<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6826864">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6826919">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6826973">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6827024">package</span>&nbsp;<span class="ident" id="6827032">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827037">import</span>&nbsp;<span class="op" id="6827044">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827047">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827056">&#34;image&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827065">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827080">_</span>&nbsp;<span class="string" id="6827082">&#34;image/png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827095">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827108">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827121">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827127">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6827137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827140">func</span>&nbsp;<span class="ident" id="6827145">readImg</span><span class="op" id="6827152">(</span><span class="ident" id="6827153">filename</span>&nbsp;<span class="builtintype" id="6827162">string</span><span class="op" id="6827168">)</span>&nbsp;<span class="op" id="6827170">(</span><span class="ident" id="6827171">image</span><span class="op" id="6827176">.</span><span class="ident" id="6827177">Image</span><span class="op" id="6827182">,</span>&nbsp;<span class="builtintype" id="6827184">error</span><span class="op" id="6827189">)</span>&nbsp;<span class="op" id="6827191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827194">f</span><span class="op" id="6827195">,</span>&nbsp;<span class="ident" id="6827197">err</span>&nbsp;<span class="op" id="6827201">:=</span>&nbsp;<span class="ident" id="6827204">os</span><span class="op" id="6827206">.</span><span class="ident" id="6827207">Open</span><span class="op" id="6827211">(</span><span class="ident" id="6827212">filename</span><span class="op" id="6827220">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827223">if</span>&nbsp;<span class="ident" id="6827226">err</span>&nbsp;<span class="op" id="6827230">!=</span>&nbsp;<span class="ident" id="6827233">nil</span>&nbsp;<span class="op" id="6827237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827241">return</span>&nbsp;<span class="ident" id="6827248">nil</span><span class="op" id="6827251">,</span>&nbsp;<span class="ident" id="6827253">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827261">defer</span>&nbsp;<span class="ident" id="6827267">f</span><span class="op" id="6827268">.</span><span class="ident" id="6827269">Close</span><span class="op" id="6827274">(</span><span class="op" id="6827275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827278">m</span><span class="op" id="6827279">,</span>&nbsp;<span class="ident" id="6827281">_</span><span class="op" id="6827282">,</span>&nbsp;<span class="ident" id="6827284">err</span>&nbsp;<span class="op" id="6827288">:=</span>&nbsp;<span class="ident" id="6827291">image</span><span class="op" id="6827296">.</span><span class="ident" id="6827297">Decode</span><span class="op" id="6827303">(</span><span class="ident" id="6827304">f</span><span class="op" id="6827305">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827308">return</span>&nbsp;<span class="ident" id="6827315">m</span><span class="op" id="6827316">,</span>&nbsp;<span class="ident" id="6827318">err</span><br>
<span class="lineno"></span><span class="op" id="6827322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827325">func</span>&nbsp;<span class="ident" id="6827330">readGIF</span><span class="op" id="6827337">(</span><span class="ident" id="6827338">filename</span>&nbsp;<span class="builtintype" id="6827347">string</span><span class="op" id="6827353">)</span>&nbsp;<span class="op" id="6827355">(</span><span class="op" id="6827356">*</span><span class="ident" id="6827357">GIF</span><span class="op" id="6827360">,</span>&nbsp;<span class="builtintype" id="6827362">error</span><span class="op" id="6827367">)</span>&nbsp;<span class="op" id="6827369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827372">f</span><span class="op" id="6827373">,</span>&nbsp;<span class="ident" id="6827375">err</span>&nbsp;<span class="op" id="6827379">:=</span>&nbsp;<span class="ident" id="6827382">os</span><span class="op" id="6827384">.</span><span class="ident" id="6827385">Open</span><span class="op" id="6827389">(</span><span class="ident" id="6827390">filename</span><span class="op" id="6827398">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827401">if</span>&nbsp;<span class="ident" id="6827404">err</span>&nbsp;<span class="op" id="6827408">!=</span>&nbsp;<span class="ident" id="6827411">nil</span>&nbsp;<span class="op" id="6827415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827419">return</span>&nbsp;<span class="ident" id="6827426">nil</span><span class="op" id="6827429">,</span>&nbsp;<span class="ident" id="6827431">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827439">defer</span>&nbsp;<span class="ident" id="6827445">f</span><span class="op" id="6827446">.</span><span class="ident" id="6827447">Close</span><span class="op" id="6827452">(</span><span class="op" id="6827453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827456">return</span>&nbsp;<span class="ident" id="6827463">DecodeAll</span><span class="op" id="6827472">(</span><span class="ident" id="6827473">f</span><span class="op" id="6827474">)</span><br>
<span class="lineno">35</span><span class="op" id="6827476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827479">func</span>&nbsp;<span class="ident" id="6827484">delta</span><span class="op" id="6827489">(</span><span class="ident" id="6827490">u0</span><span class="op" id="6827492">,</span>&nbsp;<span class="ident" id="6827494">u1</span>&nbsp;<span class="builtintype" id="6827497">uint32</span><span class="op" id="6827503">)</span>&nbsp;<span class="ident" id="6827505">int64</span>&nbsp;<span class="op" id="6827511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827514">d</span>&nbsp;<span class="op" id="6827516">:=</span>&nbsp;<span class="ident" id="6827519">int64</span><span class="op" id="6827524">(</span><span class="ident" id="6827525">u0</span><span class="op" id="6827527">)</span>&nbsp;<span class="op" id="6827529">-</span>&nbsp;<span class="ident" id="6827531">int64</span><span class="op" id="6827536">(</span><span class="ident" id="6827537">u1</span><span class="op" id="6827539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827542">if</span>&nbsp;<span class="ident" id="6827545">d</span>&nbsp;<span class="op" id="6827547">&lt;</span>&nbsp;<span class="num" id="6827549">0</span>&nbsp;<span class="op" id="6827551">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827555">return</span>&nbsp;<span class="op" id="6827562">-</span><span class="ident" id="6827563">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827569">return</span>&nbsp;<span class="ident" id="6827576">d</span><br>
<span class="lineno"></span><span class="op" id="6827578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6827581">//&nbsp;averageDelta&nbsp;returns&nbsp;the&nbsp;average&nbsp;delta&nbsp;in&nbsp;RGB&nbsp;space.&nbsp;The&nbsp;two&nbsp;images&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="6827657">//&nbsp;have&nbsp;the&nbsp;same&nbsp;bounds.</span><br>
<span class="lineno"></span><span class="keyword" id="6827682">func</span>&nbsp;<span class="ident" id="6827687">averageDelta</span><span class="op" id="6827699">(</span><span class="ident" id="6827700">m0</span><span class="op" id="6827702">,</span>&nbsp;<span class="ident" id="6827704">m1</span>&nbsp;<span class="ident" id="6827707">image</span><span class="op" id="6827712">.</span><span class="ident" id="6827713">Image</span><span class="op" id="6827718">)</span>&nbsp;<span class="ident" id="6827720">int64</span>&nbsp;<span class="op" id="6827726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827729">b</span>&nbsp;<span class="op" id="6827731">:=</span>&nbsp;<span class="ident" id="6827734">m0</span><span class="op" id="6827736">.</span><span class="ident" id="6827737">Bounds</span><span class="op" id="6827743">(</span><span class="op" id="6827744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827747">var</span>&nbsp;<span class="ident" id="6827751">sum</span><span class="op" id="6827754">,</span>&nbsp;<span class="ident" id="6827756">n</span>&nbsp;<span class="ident" id="6827758">int64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827765">for</span>&nbsp;<span class="ident" id="6827769">y</span>&nbsp;<span class="op" id="6827771">:=</span>&nbsp;<span class="ident" id="6827774">b</span><span class="op" id="6827775">.</span><span class="ident" id="6827776">Min</span><span class="op" id="6827779">.</span><span class="ident" id="6827780">Y</span><span class="op" id="6827781">;</span>&nbsp;<span class="ident" id="6827783">y</span>&nbsp;<span class="op" id="6827785">&lt;</span>&nbsp;<span class="ident" id="6827787">b</span><span class="op" id="6827788">.</span><span class="ident" id="6827789">Max</span><span class="op" id="6827792">.</span><span class="ident" id="6827793">Y</span><span class="op" id="6827794">;</span>&nbsp;<span class="ident" id="6827796">y</span><span class="op" id="6827797">++</span>&nbsp;<span class="op" id="6827800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827804">for</span>&nbsp;<span class="ident" id="6827808">x</span>&nbsp;<span class="op" id="6827810">:=</span>&nbsp;<span class="ident" id="6827813">b</span><span class="op" id="6827814">.</span><span class="ident" id="6827815">Min</span><span class="op" id="6827818">.</span><span class="ident" id="6827819">X</span><span class="op" id="6827820">;</span>&nbsp;<span class="ident" id="6827822">x</span>&nbsp;<span class="op" id="6827824">&lt;</span>&nbsp;<span class="ident" id="6827826">b</span><span class="op" id="6827827">.</span><span class="ident" id="6827828">Max</span><span class="op" id="6827831">.</span><span class="ident" id="6827832">X</span><span class="op" id="6827833">;</span>&nbsp;<span class="ident" id="6827835">x</span><span class="op" id="6827836">++</span>&nbsp;<span class="op" id="6827839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827844">c0</span>&nbsp;<span class="op" id="6827847">:=</span>&nbsp;<span class="ident" id="6827850">m0</span><span class="op" id="6827852">.</span><span class="ident" id="6827853">At</span><span class="op" id="6827855">(</span><span class="ident" id="6827856">x</span><span class="op" id="6827857">,</span>&nbsp;<span class="ident" id="6827859">y</span><span class="op" id="6827860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827865">c1</span>&nbsp;<span class="op" id="6827868">:=</span>&nbsp;<span class="ident" id="6827871">m1</span><span class="op" id="6827873">.</span><span class="ident" id="6827874">At</span><span class="op" id="6827876">(</span><span class="ident" id="6827877">x</span><span class="op" id="6827878">,</span>&nbsp;<span class="ident" id="6827880">y</span><span class="op" id="6827881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827886">r0</span><span class="op" id="6827888">,</span>&nbsp;<span class="ident" id="6827890">g0</span><span class="op" id="6827892">,</span>&nbsp;<span class="ident" id="6827894">b0</span><span class="op" id="6827896">,</span>&nbsp;<span class="ident" id="6827898">_</span>&nbsp;<span class="op" id="6827900">:=</span>&nbsp;<span class="ident" id="6827903">c0</span><span class="op" id="6827905">.</span><span class="ident" id="6827906">RGBA</span><span class="op" id="6827910">(</span><span class="op" id="6827911">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827916">r1</span><span class="op" id="6827918">,</span>&nbsp;<span class="ident" id="6827920">g1</span><span class="op" id="6827922">,</span>&nbsp;<span class="ident" id="6827924">b1</span><span class="op" id="6827926">,</span>&nbsp;<span class="ident" id="6827928">_</span>&nbsp;<span class="op" id="6827930">:=</span>&nbsp;<span class="ident" id="6827933">c1</span><span class="op" id="6827935">.</span><span class="ident" id="6827936">RGBA</span><span class="op" id="6827940">(</span><span class="op" id="6827941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827946">sum</span>&nbsp;<span class="op" id="6827950">+=</span>&nbsp;<span class="ident" id="6827953">delta</span><span class="op" id="6827958">(</span><span class="ident" id="6827959">r0</span><span class="op" id="6827961">,</span>&nbsp;<span class="ident" id="6827963">r1</span><span class="op" id="6827965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827970">sum</span>&nbsp;<span class="op" id="6827974">+=</span>&nbsp;<span class="ident" id="6827977">delta</span><span class="op" id="6827982">(</span><span class="ident" id="6827983">g0</span><span class="op" id="6827985">,</span>&nbsp;<span class="ident" id="6827987">g1</span><span class="op" id="6827989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827994">sum</span>&nbsp;<span class="op" id="6827998">+=</span>&nbsp;<span class="ident" id="6828001">delta</span><span class="op" id="6828006">(</span><span class="ident" id="6828007">b0</span><span class="op" id="6828009">,</span>&nbsp;<span class="ident" id="6828011">b1</span><span class="op" id="6828013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828018">n</span>&nbsp;<span class="op" id="6828020">+=</span>&nbsp;<span class="num" id="6828023">3</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828033">return</span>&nbsp;<span class="ident" id="6828040">sum</span>&nbsp;<span class="op" id="6828044">/</span>&nbsp;<span class="ident" id="6828046">n</span><br>
<span class="lineno"></span><span class="op" id="6828048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6828051">var</span>&nbsp;<span class="ident" id="6828055">testCase</span>&nbsp;<span class="op" id="6828064">=</span>&nbsp;<span class="op" id="6828066">[</span><span class="op" id="6828067">]</span><span class="keyword" id="6828068">struct</span>&nbsp;<span class="op" id="6828075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828078">filename</span>&nbsp;&nbsp;<span class="builtintype" id="6828088">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828096">tolerance</span>&nbsp;<span class="ident" id="6828106">int64</span><br>
<span class="lineno"></span><span class="op" id="6828112">}</span><span class="op" id="6828113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828116">{</span><span class="string" id="6828117">&#34;../testdata/video-001.png&#34;</span><span class="op" id="6828144">,</span>&nbsp;<span class="num" id="6828146">1</span>&nbsp;<span class="op" id="6828148">&lt;&lt;</span>&nbsp;<span class="num" id="6828151">12</span><span class="op" id="6828153">}</span><span class="op" id="6828154">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828157">{</span><span class="string" id="6828158">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="6828185">,</span>&nbsp;<span class="num" id="6828187">0</span><span class="op" id="6828188">}</span><span class="op" id="6828189">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828192">{</span><span class="string" id="6828193">&#34;../testdata/video-001.interlaced.gif&#34;</span><span class="op" id="6828231">,</span>&nbsp;<span class="num" id="6828233">0</span><span class="op" id="6828234">}</span><span class="op" id="6828235">,</span><br>
<span class="lineno"></span><span class="op" id="6828237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6828240">func</span>&nbsp;<span class="ident" id="6828245">TestWriter</span><span class="op" id="6828255">(</span><span class="ident" id="6828256">t</span>&nbsp;<span class="op" id="6828258">*</span><span class="ident" id="6828259">testing</span><span class="op" id="6828266">.</span><span class="ident" id="6828267">T</span><span class="op" id="6828268">)</span>&nbsp;<span class="op" id="6828270">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828273">for</span>&nbsp;<span class="ident" id="6828277">_</span><span class="op" id="6828278">,</span>&nbsp;<span class="ident" id="6828280">tc</span>&nbsp;<span class="op" id="6828283">:=</span>&nbsp;<span class="keyword" id="6828286">range</span>&nbsp;<span class="ident" id="6828292">testCase</span>&nbsp;<span class="op" id="6828301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828305">m0</span><span class="op" id="6828307">,</span>&nbsp;<span class="ident" id="6828309">err</span>&nbsp;<span class="op" id="6828313">:=</span>&nbsp;<span class="ident" id="6828316">readImg</span><span class="op" id="6828323">(</span><span class="ident" id="6828324">tc</span><span class="op" id="6828326">.</span><span class="ident" id="6828327">filename</span><span class="op" id="6828335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828339">if</span>&nbsp;<span class="ident" id="6828342">err</span>&nbsp;<span class="op" id="6828346">!=</span>&nbsp;<span class="ident" id="6828349">nil</span>&nbsp;<span class="op" id="6828353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828358">t</span><span class="op" id="6828359">.</span><span class="ident" id="6828360">Error</span><span class="op" id="6828365">(</span><span class="ident" id="6828366">tc</span><span class="op" id="6828368">.</span><span class="ident" id="6828369">filename</span><span class="op" id="6828377">,</span>&nbsp;<span class="ident" id="6828379">err</span><span class="op" id="6828382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828387">continue</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828402">var</span>&nbsp;<span class="ident" id="6828406">buf</span>&nbsp;<span class="ident" id="6828410">bytes</span><span class="op" id="6828415">.</span><span class="ident" id="6828416">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828425">err</span>&nbsp;<span class="op" id="6828429">=</span>&nbsp;<span class="ident" id="6828431">Encode</span><span class="op" id="6828437">(</span><span class="op" id="6828438">&amp;</span><span class="ident" id="6828439">buf</span><span class="op" id="6828442">,</span>&nbsp;<span class="ident" id="6828444">m0</span><span class="op" id="6828446">,</span>&nbsp;<span class="ident" id="6828448">nil</span><span class="op" id="6828451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828455">if</span>&nbsp;<span class="ident" id="6828458">err</span>&nbsp;<span class="op" id="6828462">!=</span>&nbsp;<span class="ident" id="6828465">nil</span>&nbsp;<span class="op" id="6828469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828474">t</span><span class="op" id="6828475">.</span><span class="ident" id="6828476">Error</span><span class="op" id="6828481">(</span><span class="ident" id="6828482">tc</span><span class="op" id="6828484">.</span><span class="ident" id="6828485">filename</span><span class="op" id="6828493">,</span>&nbsp;<span class="ident" id="6828495">err</span><span class="op" id="6828498">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828503">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828518">m1</span><span class="op" id="6828520">,</span>&nbsp;<span class="ident" id="6828522">err</span>&nbsp;<span class="op" id="6828526">:=</span>&nbsp;<span class="ident" id="6828529">Decode</span><span class="op" id="6828535">(</span><span class="op" id="6828536">&amp;</span><span class="ident" id="6828537">buf</span><span class="op" id="6828540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828544">if</span>&nbsp;<span class="ident" id="6828547">err</span>&nbsp;<span class="op" id="6828551">!=</span>&nbsp;<span class="ident" id="6828554">nil</span>&nbsp;<span class="op" id="6828558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828563">t</span><span class="op" id="6828564">.</span><span class="ident" id="6828565">Error</span><span class="op" id="6828570">(</span><span class="ident" id="6828571">tc</span><span class="op" id="6828573">.</span><span class="ident" id="6828574">filename</span><span class="op" id="6828582">,</span>&nbsp;<span class="ident" id="6828584">err</span><span class="op" id="6828587">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828592">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828607">if</span>&nbsp;<span class="ident" id="6828610">m0</span><span class="op" id="6828612">.</span><span class="ident" id="6828613">Bounds</span><span class="op" id="6828619">(</span><span class="op" id="6828620">)</span>&nbsp;<span class="op" id="6828622">!=</span>&nbsp;<span class="ident" id="6828625">m1</span><span class="op" id="6828627">.</span><span class="ident" id="6828628">Bounds</span><span class="op" id="6828634">(</span><span class="op" id="6828635">)</span>&nbsp;<span class="op" id="6828637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828642">t</span><span class="op" id="6828643">.</span><span class="ident" id="6828644">Errorf</span><span class="op" id="6828650">(</span><span class="string" id="6828651">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6828681">,</span>&nbsp;<span class="ident" id="6828683">tc</span><span class="op" id="6828685">.</span><span class="ident" id="6828686">filename</span><span class="op" id="6828694">,</span>&nbsp;<span class="ident" id="6828696">m0</span><span class="op" id="6828698">.</span><span class="ident" id="6828699">Bounds</span><span class="op" id="6828705">(</span><span class="op" id="6828706">)</span><span class="op" id="6828707">,</span>&nbsp;<span class="ident" id="6828709">m1</span><span class="op" id="6828711">.</span><span class="ident" id="6828712">Bounds</span><span class="op" id="6828718">(</span><span class="op" id="6828719">)</span><span class="op" id="6828720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828725">continue</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6828740">//&nbsp;Compare&nbsp;the&nbsp;average&nbsp;delta&nbsp;to&nbsp;the&nbsp;tolerance&nbsp;level.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828795">avgDelta</span>&nbsp;<span class="op" id="6828804">:=</span>&nbsp;<span class="ident" id="6828807">averageDelta</span><span class="op" id="6828819">(</span><span class="ident" id="6828820">m0</span><span class="op" id="6828822">,</span>&nbsp;<span class="ident" id="6828824">m1</span><span class="op" id="6828826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828830">if</span>&nbsp;<span class="ident" id="6828833">avgDelta</span>&nbsp;<span class="op" id="6828842">&gt;</span>&nbsp;<span class="ident" id="6828844">tc</span><span class="op" id="6828846">.</span><span class="ident" id="6828847">tolerance</span>&nbsp;<span class="op" id="6828857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828862">t</span><span class="op" id="6828863">.</span><span class="ident" id="6828864">Errorf</span><span class="op" id="6828870">(</span><span class="string" id="6828871">&#34;%s:&nbsp;average&nbsp;delta&nbsp;is&nbsp;too&nbsp;high.&nbsp;expected:&nbsp;%d,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6828924">,</span>&nbsp;<span class="ident" id="6828926">tc</span><span class="op" id="6828928">.</span><span class="ident" id="6828929">filename</span><span class="op" id="6828937">,</span>&nbsp;<span class="ident" id="6828939">tc</span><span class="op" id="6828941">.</span><span class="ident" id="6828942">tolerance</span><span class="op" id="6828951">,</span>&nbsp;<span class="ident" id="6828953">avgDelta</span><span class="op" id="6828961">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828966">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828980">}</span><br>
<span class="lineno"></span><span class="op" id="6828982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6828985">func</span>&nbsp;<span class="ident" id="6828990">TestSubImage</span><span class="op" id="6829002">(</span><span class="ident" id="6829003">t</span>&nbsp;<span class="op" id="6829005">*</span><span class="ident" id="6829006">testing</span><span class="op" id="6829013">.</span><span class="ident" id="6829014">T</span><span class="op" id="6829015">)</span>&nbsp;<span class="op" id="6829017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829020">m0</span><span class="op" id="6829022">,</span>&nbsp;<span class="ident" id="6829024">err</span>&nbsp;<span class="op" id="6829028">:=</span>&nbsp;<span class="ident" id="6829031">readImg</span><span class="op" id="6829038">(</span><span class="string" id="6829039">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="6829066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829069">if</span>&nbsp;<span class="ident" id="6829072">err</span>&nbsp;<span class="op" id="6829076">!=</span>&nbsp;<span class="ident" id="6829079">nil</span>&nbsp;<span class="op" id="6829083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829087">t</span><span class="op" id="6829088">.</span><span class="ident" id="6829089">Fatalf</span><span class="op" id="6829095">(</span><span class="string" id="6829096">&#34;readImg:&nbsp;%v&#34;</span><span class="op" id="6829109">,</span>&nbsp;<span class="ident" id="6829111">err</span><span class="op" id="6829114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829117">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829120">m0</span>&nbsp;<span class="op" id="6829123">=</span>&nbsp;<span class="ident" id="6829125">m0</span><span class="op" id="6829127">.</span><span class="op" id="6829128">(</span><span class="op" id="6829129">*</span><span class="ident" id="6829130">image</span><span class="op" id="6829135">.</span><span class="ident" id="6829136">Paletted</span><span class="op" id="6829144">)</span><span class="op" id="6829145">.</span><span class="ident" id="6829146">SubImage</span><span class="op" id="6829154">(</span><span class="ident" id="6829155">image</span><span class="op" id="6829160">.</span><span class="ident" id="6829161">Rect</span><span class="op" id="6829165">(</span><span class="num" id="6829166">0</span><span class="op" id="6829167">,</span>&nbsp;<span class="num" id="6829169">0</span><span class="op" id="6829170">,</span>&nbsp;<span class="num" id="6829172">50</span><span class="op" id="6829174">,</span>&nbsp;<span class="num" id="6829176">30</span><span class="op" id="6829178">)</span><span class="op" id="6829179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829182">var</span>&nbsp;<span class="ident" id="6829186">buf</span>&nbsp;<span class="ident" id="6829190">bytes</span><span class="op" id="6829195">.</span><span class="ident" id="6829196">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829204">err</span>&nbsp;<span class="op" id="6829208">=</span>&nbsp;<span class="ident" id="6829210">Encode</span><span class="op" id="6829216">(</span><span class="op" id="6829217">&amp;</span><span class="ident" id="6829218">buf</span><span class="op" id="6829221">,</span>&nbsp;<span class="ident" id="6829223">m0</span><span class="op" id="6829225">,</span>&nbsp;<span class="ident" id="6829227">nil</span><span class="op" id="6829230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829233">if</span>&nbsp;<span class="ident" id="6829236">err</span>&nbsp;<span class="op" id="6829240">!=</span>&nbsp;<span class="ident" id="6829243">nil</span>&nbsp;<span class="op" id="6829247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829251">t</span><span class="op" id="6829252">.</span><span class="ident" id="6829253">Fatalf</span><span class="op" id="6829259">(</span><span class="string" id="6829260">&#34;Encode:&nbsp;%v&#34;</span><span class="op" id="6829272">,</span>&nbsp;<span class="ident" id="6829274">err</span><span class="op" id="6829277">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829283">m1</span><span class="op" id="6829285">,</span>&nbsp;<span class="ident" id="6829287">err</span>&nbsp;<span class="op" id="6829291">:=</span>&nbsp;<span class="ident" id="6829294">Decode</span><span class="op" id="6829300">(</span><span class="op" id="6829301">&amp;</span><span class="ident" id="6829302">buf</span><span class="op" id="6829305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829308">if</span>&nbsp;<span class="ident" id="6829311">err</span>&nbsp;<span class="op" id="6829315">!=</span>&nbsp;<span class="ident" id="6829318">nil</span>&nbsp;<span class="op" id="6829322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829326">t</span><span class="op" id="6829327">.</span><span class="ident" id="6829328">Fatalf</span><span class="op" id="6829334">(</span><span class="string" id="6829335">&#34;Decode:&nbsp;%v&#34;</span><span class="op" id="6829347">,</span>&nbsp;<span class="ident" id="6829349">err</span><span class="op" id="6829352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829355">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829358">if</span>&nbsp;<span class="ident" id="6829361">m0</span><span class="op" id="6829363">.</span><span class="ident" id="6829364">Bounds</span><span class="op" id="6829370">(</span><span class="op" id="6829371">)</span>&nbsp;<span class="op" id="6829373">!=</span>&nbsp;<span class="ident" id="6829376">m1</span><span class="op" id="6829378">.</span><span class="ident" id="6829379">Bounds</span><span class="op" id="6829385">(</span><span class="op" id="6829386">)</span>&nbsp;<span class="op" id="6829388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829392">t</span><span class="op" id="6829393">.</span><span class="ident" id="6829394">Fatalf</span><span class="op" id="6829400">(</span><span class="string" id="6829401">&#34;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6829427">,</span>&nbsp;<span class="ident" id="6829429">m0</span><span class="op" id="6829431">.</span><span class="ident" id="6829432">Bounds</span><span class="op" id="6829438">(</span><span class="op" id="6829439">)</span><span class="op" id="6829440">,</span>&nbsp;<span class="ident" id="6829442">m1</span><span class="op" id="6829444">.</span><span class="ident" id="6829445">Bounds</span><span class="op" id="6829451">(</span><span class="op" id="6829452">)</span><span class="op" id="6829453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829459">if</span>&nbsp;<span class="ident" id="6829462">averageDelta</span><span class="op" id="6829474">(</span><span class="ident" id="6829475">m0</span><span class="op" id="6829477">,</span>&nbsp;<span class="ident" id="6829479">m1</span><span class="op" id="6829481">)</span>&nbsp;<span class="op" id="6829483">!=</span>&nbsp;<span class="num" id="6829486">0</span>&nbsp;<span class="op" id="6829488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829492">t</span><span class="op" id="6829493">.</span><span class="ident" id="6829494">Fatalf</span><span class="op" id="6829500">(</span><span class="string" id="6829501">&#34;images&nbsp;differ&#34;</span><span class="op" id="6829516">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829519">}</span><br>
<span class="lineno"></span><span class="op" id="6829521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6829524">var</span>&nbsp;<span class="ident" id="6829528">frames</span>&nbsp;<span class="op" id="6829535">=</span>&nbsp;<span class="op" id="6829537">[</span><span class="op" id="6829538">]</span><span class="builtintype" id="6829539">string</span><span class="op" id="6829545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6829548">&#34;../testdata/video-001.gif&#34;</span><span class="op" id="6829575">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6829578">&#34;../testdata/video-005.gray.gif&#34;</span><span class="op" id="6829610">,</span><br>
<span class="lineno"></span><span class="op" id="6829612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6829615">func</span>&nbsp;<span class="ident" id="6829620">TestEncodeAll</span><span class="op" id="6829633">(</span><span class="ident" id="6829634">t</span>&nbsp;<span class="op" id="6829636">*</span><span class="ident" id="6829637">testing</span><span class="op" id="6829644">.</span><span class="ident" id="6829645">T</span><span class="op" id="6829646">)</span>&nbsp;<span class="op" id="6829648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829651">g0</span>&nbsp;<span class="op" id="6829654">:=</span>&nbsp;<span class="op" id="6829657">&amp;</span><span class="ident" id="6829658">GIF</span><span class="op" id="6829661">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829665">Image</span><span class="op" id="6829670">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6829676">make</span><span class="op" id="6829680">(</span><span class="op" id="6829681">[</span><span class="op" id="6829682">]</span><span class="op" id="6829683">*</span><span class="ident" id="6829684">image</span><span class="op" id="6829689">.</span><span class="ident" id="6829690">Paletted</span><span class="op" id="6829698">,</span>&nbsp;<span class="builtinfunc" id="6829700">len</span><span class="op" id="6829703">(</span><span class="ident" id="6829704">frames</span><span class="op" id="6829710">)</span><span class="op" id="6829711">)</span><span class="op" id="6829712">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829716">Delay</span><span class="op" id="6829721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6829727">make</span><span class="op" id="6829731">(</span><span class="op" id="6829732">[</span><span class="op" id="6829733">]</span><span class="builtintype" id="6829734">int</span><span class="op" id="6829737">,</span>&nbsp;<span class="builtinfunc" id="6829739">len</span><span class="op" id="6829742">(</span><span class="ident" id="6829743">frames</span><span class="op" id="6829749">)</span><span class="op" id="6829750">)</span><span class="op" id="6829751">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829755">LoopCount</span><span class="op" id="6829764">:</span>&nbsp;<span class="num" id="6829766">5</span><span class="op" id="6829767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829773">for</span>&nbsp;<span class="ident" id="6829777">i</span><span class="op" id="6829778">,</span>&nbsp;<span class="ident" id="6829780">f</span>&nbsp;<span class="op" id="6829782">:=</span>&nbsp;<span class="keyword" id="6829785">range</span>&nbsp;<span class="ident" id="6829791">frames</span>&nbsp;<span class="op" id="6829798">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829802">m</span><span class="op" id="6829803">,</span>&nbsp;<span class="ident" id="6829805">err</span>&nbsp;<span class="op" id="6829809">:=</span>&nbsp;<span class="ident" id="6829812">readGIF</span><span class="op" id="6829819">(</span><span class="ident" id="6829820">f</span><span class="op" id="6829821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829825">if</span>&nbsp;<span class="ident" id="6829828">err</span>&nbsp;<span class="op" id="6829832">!=</span>&nbsp;<span class="ident" id="6829835">nil</span>&nbsp;<span class="op" id="6829839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829844">t</span><span class="op" id="6829845">.</span><span class="ident" id="6829846">Fatal</span><span class="op" id="6829851">(</span><span class="ident" id="6829852">f</span><span class="op" id="6829853">,</span>&nbsp;<span class="ident" id="6829855">err</span><span class="op" id="6829858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829866">g0</span><span class="op" id="6829868">.</span><span class="ident" id="6829869">Image</span><span class="op" id="6829874">[</span><span class="ident" id="6829875">i</span><span class="op" id="6829876">]</span>&nbsp;<span class="op" id="6829878">=</span>&nbsp;<span class="ident" id="6829880">m</span><span class="op" id="6829881">.</span><span class="ident" id="6829882">Image</span><span class="op" id="6829887">[</span><span class="num" id="6829888">0</span><span class="op" id="6829889">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829895">var</span>&nbsp;<span class="ident" id="6829899">buf</span>&nbsp;<span class="ident" id="6829903">bytes</span><span class="op" id="6829908">.</span><span class="ident" id="6829909">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829917">if</span>&nbsp;<span class="ident" id="6829920">err</span>&nbsp;<span class="op" id="6829924">:=</span>&nbsp;<span class="ident" id="6829927">EncodeAll</span><span class="op" id="6829936">(</span><span class="op" id="6829937">&amp;</span><span class="ident" id="6829938">buf</span><span class="op" id="6829941">,</span>&nbsp;<span class="ident" id="6829943">g0</span><span class="op" id="6829945">)</span><span class="op" id="6829946">;</span>&nbsp;<span class="ident" id="6829948">err</span>&nbsp;<span class="op" id="6829952">!=</span>&nbsp;<span class="ident" id="6829955">nil</span>&nbsp;<span class="op" id="6829959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829963">t</span><span class="op" id="6829964">.</span><span class="ident" id="6829965">Fatal</span><span class="op" id="6829970">(</span><span class="string" id="6829971">&#34;EncodeAll:&#34;</span><span class="op" id="6829983">,</span>&nbsp;<span class="ident" id="6829985">err</span><span class="op" id="6829988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829991">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829994">g1</span><span class="op" id="6829996">,</span>&nbsp;<span class="ident" id="6829998">err</span>&nbsp;<span class="op" id="6830002">:=</span>&nbsp;<span class="ident" id="6830005">DecodeAll</span><span class="op" id="6830014">(</span><span class="op" id="6830015">&amp;</span><span class="ident" id="6830016">buf</span><span class="op" id="6830019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830022">if</span>&nbsp;<span class="ident" id="6830025">err</span>&nbsp;<span class="op" id="6830029">!=</span>&nbsp;<span class="ident" id="6830032">nil</span>&nbsp;<span class="op" id="6830036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830040">t</span><span class="op" id="6830041">.</span><span class="ident" id="6830042">Fatal</span><span class="op" id="6830047">(</span><span class="string" id="6830048">&#34;DecodeAll:&#34;</span><span class="op" id="6830060">,</span>&nbsp;<span class="ident" id="6830062">err</span><span class="op" id="6830065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830071">if</span>&nbsp;<span class="ident" id="6830074">g0</span><span class="op" id="6830076">.</span><span class="ident" id="6830077">LoopCount</span>&nbsp;<span class="op" id="6830087">!=</span>&nbsp;<span class="ident" id="6830090">g1</span><span class="op" id="6830092">.</span><span class="ident" id="6830093">LoopCount</span>&nbsp;<span class="op" id="6830103">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830107">t</span><span class="op" id="6830108">.</span><span class="ident" id="6830109">Errorf</span><span class="op" id="6830115">(</span><span class="string" id="6830116">&#34;loop&nbsp;counts&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="6830147">,</span>&nbsp;<span class="ident" id="6830149">g0</span><span class="op" id="6830151">.</span><span class="ident" id="6830152">LoopCount</span><span class="op" id="6830161">,</span>&nbsp;<span class="ident" id="6830163">g1</span><span class="op" id="6830165">.</span><span class="ident" id="6830166">LoopCount</span><span class="op" id="6830175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830181">for</span>&nbsp;<span class="ident" id="6830185">i</span>&nbsp;<span class="op" id="6830187">:=</span>&nbsp;<span class="keyword" id="6830190">range</span>&nbsp;<span class="ident" id="6830196">g0</span><span class="op" id="6830198">.</span><span class="ident" id="6830199">Image</span>&nbsp;<span class="op" id="6830205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830209">m0</span><span class="op" id="6830211">,</span>&nbsp;<span class="ident" id="6830213">m1</span>&nbsp;<span class="op" id="6830216">:=</span>&nbsp;<span class="ident" id="6830219">g0</span><span class="op" id="6830221">.</span><span class="ident" id="6830222">Image</span><span class="op" id="6830227">[</span><span class="ident" id="6830228">i</span><span class="op" id="6830229">]</span><span class="op" id="6830230">,</span>&nbsp;<span class="ident" id="6830232">g1</span><span class="op" id="6830234">.</span><span class="ident" id="6830235">Image</span><span class="op" id="6830240">[</span><span class="ident" id="6830241">i</span><span class="op" id="6830242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830246">if</span>&nbsp;<span class="ident" id="6830249">m0</span><span class="op" id="6830251">.</span><span class="ident" id="6830252">Bounds</span><span class="op" id="6830258">(</span><span class="op" id="6830259">)</span>&nbsp;<span class="op" id="6830261">!=</span>&nbsp;<span class="ident" id="6830264">m1</span><span class="op" id="6830266">.</span><span class="ident" id="6830267">Bounds</span><span class="op" id="6830273">(</span><span class="op" id="6830274">)</span>&nbsp;<span class="op" id="6830276">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830281">t</span><span class="op" id="6830282">.</span><span class="ident" id="6830283">Errorf</span><span class="op" id="6830289">(</span><span class="string" id="6830290">&#34;%s,&nbsp;bounds&nbsp;differ:&nbsp;%v&nbsp;and&nbsp;%v&#34;</span><span class="op" id="6830320">,</span>&nbsp;<span class="ident" id="6830322">frames</span><span class="op" id="6830328">[</span><span class="ident" id="6830329">i</span><span class="op" id="6830330">]</span><span class="op" id="6830331">,</span>&nbsp;<span class="ident" id="6830333">m0</span><span class="op" id="6830335">.</span><span class="ident" id="6830336">Bounds</span><span class="op" id="6830342">(</span><span class="op" id="6830343">)</span><span class="op" id="6830344">,</span>&nbsp;<span class="ident" id="6830346">m1</span><span class="op" id="6830348">.</span><span class="ident" id="6830349">Bounds</span><span class="op" id="6830355">(</span><span class="op" id="6830356">)</span><span class="op" id="6830357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830365">d0</span><span class="op" id="6830367">,</span>&nbsp;<span class="ident" id="6830369">d1</span>&nbsp;<span class="op" id="6830372">:=</span>&nbsp;<span class="ident" id="6830375">g0</span><span class="op" id="6830377">.</span><span class="ident" id="6830378">Delay</span><span class="op" id="6830383">[</span><span class="ident" id="6830384">i</span><span class="op" id="6830385">]</span><span class="op" id="6830386">,</span>&nbsp;<span class="ident" id="6830388">g1</span><span class="op" id="6830390">.</span><span class="ident" id="6830391">Delay</span><span class="op" id="6830396">[</span><span class="ident" id="6830397">i</span><span class="op" id="6830398">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830402">if</span>&nbsp;<span class="ident" id="6830405">d0</span>&nbsp;<span class="op" id="6830408">!=</span>&nbsp;<span class="ident" id="6830411">d1</span>&nbsp;<span class="op" id="6830414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830419">t</span><span class="op" id="6830420">.</span><span class="ident" id="6830421">Errorf</span><span class="op" id="6830427">(</span><span class="string" id="6830428">&#34;%s:&nbsp;delay&nbsp;values&nbsp;differ:&nbsp;%d&nbsp;and&nbsp;%d&#34;</span><span class="op" id="6830464">,</span>&nbsp;<span class="ident" id="6830466">frames</span><span class="op" id="6830472">[</span><span class="ident" id="6830473">i</span><span class="op" id="6830474">]</span><span class="op" id="6830475">,</span>&nbsp;<span class="ident" id="6830477">d0</span><span class="op" id="6830479">,</span>&nbsp;<span class="ident" id="6830481">d1</span><span class="op" id="6830483">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830494">g1</span><span class="op" id="6830496">.</span><span class="ident" id="6830497">Delay</span>&nbsp;<span class="op" id="6830503">=</span>&nbsp;<span class="builtinfunc" id="6830505">make</span><span class="op" id="6830509">(</span><span class="op" id="6830510">[</span><span class="op" id="6830511">]</span><span class="builtintype" id="6830512">int</span><span class="op" id="6830515">,</span>&nbsp;<span class="num" id="6830517">1</span><span class="op" id="6830518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830521">if</span>&nbsp;<span class="ident" id="6830524">err</span>&nbsp;<span class="op" id="6830528">:=</span>&nbsp;<span class="ident" id="6830531">EncodeAll</span><span class="op" id="6830540">(</span><span class="ident" id="6830541">ioutil</span><span class="op" id="6830547">.</span><span class="ident" id="6830548">Discard</span><span class="op" id="6830555">,</span>&nbsp;<span class="ident" id="6830557">g1</span><span class="op" id="6830559">)</span><span class="op" id="6830560">;</span>&nbsp;<span class="ident" id="6830562">err</span>&nbsp;<span class="op" id="6830566">==</span>&nbsp;<span class="ident" id="6830569">nil</span>&nbsp;<span class="op" id="6830573">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830577">t</span><span class="op" id="6830578">.</span><span class="ident" id="6830579">Error</span><span class="op" id="6830584">(</span><span class="string" id="6830585">&#34;expected&nbsp;error&nbsp;from&nbsp;mismatched&nbsp;delay&nbsp;and&nbsp;image&nbsp;slice&nbsp;lengths&#34;</span><span class="op" id="6830647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830653">if</span>&nbsp;<span class="ident" id="6830656">err</span>&nbsp;<span class="op" id="6830660">:=</span>&nbsp;<span class="ident" id="6830663">EncodeAll</span><span class="op" id="6830672">(</span><span class="ident" id="6830673">ioutil</span><span class="op" id="6830679">.</span><span class="ident" id="6830680">Discard</span><span class="op" id="6830687">,</span>&nbsp;<span class="op" id="6830689">&amp;</span><span class="ident" id="6830690">GIF</span><span class="op" id="6830693">{</span><span class="op" id="6830694">}</span><span class="op" id="6830695">)</span><span class="op" id="6830696">;</span>&nbsp;<span class="ident" id="6830698">err</span>&nbsp;<span class="op" id="6830702">==</span>&nbsp;<span class="ident" id="6830705">nil</span>&nbsp;<span class="op" id="6830709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830713">t</span><span class="op" id="6830714">.</span><span class="ident" id="6830715">Error</span><span class="op" id="6830720">(</span><span class="string" id="6830721">&#34;expected&nbsp;error&nbsp;from&nbsp;providing&nbsp;empty&nbsp;gif&#34;</span><span class="op" id="6830762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830765">}</span><br>
<span class="lineno">175</span><span class="op" id="6830767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830770">func</span>&nbsp;<span class="ident" id="6830775">BenchmarkEncode</span><span class="op" id="6830790">(</span><span class="ident" id="6830791">b</span>&nbsp;<span class="op" id="6830793">*</span><span class="ident" id="6830794">testing</span><span class="op" id="6830801">.</span><span class="ident" id="6830802">B</span><span class="op" id="6830803">)</span>&nbsp;<span class="op" id="6830805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830808">b</span><span class="op" id="6830809">.</span><span class="ident" id="6830810">StopTimer</span><span class="op" id="6830819">(</span><span class="op" id="6830820">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830824">bo</span>&nbsp;<span class="op" id="6830827">:=</span>&nbsp;<span class="ident" id="6830830">image</span><span class="op" id="6830835">.</span><span class="ident" id="6830836">Rect</span><span class="op" id="6830840">(</span><span class="num" id="6830841">0</span><span class="op" id="6830842">,</span>&nbsp;<span class="num" id="6830844">0</span><span class="op" id="6830845">,</span>&nbsp;<span class="num" id="6830847">640</span><span class="op" id="6830850">,</span>&nbsp;<span class="num" id="6830852">480</span><span class="op" id="6830855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830858">rnd</span>&nbsp;<span class="op" id="6830862">:=</span>&nbsp;<span class="ident" id="6830865">rand</span><span class="op" id="6830869">.</span><span class="ident" id="6830870">New</span><span class="op" id="6830873">(</span><span class="ident" id="6830874">rand</span><span class="op" id="6830878">.</span><span class="ident" id="6830879">NewSource</span><span class="op" id="6830888">(</span><span class="num" id="6830889">123</span><span class="op" id="6830892">)</span><span class="op" id="6830893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6830897">//&nbsp;Restrict&nbsp;to&nbsp;a&nbsp;256-color&nbsp;paletted&nbsp;image&nbsp;to&nbsp;avoid&nbsp;quantization&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830968">palette</span>&nbsp;<span class="op" id="6830976">:=</span>&nbsp;<span class="builtinfunc" id="6830979">make</span><span class="op" id="6830983">(</span><span class="ident" id="6830984">color</span><span class="op" id="6830989">.</span><span class="ident" id="6830990">Palette</span><span class="op" id="6830997">,</span>&nbsp;<span class="num" id="6830999">256</span><span class="op" id="6831002">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831005">for</span>&nbsp;<span class="ident" id="6831009">i</span>&nbsp;<span class="op" id="6831011">:=</span>&nbsp;<span class="keyword" id="6831014">range</span>&nbsp;<span class="ident" id="6831020">palette</span>&nbsp;<span class="op" id="6831028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831032">palette</span><span class="op" id="6831039">[</span><span class="ident" id="6831040">i</span><span class="op" id="6831041">]</span>&nbsp;<span class="op" id="6831043">=</span>&nbsp;<span class="ident" id="6831045">color</span><span class="op" id="6831050">.</span><span class="ident" id="6831051">RGBA</span><span class="op" id="6831055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6831060">uint8</span><span class="op" id="6831065">(</span><span class="ident" id="6831066">rnd</span><span class="op" id="6831069">.</span><span class="ident" id="6831070">Intn</span><span class="op" id="6831074">(</span><span class="num" id="6831075">256</span><span class="op" id="6831078">)</span><span class="op" id="6831079">)</span><span class="op" id="6831080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6831085">uint8</span><span class="op" id="6831090">(</span><span class="ident" id="6831091">rnd</span><span class="op" id="6831094">.</span><span class="ident" id="6831095">Intn</span><span class="op" id="6831099">(</span><span class="num" id="6831100">256</span><span class="op" id="6831103">)</span><span class="op" id="6831104">)</span><span class="op" id="6831105">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6831110">uint8</span><span class="op" id="6831115">(</span><span class="ident" id="6831116">rnd</span><span class="op" id="6831119">.</span><span class="ident" id="6831120">Intn</span><span class="op" id="6831124">(</span><span class="num" id="6831125">256</span><span class="op" id="6831128">)</span><span class="op" id="6831129">)</span><span class="op" id="6831130">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6831135">255</span><span class="op" id="6831138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831148">img</span>&nbsp;<span class="op" id="6831152">:=</span>&nbsp;<span class="ident" id="6831155">image</span><span class="op" id="6831160">.</span><span class="ident" id="6831161">NewPaletted</span><span class="op" id="6831172">(</span><span class="ident" id="6831173">image</span><span class="op" id="6831178">.</span><span class="ident" id="6831179">Rect</span><span class="op" id="6831183">(</span><span class="num" id="6831184">0</span><span class="op" id="6831185">,</span>&nbsp;<span class="num" id="6831187">0</span><span class="op" id="6831188">,</span>&nbsp;<span class="num" id="6831190">640</span><span class="op" id="6831193">,</span>&nbsp;<span class="num" id="6831195">480</span><span class="op" id="6831198">)</span><span class="op" id="6831199">,</span>&nbsp;<span class="ident" id="6831201">palette</span><span class="op" id="6831208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831211">for</span>&nbsp;<span class="ident" id="6831215">y</span>&nbsp;<span class="op" id="6831217">:=</span>&nbsp;<span class="ident" id="6831220">bo</span><span class="op" id="6831222">.</span><span class="ident" id="6831223">Min</span><span class="op" id="6831226">.</span><span class="ident" id="6831227">Y</span><span class="op" id="6831228">;</span>&nbsp;<span class="ident" id="6831230">y</span>&nbsp;<span class="op" id="6831232">&lt;</span>&nbsp;<span class="ident" id="6831234">bo</span><span class="op" id="6831236">.</span><span class="ident" id="6831237">Max</span><span class="op" id="6831240">.</span><span class="ident" id="6831241">Y</span><span class="op" id="6831242">;</span>&nbsp;<span class="ident" id="6831244">y</span><span class="op" id="6831245">++</span>&nbsp;<span class="op" id="6831248">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831252">for</span>&nbsp;<span class="ident" id="6831256">x</span>&nbsp;<span class="op" id="6831258">:=</span>&nbsp;<span class="ident" id="6831261">bo</span><span class="op" id="6831263">.</span><span class="ident" id="6831264">Min</span><span class="op" id="6831267">.</span><span class="ident" id="6831268">X</span><span class="op" id="6831269">;</span>&nbsp;<span class="ident" id="6831271">x</span>&nbsp;<span class="op" id="6831273">&lt;</span>&nbsp;<span class="ident" id="6831275">bo</span><span class="op" id="6831277">.</span><span class="ident" id="6831278">Max</span><span class="op" id="6831281">.</span><span class="ident" id="6831282">X</span><span class="op" id="6831283">;</span>&nbsp;<span class="ident" id="6831285">x</span><span class="op" id="6831286">++</span>&nbsp;<span class="op" id="6831289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831294">img</span><span class="op" id="6831297">.</span><span class="ident" id="6831298">Set</span><span class="op" id="6831301">(</span><span class="ident" id="6831302">x</span><span class="op" id="6831303">,</span>&nbsp;<span class="ident" id="6831305">y</span><span class="op" id="6831306">,</span>&nbsp;<span class="ident" id="6831308">palette</span><span class="op" id="6831315">[</span><span class="ident" id="6831316">rnd</span><span class="op" id="6831319">.</span><span class="ident" id="6831320">Intn</span><span class="op" id="6831324">(</span><span class="num" id="6831325">256</span><span class="op" id="6831328">)</span><span class="op" id="6831329">]</span><span class="op" id="6831330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831341">b</span><span class="op" id="6831342">.</span><span class="ident" id="6831343">SetBytes</span><span class="op" id="6831351">(</span><span class="num" id="6831352">640</span>&nbsp;<span class="op" id="6831356">*</span>&nbsp;<span class="num" id="6831358">480</span>&nbsp;<span class="op" id="6831362">*</span>&nbsp;<span class="num" id="6831364">4</span><span class="op" id="6831365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831368">b</span><span class="op" id="6831369">.</span><span class="ident" id="6831370">StartTimer</span><span class="op" id="6831380">(</span><span class="op" id="6831381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831384">for</span>&nbsp;<span class="ident" id="6831388">i</span>&nbsp;<span class="op" id="6831390">:=</span>&nbsp;<span class="num" id="6831393">0</span><span class="op" id="6831394">;</span>&nbsp;<span class="ident" id="6831396">i</span>&nbsp;<span class="op" id="6831398">&lt;</span>&nbsp;<span class="ident" id="6831400">b</span><span class="op" id="6831401">.</span><span class="ident" id="6831402">N</span><span class="op" id="6831403">;</span>&nbsp;<span class="ident" id="6831405">i</span><span class="op" id="6831406">++</span>&nbsp;<span class="op" id="6831409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831413">Encode</span><span class="op" id="6831419">(</span><span class="ident" id="6831420">ioutil</span><span class="op" id="6831426">.</span><span class="ident" id="6831427">Discard</span><span class="op" id="6831434">,</span>&nbsp;<span class="ident" id="6831436">img</span><span class="op" id="6831439">,</span>&nbsp;<span class="ident" id="6831441">nil</span><span class="op" id="6831444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831447">}</span><br>
<span class="lineno">205</span><span class="op" id="6831449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6831452">func</span>&nbsp;<span class="ident" id="6831457">BenchmarkQuantizedEncode</span><span class="op" id="6831481">(</span><span class="ident" id="6831482">b</span>&nbsp;<span class="op" id="6831484">*</span><span class="ident" id="6831485">testing</span><span class="op" id="6831492">.</span><span class="ident" id="6831493">B</span><span class="op" id="6831494">)</span>&nbsp;<span class="op" id="6831496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831499">b</span><span class="op" id="6831500">.</span><span class="ident" id="6831501">StopTimer</span><span class="op" id="6831510">(</span><span class="op" id="6831511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831514">img</span>&nbsp;<span class="op" id="6831518">:=</span>&nbsp;<span class="ident" id="6831521">image</span><span class="op" id="6831526">.</span><span class="ident" id="6831527">NewRGBA</span><span class="op" id="6831534">(</span><span class="ident" id="6831535">image</span><span class="op" id="6831540">.</span><span class="ident" id="6831541">Rect</span><span class="op" id="6831545">(</span><span class="num" id="6831546">0</span><span class="op" id="6831547">,</span>&nbsp;<span class="num" id="6831549">0</span><span class="op" id="6831550">,</span>&nbsp;<span class="num" id="6831552">640</span><span class="op" id="6831555">,</span>&nbsp;<span class="num" id="6831557">480</span><span class="op" id="6831560">)</span><span class="op" id="6831561">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831564">bo</span>&nbsp;<span class="op" id="6831567">:=</span>&nbsp;<span class="ident" id="6831570">img</span><span class="op" id="6831573">.</span><span class="ident" id="6831574">Bounds</span><span class="op" id="6831580">(</span><span class="op" id="6831581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831584">rnd</span>&nbsp;<span class="op" id="6831588">:=</span>&nbsp;<span class="ident" id="6831591">rand</span><span class="op" id="6831595">.</span><span class="ident" id="6831596">New</span><span class="op" id="6831599">(</span><span class="ident" id="6831600">rand</span><span class="op" id="6831604">.</span><span class="ident" id="6831605">NewSource</span><span class="op" id="6831614">(</span><span class="num" id="6831615">123</span><span class="op" id="6831618">)</span><span class="op" id="6831619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831622">for</span>&nbsp;<span class="ident" id="6831626">y</span>&nbsp;<span class="op" id="6831628">:=</span>&nbsp;<span class="ident" id="6831631">bo</span><span class="op" id="6831633">.</span><span class="ident" id="6831634">Min</span><span class="op" id="6831637">.</span><span class="ident" id="6831638">Y</span><span class="op" id="6831639">;</span>&nbsp;<span class="ident" id="6831641">y</span>&nbsp;<span class="op" id="6831643">&lt;</span>&nbsp;<span class="ident" id="6831645">bo</span><span class="op" id="6831647">.</span><span class="ident" id="6831648">Max</span><span class="op" id="6831651">.</span><span class="ident" id="6831652">Y</span><span class="op" id="6831653">;</span>&nbsp;<span class="ident" id="6831655">y</span><span class="op" id="6831656">++</span>&nbsp;<span class="op" id="6831659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831663">for</span>&nbsp;<span class="ident" id="6831667">x</span>&nbsp;<span class="op" id="6831669">:=</span>&nbsp;<span class="ident" id="6831672">bo</span><span class="op" id="6831674">.</span><span class="ident" id="6831675">Min</span><span class="op" id="6831678">.</span><span class="ident" id="6831679">X</span><span class="op" id="6831680">;</span>&nbsp;<span class="ident" id="6831682">x</span>&nbsp;<span class="op" id="6831684">&lt;</span>&nbsp;<span class="ident" id="6831686">bo</span><span class="op" id="6831688">.</span><span class="ident" id="6831689">Max</span><span class="op" id="6831692">.</span><span class="ident" id="6831693">X</span><span class="op" id="6831694">;</span>&nbsp;<span class="ident" id="6831696">x</span><span class="op" id="6831697">++</span>&nbsp;<span class="op" id="6831700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831705">img</span><span class="op" id="6831708">.</span><span class="ident" id="6831709">SetRGBA</span><span class="op" id="6831716">(</span><span class="ident" id="6831717">x</span><span class="op" id="6831718">,</span>&nbsp;<span class="ident" id="6831720">y</span><span class="op" id="6831721">,</span>&nbsp;<span class="ident" id="6831723">color</span><span class="op" id="6831728">.</span><span class="ident" id="6831729">RGBA</span><span class="op" id="6831733">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6831739">uint8</span><span class="op" id="6831744">(</span><span class="ident" id="6831745">rnd</span><span class="op" id="6831748">.</span><span class="ident" id="6831749">Intn</span><span class="op" id="6831753">(</span><span class="num" id="6831754">256</span><span class="op" id="6831757">)</span><span class="op" id="6831758">)</span><span class="op" id="6831759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6831765">uint8</span><span class="op" id="6831770">(</span><span class="ident" id="6831771">rnd</span><span class="op" id="6831774">.</span><span class="ident" id="6831775">Intn</span><span class="op" id="6831779">(</span><span class="num" id="6831780">256</span><span class="op" id="6831783">)</span><span class="op" id="6831784">)</span><span class="op" id="6831785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6831791">uint8</span><span class="op" id="6831796">(</span><span class="ident" id="6831797">rnd</span><span class="op" id="6831800">.</span><span class="ident" id="6831801">Intn</span><span class="op" id="6831805">(</span><span class="num" id="6831806">256</span><span class="op" id="6831809">)</span><span class="op" id="6831810">)</span><span class="op" id="6831811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6831817">255</span><span class="op" id="6831820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831825">}</span><span class="op" id="6831826">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831836">b</span><span class="op" id="6831837">.</span><span class="ident" id="6831838">SetBytes</span><span class="op" id="6831846">(</span><span class="num" id="6831847">640</span>&nbsp;<span class="op" id="6831851">*</span>&nbsp;<span class="num" id="6831853">480</span>&nbsp;<span class="op" id="6831857">*</span>&nbsp;<span class="num" id="6831859">4</span><span class="op" id="6831860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831863">b</span><span class="op" id="6831864">.</span><span class="ident" id="6831865">StartTimer</span><span class="op" id="6831875">(</span><span class="op" id="6831876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831879">for</span>&nbsp;<span class="ident" id="6831883">i</span>&nbsp;<span class="op" id="6831885">:=</span>&nbsp;<span class="num" id="6831888">0</span><span class="op" id="6831889">;</span>&nbsp;<span class="ident" id="6831891">i</span>&nbsp;<span class="op" id="6831893">&lt;</span>&nbsp;<span class="ident" id="6831895">b</span><span class="op" id="6831896">.</span><span class="ident" id="6831897">N</span><span class="op" id="6831898">;</span>&nbsp;<span class="ident" id="6831900">i</span><span class="op" id="6831901">++</span>&nbsp;<span class="op" id="6831904">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831908">Encode</span><span class="op" id="6831914">(</span><span class="ident" id="6831915">ioutil</span><span class="op" id="6831921">.</span><span class="ident" id="6831922">Discard</span><span class="op" id="6831929">,</span>&nbsp;<span class="ident" id="6831931">img</span><span class="op" id="6831934">,</span>&nbsp;<span class="ident" id="6831936">nil</span><span class="op" id="6831939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831942">}</span><br>
<span class="lineno"></span><span class="op" id="6831944">}</span>
</div>
</body>
</html>
