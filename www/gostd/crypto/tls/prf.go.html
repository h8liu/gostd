<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3891303">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3891358">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3891412">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3891463">package</span>&nbsp;<span class="ident" id="3891471">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3891476">import</span>&nbsp;<span class="op" id="3891483">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3891486">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3891496">&#34;crypto/hmac&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3891511">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3891525">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3891540">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3891557">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3891564">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3891567">//&nbsp;Split&nbsp;a&nbsp;premaster&nbsp;secret&nbsp;in&nbsp;two&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3891639">func</span>&nbsp;<span class="ident" id="3891644">splitPreMasterSecret</span><span class="op" id="3891664">(</span><span class="ident" id="3891665">secret</span>&nbsp;<span class="op" id="3891672">[</span><span class="op" id="3891673">]</span><span class="builtintype" id="3891674">byte</span><span class="op" id="3891678">)</span>&nbsp;<span class="op" id="3891680">(</span><span class="ident" id="3891681">s1</span><span class="op" id="3891683">,</span>&nbsp;<span class="ident" id="3891685">s2</span>&nbsp;<span class="op" id="3891688">[</span><span class="op" id="3891689">]</span><span class="builtintype" id="3891690">byte</span><span class="op" id="3891694">)</span>&nbsp;<span class="op" id="3891696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891699">s1</span>&nbsp;<span class="op" id="3891702">=</span>&nbsp;<span class="ident" id="3891704">secret</span><span class="op" id="3891710">[</span><span class="num" id="3891711">0</span>&nbsp;<span class="op" id="3891713">:</span>&nbsp;<span class="op" id="3891715">(</span><span class="builtinfunc" id="3891716">len</span><span class="op" id="3891719">(</span><span class="ident" id="3891720">secret</span><span class="op" id="3891726">)</span><span class="op" id="3891727">+</span><span class="num" id="3891728">1</span><span class="op" id="3891729">)</span><span class="op" id="3891730">/</span><span class="num" id="3891731">2</span><span class="op" id="3891732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891735">s2</span>&nbsp;<span class="op" id="3891738">=</span>&nbsp;<span class="ident" id="3891740">secret</span><span class="op" id="3891746">[</span><span class="builtinfunc" id="3891747">len</span><span class="op" id="3891750">(</span><span class="ident" id="3891751">secret</span><span class="op" id="3891757">)</span><span class="op" id="3891758">/</span><span class="num" id="3891759">2</span><span class="op" id="3891760">:</span><span class="op" id="3891761">]</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3891764">return</span><br>
<span class="lineno"></span><span class="op" id="3891771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3891774">//&nbsp;pHash&nbsp;implements&nbsp;the&nbsp;P_hash&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4346,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3891850">func</span>&nbsp;<span class="ident" id="3891855">pHash</span><span class="op" id="3891860">(</span><span class="ident" id="3891861">result</span><span class="op" id="3891867">,</span>&nbsp;<span class="ident" id="3891869">secret</span><span class="op" id="3891875">,</span>&nbsp;<span class="ident" id="3891877">seed</span>&nbsp;<span class="op" id="3891882">[</span><span class="op" id="3891883">]</span><span class="builtintype" id="3891884">byte</span><span class="op" id="3891888">,</span>&nbsp;<span class="ident" id="3891890">hash</span>&nbsp;<span class="keyword" id="3891895">func</span><span class="op" id="3891899">(</span><span class="op" id="3891900">)</span>&nbsp;<span class="ident" id="3891902">hash</span><span class="op" id="3891906">.</span><span class="ident" id="3891907">Hash</span><span class="op" id="3891911">)</span>&nbsp;<span class="op" id="3891913">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891916">h</span>&nbsp;<span class="op" id="3891918">:=</span>&nbsp;<span class="ident" id="3891921">hmac</span><span class="op" id="3891925">.</span><span class="ident" id="3891926">New</span><span class="op" id="3891929">(</span><span class="ident" id="3891930">hash</span><span class="op" id="3891934">,</span>&nbsp;<span class="ident" id="3891936">secret</span><span class="op" id="3891942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891945">h</span><span class="op" id="3891946">.</span><span class="ident" id="3891947">Write</span><span class="op" id="3891952">(</span><span class="ident" id="3891953">seed</span><span class="op" id="3891957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891960">a</span>&nbsp;<span class="op" id="3891962">:=</span>&nbsp;<span class="ident" id="3891965">h</span><span class="op" id="3891966">.</span><span class="ident" id="3891967">Sum</span><span class="op" id="3891970">(</span><span class="ident" id="3891971">nil</span><span class="op" id="3891974">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891978">j</span>&nbsp;<span class="op" id="3891980">:=</span>&nbsp;<span class="num" id="3891983">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3891986">for</span>&nbsp;<span class="ident" id="3891990">j</span>&nbsp;<span class="op" id="3891992">&lt;</span>&nbsp;<span class="builtinfunc" id="3891994">len</span><span class="op" id="3891997">(</span><span class="ident" id="3891998">result</span><span class="op" id="3892004">)</span>&nbsp;<span class="op" id="3892006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892010">h</span><span class="op" id="3892011">.</span><span class="ident" id="3892012">Reset</span><span class="op" id="3892017">(</span><span class="op" id="3892018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892022">h</span><span class="op" id="3892023">.</span><span class="ident" id="3892024">Write</span><span class="op" id="3892029">(</span><span class="ident" id="3892030">a</span><span class="op" id="3892031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892035">h</span><span class="op" id="3892036">.</span><span class="ident" id="3892037">Write</span><span class="op" id="3892042">(</span><span class="ident" id="3892043">seed</span><span class="op" id="3892047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892051">b</span>&nbsp;<span class="op" id="3892053">:=</span>&nbsp;<span class="ident" id="3892056">h</span><span class="op" id="3892057">.</span><span class="ident" id="3892058">Sum</span><span class="op" id="3892061">(</span><span class="ident" id="3892062">nil</span><span class="op" id="3892065">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892069">todo</span>&nbsp;<span class="op" id="3892074">:=</span>&nbsp;<span class="builtinfunc" id="3892077">len</span><span class="op" id="3892080">(</span><span class="ident" id="3892081">b</span><span class="op" id="3892082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892086">if</span>&nbsp;<span class="ident" id="3892089">j</span><span class="op" id="3892090">+</span><span class="ident" id="3892091">todo</span>&nbsp;<span class="op" id="3892096">&gt;</span>&nbsp;<span class="builtinfunc" id="3892098">len</span><span class="op" id="3892101">(</span><span class="ident" id="3892102">result</span><span class="op" id="3892108">)</span>&nbsp;<span class="op" id="3892110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892115">todo</span>&nbsp;<span class="op" id="3892120">=</span>&nbsp;<span class="builtinfunc" id="3892122">len</span><span class="op" id="3892125">(</span><span class="ident" id="3892126">result</span><span class="op" id="3892132">)</span>&nbsp;<span class="op" id="3892134">-</span>&nbsp;<span class="ident" id="3892136">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3892144">copy</span><span class="op" id="3892148">(</span><span class="ident" id="3892149">result</span><span class="op" id="3892155">[</span><span class="ident" id="3892156">j</span><span class="op" id="3892157">:</span><span class="ident" id="3892158">j</span><span class="op" id="3892159">+</span><span class="ident" id="3892160">todo</span><span class="op" id="3892164">]</span><span class="op" id="3892165">,</span>&nbsp;<span class="ident" id="3892167">b</span><span class="op" id="3892168">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892172">j</span>&nbsp;<span class="op" id="3892174">+=</span>&nbsp;<span class="ident" id="3892177">todo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892185">h</span><span class="op" id="3892186">.</span><span class="ident" id="3892187">Reset</span><span class="op" id="3892192">(</span><span class="op" id="3892193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892197">h</span><span class="op" id="3892198">.</span><span class="ident" id="3892199">Write</span><span class="op" id="3892204">(</span><span class="ident" id="3892205">a</span><span class="op" id="3892206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892210">a</span>&nbsp;<span class="op" id="3892212">=</span>&nbsp;<span class="ident" id="3892214">h</span><span class="op" id="3892215">.</span><span class="ident" id="3892216">Sum</span><span class="op" id="3892219">(</span><span class="ident" id="3892220">nil</span><span class="op" id="3892223">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892226">}</span><br>
<span class="lineno"></span><span class="op" id="3892228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3892231">//&nbsp;prf10&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3892322">func</span>&nbsp;<span class="ident" id="3892327">prf10</span><span class="op" id="3892332">(</span><span class="ident" id="3892333">result</span><span class="op" id="3892339">,</span>&nbsp;<span class="ident" id="3892341">secret</span><span class="op" id="3892347">,</span>&nbsp;<span class="ident" id="3892349">label</span><span class="op" id="3892354">,</span>&nbsp;<span class="ident" id="3892356">seed</span>&nbsp;<span class="op" id="3892361">[</span><span class="op" id="3892362">]</span><span class="builtintype" id="3892363">byte</span><span class="op" id="3892367">)</span>&nbsp;<span class="op" id="3892369">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892372">hashSHA1</span>&nbsp;<span class="op" id="3892381">:=</span>&nbsp;<span class="ident" id="3892384">sha1</span><span class="op" id="3892388">.</span><span class="ident" id="3892389">New</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892394">hashMD5</span>&nbsp;<span class="op" id="3892402">:=</span>&nbsp;<span class="ident" id="3892405">md5</span><span class="op" id="3892408">.</span><span class="ident" id="3892409">New</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892415">labelAndSeed</span>&nbsp;<span class="op" id="3892428">:=</span>&nbsp;<span class="builtinfunc" id="3892431">make</span><span class="op" id="3892435">(</span><span class="op" id="3892436">[</span><span class="op" id="3892437">]</span><span class="builtintype" id="3892438">byte</span><span class="op" id="3892442">,</span>&nbsp;<span class="builtinfunc" id="3892444">len</span><span class="op" id="3892447">(</span><span class="ident" id="3892448">label</span><span class="op" id="3892453">)</span><span class="op" id="3892454">+</span><span class="builtinfunc" id="3892455">len</span><span class="op" id="3892458">(</span><span class="ident" id="3892459">seed</span><span class="op" id="3892463">)</span><span class="op" id="3892464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3892467">copy</span><span class="op" id="3892471">(</span><span class="ident" id="3892472">labelAndSeed</span><span class="op" id="3892484">,</span>&nbsp;<span class="ident" id="3892486">label</span><span class="op" id="3892491">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3892494">copy</span><span class="op" id="3892498">(</span><span class="ident" id="3892499">labelAndSeed</span><span class="op" id="3892511">[</span><span class="builtinfunc" id="3892512">len</span><span class="op" id="3892515">(</span><span class="ident" id="3892516">label</span><span class="op" id="3892521">)</span><span class="op" id="3892522">:</span><span class="op" id="3892523">]</span><span class="op" id="3892524">,</span>&nbsp;<span class="ident" id="3892526">seed</span><span class="op" id="3892530">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892534">s1</span><span class="op" id="3892536">,</span>&nbsp;<span class="ident" id="3892538">s2</span>&nbsp;<span class="op" id="3892541">:=</span>&nbsp;<span class="ident" id="3892544">splitPreMasterSecret</span><span class="op" id="3892564">(</span><span class="ident" id="3892565">secret</span><span class="op" id="3892571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892574">pHash</span><span class="op" id="3892579">(</span><span class="ident" id="3892580">result</span><span class="op" id="3892586">,</span>&nbsp;<span class="ident" id="3892588">s1</span><span class="op" id="3892590">,</span>&nbsp;<span class="ident" id="3892592">labelAndSeed</span><span class="op" id="3892604">,</span>&nbsp;<span class="ident" id="3892606">hashMD5</span><span class="op" id="3892613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892616">result2</span>&nbsp;<span class="op" id="3892624">:=</span>&nbsp;<span class="builtinfunc" id="3892627">make</span><span class="op" id="3892631">(</span><span class="op" id="3892632">[</span><span class="op" id="3892633">]</span><span class="builtintype" id="3892634">byte</span><span class="op" id="3892638">,</span>&nbsp;<span class="builtinfunc" id="3892640">len</span><span class="op" id="3892643">(</span><span class="ident" id="3892644">result</span><span class="op" id="3892650">)</span><span class="op" id="3892651">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892654">pHash</span><span class="op" id="3892659">(</span><span class="ident" id="3892660">result2</span><span class="op" id="3892667">,</span>&nbsp;<span class="ident" id="3892669">s2</span><span class="op" id="3892671">,</span>&nbsp;<span class="ident" id="3892673">labelAndSeed</span><span class="op" id="3892685">,</span>&nbsp;<span class="ident" id="3892687">hashSHA1</span><span class="op" id="3892695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892699">for</span>&nbsp;<span class="ident" id="3892703">i</span><span class="op" id="3892704">,</span>&nbsp;<span class="ident" id="3892706">b</span>&nbsp;<span class="op" id="3892708">:=</span>&nbsp;<span class="keyword" id="3892711">range</span>&nbsp;<span class="ident" id="3892717">result2</span>&nbsp;<span class="op" id="3892725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892729">result</span><span class="op" id="3892735">[</span><span class="ident" id="3892736">i</span><span class="op" id="3892737">]</span>&nbsp;<span class="op" id="3892739">^=</span>&nbsp;<span class="ident" id="3892742">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892745">}</span><br>
<span class="lineno">65</span><span class="op" id="3892747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3892750">//&nbsp;prf12&nbsp;implements&nbsp;the&nbsp;TLS&nbsp;1.2&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;5.</span><br>
<span class="lineno"></span><span class="keyword" id="3892841">func</span>&nbsp;<span class="ident" id="3892846">prf12</span><span class="op" id="3892851">(</span><span class="ident" id="3892852">result</span><span class="op" id="3892858">,</span>&nbsp;<span class="ident" id="3892860">secret</span><span class="op" id="3892866">,</span>&nbsp;<span class="ident" id="3892868">label</span><span class="op" id="3892873">,</span>&nbsp;<span class="ident" id="3892875">seed</span>&nbsp;<span class="op" id="3892880">[</span><span class="op" id="3892881">]</span><span class="builtintype" id="3892882">byte</span><span class="op" id="3892886">)</span>&nbsp;<span class="op" id="3892888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892891">labelAndSeed</span>&nbsp;<span class="op" id="3892904">:=</span>&nbsp;<span class="builtinfunc" id="3892907">make</span><span class="op" id="3892911">(</span><span class="op" id="3892912">[</span><span class="op" id="3892913">]</span><span class="builtintype" id="3892914">byte</span><span class="op" id="3892918">,</span>&nbsp;<span class="builtinfunc" id="3892920">len</span><span class="op" id="3892923">(</span><span class="ident" id="3892924">label</span><span class="op" id="3892929">)</span><span class="op" id="3892930">+</span><span class="builtinfunc" id="3892931">len</span><span class="op" id="3892934">(</span><span class="ident" id="3892935">seed</span><span class="op" id="3892939">)</span><span class="op" id="3892940">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3892943">copy</span><span class="op" id="3892947">(</span><span class="ident" id="3892948">labelAndSeed</span><span class="op" id="3892960">,</span>&nbsp;<span class="ident" id="3892962">label</span><span class="op" id="3892967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3892970">copy</span><span class="op" id="3892974">(</span><span class="ident" id="3892975">labelAndSeed</span><span class="op" id="3892987">[</span><span class="builtinfunc" id="3892988">len</span><span class="op" id="3892991">(</span><span class="ident" id="3892992">label</span><span class="op" id="3892997">)</span><span class="op" id="3892998">:</span><span class="op" id="3892999">]</span><span class="op" id="3893000">,</span>&nbsp;<span class="ident" id="3893002">seed</span><span class="op" id="3893006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893010">pHash</span><span class="op" id="3893015">(</span><span class="ident" id="3893016">result</span><span class="op" id="3893022">,</span>&nbsp;<span class="ident" id="3893024">secret</span><span class="op" id="3893030">,</span>&nbsp;<span class="ident" id="3893032">labelAndSeed</span><span class="op" id="3893044">,</span>&nbsp;<span class="ident" id="3893046">sha256</span><span class="op" id="3893052">.</span><span class="ident" id="3893053">New</span><span class="op" id="3893056">)</span><br>
<span class="lineno"></span><span class="op" id="3893058">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="3893061">//&nbsp;prf30&nbsp;implements&nbsp;the&nbsp;SSL&nbsp;3.0&nbsp;pseudo-random&nbsp;function,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3893131">//&nbsp;www.mozilla.org/projects/security/pki/nss/ssl/draft302.txt&nbsp;section&nbsp;6.</span><br>
<span class="lineno"></span><span class="keyword" id="3893204">func</span>&nbsp;<span class="ident" id="3893209">prf30</span><span class="op" id="3893214">(</span><span class="ident" id="3893215">result</span><span class="op" id="3893221">,</span>&nbsp;<span class="ident" id="3893223">secret</span><span class="op" id="3893229">,</span>&nbsp;<span class="ident" id="3893231">label</span><span class="op" id="3893236">,</span>&nbsp;<span class="ident" id="3893238">seed</span>&nbsp;<span class="op" id="3893243">[</span><span class="op" id="3893244">]</span><span class="builtintype" id="3893245">byte</span><span class="op" id="3893249">)</span>&nbsp;<span class="op" id="3893251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893254">hashSHA1</span>&nbsp;<span class="op" id="3893263">:=</span>&nbsp;<span class="ident" id="3893266">sha1</span><span class="op" id="3893270">.</span><span class="ident" id="3893271">New</span><span class="op" id="3893274">(</span><span class="op" id="3893275">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893278">hashMD5</span>&nbsp;<span class="op" id="3893286">:=</span>&nbsp;<span class="ident" id="3893289">md5</span><span class="op" id="3893292">.</span><span class="ident" id="3893293">New</span><span class="op" id="3893296">(</span><span class="op" id="3893297">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893301">done</span>&nbsp;<span class="op" id="3893306">:=</span>&nbsp;<span class="num" id="3893309">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893312">i</span>&nbsp;<span class="op" id="3893314">:=</span>&nbsp;<span class="num" id="3893317">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893320">//&nbsp;RFC5246&nbsp;section&nbsp;6.3&nbsp;says&nbsp;that&nbsp;the&nbsp;largest&nbsp;PRF&nbsp;output&nbsp;needed&nbsp;is&nbsp;128</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893391">//&nbsp;bytes.&nbsp;Since&nbsp;no&nbsp;more&nbsp;ciphersuites&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;SSLv3,&nbsp;this&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893463">//&nbsp;remain&nbsp;true.&nbsp;Each&nbsp;iteration&nbsp;gives&nbsp;us&nbsp;16&nbsp;bytes&nbsp;so&nbsp;10&nbsp;iterations&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893535">//&nbsp;be&nbsp;sufficient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893554">var</span>&nbsp;<span class="ident" id="3893558">b</span>&nbsp;<span class="op" id="3893560">[</span><span class="num" id="3893561">11</span><span class="op" id="3893563">]</span><span class="builtintype" id="3893564">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893570">for</span>&nbsp;<span class="ident" id="3893574">done</span>&nbsp;<span class="op" id="3893579">&lt;</span>&nbsp;<span class="builtinfunc" id="3893581">len</span><span class="op" id="3893584">(</span><span class="ident" id="3893585">result</span><span class="op" id="3893591">)</span>&nbsp;<span class="op" id="3893593">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893597">for</span>&nbsp;<span class="ident" id="3893601">j</span>&nbsp;<span class="op" id="3893603">:=</span>&nbsp;<span class="num" id="3893606">0</span><span class="op" id="3893607">;</span>&nbsp;<span class="ident" id="3893609">j</span>&nbsp;<span class="op" id="3893611">&lt;=</span>&nbsp;<span class="ident" id="3893614">i</span><span class="op" id="3893615">;</span>&nbsp;<span class="ident" id="3893617">j</span><span class="op" id="3893618">++</span>&nbsp;<span class="op" id="3893621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893626">b</span><span class="op" id="3893627">[</span><span class="ident" id="3893628">j</span><span class="op" id="3893629">]</span>&nbsp;<span class="op" id="3893631">=</span>&nbsp;<span class="string" id="3893633">&#39;A&#39;</span>&nbsp;<span class="op" id="3893637">+</span>&nbsp;<span class="builtintype" id="3893639">byte</span><span class="op" id="3893643">(</span><span class="ident" id="3893644">i</span><span class="op" id="3893645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893654">hashSHA1</span><span class="op" id="3893662">.</span><span class="ident" id="3893663">Reset</span><span class="op" id="3893668">(</span><span class="op" id="3893669">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893673">hashSHA1</span><span class="op" id="3893681">.</span><span class="ident" id="3893682">Write</span><span class="op" id="3893687">(</span><span class="ident" id="3893688">b</span><span class="op" id="3893689">[</span><span class="op" id="3893690">:</span><span class="ident" id="3893691">i</span><span class="op" id="3893692">+</span><span class="num" id="3893693">1</span><span class="op" id="3893694">]</span><span class="op" id="3893695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893699">hashSHA1</span><span class="op" id="3893707">.</span><span class="ident" id="3893708">Write</span><span class="op" id="3893713">(</span><span class="ident" id="3893714">secret</span><span class="op" id="3893720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893724">hashSHA1</span><span class="op" id="3893732">.</span><span class="ident" id="3893733">Write</span><span class="op" id="3893738">(</span><span class="ident" id="3893739">seed</span><span class="op" id="3893743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893747">digest</span>&nbsp;<span class="op" id="3893754">:=</span>&nbsp;<span class="ident" id="3893757">hashSHA1</span><span class="op" id="3893765">.</span><span class="ident" id="3893766">Sum</span><span class="op" id="3893769">(</span><span class="ident" id="3893770">nil</span><span class="op" id="3893773">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893778">hashMD5</span><span class="op" id="3893785">.</span><span class="ident" id="3893786">Reset</span><span class="op" id="3893791">(</span><span class="op" id="3893792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893796">hashMD5</span><span class="op" id="3893803">.</span><span class="ident" id="3893804">Write</span><span class="op" id="3893809">(</span><span class="ident" id="3893810">secret</span><span class="op" id="3893816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893820">hashMD5</span><span class="op" id="3893827">.</span><span class="ident" id="3893828">Write</span><span class="op" id="3893833">(</span><span class="ident" id="3893834">digest</span><span class="op" id="3893840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893845">done</span>&nbsp;<span class="op" id="3893850">+=</span>&nbsp;<span class="builtinfunc" id="3893853">copy</span><span class="op" id="3893857">(</span><span class="ident" id="3893858">result</span><span class="op" id="3893864">[</span><span class="ident" id="3893865">done</span><span class="op" id="3893869">:</span><span class="op" id="3893870">]</span><span class="op" id="3893871">,</span>&nbsp;<span class="ident" id="3893873">hashMD5</span><span class="op" id="3893880">.</span><span class="ident" id="3893881">Sum</span><span class="op" id="3893884">(</span><span class="ident" id="3893885">nil</span><span class="op" id="3893888">)</span><span class="op" id="3893889">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893893">i</span><span class="op" id="3893894">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893898">}</span><br>
<span class="lineno"></span><span class="op" id="3893900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893903">const</span>&nbsp;<span class="op" id="3893909">(</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893912">tlsRandomLength</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3893933">=</span>&nbsp;<span class="num" id="3893935">32</span>&nbsp;<span class="comment" id="3893938">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;random&nbsp;nonce&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893979">masterSecretLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3894000">=</span>&nbsp;<span class="num" id="3894002">48</span>&nbsp;<span class="comment" id="3894005">//&nbsp;Length&nbsp;of&nbsp;a&nbsp;master&nbsp;secret&nbsp;in&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894047">finishedVerifyLength</span>&nbsp;<span class="op" id="3894068">=</span>&nbsp;<span class="num" id="3894070">12</span>&nbsp;<span class="comment" id="3894073">//&nbsp;Length&nbsp;of&nbsp;verify_data&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="op" id="3894121">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3894124">var</span>&nbsp;<span class="ident" id="3894128">masterSecretLabel</span>&nbsp;<span class="op" id="3894146">=</span>&nbsp;<span class="op" id="3894148">[</span><span class="op" id="3894149">]</span><span class="builtintype" id="3894150">byte</span><span class="op" id="3894154">(</span><span class="string" id="3894155">&#34;master&nbsp;secret&#34;</span><span class="op" id="3894170">)</span><br>
<span class="lineno"></span><span class="keyword" id="3894172">var</span>&nbsp;<span class="ident" id="3894176">keyExpansionLabel</span>&nbsp;<span class="op" id="3894194">=</span>&nbsp;<span class="op" id="3894196">[</span><span class="op" id="3894197">]</span><span class="builtintype" id="3894198">byte</span><span class="op" id="3894202">(</span><span class="string" id="3894203">&#34;key&nbsp;expansion&#34;</span><span class="op" id="3894218">)</span><br>
<span class="lineno"></span><span class="keyword" id="3894220">var</span>&nbsp;<span class="ident" id="3894224">clientFinishedLabel</span>&nbsp;<span class="op" id="3894244">=</span>&nbsp;<span class="op" id="3894246">[</span><span class="op" id="3894247">]</span><span class="builtintype" id="3894248">byte</span><span class="op" id="3894252">(</span><span class="string" id="3894253">&#34;client&nbsp;finished&#34;</span><span class="op" id="3894270">)</span><br>
<span class="lineno"></span><span class="keyword" id="3894272">var</span>&nbsp;<span class="ident" id="3894276">serverFinishedLabel</span>&nbsp;<span class="op" id="3894296">=</span>&nbsp;<span class="op" id="3894298">[</span><span class="op" id="3894299">]</span><span class="builtintype" id="3894300">byte</span><span class="op" id="3894304">(</span><span class="string" id="3894305">&#34;server&nbsp;finished&#34;</span><span class="op" id="3894322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="3894325">func</span>&nbsp;<span class="ident" id="3894330">prfForVersion</span><span class="op" id="3894343">(</span><span class="ident" id="3894344">version</span>&nbsp;<span class="builtintype" id="3894352">uint16</span><span class="op" id="3894358">)</span>&nbsp;<span class="keyword" id="3894360">func</span><span class="op" id="3894364">(</span><span class="ident" id="3894365">result</span><span class="op" id="3894371">,</span>&nbsp;<span class="ident" id="3894373">secret</span><span class="op" id="3894379">,</span>&nbsp;<span class="ident" id="3894381">label</span><span class="op" id="3894386">,</span>&nbsp;<span class="ident" id="3894388">seed</span>&nbsp;<span class="op" id="3894393">[</span><span class="op" id="3894394">]</span><span class="builtintype" id="3894395">byte</span><span class="op" id="3894399">)</span>&nbsp;<span class="op" id="3894401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894404">switch</span>&nbsp;<span class="ident" id="3894411">version</span>&nbsp;<span class="op" id="3894419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894422">case</span>&nbsp;<span class="ident" id="3894427">VersionSSL30</span><span class="op" id="3894439">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894443">return</span>&nbsp;<span class="ident" id="3894450">prf30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894457">case</span>&nbsp;<span class="ident" id="3894462">VersionTLS10</span><span class="op" id="3894474">,</span>&nbsp;<span class="ident" id="3894476">VersionTLS11</span><span class="op" id="3894488">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894492">return</span>&nbsp;<span class="ident" id="3894499">prf10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894506">case</span>&nbsp;<span class="ident" id="3894511">VersionTLS12</span><span class="op" id="3894523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894527">return</span>&nbsp;<span class="ident" id="3894534">prf12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894541">default</span><span class="op" id="3894548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3894552">panic</span><span class="op" id="3894557">(</span><span class="string" id="3894558">&#34;unknown&nbsp;version&#34;</span><span class="op" id="3894575">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894578">}</span><br>
<span class="lineno"></span><span class="op" id="3894580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3894583">//&nbsp;masterFromPreMasterSecret&nbsp;generates&nbsp;the&nbsp;master&nbsp;secret&nbsp;from&nbsp;the&nbsp;pre-master</span><br>
<span class="lineno"></span><span class="comment" id="3894660">//&nbsp;secret.&nbsp;See&nbsp;http://tools.ietf.org/html/rfc5246#section-8.1</span><br>
<span class="lineno">135</span><span class="keyword" id="3894722">func</span>&nbsp;<span class="ident" id="3894727">masterFromPreMasterSecret</span><span class="op" id="3894752">(</span><span class="ident" id="3894753">version</span>&nbsp;<span class="builtintype" id="3894761">uint16</span><span class="op" id="3894767">,</span>&nbsp;<span class="ident" id="3894769">preMasterSecret</span><span class="op" id="3894784">,</span>&nbsp;<span class="ident" id="3894786">clientRandom</span><span class="op" id="3894798">,</span>&nbsp;<span class="ident" id="3894800">serverRandom</span>&nbsp;<span class="op" id="3894813">[</span><span class="op" id="3894814">]</span><span class="builtintype" id="3894815">byte</span><span class="op" id="3894819">)</span>&nbsp;<span class="op" id="3894821">[</span><span class="op" id="3894822">]</span><span class="builtintype" id="3894823">byte</span>&nbsp;<span class="op" id="3894828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894831">var</span>&nbsp;<span class="ident" id="3894835">seed</span>&nbsp;<span class="op" id="3894840">[</span><span class="ident" id="3894841">tlsRandomLength</span>&nbsp;<span class="op" id="3894857">*</span>&nbsp;<span class="num" id="3894859">2</span><span class="op" id="3894860">]</span><span class="builtintype" id="3894861">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3894867">copy</span><span class="op" id="3894871">(</span><span class="ident" id="3894872">seed</span><span class="op" id="3894876">[</span><span class="num" id="3894877">0</span><span class="op" id="3894878">:</span><span class="builtinfunc" id="3894879">len</span><span class="op" id="3894882">(</span><span class="ident" id="3894883">clientRandom</span><span class="op" id="3894895">)</span><span class="op" id="3894896">]</span><span class="op" id="3894897">,</span>&nbsp;<span class="ident" id="3894899">clientRandom</span><span class="op" id="3894911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3894914">copy</span><span class="op" id="3894918">(</span><span class="ident" id="3894919">seed</span><span class="op" id="3894923">[</span><span class="builtinfunc" id="3894924">len</span><span class="op" id="3894927">(</span><span class="ident" id="3894928">clientRandom</span><span class="op" id="3894940">)</span><span class="op" id="3894941">:</span><span class="op" id="3894942">]</span><span class="op" id="3894943">,</span>&nbsp;<span class="ident" id="3894945">serverRandom</span><span class="op" id="3894957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894960">masterSecret</span>&nbsp;<span class="op" id="3894973">:=</span>&nbsp;<span class="builtinfunc" id="3894976">make</span><span class="op" id="3894980">(</span><span class="op" id="3894981">[</span><span class="op" id="3894982">]</span><span class="builtintype" id="3894983">byte</span><span class="op" id="3894987">,</span>&nbsp;<span class="ident" id="3894989">masterSecretLength</span><span class="op" id="3895007">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895010">prfForVersion</span><span class="op" id="3895023">(</span><span class="ident" id="3895024">version</span><span class="op" id="3895031">)</span><span class="op" id="3895032">(</span><span class="ident" id="3895033">masterSecret</span><span class="op" id="3895045">,</span>&nbsp;<span class="ident" id="3895047">preMasterSecret</span><span class="op" id="3895062">,</span>&nbsp;<span class="ident" id="3895064">masterSecretLabel</span><span class="op" id="3895081">,</span>&nbsp;<span class="ident" id="3895083">seed</span><span class="op" id="3895087">[</span><span class="num" id="3895088">0</span><span class="op" id="3895089">:</span><span class="op" id="3895090">]</span><span class="op" id="3895091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895094">return</span>&nbsp;<span class="ident" id="3895101">masterSecret</span><br>
<span class="lineno"></span><span class="op" id="3895114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3895117">//&nbsp;keysFromMasterSecret&nbsp;generates&nbsp;the&nbsp;connection&nbsp;keys&nbsp;from&nbsp;the&nbsp;master</span><br>
<span class="lineno">145</span><span class="comment" id="3895187">//&nbsp;secret,&nbsp;given&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MAC&nbsp;key,&nbsp;cipher&nbsp;key&nbsp;and&nbsp;IV,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3895265">//&nbsp;RFC&nbsp;2246,&nbsp;section&nbsp;6.3.</span><br>
<span class="lineno"></span><span class="keyword" id="3895291">func</span>&nbsp;<span class="ident" id="3895296">keysFromMasterSecret</span><span class="op" id="3895316">(</span><span class="ident" id="3895317">version</span>&nbsp;<span class="builtintype" id="3895325">uint16</span><span class="op" id="3895331">,</span>&nbsp;<span class="ident" id="3895333">masterSecret</span><span class="op" id="3895345">,</span>&nbsp;<span class="ident" id="3895347">clientRandom</span><span class="op" id="3895359">,</span>&nbsp;<span class="ident" id="3895361">serverRandom</span>&nbsp;<span class="op" id="3895374">[</span><span class="op" id="3895375">]</span><span class="builtintype" id="3895376">byte</span><span class="op" id="3895380">,</span>&nbsp;<span class="ident" id="3895382">macLen</span><span class="op" id="3895388">,</span>&nbsp;<span class="ident" id="3895390">keyLen</span><span class="op" id="3895396">,</span>&nbsp;<span class="ident" id="3895398">ivLen</span>&nbsp;<span class="builtintype" id="3895404">int</span><span class="op" id="3895407">)</span>&nbsp;<span class="op" id="3895409">(</span><span class="ident" id="3895410">clientMAC</span><span class="op" id="3895419">,</span>&nbsp;<span class="ident" id="3895421">serverMAC</span><span class="op" id="3895430">,</span>&nbsp;<span class="ident" id="3895432">clientKey</span><span class="op" id="3895441">,</span>&nbsp;<span class="ident" id="3895443">serverKey</span><span class="op" id="3895452">,</span>&nbsp;<span class="ident" id="3895454">clientIV</span><span class="op" id="3895462">,</span>&nbsp;<span class="ident" id="3895464">serverIV</span>&nbsp;<span class="op" id="3895473">[</span><span class="op" id="3895474">]</span><span class="builtintype" id="3895475">byte</span><span class="op" id="3895479">)</span>&nbsp;<span class="op" id="3895481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3895484">var</span>&nbsp;<span class="ident" id="3895488">seed</span>&nbsp;<span class="op" id="3895493">[</span><span class="ident" id="3895494">tlsRandomLength</span>&nbsp;<span class="op" id="3895510">*</span>&nbsp;<span class="num" id="3895512">2</span><span class="op" id="3895513">]</span><span class="builtintype" id="3895514">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3895520">copy</span><span class="op" id="3895524">(</span><span class="ident" id="3895525">seed</span><span class="op" id="3895529">[</span><span class="num" id="3895530">0</span><span class="op" id="3895531">:</span><span class="builtinfunc" id="3895532">len</span><span class="op" id="3895535">(</span><span class="ident" id="3895536">clientRandom</span><span class="op" id="3895548">)</span><span class="op" id="3895549">]</span><span class="op" id="3895550">,</span>&nbsp;<span class="ident" id="3895552">serverRandom</span><span class="op" id="3895564">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3895567">copy</span><span class="op" id="3895571">(</span><span class="ident" id="3895572">seed</span><span class="op" id="3895576">[</span><span class="builtinfunc" id="3895577">len</span><span class="op" id="3895580">(</span><span class="ident" id="3895581">serverRandom</span><span class="op" id="3895593">)</span><span class="op" id="3895594">:</span><span class="op" id="3895595">]</span><span class="op" id="3895596">,</span>&nbsp;<span class="ident" id="3895598">clientRandom</span><span class="op" id="3895610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895614">n</span>&nbsp;<span class="op" id="3895616">:=</span>&nbsp;<span class="num" id="3895619">2</span><span class="op" id="3895620">*</span><span class="ident" id="3895621">macLen</span>&nbsp;<span class="op" id="3895628">+</span>&nbsp;<span class="num" id="3895630">2</span><span class="op" id="3895631">*</span><span class="ident" id="3895632">keyLen</span>&nbsp;<span class="op" id="3895639">+</span>&nbsp;<span class="num" id="3895641">2</span><span class="op" id="3895642">*</span><span class="ident" id="3895643">ivLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895650">keyMaterial</span>&nbsp;<span class="op" id="3895662">:=</span>&nbsp;<span class="builtinfunc" id="3895665">make</span><span class="op" id="3895669">(</span><span class="op" id="3895670">[</span><span class="op" id="3895671">]</span><span class="builtintype" id="3895672">byte</span><span class="op" id="3895676">,</span>&nbsp;<span class="ident" id="3895678">n</span><span class="op" id="3895679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895682">prfForVersion</span><span class="op" id="3895695">(</span><span class="ident" id="3895696">version</span><span class="op" id="3895703">)</span><span class="op" id="3895704">(</span><span class="ident" id="3895705">keyMaterial</span><span class="op" id="3895716">,</span>&nbsp;<span class="ident" id="3895718">masterSecret</span><span class="op" id="3895730">,</span>&nbsp;<span class="ident" id="3895732">keyExpansionLabel</span><span class="op" id="3895749">,</span>&nbsp;<span class="ident" id="3895751">seed</span><span class="op" id="3895755">[</span><span class="num" id="3895756">0</span><span class="op" id="3895757">:</span><span class="op" id="3895758">]</span><span class="op" id="3895759">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895762">clientMAC</span>&nbsp;<span class="op" id="3895772">=</span>&nbsp;<span class="ident" id="3895774">keyMaterial</span><span class="op" id="3895785">[</span><span class="op" id="3895786">:</span><span class="ident" id="3895787">macLen</span><span class="op" id="3895793">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895796">keyMaterial</span>&nbsp;<span class="op" id="3895808">=</span>&nbsp;<span class="ident" id="3895810">keyMaterial</span><span class="op" id="3895821">[</span><span class="ident" id="3895822">macLen</span><span class="op" id="3895828">:</span><span class="op" id="3895829">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895832">serverMAC</span>&nbsp;<span class="op" id="3895842">=</span>&nbsp;<span class="ident" id="3895844">keyMaterial</span><span class="op" id="3895855">[</span><span class="op" id="3895856">:</span><span class="ident" id="3895857">macLen</span><span class="op" id="3895863">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895866">keyMaterial</span>&nbsp;<span class="op" id="3895878">=</span>&nbsp;<span class="ident" id="3895880">keyMaterial</span><span class="op" id="3895891">[</span><span class="ident" id="3895892">macLen</span><span class="op" id="3895898">:</span><span class="op" id="3895899">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895902">clientKey</span>&nbsp;<span class="op" id="3895912">=</span>&nbsp;<span class="ident" id="3895914">keyMaterial</span><span class="op" id="3895925">[</span><span class="op" id="3895926">:</span><span class="ident" id="3895927">keyLen</span><span class="op" id="3895933">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895936">keyMaterial</span>&nbsp;<span class="op" id="3895948">=</span>&nbsp;<span class="ident" id="3895950">keyMaterial</span><span class="op" id="3895961">[</span><span class="ident" id="3895962">keyLen</span><span class="op" id="3895968">:</span><span class="op" id="3895969">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3895972">serverKey</span>&nbsp;<span class="op" id="3895982">=</span>&nbsp;<span class="ident" id="3895984">keyMaterial</span><span class="op" id="3895995">[</span><span class="op" id="3895996">:</span><span class="ident" id="3895997">keyLen</span><span class="op" id="3896003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896006">keyMaterial</span>&nbsp;<span class="op" id="3896018">=</span>&nbsp;<span class="ident" id="3896020">keyMaterial</span><span class="op" id="3896031">[</span><span class="ident" id="3896032">keyLen</span><span class="op" id="3896038">:</span><span class="op" id="3896039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896042">clientIV</span>&nbsp;<span class="op" id="3896051">=</span>&nbsp;<span class="ident" id="3896053">keyMaterial</span><span class="op" id="3896064">[</span><span class="op" id="3896065">:</span><span class="ident" id="3896066">ivLen</span><span class="op" id="3896071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896074">keyMaterial</span>&nbsp;<span class="op" id="3896086">=</span>&nbsp;<span class="ident" id="3896088">keyMaterial</span><span class="op" id="3896099">[</span><span class="ident" id="3896100">ivLen</span><span class="op" id="3896105">:</span><span class="op" id="3896106">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896109">serverIV</span>&nbsp;<span class="op" id="3896118">=</span>&nbsp;<span class="ident" id="3896120">keyMaterial</span><span class="op" id="3896131">[</span><span class="op" id="3896132">:</span><span class="ident" id="3896133">ivLen</span><span class="op" id="3896138">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896141">return</span><br>
<span class="lineno"></span><span class="op" id="3896148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896151">func</span>&nbsp;<span class="ident" id="3896156">newFinishedHash</span><span class="op" id="3896171">(</span><span class="ident" id="3896172">version</span>&nbsp;<span class="builtintype" id="3896180">uint16</span><span class="op" id="3896186">)</span>&nbsp;<span class="ident" id="3896188">finishedHash</span>&nbsp;<span class="op" id="3896201">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896204">if</span>&nbsp;<span class="ident" id="3896207">version</span>&nbsp;<span class="op" id="3896215">&gt;=</span>&nbsp;<span class="ident" id="3896218">VersionTLS12</span>&nbsp;<span class="op" id="3896231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896235">return</span>&nbsp;<span class="ident" id="3896242">finishedHash</span><span class="op" id="3896254">{</span><span class="ident" id="3896255">sha256</span><span class="op" id="3896261">.</span><span class="ident" id="3896262">New</span><span class="op" id="3896265">(</span><span class="op" id="3896266">)</span><span class="op" id="3896267">,</span>&nbsp;<span class="ident" id="3896269">sha256</span><span class="op" id="3896275">.</span><span class="ident" id="3896276">New</span><span class="op" id="3896279">(</span><span class="op" id="3896280">)</span><span class="op" id="3896281">,</span>&nbsp;<span class="ident" id="3896283">nil</span><span class="op" id="3896286">,</span>&nbsp;<span class="ident" id="3896288">nil</span><span class="op" id="3896291">,</span>&nbsp;<span class="ident" id="3896293">version</span><span class="op" id="3896300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896306">return</span>&nbsp;<span class="ident" id="3896313">finishedHash</span><span class="op" id="3896325">{</span><span class="ident" id="3896326">sha1</span><span class="op" id="3896330">.</span><span class="ident" id="3896331">New</span><span class="op" id="3896334">(</span><span class="op" id="3896335">)</span><span class="op" id="3896336">,</span>&nbsp;<span class="ident" id="3896338">sha1</span><span class="op" id="3896342">.</span><span class="ident" id="3896343">New</span><span class="op" id="3896346">(</span><span class="op" id="3896347">)</span><span class="op" id="3896348">,</span>&nbsp;<span class="ident" id="3896350">md5</span><span class="op" id="3896353">.</span><span class="ident" id="3896354">New</span><span class="op" id="3896357">(</span><span class="op" id="3896358">)</span><span class="op" id="3896359">,</span>&nbsp;<span class="ident" id="3896361">md5</span><span class="op" id="3896364">.</span><span class="ident" id="3896365">New</span><span class="op" id="3896368">(</span><span class="op" id="3896369">)</span><span class="op" id="3896370">,</span>&nbsp;<span class="ident" id="3896372">version</span><span class="op" id="3896379">}</span><br>
<span class="lineno"></span><span class="op" id="3896381">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="3896384">//&nbsp;A&nbsp;finishedHash&nbsp;calculates&nbsp;the&nbsp;hash&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake&nbsp;messages&nbsp;suitable</span><br>
<span class="lineno"></span><span class="comment" id="3896462">//&nbsp;for&nbsp;including&nbsp;in&nbsp;a&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3896502">type</span>&nbsp;<span class="ident" id="3896507">finishedHash</span>&nbsp;<span class="keyword" id="3896520">struct</span>&nbsp;<span class="op" id="3896527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896530">client</span>&nbsp;<span class="ident" id="3896537">hash</span><span class="op" id="3896541">.</span><span class="ident" id="3896542">Hash</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896548">server</span>&nbsp;<span class="ident" id="3896555">hash</span><span class="op" id="3896559">.</span><span class="ident" id="3896560">Hash</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3896567">//&nbsp;Prior&nbsp;to&nbsp;TLS&nbsp;1.2,&nbsp;an&nbsp;additional&nbsp;MD5&nbsp;hash&nbsp;is&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896625">clientMD5</span>&nbsp;<span class="ident" id="3896635">hash</span><span class="op" id="3896639">.</span><span class="ident" id="3896640">Hash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896646">serverMD5</span>&nbsp;<span class="ident" id="3896656">hash</span><span class="op" id="3896660">.</span><span class="ident" id="3896661">Hash</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896668">version</span>&nbsp;<span class="builtintype" id="3896676">uint16</span><br>
<span class="lineno"></span><span class="op" id="3896683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3896686">func</span>&nbsp;<span class="op" id="3896691">(</span><span class="ident" id="3896692">h</span>&nbsp;<span class="ident" id="3896694">finishedHash</span><span class="op" id="3896706">)</span>&nbsp;<span class="ident" id="3896708">Write</span><span class="op" id="3896713">(</span><span class="ident" id="3896714">msg</span>&nbsp;<span class="op" id="3896718">[</span><span class="op" id="3896719">]</span><span class="builtintype" id="3896720">byte</span><span class="op" id="3896724">)</span>&nbsp;<span class="op" id="3896726">(</span><span class="ident" id="3896727">n</span>&nbsp;<span class="builtintype" id="3896729">int</span><span class="op" id="3896732">,</span>&nbsp;<span class="ident" id="3896734">err</span>&nbsp;<span class="builtintype" id="3896738">error</span><span class="op" id="3896743">)</span>&nbsp;<span class="op" id="3896745">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896748">h</span><span class="op" id="3896749">.</span><span class="ident" id="3896750">client</span><span class="op" id="3896756">.</span><span class="ident" id="3896757">Write</span><span class="op" id="3896762">(</span><span class="ident" id="3896763">msg</span><span class="op" id="3896766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896769">h</span><span class="op" id="3896770">.</span><span class="ident" id="3896771">server</span><span class="op" id="3896777">.</span><span class="ident" id="3896778">Write</span><span class="op" id="3896783">(</span><span class="ident" id="3896784">msg</span><span class="op" id="3896787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896791">if</span>&nbsp;<span class="ident" id="3896794">h</span><span class="op" id="3896795">.</span><span class="ident" id="3896796">version</span>&nbsp;<span class="op" id="3896804">&lt;</span>&nbsp;<span class="ident" id="3896806">VersionTLS12</span>&nbsp;<span class="op" id="3896819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896823">h</span><span class="op" id="3896824">.</span><span class="ident" id="3896825">clientMD5</span><span class="op" id="3896834">.</span><span class="ident" id="3896835">Write</span><span class="op" id="3896840">(</span><span class="ident" id="3896841">msg</span><span class="op" id="3896844">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3896848">h</span><span class="op" id="3896849">.</span><span class="ident" id="3896850">serverMD5</span><span class="op" id="3896859">.</span><span class="ident" id="3896860">Write</span><span class="op" id="3896865">(</span><span class="ident" id="3896866">msg</span><span class="op" id="3896869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3896872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3896875">return</span>&nbsp;<span class="builtinfunc" id="3896882">len</span><span class="op" id="3896885">(</span><span class="ident" id="3896886">msg</span><span class="op" id="3896889">)</span><span class="op" id="3896890">,</span>&nbsp;<span class="ident" id="3896892">nil</span><br>
<span class="lineno"></span><span class="op" id="3896896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3896899">//&nbsp;finishedSum30&nbsp;calculates&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;SSLv3</span><br>
<span class="lineno"></span><span class="comment" id="3896977">//&nbsp;Finished&nbsp;message&nbsp;given&nbsp;the&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hashes&nbsp;of&nbsp;a&nbsp;set&nbsp;of&nbsp;handshake</span><br>
<span class="lineno"></span><span class="comment" id="3897049">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3897062">func</span>&nbsp;<span class="ident" id="3897067">finishedSum30</span><span class="op" id="3897080">(</span><span class="ident" id="3897081">md5</span><span class="op" id="3897084">,</span>&nbsp;<span class="ident" id="3897086">sha1</span>&nbsp;<span class="ident" id="3897091">hash</span><span class="op" id="3897095">.</span><span class="ident" id="3897096">Hash</span><span class="op" id="3897100">,</span>&nbsp;<span class="ident" id="3897102">masterSecret</span>&nbsp;<span class="op" id="3897115">[</span><span class="op" id="3897116">]</span><span class="builtintype" id="3897117">byte</span><span class="op" id="3897121">,</span>&nbsp;<span class="ident" id="3897123">magic</span>&nbsp;<span class="op" id="3897129">[</span><span class="num" id="3897130">4</span><span class="op" id="3897131">]</span><span class="builtintype" id="3897132">byte</span><span class="op" id="3897136">)</span>&nbsp;<span class="op" id="3897138">[</span><span class="op" id="3897139">]</span><span class="builtintype" id="3897140">byte</span>&nbsp;<span class="op" id="3897145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897148">md5</span><span class="op" id="3897151">.</span><span class="ident" id="3897152">Write</span><span class="op" id="3897157">(</span><span class="ident" id="3897158">magic</span><span class="op" id="3897163">[</span><span class="op" id="3897164">:</span><span class="op" id="3897165">]</span><span class="op" id="3897166">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897169">md5</span><span class="op" id="3897172">.</span><span class="ident" id="3897173">Write</span><span class="op" id="3897178">(</span><span class="ident" id="3897179">masterSecret</span><span class="op" id="3897191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897194">md5</span><span class="op" id="3897197">.</span><span class="ident" id="3897198">Write</span><span class="op" id="3897203">(</span><span class="ident" id="3897204">ssl30Pad1</span><span class="op" id="3897213">[</span><span class="op" id="3897214">:</span><span class="op" id="3897215">]</span><span class="op" id="3897216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897219">md5Digest</span>&nbsp;<span class="op" id="3897229">:=</span>&nbsp;<span class="ident" id="3897232">md5</span><span class="op" id="3897235">.</span><span class="ident" id="3897236">Sum</span><span class="op" id="3897239">(</span><span class="ident" id="3897240">nil</span><span class="op" id="3897243">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897247">md5</span><span class="op" id="3897250">.</span><span class="ident" id="3897251">Reset</span><span class="op" id="3897256">(</span><span class="op" id="3897257">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897260">md5</span><span class="op" id="3897263">.</span><span class="ident" id="3897264">Write</span><span class="op" id="3897269">(</span><span class="ident" id="3897270">masterSecret</span><span class="op" id="3897282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897285">md5</span><span class="op" id="3897288">.</span><span class="ident" id="3897289">Write</span><span class="op" id="3897294">(</span><span class="ident" id="3897295">ssl30Pad2</span><span class="op" id="3897304">[</span><span class="op" id="3897305">:</span><span class="op" id="3897306">]</span><span class="op" id="3897307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897310">md5</span><span class="op" id="3897313">.</span><span class="ident" id="3897314">Write</span><span class="op" id="3897319">(</span><span class="ident" id="3897320">md5Digest</span><span class="op" id="3897329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897332">md5Digest</span>&nbsp;<span class="op" id="3897342">=</span>&nbsp;<span class="ident" id="3897344">md5</span><span class="op" id="3897347">.</span><span class="ident" id="3897348">Sum</span><span class="op" id="3897351">(</span><span class="ident" id="3897352">nil</span><span class="op" id="3897355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897359">sha1</span><span class="op" id="3897363">.</span><span class="ident" id="3897364">Write</span><span class="op" id="3897369">(</span><span class="ident" id="3897370">magic</span><span class="op" id="3897375">[</span><span class="op" id="3897376">:</span><span class="op" id="3897377">]</span><span class="op" id="3897378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897381">sha1</span><span class="op" id="3897385">.</span><span class="ident" id="3897386">Write</span><span class="op" id="3897391">(</span><span class="ident" id="3897392">masterSecret</span><span class="op" id="3897404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897407">sha1</span><span class="op" id="3897411">.</span><span class="ident" id="3897412">Write</span><span class="op" id="3897417">(</span><span class="ident" id="3897418">ssl30Pad1</span><span class="op" id="3897427">[</span><span class="op" id="3897428">:</span><span class="num" id="3897429">40</span><span class="op" id="3897431">]</span><span class="op" id="3897432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897435">sha1Digest</span>&nbsp;<span class="op" id="3897446">:=</span>&nbsp;<span class="ident" id="3897449">sha1</span><span class="op" id="3897453">.</span><span class="ident" id="3897454">Sum</span><span class="op" id="3897457">(</span><span class="ident" id="3897458">nil</span><span class="op" id="3897461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897465">sha1</span><span class="op" id="3897469">.</span><span class="ident" id="3897470">Reset</span><span class="op" id="3897475">(</span><span class="op" id="3897476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897479">sha1</span><span class="op" id="3897483">.</span><span class="ident" id="3897484">Write</span><span class="op" id="3897489">(</span><span class="ident" id="3897490">masterSecret</span><span class="op" id="3897502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897505">sha1</span><span class="op" id="3897509">.</span><span class="ident" id="3897510">Write</span><span class="op" id="3897515">(</span><span class="ident" id="3897516">ssl30Pad2</span><span class="op" id="3897525">[</span><span class="op" id="3897526">:</span><span class="num" id="3897527">40</span><span class="op" id="3897529">]</span><span class="op" id="3897530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897533">sha1</span><span class="op" id="3897537">.</span><span class="ident" id="3897538">Write</span><span class="op" id="3897543">(</span><span class="ident" id="3897544">sha1Digest</span><span class="op" id="3897554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897557">sha1Digest</span>&nbsp;<span class="op" id="3897568">=</span>&nbsp;<span class="ident" id="3897570">sha1</span><span class="op" id="3897574">.</span><span class="ident" id="3897575">Sum</span><span class="op" id="3897578">(</span><span class="ident" id="3897579">nil</span><span class="op" id="3897582">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3897586">ret</span>&nbsp;<span class="op" id="3897590">:=</span>&nbsp;<span class="builtinfunc" id="3897593">make</span><span class="op" id="3897597">(</span><span class="op" id="3897598">[</span><span class="op" id="3897599">]</span><span class="builtintype" id="3897600">byte</span><span class="op" id="3897604">,</span>&nbsp;<span class="builtinfunc" id="3897606">len</span><span class="op" id="3897609">(</span><span class="ident" id="3897610">md5Digest</span><span class="op" id="3897619">)</span><span class="op" id="3897620">+</span><span class="builtinfunc" id="3897621">len</span><span class="op" id="3897624">(</span><span class="ident" id="3897625">sha1Digest</span><span class="op" id="3897635">)</span><span class="op" id="3897636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3897639">copy</span><span class="op" id="3897643">(</span><span class="ident" id="3897644">ret</span><span class="op" id="3897647">,</span>&nbsp;<span class="ident" id="3897649">md5Digest</span><span class="op" id="3897658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3897661">copy</span><span class="op" id="3897665">(</span><span class="ident" id="3897666">ret</span><span class="op" id="3897669">[</span><span class="builtinfunc" id="3897670">len</span><span class="op" id="3897673">(</span><span class="ident" id="3897674">md5Digest</span><span class="op" id="3897683">)</span><span class="op" id="3897684">:</span><span class="op" id="3897685">]</span><span class="op" id="3897686">,</span>&nbsp;<span class="ident" id="3897688">sha1Digest</span><span class="op" id="3897698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897701">return</span>&nbsp;<span class="ident" id="3897708">ret</span><br>
<span class="lineno">230</span><span class="op" id="3897712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3897715">var</span>&nbsp;<span class="ident" id="3897719">ssl3ClientFinishedMagic</span>&nbsp;<span class="op" id="3897743">=</span>&nbsp;<span class="op" id="3897745">[</span><span class="num" id="3897746">4</span><span class="op" id="3897747">]</span><span class="builtintype" id="3897748">byte</span><span class="op" id="3897752">{</span><span class="num" id="3897753">0x43</span><span class="op" id="3897757">,</span>&nbsp;<span class="num" id="3897759">0x4c</span><span class="op" id="3897763">,</span>&nbsp;<span class="num" id="3897765">0x4e</span><span class="op" id="3897769">,</span>&nbsp;<span class="num" id="3897771">0x54</span><span class="op" id="3897775">}</span><br>
<span class="lineno"></span><span class="keyword" id="3897777">var</span>&nbsp;<span class="ident" id="3897781">ssl3ServerFinishedMagic</span>&nbsp;<span class="op" id="3897805">=</span>&nbsp;<span class="op" id="3897807">[</span><span class="num" id="3897808">4</span><span class="op" id="3897809">]</span><span class="builtintype" id="3897810">byte</span><span class="op" id="3897814">{</span><span class="num" id="3897815">0x53</span><span class="op" id="3897819">,</span>&nbsp;<span class="num" id="3897821">0x52</span><span class="op" id="3897825">,</span>&nbsp;<span class="num" id="3897827">0x56</span><span class="op" id="3897831">,</span>&nbsp;<span class="num" id="3897833">0x52</span><span class="op" id="3897837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="3897840">//&nbsp;clientSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3897914">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3897935">func</span>&nbsp;<span class="op" id="3897940">(</span><span class="ident" id="3897941">h</span>&nbsp;<span class="ident" id="3897943">finishedHash</span><span class="op" id="3897955">)</span>&nbsp;<span class="ident" id="3897957">clientSum</span><span class="op" id="3897966">(</span><span class="ident" id="3897967">masterSecret</span>&nbsp;<span class="op" id="3897980">[</span><span class="op" id="3897981">]</span><span class="builtintype" id="3897982">byte</span><span class="op" id="3897986">)</span>&nbsp;<span class="op" id="3897988">[</span><span class="op" id="3897989">]</span><span class="builtintype" id="3897990">byte</span>&nbsp;<span class="op" id="3897995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3897998">if</span>&nbsp;<span class="ident" id="3898001">h</span><span class="op" id="3898002">.</span><span class="ident" id="3898003">version</span>&nbsp;<span class="op" id="3898011">==</span>&nbsp;<span class="ident" id="3898014">VersionSSL30</span>&nbsp;<span class="op" id="3898027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898031">return</span>&nbsp;<span class="ident" id="3898038">finishedSum30</span><span class="op" id="3898051">(</span><span class="ident" id="3898052">h</span><span class="op" id="3898053">.</span><span class="ident" id="3898054">clientMD5</span><span class="op" id="3898063">,</span>&nbsp;<span class="ident" id="3898065">h</span><span class="op" id="3898066">.</span><span class="ident" id="3898067">client</span><span class="op" id="3898073">,</span>&nbsp;<span class="ident" id="3898075">masterSecret</span><span class="op" id="3898087">,</span>&nbsp;<span class="ident" id="3898089">ssl3ClientFinishedMagic</span><span class="op" id="3898112">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898119">out</span>&nbsp;<span class="op" id="3898123">:=</span>&nbsp;<span class="builtinfunc" id="3898126">make</span><span class="op" id="3898130">(</span><span class="op" id="3898131">[</span><span class="op" id="3898132">]</span><span class="builtintype" id="3898133">byte</span><span class="op" id="3898137">,</span>&nbsp;<span class="ident" id="3898139">finishedVerifyLength</span><span class="op" id="3898159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898162">if</span>&nbsp;<span class="ident" id="3898165">h</span><span class="op" id="3898166">.</span><span class="ident" id="3898167">version</span>&nbsp;<span class="op" id="3898175">&gt;=</span>&nbsp;<span class="ident" id="3898178">VersionTLS12</span>&nbsp;<span class="op" id="3898191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898195">seed</span>&nbsp;<span class="op" id="3898200">:=</span>&nbsp;<span class="ident" id="3898203">h</span><span class="op" id="3898204">.</span><span class="ident" id="3898205">client</span><span class="op" id="3898211">.</span><span class="ident" id="3898212">Sum</span><span class="op" id="3898215">(</span><span class="ident" id="3898216">nil</span><span class="op" id="3898219">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898223">prf12</span><span class="op" id="3898228">(</span><span class="ident" id="3898229">out</span><span class="op" id="3898232">,</span>&nbsp;<span class="ident" id="3898234">masterSecret</span><span class="op" id="3898246">,</span>&nbsp;<span class="ident" id="3898248">clientFinishedLabel</span><span class="op" id="3898267">,</span>&nbsp;<span class="ident" id="3898269">seed</span><span class="op" id="3898273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898276">}</span>&nbsp;<span class="keyword" id="3898278">else</span>&nbsp;<span class="op" id="3898283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898287">seed</span>&nbsp;<span class="op" id="3898292">:=</span>&nbsp;<span class="builtinfunc" id="3898295">make</span><span class="op" id="3898299">(</span><span class="op" id="3898300">[</span><span class="op" id="3898301">]</span><span class="builtintype" id="3898302">byte</span><span class="op" id="3898306">,</span>&nbsp;<span class="num" id="3898308">0</span><span class="op" id="3898309">,</span>&nbsp;<span class="ident" id="3898311">md5</span><span class="op" id="3898314">.</span><span class="ident" id="3898315">Size</span><span class="op" id="3898319">+</span><span class="ident" id="3898320">sha1</span><span class="op" id="3898324">.</span><span class="ident" id="3898325">Size</span><span class="op" id="3898329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898333">seed</span>&nbsp;<span class="op" id="3898338">=</span>&nbsp;<span class="ident" id="3898340">h</span><span class="op" id="3898341">.</span><span class="ident" id="3898342">clientMD5</span><span class="op" id="3898351">.</span><span class="ident" id="3898352">Sum</span><span class="op" id="3898355">(</span><span class="ident" id="3898356">seed</span><span class="op" id="3898360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898364">seed</span>&nbsp;<span class="op" id="3898369">=</span>&nbsp;<span class="ident" id="3898371">h</span><span class="op" id="3898372">.</span><span class="ident" id="3898373">client</span><span class="op" id="3898379">.</span><span class="ident" id="3898380">Sum</span><span class="op" id="3898383">(</span><span class="ident" id="3898384">seed</span><span class="op" id="3898388">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898392">prf10</span><span class="op" id="3898397">(</span><span class="ident" id="3898398">out</span><span class="op" id="3898401">,</span>&nbsp;<span class="ident" id="3898403">masterSecret</span><span class="op" id="3898415">,</span>&nbsp;<span class="ident" id="3898417">clientFinishedLabel</span><span class="op" id="3898436">,</span>&nbsp;<span class="ident" id="3898438">seed</span><span class="op" id="3898442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898448">return</span>&nbsp;<span class="ident" id="3898455">out</span><br>
<span class="lineno"></span><span class="op" id="3898459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="3898462">//&nbsp;serverSum&nbsp;returns&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;verify_data&nbsp;member&nbsp;of&nbsp;a&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3898536">//&nbsp;Finished&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="3898557">func</span>&nbsp;<span class="op" id="3898562">(</span><span class="ident" id="3898563">h</span>&nbsp;<span class="ident" id="3898565">finishedHash</span><span class="op" id="3898577">)</span>&nbsp;<span class="ident" id="3898579">serverSum</span><span class="op" id="3898588">(</span><span class="ident" id="3898589">masterSecret</span>&nbsp;<span class="op" id="3898602">[</span><span class="op" id="3898603">]</span><span class="builtintype" id="3898604">byte</span><span class="op" id="3898608">)</span>&nbsp;<span class="op" id="3898610">[</span><span class="op" id="3898611">]</span><span class="builtintype" id="3898612">byte</span>&nbsp;<span class="op" id="3898617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898620">if</span>&nbsp;<span class="ident" id="3898623">h</span><span class="op" id="3898624">.</span><span class="ident" id="3898625">version</span>&nbsp;<span class="op" id="3898633">==</span>&nbsp;<span class="ident" id="3898636">VersionSSL30</span>&nbsp;<span class="op" id="3898649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898653">return</span>&nbsp;<span class="ident" id="3898660">finishedSum30</span><span class="op" id="3898673">(</span><span class="ident" id="3898674">h</span><span class="op" id="3898675">.</span><span class="ident" id="3898676">serverMD5</span><span class="op" id="3898685">,</span>&nbsp;<span class="ident" id="3898687">h</span><span class="op" id="3898688">.</span><span class="ident" id="3898689">server</span><span class="op" id="3898695">,</span>&nbsp;<span class="ident" id="3898697">masterSecret</span><span class="op" id="3898709">,</span>&nbsp;<span class="ident" id="3898711">ssl3ServerFinishedMagic</span><span class="op" id="3898734">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898741">out</span>&nbsp;<span class="op" id="3898745">:=</span>&nbsp;<span class="builtinfunc" id="3898748">make</span><span class="op" id="3898752">(</span><span class="op" id="3898753">[</span><span class="op" id="3898754">]</span><span class="builtintype" id="3898755">byte</span><span class="op" id="3898759">,</span>&nbsp;<span class="ident" id="3898761">finishedVerifyLength</span><span class="op" id="3898781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3898784">if</span>&nbsp;<span class="ident" id="3898787">h</span><span class="op" id="3898788">.</span><span class="ident" id="3898789">version</span>&nbsp;<span class="op" id="3898797">&gt;=</span>&nbsp;<span class="ident" id="3898800">VersionTLS12</span>&nbsp;<span class="op" id="3898813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898817">seed</span>&nbsp;<span class="op" id="3898822">:=</span>&nbsp;<span class="ident" id="3898825">h</span><span class="op" id="3898826">.</span><span class="ident" id="3898827">server</span><span class="op" id="3898833">.</span><span class="ident" id="3898834">Sum</span><span class="op" id="3898837">(</span><span class="ident" id="3898838">nil</span><span class="op" id="3898841">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898845">prf12</span><span class="op" id="3898850">(</span><span class="ident" id="3898851">out</span><span class="op" id="3898854">,</span>&nbsp;<span class="ident" id="3898856">masterSecret</span><span class="op" id="3898868">,</span>&nbsp;<span class="ident" id="3898870">serverFinishedLabel</span><span class="op" id="3898889">,</span>&nbsp;<span class="ident" id="3898891">seed</span><span class="op" id="3898895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3898898">}</span>&nbsp;<span class="keyword" id="3898900">else</span>&nbsp;<span class="op" id="3898905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898909">seed</span>&nbsp;<span class="op" id="3898914">:=</span>&nbsp;<span class="builtinfunc" id="3898917">make</span><span class="op" id="3898921">(</span><span class="op" id="3898922">[</span><span class="op" id="3898923">]</span><span class="builtintype" id="3898924">byte</span><span class="op" id="3898928">,</span>&nbsp;<span class="num" id="3898930">0</span><span class="op" id="3898931">,</span>&nbsp;<span class="ident" id="3898933">md5</span><span class="op" id="3898936">.</span><span class="ident" id="3898937">Size</span><span class="op" id="3898941">+</span><span class="ident" id="3898942">sha1</span><span class="op" id="3898946">.</span><span class="ident" id="3898947">Size</span><span class="op" id="3898951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898955">seed</span>&nbsp;<span class="op" id="3898960">=</span>&nbsp;<span class="ident" id="3898962">h</span><span class="op" id="3898963">.</span><span class="ident" id="3898964">serverMD5</span><span class="op" id="3898973">.</span><span class="ident" id="3898974">Sum</span><span class="op" id="3898977">(</span><span class="ident" id="3898978">seed</span><span class="op" id="3898982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3898986">seed</span>&nbsp;<span class="op" id="3898991">=</span>&nbsp;<span class="ident" id="3898993">h</span><span class="op" id="3898994">.</span><span class="ident" id="3898995">server</span><span class="op" id="3899001">.</span><span class="ident" id="3899002">Sum</span><span class="op" id="3899005">(</span><span class="ident" id="3899006">seed</span><span class="op" id="3899010">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899014">prf10</span><span class="op" id="3899019">(</span><span class="ident" id="3899020">out</span><span class="op" id="3899023">,</span>&nbsp;<span class="ident" id="3899025">masterSecret</span><span class="op" id="3899037">,</span>&nbsp;<span class="ident" id="3899039">serverFinishedLabel</span><span class="op" id="3899058">,</span>&nbsp;<span class="ident" id="3899060">seed</span><span class="op" id="3899064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899070">return</span>&nbsp;<span class="ident" id="3899077">out</span><br>
<span class="lineno"></span><span class="op" id="3899081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="comment" id="3899084">//&nbsp;hashForClientCertificate&nbsp;returns&nbsp;a&nbsp;digest,&nbsp;hash&nbsp;function,&nbsp;and&nbsp;TLS&nbsp;1.2&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3899162">//&nbsp;id&nbsp;suitable&nbsp;for&nbsp;signing&nbsp;by&nbsp;a&nbsp;TLS&nbsp;client&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3899218">func</span>&nbsp;<span class="op" id="3899223">(</span><span class="ident" id="3899224">h</span>&nbsp;<span class="ident" id="3899226">finishedHash</span><span class="op" id="3899238">)</span>&nbsp;<span class="ident" id="3899240">hashForClientCertificate</span><span class="op" id="3899264">(</span><span class="ident" id="3899265">sigType</span>&nbsp;<span class="builtintype" id="3899273">uint8</span><span class="op" id="3899278">)</span>&nbsp;<span class="op" id="3899280">(</span><span class="op" id="3899281">[</span><span class="op" id="3899282">]</span><span class="builtintype" id="3899283">byte</span><span class="op" id="3899287">,</span>&nbsp;<span class="ident" id="3899289">crypto</span><span class="op" id="3899295">.</span><span class="ident" id="3899296">Hash</span><span class="op" id="3899300">,</span>&nbsp;<span class="builtintype" id="3899302">uint8</span><span class="op" id="3899307">)</span>&nbsp;<span class="op" id="3899309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899312">if</span>&nbsp;<span class="ident" id="3899315">h</span><span class="op" id="3899316">.</span><span class="ident" id="3899317">version</span>&nbsp;<span class="op" id="3899325">&gt;=</span>&nbsp;<span class="ident" id="3899328">VersionTLS12</span>&nbsp;<span class="op" id="3899341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899345">digest</span>&nbsp;<span class="op" id="3899352">:=</span>&nbsp;<span class="ident" id="3899355">h</span><span class="op" id="3899356">.</span><span class="ident" id="3899357">server</span><span class="op" id="3899363">.</span><span class="ident" id="3899364">Sum</span><span class="op" id="3899367">(</span><span class="ident" id="3899368">nil</span><span class="op" id="3899371">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899375">return</span>&nbsp;<span class="ident" id="3899382">digest</span><span class="op" id="3899388">,</span>&nbsp;<span class="ident" id="3899390">crypto</span><span class="op" id="3899396">.</span><span class="ident" id="3899397">SHA256</span><span class="op" id="3899403">,</span>&nbsp;<span class="ident" id="3899405">hashSHA256</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899420">if</span>&nbsp;<span class="ident" id="3899423">sigType</span>&nbsp;<span class="op" id="3899431">==</span>&nbsp;<span class="ident" id="3899434">signatureECDSA</span>&nbsp;<span class="op" id="3899449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899453">digest</span>&nbsp;<span class="op" id="3899460">:=</span>&nbsp;<span class="ident" id="3899463">h</span><span class="op" id="3899464">.</span><span class="ident" id="3899465">server</span><span class="op" id="3899471">.</span><span class="ident" id="3899472">Sum</span><span class="op" id="3899475">(</span><span class="ident" id="3899476">nil</span><span class="op" id="3899479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899483">return</span>&nbsp;<span class="ident" id="3899490">digest</span><span class="op" id="3899496">,</span>&nbsp;<span class="ident" id="3899498">crypto</span><span class="op" id="3899504">.</span><span class="ident" id="3899505">SHA1</span><span class="op" id="3899509">,</span>&nbsp;<span class="ident" id="3899511">hashSHA1</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3899521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899525">digest</span>&nbsp;<span class="op" id="3899532">:=</span>&nbsp;<span class="builtinfunc" id="3899535">make</span><span class="op" id="3899539">(</span><span class="op" id="3899540">[</span><span class="op" id="3899541">]</span><span class="builtintype" id="3899542">byte</span><span class="op" id="3899546">,</span>&nbsp;<span class="num" id="3899548">0</span><span class="op" id="3899549">,</span>&nbsp;<span class="num" id="3899551">36</span><span class="op" id="3899553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899556">digest</span>&nbsp;<span class="op" id="3899563">=</span>&nbsp;<span class="ident" id="3899565">h</span><span class="op" id="3899566">.</span><span class="ident" id="3899567">serverMD5</span><span class="op" id="3899576">.</span><span class="ident" id="3899577">Sum</span><span class="op" id="3899580">(</span><span class="ident" id="3899581">digest</span><span class="op" id="3899587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3899590">digest</span>&nbsp;<span class="op" id="3899597">=</span>&nbsp;<span class="ident" id="3899599">h</span><span class="op" id="3899600">.</span><span class="ident" id="3899601">server</span><span class="op" id="3899607">.</span><span class="ident" id="3899608">Sum</span><span class="op" id="3899611">(</span><span class="ident" id="3899612">digest</span><span class="op" id="3899618">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3899621">return</span>&nbsp;<span class="ident" id="3899628">digest</span><span class="op" id="3899634">,</span>&nbsp;<span class="ident" id="3899636">crypto</span><span class="op" id="3899642">.</span><span class="ident" id="3899643">MD5SHA1</span><span class="op" id="3899650">,</span>&nbsp;<span class="num" id="3899652">0</span>&nbsp;<span class="comment" id="3899654">/*&nbsp;not&nbsp;specified&nbsp;in&nbsp;TLS&nbsp;1.2.&nbsp;*/</span><br>
<span class="lineno"></span><span class="op" id="3899686">}</span>
</div>
</body>
</html>
