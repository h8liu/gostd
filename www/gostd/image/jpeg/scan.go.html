<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6060017">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6060072">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6060126">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6060177">package</span>&nbsp;<span class="ident" id="6060185">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6060191">import</span>&nbsp;<span class="op" id="6060198">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6060201">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="6060209">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="6060212">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6060272">func</span>&nbsp;<span class="op" id="6060277">(</span><span class="ident" id="6060278">d</span>&nbsp;<span class="op" id="6060280">*</span><span class="ident" id="6060281">decoder</span><span class="op" id="6060288">)</span>&nbsp;<span class="ident" id="6060290">makeImg</span><span class="op" id="6060297">(</span><span class="ident" id="6060298">h0</span><span class="op" id="6060300">,</span>&nbsp;<span class="ident" id="6060302">v0</span><span class="op" id="6060304">,</span>&nbsp;<span class="ident" id="6060306">mxx</span><span class="op" id="6060309">,</span>&nbsp;<span class="ident" id="6060311">myy</span>&nbsp;<span class="builtintype" id="6060315">int</span><span class="op" id="6060318">)</span>&nbsp;<span class="op" id="6060320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060323">if</span>&nbsp;<span class="ident" id="6060326">d</span><span class="op" id="6060327">.</span><span class="ident" id="6060328">nComp</span>&nbsp;<span class="op" id="6060334">==</span>&nbsp;<span class="ident" id="6060337">nGrayComponent</span>&nbsp;<span class="op" id="6060352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060356">m</span>&nbsp;<span class="op" id="6060358">:=</span>&nbsp;<span class="ident" id="6060361">image</span><span class="op" id="6060366">.</span><span class="ident" id="6060367">NewGray</span><span class="op" id="6060374">(</span><span class="ident" id="6060375">image</span><span class="op" id="6060380">.</span><span class="ident" id="6060381">Rect</span><span class="op" id="6060385">(</span><span class="num" id="6060386">0</span><span class="op" id="6060387">,</span>&nbsp;<span class="num" id="6060389">0</span><span class="op" id="6060390">,</span>&nbsp;<span class="num" id="6060392">8</span><span class="op" id="6060393">*</span><span class="ident" id="6060394">mxx</span><span class="op" id="6060397">,</span>&nbsp;<span class="num" id="6060399">8</span><span class="op" id="6060400">*</span><span class="ident" id="6060401">myy</span><span class="op" id="6060404">)</span><span class="op" id="6060405">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060409">d</span><span class="op" id="6060410">.</span><span class="ident" id="6060411">img1</span>&nbsp;<span class="op" id="6060416">=</span>&nbsp;<span class="ident" id="6060418">m</span><span class="op" id="6060419">.</span><span class="ident" id="6060420">SubImage</span><span class="op" id="6060428">(</span><span class="ident" id="6060429">image</span><span class="op" id="6060434">.</span><span class="ident" id="6060435">Rect</span><span class="op" id="6060439">(</span><span class="num" id="6060440">0</span><span class="op" id="6060441">,</span>&nbsp;<span class="num" id="6060443">0</span><span class="op" id="6060444">,</span>&nbsp;<span class="ident" id="6060446">d</span><span class="op" id="6060447">.</span><span class="ident" id="6060448">width</span><span class="op" id="6060453">,</span>&nbsp;<span class="ident" id="6060455">d</span><span class="op" id="6060456">.</span><span class="ident" id="6060457">height</span><span class="op" id="6060463">)</span><span class="op" id="6060464">)</span><span class="op" id="6060465">.</span><span class="op" id="6060466">(</span><span class="op" id="6060467">*</span><span class="ident" id="6060468">image</span><span class="op" id="6060473">.</span><span class="ident" id="6060474">Gray</span><span class="op" id="6060478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060493">var</span>&nbsp;<span class="ident" id="6060497">subsampleRatio</span>&nbsp;<span class="ident" id="6060512">image</span><span class="op" id="6060517">.</span><span class="ident" id="6060518">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060539">switch</span>&nbsp;<span class="op" id="6060546">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060549">case</span>&nbsp;<span class="ident" id="6060554">h0</span>&nbsp;<span class="op" id="6060557">==</span>&nbsp;<span class="num" id="6060560">1</span>&nbsp;<span class="op" id="6060562">&amp;&amp;</span>&nbsp;<span class="ident" id="6060565">v0</span>&nbsp;<span class="op" id="6060568">==</span>&nbsp;<span class="num" id="6060571">1</span><span class="op" id="6060572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060576">subsampleRatio</span>&nbsp;<span class="op" id="6060591">=</span>&nbsp;<span class="ident" id="6060593">image</span><span class="op" id="6060598">.</span><span class="ident" id="6060599">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060623">case</span>&nbsp;<span class="ident" id="6060628">h0</span>&nbsp;<span class="op" id="6060631">==</span>&nbsp;<span class="num" id="6060634">1</span>&nbsp;<span class="op" id="6060636">&amp;&amp;</span>&nbsp;<span class="ident" id="6060639">v0</span>&nbsp;<span class="op" id="6060642">==</span>&nbsp;<span class="num" id="6060645">2</span><span class="op" id="6060646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060650">subsampleRatio</span>&nbsp;<span class="op" id="6060665">=</span>&nbsp;<span class="ident" id="6060667">image</span><span class="op" id="6060672">.</span><span class="ident" id="6060673">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060697">case</span>&nbsp;<span class="ident" id="6060702">h0</span>&nbsp;<span class="op" id="6060705">==</span>&nbsp;<span class="num" id="6060708">2</span>&nbsp;<span class="op" id="6060710">&amp;&amp;</span>&nbsp;<span class="ident" id="6060713">v0</span>&nbsp;<span class="op" id="6060716">==</span>&nbsp;<span class="num" id="6060719">1</span><span class="op" id="6060720">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060724">subsampleRatio</span>&nbsp;<span class="op" id="6060739">=</span>&nbsp;<span class="ident" id="6060741">image</span><span class="op" id="6060746">.</span><span class="ident" id="6060747">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060771">case</span>&nbsp;<span class="ident" id="6060776">h0</span>&nbsp;<span class="op" id="6060779">==</span>&nbsp;<span class="num" id="6060782">2</span>&nbsp;<span class="op" id="6060784">&amp;&amp;</span>&nbsp;<span class="ident" id="6060787">v0</span>&nbsp;<span class="op" id="6060790">==</span>&nbsp;<span class="num" id="6060793">2</span><span class="op" id="6060794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060798">subsampleRatio</span>&nbsp;<span class="op" id="6060813">=</span>&nbsp;<span class="ident" id="6060815">image</span><span class="op" id="6060820">.</span><span class="ident" id="6060821">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060845">default</span><span class="op" id="6060852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6060856">panic</span><span class="op" id="6060861">(</span><span class="string" id="6060862">&#34;unreachable&#34;</span><span class="op" id="6060875">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060881">m</span>&nbsp;<span class="op" id="6060883">:=</span>&nbsp;<span class="ident" id="6060886">image</span><span class="op" id="6060891">.</span><span class="ident" id="6060892">NewYCbCr</span><span class="op" id="6060900">(</span><span class="ident" id="6060901">image</span><span class="op" id="6060906">.</span><span class="ident" id="6060907">Rect</span><span class="op" id="6060911">(</span><span class="num" id="6060912">0</span><span class="op" id="6060913">,</span>&nbsp;<span class="num" id="6060915">0</span><span class="op" id="6060916">,</span>&nbsp;<span class="num" id="6060918">8</span><span class="op" id="6060919">*</span><span class="ident" id="6060920">h0</span><span class="op" id="6060922">*</span><span class="ident" id="6060923">mxx</span><span class="op" id="6060926">,</span>&nbsp;<span class="num" id="6060928">8</span><span class="op" id="6060929">*</span><span class="ident" id="6060930">v0</span><span class="op" id="6060932">*</span><span class="ident" id="6060933">myy</span><span class="op" id="6060936">)</span><span class="op" id="6060937">,</span>&nbsp;<span class="ident" id="6060939">subsampleRatio</span><span class="op" id="6060953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060956">d</span><span class="op" id="6060957">.</span><span class="ident" id="6060958">img3</span>&nbsp;<span class="op" id="6060963">=</span>&nbsp;<span class="ident" id="6060965">m</span><span class="op" id="6060966">.</span><span class="ident" id="6060967">SubImage</span><span class="op" id="6060975">(</span><span class="ident" id="6060976">image</span><span class="op" id="6060981">.</span><span class="ident" id="6060982">Rect</span><span class="op" id="6060986">(</span><span class="num" id="6060987">0</span><span class="op" id="6060988">,</span>&nbsp;<span class="num" id="6060990">0</span><span class="op" id="6060991">,</span>&nbsp;<span class="ident" id="6060993">d</span><span class="op" id="6060994">.</span><span class="ident" id="6060995">width</span><span class="op" id="6061000">,</span>&nbsp;<span class="ident" id="6061002">d</span><span class="op" id="6061003">.</span><span class="ident" id="6061004">height</span><span class="op" id="6061010">)</span><span class="op" id="6061011">)</span><span class="op" id="6061012">.</span><span class="op" id="6061013">(</span><span class="op" id="6061014">*</span><span class="ident" id="6061015">image</span><span class="op" id="6061020">.</span><span class="ident" id="6061021">YCbCr</span><span class="op" id="6061026">)</span><br>
<span class="lineno"></span><span class="op" id="6061028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6061031">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6061062">func</span>&nbsp;<span class="op" id="6061067">(</span><span class="ident" id="6061068">d</span>&nbsp;<span class="op" id="6061070">*</span><span class="ident" id="6061071">decoder</span><span class="op" id="6061078">)</span>&nbsp;<span class="ident" id="6061080">processSOS</span><span class="op" id="6061090">(</span><span class="ident" id="6061091">n</span>&nbsp;<span class="builtintype" id="6061093">int</span><span class="op" id="6061096">)</span>&nbsp;<span class="builtintype" id="6061098">error</span>&nbsp;<span class="op" id="6061104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061107">if</span>&nbsp;<span class="ident" id="6061110">d</span><span class="op" id="6061111">.</span><span class="ident" id="6061112">nComp</span>&nbsp;<span class="op" id="6061118">==</span>&nbsp;<span class="num" id="6061121">0</span>&nbsp;<span class="op" id="6061123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061127">return</span>&nbsp;<span class="ident" id="6061134">FormatError</span><span class="op" id="6061145">(</span><span class="string" id="6061146">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="6061166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061169">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061172">if</span>&nbsp;<span class="ident" id="6061175">n</span>&nbsp;<span class="op" id="6061177">&lt;</span>&nbsp;<span class="num" id="6061179">6</span>&nbsp;<span class="op" id="6061181">||</span>&nbsp;<span class="num" id="6061184">4</span><span class="op" id="6061185">+</span><span class="num" id="6061186">2</span><span class="op" id="6061187">*</span><span class="ident" id="6061188">d</span><span class="op" id="6061189">.</span><span class="ident" id="6061190">nComp</span>&nbsp;<span class="op" id="6061196">&lt;</span>&nbsp;<span class="ident" id="6061198">n</span>&nbsp;<span class="op" id="6061200">||</span>&nbsp;<span class="ident" id="6061203">n</span><span class="op" id="6061204">%</span><span class="num" id="6061205">2</span>&nbsp;<span class="op" id="6061207">!=</span>&nbsp;<span class="num" id="6061210">0</span>&nbsp;<span class="op" id="6061212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061216">return</span>&nbsp;<span class="ident" id="6061223">FormatError</span><span class="op" id="6061234">(</span><span class="string" id="6061235">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6061257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061263">if</span>&nbsp;<span class="ident" id="6061266">err</span>&nbsp;<span class="op" id="6061270">:=</span>&nbsp;<span class="ident" id="6061273">d</span><span class="op" id="6061274">.</span><span class="ident" id="6061275">readFull</span><span class="op" id="6061283">(</span><span class="ident" id="6061284">d</span><span class="op" id="6061285">.</span><span class="ident" id="6061286">tmp</span><span class="op" id="6061289">[</span><span class="op" id="6061290">:</span><span class="ident" id="6061291">n</span><span class="op" id="6061292">]</span><span class="op" id="6061293">)</span><span class="op" id="6061294">;</span>&nbsp;<span class="ident" id="6061296">err</span>&nbsp;<span class="op" id="6061300">!=</span>&nbsp;<span class="ident" id="6061303">nil</span>&nbsp;<span class="op" id="6061307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061311">return</span>&nbsp;<span class="ident" id="6061318">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061326">nComp</span>&nbsp;<span class="op" id="6061332">:=</span>&nbsp;<span class="builtintype" id="6061335">int</span><span class="op" id="6061338">(</span><span class="ident" id="6061339">d</span><span class="op" id="6061340">.</span><span class="ident" id="6061341">tmp</span><span class="op" id="6061344">[</span><span class="num" id="6061345">0</span><span class="op" id="6061346">]</span><span class="op" id="6061347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061350">if</span>&nbsp;<span class="ident" id="6061353">n</span>&nbsp;<span class="op" id="6061355">!=</span>&nbsp;<span class="num" id="6061358">4</span><span class="op" id="6061359">+</span><span class="num" id="6061360">2</span><span class="op" id="6061361">*</span><span class="ident" id="6061362">nComp</span>&nbsp;<span class="op" id="6061368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061372">return</span>&nbsp;<span class="ident" id="6061379">FormatError</span><span class="op" id="6061390">(</span><span class="string" id="6061391">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="6061442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061445">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061448">var</span>&nbsp;<span class="ident" id="6061452">scan</span>&nbsp;<span class="op" id="6061457">[</span><span class="ident" id="6061458">nColorComponent</span><span class="op" id="6061473">]</span><span class="keyword" id="6061474">struct</span>&nbsp;<span class="op" id="6061481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061485">compIndex</span>&nbsp;<span class="builtintype" id="6061495">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061503">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6061513">uint8</span>&nbsp;<span class="comment" id="6061519">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061543">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6061553">uint8</span>&nbsp;<span class="comment" id="6061559">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061582">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061585">for</span>&nbsp;<span class="ident" id="6061589">i</span>&nbsp;<span class="op" id="6061591">:=</span>&nbsp;<span class="num" id="6061594">0</span><span class="op" id="6061595">;</span>&nbsp;<span class="ident" id="6061597">i</span>&nbsp;<span class="op" id="6061599">&lt;</span>&nbsp;<span class="ident" id="6061601">nComp</span><span class="op" id="6061606">;</span>&nbsp;<span class="ident" id="6061608">i</span><span class="op" id="6061609">++</span>&nbsp;<span class="op" id="6061612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061616">cs</span>&nbsp;<span class="op" id="6061619">:=</span>&nbsp;<span class="ident" id="6061622">d</span><span class="op" id="6061623">.</span><span class="ident" id="6061624">tmp</span><span class="op" id="6061627">[</span><span class="num" id="6061628">1</span><span class="op" id="6061629">+</span><span class="num" id="6061630">2</span><span class="op" id="6061631">*</span><span class="ident" id="6061632">i</span><span class="op" id="6061633">]</span>&nbsp;<span class="comment" id="6061635">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061660">compIndex</span>&nbsp;<span class="op" id="6061670">:=</span>&nbsp;<span class="op" id="6061673">-</span><span class="num" id="6061674">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061678">for</span>&nbsp;<span class="ident" id="6061682">j</span><span class="op" id="6061683">,</span>&nbsp;<span class="ident" id="6061685">comp</span>&nbsp;<span class="op" id="6061690">:=</span>&nbsp;<span class="keyword" id="6061693">range</span>&nbsp;<span class="ident" id="6061699">d</span><span class="op" id="6061700">.</span><span class="ident" id="6061701">comp</span>&nbsp;<span class="op" id="6061706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061711">if</span>&nbsp;<span class="ident" id="6061714">cs</span>&nbsp;<span class="op" id="6061717">==</span>&nbsp;<span class="ident" id="6061720">comp</span><span class="op" id="6061724">.</span><span class="ident" id="6061725">c</span>&nbsp;<span class="op" id="6061727">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061733">compIndex</span>&nbsp;<span class="op" id="6061743">=</span>&nbsp;<span class="ident" id="6061745">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061758">if</span>&nbsp;<span class="ident" id="6061761">compIndex</span>&nbsp;<span class="op" id="6061771">&lt;</span>&nbsp;<span class="num" id="6061773">0</span>&nbsp;<span class="op" id="6061775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061780">return</span>&nbsp;<span class="ident" id="6061787">FormatError</span><span class="op" id="6061798">(</span><span class="string" id="6061799">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="6061827">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061835">scan</span><span class="op" id="6061839">[</span><span class="ident" id="6061840">i</span><span class="op" id="6061841">]</span><span class="op" id="6061842">.</span><span class="ident" id="6061843">compIndex</span>&nbsp;<span class="op" id="6061853">=</span>&nbsp;<span class="builtintype" id="6061855">uint8</span><span class="op" id="6061860">(</span><span class="ident" id="6061861">compIndex</span><span class="op" id="6061870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061874">scan</span><span class="op" id="6061878">[</span><span class="ident" id="6061879">i</span><span class="op" id="6061880">]</span><span class="op" id="6061881">.</span><span class="ident" id="6061882">td</span>&nbsp;<span class="op" id="6061885">=</span>&nbsp;<span class="ident" id="6061887">d</span><span class="op" id="6061888">.</span><span class="ident" id="6061889">tmp</span><span class="op" id="6061892">[</span><span class="num" id="6061893">2</span><span class="op" id="6061894">+</span><span class="num" id="6061895">2</span><span class="op" id="6061896">*</span><span class="ident" id="6061897">i</span><span class="op" id="6061898">]</span>&nbsp;<span class="op" id="6061900">&gt;&gt;</span>&nbsp;<span class="num" id="6061903">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061907">if</span>&nbsp;<span class="ident" id="6061910">scan</span><span class="op" id="6061914">[</span><span class="ident" id="6061915">i</span><span class="op" id="6061916">]</span><span class="op" id="6061917">.</span><span class="ident" id="6061918">td</span>&nbsp;<span class="op" id="6061921">&gt;</span>&nbsp;<span class="ident" id="6061923">maxTh</span>&nbsp;<span class="op" id="6061929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061934">return</span>&nbsp;<span class="ident" id="6061941">FormatError</span><span class="op" id="6061952">(</span><span class="string" id="6061953">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="6061967">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061975">scan</span><span class="op" id="6061979">[</span><span class="ident" id="6061980">i</span><span class="op" id="6061981">]</span><span class="op" id="6061982">.</span><span class="ident" id="6061983">ta</span>&nbsp;<span class="op" id="6061986">=</span>&nbsp;<span class="ident" id="6061988">d</span><span class="op" id="6061989">.</span><span class="ident" id="6061990">tmp</span><span class="op" id="6061993">[</span><span class="num" id="6061994">2</span><span class="op" id="6061995">+</span><span class="num" id="6061996">2</span><span class="op" id="6061997">*</span><span class="ident" id="6061998">i</span><span class="op" id="6061999">]</span>&nbsp;<span class="op" id="6062001">&amp;</span>&nbsp;<span class="num" id="6062003">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062010">if</span>&nbsp;<span class="ident" id="6062013">scan</span><span class="op" id="6062017">[</span><span class="ident" id="6062018">i</span><span class="op" id="6062019">]</span><span class="op" id="6062020">.</span><span class="ident" id="6062021">ta</span>&nbsp;<span class="op" id="6062024">&gt;</span>&nbsp;<span class="ident" id="6062026">maxTh</span>&nbsp;<span class="op" id="6062032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062037">return</span>&nbsp;<span class="ident" id="6062044">FormatError</span><span class="op" id="6062055">(</span><span class="string" id="6062056">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="6062070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062074">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062081">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062140">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062208">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062259">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062263">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062333">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062404">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062474">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062541">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062609">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062678">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062745">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062815">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062878">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062899">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062903">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062972">zigStart</span><span class="op" id="6062980">,</span>&nbsp;<span class="ident" id="6062982">zigEnd</span><span class="op" id="6062988">,</span>&nbsp;<span class="ident" id="6062990">ah</span><span class="op" id="6062992">,</span>&nbsp;<span class="ident" id="6062994">al</span>&nbsp;<span class="op" id="6062997">:=</span>&nbsp;<span class="builtintype" id="6063000">int32</span><span class="op" id="6063005">(</span><span class="num" id="6063006">0</span><span class="op" id="6063007">)</span><span class="op" id="6063008">,</span>&nbsp;<span class="builtintype" id="6063010">int32</span><span class="op" id="6063015">(</span><span class="ident" id="6063016">blockSize</span><span class="op" id="6063025">-</span><span class="num" id="6063026">1</span><span class="op" id="6063027">)</span><span class="op" id="6063028">,</span>&nbsp;<span class="builtintype" id="6063030">uint32</span><span class="op" id="6063036">(</span><span class="num" id="6063037">0</span><span class="op" id="6063038">)</span><span class="op" id="6063039">,</span>&nbsp;<span class="builtintype" id="6063041">uint32</span><span class="op" id="6063047">(</span><span class="num" id="6063048">0</span><span class="op" id="6063049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063052">if</span>&nbsp;<span class="ident" id="6063055">d</span><span class="op" id="6063056">.</span><span class="ident" id="6063057">progressive</span>&nbsp;<span class="op" id="6063069">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063073">zigStart</span>&nbsp;<span class="op" id="6063082">=</span>&nbsp;<span class="builtintype" id="6063084">int32</span><span class="op" id="6063089">(</span><span class="ident" id="6063090">d</span><span class="op" id="6063091">.</span><span class="ident" id="6063092">tmp</span><span class="op" id="6063095">[</span><span class="num" id="6063096">1</span><span class="op" id="6063097">+</span><span class="num" id="6063098">2</span><span class="op" id="6063099">*</span><span class="ident" id="6063100">nComp</span><span class="op" id="6063105">]</span><span class="op" id="6063106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063110">zigEnd</span>&nbsp;<span class="op" id="6063117">=</span>&nbsp;<span class="builtintype" id="6063119">int32</span><span class="op" id="6063124">(</span><span class="ident" id="6063125">d</span><span class="op" id="6063126">.</span><span class="ident" id="6063127">tmp</span><span class="op" id="6063130">[</span><span class="num" id="6063131">2</span><span class="op" id="6063132">+</span><span class="num" id="6063133">2</span><span class="op" id="6063134">*</span><span class="ident" id="6063135">nComp</span><span class="op" id="6063140">]</span><span class="op" id="6063141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063145">ah</span>&nbsp;<span class="op" id="6063148">=</span>&nbsp;<span class="builtintype" id="6063150">uint32</span><span class="op" id="6063156">(</span><span class="ident" id="6063157">d</span><span class="op" id="6063158">.</span><span class="ident" id="6063159">tmp</span><span class="op" id="6063162">[</span><span class="num" id="6063163">3</span><span class="op" id="6063164">+</span><span class="num" id="6063165">2</span><span class="op" id="6063166">*</span><span class="ident" id="6063167">nComp</span><span class="op" id="6063172">]</span>&nbsp;<span class="op" id="6063174">&gt;&gt;</span>&nbsp;<span class="num" id="6063177">4</span><span class="op" id="6063178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063182">al</span>&nbsp;<span class="op" id="6063185">=</span>&nbsp;<span class="builtintype" id="6063187">uint32</span><span class="op" id="6063193">(</span><span class="ident" id="6063194">d</span><span class="op" id="6063195">.</span><span class="ident" id="6063196">tmp</span><span class="op" id="6063199">[</span><span class="num" id="6063200">3</span><span class="op" id="6063201">+</span><span class="num" id="6063202">2</span><span class="op" id="6063203">*</span><span class="ident" id="6063204">nComp</span><span class="op" id="6063209">]</span>&nbsp;<span class="op" id="6063211">&amp;</span>&nbsp;<span class="num" id="6063213">0x0f</span><span class="op" id="6063217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063221">if</span>&nbsp;<span class="op" id="6063224">(</span><span class="ident" id="6063225">zigStart</span>&nbsp;<span class="op" id="6063234">==</span>&nbsp;<span class="num" id="6063237">0</span>&nbsp;<span class="op" id="6063239">&amp;&amp;</span>&nbsp;<span class="ident" id="6063242">zigEnd</span>&nbsp;<span class="op" id="6063249">!=</span>&nbsp;<span class="num" id="6063252">0</span><span class="op" id="6063253">)</span>&nbsp;<span class="op" id="6063255">||</span>&nbsp;<span class="ident" id="6063258">zigStart</span>&nbsp;<span class="op" id="6063267">&gt;</span>&nbsp;<span class="ident" id="6063269">zigEnd</span>&nbsp;<span class="op" id="6063276">||</span>&nbsp;<span class="ident" id="6063279">blockSize</span>&nbsp;<span class="op" id="6063289">&lt;=</span>&nbsp;<span class="ident" id="6063292">zigEnd</span>&nbsp;<span class="op" id="6063299">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063304">return</span>&nbsp;<span class="ident" id="6063311">FormatError</span><span class="op" id="6063322">(</span><span class="string" id="6063323">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="6063354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063362">if</span>&nbsp;<span class="ident" id="6063365">zigStart</span>&nbsp;<span class="op" id="6063374">!=</span>&nbsp;<span class="num" id="6063377">0</span>&nbsp;<span class="op" id="6063379">&amp;&amp;</span>&nbsp;<span class="ident" id="6063382">nComp</span>&nbsp;<span class="op" id="6063388">!=</span>&nbsp;<span class="num" id="6063391">1</span>&nbsp;<span class="op" id="6063393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063398">return</span>&nbsp;<span class="ident" id="6063405">FormatError</span><span class="op" id="6063416">(</span><span class="string" id="6063417">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="6063474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063478">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063482">if</span>&nbsp;<span class="ident" id="6063485">ah</span>&nbsp;<span class="op" id="6063488">!=</span>&nbsp;<span class="num" id="6063491">0</span>&nbsp;<span class="op" id="6063493">&amp;&amp;</span>&nbsp;<span class="ident" id="6063496">ah</span>&nbsp;<span class="op" id="6063499">!=</span>&nbsp;<span class="ident" id="6063502">al</span><span class="op" id="6063504">+</span><span class="num" id="6063505">1</span>&nbsp;<span class="op" id="6063507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063512">return</span>&nbsp;<span class="ident" id="6063519">FormatError</span><span class="op" id="6063530">(</span><span class="string" id="6063531">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="6063568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6063579">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063654">h0</span><span class="op" id="6063656">,</span>&nbsp;<span class="ident" id="6063658">v0</span>&nbsp;<span class="op" id="6063661">:=</span>&nbsp;<span class="ident" id="6063664">d</span><span class="op" id="6063665">.</span><span class="ident" id="6063666">comp</span><span class="op" id="6063670">[</span><span class="num" id="6063671">0</span><span class="op" id="6063672">]</span><span class="op" id="6063673">.</span><span class="ident" id="6063674">h</span><span class="op" id="6063675">,</span>&nbsp;<span class="ident" id="6063677">d</span><span class="op" id="6063678">.</span><span class="ident" id="6063679">comp</span><span class="op" id="6063683">[</span><span class="num" id="6063684">0</span><span class="op" id="6063685">]</span><span class="op" id="6063686">.</span><span class="ident" id="6063687">v</span>&nbsp;<span class="comment" id="6063689">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063735">mxx</span>&nbsp;<span class="op" id="6063739">:=</span>&nbsp;<span class="op" id="6063742">(</span><span class="ident" id="6063743">d</span><span class="op" id="6063744">.</span><span class="ident" id="6063745">width</span>&nbsp;<span class="op" id="6063751">+</span>&nbsp;<span class="num" id="6063753">8</span><span class="op" id="6063754">*</span><span class="ident" id="6063755">h0</span>&nbsp;<span class="op" id="6063758">-</span>&nbsp;<span class="num" id="6063760">1</span><span class="op" id="6063761">)</span>&nbsp;<span class="op" id="6063763">/</span>&nbsp;<span class="op" id="6063765">(</span><span class="num" id="6063766">8</span>&nbsp;<span class="op" id="6063768">*</span>&nbsp;<span class="ident" id="6063770">h0</span><span class="op" id="6063772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063775">myy</span>&nbsp;<span class="op" id="6063779">:=</span>&nbsp;<span class="op" id="6063782">(</span><span class="ident" id="6063783">d</span><span class="op" id="6063784">.</span><span class="ident" id="6063785">height</span>&nbsp;<span class="op" id="6063792">+</span>&nbsp;<span class="num" id="6063794">8</span><span class="op" id="6063795">*</span><span class="ident" id="6063796">v0</span>&nbsp;<span class="op" id="6063799">-</span>&nbsp;<span class="num" id="6063801">1</span><span class="op" id="6063802">)</span>&nbsp;<span class="op" id="6063804">/</span>&nbsp;<span class="op" id="6063806">(</span><span class="num" id="6063807">8</span>&nbsp;<span class="op" id="6063809">*</span>&nbsp;<span class="ident" id="6063811">v0</span><span class="op" id="6063813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063816">if</span>&nbsp;<span class="ident" id="6063819">d</span><span class="op" id="6063820">.</span><span class="ident" id="6063821">img1</span>&nbsp;<span class="op" id="6063826">==</span>&nbsp;<span class="ident" id="6063829">nil</span>&nbsp;<span class="op" id="6063833">&amp;&amp;</span>&nbsp;<span class="ident" id="6063836">d</span><span class="op" id="6063837">.</span><span class="ident" id="6063838">img3</span>&nbsp;<span class="op" id="6063843">==</span>&nbsp;<span class="ident" id="6063846">nil</span>&nbsp;<span class="op" id="6063850">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063854">d</span><span class="op" id="6063855">.</span><span class="ident" id="6063856">makeImg</span><span class="op" id="6063863">(</span><span class="ident" id="6063864">h0</span><span class="op" id="6063866">,</span>&nbsp;<span class="ident" id="6063868">v0</span><span class="op" id="6063870">,</span>&nbsp;<span class="ident" id="6063872">mxx</span><span class="op" id="6063875">,</span>&nbsp;<span class="ident" id="6063877">myy</span><span class="op" id="6063880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063886">if</span>&nbsp;<span class="ident" id="6063889">d</span><span class="op" id="6063890">.</span><span class="ident" id="6063891">progressive</span>&nbsp;<span class="op" id="6063903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063907">for</span>&nbsp;<span class="ident" id="6063911">i</span>&nbsp;<span class="op" id="6063913">:=</span>&nbsp;<span class="num" id="6063916">0</span><span class="op" id="6063917">;</span>&nbsp;<span class="ident" id="6063919">i</span>&nbsp;<span class="op" id="6063921">&lt;</span>&nbsp;<span class="ident" id="6063923">nComp</span><span class="op" id="6063928">;</span>&nbsp;<span class="ident" id="6063930">i</span><span class="op" id="6063931">++</span>&nbsp;<span class="op" id="6063934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063939">compIndex</span>&nbsp;<span class="op" id="6063949">:=</span>&nbsp;<span class="ident" id="6063952">scan</span><span class="op" id="6063956">[</span><span class="ident" id="6063957">i</span><span class="op" id="6063958">]</span><span class="op" id="6063959">.</span><span class="ident" id="6063960">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063973">if</span>&nbsp;<span class="ident" id="6063976">d</span><span class="op" id="6063977">.</span><span class="ident" id="6063978">progCoeffs</span><span class="op" id="6063988">[</span><span class="ident" id="6063989">compIndex</span><span class="op" id="6063998">]</span>&nbsp;<span class="op" id="6064000">==</span>&nbsp;<span class="ident" id="6064003">nil</span>&nbsp;<span class="op" id="6064007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064013">d</span><span class="op" id="6064014">.</span><span class="ident" id="6064015">progCoeffs</span><span class="op" id="6064025">[</span><span class="ident" id="6064026">compIndex</span><span class="op" id="6064035">]</span>&nbsp;<span class="op" id="6064037">=</span>&nbsp;<span class="builtinfunc" id="6064039">make</span><span class="op" id="6064043">(</span><span class="op" id="6064044">[</span><span class="op" id="6064045">]</span><span class="ident" id="6064046">block</span><span class="op" id="6064051">,</span>&nbsp;<span class="ident" id="6064053">mxx</span><span class="op" id="6064056">*</span><span class="ident" id="6064057">myy</span><span class="op" id="6064060">*</span><span class="ident" id="6064061">d</span><span class="op" id="6064062">.</span><span class="ident" id="6064063">comp</span><span class="op" id="6064067">[</span><span class="ident" id="6064068">compIndex</span><span class="op" id="6064077">]</span><span class="op" id="6064078">.</span><span class="ident" id="6064079">h</span><span class="op" id="6064080">*</span><span class="ident" id="6064081">d</span><span class="op" id="6064082">.</span><span class="ident" id="6064083">comp</span><span class="op" id="6064087">[</span><span class="ident" id="6064088">compIndex</span><span class="op" id="6064097">]</span><span class="op" id="6064098">.</span><span class="ident" id="6064099">v</span><span class="op" id="6064100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064112">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064116">d</span><span class="op" id="6064117">.</span><span class="ident" id="6064118">bits</span>&nbsp;<span class="op" id="6064123">=</span>&nbsp;<span class="ident" id="6064125">bits</span><span class="op" id="6064129">{</span><span class="op" id="6064130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064133">mcu</span><span class="op" id="6064136">,</span>&nbsp;<span class="ident" id="6064138">expectedRST</span>&nbsp;<span class="op" id="6064150">:=</span>&nbsp;<span class="num" id="6064153">0</span><span class="op" id="6064154">,</span>&nbsp;<span class="builtintype" id="6064156">uint8</span><span class="op" id="6064161">(</span><span class="ident" id="6064162">rst0Marker</span><span class="op" id="6064172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064175">var</span>&nbsp;<span class="op" id="6064179">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064183">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064251">b</span>&nbsp;&nbsp;<span class="ident" id="6064254">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064262">dc</span>&nbsp;<span class="op" id="6064265">[</span><span class="ident" id="6064266">nColorComponent</span><span class="op" id="6064281">]</span><span class="builtintype" id="6064282">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064290">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064363">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064437">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064510">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064580">bx</span><span class="op" id="6064582">,</span>&nbsp;<span class="ident" id="6064584">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6064591">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064597">blockCount</span>&nbsp;<span class="builtintype" id="6064608">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6064613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064616">for</span>&nbsp;<span class="ident" id="6064620">my</span>&nbsp;<span class="op" id="6064623">:=</span>&nbsp;<span class="num" id="6064626">0</span><span class="op" id="6064627">;</span>&nbsp;<span class="ident" id="6064629">my</span>&nbsp;<span class="op" id="6064632">&lt;</span>&nbsp;<span class="ident" id="6064634">myy</span><span class="op" id="6064637">;</span>&nbsp;<span class="ident" id="6064639">my</span><span class="op" id="6064641">++</span>&nbsp;<span class="op" id="6064644">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064648">for</span>&nbsp;<span class="ident" id="6064652">mx</span>&nbsp;<span class="op" id="6064655">:=</span>&nbsp;<span class="num" id="6064658">0</span><span class="op" id="6064659">;</span>&nbsp;<span class="ident" id="6064661">mx</span>&nbsp;<span class="op" id="6064664">&lt;</span>&nbsp;<span class="ident" id="6064666">mxx</span><span class="op" id="6064669">;</span>&nbsp;<span class="ident" id="6064671">mx</span><span class="op" id="6064673">++</span>&nbsp;<span class="op" id="6064676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064681">for</span>&nbsp;<span class="ident" id="6064685">i</span>&nbsp;<span class="op" id="6064687">:=</span>&nbsp;<span class="num" id="6064690">0</span><span class="op" id="6064691">;</span>&nbsp;<span class="ident" id="6064693">i</span>&nbsp;<span class="op" id="6064695">&lt;</span>&nbsp;<span class="ident" id="6064697">nComp</span><span class="op" id="6064702">;</span>&nbsp;<span class="ident" id="6064704">i</span><span class="op" id="6064705">++</span>&nbsp;<span class="op" id="6064708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064714">compIndex</span>&nbsp;<span class="op" id="6064724">:=</span>&nbsp;<span class="ident" id="6064727">scan</span><span class="op" id="6064731">[</span><span class="ident" id="6064732">i</span><span class="op" id="6064733">]</span><span class="op" id="6064734">.</span><span class="ident" id="6064735">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064749">qt</span>&nbsp;<span class="op" id="6064752">:=</span>&nbsp;<span class="op" id="6064755">&amp;</span><span class="ident" id="6064756">d</span><span class="op" id="6064757">.</span><span class="ident" id="6064758">quant</span><span class="op" id="6064763">[</span><span class="ident" id="6064764">d</span><span class="op" id="6064765">.</span><span class="ident" id="6064766">comp</span><span class="op" id="6064770">[</span><span class="ident" id="6064771">compIndex</span><span class="op" id="6064780">]</span><span class="op" id="6064781">.</span><span class="ident" id="6064782">tq</span><span class="op" id="6064784">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6064790">for</span>&nbsp;<span class="ident" id="6064794">j</span>&nbsp;<span class="op" id="6064796">:=</span>&nbsp;<span class="num" id="6064799">0</span><span class="op" id="6064800">;</span>&nbsp;<span class="ident" id="6064802">j</span>&nbsp;<span class="op" id="6064804">&lt;</span>&nbsp;<span class="ident" id="6064806">d</span><span class="op" id="6064807">.</span><span class="ident" id="6064808">comp</span><span class="op" id="6064812">[</span><span class="ident" id="6064813">compIndex</span><span class="op" id="6064822">]</span><span class="op" id="6064823">.</span><span class="ident" id="6064824">h</span><span class="op" id="6064825">*</span><span class="ident" id="6064826">d</span><span class="op" id="6064827">.</span><span class="ident" id="6064828">comp</span><span class="op" id="6064832">[</span><span class="ident" id="6064833">compIndex</span><span class="op" id="6064842">]</span><span class="op" id="6064843">.</span><span class="ident" id="6064844">v</span><span class="op" id="6064845">;</span>&nbsp;<span class="ident" id="6064847">j</span><span class="op" id="6064848">++</span>&nbsp;<span class="op" id="6064851">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064858">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064927">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6064996">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065004">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065078">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065094">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065110">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065118">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065195">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065272">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065305">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065321">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065337">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065414">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065442">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065450">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065528">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065603">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065682">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065758">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065791">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065807">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065823">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065887">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6065901">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065915">if</span>&nbsp;<span class="ident" id="6065918">nComp</span>&nbsp;<span class="op" id="6065924">!=</span>&nbsp;<span class="num" id="6065927">1</span>&nbsp;<span class="op" id="6065929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065937">bx</span><span class="op" id="6065939">,</span>&nbsp;<span class="ident" id="6065941">by</span>&nbsp;<span class="op" id="6065944">=</span>&nbsp;<span class="ident" id="6065946">d</span><span class="op" id="6065947">.</span><span class="ident" id="6065948">comp</span><span class="op" id="6065952">[</span><span class="ident" id="6065953">compIndex</span><span class="op" id="6065962">]</span><span class="op" id="6065963">.</span><span class="ident" id="6065964">h</span><span class="op" id="6065965">*</span><span class="ident" id="6065966">mx</span><span class="op" id="6065968">,</span>&nbsp;<span class="ident" id="6065970">d</span><span class="op" id="6065971">.</span><span class="ident" id="6065972">comp</span><span class="op" id="6065976">[</span><span class="ident" id="6065977">compIndex</span><span class="op" id="6065986">]</span><span class="op" id="6065987">.</span><span class="ident" id="6065988">v</span><span class="op" id="6065989">*</span><span class="ident" id="6065990">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065999">if</span>&nbsp;<span class="ident" id="6066002">h0</span>&nbsp;<span class="op" id="6066005">==</span>&nbsp;<span class="num" id="6066008">1</span>&nbsp;<span class="op" id="6066010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066019">by</span>&nbsp;<span class="op" id="6066022">+=</span>&nbsp;<span class="ident" id="6066025">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066033">}</span>&nbsp;<span class="keyword" id="6066035">else</span>&nbsp;<span class="op" id="6066040">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066049">bx</span>&nbsp;<span class="op" id="6066052">+=</span>&nbsp;<span class="ident" id="6066055">j</span>&nbsp;<span class="op" id="6066057">%</span>&nbsp;<span class="num" id="6066059">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066068">by</span>&nbsp;<span class="op" id="6066071">+=</span>&nbsp;<span class="ident" id="6066074">j</span>&nbsp;<span class="op" id="6066076">/</span>&nbsp;<span class="num" id="6066078">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066093">}</span>&nbsp;<span class="keyword" id="6066095">else</span>&nbsp;<span class="op" id="6066100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066108">q</span>&nbsp;<span class="op" id="6066110">:=</span>&nbsp;<span class="ident" id="6066113">mxx</span>&nbsp;<span class="op" id="6066117">*</span>&nbsp;<span class="ident" id="6066119">d</span><span class="op" id="6066120">.</span><span class="ident" id="6066121">comp</span><span class="op" id="6066125">[</span><span class="ident" id="6066126">compIndex</span><span class="op" id="6066135">]</span><span class="op" id="6066136">.</span><span class="ident" id="6066137">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066145">bx</span>&nbsp;<span class="op" id="6066148">=</span>&nbsp;<span class="ident" id="6066150">blockCount</span>&nbsp;<span class="op" id="6066161">%</span>&nbsp;<span class="ident" id="6066163">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066171">by</span>&nbsp;<span class="op" id="6066174">=</span>&nbsp;<span class="ident" id="6066176">blockCount</span>&nbsp;<span class="op" id="6066187">/</span>&nbsp;<span class="ident" id="6066189">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066197">blockCount</span><span class="op" id="6066207">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066216">if</span>&nbsp;<span class="ident" id="6066219">bx</span><span class="op" id="6066221">*</span><span class="num" id="6066222">8</span>&nbsp;<span class="op" id="6066224">&gt;=</span>&nbsp;<span class="ident" id="6066227">d</span><span class="op" id="6066228">.</span><span class="ident" id="6066229">width</span>&nbsp;<span class="op" id="6066235">||</span>&nbsp;<span class="ident" id="6066238">by</span><span class="op" id="6066240">*</span><span class="num" id="6066241">8</span>&nbsp;<span class="op" id="6066243">&gt;=</span>&nbsp;<span class="ident" id="6066246">d</span><span class="op" id="6066247">.</span><span class="ident" id="6066248">height</span>&nbsp;<span class="op" id="6066255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066264">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066294">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066367">if</span>&nbsp;<span class="ident" id="6066370">d</span><span class="op" id="6066371">.</span><span class="ident" id="6066372">progressive</span>&nbsp;<span class="op" id="6066384">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066392">b</span>&nbsp;<span class="op" id="6066394">=</span>&nbsp;<span class="ident" id="6066396">d</span><span class="op" id="6066397">.</span><span class="ident" id="6066398">progCoeffs</span><span class="op" id="6066408">[</span><span class="ident" id="6066409">compIndex</span><span class="op" id="6066418">]</span><span class="op" id="6066419">[</span><span class="ident" id="6066420">by</span><span class="op" id="6066422">*</span><span class="ident" id="6066423">mxx</span><span class="op" id="6066426">*</span><span class="ident" id="6066427">d</span><span class="op" id="6066428">.</span><span class="ident" id="6066429">comp</span><span class="op" id="6066433">[</span><span class="ident" id="6066434">compIndex</span><span class="op" id="6066443">]</span><span class="op" id="6066444">.</span><span class="ident" id="6066445">h</span><span class="op" id="6066446">+</span><span class="ident" id="6066447">bx</span><span class="op" id="6066449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066456">}</span>&nbsp;<span class="keyword" id="6066458">else</span>&nbsp;<span class="op" id="6066463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066471">b</span>&nbsp;<span class="op" id="6066473">=</span>&nbsp;<span class="ident" id="6066475">block</span><span class="op" id="6066480">{</span><span class="op" id="6066481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066496">if</span>&nbsp;<span class="ident" id="6066499">ah</span>&nbsp;<span class="op" id="6066502">!=</span>&nbsp;<span class="num" id="6066505">0</span>&nbsp;<span class="op" id="6066507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066515">if</span>&nbsp;<span class="ident" id="6066518">err</span>&nbsp;<span class="op" id="6066522">:=</span>&nbsp;<span class="ident" id="6066525">d</span><span class="op" id="6066526">.</span><span class="ident" id="6066527">refine</span><span class="op" id="6066533">(</span><span class="op" id="6066534">&amp;</span><span class="ident" id="6066535">b</span><span class="op" id="6066536">,</span>&nbsp;<span class="op" id="6066538">&amp;</span><span class="ident" id="6066539">d</span><span class="op" id="6066540">.</span><span class="ident" id="6066541">huff</span><span class="op" id="6066545">[</span><span class="ident" id="6066546">acTable</span><span class="op" id="6066553">]</span><span class="op" id="6066554">[</span><span class="ident" id="6066555">scan</span><span class="op" id="6066559">[</span><span class="ident" id="6066560">i</span><span class="op" id="6066561">]</span><span class="op" id="6066562">.</span><span class="ident" id="6066563">ta</span><span class="op" id="6066565">]</span><span class="op" id="6066566">,</span>&nbsp;<span class="ident" id="6066568">zigStart</span><span class="op" id="6066576">,</span>&nbsp;<span class="ident" id="6066578">zigEnd</span><span class="op" id="6066584">,</span>&nbsp;<span class="num" id="6066586">1</span><span class="op" id="6066587">&lt;&lt;</span><span class="ident" id="6066589">al</span><span class="op" id="6066591">)</span><span class="op" id="6066592">;</span>&nbsp;<span class="ident" id="6066594">err</span>&nbsp;<span class="op" id="6066598">!=</span>&nbsp;<span class="ident" id="6066601">nil</span>&nbsp;<span class="op" id="6066605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066614">return</span>&nbsp;<span class="ident" id="6066621">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066638">}</span>&nbsp;<span class="keyword" id="6066640">else</span>&nbsp;<span class="op" id="6066645">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066653">zig</span>&nbsp;<span class="op" id="6066657">:=</span>&nbsp;<span class="ident" id="6066660">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066675">if</span>&nbsp;<span class="ident" id="6066678">zig</span>&nbsp;<span class="op" id="6066682">==</span>&nbsp;<span class="num" id="6066685">0</span>&nbsp;<span class="op" id="6066687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066696">zig</span><span class="op" id="6066699">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6066709">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066779">value</span><span class="op" id="6066784">,</span>&nbsp;<span class="ident" id="6066786">err</span>&nbsp;<span class="op" id="6066790">:=</span>&nbsp;<span class="ident" id="6066793">d</span><span class="op" id="6066794">.</span><span class="ident" id="6066795">decodeHuffman</span><span class="op" id="6066808">(</span><span class="op" id="6066809">&amp;</span><span class="ident" id="6066810">d</span><span class="op" id="6066811">.</span><span class="ident" id="6066812">huff</span><span class="op" id="6066816">[</span><span class="ident" id="6066817">dcTable</span><span class="op" id="6066824">]</span><span class="op" id="6066825">[</span><span class="ident" id="6066826">scan</span><span class="op" id="6066830">[</span><span class="ident" id="6066831">i</span><span class="op" id="6066832">]</span><span class="op" id="6066833">.</span><span class="ident" id="6066834">td</span><span class="op" id="6066836">]</span><span class="op" id="6066837">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066846">if</span>&nbsp;<span class="ident" id="6066849">err</span>&nbsp;<span class="op" id="6066853">!=</span>&nbsp;<span class="ident" id="6066856">nil</span>&nbsp;<span class="op" id="6066860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066870">return</span>&nbsp;<span class="ident" id="6066877">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066897">if</span>&nbsp;<span class="ident" id="6066900">value</span>&nbsp;<span class="op" id="6066906">&gt;</span>&nbsp;<span class="num" id="6066908">16</span>&nbsp;<span class="op" id="6066911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066921">return</span>&nbsp;<span class="ident" id="6066928">UnsupportedError</span><span class="op" id="6066944">(</span><span class="string" id="6066945">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="6066969">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066987">dcDelta</span><span class="op" id="6066994">,</span>&nbsp;<span class="ident" id="6066996">err</span>&nbsp;<span class="op" id="6067000">:=</span>&nbsp;<span class="ident" id="6067003">d</span><span class="op" id="6067004">.</span><span class="ident" id="6067005">receiveExtend</span><span class="op" id="6067018">(</span><span class="ident" id="6067019">value</span><span class="op" id="6067024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067033">if</span>&nbsp;<span class="ident" id="6067036">err</span>&nbsp;<span class="op" id="6067040">!=</span>&nbsp;<span class="ident" id="6067043">nil</span>&nbsp;<span class="op" id="6067047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067057">return</span>&nbsp;<span class="ident" id="6067064">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067075">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067084">dc</span><span class="op" id="6067086">[</span><span class="ident" id="6067087">compIndex</span><span class="op" id="6067096">]</span>&nbsp;<span class="op" id="6067098">+=</span>&nbsp;<span class="ident" id="6067101">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067116">b</span><span class="op" id="6067117">[</span><span class="num" id="6067118">0</span><span class="op" id="6067119">]</span>&nbsp;<span class="op" id="6067121">=</span>&nbsp;<span class="ident" id="6067123">dc</span><span class="op" id="6067125">[</span><span class="ident" id="6067126">compIndex</span><span class="op" id="6067135">]</span>&nbsp;<span class="op" id="6067137">&lt;&lt;</span>&nbsp;<span class="ident" id="6067140">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067158">if</span>&nbsp;<span class="ident" id="6067161">zig</span>&nbsp;<span class="op" id="6067165">&lt;=</span>&nbsp;<span class="ident" id="6067168">zigEnd</span>&nbsp;<span class="op" id="6067175">&amp;&amp;</span>&nbsp;<span class="ident" id="6067178">d</span><span class="op" id="6067179">.</span><span class="ident" id="6067180">eobRun</span>&nbsp;<span class="op" id="6067187">&gt;</span>&nbsp;<span class="num" id="6067189">0</span>&nbsp;<span class="op" id="6067191">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067200">d</span><span class="op" id="6067201">.</span><span class="ident" id="6067202">eobRun</span><span class="op" id="6067208">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067217">}</span>&nbsp;<span class="keyword" id="6067219">else</span>&nbsp;<span class="op" id="6067224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6067233">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067304">huff</span>&nbsp;<span class="op" id="6067309">:=</span>&nbsp;<span class="op" id="6067312">&amp;</span><span class="ident" id="6067313">d</span><span class="op" id="6067314">.</span><span class="ident" id="6067315">huff</span><span class="op" id="6067319">[</span><span class="ident" id="6067320">acTable</span><span class="op" id="6067327">]</span><span class="op" id="6067328">[</span><span class="ident" id="6067329">scan</span><span class="op" id="6067333">[</span><span class="ident" id="6067334">i</span><span class="op" id="6067335">]</span><span class="op" id="6067336">.</span><span class="ident" id="6067337">ta</span><span class="op" id="6067339">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067348">for</span>&nbsp;<span class="op" id="6067352">;</span>&nbsp;<span class="ident" id="6067354">zig</span>&nbsp;<span class="op" id="6067358">&lt;=</span>&nbsp;<span class="ident" id="6067361">zigEnd</span><span class="op" id="6067367">;</span>&nbsp;<span class="ident" id="6067369">zig</span><span class="op" id="6067372">++</span>&nbsp;<span class="op" id="6067375">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067385">value</span><span class="op" id="6067390">,</span>&nbsp;<span class="ident" id="6067392">err</span>&nbsp;<span class="op" id="6067396">:=</span>&nbsp;<span class="ident" id="6067399">d</span><span class="op" id="6067400">.</span><span class="ident" id="6067401">decodeHuffman</span><span class="op" id="6067414">(</span><span class="ident" id="6067415">huff</span><span class="op" id="6067419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067429">if</span>&nbsp;<span class="ident" id="6067432">err</span>&nbsp;<span class="op" id="6067436">!=</span>&nbsp;<span class="ident" id="6067439">nil</span>&nbsp;<span class="op" id="6067443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067454">return</span>&nbsp;<span class="ident" id="6067461">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067483">val0</span>&nbsp;<span class="op" id="6067488">:=</span>&nbsp;<span class="ident" id="6067491">value</span>&nbsp;<span class="op" id="6067497">&gt;&gt;</span>&nbsp;<span class="num" id="6067500">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067510">val1</span>&nbsp;<span class="op" id="6067515">:=</span>&nbsp;<span class="ident" id="6067518">value</span>&nbsp;<span class="op" id="6067524">&amp;</span>&nbsp;<span class="num" id="6067526">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067539">if</span>&nbsp;<span class="ident" id="6067542">val1</span>&nbsp;<span class="op" id="6067547">!=</span>&nbsp;<span class="num" id="6067550">0</span>&nbsp;<span class="op" id="6067552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067563">zig</span>&nbsp;<span class="op" id="6067567">+=</span>&nbsp;<span class="builtintype" id="6067570">int32</span><span class="op" id="6067575">(</span><span class="ident" id="6067576">val0</span><span class="op" id="6067580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067591">if</span>&nbsp;<span class="ident" id="6067594">zig</span>&nbsp;<span class="op" id="6067598">&gt;</span>&nbsp;<span class="ident" id="6067600">zigEnd</span>&nbsp;<span class="op" id="6067607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067619">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067645">ac</span><span class="op" id="6067647">,</span>&nbsp;<span class="ident" id="6067649">err</span>&nbsp;<span class="op" id="6067653">:=</span>&nbsp;<span class="ident" id="6067656">d</span><span class="op" id="6067657">.</span><span class="ident" id="6067658">receiveExtend</span><span class="op" id="6067671">(</span><span class="ident" id="6067672">val1</span><span class="op" id="6067676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067687">if</span>&nbsp;<span class="ident" id="6067690">err</span>&nbsp;<span class="op" id="6067694">!=</span>&nbsp;<span class="ident" id="6067697">nil</span>&nbsp;<span class="op" id="6067701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067713">return</span>&nbsp;<span class="ident" id="6067720">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067733">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067744">b</span><span class="op" id="6067745">[</span><span class="ident" id="6067746">unzig</span><span class="op" id="6067751">[</span><span class="ident" id="6067752">zig</span><span class="op" id="6067755">]</span><span class="op" id="6067756">]</span>&nbsp;<span class="op" id="6067758">=</span>&nbsp;<span class="ident" id="6067760">ac</span>&nbsp;<span class="op" id="6067763">&lt;&lt;</span>&nbsp;<span class="ident" id="6067766">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067777">}</span>&nbsp;<span class="keyword" id="6067779">else</span>&nbsp;<span class="op" id="6067784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067795">if</span>&nbsp;<span class="ident" id="6067798">val0</span>&nbsp;<span class="op" id="6067803">!=</span>&nbsp;<span class="num" id="6067806">0x0f</span>&nbsp;<span class="op" id="6067811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067823">d</span><span class="op" id="6067824">.</span><span class="ident" id="6067825">eobRun</span>&nbsp;<span class="op" id="6067832">=</span>&nbsp;<span class="builtintype" id="6067834">uint16</span><span class="op" id="6067840">(</span><span class="num" id="6067841">1</span>&nbsp;<span class="op" id="6067843">&lt;&lt;</span>&nbsp;<span class="ident" id="6067846">val0</span><span class="op" id="6067850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067862">if</span>&nbsp;<span class="ident" id="6067865">val0</span>&nbsp;<span class="op" id="6067870">!=</span>&nbsp;<span class="num" id="6067873">0</span>&nbsp;<span class="op" id="6067875">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6067888">bits</span><span class="op" id="6067892">,</span>&nbsp;<span class="ident" id="6067894">err</span>&nbsp;<span class="op" id="6067898">:=</span>&nbsp;<span class="ident" id="6067901">d</span><span class="op" id="6067902">.</span><span class="ident" id="6067903">decodeBits</span><span class="op" id="6067913">(</span><span class="builtintype" id="6067914">int32</span><span class="op" id="6067919">(</span><span class="ident" id="6067920">val0</span><span class="op" id="6067924">)</span><span class="op" id="6067925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067938">if</span>&nbsp;<span class="ident" id="6067941">err</span>&nbsp;<span class="op" id="6067945">!=</span>&nbsp;<span class="ident" id="6067948">nil</span>&nbsp;<span class="op" id="6067952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6067966">return</span>&nbsp;<span class="ident" id="6067973">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6067988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068001">d</span><span class="op" id="6068002">.</span><span class="ident" id="6068003">eobRun</span>&nbsp;<span class="op" id="6068010">|=</span>&nbsp;<span class="builtintype" id="6068013">uint16</span><span class="op" id="6068019">(</span><span class="ident" id="6068020">bits</span><span class="op" id="6068024">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068048">d</span><span class="op" id="6068049">.</span><span class="ident" id="6068050">eobRun</span><span class="op" id="6068056">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068069">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068095">zig</span>&nbsp;<span class="op" id="6068099">+=</span>&nbsp;<span class="num" id="6068102">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068147">if</span>&nbsp;<span class="ident" id="6068150">d</span><span class="op" id="6068151">.</span><span class="ident" id="6068152">progressive</span>&nbsp;<span class="op" id="6068164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068172">if</span>&nbsp;<span class="ident" id="6068175">zigEnd</span>&nbsp;<span class="op" id="6068182">!=</span>&nbsp;<span class="ident" id="6068185">blockSize</span><span class="op" id="6068194">-</span><span class="num" id="6068195">1</span>&nbsp;<span class="op" id="6068197">||</span>&nbsp;<span class="ident" id="6068200">al</span>&nbsp;<span class="op" id="6068203">!=</span>&nbsp;<span class="num" id="6068206">0</span>&nbsp;<span class="op" id="6068208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068217">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068296">d</span><span class="op" id="6068297">.</span><span class="ident" id="6068298">progCoeffs</span><span class="op" id="6068308">[</span><span class="ident" id="6068309">compIndex</span><span class="op" id="6068318">]</span><span class="op" id="6068319">[</span><span class="ident" id="6068320">by</span><span class="op" id="6068322">*</span><span class="ident" id="6068323">mxx</span><span class="op" id="6068326">*</span><span class="ident" id="6068327">d</span><span class="op" id="6068328">.</span><span class="ident" id="6068329">comp</span><span class="op" id="6068333">[</span><span class="ident" id="6068334">compIndex</span><span class="op" id="6068343">]</span><span class="op" id="6068344">.</span><span class="ident" id="6068345">h</span><span class="op" id="6068346">+</span><span class="ident" id="6068347">bx</span><span class="op" id="6068349">]</span>&nbsp;<span class="op" id="6068351">=</span>&nbsp;<span class="ident" id="6068353">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068362">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068448">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068534">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068619">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068705">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068766">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068788">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6068796">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6068874">for</span>&nbsp;<span class="ident" id="6068878">zig</span>&nbsp;<span class="op" id="6068882">:=</span>&nbsp;<span class="num" id="6068885">0</span><span class="op" id="6068886">;</span>&nbsp;<span class="ident" id="6068888">zig</span>&nbsp;<span class="op" id="6068892">&lt;</span>&nbsp;<span class="ident" id="6068894">blockSize</span><span class="op" id="6068903">;</span>&nbsp;<span class="ident" id="6068905">zig</span><span class="op" id="6068908">++</span>&nbsp;<span class="op" id="6068911">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068919">b</span><span class="op" id="6068920">[</span><span class="ident" id="6068921">unzig</span><span class="op" id="6068926">[</span><span class="ident" id="6068927">zig</span><span class="op" id="6068930">]</span><span class="op" id="6068931">]</span>&nbsp;<span class="op" id="6068933">*=</span>&nbsp;<span class="ident" id="6068936">qt</span><span class="op" id="6068938">[</span><span class="ident" id="6068939">zig</span><span class="op" id="6068942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6068949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068956">idct</span><span class="op" id="6068960">(</span><span class="op" id="6068961">&amp;</span><span class="ident" id="6068962">b</span><span class="op" id="6068963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6068970">dst</span><span class="op" id="6068973">,</span>&nbsp;<span class="ident" id="6068975">stride</span>&nbsp;<span class="op" id="6068982">:=</span>&nbsp;<span class="op" id="6068985">[</span><span class="op" id="6068986">]</span><span class="builtintype" id="6068987">byte</span><span class="op" id="6068991">(</span><span class="ident" id="6068992">nil</span><span class="op" id="6068995">)</span><span class="op" id="6068996">,</span>&nbsp;<span class="num" id="6068998">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069005">if</span>&nbsp;<span class="ident" id="6069008">d</span><span class="op" id="6069009">.</span><span class="ident" id="6069010">nComp</span>&nbsp;<span class="op" id="6069016">==</span>&nbsp;<span class="ident" id="6069019">nGrayComponent</span>&nbsp;<span class="op" id="6069034">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069042">dst</span><span class="op" id="6069045">,</span>&nbsp;<span class="ident" id="6069047">stride</span>&nbsp;<span class="op" id="6069054">=</span>&nbsp;<span class="ident" id="6069056">d</span><span class="op" id="6069057">.</span><span class="ident" id="6069058">img1</span><span class="op" id="6069062">.</span><span class="ident" id="6069063">Pix</span><span class="op" id="6069066">[</span><span class="num" id="6069067">8</span><span class="op" id="6069068">*</span><span class="op" id="6069069">(</span><span class="ident" id="6069070">by</span><span class="op" id="6069072">*</span><span class="ident" id="6069073">d</span><span class="op" id="6069074">.</span><span class="ident" id="6069075">img1</span><span class="op" id="6069079">.</span><span class="ident" id="6069080">Stride</span><span class="op" id="6069086">+</span><span class="ident" id="6069087">bx</span><span class="op" id="6069089">)</span><span class="op" id="6069090">:</span><span class="op" id="6069091">]</span><span class="op" id="6069092">,</span>&nbsp;<span class="ident" id="6069094">d</span><span class="op" id="6069095">.</span><span class="ident" id="6069096">img1</span><span class="op" id="6069100">.</span><span class="ident" id="6069101">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069113">}</span>&nbsp;<span class="keyword" id="6069115">else</span>&nbsp;<span class="op" id="6069120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069128">switch</span>&nbsp;<span class="ident" id="6069135">compIndex</span>&nbsp;<span class="op" id="6069145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069153">case</span>&nbsp;<span class="num" id="6069158">0</span><span class="op" id="6069159">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069168">dst</span><span class="op" id="6069171">,</span>&nbsp;<span class="ident" id="6069173">stride</span>&nbsp;<span class="op" id="6069180">=</span>&nbsp;<span class="ident" id="6069182">d</span><span class="op" id="6069183">.</span><span class="ident" id="6069184">img3</span><span class="op" id="6069188">.</span><span class="ident" id="6069189">Y</span><span class="op" id="6069190">[</span><span class="num" id="6069191">8</span><span class="op" id="6069192">*</span><span class="op" id="6069193">(</span><span class="ident" id="6069194">by</span><span class="op" id="6069196">*</span><span class="ident" id="6069197">d</span><span class="op" id="6069198">.</span><span class="ident" id="6069199">img3</span><span class="op" id="6069203">.</span><span class="ident" id="6069204">YStride</span><span class="op" id="6069211">+</span><span class="ident" id="6069212">bx</span><span class="op" id="6069214">)</span><span class="op" id="6069215">:</span><span class="op" id="6069216">]</span><span class="op" id="6069217">,</span>&nbsp;<span class="ident" id="6069219">d</span><span class="op" id="6069220">.</span><span class="ident" id="6069221">img3</span><span class="op" id="6069225">.</span><span class="ident" id="6069226">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069240">case</span>&nbsp;<span class="num" id="6069245">1</span><span class="op" id="6069246">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069255">dst</span><span class="op" id="6069258">,</span>&nbsp;<span class="ident" id="6069260">stride</span>&nbsp;<span class="op" id="6069267">=</span>&nbsp;<span class="ident" id="6069269">d</span><span class="op" id="6069270">.</span><span class="ident" id="6069271">img3</span><span class="op" id="6069275">.</span><span class="ident" id="6069276">Cb</span><span class="op" id="6069278">[</span><span class="num" id="6069279">8</span><span class="op" id="6069280">*</span><span class="op" id="6069281">(</span><span class="ident" id="6069282">by</span><span class="op" id="6069284">*</span><span class="ident" id="6069285">d</span><span class="op" id="6069286">.</span><span class="ident" id="6069287">img3</span><span class="op" id="6069291">.</span><span class="ident" id="6069292">CStride</span><span class="op" id="6069299">+</span><span class="ident" id="6069300">bx</span><span class="op" id="6069302">)</span><span class="op" id="6069303">:</span><span class="op" id="6069304">]</span><span class="op" id="6069305">,</span>&nbsp;<span class="ident" id="6069307">d</span><span class="op" id="6069308">.</span><span class="ident" id="6069309">img3</span><span class="op" id="6069313">.</span><span class="ident" id="6069314">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069328">case</span>&nbsp;<span class="num" id="6069333">2</span><span class="op" id="6069334">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069343">dst</span><span class="op" id="6069346">,</span>&nbsp;<span class="ident" id="6069348">stride</span>&nbsp;<span class="op" id="6069355">=</span>&nbsp;<span class="ident" id="6069357">d</span><span class="op" id="6069358">.</span><span class="ident" id="6069359">img3</span><span class="op" id="6069363">.</span><span class="ident" id="6069364">Cr</span><span class="op" id="6069366">[</span><span class="num" id="6069367">8</span><span class="op" id="6069368">*</span><span class="op" id="6069369">(</span><span class="ident" id="6069370">by</span><span class="op" id="6069372">*</span><span class="ident" id="6069373">d</span><span class="op" id="6069374">.</span><span class="ident" id="6069375">img3</span><span class="op" id="6069379">.</span><span class="ident" id="6069380">CStride</span><span class="op" id="6069387">+</span><span class="ident" id="6069388">bx</span><span class="op" id="6069390">)</span><span class="op" id="6069391">:</span><span class="op" id="6069392">]</span><span class="op" id="6069393">,</span>&nbsp;<span class="ident" id="6069395">d</span><span class="op" id="6069396">.</span><span class="ident" id="6069397">img3</span><span class="op" id="6069401">.</span><span class="ident" id="6069402">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069416">default</span><span class="op" id="6069423">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069432">return</span>&nbsp;<span class="ident" id="6069439">UnsupportedError</span><span class="op" id="6069455">(</span><span class="string" id="6069456">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="6069477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069499">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069564">for</span>&nbsp;<span class="ident" id="6069568">y</span>&nbsp;<span class="op" id="6069570">:=</span>&nbsp;<span class="num" id="6069573">0</span><span class="op" id="6069574">;</span>&nbsp;<span class="ident" id="6069576">y</span>&nbsp;<span class="op" id="6069578">&lt;</span>&nbsp;<span class="num" id="6069580">8</span><span class="op" id="6069581">;</span>&nbsp;<span class="ident" id="6069583">y</span><span class="op" id="6069584">++</span>&nbsp;<span class="op" id="6069587">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069595">y8</span>&nbsp;<span class="op" id="6069598">:=</span>&nbsp;<span class="ident" id="6069601">y</span>&nbsp;<span class="op" id="6069603">*</span>&nbsp;<span class="num" id="6069605">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069613">yStride</span>&nbsp;<span class="op" id="6069621">:=</span>&nbsp;<span class="ident" id="6069624">y</span>&nbsp;<span class="op" id="6069626">*</span>&nbsp;<span class="ident" id="6069628">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069641">for</span>&nbsp;<span class="ident" id="6069645">x</span>&nbsp;<span class="op" id="6069647">:=</span>&nbsp;<span class="num" id="6069650">0</span><span class="op" id="6069651">;</span>&nbsp;<span class="ident" id="6069653">x</span>&nbsp;<span class="op" id="6069655">&lt;</span>&nbsp;<span class="num" id="6069657">8</span><span class="op" id="6069658">;</span>&nbsp;<span class="ident" id="6069660">x</span><span class="op" id="6069661">++</span>&nbsp;<span class="op" id="6069664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069673">c</span>&nbsp;<span class="op" id="6069675">:=</span>&nbsp;<span class="ident" id="6069678">b</span><span class="op" id="6069679">[</span><span class="ident" id="6069680">y8</span><span class="op" id="6069682">+</span><span class="ident" id="6069683">x</span><span class="op" id="6069684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069693">if</span>&nbsp;<span class="ident" id="6069696">c</span>&nbsp;<span class="op" id="6069698">&lt;</span>&nbsp;<span class="op" id="6069700">-</span><span class="num" id="6069701">128</span>&nbsp;<span class="op" id="6069705">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069715">c</span>&nbsp;<span class="op" id="6069717">=</span>&nbsp;<span class="num" id="6069719">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069728">}</span>&nbsp;<span class="keyword" id="6069730">else</span>&nbsp;<span class="keyword" id="6069735">if</span>&nbsp;<span class="ident" id="6069738">c</span>&nbsp;<span class="op" id="6069740">&gt;</span>&nbsp;<span class="num" id="6069742">127</span>&nbsp;<span class="op" id="6069746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069756">c</span>&nbsp;<span class="op" id="6069758">=</span>&nbsp;<span class="num" id="6069760">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069771">}</span>&nbsp;<span class="keyword" id="6069773">else</span>&nbsp;<span class="op" id="6069778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069788">c</span>&nbsp;<span class="op" id="6069790">+=</span>&nbsp;<span class="num" id="6069793">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069813">dst</span><span class="op" id="6069816">[</span><span class="ident" id="6069817">yStride</span><span class="op" id="6069824">+</span><span class="ident" id="6069825">x</span><span class="op" id="6069826">]</span>&nbsp;<span class="op" id="6069828">=</span>&nbsp;<span class="builtintype" id="6069830">uint8</span><span class="op" id="6069835">(</span><span class="ident" id="6069836">c</span><span class="op" id="6069837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069858">}</span>&nbsp;<span class="comment" id="6069860">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6069872">}</span>&nbsp;<span class="comment" id="6069874">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6069886">mcu</span><span class="op" id="6069889">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6069895">if</span>&nbsp;<span class="ident" id="6069898">d</span><span class="op" id="6069899">.</span><span class="ident" id="6069900">ri</span>&nbsp;<span class="op" id="6069903">&gt;</span>&nbsp;<span class="num" id="6069905">0</span>&nbsp;<span class="op" id="6069907">&amp;&amp;</span>&nbsp;<span class="ident" id="6069910">mcu</span><span class="op" id="6069913">%</span><span class="ident" id="6069914">d</span><span class="op" id="6069915">.</span><span class="ident" id="6069916">ri</span>&nbsp;<span class="op" id="6069919">==</span>&nbsp;<span class="num" id="6069922">0</span>&nbsp;<span class="op" id="6069924">&amp;&amp;</span>&nbsp;<span class="ident" id="6069927">mcu</span>&nbsp;<span class="op" id="6069931">&lt;</span>&nbsp;<span class="ident" id="6069933">mxx</span><span class="op" id="6069936">*</span><span class="ident" id="6069937">myy</span>&nbsp;<span class="op" id="6069941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6069947">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070047">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070144">if</span>&nbsp;<span class="ident" id="6070147">err</span>&nbsp;<span class="op" id="6070151">:=</span>&nbsp;<span class="ident" id="6070154">d</span><span class="op" id="6070155">.</span><span class="ident" id="6070156">readFull</span><span class="op" id="6070164">(</span><span class="ident" id="6070165">d</span><span class="op" id="6070166">.</span><span class="ident" id="6070167">tmp</span><span class="op" id="6070170">[</span><span class="op" id="6070171">:</span><span class="num" id="6070172">2</span><span class="op" id="6070173">]</span><span class="op" id="6070174">)</span><span class="op" id="6070175">;</span>&nbsp;<span class="ident" id="6070177">err</span>&nbsp;<span class="op" id="6070181">!=</span>&nbsp;<span class="ident" id="6070184">nil</span>&nbsp;<span class="op" id="6070188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070195">return</span>&nbsp;<span class="ident" id="6070202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070216">if</span>&nbsp;<span class="ident" id="6070219">d</span><span class="op" id="6070220">.</span><span class="ident" id="6070221">tmp</span><span class="op" id="6070224">[</span><span class="num" id="6070225">0</span><span class="op" id="6070226">]</span>&nbsp;<span class="op" id="6070228">!=</span>&nbsp;<span class="num" id="6070231">0xff</span>&nbsp;<span class="op" id="6070236">||</span>&nbsp;<span class="ident" id="6070239">d</span><span class="op" id="6070240">.</span><span class="ident" id="6070241">tmp</span><span class="op" id="6070244">[</span><span class="num" id="6070245">1</span><span class="op" id="6070246">]</span>&nbsp;<span class="op" id="6070248">!=</span>&nbsp;<span class="ident" id="6070251">expectedRST</span>&nbsp;<span class="op" id="6070263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070270">return</span>&nbsp;<span class="ident" id="6070277">FormatError</span><span class="op" id="6070288">(</span><span class="string" id="6070289">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="6070305">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070317">expectedRST</span><span class="op" id="6070328">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070335">if</span>&nbsp;<span class="ident" id="6070338">expectedRST</span>&nbsp;<span class="op" id="6070350">==</span>&nbsp;<span class="ident" id="6070353">rst7Marker</span><span class="op" id="6070363">+</span><span class="num" id="6070364">1</span>&nbsp;<span class="op" id="6070366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070373">expectedRST</span>&nbsp;<span class="op" id="6070385">=</span>&nbsp;<span class="ident" id="6070387">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070402">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070408">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070442">d</span><span class="op" id="6070443">.</span><span class="ident" id="6070444">bits</span>&nbsp;<span class="op" id="6070449">=</span>&nbsp;<span class="ident" id="6070451">bits</span><span class="op" id="6070455">{</span><span class="op" id="6070456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070462">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070520">dc</span>&nbsp;<span class="op" id="6070523">=</span>&nbsp;<span class="op" id="6070525">[</span><span class="ident" id="6070526">nColorComponent</span><span class="op" id="6070541">]</span><span class="builtintype" id="6070542">int32</span><span class="op" id="6070547">{</span><span class="op" id="6070548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070554">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070622">d</span><span class="op" id="6070623">.</span><span class="ident" id="6070624">eobRun</span>&nbsp;<span class="op" id="6070631">=</span>&nbsp;<span class="num" id="6070633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070642">}</span>&nbsp;<span class="comment" id="6070644">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070655">}</span>&nbsp;<span class="comment" id="6070657">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070669">return</span>&nbsp;<span class="ident" id="6070676">nil</span><br>
<span class="lineno"></span><span class="op" id="6070680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6070683">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6070762">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="6070780">func</span>&nbsp;<span class="op" id="6070785">(</span><span class="ident" id="6070786">d</span>&nbsp;<span class="op" id="6070788">*</span><span class="ident" id="6070789">decoder</span><span class="op" id="6070796">)</span>&nbsp;<span class="ident" id="6070798">refine</span><span class="op" id="6070804">(</span><span class="ident" id="6070805">b</span>&nbsp;<span class="op" id="6070807">*</span><span class="ident" id="6070808">block</span><span class="op" id="6070813">,</span>&nbsp;<span class="ident" id="6070815">h</span>&nbsp;<span class="op" id="6070817">*</span><span class="ident" id="6070818">huffman</span><span class="op" id="6070825">,</span>&nbsp;<span class="ident" id="6070827">zigStart</span><span class="op" id="6070835">,</span>&nbsp;<span class="ident" id="6070837">zigEnd</span><span class="op" id="6070843">,</span>&nbsp;<span class="ident" id="6070845">delta</span>&nbsp;<span class="builtintype" id="6070851">int32</span><span class="op" id="6070856">)</span>&nbsp;<span class="builtintype" id="6070858">error</span>&nbsp;<span class="op" id="6070864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6070867">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070907">if</span>&nbsp;<span class="ident" id="6070910">zigStart</span>&nbsp;<span class="op" id="6070919">==</span>&nbsp;<span class="num" id="6070922">0</span>&nbsp;<span class="op" id="6070924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6070928">if</span>&nbsp;<span class="ident" id="6070931">zigEnd</span>&nbsp;<span class="op" id="6070938">!=</span>&nbsp;<span class="num" id="6070941">0</span>&nbsp;<span class="op" id="6070943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6070948">panic</span><span class="op" id="6070953">(</span><span class="string" id="6070954">&#34;unreachable&#34;</span><span class="op" id="6070967">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6070971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6070975">bit</span><span class="op" id="6070978">,</span>&nbsp;<span class="ident" id="6070980">err</span>&nbsp;<span class="op" id="6070984">:=</span>&nbsp;<span class="ident" id="6070987">d</span><span class="op" id="6070988">.</span><span class="ident" id="6070989">decodeBit</span><span class="op" id="6070998">(</span><span class="op" id="6070999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071003">if</span>&nbsp;<span class="ident" id="6071006">err</span>&nbsp;<span class="op" id="6071010">!=</span>&nbsp;<span class="ident" id="6071013">nil</span>&nbsp;<span class="op" id="6071017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071022">return</span>&nbsp;<span class="ident" id="6071029">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071035">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071039">if</span>&nbsp;<span class="ident" id="6071042">bit</span>&nbsp;<span class="op" id="6071046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071051">b</span><span class="op" id="6071052">[</span><span class="num" id="6071053">0</span><span class="op" id="6071054">]</span>&nbsp;<span class="op" id="6071056">|=</span>&nbsp;<span class="ident" id="6071059">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071071">return</span>&nbsp;<span class="ident" id="6071078">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071083">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6071087">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071169">zig</span>&nbsp;<span class="op" id="6071173">:=</span>&nbsp;<span class="ident" id="6071176">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071186">if</span>&nbsp;<span class="ident" id="6071189">d</span><span class="op" id="6071190">.</span><span class="ident" id="6071191">eobRun</span>&nbsp;<span class="op" id="6071198">==</span>&nbsp;<span class="num" id="6071201">0</span>&nbsp;<span class="op" id="6071203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071206">loop</span><span class="op" id="6071210">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071214">for</span>&nbsp;<span class="op" id="6071218">;</span>&nbsp;<span class="ident" id="6071220">zig</span>&nbsp;<span class="op" id="6071224">&lt;=</span>&nbsp;<span class="ident" id="6071227">zigEnd</span><span class="op" id="6071233">;</span>&nbsp;<span class="ident" id="6071235">zig</span><span class="op" id="6071238">++</span>&nbsp;<span class="op" id="6071241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071246">z</span>&nbsp;<span class="op" id="6071248">:=</span>&nbsp;<span class="builtintype" id="6071251">int32</span><span class="op" id="6071256">(</span><span class="num" id="6071257">0</span><span class="op" id="6071258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071263">value</span><span class="op" id="6071268">,</span>&nbsp;<span class="ident" id="6071270">err</span>&nbsp;<span class="op" id="6071274">:=</span>&nbsp;<span class="ident" id="6071277">d</span><span class="op" id="6071278">.</span><span class="ident" id="6071279">decodeHuffman</span><span class="op" id="6071292">(</span><span class="ident" id="6071293">h</span><span class="op" id="6071294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071299">if</span>&nbsp;<span class="ident" id="6071302">err</span>&nbsp;<span class="op" id="6071306">!=</span>&nbsp;<span class="ident" id="6071309">nil</span>&nbsp;<span class="op" id="6071313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071319">return</span>&nbsp;<span class="ident" id="6071326">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071338">val0</span>&nbsp;<span class="op" id="6071343">:=</span>&nbsp;<span class="ident" id="6071346">value</span>&nbsp;<span class="op" id="6071352">&gt;&gt;</span>&nbsp;<span class="num" id="6071355">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071360">val1</span>&nbsp;<span class="op" id="6071365">:=</span>&nbsp;<span class="ident" id="6071368">value</span>&nbsp;<span class="op" id="6071374">&amp;</span>&nbsp;<span class="num" id="6071376">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071385">switch</span>&nbsp;<span class="ident" id="6071392">val1</span>&nbsp;<span class="op" id="6071397">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071402">case</span>&nbsp;<span class="num" id="6071407">0</span><span class="op" id="6071408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071414">if</span>&nbsp;<span class="ident" id="6071417">val0</span>&nbsp;<span class="op" id="6071422">!=</span>&nbsp;<span class="num" id="6071425">0x0f</span>&nbsp;<span class="op" id="6071430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071437">d</span><span class="op" id="6071438">.</span><span class="ident" id="6071439">eobRun</span>&nbsp;<span class="op" id="6071446">=</span>&nbsp;<span class="builtintype" id="6071448">uint16</span><span class="op" id="6071454">(</span><span class="num" id="6071455">1</span>&nbsp;<span class="op" id="6071457">&lt;&lt;</span>&nbsp;<span class="ident" id="6071460">val0</span><span class="op" id="6071464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071471">if</span>&nbsp;<span class="ident" id="6071474">val0</span>&nbsp;<span class="op" id="6071479">!=</span>&nbsp;<span class="num" id="6071482">0</span>&nbsp;<span class="op" id="6071484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071492">bits</span><span class="op" id="6071496">,</span>&nbsp;<span class="ident" id="6071498">err</span>&nbsp;<span class="op" id="6071502">:=</span>&nbsp;<span class="ident" id="6071505">d</span><span class="op" id="6071506">.</span><span class="ident" id="6071507">decodeBits</span><span class="op" id="6071517">(</span><span class="builtintype" id="6071518">int32</span><span class="op" id="6071523">(</span><span class="ident" id="6071524">val0</span><span class="op" id="6071528">)</span><span class="op" id="6071529">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071537">if</span>&nbsp;<span class="ident" id="6071540">err</span>&nbsp;<span class="op" id="6071544">!=</span>&nbsp;<span class="ident" id="6071547">nil</span>&nbsp;<span class="op" id="6071551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071560">return</span>&nbsp;<span class="ident" id="6071567">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071585">d</span><span class="op" id="6071586">.</span><span class="ident" id="6071587">eobRun</span>&nbsp;<span class="op" id="6071594">|=</span>&nbsp;<span class="builtintype" id="6071597">uint16</span><span class="op" id="6071603">(</span><span class="ident" id="6071604">bits</span><span class="op" id="6071608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071615">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071622">break</span>&nbsp;<span class="ident" id="6071628">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071642">case</span>&nbsp;<span class="num" id="6071647">1</span><span class="op" id="6071648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071654">z</span>&nbsp;<span class="op" id="6071656">=</span>&nbsp;<span class="ident" id="6071658">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071668">bit</span><span class="op" id="6071671">,</span>&nbsp;<span class="ident" id="6071673">err</span>&nbsp;<span class="op" id="6071677">:=</span>&nbsp;<span class="ident" id="6071680">d</span><span class="op" id="6071681">.</span><span class="ident" id="6071682">decodeBit</span><span class="op" id="6071691">(</span><span class="op" id="6071692">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071698">if</span>&nbsp;<span class="ident" id="6071701">err</span>&nbsp;<span class="op" id="6071705">!=</span>&nbsp;<span class="ident" id="6071708">nil</span>&nbsp;<span class="op" id="6071712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071719">return</span>&nbsp;<span class="ident" id="6071726">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071740">if</span>&nbsp;<span class="op" id="6071743">!</span><span class="ident" id="6071744">bit</span>&nbsp;<span class="op" id="6071748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071755">z</span>&nbsp;<span class="op" id="6071757">=</span>&nbsp;<span class="op" id="6071759">-</span><span class="ident" id="6071760">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071771">default</span><span class="op" id="6071778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071784">return</span>&nbsp;<span class="ident" id="6071791">FormatError</span><span class="op" id="6071802">(</span><span class="string" id="6071803">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="6071828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6071839">zig</span><span class="op" id="6071842">,</span>&nbsp;<span class="ident" id="6071844">err</span>&nbsp;<span class="op" id="6071848">=</span>&nbsp;<span class="ident" id="6071850">d</span><span class="op" id="6071851">.</span><span class="ident" id="6071852">refineNonZeroes</span><span class="op" id="6071867">(</span><span class="ident" id="6071868">b</span><span class="op" id="6071869">,</span>&nbsp;<span class="ident" id="6071871">zig</span><span class="op" id="6071874">,</span>&nbsp;<span class="ident" id="6071876">zigEnd</span><span class="op" id="6071882">,</span>&nbsp;<span class="builtintype" id="6071884">int32</span><span class="op" id="6071889">(</span><span class="ident" id="6071890">val0</span><span class="op" id="6071894">)</span><span class="op" id="6071895">,</span>&nbsp;<span class="ident" id="6071897">delta</span><span class="op" id="6071902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071907">if</span>&nbsp;<span class="ident" id="6071910">err</span>&nbsp;<span class="op" id="6071914">!=</span>&nbsp;<span class="ident" id="6071917">nil</span>&nbsp;<span class="op" id="6071921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071927">return</span>&nbsp;<span class="ident" id="6071934">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6071941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071946">if</span>&nbsp;<span class="ident" id="6071949">zig</span>&nbsp;<span class="op" id="6071953">&gt;</span>&nbsp;<span class="ident" id="6071955">zigEnd</span>&nbsp;<span class="op" id="6071962">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6071968">return</span>&nbsp;<span class="ident" id="6071975">FormatError</span><span class="op" id="6071986">(</span><span class="string" id="6071987">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="6072010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072020">if</span>&nbsp;<span class="ident" id="6072023">z</span>&nbsp;<span class="op" id="6072025">!=</span>&nbsp;<span class="num" id="6072028">0</span>&nbsp;<span class="op" id="6072030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072036">b</span><span class="op" id="6072037">[</span><span class="ident" id="6072038">unzig</span><span class="op" id="6072043">[</span><span class="ident" id="6072044">zig</span><span class="op" id="6072047">]</span><span class="op" id="6072048">]</span>&nbsp;<span class="op" id="6072050">=</span>&nbsp;<span class="ident" id="6072052">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072057">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072067">if</span>&nbsp;<span class="ident" id="6072070">d</span><span class="op" id="6072071">.</span><span class="ident" id="6072072">eobRun</span>&nbsp;<span class="op" id="6072079">&gt;</span>&nbsp;<span class="num" id="6072081">0</span>&nbsp;<span class="op" id="6072083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072087">d</span><span class="op" id="6072088">.</span><span class="ident" id="6072089">eobRun</span><span class="op" id="6072095">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072100">if</span>&nbsp;<span class="ident" id="6072103">_</span><span class="op" id="6072104">,</span>&nbsp;<span class="ident" id="6072106">err</span>&nbsp;<span class="op" id="6072110">:=</span>&nbsp;<span class="ident" id="6072113">d</span><span class="op" id="6072114">.</span><span class="ident" id="6072115">refineNonZeroes</span><span class="op" id="6072130">(</span><span class="ident" id="6072131">b</span><span class="op" id="6072132">,</span>&nbsp;<span class="ident" id="6072134">zig</span><span class="op" id="6072137">,</span>&nbsp;<span class="ident" id="6072139">zigEnd</span><span class="op" id="6072145">,</span>&nbsp;<span class="op" id="6072147">-</span><span class="num" id="6072148">1</span><span class="op" id="6072149">,</span>&nbsp;<span class="ident" id="6072151">delta</span><span class="op" id="6072156">)</span><span class="op" id="6072157">;</span>&nbsp;<span class="ident" id="6072159">err</span>&nbsp;<span class="op" id="6072163">!=</span>&nbsp;<span class="ident" id="6072166">nil</span>&nbsp;<span class="op" id="6072170">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072175">return</span>&nbsp;<span class="ident" id="6072182">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072194">return</span>&nbsp;<span class="ident" id="6072201">nil</span><br>
<span class="lineno"></span><span class="op" id="6072205">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="6072208">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="6072287">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="6072334">func</span>&nbsp;<span class="op" id="6072339">(</span><span class="ident" id="6072340">d</span>&nbsp;<span class="op" id="6072342">*</span><span class="ident" id="6072343">decoder</span><span class="op" id="6072350">)</span>&nbsp;<span class="ident" id="6072352">refineNonZeroes</span><span class="op" id="6072367">(</span><span class="ident" id="6072368">b</span>&nbsp;<span class="op" id="6072370">*</span><span class="ident" id="6072371">block</span><span class="op" id="6072376">,</span>&nbsp;<span class="ident" id="6072378">zig</span><span class="op" id="6072381">,</span>&nbsp;<span class="ident" id="6072383">zigEnd</span><span class="op" id="6072389">,</span>&nbsp;<span class="ident" id="6072391">nz</span><span class="op" id="6072393">,</span>&nbsp;<span class="ident" id="6072395">delta</span>&nbsp;<span class="builtintype" id="6072401">int32</span><span class="op" id="6072406">)</span>&nbsp;<span class="op" id="6072408">(</span><span class="builtintype" id="6072409">int32</span><span class="op" id="6072414">,</span>&nbsp;<span class="builtintype" id="6072416">error</span><span class="op" id="6072421">)</span>&nbsp;<span class="op" id="6072423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072426">for</span>&nbsp;<span class="op" id="6072430">;</span>&nbsp;<span class="ident" id="6072432">zig</span>&nbsp;<span class="op" id="6072436">&lt;=</span>&nbsp;<span class="ident" id="6072439">zigEnd</span><span class="op" id="6072445">;</span>&nbsp;<span class="ident" id="6072447">zig</span><span class="op" id="6072450">++</span>&nbsp;<span class="op" id="6072453">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072457">u</span>&nbsp;<span class="op" id="6072459">:=</span>&nbsp;<span class="ident" id="6072462">unzig</span><span class="op" id="6072467">[</span><span class="ident" id="6072468">zig</span><span class="op" id="6072471">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072475">if</span>&nbsp;<span class="ident" id="6072478">b</span><span class="op" id="6072479">[</span><span class="ident" id="6072480">u</span><span class="op" id="6072481">]</span>&nbsp;<span class="op" id="6072483">==</span>&nbsp;<span class="num" id="6072486">0</span>&nbsp;<span class="op" id="6072488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072493">if</span>&nbsp;<span class="ident" id="6072496">nz</span>&nbsp;<span class="op" id="6072499">==</span>&nbsp;<span class="num" id="6072502">0</span>&nbsp;<span class="op" id="6072504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072510">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072519">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072524">nz</span><span class="op" id="6072526">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072532">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072547">bit</span><span class="op" id="6072550">,</span>&nbsp;<span class="ident" id="6072552">err</span>&nbsp;<span class="op" id="6072556">:=</span>&nbsp;<span class="ident" id="6072559">d</span><span class="op" id="6072560">.</span><span class="ident" id="6072561">decodeBit</span><span class="op" id="6072570">(</span><span class="op" id="6072571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072575">if</span>&nbsp;<span class="ident" id="6072578">err</span>&nbsp;<span class="op" id="6072582">!=</span>&nbsp;<span class="ident" id="6072585">nil</span>&nbsp;<span class="op" id="6072589">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072594">return</span>&nbsp;<span class="num" id="6072601">0</span><span class="op" id="6072602">,</span>&nbsp;<span class="ident" id="6072604">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072614">if</span>&nbsp;<span class="op" id="6072617">!</span><span class="ident" id="6072618">bit</span>&nbsp;<span class="op" id="6072622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072627">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072638">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072642">if</span>&nbsp;<span class="ident" id="6072645">b</span><span class="op" id="6072646">[</span><span class="ident" id="6072647">u</span><span class="op" id="6072648">]</span>&nbsp;<span class="op" id="6072650">&gt;=</span>&nbsp;<span class="num" id="6072653">0</span>&nbsp;<span class="op" id="6072655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072660">b</span><span class="op" id="6072661">[</span><span class="ident" id="6072662">u</span><span class="op" id="6072663">]</span>&nbsp;<span class="op" id="6072665">+=</span>&nbsp;<span class="ident" id="6072668">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072676">}</span>&nbsp;<span class="keyword" id="6072678">else</span>&nbsp;<span class="op" id="6072683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6072688">b</span><span class="op" id="6072689">[</span><span class="ident" id="6072690">u</span><span class="op" id="6072691">]</span>&nbsp;<span class="op" id="6072693">-=</span>&nbsp;<span class="ident" id="6072696">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072704">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6072707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6072710">return</span>&nbsp;<span class="ident" id="6072717">zig</span><span class="op" id="6072720">,</span>&nbsp;<span class="ident" id="6072722">nil</span><br>
<span class="lineno"></span><span class="op" id="6072726">}</span>
</div>
</body>
</html>
