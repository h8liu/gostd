<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2381800">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2381856">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2381910">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2381961">//&nbsp;Linux&nbsp;socket&nbsp;filter</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2381985">package</span>&nbsp;<span class="ident" id="2381993">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382002">import</span>&nbsp;<span class="op" id="2382009">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2382012">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2382021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382024">func</span>&nbsp;<span class="ident" id="2382029">LsfStmt</span><span class="op" id="2382036">(</span><span class="ident" id="2382037">code</span><span class="op" id="2382041">,</span>&nbsp;<span class="ident" id="2382043">k</span>&nbsp;<span class="builtintype" id="2382045">int</span><span class="op" id="2382048">)</span>&nbsp;<span class="op" id="2382050">*</span><span class="ident" id="2382051">SockFilter</span>&nbsp;<span class="op" id="2382062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382065">return</span>&nbsp;<span class="op" id="2382072">&amp;</span><span class="ident" id="2382073">SockFilter</span><span class="op" id="2382083">{</span><span class="ident" id="2382084">Code</span><span class="op" id="2382088">:</span>&nbsp;<span class="builtintype" id="2382090">uint16</span><span class="op" id="2382096">(</span><span class="ident" id="2382097">code</span><span class="op" id="2382101">)</span><span class="op" id="2382102">,</span>&nbsp;<span class="ident" id="2382104">K</span><span class="op" id="2382105">:</span>&nbsp;<span class="builtintype" id="2382107">uint32</span><span class="op" id="2382113">(</span><span class="ident" id="2382114">k</span><span class="op" id="2382115">)</span><span class="op" id="2382116">}</span><br>
<span class="lineno">15</span><span class="op" id="2382118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382121">func</span>&nbsp;<span class="ident" id="2382126">LsfJump</span><span class="op" id="2382133">(</span><span class="ident" id="2382134">code</span><span class="op" id="2382138">,</span>&nbsp;<span class="ident" id="2382140">k</span><span class="op" id="2382141">,</span>&nbsp;<span class="ident" id="2382143">jt</span><span class="op" id="2382145">,</span>&nbsp;<span class="ident" id="2382147">jf</span>&nbsp;<span class="builtintype" id="2382150">int</span><span class="op" id="2382153">)</span>&nbsp;<span class="op" id="2382155">*</span><span class="ident" id="2382156">SockFilter</span>&nbsp;<span class="op" id="2382167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382170">return</span>&nbsp;<span class="op" id="2382177">&amp;</span><span class="ident" id="2382178">SockFilter</span><span class="op" id="2382188">{</span><span class="ident" id="2382189">Code</span><span class="op" id="2382193">:</span>&nbsp;<span class="builtintype" id="2382195">uint16</span><span class="op" id="2382201">(</span><span class="ident" id="2382202">code</span><span class="op" id="2382206">)</span><span class="op" id="2382207">,</span>&nbsp;<span class="ident" id="2382209">Jt</span><span class="op" id="2382211">:</span>&nbsp;<span class="builtintype" id="2382213">uint8</span><span class="op" id="2382218">(</span><span class="ident" id="2382219">jt</span><span class="op" id="2382221">)</span><span class="op" id="2382222">,</span>&nbsp;<span class="ident" id="2382224">Jf</span><span class="op" id="2382226">:</span>&nbsp;<span class="builtintype" id="2382228">uint8</span><span class="op" id="2382233">(</span><span class="ident" id="2382234">jf</span><span class="op" id="2382236">)</span><span class="op" id="2382237">,</span>&nbsp;<span class="ident" id="2382239">K</span><span class="op" id="2382240">:</span>&nbsp;<span class="builtintype" id="2382242">uint32</span><span class="op" id="2382248">(</span><span class="ident" id="2382249">k</span><span class="op" id="2382250">)</span><span class="op" id="2382251">}</span><br>
<span class="lineno"></span><span class="op" id="2382253">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2382256">func</span>&nbsp;<span class="ident" id="2382261">LsfSocket</span><span class="op" id="2382270">(</span><span class="ident" id="2382271">ifindex</span><span class="op" id="2382278">,</span>&nbsp;<span class="ident" id="2382280">proto</span>&nbsp;<span class="builtintype" id="2382286">int</span><span class="op" id="2382289">)</span>&nbsp;<span class="op" id="2382291">(</span><span class="builtintype" id="2382292">int</span><span class="op" id="2382295">,</span>&nbsp;<span class="builtintype" id="2382297">error</span><span class="op" id="2382302">)</span>&nbsp;<span class="op" id="2382304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382307">var</span>&nbsp;<span class="ident" id="2382311">lsall</span>&nbsp;<span class="ident" id="2382317">SockaddrLinklayer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382336">s</span><span class="op" id="2382337">,</span>&nbsp;<span class="ident" id="2382339">e</span>&nbsp;<span class="op" id="2382341">:=</span>&nbsp;<span class="ident" id="2382344">Socket</span><span class="op" id="2382350">(</span><span class="ident" id="2382351">AF_PACKET</span><span class="op" id="2382360">,</span>&nbsp;<span class="ident" id="2382362">SOCK_RAW</span><span class="op" id="2382370">,</span>&nbsp;<span class="ident" id="2382372">proto</span><span class="op" id="2382377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382380">if</span>&nbsp;<span class="ident" id="2382383">e</span>&nbsp;<span class="op" id="2382385">!=</span>&nbsp;<span class="ident" id="2382388">nil</span>&nbsp;<span class="op" id="2382392">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382396">return</span>&nbsp;<span class="num" id="2382403">0</span><span class="op" id="2382404">,</span>&nbsp;<span class="ident" id="2382406">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382412">p</span>&nbsp;<span class="op" id="2382414">:=</span>&nbsp;<span class="op" id="2382417">(</span><span class="op" id="2382418">*</span><span class="op" id="2382419">[</span><span class="num" id="2382420">2</span><span class="op" id="2382421">]</span><span class="builtintype" id="2382422">byte</span><span class="op" id="2382426">)</span><span class="op" id="2382427">(</span><span class="ident" id="2382428">unsafe</span><span class="op" id="2382434">.</span><span class="ident" id="2382435">Pointer</span><span class="op" id="2382442">(</span><span class="op" id="2382443">&amp;</span><span class="ident" id="2382444">lsall</span><span class="op" id="2382449">.</span><span class="ident" id="2382450">Protocol</span><span class="op" id="2382458">)</span><span class="op" id="2382459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382462">p</span><span class="op" id="2382463">[</span><span class="num" id="2382464">0</span><span class="op" id="2382465">]</span>&nbsp;<span class="op" id="2382467">=</span>&nbsp;<span class="builtintype" id="2382469">byte</span><span class="op" id="2382473">(</span><span class="ident" id="2382474">proto</span>&nbsp;<span class="op" id="2382480">&gt;&gt;</span>&nbsp;<span class="num" id="2382483">8</span><span class="op" id="2382484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382487">p</span><span class="op" id="2382488">[</span><span class="num" id="2382489">1</span><span class="op" id="2382490">]</span>&nbsp;<span class="op" id="2382492">=</span>&nbsp;<span class="builtintype" id="2382494">byte</span><span class="op" id="2382498">(</span><span class="ident" id="2382499">proto</span><span class="op" id="2382504">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382507">lsall</span><span class="op" id="2382512">.</span><span class="ident" id="2382513">Ifindex</span>&nbsp;<span class="op" id="2382521">=</span>&nbsp;<span class="ident" id="2382523">ifindex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382532">e</span>&nbsp;<span class="op" id="2382534">=</span>&nbsp;<span class="ident" id="2382536">Bind</span><span class="op" id="2382540">(</span><span class="ident" id="2382541">s</span><span class="op" id="2382542">,</span>&nbsp;<span class="op" id="2382544">&amp;</span><span class="ident" id="2382545">lsall</span><span class="op" id="2382550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382553">if</span>&nbsp;<span class="ident" id="2382556">e</span>&nbsp;<span class="op" id="2382558">!=</span>&nbsp;<span class="ident" id="2382561">nil</span>&nbsp;<span class="op" id="2382565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382569">Close</span><span class="op" id="2382574">(</span><span class="ident" id="2382575">s</span><span class="op" id="2382576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382580">return</span>&nbsp;<span class="num" id="2382587">0</span><span class="op" id="2382588">,</span>&nbsp;<span class="ident" id="2382590">e</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382596">return</span>&nbsp;<span class="ident" id="2382603">s</span><span class="op" id="2382604">,</span>&nbsp;<span class="ident" id="2382606">nil</span><br>
<span class="lineno"></span><span class="op" id="2382610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382613">type</span>&nbsp;<span class="ident" id="2382618">iflags</span>&nbsp;<span class="keyword" id="2382625">struct</span>&nbsp;<span class="op" id="2382632">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382635">name</span>&nbsp;&nbsp;<span class="op" id="2382641">[</span><span class="ident" id="2382642">IFNAMSIZ</span><span class="op" id="2382650">]</span><span class="builtintype" id="2382651">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382657">flags</span>&nbsp;<span class="builtintype" id="2382663">uint16</span><br>
<span class="lineno"></span><span class="op" id="2382670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2382673">func</span>&nbsp;<span class="ident" id="2382678">SetLsfPromisc</span><span class="op" id="2382691">(</span><span class="ident" id="2382692">name</span>&nbsp;<span class="builtintype" id="2382697">string</span><span class="op" id="2382703">,</span>&nbsp;<span class="ident" id="2382705">m</span>&nbsp;<span class="builtintype" id="2382707">bool</span><span class="op" id="2382711">)</span>&nbsp;<span class="builtintype" id="2382713">error</span>&nbsp;<span class="op" id="2382719">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382722">s</span><span class="op" id="2382723">,</span>&nbsp;<span class="ident" id="2382725">e</span>&nbsp;<span class="op" id="2382727">:=</span>&nbsp;<span class="ident" id="2382730">Socket</span><span class="op" id="2382736">(</span><span class="ident" id="2382737">AF_INET</span><span class="op" id="2382744">,</span>&nbsp;<span class="ident" id="2382746">SOCK_DGRAM</span><span class="op" id="2382756">,</span>&nbsp;<span class="num" id="2382758">0</span><span class="op" id="2382759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382762">if</span>&nbsp;<span class="ident" id="2382765">e</span>&nbsp;<span class="op" id="2382767">!=</span>&nbsp;<span class="ident" id="2382770">nil</span>&nbsp;<span class="op" id="2382774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382778">return</span>&nbsp;<span class="ident" id="2382785">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382791">defer</span>&nbsp;<span class="ident" id="2382797">Close</span><span class="op" id="2382802">(</span><span class="ident" id="2382803">s</span><span class="op" id="2382804">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382807">var</span>&nbsp;<span class="ident" id="2382811">ifl</span>&nbsp;<span class="ident" id="2382815">iflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2382823">copy</span><span class="op" id="2382827">(</span><span class="ident" id="2382828">ifl</span><span class="op" id="2382831">.</span><span class="ident" id="2382832">name</span><span class="op" id="2382836">[</span><span class="op" id="2382837">:</span><span class="op" id="2382838">]</span><span class="op" id="2382839">,</span>&nbsp;<span class="op" id="2382841">[</span><span class="op" id="2382842">]</span><span class="builtintype" id="2382843">byte</span><span class="op" id="2382847">(</span><span class="ident" id="2382848">name</span><span class="op" id="2382852">)</span><span class="op" id="2382853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382856">_</span><span class="op" id="2382857">,</span>&nbsp;<span class="ident" id="2382859">_</span><span class="op" id="2382860">,</span>&nbsp;<span class="ident" id="2382862">ep</span>&nbsp;<span class="op" id="2382865">:=</span>&nbsp;<span class="ident" id="2382868">Syscall</span><span class="op" id="2382875">(</span><span class="ident" id="2382876">SYS_IOCTL</span><span class="op" id="2382885">,</span>&nbsp;<span class="builtintype" id="2382887">uintptr</span><span class="op" id="2382894">(</span><span class="ident" id="2382895">s</span><span class="op" id="2382896">)</span><span class="op" id="2382897">,</span>&nbsp;<span class="ident" id="2382899">SIOCGIFFLAGS</span><span class="op" id="2382911">,</span>&nbsp;<span class="builtintype" id="2382913">uintptr</span><span class="op" id="2382920">(</span><span class="ident" id="2382921">unsafe</span><span class="op" id="2382927">.</span><span class="ident" id="2382928">Pointer</span><span class="op" id="2382935">(</span><span class="op" id="2382936">&amp;</span><span class="ident" id="2382937">ifl</span><span class="op" id="2382940">)</span><span class="op" id="2382941">)</span><span class="op" id="2382942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382945">if</span>&nbsp;<span class="ident" id="2382948">ep</span>&nbsp;<span class="op" id="2382951">!=</span>&nbsp;<span class="num" id="2382954">0</span>&nbsp;<span class="op" id="2382956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382960">return</span>&nbsp;<span class="ident" id="2382967">Errno</span><span class="op" id="2382972">(</span><span class="ident" id="2382973">ep</span><span class="op" id="2382975">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2382978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2382981">if</span>&nbsp;<span class="ident" id="2382984">m</span>&nbsp;<span class="op" id="2382986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2382990">ifl</span><span class="op" id="2382993">.</span><span class="ident" id="2382994">flags</span>&nbsp;<span class="op" id="2383000">|=</span>&nbsp;<span class="builtintype" id="2383003">uint16</span><span class="op" id="2383009">(</span><span class="ident" id="2383010">IFF_PROMISC</span><span class="op" id="2383021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2383024">}</span>&nbsp;<span class="keyword" id="2383026">else</span>&nbsp;<span class="op" id="2383031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383035">ifl</span><span class="op" id="2383038">.</span><span class="ident" id="2383039">flags</span>&nbsp;<span class="op" id="2383045">&amp;=</span>&nbsp;<span class="op" id="2383048">^</span><span class="builtintype" id="2383049">uint16</span><span class="op" id="2383055">(</span><span class="ident" id="2383056">IFF_PROMISC</span><span class="op" id="2383067">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2383070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383073">_</span><span class="op" id="2383074">,</span>&nbsp;<span class="ident" id="2383076">_</span><span class="op" id="2383077">,</span>&nbsp;<span class="ident" id="2383079">ep</span>&nbsp;<span class="op" id="2383082">=</span>&nbsp;<span class="ident" id="2383084">Syscall</span><span class="op" id="2383091">(</span><span class="ident" id="2383092">SYS_IOCTL</span><span class="op" id="2383101">,</span>&nbsp;<span class="builtintype" id="2383103">uintptr</span><span class="op" id="2383110">(</span><span class="ident" id="2383111">s</span><span class="op" id="2383112">)</span><span class="op" id="2383113">,</span>&nbsp;<span class="ident" id="2383115">SIOCSIFFLAGS</span><span class="op" id="2383127">,</span>&nbsp;<span class="builtintype" id="2383129">uintptr</span><span class="op" id="2383136">(</span><span class="ident" id="2383137">unsafe</span><span class="op" id="2383143">.</span><span class="ident" id="2383144">Pointer</span><span class="op" id="2383151">(</span><span class="op" id="2383152">&amp;</span><span class="ident" id="2383153">ifl</span><span class="op" id="2383156">)</span><span class="op" id="2383157">)</span><span class="op" id="2383158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383161">if</span>&nbsp;<span class="ident" id="2383164">ep</span>&nbsp;<span class="op" id="2383167">!=</span>&nbsp;<span class="num" id="2383170">0</span>&nbsp;<span class="op" id="2383172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383176">return</span>&nbsp;<span class="ident" id="2383183">Errno</span><span class="op" id="2383188">(</span><span class="ident" id="2383189">ep</span><span class="op" id="2383191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2383194">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383197">return</span>&nbsp;<span class="ident" id="2383204">nil</span><br>
<span class="lineno"></span><span class="op" id="2383208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2383211">func</span>&nbsp;<span class="ident" id="2383216">AttachLsf</span><span class="op" id="2383225">(</span><span class="ident" id="2383226">fd</span>&nbsp;<span class="builtintype" id="2383229">int</span><span class="op" id="2383232">,</span>&nbsp;<span class="ident" id="2383234">i</span>&nbsp;<span class="op" id="2383236">[</span><span class="op" id="2383237">]</span><span class="ident" id="2383238">SockFilter</span><span class="op" id="2383248">)</span>&nbsp;<span class="builtintype" id="2383250">error</span>&nbsp;<span class="op" id="2383256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383259">var</span>&nbsp;<span class="ident" id="2383263">p</span>&nbsp;<span class="ident" id="2383265">SockFprog</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383276">p</span><span class="op" id="2383277">.</span><span class="ident" id="2383278">Len</span>&nbsp;<span class="op" id="2383282">=</span>&nbsp;<span class="builtintype" id="2383284">uint16</span><span class="op" id="2383290">(</span><span class="builtinfunc" id="2383291">len</span><span class="op" id="2383294">(</span><span class="ident" id="2383295">i</span><span class="op" id="2383296">)</span><span class="op" id="2383297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2383300">p</span><span class="op" id="2383301">.</span><span class="ident" id="2383302">Filter</span>&nbsp;<span class="op" id="2383309">=</span>&nbsp;<span class="op" id="2383311">(</span><span class="op" id="2383312">*</span><span class="ident" id="2383313">SockFilter</span><span class="op" id="2383323">)</span><span class="op" id="2383324">(</span><span class="ident" id="2383325">unsafe</span><span class="op" id="2383331">.</span><span class="ident" id="2383332">Pointer</span><span class="op" id="2383339">(</span><span class="op" id="2383340">&amp;</span><span class="ident" id="2383341">i</span><span class="op" id="2383342">[</span><span class="num" id="2383343">0</span><span class="op" id="2383344">]</span><span class="op" id="2383345">)</span><span class="op" id="2383346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383349">return</span>&nbsp;<span class="ident" id="2383356">setsockopt</span><span class="op" id="2383366">(</span><span class="ident" id="2383367">fd</span><span class="op" id="2383369">,</span>&nbsp;<span class="ident" id="2383371">SOL_SOCKET</span><span class="op" id="2383381">,</span>&nbsp;<span class="ident" id="2383383">SO_ATTACH_FILTER</span><span class="op" id="2383399">,</span>&nbsp;<span class="ident" id="2383401">unsafe</span><span class="op" id="2383407">.</span><span class="ident" id="2383408">Pointer</span><span class="op" id="2383415">(</span><span class="op" id="2383416">&amp;</span><span class="ident" id="2383417">p</span><span class="op" id="2383418">)</span><span class="op" id="2383419">,</span>&nbsp;<span class="ident" id="2383421">unsafe</span><span class="op" id="2383427">.</span><span class="ident" id="2383428">Sizeof</span><span class="op" id="2383434">(</span><span class="ident" id="2383435">p</span><span class="op" id="2383436">)</span><span class="op" id="2383437">)</span><br>
<span class="lineno"></span><span class="op" id="2383439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="2383442">func</span>&nbsp;<span class="ident" id="2383447">DetachLsf</span><span class="op" id="2383456">(</span><span class="ident" id="2383457">fd</span>&nbsp;<span class="builtintype" id="2383460">int</span><span class="op" id="2383463">)</span>&nbsp;<span class="builtintype" id="2383465">error</span>&nbsp;<span class="op" id="2383471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383474">var</span>&nbsp;<span class="ident" id="2383478">dummy</span>&nbsp;<span class="builtintype" id="2383484">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2383489">return</span>&nbsp;<span class="ident" id="2383496">setsockopt</span><span class="op" id="2383506">(</span><span class="ident" id="2383507">fd</span><span class="op" id="2383509">,</span>&nbsp;<span class="ident" id="2383511">SOL_SOCKET</span><span class="op" id="2383521">,</span>&nbsp;<span class="ident" id="2383523">SO_DETACH_FILTER</span><span class="op" id="2383539">,</span>&nbsp;<span class="ident" id="2383541">unsafe</span><span class="op" id="2383547">.</span><span class="ident" id="2383548">Pointer</span><span class="op" id="2383555">(</span><span class="op" id="2383556">&amp;</span><span class="ident" id="2383557">dummy</span><span class="op" id="2383562">)</span><span class="op" id="2383563">,</span>&nbsp;<span class="ident" id="2383565">unsafe</span><span class="op" id="2383571">.</span><span class="ident" id="2383572">Sizeof</span><span class="op" id="2383578">(</span><span class="ident" id="2383579">dummy</span><span class="op" id="2383584">)</span><span class="op" id="2383585">)</span><br>
<span class="lineno"></span><span class="op" id="2383587">}</span>
</div>
</body>
</html>
