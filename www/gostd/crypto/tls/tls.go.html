<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html" class="current">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4583182">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4583237">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4583291">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4583342">//&nbsp;Package&nbsp;tls&nbsp;partially&nbsp;implements&nbsp;TLS&nbsp;1.2,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;5246.</span><br>
<span class="lineno"></span><span class="keyword" id="4583413">package</span>&nbsp;<span class="ident" id="4583421">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4583426">import</span>&nbsp;<span class="op" id="4583433">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583436">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583446">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583462">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583476">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583491">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583507">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583517">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583530">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583537">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4583548">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4583555">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4583558">//&nbsp;Server&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;server&nbsp;side&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4583609">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4583652">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4583710">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno">25</span><span class="keyword" id="4583739">func</span>&nbsp;<span class="ident" id="4583744">Server</span><span class="op" id="4583750">(</span><span class="ident" id="4583751">conn</span>&nbsp;<span class="ident" id="4583756"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4583759">.</span><span class="ident" id="4583760"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="4583764">,</span>&nbsp;<span class="ident" id="4583766">config</span>&nbsp;<span class="op" id="4583773">*</span><span class="ident" id="4583774"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4583780">)</span>&nbsp;<span class="op" id="4583782">*</span><span class="ident" id="4583783"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span>&nbsp;<span class="op" id="4583788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4583791">return</span>&nbsp;<span class="op" id="4583798">&amp;</span><span class="ident" id="4583799"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4583803">{</span><span class="ident" id="4583804"><a href="/gostd/crypto/tls/conn.go.html#4461931">conn</a></span><span class="op" id="4583808">:</span>&nbsp;<span class="ident" id="4583810"><a href="/gostd/crypto/tls/tls.go.html#4583751">conn</a></span><span class="op" id="4583814">,</span>&nbsp;<span class="ident" id="4583816"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4583822">:</span>&nbsp;<span class="ident" id="4583824"><a href="/gostd/crypto/tls/tls.go.html#4583766">config</a></span><span class="op" id="4583830">}</span><br>
<span class="lineno"></span><span class="op" id="4583832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4583835">//&nbsp;Client&nbsp;returns&nbsp;a&nbsp;new&nbsp;TLS&nbsp;client&nbsp;side&nbsp;connection</span><br>
<span class="lineno">30</span><span class="comment" id="4583886">//&nbsp;using&nbsp;conn&nbsp;as&nbsp;the&nbsp;underlying&nbsp;transport.</span><br>
<span class="lineno"></span><span class="comment" id="4583929">//&nbsp;The&nbsp;config&nbsp;cannot&nbsp;be&nbsp;nil:&nbsp;users&nbsp;must&nbsp;set&nbsp;either&nbsp;ServerName&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4583994">//&nbsp;InsecureSkipVerify&nbsp;in&nbsp;the&nbsp;config.</span><br>
<span class="lineno"></span><span class="keyword" id="4584031">func</span>&nbsp;<span class="ident" id="4584036">Client</span><span class="op" id="4584042">(</span><span class="ident" id="4584043">conn</span>&nbsp;<span class="ident" id="4584048"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4584051">.</span><span class="ident" id="4584052"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="4584056">,</span>&nbsp;<span class="ident" id="4584058">config</span>&nbsp;<span class="op" id="4584065">*</span><span class="ident" id="4584066"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4584072">)</span>&nbsp;<span class="op" id="4584074">*</span><span class="ident" id="4584075"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span>&nbsp;<span class="op" id="4584080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584083">return</span>&nbsp;<span class="op" id="4584090">&amp;</span><span class="ident" id="4584091"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4584095">{</span><span class="ident" id="4584096"><a href="/gostd/crypto/tls/conn.go.html#4461931">conn</a></span><span class="op" id="4584100">:</span>&nbsp;<span class="ident" id="4584102"><a href="/gostd/crypto/tls/tls.go.html#4584043">conn</a></span><span class="op" id="4584106">,</span>&nbsp;<span class="ident" id="4584108"><a href="/gostd/crypto/tls/conn.go.html#4462274">config</a></span><span class="op" id="4584114">:</span>&nbsp;<span class="ident" id="4584116"><a href="/gostd/crypto/tls/tls.go.html#4584058">config</a></span><span class="op" id="4584122">,</span>&nbsp;<span class="ident" id="4584124"><a href="/gostd/crypto/tls/conn.go.html#4461950">isClient</a></span><span class="op" id="4584132">:</span>&nbsp;<span class="builtintype" id="4584134">true</span><span class="op" id="4584138">}</span><br>
<span class="lineno">35</span><span class="op" id="4584140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4584143">//&nbsp;A&nbsp;listener&nbsp;implements&nbsp;a&nbsp;network&nbsp;listener&nbsp;(net.Listener)&nbsp;for&nbsp;TLS&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="4584223">type</span>&nbsp;<span class="ident" id="4584228">listener</span>&nbsp;<span class="keyword" id="4584237">struct</span>&nbsp;<span class="op" id="4584244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584247"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4584250">.</span><span class="ident" id="4584251"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584261">config</span>&nbsp;<span class="op" id="4584268">*</span><span class="ident" id="4584269"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno"></span><span class="op" id="4584276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4584279">//&nbsp;Accept&nbsp;waits&nbsp;for&nbsp;and&nbsp;returns&nbsp;the&nbsp;next&nbsp;incoming&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4584345">//&nbsp;The&nbsp;returned&nbsp;connection&nbsp;c&nbsp;is&nbsp;a&nbsp;*tls.Conn.</span><br>
<span class="lineno">45</span><span class="keyword" id="4584390">func</span>&nbsp;<span class="op" id="4584395">(</span><span class="ident" id="4584396">l</span>&nbsp;<span class="op" id="4584398">*</span><span class="ident" id="4584399"><a href="/gostd/crypto/tls/tls.go.html#4584228">listener</a></span><span class="op" id="4584407">)</span>&nbsp;<span class="ident" id="4584409">Accept</span><span class="op" id="4584415">(</span><span class="op" id="4584416">)</span>&nbsp;<span class="op" id="4584418">(</span><span class="ident" id="4584419">c</span>&nbsp;<span class="ident" id="4584421"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4584424">.</span><span class="ident" id="4584425"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="4584429">,</span>&nbsp;<span class="ident" id="4584431">err</span>&nbsp;<span class="builtintype" id="4584435">error</span><span class="op" id="4584440">)</span>&nbsp;<span class="op" id="4584442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584445"><a href="/gostd/crypto/tls/tls.go.html#4584419">c</a></span><span class="op" id="4584446">,</span>&nbsp;<span class="ident" id="4584448"><a href="/gostd/crypto/tls/tls.go.html#4584431">err</a></span>&nbsp;<span class="op" id="4584452">=</span>&nbsp;<span class="ident" id="4584454"><a href="/gostd/crypto/tls/tls.go.html#4584396">l</a></span><span class="op" id="4584455">.</span><span class="ident" id="4584456"><a href="/gostd/crypto/tls/tls.go.html#4584247">Listener</a></span><span class="op" id="4584464">.</span><span class="ident" id="4584465"><a href="/gostd/net/net.go.html#3340795">Accept</a></span><span class="op" id="4584471">(</span><span class="op" id="4584472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584475">if</span>&nbsp;<span class="ident" id="4584478"><a href="/gostd/crypto/tls/tls.go.html#4584431">err</a></span>&nbsp;<span class="op" id="4584482">!=</span>&nbsp;<span class="builtintype" id="4584485">nil</span>&nbsp;<span class="op" id="4584489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584493">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4584501">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584504"><a href="/gostd/crypto/tls/tls.go.html#4584419">c</a></span>&nbsp;<span class="op" id="4584506">=</span>&nbsp;<span class="ident" id="4584508"><a href="/gostd/crypto/tls/tls.go.html#4583744">Server</a></span><span class="op" id="4584514">(</span><span class="ident" id="4584515"><a href="/gostd/crypto/tls/tls.go.html#4584419">c</a></span><span class="op" id="4584516">,</span>&nbsp;<span class="ident" id="4584518"><a href="/gostd/crypto/tls/tls.go.html#4584396">l</a></span><span class="op" id="4584519">.</span><span class="ident" id="4584520"><a href="/gostd/crypto/tls/tls.go.html#4584261">config</a></span><span class="op" id="4584526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584529">return</span><br>
<span class="lineno"></span><span class="op" id="4584536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4584539">//&nbsp;NewListener&nbsp;creates&nbsp;a&nbsp;Listener&nbsp;which&nbsp;accepts&nbsp;connections&nbsp;from&nbsp;an&nbsp;inner</span><br>
<span class="lineno">55</span><span class="comment" id="4584613">//&nbsp;Listener&nbsp;and&nbsp;wraps&nbsp;each&nbsp;connection&nbsp;with&nbsp;Server.</span><br>
<span class="lineno"></span><span class="comment" id="4584664">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4584722">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4584751">func</span>&nbsp;<span class="ident" id="4584756">NewListener</span><span class="op" id="4584767">(</span><span class="ident" id="4584768">inner</span>&nbsp;<span class="ident" id="4584774"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4584777">.</span><span class="ident" id="4584778"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="4584786">,</span>&nbsp;<span class="ident" id="4584788">config</span>&nbsp;<span class="op" id="4584795">*</span><span class="ident" id="4584796"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4584802">)</span>&nbsp;<span class="ident" id="4584804"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4584807">.</span><span class="ident" id="4584808"><a href="/gostd/net/net.go.html#3340703">Listener</a></span>&nbsp;<span class="op" id="4584817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584820">l</span>&nbsp;<span class="op" id="4584822">:=</span>&nbsp;<span class="builtinfunc" id="4584825">new</span><span class="op" id="4584828">(</span><span class="ident" id="4584829"><a href="/gostd/crypto/tls/tls.go.html#4584228">listener</a></span><span class="op" id="4584837">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584840"><a href="/gostd/crypto/tls/tls.go.html#4584820">l</a></span><span class="op" id="4584841">.</span><span class="ident" id="4584842"><a href="/gostd/crypto/tls/tls.go.html#4584247">Listener</a></span>&nbsp;<span class="op" id="4584851">=</span>&nbsp;<span class="ident" id="4584853"><a href="/gostd/crypto/tls/tls.go.html#4584768">inner</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4584860"><a href="/gostd/crypto/tls/tls.go.html#4584820">l</a></span><span class="op" id="4584861">.</span><span class="ident" id="4584862"><a href="/gostd/crypto/tls/tls.go.html#4584261">config</a></span>&nbsp;<span class="op" id="4584869">=</span>&nbsp;<span class="ident" id="4584871"><a href="/gostd/crypto/tls/tls.go.html#4584788">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4584879">return</span>&nbsp;<span class="ident" id="4584886"><a href="/gostd/crypto/tls/tls.go.html#4584820">l</a></span><br>
<span class="lineno"></span><span class="op" id="4584888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4584891">//&nbsp;Listen&nbsp;creates&nbsp;a&nbsp;TLS&nbsp;listener&nbsp;accepting&nbsp;connections&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4584953">//&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Listen.</span><br>
<span class="lineno"></span><span class="comment" id="4584996">//&nbsp;The&nbsp;configuration&nbsp;config&nbsp;must&nbsp;be&nbsp;non-nil&nbsp;and&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4585054">//&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4585083">func</span>&nbsp;<span class="ident" id="4585088">Listen</span><span class="op" id="4585094">(</span><span class="ident" id="4585095">network</span><span class="op" id="4585102">,</span>&nbsp;<span class="ident" id="4585104">laddr</span>&nbsp;<span class="builtintype" id="4585110">string</span><span class="op" id="4585116">,</span>&nbsp;<span class="ident" id="4585118">config</span>&nbsp;<span class="op" id="4585125">*</span><span class="ident" id="4585126"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4585132">)</span>&nbsp;<span class="op" id="4585134">(</span><span class="ident" id="4585135"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4585138">.</span><span class="ident" id="4585139"><a href="/gostd/net/net.go.html#3340703">Listener</a></span><span class="op" id="4585147">,</span>&nbsp;<span class="builtintype" id="4585149">error</span><span class="op" id="4585154">)</span>&nbsp;<span class="op" id="4585156">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585159">if</span>&nbsp;<span class="ident" id="4585162"><a href="/gostd/crypto/tls/tls.go.html#4585118">config</a></span>&nbsp;<span class="op" id="4585169">==</span>&nbsp;<span class="builtintype" id="4585172">nil</span>&nbsp;<span class="op" id="4585176">||</span>&nbsp;<span class="builtinfunc" id="4585179">len</span><span class="op" id="4585182">(</span><span class="ident" id="4585183"><a href="/gostd/crypto/tls/tls.go.html#4585118">config</a></span><span class="op" id="4585189">.</span><span class="ident" id="4585190"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4585202">)</span>&nbsp;<span class="op" id="4585204">==</span>&nbsp;<span class="num" id="4585207">0</span>&nbsp;<span class="op" id="4585209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585213">return</span>&nbsp;<span class="builtintype" id="4585220">nil</span><span class="op" id="4585223">,</span>&nbsp;<span class="ident" id="4585225"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4585231">.</span><span class="ident" id="4585232"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4585235">(</span><span class="string" id="4585236">&#34;tls.Listen:&nbsp;no&nbsp;certificates&nbsp;in&nbsp;configuration&#34;</span><span class="op" id="4585282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4585285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4585288">l</span><span class="op" id="4585289">,</span>&nbsp;<span class="ident" id="4585291">err</span>&nbsp;<span class="op" id="4585295">:=</span>&nbsp;<span class="ident" id="4585298"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4585301">.</span><span class="ident" id="4585302"><a href="/gostd/net/dial.go.html#3207117">Listen</a></span><span class="op" id="4585308">(</span><span class="ident" id="4585309"><a href="/gostd/crypto/tls/tls.go.html#4585095">network</a></span><span class="op" id="4585316">,</span>&nbsp;<span class="ident" id="4585318"><a href="/gostd/crypto/tls/tls.go.html#4585104">laddr</a></span><span class="op" id="4585323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585326">if</span>&nbsp;<span class="ident" id="4585329"><a href="/gostd/crypto/tls/tls.go.html#4585291">err</a></span>&nbsp;<span class="op" id="4585333">!=</span>&nbsp;<span class="builtintype" id="4585336">nil</span>&nbsp;<span class="op" id="4585340">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585344">return</span>&nbsp;<span class="builtintype" id="4585351">nil</span><span class="op" id="4585354">,</span>&nbsp;<span class="ident" id="4585356"><a href="/gostd/crypto/tls/tls.go.html#4585291">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4585361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4585364">return</span>&nbsp;<span class="ident" id="4585371"><a href="/gostd/crypto/tls/tls.go.html#4584756">NewListener</a></span><span class="op" id="4585382">(</span><span class="ident" id="4585383"><a href="/gostd/crypto/tls/tls.go.html#4585288">l</a></span><span class="op" id="4585384">,</span>&nbsp;<span class="ident" id="4585386"><a href="/gostd/crypto/tls/tls.go.html#4585118">config</a></span><span class="op" id="4585392">)</span><span class="op" id="4585393">,</span>&nbsp;<span class="builtintype" id="4585395">nil</span><br>
<span class="lineno"></span><span class="op" id="4585399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4585402">type</span>&nbsp;<span class="ident" id="4585407">timeoutError</span>&nbsp;<span class="keyword" id="4585420">struct</span><span class="op" id="4585426">{</span><span class="op" id="4585427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4585430">func</span>&nbsp;<span class="op" id="4585435">(</span><span class="ident" id="4585436"><a href="/gostd/crypto/tls/tls.go.html#4585407">timeoutError</a></span><span class="op" id="4585448">)</span>&nbsp;<span class="ident" id="4585450">Error</span><span class="op" id="4585455">(</span><span class="op" id="4585456">)</span>&nbsp;<span class="builtintype" id="4585458">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4585467">{</span>&nbsp;<span class="keyword" id="4585469">return</span>&nbsp;<span class="string" id="4585476">&#34;tls:&nbsp;DialWithDialer&nbsp;timed&nbsp;out&#34;</span>&nbsp;<span class="op" id="4585508">}</span><br>
<span class="lineno"></span><span class="keyword" id="4585510">func</span>&nbsp;<span class="op" id="4585515">(</span><span class="ident" id="4585516"><a href="/gostd/crypto/tls/tls.go.html#4585407">timeoutError</a></span><span class="op" id="4585528">)</span>&nbsp;<span class="ident" id="4585530">Timeout</span><span class="op" id="4585537">(</span><span class="op" id="4585538">)</span>&nbsp;<span class="builtintype" id="4585540">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4585547">{</span>&nbsp;<span class="keyword" id="4585549">return</span>&nbsp;<span class="builtintype" id="4585556">true</span>&nbsp;<span class="op" id="4585561">}</span><br>
<span class="lineno"></span><span class="keyword" id="4585563">func</span>&nbsp;<span class="op" id="4585568">(</span><span class="ident" id="4585569"><a href="/gostd/crypto/tls/tls.go.html#4585407">timeoutError</a></span><span class="op" id="4585581">)</span>&nbsp;<span class="ident" id="4585583">Temporary</span><span class="op" id="4585592">(</span><span class="op" id="4585593">)</span>&nbsp;<span class="builtintype" id="4585595">bool</span>&nbsp;<span class="op" id="4585600">{</span>&nbsp;<span class="keyword" id="4585602">return</span>&nbsp;<span class="builtintype" id="4585609">true</span>&nbsp;<span class="op" id="4585614">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4585617">//&nbsp;DialWithDialer&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;dialer.Dial&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4585695">//&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting&nbsp;TLS&nbsp;connection.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="4585774">//&nbsp;timeout&nbsp;or&nbsp;deadline&nbsp;given&nbsp;in&nbsp;the&nbsp;dialer&nbsp;apply&nbsp;to&nbsp;connection&nbsp;and&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4585845">//&nbsp;handshake&nbsp;as&nbsp;a&nbsp;whole.</span><br>
<span class="lineno">90</span><span class="comment" id="4585870">//</span><br>
<span class="lineno"></span><span class="comment" id="4585873">//&nbsp;DialWithDialer&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="4585948">//&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4586016">func</span>&nbsp;<span class="ident" id="4586021">DialWithDialer</span><span class="op" id="4586035">(</span><span class="ident" id="4586036">dialer</span>&nbsp;<span class="op" id="4586043">*</span><span class="ident" id="4586044"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4586047">.</span><span class="ident" id="4586048"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="4586054">,</span>&nbsp;<span class="ident" id="4586056">network</span><span class="op" id="4586063">,</span>&nbsp;<span class="ident" id="4586065">addr</span>&nbsp;<span class="builtintype" id="4586070">string</span><span class="op" id="4586076">,</span>&nbsp;<span class="ident" id="4586078">config</span>&nbsp;<span class="op" id="4586085">*</span><span class="ident" id="4586086"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4586092">)</span>&nbsp;<span class="op" id="4586094">(</span><span class="op" id="4586095">*</span><span class="ident" id="4586096"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4586100">,</span>&nbsp;<span class="builtintype" id="4586102">error</span><span class="op" id="4586107">)</span>&nbsp;<span class="op" id="4586109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586112">//&nbsp;We&nbsp;want&nbsp;the&nbsp;Timeout&nbsp;and&nbsp;Deadline&nbsp;values&nbsp;from&nbsp;dialer&nbsp;to&nbsp;cover&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586181">//&nbsp;whole&nbsp;process:&nbsp;TCP&nbsp;connection&nbsp;and&nbsp;TLS&nbsp;handshake.&nbsp;This&nbsp;means&nbsp;that&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586253">//&nbsp;also&nbsp;need&nbsp;to&nbsp;start&nbsp;our&nbsp;own&nbsp;timers&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586296">timeout</span>&nbsp;<span class="op" id="4586304">:=</span>&nbsp;<span class="ident" id="4586307"><a href="/gostd/crypto/tls/tls.go.html#4586036">dialer</a></span><span class="op" id="4586313">.</span><span class="ident" id="4586314"><a href="/gostd/net/dial.go.html#3200103">Timeout</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586324">if</span>&nbsp;<span class="op" id="4586327">!</span><span class="ident" id="4586328"><a href="/gostd/crypto/tls/tls.go.html#4586036">dialer</a></span><span class="op" id="4586334">.</span><span class="ident" id="4586335"><a href="/gostd/net/dial.go.html#3200340">Deadline</a></span><span class="op" id="4586343">.</span><span class="ident" id="4586344"><a href="/gostd/time/time.go.html#2728744">IsZero</a></span><span class="op" id="4586350">(</span><span class="op" id="4586351">)</span>&nbsp;<span class="op" id="4586353">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586357">deadlineTimeout</span>&nbsp;<span class="op" id="4586373">:=</span>&nbsp;<span class="ident" id="4586376"><a href="/gostd/crypto/tls/tls.go.html#4586036">dialer</a></span><span class="op" id="4586382">.</span><span class="ident" id="4586383"><a href="/gostd/net/dial.go.html#3200340">Deadline</a></span><span class="op" id="4586391">.</span><span class="ident" id="4586392"><a href="/gostd/time/time.go.html#2739063">Sub</a></span><span class="op" id="4586395">(</span><span class="ident" id="4586396"><a href="/gostd/crypto/tls/tls.go.html#4583548">time</a></span><span class="op" id="4586400">.</span><span class="ident" id="4586401"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="4586404">(</span><span class="op" id="4586405">)</span><span class="op" id="4586406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586410">if</span>&nbsp;<span class="ident" id="4586413"><a href="/gostd/crypto/tls/tls.go.html#4586296">timeout</a></span>&nbsp;<span class="op" id="4586421">==</span>&nbsp;<span class="num" id="4586424">0</span>&nbsp;<span class="op" id="4586426">||</span>&nbsp;<span class="ident" id="4586429"><a href="/gostd/crypto/tls/tls.go.html#4586357">deadlineTimeout</a></span>&nbsp;<span class="op" id="4586445">&lt;</span>&nbsp;<span class="ident" id="4586447"><a href="/gostd/crypto/tls/tls.go.html#4586296">timeout</a></span>&nbsp;<span class="op" id="4586455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586460"><a href="/gostd/crypto/tls/tls.go.html#4586296">timeout</a></span>&nbsp;<span class="op" id="4586468">=</span>&nbsp;<span class="ident" id="4586470"><a href="/gostd/crypto/tls/tls.go.html#4586357">deadlineTimeout</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586491">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586495">var</span>&nbsp;<span class="ident" id="4586499">errChannel</span>&nbsp;<span class="keyword" id="4586510">chan</span>&nbsp;<span class="builtintype" id="4586515">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586523">if</span>&nbsp;<span class="ident" id="4586526"><a href="/gostd/crypto/tls/tls.go.html#4586296">timeout</a></span>&nbsp;<span class="op" id="4586534">!=</span>&nbsp;<span class="num" id="4586537">0</span>&nbsp;<span class="op" id="4586539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586543"><a href="/gostd/crypto/tls/tls.go.html#4586499">errChannel</a></span>&nbsp;<span class="op" id="4586554">=</span>&nbsp;<span class="builtinfunc" id="4586556">make</span><span class="op" id="4586560">(</span><span class="keyword" id="4586561">chan</span>&nbsp;<span class="builtintype" id="4586566">error</span><span class="op" id="4586571">,</span>&nbsp;<span class="num" id="4586573">2</span><span class="op" id="4586574">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586578"><a href="/gostd/crypto/tls/tls.go.html#4583548">time</a></span><span class="op" id="4586582">.</span><span class="ident" id="4586583"><a href="/gostd/time/sleep.go.html#2716875">AfterFunc</a></span><span class="op" id="4586592">(</span><span class="ident" id="4586593"><a href="/gostd/crypto/tls/tls.go.html#4586296">timeout</a></span><span class="op" id="4586600">,</span>&nbsp;<span class="keyword" id="4586602">func</span><span class="op" id="4586606">(</span><span class="op" id="4586607">)</span>&nbsp;<span class="op" id="4586609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586614"><a href="/gostd/crypto/tls/tls.go.html#4586499">errChannel</a></span>&nbsp;<span class="op" id="4586625">&lt;-</span>&nbsp;<span class="ident" id="4586628"><a href="/gostd/crypto/tls/tls.go.html#4585407">timeoutError</a></span><span class="op" id="4586640">{</span><span class="op" id="4586641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586645">}</span><span class="op" id="4586646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586653">rawConn</span><span class="op" id="4586660">,</span>&nbsp;<span class="ident" id="4586662">err</span>&nbsp;<span class="op" id="4586666">:=</span>&nbsp;<span class="ident" id="4586669"><a href="/gostd/crypto/tls/tls.go.html#4586036">dialer</a></span><span class="op" id="4586675">.</span><span class="ident" id="4586676"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="4586680">(</span><span class="ident" id="4586681"><a href="/gostd/crypto/tls/tls.go.html#4586056">network</a></span><span class="op" id="4586688">,</span>&nbsp;<span class="ident" id="4586690"><a href="/gostd/crypto/tls/tls.go.html#4586065">addr</a></span><span class="op" id="4586694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586697">if</span>&nbsp;<span class="ident" id="4586700"><a href="/gostd/crypto/tls/tls.go.html#4586662">err</a></span>&nbsp;<span class="op" id="4586704">!=</span>&nbsp;<span class="builtintype" id="4586707">nil</span>&nbsp;<span class="op" id="4586711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586715">return</span>&nbsp;<span class="builtintype" id="4586722">nil</span><span class="op" id="4586725">,</span>&nbsp;<span class="ident" id="4586727"><a href="/gostd/crypto/tls/tls.go.html#4586662">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586736">colonPos</span>&nbsp;<span class="op" id="4586745">:=</span>&nbsp;<span class="ident" id="4586748"><a href="/gostd/crypto/tls/tls.go.html#4583537">strings</a></span><span class="op" id="4586755">.</span><span class="ident" id="4586756"><a href="/gostd/strings/strings.go.html#2969551">LastIndex</a></span><span class="op" id="4586765">(</span><span class="ident" id="4586766"><a href="/gostd/crypto/tls/tls.go.html#4586065">addr</a></span><span class="op" id="4586770">,</span>&nbsp;<span class="string" id="4586772">&#34;:&#34;</span><span class="op" id="4586775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586778">if</span>&nbsp;<span class="ident" id="4586781"><a href="/gostd/crypto/tls/tls.go.html#4586736">colonPos</a></span>&nbsp;<span class="op" id="4586790">==</span>&nbsp;<span class="op" id="4586793">-</span><span class="num" id="4586794">1</span>&nbsp;<span class="op" id="4586796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586800"><a href="/gostd/crypto/tls/tls.go.html#4586736">colonPos</a></span>&nbsp;<span class="op" id="4586809">=</span>&nbsp;<span class="builtinfunc" id="4586811">len</span><span class="op" id="4586814">(</span><span class="ident" id="4586815"><a href="/gostd/crypto/tls/tls.go.html#4586065">addr</a></span><span class="op" id="4586819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586825">hostname</span>&nbsp;<span class="op" id="4586834">:=</span>&nbsp;<span class="ident" id="4586837"><a href="/gostd/crypto/tls/tls.go.html#4586065">addr</a></span><span class="op" id="4586841">[</span><span class="op" id="4586842">:</span><span class="ident" id="4586843"><a href="/gostd/crypto/tls/tls.go.html#4586736">colonPos</a></span><span class="op" id="4586851">]</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586855">if</span>&nbsp;<span class="ident" id="4586858"><a href="/gostd/crypto/tls/tls.go.html#4586078">config</a></span>&nbsp;<span class="op" id="4586865">==</span>&nbsp;<span class="builtintype" id="4586868">nil</span>&nbsp;<span class="op" id="4586872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4586876"><a href="/gostd/crypto/tls/tls.go.html#4586078">config</a></span>&nbsp;<span class="op" id="4586883">=</span>&nbsp;<span class="ident" id="4586885"><a href="/gostd/crypto/tls/common.go.html#4460898">defaultConfig</a></span><span class="op" id="4586898">(</span><span class="op" id="4586899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4586902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586905">//&nbsp;If&nbsp;no&nbsp;ServerName&nbsp;is&nbsp;set,&nbsp;infer&nbsp;the&nbsp;ServerName</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4586955">//&nbsp;from&nbsp;the&nbsp;hostname&nbsp;we&#39;re&nbsp;connecting&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4586998">if</span>&nbsp;<span class="ident" id="4587001"><a href="/gostd/crypto/tls/tls.go.html#4586078">config</a></span><span class="op" id="4587007">.</span><span class="ident" id="4587008"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span>&nbsp;<span class="op" id="4587019">==</span>&nbsp;<span class="string" id="4587022">&#34;&#34;</span>&nbsp;<span class="op" id="4587025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4587029">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;to&nbsp;avoid&nbsp;polluting&nbsp;argument&nbsp;or&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587086">c</span>&nbsp;<span class="op" id="4587088">:=</span>&nbsp;<span class="op" id="4587091">*</span><span class="ident" id="4587092"><a href="/gostd/crypto/tls/tls.go.html#4586078">config</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587101"><a href="/gostd/crypto/tls/tls.go.html#4587086">c</a></span><span class="op" id="4587102">.</span><span class="ident" id="4587103"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span>&nbsp;<span class="op" id="4587114">=</span>&nbsp;<span class="ident" id="4587116"><a href="/gostd/crypto/tls/tls.go.html#4586825">hostname</a></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587127"><a href="/gostd/crypto/tls/tls.go.html#4586078">config</a></span>&nbsp;<span class="op" id="4587134">=</span>&nbsp;<span class="op" id="4587136">&amp;</span><span class="ident" id="4587137"><a href="/gostd/crypto/tls/tls.go.html#4587086">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587144">conn</span>&nbsp;<span class="op" id="4587149">:=</span>&nbsp;<span class="ident" id="4587152"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="4587158">(</span><span class="ident" id="4587159"><a href="/gostd/crypto/tls/tls.go.html#4586653">rawConn</a></span><span class="op" id="4587166">,</span>&nbsp;<span class="ident" id="4587168"><a href="/gostd/crypto/tls/tls.go.html#4586078">config</a></span><span class="op" id="4587174">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587178">if</span>&nbsp;<span class="ident" id="4587181"><a href="/gostd/crypto/tls/tls.go.html#4586296">timeout</a></span>&nbsp;<span class="op" id="4587189">==</span>&nbsp;<span class="num" id="4587192">0</span>&nbsp;<span class="op" id="4587194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587198"><a href="/gostd/crypto/tls/tls.go.html#4586662">err</a></span>&nbsp;<span class="op" id="4587202">=</span>&nbsp;<span class="ident" id="4587204"><a href="/gostd/crypto/tls/tls.go.html#4587144">conn</a></span><span class="op" id="4587208">.</span><span class="ident" id="4587209"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="4587218">(</span><span class="op" id="4587219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587222">}</span>&nbsp;<span class="keyword" id="4587224">else</span>&nbsp;<span class="op" id="4587229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587233">go</span>&nbsp;<span class="keyword" id="4587236">func</span><span class="op" id="4587240">(</span><span class="op" id="4587241">)</span>&nbsp;<span class="op" id="4587243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587248"><a href="/gostd/crypto/tls/tls.go.html#4586499">errChannel</a></span>&nbsp;<span class="op" id="4587259">&lt;-</span>&nbsp;<span class="ident" id="4587262"><a href="/gostd/crypto/tls/tls.go.html#4587144">conn</a></span><span class="op" id="4587266">.</span><span class="ident" id="4587267"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="4587276">(</span><span class="op" id="4587277">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587281">}</span><span class="op" id="4587282">(</span><span class="op" id="4587283">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587288"><a href="/gostd/crypto/tls/tls.go.html#4586662">err</a></span>&nbsp;<span class="op" id="4587292">=</span>&nbsp;<span class="op" id="4587294">&lt;-</span><span class="ident" id="4587296"><a href="/gostd/crypto/tls/tls.go.html#4586499">errChannel</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587312">if</span>&nbsp;<span class="ident" id="4587315"><a href="/gostd/crypto/tls/tls.go.html#4586662">err</a></span>&nbsp;<span class="op" id="4587319">!=</span>&nbsp;<span class="builtintype" id="4587322">nil</span>&nbsp;<span class="op" id="4587326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4587330"><a href="/gostd/crypto/tls/tls.go.html#4586653">rawConn</a></span><span class="op" id="4587337">.</span><span class="ident" id="4587338"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4587343">(</span><span class="op" id="4587344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587348">return</span>&nbsp;<span class="builtintype" id="4587355">nil</span><span class="op" id="4587358">,</span>&nbsp;<span class="ident" id="4587360"><a href="/gostd/crypto/tls/tls.go.html#4586662">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4587365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587369">return</span>&nbsp;<span class="ident" id="4587376"><a href="/gostd/crypto/tls/tls.go.html#4587144">conn</a></span><span class="op" id="4587380">,</span>&nbsp;<span class="builtintype" id="4587382">nil</span><br>
<span class="lineno"></span><span class="op" id="4587386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4587389">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;given&nbsp;network&nbsp;address&nbsp;using&nbsp;net.Dial</span><br>
<span class="lineno"></span><span class="comment" id="4587450">//&nbsp;and&nbsp;then&nbsp;initiates&nbsp;a&nbsp;TLS&nbsp;handshake,&nbsp;returning&nbsp;the&nbsp;resulting</span><br>
<span class="lineno">160</span><span class="comment" id="4587513">//&nbsp;TLS&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4587532">//&nbsp;Dial&nbsp;interprets&nbsp;a&nbsp;nil&nbsp;configuration&nbsp;as&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4587588">//&nbsp;the&nbsp;zero&nbsp;configuration;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;of&nbsp;Config</span><br>
<span class="lineno"></span><span class="comment" id="4587647">//&nbsp;for&nbsp;the&nbsp;defaults.</span><br>
<span class="lineno"></span><span class="keyword" id="4587668">func</span>&nbsp;<span class="ident" id="4587673">Dial</span><span class="op" id="4587677">(</span><span class="ident" id="4587678">network</span><span class="op" id="4587685">,</span>&nbsp;<span class="ident" id="4587687">addr</span>&nbsp;<span class="builtintype" id="4587692">string</span><span class="op" id="4587698">,</span>&nbsp;<span class="ident" id="4587700">config</span>&nbsp;<span class="op" id="4587707">*</span><span class="ident" id="4587708"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4587714">)</span>&nbsp;<span class="op" id="4587716">(</span><span class="op" id="4587717">*</span><span class="ident" id="4587718"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4587722">,</span>&nbsp;<span class="builtintype" id="4587724">error</span><span class="op" id="4587729">)</span>&nbsp;<span class="op" id="4587731">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4587734">return</span>&nbsp;<span class="ident" id="4587741"><a href="/gostd/crypto/tls/tls.go.html#4586021">DialWithDialer</a></span><span class="op" id="4587755">(</span><span class="builtinfunc" id="4587756">new</span><span class="op" id="4587759">(</span><span class="ident" id="4587760"><a href="/gostd/crypto/tls/tls.go.html#4583530">net</a></span><span class="op" id="4587763">.</span><span class="ident" id="4587764"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="4587770">)</span><span class="op" id="4587771">,</span>&nbsp;<span class="ident" id="4587773"><a href="/gostd/crypto/tls/tls.go.html#4587678">network</a></span><span class="op" id="4587780">,</span>&nbsp;<span class="ident" id="4587782"><a href="/gostd/crypto/tls/tls.go.html#4587687">addr</a></span><span class="op" id="4587786">,</span>&nbsp;<span class="ident" id="4587788"><a href="/gostd/crypto/tls/tls.go.html#4587700">config</a></span><span class="op" id="4587794">)</span><br>
<span class="lineno"></span><span class="op" id="4587796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4587799">//&nbsp;LoadX509KeyPair&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4587876">//&nbsp;files.&nbsp;The&nbsp;files&nbsp;must&nbsp;contain&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno">170</span><span class="keyword" id="4587927">func</span>&nbsp;<span class="ident" id="4587932">LoadX509KeyPair</span><span class="op" id="4587947">(</span><span class="ident" id="4587948">certFile</span><span class="op" id="4587956">,</span>&nbsp;<span class="ident" id="4587958">keyFile</span>&nbsp;<span class="builtintype" id="4587966">string</span><span class="op" id="4587972">)</span>&nbsp;<span class="op" id="4587974">(</span><span class="ident" id="4587975">cert</span>&nbsp;<span class="ident" id="4587980"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4587991">,</span>&nbsp;<span class="ident" id="4587993">err</span>&nbsp;<span class="builtintype" id="4587997">error</span><span class="op" id="4588002">)</span>&nbsp;<span class="op" id="4588004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588007">certPEMBlock</span><span class="op" id="4588019">,</span>&nbsp;<span class="ident" id="4588021"><a href="/gostd/crypto/tls/tls.go.html#4587993">err</a></span>&nbsp;<span class="op" id="4588025">:=</span>&nbsp;<span class="ident" id="4588028"><a href="/gostd/crypto/tls/tls.go.html#4583517">ioutil</a></span><span class="op" id="4588034">.</span><span class="ident" id="4588035"><a href="/gostd/io/ioutil/ioutil.go.html#3765434">ReadFile</a></span><span class="op" id="4588043">(</span><span class="ident" id="4588044"><a href="/gostd/crypto/tls/tls.go.html#4587948">certFile</a></span><span class="op" id="4588052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588055">if</span>&nbsp;<span class="ident" id="4588058"><a href="/gostd/crypto/tls/tls.go.html#4587993">err</a></span>&nbsp;<span class="op" id="4588062">!=</span>&nbsp;<span class="builtintype" id="4588065">nil</span>&nbsp;<span class="op" id="4588069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588073">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588081">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588084">keyPEMBlock</span><span class="op" id="4588095">,</span>&nbsp;<span class="ident" id="4588097"><a href="/gostd/crypto/tls/tls.go.html#4587993">err</a></span>&nbsp;<span class="op" id="4588101">:=</span>&nbsp;<span class="ident" id="4588104"><a href="/gostd/crypto/tls/tls.go.html#4583517">ioutil</a></span><span class="op" id="4588110">.</span><span class="ident" id="4588111"><a href="/gostd/io/ioutil/ioutil.go.html#3765434">ReadFile</a></span><span class="op" id="4588119">(</span><span class="ident" id="4588120"><a href="/gostd/crypto/tls/tls.go.html#4587958">keyFile</a></span><span class="op" id="4588127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588130">if</span>&nbsp;<span class="ident" id="4588133"><a href="/gostd/crypto/tls/tls.go.html#4587993">err</a></span>&nbsp;<span class="op" id="4588137">!=</span>&nbsp;<span class="builtintype" id="4588140">nil</span>&nbsp;<span class="op" id="4588144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588148">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588159">return</span>&nbsp;<span class="ident" id="4588166"><a href="/gostd/crypto/tls/tls.go.html#4588297">X509KeyPair</a></span><span class="op" id="4588177">(</span><span class="ident" id="4588178"><a href="/gostd/crypto/tls/tls.go.html#4588007">certPEMBlock</a></span><span class="op" id="4588190">,</span>&nbsp;<span class="ident" id="4588192"><a href="/gostd/crypto/tls/tls.go.html#4588084">keyPEMBlock</a></span><span class="op" id="4588203">)</span><br>
<span class="lineno">180</span><span class="op" id="4588205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4588208">//&nbsp;X509KeyPair&nbsp;parses&nbsp;a&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;from&nbsp;a&nbsp;pair&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4588271">//&nbsp;PEM&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4588292">func</span>&nbsp;<span class="ident" id="4588297">X509KeyPair</span><span class="op" id="4588308">(</span><span class="ident" id="4588309">certPEMBlock</span><span class="op" id="4588321">,</span>&nbsp;<span class="ident" id="4588323">keyPEMBlock</span>&nbsp;<span class="op" id="4588335">[</span><span class="op" id="4588336">]</span><span class="builtintype" id="4588337">byte</span><span class="op" id="4588341">)</span>&nbsp;<span class="op" id="4588343">(</span><span class="ident" id="4588344">cert</span>&nbsp;<span class="ident" id="4588349"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4588360">,</span>&nbsp;<span class="ident" id="4588362">err</span>&nbsp;<span class="builtintype" id="4588366">error</span><span class="op" id="4588371">)</span>&nbsp;<span class="op" id="4588373">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588376">var</span>&nbsp;<span class="ident" id="4588380">certDERBlock</span>&nbsp;<span class="op" id="4588393">*</span><span class="ident" id="4588394"><a href="/gostd/crypto/tls/tls.go.html#4583491">pem</a></span><span class="op" id="4588397">.</span><span class="ident" id="4588398"><a href="/gostd/encoding/pem/pem.go.html#4703705">Block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588405">for</span>&nbsp;<span class="op" id="4588409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588413"><a href="/gostd/crypto/tls/tls.go.html#4588380">certDERBlock</a></span><span class="op" id="4588425">,</span>&nbsp;<span class="ident" id="4588427"><a href="/gostd/crypto/tls/tls.go.html#4588309">certPEMBlock</a></span>&nbsp;<span class="op" id="4588440">=</span>&nbsp;<span class="ident" id="4588442"><a href="/gostd/crypto/tls/tls.go.html#4583491">pem</a></span><span class="op" id="4588445">.</span><span class="ident" id="4588446"><a href="/gostd/encoding/pem/pem.go.html#4705239">Decode</a></span><span class="op" id="4588452">(</span><span class="ident" id="4588453"><a href="/gostd/crypto/tls/tls.go.html#4588309">certPEMBlock</a></span><span class="op" id="4588465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588469">if</span>&nbsp;<span class="ident" id="4588472"><a href="/gostd/crypto/tls/tls.go.html#4588380">certDERBlock</a></span>&nbsp;<span class="op" id="4588485">==</span>&nbsp;<span class="builtintype" id="4588488">nil</span>&nbsp;<span class="op" id="4588492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588497">break</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588509">if</span>&nbsp;<span class="ident" id="4588512"><a href="/gostd/crypto/tls/tls.go.html#4588380">certDERBlock</a></span><span class="op" id="4588524">.</span><span class="ident" id="4588525"><a href="/gostd/encoding/pem/pem.go.html#4703721">Type</a></span>&nbsp;<span class="op" id="4588530">==</span>&nbsp;<span class="string" id="4588533">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4588547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588552"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4588556">.</span><span class="ident" id="4588557"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span>&nbsp;<span class="op" id="4588569">=</span>&nbsp;<span class="builtinfunc" id="4588571">append</span><span class="op" id="4588577">(</span><span class="ident" id="4588578"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4588582">.</span><span class="ident" id="4588583"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><span class="op" id="4588594">,</span>&nbsp;<span class="ident" id="4588596"><a href="/gostd/crypto/tls/tls.go.html#4588380">certDERBlock</a></span><span class="op" id="4588608">.</span><span class="ident" id="4588609"><a href="/gostd/encoding/pem/pem.go.html#4703859">Bytes</a></span><span class="op" id="4588614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588621">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588625">if</span>&nbsp;<span class="builtinfunc" id="4588628">len</span><span class="op" id="4588631">(</span><span class="ident" id="4588632"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4588636">.</span><span class="ident" id="4588637"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><span class="op" id="4588648">)</span>&nbsp;<span class="op" id="4588650">==</span>&nbsp;<span class="num" id="4588653">0</span>&nbsp;<span class="op" id="4588655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588659"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4588663">=</span>&nbsp;<span class="ident" id="4588665"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4588671">.</span><span class="ident" id="4588672"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4588675">(</span><span class="string" id="4588676">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;certificate&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4588726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588738">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588742">var</span>&nbsp;<span class="ident" id="4588746">keyDERBlock</span>&nbsp;<span class="op" id="4588758">*</span><span class="ident" id="4588759"><a href="/gostd/crypto/tls/tls.go.html#4583491">pem</a></span><span class="op" id="4588762">.</span><span class="ident" id="4588763"><a href="/gostd/encoding/pem/pem.go.html#4703705">Block</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588770">for</span>&nbsp;<span class="op" id="4588774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588778"><a href="/gostd/crypto/tls/tls.go.html#4588746">keyDERBlock</a></span><span class="op" id="4588789">,</span>&nbsp;<span class="ident" id="4588791"><a href="/gostd/crypto/tls/tls.go.html#4588323">keyPEMBlock</a></span>&nbsp;<span class="op" id="4588803">=</span>&nbsp;<span class="ident" id="4588805"><a href="/gostd/crypto/tls/tls.go.html#4583491">pem</a></span><span class="op" id="4588808">.</span><span class="ident" id="4588809"><a href="/gostd/encoding/pem/pem.go.html#4705239">Decode</a></span><span class="op" id="4588815">(</span><span class="ident" id="4588816"><a href="/gostd/crypto/tls/tls.go.html#4588323">keyPEMBlock</a></span><span class="op" id="4588827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588831">if</span>&nbsp;<span class="ident" id="4588834"><a href="/gostd/crypto/tls/tls.go.html#4588746">keyDERBlock</a></span>&nbsp;<span class="op" id="4588846">==</span>&nbsp;<span class="builtintype" id="4588849">nil</span>&nbsp;<span class="op" id="4588853">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4588858"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4588862">=</span>&nbsp;<span class="ident" id="4588864"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4588870">.</span><span class="ident" id="4588871"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4588874">(</span><span class="string" id="4588875">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;key&nbsp;PEM&nbsp;data&#34;</span><span class="op" id="4588917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4588931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4588935">if</span>&nbsp;<span class="ident" id="4588938"><a href="/gostd/crypto/tls/tls.go.html#4588746">keyDERBlock</a></span><span class="op" id="4588949">.</span><span class="ident" id="4588950"><a href="/gostd/encoding/pem/pem.go.html#4703721">Type</a></span>&nbsp;<span class="op" id="4588955">==</span>&nbsp;<span class="string" id="4588958">&#34;PRIVATE&nbsp;KEY&#34;</span>&nbsp;<span class="op" id="4588972">||</span>&nbsp;<span class="ident" id="4588975"><a href="/gostd/crypto/tls/tls.go.html#4583537">strings</a></span><span class="op" id="4588982">.</span><span class="ident" id="4588983"><a href="/gostd/strings/strings.go.html#2975527">HasSuffix</a></span><span class="op" id="4588992">(</span><span class="ident" id="4588993"><a href="/gostd/crypto/tls/tls.go.html#4588746">keyDERBlock</a></span><span class="op" id="4589004">.</span><span class="ident" id="4589005"><a href="/gostd/encoding/pem/pem.go.html#4703721">Type</a></span><span class="op" id="4589009">,</span>&nbsp;<span class="string" id="4589011">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="4589025">)</span>&nbsp;<span class="op" id="4589027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589032">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589047"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4589051">.</span><span class="ident" id="4589052"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4589062">,</span>&nbsp;<span class="ident" id="4589064"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589068">=</span>&nbsp;<span class="ident" id="4589070"><a href="/gostd/crypto/tls/tls.go.html#4590358">parsePrivateKey</a></span><span class="op" id="4589085">(</span><span class="ident" id="4589086"><a href="/gostd/crypto/tls/tls.go.html#4588746">keyDERBlock</a></span><span class="op" id="4589097">.</span><span class="ident" id="4589098"><a href="/gostd/encoding/pem/pem.go.html#4703859">Bytes</a></span><span class="op" id="4589103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589106">if</span>&nbsp;<span class="ident" id="4589109"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589113">!=</span>&nbsp;<span class="builtintype" id="4589116">nil</span>&nbsp;<span class="op" id="4589120">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589124">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589136">//&nbsp;We&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;parse&nbsp;the&nbsp;public&nbsp;key&nbsp;for&nbsp;TLS,&nbsp;but&nbsp;we&nbsp;so&nbsp;do&nbsp;anyway</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4589207">//&nbsp;to&nbsp;check&nbsp;that&nbsp;it&nbsp;looks&nbsp;sane&nbsp;and&nbsp;matches&nbsp;the&nbsp;private&nbsp;key.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589268">x509Cert</span><span class="op" id="4589276">,</span>&nbsp;<span class="ident" id="4589278"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589282">:=</span>&nbsp;<span class="ident" id="4589285"><a href="/gostd/crypto/tls/tls.go.html#4583476">x509</a></span><span class="op" id="4589289">.</span><span class="ident" id="4589290"><a href="/gostd/crypto/x509/x509.go.html#4679509">ParseCertificate</a></span><span class="op" id="4589306">(</span><span class="ident" id="4589307"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4589311">.</span><span class="ident" id="4589312"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><span class="op" id="4589323">[</span><span class="num" id="4589324">0</span><span class="op" id="4589325">]</span><span class="op" id="4589326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589329">if</span>&nbsp;<span class="ident" id="4589332"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589336">!=</span>&nbsp;<span class="builtintype" id="4589339">nil</span>&nbsp;<span class="op" id="4589343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589347">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589359">switch</span>&nbsp;<span class="ident" id="4589366">pub</span>&nbsp;<span class="op" id="4589370">:=</span>&nbsp;<span class="ident" id="4589373"><a href="/gostd/crypto/tls/tls.go.html#4589268">x509Cert</a></span><span class="op" id="4589381">.</span><span class="ident" id="4589382"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4589391">.</span><span class="op" id="4589392">(</span><span class="keyword" id="4589393">type</span><span class="op" id="4589397">)</span>&nbsp;<span class="op" id="4589399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589402">case</span>&nbsp;<span class="op" id="4589407">*</span><span class="ident" id="4589408"><a href="/gostd/crypto/tls/tls.go.html#4583462">rsa</a></span><span class="op" id="4589411">.</span><span class="ident" id="4589412"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4589421">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589425">priv</span><span class="op" id="4589429">,</span>&nbsp;<span class="ident" id="4589431">ok</span>&nbsp;<span class="op" id="4589434">:=</span>&nbsp;<span class="ident" id="4589437"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4589441">.</span><span class="ident" id="4589442"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4589452">.</span><span class="op" id="4589453">(</span><span class="op" id="4589454">*</span><span class="ident" id="4589455"><a href="/gostd/crypto/tls/tls.go.html#4583462">rsa</a></span><span class="op" id="4589458">.</span><span class="ident" id="4589459"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4589469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589473">if</span>&nbsp;<span class="op" id="4589476">!</span><span class="ident" id="4589477"><a href="/gostd/crypto/tls/tls.go.html#4589431">ok</a></span>&nbsp;<span class="op" id="4589480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589485"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589489">=</span>&nbsp;<span class="ident" id="4589491"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4589497">.</span><span class="ident" id="4589498"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4589501">(</span><span class="string" id="4589502">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4589563">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589568">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589581">if</span>&nbsp;<span class="ident" id="4589584"><a href="/gostd/crypto/tls/tls.go.html#4589366">pub</a></span><span class="op" id="4589587">.</span><span class="ident" id="4589588"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4589589">.</span><span class="ident" id="4589590"><a href="/gostd/math/big/int.go.html#2042946">Cmp</a></span><span class="op" id="4589593">(</span><span class="ident" id="4589594"><a href="/gostd/crypto/tls/tls.go.html#4589425">priv</a></span><span class="op" id="4589598">.</span><span class="ident" id="4589599"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4589600">)</span>&nbsp;<span class="op" id="4589602">!=</span>&nbsp;<span class="num" id="4589605">0</span>&nbsp;<span class="op" id="4589607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589612"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589616">=</span>&nbsp;<span class="ident" id="4589618"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4589624">.</span><span class="ident" id="4589625"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4589628">(</span><span class="string" id="4589629">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4589680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589685">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589697">case</span>&nbsp;<span class="op" id="4589702">*</span><span class="ident" id="4589703"><a href="/gostd/crypto/tls/tls.go.html#4583446">ecdsa</a></span><span class="op" id="4589708">.</span><span class="ident" id="4589709"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="4589718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589722">priv</span><span class="op" id="4589726">,</span>&nbsp;<span class="ident" id="4589728">ok</span>&nbsp;<span class="op" id="4589731">:=</span>&nbsp;<span class="ident" id="4589734"><a href="/gostd/crypto/tls/tls.go.html#4588344">cert</a></span><span class="op" id="4589738">.</span><span class="ident" id="4589739"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4589749">.</span><span class="op" id="4589750">(</span><span class="op" id="4589751">*</span><span class="ident" id="4589752"><a href="/gostd/crypto/tls/tls.go.html#4583446">ecdsa</a></span><span class="op" id="4589757">.</span><span class="ident" id="4589758"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005513">PrivateKey</a></span><span class="op" id="4589768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589772">if</span>&nbsp;<span class="op" id="4589775">!</span><span class="ident" id="4589776"><a href="/gostd/crypto/tls/tls.go.html#4589728">ok</a></span>&nbsp;<span class="op" id="4589779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589784"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589788">=</span>&nbsp;<span class="ident" id="4589790"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4589796">.</span><span class="ident" id="4589797"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4589800">(</span><span class="string" id="4589801">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;type&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&nbsp;type&#34;</span><span class="op" id="4589862">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589867">return</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4589877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4589881">if</span>&nbsp;<span class="ident" id="4589884"><a href="/gostd/crypto/tls/tls.go.html#4589366">pub</a></span><span class="op" id="4589887">.</span><span class="ident" id="4589888"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005445">X</a></span><span class="op" id="4589889">.</span><span class="ident" id="4589890"><a href="/gostd/math/big/int.go.html#2042946">Cmp</a></span><span class="op" id="4589893">(</span><span class="ident" id="4589894"><a href="/gostd/crypto/tls/tls.go.html#4589722">priv</a></span><span class="op" id="4589898">.</span><span class="ident" id="4589899"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005445">X</a></span><span class="op" id="4589900">)</span>&nbsp;<span class="op" id="4589902">!=</span>&nbsp;<span class="num" id="4589905">0</span>&nbsp;<span class="op" id="4589907">||</span>&nbsp;<span class="ident" id="4589910"><a href="/gostd/crypto/tls/tls.go.html#4589366">pub</a></span><span class="op" id="4589913">.</span><span class="ident" id="4589914"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005448">Y</a></span><span class="op" id="4589915">.</span><span class="ident" id="4589916"><a href="/gostd/math/big/int.go.html#2042946">Cmp</a></span><span class="op" id="4589919">(</span><span class="ident" id="4589920"><a href="/gostd/crypto/tls/tls.go.html#4589722">priv</a></span><span class="op" id="4589924">.</span><span class="ident" id="4589925"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005448">Y</a></span><span class="op" id="4589926">)</span>&nbsp;<span class="op" id="4589928">!=</span>&nbsp;<span class="num" id="4589931">0</span>&nbsp;<span class="op" id="4589933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4589938"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4589942">=</span>&nbsp;<span class="ident" id="4589944"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4589950">.</span><span class="ident" id="4589951"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4589954">(</span><span class="string" id="4589955">&#34;crypto/tls:&nbsp;private&nbsp;key&nbsp;does&nbsp;not&nbsp;match&nbsp;public&nbsp;key&#34;</span><span class="op" id="4590006">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590011">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590023">default</span><span class="op" id="4590030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4590034"><a href="/gostd/crypto/tls/tls.go.html#4588362">err</a></span>&nbsp;<span class="op" id="4590038">=</span>&nbsp;<span class="ident" id="4590040"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4590046">.</span><span class="ident" id="4590047"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4590050">(</span><span class="string" id="4590051">&#34;crypto/tls:&nbsp;unknown&nbsp;public&nbsp;key&nbsp;algorithm&#34;</span><span class="op" id="4590093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590097">return</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590109">return</span><br>
<span class="lineno"></span><span class="op" id="4590116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="4590119">//&nbsp;Attempt&nbsp;to&nbsp;parse&nbsp;the&nbsp;given&nbsp;private&nbsp;key&nbsp;DER&nbsp;block.&nbsp;OpenSSL&nbsp;0.9.8&nbsp;generates</span><br>
<span class="lineno"></span><span class="comment" id="4590196">//&nbsp;PKCS#1&nbsp;private&nbsp;keys&nbsp;by&nbsp;default,&nbsp;while&nbsp;OpenSSL&nbsp;1.0.0&nbsp;generates&nbsp;PKCS#8&nbsp;keys.</span><br>
<span class="lineno"></span><span class="comment" id="4590274">//&nbsp;OpenSSL&nbsp;ecparam&nbsp;generates&nbsp;SEC1&nbsp;EC&nbsp;private&nbsp;keys&nbsp;for&nbsp;ECDSA.&nbsp;We&nbsp;try&nbsp;all&nbsp;three.</span><br>
<span class="lineno"></span><span class="keyword" id="4590353">func</span>&nbsp;<span class="ident" id="4590358">parsePrivateKey</span><span class="op" id="4590373">(</span><span class="ident" id="4590374">der</span>&nbsp;<span class="op" id="4590378">[</span><span class="op" id="4590379">]</span><span class="builtintype" id="4590380">byte</span><span class="op" id="4590384">)</span>&nbsp;<span class="op" id="4590386">(</span><span class="ident" id="4590387"><a href="/gostd/crypto/tls/tls.go.html#4583436">crypto</a></span><span class="op" id="4590393">.</span><span class="ident" id="4590394"><a href="/gostd/crypto/crypto.go.html#3012570">PrivateKey</a></span><span class="op" id="4590404">,</span>&nbsp;<span class="builtintype" id="4590406">error</span><span class="op" id="4590411">)</span>&nbsp;<span class="op" id="4590413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590416">if</span>&nbsp;<span class="ident" id="4590419">key</span><span class="op" id="4590422">,</span>&nbsp;<span class="ident" id="4590424">err</span>&nbsp;<span class="op" id="4590428">:=</span>&nbsp;<span class="ident" id="4590431"><a href="/gostd/crypto/tls/tls.go.html#4583476">x509</a></span><span class="op" id="4590435">.</span><span class="ident" id="4590436"><a href="/gostd/crypto/x509/pkcs1.go.html#4623243">ParsePKCS1PrivateKey</a></span><span class="op" id="4590456">(</span><span class="ident" id="4590457"><a href="/gostd/crypto/tls/tls.go.html#4590374">der</a></span><span class="op" id="4590460">)</span><span class="op" id="4590461">;</span>&nbsp;<span class="ident" id="4590463"><a href="/gostd/crypto/tls/tls.go.html#4590424">err</a></span>&nbsp;<span class="op" id="4590467">==</span>&nbsp;<span class="builtintype" id="4590470">nil</span>&nbsp;<span class="op" id="4590474">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590478">return</span>&nbsp;<span class="ident" id="4590485"><a href="/gostd/crypto/tls/tls.go.html#4590419">key</a></span><span class="op" id="4590488">,</span>&nbsp;<span class="builtintype" id="4590490">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590498">if</span>&nbsp;<span class="ident" id="4590501">key</span><span class="op" id="4590504">,</span>&nbsp;<span class="ident" id="4590506">err</span>&nbsp;<span class="op" id="4590510">:=</span>&nbsp;<span class="ident" id="4590513"><a href="/gostd/crypto/tls/tls.go.html#4583476">x509</a></span><span class="op" id="4590517">.</span><span class="ident" id="4590518"><a href="/gostd/crypto/x509/pkcs8.go.html#4625876">ParsePKCS8PrivateKey</a></span><span class="op" id="4590538">(</span><span class="ident" id="4590539"><a href="/gostd/crypto/tls/tls.go.html#4590374">der</a></span><span class="op" id="4590542">)</span><span class="op" id="4590543">;</span>&nbsp;<span class="ident" id="4590545"><a href="/gostd/crypto/tls/tls.go.html#4590506">err</a></span>&nbsp;<span class="op" id="4590549">==</span>&nbsp;<span class="builtintype" id="4590552">nil</span>&nbsp;<span class="op" id="4590556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590560">switch</span>&nbsp;<span class="ident" id="4590567">key</span>&nbsp;<span class="op" id="4590571">:=</span>&nbsp;<span class="ident" id="4590574"><a href="/gostd/crypto/tls/tls.go.html#4590501">key</a></span><span class="op" id="4590577">.</span><span class="op" id="4590578">(</span><span class="keyword" id="4590579">type</span><span class="op" id="4590583">)</span>&nbsp;<span class="op" id="4590585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590589">case</span>&nbsp;<span class="op" id="4590594">*</span><span class="ident" id="4590595"><a href="/gostd/crypto/tls/tls.go.html#4583462">rsa</a></span><span class="op" id="4590598">.</span><span class="ident" id="4590599"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4590609">,</span>&nbsp;<span class="op" id="4590611">*</span><span class="ident" id="4590612"><a href="/gostd/crypto/tls/tls.go.html#4583446">ecdsa</a></span><span class="op" id="4590617">.</span><span class="ident" id="4590618"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005513">PrivateKey</a></span><span class="op" id="4590628">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590633">return</span>&nbsp;<span class="ident" id="4590640"><a href="/gostd/crypto/tls/tls.go.html#4590567">key</a></span><span class="op" id="4590643">,</span>&nbsp;<span class="builtintype" id="4590645">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590651">default</span><span class="op" id="4590658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590663">return</span>&nbsp;<span class="builtintype" id="4590670">nil</span><span class="op" id="4590673">,</span>&nbsp;<span class="ident" id="4590675"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4590681">.</span><span class="ident" id="4590682"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4590685">(</span><span class="string" id="4590686">&#34;crypto/tls:&nbsp;found&nbsp;unknown&nbsp;private&nbsp;key&nbsp;type&nbsp;in&nbsp;PKCS#8&nbsp;wrapping&#34;</span><span class="op" id="4590749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590756">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590759">if</span>&nbsp;<span class="ident" id="4590762">key</span><span class="op" id="4590765">,</span>&nbsp;<span class="ident" id="4590767">err</span>&nbsp;<span class="op" id="4590771">:=</span>&nbsp;<span class="ident" id="4590774"><a href="/gostd/crypto/tls/tls.go.html#4583476">x509</a></span><span class="op" id="4590778">.</span><span class="ident" id="4590779"><a href="/gostd/crypto/x509/sec1.go.html#4629841">ParseECPrivateKey</a></span><span class="op" id="4590796">(</span><span class="ident" id="4590797"><a href="/gostd/crypto/tls/tls.go.html#4590374">der</a></span><span class="op" id="4590800">)</span><span class="op" id="4590801">;</span>&nbsp;<span class="ident" id="4590803"><a href="/gostd/crypto/tls/tls.go.html#4590767">err</a></span>&nbsp;<span class="op" id="4590807">==</span>&nbsp;<span class="builtintype" id="4590810">nil</span>&nbsp;<span class="op" id="4590814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590818">return</span>&nbsp;<span class="ident" id="4590825"><a href="/gostd/crypto/tls/tls.go.html#4590762">key</a></span><span class="op" id="4590828">,</span>&nbsp;<span class="builtintype" id="4590830">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4590835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4590839">return</span>&nbsp;<span class="builtintype" id="4590846">nil</span><span class="op" id="4590849">,</span>&nbsp;<span class="ident" id="4590851"><a href="/gostd/crypto/tls/tls.go.html#4583507">errors</a></span><span class="op" id="4590857">.</span><span class="ident" id="4590858"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4590861">(</span><span class="string" id="4590862">&#34;crypto/tls:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;private&nbsp;key&#34;</span><span class="op" id="4590903">)</span><br>
<span class="lineno">275</span><span class="op" id="4590905">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
