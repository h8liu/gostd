<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html" class="current">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6715634">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6715689">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6715743">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6715794">package</span>&nbsp;<span class="ident" id="6715802">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6715807">import</span>&nbsp;<span class="string" id="6715814">&#34;sync&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6715822">type</span>&nbsp;<span class="ident" id="6715827">streamListener</span>&nbsp;<span class="keyword" id="6715842">struct</span>&nbsp;<span class="op" id="6715849">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715852">net</span><span class="op" id="6715855">,</span>&nbsp;<span class="ident" id="6715857">addr</span>&nbsp;<span class="builtintype" id="6715862">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715870">ln</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715880">Listener</span><br>
<span class="lineno"></span><span class="op" id="6715889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6715892">type</span>&nbsp;<span class="ident" id="6715897">dualStackServer</span>&nbsp;<span class="keyword" id="6715913">struct</span>&nbsp;<span class="op" id="6715920">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715923">lnmu</span>&nbsp;<span class="ident" id="6715928">sync</span><span class="op" id="6715932">.</span><span class="ident" id="6715933">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715942">lns</span>&nbsp;&nbsp;<span class="op" id="6715947">[</span><span class="op" id="6715948">]</span><span class="ident" id="6715949">streamListener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715965">port</span>&nbsp;<span class="builtintype" id="6715970">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715979">cmu</span>&nbsp;<span class="ident" id="6715983">sync</span><span class="op" id="6715987">.</span><span class="ident" id="6715988">RWMutex</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6715997">cs</span>&nbsp;&nbsp;<span class="op" id="6716001">[</span><span class="op" id="6716002">]</span><span class="ident" id="6716003">Conn</span>&nbsp;<span class="comment" id="6716008">//&nbsp;established&nbsp;connections&nbsp;at&nbsp;the&nbsp;passive&nbsp;open&nbsp;side</span><br>
<span class="lineno"></span><span class="op" id="6716060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716063">func</span>&nbsp;<span class="op" id="6716068">(</span><span class="ident" id="6716069">dss</span>&nbsp;<span class="op" id="6716073">*</span><span class="ident" id="6716074">dualStackServer</span><span class="op" id="6716089">)</span>&nbsp;<span class="ident" id="6716091">buildup</span><span class="op" id="6716098">(</span><span class="ident" id="6716099">server</span>&nbsp;<span class="keyword" id="6716106">func</span><span class="op" id="6716110">(</span><span class="op" id="6716111">*</span><span class="ident" id="6716112">dualStackServer</span><span class="op" id="6716127">,</span>&nbsp;<span class="ident" id="6716129">Listener</span><span class="op" id="6716137">)</span><span class="op" id="6716138">)</span>&nbsp;<span class="builtintype" id="6716140">error</span>&nbsp;<span class="op" id="6716146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716149">for</span>&nbsp;<span class="ident" id="6716153">i</span>&nbsp;<span class="op" id="6716155">:=</span>&nbsp;<span class="keyword" id="6716158">range</span>&nbsp;<span class="ident" id="6716164">dss</span><span class="op" id="6716167">.</span><span class="ident" id="6716168">lns</span>&nbsp;<span class="op" id="6716172">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716176">go</span>&nbsp;<span class="ident" id="6716179">server</span><span class="op" id="6716185">(</span><span class="ident" id="6716186">dss</span><span class="op" id="6716189">,</span>&nbsp;<span class="ident" id="6716191">dss</span><span class="op" id="6716194">.</span><span class="ident" id="6716195">lns</span><span class="op" id="6716198">[</span><span class="ident" id="6716199">i</span><span class="op" id="6716200">]</span><span class="op" id="6716201">.</span><span class="ident" id="6716202">ln</span><span class="op" id="6716204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716210">return</span>&nbsp;<span class="builtintype" id="6716217">nil</span><br>
<span class="lineno"></span><span class="op" id="6716221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="6716224">func</span>&nbsp;<span class="op" id="6716229">(</span><span class="ident" id="6716230">dss</span>&nbsp;<span class="op" id="6716234">*</span><span class="ident" id="6716235">dualStackServer</span><span class="op" id="6716250">)</span>&nbsp;<span class="ident" id="6716252">putConn</span><span class="op" id="6716259">(</span><span class="ident" id="6716260">c</span>&nbsp;<span class="ident" id="6716262">Conn</span><span class="op" id="6716266">)</span>&nbsp;<span class="builtintype" id="6716268">error</span>&nbsp;<span class="op" id="6716274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716277">dss</span><span class="op" id="6716280">.</span><span class="ident" id="6716281">cmu</span><span class="op" id="6716284">.</span><span class="ident" id="6716285">Lock</span><span class="op" id="6716289">(</span><span class="op" id="6716290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716293">dss</span><span class="op" id="6716296">.</span><span class="ident" id="6716297">cs</span>&nbsp;<span class="op" id="6716300">=</span>&nbsp;<span class="builtinfunc" id="6716302">append</span><span class="op" id="6716308">(</span><span class="ident" id="6716309">dss</span><span class="op" id="6716312">.</span><span class="ident" id="6716313">cs</span><span class="op" id="6716315">,</span>&nbsp;<span class="ident" id="6716317">c</span><span class="op" id="6716318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716321">dss</span><span class="op" id="6716324">.</span><span class="ident" id="6716325">cmu</span><span class="op" id="6716328">.</span><span class="ident" id="6716329">Unlock</span><span class="op" id="6716335">(</span><span class="op" id="6716336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716339">return</span>&nbsp;<span class="builtintype" id="6716346">nil</span><br>
<span class="lineno">35</span><span class="op" id="6716350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716353">func</span>&nbsp;<span class="op" id="6716358">(</span><span class="ident" id="6716359">dss</span>&nbsp;<span class="op" id="6716363">*</span><span class="ident" id="6716364">dualStackServer</span><span class="op" id="6716379">)</span>&nbsp;<span class="ident" id="6716381">teardownNetwork</span><span class="op" id="6716396">(</span><span class="ident" id="6716397">net</span>&nbsp;<span class="builtintype" id="6716401">string</span><span class="op" id="6716407">)</span>&nbsp;<span class="builtintype" id="6716409">error</span>&nbsp;<span class="op" id="6716415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716418">dss</span><span class="op" id="6716421">.</span><span class="ident" id="6716422">lnmu</span><span class="op" id="6716426">.</span><span class="ident" id="6716427">Lock</span><span class="op" id="6716431">(</span><span class="op" id="6716432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716435">for</span>&nbsp;<span class="ident" id="6716439">i</span>&nbsp;<span class="op" id="6716441">:=</span>&nbsp;<span class="keyword" id="6716444">range</span>&nbsp;<span class="ident" id="6716450">dss</span><span class="op" id="6716453">.</span><span class="ident" id="6716454">lns</span>&nbsp;<span class="op" id="6716458">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716462">if</span>&nbsp;<span class="ident" id="6716465">net</span>&nbsp;<span class="op" id="6716469">==</span>&nbsp;<span class="ident" id="6716472">dss</span><span class="op" id="6716475">.</span><span class="ident" id="6716476">lns</span><span class="op" id="6716479">[</span><span class="ident" id="6716480">i</span><span class="op" id="6716481">]</span><span class="op" id="6716482">.</span><span class="ident" id="6716483">net</span>&nbsp;<span class="op" id="6716487">&amp;&amp;</span>&nbsp;<span class="ident" id="6716490">dss</span><span class="op" id="6716493">.</span><span class="ident" id="6716494">lns</span><span class="op" id="6716497">[</span><span class="ident" id="6716498">i</span><span class="op" id="6716499">]</span><span class="op" id="6716500">.</span><span class="ident" id="6716501">ln</span>&nbsp;<span class="op" id="6716504">!=</span>&nbsp;<span class="builtintype" id="6716507">nil</span>&nbsp;<span class="op" id="6716511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716516">dss</span><span class="op" id="6716519">.</span><span class="ident" id="6716520">lns</span><span class="op" id="6716523">[</span><span class="ident" id="6716524">i</span><span class="op" id="6716525">]</span><span class="op" id="6716526">.</span><span class="ident" id="6716527">ln</span><span class="op" id="6716529">.</span><span class="ident" id="6716530">Close</span><span class="op" id="6716535">(</span><span class="op" id="6716536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716541">dss</span><span class="op" id="6716544">.</span><span class="ident" id="6716545">lns</span><span class="op" id="6716548">[</span><span class="ident" id="6716549">i</span><span class="op" id="6716550">]</span><span class="op" id="6716551">.</span><span class="ident" id="6716552">ln</span>&nbsp;<span class="op" id="6716555">=</span>&nbsp;<span class="builtintype" id="6716557">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716566">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716569">dss</span><span class="op" id="6716572">.</span><span class="ident" id="6716573">lnmu</span><span class="op" id="6716577">.</span><span class="ident" id="6716578">Unlock</span><span class="op" id="6716584">(</span><span class="op" id="6716585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716588">return</span>&nbsp;<span class="builtintype" id="6716595">nil</span><br>
<span class="lineno"></span><span class="op" id="6716599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716602">func</span>&nbsp;<span class="op" id="6716607">(</span><span class="ident" id="6716608">dss</span>&nbsp;<span class="op" id="6716612">*</span><span class="ident" id="6716613">dualStackServer</span><span class="op" id="6716628">)</span>&nbsp;<span class="ident" id="6716630">teardown</span><span class="op" id="6716638">(</span><span class="op" id="6716639">)</span>&nbsp;<span class="builtintype" id="6716641">error</span>&nbsp;<span class="op" id="6716647">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716650">dss</span><span class="op" id="6716653">.</span><span class="ident" id="6716654">lnmu</span><span class="op" id="6716658">.</span><span class="ident" id="6716659">Lock</span><span class="op" id="6716663">(</span><span class="op" id="6716664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716667">for</span>&nbsp;<span class="ident" id="6716671">i</span>&nbsp;<span class="op" id="6716673">:=</span>&nbsp;<span class="keyword" id="6716676">range</span>&nbsp;<span class="ident" id="6716682">dss</span><span class="op" id="6716685">.</span><span class="ident" id="6716686">lns</span>&nbsp;<span class="op" id="6716690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716694">if</span>&nbsp;<span class="ident" id="6716697">dss</span><span class="op" id="6716700">.</span><span class="ident" id="6716701">lns</span><span class="op" id="6716704">[</span><span class="ident" id="6716705">i</span><span class="op" id="6716706">]</span><span class="op" id="6716707">.</span><span class="ident" id="6716708">ln</span>&nbsp;<span class="op" id="6716711">!=</span>&nbsp;<span class="builtintype" id="6716714">nil</span>&nbsp;<span class="op" id="6716718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716723">dss</span><span class="op" id="6716726">.</span><span class="ident" id="6716727">lns</span><span class="op" id="6716730">[</span><span class="ident" id="6716731">i</span><span class="op" id="6716732">]</span><span class="op" id="6716733">.</span><span class="ident" id="6716734">ln</span><span class="op" id="6716736">.</span><span class="ident" id="6716737">Close</span><span class="op" id="6716742">(</span><span class="op" id="6716743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716747">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716753">dss</span><span class="op" id="6716756">.</span><span class="ident" id="6716757">lnmu</span><span class="op" id="6716761">.</span><span class="ident" id="6716762">Unlock</span><span class="op" id="6716768">(</span><span class="op" id="6716769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716772">dss</span><span class="op" id="6716775">.</span><span class="ident" id="6716776">cmu</span><span class="op" id="6716779">.</span><span class="ident" id="6716780">Lock</span><span class="op" id="6716784">(</span><span class="op" id="6716785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716788">for</span>&nbsp;<span class="ident" id="6716792">_</span><span class="op" id="6716793">,</span>&nbsp;<span class="ident" id="6716795">c</span>&nbsp;<span class="op" id="6716797">:=</span>&nbsp;<span class="keyword" id="6716800">range</span>&nbsp;<span class="ident" id="6716806">dss</span><span class="op" id="6716809">.</span><span class="ident" id="6716810">cs</span>&nbsp;<span class="op" id="6716813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716817">c</span><span class="op" id="6716818">.</span><span class="ident" id="6716819">Close</span><span class="op" id="6716824">(</span><span class="op" id="6716825">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6716828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716831">dss</span><span class="op" id="6716834">.</span><span class="ident" id="6716835">cmu</span><span class="op" id="6716838">.</span><span class="ident" id="6716839">Unlock</span><span class="op" id="6716845">(</span><span class="op" id="6716846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716849">return</span>&nbsp;<span class="builtintype" id="6716856">nil</span><br>
<span class="lineno"></span><span class="op" id="6716860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="keyword" id="6716863">func</span>&nbsp;<span class="ident" id="6716868">newDualStackServer</span><span class="op" id="6716886">(</span><span class="ident" id="6716887">lns</span>&nbsp;<span class="op" id="6716891">[</span><span class="op" id="6716892">]</span><span class="ident" id="6716893">streamListener</span><span class="op" id="6716907">)</span>&nbsp;<span class="op" id="6716909">(</span><span class="op" id="6716910">*</span><span class="ident" id="6716911">dualStackServer</span><span class="op" id="6716926">,</span>&nbsp;<span class="builtintype" id="6716928">error</span><span class="op" id="6716933">)</span>&nbsp;<span class="op" id="6716935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6716938">dss</span>&nbsp;<span class="op" id="6716942">:=</span>&nbsp;<span class="op" id="6716945">&amp;</span><span class="ident" id="6716946">dualStackServer</span><span class="op" id="6716961">{</span><span class="ident" id="6716962">lns</span><span class="op" id="6716965">:</span>&nbsp;<span class="ident" id="6716967">lns</span><span class="op" id="6716970">,</span>&nbsp;<span class="ident" id="6716972">port</span><span class="op" id="6716976">:</span>&nbsp;<span class="string" id="6716978">&#34;0&#34;</span><span class="op" id="6716981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6716984">for</span>&nbsp;<span class="ident" id="6716988">i</span>&nbsp;<span class="op" id="6716990">:=</span>&nbsp;<span class="keyword" id="6716993">range</span>&nbsp;<span class="ident" id="6716999">dss</span><span class="op" id="6717002">.</span><span class="ident" id="6717003">lns</span>&nbsp;<span class="op" id="6717007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6717011">ln</span><span class="op" id="6717013">,</span>&nbsp;<span class="ident" id="6717015">err</span>&nbsp;<span class="op" id="6717019">:=</span>&nbsp;<span class="ident" id="6717022">Listen</span><span class="op" id="6717028">(</span><span class="ident" id="6717029">dss</span><span class="op" id="6717032">.</span><span class="ident" id="6717033">lns</span><span class="op" id="6717036">[</span><span class="ident" id="6717037">i</span><span class="op" id="6717038">]</span><span class="op" id="6717039">.</span><span class="ident" id="6717040">net</span><span class="op" id="6717043">,</span>&nbsp;<span class="ident" id="6717045">dss</span><span class="op" id="6717048">.</span><span class="ident" id="6717049">lns</span><span class="op" id="6717052">[</span><span class="ident" id="6717053">i</span><span class="op" id="6717054">]</span><span class="op" id="6717055">.</span><span class="ident" id="6717056">addr</span><span class="op" id="6717060">+</span><span class="string" id="6717061">&#34;:&#34;</span><span class="op" id="6717064">+</span><span class="ident" id="6717065">dss</span><span class="op" id="6717068">.</span><span class="ident" id="6717069">port</span><span class="op" id="6717073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6717077">if</span>&nbsp;<span class="ident" id="6717080">err</span>&nbsp;<span class="op" id="6717084">!=</span>&nbsp;<span class="builtintype" id="6717087">nil</span>&nbsp;<span class="op" id="6717091">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6717096">dss</span><span class="op" id="6717099">.</span><span class="ident" id="6717100">teardown</span><span class="op" id="6717108">(</span><span class="op" id="6717109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6717114">return</span>&nbsp;<span class="builtintype" id="6717121">nil</span><span class="op" id="6717124">,</span>&nbsp;<span class="ident" id="6717126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6717132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6717136">dss</span><span class="op" id="6717139">.</span><span class="ident" id="6717140">lns</span><span class="op" id="6717143">[</span><span class="ident" id="6717144">i</span><span class="op" id="6717145">]</span><span class="op" id="6717146">.</span><span class="ident" id="6717147">ln</span>&nbsp;<span class="op" id="6717150">=</span>&nbsp;<span class="ident" id="6717152">ln</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6717157">if</span>&nbsp;<span class="ident" id="6717160">dss</span><span class="op" id="6717163">.</span><span class="ident" id="6717164">port</span>&nbsp;<span class="op" id="6717169">==</span>&nbsp;<span class="string" id="6717172">&#34;0&#34;</span>&nbsp;<span class="op" id="6717176">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6717181">if</span>&nbsp;<span class="ident" id="6717184">_</span><span class="op" id="6717185">,</span>&nbsp;<span class="ident" id="6717187">dss</span><span class="op" id="6717190">.</span><span class="ident" id="6717191">port</span><span class="op" id="6717195">,</span>&nbsp;<span class="ident" id="6717197">err</span>&nbsp;<span class="op" id="6717201">=</span>&nbsp;<span class="ident" id="6717203">SplitHostPort</span><span class="op" id="6717216">(</span><span class="ident" id="6717217">ln</span><span class="op" id="6717219">.</span><span class="ident" id="6717220">Addr</span><span class="op" id="6717224">(</span><span class="op" id="6717225">)</span><span class="op" id="6717226">.</span><span class="ident" id="6717227">String</span><span class="op" id="6717233">(</span><span class="op" id="6717234">)</span><span class="op" id="6717235">)</span><span class="op" id="6717236">;</span>&nbsp;<span class="ident" id="6717238">err</span>&nbsp;<span class="op" id="6717242">!=</span>&nbsp;<span class="builtintype" id="6717245">nil</span>&nbsp;<span class="op" id="6717249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6717255">dss</span><span class="op" id="6717258">.</span><span class="ident" id="6717259">teardown</span><span class="op" id="6717267">(</span><span class="op" id="6717268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6717274">return</span>&nbsp;<span class="builtintype" id="6717281">nil</span><span class="op" id="6717284">,</span>&nbsp;<span class="ident" id="6717286">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6717293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6717297">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6717300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6717303">return</span>&nbsp;<span class="ident" id="6717310">dss</span><span class="op" id="6717313">,</span>&nbsp;<span class="builtintype" id="6717315">nil</span><br>
<span class="lineno"></span><span class="op" id="6717319">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
