<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5473470">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5473525">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5473579">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5473630">package</span>&nbsp;<span class="ident" id="5473638">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5473645">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5473718">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5473795">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5473874">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5473953">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5474031">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5474110">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5474184">type</span>&nbsp;<span class="ident" id="5474189">moveToFrontDecoder</span>&nbsp;<span class="op" id="5474208">[</span><span class="op" id="5474209">]</span><span class="builtintype" id="5474210">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5474216">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5474295">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5474310">func</span>&nbsp;<span class="ident" id="5474315">newMTFDecoder</span><span class="op" id="5474328">(</span><span class="ident" id="5474329">symbols</span>&nbsp;<span class="op" id="5474337">[</span><span class="op" id="5474338">]</span><span class="builtintype" id="5474339">byte</span><span class="op" id="5474343">)</span>&nbsp;<span class="ident" id="5474345">moveToFrontDecoder</span>&nbsp;<span class="op" id="5474364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474367">if</span>&nbsp;<span class="builtinfunc" id="5474370">len</span><span class="op" id="5474373">(</span><span class="ident" id="5474374">symbols</span><span class="op" id="5474381">)</span>&nbsp;<span class="op" id="5474383">&gt;</span>&nbsp;<span class="num" id="5474385">256</span>&nbsp;<span class="op" id="5474389">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5474393">panic</span><span class="op" id="5474398">(</span><span class="string" id="5474399">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5474417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474423">return</span>&nbsp;<span class="ident" id="5474430">moveToFrontDecoder</span><span class="op" id="5474448">(</span><span class="ident" id="5474449">symbols</span><span class="op" id="5474456">)</span><br>
<span class="lineno"></span><span class="op" id="5474458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5474461">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5474535">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5474562">func</span>&nbsp;<span class="ident" id="5474567">newMTFDecoderWithRange</span><span class="op" id="5474589">(</span><span class="ident" id="5474590">n</span>&nbsp;<span class="builtintype" id="5474592">int</span><span class="op" id="5474595">)</span>&nbsp;<span class="ident" id="5474597">moveToFrontDecoder</span>&nbsp;<span class="op" id="5474616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474619">if</span>&nbsp;<span class="ident" id="5474622">n</span>&nbsp;<span class="op" id="5474624">&gt;</span>&nbsp;<span class="num" id="5474626">256</span>&nbsp;<span class="op" id="5474630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5474634">panic</span><span class="op" id="5474639">(</span><span class="string" id="5474640">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5474691">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474698">m</span>&nbsp;<span class="op" id="5474700">:=</span>&nbsp;<span class="builtinfunc" id="5474703">make</span><span class="op" id="5474707">(</span><span class="op" id="5474708">[</span><span class="op" id="5474709">]</span><span class="builtintype" id="5474710">byte</span><span class="op" id="5474714">,</span>&nbsp;<span class="ident" id="5474716">n</span><span class="op" id="5474717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474720">for</span>&nbsp;<span class="ident" id="5474724">i</span>&nbsp;<span class="op" id="5474726">:=</span>&nbsp;<span class="num" id="5474729">0</span><span class="op" id="5474730">;</span>&nbsp;<span class="ident" id="5474732">i</span>&nbsp;<span class="op" id="5474734">&lt;</span>&nbsp;<span class="ident" id="5474736">n</span><span class="op" id="5474737">;</span>&nbsp;<span class="ident" id="5474739">i</span><span class="op" id="5474740">++</span>&nbsp;<span class="op" id="5474743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5474747">m</span><span class="op" id="5474748">[</span><span class="ident" id="5474749">i</span><span class="op" id="5474750">]</span>&nbsp;<span class="op" id="5474752">=</span>&nbsp;<span class="builtintype" id="5474754">byte</span><span class="op" id="5474758">(</span><span class="ident" id="5474759">i</span><span class="op" id="5474760">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5474763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5474766">return</span>&nbsp;<span class="ident" id="5474773">moveToFrontDecoder</span><span class="op" id="5474791">(</span><span class="ident" id="5474792">m</span><span class="op" id="5474793">)</span><br>
<span class="lineno"></span><span class="op" id="5474795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5474798">func</span>&nbsp;<span class="op" id="5474803">(</span><span class="ident" id="5474804">m</span>&nbsp;<span class="ident" id="5474806">moveToFrontDecoder</span><span class="op" id="5474824">)</span>&nbsp;<span class="ident" id="5474826">Decode</span><span class="op" id="5474832">(</span><span class="ident" id="5474833">n</span>&nbsp;<span class="builtintype" id="5474835">int</span><span class="op" id="5474838">)</span>&nbsp;<span class="op" id="5474840">(</span><span class="ident" id="5474841">b</span>&nbsp;<span class="builtintype" id="5474843">byte</span><span class="op" id="5474847">)</span>&nbsp;<span class="op" id="5474849">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474852">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474914">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5474980">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5475038">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475105">b</span>&nbsp;<span class="op" id="5475107">=</span>&nbsp;<span class="ident" id="5475109">m</span><span class="op" id="5475110">[</span><span class="ident" id="5475111">n</span><span class="op" id="5475112">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5475115">copy</span><span class="op" id="5475119">(</span><span class="ident" id="5475120">m</span><span class="op" id="5475121">[</span><span class="num" id="5475122">1</span><span class="op" id="5475123">:</span><span class="op" id="5475124">]</span><span class="op" id="5475125">,</span>&nbsp;<span class="ident" id="5475127">m</span><span class="op" id="5475128">[</span><span class="op" id="5475129">:</span><span class="ident" id="5475130">n</span><span class="op" id="5475131">]</span><span class="op" id="5475132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5475135">m</span><span class="op" id="5475136">[</span><span class="num" id="5475137">0</span><span class="op" id="5475138">]</span>&nbsp;<span class="op" id="5475140">=</span>&nbsp;<span class="ident" id="5475142">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475145">return</span><br>
<span class="lineno"></span><span class="op" id="5475152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5475155">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5475209">func</span>&nbsp;<span class="op" id="5475214">(</span><span class="ident" id="5475215">m</span>&nbsp;<span class="ident" id="5475217">moveToFrontDecoder</span><span class="op" id="5475235">)</span>&nbsp;<span class="ident" id="5475237">First</span><span class="op" id="5475242">(</span><span class="op" id="5475243">)</span>&nbsp;<span class="builtintype" id="5475245">byte</span>&nbsp;<span class="op" id="5475250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5475253">return</span>&nbsp;<span class="ident" id="5475260">m</span><span class="op" id="5475261">[</span><span class="num" id="5475262">0</span><span class="op" id="5475263">]</span><br>
<span class="lineno"></span><span class="op" id="5475265">}</span>
</div>
</body>
</html>
