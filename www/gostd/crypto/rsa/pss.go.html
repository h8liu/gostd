<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3701205">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3701260">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3701314">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3701365">package</span>&nbsp;<span class="ident" id="3701373">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3701378">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="3701432">//</span><br>
<span class="lineno"></span><span class="comment" id="3701435">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3701532">import</span>&nbsp;<span class="op" id="3701539">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3701542">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3701551">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3701561">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3701571">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3701579">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3701585">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="3701596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3701599">func</span>&nbsp;<span class="ident" id="3701604">emsaPSSEncode</span><span class="op" id="3701617">(</span><span class="ident" id="3701618">mHash</span>&nbsp;<span class="op" id="3701624">[</span><span class="op" id="3701625">]</span><span class="builtintype" id="3701626">byte</span><span class="op" id="3701630">,</span>&nbsp;<span class="ident" id="3701632">emBits</span>&nbsp;<span class="builtintype" id="3701639">int</span><span class="op" id="3701642">,</span>&nbsp;<span class="ident" id="3701644">salt</span>&nbsp;<span class="op" id="3701649">[</span><span class="op" id="3701650">]</span><span class="builtintype" id="3701651">byte</span><span class="op" id="3701655">,</span>&nbsp;<span class="ident" id="3701657">hash</span>&nbsp;<span class="ident" id="3701662">hash</span><span class="op" id="3701666">.</span><span class="ident" id="3701667">Hash</span><span class="op" id="3701671">)</span>&nbsp;<span class="op" id="3701673">(</span><span class="op" id="3701674">[</span><span class="op" id="3701675">]</span><span class="builtintype" id="3701676">byte</span><span class="op" id="3701680">,</span>&nbsp;<span class="builtintype" id="3701682">error</span><span class="op" id="3701687">)</span>&nbsp;<span class="op" id="3701689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701692">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701719">hLen</span>&nbsp;<span class="op" id="3701724">:=</span>&nbsp;<span class="ident" id="3701727">hash</span><span class="op" id="3701731">.</span><span class="ident" id="3701732">Size</span><span class="op" id="3701736">(</span><span class="op" id="3701737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701740">sLen</span>&nbsp;<span class="op" id="3701745">:=</span>&nbsp;<span class="builtinfunc" id="3701748">len</span><span class="op" id="3701751">(</span><span class="ident" id="3701752">salt</span><span class="op" id="3701756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3701759">emLen</span>&nbsp;<span class="op" id="3701765">:=</span>&nbsp;<span class="op" id="3701768">(</span><span class="ident" id="3701769">emBits</span>&nbsp;<span class="op" id="3701776">+</span>&nbsp;<span class="num" id="3701778">7</span><span class="op" id="3701779">)</span>&nbsp;<span class="op" id="3701781">/</span>&nbsp;<span class="num" id="3701783">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701787">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701859">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701930">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701954">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3701958">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702020">if</span>&nbsp;<span class="builtinfunc" id="3702023">len</span><span class="op" id="3702026">(</span><span class="ident" id="3702027">mHash</span><span class="op" id="3702032">)</span>&nbsp;<span class="op" id="3702034">!=</span>&nbsp;<span class="ident" id="3702037">hLen</span>&nbsp;<span class="op" id="3702042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702046">return</span>&nbsp;<span class="ident" id="3702053">nil</span><span class="op" id="3702056">,</span>&nbsp;<span class="ident" id="3702058">errors</span><span class="op" id="3702064">.</span><span class="ident" id="3702065">New</span><span class="op" id="3702068">(</span><span class="string" id="3702069">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="3702111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702114">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702118">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702189">if</span>&nbsp;<span class="ident" id="3702192">emLen</span>&nbsp;<span class="op" id="3702198">&lt;</span>&nbsp;<span class="ident" id="3702200">hLen</span><span class="op" id="3702204">+</span><span class="ident" id="3702205">sLen</span><span class="op" id="3702209">+</span><span class="num" id="3702210">2</span>&nbsp;<span class="op" id="3702212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702216">return</span>&nbsp;<span class="ident" id="3702223">nil</span><span class="op" id="3702226">,</span>&nbsp;<span class="ident" id="3702228">errors</span><span class="op" id="3702234">.</span><span class="ident" id="3702235">New</span><span class="op" id="3702238">(</span><span class="string" id="3702239">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="3702267">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3702270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702274">em</span>&nbsp;<span class="op" id="3702277">:=</span>&nbsp;<span class="builtinfunc" id="3702280">make</span><span class="op" id="3702284">(</span><span class="op" id="3702285">[</span><span class="op" id="3702286">]</span><span class="builtintype" id="3702287">byte</span><span class="op" id="3702291">,</span>&nbsp;<span class="ident" id="3702293">emLen</span><span class="op" id="3702298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702301">db</span>&nbsp;<span class="op" id="3702304">:=</span>&nbsp;<span class="ident" id="3702307">em</span><span class="op" id="3702309">[</span><span class="op" id="3702310">:</span><span class="ident" id="3702311">emLen</span><span class="op" id="3702316">-</span><span class="ident" id="3702317">sLen</span><span class="op" id="3702321">-</span><span class="ident" id="3702322">hLen</span><span class="op" id="3702326">-</span><span class="num" id="3702327">2</span><span class="op" id="3702328">+</span><span class="num" id="3702329">1</span><span class="op" id="3702330">+</span><span class="ident" id="3702331">sLen</span><span class="op" id="3702335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702338">h</span>&nbsp;<span class="op" id="3702340">:=</span>&nbsp;<span class="ident" id="3702343">em</span><span class="op" id="3702345">[</span><span class="ident" id="3702346">emLen</span><span class="op" id="3702351">-</span><span class="ident" id="3702352">sLen</span><span class="op" id="3702356">-</span><span class="ident" id="3702357">hLen</span><span class="op" id="3702361">-</span><span class="num" id="3702362">2</span><span class="op" id="3702363">+</span><span class="num" id="3702364">1</span><span class="op" id="3702365">+</span><span class="ident" id="3702366">sLen</span>&nbsp;<span class="op" id="3702371">:</span>&nbsp;<span class="ident" id="3702373">emLen</span><span class="op" id="3702378">-</span><span class="num" id="3702379">1</span><span class="op" id="3702380">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702384">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702457">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702496">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702500">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702512">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702573">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702577">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702644">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702673">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702677">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3702736">var</span>&nbsp;<span class="ident" id="3702740">prefix</span>&nbsp;<span class="op" id="3702747">[</span><span class="num" id="3702748">8</span><span class="op" id="3702749">]</span><span class="builtintype" id="3702750">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702757">hash</span><span class="op" id="3702761">.</span><span class="ident" id="3702762">Write</span><span class="op" id="3702767">(</span><span class="ident" id="3702768">prefix</span><span class="op" id="3702774">[</span><span class="op" id="3702775">:</span><span class="op" id="3702776">]</span><span class="op" id="3702777">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702780">hash</span><span class="op" id="3702784">.</span><span class="ident" id="3702785">Write</span><span class="op" id="3702790">(</span><span class="ident" id="3702791">mHash</span><span class="op" id="3702796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702799">hash</span><span class="op" id="3702803">.</span><span class="ident" id="3702804">Write</span><span class="op" id="3702809">(</span><span class="ident" id="3702810">salt</span><span class="op" id="3702814">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702818">h</span>&nbsp;<span class="op" id="3702820">=</span>&nbsp;<span class="ident" id="3702822">hash</span><span class="op" id="3702826">.</span><span class="ident" id="3702827">Sum</span><span class="op" id="3702830">(</span><span class="ident" id="3702831">h</span><span class="op" id="3702832">[</span><span class="op" id="3702833">:</span><span class="num" id="3702834">0</span><span class="op" id="3702835">]</span><span class="op" id="3702836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3702839">hash</span><span class="op" id="3702843">.</span><span class="ident" id="3702844">Reset</span><span class="op" id="3702849">(</span><span class="op" id="3702850">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702854">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702928">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702977">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3702981">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703050">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703077">db</span><span class="op" id="3703079">[</span><span class="ident" id="3703080">emLen</span><span class="op" id="3703085">-</span><span class="ident" id="3703086">sLen</span><span class="op" id="3703090">-</span><span class="ident" id="3703091">hLen</span><span class="op" id="3703095">-</span><span class="num" id="3703096">2</span><span class="op" id="3703097">]</span>&nbsp;<span class="op" id="3703099">=</span>&nbsp;<span class="num" id="3703101">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3703107">copy</span><span class="op" id="3703111">(</span><span class="ident" id="3703112">db</span><span class="op" id="3703114">[</span><span class="ident" id="3703115">emLen</span><span class="op" id="3703120">-</span><span class="ident" id="3703121">sLen</span><span class="op" id="3703125">-</span><span class="ident" id="3703126">hLen</span><span class="op" id="3703130">-</span><span class="num" id="3703131">1</span><span class="op" id="3703132">:</span><span class="op" id="3703133">]</span><span class="op" id="3703134">,</span>&nbsp;<span class="ident" id="3703136">salt</span><span class="op" id="3703140">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703144">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703191">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703195">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703235">mgf1XOR</span><span class="op" id="3703242">(</span><span class="ident" id="3703243">db</span><span class="op" id="3703245">,</span>&nbsp;<span class="ident" id="3703247">hash</span><span class="op" id="3703251">,</span>&nbsp;<span class="ident" id="3703253">h</span><span class="op" id="3703254">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703258">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703332">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703359">db</span><span class="op" id="3703361">[</span><span class="num" id="3703362">0</span><span class="op" id="3703363">]</span>&nbsp;<span class="op" id="3703365">&amp;=</span>&nbsp;<span class="op" id="3703368">(</span><span class="num" id="3703369">0xFF</span>&nbsp;<span class="op" id="3703374">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3703377">uint</span><span class="op" id="3703381">(</span><span class="num" id="3703382">8</span><span class="op" id="3703383">*</span><span class="ident" id="3703384">emLen</span><span class="op" id="3703389">-</span><span class="ident" id="3703390">emBits</span><span class="op" id="3703396">)</span><span class="op" id="3703397">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703401">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703441">em</span><span class="op" id="3703443">[</span><span class="ident" id="3703444">emLen</span><span class="op" id="3703449">-</span><span class="num" id="3703450">1</span><span class="op" id="3703451">]</span>&nbsp;<span class="op" id="3703453">=</span>&nbsp;<span class="num" id="3703455">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703462">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703481">return</span>&nbsp;<span class="ident" id="3703488">em</span><span class="op" id="3703490">,</span>&nbsp;<span class="ident" id="3703492">nil</span><br>
<span class="lineno"></span><span class="op" id="3703496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3703499">func</span>&nbsp;<span class="ident" id="3703504">emsaPSSVerify</span><span class="op" id="3703517">(</span><span class="ident" id="3703518">mHash</span><span class="op" id="3703523">,</span>&nbsp;<span class="ident" id="3703525">em</span>&nbsp;<span class="op" id="3703528">[</span><span class="op" id="3703529">]</span><span class="builtintype" id="3703530">byte</span><span class="op" id="3703534">,</span>&nbsp;<span class="ident" id="3703536">emBits</span><span class="op" id="3703542">,</span>&nbsp;<span class="ident" id="3703544">sLen</span>&nbsp;<span class="builtintype" id="3703549">int</span><span class="op" id="3703552">,</span>&nbsp;<span class="ident" id="3703554">hash</span>&nbsp;<span class="ident" id="3703559">hash</span><span class="op" id="3703563">.</span><span class="ident" id="3703564">Hash</span><span class="op" id="3703568">)</span>&nbsp;<span class="builtintype" id="3703570">error</span>&nbsp;<span class="op" id="3703576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703579">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703651">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703724">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703742">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703746">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703807">hLen</span>&nbsp;<span class="op" id="3703812">:=</span>&nbsp;<span class="ident" id="3703815">hash</span><span class="op" id="3703819">.</span><span class="ident" id="3703820">Size</span><span class="op" id="3703824">(</span><span class="op" id="3703825">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703828">if</span>&nbsp;<span class="ident" id="3703831">hLen</span>&nbsp;<span class="op" id="3703836">!=</span>&nbsp;<span class="builtinfunc" id="3703839">len</span><span class="op" id="3703842">(</span><span class="ident" id="3703843">mHash</span><span class="op" id="3703848">)</span>&nbsp;<span class="op" id="3703850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703854">return</span>&nbsp;<span class="ident" id="3703861">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3703878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3703882">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3703950">emLen</span>&nbsp;<span class="op" id="3703956">:=</span>&nbsp;<span class="op" id="3703959">(</span><span class="ident" id="3703960">emBits</span>&nbsp;<span class="op" id="3703967">+</span>&nbsp;<span class="num" id="3703969">7</span><span class="op" id="3703970">)</span>&nbsp;<span class="op" id="3703972">/</span>&nbsp;<span class="num" id="3703974">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3703977">if</span>&nbsp;<span class="ident" id="3703980">emLen</span>&nbsp;<span class="op" id="3703986">&lt;</span>&nbsp;<span class="ident" id="3703988">hLen</span><span class="op" id="3703992">+</span><span class="ident" id="3703993">sLen</span><span class="op" id="3703997">+</span><span class="num" id="3703998">2</span>&nbsp;<span class="op" id="3704000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704004">return</span>&nbsp;<span class="ident" id="3704011">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704032">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704101">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704147">if</span>&nbsp;<span class="ident" id="3704150">em</span><span class="op" id="3704152">[</span><span class="builtinfunc" id="3704153">len</span><span class="op" id="3704156">(</span><span class="ident" id="3704157">em</span><span class="op" id="3704159">)</span><span class="op" id="3704160">-</span><span class="num" id="3704161">1</span><span class="op" id="3704162">]</span>&nbsp;<span class="op" id="3704164">!=</span>&nbsp;<span class="num" id="3704167">0xBC</span>&nbsp;<span class="op" id="3704172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704176">return</span>&nbsp;<span class="ident" id="3704183">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704200">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704204">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704276">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704315">db</span>&nbsp;<span class="op" id="3704318">:=</span>&nbsp;<span class="ident" id="3704321">em</span><span class="op" id="3704323">[</span><span class="op" id="3704324">:</span><span class="ident" id="3704325">emLen</span><span class="op" id="3704330">-</span><span class="ident" id="3704331">hLen</span><span class="op" id="3704335">-</span><span class="num" id="3704336">1</span><span class="op" id="3704337">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704340">h</span>&nbsp;<span class="op" id="3704342">:=</span>&nbsp;<span class="ident" id="3704345">em</span><span class="op" id="3704347">[</span><span class="ident" id="3704348">emLen</span><span class="op" id="3704353">-</span><span class="ident" id="3704354">hLen</span><span class="op" id="3704358">-</span><span class="num" id="3704359">1</span>&nbsp;<span class="op" id="3704361">:</span>&nbsp;<span class="builtinfunc" id="3704363">len</span><span class="op" id="3704366">(</span><span class="ident" id="3704367">em</span><span class="op" id="3704369">)</span><span class="op" id="3704370">-</span><span class="num" id="3704371">1</span><span class="op" id="3704372">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704376">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704449">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704519">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704533">if</span>&nbsp;<span class="ident" id="3704536">em</span><span class="op" id="3704538">[</span><span class="num" id="3704539">0</span><span class="op" id="3704540">]</span><span class="op" id="3704541">&amp;</span><span class="op" id="3704542">(</span><span class="num" id="3704543">0xFF</span><span class="op" id="3704547">&lt;&lt;</span><span class="builtintype" id="3704549">uint</span><span class="op" id="3704553">(</span><span class="num" id="3704554">8</span><span class="op" id="3704555">-</span><span class="op" id="3704556">(</span><span class="num" id="3704557">8</span><span class="op" id="3704558">*</span><span class="ident" id="3704559">emLen</span><span class="op" id="3704564">-</span><span class="ident" id="3704565">emBits</span><span class="op" id="3704571">)</span><span class="op" id="3704572">)</span><span class="op" id="3704573">)</span>&nbsp;<span class="op" id="3704575">!=</span>&nbsp;<span class="num" id="3704578">0</span>&nbsp;<span class="op" id="3704580">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704584">return</span>&nbsp;<span class="ident" id="3704591">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3704608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704612">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704659">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704663">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704702">mgf1XOR</span><span class="op" id="3704709">(</span><span class="ident" id="3704710">db</span><span class="op" id="3704712">,</span>&nbsp;<span class="ident" id="3704714">hash</span><span class="op" id="3704718">,</span>&nbsp;<span class="ident" id="3704720">h</span><span class="op" id="3704721">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704725">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3704802">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704819">db</span><span class="op" id="3704821">[</span><span class="num" id="3704822">0</span><span class="op" id="3704823">]</span>&nbsp;<span class="op" id="3704825">&amp;=</span>&nbsp;<span class="op" id="3704828">(</span><span class="num" id="3704829">0xFF</span>&nbsp;<span class="op" id="3704834">&gt;&gt;</span>&nbsp;<span class="builtintype" id="3704837">uint</span><span class="op" id="3704841">(</span><span class="num" id="3704842">8</span><span class="op" id="3704843">*</span><span class="ident" id="3704844">emLen</span><span class="op" id="3704849">-</span><span class="ident" id="3704850">emBits</span><span class="op" id="3704856">)</span><span class="op" id="3704857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704861">if</span>&nbsp;<span class="ident" id="3704864">sLen</span>&nbsp;<span class="op" id="3704869">==</span>&nbsp;<span class="ident" id="3704872">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="3704890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3704893">FindSaltLength</span><span class="op" id="3704907">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704911">for</span>&nbsp;<span class="ident" id="3704915">sLen</span>&nbsp;<span class="op" id="3704920">=</span>&nbsp;<span class="ident" id="3704922">emLen</span>&nbsp;<span class="op" id="3704928">-</span>&nbsp;<span class="op" id="3704930">(</span><span class="ident" id="3704931">hLen</span>&nbsp;<span class="op" id="3704936">+</span>&nbsp;<span class="num" id="3704938">2</span><span class="op" id="3704939">)</span><span class="op" id="3704940">;</span>&nbsp;<span class="ident" id="3704942">sLen</span>&nbsp;<span class="op" id="3704947">&gt;=</span>&nbsp;<span class="num" id="3704950">0</span><span class="op" id="3704951">;</span>&nbsp;<span class="ident" id="3704953">sLen</span><span class="op" id="3704957">--</span>&nbsp;<span class="op" id="3704960">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704965">switch</span>&nbsp;<span class="ident" id="3704972">db</span><span class="op" id="3704974">[</span><span class="ident" id="3704975">emLen</span><span class="op" id="3704980">-</span><span class="ident" id="3704981">hLen</span><span class="op" id="3704985">-</span><span class="ident" id="3704986">sLen</span><span class="op" id="3704990">-</span><span class="num" id="3704991">2</span><span class="op" id="3704992">]</span>&nbsp;<span class="op" id="3704994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3704999">case</span>&nbsp;<span class="num" id="3705004">1</span><span class="op" id="3705005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705011">break</span>&nbsp;<span class="ident" id="3705017">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705035">case</span>&nbsp;<span class="num" id="3705040">0</span><span class="op" id="3705041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705047">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705059">default</span><span class="op" id="3705066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705072">return</span>&nbsp;<span class="ident" id="3705079">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705106">if</span>&nbsp;<span class="ident" id="3705109">sLen</span>&nbsp;<span class="op" id="3705114">&lt;</span>&nbsp;<span class="num" id="3705116">0</span>&nbsp;<span class="op" id="3705118">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705123">return</span>&nbsp;<span class="ident" id="3705130">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705151">}</span>&nbsp;<span class="keyword" id="3705153">else</span>&nbsp;<span class="op" id="3705158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705162">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705237">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705312">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705385">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705426">for</span>&nbsp;<span class="ident" id="3705430">_</span><span class="op" id="3705431">,</span>&nbsp;<span class="ident" id="3705433">e</span>&nbsp;<span class="op" id="3705435">:=</span>&nbsp;<span class="keyword" id="3705438">range</span>&nbsp;<span class="ident" id="3705444">db</span><span class="op" id="3705446">[</span><span class="op" id="3705447">:</span><span class="ident" id="3705448">emLen</span><span class="op" id="3705453">-</span><span class="ident" id="3705454">hLen</span><span class="op" id="3705458">-</span><span class="ident" id="3705459">sLen</span><span class="op" id="3705463">-</span><span class="num" id="3705464">2</span><span class="op" id="3705465">]</span>&nbsp;<span class="op" id="3705467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705472">if</span>&nbsp;<span class="ident" id="3705475">e</span>&nbsp;<span class="op" id="3705477">!=</span>&nbsp;<span class="num" id="3705480">0x00</span>&nbsp;<span class="op" id="3705485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705491">return</span>&nbsp;<span class="ident" id="3705498">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705525">if</span>&nbsp;<span class="ident" id="3705528">db</span><span class="op" id="3705530">[</span><span class="ident" id="3705531">emLen</span><span class="op" id="3705536">-</span><span class="ident" id="3705537">hLen</span><span class="op" id="3705541">-</span><span class="ident" id="3705542">sLen</span><span class="op" id="3705546">-</span><span class="num" id="3705547">2</span><span class="op" id="3705548">]</span>&nbsp;<span class="op" id="3705550">!=</span>&nbsp;<span class="num" id="3705553">0x01</span>&nbsp;<span class="op" id="3705558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705563">return</span>&nbsp;<span class="ident" id="3705570">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705588">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3705591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705595">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705644">salt</span>&nbsp;<span class="op" id="3705649">:=</span>&nbsp;<span class="ident" id="3705652">db</span><span class="op" id="3705654">[</span><span class="builtinfunc" id="3705655">len</span><span class="op" id="3705658">(</span><span class="ident" id="3705659">db</span><span class="op" id="3705661">)</span><span class="op" id="3705662">-</span><span class="ident" id="3705663">sLen</span><span class="op" id="3705667">:</span><span class="op" id="3705668">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705672">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705685">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705750">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705817">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705846">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3705850">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3705909">var</span>&nbsp;<span class="ident" id="3705913">prefix</span>&nbsp;<span class="op" id="3705920">[</span><span class="num" id="3705921">8</span><span class="op" id="3705922">]</span><span class="builtintype" id="3705923">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705929">hash</span><span class="op" id="3705933">.</span><span class="ident" id="3705934">Write</span><span class="op" id="3705939">(</span><span class="ident" id="3705940">prefix</span><span class="op" id="3705946">[</span><span class="op" id="3705947">:</span><span class="op" id="3705948">]</span><span class="op" id="3705949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705952">hash</span><span class="op" id="3705956">.</span><span class="ident" id="3705957">Write</span><span class="op" id="3705962">(</span><span class="ident" id="3705963">mHash</span><span class="op" id="3705968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705971">hash</span><span class="op" id="3705975">.</span><span class="ident" id="3705976">Write</span><span class="op" id="3705981">(</span><span class="ident" id="3705982">salt</span><span class="op" id="3705986">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3705990">h0</span>&nbsp;<span class="op" id="3705993">:=</span>&nbsp;<span class="ident" id="3705996">hash</span><span class="op" id="3706000">.</span><span class="ident" id="3706001">Sum</span><span class="op" id="3706004">(</span><span class="ident" id="3706005">nil</span><span class="op" id="3706008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706012">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706086">if</span>&nbsp;<span class="op" id="3706089">!</span><span class="ident" id="3706090">bytes</span><span class="op" id="3706095">.</span><span class="ident" id="3706096">Equal</span><span class="op" id="3706101">(</span><span class="ident" id="3706102">h0</span><span class="op" id="3706104">,</span>&nbsp;<span class="ident" id="3706106">h</span><span class="op" id="3706107">)</span>&nbsp;<span class="op" id="3706109">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706113">return</span>&nbsp;<span class="ident" id="3706120">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706140">return</span>&nbsp;<span class="ident" id="3706147">nil</span><br>
<span class="lineno"></span><span class="op" id="3706151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3706154">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="3706243">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3706321">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3706401">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="3706440">func</span>&nbsp;<span class="ident" id="3706445">signPSSWithSalt</span><span class="op" id="3706460">(</span><span class="ident" id="3706461">rand</span>&nbsp;<span class="ident" id="3706466">io</span><span class="op" id="3706468">.</span><span class="ident" id="3706469">Reader</span><span class="op" id="3706475">,</span>&nbsp;<span class="ident" id="3706477">priv</span>&nbsp;<span class="op" id="3706482">*</span><span class="ident" id="3706483">PrivateKey</span><span class="op" id="3706493">,</span>&nbsp;<span class="ident" id="3706495">hash</span>&nbsp;<span class="ident" id="3706500">crypto</span><span class="op" id="3706506">.</span><span class="ident" id="3706507">Hash</span><span class="op" id="3706511">,</span>&nbsp;<span class="ident" id="3706513">hashed</span><span class="op" id="3706519">,</span>&nbsp;<span class="ident" id="3706521">salt</span>&nbsp;<span class="op" id="3706526">[</span><span class="op" id="3706527">]</span><span class="builtintype" id="3706528">byte</span><span class="op" id="3706532">)</span>&nbsp;<span class="op" id="3706534">(</span><span class="ident" id="3706535">s</span>&nbsp;<span class="op" id="3706537">[</span><span class="op" id="3706538">]</span><span class="builtintype" id="3706539">byte</span><span class="op" id="3706543">,</span>&nbsp;<span class="ident" id="3706545">err</span>&nbsp;<span class="builtintype" id="3706549">error</span><span class="op" id="3706554">)</span>&nbsp;<span class="op" id="3706556">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706559">nBits</span>&nbsp;<span class="op" id="3706565">:=</span>&nbsp;<span class="ident" id="3706568">priv</span><span class="op" id="3706572">.</span><span class="ident" id="3706573">N</span><span class="op" id="3706574">.</span><span class="ident" id="3706575">BitLen</span><span class="op" id="3706581">(</span><span class="op" id="3706582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706585">em</span><span class="op" id="3706587">,</span>&nbsp;<span class="ident" id="3706589">err</span>&nbsp;<span class="op" id="3706593">:=</span>&nbsp;<span class="ident" id="3706596">emsaPSSEncode</span><span class="op" id="3706609">(</span><span class="ident" id="3706610">hashed</span><span class="op" id="3706616">,</span>&nbsp;<span class="ident" id="3706618">nBits</span><span class="op" id="3706623">-</span><span class="num" id="3706624">1</span><span class="op" id="3706625">,</span>&nbsp;<span class="ident" id="3706627">salt</span><span class="op" id="3706631">,</span>&nbsp;<span class="ident" id="3706633">hash</span><span class="op" id="3706637">.</span><span class="ident" id="3706638">New</span><span class="op" id="3706641">(</span><span class="op" id="3706642">)</span><span class="op" id="3706643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706646">if</span>&nbsp;<span class="ident" id="3706649">err</span>&nbsp;<span class="op" id="3706653">!=</span>&nbsp;<span class="ident" id="3706656">nil</span>&nbsp;<span class="op" id="3706660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706664">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706672">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706675">m</span>&nbsp;<span class="op" id="3706677">:=</span>&nbsp;<span class="builtinfunc" id="3706680">new</span><span class="op" id="3706683">(</span><span class="ident" id="3706684">big</span><span class="op" id="3706687">.</span><span class="ident" id="3706688">Int</span><span class="op" id="3706691">)</span><span class="op" id="3706692">.</span><span class="ident" id="3706693">SetBytes</span><span class="op" id="3706701">(</span><span class="ident" id="3706702">em</span><span class="op" id="3706704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706707">c</span><span class="op" id="3706708">,</span>&nbsp;<span class="ident" id="3706710">err</span>&nbsp;<span class="op" id="3706714">:=</span>&nbsp;<span class="ident" id="3706717">decrypt</span><span class="op" id="3706724">(</span><span class="ident" id="3706725">rand</span><span class="op" id="3706729">,</span>&nbsp;<span class="ident" id="3706731">priv</span><span class="op" id="3706735">,</span>&nbsp;<span class="ident" id="3706737">m</span><span class="op" id="3706738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706741">if</span>&nbsp;<span class="ident" id="3706744">err</span>&nbsp;<span class="op" id="3706748">!=</span>&nbsp;<span class="ident" id="3706751">nil</span>&nbsp;<span class="op" id="3706755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706759">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3706767">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706770">s</span>&nbsp;<span class="op" id="3706772">=</span>&nbsp;<span class="builtinfunc" id="3706774">make</span><span class="op" id="3706778">(</span><span class="op" id="3706779">[</span><span class="op" id="3706780">]</span><span class="builtintype" id="3706781">byte</span><span class="op" id="3706785">,</span>&nbsp;<span class="op" id="3706787">(</span><span class="ident" id="3706788">nBits</span><span class="op" id="3706793">+</span><span class="num" id="3706794">7</span><span class="op" id="3706795">)</span><span class="op" id="3706796">/</span><span class="num" id="3706797">8</span><span class="op" id="3706798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706801">copyWithLeftPad</span><span class="op" id="3706816">(</span><span class="ident" id="3706817">s</span><span class="op" id="3706818">,</span>&nbsp;<span class="ident" id="3706820">c</span><span class="op" id="3706821">.</span><span class="ident" id="3706822">Bytes</span><span class="op" id="3706827">(</span><span class="op" id="3706828">)</span><span class="op" id="3706829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3706832">return</span><br>
<span class="lineno"></span><span class="op" id="3706839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3706842">const</span>&nbsp;<span class="op" id="3706848">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706851">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3706923">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3706993">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="3707011">=</span>&nbsp;<span class="num" id="3707013">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707016">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707087">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707126">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="3707150">=</span>&nbsp;<span class="op" id="3707152">-</span><span class="num" id="3707153">1</span><br>
<span class="lineno"></span><span class="op" id="3707155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3707158">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="3707232">type</span>&nbsp;<span class="ident" id="3707237">PSSOptions</span>&nbsp;<span class="keyword" id="3707248">struct</span>&nbsp;<span class="op" id="3707255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707258">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707321">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707394">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707423">SaltLength</span>&nbsp;<span class="builtintype" id="3707434">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707440">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707510">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3707579">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3707608">Hash</span>&nbsp;<span class="ident" id="3707613">crypto</span><span class="op" id="3707619">.</span><span class="ident" id="3707620">Hash</span><br>
<span class="lineno">230</span><span class="op" id="3707625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3707628">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="3707691">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="3707713">func</span>&nbsp;<span class="op" id="3707718">(</span><span class="ident" id="3707719">pssOpts</span>&nbsp;<span class="op" id="3707727">*</span><span class="ident" id="3707728">PSSOptions</span><span class="op" id="3707738">)</span>&nbsp;<span class="ident" id="3707740">HashFunc</span><span class="op" id="3707748">(</span><span class="op" id="3707749">)</span>&nbsp;<span class="ident" id="3707751">crypto</span><span class="op" id="3707757">.</span><span class="ident" id="3707758">Hash</span>&nbsp;<span class="op" id="3707763">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707766">return</span>&nbsp;<span class="ident" id="3707773">pssOpts</span><span class="op" id="3707780">.</span><span class="ident" id="3707781">Hash</span><br>
<span class="lineno"></span><span class="op" id="3707786">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3707789">func</span>&nbsp;<span class="op" id="3707794">(</span><span class="ident" id="3707795">opts</span>&nbsp;<span class="op" id="3707800">*</span><span class="ident" id="3707801">PSSOptions</span><span class="op" id="3707811">)</span>&nbsp;<span class="ident" id="3707813">saltLength</span><span class="op" id="3707823">(</span><span class="op" id="3707824">)</span>&nbsp;<span class="builtintype" id="3707826">int</span>&nbsp;<span class="op" id="3707830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707833">if</span>&nbsp;<span class="ident" id="3707836">opts</span>&nbsp;<span class="op" id="3707841">==</span>&nbsp;<span class="ident" id="3707844">nil</span>&nbsp;<span class="op" id="3707848">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707852">return</span>&nbsp;<span class="ident" id="3707859">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3707878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3707881">return</span>&nbsp;<span class="ident" id="3707888">opts</span><span class="op" id="3707892">.</span><span class="ident" id="3707893">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="3707904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3707907">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="3707975">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3708053">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="3708130">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3708152">func</span>&nbsp;<span class="ident" id="3708157">SignPSS</span><span class="op" id="3708164">(</span><span class="ident" id="3708165">rand</span>&nbsp;<span class="ident" id="3708170">io</span><span class="op" id="3708172">.</span><span class="ident" id="3708173">Reader</span><span class="op" id="3708179">,</span>&nbsp;<span class="ident" id="3708181">priv</span>&nbsp;<span class="op" id="3708186">*</span><span class="ident" id="3708187">PrivateKey</span><span class="op" id="3708197">,</span>&nbsp;<span class="ident" id="3708199">hash</span>&nbsp;<span class="ident" id="3708204">crypto</span><span class="op" id="3708210">.</span><span class="ident" id="3708211">Hash</span><span class="op" id="3708215">,</span>&nbsp;<span class="ident" id="3708217">hashed</span>&nbsp;<span class="op" id="3708224">[</span><span class="op" id="3708225">]</span><span class="builtintype" id="3708226">byte</span><span class="op" id="3708230">,</span>&nbsp;<span class="ident" id="3708232">opts</span>&nbsp;<span class="op" id="3708237">*</span><span class="ident" id="3708238">PSSOptions</span><span class="op" id="3708248">)</span>&nbsp;<span class="op" id="3708250">(</span><span class="ident" id="3708251">s</span>&nbsp;<span class="op" id="3708253">[</span><span class="op" id="3708254">]</span><span class="builtintype" id="3708255">byte</span><span class="op" id="3708259">,</span>&nbsp;<span class="ident" id="3708261">err</span>&nbsp;<span class="builtintype" id="3708265">error</span><span class="op" id="3708270">)</span>&nbsp;<span class="op" id="3708272">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708275">saltLength</span>&nbsp;<span class="op" id="3708286">:=</span>&nbsp;<span class="ident" id="3708289">opts</span><span class="op" id="3708293">.</span><span class="ident" id="3708294">saltLength</span><span class="op" id="3708304">(</span><span class="op" id="3708305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708308">switch</span>&nbsp;<span class="ident" id="3708315">saltLength</span>&nbsp;<span class="op" id="3708326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708329">case</span>&nbsp;<span class="ident" id="3708334">PSSSaltLengthAuto</span><span class="op" id="3708351">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708355">saltLength</span>&nbsp;<span class="op" id="3708366">=</span>&nbsp;<span class="op" id="3708368">(</span><span class="ident" id="3708369">priv</span><span class="op" id="3708373">.</span><span class="ident" id="3708374">N</span><span class="op" id="3708375">.</span><span class="ident" id="3708376">BitLen</span><span class="op" id="3708382">(</span><span class="op" id="3708383">)</span><span class="op" id="3708384">+</span><span class="num" id="3708385">7</span><span class="op" id="3708386">)</span><span class="op" id="3708387">/</span><span class="num" id="3708388">8</span>&nbsp;<span class="op" id="3708390">-</span>&nbsp;<span class="num" id="3708392">2</span>&nbsp;<span class="op" id="3708394">-</span>&nbsp;<span class="ident" id="3708396">hash</span><span class="op" id="3708400">.</span><span class="ident" id="3708401">Size</span><span class="op" id="3708405">(</span><span class="op" id="3708406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708409">case</span>&nbsp;<span class="ident" id="3708414">PSSSaltLengthEqualsHash</span><span class="op" id="3708437">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708441">saltLength</span>&nbsp;<span class="op" id="3708452">=</span>&nbsp;<span class="ident" id="3708454">hash</span><span class="op" id="3708458">.</span><span class="ident" id="3708459">Size</span><span class="op" id="3708463">(</span><span class="op" id="3708464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708471">if</span>&nbsp;<span class="ident" id="3708474">opts</span><span class="op" id="3708478">.</span><span class="ident" id="3708479">Hash</span>&nbsp;<span class="op" id="3708484">!=</span>&nbsp;<span class="num" id="3708487">0</span>&nbsp;<span class="op" id="3708489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708493">hash</span>&nbsp;<span class="op" id="3708498">=</span>&nbsp;<span class="ident" id="3708500">opts</span><span class="op" id="3708504">.</span><span class="ident" id="3708505">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3708515">salt</span>&nbsp;<span class="op" id="3708520">:=</span>&nbsp;<span class="builtinfunc" id="3708523">make</span><span class="op" id="3708527">(</span><span class="op" id="3708528">[</span><span class="op" id="3708529">]</span><span class="builtintype" id="3708530">byte</span><span class="op" id="3708534">,</span>&nbsp;<span class="ident" id="3708536">saltLength</span><span class="op" id="3708546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708549">if</span>&nbsp;<span class="ident" id="3708552">_</span><span class="op" id="3708553">,</span>&nbsp;<span class="ident" id="3708555">err</span>&nbsp;<span class="op" id="3708559">=</span>&nbsp;<span class="ident" id="3708561">io</span><span class="op" id="3708563">.</span><span class="ident" id="3708564">ReadFull</span><span class="op" id="3708572">(</span><span class="ident" id="3708573">rand</span><span class="op" id="3708577">,</span>&nbsp;<span class="ident" id="3708579">salt</span><span class="op" id="3708583">)</span><span class="op" id="3708584">;</span>&nbsp;<span class="ident" id="3708586">err</span>&nbsp;<span class="op" id="3708590">!=</span>&nbsp;<span class="ident" id="3708593">nil</span>&nbsp;<span class="op" id="3708597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708601">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3708609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3708612">return</span>&nbsp;<span class="ident" id="3708619">signPSSWithSalt</span><span class="op" id="3708634">(</span><span class="ident" id="3708635">rand</span><span class="op" id="3708639">,</span>&nbsp;<span class="ident" id="3708641">priv</span><span class="op" id="3708645">,</span>&nbsp;<span class="ident" id="3708647">hash</span><span class="op" id="3708651">,</span>&nbsp;<span class="ident" id="3708653">hashed</span><span class="op" id="3708659">,</span>&nbsp;<span class="ident" id="3708661">salt</span><span class="op" id="3708665">)</span><br>
<span class="lineno"></span><span class="op" id="3708667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3708670">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="3708709">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="3708783">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="3708855">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="3708934">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3708956">func</span>&nbsp;<span class="ident" id="3708961">VerifyPSS</span><span class="op" id="3708970">(</span><span class="ident" id="3708971">pub</span>&nbsp;<span class="op" id="3708975">*</span><span class="ident" id="3708976">PublicKey</span><span class="op" id="3708985">,</span>&nbsp;<span class="ident" id="3708987">hash</span>&nbsp;<span class="ident" id="3708992">crypto</span><span class="op" id="3708998">.</span><span class="ident" id="3708999">Hash</span><span class="op" id="3709003">,</span>&nbsp;<span class="ident" id="3709005">hashed</span>&nbsp;<span class="op" id="3709012">[</span><span class="op" id="3709013">]</span><span class="builtintype" id="3709014">byte</span><span class="op" id="3709018">,</span>&nbsp;<span class="ident" id="3709020">sig</span>&nbsp;<span class="op" id="3709024">[</span><span class="op" id="3709025">]</span><span class="builtintype" id="3709026">byte</span><span class="op" id="3709030">,</span>&nbsp;<span class="ident" id="3709032">opts</span>&nbsp;<span class="op" id="3709037">*</span><span class="ident" id="3709038">PSSOptions</span><span class="op" id="3709048">)</span>&nbsp;<span class="builtintype" id="3709050">error</span>&nbsp;<span class="op" id="3709056">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709059">return</span>&nbsp;<span class="ident" id="3709066">verifyPSS</span><span class="op" id="3709075">(</span><span class="ident" id="3709076">pub</span><span class="op" id="3709079">,</span>&nbsp;<span class="ident" id="3709081">hash</span><span class="op" id="3709085">,</span>&nbsp;<span class="ident" id="3709087">hashed</span><span class="op" id="3709093">,</span>&nbsp;<span class="ident" id="3709095">sig</span><span class="op" id="3709098">,</span>&nbsp;<span class="ident" id="3709100">opts</span><span class="op" id="3709104">.</span><span class="ident" id="3709105">saltLength</span><span class="op" id="3709115">(</span><span class="op" id="3709116">)</span><span class="op" id="3709117">)</span><br>
<span class="lineno"></span><span class="op" id="3709119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3709122">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="3709188">func</span>&nbsp;<span class="ident" id="3709193">verifyPSS</span><span class="op" id="3709202">(</span><span class="ident" id="3709203">pub</span>&nbsp;<span class="op" id="3709207">*</span><span class="ident" id="3709208">PublicKey</span><span class="op" id="3709217">,</span>&nbsp;<span class="ident" id="3709219">hash</span>&nbsp;<span class="ident" id="3709224">crypto</span><span class="op" id="3709230">.</span><span class="ident" id="3709231">Hash</span><span class="op" id="3709235">,</span>&nbsp;<span class="ident" id="3709237">hashed</span>&nbsp;<span class="op" id="3709244">[</span><span class="op" id="3709245">]</span><span class="builtintype" id="3709246">byte</span><span class="op" id="3709250">,</span>&nbsp;<span class="ident" id="3709252">sig</span>&nbsp;<span class="op" id="3709256">[</span><span class="op" id="3709257">]</span><span class="builtintype" id="3709258">byte</span><span class="op" id="3709262">,</span>&nbsp;<span class="ident" id="3709264">saltLen</span>&nbsp;<span class="builtintype" id="3709272">int</span><span class="op" id="3709275">)</span>&nbsp;<span class="builtintype" id="3709277">error</span>&nbsp;<span class="op" id="3709283">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709286">nBits</span>&nbsp;<span class="op" id="3709292">:=</span>&nbsp;<span class="ident" id="3709295">pub</span><span class="op" id="3709298">.</span><span class="ident" id="3709299">N</span><span class="op" id="3709300">.</span><span class="ident" id="3709301">BitLen</span><span class="op" id="3709307">(</span><span class="op" id="3709308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709311">if</span>&nbsp;<span class="builtinfunc" id="3709314">len</span><span class="op" id="3709317">(</span><span class="ident" id="3709318">sig</span><span class="op" id="3709321">)</span>&nbsp;<span class="op" id="3709323">!=</span>&nbsp;<span class="op" id="3709326">(</span><span class="ident" id="3709327">nBits</span><span class="op" id="3709332">+</span><span class="num" id="3709333">7</span><span class="op" id="3709334">)</span><span class="op" id="3709335">/</span><span class="num" id="3709336">8</span>&nbsp;<span class="op" id="3709338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709342">return</span>&nbsp;<span class="ident" id="3709349">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709369">s</span>&nbsp;<span class="op" id="3709371">:=</span>&nbsp;<span class="builtinfunc" id="3709374">new</span><span class="op" id="3709377">(</span><span class="ident" id="3709378">big</span><span class="op" id="3709381">.</span><span class="ident" id="3709382">Int</span><span class="op" id="3709385">)</span><span class="op" id="3709386">.</span><span class="ident" id="3709387">SetBytes</span><span class="op" id="3709395">(</span><span class="ident" id="3709396">sig</span><span class="op" id="3709399">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709402">m</span>&nbsp;<span class="op" id="3709404">:=</span>&nbsp;<span class="ident" id="3709407">encrypt</span><span class="op" id="3709414">(</span><span class="builtinfunc" id="3709415">new</span><span class="op" id="3709418">(</span><span class="ident" id="3709419">big</span><span class="op" id="3709422">.</span><span class="ident" id="3709423">Int</span><span class="op" id="3709426">)</span><span class="op" id="3709427">,</span>&nbsp;<span class="ident" id="3709429">pub</span><span class="op" id="3709432">,</span>&nbsp;<span class="ident" id="3709434">s</span><span class="op" id="3709435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709438">emBits</span>&nbsp;<span class="op" id="3709445">:=</span>&nbsp;<span class="ident" id="3709448">nBits</span>&nbsp;<span class="op" id="3709454">-</span>&nbsp;<span class="num" id="3709456">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709459">emLen</span>&nbsp;<span class="op" id="3709465">:=</span>&nbsp;<span class="op" id="3709468">(</span><span class="ident" id="3709469">emBits</span>&nbsp;<span class="op" id="3709476">+</span>&nbsp;<span class="num" id="3709478">7</span><span class="op" id="3709479">)</span>&nbsp;<span class="op" id="3709481">/</span>&nbsp;<span class="num" id="3709483">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709486">if</span>&nbsp;<span class="ident" id="3709489">emLen</span>&nbsp;<span class="op" id="3709495">&lt;</span>&nbsp;<span class="builtinfunc" id="3709497">len</span><span class="op" id="3709500">(</span><span class="ident" id="3709501">m</span><span class="op" id="3709502">.</span><span class="ident" id="3709503">Bytes</span><span class="op" id="3709508">(</span><span class="op" id="3709509">)</span><span class="op" id="3709510">)</span>&nbsp;<span class="op" id="3709512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709516">return</span>&nbsp;<span class="ident" id="3709523">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709543">em</span>&nbsp;<span class="op" id="3709546">:=</span>&nbsp;<span class="builtinfunc" id="3709549">make</span><span class="op" id="3709553">(</span><span class="op" id="3709554">[</span><span class="op" id="3709555">]</span><span class="builtintype" id="3709556">byte</span><span class="op" id="3709560">,</span>&nbsp;<span class="ident" id="3709562">emLen</span><span class="op" id="3709567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709570">copyWithLeftPad</span><span class="op" id="3709585">(</span><span class="ident" id="3709586">em</span><span class="op" id="3709588">,</span>&nbsp;<span class="ident" id="3709590">m</span><span class="op" id="3709591">.</span><span class="ident" id="3709592">Bytes</span><span class="op" id="3709597">(</span><span class="op" id="3709598">)</span><span class="op" id="3709599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709602">if</span>&nbsp;<span class="ident" id="3709605">saltLen</span>&nbsp;<span class="op" id="3709613">==</span>&nbsp;<span class="ident" id="3709616">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="3709640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3709644">saltLen</span>&nbsp;<span class="op" id="3709652">=</span>&nbsp;<span class="ident" id="3709654">hash</span><span class="op" id="3709658">.</span><span class="ident" id="3709659">Size</span><span class="op" id="3709663">(</span><span class="op" id="3709664">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3709667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3709670">return</span>&nbsp;<span class="ident" id="3709677">emsaPSSVerify</span><span class="op" id="3709690">(</span><span class="ident" id="3709691">hashed</span><span class="op" id="3709697">,</span>&nbsp;<span class="ident" id="3709699">em</span><span class="op" id="3709701">,</span>&nbsp;<span class="ident" id="3709703">emBits</span><span class="op" id="3709709">,</span>&nbsp;<span class="ident" id="3709711">saltLen</span><span class="op" id="3709718">,</span>&nbsp;<span class="ident" id="3709720">hash</span><span class="op" id="3709724">.</span><span class="ident" id="3709725">New</span><span class="op" id="3709728">(</span><span class="op" id="3709729">)</span><span class="op" id="3709730">)</span><br>
<span class="lineno"></span><span class="op" id="3709732">}</span>
</div>
</body>
</html>
