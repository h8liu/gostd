<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4401419">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4401474">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4401528">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4401579">//go:generate&nbsp;go&nbsp;run&nbsp;decgen.go&nbsp;-output&nbsp;dec_helpers.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4401634">package</span>&nbsp;<span class="ident" id="4401642">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4401647">import</span>&nbsp;<span class="op" id="4401654">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4401657">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4401669">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4401679">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4401685">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4401693">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4401703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4401706">var</span>&nbsp;<span class="op" id="4401710">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401713">errBadUint</span>&nbsp;<span class="op" id="4401724">=</span>&nbsp;<span class="ident" id="4401726">errors</span><span class="op" id="4401732">.</span><span class="ident" id="4401733">New</span><span class="op" id="4401736">(</span><span class="string" id="4401737">&#34;gob:&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="4401781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401784">errBadType</span>&nbsp;<span class="op" id="4401795">=</span>&nbsp;<span class="ident" id="4401797">errors</span><span class="op" id="4401803">.</span><span class="ident" id="4401804">New</span><span class="op" id="4401807">(</span><span class="string" id="4401808">&#34;gob:&nbsp;unknown&nbsp;type&nbsp;id&nbsp;or&nbsp;corrupted&nbsp;data&#34;</span><span class="op" id="4401848">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4401851">errRange</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4401862">=</span>&nbsp;<span class="ident" id="4401864">errors</span><span class="op" id="4401870">.</span><span class="ident" id="4401871">New</span><span class="op" id="4401874">(</span><span class="string" id="4401875">&#34;gob:&nbsp;bad&nbsp;data:&nbsp;field&nbsp;numbers&nbsp;out&nbsp;of&nbsp;bounds&#34;</span><span class="op" id="4401919">)</span><br>
<span class="lineno"></span><span class="op" id="4401921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4401924">type</span>&nbsp;<span class="ident" id="4401929">decHelper</span>&nbsp;<span class="keyword" id="4401939">func</span><span class="op" id="4401943">(</span><span class="ident" id="4401944">state</span>&nbsp;<span class="op" id="4401950">*</span><span class="ident" id="4401951">decoderState</span><span class="op" id="4401963">,</span>&nbsp;<span class="ident" id="4401965">v</span>&nbsp;<span class="ident" id="4401967">reflect</span><span class="op" id="4401974">.</span><span class="ident" id="4401975">Value</span><span class="op" id="4401980">,</span>&nbsp;<span class="ident" id="4401982">length</span>&nbsp;<span class="builtintype" id="4401989">int</span><span class="op" id="4401992">,</span>&nbsp;<span class="ident" id="4401994">ovfl</span>&nbsp;<span class="builtintype" id="4401999">error</span><span class="op" id="4402004">)</span>&nbsp;<span class="builtintype" id="4402006">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4402012">//&nbsp;decoderState&nbsp;is&nbsp;the&nbsp;execution&nbsp;state&nbsp;of&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;decoder.&nbsp;A&nbsp;new&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="4402094">//&nbsp;is&nbsp;created&nbsp;for&nbsp;nested&nbsp;objects.</span><br>
<span class="lineno"></span><span class="keyword" id="4402128">type</span>&nbsp;<span class="ident" id="4402133">decoderState</span>&nbsp;<span class="keyword" id="4402146">struct</span>&nbsp;<span class="op" id="4402153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402156">dec</span>&nbsp;<span class="op" id="4402160">*</span><span class="ident" id="4402161">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402170">//&nbsp;The&nbsp;buffer&nbsp;is&nbsp;stored&nbsp;with&nbsp;an&nbsp;extra&nbsp;indirection&nbsp;because&nbsp;it&nbsp;may&nbsp;be&nbsp;replaced</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4402248">//&nbsp;if&nbsp;we&nbsp;load&nbsp;a&nbsp;type&nbsp;during&nbsp;decode&nbsp;(when&nbsp;reading&nbsp;an&nbsp;interface&nbsp;value).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402319">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402328">*</span><span class="ident" id="4402329">decBuffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402340">fieldnum</span>&nbsp;<span class="builtintype" id="4402349">int</span>&nbsp;<span class="comment" id="4402353">//&nbsp;the&nbsp;last&nbsp;field&nbsp;number&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402385">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402394">[</span><span class="op" id="4402395">]</span><span class="builtintype" id="4402396">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402402">next</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4402411">*</span><span class="ident" id="4402412">decoderState</span>&nbsp;<span class="comment" id="4402425">//&nbsp;for&nbsp;free&nbsp;list</span><br>
<span class="lineno">35</span><span class="op" id="4402442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4402445">//&nbsp;decBuffer&nbsp;is&nbsp;an&nbsp;extremely&nbsp;simple,&nbsp;fast&nbsp;implementation&nbsp;of&nbsp;a&nbsp;read-only&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="4402530">//&nbsp;It&nbsp;is&nbsp;initialized&nbsp;by&nbsp;calling&nbsp;Size&nbsp;and&nbsp;then&nbsp;copying&nbsp;the&nbsp;data&nbsp;into&nbsp;the&nbsp;slice&nbsp;returned&nbsp;by&nbsp;Bytes().</span><br>
<span class="lineno"></span><span class="keyword" id="4402629">type</span>&nbsp;<span class="ident" id="4402634">decBuffer</span>&nbsp;<span class="keyword" id="4402644">struct</span>&nbsp;<span class="op" id="4402651">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402654">data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4402661">[</span><span class="op" id="4402662">]</span><span class="builtintype" id="4402663">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402669">offset</span>&nbsp;<span class="builtintype" id="4402676">int</span>&nbsp;<span class="comment" id="4402680">//&nbsp;Read&nbsp;offset.</span><br>
<span class="lineno"></span><span class="op" id="4402696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4402699">func</span>&nbsp;<span class="op" id="4402704">(</span><span class="ident" id="4402705">d</span>&nbsp;<span class="op" id="4402707">*</span><span class="ident" id="4402708">decBuffer</span><span class="op" id="4402717">)</span>&nbsp;<span class="ident" id="4402719">Read</span><span class="op" id="4402723">(</span><span class="ident" id="4402724">p</span>&nbsp;<span class="op" id="4402726">[</span><span class="op" id="4402727">]</span><span class="builtintype" id="4402728">byte</span><span class="op" id="4402732">)</span>&nbsp;<span class="op" id="4402734">(</span><span class="builtintype" id="4402735">int</span><span class="op" id="4402738">,</span>&nbsp;<span class="builtintype" id="4402740">error</span><span class="op" id="4402745">)</span>&nbsp;<span class="op" id="4402747">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402750">n</span>&nbsp;<span class="op" id="4402752">:=</span>&nbsp;<span class="builtinfunc" id="4402755">copy</span><span class="op" id="4402759">(</span><span class="ident" id="4402760">p</span><span class="op" id="4402761">,</span>&nbsp;<span class="ident" id="4402763">d</span><span class="op" id="4402764">.</span><span class="ident" id="4402765">data</span><span class="op" id="4402769">[</span><span class="ident" id="4402770">d</span><span class="op" id="4402771">.</span><span class="ident" id="4402772">offset</span><span class="op" id="4402778">:</span><span class="op" id="4402779">]</span><span class="op" id="4402780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402783">if</span>&nbsp;<span class="ident" id="4402786">n</span>&nbsp;<span class="op" id="4402788">==</span>&nbsp;<span class="num" id="4402791">0</span>&nbsp;<span class="op" id="4402793">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4402796">len</span><span class="op" id="4402799">(</span><span class="ident" id="4402800">p</span><span class="op" id="4402801">)</span>&nbsp;<span class="op" id="4402803">!=</span>&nbsp;<span class="num" id="4402806">0</span>&nbsp;<span class="op" id="4402808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402812">return</span>&nbsp;<span class="num" id="4402819">0</span><span class="op" id="4402820">,</span>&nbsp;<span class="ident" id="4402822">io</span><span class="op" id="4402824">.</span><span class="ident" id="4402825">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402833">d</span><span class="op" id="4402834">.</span><span class="ident" id="4402835">offset</span>&nbsp;<span class="op" id="4402842">+=</span>&nbsp;<span class="ident" id="4402845">n</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402848">return</span>&nbsp;<span class="ident" id="4402855">n</span><span class="op" id="4402856">,</span>&nbsp;<span class="ident" id="4402858">nil</span><br>
<span class="lineno"></span><span class="op" id="4402862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4402865">func</span>&nbsp;<span class="op" id="4402870">(</span><span class="ident" id="4402871">d</span>&nbsp;<span class="op" id="4402873">*</span><span class="ident" id="4402874">decBuffer</span><span class="op" id="4402883">)</span>&nbsp;<span class="ident" id="4402885">Drop</span><span class="op" id="4402889">(</span><span class="ident" id="4402890">n</span>&nbsp;<span class="builtintype" id="4402892">int</span><span class="op" id="4402895">)</span>&nbsp;<span class="op" id="4402897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4402900">if</span>&nbsp;<span class="ident" id="4402903">n</span>&nbsp;<span class="op" id="4402905">&gt;</span>&nbsp;<span class="ident" id="4402907">d</span><span class="op" id="4402908">.</span><span class="ident" id="4402909">Len</span><span class="op" id="4402912">(</span><span class="op" id="4402913">)</span>&nbsp;<span class="op" id="4402915">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4402919">panic</span><span class="op" id="4402924">(</span><span class="string" id="4402925">&#34;drop&#34;</span><span class="op" id="4402931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4402934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4402937">d</span><span class="op" id="4402938">.</span><span class="ident" id="4402939">offset</span>&nbsp;<span class="op" id="4402946">+=</span>&nbsp;<span class="ident" id="4402949">n</span><br>
<span class="lineno"></span><span class="op" id="4402951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4402954">//&nbsp;Size&nbsp;grows&nbsp;the&nbsp;buffer&nbsp;to&nbsp;exactly&nbsp;n&nbsp;bytes,&nbsp;so&nbsp;d.Bytes()&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4403017">//&nbsp;return&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n.&nbsp;Existing&nbsp;data&nbsp;is&nbsp;first&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4403082">func</span>&nbsp;<span class="op" id="4403087">(</span><span class="ident" id="4403088">d</span>&nbsp;<span class="op" id="4403090">*</span><span class="ident" id="4403091">decBuffer</span><span class="op" id="4403100">)</span>&nbsp;<span class="ident" id="4403102">Size</span><span class="op" id="4403106">(</span><span class="ident" id="4403107">n</span>&nbsp;<span class="builtintype" id="4403109">int</span><span class="op" id="4403112">)</span>&nbsp;<span class="op" id="4403114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403117">d</span><span class="op" id="4403118">.</span><span class="ident" id="4403119">Reset</span><span class="op" id="4403124">(</span><span class="op" id="4403125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403128">if</span>&nbsp;<span class="builtinfunc" id="4403131">cap</span><span class="op" id="4403134">(</span><span class="ident" id="4403135">d</span><span class="op" id="4403136">.</span><span class="ident" id="4403137">data</span><span class="op" id="4403141">)</span>&nbsp;<span class="op" id="4403143">&lt;</span>&nbsp;<span class="ident" id="4403145">n</span>&nbsp;<span class="op" id="4403147">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403151">d</span><span class="op" id="4403152">.</span><span class="ident" id="4403153">data</span>&nbsp;<span class="op" id="4403158">=</span>&nbsp;<span class="builtinfunc" id="4403160">make</span><span class="op" id="4403164">(</span><span class="op" id="4403165">[</span><span class="op" id="4403166">]</span><span class="builtintype" id="4403167">byte</span><span class="op" id="4403171">,</span>&nbsp;<span class="ident" id="4403173">n</span><span class="op" id="4403174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403177">}</span>&nbsp;<span class="keyword" id="4403179">else</span>&nbsp;<span class="op" id="4403184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403188">d</span><span class="op" id="4403189">.</span><span class="ident" id="4403190">data</span>&nbsp;<span class="op" id="4403195">=</span>&nbsp;<span class="ident" id="4403197">d</span><span class="op" id="4403198">.</span><span class="ident" id="4403199">data</span><span class="op" id="4403203">[</span><span class="num" id="4403204">0</span><span class="op" id="4403205">:</span><span class="ident" id="4403206">n</span><span class="op" id="4403207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403210">}</span><br>
<span class="lineno"></span><span class="op" id="4403212">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4403215">func</span>&nbsp;<span class="op" id="4403220">(</span><span class="ident" id="4403221">d</span>&nbsp;<span class="op" id="4403223">*</span><span class="ident" id="4403224">decBuffer</span><span class="op" id="4403233">)</span>&nbsp;<span class="ident" id="4403235">ReadByte</span><span class="op" id="4403243">(</span><span class="op" id="4403244">)</span>&nbsp;<span class="op" id="4403246">(</span><span class="builtintype" id="4403247">byte</span><span class="op" id="4403251">,</span>&nbsp;<span class="builtintype" id="4403253">error</span><span class="op" id="4403258">)</span>&nbsp;<span class="op" id="4403260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403263">if</span>&nbsp;<span class="ident" id="4403266">d</span><span class="op" id="4403267">.</span><span class="ident" id="4403268">offset</span>&nbsp;<span class="op" id="4403275">&gt;=</span>&nbsp;<span class="builtinfunc" id="4403278">len</span><span class="op" id="4403281">(</span><span class="ident" id="4403282">d</span><span class="op" id="4403283">.</span><span class="ident" id="4403284">data</span><span class="op" id="4403288">)</span>&nbsp;<span class="op" id="4403290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403294">return</span>&nbsp;<span class="num" id="4403301">0</span><span class="op" id="4403302">,</span>&nbsp;<span class="ident" id="4403304">io</span><span class="op" id="4403306">.</span><span class="ident" id="4403307">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403312">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403315">c</span>&nbsp;<span class="op" id="4403317">:=</span>&nbsp;<span class="ident" id="4403320">d</span><span class="op" id="4403321">.</span><span class="ident" id="4403322">data</span><span class="op" id="4403326">[</span><span class="ident" id="4403327">d</span><span class="op" id="4403328">.</span><span class="ident" id="4403329">offset</span><span class="op" id="4403335">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403338">d</span><span class="op" id="4403339">.</span><span class="ident" id="4403340">offset</span><span class="op" id="4403346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403350">return</span>&nbsp;<span class="ident" id="4403357">c</span><span class="op" id="4403358">,</span>&nbsp;<span class="ident" id="4403360">nil</span><br>
<span class="lineno"></span><span class="op" id="4403364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4403367">func</span>&nbsp;<span class="op" id="4403372">(</span><span class="ident" id="4403373">d</span>&nbsp;<span class="op" id="4403375">*</span><span class="ident" id="4403376">decBuffer</span><span class="op" id="4403385">)</span>&nbsp;<span class="ident" id="4403387">Len</span><span class="op" id="4403390">(</span><span class="op" id="4403391">)</span>&nbsp;<span class="builtintype" id="4403393">int</span>&nbsp;<span class="op" id="4403397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403400">return</span>&nbsp;<span class="builtinfunc" id="4403407">len</span><span class="op" id="4403410">(</span><span class="ident" id="4403411">d</span><span class="op" id="4403412">.</span><span class="ident" id="4403413">data</span><span class="op" id="4403417">)</span>&nbsp;<span class="op" id="4403419">-</span>&nbsp;<span class="ident" id="4403421">d</span><span class="op" id="4403422">.</span><span class="ident" id="4403423">offset</span><br>
<span class="lineno"></span><span class="op" id="4403430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4403433">func</span>&nbsp;<span class="op" id="4403438">(</span><span class="ident" id="4403439">d</span>&nbsp;<span class="op" id="4403441">*</span><span class="ident" id="4403442">decBuffer</span><span class="op" id="4403451">)</span>&nbsp;<span class="ident" id="4403453">Bytes</span><span class="op" id="4403458">(</span><span class="op" id="4403459">)</span>&nbsp;<span class="op" id="4403461">[</span><span class="op" id="4403462">]</span><span class="builtintype" id="4403463">byte</span>&nbsp;<span class="op" id="4403468">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403471">return</span>&nbsp;<span class="ident" id="4403478">d</span><span class="op" id="4403479">.</span><span class="ident" id="4403480">data</span><span class="op" id="4403484">[</span><span class="ident" id="4403485">d</span><span class="op" id="4403486">.</span><span class="ident" id="4403487">offset</span><span class="op" id="4403493">:</span><span class="op" id="4403494">]</span><br>
<span class="lineno"></span><span class="op" id="4403496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4403499">func</span>&nbsp;<span class="op" id="4403504">(</span><span class="ident" id="4403505">d</span>&nbsp;<span class="op" id="4403507">*</span><span class="ident" id="4403508">decBuffer</span><span class="op" id="4403517">)</span>&nbsp;<span class="ident" id="4403519">Reset</span><span class="op" id="4403524">(</span><span class="op" id="4403525">)</span>&nbsp;<span class="op" id="4403527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403530">d</span><span class="op" id="4403531">.</span><span class="ident" id="4403532">data</span>&nbsp;<span class="op" id="4403537">=</span>&nbsp;<span class="ident" id="4403539">d</span><span class="op" id="4403540">.</span><span class="ident" id="4403541">data</span><span class="op" id="4403545">[</span><span class="num" id="4403546">0</span><span class="op" id="4403547">:</span><span class="num" id="4403548">0</span><span class="op" id="4403549">]</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403552">d</span><span class="op" id="4403553">.</span><span class="ident" id="4403554">offset</span>&nbsp;<span class="op" id="4403561">=</span>&nbsp;<span class="num" id="4403563">0</span><br>
<span class="lineno"></span><span class="op" id="4403565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4403568">//&nbsp;We&nbsp;pass&nbsp;the&nbsp;bytes.Buffer&nbsp;separately&nbsp;for&nbsp;easier&nbsp;testing&nbsp;of&nbsp;the&nbsp;infrastructure</span><br>
<span class="lineno"></span><span class="comment" id="4403648">//&nbsp;without&nbsp;requiring&nbsp;a&nbsp;full&nbsp;Decoder.</span><br>
<span class="lineno">95</span><span class="keyword" id="4403685">func</span>&nbsp;<span class="op" id="4403690">(</span><span class="ident" id="4403691">dec</span>&nbsp;<span class="op" id="4403695">*</span><span class="ident" id="4403696">Decoder</span><span class="op" id="4403703">)</span>&nbsp;<span class="ident" id="4403705">newDecoderState</span><span class="op" id="4403720">(</span><span class="ident" id="4403721">buf</span>&nbsp;<span class="op" id="4403725">*</span><span class="ident" id="4403726">decBuffer</span><span class="op" id="4403735">)</span>&nbsp;<span class="op" id="4403737">*</span><span class="ident" id="4403738">decoderState</span>&nbsp;<span class="op" id="4403751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403754">d</span>&nbsp;<span class="op" id="4403756">:=</span>&nbsp;<span class="ident" id="4403759">dec</span><span class="op" id="4403762">.</span><span class="ident" id="4403763">freeList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403773">if</span>&nbsp;<span class="ident" id="4403776">d</span>&nbsp;<span class="op" id="4403778">==</span>&nbsp;<span class="ident" id="4403781">nil</span>&nbsp;<span class="op" id="4403785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403789">d</span>&nbsp;<span class="op" id="4403791">=</span>&nbsp;<span class="builtinfunc" id="4403793">new</span><span class="op" id="4403796">(</span><span class="ident" id="4403797">decoderState</span><span class="op" id="4403809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403813">d</span><span class="op" id="4403814">.</span><span class="ident" id="4403815">dec</span>&nbsp;<span class="op" id="4403819">=</span>&nbsp;<span class="ident" id="4403821">dec</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403827">d</span><span class="op" id="4403828">.</span><span class="ident" id="4403829">buf</span>&nbsp;<span class="op" id="4403833">=</span>&nbsp;<span class="builtinfunc" id="4403835">make</span><span class="op" id="4403839">(</span><span class="op" id="4403840">[</span><span class="op" id="4403841">]</span><span class="builtintype" id="4403842">byte</span><span class="op" id="4403846">,</span>&nbsp;<span class="ident" id="4403848">uint64Size</span><span class="op" id="4403858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403861">}</span>&nbsp;<span class="keyword" id="4403863">else</span>&nbsp;<span class="op" id="4403868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403872">dec</span><span class="op" id="4403875">.</span><span class="ident" id="4403876">freeList</span>&nbsp;<span class="op" id="4403885">=</span>&nbsp;<span class="ident" id="4403887">d</span><span class="op" id="4403888">.</span><span class="ident" id="4403889">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4403895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403898">d</span><span class="op" id="4403899">.</span><span class="ident" id="4403900">b</span>&nbsp;<span class="op" id="4403902">=</span>&nbsp;<span class="ident" id="4403904">buf</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4403909">return</span>&nbsp;<span class="ident" id="4403916">d</span><br>
<span class="lineno"></span><span class="op" id="4403918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4403921">func</span>&nbsp;<span class="op" id="4403926">(</span><span class="ident" id="4403927">dec</span>&nbsp;<span class="op" id="4403931">*</span><span class="ident" id="4403932">Decoder</span><span class="op" id="4403939">)</span>&nbsp;<span class="ident" id="4403941">freeDecoderState</span><span class="op" id="4403957">(</span><span class="ident" id="4403958">d</span>&nbsp;<span class="op" id="4403960">*</span><span class="ident" id="4403961">decoderState</span><span class="op" id="4403973">)</span>&nbsp;<span class="op" id="4403975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4403978">d</span><span class="op" id="4403979">.</span><span class="ident" id="4403980">next</span>&nbsp;<span class="op" id="4403985">=</span>&nbsp;<span class="ident" id="4403987">dec</span><span class="op" id="4403990">.</span><span class="ident" id="4403991">freeList</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404001">dec</span><span class="op" id="4404004">.</span><span class="ident" id="4404005">freeList</span>&nbsp;<span class="op" id="4404014">=</span>&nbsp;<span class="ident" id="4404016">d</span><br>
<span class="lineno"></span><span class="op" id="4404018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4404021">func</span>&nbsp;<span class="ident" id="4404026">overflow</span><span class="op" id="4404034">(</span><span class="ident" id="4404035">name</span>&nbsp;<span class="builtintype" id="4404040">string</span><span class="op" id="4404046">)</span>&nbsp;<span class="builtintype" id="4404048">error</span>&nbsp;<span class="op" id="4404054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404057">return</span>&nbsp;<span class="ident" id="4404064">errors</span><span class="op" id="4404070">.</span><span class="ident" id="4404071">New</span><span class="op" id="4404074">(</span><span class="string" id="4404075">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4404089">+</span>&nbsp;<span class="ident" id="4404091">name</span>&nbsp;<span class="op" id="4404096">+</span>&nbsp;<span class="string" id="4404098">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4404114">)</span><br>
<span class="lineno">115</span><span class="op" id="4404116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4404119">//&nbsp;decodeUintReader&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;an&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4404192">//&nbsp;Used&nbsp;only&nbsp;by&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;read&nbsp;the&nbsp;message&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4404248">func</span>&nbsp;<span class="ident" id="4404253">decodeUintReader</span><span class="op" id="4404269">(</span><span class="ident" id="4404270">r</span>&nbsp;<span class="ident" id="4404272">io</span><span class="op" id="4404274">.</span><span class="ident" id="4404275">Reader</span><span class="op" id="4404281">,</span>&nbsp;<span class="ident" id="4404283">buf</span>&nbsp;<span class="op" id="4404287">[</span><span class="op" id="4404288">]</span><span class="builtintype" id="4404289">byte</span><span class="op" id="4404293">)</span>&nbsp;<span class="op" id="4404295">(</span><span class="ident" id="4404296">x</span>&nbsp;<span class="ident" id="4404298">uint64</span><span class="op" id="4404304">,</span>&nbsp;<span class="ident" id="4404306">width</span>&nbsp;<span class="builtintype" id="4404312">int</span><span class="op" id="4404315">,</span>&nbsp;<span class="ident" id="4404317">err</span>&nbsp;<span class="builtintype" id="4404321">error</span><span class="op" id="4404326">)</span>&nbsp;<span class="op" id="4404328">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404331">width</span>&nbsp;<span class="op" id="4404337">=</span>&nbsp;<span class="num" id="4404339">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404342">n</span><span class="op" id="4404343">,</span>&nbsp;<span class="ident" id="4404345">err</span>&nbsp;<span class="op" id="4404349">:=</span>&nbsp;<span class="ident" id="4404352">io</span><span class="op" id="4404354">.</span><span class="ident" id="4404355">ReadFull</span><span class="op" id="4404363">(</span><span class="ident" id="4404364">r</span><span class="op" id="4404365">,</span>&nbsp;<span class="ident" id="4404367">buf</span><span class="op" id="4404370">[</span><span class="num" id="4404371">0</span><span class="op" id="4404372">:</span><span class="ident" id="4404373">width</span><span class="op" id="4404378">]</span><span class="op" id="4404379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404382">if</span>&nbsp;<span class="ident" id="4404385">n</span>&nbsp;<span class="op" id="4404387">==</span>&nbsp;<span class="num" id="4404390">0</span>&nbsp;<span class="op" id="4404392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404396">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404404">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404407">b</span>&nbsp;<span class="op" id="4404409">:=</span>&nbsp;<span class="ident" id="4404412">buf</span><span class="op" id="4404415">[</span><span class="num" id="4404416">0</span><span class="op" id="4404417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404420">if</span>&nbsp;<span class="ident" id="4404423">b</span>&nbsp;<span class="op" id="4404425">&lt;=</span>&nbsp;<span class="num" id="4404428">0x7f</span>&nbsp;<span class="op" id="4404433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404437">return</span>&nbsp;<span class="ident" id="4404444">uint64</span><span class="op" id="4404450">(</span><span class="ident" id="4404451">b</span><span class="op" id="4404452">)</span><span class="op" id="4404453">,</span>&nbsp;<span class="ident" id="4404455">width</span><span class="op" id="4404460">,</span>&nbsp;<span class="ident" id="4404462">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404470">n</span>&nbsp;<span class="op" id="4404472">=</span>&nbsp;<span class="op" id="4404474">-</span><span class="builtintype" id="4404475">int</span><span class="op" id="4404478">(</span><span class="builtintype" id="4404479">int8</span><span class="op" id="4404483">(</span><span class="ident" id="4404484">b</span><span class="op" id="4404485">)</span><span class="op" id="4404486">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404489">if</span>&nbsp;<span class="ident" id="4404492">n</span>&nbsp;<span class="op" id="4404494">&gt;</span>&nbsp;<span class="ident" id="4404496">uint64Size</span>&nbsp;<span class="op" id="4404507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404511">err</span>&nbsp;<span class="op" id="4404515">=</span>&nbsp;<span class="ident" id="4404517">errBadUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404530">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404541">width</span><span class="op" id="4404546">,</span>&nbsp;<span class="ident" id="4404548">err</span>&nbsp;<span class="op" id="4404552">=</span>&nbsp;<span class="ident" id="4404554">io</span><span class="op" id="4404556">.</span><span class="ident" id="4404557">ReadFull</span><span class="op" id="4404565">(</span><span class="ident" id="4404566">r</span><span class="op" id="4404567">,</span>&nbsp;<span class="ident" id="4404569">buf</span><span class="op" id="4404572">[</span><span class="num" id="4404573">0</span><span class="op" id="4404574">:</span><span class="ident" id="4404575">n</span><span class="op" id="4404576">]</span><span class="op" id="4404577">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404580">if</span>&nbsp;<span class="ident" id="4404583">err</span>&nbsp;<span class="op" id="4404587">!=</span>&nbsp;<span class="ident" id="4404590">nil</span>&nbsp;<span class="op" id="4404594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404598">if</span>&nbsp;<span class="ident" id="4404601">err</span>&nbsp;<span class="op" id="4404605">==</span>&nbsp;<span class="ident" id="4404608">io</span><span class="op" id="4404610">.</span><span class="ident" id="4404611">EOF</span>&nbsp;<span class="op" id="4404615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404620">err</span>&nbsp;<span class="op" id="4404624">=</span>&nbsp;<span class="ident" id="4404626">io</span><span class="op" id="4404628">.</span><span class="ident" id="4404629">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404652">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4404663">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404729">for</span>&nbsp;<span class="ident" id="4404733">_</span><span class="op" id="4404734">,</span>&nbsp;<span class="ident" id="4404736">b</span>&nbsp;<span class="op" id="4404738">:=</span>&nbsp;<span class="keyword" id="4404741">range</span>&nbsp;<span class="ident" id="4404747">buf</span><span class="op" id="4404750">[</span><span class="num" id="4404751">0</span><span class="op" id="4404752">:</span><span class="ident" id="4404753">width</span><span class="op" id="4404758">]</span>&nbsp;<span class="op" id="4404760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404764">x</span>&nbsp;<span class="op" id="4404766">=</span>&nbsp;<span class="ident" id="4404768">x</span><span class="op" id="4404769">&lt;&lt;</span><span class="num" id="4404771">8</span>&nbsp;<span class="op" id="4404773">|</span>&nbsp;<span class="ident" id="4404775">uint64</span><span class="op" id="4404781">(</span><span class="ident" id="4404782">b</span><span class="op" id="4404783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4404786">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404789">width</span><span class="op" id="4404794">++</span>&nbsp;<span class="comment" id="4404797">//&nbsp;+1&nbsp;for&nbsp;length&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4404820">return</span><br>
<span class="lineno"></span><span class="op" id="4404827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4404830">//&nbsp;decodeUint&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;unsigned&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno">150</span><span class="comment" id="4404892">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4404924">func</span>&nbsp;<span class="op" id="4404929">(</span><span class="ident" id="4404930">state</span>&nbsp;<span class="op" id="4404936">*</span><span class="ident" id="4404937">decoderState</span><span class="op" id="4404949">)</span>&nbsp;<span class="ident" id="4404951">decodeUint</span><span class="op" id="4404961">(</span><span class="op" id="4404962">)</span>&nbsp;<span class="op" id="4404964">(</span><span class="ident" id="4404965">x</span>&nbsp;<span class="ident" id="4404967">uint64</span><span class="op" id="4404973">)</span>&nbsp;<span class="op" id="4404975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4404978">b</span><span class="op" id="4404979">,</span>&nbsp;<span class="ident" id="4404981">err</span>&nbsp;<span class="op" id="4404985">:=</span>&nbsp;<span class="ident" id="4404988">state</span><span class="op" id="4404993">.</span><span class="ident" id="4404994">b</span><span class="op" id="4404995">.</span><span class="ident" id="4404996">ReadByte</span><span class="op" id="4405004">(</span><span class="op" id="4405005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405008">if</span>&nbsp;<span class="ident" id="4405011">err</span>&nbsp;<span class="op" id="4405015">!=</span>&nbsp;<span class="ident" id="4405018">nil</span>&nbsp;<span class="op" id="4405022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405026">error_</span><span class="op" id="4405032">(</span><span class="ident" id="4405033">err</span><span class="op" id="4405036">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405042">if</span>&nbsp;<span class="ident" id="4405045">b</span>&nbsp;<span class="op" id="4405047">&lt;=</span>&nbsp;<span class="num" id="4405050">0x7f</span>&nbsp;<span class="op" id="4405055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405059">return</span>&nbsp;<span class="ident" id="4405066">uint64</span><span class="op" id="4405072">(</span><span class="ident" id="4405073">b</span><span class="op" id="4405074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405080">n</span>&nbsp;<span class="op" id="4405082">:=</span>&nbsp;<span class="op" id="4405085">-</span><span class="builtintype" id="4405086">int</span><span class="op" id="4405089">(</span><span class="builtintype" id="4405090">int8</span><span class="op" id="4405094">(</span><span class="ident" id="4405095">b</span><span class="op" id="4405096">)</span><span class="op" id="4405097">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405100">if</span>&nbsp;<span class="ident" id="4405103">n</span>&nbsp;<span class="op" id="4405105">&gt;</span>&nbsp;<span class="ident" id="4405107">uint64Size</span>&nbsp;<span class="op" id="4405118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405122">error_</span><span class="op" id="4405128">(</span><span class="ident" id="4405129">errBadUint</span><span class="op" id="4405139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405145">width</span><span class="op" id="4405150">,</span>&nbsp;<span class="ident" id="4405152">err</span>&nbsp;<span class="op" id="4405156">:=</span>&nbsp;<span class="ident" id="4405159">state</span><span class="op" id="4405164">.</span><span class="ident" id="4405165">b</span><span class="op" id="4405166">.</span><span class="ident" id="4405167">Read</span><span class="op" id="4405171">(</span><span class="ident" id="4405172">state</span><span class="op" id="4405177">.</span><span class="ident" id="4405178">buf</span><span class="op" id="4405181">[</span><span class="num" id="4405182">0</span><span class="op" id="4405183">:</span><span class="ident" id="4405184">n</span><span class="op" id="4405185">]</span><span class="op" id="4405186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405189">if</span>&nbsp;<span class="ident" id="4405192">err</span>&nbsp;<span class="op" id="4405196">!=</span>&nbsp;<span class="ident" id="4405199">nil</span>&nbsp;<span class="op" id="4405203">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405207">error_</span><span class="op" id="4405213">(</span><span class="ident" id="4405214">err</span><span class="op" id="4405217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4405223">//&nbsp;Don&#39;t&nbsp;need&nbsp;to&nbsp;check&nbsp;error;&nbsp;it&#39;s&nbsp;safe&nbsp;to&nbsp;loop&nbsp;regardless.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4405284">//&nbsp;Could&nbsp;check&nbsp;that&nbsp;the&nbsp;high&nbsp;byte&nbsp;is&nbsp;zero&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;worth&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405350">for</span>&nbsp;<span class="ident" id="4405354">_</span><span class="op" id="4405355">,</span>&nbsp;<span class="ident" id="4405357">b</span>&nbsp;<span class="op" id="4405359">:=</span>&nbsp;<span class="keyword" id="4405362">range</span>&nbsp;<span class="ident" id="4405368">state</span><span class="op" id="4405373">.</span><span class="ident" id="4405374">buf</span><span class="op" id="4405377">[</span><span class="num" id="4405378">0</span><span class="op" id="4405379">:</span><span class="ident" id="4405380">width</span><span class="op" id="4405385">]</span>&nbsp;<span class="op" id="4405387">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405391">x</span>&nbsp;<span class="op" id="4405393">=</span>&nbsp;<span class="ident" id="4405395">x</span><span class="op" id="4405396">&lt;&lt;</span><span class="num" id="4405398">8</span>&nbsp;<span class="op" id="4405400">|</span>&nbsp;<span class="ident" id="4405402">uint64</span><span class="op" id="4405408">(</span><span class="ident" id="4405409">b</span><span class="op" id="4405410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405416">return</span>&nbsp;<span class="ident" id="4405423">x</span><br>
<span class="lineno"></span><span class="op" id="4405425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="4405428">//&nbsp;decodeInt&nbsp;reads&nbsp;an&nbsp;encoded&nbsp;signed&nbsp;integer&nbsp;from&nbsp;state.r.</span><br>
<span class="lineno"></span><span class="comment" id="4405487">//&nbsp;Does&nbsp;not&nbsp;check&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span><span class="keyword" id="4405519">func</span>&nbsp;<span class="op" id="4405524">(</span><span class="ident" id="4405525">state</span>&nbsp;<span class="op" id="4405531">*</span><span class="ident" id="4405532">decoderState</span><span class="op" id="4405544">)</span>&nbsp;<span class="ident" id="4405546">decodeInt</span><span class="op" id="4405555">(</span><span class="op" id="4405556">)</span>&nbsp;<span class="ident" id="4405558">int64</span>&nbsp;<span class="op" id="4405564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405567">x</span>&nbsp;<span class="op" id="4405569">:=</span>&nbsp;<span class="ident" id="4405572">state</span><span class="op" id="4405577">.</span><span class="ident" id="4405578">decodeUint</span><span class="op" id="4405588">(</span><span class="op" id="4405589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405592">if</span>&nbsp;<span class="ident" id="4405595">x</span><span class="op" id="4405596">&amp;</span><span class="num" id="4405597">1</span>&nbsp;<span class="op" id="4405599">!=</span>&nbsp;<span class="num" id="4405602">0</span>&nbsp;<span class="op" id="4405604">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405608">return</span>&nbsp;<span class="op" id="4405615">^</span><span class="ident" id="4405616">int64</span><span class="op" id="4405621">(</span><span class="ident" id="4405622">x</span>&nbsp;<span class="op" id="4405624">&gt;&gt;</span>&nbsp;<span class="num" id="4405627">1</span><span class="op" id="4405628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4405631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4405634">return</span>&nbsp;<span class="ident" id="4405641">int64</span><span class="op" id="4405646">(</span><span class="ident" id="4405647">x</span>&nbsp;<span class="op" id="4405649">&gt;&gt;</span>&nbsp;<span class="num" id="4405652">1</span><span class="op" id="4405653">)</span><br>
<span class="lineno"></span><span class="op" id="4405655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="4405658">//&nbsp;decOp&nbsp;is&nbsp;the&nbsp;signature&nbsp;of&nbsp;a&nbsp;decoding&nbsp;operator&nbsp;for&nbsp;a&nbsp;given&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4405725">type</span>&nbsp;<span class="ident" id="4405730">decOp</span>&nbsp;<span class="keyword" id="4405736">func</span><span class="op" id="4405740">(</span><span class="ident" id="4405741">i</span>&nbsp;<span class="op" id="4405743">*</span><span class="ident" id="4405744">decInstr</span><span class="op" id="4405752">,</span>&nbsp;<span class="ident" id="4405754">state</span>&nbsp;<span class="op" id="4405760">*</span><span class="ident" id="4405761">decoderState</span><span class="op" id="4405773">,</span>&nbsp;<span class="ident" id="4405775">v</span>&nbsp;<span class="ident" id="4405777">reflect</span><span class="op" id="4405784">.</span><span class="ident" id="4405785">Value</span><span class="op" id="4405790">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4405793">//&nbsp;The&nbsp;&#39;instructions&#39;&nbsp;of&nbsp;the&nbsp;decoding&nbsp;machine</span><br>
<span class="lineno"></span><span class="keyword" id="4405839">type</span>&nbsp;<span class="ident" id="4405844">decInstr</span>&nbsp;<span class="keyword" id="4405853">struct</span>&nbsp;<span class="op" id="4405860">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405863">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4405869">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405876">field</span>&nbsp;<span class="builtintype" id="4405882">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4405888">//&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;wire&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405922">index</span>&nbsp;<span class="op" id="4405928">[</span><span class="op" id="4405929">]</span><span class="builtintype" id="4405930">int</span>&nbsp;<span class="comment" id="4405934">//&nbsp;field&nbsp;access&nbsp;indices&nbsp;for&nbsp;destination&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4405980">ovfl</span>&nbsp;&nbsp;<span class="builtintype" id="4405986">error</span>&nbsp;<span class="comment" id="4405992">//&nbsp;error&nbsp;message&nbsp;for&nbsp;overflow/underflow&nbsp;(for&nbsp;arrays,&nbsp;of&nbsp;the&nbsp;elements)</span><br>
<span class="lineno"></span><span class="op" id="4406062">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4406065">//&nbsp;ignoreUint&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4406122">func</span>&nbsp;<span class="ident" id="4406127">ignoreUint</span><span class="op" id="4406137">(</span><span class="ident" id="4406138">i</span>&nbsp;<span class="op" id="4406140">*</span><span class="ident" id="4406141">decInstr</span><span class="op" id="4406149">,</span>&nbsp;<span class="ident" id="4406151">state</span>&nbsp;<span class="op" id="4406157">*</span><span class="ident" id="4406158">decoderState</span><span class="op" id="4406170">,</span>&nbsp;<span class="ident" id="4406172">v</span>&nbsp;<span class="ident" id="4406174">reflect</span><span class="op" id="4406181">.</span><span class="ident" id="4406182">Value</span><span class="op" id="4406187">)</span>&nbsp;<span class="op" id="4406189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406192">state</span><span class="op" id="4406197">.</span><span class="ident" id="4406198">decodeUint</span><span class="op" id="4406208">(</span><span class="op" id="4406209">)</span><br>
<span class="lineno"></span><span class="op" id="4406211">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="4406214">//&nbsp;ignoreTwoUints&nbsp;discards&nbsp;a&nbsp;uint&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;to&nbsp;skip</span><br>
<span class="lineno"></span><span class="comment" id="4406293">//&nbsp;complex&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4406312">func</span>&nbsp;<span class="ident" id="4406317">ignoreTwoUints</span><span class="op" id="4406331">(</span><span class="ident" id="4406332">i</span>&nbsp;<span class="op" id="4406334">*</span><span class="ident" id="4406335">decInstr</span><span class="op" id="4406343">,</span>&nbsp;<span class="ident" id="4406345">state</span>&nbsp;<span class="op" id="4406351">*</span><span class="ident" id="4406352">decoderState</span><span class="op" id="4406364">,</span>&nbsp;<span class="ident" id="4406366">v</span>&nbsp;<span class="ident" id="4406368">reflect</span><span class="op" id="4406375">.</span><span class="ident" id="4406376">Value</span><span class="op" id="4406381">)</span>&nbsp;<span class="op" id="4406383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406386">state</span><span class="op" id="4406391">.</span><span class="ident" id="4406392">decodeUint</span><span class="op" id="4406402">(</span><span class="op" id="4406403">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4406406">state</span><span class="op" id="4406411">.</span><span class="ident" id="4406412">decodeUint</span><span class="op" id="4406422">(</span><span class="op" id="4406423">)</span><br>
<span class="lineno"></span><span class="op" id="4406425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4406428">//&nbsp;Since&nbsp;the&nbsp;encoder&nbsp;writes&nbsp;no&nbsp;zeros,&nbsp;if&nbsp;we&nbsp;arrive&nbsp;at&nbsp;a&nbsp;decoder&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span><span class="comment" id="4406500">//&nbsp;a&nbsp;value&nbsp;to&nbsp;extract&nbsp;and&nbsp;store.&nbsp;&nbsp;The&nbsp;field&nbsp;number&nbsp;has&nbsp;already&nbsp;been&nbsp;read</span><br>
<span class="lineno">210</span><span class="comment" id="4406573">//&nbsp;(it&#39;s&nbsp;how&nbsp;we&nbsp;knew&nbsp;to&nbsp;call&nbsp;this&nbsp;decoder).</span><br>
<span class="lineno"></span><span class="comment" id="4406617">//&nbsp;Each&nbsp;decoder&nbsp;is&nbsp;responsible&nbsp;for&nbsp;handling&nbsp;any&nbsp;indirections&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4406689">//&nbsp;with&nbsp;the&nbsp;data&nbsp;structure.&nbsp;&nbsp;If&nbsp;any&nbsp;pointer&nbsp;so&nbsp;reached&nbsp;is&nbsp;nil,&nbsp;allocation&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4406768">//&nbsp;be&nbsp;done.</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="4406781">//&nbsp;decAlloc&nbsp;takes&nbsp;a&nbsp;value&nbsp;and&nbsp;returns&nbsp;a&nbsp;settable&nbsp;value&nbsp;that&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="4406845">//&nbsp;be&nbsp;assigned&nbsp;to.&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer,&nbsp;decAlloc&nbsp;guarantees&nbsp;it&nbsp;points&nbsp;to&nbsp;storage.</span><br>
<span class="lineno"></span><span class="comment" id="4406933">//&nbsp;The&nbsp;callers&nbsp;to&nbsp;the&nbsp;individual&nbsp;decoders&nbsp;are&nbsp;expected&nbsp;to&nbsp;have&nbsp;used&nbsp;decAlloc.</span><br>
<span class="lineno"></span><span class="comment" id="4407011">//&nbsp;The&nbsp;individual&nbsp;decoders&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4407056">func</span>&nbsp;<span class="ident" id="4407061">decAlloc</span><span class="op" id="4407069">(</span><span class="ident" id="4407070">v</span>&nbsp;<span class="ident" id="4407072">reflect</span><span class="op" id="4407079">.</span><span class="ident" id="4407080">Value</span><span class="op" id="4407085">)</span>&nbsp;<span class="ident" id="4407087">reflect</span><span class="op" id="4407094">.</span><span class="ident" id="4407095">Value</span>&nbsp;<span class="op" id="4407101">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407104">for</span>&nbsp;<span class="ident" id="4407108">v</span><span class="op" id="4407109">.</span><span class="ident" id="4407110">Kind</span><span class="op" id="4407114">(</span><span class="op" id="4407115">)</span>&nbsp;<span class="op" id="4407117">==</span>&nbsp;<span class="ident" id="4407120">reflect</span><span class="op" id="4407127">.</span><span class="ident" id="4407128">Ptr</span>&nbsp;<span class="op" id="4407132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407136">if</span>&nbsp;<span class="ident" id="4407139">v</span><span class="op" id="4407140">.</span><span class="ident" id="4407141">IsNil</span><span class="op" id="4407146">(</span><span class="op" id="4407147">)</span>&nbsp;<span class="op" id="4407149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407154">v</span><span class="op" id="4407155">.</span><span class="ident" id="4407156">Set</span><span class="op" id="4407159">(</span><span class="ident" id="4407160">reflect</span><span class="op" id="4407167">.</span><span class="ident" id="4407168">New</span><span class="op" id="4407171">(</span><span class="ident" id="4407172">v</span><span class="op" id="4407173">.</span><span class="ident" id="4407174">Type</span><span class="op" id="4407178">(</span><span class="op" id="4407179">)</span><span class="op" id="4407180">.</span><span class="ident" id="4407181">Elem</span><span class="op" id="4407185">(</span><span class="op" id="4407186">)</span><span class="op" id="4407187">)</span><span class="op" id="4407188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407196">v</span>&nbsp;<span class="op" id="4407198">=</span>&nbsp;<span class="ident" id="4407200">v</span><span class="op" id="4407201">.</span><span class="ident" id="4407202">Elem</span><span class="op" id="4407206">(</span><span class="op" id="4407207">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407213">return</span>&nbsp;<span class="ident" id="4407220">v</span><br>
<span class="lineno"></span><span class="op" id="4407222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4407225">//&nbsp;decBool&nbsp;decodes&nbsp;a&nbsp;uint&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;boolean&nbsp;in&nbsp;value.</span><br>
<span class="lineno">230</span><span class="keyword" id="4407288">func</span>&nbsp;<span class="ident" id="4407293">decBool</span><span class="op" id="4407300">(</span><span class="ident" id="4407301">i</span>&nbsp;<span class="op" id="4407303">*</span><span class="ident" id="4407304">decInstr</span><span class="op" id="4407312">,</span>&nbsp;<span class="ident" id="4407314">state</span>&nbsp;<span class="op" id="4407320">*</span><span class="ident" id="4407321">decoderState</span><span class="op" id="4407333">,</span>&nbsp;<span class="ident" id="4407335">value</span>&nbsp;<span class="ident" id="4407341">reflect</span><span class="op" id="4407348">.</span><span class="ident" id="4407349">Value</span><span class="op" id="4407354">)</span>&nbsp;<span class="op" id="4407356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407359">value</span><span class="op" id="4407364">.</span><span class="ident" id="4407365">SetBool</span><span class="op" id="4407372">(</span><span class="ident" id="4407373">state</span><span class="op" id="4407378">.</span><span class="ident" id="4407379">decodeUint</span><span class="op" id="4407389">(</span><span class="op" id="4407390">)</span>&nbsp;<span class="op" id="4407392">!=</span>&nbsp;<span class="num" id="4407395">0</span><span class="op" id="4407396">)</span><br>
<span class="lineno"></span><span class="op" id="4407398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4407401">//&nbsp;decInt8&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int8&nbsp;in&nbsp;value.</span><br>
<span class="lineno">235</span><span class="keyword" id="4407466">func</span>&nbsp;<span class="ident" id="4407471">decInt8</span><span class="op" id="4407478">(</span><span class="ident" id="4407479">i</span>&nbsp;<span class="op" id="4407481">*</span><span class="ident" id="4407482">decInstr</span><span class="op" id="4407490">,</span>&nbsp;<span class="ident" id="4407492">state</span>&nbsp;<span class="op" id="4407498">*</span><span class="ident" id="4407499">decoderState</span><span class="op" id="4407511">,</span>&nbsp;<span class="ident" id="4407513">value</span>&nbsp;<span class="ident" id="4407519">reflect</span><span class="op" id="4407526">.</span><span class="ident" id="4407527">Value</span><span class="op" id="4407532">)</span>&nbsp;<span class="op" id="4407534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407537">v</span>&nbsp;<span class="op" id="4407539">:=</span>&nbsp;<span class="ident" id="4407542">state</span><span class="op" id="4407547">.</span><span class="ident" id="4407548">decodeInt</span><span class="op" id="4407557">(</span><span class="op" id="4407558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407561">if</span>&nbsp;<span class="ident" id="4407564">v</span>&nbsp;<span class="op" id="4407566">&lt;</span>&nbsp;<span class="ident" id="4407568">math</span><span class="op" id="4407572">.</span><span class="ident" id="4407573">MinInt8</span>&nbsp;<span class="op" id="4407581">||</span>&nbsp;<span class="ident" id="4407584">math</span><span class="op" id="4407588">.</span><span class="ident" id="4407589">MaxInt8</span>&nbsp;<span class="op" id="4407597">&lt;</span>&nbsp;<span class="ident" id="4407599">v</span>&nbsp;<span class="op" id="4407601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407605">error_</span><span class="op" id="4407611">(</span><span class="ident" id="4407612">i</span><span class="op" id="4407613">.</span><span class="ident" id="4407614">ovfl</span><span class="op" id="4407618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407621">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407624">value</span><span class="op" id="4407629">.</span><span class="ident" id="4407630">SetInt</span><span class="op" id="4407636">(</span><span class="ident" id="4407637">v</span><span class="op" id="4407638">)</span><br>
<span class="lineno"></span><span class="op" id="4407640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4407643">//&nbsp;decUint8&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint8&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4407718">func</span>&nbsp;<span class="ident" id="4407723">decUint8</span><span class="op" id="4407731">(</span><span class="ident" id="4407732">i</span>&nbsp;<span class="op" id="4407734">*</span><span class="ident" id="4407735">decInstr</span><span class="op" id="4407743">,</span>&nbsp;<span class="ident" id="4407745">state</span>&nbsp;<span class="op" id="4407751">*</span><span class="ident" id="4407752">decoderState</span><span class="op" id="4407764">,</span>&nbsp;<span class="ident" id="4407766">value</span>&nbsp;<span class="ident" id="4407772">reflect</span><span class="op" id="4407779">.</span><span class="ident" id="4407780">Value</span><span class="op" id="4407785">)</span>&nbsp;<span class="op" id="4407787">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407790">v</span>&nbsp;<span class="op" id="4407792">:=</span>&nbsp;<span class="ident" id="4407795">state</span><span class="op" id="4407800">.</span><span class="ident" id="4407801">decodeUint</span><span class="op" id="4407811">(</span><span class="op" id="4407812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4407815">if</span>&nbsp;<span class="ident" id="4407818">math</span><span class="op" id="4407822">.</span><span class="ident" id="4407823">MaxUint8</span>&nbsp;<span class="op" id="4407832">&lt;</span>&nbsp;<span class="ident" id="4407834">v</span>&nbsp;<span class="op" id="4407836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407840">error_</span><span class="op" id="4407846">(</span><span class="ident" id="4407847">i</span><span class="op" id="4407848">.</span><span class="ident" id="4407849">ovfl</span><span class="op" id="4407853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4407856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4407859">value</span><span class="op" id="4407864">.</span><span class="ident" id="4407865">SetUint</span><span class="op" id="4407872">(</span><span class="ident" id="4407873">v</span><span class="op" id="4407874">)</span><br>
<span class="lineno">250</span><span class="op" id="4407876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4407879">//&nbsp;decInt16&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4407946">func</span>&nbsp;<span class="ident" id="4407951">decInt16</span><span class="op" id="4407959">(</span><span class="ident" id="4407960">i</span>&nbsp;<span class="op" id="4407962">*</span><span class="ident" id="4407963">decInstr</span><span class="op" id="4407971">,</span>&nbsp;<span class="ident" id="4407973">state</span>&nbsp;<span class="op" id="4407979">*</span><span class="ident" id="4407980">decoderState</span><span class="op" id="4407992">,</span>&nbsp;<span class="ident" id="4407994">value</span>&nbsp;<span class="ident" id="4408000">reflect</span><span class="op" id="4408007">.</span><span class="ident" id="4408008">Value</span><span class="op" id="4408013">)</span>&nbsp;<span class="op" id="4408015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408018">v</span>&nbsp;<span class="op" id="4408020">:=</span>&nbsp;<span class="ident" id="4408023">state</span><span class="op" id="4408028">.</span><span class="ident" id="4408029">decodeInt</span><span class="op" id="4408038">(</span><span class="op" id="4408039">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408042">if</span>&nbsp;<span class="ident" id="4408045">v</span>&nbsp;<span class="op" id="4408047">&lt;</span>&nbsp;<span class="ident" id="4408049">math</span><span class="op" id="4408053">.</span><span class="ident" id="4408054">MinInt16</span>&nbsp;<span class="op" id="4408063">||</span>&nbsp;<span class="ident" id="4408066">math</span><span class="op" id="4408070">.</span><span class="ident" id="4408071">MaxInt16</span>&nbsp;<span class="op" id="4408080">&lt;</span>&nbsp;<span class="ident" id="4408082">v</span>&nbsp;<span class="op" id="4408084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408088">error_</span><span class="op" id="4408094">(</span><span class="ident" id="4408095">i</span><span class="op" id="4408096">.</span><span class="ident" id="4408097">ovfl</span><span class="op" id="4408101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4408104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408107">value</span><span class="op" id="4408112">.</span><span class="ident" id="4408113">SetInt</span><span class="op" id="4408119">(</span><span class="ident" id="4408120">v</span><span class="op" id="4408121">)</span><br>
<span class="lineno"></span><span class="op" id="4408123">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="comment" id="4408126">//&nbsp;decUint16&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint16&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4408203">func</span>&nbsp;<span class="ident" id="4408208">decUint16</span><span class="op" id="4408217">(</span><span class="ident" id="4408218">i</span>&nbsp;<span class="op" id="4408220">*</span><span class="ident" id="4408221">decInstr</span><span class="op" id="4408229">,</span>&nbsp;<span class="ident" id="4408231">state</span>&nbsp;<span class="op" id="4408237">*</span><span class="ident" id="4408238">decoderState</span><span class="op" id="4408250">,</span>&nbsp;<span class="ident" id="4408252">value</span>&nbsp;<span class="ident" id="4408258">reflect</span><span class="op" id="4408265">.</span><span class="ident" id="4408266">Value</span><span class="op" id="4408271">)</span>&nbsp;<span class="op" id="4408273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408276">v</span>&nbsp;<span class="op" id="4408278">:=</span>&nbsp;<span class="ident" id="4408281">state</span><span class="op" id="4408286">.</span><span class="ident" id="4408287">decodeUint</span><span class="op" id="4408297">(</span><span class="op" id="4408298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408301">if</span>&nbsp;<span class="ident" id="4408304">math</span><span class="op" id="4408308">.</span><span class="ident" id="4408309">MaxUint16</span>&nbsp;<span class="op" id="4408319">&lt;</span>&nbsp;<span class="ident" id="4408321">v</span>&nbsp;<span class="op" id="4408323">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408327">error_</span><span class="op" id="4408333">(</span><span class="ident" id="4408334">i</span><span class="op" id="4408335">.</span><span class="ident" id="4408336">ovfl</span><span class="op" id="4408340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4408343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408346">value</span><span class="op" id="4408351">.</span><span class="ident" id="4408352">SetUint</span><span class="op" id="4408359">(</span><span class="ident" id="4408360">v</span><span class="op" id="4408361">)</span><br>
<span class="lineno"></span><span class="op" id="4408363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="4408366">//&nbsp;decInt32&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int32&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4408433">func</span>&nbsp;<span class="ident" id="4408438">decInt32</span><span class="op" id="4408446">(</span><span class="ident" id="4408447">i</span>&nbsp;<span class="op" id="4408449">*</span><span class="ident" id="4408450">decInstr</span><span class="op" id="4408458">,</span>&nbsp;<span class="ident" id="4408460">state</span>&nbsp;<span class="op" id="4408466">*</span><span class="ident" id="4408467">decoderState</span><span class="op" id="4408479">,</span>&nbsp;<span class="ident" id="4408481">value</span>&nbsp;<span class="ident" id="4408487">reflect</span><span class="op" id="4408494">.</span><span class="ident" id="4408495">Value</span><span class="op" id="4408500">)</span>&nbsp;<span class="op" id="4408502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408505">v</span>&nbsp;<span class="op" id="4408507">:=</span>&nbsp;<span class="ident" id="4408510">state</span><span class="op" id="4408515">.</span><span class="ident" id="4408516">decodeInt</span><span class="op" id="4408525">(</span><span class="op" id="4408526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408529">if</span>&nbsp;<span class="ident" id="4408532">v</span>&nbsp;<span class="op" id="4408534">&lt;</span>&nbsp;<span class="ident" id="4408536">math</span><span class="op" id="4408540">.</span><span class="ident" id="4408541">MinInt32</span>&nbsp;<span class="op" id="4408550">||</span>&nbsp;<span class="ident" id="4408553">math</span><span class="op" id="4408557">.</span><span class="ident" id="4408558">MaxInt32</span>&nbsp;<span class="op" id="4408567">&lt;</span>&nbsp;<span class="ident" id="4408569">v</span>&nbsp;<span class="op" id="4408571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408575">error_</span><span class="op" id="4408581">(</span><span class="ident" id="4408582">i</span><span class="op" id="4408583">.</span><span class="ident" id="4408584">ovfl</span><span class="op" id="4408588">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4408591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408594">value</span><span class="op" id="4408599">.</span><span class="ident" id="4408600">SetInt</span><span class="op" id="4408606">(</span><span class="ident" id="4408607">v</span><span class="op" id="4408608">)</span><br>
<span class="lineno"></span><span class="op" id="4408610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4408613">//&nbsp;decUint32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint32&nbsp;in&nbsp;value.</span><br>
<span class="lineno">280</span><span class="keyword" id="4408690">func</span>&nbsp;<span class="ident" id="4408695">decUint32</span><span class="op" id="4408704">(</span><span class="ident" id="4408705">i</span>&nbsp;<span class="op" id="4408707">*</span><span class="ident" id="4408708">decInstr</span><span class="op" id="4408716">,</span>&nbsp;<span class="ident" id="4408718">state</span>&nbsp;<span class="op" id="4408724">*</span><span class="ident" id="4408725">decoderState</span><span class="op" id="4408737">,</span>&nbsp;<span class="ident" id="4408739">value</span>&nbsp;<span class="ident" id="4408745">reflect</span><span class="op" id="4408752">.</span><span class="ident" id="4408753">Value</span><span class="op" id="4408758">)</span>&nbsp;<span class="op" id="4408760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408763">v</span>&nbsp;<span class="op" id="4408765">:=</span>&nbsp;<span class="ident" id="4408768">state</span><span class="op" id="4408773">.</span><span class="ident" id="4408774">decodeUint</span><span class="op" id="4408784">(</span><span class="op" id="4408785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4408788">if</span>&nbsp;<span class="ident" id="4408791">math</span><span class="op" id="4408795">.</span><span class="ident" id="4408796">MaxUint32</span>&nbsp;<span class="op" id="4408806">&lt;</span>&nbsp;<span class="ident" id="4408808">v</span>&nbsp;<span class="op" id="4408810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408814">error_</span><span class="op" id="4408820">(</span><span class="ident" id="4408821">i</span><span class="op" id="4408822">.</span><span class="ident" id="4408823">ovfl</span><span class="op" id="4408827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4408830">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408833">value</span><span class="op" id="4408838">.</span><span class="ident" id="4408839">SetUint</span><span class="op" id="4408846">(</span><span class="ident" id="4408847">v</span><span class="op" id="4408848">)</span><br>
<span class="lineno"></span><span class="op" id="4408850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4408853">//&nbsp;decInt64&nbsp;decodes&nbsp;an&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;an&nbsp;int64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4408920">func</span>&nbsp;<span class="ident" id="4408925">decInt64</span><span class="op" id="4408933">(</span><span class="ident" id="4408934">i</span>&nbsp;<span class="op" id="4408936">*</span><span class="ident" id="4408937">decInstr</span><span class="op" id="4408945">,</span>&nbsp;<span class="ident" id="4408947">state</span>&nbsp;<span class="op" id="4408953">*</span><span class="ident" id="4408954">decoderState</span><span class="op" id="4408966">,</span>&nbsp;<span class="ident" id="4408968">value</span>&nbsp;<span class="ident" id="4408974">reflect</span><span class="op" id="4408981">.</span><span class="ident" id="4408982">Value</span><span class="op" id="4408987">)</span>&nbsp;<span class="op" id="4408989">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4408992">v</span>&nbsp;<span class="op" id="4408994">:=</span>&nbsp;<span class="ident" id="4408997">state</span><span class="op" id="4409002">.</span><span class="ident" id="4409003">decodeInt</span><span class="op" id="4409012">(</span><span class="op" id="4409013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409016">value</span><span class="op" id="4409021">.</span><span class="ident" id="4409022">SetInt</span><span class="op" id="4409028">(</span><span class="ident" id="4409029">v</span><span class="op" id="4409030">)</span><br>
<span class="lineno"></span><span class="op" id="4409032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4409035">//&nbsp;decUint64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;and&nbsp;stores&nbsp;it&nbsp;as&nbsp;a&nbsp;uint64&nbsp;in&nbsp;value.</span><br>
<span class="lineno">295</span><span class="keyword" id="4409112">func</span>&nbsp;<span class="ident" id="4409117">decUint64</span><span class="op" id="4409126">(</span><span class="ident" id="4409127">i</span>&nbsp;<span class="op" id="4409129">*</span><span class="ident" id="4409130">decInstr</span><span class="op" id="4409138">,</span>&nbsp;<span class="ident" id="4409140">state</span>&nbsp;<span class="op" id="4409146">*</span><span class="ident" id="4409147">decoderState</span><span class="op" id="4409159">,</span>&nbsp;<span class="ident" id="4409161">value</span>&nbsp;<span class="ident" id="4409167">reflect</span><span class="op" id="4409174">.</span><span class="ident" id="4409175">Value</span><span class="op" id="4409180">)</span>&nbsp;<span class="op" id="4409182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409185">v</span>&nbsp;<span class="op" id="4409187">:=</span>&nbsp;<span class="ident" id="4409190">state</span><span class="op" id="4409195">.</span><span class="ident" id="4409196">decodeUint</span><span class="op" id="4409206">(</span><span class="op" id="4409207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409210">value</span><span class="op" id="4409215">.</span><span class="ident" id="4409216">SetUint</span><span class="op" id="4409223">(</span><span class="ident" id="4409224">v</span><span class="op" id="4409225">)</span><br>
<span class="lineno"></span><span class="op" id="4409227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="4409230">//&nbsp;Floating-point&nbsp;numbers&nbsp;are&nbsp;transmitted&nbsp;as&nbsp;uint64s&nbsp;holding&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="4409300">//&nbsp;of&nbsp;the&nbsp;underlying&nbsp;representation.&nbsp;&nbsp;They&nbsp;are&nbsp;sent&nbsp;byte-reversed,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="4409372">//&nbsp;the&nbsp;exponent&nbsp;end&nbsp;coming&nbsp;out&nbsp;first,&nbsp;so&nbsp;integer&nbsp;floating&nbsp;point&nbsp;numbers</span><br>
<span class="lineno"></span><span class="comment" id="4409444">//&nbsp;(for&nbsp;example)&nbsp;transmit&nbsp;more&nbsp;compactly.&nbsp;&nbsp;This&nbsp;routine&nbsp;does&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4409509">//&nbsp;unswizzling.</span><br>
<span class="lineno">305</span><span class="keyword" id="4409525">func</span>&nbsp;<span class="ident" id="4409530">float64FromBits</span><span class="op" id="4409545">(</span><span class="ident" id="4409546">u</span>&nbsp;<span class="ident" id="4409548">uint64</span><span class="op" id="4409554">)</span>&nbsp;<span class="builtintype" id="4409556">float64</span>&nbsp;<span class="op" id="4409564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409567">var</span>&nbsp;<span class="ident" id="4409571">v</span>&nbsp;<span class="ident" id="4409573">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409581">for</span>&nbsp;<span class="ident" id="4409585">i</span>&nbsp;<span class="op" id="4409587">:=</span>&nbsp;<span class="num" id="4409590">0</span><span class="op" id="4409591">;</span>&nbsp;<span class="ident" id="4409593">i</span>&nbsp;<span class="op" id="4409595">&lt;</span>&nbsp;<span class="num" id="4409597">8</span><span class="op" id="4409598">;</span>&nbsp;<span class="ident" id="4409600">i</span><span class="op" id="4409601">++</span>&nbsp;<span class="op" id="4409604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409608">v</span>&nbsp;<span class="op" id="4409610">&lt;&lt;=</span>&nbsp;<span class="num" id="4409614">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409618">v</span>&nbsp;<span class="op" id="4409620">|=</span>&nbsp;<span class="ident" id="4409623">u</span>&nbsp;<span class="op" id="4409625">&amp;</span>&nbsp;<span class="num" id="4409627">0xFF</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4409634">u</span>&nbsp;<span class="op" id="4409636">&gt;&gt;=</span>&nbsp;<span class="num" id="4409640">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4409643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4409646">return</span>&nbsp;<span class="ident" id="4409653">math</span><span class="op" id="4409657">.</span><span class="ident" id="4409658">Float64frombits</span><span class="op" id="4409673">(</span><span class="ident" id="4409674">v</span><span class="op" id="4409675">)</span><br>
<span class="lineno"></span><span class="op" id="4409677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="4409680">//&nbsp;float32FromBits&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4409765">//&nbsp;number,&nbsp;and&nbsp;returns&nbsp;it.&nbsp;It&#39;s&nbsp;a&nbsp;helper&nbsp;function&nbsp;for&nbsp;float32&nbsp;and&nbsp;complex64.</span><br>
<span class="lineno"></span><span class="comment" id="4409842">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;float64&nbsp;because&nbsp;that&#39;s&nbsp;what&nbsp;reflection&nbsp;needs,&nbsp;but&nbsp;its&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="4409919">//&nbsp;value&nbsp;is&nbsp;known&nbsp;to&nbsp;be&nbsp;accurately&nbsp;representable&nbsp;in&nbsp;a&nbsp;float32.</span><br>
<span class="lineno"></span><span class="keyword" id="4409982">func</span>&nbsp;<span class="ident" id="4409987">float32FromBits</span><span class="op" id="4410002">(</span><span class="ident" id="4410003">u</span>&nbsp;<span class="ident" id="4410005">uint64</span><span class="op" id="4410011">,</span>&nbsp;<span class="ident" id="4410013">ovfl</span>&nbsp;<span class="builtintype" id="4410018">error</span><span class="op" id="4410023">)</span>&nbsp;<span class="builtintype" id="4410025">float64</span>&nbsp;<span class="op" id="4410033">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410036">v</span>&nbsp;<span class="op" id="4410038">:=</span>&nbsp;<span class="ident" id="4410041">float64FromBits</span><span class="op" id="4410056">(</span><span class="ident" id="4410057">u</span><span class="op" id="4410058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410061">av</span>&nbsp;<span class="op" id="4410064">:=</span>&nbsp;<span class="ident" id="4410067">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410070">if</span>&nbsp;<span class="ident" id="4410073">av</span>&nbsp;<span class="op" id="4410076">&lt;</span>&nbsp;<span class="num" id="4410078">0</span>&nbsp;<span class="op" id="4410080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410084">av</span>&nbsp;<span class="op" id="4410087">=</span>&nbsp;<span class="op" id="4410089">-</span><span class="ident" id="4410090">av</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410094">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4410097">//&nbsp;+Inf&nbsp;is&nbsp;OK&nbsp;in&nbsp;both&nbsp;32-&nbsp;and&nbsp;64-bit&nbsp;floats.&nbsp;&nbsp;Underflow&nbsp;is&nbsp;always&nbsp;OK.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410168">if</span>&nbsp;<span class="ident" id="4410171">math</span><span class="op" id="4410175">.</span><span class="ident" id="4410176">MaxFloat32</span>&nbsp;<span class="op" id="4410187">&lt;</span>&nbsp;<span class="ident" id="4410189">av</span>&nbsp;<span class="op" id="4410192">&amp;&amp;</span>&nbsp;<span class="ident" id="4410195">av</span>&nbsp;<span class="op" id="4410198">&lt;=</span>&nbsp;<span class="ident" id="4410201">math</span><span class="op" id="4410205">.</span><span class="ident" id="4410206">MaxFloat64</span>&nbsp;<span class="op" id="4410217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410221">error_</span><span class="op" id="4410227">(</span><span class="ident" id="4410228">ovfl</span><span class="op" id="4410232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4410235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4410238">return</span>&nbsp;<span class="ident" id="4410245">v</span><br>
<span class="lineno">330</span><span class="op" id="4410247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4410250">//&nbsp;decFloat32&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;32-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4410330">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4410365">func</span>&nbsp;<span class="ident" id="4410370">decFloat32</span><span class="op" id="4410380">(</span><span class="ident" id="4410381">i</span>&nbsp;<span class="op" id="4410383">*</span><span class="ident" id="4410384">decInstr</span><span class="op" id="4410392">,</span>&nbsp;<span class="ident" id="4410394">state</span>&nbsp;<span class="op" id="4410400">*</span><span class="ident" id="4410401">decoderState</span><span class="op" id="4410413">,</span>&nbsp;<span class="ident" id="4410415">value</span>&nbsp;<span class="ident" id="4410421">reflect</span><span class="op" id="4410428">.</span><span class="ident" id="4410429">Value</span><span class="op" id="4410434">)</span>&nbsp;<span class="op" id="4410436">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410439">value</span><span class="op" id="4410444">.</span><span class="ident" id="4410445">SetFloat</span><span class="op" id="4410453">(</span><span class="ident" id="4410454">float32FromBits</span><span class="op" id="4410469">(</span><span class="ident" id="4410470">state</span><span class="op" id="4410475">.</span><span class="ident" id="4410476">decodeUint</span><span class="op" id="4410486">(</span><span class="op" id="4410487">)</span><span class="op" id="4410488">,</span>&nbsp;<span class="ident" id="4410490">i</span><span class="op" id="4410491">.</span><span class="ident" id="4410492">ovfl</span><span class="op" id="4410496">)</span><span class="op" id="4410497">)</span><br>
<span class="lineno"></span><span class="op" id="4410499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4410502">//&nbsp;decFloat64&nbsp;decodes&nbsp;an&nbsp;unsigned&nbsp;integer,&nbsp;treats&nbsp;it&nbsp;as&nbsp;a&nbsp;64-bit&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="4410582">//&nbsp;number,&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">340</span><span class="keyword" id="4410617">func</span>&nbsp;<span class="ident" id="4410622">decFloat64</span><span class="op" id="4410632">(</span><span class="ident" id="4410633">i</span>&nbsp;<span class="op" id="4410635">*</span><span class="ident" id="4410636">decInstr</span><span class="op" id="4410644">,</span>&nbsp;<span class="ident" id="4410646">state</span>&nbsp;<span class="op" id="4410652">*</span><span class="ident" id="4410653">decoderState</span><span class="op" id="4410665">,</span>&nbsp;<span class="ident" id="4410667">value</span>&nbsp;<span class="ident" id="4410673">reflect</span><span class="op" id="4410680">.</span><span class="ident" id="4410681">Value</span><span class="op" id="4410686">)</span>&nbsp;<span class="op" id="4410688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4410691">value</span><span class="op" id="4410696">.</span><span class="ident" id="4410697">SetFloat</span><span class="op" id="4410705">(</span><span class="ident" id="4410706">float64FromBits</span><span class="op" id="4410721">(</span><span class="ident" id="4410722">state</span><span class="op" id="4410727">.</span><span class="ident" id="4410728">decodeUint</span><span class="op" id="4410738">(</span><span class="op" id="4410739">)</span><span class="op" id="4410740">)</span><span class="op" id="4410741">)</span><br>
<span class="lineno"></span><span class="op" id="4410743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4410746">//&nbsp;decComplex64&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno">345</span><span class="comment" id="4410816">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex64&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4410892">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4410922">func</span>&nbsp;<span class="ident" id="4410927">decComplex64</span><span class="op" id="4410939">(</span><span class="ident" id="4410940">i</span>&nbsp;<span class="op" id="4410942">*</span><span class="ident" id="4410943">decInstr</span><span class="op" id="4410951">,</span>&nbsp;<span class="ident" id="4410953">state</span>&nbsp;<span class="op" id="4410959">*</span><span class="ident" id="4410960">decoderState</span><span class="op" id="4410972">,</span>&nbsp;<span class="ident" id="4410974">value</span>&nbsp;<span class="ident" id="4410980">reflect</span><span class="op" id="4410987">.</span><span class="ident" id="4410988">Value</span><span class="op" id="4410993">)</span>&nbsp;<span class="op" id="4410995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4410998">real</span>&nbsp;<span class="op" id="4411003">:=</span>&nbsp;<span class="ident" id="4411006">float32FromBits</span><span class="op" id="4411021">(</span><span class="ident" id="4411022">state</span><span class="op" id="4411027">.</span><span class="ident" id="4411028">decodeUint</span><span class="op" id="4411038">(</span><span class="op" id="4411039">)</span><span class="op" id="4411040">,</span>&nbsp;<span class="ident" id="4411042">i</span><span class="op" id="4411043">.</span><span class="ident" id="4411044">ovfl</span><span class="op" id="4411048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4411051">imag</span>&nbsp;<span class="op" id="4411056">:=</span>&nbsp;<span class="ident" id="4411059">float32FromBits</span><span class="op" id="4411074">(</span><span class="ident" id="4411075">state</span><span class="op" id="4411080">.</span><span class="ident" id="4411081">decodeUint</span><span class="op" id="4411091">(</span><span class="op" id="4411092">)</span><span class="op" id="4411093">,</span>&nbsp;<span class="ident" id="4411095">i</span><span class="op" id="4411096">.</span><span class="ident" id="4411097">ovfl</span><span class="op" id="4411101">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411104">value</span><span class="op" id="4411109">.</span><span class="ident" id="4411110">SetComplex</span><span class="op" id="4411120">(</span><span class="builtinfunc" id="4411121">complex</span><span class="op" id="4411128">(</span><span class="builtinfunc" id="4411129">real</span><span class="op" id="4411133">,</span>&nbsp;<span class="builtinfunc" id="4411135">imag</span><span class="op" id="4411139">)</span><span class="op" id="4411140">)</span><br>
<span class="lineno"></span><span class="op" id="4411142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4411145">//&nbsp;decComplex128&nbsp;decodes&nbsp;a&nbsp;pair&nbsp;of&nbsp;unsigned&nbsp;integers,&nbsp;treats&nbsp;them&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4411216">//&nbsp;pair&nbsp;of&nbsp;floating&nbsp;point&nbsp;numbers,&nbsp;and&nbsp;stores&nbsp;them&nbsp;as&nbsp;a&nbsp;complex128&nbsp;in&nbsp;value.</span><br>
<span class="lineno">355</span><span class="comment" id="4411293">//&nbsp;The&nbsp;real&nbsp;part&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4411323">func</span>&nbsp;<span class="ident" id="4411328">decComplex128</span><span class="op" id="4411341">(</span><span class="ident" id="4411342">i</span>&nbsp;<span class="op" id="4411344">*</span><span class="ident" id="4411345">decInstr</span><span class="op" id="4411353">,</span>&nbsp;<span class="ident" id="4411355">state</span>&nbsp;<span class="op" id="4411361">*</span><span class="ident" id="4411362">decoderState</span><span class="op" id="4411374">,</span>&nbsp;<span class="ident" id="4411376">value</span>&nbsp;<span class="ident" id="4411382">reflect</span><span class="op" id="4411389">.</span><span class="ident" id="4411390">Value</span><span class="op" id="4411395">)</span>&nbsp;<span class="op" id="4411397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4411400">real</span>&nbsp;<span class="op" id="4411405">:=</span>&nbsp;<span class="ident" id="4411408">float64FromBits</span><span class="op" id="4411423">(</span><span class="ident" id="4411424">state</span><span class="op" id="4411429">.</span><span class="ident" id="4411430">decodeUint</span><span class="op" id="4411440">(</span><span class="op" id="4411441">)</span><span class="op" id="4411442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4411445">imag</span>&nbsp;<span class="op" id="4411450">:=</span>&nbsp;<span class="ident" id="4411453">float64FromBits</span><span class="op" id="4411468">(</span><span class="ident" id="4411469">state</span><span class="op" id="4411474">.</span><span class="ident" id="4411475">decodeUint</span><span class="op" id="4411485">(</span><span class="op" id="4411486">)</span><span class="op" id="4411487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411490">value</span><span class="op" id="4411495">.</span><span class="ident" id="4411496">SetComplex</span><span class="op" id="4411506">(</span><span class="builtinfunc" id="4411507">complex</span><span class="op" id="4411514">(</span><span class="builtinfunc" id="4411515">real</span><span class="op" id="4411519">,</span>&nbsp;<span class="builtinfunc" id="4411521">imag</span><span class="op" id="4411525">)</span><span class="op" id="4411526">)</span><br>
<span class="lineno">360</span><span class="op" id="4411528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4411531">//&nbsp;decUint8Slice&nbsp;decodes&nbsp;a&nbsp;byte&nbsp;slice&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;slice&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4411604">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4411628">//&nbsp;uint8&nbsp;slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">365</span><span class="keyword" id="4411704">func</span>&nbsp;<span class="ident" id="4411709">decUint8Slice</span><span class="op" id="4411722">(</span><span class="ident" id="4411723">i</span>&nbsp;<span class="op" id="4411725">*</span><span class="ident" id="4411726">decInstr</span><span class="op" id="4411734">,</span>&nbsp;<span class="ident" id="4411736">state</span>&nbsp;<span class="op" id="4411742">*</span><span class="ident" id="4411743">decoderState</span><span class="op" id="4411755">,</span>&nbsp;<span class="ident" id="4411757">value</span>&nbsp;<span class="ident" id="4411763">reflect</span><span class="op" id="4411770">.</span><span class="ident" id="4411771">Value</span><span class="op" id="4411776">)</span>&nbsp;<span class="op" id="4411778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411781">u</span>&nbsp;<span class="op" id="4411783">:=</span>&nbsp;<span class="ident" id="4411786">state</span><span class="op" id="4411791">.</span><span class="ident" id="4411792">decodeUint</span><span class="op" id="4411802">(</span><span class="op" id="4411803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411806">n</span>&nbsp;<span class="op" id="4411808">:=</span>&nbsp;<span class="builtintype" id="4411811">int</span><span class="op" id="4411814">(</span><span class="ident" id="4411815">u</span><span class="op" id="4411816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411819">if</span>&nbsp;<span class="ident" id="4411822">n</span>&nbsp;<span class="op" id="4411824">&lt;</span>&nbsp;<span class="num" id="4411826">0</span>&nbsp;<span class="op" id="4411828">||</span>&nbsp;<span class="ident" id="4411831">uint64</span><span class="op" id="4411837">(</span><span class="ident" id="4411838">n</span><span class="op" id="4411839">)</span>&nbsp;<span class="op" id="4411841">!=</span>&nbsp;<span class="ident" id="4411844">u</span>&nbsp;<span class="op" id="4411846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411850">errorf</span><span class="op" id="4411856">(</span><span class="string" id="4411857">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4411901">,</span>&nbsp;<span class="ident" id="4411903">value</span><span class="op" id="4411908">.</span><span class="ident" id="4411909">Type</span><span class="op" id="4411913">(</span><span class="op" id="4411914">)</span><span class="op" id="4411915">,</span>&nbsp;<span class="ident" id="4411917">u</span><span class="op" id="4411918">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4411921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4411924">if</span>&nbsp;<span class="ident" id="4411927">n</span>&nbsp;<span class="op" id="4411929">&gt;</span>&nbsp;<span class="ident" id="4411931">state</span><span class="op" id="4411936">.</span><span class="ident" id="4411937">b</span><span class="op" id="4411938">.</span><span class="ident" id="4411939">Len</span><span class="op" id="4411942">(</span><span class="op" id="4411943">)</span>&nbsp;<span class="op" id="4411945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4411949">errorf</span><span class="op" id="4411955">(</span><span class="string" id="4411956">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4411989">,</span>&nbsp;<span class="ident" id="4411991">value</span><span class="op" id="4411996">.</span><span class="ident" id="4411997">Type</span><span class="op" id="4412001">(</span><span class="op" id="4412002">)</span><span class="op" id="4412003">,</span>&nbsp;<span class="ident" id="4412005">n</span><span class="op" id="4412006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412012">if</span>&nbsp;<span class="ident" id="4412015">n</span>&nbsp;<span class="op" id="4412017">&gt;</span>&nbsp;<span class="ident" id="4412019">tooBig</span>&nbsp;<span class="op" id="4412026">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412030">errorf</span><span class="op" id="4412036">(</span><span class="string" id="4412037">&#34;byte&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&#34;</span><span class="op" id="4412061">,</span>&nbsp;<span class="ident" id="4412063">n</span><span class="op" id="4412064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412070">if</span>&nbsp;<span class="ident" id="4412073">value</span><span class="op" id="4412078">.</span><span class="ident" id="4412079">Cap</span><span class="op" id="4412082">(</span><span class="op" id="4412083">)</span>&nbsp;<span class="op" id="4412085">&lt;</span>&nbsp;<span class="ident" id="4412087">n</span>&nbsp;<span class="op" id="4412089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412093">value</span><span class="op" id="4412098">.</span><span class="ident" id="4412099">Set</span><span class="op" id="4412102">(</span><span class="ident" id="4412103">reflect</span><span class="op" id="4412110">.</span><span class="ident" id="4412111">MakeSlice</span><span class="op" id="4412120">(</span><span class="ident" id="4412121">value</span><span class="op" id="4412126">.</span><span class="ident" id="4412127">Type</span><span class="op" id="4412131">(</span><span class="op" id="4412132">)</span><span class="op" id="4412133">,</span>&nbsp;<span class="ident" id="4412135">n</span><span class="op" id="4412136">,</span>&nbsp;<span class="ident" id="4412138">n</span><span class="op" id="4412139">)</span><span class="op" id="4412140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412143">}</span>&nbsp;<span class="keyword" id="4412145">else</span>&nbsp;<span class="op" id="4412150">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412154">value</span><span class="op" id="4412159">.</span><span class="ident" id="4412160">Set</span><span class="op" id="4412163">(</span><span class="ident" id="4412164">value</span><span class="op" id="4412169">.</span><span class="ident" id="4412170">Slice</span><span class="op" id="4412175">(</span><span class="num" id="4412176">0</span><span class="op" id="4412177">,</span>&nbsp;<span class="ident" id="4412179">n</span><span class="op" id="4412180">)</span><span class="op" id="4412181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412187">if</span>&nbsp;<span class="ident" id="4412190">_</span><span class="op" id="4412191">,</span>&nbsp;<span class="ident" id="4412193">err</span>&nbsp;<span class="op" id="4412197">:=</span>&nbsp;<span class="ident" id="4412200">state</span><span class="op" id="4412205">.</span><span class="ident" id="4412206">b</span><span class="op" id="4412207">.</span><span class="ident" id="4412208">Read</span><span class="op" id="4412212">(</span><span class="ident" id="4412213">value</span><span class="op" id="4412218">.</span><span class="ident" id="4412219">Bytes</span><span class="op" id="4412224">(</span><span class="op" id="4412225">)</span><span class="op" id="4412226">)</span><span class="op" id="4412227">;</span>&nbsp;<span class="ident" id="4412229">err</span>&nbsp;<span class="op" id="4412233">!=</span>&nbsp;<span class="ident" id="4412236">nil</span>&nbsp;<span class="op" id="4412240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412244">errorf</span><span class="op" id="4412250">(</span><span class="string" id="4412251">&#34;error&nbsp;decoding&nbsp;[]byte:&nbsp;%s&#34;</span><span class="op" id="4412278">,</span>&nbsp;<span class="ident" id="4412280">err</span><span class="op" id="4412283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412286">}</span><br>
<span class="lineno">385</span><span class="op" id="4412288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4412291">//&nbsp;decString&nbsp;decodes&nbsp;byte&nbsp;array&nbsp;and&nbsp;stores&nbsp;in&nbsp;value&nbsp;a&nbsp;string&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="4412359">//&nbsp;describing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4412383">//&nbsp;Strings&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;count&nbsp;followed&nbsp;by&nbsp;the&nbsp;raw&nbsp;bytes.</span><br>
<span class="lineno">390</span><span class="keyword" id="4412454">func</span>&nbsp;<span class="ident" id="4412459">decString</span><span class="op" id="4412468">(</span><span class="ident" id="4412469">i</span>&nbsp;<span class="op" id="4412471">*</span><span class="ident" id="4412472">decInstr</span><span class="op" id="4412480">,</span>&nbsp;<span class="ident" id="4412482">state</span>&nbsp;<span class="op" id="4412488">*</span><span class="ident" id="4412489">decoderState</span><span class="op" id="4412501">,</span>&nbsp;<span class="ident" id="4412503">value</span>&nbsp;<span class="ident" id="4412509">reflect</span><span class="op" id="4412516">.</span><span class="ident" id="4412517">Value</span><span class="op" id="4412522">)</span>&nbsp;<span class="op" id="4412524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412527">u</span>&nbsp;<span class="op" id="4412529">:=</span>&nbsp;<span class="ident" id="4412532">state</span><span class="op" id="4412537">.</span><span class="ident" id="4412538">decodeUint</span><span class="op" id="4412548">(</span><span class="op" id="4412549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412552">n</span>&nbsp;<span class="op" id="4412554">:=</span>&nbsp;<span class="builtintype" id="4412557">int</span><span class="op" id="4412560">(</span><span class="ident" id="4412561">u</span><span class="op" id="4412562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412565">if</span>&nbsp;<span class="ident" id="4412568">n</span>&nbsp;<span class="op" id="4412570">&lt;</span>&nbsp;<span class="num" id="4412572">0</span>&nbsp;<span class="op" id="4412574">||</span>&nbsp;<span class="ident" id="4412577">uint64</span><span class="op" id="4412583">(</span><span class="ident" id="4412584">n</span><span class="op" id="4412585">)</span>&nbsp;<span class="op" id="4412587">!=</span>&nbsp;<span class="ident" id="4412590">u</span>&nbsp;<span class="op" id="4412592">||</span>&nbsp;<span class="ident" id="4412595">n</span>&nbsp;<span class="op" id="4412597">&gt;</span>&nbsp;<span class="ident" id="4412599">state</span><span class="op" id="4412604">.</span><span class="ident" id="4412605">b</span><span class="op" id="4412606">.</span><span class="ident" id="4412607">Len</span><span class="op" id="4412610">(</span><span class="op" id="4412611">)</span>&nbsp;<span class="op" id="4412613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412617">errorf</span><span class="op" id="4412623">(</span><span class="string" id="4412624">&#34;length&nbsp;of&nbsp;%s&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;bytes)&#34;</span><span class="op" id="4412668">,</span>&nbsp;<span class="ident" id="4412670">value</span><span class="op" id="4412675">.</span><span class="ident" id="4412676">Type</span><span class="op" id="4412680">(</span><span class="op" id="4412681">)</span><span class="op" id="4412682">,</span>&nbsp;<span class="ident" id="4412684">u</span><span class="op" id="4412685">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412691">if</span>&nbsp;<span class="ident" id="4412694">n</span>&nbsp;<span class="op" id="4412696">&gt;</span>&nbsp;<span class="ident" id="4412698">state</span><span class="op" id="4412703">.</span><span class="ident" id="4412704">b</span><span class="op" id="4412705">.</span><span class="ident" id="4412706">Len</span><span class="op" id="4412709">(</span><span class="op" id="4412710">)</span>&nbsp;<span class="op" id="4412712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412716">errorf</span><span class="op" id="4412722">(</span><span class="string" id="4412723">&#34;%s&nbsp;data&nbsp;too&nbsp;long&nbsp;for&nbsp;buffer:&nbsp;%d&#34;</span><span class="op" id="4412756">,</span>&nbsp;<span class="ident" id="4412758">value</span><span class="op" id="4412763">.</span><span class="ident" id="4412764">Type</span><span class="op" id="4412768">(</span><span class="op" id="4412769">)</span><span class="op" id="4412770">,</span>&nbsp;<span class="ident" id="4412772">n</span><span class="op" id="4412773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4412779">//&nbsp;Read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412798">data</span>&nbsp;<span class="op" id="4412803">:=</span>&nbsp;<span class="builtinfunc" id="4412806">make</span><span class="op" id="4412810">(</span><span class="op" id="4412811">[</span><span class="op" id="4412812">]</span><span class="builtintype" id="4412813">byte</span><span class="op" id="4412817">,</span>&nbsp;<span class="ident" id="4412819">n</span><span class="op" id="4412820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4412823">if</span>&nbsp;<span class="ident" id="4412826">_</span><span class="op" id="4412827">,</span>&nbsp;<span class="ident" id="4412829">err</span>&nbsp;<span class="op" id="4412833">:=</span>&nbsp;<span class="ident" id="4412836">state</span><span class="op" id="4412841">.</span><span class="ident" id="4412842">b</span><span class="op" id="4412843">.</span><span class="ident" id="4412844">Read</span><span class="op" id="4412848">(</span><span class="ident" id="4412849">data</span><span class="op" id="4412853">)</span><span class="op" id="4412854">;</span>&nbsp;<span class="ident" id="4412856">err</span>&nbsp;<span class="op" id="4412860">!=</span>&nbsp;<span class="ident" id="4412863">nil</span>&nbsp;<span class="op" id="4412867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412871">errorf</span><span class="op" id="4412877">(</span><span class="string" id="4412878">&#34;error&nbsp;decoding&nbsp;string:&nbsp;%s&#34;</span><span class="op" id="4412905">,</span>&nbsp;<span class="ident" id="4412907">err</span><span class="op" id="4412910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4412913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4412916">value</span><span class="op" id="4412921">.</span><span class="ident" id="4412922">SetString</span><span class="op" id="4412931">(</span><span class="builtintype" id="4412932">string</span><span class="op" id="4412938">(</span><span class="ident" id="4412939">data</span><span class="op" id="4412943">)</span><span class="op" id="4412944">)</span><br>
<span class="lineno">405</span><span class="op" id="4412946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4412949">//&nbsp;ignoreUint8Array&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;byte&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4413033">func</span>&nbsp;<span class="ident" id="4413038">ignoreUint8Array</span><span class="op" id="4413054">(</span><span class="ident" id="4413055">i</span>&nbsp;<span class="op" id="4413057">*</span><span class="ident" id="4413058">decInstr</span><span class="op" id="4413066">,</span>&nbsp;<span class="ident" id="4413068">state</span>&nbsp;<span class="op" id="4413074">*</span><span class="ident" id="4413075">decoderState</span><span class="op" id="4413087">,</span>&nbsp;<span class="ident" id="4413089">value</span>&nbsp;<span class="ident" id="4413095">reflect</span><span class="op" id="4413102">.</span><span class="ident" id="4413103">Value</span><span class="op" id="4413108">)</span>&nbsp;<span class="op" id="4413110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413113">b</span>&nbsp;<span class="op" id="4413115">:=</span>&nbsp;<span class="builtinfunc" id="4413118">make</span><span class="op" id="4413122">(</span><span class="op" id="4413123">[</span><span class="op" id="4413124">]</span><span class="builtintype" id="4413125">byte</span><span class="op" id="4413129">,</span>&nbsp;<span class="ident" id="4413131">state</span><span class="op" id="4413136">.</span><span class="ident" id="4413137">decodeUint</span><span class="op" id="4413147">(</span><span class="op" id="4413148">)</span><span class="op" id="4413149">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413152">state</span><span class="op" id="4413157">.</span><span class="ident" id="4413158">b</span><span class="op" id="4413159">.</span><span class="ident" id="4413160">Read</span><span class="op" id="4413164">(</span><span class="ident" id="4413165">b</span><span class="op" id="4413166">)</span><br>
<span class="lineno"></span><span class="op" id="4413168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4413171">//&nbsp;Execution&nbsp;engine</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4413192">//&nbsp;The&nbsp;encoder&nbsp;engine&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;instructions&nbsp;indexed&nbsp;by&nbsp;field&nbsp;number&nbsp;of&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4413282">//&nbsp;decoder.&nbsp;&nbsp;It&nbsp;is&nbsp;executed&nbsp;with&nbsp;random&nbsp;access&nbsp;according&nbsp;to&nbsp;field&nbsp;number.</span><br>
<span class="lineno"></span><span class="keyword" id="4413356">type</span>&nbsp;<span class="ident" id="4413361">decEngine</span>&nbsp;<span class="keyword" id="4413371">struct</span>&nbsp;<span class="op" id="4413378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413381">instr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4413390">[</span><span class="op" id="4413391">]</span><span class="ident" id="4413392">decInstr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413402">numInstr</span>&nbsp;<span class="builtintype" id="4413411">int</span>&nbsp;<span class="comment" id="4413415">//&nbsp;the&nbsp;number&nbsp;of&nbsp;active&nbsp;instructions</span><br>
<span class="lineno">420</span><span class="op" id="4413452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4413455">//&nbsp;decodeSingle&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;value&nbsp;that&nbsp;is&nbsp;not&nbsp;a&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4413542">//&nbsp;Such&nbsp;values&nbsp;are&nbsp;preceded&nbsp;by&nbsp;a&nbsp;zero,&nbsp;making&nbsp;them&nbsp;have&nbsp;the&nbsp;memory&nbsp;layout&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4413621">//&nbsp;struct&nbsp;field&nbsp;(although&nbsp;with&nbsp;an&nbsp;illegal&nbsp;field&nbsp;number).</span><br>
<span class="lineno">425</span><span class="keyword" id="4413678">func</span>&nbsp;<span class="op" id="4413683">(</span><span class="ident" id="4413684">dec</span>&nbsp;<span class="op" id="4413688">*</span><span class="ident" id="4413689">Decoder</span><span class="op" id="4413696">)</span>&nbsp;<span class="ident" id="4413698">decodeSingle</span><span class="op" id="4413710">(</span><span class="ident" id="4413711">engine</span>&nbsp;<span class="op" id="4413718">*</span><span class="ident" id="4413719">decEngine</span><span class="op" id="4413728">,</span>&nbsp;<span class="ident" id="4413730">ut</span>&nbsp;<span class="op" id="4413733">*</span><span class="ident" id="4413734">userTypeInfo</span><span class="op" id="4413746">,</span>&nbsp;<span class="ident" id="4413748">value</span>&nbsp;<span class="ident" id="4413754">reflect</span><span class="op" id="4413761">.</span><span class="ident" id="4413762">Value</span><span class="op" id="4413767">)</span>&nbsp;<span class="op" id="4413769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413772">state</span>&nbsp;<span class="op" id="4413778">:=</span>&nbsp;<span class="ident" id="4413781">dec</span><span class="op" id="4413784">.</span><span class="ident" id="4413785">newDecoderState</span><span class="op" id="4413800">(</span><span class="op" id="4413801">&amp;</span><span class="ident" id="4413802">dec</span><span class="op" id="4413805">.</span><span class="ident" id="4413806">buf</span><span class="op" id="4413809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413812">defer</span>&nbsp;<span class="ident" id="4413818">dec</span><span class="op" id="4413821">.</span><span class="ident" id="4413822">freeDecoderState</span><span class="op" id="4413838">(</span><span class="ident" id="4413839">state</span><span class="op" id="4413844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413847">state</span><span class="op" id="4413852">.</span><span class="ident" id="4413853">fieldnum</span>&nbsp;<span class="op" id="4413862">=</span>&nbsp;<span class="ident" id="4413864">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4413880">if</span>&nbsp;<span class="ident" id="4413883">state</span><span class="op" id="4413888">.</span><span class="ident" id="4413889">decodeUint</span><span class="op" id="4413899">(</span><span class="op" id="4413900">)</span>&nbsp;<span class="op" id="4413902">!=</span>&nbsp;<span class="num" id="4413905">0</span>&nbsp;<span class="op" id="4413907">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413911">errorf</span><span class="op" id="4413917">(</span><span class="string" id="4413918">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4413972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4413975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413978">instr</span>&nbsp;<span class="op" id="4413984">:=</span>&nbsp;<span class="op" id="4413987">&amp;</span><span class="ident" id="4413988">engine</span><span class="op" id="4413994">.</span><span class="ident" id="4413995">instr</span><span class="op" id="4414000">[</span><span class="ident" id="4414001">singletonField</span><span class="op" id="4414015">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414018">instr</span><span class="op" id="4414023">.</span><span class="ident" id="4414024">op</span><span class="op" id="4414026">(</span><span class="ident" id="4414027">instr</span><span class="op" id="4414032">,</span>&nbsp;<span class="ident" id="4414034">state</span><span class="op" id="4414039">,</span>&nbsp;<span class="ident" id="4414041">value</span><span class="op" id="4414046">)</span><br>
<span class="lineno"></span><span class="op" id="4414048">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="4414051">//&nbsp;decodeStruct&nbsp;decodes&nbsp;a&nbsp;top-level&nbsp;struct&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4414118">//&nbsp;Indir&nbsp;is&nbsp;for&nbsp;the&nbsp;value,&nbsp;not&nbsp;the&nbsp;type.&nbsp;&nbsp;At&nbsp;the&nbsp;time&nbsp;of&nbsp;the&nbsp;call&nbsp;it&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4414191">//&nbsp;differ&nbsp;from&nbsp;ut.indir,&nbsp;which&nbsp;was&nbsp;computed&nbsp;when&nbsp;the&nbsp;engine&nbsp;was&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="4414262">//&nbsp;This&nbsp;state&nbsp;cannot&nbsp;arise&nbsp;for&nbsp;decodeSingle,&nbsp;which&nbsp;is&nbsp;called&nbsp;directly</span><br>
<span class="lineno">440</span><span class="comment" id="4414332">//&nbsp;from&nbsp;the&nbsp;user&#39;s&nbsp;value,&nbsp;not&nbsp;from&nbsp;the&nbsp;innards&nbsp;of&nbsp;an&nbsp;engine.</span><br>
<span class="lineno"></span><span class="keyword" id="4414393">func</span>&nbsp;<span class="op" id="4414398">(</span><span class="ident" id="4414399">dec</span>&nbsp;<span class="op" id="4414403">*</span><span class="ident" id="4414404">Decoder</span><span class="op" id="4414411">)</span>&nbsp;<span class="ident" id="4414413">decodeStruct</span><span class="op" id="4414425">(</span><span class="ident" id="4414426">engine</span>&nbsp;<span class="op" id="4414433">*</span><span class="ident" id="4414434">decEngine</span><span class="op" id="4414443">,</span>&nbsp;<span class="ident" id="4414445">ut</span>&nbsp;<span class="op" id="4414448">*</span><span class="ident" id="4414449">userTypeInfo</span><span class="op" id="4414461">,</span>&nbsp;<span class="ident" id="4414463">value</span>&nbsp;<span class="ident" id="4414469">reflect</span><span class="op" id="4414476">.</span><span class="ident" id="4414477">Value</span><span class="op" id="4414482">)</span>&nbsp;<span class="op" id="4414484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414487">state</span>&nbsp;<span class="op" id="4414493">:=</span>&nbsp;<span class="ident" id="4414496">dec</span><span class="op" id="4414499">.</span><span class="ident" id="4414500">newDecoderState</span><span class="op" id="4414515">(</span><span class="op" id="4414516">&amp;</span><span class="ident" id="4414517">dec</span><span class="op" id="4414520">.</span><span class="ident" id="4414521">buf</span><span class="op" id="4414524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414527">defer</span>&nbsp;<span class="ident" id="4414533">dec</span><span class="op" id="4414536">.</span><span class="ident" id="4414537">freeDecoderState</span><span class="op" id="4414553">(</span><span class="ident" id="4414554">state</span><span class="op" id="4414559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414562">state</span><span class="op" id="4414567">.</span><span class="ident" id="4414568">fieldnum</span>&nbsp;<span class="op" id="4414577">=</span>&nbsp;<span class="op" id="4414579">-</span><span class="num" id="4414580">1</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414583">for</span>&nbsp;<span class="ident" id="4414587">state</span><span class="op" id="4414592">.</span><span class="ident" id="4414593">b</span><span class="op" id="4414594">.</span><span class="ident" id="4414595">Len</span><span class="op" id="4414598">(</span><span class="op" id="4414599">)</span>&nbsp;<span class="op" id="4414601">&gt;</span>&nbsp;<span class="num" id="4414603">0</span>&nbsp;<span class="op" id="4414605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414609">delta</span>&nbsp;<span class="op" id="4414615">:=</span>&nbsp;<span class="builtintype" id="4414618">int</span><span class="op" id="4414621">(</span><span class="ident" id="4414622">state</span><span class="op" id="4414627">.</span><span class="ident" id="4414628">decodeUint</span><span class="op" id="4414638">(</span><span class="op" id="4414639">)</span><span class="op" id="4414640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414644">if</span>&nbsp;<span class="ident" id="4414647">delta</span>&nbsp;<span class="op" id="4414653">&lt;</span>&nbsp;<span class="num" id="4414655">0</span>&nbsp;<span class="op" id="4414657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414662">errorf</span><span class="op" id="4414668">(</span><span class="string" id="4414669">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4414709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414713">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414717">if</span>&nbsp;<span class="ident" id="4414720">delta</span>&nbsp;<span class="op" id="4414726">==</span>&nbsp;<span class="num" id="4414729">0</span>&nbsp;<span class="op" id="4414731">{</span>&nbsp;<span class="comment" id="4414733">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414792">fieldnum</span>&nbsp;<span class="op" id="4414801">:=</span>&nbsp;<span class="ident" id="4414804">state</span><span class="op" id="4414809">.</span><span class="ident" id="4414810">fieldnum</span>&nbsp;<span class="op" id="4414819">+</span>&nbsp;<span class="ident" id="4414821">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414829">if</span>&nbsp;<span class="ident" id="4414832">fieldnum</span>&nbsp;<span class="op" id="4414841">&gt;=</span>&nbsp;<span class="builtinfunc" id="4414844">len</span><span class="op" id="4414847">(</span><span class="ident" id="4414848">engine</span><span class="op" id="4414854">.</span><span class="ident" id="4414855">instr</span><span class="op" id="4414860">)</span>&nbsp;<span class="op" id="4414862">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414867">error_</span><span class="op" id="4414873">(</span><span class="ident" id="4414874">errRange</span><span class="op" id="4414882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414887">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414899">instr</span>&nbsp;<span class="op" id="4414905">:=</span>&nbsp;<span class="op" id="4414908">&amp;</span><span class="ident" id="4414909">engine</span><span class="op" id="4414915">.</span><span class="ident" id="4414916">instr</span><span class="op" id="4414921">[</span><span class="ident" id="4414922">fieldnum</span><span class="op" id="4414930">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414934">var</span>&nbsp;<span class="ident" id="4414938">field</span>&nbsp;<span class="ident" id="4414944">reflect</span><span class="op" id="4414951">.</span><span class="ident" id="4414952">Value</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414960">if</span>&nbsp;<span class="ident" id="4414963">instr</span><span class="op" id="4414968">.</span><span class="ident" id="4414969">index</span>&nbsp;<span class="op" id="4414975">!=</span>&nbsp;<span class="ident" id="4414978">nil</span>&nbsp;<span class="op" id="4414982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414987">//&nbsp;Otherwise&nbsp;the&nbsp;field&nbsp;is&nbsp;unknown&nbsp;to&nbsp;us&nbsp;and&nbsp;instr.op&nbsp;is&nbsp;an&nbsp;ignore&nbsp;op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415060">field</span>&nbsp;<span class="op" id="4415066">=</span>&nbsp;<span class="ident" id="4415068">value</span><span class="op" id="4415073">.</span><span class="ident" id="4415074">FieldByIndex</span><span class="op" id="4415086">(</span><span class="ident" id="4415087">instr</span><span class="op" id="4415092">.</span><span class="ident" id="4415093">index</span><span class="op" id="4415098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415103">if</span>&nbsp;<span class="ident" id="4415106">field</span><span class="op" id="4415111">.</span><span class="ident" id="4415112">Kind</span><span class="op" id="4415116">(</span><span class="op" id="4415117">)</span>&nbsp;<span class="op" id="4415119">==</span>&nbsp;<span class="ident" id="4415122">reflect</span><span class="op" id="4415129">.</span><span class="ident" id="4415130">Ptr</span>&nbsp;<span class="op" id="4415134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415140">field</span>&nbsp;<span class="op" id="4415146">=</span>&nbsp;<span class="ident" id="4415148">decAlloc</span><span class="op" id="4415156">(</span><span class="ident" id="4415157">field</span><span class="op" id="4415162">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415175">instr</span><span class="op" id="4415180">.</span><span class="ident" id="4415181">op</span><span class="op" id="4415183">(</span><span class="ident" id="4415184">instr</span><span class="op" id="4415189">,</span>&nbsp;<span class="ident" id="4415191">state</span><span class="op" id="4415196">,</span>&nbsp;<span class="ident" id="4415198">field</span><span class="op" id="4415203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415207">state</span><span class="op" id="4415212">.</span><span class="ident" id="4415213">fieldnum</span>&nbsp;<span class="op" id="4415222">=</span>&nbsp;<span class="ident" id="4415224">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415234">}</span><br>
<span class="lineno">470</span><span class="op" id="4415236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4415239">var</span>&nbsp;<span class="ident" id="4415243">noValue</span>&nbsp;<span class="ident" id="4415251">reflect</span><span class="op" id="4415258">.</span><span class="ident" id="4415259">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4415266">//&nbsp;ignoreStruct&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;struct&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">475</span><span class="keyword" id="4415334">func</span>&nbsp;<span class="op" id="4415339">(</span><span class="ident" id="4415340">dec</span>&nbsp;<span class="op" id="4415344">*</span><span class="ident" id="4415345">Decoder</span><span class="op" id="4415352">)</span>&nbsp;<span class="ident" id="4415354">ignoreStruct</span><span class="op" id="4415366">(</span><span class="ident" id="4415367">engine</span>&nbsp;<span class="op" id="4415374">*</span><span class="ident" id="4415375">decEngine</span><span class="op" id="4415384">)</span>&nbsp;<span class="op" id="4415386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415389">state</span>&nbsp;<span class="op" id="4415395">:=</span>&nbsp;<span class="ident" id="4415398">dec</span><span class="op" id="4415401">.</span><span class="ident" id="4415402">newDecoderState</span><span class="op" id="4415417">(</span><span class="op" id="4415418">&amp;</span><span class="ident" id="4415419">dec</span><span class="op" id="4415422">.</span><span class="ident" id="4415423">buf</span><span class="op" id="4415426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415429">defer</span>&nbsp;<span class="ident" id="4415435">dec</span><span class="op" id="4415438">.</span><span class="ident" id="4415439">freeDecoderState</span><span class="op" id="4415455">(</span><span class="ident" id="4415456">state</span><span class="op" id="4415461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415464">state</span><span class="op" id="4415469">.</span><span class="ident" id="4415470">fieldnum</span>&nbsp;<span class="op" id="4415479">=</span>&nbsp;<span class="op" id="4415481">-</span><span class="num" id="4415482">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415485">for</span>&nbsp;<span class="ident" id="4415489">state</span><span class="op" id="4415494">.</span><span class="ident" id="4415495">b</span><span class="op" id="4415496">.</span><span class="ident" id="4415497">Len</span><span class="op" id="4415500">(</span><span class="op" id="4415501">)</span>&nbsp;<span class="op" id="4415503">&gt;</span>&nbsp;<span class="num" id="4415505">0</span>&nbsp;<span class="op" id="4415507">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415511">delta</span>&nbsp;<span class="op" id="4415517">:=</span>&nbsp;<span class="builtintype" id="4415520">int</span><span class="op" id="4415523">(</span><span class="ident" id="4415524">state</span><span class="op" id="4415529">.</span><span class="ident" id="4415530">decodeUint</span><span class="op" id="4415540">(</span><span class="op" id="4415541">)</span><span class="op" id="4415542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415546">if</span>&nbsp;<span class="ident" id="4415549">delta</span>&nbsp;<span class="op" id="4415555">&lt;</span>&nbsp;<span class="num" id="4415557">0</span>&nbsp;<span class="op" id="4415559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415564">errorf</span><span class="op" id="4415570">(</span><span class="string" id="4415571">&#34;ignore&nbsp;decode:&nbsp;corrupted&nbsp;data:&nbsp;negative&nbsp;delta&#34;</span><span class="op" id="4415618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415626">if</span>&nbsp;<span class="ident" id="4415629">delta</span>&nbsp;<span class="op" id="4415635">==</span>&nbsp;<span class="num" id="4415638">0</span>&nbsp;<span class="op" id="4415640">{</span>&nbsp;<span class="comment" id="4415642">//&nbsp;struct&nbsp;terminator&nbsp;is&nbsp;zero&nbsp;delta&nbsp;fieldnum</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415689">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415701">fieldnum</span>&nbsp;<span class="op" id="4415710">:=</span>&nbsp;<span class="ident" id="4415713">state</span><span class="op" id="4415718">.</span><span class="ident" id="4415719">fieldnum</span>&nbsp;<span class="op" id="4415728">+</span>&nbsp;<span class="ident" id="4415730">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415738">if</span>&nbsp;<span class="ident" id="4415741">fieldnum</span>&nbsp;<span class="op" id="4415750">&gt;=</span>&nbsp;<span class="builtinfunc" id="4415753">len</span><span class="op" id="4415756">(</span><span class="ident" id="4415757">engine</span><span class="op" id="4415763">.</span><span class="ident" id="4415764">instr</span><span class="op" id="4415769">)</span>&nbsp;<span class="op" id="4415771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415776">error_</span><span class="op" id="4415782">(</span><span class="ident" id="4415783">errRange</span><span class="op" id="4415791">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415799">instr</span>&nbsp;<span class="op" id="4415805">:=</span>&nbsp;<span class="op" id="4415808">&amp;</span><span class="ident" id="4415809">engine</span><span class="op" id="4415815">.</span><span class="ident" id="4415816">instr</span><span class="op" id="4415821">[</span><span class="ident" id="4415822">fieldnum</span><span class="op" id="4415830">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415834">instr</span><span class="op" id="4415839">.</span><span class="ident" id="4415840">op</span><span class="op" id="4415842">(</span><span class="ident" id="4415843">instr</span><span class="op" id="4415848">,</span>&nbsp;<span class="ident" id="4415850">state</span><span class="op" id="4415855">,</span>&nbsp;<span class="ident" id="4415857">noValue</span><span class="op" id="4415864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415868">state</span><span class="op" id="4415873">.</span><span class="ident" id="4415874">fieldnum</span>&nbsp;<span class="op" id="4415883">=</span>&nbsp;<span class="ident" id="4415885">fieldnum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415895">}</span><br>
<span class="lineno">495</span><span class="op" id="4415897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4415900">//&nbsp;ignoreSingle&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;top-level&nbsp;non-struct&nbsp;value&nbsp;with&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="4415975">//&nbsp;destination.&nbsp;It&#39;s&nbsp;used&nbsp;when&nbsp;calling&nbsp;Decode&nbsp;with&nbsp;a&nbsp;nil&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4416039">func</span>&nbsp;<span class="op" id="4416044">(</span><span class="ident" id="4416045">dec</span>&nbsp;<span class="op" id="4416049">*</span><span class="ident" id="4416050">Decoder</span><span class="op" id="4416057">)</span>&nbsp;<span class="ident" id="4416059">ignoreSingle</span><span class="op" id="4416071">(</span><span class="ident" id="4416072">engine</span>&nbsp;<span class="op" id="4416079">*</span><span class="ident" id="4416080">decEngine</span><span class="op" id="4416089">)</span>&nbsp;<span class="op" id="4416091">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416094">state</span>&nbsp;<span class="op" id="4416100">:=</span>&nbsp;<span class="ident" id="4416103">dec</span><span class="op" id="4416106">.</span><span class="ident" id="4416107">newDecoderState</span><span class="op" id="4416122">(</span><span class="op" id="4416123">&amp;</span><span class="ident" id="4416124">dec</span><span class="op" id="4416127">.</span><span class="ident" id="4416128">buf</span><span class="op" id="4416131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416134">defer</span>&nbsp;<span class="ident" id="4416140">dec</span><span class="op" id="4416143">.</span><span class="ident" id="4416144">freeDecoderState</span><span class="op" id="4416160">(</span><span class="ident" id="4416161">state</span><span class="op" id="4416166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416169">state</span><span class="op" id="4416174">.</span><span class="ident" id="4416175">fieldnum</span>&nbsp;<span class="op" id="4416184">=</span>&nbsp;<span class="ident" id="4416186">singletonField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416202">delta</span>&nbsp;<span class="op" id="4416208">:=</span>&nbsp;<span class="builtintype" id="4416211">int</span><span class="op" id="4416214">(</span><span class="ident" id="4416215">state</span><span class="op" id="4416220">.</span><span class="ident" id="4416221">decodeUint</span><span class="op" id="4416231">(</span><span class="op" id="4416232">)</span><span class="op" id="4416233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416236">if</span>&nbsp;<span class="ident" id="4416239">delta</span>&nbsp;<span class="op" id="4416245">!=</span>&nbsp;<span class="num" id="4416248">0</span>&nbsp;<span class="op" id="4416250">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416254">errorf</span><span class="op" id="4416260">(</span><span class="string" id="4416261">&#34;decode:&nbsp;corrupted&nbsp;data:&nbsp;non-zero&nbsp;delta&nbsp;for&nbsp;singleton&#34;</span><span class="op" id="4416315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416321">instr</span>&nbsp;<span class="op" id="4416327">:=</span>&nbsp;<span class="op" id="4416330">&amp;</span><span class="ident" id="4416331">engine</span><span class="op" id="4416337">.</span><span class="ident" id="4416338">instr</span><span class="op" id="4416343">[</span><span class="ident" id="4416344">singletonField</span><span class="op" id="4416358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416361">instr</span><span class="op" id="4416366">.</span><span class="ident" id="4416367">op</span><span class="op" id="4416369">(</span><span class="ident" id="4416370">instr</span><span class="op" id="4416375">,</span>&nbsp;<span class="ident" id="4416377">state</span><span class="op" id="4416382">,</span>&nbsp;<span class="ident" id="4416384">noValue</span><span class="op" id="4416391">)</span><br>
<span class="lineno"></span><span class="op" id="4416393">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="comment" id="4416396">//&nbsp;decodeArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;decoding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4416463">func</span>&nbsp;<span class="op" id="4416468">(</span><span class="ident" id="4416469">dec</span>&nbsp;<span class="op" id="4416473">*</span><span class="ident" id="4416474">Decoder</span><span class="op" id="4416481">)</span>&nbsp;<span class="ident" id="4416483">decodeArrayHelper</span><span class="op" id="4416500">(</span><span class="ident" id="4416501">state</span>&nbsp;<span class="op" id="4416507">*</span><span class="ident" id="4416508">decoderState</span><span class="op" id="4416520">,</span>&nbsp;<span class="ident" id="4416522">value</span>&nbsp;<span class="ident" id="4416528">reflect</span><span class="op" id="4416535">.</span><span class="ident" id="4416536">Value</span><span class="op" id="4416541">,</span>&nbsp;<span class="ident" id="4416543">elemOp</span>&nbsp;<span class="ident" id="4416550">decOp</span><span class="op" id="4416555">,</span>&nbsp;<span class="ident" id="4416557">length</span>&nbsp;<span class="builtintype" id="4416564">int</span><span class="op" id="4416567">,</span>&nbsp;<span class="ident" id="4416569">ovfl</span>&nbsp;<span class="builtintype" id="4416574">error</span><span class="op" id="4416579">,</span>&nbsp;<span class="ident" id="4416581">helper</span>&nbsp;<span class="ident" id="4416588">decHelper</span><span class="op" id="4416597">)</span>&nbsp;<span class="op" id="4416599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416602">if</span>&nbsp;<span class="ident" id="4416605">helper</span>&nbsp;<span class="op" id="4416612">!=</span>&nbsp;<span class="ident" id="4416615">nil</span>&nbsp;<span class="op" id="4416619">&amp;&amp;</span>&nbsp;<span class="ident" id="4416622">helper</span><span class="op" id="4416628">(</span><span class="ident" id="4416629">state</span><span class="op" id="4416634">,</span>&nbsp;<span class="ident" id="4416636">value</span><span class="op" id="4416641">,</span>&nbsp;<span class="ident" id="4416643">length</span><span class="op" id="4416649">,</span>&nbsp;<span class="ident" id="4416651">ovfl</span><span class="op" id="4416655">)</span>&nbsp;<span class="op" id="4416657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416661">return</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416672">instr</span>&nbsp;<span class="op" id="4416678">:=</span>&nbsp;<span class="op" id="4416681">&amp;</span><span class="ident" id="4416682">decInstr</span><span class="op" id="4416690">{</span><span class="ident" id="4416691">elemOp</span><span class="op" id="4416697">,</span>&nbsp;<span class="num" id="4416699">0</span><span class="op" id="4416700">,</span>&nbsp;<span class="ident" id="4416702">nil</span><span class="op" id="4416705">,</span>&nbsp;<span class="ident" id="4416707">ovfl</span><span class="op" id="4416711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416714">isPtr</span>&nbsp;<span class="op" id="4416720">:=</span>&nbsp;<span class="ident" id="4416723">value</span><span class="op" id="4416728">.</span><span class="ident" id="4416729">Type</span><span class="op" id="4416733">(</span><span class="op" id="4416734">)</span><span class="op" id="4416735">.</span><span class="ident" id="4416736">Elem</span><span class="op" id="4416740">(</span><span class="op" id="4416741">)</span><span class="op" id="4416742">.</span><span class="ident" id="4416743">Kind</span><span class="op" id="4416747">(</span><span class="op" id="4416748">)</span>&nbsp;<span class="op" id="4416750">==</span>&nbsp;<span class="ident" id="4416753">reflect</span><span class="op" id="4416760">.</span><span class="ident" id="4416761">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416766">for</span>&nbsp;<span class="ident" id="4416770">i</span>&nbsp;<span class="op" id="4416772">:=</span>&nbsp;<span class="num" id="4416775">0</span><span class="op" id="4416776">;</span>&nbsp;<span class="ident" id="4416778">i</span>&nbsp;<span class="op" id="4416780">&lt;</span>&nbsp;<span class="ident" id="4416782">length</span><span class="op" id="4416788">;</span>&nbsp;<span class="ident" id="4416790">i</span><span class="op" id="4416791">++</span>&nbsp;<span class="op" id="4416794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416798">if</span>&nbsp;<span class="ident" id="4416801">state</span><span class="op" id="4416806">.</span><span class="ident" id="4416807">b</span><span class="op" id="4416808">.</span><span class="ident" id="4416809">Len</span><span class="op" id="4416812">(</span><span class="op" id="4416813">)</span>&nbsp;<span class="op" id="4416815">==</span>&nbsp;<span class="num" id="4416818">0</span>&nbsp;<span class="op" id="4416820">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416825">errorf</span><span class="op" id="4416831">(</span><span class="string" id="4416832">&#34;decoding&nbsp;array&nbsp;or&nbsp;slice:&nbsp;length&nbsp;exceeds&nbsp;input&nbsp;size&nbsp;(%d&nbsp;elements)&#34;</span><span class="op" id="4416898">,</span>&nbsp;<span class="ident" id="4416900">length</span><span class="op" id="4416906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416914">v</span>&nbsp;<span class="op" id="4416916">:=</span>&nbsp;<span class="ident" id="4416919">value</span><span class="op" id="4416924">.</span><span class="ident" id="4416925">Index</span><span class="op" id="4416930">(</span><span class="ident" id="4416931">i</span><span class="op" id="4416932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416936">if</span>&nbsp;<span class="ident" id="4416939">isPtr</span>&nbsp;<span class="op" id="4416945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416950">v</span>&nbsp;<span class="op" id="4416952">=</span>&nbsp;<span class="ident" id="4416954">decAlloc</span><span class="op" id="4416962">(</span><span class="ident" id="4416963">v</span><span class="op" id="4416964">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416972">elemOp</span><span class="op" id="4416978">(</span><span class="ident" id="4416979">instr</span><span class="op" id="4416984">,</span>&nbsp;<span class="ident" id="4416986">state</span><span class="op" id="4416991">,</span>&nbsp;<span class="ident" id="4416993">v</span><span class="op" id="4416994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416997">}</span><br>
<span class="lineno"></span><span class="op" id="4416999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="comment" id="4417002">//&nbsp;decodeArray&nbsp;decodes&nbsp;an&nbsp;array&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4417058">//&nbsp;The&nbsp;length&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;preceding&nbsp;the&nbsp;elements.&nbsp;&nbsp;Even&nbsp;though&nbsp;the&nbsp;length&nbsp;is&nbsp;redundant</span><br>
<span class="lineno"></span><span class="comment" id="4417156">//&nbsp;(it&#39;s&nbsp;part&nbsp;of&nbsp;the&nbsp;type),&nbsp;it&#39;s&nbsp;a&nbsp;useful&nbsp;check&nbsp;and&nbsp;is&nbsp;included&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4417237">func</span>&nbsp;<span class="op" id="4417242">(</span><span class="ident" id="4417243">dec</span>&nbsp;<span class="op" id="4417247">*</span><span class="ident" id="4417248">Decoder</span><span class="op" id="4417255">)</span>&nbsp;<span class="ident" id="4417257">decodeArray</span><span class="op" id="4417268">(</span><span class="ident" id="4417269">atyp</span>&nbsp;<span class="ident" id="4417274">reflect</span><span class="op" id="4417281">.</span><span class="ident" id="4417282">Type</span><span class="op" id="4417286">,</span>&nbsp;<span class="ident" id="4417288">state</span>&nbsp;<span class="op" id="4417294">*</span><span class="ident" id="4417295">decoderState</span><span class="op" id="4417307">,</span>&nbsp;<span class="ident" id="4417309">value</span>&nbsp;<span class="ident" id="4417315">reflect</span><span class="op" id="4417322">.</span><span class="ident" id="4417323">Value</span><span class="op" id="4417328">,</span>&nbsp;<span class="ident" id="4417330">elemOp</span>&nbsp;<span class="ident" id="4417337">decOp</span><span class="op" id="4417342">,</span>&nbsp;<span class="ident" id="4417344">length</span>&nbsp;<span class="builtintype" id="4417351">int</span><span class="op" id="4417354">,</span>&nbsp;<span class="ident" id="4417356">ovfl</span>&nbsp;<span class="builtintype" id="4417361">error</span><span class="op" id="4417366">,</span>&nbsp;<span class="ident" id="4417368">helper</span>&nbsp;<span class="ident" id="4417375">decHelper</span><span class="op" id="4417384">)</span>&nbsp;<span class="op" id="4417386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417389">if</span>&nbsp;<span class="ident" id="4417392">n</span>&nbsp;<span class="op" id="4417394">:=</span>&nbsp;<span class="ident" id="4417397">state</span><span class="op" id="4417402">.</span><span class="ident" id="4417403">decodeUint</span><span class="op" id="4417413">(</span><span class="op" id="4417414">)</span><span class="op" id="4417415">;</span>&nbsp;<span class="ident" id="4417417">n</span>&nbsp;<span class="op" id="4417419">!=</span>&nbsp;<span class="ident" id="4417422">uint64</span><span class="op" id="4417428">(</span><span class="ident" id="4417429">length</span><span class="op" id="4417435">)</span>&nbsp;<span class="op" id="4417437">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417441">errorf</span><span class="op" id="4417447">(</span><span class="string" id="4417448">&#34;length&nbsp;mismatch&nbsp;in&nbsp;decodeArray&#34;</span><span class="op" id="4417480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417486">dec</span><span class="op" id="4417489">.</span><span class="ident" id="4417490">decodeArrayHelper</span><span class="op" id="4417507">(</span><span class="ident" id="4417508">state</span><span class="op" id="4417513">,</span>&nbsp;<span class="ident" id="4417515">value</span><span class="op" id="4417520">,</span>&nbsp;<span class="ident" id="4417522">elemOp</span><span class="op" id="4417528">,</span>&nbsp;<span class="ident" id="4417530">length</span><span class="op" id="4417536">,</span>&nbsp;<span class="ident" id="4417538">ovfl</span><span class="op" id="4417542">,</span>&nbsp;<span class="ident" id="4417544">helper</span><span class="op" id="4417550">)</span><br>
<span class="lineno"></span><span class="op" id="4417552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="4417555">//&nbsp;decodeIntoValue&nbsp;is&nbsp;a&nbsp;helper&nbsp;for&nbsp;map&nbsp;decoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4417604">func</span>&nbsp;<span class="ident" id="4417609">decodeIntoValue</span><span class="op" id="4417624">(</span><span class="ident" id="4417625">state</span>&nbsp;<span class="op" id="4417631">*</span><span class="ident" id="4417632">decoderState</span><span class="op" id="4417644">,</span>&nbsp;<span class="ident" id="4417646">op</span>&nbsp;<span class="ident" id="4417649">decOp</span><span class="op" id="4417654">,</span>&nbsp;<span class="ident" id="4417656">isPtr</span>&nbsp;<span class="builtintype" id="4417662">bool</span><span class="op" id="4417666">,</span>&nbsp;<span class="ident" id="4417668">value</span>&nbsp;<span class="ident" id="4417674">reflect</span><span class="op" id="4417681">.</span><span class="ident" id="4417682">Value</span><span class="op" id="4417687">,</span>&nbsp;<span class="ident" id="4417689">ovfl</span>&nbsp;<span class="builtintype" id="4417694">error</span><span class="op" id="4417699">)</span>&nbsp;<span class="ident" id="4417701">reflect</span><span class="op" id="4417708">.</span><span class="ident" id="4417709">Value</span>&nbsp;<span class="op" id="4417715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417718">instr</span>&nbsp;<span class="op" id="4417724">:=</span>&nbsp;<span class="op" id="4417727">&amp;</span><span class="ident" id="4417728">decInstr</span><span class="op" id="4417736">{</span><span class="ident" id="4417737">op</span><span class="op" id="4417739">,</span>&nbsp;<span class="num" id="4417741">0</span><span class="op" id="4417742">,</span>&nbsp;<span class="ident" id="4417744">nil</span><span class="op" id="4417747">,</span>&nbsp;<span class="ident" id="4417749">ovfl</span><span class="op" id="4417753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417756">v</span>&nbsp;<span class="op" id="4417758">:=</span>&nbsp;<span class="ident" id="4417761">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417768">if</span>&nbsp;<span class="ident" id="4417771">isPtr</span>&nbsp;<span class="op" id="4417777">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417781">v</span>&nbsp;<span class="op" id="4417783">=</span>&nbsp;<span class="ident" id="4417785">decAlloc</span><span class="op" id="4417793">(</span><span class="ident" id="4417794">value</span><span class="op" id="4417799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417805">op</span><span class="op" id="4417807">(</span><span class="ident" id="4417808">instr</span><span class="op" id="4417813">,</span>&nbsp;<span class="ident" id="4417815">state</span><span class="op" id="4417820">,</span>&nbsp;<span class="ident" id="4417822">v</span><span class="op" id="4417823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417826">return</span>&nbsp;<span class="ident" id="4417833">value</span><br>
<span class="lineno"></span><span class="op" id="4417839">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="4417842">//&nbsp;decodeMap&nbsp;decodes&nbsp;a&nbsp;map&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4417893">//&nbsp;Maps&nbsp;are&nbsp;encoded&nbsp;as&nbsp;a&nbsp;length&nbsp;followed&nbsp;by&nbsp;key:value&nbsp;pairs.</span><br>
<span class="lineno"></span><span class="comment" id="4417954">//&nbsp;Because&nbsp;the&nbsp;internals&nbsp;of&nbsp;maps&nbsp;are&nbsp;not&nbsp;visible&nbsp;to&nbsp;us,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="4418018">//&nbsp;use&nbsp;reflection&nbsp;rather&nbsp;than&nbsp;pointer&nbsp;magic.</span><br>
<span class="lineno">555</span><span class="keyword" id="4418063">func</span>&nbsp;<span class="op" id="4418068">(</span><span class="ident" id="4418069">dec</span>&nbsp;<span class="op" id="4418073">*</span><span class="ident" id="4418074">Decoder</span><span class="op" id="4418081">)</span>&nbsp;<span class="ident" id="4418083">decodeMap</span><span class="op" id="4418092">(</span><span class="ident" id="4418093">mtyp</span>&nbsp;<span class="ident" id="4418098">reflect</span><span class="op" id="4418105">.</span><span class="ident" id="4418106">Type</span><span class="op" id="4418110">,</span>&nbsp;<span class="ident" id="4418112">state</span>&nbsp;<span class="op" id="4418118">*</span><span class="ident" id="4418119">decoderState</span><span class="op" id="4418131">,</span>&nbsp;<span class="ident" id="4418133">value</span>&nbsp;<span class="ident" id="4418139">reflect</span><span class="op" id="4418146">.</span><span class="ident" id="4418147">Value</span><span class="op" id="4418152">,</span>&nbsp;<span class="ident" id="4418154">keyOp</span><span class="op" id="4418159">,</span>&nbsp;<span class="ident" id="4418161">elemOp</span>&nbsp;<span class="ident" id="4418168">decOp</span><span class="op" id="4418173">,</span>&nbsp;<span class="ident" id="4418175">ovfl</span>&nbsp;<span class="builtintype" id="4418180">error</span><span class="op" id="4418185">)</span>&nbsp;<span class="op" id="4418187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4418190">if</span>&nbsp;<span class="ident" id="4418193">value</span><span class="op" id="4418198">.</span><span class="ident" id="4418199">IsNil</span><span class="op" id="4418204">(</span><span class="op" id="4418205">)</span>&nbsp;<span class="op" id="4418207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4418211">//&nbsp;Allocate&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418230">value</span><span class="op" id="4418235">.</span><span class="ident" id="4418236">Set</span><span class="op" id="4418239">(</span><span class="ident" id="4418240">reflect</span><span class="op" id="4418247">.</span><span class="ident" id="4418248">MakeMap</span><span class="op" id="4418255">(</span><span class="ident" id="4418256">mtyp</span><span class="op" id="4418260">)</span><span class="op" id="4418261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4418264">}</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418267">n</span>&nbsp;<span class="op" id="4418269">:=</span>&nbsp;<span class="builtintype" id="4418272">int</span><span class="op" id="4418275">(</span><span class="ident" id="4418276">state</span><span class="op" id="4418281">.</span><span class="ident" id="4418282">decodeUint</span><span class="op" id="4418292">(</span><span class="op" id="4418293">)</span><span class="op" id="4418294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418297">keyIsPtr</span>&nbsp;<span class="op" id="4418306">:=</span>&nbsp;<span class="ident" id="4418309">mtyp</span><span class="op" id="4418313">.</span><span class="ident" id="4418314">Key</span><span class="op" id="4418317">(</span><span class="op" id="4418318">)</span><span class="op" id="4418319">.</span><span class="ident" id="4418320">Kind</span><span class="op" id="4418324">(</span><span class="op" id="4418325">)</span>&nbsp;<span class="op" id="4418327">==</span>&nbsp;<span class="ident" id="4418330">reflect</span><span class="op" id="4418337">.</span><span class="ident" id="4418338">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418343">elemIsPtr</span>&nbsp;<span class="op" id="4418353">:=</span>&nbsp;<span class="ident" id="4418356">mtyp</span><span class="op" id="4418360">.</span><span class="ident" id="4418361">Elem</span><span class="op" id="4418365">(</span><span class="op" id="4418366">)</span><span class="op" id="4418367">.</span><span class="ident" id="4418368">Kind</span><span class="op" id="4418372">(</span><span class="op" id="4418373">)</span>&nbsp;<span class="op" id="4418375">==</span>&nbsp;<span class="ident" id="4418378">reflect</span><span class="op" id="4418385">.</span><span class="ident" id="4418386">Ptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4418391">for</span>&nbsp;<span class="ident" id="4418395">i</span>&nbsp;<span class="op" id="4418397">:=</span>&nbsp;<span class="num" id="4418400">0</span><span class="op" id="4418401">;</span>&nbsp;<span class="ident" id="4418403">i</span>&nbsp;<span class="op" id="4418405">&lt;</span>&nbsp;<span class="ident" id="4418407">n</span><span class="op" id="4418408">;</span>&nbsp;<span class="ident" id="4418410">i</span><span class="op" id="4418411">++</span>&nbsp;<span class="op" id="4418414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418418">key</span>&nbsp;<span class="op" id="4418422">:=</span>&nbsp;<span class="ident" id="4418425">decodeIntoValue</span><span class="op" id="4418440">(</span><span class="ident" id="4418441">state</span><span class="op" id="4418446">,</span>&nbsp;<span class="ident" id="4418448">keyOp</span><span class="op" id="4418453">,</span>&nbsp;<span class="ident" id="4418455">keyIsPtr</span><span class="op" id="4418463">,</span>&nbsp;<span class="ident" id="4418465">allocValue</span><span class="op" id="4418475">(</span><span class="ident" id="4418476">mtyp</span><span class="op" id="4418480">.</span><span class="ident" id="4418481">Key</span><span class="op" id="4418484">(</span><span class="op" id="4418485">)</span><span class="op" id="4418486">)</span><span class="op" id="4418487">,</span>&nbsp;<span class="ident" id="4418489">ovfl</span><span class="op" id="4418493">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418497">elem</span>&nbsp;<span class="op" id="4418502">:=</span>&nbsp;<span class="ident" id="4418505">decodeIntoValue</span><span class="op" id="4418520">(</span><span class="ident" id="4418521">state</span><span class="op" id="4418526">,</span>&nbsp;<span class="ident" id="4418528">elemOp</span><span class="op" id="4418534">,</span>&nbsp;<span class="ident" id="4418536">elemIsPtr</span><span class="op" id="4418545">,</span>&nbsp;<span class="ident" id="4418547">allocValue</span><span class="op" id="4418557">(</span><span class="ident" id="4418558">mtyp</span><span class="op" id="4418562">.</span><span class="ident" id="4418563">Elem</span><span class="op" id="4418567">(</span><span class="op" id="4418568">)</span><span class="op" id="4418569">)</span><span class="op" id="4418570">,</span>&nbsp;<span class="ident" id="4418572">ovfl</span><span class="op" id="4418576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418580">value</span><span class="op" id="4418585">.</span><span class="ident" id="4418586">SetMapIndex</span><span class="op" id="4418597">(</span><span class="ident" id="4418598">key</span><span class="op" id="4418601">,</span>&nbsp;<span class="ident" id="4418603">elem</span><span class="op" id="4418607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4418610">}</span><br>
<span class="lineno"></span><span class="op" id="4418612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">570</span><span class="comment" id="4418615">//&nbsp;ignoreArrayHelper&nbsp;does&nbsp;the&nbsp;work&nbsp;for&nbsp;discarding&nbsp;arrays&nbsp;and&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4418684">func</span>&nbsp;<span class="op" id="4418689">(</span><span class="ident" id="4418690">dec</span>&nbsp;<span class="op" id="4418694">*</span><span class="ident" id="4418695">Decoder</span><span class="op" id="4418702">)</span>&nbsp;<span class="ident" id="4418704">ignoreArrayHelper</span><span class="op" id="4418721">(</span><span class="ident" id="4418722">state</span>&nbsp;<span class="op" id="4418728">*</span><span class="ident" id="4418729">decoderState</span><span class="op" id="4418741">,</span>&nbsp;<span class="ident" id="4418743">elemOp</span>&nbsp;<span class="ident" id="4418750">decOp</span><span class="op" id="4418755">,</span>&nbsp;<span class="ident" id="4418757">length</span>&nbsp;<span class="builtintype" id="4418764">int</span><span class="op" id="4418767">)</span>&nbsp;<span class="op" id="4418769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418772">instr</span>&nbsp;<span class="op" id="4418778">:=</span>&nbsp;<span class="op" id="4418781">&amp;</span><span class="ident" id="4418782">decInstr</span><span class="op" id="4418790">{</span><span class="ident" id="4418791">elemOp</span><span class="op" id="4418797">,</span>&nbsp;<span class="num" id="4418799">0</span><span class="op" id="4418800">,</span>&nbsp;<span class="ident" id="4418802">nil</span><span class="op" id="4418805">,</span>&nbsp;<span class="ident" id="4418807">errors</span><span class="op" id="4418813">.</span><span class="ident" id="4418814">New</span><span class="op" id="4418817">(</span><span class="string" id="4418818">&#34;no&nbsp;error&#34;</span><span class="op" id="4418828">)</span><span class="op" id="4418829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4418832">for</span>&nbsp;<span class="ident" id="4418836">i</span>&nbsp;<span class="op" id="4418838">:=</span>&nbsp;<span class="num" id="4418841">0</span><span class="op" id="4418842">;</span>&nbsp;<span class="ident" id="4418844">i</span>&nbsp;<span class="op" id="4418846">&lt;</span>&nbsp;<span class="ident" id="4418848">length</span><span class="op" id="4418854">;</span>&nbsp;<span class="ident" id="4418856">i</span><span class="op" id="4418857">++</span>&nbsp;<span class="op" id="4418860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418864">elemOp</span><span class="op" id="4418870">(</span><span class="ident" id="4418871">instr</span><span class="op" id="4418876">,</span>&nbsp;<span class="ident" id="4418878">state</span><span class="op" id="4418883">,</span>&nbsp;<span class="ident" id="4418885">noValue</span><span class="op" id="4418892">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4418895">}</span><br>
<span class="lineno"></span><span class="op" id="4418897">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418900">//&nbsp;ignoreArray&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;array&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4418973">func</span>&nbsp;<span class="op" id="4418978">(</span><span class="ident" id="4418979">dec</span>&nbsp;<span class="op" id="4418983">*</span><span class="ident" id="4418984">Decoder</span><span class="op" id="4418991">)</span>&nbsp;<span class="ident" id="4418993">ignoreArray</span><span class="op" id="4419004">(</span><span class="ident" id="4419005">state</span>&nbsp;<span class="op" id="4419011">*</span><span class="ident" id="4419012">decoderState</span><span class="op" id="4419024">,</span>&nbsp;<span class="ident" id="4419026">elemOp</span>&nbsp;<span class="ident" id="4419033">decOp</span><span class="op" id="4419038">,</span>&nbsp;<span class="ident" id="4419040">length</span>&nbsp;<span class="builtintype" id="4419047">int</span><span class="op" id="4419050">)</span>&nbsp;<span class="op" id="4419052">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419055">if</span>&nbsp;<span class="ident" id="4419058">n</span>&nbsp;<span class="op" id="4419060">:=</span>&nbsp;<span class="ident" id="4419063">state</span><span class="op" id="4419068">.</span><span class="ident" id="4419069">decodeUint</span><span class="op" id="4419079">(</span><span class="op" id="4419080">)</span><span class="op" id="4419081">;</span>&nbsp;<span class="ident" id="4419083">n</span>&nbsp;<span class="op" id="4419085">!=</span>&nbsp;<span class="ident" id="4419088">uint64</span><span class="op" id="4419094">(</span><span class="ident" id="4419095">length</span><span class="op" id="4419101">)</span>&nbsp;<span class="op" id="4419103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419107">errorf</span><span class="op" id="4419113">(</span><span class="string" id="4419114">&#34;length&nbsp;mismatch&nbsp;in&nbsp;ignoreArray&#34;</span><span class="op" id="4419146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419152">dec</span><span class="op" id="4419155">.</span><span class="ident" id="4419156">ignoreArrayHelper</span><span class="op" id="4419173">(</span><span class="ident" id="4419174">state</span><span class="op" id="4419179">,</span>&nbsp;<span class="ident" id="4419181">elemOp</span><span class="op" id="4419187">,</span>&nbsp;<span class="ident" id="4419189">length</span><span class="op" id="4419195">)</span><br>
<span class="lineno"></span><span class="op" id="4419197">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span><span class="comment" id="4419200">//&nbsp;ignoreMap&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;map&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4419268">func</span>&nbsp;<span class="op" id="4419273">(</span><span class="ident" id="4419274">dec</span>&nbsp;<span class="op" id="4419278">*</span><span class="ident" id="4419279">Decoder</span><span class="op" id="4419286">)</span>&nbsp;<span class="ident" id="4419288">ignoreMap</span><span class="op" id="4419297">(</span><span class="ident" id="4419298">state</span>&nbsp;<span class="op" id="4419304">*</span><span class="ident" id="4419305">decoderState</span><span class="op" id="4419317">,</span>&nbsp;<span class="ident" id="4419319">keyOp</span><span class="op" id="4419324">,</span>&nbsp;<span class="ident" id="4419326">elemOp</span>&nbsp;<span class="ident" id="4419333">decOp</span><span class="op" id="4419338">)</span>&nbsp;<span class="op" id="4419340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419343">n</span>&nbsp;<span class="op" id="4419345">:=</span>&nbsp;<span class="builtintype" id="4419348">int</span><span class="op" id="4419351">(</span><span class="ident" id="4419352">state</span><span class="op" id="4419357">.</span><span class="ident" id="4419358">decodeUint</span><span class="op" id="4419368">(</span><span class="op" id="4419369">)</span><span class="op" id="4419370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419373">keyInstr</span>&nbsp;<span class="op" id="4419382">:=</span>&nbsp;<span class="op" id="4419385">&amp;</span><span class="ident" id="4419386">decInstr</span><span class="op" id="4419394">{</span><span class="ident" id="4419395">keyOp</span><span class="op" id="4419400">,</span>&nbsp;<span class="num" id="4419402">0</span><span class="op" id="4419403">,</span>&nbsp;<span class="ident" id="4419405">nil</span><span class="op" id="4419408">,</span>&nbsp;<span class="ident" id="4419410">errors</span><span class="op" id="4419416">.</span><span class="ident" id="4419417">New</span><span class="op" id="4419420">(</span><span class="string" id="4419421">&#34;no&nbsp;error&#34;</span><span class="op" id="4419431">)</span><span class="op" id="4419432">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419435">elemInstr</span>&nbsp;<span class="op" id="4419445">:=</span>&nbsp;<span class="op" id="4419448">&amp;</span><span class="ident" id="4419449">decInstr</span><span class="op" id="4419457">{</span><span class="ident" id="4419458">elemOp</span><span class="op" id="4419464">,</span>&nbsp;<span class="num" id="4419466">0</span><span class="op" id="4419467">,</span>&nbsp;<span class="ident" id="4419469">nil</span><span class="op" id="4419472">,</span>&nbsp;<span class="ident" id="4419474">errors</span><span class="op" id="4419480">.</span><span class="ident" id="4419481">New</span><span class="op" id="4419484">(</span><span class="string" id="4419485">&#34;no&nbsp;error&#34;</span><span class="op" id="4419495">)</span><span class="op" id="4419496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419499">for</span>&nbsp;<span class="ident" id="4419503">i</span>&nbsp;<span class="op" id="4419505">:=</span>&nbsp;<span class="num" id="4419508">0</span><span class="op" id="4419509">;</span>&nbsp;<span class="ident" id="4419511">i</span>&nbsp;<span class="op" id="4419513">&lt;</span>&nbsp;<span class="ident" id="4419515">n</span><span class="op" id="4419516">;</span>&nbsp;<span class="ident" id="4419518">i</span><span class="op" id="4419519">++</span>&nbsp;<span class="op" id="4419522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419526">keyOp</span><span class="op" id="4419531">(</span><span class="ident" id="4419532">keyInstr</span><span class="op" id="4419540">,</span>&nbsp;<span class="ident" id="4419542">state</span><span class="op" id="4419547">,</span>&nbsp;<span class="ident" id="4419549">noValue</span><span class="op" id="4419556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419560">elemOp</span><span class="op" id="4419566">(</span><span class="ident" id="4419567">elemInstr</span><span class="op" id="4419576">,</span>&nbsp;<span class="ident" id="4419578">state</span><span class="op" id="4419583">,</span>&nbsp;<span class="ident" id="4419585">noValue</span><span class="op" id="4419592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419595">}</span><br>
<span class="lineno">595</span><span class="op" id="4419597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4419600">//&nbsp;decodeSlice&nbsp;decodes&nbsp;a&nbsp;slice&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4419655">//&nbsp;Slices&nbsp;are&nbsp;encoded&nbsp;as&nbsp;an&nbsp;unsigned&nbsp;length&nbsp;followed&nbsp;by&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="4419725">func</span>&nbsp;<span class="op" id="4419730">(</span><span class="ident" id="4419731">dec</span>&nbsp;<span class="op" id="4419735">*</span><span class="ident" id="4419736">Decoder</span><span class="op" id="4419743">)</span>&nbsp;<span class="ident" id="4419745">decodeSlice</span><span class="op" id="4419756">(</span><span class="ident" id="4419757">state</span>&nbsp;<span class="op" id="4419763">*</span><span class="ident" id="4419764">decoderState</span><span class="op" id="4419776">,</span>&nbsp;<span class="ident" id="4419778">value</span>&nbsp;<span class="ident" id="4419784">reflect</span><span class="op" id="4419791">.</span><span class="ident" id="4419792">Value</span><span class="op" id="4419797">,</span>&nbsp;<span class="ident" id="4419799">elemOp</span>&nbsp;<span class="ident" id="4419806">decOp</span><span class="op" id="4419811">,</span>&nbsp;<span class="ident" id="4419813">ovfl</span>&nbsp;<span class="builtintype" id="4419818">error</span><span class="op" id="4419823">,</span>&nbsp;<span class="ident" id="4419825">helper</span>&nbsp;<span class="ident" id="4419832">decHelper</span><span class="op" id="4419841">)</span>&nbsp;<span class="op" id="4419843">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419846">u</span>&nbsp;<span class="op" id="4419848">:=</span>&nbsp;<span class="ident" id="4419851">state</span><span class="op" id="4419856">.</span><span class="ident" id="4419857">decodeUint</span><span class="op" id="4419867">(</span><span class="op" id="4419868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419871">typ</span>&nbsp;<span class="op" id="4419875">:=</span>&nbsp;<span class="ident" id="4419878">value</span><span class="op" id="4419883">.</span><span class="ident" id="4419884">Type</span><span class="op" id="4419888">(</span><span class="op" id="4419889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419892">size</span>&nbsp;<span class="op" id="4419897">:=</span>&nbsp;<span class="ident" id="4419900">uint64</span><span class="op" id="4419906">(</span><span class="ident" id="4419907">typ</span><span class="op" id="4419910">.</span><span class="ident" id="4419911">Elem</span><span class="op" id="4419915">(</span><span class="op" id="4419916">)</span><span class="op" id="4419917">.</span><span class="ident" id="4419918">Size</span><span class="op" id="4419922">(</span><span class="op" id="4419923">)</span><span class="op" id="4419924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419927">nBytes</span>&nbsp;<span class="op" id="4419934">:=</span>&nbsp;<span class="ident" id="4419937">u</span>&nbsp;<span class="op" id="4419939">*</span>&nbsp;<span class="ident" id="4419941">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419947">n</span>&nbsp;<span class="op" id="4419949">:=</span>&nbsp;<span class="builtintype" id="4419952">int</span><span class="op" id="4419955">(</span><span class="ident" id="4419956">u</span><span class="op" id="4419957">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419960">//&nbsp;Take&nbsp;care&nbsp;with&nbsp;overflow&nbsp;in&nbsp;this&nbsp;calculation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420009">if</span>&nbsp;<span class="ident" id="4420012">n</span>&nbsp;<span class="op" id="4420014">&lt;</span>&nbsp;<span class="num" id="4420016">0</span>&nbsp;<span class="op" id="4420018">||</span>&nbsp;<span class="ident" id="4420021">uint64</span><span class="op" id="4420027">(</span><span class="ident" id="4420028">n</span><span class="op" id="4420029">)</span>&nbsp;<span class="op" id="4420031">!=</span>&nbsp;<span class="ident" id="4420034">u</span>&nbsp;<span class="op" id="4420036">||</span>&nbsp;<span class="ident" id="4420039">nBytes</span>&nbsp;<span class="op" id="4420046">&gt;</span>&nbsp;<span class="ident" id="4420048">tooBig</span>&nbsp;<span class="op" id="4420055">||</span>&nbsp;<span class="op" id="4420058">(</span><span class="ident" id="4420059">size</span>&nbsp;<span class="op" id="4420064">&gt;</span>&nbsp;<span class="num" id="4420066">0</span>&nbsp;<span class="op" id="4420068">&amp;&amp;</span>&nbsp;<span class="ident" id="4420071">nBytes</span><span class="op" id="4420077">/</span><span class="ident" id="4420078">size</span>&nbsp;<span class="op" id="4420083">!=</span>&nbsp;<span class="ident" id="4420086">u</span><span class="op" id="4420087">)</span>&nbsp;<span class="op" id="4420089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420093">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;n&nbsp;against&nbsp;buffer&nbsp;length&nbsp;here&nbsp;because&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420166">//&nbsp;of&nbsp;interfaces,&nbsp;there&nbsp;will&nbsp;be&nbsp;buffer&nbsp;reloads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420216">errorf</span><span class="op" id="4420222">(</span><span class="string" id="4420223">&#34;%s&nbsp;slice&nbsp;too&nbsp;big:&nbsp;%d&nbsp;elements&nbsp;of&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="4420266">,</span>&nbsp;<span class="ident" id="4420268">typ</span><span class="op" id="4420271">.</span><span class="ident" id="4420272">Elem</span><span class="op" id="4420276">(</span><span class="op" id="4420277">)</span><span class="op" id="4420278">,</span>&nbsp;<span class="ident" id="4420280">u</span><span class="op" id="4420281">,</span>&nbsp;<span class="ident" id="4420283">size</span><span class="op" id="4420287">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420293">if</span>&nbsp;<span class="ident" id="4420296">value</span><span class="op" id="4420301">.</span><span class="ident" id="4420302">Cap</span><span class="op" id="4420305">(</span><span class="op" id="4420306">)</span>&nbsp;<span class="op" id="4420308">&lt;</span>&nbsp;<span class="ident" id="4420310">n</span>&nbsp;<span class="op" id="4420312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420316">value</span><span class="op" id="4420321">.</span><span class="ident" id="4420322">Set</span><span class="op" id="4420325">(</span><span class="ident" id="4420326">reflect</span><span class="op" id="4420333">.</span><span class="ident" id="4420334">MakeSlice</span><span class="op" id="4420343">(</span><span class="ident" id="4420344">typ</span><span class="op" id="4420347">,</span>&nbsp;<span class="ident" id="4420349">n</span><span class="op" id="4420350">,</span>&nbsp;<span class="ident" id="4420352">n</span><span class="op" id="4420353">)</span><span class="op" id="4420354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420357">}</span>&nbsp;<span class="keyword" id="4420359">else</span>&nbsp;<span class="op" id="4420364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420368">value</span><span class="op" id="4420373">.</span><span class="ident" id="4420374">Set</span><span class="op" id="4420377">(</span><span class="ident" id="4420378">value</span><span class="op" id="4420383">.</span><span class="ident" id="4420384">Slice</span><span class="op" id="4420389">(</span><span class="num" id="4420390">0</span><span class="op" id="4420391">,</span>&nbsp;<span class="ident" id="4420393">n</span><span class="op" id="4420394">)</span><span class="op" id="4420395">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420401">dec</span><span class="op" id="4420404">.</span><span class="ident" id="4420405">decodeArrayHelper</span><span class="op" id="4420422">(</span><span class="ident" id="4420423">state</span><span class="op" id="4420428">,</span>&nbsp;<span class="ident" id="4420430">value</span><span class="op" id="4420435">,</span>&nbsp;<span class="ident" id="4420437">elemOp</span><span class="op" id="4420443">,</span>&nbsp;<span class="ident" id="4420445">n</span><span class="op" id="4420446">,</span>&nbsp;<span class="ident" id="4420448">ovfl</span><span class="op" id="4420452">,</span>&nbsp;<span class="ident" id="4420454">helper</span><span class="op" id="4420460">)</span><br>
<span class="lineno"></span><span class="op" id="4420462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4420465">//&nbsp;ignoreSlice&nbsp;skips&nbsp;over&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;slice&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno">620</span><span class="keyword" id="4420539">func</span>&nbsp;<span class="op" id="4420544">(</span><span class="ident" id="4420545">dec</span>&nbsp;<span class="op" id="4420549">*</span><span class="ident" id="4420550">Decoder</span><span class="op" id="4420557">)</span>&nbsp;<span class="ident" id="4420559">ignoreSlice</span><span class="op" id="4420570">(</span><span class="ident" id="4420571">state</span>&nbsp;<span class="op" id="4420577">*</span><span class="ident" id="4420578">decoderState</span><span class="op" id="4420590">,</span>&nbsp;<span class="ident" id="4420592">elemOp</span>&nbsp;<span class="ident" id="4420599">decOp</span><span class="op" id="4420604">)</span>&nbsp;<span class="op" id="4420606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420609">dec</span><span class="op" id="4420612">.</span><span class="ident" id="4420613">ignoreArrayHelper</span><span class="op" id="4420630">(</span><span class="ident" id="4420631">state</span><span class="op" id="4420636">,</span>&nbsp;<span class="ident" id="4420638">elemOp</span><span class="op" id="4420644">,</span>&nbsp;<span class="builtintype" id="4420646">int</span><span class="op" id="4420649">(</span><span class="ident" id="4420650">state</span><span class="op" id="4420655">.</span><span class="ident" id="4420656">decodeUint</span><span class="op" id="4420666">(</span><span class="op" id="4420667">)</span><span class="op" id="4420668">)</span><span class="op" id="4420669">)</span><br>
<span class="lineno"></span><span class="op" id="4420671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4420674">//&nbsp;decodeInterface&nbsp;decodes&nbsp;an&nbsp;interface&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">625</span><span class="comment" id="4420744">//&nbsp;Interfaces&nbsp;are&nbsp;encoded&nbsp;as&nbsp;the&nbsp;name&nbsp;of&nbsp;a&nbsp;concrete&nbsp;type&nbsp;followed&nbsp;by&nbsp;a&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4420822">//&nbsp;If&nbsp;the&nbsp;name&nbsp;is&nbsp;empty,&nbsp;the&nbsp;value&nbsp;is&nbsp;nil&nbsp;and&nbsp;no&nbsp;value&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4420886">func</span>&nbsp;<span class="op" id="4420891">(</span><span class="ident" id="4420892">dec</span>&nbsp;<span class="op" id="4420896">*</span><span class="ident" id="4420897">Decoder</span><span class="op" id="4420904">)</span>&nbsp;<span class="ident" id="4420906">decodeInterface</span><span class="op" id="4420921">(</span><span class="ident" id="4420922">ityp</span>&nbsp;<span class="ident" id="4420927">reflect</span><span class="op" id="4420934">.</span><span class="ident" id="4420935">Type</span><span class="op" id="4420939">,</span>&nbsp;<span class="ident" id="4420941">state</span>&nbsp;<span class="op" id="4420947">*</span><span class="ident" id="4420948">decoderState</span><span class="op" id="4420960">,</span>&nbsp;<span class="ident" id="4420962">value</span>&nbsp;<span class="ident" id="4420968">reflect</span><span class="op" id="4420975">.</span><span class="ident" id="4420976">Value</span><span class="op" id="4420981">)</span>&nbsp;<span class="op" id="4420983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420986">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421026">nr</span>&nbsp;<span class="op" id="4421029">:=</span>&nbsp;<span class="ident" id="4421032">state</span><span class="op" id="4421037">.</span><span class="ident" id="4421038">decodeUint</span><span class="op" id="4421048">(</span><span class="op" id="4421049">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421052">if</span>&nbsp;<span class="ident" id="4421055">nr</span>&nbsp;<span class="op" id="4421058">&lt;</span>&nbsp;<span class="num" id="4421060">0</span>&nbsp;<span class="op" id="4421062">||</span>&nbsp;<span class="ident" id="4421065">nr</span>&nbsp;<span class="op" id="4421068">&gt;</span>&nbsp;<span class="num" id="4421070">1</span><span class="op" id="4421071">&lt;&lt;</span><span class="num" id="4421073">31</span>&nbsp;<span class="op" id="4421076">{</span>&nbsp;<span class="comment" id="4421078">//&nbsp;zero&nbsp;is&nbsp;permissible&nbsp;for&nbsp;anonymous&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421123">errorf</span><span class="op" id="4421129">(</span><span class="string" id="4421130">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d&#34;</span><span class="op" id="4421159">,</span>&nbsp;<span class="ident" id="4421161">nr</span><span class="op" id="4421163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421169">if</span>&nbsp;<span class="ident" id="4421172">nr</span>&nbsp;<span class="op" id="4421175">&gt;</span>&nbsp;<span class="ident" id="4421177">uint64</span><span class="op" id="4421183">(</span><span class="ident" id="4421184">state</span><span class="op" id="4421189">.</span><span class="ident" id="4421190">b</span><span class="op" id="4421191">.</span><span class="ident" id="4421192">Len</span><span class="op" id="4421195">(</span><span class="op" id="4421196">)</span><span class="op" id="4421197">)</span>&nbsp;<span class="op" id="4421199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421203">errorf</span><span class="op" id="4421209">(</span><span class="string" id="4421210">&#34;invalid&nbsp;type&nbsp;name&nbsp;length&nbsp;%d:&nbsp;exceeds&nbsp;input&nbsp;size&#34;</span><span class="op" id="4421259">,</span>&nbsp;<span class="ident" id="4421261">nr</span><span class="op" id="4421263">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421269">b</span>&nbsp;<span class="op" id="4421271">:=</span>&nbsp;<span class="builtinfunc" id="4421274">make</span><span class="op" id="4421278">(</span><span class="op" id="4421279">[</span><span class="op" id="4421280">]</span><span class="builtintype" id="4421281">byte</span><span class="op" id="4421285">,</span>&nbsp;<span class="ident" id="4421287">nr</span><span class="op" id="4421289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421292">state</span><span class="op" id="4421297">.</span><span class="ident" id="4421298">b</span><span class="op" id="4421299">.</span><span class="ident" id="4421300">Read</span><span class="op" id="4421304">(</span><span class="ident" id="4421305">b</span><span class="op" id="4421306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421309">name</span>&nbsp;<span class="op" id="4421314">:=</span>&nbsp;<span class="builtintype" id="4421317">string</span><span class="op" id="4421323">(</span><span class="ident" id="4421324">b</span><span class="op" id="4421325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421328">//&nbsp;Allocate&nbsp;the&nbsp;destination&nbsp;interface&nbsp;value.</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421374">if</span>&nbsp;<span class="ident" id="4421377">name</span>&nbsp;<span class="op" id="4421382">==</span>&nbsp;<span class="string" id="4421385">&#34;&#34;</span>&nbsp;<span class="op" id="4421388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421392">//&nbsp;Copy&nbsp;the&nbsp;nil&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421441">value</span><span class="op" id="4421446">.</span><span class="ident" id="4421447">Set</span><span class="op" id="4421450">(</span><span class="ident" id="4421451">reflect</span><span class="op" id="4421458">.</span><span class="ident" id="4421459">Zero</span><span class="op" id="4421463">(</span><span class="ident" id="4421464">value</span><span class="op" id="4421469">.</span><span class="ident" id="4421470">Type</span><span class="op" id="4421474">(</span><span class="op" id="4421475">)</span><span class="op" id="4421476">)</span><span class="op" id="4421477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421481">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421489">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421492">if</span>&nbsp;<span class="builtinfunc" id="4421495">len</span><span class="op" id="4421498">(</span><span class="ident" id="4421499">name</span><span class="op" id="4421503">)</span>&nbsp;<span class="op" id="4421505">&gt;</span>&nbsp;<span class="num" id="4421507">1024</span>&nbsp;<span class="op" id="4421512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421516">errorf</span><span class="op" id="4421522">(</span><span class="string" id="4421523">&#34;name&nbsp;too&nbsp;long&nbsp;(%d&nbsp;bytes):&nbsp;%.20q...&#34;</span><span class="op" id="4421559">,</span>&nbsp;<span class="builtinfunc" id="4421561">len</span><span class="op" id="4421564">(</span><span class="ident" id="4421565">name</span><span class="op" id="4421569">)</span><span class="op" id="4421570">,</span>&nbsp;<span class="ident" id="4421572">name</span><span class="op" id="4421576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421582">//&nbsp;The&nbsp;concrete&nbsp;type&nbsp;must&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421624">registerLock</span><span class="op" id="4421636">.</span><span class="ident" id="4421637">RLock</span><span class="op" id="4421642">(</span><span class="op" id="4421643">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421646">typ</span><span class="op" id="4421649">,</span>&nbsp;<span class="ident" id="4421651">ok</span>&nbsp;<span class="op" id="4421654">:=</span>&nbsp;<span class="ident" id="4421657">nameToConcreteType</span><span class="op" id="4421675">[</span><span class="ident" id="4421676">name</span><span class="op" id="4421680">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421683">registerLock</span><span class="op" id="4421695">.</span><span class="ident" id="4421696">RUnlock</span><span class="op" id="4421703">(</span><span class="op" id="4421704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421707">if</span>&nbsp;<span class="op" id="4421710">!</span><span class="ident" id="4421711">ok</span>&nbsp;<span class="op" id="4421714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421718">errorf</span><span class="op" id="4421724">(</span><span class="string" id="4421725">&#34;name&nbsp;not&nbsp;registered&nbsp;for&nbsp;interface:&nbsp;%q&#34;</span><span class="op" id="4421764">,</span>&nbsp;<span class="ident" id="4421766">name</span><span class="op" id="4421770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421773">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421776">//&nbsp;Read&nbsp;the&nbsp;type&nbsp;id&nbsp;of&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421820">concreteId</span>&nbsp;<span class="op" id="4421831">:=</span>&nbsp;<span class="ident" id="4421834">dec</span><span class="op" id="4421837">.</span><span class="ident" id="4421838">decodeTypeSequence</span><span class="op" id="4421856">(</span><span class="builtintype" id="4421857">true</span><span class="op" id="4421861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421864">if</span>&nbsp;<span class="ident" id="4421867">concreteId</span>&nbsp;<span class="op" id="4421878">&lt;</span>&nbsp;<span class="num" id="4421880">0</span>&nbsp;<span class="op" id="4421882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421886">error_</span><span class="op" id="4421892">(</span><span class="ident" id="4421893">dec</span><span class="op" id="4421896">.</span><span class="ident" id="4421897">err</span><span class="op" id="4421900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421903">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421906">//&nbsp;Byte&nbsp;count&nbsp;of&nbsp;value&nbsp;is&nbsp;next;&nbsp;we&nbsp;don&#39;t&nbsp;care&nbsp;what&nbsp;it&nbsp;is&nbsp;(it&#39;s&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4421976">//&nbsp;in&nbsp;case&nbsp;we&nbsp;want&nbsp;to&nbsp;ignore&nbsp;the&nbsp;value&nbsp;by&nbsp;skipping&nbsp;it&nbsp;completely).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422044">state</span><span class="op" id="4422049">.</span><span class="ident" id="4422050">decodeUint</span><span class="op" id="4422060">(</span><span class="op" id="4422061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422064">//&nbsp;Read&nbsp;the&nbsp;concrete&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422093">v</span>&nbsp;<span class="op" id="4422095">:=</span>&nbsp;<span class="ident" id="4422098">allocValue</span><span class="op" id="4422108">(</span><span class="ident" id="4422109">typ</span><span class="op" id="4422112">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422115">dec</span><span class="op" id="4422118">.</span><span class="ident" id="4422119">decodeValue</span><span class="op" id="4422130">(</span><span class="ident" id="4422131">concreteId</span><span class="op" id="4422141">,</span>&nbsp;<span class="ident" id="4422143">v</span><span class="op" id="4422144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422147">if</span>&nbsp;<span class="ident" id="4422150">dec</span><span class="op" id="4422153">.</span><span class="ident" id="4422154">err</span>&nbsp;<span class="op" id="4422158">!=</span>&nbsp;<span class="ident" id="4422161">nil</span>&nbsp;<span class="op" id="4422165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422169">error_</span><span class="op" id="4422175">(</span><span class="ident" id="4422176">dec</span><span class="op" id="4422179">.</span><span class="ident" id="4422180">err</span><span class="op" id="4422183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422189">//&nbsp;Assign&nbsp;the&nbsp;concrete&nbsp;value&nbsp;to&nbsp;the&nbsp;interface.</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422237">//&nbsp;Tread&nbsp;carefully;&nbsp;it&nbsp;might&nbsp;not&nbsp;satisfy&nbsp;the&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422294">if</span>&nbsp;<span class="op" id="4422297">!</span><span class="ident" id="4422298">typ</span><span class="op" id="4422301">.</span><span class="ident" id="4422302">AssignableTo</span><span class="op" id="4422314">(</span><span class="ident" id="4422315">ityp</span><span class="op" id="4422319">)</span>&nbsp;<span class="op" id="4422321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422325">errorf</span><span class="op" id="4422331">(</span><span class="string" id="4422332">&#34;%s&nbsp;is&nbsp;not&nbsp;assignable&nbsp;to&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4422365">,</span>&nbsp;<span class="ident" id="4422367">typ</span><span class="op" id="4422370">,</span>&nbsp;<span class="ident" id="4422372">ityp</span><span class="op" id="4422376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422382">//&nbsp;Copy&nbsp;the&nbsp;interface&nbsp;value&nbsp;to&nbsp;the&nbsp;target.</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422426">value</span><span class="op" id="4422431">.</span><span class="ident" id="4422432">Set</span><span class="op" id="4422435">(</span><span class="ident" id="4422436">v</span><span class="op" id="4422437">)</span><br>
<span class="lineno"></span><span class="op" id="4422439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4422442">//&nbsp;ignoreInterface&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;an&nbsp;interface&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4422523">func</span>&nbsp;<span class="op" id="4422528">(</span><span class="ident" id="4422529">dec</span>&nbsp;<span class="op" id="4422533">*</span><span class="ident" id="4422534">Decoder</span><span class="op" id="4422541">)</span>&nbsp;<span class="ident" id="4422543">ignoreInterface</span><span class="op" id="4422558">(</span><span class="ident" id="4422559">state</span>&nbsp;<span class="op" id="4422565">*</span><span class="ident" id="4422566">decoderState</span><span class="op" id="4422578">)</span>&nbsp;<span class="op" id="4422580">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422583">//&nbsp;Read&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422623">b</span>&nbsp;<span class="op" id="4422625">:=</span>&nbsp;<span class="builtinfunc" id="4422628">make</span><span class="op" id="4422632">(</span><span class="op" id="4422633">[</span><span class="op" id="4422634">]</span><span class="builtintype" id="4422635">byte</span><span class="op" id="4422639">,</span>&nbsp;<span class="ident" id="4422641">state</span><span class="op" id="4422646">.</span><span class="ident" id="4422647">decodeUint</span><span class="op" id="4422657">(</span><span class="op" id="4422658">)</span><span class="op" id="4422659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422662">_</span><span class="op" id="4422663">,</span>&nbsp;<span class="ident" id="4422665">err</span>&nbsp;<span class="op" id="4422669">:=</span>&nbsp;<span class="ident" id="4422672">state</span><span class="op" id="4422677">.</span><span class="ident" id="4422678">b</span><span class="op" id="4422679">.</span><span class="ident" id="4422680">Read</span><span class="op" id="4422684">(</span><span class="ident" id="4422685">b</span><span class="op" id="4422686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422689">if</span>&nbsp;<span class="ident" id="4422692">err</span>&nbsp;<span class="op" id="4422696">!=</span>&nbsp;<span class="ident" id="4422699">nil</span>&nbsp;<span class="op" id="4422703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422707">error_</span><span class="op" id="4422713">(</span><span class="ident" id="4422714">err</span><span class="op" id="4422717">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422723">id</span>&nbsp;<span class="op" id="4422726">:=</span>&nbsp;<span class="ident" id="4422729">dec</span><span class="op" id="4422732">.</span><span class="ident" id="4422733">decodeTypeSequence</span><span class="op" id="4422751">(</span><span class="builtintype" id="4422752">true</span><span class="op" id="4422756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422759">if</span>&nbsp;<span class="ident" id="4422762">id</span>&nbsp;<span class="op" id="4422765">&lt;</span>&nbsp;<span class="num" id="4422767">0</span>&nbsp;<span class="op" id="4422769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422773">error_</span><span class="op" id="4422779">(</span><span class="ident" id="4422780">dec</span><span class="op" id="4422783">.</span><span class="ident" id="4422784">err</span><span class="op" id="4422787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422790">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422793">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;the&nbsp;decoder&nbsp;buffer&nbsp;contains&nbsp;a&nbsp;delimited&nbsp;value.&nbsp;Just&nbsp;toss&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422873">state</span><span class="op" id="4422878">.</span><span class="ident" id="4422879">b</span><span class="op" id="4422880">.</span><span class="ident" id="4422881">Drop</span><span class="op" id="4422885">(</span><span class="builtintype" id="4422886">int</span><span class="op" id="4422889">(</span><span class="ident" id="4422890">state</span><span class="op" id="4422895">.</span><span class="ident" id="4422896">decodeUint</span><span class="op" id="4422906">(</span><span class="op" id="4422907">)</span><span class="op" id="4422908">)</span><span class="op" id="4422909">)</span><br>
<span class="lineno"></span><span class="op" id="4422911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4422914">//&nbsp;decodeGobDecoder&nbsp;decodes&nbsp;something&nbsp;implementing&nbsp;the&nbsp;GobDecoder&nbsp;interface.</span><br>
<span class="lineno">695</span><span class="comment" id="4422991">//&nbsp;The&nbsp;data&nbsp;is&nbsp;encoded&nbsp;as&nbsp;a&nbsp;byte&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4423031">func</span>&nbsp;<span class="op" id="4423036">(</span><span class="ident" id="4423037">dec</span>&nbsp;<span class="op" id="4423041">*</span><span class="ident" id="4423042">Decoder</span><span class="op" id="4423049">)</span>&nbsp;<span class="ident" id="4423051">decodeGobDecoder</span><span class="op" id="4423067">(</span><span class="ident" id="4423068">ut</span>&nbsp;<span class="op" id="4423071">*</span><span class="ident" id="4423072">userTypeInfo</span><span class="op" id="4423084">,</span>&nbsp;<span class="ident" id="4423086">state</span>&nbsp;<span class="op" id="4423092">*</span><span class="ident" id="4423093">decoderState</span><span class="op" id="4423105">,</span>&nbsp;<span class="ident" id="4423107">value</span>&nbsp;<span class="ident" id="4423113">reflect</span><span class="op" id="4423120">.</span><span class="ident" id="4423121">Value</span><span class="op" id="4423126">)</span>&nbsp;<span class="op" id="4423128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423131">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423165">b</span>&nbsp;<span class="op" id="4423167">:=</span>&nbsp;<span class="builtinfunc" id="4423170">make</span><span class="op" id="4423174">(</span><span class="op" id="4423175">[</span><span class="op" id="4423176">]</span><span class="builtintype" id="4423177">byte</span><span class="op" id="4423181">,</span>&nbsp;<span class="ident" id="4423183">state</span><span class="op" id="4423188">.</span><span class="ident" id="4423189">decodeUint</span><span class="op" id="4423199">(</span><span class="op" id="4423200">)</span><span class="op" id="4423201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423204">_</span><span class="op" id="4423205">,</span>&nbsp;<span class="ident" id="4423207">err</span>&nbsp;<span class="op" id="4423211">:=</span>&nbsp;<span class="ident" id="4423214">state</span><span class="op" id="4423219">.</span><span class="ident" id="4423220">b</span><span class="op" id="4423221">.</span><span class="ident" id="4423222">Read</span><span class="op" id="4423226">(</span><span class="ident" id="4423227">b</span><span class="op" id="4423228">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423231">if</span>&nbsp;<span class="ident" id="4423234">err</span>&nbsp;<span class="op" id="4423238">!=</span>&nbsp;<span class="ident" id="4423241">nil</span>&nbsp;<span class="op" id="4423245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423249">error_</span><span class="op" id="4423255">(</span><span class="ident" id="4423256">err</span><span class="op" id="4423259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423265">//&nbsp;We&nbsp;know&nbsp;it&#39;s&nbsp;one&nbsp;of&nbsp;these.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423296">switch</span>&nbsp;<span class="ident" id="4423303">ut</span><span class="op" id="4423305">.</span><span class="ident" id="4423306">externalDec</span>&nbsp;<span class="op" id="4423318">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423321">case</span>&nbsp;<span class="ident" id="4423326">xGob</span><span class="op" id="4423330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423334">err</span>&nbsp;<span class="op" id="4423338">=</span>&nbsp;<span class="ident" id="4423340">value</span><span class="op" id="4423345">.</span><span class="ident" id="4423346">Interface</span><span class="op" id="4423355">(</span><span class="op" id="4423356">)</span><span class="op" id="4423357">.</span><span class="op" id="4423358">(</span><span class="ident" id="4423359">GobDecoder</span><span class="op" id="4423369">)</span><span class="op" id="4423370">.</span><span class="ident" id="4423371">GobDecode</span><span class="op" id="4423380">(</span><span class="ident" id="4423381">b</span><span class="op" id="4423382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423385">case</span>&nbsp;<span class="ident" id="4423390">xBinary</span><span class="op" id="4423397">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423401">err</span>&nbsp;<span class="op" id="4423405">=</span>&nbsp;<span class="ident" id="4423407">value</span><span class="op" id="4423412">.</span><span class="ident" id="4423413">Interface</span><span class="op" id="4423422">(</span><span class="op" id="4423423">)</span><span class="op" id="4423424">.</span><span class="op" id="4423425">(</span><span class="ident" id="4423426">encoding</span><span class="op" id="4423434">.</span><span class="ident" id="4423435">BinaryUnmarshaler</span><span class="op" id="4423452">)</span><span class="op" id="4423453">.</span><span class="ident" id="4423454">UnmarshalBinary</span><span class="op" id="4423469">(</span><span class="ident" id="4423470">b</span><span class="op" id="4423471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423474">case</span>&nbsp;<span class="ident" id="4423479">xText</span><span class="op" id="4423484">:</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423488">err</span>&nbsp;<span class="op" id="4423492">=</span>&nbsp;<span class="ident" id="4423494">value</span><span class="op" id="4423499">.</span><span class="ident" id="4423500">Interface</span><span class="op" id="4423509">(</span><span class="op" id="4423510">)</span><span class="op" id="4423511">.</span><span class="op" id="4423512">(</span><span class="ident" id="4423513">encoding</span><span class="op" id="4423521">.</span><span class="ident" id="4423522">TextUnmarshaler</span><span class="op" id="4423537">)</span><span class="op" id="4423538">.</span><span class="ident" id="4423539">UnmarshalText</span><span class="op" id="4423552">(</span><span class="ident" id="4423553">b</span><span class="op" id="4423554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423560">if</span>&nbsp;<span class="ident" id="4423563">err</span>&nbsp;<span class="op" id="4423567">!=</span>&nbsp;<span class="ident" id="4423570">nil</span>&nbsp;<span class="op" id="4423574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423578">error_</span><span class="op" id="4423584">(</span><span class="ident" id="4423585">err</span><span class="op" id="4423588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423591">}</span><br>
<span class="lineno">715</span><span class="op" id="4423593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4423596">//&nbsp;ignoreGobDecoder&nbsp;discards&nbsp;the&nbsp;data&nbsp;for&nbsp;a&nbsp;GobDecoder&nbsp;value&nbsp;with&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4423678">func</span>&nbsp;<span class="op" id="4423683">(</span><span class="ident" id="4423684">dec</span>&nbsp;<span class="op" id="4423688">*</span><span class="ident" id="4423689">Decoder</span><span class="op" id="4423696">)</span>&nbsp;<span class="ident" id="4423698">ignoreGobDecoder</span><span class="op" id="4423714">(</span><span class="ident" id="4423715">state</span>&nbsp;<span class="op" id="4423721">*</span><span class="ident" id="4423722">decoderState</span><span class="op" id="4423734">)</span>&nbsp;<span class="op" id="4423736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423739">//&nbsp;Read&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;value.</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423773">b</span>&nbsp;<span class="op" id="4423775">:=</span>&nbsp;<span class="builtinfunc" id="4423778">make</span><span class="op" id="4423782">(</span><span class="op" id="4423783">[</span><span class="op" id="4423784">]</span><span class="builtintype" id="4423785">byte</span><span class="op" id="4423789">,</span>&nbsp;<span class="ident" id="4423791">state</span><span class="op" id="4423796">.</span><span class="ident" id="4423797">decodeUint</span><span class="op" id="4423807">(</span><span class="op" id="4423808">)</span><span class="op" id="4423809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423812">_</span><span class="op" id="4423813">,</span>&nbsp;<span class="ident" id="4423815">err</span>&nbsp;<span class="op" id="4423819">:=</span>&nbsp;<span class="ident" id="4423822">state</span><span class="op" id="4423827">.</span><span class="ident" id="4423828">b</span><span class="op" id="4423829">.</span><span class="ident" id="4423830">Read</span><span class="op" id="4423834">(</span><span class="ident" id="4423835">b</span><span class="op" id="4423836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423839">if</span>&nbsp;<span class="ident" id="4423842">err</span>&nbsp;<span class="op" id="4423846">!=</span>&nbsp;<span class="ident" id="4423849">nil</span>&nbsp;<span class="op" id="4423853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423857">error_</span><span class="op" id="4423863">(</span><span class="ident" id="4423864">err</span><span class="op" id="4423867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423870">}</span><br>
<span class="lineno">725</span><span class="op" id="4423872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4423875">//&nbsp;Index&nbsp;by&nbsp;Go&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4423897">var</span>&nbsp;<span class="ident" id="4423901">decOpTable</span>&nbsp;<span class="op" id="4423912">=</span>&nbsp;<span class="op" id="4423914">[</span><span class="op" id="4423915">...</span><span class="op" id="4423918">]</span><span class="ident" id="4423919">decOp</span><span class="op" id="4423924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423927">reflect</span><span class="op" id="4423934">.</span><span class="ident" id="4423935">Bool</span><span class="op" id="4423939">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423947">decBool</span><span class="op" id="4423954">,</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423957">reflect</span><span class="op" id="4423964">.</span><span class="ident" id="4423965">Int8</span><span class="op" id="4423969">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4423977">decInt8</span><span class="op" id="4423984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423987">reflect</span><span class="op" id="4423994">.</span><span class="ident" id="4423995">Int16</span><span class="op" id="4424000">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424007">decInt16</span><span class="op" id="4424015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424018">reflect</span><span class="op" id="4424025">.</span><span class="ident" id="4424026">Int32</span><span class="op" id="4424031">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424038">decInt32</span><span class="op" id="4424046">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424049">reflect</span><span class="op" id="4424056">.</span><span class="ident" id="4424057">Int64</span><span class="op" id="4424062">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424069">decInt64</span><span class="op" id="4424077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424080">reflect</span><span class="op" id="4424087">.</span><span class="ident" id="4424088">Uint8</span><span class="op" id="4424093">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424100">decUint8</span><span class="op" id="4424108">,</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424111">reflect</span><span class="op" id="4424118">.</span><span class="ident" id="4424119">Uint16</span><span class="op" id="4424125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424131">decUint16</span><span class="op" id="4424140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424143">reflect</span><span class="op" id="4424150">.</span><span class="ident" id="4424151">Uint32</span><span class="op" id="4424157">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424163">decUint32</span><span class="op" id="4424172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424175">reflect</span><span class="op" id="4424182">.</span><span class="ident" id="4424183">Uint64</span><span class="op" id="4424189">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424195">decUint64</span><span class="op" id="4424204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424207">reflect</span><span class="op" id="4424214">.</span><span class="ident" id="4424215">Float32</span><span class="op" id="4424222">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424227">decFloat32</span><span class="op" id="4424237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424240">reflect</span><span class="op" id="4424247">.</span><span class="ident" id="4424248">Float64</span><span class="op" id="4424255">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424260">decFloat64</span><span class="op" id="4424270">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424273">reflect</span><span class="op" id="4424280">.</span><span class="ident" id="4424281">Complex64</span><span class="op" id="4424290">:</span>&nbsp;&nbsp;<span class="ident" id="4424293">decComplex64</span><span class="op" id="4424305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424308">reflect</span><span class="op" id="4424315">.</span><span class="ident" id="4424316">Complex128</span><span class="op" id="4424326">:</span>&nbsp;<span class="ident" id="4424328">decComplex128</span><span class="op" id="4424341">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424344">reflect</span><span class="op" id="4424351">.</span><span class="ident" id="4424352">String</span><span class="op" id="4424358">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424364">decString</span><span class="op" id="4424373">,</span><br>
<span class="lineno"></span><span class="op" id="4424375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="4424378">//&nbsp;Indexed&nbsp;by&nbsp;gob&nbsp;types.&nbsp;&nbsp;tComplex&nbsp;will&nbsp;be&nbsp;added&nbsp;during&nbsp;type.init().</span><br>
<span class="lineno"></span><span class="keyword" id="4424447">var</span>&nbsp;<span class="ident" id="4424451">decIgnoreOpMap</span>&nbsp;<span class="op" id="4424466">=</span>&nbsp;<span class="keyword" id="4424468">map</span><span class="op" id="4424471">[</span><span class="ident" id="4424472">typeId</span><span class="op" id="4424478">]</span><span class="ident" id="4424479">decOp</span><span class="op" id="4424484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424487">tBool</span><span class="op" id="4424492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424497">ignoreUint</span><span class="op" id="4424507">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424510">tInt</span><span class="op" id="4424514">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424520">ignoreUint</span><span class="op" id="4424530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424533">tUint</span><span class="op" id="4424538">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4424543">ignoreUint</span><span class="op" id="4424553">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424556">tFloat</span><span class="op" id="4424562">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4424566">ignoreUint</span><span class="op" id="4424576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424579">tBytes</span><span class="op" id="4424585">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4424589">ignoreUint8Array</span><span class="op" id="4424605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424608">tString</span><span class="op" id="4424615">:</span>&nbsp;&nbsp;<span class="ident" id="4424618">ignoreUint8Array</span><span class="op" id="4424634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424637">tComplex</span><span class="op" id="4424645">:</span>&nbsp;<span class="ident" id="4424647">ignoreTwoUints</span><span class="op" id="4424661">,</span><br>
<span class="lineno"></span><span class="op" id="4424663">}</span><br>
<span class="lineno">755</span><br>
<span class="lineno"></span><span class="comment" id="4424666">//&nbsp;decOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;the&nbsp;base&nbsp;type&nbsp;under&nbsp;rt&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4424733">//&nbsp;the&nbsp;indirection&nbsp;count&nbsp;to&nbsp;reach&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4424771">func</span>&nbsp;<span class="op" id="4424776">(</span><span class="ident" id="4424777">dec</span>&nbsp;<span class="op" id="4424781">*</span><span class="ident" id="4424782">Decoder</span><span class="op" id="4424789">)</span>&nbsp;<span class="ident" id="4424791">decOpFor</span><span class="op" id="4424799">(</span><span class="ident" id="4424800">wireId</span>&nbsp;<span class="ident" id="4424807">typeId</span><span class="op" id="4424813">,</span>&nbsp;<span class="ident" id="4424815">rt</span>&nbsp;<span class="ident" id="4424818">reflect</span><span class="op" id="4424825">.</span><span class="ident" id="4424826">Type</span><span class="op" id="4424830">,</span>&nbsp;<span class="ident" id="4424832">name</span>&nbsp;<span class="builtintype" id="4424837">string</span><span class="op" id="4424843">,</span>&nbsp;<span class="ident" id="4424845">inProgress</span>&nbsp;<span class="keyword" id="4424856">map</span><span class="op" id="4424859">[</span><span class="ident" id="4424860">reflect</span><span class="op" id="4424867">.</span><span class="ident" id="4424868">Type</span><span class="op" id="4424872">]</span><span class="op" id="4424873">*</span><span class="ident" id="4424874">decOp</span><span class="op" id="4424879">)</span>&nbsp;<span class="op" id="4424881">*</span><span class="ident" id="4424882">decOp</span>&nbsp;<span class="op" id="4424888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424891">ut</span>&nbsp;<span class="op" id="4424894">:=</span>&nbsp;<span class="ident" id="4424897">userType</span><span class="op" id="4424905">(</span><span class="ident" id="4424906">rt</span><span class="op" id="4424908">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4424911">//&nbsp;If&nbsp;the&nbsp;type&nbsp;implements&nbsp;GobEncoder,&nbsp;we&nbsp;handle&nbsp;it&nbsp;without&nbsp;further&nbsp;processing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424991">if</span>&nbsp;<span class="ident" id="4424994">ut</span><span class="op" id="4424996">.</span><span class="ident" id="4424997">externalDec</span>&nbsp;<span class="op" id="4425009">!=</span>&nbsp;<span class="num" id="4425012">0</span>&nbsp;<span class="op" id="4425014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425018">return</span>&nbsp;<span class="ident" id="4425025">dec</span><span class="op" id="4425028">.</span><span class="ident" id="4425029">gobDecodeOpFor</span><span class="op" id="4425043">(</span><span class="ident" id="4425044">ut</span><span class="op" id="4425046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425049">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425053">//&nbsp;If&nbsp;this&nbsp;type&nbsp;is&nbsp;already&nbsp;in&nbsp;progress,&nbsp;it&#39;s&nbsp;a&nbsp;recursive&nbsp;type&nbsp;(e.g.&nbsp;map[string]*T).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425138">//&nbsp;Return&nbsp;the&nbsp;pointer&nbsp;to&nbsp;the&nbsp;op&nbsp;we&#39;re&nbsp;already&nbsp;building.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425195">if</span>&nbsp;<span class="ident" id="4425198">opPtr</span>&nbsp;<span class="op" id="4425204">:=</span>&nbsp;<span class="ident" id="4425207">inProgress</span><span class="op" id="4425217">[</span><span class="ident" id="4425218">rt</span><span class="op" id="4425220">]</span><span class="op" id="4425221">;</span>&nbsp;<span class="ident" id="4425223">opPtr</span>&nbsp;<span class="op" id="4425229">!=</span>&nbsp;<span class="ident" id="4425232">nil</span>&nbsp;<span class="op" id="4425236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425240">return</span>&nbsp;<span class="ident" id="4425247">opPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425254">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425257">typ</span>&nbsp;<span class="op" id="4425261">:=</span>&nbsp;<span class="ident" id="4425264">ut</span><span class="op" id="4425266">.</span><span class="ident" id="4425267">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425273">var</span>&nbsp;<span class="ident" id="4425277">op</span>&nbsp;<span class="ident" id="4425280">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425287">k</span>&nbsp;<span class="op" id="4425289">:=</span>&nbsp;<span class="ident" id="4425292">typ</span><span class="op" id="4425295">.</span><span class="ident" id="4425296">Kind</span><span class="op" id="4425300">(</span><span class="op" id="4425301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425304">if</span>&nbsp;<span class="builtintype" id="4425307">int</span><span class="op" id="4425310">(</span><span class="ident" id="4425311">k</span><span class="op" id="4425312">)</span>&nbsp;<span class="op" id="4425314">&lt;</span>&nbsp;<span class="builtinfunc" id="4425316">len</span><span class="op" id="4425319">(</span><span class="ident" id="4425320">decOpTable</span><span class="op" id="4425330">)</span>&nbsp;<span class="op" id="4425332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425336">op</span>&nbsp;<span class="op" id="4425339">=</span>&nbsp;<span class="ident" id="4425341">decOpTable</span><span class="op" id="4425351">[</span><span class="ident" id="4425352">k</span><span class="op" id="4425353">]</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425359">if</span>&nbsp;<span class="ident" id="4425362">op</span>&nbsp;<span class="op" id="4425365">==</span>&nbsp;<span class="ident" id="4425368">nil</span>&nbsp;<span class="op" id="4425372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425376">inProgress</span><span class="op" id="4425386">[</span><span class="ident" id="4425387">rt</span><span class="op" id="4425389">]</span>&nbsp;<span class="op" id="4425391">=</span>&nbsp;<span class="op" id="4425393">&amp;</span><span class="ident" id="4425394">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425399">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425418">switch</span>&nbsp;<span class="ident" id="4425425">t</span>&nbsp;<span class="op" id="4425427">:=</span>&nbsp;<span class="ident" id="4425430">typ</span><span class="op" id="4425433">;</span>&nbsp;<span class="ident" id="4425435">t</span><span class="op" id="4425436">.</span><span class="ident" id="4425437">Kind</span><span class="op" id="4425441">(</span><span class="op" id="4425442">)</span>&nbsp;<span class="op" id="4425444">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425448">case</span>&nbsp;<span class="ident" id="4425453">reflect</span><span class="op" id="4425460">.</span><span class="ident" id="4425461">Array</span><span class="op" id="4425466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425471">name</span>&nbsp;<span class="op" id="4425476">=</span>&nbsp;<span class="string" id="4425478">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4425492">+</span>&nbsp;<span class="ident" id="4425494">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425502">elemId</span>&nbsp;<span class="op" id="4425509">:=</span>&nbsp;<span class="ident" id="4425512">dec</span><span class="op" id="4425515">.</span><span class="ident" id="4425516">wireType</span><span class="op" id="4425524">[</span><span class="ident" id="4425525">wireId</span><span class="op" id="4425531">]</span><span class="op" id="4425532">.</span><span class="ident" id="4425533">ArrayT</span><span class="op" id="4425539">.</span><span class="ident" id="4425540">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425548">elemOp</span>&nbsp;<span class="op" id="4425555">:=</span>&nbsp;<span class="ident" id="4425558">dec</span><span class="op" id="4425561">.</span><span class="ident" id="4425562">decOpFor</span><span class="op" id="4425570">(</span><span class="ident" id="4425571">elemId</span><span class="op" id="4425577">,</span>&nbsp;<span class="ident" id="4425579">t</span><span class="op" id="4425580">.</span><span class="ident" id="4425581">Elem</span><span class="op" id="4425585">(</span><span class="op" id="4425586">)</span><span class="op" id="4425587">,</span>&nbsp;<span class="ident" id="4425589">name</span><span class="op" id="4425593">,</span>&nbsp;<span class="ident" id="4425595">inProgress</span><span class="op" id="4425605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425610">ovfl</span>&nbsp;<span class="op" id="4425615">:=</span>&nbsp;<span class="ident" id="4425618">overflow</span><span class="op" id="4425626">(</span><span class="ident" id="4425627">name</span><span class="op" id="4425631">)</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425636">helper</span>&nbsp;<span class="op" id="4425643">:=</span>&nbsp;<span class="ident" id="4425646">decArrayHelper</span><span class="op" id="4425660">[</span><span class="ident" id="4425661">t</span><span class="op" id="4425662">.</span><span class="ident" id="4425663">Elem</span><span class="op" id="4425667">(</span><span class="op" id="4425668">)</span><span class="op" id="4425669">.</span><span class="ident" id="4425670">Kind</span><span class="op" id="4425674">(</span><span class="op" id="4425675">)</span><span class="op" id="4425676">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425681">op</span>&nbsp;<span class="op" id="4425684">=</span>&nbsp;<span class="keyword" id="4425686">func</span><span class="op" id="4425690">(</span><span class="ident" id="4425691">i</span>&nbsp;<span class="op" id="4425693">*</span><span class="ident" id="4425694">decInstr</span><span class="op" id="4425702">,</span>&nbsp;<span class="ident" id="4425704">state</span>&nbsp;<span class="op" id="4425710">*</span><span class="ident" id="4425711">decoderState</span><span class="op" id="4425723">,</span>&nbsp;<span class="ident" id="4425725">value</span>&nbsp;<span class="ident" id="4425731">reflect</span><span class="op" id="4425738">.</span><span class="ident" id="4425739">Value</span><span class="op" id="4425744">)</span>&nbsp;<span class="op" id="4425746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425752">state</span><span class="op" id="4425757">.</span><span class="ident" id="4425758">dec</span><span class="op" id="4425761">.</span><span class="ident" id="4425762">decodeArray</span><span class="op" id="4425773">(</span><span class="ident" id="4425774">t</span><span class="op" id="4425775">,</span>&nbsp;<span class="ident" id="4425777">state</span><span class="op" id="4425782">,</span>&nbsp;<span class="ident" id="4425784">value</span><span class="op" id="4425789">,</span>&nbsp;<span class="op" id="4425791">*</span><span class="ident" id="4425792">elemOp</span><span class="op" id="4425798">,</span>&nbsp;<span class="ident" id="4425800">t</span><span class="op" id="4425801">.</span><span class="ident" id="4425802">Len</span><span class="op" id="4425805">(</span><span class="op" id="4425806">)</span><span class="op" id="4425807">,</span>&nbsp;<span class="ident" id="4425809">ovfl</span><span class="op" id="4425813">,</span>&nbsp;<span class="ident" id="4425815">helper</span><span class="op" id="4425821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425831">case</span>&nbsp;<span class="ident" id="4425836">reflect</span><span class="op" id="4425843">.</span><span class="ident" id="4425844">Map</span><span class="op" id="4425847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425852">keyId</span>&nbsp;<span class="op" id="4425858">:=</span>&nbsp;<span class="ident" id="4425861">dec</span><span class="op" id="4425864">.</span><span class="ident" id="4425865">wireType</span><span class="op" id="4425873">[</span><span class="ident" id="4425874">wireId</span><span class="op" id="4425880">]</span><span class="op" id="4425881">.</span><span class="ident" id="4425882">MapT</span><span class="op" id="4425886">.</span><span class="ident" id="4425887">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425894">elemId</span>&nbsp;<span class="op" id="4425901">:=</span>&nbsp;<span class="ident" id="4425904">dec</span><span class="op" id="4425907">.</span><span class="ident" id="4425908">wireType</span><span class="op" id="4425916">[</span><span class="ident" id="4425917">wireId</span><span class="op" id="4425923">]</span><span class="op" id="4425924">.</span><span class="ident" id="4425925">MapT</span><span class="op" id="4425929">.</span><span class="ident" id="4425930">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425938">keyOp</span>&nbsp;<span class="op" id="4425944">:=</span>&nbsp;<span class="ident" id="4425947">dec</span><span class="op" id="4425950">.</span><span class="ident" id="4425951">decOpFor</span><span class="op" id="4425959">(</span><span class="ident" id="4425960">keyId</span><span class="op" id="4425965">,</span>&nbsp;<span class="ident" id="4425967">t</span><span class="op" id="4425968">.</span><span class="ident" id="4425969">Key</span><span class="op" id="4425972">(</span><span class="op" id="4425973">)</span><span class="op" id="4425974">,</span>&nbsp;<span class="string" id="4425976">&#34;key&nbsp;of&nbsp;&#34;</span><span class="op" id="4425985">+</span><span class="ident" id="4425986">name</span><span class="op" id="4425990">,</span>&nbsp;<span class="ident" id="4425992">inProgress</span><span class="op" id="4426002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426007">elemOp</span>&nbsp;<span class="op" id="4426014">:=</span>&nbsp;<span class="ident" id="4426017">dec</span><span class="op" id="4426020">.</span><span class="ident" id="4426021">decOpFor</span><span class="op" id="4426029">(</span><span class="ident" id="4426030">elemId</span><span class="op" id="4426036">,</span>&nbsp;<span class="ident" id="4426038">t</span><span class="op" id="4426039">.</span><span class="ident" id="4426040">Elem</span><span class="op" id="4426044">(</span><span class="op" id="4426045">)</span><span class="op" id="4426046">,</span>&nbsp;<span class="string" id="4426048">&#34;element&nbsp;of&nbsp;&#34;</span><span class="op" id="4426061">+</span><span class="ident" id="4426062">name</span><span class="op" id="4426066">,</span>&nbsp;<span class="ident" id="4426068">inProgress</span><span class="op" id="4426078">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426083">ovfl</span>&nbsp;<span class="op" id="4426088">:=</span>&nbsp;<span class="ident" id="4426091">overflow</span><span class="op" id="4426099">(</span><span class="ident" id="4426100">name</span><span class="op" id="4426104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426109">op</span>&nbsp;<span class="op" id="4426112">=</span>&nbsp;<span class="keyword" id="4426114">func</span><span class="op" id="4426118">(</span><span class="ident" id="4426119">i</span>&nbsp;<span class="op" id="4426121">*</span><span class="ident" id="4426122">decInstr</span><span class="op" id="4426130">,</span>&nbsp;<span class="ident" id="4426132">state</span>&nbsp;<span class="op" id="4426138">*</span><span class="ident" id="4426139">decoderState</span><span class="op" id="4426151">,</span>&nbsp;<span class="ident" id="4426153">value</span>&nbsp;<span class="ident" id="4426159">reflect</span><span class="op" id="4426166">.</span><span class="ident" id="4426167">Value</span><span class="op" id="4426172">)</span>&nbsp;<span class="op" id="4426174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426180">state</span><span class="op" id="4426185">.</span><span class="ident" id="4426186">dec</span><span class="op" id="4426189">.</span><span class="ident" id="4426190">decodeMap</span><span class="op" id="4426199">(</span><span class="ident" id="4426200">t</span><span class="op" id="4426201">,</span>&nbsp;<span class="ident" id="4426203">state</span><span class="op" id="4426208">,</span>&nbsp;<span class="ident" id="4426210">value</span><span class="op" id="4426215">,</span>&nbsp;<span class="op" id="4426217">*</span><span class="ident" id="4426218">keyOp</span><span class="op" id="4426223">,</span>&nbsp;<span class="op" id="4426225">*</span><span class="ident" id="4426226">elemOp</span><span class="op" id="4426232">,</span>&nbsp;<span class="ident" id="4426234">ovfl</span><span class="op" id="4426238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426248">case</span>&nbsp;<span class="ident" id="4426253">reflect</span><span class="op" id="4426260">.</span><span class="ident" id="4426261">Slice</span><span class="op" id="4426266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426271">name</span>&nbsp;<span class="op" id="4426276">=</span>&nbsp;<span class="string" id="4426278">&#34;element&nbsp;of&nbsp;&#34;</span>&nbsp;<span class="op" id="4426292">+</span>&nbsp;<span class="ident" id="4426294">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426302">if</span>&nbsp;<span class="ident" id="4426305">t</span><span class="op" id="4426306">.</span><span class="ident" id="4426307">Elem</span><span class="op" id="4426311">(</span><span class="op" id="4426312">)</span><span class="op" id="4426313">.</span><span class="ident" id="4426314">Kind</span><span class="op" id="4426318">(</span><span class="op" id="4426319">)</span>&nbsp;<span class="op" id="4426321">==</span>&nbsp;<span class="ident" id="4426324">reflect</span><span class="op" id="4426331">.</span><span class="ident" id="4426332">Uint8</span>&nbsp;<span class="op" id="4426338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426344">op</span>&nbsp;<span class="op" id="4426347">=</span>&nbsp;<span class="ident" id="4426349">decUint8Slice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426367">break</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426381">var</span>&nbsp;<span class="ident" id="4426385">elemId</span>&nbsp;<span class="ident" id="4426392">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426402">if</span>&nbsp;<span class="ident" id="4426405">tt</span><span class="op" id="4426407">,</span>&nbsp;<span class="ident" id="4426409">ok</span>&nbsp;<span class="op" id="4426412">:=</span>&nbsp;<span class="ident" id="4426415">builtinIdToType</span><span class="op" id="4426430">[</span><span class="ident" id="4426431">wireId</span><span class="op" id="4426437">]</span><span class="op" id="4426438">;</span>&nbsp;<span class="ident" id="4426440">ok</span>&nbsp;<span class="op" id="4426443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426449">elemId</span>&nbsp;<span class="op" id="4426456">=</span>&nbsp;<span class="ident" id="4426458">tt</span><span class="op" id="4426460">.</span><span class="op" id="4426461">(</span><span class="op" id="4426462">*</span><span class="ident" id="4426463">sliceType</span><span class="op" id="4426472">)</span><span class="op" id="4426473">.</span><span class="ident" id="4426474">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426482">}</span>&nbsp;<span class="keyword" id="4426484">else</span>&nbsp;<span class="op" id="4426489">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426495">elemId</span>&nbsp;<span class="op" id="4426502">=</span>&nbsp;<span class="ident" id="4426504">dec</span><span class="op" id="4426507">.</span><span class="ident" id="4426508">wireType</span><span class="op" id="4426516">[</span><span class="ident" id="4426517">wireId</span><span class="op" id="4426523">]</span><span class="op" id="4426524">.</span><span class="ident" id="4426525">SliceT</span><span class="op" id="4426531">.</span><span class="ident" id="4426532">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426545">elemOp</span>&nbsp;<span class="op" id="4426552">:=</span>&nbsp;<span class="ident" id="4426555">dec</span><span class="op" id="4426558">.</span><span class="ident" id="4426559">decOpFor</span><span class="op" id="4426567">(</span><span class="ident" id="4426568">elemId</span><span class="op" id="4426574">,</span>&nbsp;<span class="ident" id="4426576">t</span><span class="op" id="4426577">.</span><span class="ident" id="4426578">Elem</span><span class="op" id="4426582">(</span><span class="op" id="4426583">)</span><span class="op" id="4426584">,</span>&nbsp;<span class="ident" id="4426586">name</span><span class="op" id="4426590">,</span>&nbsp;<span class="ident" id="4426592">inProgress</span><span class="op" id="4426602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426607">ovfl</span>&nbsp;<span class="op" id="4426612">:=</span>&nbsp;<span class="ident" id="4426615">overflow</span><span class="op" id="4426623">(</span><span class="ident" id="4426624">name</span><span class="op" id="4426628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426633">helper</span>&nbsp;<span class="op" id="4426640">:=</span>&nbsp;<span class="ident" id="4426643">decSliceHelper</span><span class="op" id="4426657">[</span><span class="ident" id="4426658">t</span><span class="op" id="4426659">.</span><span class="ident" id="4426660">Elem</span><span class="op" id="4426664">(</span><span class="op" id="4426665">)</span><span class="op" id="4426666">.</span><span class="ident" id="4426667">Kind</span><span class="op" id="4426671">(</span><span class="op" id="4426672">)</span><span class="op" id="4426673">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426678">op</span>&nbsp;<span class="op" id="4426681">=</span>&nbsp;<span class="keyword" id="4426683">func</span><span class="op" id="4426687">(</span><span class="ident" id="4426688">i</span>&nbsp;<span class="op" id="4426690">*</span><span class="ident" id="4426691">decInstr</span><span class="op" id="4426699">,</span>&nbsp;<span class="ident" id="4426701">state</span>&nbsp;<span class="op" id="4426707">*</span><span class="ident" id="4426708">decoderState</span><span class="op" id="4426720">,</span>&nbsp;<span class="ident" id="4426722">value</span>&nbsp;<span class="ident" id="4426728">reflect</span><span class="op" id="4426735">.</span><span class="ident" id="4426736">Value</span><span class="op" id="4426741">)</span>&nbsp;<span class="op" id="4426743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426749">state</span><span class="op" id="4426754">.</span><span class="ident" id="4426755">dec</span><span class="op" id="4426758">.</span><span class="ident" id="4426759">decodeSlice</span><span class="op" id="4426770">(</span><span class="ident" id="4426771">state</span><span class="op" id="4426776">,</span>&nbsp;<span class="ident" id="4426778">value</span><span class="op" id="4426783">,</span>&nbsp;<span class="op" id="4426785">*</span><span class="ident" id="4426786">elemOp</span><span class="op" id="4426792">,</span>&nbsp;<span class="ident" id="4426794">ovfl</span><span class="op" id="4426798">,</span>&nbsp;<span class="ident" id="4426800">helper</span><span class="op" id="4426806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426816">case</span>&nbsp;<span class="ident" id="4426821">reflect</span><span class="op" id="4426828">.</span><span class="ident" id="4426829">Struct</span><span class="op" id="4426835">:</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426840">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426915">ut</span>&nbsp;<span class="op" id="4426918">:=</span>&nbsp;<span class="ident" id="4426921">userType</span><span class="op" id="4426929">(</span><span class="ident" id="4426930">typ</span><span class="op" id="4426933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426938">enginePtr</span><span class="op" id="4426947">,</span>&nbsp;<span class="ident" id="4426949">err</span>&nbsp;<span class="op" id="4426953">:=</span>&nbsp;<span class="ident" id="4426956">dec</span><span class="op" id="4426959">.</span><span class="ident" id="4426960">getDecEnginePtr</span><span class="op" id="4426975">(</span><span class="ident" id="4426976">wireId</span><span class="op" id="4426982">,</span>&nbsp;<span class="ident" id="4426984">ut</span><span class="op" id="4426986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426991">if</span>&nbsp;<span class="ident" id="4426994">err</span>&nbsp;<span class="op" id="4426998">!=</span>&nbsp;<span class="ident" id="4427001">nil</span>&nbsp;<span class="op" id="4427005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427011">error_</span><span class="op" id="4427017">(</span><span class="ident" id="4427018">err</span><span class="op" id="4427021">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427031">op</span>&nbsp;<span class="op" id="4427034">=</span>&nbsp;<span class="keyword" id="4427036">func</span><span class="op" id="4427040">(</span><span class="ident" id="4427041">i</span>&nbsp;<span class="op" id="4427043">*</span><span class="ident" id="4427044">decInstr</span><span class="op" id="4427052">,</span>&nbsp;<span class="ident" id="4427054">state</span>&nbsp;<span class="op" id="4427060">*</span><span class="ident" id="4427061">decoderState</span><span class="op" id="4427073">,</span>&nbsp;<span class="ident" id="4427075">value</span>&nbsp;<span class="ident" id="4427081">reflect</span><span class="op" id="4427088">.</span><span class="ident" id="4427089">Value</span><span class="op" id="4427094">)</span>&nbsp;<span class="op" id="4427096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427102">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427179">dec</span><span class="op" id="4427182">.</span><span class="ident" id="4427183">decodeStruct</span><span class="op" id="4427195">(</span><span class="op" id="4427196">*</span><span class="ident" id="4427197">enginePtr</span><span class="op" id="4427206">,</span>&nbsp;<span class="ident" id="4427208">ut</span><span class="op" id="4427210">,</span>&nbsp;<span class="ident" id="4427212">value</span><span class="op" id="4427217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427222">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427226">case</span>&nbsp;<span class="ident" id="4427231">reflect</span><span class="op" id="4427238">.</span><span class="ident" id="4427239">Interface</span><span class="op" id="4427248">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427253">op</span>&nbsp;<span class="op" id="4427256">=</span>&nbsp;<span class="keyword" id="4427258">func</span><span class="op" id="4427262">(</span><span class="ident" id="4427263">i</span>&nbsp;<span class="op" id="4427265">*</span><span class="ident" id="4427266">decInstr</span><span class="op" id="4427274">,</span>&nbsp;<span class="ident" id="4427276">state</span>&nbsp;<span class="op" id="4427282">*</span><span class="ident" id="4427283">decoderState</span><span class="op" id="4427295">,</span>&nbsp;<span class="ident" id="4427297">value</span>&nbsp;<span class="ident" id="4427303">reflect</span><span class="op" id="4427310">.</span><span class="ident" id="4427311">Value</span><span class="op" id="4427316">)</span>&nbsp;<span class="op" id="4427318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427324">state</span><span class="op" id="4427329">.</span><span class="ident" id="4427330">dec</span><span class="op" id="4427333">.</span><span class="ident" id="4427334">decodeInterface</span><span class="op" id="4427349">(</span><span class="ident" id="4427350">t</span><span class="op" id="4427351">,</span>&nbsp;<span class="ident" id="4427353">state</span><span class="op" id="4427358">,</span>&nbsp;<span class="ident" id="4427360">value</span><span class="op" id="4427365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427374">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427380">if</span>&nbsp;<span class="ident" id="4427383">op</span>&nbsp;<span class="op" id="4427386">==</span>&nbsp;<span class="ident" id="4427389">nil</span>&nbsp;<span class="op" id="4427393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427397">errorf</span><span class="op" id="4427403">(</span><span class="string" id="4427404">&#34;decode&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4427433">,</span>&nbsp;<span class="ident" id="4427435">rt</span><span class="op" id="4427437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427443">return</span>&nbsp;<span class="op" id="4427450">&amp;</span><span class="ident" id="4427451">op</span><br>
<span class="lineno">840</span><span class="op" id="4427454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4427457">//&nbsp;decIgnoreOpFor&nbsp;returns&nbsp;the&nbsp;decoding&nbsp;op&nbsp;for&nbsp;a&nbsp;field&nbsp;that&nbsp;has&nbsp;no&nbsp;destination.</span><br>
<span class="lineno"></span><span class="keyword" id="4427536">func</span>&nbsp;<span class="op" id="4427541">(</span><span class="ident" id="4427542">dec</span>&nbsp;<span class="op" id="4427546">*</span><span class="ident" id="4427547">Decoder</span><span class="op" id="4427554">)</span>&nbsp;<span class="ident" id="4427556">decIgnoreOpFor</span><span class="op" id="4427570">(</span><span class="ident" id="4427571">wireId</span>&nbsp;<span class="ident" id="4427578">typeId</span><span class="op" id="4427584">)</span>&nbsp;<span class="ident" id="4427586">decOp</span>&nbsp;<span class="op" id="4427592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427595">op</span><span class="op" id="4427597">,</span>&nbsp;<span class="ident" id="4427599">ok</span>&nbsp;<span class="op" id="4427602">:=</span>&nbsp;<span class="ident" id="4427605">decIgnoreOpMap</span><span class="op" id="4427619">[</span><span class="ident" id="4427620">wireId</span><span class="op" id="4427626">]</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427629">if</span>&nbsp;<span class="op" id="4427632">!</span><span class="ident" id="4427633">ok</span>&nbsp;<span class="op" id="4427636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427640">if</span>&nbsp;<span class="ident" id="4427643">wireId</span>&nbsp;<span class="op" id="4427650">==</span>&nbsp;<span class="ident" id="4427653">tInterface</span>&nbsp;<span class="op" id="4427664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427669">//&nbsp;Special&nbsp;case&nbsp;because&nbsp;it&#39;s&nbsp;a&nbsp;method:&nbsp;the&nbsp;ignored&nbsp;item&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427734">//&nbsp;define&nbsp;types&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;record&nbsp;their&nbsp;state&nbsp;in&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427803">op</span>&nbsp;<span class="op" id="4427806">=</span>&nbsp;<span class="keyword" id="4427808">func</span><span class="op" id="4427812">(</span><span class="ident" id="4427813">i</span>&nbsp;<span class="op" id="4427815">*</span><span class="ident" id="4427816">decInstr</span><span class="op" id="4427824">,</span>&nbsp;<span class="ident" id="4427826">state</span>&nbsp;<span class="op" id="4427832">*</span><span class="ident" id="4427833">decoderState</span><span class="op" id="4427845">,</span>&nbsp;<span class="ident" id="4427847">value</span>&nbsp;<span class="ident" id="4427853">reflect</span><span class="op" id="4427860">.</span><span class="ident" id="4427861">Value</span><span class="op" id="4427866">)</span>&nbsp;<span class="op" id="4427868">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427874">state</span><span class="op" id="4427879">.</span><span class="ident" id="4427880">dec</span><span class="op" id="4427883">.</span><span class="ident" id="4427884">ignoreInterface</span><span class="op" id="4427899">(</span><span class="ident" id="4427900">state</span><span class="op" id="4427905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427915">return</span>&nbsp;<span class="ident" id="4427922">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427931">//&nbsp;Special&nbsp;cases</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427950">wire</span>&nbsp;<span class="op" id="4427955">:=</span>&nbsp;<span class="ident" id="4427958">dec</span><span class="op" id="4427961">.</span><span class="ident" id="4427962">wireType</span><span class="op" id="4427970">[</span><span class="ident" id="4427971">wireId</span><span class="op" id="4427977">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427981">switch</span>&nbsp;<span class="op" id="4427988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427992">case</span>&nbsp;<span class="ident" id="4427997">wire</span>&nbsp;<span class="op" id="4428002">==</span>&nbsp;<span class="ident" id="4428005">nil</span><span class="op" id="4428008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428013">errorf</span><span class="op" id="4428019">(</span><span class="string" id="4428020">&#34;bad&nbsp;data:&nbsp;undefined&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4428049">,</span>&nbsp;<span class="ident" id="4428051">wireId</span><span class="op" id="4428057">.</span><span class="builtintype" id="4428058">string</span><span class="op" id="4428064">(</span><span class="op" id="4428065">)</span><span class="op" id="4428066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428070">case</span>&nbsp;<span class="ident" id="4428075">wire</span><span class="op" id="4428079">.</span><span class="ident" id="4428080">ArrayT</span>&nbsp;<span class="op" id="4428087">!=</span>&nbsp;<span class="ident" id="4428090">nil</span><span class="op" id="4428093">:</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428098">elemId</span>&nbsp;<span class="op" id="4428105">:=</span>&nbsp;<span class="ident" id="4428108">wire</span><span class="op" id="4428112">.</span><span class="ident" id="4428113">ArrayT</span><span class="op" id="4428119">.</span><span class="ident" id="4428120">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428128">elemOp</span>&nbsp;<span class="op" id="4428135">:=</span>&nbsp;<span class="ident" id="4428138">dec</span><span class="op" id="4428141">.</span><span class="ident" id="4428142">decIgnoreOpFor</span><span class="op" id="4428156">(</span><span class="ident" id="4428157">elemId</span><span class="op" id="4428163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428168">op</span>&nbsp;<span class="op" id="4428171">=</span>&nbsp;<span class="keyword" id="4428173">func</span><span class="op" id="4428177">(</span><span class="ident" id="4428178">i</span>&nbsp;<span class="op" id="4428180">*</span><span class="ident" id="4428181">decInstr</span><span class="op" id="4428189">,</span>&nbsp;<span class="ident" id="4428191">state</span>&nbsp;<span class="op" id="4428197">*</span><span class="ident" id="4428198">decoderState</span><span class="op" id="4428210">,</span>&nbsp;<span class="ident" id="4428212">value</span>&nbsp;<span class="ident" id="4428218">reflect</span><span class="op" id="4428225">.</span><span class="ident" id="4428226">Value</span><span class="op" id="4428231">)</span>&nbsp;<span class="op" id="4428233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428239">state</span><span class="op" id="4428244">.</span><span class="ident" id="4428245">dec</span><span class="op" id="4428248">.</span><span class="ident" id="4428249">ignoreArray</span><span class="op" id="4428260">(</span><span class="ident" id="4428261">state</span><span class="op" id="4428266">,</span>&nbsp;<span class="ident" id="4428268">elemOp</span><span class="op" id="4428274">,</span>&nbsp;<span class="ident" id="4428276">wire</span><span class="op" id="4428280">.</span><span class="ident" id="4428281">ArrayT</span><span class="op" id="4428287">.</span><span class="ident" id="4428288">Len</span><span class="op" id="4428291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428296">}</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428301">case</span>&nbsp;<span class="ident" id="4428306">wire</span><span class="op" id="4428310">.</span><span class="ident" id="4428311">MapT</span>&nbsp;<span class="op" id="4428316">!=</span>&nbsp;<span class="ident" id="4428319">nil</span><span class="op" id="4428322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428327">keyId</span>&nbsp;<span class="op" id="4428333">:=</span>&nbsp;<span class="ident" id="4428336">dec</span><span class="op" id="4428339">.</span><span class="ident" id="4428340">wireType</span><span class="op" id="4428348">[</span><span class="ident" id="4428349">wireId</span><span class="op" id="4428355">]</span><span class="op" id="4428356">.</span><span class="ident" id="4428357">MapT</span><span class="op" id="4428361">.</span><span class="ident" id="4428362">Key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428369">elemId</span>&nbsp;<span class="op" id="4428376">:=</span>&nbsp;<span class="ident" id="4428379">dec</span><span class="op" id="4428382">.</span><span class="ident" id="4428383">wireType</span><span class="op" id="4428391">[</span><span class="ident" id="4428392">wireId</span><span class="op" id="4428398">]</span><span class="op" id="4428399">.</span><span class="ident" id="4428400">MapT</span><span class="op" id="4428404">.</span><span class="ident" id="4428405">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428413">keyOp</span>&nbsp;<span class="op" id="4428419">:=</span>&nbsp;<span class="ident" id="4428422">dec</span><span class="op" id="4428425">.</span><span class="ident" id="4428426">decIgnoreOpFor</span><span class="op" id="4428440">(</span><span class="ident" id="4428441">keyId</span><span class="op" id="4428446">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428451">elemOp</span>&nbsp;<span class="op" id="4428458">:=</span>&nbsp;<span class="ident" id="4428461">dec</span><span class="op" id="4428464">.</span><span class="ident" id="4428465">decIgnoreOpFor</span><span class="op" id="4428479">(</span><span class="ident" id="4428480">elemId</span><span class="op" id="4428486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428491">op</span>&nbsp;<span class="op" id="4428494">=</span>&nbsp;<span class="keyword" id="4428496">func</span><span class="op" id="4428500">(</span><span class="ident" id="4428501">i</span>&nbsp;<span class="op" id="4428503">*</span><span class="ident" id="4428504">decInstr</span><span class="op" id="4428512">,</span>&nbsp;<span class="ident" id="4428514">state</span>&nbsp;<span class="op" id="4428520">*</span><span class="ident" id="4428521">decoderState</span><span class="op" id="4428533">,</span>&nbsp;<span class="ident" id="4428535">value</span>&nbsp;<span class="ident" id="4428541">reflect</span><span class="op" id="4428548">.</span><span class="ident" id="4428549">Value</span><span class="op" id="4428554">)</span>&nbsp;<span class="op" id="4428556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428562">state</span><span class="op" id="4428567">.</span><span class="ident" id="4428568">dec</span><span class="op" id="4428571">.</span><span class="ident" id="4428572">ignoreMap</span><span class="op" id="4428581">(</span><span class="ident" id="4428582">state</span><span class="op" id="4428587">,</span>&nbsp;<span class="ident" id="4428589">keyOp</span><span class="op" id="4428594">,</span>&nbsp;<span class="ident" id="4428596">elemOp</span><span class="op" id="4428602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428612">case</span>&nbsp;<span class="ident" id="4428617">wire</span><span class="op" id="4428621">.</span><span class="ident" id="4428622">SliceT</span>&nbsp;<span class="op" id="4428629">!=</span>&nbsp;<span class="ident" id="4428632">nil</span><span class="op" id="4428635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428640">elemId</span>&nbsp;<span class="op" id="4428647">:=</span>&nbsp;<span class="ident" id="4428650">wire</span><span class="op" id="4428654">.</span><span class="ident" id="4428655">SliceT</span><span class="op" id="4428661">.</span><span class="ident" id="4428662">Elem</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428670">elemOp</span>&nbsp;<span class="op" id="4428677">:=</span>&nbsp;<span class="ident" id="4428680">dec</span><span class="op" id="4428683">.</span><span class="ident" id="4428684">decIgnoreOpFor</span><span class="op" id="4428698">(</span><span class="ident" id="4428699">elemId</span><span class="op" id="4428705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428710">op</span>&nbsp;<span class="op" id="4428713">=</span>&nbsp;<span class="keyword" id="4428715">func</span><span class="op" id="4428719">(</span><span class="ident" id="4428720">i</span>&nbsp;<span class="op" id="4428722">*</span><span class="ident" id="4428723">decInstr</span><span class="op" id="4428731">,</span>&nbsp;<span class="ident" id="4428733">state</span>&nbsp;<span class="op" id="4428739">*</span><span class="ident" id="4428740">decoderState</span><span class="op" id="4428752">,</span>&nbsp;<span class="ident" id="4428754">value</span>&nbsp;<span class="ident" id="4428760">reflect</span><span class="op" id="4428767">.</span><span class="ident" id="4428768">Value</span><span class="op" id="4428773">)</span>&nbsp;<span class="op" id="4428775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428781">state</span><span class="op" id="4428786">.</span><span class="ident" id="4428787">dec</span><span class="op" id="4428790">.</span><span class="ident" id="4428791">ignoreSlice</span><span class="op" id="4428802">(</span><span class="ident" id="4428803">state</span><span class="op" id="4428808">,</span>&nbsp;<span class="ident" id="4428810">elemOp</span><span class="op" id="4428816">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428826">case</span>&nbsp;<span class="ident" id="4428831">wire</span><span class="op" id="4428835">.</span><span class="ident" id="4428836">StructT</span>&nbsp;<span class="op" id="4428844">!=</span>&nbsp;<span class="ident" id="4428847">nil</span><span class="op" id="4428850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428855">//&nbsp;Generate&nbsp;a&nbsp;closure&nbsp;that&nbsp;calls&nbsp;out&nbsp;to&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;nested&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428930">enginePtr</span><span class="op" id="4428939">,</span>&nbsp;<span class="ident" id="4428941">err</span>&nbsp;<span class="op" id="4428945">:=</span>&nbsp;<span class="ident" id="4428948">dec</span><span class="op" id="4428951">.</span><span class="ident" id="4428952">getIgnoreEnginePtr</span><span class="op" id="4428970">(</span><span class="ident" id="4428971">wireId</span><span class="op" id="4428977">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428982">if</span>&nbsp;<span class="ident" id="4428985">err</span>&nbsp;<span class="op" id="4428989">!=</span>&nbsp;<span class="ident" id="4428992">nil</span>&nbsp;<span class="op" id="4428996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429002">error_</span><span class="op" id="4429008">(</span><span class="ident" id="4429009">err</span><span class="op" id="4429012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429022">op</span>&nbsp;<span class="op" id="4429025">=</span>&nbsp;<span class="keyword" id="4429027">func</span><span class="op" id="4429031">(</span><span class="ident" id="4429032">i</span>&nbsp;<span class="op" id="4429034">*</span><span class="ident" id="4429035">decInstr</span><span class="op" id="4429043">,</span>&nbsp;<span class="ident" id="4429045">state</span>&nbsp;<span class="op" id="4429051">*</span><span class="ident" id="4429052">decoderState</span><span class="op" id="4429064">,</span>&nbsp;<span class="ident" id="4429066">value</span>&nbsp;<span class="ident" id="4429072">reflect</span><span class="op" id="4429079">.</span><span class="ident" id="4429080">Value</span><span class="op" id="4429085">)</span>&nbsp;<span class="op" id="4429087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429093">//&nbsp;indirect&nbsp;through&nbsp;enginePtr&nbsp;to&nbsp;delay&nbsp;evaluation&nbsp;for&nbsp;recursive&nbsp;structs</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429169">state</span><span class="op" id="4429174">.</span><span class="ident" id="4429175">dec</span><span class="op" id="4429178">.</span><span class="ident" id="4429179">ignoreStruct</span><span class="op" id="4429191">(</span><span class="op" id="4429192">*</span><span class="ident" id="4429193">enginePtr</span><span class="op" id="4429202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429212">case</span>&nbsp;<span class="ident" id="4429217">wire</span><span class="op" id="4429221">.</span><span class="ident" id="4429222">GobEncoderT</span>&nbsp;<span class="op" id="4429234">!=</span>&nbsp;<span class="ident" id="4429237">nil</span><span class="op" id="4429240">,</span>&nbsp;<span class="ident" id="4429242">wire</span><span class="op" id="4429246">.</span><span class="ident" id="4429247">BinaryMarshalerT</span>&nbsp;<span class="op" id="4429264">!=</span>&nbsp;<span class="ident" id="4429267">nil</span><span class="op" id="4429270">,</span>&nbsp;<span class="ident" id="4429272">wire</span><span class="op" id="4429276">.</span><span class="ident" id="4429277">TextMarshalerT</span>&nbsp;<span class="op" id="4429292">!=</span>&nbsp;<span class="ident" id="4429295">nil</span><span class="op" id="4429298">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429303">op</span>&nbsp;<span class="op" id="4429306">=</span>&nbsp;<span class="keyword" id="4429308">func</span><span class="op" id="4429312">(</span><span class="ident" id="4429313">i</span>&nbsp;<span class="op" id="4429315">*</span><span class="ident" id="4429316">decInstr</span><span class="op" id="4429324">,</span>&nbsp;<span class="ident" id="4429326">state</span>&nbsp;<span class="op" id="4429332">*</span><span class="ident" id="4429333">decoderState</span><span class="op" id="4429345">,</span>&nbsp;<span class="ident" id="4429347">value</span>&nbsp;<span class="ident" id="4429353">reflect</span><span class="op" id="4429360">.</span><span class="ident" id="4429361">Value</span><span class="op" id="4429366">)</span>&nbsp;<span class="op" id="4429368">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429374">state</span><span class="op" id="4429379">.</span><span class="ident" id="4429380">dec</span><span class="op" id="4429383">.</span><span class="ident" id="4429384">ignoreGobDecoder</span><span class="op" id="4429400">(</span><span class="ident" id="4429401">state</span><span class="op" id="4429406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429421">if</span>&nbsp;<span class="ident" id="4429424">op</span>&nbsp;<span class="op" id="4429427">==</span>&nbsp;<span class="ident" id="4429430">nil</span>&nbsp;<span class="op" id="4429434">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429438">errorf</span><span class="op" id="4429444">(</span><span class="string" id="4429445">&#34;bad&nbsp;data:&nbsp;ignore&nbsp;can&#39;t&nbsp;handle&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4429484">,</span>&nbsp;<span class="ident" id="4429486">wireId</span><span class="op" id="4429492">.</span><span class="builtintype" id="4429493">string</span><span class="op" id="4429499">(</span><span class="op" id="4429500">)</span><span class="op" id="4429501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429507">return</span>&nbsp;<span class="ident" id="4429514">op</span><br>
<span class="lineno"></span><span class="op" id="4429517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">905</span><span class="comment" id="4429520">//&nbsp;gobDecodeOpFor&nbsp;returns&nbsp;the&nbsp;op&nbsp;for&nbsp;a&nbsp;type&nbsp;that&nbsp;is&nbsp;known&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="4429591">//&nbsp;GobDecoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4429606">func</span>&nbsp;<span class="op" id="4429611">(</span><span class="ident" id="4429612">dec</span>&nbsp;<span class="op" id="4429616">*</span><span class="ident" id="4429617">Decoder</span><span class="op" id="4429624">)</span>&nbsp;<span class="ident" id="4429626">gobDecodeOpFor</span><span class="op" id="4429640">(</span><span class="ident" id="4429641">ut</span>&nbsp;<span class="op" id="4429644">*</span><span class="ident" id="4429645">userTypeInfo</span><span class="op" id="4429657">)</span>&nbsp;<span class="op" id="4429659">*</span><span class="ident" id="4429660">decOp</span>&nbsp;<span class="op" id="4429666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429669">rcvrType</span>&nbsp;<span class="op" id="4429678">:=</span>&nbsp;<span class="ident" id="4429681">ut</span><span class="op" id="4429683">.</span><span class="ident" id="4429684">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429690">if</span>&nbsp;<span class="ident" id="4429693">ut</span><span class="op" id="4429695">.</span><span class="ident" id="4429696">decIndir</span>&nbsp;<span class="op" id="4429705">==</span>&nbsp;<span class="op" id="4429708">-</span><span class="num" id="4429709">1</span>&nbsp;<span class="op" id="4429711">{</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429715">rcvrType</span>&nbsp;<span class="op" id="4429724">=</span>&nbsp;<span class="ident" id="4429726">reflect</span><span class="op" id="4429733">.</span><span class="ident" id="4429734">PtrTo</span><span class="op" id="4429739">(</span><span class="ident" id="4429740">rcvrType</span><span class="op" id="4429748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429751">}</span>&nbsp;<span class="keyword" id="4429753">else</span>&nbsp;<span class="keyword" id="4429758">if</span>&nbsp;<span class="ident" id="4429761">ut</span><span class="op" id="4429763">.</span><span class="ident" id="4429764">decIndir</span>&nbsp;<span class="op" id="4429773">&gt;</span>&nbsp;<span class="num" id="4429775">0</span>&nbsp;<span class="op" id="4429777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429781">for</span>&nbsp;<span class="ident" id="4429785">i</span>&nbsp;<span class="op" id="4429787">:=</span>&nbsp;<span class="builtintype" id="4429790">int8</span><span class="op" id="4429794">(</span><span class="num" id="4429795">0</span><span class="op" id="4429796">)</span><span class="op" id="4429797">;</span>&nbsp;<span class="ident" id="4429799">i</span>&nbsp;<span class="op" id="4429801">&lt;</span>&nbsp;<span class="ident" id="4429803">ut</span><span class="op" id="4429805">.</span><span class="ident" id="4429806">decIndir</span><span class="op" id="4429814">;</span>&nbsp;<span class="ident" id="4429816">i</span><span class="op" id="4429817">++</span>&nbsp;<span class="op" id="4429820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429825">rcvrType</span>&nbsp;<span class="op" id="4429834">=</span>&nbsp;<span class="ident" id="4429836">rcvrType</span><span class="op" id="4429844">.</span><span class="ident" id="4429845">Elem</span><span class="op" id="4429849">(</span><span class="op" id="4429850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429854">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429860">var</span>&nbsp;<span class="ident" id="4429864">op</span>&nbsp;<span class="ident" id="4429867">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429874">op</span>&nbsp;<span class="op" id="4429877">=</span>&nbsp;<span class="keyword" id="4429879">func</span><span class="op" id="4429883">(</span><span class="ident" id="4429884">i</span>&nbsp;<span class="op" id="4429886">*</span><span class="ident" id="4429887">decInstr</span><span class="op" id="4429895">,</span>&nbsp;<span class="ident" id="4429897">state</span>&nbsp;<span class="op" id="4429903">*</span><span class="ident" id="4429904">decoderState</span><span class="op" id="4429916">,</span>&nbsp;<span class="ident" id="4429918">value</span>&nbsp;<span class="ident" id="4429924">reflect</span><span class="op" id="4429931">.</span><span class="ident" id="4429932">Value</span><span class="op" id="4429937">)</span>&nbsp;<span class="op" id="4429939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4429943">//&nbsp;We&nbsp;now&nbsp;have&nbsp;the&nbsp;base&nbsp;type.&nbsp;We&nbsp;need&nbsp;its&nbsp;address&nbsp;if&nbsp;the&nbsp;receiver&nbsp;is&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430025">if</span>&nbsp;<span class="ident" id="4430028">value</span><span class="op" id="4430033">.</span><span class="ident" id="4430034">Kind</span><span class="op" id="4430038">(</span><span class="op" id="4430039">)</span>&nbsp;<span class="op" id="4430041">!=</span>&nbsp;<span class="ident" id="4430044">reflect</span><span class="op" id="4430051">.</span><span class="ident" id="4430052">Ptr</span>&nbsp;<span class="op" id="4430056">&amp;&amp;</span>&nbsp;<span class="ident" id="4430059">rcvrType</span><span class="op" id="4430067">.</span><span class="ident" id="4430068">Kind</span><span class="op" id="4430072">(</span><span class="op" id="4430073">)</span>&nbsp;<span class="op" id="4430075">==</span>&nbsp;<span class="ident" id="4430078">reflect</span><span class="op" id="4430085">.</span><span class="ident" id="4430086">Ptr</span>&nbsp;<span class="op" id="4430090">{</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430095">value</span>&nbsp;<span class="op" id="4430101">=</span>&nbsp;<span class="ident" id="4430103">value</span><span class="op" id="4430108">.</span><span class="ident" id="4430109">Addr</span><span class="op" id="4430113">(</span><span class="op" id="4430114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430122">state</span><span class="op" id="4430127">.</span><span class="ident" id="4430128">dec</span><span class="op" id="4430131">.</span><span class="ident" id="4430132">decodeGobDecoder</span><span class="op" id="4430148">(</span><span class="ident" id="4430149">ut</span><span class="op" id="4430151">,</span>&nbsp;<span class="ident" id="4430153">state</span><span class="op" id="4430158">,</span>&nbsp;<span class="ident" id="4430160">value</span><span class="op" id="4430165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430171">return</span>&nbsp;<span class="op" id="4430178">&amp;</span><span class="ident" id="4430179">op</span><br>
<span class="lineno">925</span><span class="op" id="4430182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4430185">//&nbsp;compatibleType&nbsp;asks:&nbsp;Are&nbsp;these&nbsp;two&nbsp;gob&nbsp;Types&nbsp;compatible?</span><br>
<span class="lineno"></span><span class="comment" id="4430245">//&nbsp;Answers&nbsp;the&nbsp;question&nbsp;for&nbsp;basic&nbsp;types,&nbsp;arrays,&nbsp;maps&nbsp;and&nbsp;slices,&nbsp;plus</span><br>
<span class="lineno"></span><span class="comment" id="4430316">//&nbsp;GobEncoder/Decoder&nbsp;pairs.</span><br>
<span class="lineno">930</span><span class="comment" id="4430345">//&nbsp;Structs&nbsp;are&nbsp;considered&nbsp;ok;&nbsp;fields&nbsp;will&nbsp;be&nbsp;checked&nbsp;later.</span><br>
<span class="lineno"></span><span class="keyword" id="4430405">func</span>&nbsp;<span class="op" id="4430410">(</span><span class="ident" id="4430411">dec</span>&nbsp;<span class="op" id="4430415">*</span><span class="ident" id="4430416">Decoder</span><span class="op" id="4430423">)</span>&nbsp;<span class="ident" id="4430425">compatibleType</span><span class="op" id="4430439">(</span><span class="ident" id="4430440">fr</span>&nbsp;<span class="ident" id="4430443">reflect</span><span class="op" id="4430450">.</span><span class="ident" id="4430451">Type</span><span class="op" id="4430455">,</span>&nbsp;<span class="ident" id="4430457">fw</span>&nbsp;<span class="ident" id="4430460">typeId</span><span class="op" id="4430466">,</span>&nbsp;<span class="ident" id="4430468">inProgress</span>&nbsp;<span class="keyword" id="4430479">map</span><span class="op" id="4430482">[</span><span class="ident" id="4430483">reflect</span><span class="op" id="4430490">.</span><span class="ident" id="4430491">Type</span><span class="op" id="4430495">]</span><span class="ident" id="4430496">typeId</span><span class="op" id="4430502">)</span>&nbsp;<span class="builtintype" id="4430504">bool</span>&nbsp;<span class="op" id="4430509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430512">if</span>&nbsp;<span class="ident" id="4430515">rhs</span><span class="op" id="4430518">,</span>&nbsp;<span class="ident" id="4430520">ok</span>&nbsp;<span class="op" id="4430523">:=</span>&nbsp;<span class="ident" id="4430526">inProgress</span><span class="op" id="4430536">[</span><span class="ident" id="4430537">fr</span><span class="op" id="4430539">]</span><span class="op" id="4430540">;</span>&nbsp;<span class="ident" id="4430542">ok</span>&nbsp;<span class="op" id="4430545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430549">return</span>&nbsp;<span class="ident" id="4430556">rhs</span>&nbsp;<span class="op" id="4430560">==</span>&nbsp;<span class="ident" id="4430563">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4430567">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430570">inProgress</span><span class="op" id="4430580">[</span><span class="ident" id="4430581">fr</span><span class="op" id="4430583">]</span>&nbsp;<span class="op" id="4430585">=</span>&nbsp;<span class="ident" id="4430587">fw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430591">ut</span>&nbsp;<span class="op" id="4430594">:=</span>&nbsp;<span class="ident" id="4430597">userType</span><span class="op" id="4430605">(</span><span class="ident" id="4430606">fr</span><span class="op" id="4430608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4430611">wire</span><span class="op" id="4430615">,</span>&nbsp;<span class="ident" id="4430617">ok</span>&nbsp;<span class="op" id="4430620">:=</span>&nbsp;<span class="ident" id="4430623">dec</span><span class="op" id="4430626">.</span><span class="ident" id="4430627">wireType</span><span class="op" id="4430635">[</span><span class="ident" id="4430636">fw</span><span class="op" id="4430638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430641">//&nbsp;If&nbsp;wire&nbsp;was&nbsp;encoded&nbsp;with&nbsp;an&nbsp;encoding&nbsp;method,&nbsp;fr&nbsp;must&nbsp;have&nbsp;that&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430716">//&nbsp;And&nbsp;if&nbsp;not,&nbsp;it&nbsp;must&nbsp;not.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430745">//&nbsp;At&nbsp;most&nbsp;one&nbsp;of&nbsp;the&nbsp;booleans&nbsp;in&nbsp;ut&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430791">//&nbsp;We&nbsp;could&nbsp;possibly&nbsp;relax&nbsp;this&nbsp;constraint&nbsp;in&nbsp;the&nbsp;future&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430861">//&nbsp;choose&nbsp;the&nbsp;decoding&nbsp;method&nbsp;using&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;wireType.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4430924">//&nbsp;The&nbsp;parentheses&nbsp;look&nbsp;odd&nbsp;but&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4430970">if</span>&nbsp;<span class="op" id="4430973">(</span><span class="ident" id="4430974">ut</span><span class="op" id="4430976">.</span><span class="ident" id="4430977">externalDec</span>&nbsp;<span class="op" id="4430989">==</span>&nbsp;<span class="ident" id="4430992">xGob</span><span class="op" id="4430996">)</span>&nbsp;<span class="op" id="4430998">!=</span>&nbsp;<span class="op" id="4431001">(</span><span class="ident" id="4431002">ok</span>&nbsp;<span class="op" id="4431005">&amp;&amp;</span>&nbsp;<span class="ident" id="4431008">wire</span><span class="op" id="4431012">.</span><span class="ident" id="4431013">GobEncoderT</span>&nbsp;<span class="op" id="4431025">!=</span>&nbsp;<span class="ident" id="4431028">nil</span><span class="op" id="4431031">)</span>&nbsp;<span class="op" id="4431033">||</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431038">(</span><span class="ident" id="4431039">ut</span><span class="op" id="4431041">.</span><span class="ident" id="4431042">externalDec</span>&nbsp;<span class="op" id="4431054">==</span>&nbsp;<span class="ident" id="4431057">xBinary</span><span class="op" id="4431064">)</span>&nbsp;<span class="op" id="4431066">!=</span>&nbsp;<span class="op" id="4431069">(</span><span class="ident" id="4431070">ok</span>&nbsp;<span class="op" id="4431073">&amp;&amp;</span>&nbsp;<span class="ident" id="4431076">wire</span><span class="op" id="4431080">.</span><span class="ident" id="4431081">BinaryMarshalerT</span>&nbsp;<span class="op" id="4431098">!=</span>&nbsp;<span class="ident" id="4431101">nil</span><span class="op" id="4431104">)</span>&nbsp;<span class="op" id="4431106">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431111">(</span><span class="ident" id="4431112">ut</span><span class="op" id="4431114">.</span><span class="ident" id="4431115">externalDec</span>&nbsp;<span class="op" id="4431127">==</span>&nbsp;<span class="ident" id="4431130">xText</span><span class="op" id="4431135">)</span>&nbsp;<span class="op" id="4431137">!=</span>&nbsp;<span class="op" id="4431140">(</span><span class="ident" id="4431141">ok</span>&nbsp;<span class="op" id="4431144">&amp;&amp;</span>&nbsp;<span class="ident" id="4431147">wire</span><span class="op" id="4431151">.</span><span class="ident" id="4431152">TextMarshalerT</span>&nbsp;<span class="op" id="4431167">!=</span>&nbsp;<span class="ident" id="4431170">nil</span><span class="op" id="4431173">)</span>&nbsp;<span class="op" id="4431175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431179">return</span>&nbsp;<span class="builtintype" id="4431186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431196">if</span>&nbsp;<span class="ident" id="4431199">ut</span><span class="op" id="4431201">.</span><span class="ident" id="4431202">externalDec</span>&nbsp;<span class="op" id="4431214">!=</span>&nbsp;<span class="num" id="4431217">0</span>&nbsp;<span class="op" id="4431219">{</span>&nbsp;<span class="comment" id="4431221">//&nbsp;This&nbsp;test&nbsp;trumps&nbsp;all&nbsp;others.</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431255">return</span>&nbsp;<span class="builtintype" id="4431262">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431271">switch</span>&nbsp;<span class="ident" id="4431278">t</span>&nbsp;<span class="op" id="4431280">:=</span>&nbsp;<span class="ident" id="4431283">ut</span><span class="op" id="4431285">.</span><span class="ident" id="4431286">base</span><span class="op" id="4431290">;</span>&nbsp;<span class="ident" id="4431292">t</span><span class="op" id="4431293">.</span><span class="ident" id="4431294">Kind</span><span class="op" id="4431298">(</span><span class="op" id="4431299">)</span>&nbsp;<span class="op" id="4431301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431304">default</span><span class="op" id="4431311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4431315">//&nbsp;chan,&nbsp;etc:&nbsp;cannot&nbsp;handle.</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431346">return</span>&nbsp;<span class="builtintype" id="4431353">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431360">case</span>&nbsp;<span class="ident" id="4431365">reflect</span><span class="op" id="4431372">.</span><span class="ident" id="4431373">Bool</span><span class="op" id="4431377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431381">return</span>&nbsp;<span class="ident" id="4431388">fw</span>&nbsp;<span class="op" id="4431391">==</span>&nbsp;<span class="ident" id="4431394">tBool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431401">case</span>&nbsp;<span class="ident" id="4431406">reflect</span><span class="op" id="4431413">.</span><span class="ident" id="4431414">Int</span><span class="op" id="4431417">,</span>&nbsp;<span class="ident" id="4431419">reflect</span><span class="op" id="4431426">.</span><span class="ident" id="4431427">Int8</span><span class="op" id="4431431">,</span>&nbsp;<span class="ident" id="4431433">reflect</span><span class="op" id="4431440">.</span><span class="ident" id="4431441">Int16</span><span class="op" id="4431446">,</span>&nbsp;<span class="ident" id="4431448">reflect</span><span class="op" id="4431455">.</span><span class="ident" id="4431456">Int32</span><span class="op" id="4431461">,</span>&nbsp;<span class="ident" id="4431463">reflect</span><span class="op" id="4431470">.</span><span class="ident" id="4431471">Int64</span><span class="op" id="4431476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431480">return</span>&nbsp;<span class="ident" id="4431487">fw</span>&nbsp;<span class="op" id="4431490">==</span>&nbsp;<span class="ident" id="4431493">tInt</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431499">case</span>&nbsp;<span class="ident" id="4431504">reflect</span><span class="op" id="4431511">.</span><span class="ident" id="4431512">Uint</span><span class="op" id="4431516">,</span>&nbsp;<span class="ident" id="4431518">reflect</span><span class="op" id="4431525">.</span><span class="ident" id="4431526">Uint8</span><span class="op" id="4431531">,</span>&nbsp;<span class="ident" id="4431533">reflect</span><span class="op" id="4431540">.</span><span class="ident" id="4431541">Uint16</span><span class="op" id="4431547">,</span>&nbsp;<span class="ident" id="4431549">reflect</span><span class="op" id="4431556">.</span><span class="ident" id="4431557">Uint32</span><span class="op" id="4431563">,</span>&nbsp;<span class="ident" id="4431565">reflect</span><span class="op" id="4431572">.</span><span class="ident" id="4431573">Uint64</span><span class="op" id="4431579">,</span>&nbsp;<span class="ident" id="4431581">reflect</span><span class="op" id="4431588">.</span><span class="ident" id="4431589">Uintptr</span><span class="op" id="4431596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431600">return</span>&nbsp;<span class="ident" id="4431607">fw</span>&nbsp;<span class="op" id="4431610">==</span>&nbsp;<span class="ident" id="4431613">tUint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431620">case</span>&nbsp;<span class="ident" id="4431625">reflect</span><span class="op" id="4431632">.</span><span class="ident" id="4431633">Float32</span><span class="op" id="4431640">,</span>&nbsp;<span class="ident" id="4431642">reflect</span><span class="op" id="4431649">.</span><span class="ident" id="4431650">Float64</span><span class="op" id="4431657">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431661">return</span>&nbsp;<span class="ident" id="4431668">fw</span>&nbsp;<span class="op" id="4431671">==</span>&nbsp;<span class="ident" id="4431674">tFloat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431682">case</span>&nbsp;<span class="ident" id="4431687">reflect</span><span class="op" id="4431694">.</span><span class="ident" id="4431695">Complex64</span><span class="op" id="4431704">,</span>&nbsp;<span class="ident" id="4431706">reflect</span><span class="op" id="4431713">.</span><span class="ident" id="4431714">Complex128</span><span class="op" id="4431724">:</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431728">return</span>&nbsp;<span class="ident" id="4431735">fw</span>&nbsp;<span class="op" id="4431738">==</span>&nbsp;<span class="ident" id="4431741">tComplex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431751">case</span>&nbsp;<span class="ident" id="4431756">reflect</span><span class="op" id="4431763">.</span><span class="ident" id="4431764">String</span><span class="op" id="4431770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431774">return</span>&nbsp;<span class="ident" id="4431781">fw</span>&nbsp;<span class="op" id="4431784">==</span>&nbsp;<span class="ident" id="4431787">tString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431796">case</span>&nbsp;<span class="ident" id="4431801">reflect</span><span class="op" id="4431808">.</span><span class="ident" id="4431809">Interface</span><span class="op" id="4431818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431822">return</span>&nbsp;<span class="ident" id="4431829">fw</span>&nbsp;<span class="op" id="4431832">==</span>&nbsp;<span class="ident" id="4431835">tInterface</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431847">case</span>&nbsp;<span class="ident" id="4431852">reflect</span><span class="op" id="4431859">.</span><span class="ident" id="4431860">Array</span><span class="op" id="4431865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431869">if</span>&nbsp;<span class="op" id="4431872">!</span><span class="ident" id="4431873">ok</span>&nbsp;<span class="op" id="4431876">||</span>&nbsp;<span class="ident" id="4431879">wire</span><span class="op" id="4431883">.</span><span class="ident" id="4431884">ArrayT</span>&nbsp;<span class="op" id="4431891">==</span>&nbsp;<span class="ident" id="4431894">nil</span>&nbsp;<span class="op" id="4431898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431903">return</span>&nbsp;<span class="builtintype" id="4431910">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4431918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4431922">array</span>&nbsp;<span class="op" id="4431928">:=</span>&nbsp;<span class="ident" id="4431931">wire</span><span class="op" id="4431935">.</span><span class="ident" id="4431936">ArrayT</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4431945">return</span>&nbsp;<span class="ident" id="4431952">t</span><span class="op" id="4431953">.</span><span class="ident" id="4431954">Len</span><span class="op" id="4431957">(</span><span class="op" id="4431958">)</span>&nbsp;<span class="op" id="4431960">==</span>&nbsp;<span class="ident" id="4431963">array</span><span class="op" id="4431968">.</span><span class="ident" id="4431969">Len</span>&nbsp;<span class="op" id="4431973">&amp;&amp;</span>&nbsp;<span class="ident" id="4431976">dec</span><span class="op" id="4431979">.</span><span class="ident" id="4431980">compatibleType</span><span class="op" id="4431994">(</span><span class="ident" id="4431995">t</span><span class="op" id="4431996">.</span><span class="ident" id="4431997">Elem</span><span class="op" id="4432001">(</span><span class="op" id="4432002">)</span><span class="op" id="4432003">,</span>&nbsp;<span class="ident" id="4432005">array</span><span class="op" id="4432010">.</span><span class="ident" id="4432011">Elem</span><span class="op" id="4432015">,</span>&nbsp;<span class="ident" id="4432017">inProgress</span><span class="op" id="4432027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432030">case</span>&nbsp;<span class="ident" id="4432035">reflect</span><span class="op" id="4432042">.</span><span class="ident" id="4432043">Map</span><span class="op" id="4432046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432050">if</span>&nbsp;<span class="op" id="4432053">!</span><span class="ident" id="4432054">ok</span>&nbsp;<span class="op" id="4432057">||</span>&nbsp;<span class="ident" id="4432060">wire</span><span class="op" id="4432064">.</span><span class="ident" id="4432065">MapT</span>&nbsp;<span class="op" id="4432070">==</span>&nbsp;<span class="ident" id="4432073">nil</span>&nbsp;<span class="op" id="4432077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432082">return</span>&nbsp;<span class="builtintype" id="4432089">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432097">}</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432101">MapType</span>&nbsp;<span class="op" id="4432109">:=</span>&nbsp;<span class="ident" id="4432112">wire</span><span class="op" id="4432116">.</span><span class="ident" id="4432117">MapT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432124">return</span>&nbsp;<span class="ident" id="4432131">dec</span><span class="op" id="4432134">.</span><span class="ident" id="4432135">compatibleType</span><span class="op" id="4432149">(</span><span class="ident" id="4432150">t</span><span class="op" id="4432151">.</span><span class="ident" id="4432152">Key</span><span class="op" id="4432155">(</span><span class="op" id="4432156">)</span><span class="op" id="4432157">,</span>&nbsp;<span class="ident" id="4432159">MapType</span><span class="op" id="4432166">.</span><span class="ident" id="4432167">Key</span><span class="op" id="4432170">,</span>&nbsp;<span class="ident" id="4432172">inProgress</span><span class="op" id="4432182">)</span>&nbsp;<span class="op" id="4432184">&amp;&amp;</span>&nbsp;<span class="ident" id="4432187">dec</span><span class="op" id="4432190">.</span><span class="ident" id="4432191">compatibleType</span><span class="op" id="4432205">(</span><span class="ident" id="4432206">t</span><span class="op" id="4432207">.</span><span class="ident" id="4432208">Elem</span><span class="op" id="4432212">(</span><span class="op" id="4432213">)</span><span class="op" id="4432214">,</span>&nbsp;<span class="ident" id="4432216">MapType</span><span class="op" id="4432223">.</span><span class="ident" id="4432224">Elem</span><span class="op" id="4432228">,</span>&nbsp;<span class="ident" id="4432230">inProgress</span><span class="op" id="4432240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432243">case</span>&nbsp;<span class="ident" id="4432248">reflect</span><span class="op" id="4432255">.</span><span class="ident" id="4432256">Slice</span><span class="op" id="4432261">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4432265">//&nbsp;Is&nbsp;it&nbsp;an&nbsp;array&nbsp;of&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432295">if</span>&nbsp;<span class="ident" id="4432298">t</span><span class="op" id="4432299">.</span><span class="ident" id="4432300">Elem</span><span class="op" id="4432304">(</span><span class="op" id="4432305">)</span><span class="op" id="4432306">.</span><span class="ident" id="4432307">Kind</span><span class="op" id="4432311">(</span><span class="op" id="4432312">)</span>&nbsp;<span class="op" id="4432314">==</span>&nbsp;<span class="ident" id="4432317">reflect</span><span class="op" id="4432324">.</span><span class="ident" id="4432325">Uint8</span>&nbsp;<span class="op" id="4432331">{</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432336">return</span>&nbsp;<span class="ident" id="4432343">fw</span>&nbsp;<span class="op" id="4432346">==</span>&nbsp;<span class="ident" id="4432349">tBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4432362">//&nbsp;Extract&nbsp;and&nbsp;compare&nbsp;element&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432402">var</span>&nbsp;<span class="ident" id="4432406">sw</span>&nbsp;<span class="op" id="4432409">*</span><span class="ident" id="4432410">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432422">if</span>&nbsp;<span class="ident" id="4432425">tt</span><span class="op" id="4432427">,</span>&nbsp;<span class="ident" id="4432429">ok</span>&nbsp;<span class="op" id="4432432">:=</span>&nbsp;<span class="ident" id="4432435">builtinIdToType</span><span class="op" id="4432450">[</span><span class="ident" id="4432451">fw</span><span class="op" id="4432453">]</span><span class="op" id="4432454">;</span>&nbsp;<span class="ident" id="4432456">ok</span>&nbsp;<span class="op" id="4432459">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432464">sw</span><span class="op" id="4432466">,</span>&nbsp;<span class="ident" id="4432468">_</span>&nbsp;<span class="op" id="4432470">=</span>&nbsp;<span class="ident" id="4432472">tt</span><span class="op" id="4432474">.</span><span class="op" id="4432475">(</span><span class="op" id="4432476">*</span><span class="ident" id="4432477">sliceType</span><span class="op" id="4432486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432490">}</span>&nbsp;<span class="keyword" id="4432492">else</span>&nbsp;<span class="keyword" id="4432497">if</span>&nbsp;<span class="ident" id="4432500">wire</span>&nbsp;<span class="op" id="4432505">!=</span>&nbsp;<span class="ident" id="4432508">nil</span>&nbsp;<span class="op" id="4432512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432517">sw</span>&nbsp;<span class="op" id="4432520">=</span>&nbsp;<span class="ident" id="4432522">wire</span><span class="op" id="4432526">.</span><span class="ident" id="4432527">SliceT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4432540">elem</span>&nbsp;<span class="op" id="4432545">:=</span>&nbsp;<span class="ident" id="4432548">userType</span><span class="op" id="4432556">(</span><span class="ident" id="4432557">t</span><span class="op" id="4432558">.</span><span class="ident" id="4432559">Elem</span><span class="op" id="4432563">(</span><span class="op" id="4432564">)</span><span class="op" id="4432565">)</span><span class="op" id="4432566">.</span><span class="ident" id="4432567">base</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432574">return</span>&nbsp;<span class="ident" id="4432581">sw</span>&nbsp;<span class="op" id="4432584">!=</span>&nbsp;<span class="ident" id="4432587">nil</span>&nbsp;<span class="op" id="4432591">&amp;&amp;</span>&nbsp;<span class="ident" id="4432594">dec</span><span class="op" id="4432597">.</span><span class="ident" id="4432598">compatibleType</span><span class="op" id="4432612">(</span><span class="ident" id="4432613">elem</span><span class="op" id="4432617">,</span>&nbsp;<span class="ident" id="4432619">sw</span><span class="op" id="4432621">.</span><span class="ident" id="4432622">Elem</span><span class="op" id="4432626">,</span>&nbsp;<span class="ident" id="4432628">inProgress</span><span class="op" id="4432638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432641">case</span>&nbsp;<span class="ident" id="4432646">reflect</span><span class="op" id="4432653">.</span><span class="ident" id="4432654">Struct</span><span class="op" id="4432660">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432664">return</span>&nbsp;<span class="builtintype" id="4432671">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432677">}</span><br>
<span class="lineno"></span><span class="op" id="4432679">}</span><br>
<span class="lineno">1000</span><br>
<span class="lineno"></span><span class="comment" id="4432682">//&nbsp;typeString&nbsp;returns&nbsp;a&nbsp;human-readable&nbsp;description&nbsp;of&nbsp;the&nbsp;type&nbsp;identified&nbsp;by&nbsp;remoteId.</span><br>
<span class="lineno"></span><span class="keyword" id="4432769">func</span>&nbsp;<span class="op" id="4432774">(</span><span class="ident" id="4432775">dec</span>&nbsp;<span class="op" id="4432779">*</span><span class="ident" id="4432780">Decoder</span><span class="op" id="4432787">)</span>&nbsp;<span class="ident" id="4432789">typeString</span><span class="op" id="4432799">(</span><span class="ident" id="4432800">remoteId</span>&nbsp;<span class="ident" id="4432809">typeId</span><span class="op" id="4432815">)</span>&nbsp;<span class="builtintype" id="4432817">string</span>&nbsp;<span class="op" id="4432824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432827">if</span>&nbsp;<span class="ident" id="4432830">t</span>&nbsp;<span class="op" id="4432832">:=</span>&nbsp;<span class="ident" id="4432835">idToType</span><span class="op" id="4432843">[</span><span class="ident" id="4432844">remoteId</span><span class="op" id="4432852">]</span><span class="op" id="4432853">;</span>&nbsp;<span class="ident" id="4432855">t</span>&nbsp;<span class="op" id="4432857">!=</span>&nbsp;<span class="ident" id="4432860">nil</span>&nbsp;<span class="op" id="4432864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4432868">//&nbsp;globally&nbsp;known&nbsp;type.</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432894">return</span>&nbsp;<span class="ident" id="4432901">t</span><span class="op" id="4432902">.</span><span class="builtintype" id="4432903">string</span><span class="op" id="4432909">(</span><span class="op" id="4432910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4432913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4432916">return</span>&nbsp;<span class="ident" id="4432923">dec</span><span class="op" id="4432926">.</span><span class="ident" id="4432927">wireType</span><span class="op" id="4432935">[</span><span class="ident" id="4432936">remoteId</span><span class="op" id="4432944">]</span><span class="op" id="4432945">.</span><span class="builtintype" id="4432946">string</span><span class="op" id="4432952">(</span><span class="op" id="4432953">)</span><br>
<span class="lineno"></span><span class="op" id="4432955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="4432958">//&nbsp;compileSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value,&nbsp;including</span><br>
<span class="lineno"></span><span class="comment" id="4433047">//&nbsp;GobDecoders.</span><br>
<span class="lineno"></span><span class="keyword" id="4433063">func</span>&nbsp;<span class="op" id="4433068">(</span><span class="ident" id="4433069">dec</span>&nbsp;<span class="op" id="4433073">*</span><span class="ident" id="4433074">Decoder</span><span class="op" id="4433081">)</span>&nbsp;<span class="ident" id="4433083">compileSingle</span><span class="op" id="4433096">(</span><span class="ident" id="4433097">remoteId</span>&nbsp;<span class="ident" id="4433106">typeId</span><span class="op" id="4433112">,</span>&nbsp;<span class="ident" id="4433114">ut</span>&nbsp;<span class="op" id="4433117">*</span><span class="ident" id="4433118">userTypeInfo</span><span class="op" id="4433130">)</span>&nbsp;<span class="op" id="4433132">(</span><span class="ident" id="4433133">engine</span>&nbsp;<span class="op" id="4433140">*</span><span class="ident" id="4433141">decEngine</span><span class="op" id="4433150">,</span>&nbsp;<span class="ident" id="4433152">err</span>&nbsp;<span class="builtintype" id="4433156">error</span><span class="op" id="4433161">)</span>&nbsp;<span class="op" id="4433163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433166">rt</span>&nbsp;<span class="op" id="4433169">:=</span>&nbsp;<span class="ident" id="4433172">ut</span><span class="op" id="4433174">.</span><span class="ident" id="4433175">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433181">engine</span>&nbsp;<span class="op" id="4433188">=</span>&nbsp;<span class="builtinfunc" id="4433190">new</span><span class="op" id="4433193">(</span><span class="ident" id="4433194">decEngine</span><span class="op" id="4433203">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433206">engine</span><span class="op" id="4433212">.</span><span class="ident" id="4433213">instr</span>&nbsp;<span class="op" id="4433219">=</span>&nbsp;<span class="builtinfunc" id="4433221">make</span><span class="op" id="4433225">(</span><span class="op" id="4433226">[</span><span class="op" id="4433227">]</span><span class="ident" id="4433228">decInstr</span><span class="op" id="4433236">,</span>&nbsp;<span class="num" id="4433238">1</span><span class="op" id="4433239">)</span>&nbsp;<span class="comment" id="4433241">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433254">name</span>&nbsp;<span class="op" id="4433259">:=</span>&nbsp;<span class="ident" id="4433262">rt</span><span class="op" id="4433264">.</span><span class="ident" id="4433265">String</span><span class="op" id="4433271">(</span><span class="op" id="4433272">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4433289">//&nbsp;best&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433308">if</span>&nbsp;<span class="op" id="4433311">!</span><span class="ident" id="4433312">dec</span><span class="op" id="4433315">.</span><span class="ident" id="4433316">compatibleType</span><span class="op" id="4433330">(</span><span class="ident" id="4433331">rt</span><span class="op" id="4433333">,</span>&nbsp;<span class="ident" id="4433335">remoteId</span><span class="op" id="4433343">,</span>&nbsp;<span class="builtinfunc" id="4433345">make</span><span class="op" id="4433349">(</span><span class="keyword" id="4433350">map</span><span class="op" id="4433353">[</span><span class="ident" id="4433354">reflect</span><span class="op" id="4433361">.</span><span class="ident" id="4433362">Type</span><span class="op" id="4433366">]</span><span class="ident" id="4433367">typeId</span><span class="op" id="4433373">)</span><span class="op" id="4433374">)</span>&nbsp;<span class="op" id="4433376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433380">remoteType</span>&nbsp;<span class="op" id="4433391">:=</span>&nbsp;<span class="ident" id="4433394">dec</span><span class="op" id="4433397">.</span><span class="ident" id="4433398">typeString</span><span class="op" id="4433408">(</span><span class="ident" id="4433409">remoteId</span><span class="op" id="4433417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4433421">//&nbsp;Common&nbsp;confusing&nbsp;case:&nbsp;local&nbsp;interface&nbsp;type,&nbsp;remote&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433493">if</span>&nbsp;<span class="ident" id="4433496">ut</span><span class="op" id="4433498">.</span><span class="ident" id="4433499">base</span><span class="op" id="4433503">.</span><span class="ident" id="4433504">Kind</span><span class="op" id="4433508">(</span><span class="op" id="4433509">)</span>&nbsp;<span class="op" id="4433511">==</span>&nbsp;<span class="ident" id="4433514">reflect</span><span class="op" id="4433521">.</span><span class="ident" id="4433522">Interface</span>&nbsp;<span class="op" id="4433532">&amp;&amp;</span>&nbsp;<span class="ident" id="4433535">remoteId</span>&nbsp;<span class="op" id="4433544">!=</span>&nbsp;<span class="ident" id="4433547">tInterface</span>&nbsp;<span class="op" id="4433558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433563">return</span>&nbsp;<span class="ident" id="4433570">nil</span><span class="op" id="4433573">,</span>&nbsp;<span class="ident" id="4433575">errors</span><span class="op" id="4433581">.</span><span class="ident" id="4433582">New</span><span class="op" id="4433585">(</span><span class="string" id="4433586">&#34;gob:&nbsp;local&nbsp;interface&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4433615">+</span>&nbsp;<span class="ident" id="4433617">name</span>&nbsp;<span class="op" id="4433622">+</span>&nbsp;<span class="string" id="4433624">&#34;&nbsp;can&nbsp;only&nbsp;be&nbsp;decoded&nbsp;from&nbsp;remote&nbsp;interface&nbsp;type;&nbsp;received&nbsp;concrete&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4433699">+</span>&nbsp;<span class="ident" id="4433701">remoteType</span><span class="op" id="4433711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4433719">return</span>&nbsp;<span class="ident" id="4433726">nil</span><span class="op" id="4433729">,</span>&nbsp;<span class="ident" id="4433731">errors</span><span class="op" id="4433737">.</span><span class="ident" id="4433738">New</span><span class="op" id="4433741">(</span><span class="string" id="4433742">&#34;gob:&nbsp;decoding&nbsp;into&nbsp;local&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4433775">+</span>&nbsp;<span class="ident" id="4433777">name</span>&nbsp;<span class="op" id="4433782">+</span>&nbsp;<span class="string" id="4433784">&#34;,&nbsp;received&nbsp;remote&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4433810">+</span>&nbsp;<span class="ident" id="4433812">remoteType</span><span class="op" id="4433822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4433825">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433828">op</span>&nbsp;<span class="op" id="4433831">:=</span>&nbsp;<span class="ident" id="4433834">dec</span><span class="op" id="4433837">.</span><span class="ident" id="4433838">decOpFor</span><span class="op" id="4433846">(</span><span class="ident" id="4433847">remoteId</span><span class="op" id="4433855">,</span>&nbsp;<span class="ident" id="4433857">rt</span><span class="op" id="4433859">,</span>&nbsp;<span class="ident" id="4433861">name</span><span class="op" id="4433865">,</span>&nbsp;<span class="builtinfunc" id="4433867">make</span><span class="op" id="4433871">(</span><span class="keyword" id="4433872">map</span><span class="op" id="4433875">[</span><span class="ident" id="4433876">reflect</span><span class="op" id="4433883">.</span><span class="ident" id="4433884">Type</span><span class="op" id="4433888">]</span><span class="op" id="4433889">*</span><span class="ident" id="4433890">decOp</span><span class="op" id="4433895">)</span><span class="op" id="4433896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433899">ovfl</span>&nbsp;<span class="op" id="4433904">:=</span>&nbsp;<span class="ident" id="4433907">errors</span><span class="op" id="4433913">.</span><span class="ident" id="4433914">New</span><span class="op" id="4433917">(</span><span class="string" id="4433918">`value&nbsp;for&nbsp;&#34;`</span>&nbsp;<span class="op" id="4433932">+</span>&nbsp;<span class="ident" id="4433934">name</span>&nbsp;<span class="op" id="4433939">+</span>&nbsp;<span class="string" id="4433941">`&#34;&nbsp;out&nbsp;of&nbsp;range`</span><span class="op" id="4433957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4433960">engine</span><span class="op" id="4433966">.</span><span class="ident" id="4433967">instr</span><span class="op" id="4433972">[</span><span class="ident" id="4433973">singletonField</span><span class="op" id="4433987">]</span>&nbsp;<span class="op" id="4433989">=</span>&nbsp;<span class="ident" id="4433991">decInstr</span><span class="op" id="4433999">{</span><span class="op" id="4434000">*</span><span class="ident" id="4434001">op</span><span class="op" id="4434003">,</span>&nbsp;<span class="ident" id="4434005">singletonField</span><span class="op" id="4434019">,</span>&nbsp;<span class="ident" id="4434021">nil</span><span class="op" id="4434024">,</span>&nbsp;<span class="ident" id="4434026">ovfl</span><span class="op" id="4434030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434033">engine</span><span class="op" id="4434039">.</span><span class="ident" id="4434040">numInstr</span>&nbsp;<span class="op" id="4434049">=</span>&nbsp;<span class="num" id="4434051">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434054">return</span><br>
<span class="lineno">1030</span><span class="op" id="4434061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4434064">//&nbsp;compileIgnoreSingle&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;non-struct&nbsp;top-level&nbsp;value&nbsp;that&nbsp;will&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4434172">func</span>&nbsp;<span class="op" id="4434177">(</span><span class="ident" id="4434178">dec</span>&nbsp;<span class="op" id="4434182">*</span><span class="ident" id="4434183">Decoder</span><span class="op" id="4434190">)</span>&nbsp;<span class="ident" id="4434192">compileIgnoreSingle</span><span class="op" id="4434211">(</span><span class="ident" id="4434212">remoteId</span>&nbsp;<span class="ident" id="4434221">typeId</span><span class="op" id="4434227">)</span>&nbsp;<span class="op" id="4434229">(</span><span class="ident" id="4434230">engine</span>&nbsp;<span class="op" id="4434237">*</span><span class="ident" id="4434238">decEngine</span><span class="op" id="4434247">,</span>&nbsp;<span class="ident" id="4434249">err</span>&nbsp;<span class="builtintype" id="4434253">error</span><span class="op" id="4434258">)</span>&nbsp;<span class="op" id="4434260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434263">engine</span>&nbsp;<span class="op" id="4434270">=</span>&nbsp;<span class="builtinfunc" id="4434272">new</span><span class="op" id="4434275">(</span><span class="ident" id="4434276">decEngine</span><span class="op" id="4434285">)</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434288">engine</span><span class="op" id="4434294">.</span><span class="ident" id="4434295">instr</span>&nbsp;<span class="op" id="4434301">=</span>&nbsp;<span class="builtinfunc" id="4434303">make</span><span class="op" id="4434307">(</span><span class="op" id="4434308">[</span><span class="op" id="4434309">]</span><span class="ident" id="4434310">decInstr</span><span class="op" id="4434318">,</span>&nbsp;<span class="num" id="4434320">1</span><span class="op" id="4434321">)</span>&nbsp;<span class="comment" id="4434323">//&nbsp;one&nbsp;item</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434336">op</span>&nbsp;<span class="op" id="4434339">:=</span>&nbsp;<span class="ident" id="4434342">dec</span><span class="op" id="4434345">.</span><span class="ident" id="4434346">decIgnoreOpFor</span><span class="op" id="4434360">(</span><span class="ident" id="4434361">remoteId</span><span class="op" id="4434369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434372">ovfl</span>&nbsp;<span class="op" id="4434377">:=</span>&nbsp;<span class="ident" id="4434380">overflow</span><span class="op" id="4434388">(</span><span class="ident" id="4434389">dec</span><span class="op" id="4434392">.</span><span class="ident" id="4434393">typeString</span><span class="op" id="4434403">(</span><span class="ident" id="4434404">remoteId</span><span class="op" id="4434412">)</span><span class="op" id="4434413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434416">engine</span><span class="op" id="4434422">.</span><span class="ident" id="4434423">instr</span><span class="op" id="4434428">[</span><span class="num" id="4434429">0</span><span class="op" id="4434430">]</span>&nbsp;<span class="op" id="4434432">=</span>&nbsp;<span class="ident" id="4434434">decInstr</span><span class="op" id="4434442">{</span><span class="ident" id="4434443">op</span><span class="op" id="4434445">,</span>&nbsp;<span class="num" id="4434447">0</span><span class="op" id="4434448">,</span>&nbsp;<span class="ident" id="4434450">nil</span><span class="op" id="4434453">,</span>&nbsp;<span class="ident" id="4434455">ovfl</span><span class="op" id="4434459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434462">engine</span><span class="op" id="4434468">.</span><span class="ident" id="4434469">numInstr</span>&nbsp;<span class="op" id="4434478">=</span>&nbsp;<span class="num" id="4434480">1</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434483">return</span><br>
<span class="lineno"></span><span class="op" id="4434490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4434493">//&nbsp;compileDec&nbsp;compiles&nbsp;the&nbsp;decoder&nbsp;engine&nbsp;for&nbsp;a&nbsp;value.&nbsp;&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;not&nbsp;a&nbsp;struct,</span><br>
<span class="lineno"></span><span class="comment" id="4434579">//&nbsp;it&nbsp;calls&nbsp;out&nbsp;to&nbsp;compileSingle.</span><br>
<span class="lineno">1045</span><span class="keyword" id="4434613">func</span>&nbsp;<span class="op" id="4434618">(</span><span class="ident" id="4434619">dec</span>&nbsp;<span class="op" id="4434623">*</span><span class="ident" id="4434624">Decoder</span><span class="op" id="4434631">)</span>&nbsp;<span class="ident" id="4434633">compileDec</span><span class="op" id="4434643">(</span><span class="ident" id="4434644">remoteId</span>&nbsp;<span class="ident" id="4434653">typeId</span><span class="op" id="4434659">,</span>&nbsp;<span class="ident" id="4434661">ut</span>&nbsp;<span class="op" id="4434664">*</span><span class="ident" id="4434665">userTypeInfo</span><span class="op" id="4434677">)</span>&nbsp;<span class="op" id="4434679">(</span><span class="ident" id="4434680">engine</span>&nbsp;<span class="op" id="4434687">*</span><span class="ident" id="4434688">decEngine</span><span class="op" id="4434697">,</span>&nbsp;<span class="ident" id="4434699">err</span>&nbsp;<span class="builtintype" id="4434703">error</span><span class="op" id="4434708">)</span>&nbsp;<span class="op" id="4434710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434713">rt</span>&nbsp;<span class="op" id="4434716">:=</span>&nbsp;<span class="ident" id="4434719">ut</span><span class="op" id="4434721">.</span><span class="ident" id="4434722">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4434728">srt</span>&nbsp;<span class="op" id="4434732">:=</span>&nbsp;<span class="ident" id="4434735">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434739">if</span>&nbsp;<span class="ident" id="4434742">srt</span><span class="op" id="4434745">.</span><span class="ident" id="4434746">Kind</span><span class="op" id="4434750">(</span><span class="op" id="4434751">)</span>&nbsp;<span class="op" id="4434753">!=</span>&nbsp;<span class="ident" id="4434756">reflect</span><span class="op" id="4434763">.</span><span class="ident" id="4434764">Struct</span>&nbsp;<span class="op" id="4434771">||</span>&nbsp;<span class="ident" id="4434774">ut</span><span class="op" id="4434776">.</span><span class="ident" id="4434777">externalDec</span>&nbsp;<span class="op" id="4434789">!=</span>&nbsp;<span class="num" id="4434792">0</span>&nbsp;<span class="op" id="4434794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434798">return</span>&nbsp;<span class="ident" id="4434805">dec</span><span class="op" id="4434808">.</span><span class="ident" id="4434809">compileSingle</span><span class="op" id="4434822">(</span><span class="ident" id="4434823">remoteId</span><span class="op" id="4434831">,</span>&nbsp;<span class="ident" id="4434833">ut</span><span class="op" id="4434835">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4434838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4434841">var</span>&nbsp;<span class="ident" id="4434845">wireStruct</span>&nbsp;<span class="op" id="4434856">*</span><span class="ident" id="4434857">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434869">//&nbsp;Builtin&nbsp;types&nbsp;can&nbsp;come&nbsp;from&nbsp;global&nbsp;pool;&nbsp;the&nbsp;rest&nbsp;must&nbsp;be&nbsp;defined&nbsp;by&nbsp;the&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4434955">//&nbsp;Also&nbsp;we&nbsp;know&nbsp;we&#39;re&nbsp;decoding&nbsp;a&nbsp;struct&nbsp;now,&nbsp;so&nbsp;the&nbsp;client&nbsp;must&nbsp;have&nbsp;sent&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435035">if</span>&nbsp;<span class="ident" id="4435038">t</span><span class="op" id="4435039">,</span>&nbsp;<span class="ident" id="4435041">ok</span>&nbsp;<span class="op" id="4435044">:=</span>&nbsp;<span class="ident" id="4435047">builtinIdToType</span><span class="op" id="4435062">[</span><span class="ident" id="4435063">remoteId</span><span class="op" id="4435071">]</span><span class="op" id="4435072">;</span>&nbsp;<span class="ident" id="4435074">ok</span>&nbsp;<span class="op" id="4435077">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435081">wireStruct</span><span class="op" id="4435091">,</span>&nbsp;<span class="ident" id="4435093">_</span>&nbsp;<span class="op" id="4435095">=</span>&nbsp;<span class="ident" id="4435097">t</span><span class="op" id="4435098">.</span><span class="op" id="4435099">(</span><span class="op" id="4435100">*</span><span class="ident" id="4435101">structType</span><span class="op" id="4435111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435114">}</span>&nbsp;<span class="keyword" id="4435116">else</span>&nbsp;<span class="op" id="4435121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435125">wire</span>&nbsp;<span class="op" id="4435130">:=</span>&nbsp;<span class="ident" id="4435133">dec</span><span class="op" id="4435136">.</span><span class="ident" id="4435137">wireType</span><span class="op" id="4435145">[</span><span class="ident" id="4435146">remoteId</span><span class="op" id="4435154">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435158">if</span>&nbsp;<span class="ident" id="4435161">wire</span>&nbsp;<span class="op" id="4435166">==</span>&nbsp;<span class="ident" id="4435169">nil</span>&nbsp;<span class="op" id="4435173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435178">error_</span><span class="op" id="4435184">(</span><span class="ident" id="4435185">errBadType</span><span class="op" id="4435195">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435203">wireStruct</span>&nbsp;<span class="op" id="4435214">=</span>&nbsp;<span class="ident" id="4435216">wire</span><span class="op" id="4435220">.</span><span class="ident" id="4435221">StructT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435233">if</span>&nbsp;<span class="ident" id="4435236">wireStruct</span>&nbsp;<span class="op" id="4435247">==</span>&nbsp;<span class="ident" id="4435250">nil</span>&nbsp;<span class="op" id="4435254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435258">errorf</span><span class="op" id="4435264">(</span><span class="string" id="4435265">&#34;type&nbsp;mismatch&nbsp;in&nbsp;decoder:&nbsp;want&nbsp;struct&nbsp;type&nbsp;%s;&nbsp;got&nbsp;non-struct&#34;</span><span class="op" id="4435328">,</span>&nbsp;<span class="ident" id="4435330">rt</span><span class="op" id="4435332">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435338">engine</span>&nbsp;<span class="op" id="4435345">=</span>&nbsp;<span class="builtinfunc" id="4435347">new</span><span class="op" id="4435350">(</span><span class="ident" id="4435351">decEngine</span><span class="op" id="4435360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435363">engine</span><span class="op" id="4435369">.</span><span class="ident" id="4435370">instr</span>&nbsp;<span class="op" id="4435376">=</span>&nbsp;<span class="builtinfunc" id="4435378">make</span><span class="op" id="4435382">(</span><span class="op" id="4435383">[</span><span class="op" id="4435384">]</span><span class="ident" id="4435385">decInstr</span><span class="op" id="4435393">,</span>&nbsp;<span class="builtinfunc" id="4435395">len</span><span class="op" id="4435398">(</span><span class="ident" id="4435399">wireStruct</span><span class="op" id="4435409">.</span><span class="ident" id="4435410">Field</span><span class="op" id="4435415">)</span><span class="op" id="4435416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435419">seen</span>&nbsp;<span class="op" id="4435424">:=</span>&nbsp;<span class="builtinfunc" id="4435427">make</span><span class="op" id="4435431">(</span><span class="keyword" id="4435432">map</span><span class="op" id="4435435">[</span><span class="ident" id="4435436">reflect</span><span class="op" id="4435443">.</span><span class="ident" id="4435444">Type</span><span class="op" id="4435448">]</span><span class="op" id="4435449">*</span><span class="ident" id="4435450">decOp</span><span class="op" id="4435455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435458">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;wire&nbsp;type.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435501">for</span>&nbsp;<span class="ident" id="4435505">fieldnum</span>&nbsp;<span class="op" id="4435514">:=</span>&nbsp;<span class="num" id="4435517">0</span><span class="op" id="4435518">;</span>&nbsp;<span class="ident" id="4435520">fieldnum</span>&nbsp;<span class="op" id="4435529">&lt;</span>&nbsp;<span class="builtinfunc" id="4435531">len</span><span class="op" id="4435534">(</span><span class="ident" id="4435535">wireStruct</span><span class="op" id="4435545">.</span><span class="ident" id="4435546">Field</span><span class="op" id="4435551">)</span><span class="op" id="4435552">;</span>&nbsp;<span class="ident" id="4435554">fieldnum</span><span class="op" id="4435562">++</span>&nbsp;<span class="op" id="4435565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435569">wireField</span>&nbsp;<span class="op" id="4435579">:=</span>&nbsp;<span class="ident" id="4435582">wireStruct</span><span class="op" id="4435592">.</span><span class="ident" id="4435593">Field</span><span class="op" id="4435598">[</span><span class="ident" id="4435599">fieldnum</span><span class="op" id="4435607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435611">if</span>&nbsp;<span class="ident" id="4435614">wireField</span><span class="op" id="4435623">.</span><span class="ident" id="4435624">Name</span>&nbsp;<span class="op" id="4435629">==</span>&nbsp;<span class="string" id="4435632">&#34;&#34;</span>&nbsp;<span class="op" id="4435635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435640">errorf</span><span class="op" id="4435646">(</span><span class="string" id="4435647">&#34;empty&nbsp;name&nbsp;for&nbsp;remote&nbsp;field&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="4435687">,</span>&nbsp;<span class="ident" id="4435689">wireStruct</span><span class="op" id="4435699">.</span><span class="ident" id="4435700">Name</span><span class="op" id="4435704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4435708">}</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435712">ovfl</span>&nbsp;<span class="op" id="4435717">:=</span>&nbsp;<span class="ident" id="4435720">overflow</span><span class="op" id="4435728">(</span><span class="ident" id="4435729">wireField</span><span class="op" id="4435738">.</span><span class="ident" id="4435739">Name</span><span class="op" id="4435743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435747">//&nbsp;Find&nbsp;the&nbsp;field&nbsp;of&nbsp;the&nbsp;local&nbsp;type&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435805">localField</span><span class="op" id="4435815">,</span>&nbsp;<span class="ident" id="4435817">present</span>&nbsp;<span class="op" id="4435825">:=</span>&nbsp;<span class="ident" id="4435828">srt</span><span class="op" id="4435831">.</span><span class="ident" id="4435832">FieldByName</span><span class="op" id="4435843">(</span><span class="ident" id="4435844">wireField</span><span class="op" id="4435853">.</span><span class="ident" id="4435854">Name</span><span class="op" id="4435858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4435862">//&nbsp;TODO(r):&nbsp;anonymous&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4435892">if</span>&nbsp;<span class="op" id="4435895">!</span><span class="ident" id="4435896">present</span>&nbsp;<span class="op" id="4435904">||</span>&nbsp;<span class="op" id="4435907">!</span><span class="ident" id="4435908">isExported</span><span class="op" id="4435918">(</span><span class="ident" id="4435919">wireField</span><span class="op" id="4435928">.</span><span class="ident" id="4435929">Name</span><span class="op" id="4435933">)</span>&nbsp;<span class="op" id="4435935">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435940">op</span>&nbsp;<span class="op" id="4435943">:=</span>&nbsp;<span class="ident" id="4435946">dec</span><span class="op" id="4435949">.</span><span class="ident" id="4435950">decIgnoreOpFor</span><span class="op" id="4435964">(</span><span class="ident" id="4435965">wireField</span><span class="op" id="4435974">.</span><span class="ident" id="4435975">Id</span><span class="op" id="4435977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4435982">engine</span><span class="op" id="4435988">.</span><span class="ident" id="4435989">instr</span><span class="op" id="4435994">[</span><span class="ident" id="4435995">fieldnum</span><span class="op" id="4436003">]</span>&nbsp;<span class="op" id="4436005">=</span>&nbsp;<span class="ident" id="4436007">decInstr</span><span class="op" id="4436015">{</span><span class="ident" id="4436016">op</span><span class="op" id="4436018">,</span>&nbsp;<span class="ident" id="4436020">fieldnum</span><span class="op" id="4436028">,</span>&nbsp;<span class="ident" id="4436030">nil</span><span class="op" id="4436033">,</span>&nbsp;<span class="ident" id="4436035">ovfl</span><span class="op" id="4436039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436044">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436059">if</span>&nbsp;<span class="op" id="4436062">!</span><span class="ident" id="4436063">dec</span><span class="op" id="4436066">.</span><span class="ident" id="4436067">compatibleType</span><span class="op" id="4436081">(</span><span class="ident" id="4436082">localField</span><span class="op" id="4436092">.</span><span class="ident" id="4436093">Type</span><span class="op" id="4436097">,</span>&nbsp;<span class="ident" id="4436099">wireField</span><span class="op" id="4436108">.</span><span class="ident" id="4436109">Id</span><span class="op" id="4436111">,</span>&nbsp;<span class="builtinfunc" id="4436113">make</span><span class="op" id="4436117">(</span><span class="keyword" id="4436118">map</span><span class="op" id="4436121">[</span><span class="ident" id="4436122">reflect</span><span class="op" id="4436129">.</span><span class="ident" id="4436130">Type</span><span class="op" id="4436134">]</span><span class="ident" id="4436135">typeId</span><span class="op" id="4436141">)</span><span class="op" id="4436142">)</span>&nbsp;<span class="op" id="4436144">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436149">errorf</span><span class="op" id="4436155">(</span><span class="string" id="4436156">&#34;wrong&nbsp;type&nbsp;(%s)&nbsp;for&nbsp;received&nbsp;field&nbsp;%s.%s&#34;</span><span class="op" id="4436198">,</span>&nbsp;<span class="ident" id="4436200">localField</span><span class="op" id="4436210">.</span><span class="ident" id="4436211">Type</span><span class="op" id="4436215">,</span>&nbsp;<span class="ident" id="4436217">wireStruct</span><span class="op" id="4436227">.</span><span class="ident" id="4436228">Name</span><span class="op" id="4436232">,</span>&nbsp;<span class="ident" id="4436234">wireField</span><span class="op" id="4436243">.</span><span class="ident" id="4436244">Name</span><span class="op" id="4436248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436256">op</span>&nbsp;<span class="op" id="4436259">:=</span>&nbsp;<span class="ident" id="4436262">dec</span><span class="op" id="4436265">.</span><span class="ident" id="4436266">decOpFor</span><span class="op" id="4436274">(</span><span class="ident" id="4436275">wireField</span><span class="op" id="4436284">.</span><span class="ident" id="4436285">Id</span><span class="op" id="4436287">,</span>&nbsp;<span class="ident" id="4436289">localField</span><span class="op" id="4436299">.</span><span class="ident" id="4436300">Type</span><span class="op" id="4436304">,</span>&nbsp;<span class="ident" id="4436306">localField</span><span class="op" id="4436316">.</span><span class="ident" id="4436317">Name</span><span class="op" id="4436321">,</span>&nbsp;<span class="ident" id="4436323">seen</span><span class="op" id="4436327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436331">engine</span><span class="op" id="4436337">.</span><span class="ident" id="4436338">instr</span><span class="op" id="4436343">[</span><span class="ident" id="4436344">fieldnum</span><span class="op" id="4436352">]</span>&nbsp;<span class="op" id="4436354">=</span>&nbsp;<span class="ident" id="4436356">decInstr</span><span class="op" id="4436364">{</span><span class="op" id="4436365">*</span><span class="ident" id="4436366">op</span><span class="op" id="4436368">,</span>&nbsp;<span class="ident" id="4436370">fieldnum</span><span class="op" id="4436378">,</span>&nbsp;<span class="ident" id="4436380">localField</span><span class="op" id="4436390">.</span><span class="ident" id="4436391">Index</span><span class="op" id="4436396">,</span>&nbsp;<span class="ident" id="4436398">ovfl</span><span class="op" id="4436402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436406">engine</span><span class="op" id="4436412">.</span><span class="ident" id="4436413">numInstr</span><span class="op" id="4436421">++</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436428">return</span><br>
<span class="lineno"></span><span class="op" id="4436435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4436438">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type.</span><br>
<span class="lineno">1095</span><span class="keyword" id="4436500">func</span>&nbsp;<span class="op" id="4436505">(</span><span class="ident" id="4436506">dec</span>&nbsp;<span class="op" id="4436510">*</span><span class="ident" id="4436511">Decoder</span><span class="op" id="4436518">)</span>&nbsp;<span class="ident" id="4436520">getDecEnginePtr</span><span class="op" id="4436535">(</span><span class="ident" id="4436536">remoteId</span>&nbsp;<span class="ident" id="4436545">typeId</span><span class="op" id="4436551">,</span>&nbsp;<span class="ident" id="4436553">ut</span>&nbsp;<span class="op" id="4436556">*</span><span class="ident" id="4436557">userTypeInfo</span><span class="op" id="4436569">)</span>&nbsp;<span class="op" id="4436571">(</span><span class="ident" id="4436572">enginePtr</span>&nbsp;<span class="op" id="4436582">*</span><span class="op" id="4436583">*</span><span class="ident" id="4436584">decEngine</span><span class="op" id="4436593">,</span>&nbsp;<span class="ident" id="4436595">err</span>&nbsp;<span class="builtintype" id="4436599">error</span><span class="op" id="4436604">)</span>&nbsp;<span class="op" id="4436606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436609">rt</span>&nbsp;<span class="op" id="4436612">:=</span>&nbsp;<span class="ident" id="4436615">ut</span><span class="op" id="4436617">.</span><span class="ident" id="4436618">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436624">decoderMap</span><span class="op" id="4436634">,</span>&nbsp;<span class="ident" id="4436636">ok</span>&nbsp;<span class="op" id="4436639">:=</span>&nbsp;<span class="ident" id="4436642">dec</span><span class="op" id="4436645">.</span><span class="ident" id="4436646">decoderCache</span><span class="op" id="4436658">[</span><span class="ident" id="4436659">rt</span><span class="op" id="4436661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436664">if</span>&nbsp;<span class="op" id="4436667">!</span><span class="ident" id="4436668">ok</span>&nbsp;<span class="op" id="4436671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436675">decoderMap</span>&nbsp;<span class="op" id="4436686">=</span>&nbsp;<span class="builtinfunc" id="4436688">make</span><span class="op" id="4436692">(</span><span class="keyword" id="4436693">map</span><span class="op" id="4436696">[</span><span class="ident" id="4436697">typeId</span><span class="op" id="4436703">]</span><span class="op" id="4436704">*</span><span class="op" id="4436705">*</span><span class="ident" id="4436706">decEngine</span><span class="op" id="4436715">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436719">dec</span><span class="op" id="4436722">.</span><span class="ident" id="4436723">decoderCache</span><span class="op" id="4436735">[</span><span class="ident" id="4436736">rt</span><span class="op" id="4436738">]</span>&nbsp;<span class="op" id="4436740">=</span>&nbsp;<span class="ident" id="4436742">decoderMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436757">if</span>&nbsp;<span class="ident" id="4436760">enginePtr</span><span class="op" id="4436769">,</span>&nbsp;<span class="ident" id="4436771">ok</span>&nbsp;<span class="op" id="4436774">=</span>&nbsp;<span class="ident" id="4436776">decoderMap</span><span class="op" id="4436786">[</span><span class="ident" id="4436787">remoteId</span><span class="op" id="4436795">]</span><span class="op" id="4436796">;</span>&nbsp;<span class="op" id="4436798">!</span><span class="ident" id="4436799">ok</span>&nbsp;<span class="op" id="4436802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4436806">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436885">enginePtr</span>&nbsp;<span class="op" id="4436895">=</span>&nbsp;<span class="builtinfunc" id="4436897">new</span><span class="op" id="4436900">(</span><span class="op" id="4436901">*</span><span class="ident" id="4436902">decEngine</span><span class="op" id="4436911">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4436915">decoderMap</span><span class="op" id="4436925">[</span><span class="ident" id="4436926">remoteId</span><span class="op" id="4436934">]</span>&nbsp;<span class="op" id="4436936">=</span>&nbsp;<span class="ident" id="4436938">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4436950">*</span><span class="ident" id="4436951">enginePtr</span><span class="op" id="4436960">,</span>&nbsp;<span class="ident" id="4436962">err</span>&nbsp;<span class="op" id="4436966">=</span>&nbsp;<span class="ident" id="4436968">dec</span><span class="op" id="4436971">.</span><span class="ident" id="4436972">compileDec</span><span class="op" id="4436982">(</span><span class="ident" id="4436983">remoteId</span><span class="op" id="4436991">,</span>&nbsp;<span class="ident" id="4436993">ut</span><span class="op" id="4436995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4436999">if</span>&nbsp;<span class="ident" id="4437002">err</span>&nbsp;<span class="op" id="4437006">!=</span>&nbsp;<span class="ident" id="4437009">nil</span>&nbsp;<span class="op" id="4437013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4437018">delete</span><span class="op" id="4437024">(</span><span class="ident" id="4437025">decoderMap</span><span class="op" id="4437035">,</span>&nbsp;<span class="ident" id="4437037">remoteId</span><span class="op" id="4437045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437049">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437055">return</span><br>
<span class="lineno"></span><span class="op" id="4437062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437065">//&nbsp;emptyStruct&nbsp;is&nbsp;the&nbsp;type&nbsp;we&nbsp;compile&nbsp;into&nbsp;when&nbsp;ignoring&nbsp;a&nbsp;struct&nbsp;value.</span><br>
<span class="lineno">1115</span><span class="keyword" id="4437138">type</span>&nbsp;<span class="ident" id="4437143">emptyStruct</span>&nbsp;<span class="keyword" id="4437155">struct</span><span class="op" id="4437161">{</span><span class="op" id="4437162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4437165">var</span>&nbsp;<span class="ident" id="4437169">emptyStructType</span>&nbsp;<span class="op" id="4437185">=</span>&nbsp;<span class="ident" id="4437187">reflect</span><span class="op" id="4437194">.</span><span class="ident" id="4437195">TypeOf</span><span class="op" id="4437201">(</span><span class="ident" id="4437202">emptyStruct</span><span class="op" id="4437213">{</span><span class="op" id="4437214">}</span><span class="op" id="4437215">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437218">//&nbsp;getDecEnginePtr&nbsp;returns&nbsp;the&nbsp;engine&nbsp;for&nbsp;the&nbsp;specified&nbsp;type&nbsp;when&nbsp;the&nbsp;value&nbsp;is&nbsp;to&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno">1120</span><span class="keyword" id="4437314">func</span>&nbsp;<span class="op" id="4437319">(</span><span class="ident" id="4437320">dec</span>&nbsp;<span class="op" id="4437324">*</span><span class="ident" id="4437325">Decoder</span><span class="op" id="4437332">)</span>&nbsp;<span class="ident" id="4437334">getIgnoreEnginePtr</span><span class="op" id="4437352">(</span><span class="ident" id="4437353">wireId</span>&nbsp;<span class="ident" id="4437360">typeId</span><span class="op" id="4437366">)</span>&nbsp;<span class="op" id="4437368">(</span><span class="ident" id="4437369">enginePtr</span>&nbsp;<span class="op" id="4437379">*</span><span class="op" id="4437380">*</span><span class="ident" id="4437381">decEngine</span><span class="op" id="4437390">,</span>&nbsp;<span class="ident" id="4437392">err</span>&nbsp;<span class="builtintype" id="4437396">error</span><span class="op" id="4437401">)</span>&nbsp;<span class="op" id="4437403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437406">var</span>&nbsp;<span class="ident" id="4437410">ok</span>&nbsp;<span class="builtintype" id="4437413">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437419">if</span>&nbsp;<span class="ident" id="4437422">enginePtr</span><span class="op" id="4437431">,</span>&nbsp;<span class="ident" id="4437433">ok</span>&nbsp;<span class="op" id="4437436">=</span>&nbsp;<span class="ident" id="4437438">dec</span><span class="op" id="4437441">.</span><span class="ident" id="4437442">ignorerCache</span><span class="op" id="4437454">[</span><span class="ident" id="4437455">wireId</span><span class="op" id="4437461">]</span><span class="op" id="4437462">;</span>&nbsp;<span class="op" id="4437464">!</span><span class="ident" id="4437465">ok</span>&nbsp;<span class="op" id="4437468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4437472">//&nbsp;To&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;mark&nbsp;this&nbsp;engine&nbsp;as&nbsp;underway&nbsp;before&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437551">enginePtr</span>&nbsp;<span class="op" id="4437561">=</span>&nbsp;<span class="builtinfunc" id="4437563">new</span><span class="op" id="4437566">(</span><span class="op" id="4437567">*</span><span class="ident" id="4437568">decEngine</span><span class="op" id="4437577">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437581">dec</span><span class="op" id="4437584">.</span><span class="ident" id="4437585">ignorerCache</span><span class="op" id="4437597">[</span><span class="ident" id="4437598">wireId</span><span class="op" id="4437604">]</span>&nbsp;<span class="op" id="4437606">=</span>&nbsp;<span class="ident" id="4437608">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4437620">wire</span>&nbsp;<span class="op" id="4437625">:=</span>&nbsp;<span class="ident" id="4437628">dec</span><span class="op" id="4437631">.</span><span class="ident" id="4437632">wireType</span><span class="op" id="4437640">[</span><span class="ident" id="4437641">wireId</span><span class="op" id="4437647">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437651">if</span>&nbsp;<span class="ident" id="4437654">wire</span>&nbsp;<span class="op" id="4437659">!=</span>&nbsp;<span class="ident" id="4437662">nil</span>&nbsp;<span class="op" id="4437666">&amp;&amp;</span>&nbsp;<span class="ident" id="4437669">wire</span><span class="op" id="4437673">.</span><span class="ident" id="4437674">StructT</span>&nbsp;<span class="op" id="4437682">!=</span>&nbsp;<span class="ident" id="4437685">nil</span>&nbsp;<span class="op" id="4437689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437694">*</span><span class="ident" id="4437695">enginePtr</span><span class="op" id="4437704">,</span>&nbsp;<span class="ident" id="4437706">err</span>&nbsp;<span class="op" id="4437710">=</span>&nbsp;<span class="ident" id="4437712">dec</span><span class="op" id="4437715">.</span><span class="ident" id="4437716">compileDec</span><span class="op" id="4437726">(</span><span class="ident" id="4437727">wireId</span><span class="op" id="4437733">,</span>&nbsp;<span class="ident" id="4437735">userType</span><span class="op" id="4437743">(</span><span class="ident" id="4437744">emptyStructType</span><span class="op" id="4437759">)</span><span class="op" id="4437760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437764">}</span>&nbsp;<span class="keyword" id="4437766">else</span>&nbsp;<span class="op" id="4437771">{</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437776">*</span><span class="ident" id="4437777">enginePtr</span><span class="op" id="4437786">,</span>&nbsp;<span class="ident" id="4437788">err</span>&nbsp;<span class="op" id="4437792">=</span>&nbsp;<span class="ident" id="4437794">dec</span><span class="op" id="4437797">.</span><span class="ident" id="4437798">compileIgnoreSingle</span><span class="op" id="4437817">(</span><span class="ident" id="4437818">wireId</span><span class="op" id="4437824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437832">if</span>&nbsp;<span class="ident" id="4437835">err</span>&nbsp;<span class="op" id="4437839">!=</span>&nbsp;<span class="ident" id="4437842">nil</span>&nbsp;<span class="op" id="4437846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4437851">delete</span><span class="op" id="4437857">(</span><span class="ident" id="4437858">dec</span><span class="op" id="4437861">.</span><span class="ident" id="4437862">ignorerCache</span><span class="op" id="4437874">,</span>&nbsp;<span class="ident" id="4437876">wireId</span><span class="op" id="4437882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437886">}</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4437889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4437892">return</span><br>
<span class="lineno"></span><span class="op" id="4437899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4437902">//&nbsp;decodeValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;value.</span><br>
<span class="lineno">1140</span><span class="keyword" id="4437986">func</span>&nbsp;<span class="op" id="4437991">(</span><span class="ident" id="4437992">dec</span>&nbsp;<span class="op" id="4437996">*</span><span class="ident" id="4437997">Decoder</span><span class="op" id="4438004">)</span>&nbsp;<span class="ident" id="4438006">decodeValue</span><span class="op" id="4438017">(</span><span class="ident" id="4438018">wireId</span>&nbsp;<span class="ident" id="4438025">typeId</span><span class="op" id="4438031">,</span>&nbsp;<span class="ident" id="4438033">value</span>&nbsp;<span class="ident" id="4438039">reflect</span><span class="op" id="4438046">.</span><span class="ident" id="4438047">Value</span><span class="op" id="4438052">)</span>&nbsp;<span class="op" id="4438054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438057">defer</span>&nbsp;<span class="ident" id="4438063">catchError</span><span class="op" id="4438073">(</span><span class="op" id="4438074">&amp;</span><span class="ident" id="4438075">dec</span><span class="op" id="4438078">.</span><span class="ident" id="4438079">err</span><span class="op" id="4438082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438085">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;nil,&nbsp;it&nbsp;means&nbsp;we&nbsp;should&nbsp;just&nbsp;ignore&nbsp;this&nbsp;item.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438152">if</span>&nbsp;<span class="op" id="4438155">!</span><span class="ident" id="4438156">value</span><span class="op" id="4438161">.</span><span class="ident" id="4438162">IsValid</span><span class="op" id="4438169">(</span><span class="op" id="4438170">)</span>&nbsp;<span class="op" id="4438172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438176">dec</span><span class="op" id="4438179">.</span><span class="ident" id="4438180">decodeIgnoredValue</span><span class="op" id="4438198">(</span><span class="ident" id="4438199">wireId</span><span class="op" id="4438205">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4438220">//&nbsp;Dereference&nbsp;down&nbsp;to&nbsp;the&nbsp;underlying&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438265">ut</span>&nbsp;<span class="op" id="4438268">:=</span>&nbsp;<span class="ident" id="4438271">userType</span><span class="op" id="4438279">(</span><span class="ident" id="4438280">value</span><span class="op" id="4438285">.</span><span class="ident" id="4438286">Type</span><span class="op" id="4438290">(</span><span class="op" id="4438291">)</span><span class="op" id="4438292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438295">base</span>&nbsp;<span class="op" id="4438300">:=</span>&nbsp;<span class="ident" id="4438303">ut</span><span class="op" id="4438305">.</span><span class="ident" id="4438306">base</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438312">var</span>&nbsp;<span class="ident" id="4438316">enginePtr</span>&nbsp;<span class="op" id="4438326">*</span><span class="op" id="4438327">*</span><span class="ident" id="4438328">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438339">enginePtr</span><span class="op" id="4438348">,</span>&nbsp;<span class="ident" id="4438350">dec</span><span class="op" id="4438353">.</span><span class="ident" id="4438354">err</span>&nbsp;<span class="op" id="4438358">=</span>&nbsp;<span class="ident" id="4438360">dec</span><span class="op" id="4438363">.</span><span class="ident" id="4438364">getDecEnginePtr</span><span class="op" id="4438379">(</span><span class="ident" id="4438380">wireId</span><span class="op" id="4438386">,</span>&nbsp;<span class="ident" id="4438388">ut</span><span class="op" id="4438390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438393">if</span>&nbsp;<span class="ident" id="4438396">dec</span><span class="op" id="4438399">.</span><span class="ident" id="4438400">err</span>&nbsp;<span class="op" id="4438404">!=</span>&nbsp;<span class="ident" id="4438407">nil</span>&nbsp;<span class="op" id="4438411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438415">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438423">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438426">value</span>&nbsp;<span class="op" id="4438432">=</span>&nbsp;<span class="ident" id="4438434">decAlloc</span><span class="op" id="4438442">(</span><span class="ident" id="4438443">value</span><span class="op" id="4438448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438451">engine</span>&nbsp;<span class="op" id="4438458">:=</span>&nbsp;<span class="op" id="4438461">*</span><span class="ident" id="4438462">enginePtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438473">if</span>&nbsp;<span class="ident" id="4438476">st</span>&nbsp;<span class="op" id="4438479">:=</span>&nbsp;<span class="ident" id="4438482">base</span><span class="op" id="4438486">;</span>&nbsp;<span class="ident" id="4438488">st</span><span class="op" id="4438490">.</span><span class="ident" id="4438491">Kind</span><span class="op" id="4438495">(</span><span class="op" id="4438496">)</span>&nbsp;<span class="op" id="4438498">==</span>&nbsp;<span class="ident" id="4438501">reflect</span><span class="op" id="4438508">.</span><span class="ident" id="4438509">Struct</span>&nbsp;<span class="op" id="4438516">&amp;&amp;</span>&nbsp;<span class="ident" id="4438519">ut</span><span class="op" id="4438521">.</span><span class="ident" id="4438522">externalDec</span>&nbsp;<span class="op" id="4438534">==</span>&nbsp;<span class="num" id="4438537">0</span>&nbsp;<span class="op" id="4438539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4438543">if</span>&nbsp;<span class="ident" id="4438546">engine</span><span class="op" id="4438552">.</span><span class="ident" id="4438553">numInstr</span>&nbsp;<span class="op" id="4438562">==</span>&nbsp;<span class="num" id="4438565">0</span>&nbsp;<span class="op" id="4438567">&amp;&amp;</span>&nbsp;<span class="ident" id="4438570">st</span><span class="op" id="4438572">.</span><span class="ident" id="4438573">NumField</span><span class="op" id="4438581">(</span><span class="op" id="4438582">)</span>&nbsp;<span class="op" id="4438584">&gt;</span>&nbsp;<span class="num" id="4438586">0</span>&nbsp;<span class="op" id="4438588">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438594">dec</span><span class="op" id="4438597">.</span><span class="ident" id="4438598">wireType</span><span class="op" id="4438606">[</span><span class="ident" id="4438607">wireId</span><span class="op" id="4438613">]</span>&nbsp;<span class="op" id="4438615">!=</span>&nbsp;<span class="ident" id="4438618">nil</span>&nbsp;<span class="op" id="4438622">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4438625">len</span><span class="op" id="4438628">(</span><span class="ident" id="4438629">dec</span><span class="op" id="4438632">.</span><span class="ident" id="4438633">wireType</span><span class="op" id="4438641">[</span><span class="ident" id="4438642">wireId</span><span class="op" id="4438648">]</span><span class="op" id="4438649">.</span><span class="ident" id="4438650">StructT</span><span class="op" id="4438657">.</span><span class="ident" id="4438658">Field</span><span class="op" id="4438663">)</span>&nbsp;<span class="op" id="4438665">&gt;</span>&nbsp;<span class="num" id="4438667">0</span>&nbsp;<span class="op" id="4438669">{</span><br>
<span class="lineno">1160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438674">name</span>&nbsp;<span class="op" id="4438679">:=</span>&nbsp;<span class="ident" id="4438682">base</span><span class="op" id="4438686">.</span><span class="ident" id="4438687">Name</span><span class="op" id="4438691">(</span><span class="op" id="4438692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438697">errorf</span><span class="op" id="4438703">(</span><span class="string" id="4438704">&#34;type&nbsp;mismatch:&nbsp;no&nbsp;fields&nbsp;matched&nbsp;compiling&nbsp;decoder&nbsp;for&nbsp;%s&#34;</span><span class="op" id="4438763">,</span>&nbsp;<span class="ident" id="4438765">name</span><span class="op" id="4438769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438777">dec</span><span class="op" id="4438780">.</span><span class="ident" id="4438781">decodeStruct</span><span class="op" id="4438793">(</span><span class="ident" id="4438794">engine</span><span class="op" id="4438800">,</span>&nbsp;<span class="ident" id="4438802">ut</span><span class="op" id="4438804">,</span>&nbsp;<span class="ident" id="4438806">value</span><span class="op" id="4438811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438814">}</span>&nbsp;<span class="keyword" id="4438816">else</span>&nbsp;<span class="op" id="4438821">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4438825">dec</span><span class="op" id="4438828">.</span><span class="ident" id="4438829">decodeSingle</span><span class="op" id="4438841">(</span><span class="ident" id="4438842">engine</span><span class="op" id="4438848">,</span>&nbsp;<span class="ident" id="4438850">ut</span><span class="op" id="4438852">,</span>&nbsp;<span class="ident" id="4438854">value</span><span class="op" id="4438859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4438862">}</span><br>
<span class="lineno"></span><span class="op" id="4438864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4438867">//&nbsp;decodeIgnoredValue&nbsp;decodes&nbsp;the&nbsp;data&nbsp;stream&nbsp;representing&nbsp;a&nbsp;value&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;and&nbsp;discards&nbsp;it.</span><br>
<span class="lineno">1170</span><span class="keyword" id="4438973">func</span>&nbsp;<span class="op" id="4438978">(</span><span class="ident" id="4438979">dec</span>&nbsp;<span class="op" id="4438983">*</span><span class="ident" id="4438984">Decoder</span><span class="op" id="4438991">)</span>&nbsp;<span class="ident" id="4438993">decodeIgnoredValue</span><span class="op" id="4439011">(</span><span class="ident" id="4439012">wireId</span>&nbsp;<span class="ident" id="4439019">typeId</span><span class="op" id="4439025">)</span>&nbsp;<span class="op" id="4439027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439030">var</span>&nbsp;<span class="ident" id="4439034">enginePtr</span>&nbsp;<span class="op" id="4439044">*</span><span class="op" id="4439045">*</span><span class="ident" id="4439046">decEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439057">enginePtr</span><span class="op" id="4439066">,</span>&nbsp;<span class="ident" id="4439068">dec</span><span class="op" id="4439071">.</span><span class="ident" id="4439072">err</span>&nbsp;<span class="op" id="4439076">=</span>&nbsp;<span class="ident" id="4439078">dec</span><span class="op" id="4439081">.</span><span class="ident" id="4439082">getIgnoreEnginePtr</span><span class="op" id="4439100">(</span><span class="ident" id="4439101">wireId</span><span class="op" id="4439107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439110">if</span>&nbsp;<span class="ident" id="4439113">dec</span><span class="op" id="4439116">.</span><span class="ident" id="4439117">err</span>&nbsp;<span class="op" id="4439121">!=</span>&nbsp;<span class="ident" id="4439124">nil</span>&nbsp;<span class="op" id="4439128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439132">return</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439143">wire</span>&nbsp;<span class="op" id="4439148">:=</span>&nbsp;<span class="ident" id="4439151">dec</span><span class="op" id="4439154">.</span><span class="ident" id="4439155">wireType</span><span class="op" id="4439163">[</span><span class="ident" id="4439164">wireId</span><span class="op" id="4439170">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439173">if</span>&nbsp;<span class="ident" id="4439176">wire</span>&nbsp;<span class="op" id="4439181">!=</span>&nbsp;<span class="ident" id="4439184">nil</span>&nbsp;<span class="op" id="4439188">&amp;&amp;</span>&nbsp;<span class="ident" id="4439191">wire</span><span class="op" id="4439195">.</span><span class="ident" id="4439196">StructT</span>&nbsp;<span class="op" id="4439204">!=</span>&nbsp;<span class="ident" id="4439207">nil</span>&nbsp;<span class="op" id="4439211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439215">dec</span><span class="op" id="4439218">.</span><span class="ident" id="4439219">ignoreStruct</span><span class="op" id="4439231">(</span><span class="op" id="4439232">*</span><span class="ident" id="4439233">enginePtr</span><span class="op" id="4439242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439245">}</span>&nbsp;<span class="keyword" id="4439247">else</span>&nbsp;<span class="op" id="4439252">{</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439256">dec</span><span class="op" id="4439259">.</span><span class="ident" id="4439260">ignoreSingle</span><span class="op" id="4439272">(</span><span class="op" id="4439273">*</span><span class="ident" id="4439274">enginePtr</span><span class="op" id="4439283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439286">}</span><br>
<span class="lineno"></span><span class="op" id="4439288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4439291">func</span>&nbsp;<span class="ident" id="4439296">init</span><span class="op" id="4439300">(</span><span class="op" id="4439301">)</span>&nbsp;<span class="op" id="4439303">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439306">var</span>&nbsp;<span class="ident" id="4439310">iop</span><span class="op" id="4439313">,</span>&nbsp;<span class="ident" id="4439315">uop</span>&nbsp;<span class="ident" id="4439319">decOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439326">switch</span>&nbsp;<span class="ident" id="4439333">reflect</span><span class="op" id="4439340">.</span><span class="ident" id="4439341">TypeOf</span><span class="op" id="4439347">(</span><span class="builtintype" id="4439348">int</span><span class="op" id="4439351">(</span><span class="num" id="4439352">0</span><span class="op" id="4439353">)</span><span class="op" id="4439354">)</span><span class="op" id="4439355">.</span><span class="ident" id="4439356">Bits</span><span class="op" id="4439360">(</span><span class="op" id="4439361">)</span>&nbsp;<span class="op" id="4439363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439366">case</span>&nbsp;<span class="num" id="4439371">32</span><span class="op" id="4439373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439377">iop</span>&nbsp;<span class="op" id="4439381">=</span>&nbsp;<span class="ident" id="4439383">decInt32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439394">uop</span>&nbsp;<span class="op" id="4439398">=</span>&nbsp;<span class="ident" id="4439400">decUint32</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439411">case</span>&nbsp;<span class="num" id="4439416">64</span><span class="op" id="4439418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439422">iop</span>&nbsp;<span class="op" id="4439426">=</span>&nbsp;<span class="ident" id="4439428">decInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439439">uop</span>&nbsp;<span class="op" id="4439443">=</span>&nbsp;<span class="ident" id="4439445">decUint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439456">default</span><span class="op" id="4439463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4439467">panic</span><span class="op" id="4439472">(</span><span class="string" id="4439473">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;int/uint&#34;</span><span class="op" id="4439504">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439510">decOpTable</span><span class="op" id="4439520">[</span><span class="ident" id="4439521">reflect</span><span class="op" id="4439528">.</span><span class="ident" id="4439529">Int</span><span class="op" id="4439532">]</span>&nbsp;<span class="op" id="4439534">=</span>&nbsp;<span class="ident" id="4439536">iop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439541">decOpTable</span><span class="op" id="4439551">[</span><span class="ident" id="4439552">reflect</span><span class="op" id="4439559">.</span><span class="ident" id="4439560">Uint</span><span class="op" id="4439564">]</span>&nbsp;<span class="op" id="4439566">=</span>&nbsp;<span class="ident" id="4439568">uop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4439574">//&nbsp;Finally&nbsp;uintptr</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439594">switch</span>&nbsp;<span class="ident" id="4439601">reflect</span><span class="op" id="4439608">.</span><span class="ident" id="4439609">TypeOf</span><span class="op" id="4439615">(</span><span class="builtintype" id="4439616">uintptr</span><span class="op" id="4439623">(</span><span class="num" id="4439624">0</span><span class="op" id="4439625">)</span><span class="op" id="4439626">)</span><span class="op" id="4439627">.</span><span class="ident" id="4439628">Bits</span><span class="op" id="4439632">(</span><span class="op" id="4439633">)</span>&nbsp;<span class="op" id="4439635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439638">case</span>&nbsp;<span class="num" id="4439643">32</span><span class="op" id="4439645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439649">uop</span>&nbsp;<span class="op" id="4439653">=</span>&nbsp;<span class="ident" id="4439655">decUint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439666">case</span>&nbsp;<span class="num" id="4439671">64</span><span class="op" id="4439673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439677">uop</span>&nbsp;<span class="op" id="4439681">=</span>&nbsp;<span class="ident" id="4439683">decUint64</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4439694">default</span><span class="op" id="4439701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4439705">panic</span><span class="op" id="4439710">(</span><span class="string" id="4439711">&#34;gob:&nbsp;unknown&nbsp;size&nbsp;of&nbsp;uintptr&#34;</span><span class="op" id="4439741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4439744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4439747">decOpTable</span><span class="op" id="4439757">[</span><span class="ident" id="4439758">reflect</span><span class="op" id="4439765">.</span><span class="ident" id="4439766">Uintptr</span><span class="op" id="4439773">]</span>&nbsp;<span class="op" id="4439775">=</span>&nbsp;<span class="ident" id="4439777">uop</span><br>
<span class="lineno"></span><span class="op" id="4439781">}</span><br>
<span class="lineno">1210</span><br>
<span class="lineno"></span><span class="comment" id="4439784">//&nbsp;Gob&nbsp;depends&nbsp;on&nbsp;being&nbsp;able&nbsp;to&nbsp;take&nbsp;the&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="4439833">//&nbsp;of&nbsp;zeroed&nbsp;Values&nbsp;it&nbsp;creates,&nbsp;so&nbsp;use&nbsp;this&nbsp;wrapper&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4439893">//&nbsp;of&nbsp;the&nbsp;standard&nbsp;reflect.Zero.</span><br>
<span class="lineno"></span><span class="comment" id="4439926">//&nbsp;Each&nbsp;call&nbsp;allocates&nbsp;once.</span><br>
<span class="lineno">1215</span><span class="keyword" id="4439955">func</span>&nbsp;<span class="ident" id="4439960">allocValue</span><span class="op" id="4439970">(</span><span class="ident" id="4439971">t</span>&nbsp;<span class="ident" id="4439973">reflect</span><span class="op" id="4439980">.</span><span class="ident" id="4439981">Type</span><span class="op" id="4439985">)</span>&nbsp;<span class="ident" id="4439987">reflect</span><span class="op" id="4439994">.</span><span class="ident" id="4439995">Value</span>&nbsp;<span class="op" id="4440001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4440004">return</span>&nbsp;<span class="ident" id="4440011">reflect</span><span class="op" id="4440018">.</span><span class="ident" id="4440019">New</span><span class="op" id="4440022">(</span><span class="ident" id="4440023">t</span><span class="op" id="4440024">)</span><span class="op" id="4440025">.</span><span class="ident" id="4440026">Elem</span><span class="op" id="4440030">(</span><span class="op" id="4440031">)</span><br>
<span class="lineno"></span><span class="op" id="4440033">}</span>
</div>
</body>
</html>
