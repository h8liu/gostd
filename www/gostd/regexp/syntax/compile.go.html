<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html" class="current">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5327194">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5327249">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5327303">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5327354">package</span>&nbsp;<span class="ident" id="5327362">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5327370">import</span>&nbsp;<span class="string" id="5327377">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5327388">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="5327474">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="5327553">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="5327624">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="5327690">//</span><br>
<span class="lineno"></span><span class="comment" id="5327693">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="5327771">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="5327832">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="5327879">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="5327949">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="5328026">type</span>&nbsp;<span class="ident" id="5328031">patchList</span>&nbsp;<span class="builtintype" id="5328041">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5328049">func</span>&nbsp;<span class="op" id="5328054">(</span><span class="ident" id="5328055">l</span>&nbsp;<span class="ident" id="5328057">patchList</span><span class="op" id="5328066">)</span>&nbsp;<span class="ident" id="5328068">next</span><span class="op" id="5328072">(</span><span class="ident" id="5328073">p</span>&nbsp;<span class="op" id="5328075">*</span><span class="ident" id="5328076">Prog</span><span class="op" id="5328080">)</span>&nbsp;<span class="ident" id="5328082">patchList</span>&nbsp;<span class="op" id="5328092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328095">i</span>&nbsp;<span class="op" id="5328097">:=</span>&nbsp;<span class="op" id="5328100">&amp;</span><span class="ident" id="5328101">p</span><span class="op" id="5328102">.</span><span class="ident" id="5328103">Inst</span><span class="op" id="5328107">[</span><span class="ident" id="5328108">l</span><span class="op" id="5328109">&gt;&gt;</span><span class="num" id="5328111">1</span><span class="op" id="5328112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328115">if</span>&nbsp;<span class="ident" id="5328118">l</span><span class="op" id="5328119">&amp;</span><span class="num" id="5328120">1</span>&nbsp;<span class="op" id="5328122">==</span>&nbsp;<span class="num" id="5328125">0</span>&nbsp;<span class="op" id="5328127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328131">return</span>&nbsp;<span class="ident" id="5328138">patchList</span><span class="op" id="5328147">(</span><span class="ident" id="5328148">i</span><span class="op" id="5328149">.</span><span class="ident" id="5328150">Out</span><span class="op" id="5328153">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328159">return</span>&nbsp;<span class="ident" id="5328166">patchList</span><span class="op" id="5328175">(</span><span class="ident" id="5328176">i</span><span class="op" id="5328177">.</span><span class="ident" id="5328178">Arg</span><span class="op" id="5328181">)</span><br>
<span class="lineno"></span><span class="op" id="5328183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5328186">func</span>&nbsp;<span class="op" id="5328191">(</span><span class="ident" id="5328192">l</span>&nbsp;<span class="ident" id="5328194">patchList</span><span class="op" id="5328203">)</span>&nbsp;<span class="ident" id="5328205">patch</span><span class="op" id="5328210">(</span><span class="ident" id="5328211">p</span>&nbsp;<span class="op" id="5328213">*</span><span class="ident" id="5328214">Prog</span><span class="op" id="5328218">,</span>&nbsp;<span class="ident" id="5328220">val</span>&nbsp;<span class="builtintype" id="5328224">uint32</span><span class="op" id="5328230">)</span>&nbsp;<span class="op" id="5328232">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328235">for</span>&nbsp;<span class="ident" id="5328239">l</span>&nbsp;<span class="op" id="5328241">!=</span>&nbsp;<span class="num" id="5328244">0</span>&nbsp;<span class="op" id="5328246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328250">i</span>&nbsp;<span class="op" id="5328252">:=</span>&nbsp;<span class="op" id="5328255">&amp;</span><span class="ident" id="5328256">p</span><span class="op" id="5328257">.</span><span class="ident" id="5328258">Inst</span><span class="op" id="5328262">[</span><span class="ident" id="5328263">l</span><span class="op" id="5328264">&gt;&gt;</span><span class="num" id="5328266">1</span><span class="op" id="5328267">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328271">if</span>&nbsp;<span class="ident" id="5328274">l</span><span class="op" id="5328275">&amp;</span><span class="num" id="5328276">1</span>&nbsp;<span class="op" id="5328278">==</span>&nbsp;<span class="num" id="5328281">0</span>&nbsp;<span class="op" id="5328283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328288">l</span>&nbsp;<span class="op" id="5328290">=</span>&nbsp;<span class="ident" id="5328292">patchList</span><span class="op" id="5328301">(</span><span class="ident" id="5328302">i</span><span class="op" id="5328303">.</span><span class="ident" id="5328304">Out</span><span class="op" id="5328307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328312">i</span><span class="op" id="5328313">.</span><span class="ident" id="5328314">Out</span>&nbsp;<span class="op" id="5328318">=</span>&nbsp;<span class="ident" id="5328320">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328326">}</span>&nbsp;<span class="keyword" id="5328328">else</span>&nbsp;<span class="op" id="5328333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328338">l</span>&nbsp;<span class="op" id="5328340">=</span>&nbsp;<span class="ident" id="5328342">patchList</span><span class="op" id="5328351">(</span><span class="ident" id="5328352">i</span><span class="op" id="5328353">.</span><span class="ident" id="5328354">Arg</span><span class="op" id="5328357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328362">i</span><span class="op" id="5328363">.</span><span class="ident" id="5328364">Arg</span>&nbsp;<span class="op" id="5328368">=</span>&nbsp;<span class="ident" id="5328370">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328379">}</span><br>
<span class="lineno">40</span><span class="op" id="5328381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5328384">func</span>&nbsp;<span class="op" id="5328389">(</span><span class="ident" id="5328390">l1</span>&nbsp;<span class="ident" id="5328393">patchList</span><span class="op" id="5328402">)</span>&nbsp;<span class="builtinfunc" id="5328404">append</span><span class="op" id="5328410">(</span><span class="ident" id="5328411">p</span>&nbsp;<span class="op" id="5328413">*</span><span class="ident" id="5328414">Prog</span><span class="op" id="5328418">,</span>&nbsp;<span class="ident" id="5328420">l2</span>&nbsp;<span class="ident" id="5328423">patchList</span><span class="op" id="5328432">)</span>&nbsp;<span class="ident" id="5328434">patchList</span>&nbsp;<span class="op" id="5328444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328447">if</span>&nbsp;<span class="ident" id="5328450">l1</span>&nbsp;<span class="op" id="5328453">==</span>&nbsp;<span class="num" id="5328456">0</span>&nbsp;<span class="op" id="5328458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328462">return</span>&nbsp;<span class="ident" id="5328469">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328476">if</span>&nbsp;<span class="ident" id="5328479">l2</span>&nbsp;<span class="op" id="5328482">==</span>&nbsp;<span class="num" id="5328485">0</span>&nbsp;<span class="op" id="5328487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328491">return</span>&nbsp;<span class="ident" id="5328498">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328506">last</span>&nbsp;<span class="op" id="5328511">:=</span>&nbsp;<span class="ident" id="5328514">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328518">for</span>&nbsp;<span class="op" id="5328522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328526">next</span>&nbsp;<span class="op" id="5328531">:=</span>&nbsp;<span class="ident" id="5328534">last</span><span class="op" id="5328538">.</span><span class="ident" id="5328539">next</span><span class="op" id="5328543">(</span><span class="ident" id="5328544">p</span><span class="op" id="5328545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328549">if</span>&nbsp;<span class="ident" id="5328552">next</span>&nbsp;<span class="op" id="5328557">==</span>&nbsp;<span class="num" id="5328560">0</span>&nbsp;<span class="op" id="5328562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328567">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328579">last</span>&nbsp;<span class="op" id="5328584">=</span>&nbsp;<span class="ident" id="5328586">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328596">i</span>&nbsp;<span class="op" id="5328598">:=</span>&nbsp;<span class="op" id="5328601">&amp;</span><span class="ident" id="5328602">p</span><span class="op" id="5328603">.</span><span class="ident" id="5328604">Inst</span><span class="op" id="5328608">[</span><span class="ident" id="5328609">last</span><span class="op" id="5328613">&gt;&gt;</span><span class="num" id="5328615">1</span><span class="op" id="5328616">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328619">if</span>&nbsp;<span class="ident" id="5328622">last</span><span class="op" id="5328626">&amp;</span><span class="num" id="5328627">1</span>&nbsp;<span class="op" id="5328629">==</span>&nbsp;<span class="num" id="5328632">0</span>&nbsp;<span class="op" id="5328634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328638">i</span><span class="op" id="5328639">.</span><span class="ident" id="5328640">Out</span>&nbsp;<span class="op" id="5328644">=</span>&nbsp;<span class="builtintype" id="5328646">uint32</span><span class="op" id="5328652">(</span><span class="ident" id="5328653">l2</span><span class="op" id="5328655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328658">}</span>&nbsp;<span class="keyword" id="5328660">else</span>&nbsp;<span class="op" id="5328665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328669">i</span><span class="op" id="5328670">.</span><span class="ident" id="5328671">Arg</span>&nbsp;<span class="op" id="5328675">=</span>&nbsp;<span class="builtintype" id="5328677">uint32</span><span class="op" id="5328683">(</span><span class="ident" id="5328684">l2</span><span class="op" id="5328686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328689">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328692">return</span>&nbsp;<span class="ident" id="5328699">l1</span><br>
<span class="lineno"></span><span class="op" id="5328702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5328705">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="5328755">type</span>&nbsp;<span class="ident" id="5328760">frag</span>&nbsp;<span class="keyword" id="5328765">struct</span>&nbsp;<span class="op" id="5328772">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328775">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5328779">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328789">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328820">out</span>&nbsp;<span class="ident" id="5328824">patchList</span>&nbsp;<span class="comment" id="5328834">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="5328869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5328872">type</span>&nbsp;<span class="ident" id="5328877">compiler</span>&nbsp;<span class="keyword" id="5328886">struct</span>&nbsp;<span class="op" id="5328893">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328896">p</span>&nbsp;<span class="op" id="5328898">*</span><span class="ident" id="5328899">Prog</span><br>
<span class="lineno"></span><span class="op" id="5328904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5328907">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="5328969">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="5329048">func</span>&nbsp;<span class="ident" id="5329053">Compile</span><span class="op" id="5329060">(</span><span class="ident" id="5329061">re</span>&nbsp;<span class="op" id="5329064">*</span><span class="ident" id="5329065">Regexp</span><span class="op" id="5329071">)</span>&nbsp;<span class="op" id="5329073">(</span><span class="op" id="5329074">*</span><span class="ident" id="5329075">Prog</span><span class="op" id="5329079">,</span>&nbsp;<span class="builtintype" id="5329081">error</span><span class="op" id="5329086">)</span>&nbsp;<span class="op" id="5329088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329091">var</span>&nbsp;<span class="ident" id="5329095">c</span>&nbsp;<span class="ident" id="5329097">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329107">c</span><span class="op" id="5329108">.</span><span class="ident" id="5329109">init</span><span class="op" id="5329113">(</span><span class="op" id="5329114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329117">f</span>&nbsp;<span class="op" id="5329119">:=</span>&nbsp;<span class="ident" id="5329122">c</span><span class="op" id="5329123">.</span><span class="ident" id="5329124">compile</span><span class="op" id="5329131">(</span><span class="ident" id="5329132">re</span><span class="op" id="5329134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329137">f</span><span class="op" id="5329138">.</span><span class="ident" id="5329139">out</span><span class="op" id="5329142">.</span><span class="ident" id="5329143">patch</span><span class="op" id="5329148">(</span><span class="ident" id="5329149">c</span><span class="op" id="5329150">.</span><span class="ident" id="5329151">p</span><span class="op" id="5329152">,</span>&nbsp;<span class="ident" id="5329154">c</span><span class="op" id="5329155">.</span><span class="ident" id="5329156">inst</span><span class="op" id="5329160">(</span><span class="ident" id="5329161">InstMatch</span><span class="op" id="5329170">)</span><span class="op" id="5329171">.</span><span class="ident" id="5329172">i</span><span class="op" id="5329173">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329176">c</span><span class="op" id="5329177">.</span><span class="ident" id="5329178">p</span><span class="op" id="5329179">.</span><span class="ident" id="5329180">Start</span>&nbsp;<span class="op" id="5329186">=</span>&nbsp;<span class="builtintype" id="5329188">int</span><span class="op" id="5329191">(</span><span class="ident" id="5329192">f</span><span class="op" id="5329193">.</span><span class="ident" id="5329194">i</span><span class="op" id="5329195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329198">return</span>&nbsp;<span class="ident" id="5329205">c</span><span class="op" id="5329206">.</span><span class="ident" id="5329207">p</span><span class="op" id="5329208">,</span>&nbsp;<span class="builtintype" id="5329210">nil</span><br>
<span class="lineno"></span><span class="op" id="5329214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5329217">func</span>&nbsp;<span class="op" id="5329222">(</span><span class="ident" id="5329223">c</span>&nbsp;<span class="op" id="5329225">*</span><span class="ident" id="5329226">compiler</span><span class="op" id="5329234">)</span>&nbsp;<span class="ident" id="5329236">init</span><span class="op" id="5329240">(</span><span class="op" id="5329241">)</span>&nbsp;<span class="op" id="5329243">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329246">c</span><span class="op" id="5329247">.</span><span class="ident" id="5329248">p</span>&nbsp;<span class="op" id="5329250">=</span>&nbsp;<span class="builtinfunc" id="5329252">new</span><span class="op" id="5329255">(</span><span class="ident" id="5329256">Prog</span><span class="op" id="5329260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329263">c</span><span class="op" id="5329264">.</span><span class="ident" id="5329265">p</span><span class="op" id="5329266">.</span><span class="ident" id="5329267">NumCap</span>&nbsp;<span class="op" id="5329274">=</span>&nbsp;<span class="num" id="5329276">2</span>&nbsp;<span class="comment" id="5329278">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329318">c</span><span class="op" id="5329319">.</span><span class="ident" id="5329320">inst</span><span class="op" id="5329324">(</span><span class="ident" id="5329325">InstFail</span><span class="op" id="5329333">)</span><br>
<span class="lineno"></span><span class="op" id="5329335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5329338">var</span>&nbsp;<span class="ident" id="5329342">anyRuneNotNL</span>&nbsp;<span class="op" id="5329355">=</span>&nbsp;<span class="op" id="5329357">[</span><span class="op" id="5329358">]</span><span class="builtintype" id="5329359">rune</span><span class="op" id="5329363">{</span><span class="num" id="5329364">0</span><span class="op" id="5329365">,</span>&nbsp;<span class="string" id="5329367">&#39;\n&#39;</span>&nbsp;<span class="op" id="5329372">-</span>&nbsp;<span class="num" id="5329374">1</span><span class="op" id="5329375">,</span>&nbsp;<span class="string" id="5329377">&#39;\n&#39;</span>&nbsp;<span class="op" id="5329382">+</span>&nbsp;<span class="num" id="5329384">1</span><span class="op" id="5329385">,</span>&nbsp;<span class="ident" id="5329387">unicode</span><span class="op" id="5329394">.</span><span class="ident" id="5329395">MaxRune</span><span class="op" id="5329402">}</span><br>
<span class="lineno"></span><span class="keyword" id="5329404">var</span>&nbsp;<span class="ident" id="5329408">anyRune</span>&nbsp;<span class="op" id="5329416">=</span>&nbsp;<span class="op" id="5329418">[</span><span class="op" id="5329419">]</span><span class="builtintype" id="5329420">rune</span><span class="op" id="5329424">{</span><span class="num" id="5329425">0</span><span class="op" id="5329426">,</span>&nbsp;<span class="ident" id="5329428">unicode</span><span class="op" id="5329435">.</span><span class="ident" id="5329436">MaxRune</span><span class="op" id="5329443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5329446">func</span>&nbsp;<span class="op" id="5329451">(</span><span class="ident" id="5329452">c</span>&nbsp;<span class="op" id="5329454">*</span><span class="ident" id="5329455">compiler</span><span class="op" id="5329463">)</span>&nbsp;<span class="ident" id="5329465">compile</span><span class="op" id="5329472">(</span><span class="ident" id="5329473">re</span>&nbsp;<span class="op" id="5329476">*</span><span class="ident" id="5329477">Regexp</span><span class="op" id="5329483">)</span>&nbsp;<span class="ident" id="5329485">frag</span>&nbsp;<span class="op" id="5329490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329493">switch</span>&nbsp;<span class="ident" id="5329500">re</span><span class="op" id="5329502">.</span><span class="ident" id="5329503">Op</span>&nbsp;<span class="op" id="5329506">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329509">case</span>&nbsp;<span class="ident" id="5329514">OpNoMatch</span><span class="op" id="5329523">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329527">return</span>&nbsp;<span class="ident" id="5329534">c</span><span class="op" id="5329535">.</span><span class="ident" id="5329536">fail</span><span class="op" id="5329540">(</span><span class="op" id="5329541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329544">case</span>&nbsp;<span class="ident" id="5329549">OpEmptyMatch</span><span class="op" id="5329561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329565">return</span>&nbsp;<span class="ident" id="5329572">c</span><span class="op" id="5329573">.</span><span class="ident" id="5329574">nop</span><span class="op" id="5329577">(</span><span class="op" id="5329578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329581">case</span>&nbsp;<span class="ident" id="5329586">OpLiteral</span><span class="op" id="5329595">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329599">if</span>&nbsp;<span class="builtinfunc" id="5329602">len</span><span class="op" id="5329605">(</span><span class="ident" id="5329606">re</span><span class="op" id="5329608">.</span><span class="ident" id="5329609">Rune</span><span class="op" id="5329613">)</span>&nbsp;<span class="op" id="5329615">==</span>&nbsp;<span class="num" id="5329618">0</span>&nbsp;<span class="op" id="5329620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329625">return</span>&nbsp;<span class="ident" id="5329632">c</span><span class="op" id="5329633">.</span><span class="ident" id="5329634">nop</span><span class="op" id="5329637">(</span><span class="op" id="5329638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329646">var</span>&nbsp;<span class="ident" id="5329650">f</span>&nbsp;<span class="ident" id="5329652">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329659">for</span>&nbsp;<span class="ident" id="5329663">j</span>&nbsp;<span class="op" id="5329665">:=</span>&nbsp;<span class="keyword" id="5329668">range</span>&nbsp;<span class="ident" id="5329674">re</span><span class="op" id="5329676">.</span><span class="ident" id="5329677">Rune</span>&nbsp;<span class="op" id="5329682">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329687">f1</span>&nbsp;<span class="op" id="5329690">:=</span>&nbsp;<span class="ident" id="5329693">c</span><span class="op" id="5329694">.</span><span class="builtintype" id="5329695">rune</span><span class="op" id="5329699">(</span><span class="ident" id="5329700">re</span><span class="op" id="5329702">.</span><span class="ident" id="5329703">Rune</span><span class="op" id="5329707">[</span><span class="ident" id="5329708">j</span><span class="op" id="5329709">:</span><span class="ident" id="5329710">j</span><span class="op" id="5329711">+</span><span class="num" id="5329712">1</span><span class="op" id="5329713">]</span><span class="op" id="5329714">,</span>&nbsp;<span class="ident" id="5329716">re</span><span class="op" id="5329718">.</span><span class="ident" id="5329719">Flags</span><span class="op" id="5329724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329729">if</span>&nbsp;<span class="ident" id="5329732">j</span>&nbsp;<span class="op" id="5329734">==</span>&nbsp;<span class="num" id="5329737">0</span>&nbsp;<span class="op" id="5329739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329745">f</span>&nbsp;<span class="op" id="5329747">=</span>&nbsp;<span class="ident" id="5329749">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329755">}</span>&nbsp;<span class="keyword" id="5329757">else</span>&nbsp;<span class="op" id="5329762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329768">f</span>&nbsp;<span class="op" id="5329770">=</span>&nbsp;<span class="ident" id="5329772">c</span><span class="op" id="5329773">.</span><span class="ident" id="5329774">cat</span><span class="op" id="5329777">(</span><span class="ident" id="5329778">f</span><span class="op" id="5329779">,</span>&nbsp;<span class="ident" id="5329781">f1</span><span class="op" id="5329783">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329796">return</span>&nbsp;<span class="ident" id="5329803">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329806">case</span>&nbsp;<span class="ident" id="5329811">OpCharClass</span><span class="op" id="5329822">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329826">return</span>&nbsp;<span class="ident" id="5329833">c</span><span class="op" id="5329834">.</span><span class="builtintype" id="5329835">rune</span><span class="op" id="5329839">(</span><span class="ident" id="5329840">re</span><span class="op" id="5329842">.</span><span class="ident" id="5329843">Rune</span><span class="op" id="5329847">,</span>&nbsp;<span class="ident" id="5329849">re</span><span class="op" id="5329851">.</span><span class="ident" id="5329852">Flags</span><span class="op" id="5329857">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329860">case</span>&nbsp;<span class="ident" id="5329865">OpAnyCharNotNL</span><span class="op" id="5329879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329883">return</span>&nbsp;<span class="ident" id="5329890">c</span><span class="op" id="5329891">.</span><span class="builtintype" id="5329892">rune</span><span class="op" id="5329896">(</span><span class="ident" id="5329897">anyRuneNotNL</span><span class="op" id="5329909">,</span>&nbsp;<span class="num" id="5329911">0</span><span class="op" id="5329912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329915">case</span>&nbsp;<span class="ident" id="5329920">OpAnyChar</span><span class="op" id="5329929">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329933">return</span>&nbsp;<span class="ident" id="5329940">c</span><span class="op" id="5329941">.</span><span class="builtintype" id="5329942">rune</span><span class="op" id="5329946">(</span><span class="ident" id="5329947">anyRune</span><span class="op" id="5329954">,</span>&nbsp;<span class="num" id="5329956">0</span><span class="op" id="5329957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329960">case</span>&nbsp;<span class="ident" id="5329965">OpBeginLine</span><span class="op" id="5329976">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329980">return</span>&nbsp;<span class="ident" id="5329987">c</span><span class="op" id="5329988">.</span><span class="ident" id="5329989">empty</span><span class="op" id="5329994">(</span><span class="ident" id="5329995">EmptyBeginLine</span><span class="op" id="5330009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330012">case</span>&nbsp;<span class="ident" id="5330017">OpEndLine</span><span class="op" id="5330026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330030">return</span>&nbsp;<span class="ident" id="5330037">c</span><span class="op" id="5330038">.</span><span class="ident" id="5330039">empty</span><span class="op" id="5330044">(</span><span class="ident" id="5330045">EmptyEndLine</span><span class="op" id="5330057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330060">case</span>&nbsp;<span class="ident" id="5330065">OpBeginText</span><span class="op" id="5330076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330080">return</span>&nbsp;<span class="ident" id="5330087">c</span><span class="op" id="5330088">.</span><span class="ident" id="5330089">empty</span><span class="op" id="5330094">(</span><span class="ident" id="5330095">EmptyBeginText</span><span class="op" id="5330109">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330112">case</span>&nbsp;<span class="ident" id="5330117">OpEndText</span><span class="op" id="5330126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330130">return</span>&nbsp;<span class="ident" id="5330137">c</span><span class="op" id="5330138">.</span><span class="ident" id="5330139">empty</span><span class="op" id="5330144">(</span><span class="ident" id="5330145">EmptyEndText</span><span class="op" id="5330157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330160">case</span>&nbsp;<span class="ident" id="5330165">OpWordBoundary</span><span class="op" id="5330179">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330183">return</span>&nbsp;<span class="ident" id="5330190">c</span><span class="op" id="5330191">.</span><span class="ident" id="5330192">empty</span><span class="op" id="5330197">(</span><span class="ident" id="5330198">EmptyWordBoundary</span><span class="op" id="5330215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330218">case</span>&nbsp;<span class="ident" id="5330223">OpNoWordBoundary</span><span class="op" id="5330239">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330243">return</span>&nbsp;<span class="ident" id="5330250">c</span><span class="op" id="5330251">.</span><span class="ident" id="5330252">empty</span><span class="op" id="5330257">(</span><span class="ident" id="5330258">EmptyNoWordBoundary</span><span class="op" id="5330277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330280">case</span>&nbsp;<span class="ident" id="5330285">OpCapture</span><span class="op" id="5330294">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330298">bra</span>&nbsp;<span class="op" id="5330302">:=</span>&nbsp;<span class="ident" id="5330305">c</span><span class="op" id="5330306">.</span><span class="builtinfunc" id="5330307">cap</span><span class="op" id="5330310">(</span><span class="builtintype" id="5330311">uint32</span><span class="op" id="5330317">(</span><span class="ident" id="5330318">re</span><span class="op" id="5330320">.</span><span class="ident" id="5330321">Cap</span>&nbsp;<span class="op" id="5330325">&lt;&lt;</span>&nbsp;<span class="num" id="5330328">1</span><span class="op" id="5330329">)</span><span class="op" id="5330330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330334">sub</span>&nbsp;<span class="op" id="5330338">:=</span>&nbsp;<span class="ident" id="5330341">c</span><span class="op" id="5330342">.</span><span class="ident" id="5330343">compile</span><span class="op" id="5330350">(</span><span class="ident" id="5330351">re</span><span class="op" id="5330353">.</span><span class="ident" id="5330354">Sub</span><span class="op" id="5330357">[</span><span class="num" id="5330358">0</span><span class="op" id="5330359">]</span><span class="op" id="5330360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330364">ket</span>&nbsp;<span class="op" id="5330368">:=</span>&nbsp;<span class="ident" id="5330371">c</span><span class="op" id="5330372">.</span><span class="builtinfunc" id="5330373">cap</span><span class="op" id="5330376">(</span><span class="builtintype" id="5330377">uint32</span><span class="op" id="5330383">(</span><span class="ident" id="5330384">re</span><span class="op" id="5330386">.</span><span class="ident" id="5330387">Cap</span><span class="op" id="5330390">&lt;&lt;</span><span class="num" id="5330392">1</span>&nbsp;<span class="op" id="5330394">|</span>&nbsp;<span class="num" id="5330396">1</span><span class="op" id="5330397">)</span><span class="op" id="5330398">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330402">return</span>&nbsp;<span class="ident" id="5330409">c</span><span class="op" id="5330410">.</span><span class="ident" id="5330411">cat</span><span class="op" id="5330414">(</span><span class="ident" id="5330415">c</span><span class="op" id="5330416">.</span><span class="ident" id="5330417">cat</span><span class="op" id="5330420">(</span><span class="ident" id="5330421">bra</span><span class="op" id="5330424">,</span>&nbsp;<span class="ident" id="5330426">sub</span><span class="op" id="5330429">)</span><span class="op" id="5330430">,</span>&nbsp;<span class="ident" id="5330432">ket</span><span class="op" id="5330435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330438">case</span>&nbsp;<span class="ident" id="5330443">OpStar</span><span class="op" id="5330449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330453">return</span>&nbsp;<span class="ident" id="5330460">c</span><span class="op" id="5330461">.</span><span class="ident" id="5330462">star</span><span class="op" id="5330466">(</span><span class="ident" id="5330467">c</span><span class="op" id="5330468">.</span><span class="ident" id="5330469">compile</span><span class="op" id="5330476">(</span><span class="ident" id="5330477">re</span><span class="op" id="5330479">.</span><span class="ident" id="5330480">Sub</span><span class="op" id="5330483">[</span><span class="num" id="5330484">0</span><span class="op" id="5330485">]</span><span class="op" id="5330486">)</span><span class="op" id="5330487">,</span>&nbsp;<span class="ident" id="5330489">re</span><span class="op" id="5330491">.</span><span class="ident" id="5330492">Flags</span><span class="op" id="5330497">&amp;</span><span class="ident" id="5330498">NonGreedy</span>&nbsp;<span class="op" id="5330508">!=</span>&nbsp;<span class="num" id="5330511">0</span><span class="op" id="5330512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330515">case</span>&nbsp;<span class="ident" id="5330520">OpPlus</span><span class="op" id="5330526">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330530">return</span>&nbsp;<span class="ident" id="5330537">c</span><span class="op" id="5330538">.</span><span class="ident" id="5330539">plus</span><span class="op" id="5330543">(</span><span class="ident" id="5330544">c</span><span class="op" id="5330545">.</span><span class="ident" id="5330546">compile</span><span class="op" id="5330553">(</span><span class="ident" id="5330554">re</span><span class="op" id="5330556">.</span><span class="ident" id="5330557">Sub</span><span class="op" id="5330560">[</span><span class="num" id="5330561">0</span><span class="op" id="5330562">]</span><span class="op" id="5330563">)</span><span class="op" id="5330564">,</span>&nbsp;<span class="ident" id="5330566">re</span><span class="op" id="5330568">.</span><span class="ident" id="5330569">Flags</span><span class="op" id="5330574">&amp;</span><span class="ident" id="5330575">NonGreedy</span>&nbsp;<span class="op" id="5330585">!=</span>&nbsp;<span class="num" id="5330588">0</span><span class="op" id="5330589">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330592">case</span>&nbsp;<span class="ident" id="5330597">OpQuest</span><span class="op" id="5330604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330608">return</span>&nbsp;<span class="ident" id="5330615">c</span><span class="op" id="5330616">.</span><span class="ident" id="5330617">quest</span><span class="op" id="5330622">(</span><span class="ident" id="5330623">c</span><span class="op" id="5330624">.</span><span class="ident" id="5330625">compile</span><span class="op" id="5330632">(</span><span class="ident" id="5330633">re</span><span class="op" id="5330635">.</span><span class="ident" id="5330636">Sub</span><span class="op" id="5330639">[</span><span class="num" id="5330640">0</span><span class="op" id="5330641">]</span><span class="op" id="5330642">)</span><span class="op" id="5330643">,</span>&nbsp;<span class="ident" id="5330645">re</span><span class="op" id="5330647">.</span><span class="ident" id="5330648">Flags</span><span class="op" id="5330653">&amp;</span><span class="ident" id="5330654">NonGreedy</span>&nbsp;<span class="op" id="5330664">!=</span>&nbsp;<span class="num" id="5330667">0</span><span class="op" id="5330668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330671">case</span>&nbsp;<span class="ident" id="5330676">OpConcat</span><span class="op" id="5330684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330688">if</span>&nbsp;<span class="builtinfunc" id="5330691">len</span><span class="op" id="5330694">(</span><span class="ident" id="5330695">re</span><span class="op" id="5330697">.</span><span class="ident" id="5330698">Sub</span><span class="op" id="5330701">)</span>&nbsp;<span class="op" id="5330703">==</span>&nbsp;<span class="num" id="5330706">0</span>&nbsp;<span class="op" id="5330708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330713">return</span>&nbsp;<span class="ident" id="5330720">c</span><span class="op" id="5330721">.</span><span class="ident" id="5330722">nop</span><span class="op" id="5330725">(</span><span class="op" id="5330726">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330734">var</span>&nbsp;<span class="ident" id="5330738">f</span>&nbsp;<span class="ident" id="5330740">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330747">for</span>&nbsp;<span class="ident" id="5330751">i</span><span class="op" id="5330752">,</span>&nbsp;<span class="ident" id="5330754">sub</span>&nbsp;<span class="op" id="5330758">:=</span>&nbsp;<span class="keyword" id="5330761">range</span>&nbsp;<span class="ident" id="5330767">re</span><span class="op" id="5330769">.</span><span class="ident" id="5330770">Sub</span>&nbsp;<span class="op" id="5330774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330779">if</span>&nbsp;<span class="ident" id="5330782">i</span>&nbsp;<span class="op" id="5330784">==</span>&nbsp;<span class="num" id="5330787">0</span>&nbsp;<span class="op" id="5330789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330795">f</span>&nbsp;<span class="op" id="5330797">=</span>&nbsp;<span class="ident" id="5330799">c</span><span class="op" id="5330800">.</span><span class="ident" id="5330801">compile</span><span class="op" id="5330808">(</span><span class="ident" id="5330809">sub</span><span class="op" id="5330812">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330817">}</span>&nbsp;<span class="keyword" id="5330819">else</span>&nbsp;<span class="op" id="5330824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330830">f</span>&nbsp;<span class="op" id="5330832">=</span>&nbsp;<span class="ident" id="5330834">c</span><span class="op" id="5330835">.</span><span class="ident" id="5330836">cat</span><span class="op" id="5330839">(</span><span class="ident" id="5330840">f</span><span class="op" id="5330841">,</span>&nbsp;<span class="ident" id="5330843">c</span><span class="op" id="5330844">.</span><span class="ident" id="5330845">compile</span><span class="op" id="5330852">(</span><span class="ident" id="5330853">sub</span><span class="op" id="5330856">)</span><span class="op" id="5330857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330870">return</span>&nbsp;<span class="ident" id="5330877">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330880">case</span>&nbsp;<span class="ident" id="5330885">OpAlternate</span><span class="op" id="5330896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330900">var</span>&nbsp;<span class="ident" id="5330904">f</span>&nbsp;<span class="ident" id="5330906">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330913">for</span>&nbsp;<span class="ident" id="5330917">_</span><span class="op" id="5330918">,</span>&nbsp;<span class="ident" id="5330920">sub</span>&nbsp;<span class="op" id="5330924">:=</span>&nbsp;<span class="keyword" id="5330927">range</span>&nbsp;<span class="ident" id="5330933">re</span><span class="op" id="5330935">.</span><span class="ident" id="5330936">Sub</span>&nbsp;<span class="op" id="5330940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330945">f</span>&nbsp;<span class="op" id="5330947">=</span>&nbsp;<span class="ident" id="5330949">c</span><span class="op" id="5330950">.</span><span class="ident" id="5330951">alt</span><span class="op" id="5330954">(</span><span class="ident" id="5330955">f</span><span class="op" id="5330956">,</span>&nbsp;<span class="ident" id="5330958">c</span><span class="op" id="5330959">.</span><span class="ident" id="5330960">compile</span><span class="op" id="5330967">(</span><span class="ident" id="5330968">sub</span><span class="op" id="5330971">)</span><span class="op" id="5330972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330976">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330980">return</span>&nbsp;<span class="ident" id="5330987">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5330993">panic</span><span class="op" id="5330998">(</span><span class="string" id="5330999">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="5331034">)</span><br>
<span class="lineno"></span><span class="op" id="5331036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5331039">func</span>&nbsp;<span class="op" id="5331044">(</span><span class="ident" id="5331045">c</span>&nbsp;<span class="op" id="5331047">*</span><span class="ident" id="5331048">compiler</span><span class="op" id="5331056">)</span>&nbsp;<span class="ident" id="5331058">inst</span><span class="op" id="5331062">(</span><span class="ident" id="5331063">op</span>&nbsp;<span class="ident" id="5331066">InstOp</span><span class="op" id="5331072">)</span>&nbsp;<span class="ident" id="5331074">frag</span>&nbsp;<span class="op" id="5331079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5331082">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331112">f</span>&nbsp;<span class="op" id="5331114">:=</span>&nbsp;<span class="ident" id="5331117">frag</span><span class="op" id="5331121">{</span><span class="ident" id="5331122">i</span><span class="op" id="5331123">:</span>&nbsp;<span class="builtintype" id="5331125">uint32</span><span class="op" id="5331131">(</span><span class="builtinfunc" id="5331132">len</span><span class="op" id="5331135">(</span><span class="ident" id="5331136">c</span><span class="op" id="5331137">.</span><span class="ident" id="5331138">p</span><span class="op" id="5331139">.</span><span class="ident" id="5331140">Inst</span><span class="op" id="5331144">)</span><span class="op" id="5331145">)</span><span class="op" id="5331146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331149">c</span><span class="op" id="5331150">.</span><span class="ident" id="5331151">p</span><span class="op" id="5331152">.</span><span class="ident" id="5331153">Inst</span>&nbsp;<span class="op" id="5331158">=</span>&nbsp;<span class="builtinfunc" id="5331160">append</span><span class="op" id="5331166">(</span><span class="ident" id="5331167">c</span><span class="op" id="5331168">.</span><span class="ident" id="5331169">p</span><span class="op" id="5331170">.</span><span class="ident" id="5331171">Inst</span><span class="op" id="5331175">,</span>&nbsp;<span class="ident" id="5331177">Inst</span><span class="op" id="5331181">{</span><span class="ident" id="5331182">Op</span><span class="op" id="5331184">:</span>&nbsp;<span class="ident" id="5331186">op</span><span class="op" id="5331188">}</span><span class="op" id="5331189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331192">return</span>&nbsp;<span class="ident" id="5331199">f</span><br>
<span class="lineno">175</span><span class="op" id="5331201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5331204">func</span>&nbsp;<span class="op" id="5331209">(</span><span class="ident" id="5331210">c</span>&nbsp;<span class="op" id="5331212">*</span><span class="ident" id="5331213">compiler</span><span class="op" id="5331221">)</span>&nbsp;<span class="ident" id="5331223">nop</span><span class="op" id="5331226">(</span><span class="op" id="5331227">)</span>&nbsp;<span class="ident" id="5331229">frag</span>&nbsp;<span class="op" id="5331234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331237">f</span>&nbsp;<span class="op" id="5331239">:=</span>&nbsp;<span class="ident" id="5331242">c</span><span class="op" id="5331243">.</span><span class="ident" id="5331244">inst</span><span class="op" id="5331248">(</span><span class="ident" id="5331249">InstNop</span><span class="op" id="5331256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331259">f</span><span class="op" id="5331260">.</span><span class="ident" id="5331261">out</span>&nbsp;<span class="op" id="5331265">=</span>&nbsp;<span class="ident" id="5331267">patchList</span><span class="op" id="5331276">(</span><span class="ident" id="5331277">f</span><span class="op" id="5331278">.</span><span class="ident" id="5331279">i</span>&nbsp;<span class="op" id="5331281">&lt;&lt;</span>&nbsp;<span class="num" id="5331284">1</span><span class="op" id="5331285">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331288">return</span>&nbsp;<span class="ident" id="5331295">f</span><br>
<span class="lineno"></span><span class="op" id="5331297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5331300">func</span>&nbsp;<span class="op" id="5331305">(</span><span class="ident" id="5331306">c</span>&nbsp;<span class="op" id="5331308">*</span><span class="ident" id="5331309">compiler</span><span class="op" id="5331317">)</span>&nbsp;<span class="ident" id="5331319">fail</span><span class="op" id="5331323">(</span><span class="op" id="5331324">)</span>&nbsp;<span class="ident" id="5331326">frag</span>&nbsp;<span class="op" id="5331331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331334">return</span>&nbsp;<span class="ident" id="5331341">frag</span><span class="op" id="5331345">{</span><span class="op" id="5331346">}</span><br>
<span class="lineno">185</span><span class="op" id="5331348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5331351">func</span>&nbsp;<span class="op" id="5331356">(</span><span class="ident" id="5331357">c</span>&nbsp;<span class="op" id="5331359">*</span><span class="ident" id="5331360">compiler</span><span class="op" id="5331368">)</span>&nbsp;<span class="builtinfunc" id="5331370">cap</span><span class="op" id="5331373">(</span><span class="ident" id="5331374">arg</span>&nbsp;<span class="builtintype" id="5331378">uint32</span><span class="op" id="5331384">)</span>&nbsp;<span class="ident" id="5331386">frag</span>&nbsp;<span class="op" id="5331391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331394">f</span>&nbsp;<span class="op" id="5331396">:=</span>&nbsp;<span class="ident" id="5331399">c</span><span class="op" id="5331400">.</span><span class="ident" id="5331401">inst</span><span class="op" id="5331405">(</span><span class="ident" id="5331406">InstCapture</span><span class="op" id="5331417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331420">f</span><span class="op" id="5331421">.</span><span class="ident" id="5331422">out</span>&nbsp;<span class="op" id="5331426">=</span>&nbsp;<span class="ident" id="5331428">patchList</span><span class="op" id="5331437">(</span><span class="ident" id="5331438">f</span><span class="op" id="5331439">.</span><span class="ident" id="5331440">i</span>&nbsp;<span class="op" id="5331442">&lt;&lt;</span>&nbsp;<span class="num" id="5331445">1</span><span class="op" id="5331446">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331449">c</span><span class="op" id="5331450">.</span><span class="ident" id="5331451">p</span><span class="op" id="5331452">.</span><span class="ident" id="5331453">Inst</span><span class="op" id="5331457">[</span><span class="ident" id="5331458">f</span><span class="op" id="5331459">.</span><span class="ident" id="5331460">i</span><span class="op" id="5331461">]</span><span class="op" id="5331462">.</span><span class="ident" id="5331463">Arg</span>&nbsp;<span class="op" id="5331467">=</span>&nbsp;<span class="ident" id="5331469">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331475">if</span>&nbsp;<span class="ident" id="5331478">c</span><span class="op" id="5331479">.</span><span class="ident" id="5331480">p</span><span class="op" id="5331481">.</span><span class="ident" id="5331482">NumCap</span>&nbsp;<span class="op" id="5331489">&lt;</span>&nbsp;<span class="builtintype" id="5331491">int</span><span class="op" id="5331494">(</span><span class="ident" id="5331495">arg</span><span class="op" id="5331498">)</span><span class="op" id="5331499">+</span><span class="num" id="5331500">1</span>&nbsp;<span class="op" id="5331502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331506">c</span><span class="op" id="5331507">.</span><span class="ident" id="5331508">p</span><span class="op" id="5331509">.</span><span class="ident" id="5331510">NumCap</span>&nbsp;<span class="op" id="5331517">=</span>&nbsp;<span class="builtintype" id="5331519">int</span><span class="op" id="5331522">(</span><span class="ident" id="5331523">arg</span><span class="op" id="5331526">)</span>&nbsp;<span class="op" id="5331528">+</span>&nbsp;<span class="num" id="5331530">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331533">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331536">return</span>&nbsp;<span class="ident" id="5331543">f</span><br>
<span class="lineno"></span><span class="op" id="5331545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5331548">func</span>&nbsp;<span class="op" id="5331553">(</span><span class="ident" id="5331554">c</span>&nbsp;<span class="op" id="5331556">*</span><span class="ident" id="5331557">compiler</span><span class="op" id="5331565">)</span>&nbsp;<span class="ident" id="5331567">cat</span><span class="op" id="5331570">(</span><span class="ident" id="5331571">f1</span><span class="op" id="5331573">,</span>&nbsp;<span class="ident" id="5331575">f2</span>&nbsp;<span class="ident" id="5331578">frag</span><span class="op" id="5331582">)</span>&nbsp;<span class="ident" id="5331584">frag</span>&nbsp;<span class="op" id="5331589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5331592">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331625">if</span>&nbsp;<span class="ident" id="5331628">f1</span><span class="op" id="5331630">.</span><span class="ident" id="5331631">i</span>&nbsp;<span class="op" id="5331633">==</span>&nbsp;<span class="num" id="5331636">0</span>&nbsp;<span class="op" id="5331638">||</span>&nbsp;<span class="ident" id="5331641">f2</span><span class="op" id="5331643">.</span><span class="ident" id="5331644">i</span>&nbsp;<span class="op" id="5331646">==</span>&nbsp;<span class="num" id="5331649">0</span>&nbsp;<span class="op" id="5331651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331655">return</span>&nbsp;<span class="ident" id="5331662">frag</span><span class="op" id="5331666">{</span><span class="op" id="5331667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5331674">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331695">f1</span><span class="op" id="5331697">.</span><span class="ident" id="5331698">out</span><span class="op" id="5331701">.</span><span class="ident" id="5331702">patch</span><span class="op" id="5331707">(</span><span class="ident" id="5331708">c</span><span class="op" id="5331709">.</span><span class="ident" id="5331710">p</span><span class="op" id="5331711">,</span>&nbsp;<span class="ident" id="5331713">f2</span><span class="op" id="5331715">.</span><span class="ident" id="5331716">i</span><span class="op" id="5331717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331720">return</span>&nbsp;<span class="ident" id="5331727">frag</span><span class="op" id="5331731">{</span><span class="ident" id="5331732">f1</span><span class="op" id="5331734">.</span><span class="ident" id="5331735">i</span><span class="op" id="5331736">,</span>&nbsp;<span class="ident" id="5331738">f2</span><span class="op" id="5331740">.</span><span class="ident" id="5331741">out</span><span class="op" id="5331744">}</span><br>
<span class="lineno"></span><span class="op" id="5331746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="5331749">func</span>&nbsp;<span class="op" id="5331754">(</span><span class="ident" id="5331755">c</span>&nbsp;<span class="op" id="5331757">*</span><span class="ident" id="5331758">compiler</span><span class="op" id="5331766">)</span>&nbsp;<span class="ident" id="5331768">alt</span><span class="op" id="5331771">(</span><span class="ident" id="5331772">f1</span><span class="op" id="5331774">,</span>&nbsp;<span class="ident" id="5331776">f2</span>&nbsp;<span class="ident" id="5331779">frag</span><span class="op" id="5331783">)</span>&nbsp;<span class="ident" id="5331785">frag</span>&nbsp;<span class="op" id="5331790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5331793">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331821">if</span>&nbsp;<span class="ident" id="5331824">f1</span><span class="op" id="5331826">.</span><span class="ident" id="5331827">i</span>&nbsp;<span class="op" id="5331829">==</span>&nbsp;<span class="num" id="5331832">0</span>&nbsp;<span class="op" id="5331834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331838">return</span>&nbsp;<span class="ident" id="5331845">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331849">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331852">if</span>&nbsp;<span class="ident" id="5331855">f2</span><span class="op" id="5331857">.</span><span class="ident" id="5331858">i</span>&nbsp;<span class="op" id="5331860">==</span>&nbsp;<span class="num" id="5331863">0</span>&nbsp;<span class="op" id="5331865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331869">return</span>&nbsp;<span class="ident" id="5331876">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331884">f</span>&nbsp;<span class="op" id="5331886">:=</span>&nbsp;<span class="ident" id="5331889">c</span><span class="op" id="5331890">.</span><span class="ident" id="5331891">inst</span><span class="op" id="5331895">(</span><span class="ident" id="5331896">InstAlt</span><span class="op" id="5331903">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331906">i</span>&nbsp;<span class="op" id="5331908">:=</span>&nbsp;<span class="op" id="5331911">&amp;</span><span class="ident" id="5331912">c</span><span class="op" id="5331913">.</span><span class="ident" id="5331914">p</span><span class="op" id="5331915">.</span><span class="ident" id="5331916">Inst</span><span class="op" id="5331920">[</span><span class="ident" id="5331921">f</span><span class="op" id="5331922">.</span><span class="ident" id="5331923">i</span><span class="op" id="5331924">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331927">i</span><span class="op" id="5331928">.</span><span class="ident" id="5331929">Out</span>&nbsp;<span class="op" id="5331933">=</span>&nbsp;<span class="ident" id="5331935">f1</span><span class="op" id="5331937">.</span><span class="ident" id="5331938">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331941">i</span><span class="op" id="5331942">.</span><span class="ident" id="5331943">Arg</span>&nbsp;<span class="op" id="5331947">=</span>&nbsp;<span class="ident" id="5331949">f2</span><span class="op" id="5331951">.</span><span class="ident" id="5331952">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331955">f</span><span class="op" id="5331956">.</span><span class="ident" id="5331957">out</span>&nbsp;<span class="op" id="5331961">=</span>&nbsp;<span class="ident" id="5331963">f1</span><span class="op" id="5331965">.</span><span class="ident" id="5331966">out</span><span class="op" id="5331969">.</span><span class="builtinfunc" id="5331970">append</span><span class="op" id="5331976">(</span><span class="ident" id="5331977">c</span><span class="op" id="5331978">.</span><span class="ident" id="5331979">p</span><span class="op" id="5331980">,</span>&nbsp;<span class="ident" id="5331982">f2</span><span class="op" id="5331984">.</span><span class="ident" id="5331985">out</span><span class="op" id="5331988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331991">return</span>&nbsp;<span class="ident" id="5331998">f</span><br>
<span class="lineno">225</span><span class="op" id="5332000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5332003">func</span>&nbsp;<span class="op" id="5332008">(</span><span class="ident" id="5332009">c</span>&nbsp;<span class="op" id="5332011">*</span><span class="ident" id="5332012">compiler</span><span class="op" id="5332020">)</span>&nbsp;<span class="ident" id="5332022">quest</span><span class="op" id="5332027">(</span><span class="ident" id="5332028">f1</span>&nbsp;<span class="ident" id="5332031">frag</span><span class="op" id="5332035">,</span>&nbsp;<span class="ident" id="5332037">nongreedy</span>&nbsp;<span class="builtintype" id="5332047">bool</span><span class="op" id="5332051">)</span>&nbsp;<span class="ident" id="5332053">frag</span>&nbsp;<span class="op" id="5332058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332061">f</span>&nbsp;<span class="op" id="5332063">:=</span>&nbsp;<span class="ident" id="5332066">c</span><span class="op" id="5332067">.</span><span class="ident" id="5332068">inst</span><span class="op" id="5332072">(</span><span class="ident" id="5332073">InstAlt</span><span class="op" id="5332080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332083">i</span>&nbsp;<span class="op" id="5332085">:=</span>&nbsp;<span class="op" id="5332088">&amp;</span><span class="ident" id="5332089">c</span><span class="op" id="5332090">.</span><span class="ident" id="5332091">p</span><span class="op" id="5332092">.</span><span class="ident" id="5332093">Inst</span><span class="op" id="5332097">[</span><span class="ident" id="5332098">f</span><span class="op" id="5332099">.</span><span class="ident" id="5332100">i</span><span class="op" id="5332101">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332104">if</span>&nbsp;<span class="ident" id="5332107">nongreedy</span>&nbsp;<span class="op" id="5332117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332121">i</span><span class="op" id="5332122">.</span><span class="ident" id="5332123">Arg</span>&nbsp;<span class="op" id="5332127">=</span>&nbsp;<span class="ident" id="5332129">f1</span><span class="op" id="5332131">.</span><span class="ident" id="5332132">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332136">f</span><span class="op" id="5332137">.</span><span class="ident" id="5332138">out</span>&nbsp;<span class="op" id="5332142">=</span>&nbsp;<span class="ident" id="5332144">patchList</span><span class="op" id="5332153">(</span><span class="ident" id="5332154">f</span><span class="op" id="5332155">.</span><span class="ident" id="5332156">i</span>&nbsp;<span class="op" id="5332158">&lt;&lt;</span>&nbsp;<span class="num" id="5332161">1</span><span class="op" id="5332162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332165">}</span>&nbsp;<span class="keyword" id="5332167">else</span>&nbsp;<span class="op" id="5332172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332176">i</span><span class="op" id="5332177">.</span><span class="ident" id="5332178">Out</span>&nbsp;<span class="op" id="5332182">=</span>&nbsp;<span class="ident" id="5332184">f1</span><span class="op" id="5332186">.</span><span class="ident" id="5332187">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332191">f</span><span class="op" id="5332192">.</span><span class="ident" id="5332193">out</span>&nbsp;<span class="op" id="5332197">=</span>&nbsp;<span class="ident" id="5332199">patchList</span><span class="op" id="5332208">(</span><span class="ident" id="5332209">f</span><span class="op" id="5332210">.</span><span class="ident" id="5332211">i</span><span class="op" id="5332212">&lt;&lt;</span><span class="num" id="5332214">1</span>&nbsp;<span class="op" id="5332216">|</span>&nbsp;<span class="num" id="5332218">1</span><span class="op" id="5332219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332225">f</span><span class="op" id="5332226">.</span><span class="ident" id="5332227">out</span>&nbsp;<span class="op" id="5332231">=</span>&nbsp;<span class="ident" id="5332233">f</span><span class="op" id="5332234">.</span><span class="ident" id="5332235">out</span><span class="op" id="5332238">.</span><span class="builtinfunc" id="5332239">append</span><span class="op" id="5332245">(</span><span class="ident" id="5332246">c</span><span class="op" id="5332247">.</span><span class="ident" id="5332248">p</span><span class="op" id="5332249">,</span>&nbsp;<span class="ident" id="5332251">f1</span><span class="op" id="5332253">.</span><span class="ident" id="5332254">out</span><span class="op" id="5332257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332260">return</span>&nbsp;<span class="ident" id="5332267">f</span><br>
<span class="lineno"></span><span class="op" id="5332269">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="5332272">func</span>&nbsp;<span class="op" id="5332277">(</span><span class="ident" id="5332278">c</span>&nbsp;<span class="op" id="5332280">*</span><span class="ident" id="5332281">compiler</span><span class="op" id="5332289">)</span>&nbsp;<span class="ident" id="5332291">star</span><span class="op" id="5332295">(</span><span class="ident" id="5332296">f1</span>&nbsp;<span class="ident" id="5332299">frag</span><span class="op" id="5332303">,</span>&nbsp;<span class="ident" id="5332305">nongreedy</span>&nbsp;<span class="builtintype" id="5332315">bool</span><span class="op" id="5332319">)</span>&nbsp;<span class="ident" id="5332321">frag</span>&nbsp;<span class="op" id="5332326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332329">f</span>&nbsp;<span class="op" id="5332331">:=</span>&nbsp;<span class="ident" id="5332334">c</span><span class="op" id="5332335">.</span><span class="ident" id="5332336">inst</span><span class="op" id="5332340">(</span><span class="ident" id="5332341">InstAlt</span><span class="op" id="5332348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332351">i</span>&nbsp;<span class="op" id="5332353">:=</span>&nbsp;<span class="op" id="5332356">&amp;</span><span class="ident" id="5332357">c</span><span class="op" id="5332358">.</span><span class="ident" id="5332359">p</span><span class="op" id="5332360">.</span><span class="ident" id="5332361">Inst</span><span class="op" id="5332365">[</span><span class="ident" id="5332366">f</span><span class="op" id="5332367">.</span><span class="ident" id="5332368">i</span><span class="op" id="5332369">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332372">if</span>&nbsp;<span class="ident" id="5332375">nongreedy</span>&nbsp;<span class="op" id="5332385">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332389">i</span><span class="op" id="5332390">.</span><span class="ident" id="5332391">Arg</span>&nbsp;<span class="op" id="5332395">=</span>&nbsp;<span class="ident" id="5332397">f1</span><span class="op" id="5332399">.</span><span class="ident" id="5332400">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332404">f</span><span class="op" id="5332405">.</span><span class="ident" id="5332406">out</span>&nbsp;<span class="op" id="5332410">=</span>&nbsp;<span class="ident" id="5332412">patchList</span><span class="op" id="5332421">(</span><span class="ident" id="5332422">f</span><span class="op" id="5332423">.</span><span class="ident" id="5332424">i</span>&nbsp;<span class="op" id="5332426">&lt;&lt;</span>&nbsp;<span class="num" id="5332429">1</span><span class="op" id="5332430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332433">}</span>&nbsp;<span class="keyword" id="5332435">else</span>&nbsp;<span class="op" id="5332440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332444">i</span><span class="op" id="5332445">.</span><span class="ident" id="5332446">Out</span>&nbsp;<span class="op" id="5332450">=</span>&nbsp;<span class="ident" id="5332452">f1</span><span class="op" id="5332454">.</span><span class="ident" id="5332455">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332459">f</span><span class="op" id="5332460">.</span><span class="ident" id="5332461">out</span>&nbsp;<span class="op" id="5332465">=</span>&nbsp;<span class="ident" id="5332467">patchList</span><span class="op" id="5332476">(</span><span class="ident" id="5332477">f</span><span class="op" id="5332478">.</span><span class="ident" id="5332479">i</span><span class="op" id="5332480">&lt;&lt;</span><span class="num" id="5332482">1</span>&nbsp;<span class="op" id="5332484">|</span>&nbsp;<span class="num" id="5332486">1</span><span class="op" id="5332487">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332493">f1</span><span class="op" id="5332495">.</span><span class="ident" id="5332496">out</span><span class="op" id="5332499">.</span><span class="ident" id="5332500">patch</span><span class="op" id="5332505">(</span><span class="ident" id="5332506">c</span><span class="op" id="5332507">.</span><span class="ident" id="5332508">p</span><span class="op" id="5332509">,</span>&nbsp;<span class="ident" id="5332511">f</span><span class="op" id="5332512">.</span><span class="ident" id="5332513">i</span><span class="op" id="5332514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332517">return</span>&nbsp;<span class="ident" id="5332524">f</span><br>
<span class="lineno"></span><span class="op" id="5332526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="5332529">func</span>&nbsp;<span class="op" id="5332534">(</span><span class="ident" id="5332535">c</span>&nbsp;<span class="op" id="5332537">*</span><span class="ident" id="5332538">compiler</span><span class="op" id="5332546">)</span>&nbsp;<span class="ident" id="5332548">plus</span><span class="op" id="5332552">(</span><span class="ident" id="5332553">f1</span>&nbsp;<span class="ident" id="5332556">frag</span><span class="op" id="5332560">,</span>&nbsp;<span class="ident" id="5332562">nongreedy</span>&nbsp;<span class="builtintype" id="5332572">bool</span><span class="op" id="5332576">)</span>&nbsp;<span class="ident" id="5332578">frag</span>&nbsp;<span class="op" id="5332583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332586">return</span>&nbsp;<span class="ident" id="5332593">frag</span><span class="op" id="5332597">{</span><span class="ident" id="5332598">f1</span><span class="op" id="5332600">.</span><span class="ident" id="5332601">i</span><span class="op" id="5332602">,</span>&nbsp;<span class="ident" id="5332604">c</span><span class="op" id="5332605">.</span><span class="ident" id="5332606">star</span><span class="op" id="5332610">(</span><span class="ident" id="5332611">f1</span><span class="op" id="5332613">,</span>&nbsp;<span class="ident" id="5332615">nongreedy</span><span class="op" id="5332624">)</span><span class="op" id="5332625">.</span><span class="ident" id="5332626">out</span><span class="op" id="5332629">}</span><br>
<span class="lineno"></span><span class="op" id="5332631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5332634">func</span>&nbsp;<span class="op" id="5332639">(</span><span class="ident" id="5332640">c</span>&nbsp;<span class="op" id="5332642">*</span><span class="ident" id="5332643">compiler</span><span class="op" id="5332651">)</span>&nbsp;<span class="ident" id="5332653">empty</span><span class="op" id="5332658">(</span><span class="ident" id="5332659">op</span>&nbsp;<span class="ident" id="5332662">EmptyOp</span><span class="op" id="5332669">)</span>&nbsp;<span class="ident" id="5332671">frag</span>&nbsp;<span class="op" id="5332676">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332679">f</span>&nbsp;<span class="op" id="5332681">:=</span>&nbsp;<span class="ident" id="5332684">c</span><span class="op" id="5332685">.</span><span class="ident" id="5332686">inst</span><span class="op" id="5332690">(</span><span class="ident" id="5332691">InstEmptyWidth</span><span class="op" id="5332705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332708">c</span><span class="op" id="5332709">.</span><span class="ident" id="5332710">p</span><span class="op" id="5332711">.</span><span class="ident" id="5332712">Inst</span><span class="op" id="5332716">[</span><span class="ident" id="5332717">f</span><span class="op" id="5332718">.</span><span class="ident" id="5332719">i</span><span class="op" id="5332720">]</span><span class="op" id="5332721">.</span><span class="ident" id="5332722">Arg</span>&nbsp;<span class="op" id="5332726">=</span>&nbsp;<span class="builtintype" id="5332728">uint32</span><span class="op" id="5332734">(</span><span class="ident" id="5332735">op</span><span class="op" id="5332737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332740">f</span><span class="op" id="5332741">.</span><span class="ident" id="5332742">out</span>&nbsp;<span class="op" id="5332746">=</span>&nbsp;<span class="ident" id="5332748">patchList</span><span class="op" id="5332757">(</span><span class="ident" id="5332758">f</span><span class="op" id="5332759">.</span><span class="ident" id="5332760">i</span>&nbsp;<span class="op" id="5332762">&lt;&lt;</span>&nbsp;<span class="num" id="5332765">1</span><span class="op" id="5332766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332769">return</span>&nbsp;<span class="ident" id="5332776">f</span><br>
<span class="lineno"></span><span class="op" id="5332778">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="5332781">func</span>&nbsp;<span class="op" id="5332786">(</span><span class="ident" id="5332787">c</span>&nbsp;<span class="op" id="5332789">*</span><span class="ident" id="5332790">compiler</span><span class="op" id="5332798">)</span>&nbsp;<span class="builtintype" id="5332800">rune</span><span class="op" id="5332804">(</span><span class="ident" id="5332805">r</span>&nbsp;<span class="op" id="5332807">[</span><span class="op" id="5332808">]</span><span class="builtintype" id="5332809">rune</span><span class="op" id="5332813">,</span>&nbsp;<span class="ident" id="5332815">flags</span>&nbsp;<span class="ident" id="5332821">Flags</span><span class="op" id="5332826">)</span>&nbsp;<span class="ident" id="5332828">frag</span>&nbsp;<span class="op" id="5332833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332836">f</span>&nbsp;<span class="op" id="5332838">:=</span>&nbsp;<span class="ident" id="5332841">c</span><span class="op" id="5332842">.</span><span class="ident" id="5332843">inst</span><span class="op" id="5332847">(</span><span class="ident" id="5332848">InstRune</span><span class="op" id="5332856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332859">i</span>&nbsp;<span class="op" id="5332861">:=</span>&nbsp;<span class="op" id="5332864">&amp;</span><span class="ident" id="5332865">c</span><span class="op" id="5332866">.</span><span class="ident" id="5332867">p</span><span class="op" id="5332868">.</span><span class="ident" id="5332869">Inst</span><span class="op" id="5332873">[</span><span class="ident" id="5332874">f</span><span class="op" id="5332875">.</span><span class="ident" id="5332876">i</span><span class="op" id="5332877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332880">i</span><span class="op" id="5332881">.</span><span class="ident" id="5332882">Rune</span>&nbsp;<span class="op" id="5332887">=</span>&nbsp;<span class="ident" id="5332889">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332892">flags</span>&nbsp;<span class="op" id="5332898">&amp;=</span>&nbsp;<span class="ident" id="5332901">FoldCase</span>&nbsp;<span class="comment" id="5332910">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332945">if</span>&nbsp;<span class="builtinfunc" id="5332948">len</span><span class="op" id="5332951">(</span><span class="ident" id="5332952">r</span><span class="op" id="5332953">)</span>&nbsp;<span class="op" id="5332955">!=</span>&nbsp;<span class="num" id="5332958">1</span>&nbsp;<span class="op" id="5332960">||</span>&nbsp;<span class="ident" id="5332963">unicode</span><span class="op" id="5332970">.</span><span class="ident" id="5332971">SimpleFold</span><span class="op" id="5332981">(</span><span class="ident" id="5332982">r</span><span class="op" id="5332983">[</span><span class="num" id="5332984">0</span><span class="op" id="5332985">]</span><span class="op" id="5332986">)</span>&nbsp;<span class="op" id="5332988">==</span>&nbsp;<span class="ident" id="5332991">r</span><span class="op" id="5332992">[</span><span class="num" id="5332993">0</span><span class="op" id="5332994">]</span>&nbsp;<span class="op" id="5332996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333000">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333033">flags</span>&nbsp;<span class="op" id="5333039">&amp;^=</span>&nbsp;<span class="ident" id="5333043">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5333053">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333056">i</span><span class="op" id="5333057">.</span><span class="ident" id="5333058">Arg</span>&nbsp;<span class="op" id="5333062">=</span>&nbsp;<span class="builtintype" id="5333064">uint32</span><span class="op" id="5333070">(</span><span class="ident" id="5333071">flags</span><span class="op" id="5333076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333079">f</span><span class="op" id="5333080">.</span><span class="ident" id="5333081">out</span>&nbsp;<span class="op" id="5333085">=</span>&nbsp;<span class="ident" id="5333087">patchList</span><span class="op" id="5333096">(</span><span class="ident" id="5333097">f</span><span class="op" id="5333098">.</span><span class="ident" id="5333099">i</span>&nbsp;<span class="op" id="5333101">&lt;&lt;</span>&nbsp;<span class="num" id="5333104">1</span><span class="op" id="5333105">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333109">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333145">switch</span>&nbsp;<span class="op" id="5333152">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333155">case</span>&nbsp;<span class="ident" id="5333160">flags</span><span class="op" id="5333165">&amp;</span><span class="ident" id="5333166">FoldCase</span>&nbsp;<span class="op" id="5333175">==</span>&nbsp;<span class="num" id="5333178">0</span>&nbsp;<span class="op" id="5333180">&amp;&amp;</span>&nbsp;<span class="op" id="5333183">(</span><span class="builtinfunc" id="5333184">len</span><span class="op" id="5333187">(</span><span class="ident" id="5333188">r</span><span class="op" id="5333189">)</span>&nbsp;<span class="op" id="5333191">==</span>&nbsp;<span class="num" id="5333194">1</span>&nbsp;<span class="op" id="5333196">||</span>&nbsp;<span class="builtinfunc" id="5333199">len</span><span class="op" id="5333202">(</span><span class="ident" id="5333203">r</span><span class="op" id="5333204">)</span>&nbsp;<span class="op" id="5333206">==</span>&nbsp;<span class="num" id="5333209">2</span>&nbsp;<span class="op" id="5333211">&amp;&amp;</span>&nbsp;<span class="ident" id="5333214">r</span><span class="op" id="5333215">[</span><span class="num" id="5333216">0</span><span class="op" id="5333217">]</span>&nbsp;<span class="op" id="5333219">==</span>&nbsp;<span class="ident" id="5333222">r</span><span class="op" id="5333223">[</span><span class="num" id="5333224">1</span><span class="op" id="5333225">]</span><span class="op" id="5333226">)</span><span class="op" id="5333227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333231">i</span><span class="op" id="5333232">.</span><span class="ident" id="5333233">Op</span>&nbsp;<span class="op" id="5333236">=</span>&nbsp;<span class="ident" id="5333238">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333249">case</span>&nbsp;<span class="builtinfunc" id="5333254">len</span><span class="op" id="5333257">(</span><span class="ident" id="5333258">r</span><span class="op" id="5333259">)</span>&nbsp;<span class="op" id="5333261">==</span>&nbsp;<span class="num" id="5333264">2</span>&nbsp;<span class="op" id="5333266">&amp;&amp;</span>&nbsp;<span class="ident" id="5333269">r</span><span class="op" id="5333270">[</span><span class="num" id="5333271">0</span><span class="op" id="5333272">]</span>&nbsp;<span class="op" id="5333274">==</span>&nbsp;<span class="num" id="5333277">0</span>&nbsp;<span class="op" id="5333279">&amp;&amp;</span>&nbsp;<span class="ident" id="5333282">r</span><span class="op" id="5333283">[</span><span class="num" id="5333284">1</span><span class="op" id="5333285">]</span>&nbsp;<span class="op" id="5333287">==</span>&nbsp;<span class="ident" id="5333290">unicode</span><span class="op" id="5333297">.</span><span class="ident" id="5333298">MaxRune</span><span class="op" id="5333305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333309">i</span><span class="op" id="5333310">.</span><span class="ident" id="5333311">Op</span>&nbsp;<span class="op" id="5333314">=</span>&nbsp;<span class="ident" id="5333316">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333329">case</span>&nbsp;<span class="builtinfunc" id="5333334">len</span><span class="op" id="5333337">(</span><span class="ident" id="5333338">r</span><span class="op" id="5333339">)</span>&nbsp;<span class="op" id="5333341">==</span>&nbsp;<span class="num" id="5333344">4</span>&nbsp;<span class="op" id="5333346">&amp;&amp;</span>&nbsp;<span class="ident" id="5333349">r</span><span class="op" id="5333350">[</span><span class="num" id="5333351">0</span><span class="op" id="5333352">]</span>&nbsp;<span class="op" id="5333354">==</span>&nbsp;<span class="num" id="5333357">0</span>&nbsp;<span class="op" id="5333359">&amp;&amp;</span>&nbsp;<span class="ident" id="5333362">r</span><span class="op" id="5333363">[</span><span class="num" id="5333364">1</span><span class="op" id="5333365">]</span>&nbsp;<span class="op" id="5333367">==</span>&nbsp;<span class="string" id="5333370">&#39;\n&#39;</span><span class="op" id="5333374">-</span><span class="num" id="5333375">1</span>&nbsp;<span class="op" id="5333377">&amp;&amp;</span>&nbsp;<span class="ident" id="5333380">r</span><span class="op" id="5333381">[</span><span class="num" id="5333382">2</span><span class="op" id="5333383">]</span>&nbsp;<span class="op" id="5333385">==</span>&nbsp;<span class="string" id="5333388">&#39;\n&#39;</span><span class="op" id="5333392">+</span><span class="num" id="5333393">1</span>&nbsp;<span class="op" id="5333395">&amp;&amp;</span>&nbsp;<span class="ident" id="5333398">r</span><span class="op" id="5333399">[</span><span class="num" id="5333400">3</span><span class="op" id="5333401">]</span>&nbsp;<span class="op" id="5333403">==</span>&nbsp;<span class="ident" id="5333406">unicode</span><span class="op" id="5333413">.</span><span class="ident" id="5333414">MaxRune</span><span class="op" id="5333421">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333425">i</span><span class="op" id="5333426">.</span><span class="ident" id="5333427">Op</span>&nbsp;<span class="op" id="5333430">=</span>&nbsp;<span class="ident" id="5333432">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5333450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333454">return</span>&nbsp;<span class="ident" id="5333461">f</span><br>
<span class="lineno"></span><span class="op" id="5333463">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
