<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/pprof</h2>
<ul>
<li><a href="/gostd/runtime/pprof/mprof_test.go.html">mprof_test.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof.go.html">pprof.go</a></li>
<li><a href="/gostd/runtime/pprof/pprof_test.go.html" class="current">pprof_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="981775">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="981831">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="981885">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="981936">//&nbsp;+build&nbsp;!nacl</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="981953">package</span>&nbsp;<span class="ident" id="981961">pprof_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="981973">import</span>&nbsp;<span class="op" id="981980">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="981983">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="981992">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="981999">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982011">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982022">&#34;regexp&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982032">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982043">.</span>&nbsp;<span class="string" id="982045">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982062">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982073">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982081">&#34;testing&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982092">&#34;time&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="982100">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="982109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="982112">func</span>&nbsp;<span class="ident" id="982117">cpuHogger</span><span class="op" id="982126">(</span><span class="ident" id="982127">f</span>&nbsp;<span class="keyword" id="982129">func</span><span class="op" id="982133">(</span><span class="op" id="982134">)</span><span class="op" id="982135">)</span>&nbsp;<span class="op" id="982137">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="982140">//&nbsp;We&nbsp;only&nbsp;need&nbsp;to&nbsp;get&nbsp;one&nbsp;100&nbsp;Hz&nbsp;clock&nbsp;tick,&nbsp;so&nbsp;we&#39;ve&nbsp;got</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="982200">//&nbsp;a&nbsp;25x&nbsp;safety&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="982225">//&nbsp;But&nbsp;do&nbsp;at&nbsp;least&nbsp;500&nbsp;iterations&nbsp;(which&nbsp;should&nbsp;take&nbsp;about&nbsp;100ms),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="982293">//&nbsp;otherwise&nbsp;TestCPUProfileMultithreaded&nbsp;can&nbsp;fail&nbsp;if&nbsp;only&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="982356">//&nbsp;thread&nbsp;is&nbsp;scheduled&nbsp;during&nbsp;the&nbsp;250ms&nbsp;period.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982405">t0</span>&nbsp;<span class="op" id="982408">:=</span>&nbsp;<span class="ident" id="982411">time</span><span class="op" id="982415">.</span><span class="ident" id="982416">Now</span><span class="op" id="982419">(</span><span class="op" id="982420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="982423">for</span>&nbsp;<span class="ident" id="982427">i</span>&nbsp;<span class="op" id="982429">:=</span>&nbsp;<span class="num" id="982432">0</span><span class="op" id="982433">;</span>&nbsp;<span class="ident" id="982435">i</span>&nbsp;<span class="op" id="982437">&lt;</span>&nbsp;<span class="num" id="982439">500</span>&nbsp;<span class="op" id="982443">||</span>&nbsp;<span class="ident" id="982446">time</span><span class="op" id="982450">.</span><span class="ident" id="982451">Since</span><span class="op" id="982456">(</span><span class="ident" id="982457">t0</span><span class="op" id="982459">)</span>&nbsp;<span class="op" id="982461">&lt;</span>&nbsp;<span class="num" id="982463">250</span><span class="op" id="982466">*</span><span class="ident" id="982467">time</span><span class="op" id="982471">.</span><span class="ident" id="982472">Millisecond</span><span class="op" id="982483">;</span>&nbsp;<span class="ident" id="982485">i</span><span class="op" id="982486">++</span>&nbsp;<span class="op" id="982489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982493">f</span><span class="op" id="982494">(</span><span class="op" id="982495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982498">}</span><br>
<span class="lineno"></span><span class="op" id="982500">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="982503">var</span>&nbsp;<span class="op" id="982507">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982510">salt1</span>&nbsp;<span class="op" id="982516">=</span>&nbsp;<span class="num" id="982518">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982521">salt2</span>&nbsp;<span class="op" id="982527">=</span>&nbsp;<span class="num" id="982529">0</span><br>
<span class="lineno"></span><span class="op" id="982531">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="982534">//&nbsp;The&nbsp;actual&nbsp;CPU&nbsp;hogging&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="982570">//&nbsp;Must&nbsp;not&nbsp;call&nbsp;other&nbsp;functions&nbsp;nor&nbsp;access&nbsp;heap/globals&nbsp;in&nbsp;the&nbsp;loop,</span><br>
<span class="lineno"></span><span class="comment" id="982640">//&nbsp;otherwise&nbsp;under&nbsp;race&nbsp;detector&nbsp;the&nbsp;samples&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;race&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="982714">func</span>&nbsp;<span class="ident" id="982719">cpuHog1</span><span class="op" id="982726">(</span><span class="op" id="982727">)</span>&nbsp;<span class="op" id="982729">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982732">foo</span>&nbsp;<span class="op" id="982736">:=</span>&nbsp;<span class="ident" id="982739">salt1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="982746">for</span>&nbsp;<span class="ident" id="982750">i</span>&nbsp;<span class="op" id="982752">:=</span>&nbsp;<span class="num" id="982755">0</span><span class="op" id="982756">;</span>&nbsp;<span class="ident" id="982758">i</span>&nbsp;<span class="op" id="982760">&lt;</span>&nbsp;<span class="num" id="982762">1e5</span><span class="op" id="982765">;</span>&nbsp;<span class="ident" id="982767">i</span><span class="op" id="982768">++</span>&nbsp;<span class="op" id="982771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="982775">if</span>&nbsp;<span class="ident" id="982778">foo</span>&nbsp;<span class="op" id="982782">&gt;</span>&nbsp;<span class="num" id="982784">0</span>&nbsp;<span class="op" id="982786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982791">foo</span>&nbsp;<span class="op" id="982795">*=</span>&nbsp;<span class="ident" id="982798">foo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982804">}</span>&nbsp;<span class="keyword" id="982806">else</span>&nbsp;<span class="op" id="982811">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982816">foo</span>&nbsp;<span class="op" id="982820">*=</span>&nbsp;<span class="ident" id="982823">foo</span>&nbsp;<span class="op" id="982827">+</span>&nbsp;<span class="num" id="982829">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982839">salt1</span>&nbsp;<span class="op" id="982845">=</span>&nbsp;<span class="ident" id="982847">foo</span><br>
<span class="lineno"></span><span class="op" id="982851">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="982854">func</span>&nbsp;<span class="ident" id="982859">cpuHog2</span><span class="op" id="982866">(</span><span class="op" id="982867">)</span>&nbsp;<span class="op" id="982869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982872">foo</span>&nbsp;<span class="op" id="982876">:=</span>&nbsp;<span class="ident" id="982879">salt2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="982886">for</span>&nbsp;<span class="ident" id="982890">i</span>&nbsp;<span class="op" id="982892">:=</span>&nbsp;<span class="num" id="982895">0</span><span class="op" id="982896">;</span>&nbsp;<span class="ident" id="982898">i</span>&nbsp;<span class="op" id="982900">&lt;</span>&nbsp;<span class="num" id="982902">1e5</span><span class="op" id="982905">;</span>&nbsp;<span class="ident" id="982907">i</span><span class="op" id="982908">++</span>&nbsp;<span class="op" id="982911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="982915">if</span>&nbsp;<span class="ident" id="982918">foo</span>&nbsp;<span class="op" id="982922">&gt;</span>&nbsp;<span class="num" id="982924">0</span>&nbsp;<span class="op" id="982926">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982931">foo</span>&nbsp;<span class="op" id="982935">*=</span>&nbsp;<span class="ident" id="982938">foo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982944">}</span>&nbsp;<span class="keyword" id="982946">else</span>&nbsp;<span class="op" id="982951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982956">foo</span>&nbsp;<span class="op" id="982960">*=</span>&nbsp;<span class="ident" id="982963">foo</span>&nbsp;<span class="op" id="982967">+</span>&nbsp;<span class="num" id="982969">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="982976">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="982979">salt2</span>&nbsp;<span class="op" id="982985">=</span>&nbsp;<span class="ident" id="982987">foo</span><br>
<span class="lineno"></span><span class="op" id="982991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="982994">func</span>&nbsp;<span class="ident" id="982999">TestCPUProfile</span><span class="op" id="983013">(</span><span class="ident" id="983014">t</span>&nbsp;<span class="op" id="983016">*</span><span class="ident" id="983017">testing</span><span class="op" id="983024">.</span><span class="ident" id="983025">T</span><span class="op" id="983026">)</span>&nbsp;<span class="op" id="983028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983031">testCPUProfile</span><span class="op" id="983045">(</span><span class="ident" id="983046">t</span><span class="op" id="983047">,</span>&nbsp;<span class="op" id="983049">[</span><span class="op" id="983050">]</span><span class="builtintype" id="983051">string</span><span class="op" id="983057">{</span><span class="string" id="983058">&#34;runtime/pprof_test.cpuHog1&#34;</span><span class="op" id="983086">}</span><span class="op" id="983087">,</span>&nbsp;<span class="keyword" id="983089">func</span><span class="op" id="983093">(</span><span class="op" id="983094">)</span>&nbsp;<span class="op" id="983096">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983100">cpuHogger</span><span class="op" id="983109">(</span><span class="ident" id="983110">cpuHog1</span><span class="op" id="983117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="983120">}</span><span class="op" id="983121">)</span><br>
<span class="lineno"></span><span class="op" id="983123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="983126">func</span>&nbsp;<span class="ident" id="983131">TestCPUProfileMultithreaded</span><span class="op" id="983158">(</span><span class="ident" id="983159">t</span>&nbsp;<span class="op" id="983161">*</span><span class="ident" id="983162">testing</span><span class="op" id="983169">.</span><span class="ident" id="983170">T</span><span class="op" id="983171">)</span>&nbsp;<span class="op" id="983173">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="983176">defer</span>&nbsp;<span class="ident" id="983182">runtime</span><span class="op" id="983189">.</span><span class="ident" id="983190">GOMAXPROCS</span><span class="op" id="983200">(</span><span class="ident" id="983201">runtime</span><span class="op" id="983208">.</span><span class="ident" id="983209">GOMAXPROCS</span><span class="op" id="983219">(</span><span class="num" id="983220">2</span><span class="op" id="983221">)</span><span class="op" id="983222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983225">testCPUProfile</span><span class="op" id="983239">(</span><span class="ident" id="983240">t</span><span class="op" id="983241">,</span>&nbsp;<span class="op" id="983243">[</span><span class="op" id="983244">]</span><span class="builtintype" id="983245">string</span><span class="op" id="983251">{</span><span class="string" id="983252">&#34;runtime/pprof_test.cpuHog1&#34;</span><span class="op" id="983280">,</span>&nbsp;<span class="string" id="983282">&#34;runtime/pprof_test.cpuHog2&#34;</span><span class="op" id="983310">}</span><span class="op" id="983311">,</span>&nbsp;<span class="keyword" id="983313">func</span><span class="op" id="983317">(</span><span class="op" id="983318">)</span>&nbsp;<span class="op" id="983320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983324">c</span>&nbsp;<span class="op" id="983326">:=</span>&nbsp;<span class="builtinfunc" id="983329">make</span><span class="op" id="983333">(</span><span class="keyword" id="983334">chan</span>&nbsp;<span class="builtintype" id="983339">int</span><span class="op" id="983342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="983346">go</span>&nbsp;<span class="keyword" id="983349">func</span><span class="op" id="983353">(</span><span class="op" id="983354">)</span>&nbsp;<span class="op" id="983356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983361">cpuHogger</span><span class="op" id="983370">(</span><span class="ident" id="983371">cpuHog1</span><span class="op" id="983378">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983383">c</span>&nbsp;<span class="op" id="983385">&lt;-</span>&nbsp;<span class="num" id="983388">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="983392">}</span><span class="op" id="983393">(</span><span class="op" id="983394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983398">cpuHogger</span><span class="op" id="983407">(</span><span class="ident" id="983408">cpuHog2</span><span class="op" id="983415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="983419">&lt;-</span><span class="ident" id="983421">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="983424">}</span><span class="op" id="983425">)</span><br>
<span class="lineno">85</span><span class="op" id="983427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="983430">func</span>&nbsp;<span class="ident" id="983435">parseProfile</span><span class="op" id="983447">(</span><span class="ident" id="983448">t</span>&nbsp;<span class="op" id="983450">*</span><span class="ident" id="983451">testing</span><span class="op" id="983458">.</span><span class="ident" id="983459">T</span><span class="op" id="983460">,</span>&nbsp;<span class="ident" id="983462">bytes</span>&nbsp;<span class="op" id="983468">[</span><span class="op" id="983469">]</span><span class="builtintype" id="983470">byte</span><span class="op" id="983474">,</span>&nbsp;<span class="ident" id="983476">f</span>&nbsp;<span class="keyword" id="983478">func</span><span class="op" id="983482">(</span><span class="builtintype" id="983483">uintptr</span><span class="op" id="983490">,</span>&nbsp;<span class="op" id="983492">[</span><span class="op" id="983493">]</span><span class="builtintype" id="983494">uintptr</span><span class="op" id="983501">)</span><span class="op" id="983502">)</span>&nbsp;<span class="op" id="983504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="983507">//&nbsp;Convert&nbsp;[]byte&nbsp;to&nbsp;[]uintptr.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983540">l</span>&nbsp;<span class="op" id="983542">:=</span>&nbsp;<span class="builtinfunc" id="983545">len</span><span class="op" id="983548">(</span><span class="ident" id="983549">bytes</span><span class="op" id="983554">)</span>&nbsp;<span class="op" id="983556">/</span>&nbsp;<span class="builtintype" id="983558">int</span><span class="op" id="983561">(</span><span class="ident" id="983562">unsafe</span><span class="op" id="983568">.</span><span class="ident" id="983569">Sizeof</span><span class="op" id="983575">(</span><span class="builtintype" id="983576">uintptr</span><span class="op" id="983583">(</span><span class="num" id="983584">0</span><span class="op" id="983585">)</span><span class="op" id="983586">)</span><span class="op" id="983587">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983590">val</span>&nbsp;<span class="op" id="983594">:=</span>&nbsp;<span class="op" id="983597">*</span><span class="op" id="983598">(</span><span class="op" id="983599">*</span><span class="op" id="983600">[</span><span class="op" id="983601">]</span><span class="builtintype" id="983602">uintptr</span><span class="op" id="983609">)</span><span class="op" id="983610">(</span><span class="ident" id="983611">unsafe</span><span class="op" id="983617">.</span><span class="ident" id="983618">Pointer</span><span class="op" id="983625">(</span><span class="op" id="983626">&amp;</span><span class="ident" id="983627">bytes</span><span class="op" id="983632">)</span><span class="op" id="983633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983636">val</span>&nbsp;<span class="op" id="983640">=</span>&nbsp;<span class="ident" id="983642">val</span><span class="op" id="983645">[</span><span class="op" id="983646">:</span><span class="ident" id="983647">l</span><span class="op" id="983648">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="983652">//&nbsp;5&nbsp;for&nbsp;the&nbsp;header,&nbsp;2&nbsp;for&nbsp;the&nbsp;per-sample&nbsp;header&nbsp;on&nbsp;at&nbsp;least&nbsp;one&nbsp;sample,&nbsp;3&nbsp;for&nbsp;the&nbsp;trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="983745">if</span>&nbsp;<span class="ident" id="983748">l</span>&nbsp;<span class="op" id="983750">&lt;</span>&nbsp;<span class="num" id="983752">5</span><span class="op" id="983753">+</span><span class="num" id="983754">2</span><span class="op" id="983755">+</span><span class="num" id="983756">3</span>&nbsp;<span class="op" id="983758">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983762">t</span><span class="op" id="983763">.</span><span class="ident" id="983764">Logf</span><span class="op" id="983768">(</span><span class="string" id="983769">&#34;profile&nbsp;too&nbsp;short:&nbsp;%#x&#34;</span><span class="op" id="983793">,</span>&nbsp;<span class="ident" id="983795">val</span><span class="op" id="983798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="983802">if</span>&nbsp;<span class="ident" id="983805">badOS</span><span class="op" id="983810">[</span><span class="ident" id="983811">runtime</span><span class="op" id="983818">.</span><span class="ident" id="983819">GOOS</span><span class="op" id="983823">]</span>&nbsp;<span class="op" id="983825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983830">t</span><span class="op" id="983831">.</span><span class="ident" id="983832">Skipf</span><span class="op" id="983837">(</span><span class="string" id="983838">&#34;ignoring&nbsp;failure&nbsp;on&nbsp;%s;&nbsp;see&nbsp;golang.org/issue/6047&#34;</span><span class="op" id="983889">,</span>&nbsp;<span class="ident" id="983891">runtime</span><span class="op" id="983898">.</span><span class="ident" id="983899">GOOS</span><span class="op" id="983903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="983908">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="983917">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983921">t</span><span class="op" id="983922">.</span><span class="ident" id="983923">FailNow</span><span class="op" id="983930">(</span><span class="op" id="983931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="983934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="983938">hd</span><span class="op" id="983940">,</span>&nbsp;<span class="ident" id="983942">val</span><span class="op" id="983945">,</span>&nbsp;<span class="ident" id="983947">tl</span>&nbsp;<span class="op" id="983950">:=</span>&nbsp;<span class="ident" id="983953">val</span><span class="op" id="983956">[</span><span class="op" id="983957">:</span><span class="num" id="983958">5</span><span class="op" id="983959">]</span><span class="op" id="983960">,</span>&nbsp;<span class="ident" id="983962">val</span><span class="op" id="983965">[</span><span class="num" id="983966">5</span><span class="op" id="983967">:</span><span class="ident" id="983968">l</span><span class="op" id="983969">-</span><span class="num" id="983970">3</span><span class="op" id="983971">]</span><span class="op" id="983972">,</span>&nbsp;<span class="ident" id="983974">val</span><span class="op" id="983977">[</span><span class="ident" id="983978">l</span><span class="op" id="983979">-</span><span class="num" id="983980">3</span><span class="op" id="983981">:</span><span class="op" id="983982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="983985">if</span>&nbsp;<span class="ident" id="983988">hd</span><span class="op" id="983990">[</span><span class="num" id="983991">0</span><span class="op" id="983992">]</span>&nbsp;<span class="op" id="983994">!=</span>&nbsp;<span class="num" id="983997">0</span>&nbsp;<span class="op" id="983999">||</span>&nbsp;<span class="ident" id="984002">hd</span><span class="op" id="984004">[</span><span class="num" id="984005">1</span><span class="op" id="984006">]</span>&nbsp;<span class="op" id="984008">!=</span>&nbsp;<span class="num" id="984011">3</span>&nbsp;<span class="op" id="984013">||</span>&nbsp;<span class="ident" id="984016">hd</span><span class="op" id="984018">[</span><span class="num" id="984019">2</span><span class="op" id="984020">]</span>&nbsp;<span class="op" id="984022">!=</span>&nbsp;<span class="num" id="984025">0</span>&nbsp;<span class="op" id="984027">||</span>&nbsp;<span class="ident" id="984030">hd</span><span class="op" id="984032">[</span><span class="num" id="984033">3</span><span class="op" id="984034">]</span>&nbsp;<span class="op" id="984036">!=</span>&nbsp;<span class="num" id="984039">1e6</span><span class="op" id="984042">/</span><span class="num" id="984043">100</span>&nbsp;<span class="op" id="984047">||</span>&nbsp;<span class="ident" id="984050">hd</span><span class="op" id="984052">[</span><span class="num" id="984053">4</span><span class="op" id="984054">]</span>&nbsp;<span class="op" id="984056">!=</span>&nbsp;<span class="num" id="984059">0</span>&nbsp;<span class="op" id="984061">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984065">t</span><span class="op" id="984066">.</span><span class="ident" id="984067">Fatalf</span><span class="op" id="984073">(</span><span class="string" id="984074">&#34;unexpected&nbsp;header&nbsp;%#x&#34;</span><span class="op" id="984097">,</span>&nbsp;<span class="ident" id="984099">hd</span><span class="op" id="984101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984108">if</span>&nbsp;<span class="ident" id="984111">tl</span><span class="op" id="984113">[</span><span class="num" id="984114">0</span><span class="op" id="984115">]</span>&nbsp;<span class="op" id="984117">!=</span>&nbsp;<span class="num" id="984120">0</span>&nbsp;<span class="op" id="984122">||</span>&nbsp;<span class="ident" id="984125">tl</span><span class="op" id="984127">[</span><span class="num" id="984128">1</span><span class="op" id="984129">]</span>&nbsp;<span class="op" id="984131">!=</span>&nbsp;<span class="num" id="984134">1</span>&nbsp;<span class="op" id="984136">||</span>&nbsp;<span class="ident" id="984139">tl</span><span class="op" id="984141">[</span><span class="num" id="984142">2</span><span class="op" id="984143">]</span>&nbsp;<span class="op" id="984145">!=</span>&nbsp;<span class="num" id="984148">0</span>&nbsp;<span class="op" id="984150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984154">t</span><span class="op" id="984155">.</span><span class="ident" id="984156">Fatalf</span><span class="op" id="984162">(</span><span class="string" id="984163">&#34;malformed&nbsp;end-of-data&nbsp;marker&nbsp;%#x&#34;</span><span class="op" id="984197">,</span>&nbsp;<span class="ident" id="984199">tl</span><span class="op" id="984201">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984208">for</span>&nbsp;<span class="builtinfunc" id="984212">len</span><span class="op" id="984215">(</span><span class="ident" id="984216">val</span><span class="op" id="984219">)</span>&nbsp;<span class="op" id="984221">&gt;</span>&nbsp;<span class="num" id="984223">0</span>&nbsp;<span class="op" id="984225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984229">if</span>&nbsp;<span class="builtinfunc" id="984232">len</span><span class="op" id="984235">(</span><span class="ident" id="984236">val</span><span class="op" id="984239">)</span>&nbsp;<span class="op" id="984241">&lt;</span>&nbsp;<span class="num" id="984243">2</span>&nbsp;<span class="op" id="984245">||</span>&nbsp;<span class="ident" id="984248">val</span><span class="op" id="984251">[</span><span class="num" id="984252">0</span><span class="op" id="984253">]</span>&nbsp;<span class="op" id="984255">&lt;</span>&nbsp;<span class="num" id="984257">1</span>&nbsp;<span class="op" id="984259">||</span>&nbsp;<span class="ident" id="984262">val</span><span class="op" id="984265">[</span><span class="num" id="984266">1</span><span class="op" id="984267">]</span>&nbsp;<span class="op" id="984269">&lt;</span>&nbsp;<span class="num" id="984271">1</span>&nbsp;<span class="op" id="984273">||</span>&nbsp;<span class="builtintype" id="984276">uintptr</span><span class="op" id="984283">(</span><span class="builtinfunc" id="984284">len</span><span class="op" id="984287">(</span><span class="ident" id="984288">val</span><span class="op" id="984291">)</span><span class="op" id="984292">)</span>&nbsp;<span class="op" id="984294">&lt;</span>&nbsp;<span class="num" id="984296">2</span><span class="op" id="984297">+</span><span class="ident" id="984298">val</span><span class="op" id="984301">[</span><span class="num" id="984302">1</span><span class="op" id="984303">]</span>&nbsp;<span class="op" id="984305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984310">t</span><span class="op" id="984311">.</span><span class="ident" id="984312">Fatalf</span><span class="op" id="984318">(</span><span class="string" id="984319">&#34;malformed&nbsp;profile.&nbsp;&nbsp;leftover:&nbsp;%#x&#34;</span><span class="op" id="984354">,</span>&nbsp;<span class="ident" id="984356">val</span><span class="op" id="984359">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984367">f</span><span class="op" id="984368">(</span><span class="ident" id="984369">val</span><span class="op" id="984372">[</span><span class="num" id="984373">0</span><span class="op" id="984374">]</span><span class="op" id="984375">,</span>&nbsp;<span class="ident" id="984377">val</span><span class="op" id="984380">[</span><span class="num" id="984381">2</span><span class="op" id="984382">:</span><span class="num" id="984383">2</span><span class="op" id="984384">+</span><span class="ident" id="984385">val</span><span class="op" id="984388">[</span><span class="num" id="984389">1</span><span class="op" id="984390">]</span><span class="op" id="984391">]</span><span class="op" id="984392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984396">val</span>&nbsp;<span class="op" id="984400">=</span>&nbsp;<span class="ident" id="984402">val</span><span class="op" id="984405">[</span><span class="num" id="984406">2</span><span class="op" id="984407">+</span><span class="ident" id="984408">val</span><span class="op" id="984411">[</span><span class="num" id="984412">1</span><span class="op" id="984413">]</span><span class="op" id="984414">:</span><span class="op" id="984415">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984418">}</span><br>
<span class="lineno"></span><span class="op" id="984420">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="984423">func</span>&nbsp;<span class="ident" id="984428">testCPUProfile</span><span class="op" id="984442">(</span><span class="ident" id="984443">t</span>&nbsp;<span class="op" id="984445">*</span><span class="ident" id="984446">testing</span><span class="op" id="984453">.</span><span class="ident" id="984454">T</span><span class="op" id="984455">,</span>&nbsp;<span class="ident" id="984457">need</span>&nbsp;<span class="op" id="984462">[</span><span class="op" id="984463">]</span><span class="builtintype" id="984464">string</span><span class="op" id="984470">,</span>&nbsp;<span class="ident" id="984472">f</span>&nbsp;<span class="keyword" id="984474">func</span><span class="op" id="984478">(</span><span class="op" id="984479">)</span><span class="op" id="984480">)</span>&nbsp;<span class="op" id="984482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984485">switch</span>&nbsp;<span class="ident" id="984492">runtime</span><span class="op" id="984499">.</span><span class="ident" id="984500">GOOS</span>&nbsp;<span class="op" id="984505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984508">case</span>&nbsp;<span class="string" id="984513">&#34;darwin&#34;</span><span class="op" id="984521">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984525">out</span><span class="op" id="984528">,</span>&nbsp;<span class="ident" id="984530">err</span>&nbsp;<span class="op" id="984534">:=</span>&nbsp;<span class="ident" id="984537">exec</span><span class="op" id="984541">.</span><span class="ident" id="984542">Command</span><span class="op" id="984549">(</span><span class="string" id="984550">&#34;uname&#34;</span><span class="op" id="984557">,</span>&nbsp;<span class="string" id="984559">&#34;-a&#34;</span><span class="op" id="984563">)</span><span class="op" id="984564">.</span><span class="ident" id="984565">CombinedOutput</span><span class="op" id="984579">(</span><span class="op" id="984580">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984584">if</span>&nbsp;<span class="ident" id="984587">err</span>&nbsp;<span class="op" id="984591">!=</span>&nbsp;<span class="ident" id="984594">nil</span>&nbsp;<span class="op" id="984598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984603">t</span><span class="op" id="984604">.</span><span class="ident" id="984605">Fatal</span><span class="op" id="984610">(</span><span class="ident" id="984611">err</span><span class="op" id="984614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984622">vers</span>&nbsp;<span class="op" id="984627">:=</span>&nbsp;<span class="builtintype" id="984630">string</span><span class="op" id="984636">(</span><span class="ident" id="984637">out</span><span class="op" id="984640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984644">t</span><span class="op" id="984645">.</span><span class="ident" id="984646">Logf</span><span class="op" id="984650">(</span><span class="string" id="984651">&#34;uname&nbsp;-a:&nbsp;%v&#34;</span><span class="op" id="984665">,</span>&nbsp;<span class="ident" id="984667">vers</span><span class="op" id="984671">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984674">case</span>&nbsp;<span class="string" id="984679">&#34;plan9&#34;</span><span class="op" id="984686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="984690">//&nbsp;unimplemented</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984709">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984721">var</span>&nbsp;<span class="ident" id="984725">prof</span>&nbsp;<span class="ident" id="984730">bytes</span><span class="op" id="984735">.</span><span class="ident" id="984736">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984744">if</span>&nbsp;<span class="ident" id="984747">err</span>&nbsp;<span class="op" id="984751">:=</span>&nbsp;<span class="ident" id="984754">StartCPUProfile</span><span class="op" id="984769">(</span><span class="op" id="984770">&amp;</span><span class="ident" id="984771">prof</span><span class="op" id="984775">)</span><span class="op" id="984776">;</span>&nbsp;<span class="ident" id="984778">err</span>&nbsp;<span class="op" id="984782">!=</span>&nbsp;<span class="ident" id="984785">nil</span>&nbsp;<span class="op" id="984789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984793">t</span><span class="op" id="984794">.</span><span class="ident" id="984795">Fatal</span><span class="op" id="984800">(</span><span class="ident" id="984801">err</span><span class="op" id="984804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="984807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984810">f</span><span class="op" id="984811">(</span><span class="op" id="984812">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984815">StopCPUProfile</span><span class="op" id="984829">(</span><span class="op" id="984830">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="984834">//&nbsp;Check&nbsp;that&nbsp;profile&nbsp;is&nbsp;well&nbsp;formed&nbsp;and&nbsp;contains&nbsp;need.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984891">have</span>&nbsp;<span class="op" id="984896">:=</span>&nbsp;<span class="builtinfunc" id="984899">make</span><span class="op" id="984903">(</span><span class="op" id="984904">[</span><span class="op" id="984905">]</span><span class="builtintype" id="984906">uintptr</span><span class="op" id="984913">,</span>&nbsp;<span class="builtinfunc" id="984915">len</span><span class="op" id="984918">(</span><span class="ident" id="984919">need</span><span class="op" id="984923">)</span><span class="op" id="984924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="984927">parseProfile</span><span class="op" id="984939">(</span><span class="ident" id="984940">t</span><span class="op" id="984941">,</span>&nbsp;<span class="ident" id="984943">prof</span><span class="op" id="984947">.</span><span class="ident" id="984948">Bytes</span><span class="op" id="984953">(</span><span class="op" id="984954">)</span><span class="op" id="984955">,</span>&nbsp;<span class="keyword" id="984957">func</span><span class="op" id="984961">(</span><span class="ident" id="984962">count</span>&nbsp;<span class="builtintype" id="984968">uintptr</span><span class="op" id="984975">,</span>&nbsp;<span class="ident" id="984977">stk</span>&nbsp;<span class="op" id="984981">[</span><span class="op" id="984982">]</span><span class="builtintype" id="984983">uintptr</span><span class="op" id="984990">)</span>&nbsp;<span class="op" id="984992">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="984996">for</span>&nbsp;<span class="ident" id="985000">_</span><span class="op" id="985001">,</span>&nbsp;<span class="ident" id="985003">pc</span>&nbsp;<span class="op" id="985006">:=</span>&nbsp;<span class="keyword" id="985009">range</span>&nbsp;<span class="ident" id="985015">stk</span>&nbsp;<span class="op" id="985019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985024">f</span>&nbsp;<span class="op" id="985026">:=</span>&nbsp;<span class="ident" id="985029">runtime</span><span class="op" id="985036">.</span><span class="ident" id="985037">FuncForPC</span><span class="op" id="985046">(</span><span class="ident" id="985047">pc</span><span class="op" id="985049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985054">if</span>&nbsp;<span class="ident" id="985057">f</span>&nbsp;<span class="op" id="985059">==</span>&nbsp;<span class="ident" id="985062">nil</span>&nbsp;<span class="op" id="985066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985072">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985084">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985089">for</span>&nbsp;<span class="ident" id="985093">i</span><span class="op" id="985094">,</span>&nbsp;<span class="ident" id="985096">name</span>&nbsp;<span class="op" id="985101">:=</span>&nbsp;<span class="keyword" id="985104">range</span>&nbsp;<span class="ident" id="985110">need</span>&nbsp;<span class="op" id="985115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985121">if</span>&nbsp;<span class="ident" id="985124">strings</span><span class="op" id="985131">.</span><span class="ident" id="985132">Contains</span><span class="op" id="985140">(</span><span class="ident" id="985141">f</span><span class="op" id="985142">.</span><span class="ident" id="985143">Name</span><span class="op" id="985147">(</span><span class="op" id="985148">)</span><span class="op" id="985149">,</span>&nbsp;<span class="ident" id="985151">name</span><span class="op" id="985155">)</span>&nbsp;<span class="op" id="985157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985164">have</span><span class="op" id="985168">[</span><span class="ident" id="985169">i</span><span class="op" id="985170">]</span>&nbsp;<span class="op" id="985172">+=</span>&nbsp;<span class="ident" id="985175">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985190">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985197">}</span><span class="op" id="985198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985202">if</span>&nbsp;<span class="builtinfunc" id="985205">len</span><span class="op" id="985208">(</span><span class="ident" id="985209">need</span><span class="op" id="985213">)</span>&nbsp;<span class="op" id="985215">==</span>&nbsp;<span class="num" id="985218">0</span>&nbsp;<span class="op" id="985220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985224">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985236">var</span>&nbsp;<span class="ident" id="985240">total</span>&nbsp;<span class="builtintype" id="985246">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985255">for</span>&nbsp;<span class="ident" id="985259">i</span><span class="op" id="985260">,</span>&nbsp;<span class="ident" id="985262">name</span>&nbsp;<span class="op" id="985267">:=</span>&nbsp;<span class="keyword" id="985270">range</span>&nbsp;<span class="ident" id="985276">need</span>&nbsp;<span class="op" id="985281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985285">total</span>&nbsp;<span class="op" id="985291">+=</span>&nbsp;<span class="ident" id="985294">have</span><span class="op" id="985298">[</span><span class="ident" id="985299">i</span><span class="op" id="985300">]</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985304">t</span><span class="op" id="985305">.</span><span class="ident" id="985306">Logf</span><span class="op" id="985310">(</span><span class="string" id="985311">&#34;%s:&nbsp;%d\n&#34;</span><span class="op" id="985321">,</span>&nbsp;<span class="ident" id="985323">name</span><span class="op" id="985327">,</span>&nbsp;<span class="ident" id="985329">have</span><span class="op" id="985333">[</span><span class="ident" id="985334">i</span><span class="op" id="985335">]</span><span class="op" id="985336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985342">ok</span>&nbsp;<span class="op" id="985345">:=</span>&nbsp;<span class="builtintype" id="985348">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985354">if</span>&nbsp;<span class="ident" id="985357">total</span>&nbsp;<span class="op" id="985363">==</span>&nbsp;<span class="num" id="985366">0</span>&nbsp;<span class="op" id="985368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985372">t</span><span class="op" id="985373">.</span><span class="ident" id="985374">Logf</span><span class="op" id="985378">(</span><span class="string" id="985379">&#34;no&nbsp;CPU&nbsp;profile&nbsp;samples&nbsp;collected&#34;</span><span class="op" id="985413">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985417">ok</span>&nbsp;<span class="op" id="985420">=</span>&nbsp;<span class="builtintype" id="985422">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="985432">//&nbsp;We&#39;d&nbsp;like&nbsp;to&nbsp;check&nbsp;a&nbsp;reasonable&nbsp;minimum,&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="985482">//&nbsp;total&nbsp;/&nbsp;len(have)&nbsp;/&nbsp;smallconstant,&nbsp;but&nbsp;this&nbsp;test&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="985538">//&nbsp;pretty&nbsp;flaky&nbsp;(see&nbsp;bug&nbsp;7095).&nbsp;&nbsp;So&nbsp;we&#39;ll&nbsp;just&nbsp;test&nbsp;to</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="985594">//&nbsp;make&nbsp;sure&nbsp;we&nbsp;got&nbsp;at&nbsp;least&nbsp;one&nbsp;sample.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985636">min</span>&nbsp;<span class="op" id="985640">:=</span>&nbsp;<span class="builtintype" id="985643">uintptr</span><span class="op" id="985650">(</span><span class="num" id="985651">1</span><span class="op" id="985652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985655">for</span>&nbsp;<span class="ident" id="985659">i</span><span class="op" id="985660">,</span>&nbsp;<span class="ident" id="985662">name</span>&nbsp;<span class="op" id="985667">:=</span>&nbsp;<span class="keyword" id="985670">range</span>&nbsp;<span class="ident" id="985676">need</span>&nbsp;<span class="op" id="985681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985685">if</span>&nbsp;<span class="ident" id="985688">have</span><span class="op" id="985692">[</span><span class="ident" id="985693">i</span><span class="op" id="985694">]</span>&nbsp;<span class="op" id="985696">&lt;</span>&nbsp;<span class="ident" id="985698">min</span>&nbsp;<span class="op" id="985702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985707">t</span><span class="op" id="985708">.</span><span class="ident" id="985709">Logf</span><span class="op" id="985713">(</span><span class="string" id="985714">&#34;%s&nbsp;has&nbsp;%d&nbsp;samples&nbsp;out&nbsp;of&nbsp;%d,&nbsp;want&nbsp;at&nbsp;least&nbsp;%d,&nbsp;ideally&nbsp;%d&#34;</span><span class="op" id="985773">,</span>&nbsp;<span class="ident" id="985775">name</span><span class="op" id="985779">,</span>&nbsp;<span class="ident" id="985781">have</span><span class="op" id="985785">[</span><span class="ident" id="985786">i</span><span class="op" id="985787">]</span><span class="op" id="985788">,</span>&nbsp;<span class="ident" id="985790">total</span><span class="op" id="985795">,</span>&nbsp;<span class="ident" id="985797">min</span><span class="op" id="985800">,</span>&nbsp;<span class="ident" id="985802">total</span><span class="op" id="985807">/</span><span class="builtintype" id="985808">uintptr</span><span class="op" id="985815">(</span><span class="builtinfunc" id="985816">len</span><span class="op" id="985819">(</span><span class="ident" id="985820">have</span><span class="op" id="985824">)</span><span class="op" id="985825">)</span><span class="op" id="985826">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985831">ok</span>&nbsp;<span class="op" id="985834">=</span>&nbsp;<span class="builtintype" id="985836">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985851">if</span>&nbsp;<span class="op" id="985854">!</span><span class="ident" id="985855">ok</span>&nbsp;<span class="op" id="985858">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985862">if</span>&nbsp;<span class="ident" id="985865">badOS</span><span class="op" id="985870">[</span><span class="ident" id="985871">runtime</span><span class="op" id="985878">.</span><span class="ident" id="985879">GOOS</span><span class="op" id="985883">]</span>&nbsp;<span class="op" id="985885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985890">t</span><span class="op" id="985891">.</span><span class="ident" id="985892">Skipf</span><span class="op" id="985897">(</span><span class="string" id="985898">&#34;ignoring&nbsp;failure&nbsp;on&nbsp;%s;&nbsp;see&nbsp;golang.org/issue/6047&#34;</span><span class="op" id="985949">,</span>&nbsp;<span class="ident" id="985951">runtime</span><span class="op" id="985958">.</span><span class="ident" id="985959">GOOS</span><span class="op" id="985963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="985968">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="985981">t</span><span class="op" id="985982">.</span><span class="ident" id="985983">FailNow</span><span class="op" id="985990">(</span><span class="op" id="985991">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="985994">}</span><br>
<span class="lineno"></span><span class="op" id="985996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="985999">func</span>&nbsp;<span class="ident" id="986004">TestCPUProfileWithFork</span><span class="op" id="986026">(</span><span class="ident" id="986027">t</span>&nbsp;<span class="op" id="986029">*</span><span class="ident" id="986030">testing</span><span class="op" id="986037">.</span><span class="ident" id="986038">T</span><span class="op" id="986039">)</span>&nbsp;<span class="op" id="986041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="986044">//&nbsp;Fork&nbsp;can&nbsp;hang&nbsp;if&nbsp;preempted&nbsp;with&nbsp;signals&nbsp;frequently&nbsp;enough&nbsp;(see&nbsp;issue&nbsp;5517).</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="986124">//&nbsp;Ensure&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;do&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986159">heap</span>&nbsp;<span class="op" id="986164">:=</span>&nbsp;<span class="num" id="986167">1</span>&nbsp;<span class="op" id="986169">&lt;&lt;</span>&nbsp;<span class="num" id="986172">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986176">if</span>&nbsp;<span class="ident" id="986179">testing</span><span class="op" id="986186">.</span><span class="ident" id="986187">Short</span><span class="op" id="986192">(</span><span class="op" id="986193">)</span>&nbsp;<span class="op" id="986195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986199">heap</span>&nbsp;<span class="op" id="986204">=</span>&nbsp;<span class="num" id="986206">100</span>&nbsp;<span class="op" id="986210">&lt;&lt;</span>&nbsp;<span class="num" id="986213">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="986217">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="986220">//&nbsp;This&nbsp;makes&nbsp;fork&nbsp;slower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986248">garbage</span>&nbsp;<span class="op" id="986256">:=</span>&nbsp;<span class="builtinfunc" id="986259">make</span><span class="op" id="986263">(</span><span class="op" id="986264">[</span><span class="op" id="986265">]</span><span class="builtintype" id="986266">byte</span><span class="op" id="986270">,</span>&nbsp;<span class="ident" id="986272">heap</span><span class="op" id="986276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="986279">//&nbsp;Need&nbsp;to&nbsp;touch&nbsp;the&nbsp;slice,&nbsp;otherwise&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;paged&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986340">done</span>&nbsp;<span class="op" id="986345">:=</span>&nbsp;<span class="builtinfunc" id="986348">make</span><span class="op" id="986352">(</span><span class="keyword" id="986353">chan</span>&nbsp;<span class="builtintype" id="986358">bool</span><span class="op" id="986362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986365">go</span>&nbsp;<span class="keyword" id="986368">func</span><span class="op" id="986372">(</span><span class="op" id="986373">)</span>&nbsp;<span class="op" id="986375">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986379">for</span>&nbsp;<span class="ident" id="986383">i</span>&nbsp;<span class="op" id="986385">:=</span>&nbsp;<span class="keyword" id="986388">range</span>&nbsp;<span class="ident" id="986394">garbage</span>&nbsp;<span class="op" id="986402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986407">garbage</span><span class="op" id="986414">[</span><span class="ident" id="986415">i</span><span class="op" id="986416">]</span>&nbsp;<span class="op" id="986418">=</span>&nbsp;<span class="num" id="986420">42</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="986425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986429">done</span>&nbsp;<span class="op" id="986434">&lt;-</span>&nbsp;<span class="builtintype" id="986437">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="986443">}</span><span class="op" id="986444">(</span><span class="op" id="986445">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="986448">&lt;-</span><span class="ident" id="986450">done</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986457">var</span>&nbsp;<span class="ident" id="986461">prof</span>&nbsp;<span class="ident" id="986466">bytes</span><span class="op" id="986471">.</span><span class="ident" id="986472">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986480">if</span>&nbsp;<span class="ident" id="986483">err</span>&nbsp;<span class="op" id="986487">:=</span>&nbsp;<span class="ident" id="986490">StartCPUProfile</span><span class="op" id="986505">(</span><span class="op" id="986506">&amp;</span><span class="ident" id="986507">prof</span><span class="op" id="986511">)</span><span class="op" id="986512">;</span>&nbsp;<span class="ident" id="986514">err</span>&nbsp;<span class="op" id="986518">!=</span>&nbsp;<span class="ident" id="986521">nil</span>&nbsp;<span class="op" id="986525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986529">t</span><span class="op" id="986530">.</span><span class="ident" id="986531">Fatal</span><span class="op" id="986536">(</span><span class="ident" id="986537">err</span><span class="op" id="986540">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="986543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986546">defer</span>&nbsp;<span class="ident" id="986552">StopCPUProfile</span><span class="op" id="986566">(</span><span class="op" id="986567">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="986571">for</span>&nbsp;<span class="ident" id="986575">i</span>&nbsp;<span class="op" id="986577">:=</span>&nbsp;<span class="num" id="986580">0</span><span class="op" id="986581">;</span>&nbsp;<span class="ident" id="986583">i</span>&nbsp;<span class="op" id="986585">&lt;</span>&nbsp;<span class="num" id="986587">10</span><span class="op" id="986589">;</span>&nbsp;<span class="ident" id="986591">i</span><span class="op" id="986592">++</span>&nbsp;<span class="op" id="986595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="986599">exec</span><span class="op" id="986603">.</span><span class="ident" id="986604">Command</span><span class="op" id="986611">(</span><span class="string" id="986612">&#34;go&#34;</span><span class="op" id="986616">)</span><span class="op" id="986617">.</span><span class="ident" id="986618">CombinedOutput</span><span class="op" id="986632">(</span><span class="op" id="986633">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="986636">}</span><br>
<span class="lineno"></span><span class="op" id="986638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="986641">//&nbsp;Test&nbsp;that&nbsp;profiler&nbsp;does&nbsp;not&nbsp;observe&nbsp;runtime.gogo&nbsp;as&nbsp;&#34;user&#34;&nbsp;goroutine&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="986724">//&nbsp;If&nbsp;it&nbsp;did,&nbsp;it&nbsp;would&nbsp;see&nbsp;inconsistent&nbsp;state&nbsp;and&nbsp;would&nbsp;either&nbsp;record&nbsp;an&nbsp;incorrect&nbsp;stack</span><br>
<span class="lineno">225</span><span class="comment" id="986813">//&nbsp;or&nbsp;crash&nbsp;because&nbsp;the&nbsp;stack&nbsp;was&nbsp;malformed.</span><br>
<span class="lineno"></span><span class="keyword" id="986858">func</span>&nbsp;<span class="ident" id="986863">TestGoroutineSwitch</span><span class="op" id="986882">(</span><span class="ident" id="986883">t</span>&nbsp;<span class="op" id="986885">*</span><span class="ident" id="986886">testing</span><span class="op" id="986893">.</span><span class="ident" id="986894">T</span><span class="op" id="986895">)</span>&nbsp;<span class="op" id="986897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="986900">//&nbsp;How&nbsp;much&nbsp;to&nbsp;try.&nbsp;These&nbsp;defaults&nbsp;take&nbsp;about&nbsp;1&nbsp;seconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="986957">//&nbsp;on&nbsp;a&nbsp;2012&nbsp;MacBook&nbsp;Pro.&nbsp;The&nbsp;ones&nbsp;in&nbsp;short&nbsp;mode&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987012">//&nbsp;about&nbsp;0.1&nbsp;seconds.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987035">tries</span>&nbsp;<span class="op" id="987041">:=</span>&nbsp;<span class="num" id="987044">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987048">count</span>&nbsp;<span class="op" id="987054">:=</span>&nbsp;<span class="num" id="987057">1000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987066">if</span>&nbsp;<span class="ident" id="987069">testing</span><span class="op" id="987076">.</span><span class="ident" id="987077">Short</span><span class="op" id="987082">(</span><span class="op" id="987083">)</span>&nbsp;<span class="op" id="987085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987089">tries</span>&nbsp;<span class="op" id="987095">=</span>&nbsp;<span class="num" id="987097">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="987100">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987103">for</span>&nbsp;<span class="ident" id="987107">try</span>&nbsp;<span class="op" id="987111">:=</span>&nbsp;<span class="num" id="987114">0</span><span class="op" id="987115">;</span>&nbsp;<span class="ident" id="987117">try</span>&nbsp;<span class="op" id="987121">&lt;</span>&nbsp;<span class="ident" id="987123">tries</span><span class="op" id="987128">;</span>&nbsp;<span class="ident" id="987130">try</span><span class="op" id="987133">++</span>&nbsp;<span class="op" id="987136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987140">var</span>&nbsp;<span class="ident" id="987144">prof</span>&nbsp;<span class="ident" id="987149">bytes</span><span class="op" id="987154">.</span><span class="ident" id="987155">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987164">if</span>&nbsp;<span class="ident" id="987167">err</span>&nbsp;<span class="op" id="987171">:=</span>&nbsp;<span class="ident" id="987174">StartCPUProfile</span><span class="op" id="987189">(</span><span class="op" id="987190">&amp;</span><span class="ident" id="987191">prof</span><span class="op" id="987195">)</span><span class="op" id="987196">;</span>&nbsp;<span class="ident" id="987198">err</span>&nbsp;<span class="op" id="987202">!=</span>&nbsp;<span class="ident" id="987205">nil</span>&nbsp;<span class="op" id="987209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987214">t</span><span class="op" id="987215">.</span><span class="ident" id="987216">Fatal</span><span class="op" id="987221">(</span><span class="ident" id="987222">err</span><span class="op" id="987225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="987229">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987233">for</span>&nbsp;<span class="ident" id="987237">i</span>&nbsp;<span class="op" id="987239">:=</span>&nbsp;<span class="num" id="987242">0</span><span class="op" id="987243">;</span>&nbsp;<span class="ident" id="987245">i</span>&nbsp;<span class="op" id="987247">&lt;</span>&nbsp;<span class="ident" id="987249">count</span><span class="op" id="987254">;</span>&nbsp;<span class="ident" id="987256">i</span><span class="op" id="987257">++</span>&nbsp;<span class="op" id="987260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987265">runtime</span><span class="op" id="987272">.</span><span class="ident" id="987273">Gosched</span><span class="op" id="987280">(</span><span class="op" id="987281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="987285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987289">StopCPUProfile</span><span class="op" id="987303">(</span><span class="op" id="987304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987309">//&nbsp;Read&nbsp;profile&nbsp;to&nbsp;look&nbsp;for&nbsp;entries&nbsp;for&nbsp;runtime.gogo&nbsp;with&nbsp;an&nbsp;attempt&nbsp;at&nbsp;a&nbsp;traceback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987396">//&nbsp;The&nbsp;special&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987419">parseProfile</span><span class="op" id="987431">(</span><span class="ident" id="987432">t</span><span class="op" id="987433">,</span>&nbsp;<span class="ident" id="987435">prof</span><span class="op" id="987439">.</span><span class="ident" id="987440">Bytes</span><span class="op" id="987445">(</span><span class="op" id="987446">)</span><span class="op" id="987447">,</span>&nbsp;<span class="keyword" id="987449">func</span><span class="op" id="987453">(</span><span class="ident" id="987454">count</span>&nbsp;<span class="builtintype" id="987460">uintptr</span><span class="op" id="987467">,</span>&nbsp;<span class="ident" id="987469">stk</span>&nbsp;<span class="op" id="987473">[</span><span class="op" id="987474">]</span><span class="builtintype" id="987475">uintptr</span><span class="op" id="987482">)</span>&nbsp;<span class="op" id="987484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987489">//&nbsp;An&nbsp;entry&nbsp;with&nbsp;two&nbsp;frames&nbsp;with&nbsp;&#39;System&#39;&nbsp;in&nbsp;its&nbsp;top&nbsp;frame</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987551">//&nbsp;exists&nbsp;to&nbsp;record&nbsp;a&nbsp;PC&nbsp;without&nbsp;a&nbsp;traceback.&nbsp;Those&nbsp;are&nbsp;okay.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987616">if</span>&nbsp;<span class="builtinfunc" id="987619">len</span><span class="op" id="987622">(</span><span class="ident" id="987623">stk</span><span class="op" id="987626">)</span>&nbsp;<span class="op" id="987628">==</span>&nbsp;<span class="num" id="987631">2</span>&nbsp;<span class="op" id="987633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987639">f</span>&nbsp;<span class="op" id="987641">:=</span>&nbsp;<span class="ident" id="987644">runtime</span><span class="op" id="987651">.</span><span class="ident" id="987652">FuncForPC</span><span class="op" id="987661">(</span><span class="ident" id="987662">stk</span><span class="op" id="987665">[</span><span class="num" id="987666">1</span><span class="op" id="987667">]</span><span class="op" id="987668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987674">if</span>&nbsp;<span class="ident" id="987677">f</span>&nbsp;<span class="op" id="987679">!=</span>&nbsp;<span class="ident" id="987682">nil</span>&nbsp;<span class="op" id="987686">&amp;&amp;</span>&nbsp;<span class="op" id="987689">(</span><span class="ident" id="987690">f</span><span class="op" id="987691">.</span><span class="ident" id="987692">Name</span><span class="op" id="987696">(</span><span class="op" id="987697">)</span>&nbsp;<span class="op" id="987699">==</span>&nbsp;<span class="string" id="987702">&#34;System&#34;</span>&nbsp;<span class="op" id="987711">||</span>&nbsp;<span class="ident" id="987714">f</span><span class="op" id="987715">.</span><span class="ident" id="987716">Name</span><span class="op" id="987720">(</span><span class="op" id="987721">)</span>&nbsp;<span class="op" id="987723">==</span>&nbsp;<span class="string" id="987726">&#34;ExternalCode&#34;</span>&nbsp;<span class="op" id="987741">||</span>&nbsp;<span class="ident" id="987744">f</span><span class="op" id="987745">.</span><span class="ident" id="987746">Name</span><span class="op" id="987750">(</span><span class="op" id="987751">)</span>&nbsp;<span class="op" id="987753">==</span>&nbsp;<span class="string" id="987756">&#34;GC&#34;</span><span class="op" id="987760">)</span>&nbsp;<span class="op" id="987762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="987780">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="987785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987791">//&nbsp;Otherwise,&nbsp;should&nbsp;not&nbsp;see&nbsp;runtime.gogo.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="987837">//&nbsp;The&nbsp;place&nbsp;we&#39;d&nbsp;see&nbsp;it&nbsp;would&nbsp;be&nbsp;the&nbsp;inner&nbsp;most&nbsp;frame.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="987896">f</span>&nbsp;<span class="op" id="987898">:=</span>&nbsp;<span class="ident" id="987901">runtime</span><span class="op" id="987908">.</span><span class="ident" id="987909">FuncForPC</span><span class="op" id="987918">(</span><span class="ident" id="987919">stk</span><span class="op" id="987922">[</span><span class="num" id="987923">0</span><span class="op" id="987924">]</span><span class="op" id="987925">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987930">if</span>&nbsp;<span class="ident" id="987933">f</span>&nbsp;<span class="op" id="987935">!=</span>&nbsp;<span class="ident" id="987938">nil</span>&nbsp;<span class="op" id="987942">&amp;&amp;</span>&nbsp;<span class="ident" id="987945">f</span><span class="op" id="987946">.</span><span class="ident" id="987947">Name</span><span class="op" id="987951">(</span><span class="op" id="987952">)</span>&nbsp;<span class="op" id="987954">==</span>&nbsp;<span class="string" id="987957">&#34;runtime.gogo&#34;</span>&nbsp;<span class="op" id="987972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="987978">var</span>&nbsp;<span class="ident" id="987982">buf</span>&nbsp;<span class="ident" id="987986">bytes</span><span class="op" id="987991">.</span><span class="ident" id="987992">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988003">for</span>&nbsp;<span class="ident" id="988007">_</span><span class="op" id="988008">,</span>&nbsp;<span class="ident" id="988010">pc</span>&nbsp;<span class="op" id="988013">:=</span>&nbsp;<span class="keyword" id="988016">range</span>&nbsp;<span class="ident" id="988022">stk</span>&nbsp;<span class="op" id="988026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988033">f</span>&nbsp;<span class="op" id="988035">:=</span>&nbsp;<span class="ident" id="988038">runtime</span><span class="op" id="988045">.</span><span class="ident" id="988046">FuncForPC</span><span class="op" id="988055">(</span><span class="ident" id="988056">pc</span><span class="op" id="988058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988065">if</span>&nbsp;<span class="ident" id="988068">f</span>&nbsp;<span class="op" id="988070">==</span>&nbsp;<span class="ident" id="988073">nil</span>&nbsp;<span class="op" id="988077">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988085">fmt</span><span class="op" id="988088">.</span><span class="ident" id="988089">Fprintf</span><span class="op" id="988096">(</span><span class="op" id="988097">&amp;</span><span class="ident" id="988098">buf</span><span class="op" id="988101">,</span>&nbsp;<span class="string" id="988103">&#34;%#x&nbsp;?:0\n&#34;</span><span class="op" id="988114">,</span>&nbsp;<span class="ident" id="988116">pc</span><span class="op" id="988118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988125">}</span>&nbsp;<span class="keyword" id="988127">else</span>&nbsp;<span class="op" id="988132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988140">file</span><span class="op" id="988144">,</span>&nbsp;<span class="ident" id="988146">line</span>&nbsp;<span class="op" id="988151">:=</span>&nbsp;<span class="ident" id="988154">f</span><span class="op" id="988155">.</span><span class="ident" id="988156">FileLine</span><span class="op" id="988164">(</span><span class="ident" id="988165">pc</span><span class="op" id="988167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988175">fmt</span><span class="op" id="988178">.</span><span class="ident" id="988179">Fprintf</span><span class="op" id="988186">(</span><span class="op" id="988187">&amp;</span><span class="ident" id="988188">buf</span><span class="op" id="988191">,</span>&nbsp;<span class="string" id="988193">&#34;%#x&nbsp;%s:%d\n&#34;</span><span class="op" id="988206">,</span>&nbsp;<span class="ident" id="988208">pc</span><span class="op" id="988210">,</span>&nbsp;<span class="ident" id="988212">file</span><span class="op" id="988216">,</span>&nbsp;<span class="ident" id="988218">line</span><span class="op" id="988222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988229">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988241">t</span><span class="op" id="988242">.</span><span class="ident" id="988243">Fatalf</span><span class="op" id="988249">(</span><span class="string" id="988250">&#34;found&nbsp;profile&nbsp;entry&nbsp;for&nbsp;runtime.gogo:\n%s&#34;</span><span class="op" id="988293">,</span>&nbsp;<span class="ident" id="988295">buf</span><span class="op" id="988298">.</span><span class="ident" id="988299">String</span><span class="op" id="988305">(</span><span class="op" id="988306">)</span><span class="op" id="988307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988316">}</span><span class="op" id="988317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988320">}</span><br>
<span class="lineno">275</span><span class="op" id="988322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="988325">//&nbsp;Test&nbsp;that&nbsp;profiling&nbsp;of&nbsp;division&nbsp;operations&nbsp;is&nbsp;okay,&nbsp;especially&nbsp;on&nbsp;ARM.&nbsp;See&nbsp;issue&nbsp;6681.</span><br>
<span class="lineno"></span><span class="keyword" id="988415">func</span>&nbsp;<span class="ident" id="988420">TestMathBigDivide</span><span class="op" id="988437">(</span><span class="ident" id="988438">t</span>&nbsp;<span class="op" id="988440">*</span><span class="ident" id="988441">testing</span><span class="op" id="988448">.</span><span class="ident" id="988449">T</span><span class="op" id="988450">)</span>&nbsp;<span class="op" id="988452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988455">testCPUProfile</span><span class="op" id="988469">(</span><span class="ident" id="988470">t</span><span class="op" id="988471">,</span>&nbsp;<span class="ident" id="988473">nil</span><span class="op" id="988476">,</span>&nbsp;<span class="keyword" id="988478">func</span><span class="op" id="988482">(</span><span class="op" id="988483">)</span>&nbsp;<span class="op" id="988485">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988489">t</span>&nbsp;<span class="op" id="988491">:=</span>&nbsp;<span class="ident" id="988494">time</span><span class="op" id="988498">.</span><span class="ident" id="988499">After</span><span class="op" id="988504">(</span><span class="num" id="988505">5</span>&nbsp;<span class="op" id="988507">*</span>&nbsp;<span class="ident" id="988509">time</span><span class="op" id="988513">.</span><span class="ident" id="988514">Second</span><span class="op" id="988520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988524">pi</span>&nbsp;<span class="op" id="988527">:=</span>&nbsp;<span class="builtinfunc" id="988530">new</span><span class="op" id="988533">(</span><span class="ident" id="988534">big</span><span class="op" id="988537">.</span><span class="ident" id="988538">Int</span><span class="op" id="988541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988545">for</span>&nbsp;<span class="op" id="988549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988554">for</span>&nbsp;<span class="ident" id="988558">i</span>&nbsp;<span class="op" id="988560">:=</span>&nbsp;<span class="num" id="988563">0</span><span class="op" id="988564">;</span>&nbsp;<span class="ident" id="988566">i</span>&nbsp;<span class="op" id="988568">&lt;</span>&nbsp;<span class="num" id="988570">100</span><span class="op" id="988573">;</span>&nbsp;<span class="ident" id="988575">i</span><span class="op" id="988576">++</span>&nbsp;<span class="op" id="988579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988585">n</span>&nbsp;<span class="op" id="988587">:=</span>&nbsp;<span class="ident" id="988590">big</span><span class="op" id="988593">.</span><span class="ident" id="988594">NewInt</span><span class="op" id="988600">(</span><span class="num" id="988601">2646693125139304345</span><span class="op" id="988620">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988626">d</span>&nbsp;<span class="op" id="988628">:=</span>&nbsp;<span class="ident" id="988631">big</span><span class="op" id="988634">.</span><span class="ident" id="988635">NewInt</span><span class="op" id="988641">(</span><span class="num" id="988642">842468587426513207</span><span class="op" id="988660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988666">pi</span><span class="op" id="988668">.</span><span class="ident" id="988669">Div</span><span class="op" id="988672">(</span><span class="ident" id="988673">n</span><span class="op" id="988674">,</span>&nbsp;<span class="ident" id="988676">d</span><span class="op" id="988677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988687">select</span>&nbsp;<span class="op" id="988694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988699">case</span>&nbsp;<span class="op" id="988704">&lt;-</span><span class="ident" id="988706">t</span><span class="op" id="988707">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988713">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988723">default</span><span class="op" id="988730">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="988742">}</span><span class="op" id="988743">)</span><br>
<span class="lineno">295</span><span class="op" id="988745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="988748">//&nbsp;Operating&nbsp;systems&nbsp;that&nbsp;are&nbsp;expected&nbsp;to&nbsp;fail&nbsp;the&nbsp;tests.&nbsp;See&nbsp;issue&nbsp;6047.</span><br>
<span class="lineno"></span><span class="keyword" id="988822">var</span>&nbsp;<span class="ident" id="988826">badOS</span>&nbsp;<span class="op" id="988832">=</span>&nbsp;<span class="keyword" id="988834">map</span><span class="op" id="988837">[</span><span class="builtintype" id="988838">string</span><span class="op" id="988844">]</span><span class="builtintype" id="988845">bool</span><span class="op" id="988849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="988852">&#34;darwin&#34;</span><span class="op" id="988860">:</span>&nbsp;<span class="builtintype" id="988862">true</span><span class="op" id="988866">,</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="988869">&#34;netbsd&#34;</span><span class="op" id="988877">:</span>&nbsp;<span class="builtintype" id="988879">true</span><span class="op" id="988883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="988886">&#34;plan9&#34;</span><span class="op" id="988893">:</span>&nbsp;&nbsp;<span class="builtintype" id="988896">true</span><span class="op" id="988900">,</span><br>
<span class="lineno"></span><span class="op" id="988902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="988905">func</span>&nbsp;<span class="ident" id="988910">TestBlockProfile</span><span class="op" id="988926">(</span><span class="ident" id="988927">t</span>&nbsp;<span class="op" id="988929">*</span><span class="ident" id="988930">testing</span><span class="op" id="988937">.</span><span class="ident" id="988938">T</span><span class="op" id="988939">)</span>&nbsp;<span class="op" id="988941">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988944">type</span>&nbsp;<span class="ident" id="988949">TestCase</span>&nbsp;<span class="keyword" id="988958">struct</span>&nbsp;<span class="op" id="988965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988969">name</span>&nbsp;<span class="builtintype" id="988974">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988983">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="988988">func</span><span class="op" id="988992">(</span><span class="op" id="988993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="988997">re</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="989002">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="989010">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="989013">tests</span>&nbsp;<span class="op" id="989019">:=</span>&nbsp;<span class="op" id="989022">[</span><span class="op" id="989023">...</span><span class="op" id="989026">]</span><span class="ident" id="989027">TestCase</span><span class="op" id="989035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="989039">{</span><span class="string" id="989040">&#34;chan&nbsp;recv&#34;</span><span class="op" id="989051">,</span>&nbsp;<span class="ident" id="989053">blockChanRecv</span><span class="op" id="989066">,</span>&nbsp;<span class="string" id="989068">`<br>
<span class="lineno"></span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime\.chanrecv1\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/chan.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockChanRecv\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno">315</span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>`</span><span class="op" id="989443">}</span><span class="op" id="989444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="989448">{</span><span class="string" id="989449">&#34;chan&nbsp;send&#34;</span><span class="op" id="989460">,</span>&nbsp;<span class="ident" id="989462">blockChanSend</span><span class="op" id="989475">,</span>&nbsp;<span class="string" id="989477">`<br>
<span class="lineno"></span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime\.chansend1\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/chan.go:[0-9]+<br>
<span class="lineno">320</span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockChanSend\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>`</span><span class="op" id="989852">}</span><span class="op" id="989853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="989857">{</span><span class="string" id="989858">&#34;chan&nbsp;close&#34;</span><span class="op" id="989870">,</span>&nbsp;<span class="ident" id="989872">blockChanClose</span><span class="op" id="989886">,</span>&nbsp;<span class="string" id="989888">`<br>
<span class="lineno"></span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno">325</span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime\.chanrecv1\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/chan.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockChanClose\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>`</span><span class="op" id="990264">}</span><span class="op" id="990265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="990269">{</span><span class="string" id="990270">&#34;select&nbsp;recv&nbsp;async&#34;</span><span class="op" id="990289">,</span>&nbsp;<span class="ident" id="990291">blockSelectRecvAsync</span><span class="op" id="990311">,</span>&nbsp;<span class="string" id="990313">`<br>
<span class="lineno">330</span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime\.selectgo\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/select.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockSelectRecvAsync\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>`</span><span class="op" id="990696">}</span><span class="op" id="990697">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="990701">{</span><span class="string" id="990702">&#34;select&nbsp;send&nbsp;sync&#34;</span><span class="op" id="990720">,</span>&nbsp;<span class="ident" id="990722">blockSelectSendSync</span><span class="op" id="990741">,</span>&nbsp;<span class="string" id="990743">`<br>
<span class="lineno"></span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime\.selectgo\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/select.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockSelectSendSync\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno">340</span>`</span><span class="op" id="991125">}</span><span class="op" id="991126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="991130">{</span><span class="string" id="991131">&#34;mutex&#34;</span><span class="op" id="991138">,</span>&nbsp;<span class="ident" id="991140">blockMutex</span><span class="op" id="991150">,</span>&nbsp;<span class="string" id="991152">`<br>
<span class="lineno"></span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;sync\.\(\*Mutex\)\.Lock\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/sync/mutex\.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockMutex\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno">345</span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>`</span><span class="op" id="991528">}</span><span class="op" id="991529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="991533">{</span><span class="string" id="991534">&#34;cond&#34;</span><span class="op" id="991540">,</span>&nbsp;<span class="ident" id="991542">blockCond</span><span class="op" id="991551">,</span>&nbsp;<span class="string" id="991553">`<br>
<span class="lineno"></span>[0-9]+&nbsp;[0-9]+&nbsp;@&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+&nbsp;0x[0-9,a-f]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;sync\.\(\*Cond\)\.Wait\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/sync/cond\.go:[0-9]+<br>
<span class="lineno">350</span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.blockCond\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>#&nbsp;&nbsp;&nbsp;&nbsp;0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;runtime/pprof_test\.TestBlockProfile\+0x[0-9,a-f]+&nbsp;&nbsp;&nbsp;&nbsp;.*/src/runtime/pprof/pprof_test.go:[0-9]+<br>
<span class="lineno"></span>`</span><span class="op" id="991926">}</span><span class="op" id="991927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="991930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="991934">runtime</span><span class="op" id="991941">.</span><span class="ident" id="991942">SetBlockProfileRate</span><span class="op" id="991961">(</span><span class="num" id="991962">1</span><span class="op" id="991963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="991966">defer</span>&nbsp;<span class="ident" id="991972">runtime</span><span class="op" id="991979">.</span><span class="ident" id="991980">SetBlockProfileRate</span><span class="op" id="991999">(</span><span class="num" id="992000">0</span><span class="op" id="992001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992004">for</span>&nbsp;<span class="ident" id="992008">_</span><span class="op" id="992009">,</span>&nbsp;<span class="ident" id="992011">test</span>&nbsp;<span class="op" id="992016">:=</span>&nbsp;<span class="keyword" id="992019">range</span>&nbsp;<span class="ident" id="992025">tests</span>&nbsp;<span class="op" id="992031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992035">test</span><span class="op" id="992039">.</span><span class="ident" id="992040">f</span><span class="op" id="992041">(</span><span class="op" id="992042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992045">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992048">var</span>&nbsp;<span class="ident" id="992052">w</span>&nbsp;<span class="ident" id="992054">bytes</span><span class="op" id="992059">.</span><span class="ident" id="992060">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992068">Lookup</span><span class="op" id="992074">(</span><span class="string" id="992075">&#34;block&#34;</span><span class="op" id="992082">)</span><span class="op" id="992083">.</span><span class="ident" id="992084">WriteTo</span><span class="op" id="992091">(</span><span class="op" id="992092">&amp;</span><span class="ident" id="992093">w</span><span class="op" id="992094">,</span>&nbsp;<span class="num" id="992096">1</span><span class="op" id="992097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992100">prof</span>&nbsp;<span class="op" id="992105">:=</span>&nbsp;<span class="ident" id="992108">w</span><span class="op" id="992109">.</span><span class="ident" id="992110">String</span><span class="op" id="992116">(</span><span class="op" id="992117">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992121">if</span>&nbsp;<span class="op" id="992124">!</span><span class="ident" id="992125">strings</span><span class="op" id="992132">.</span><span class="ident" id="992133">HasPrefix</span><span class="op" id="992142">(</span><span class="ident" id="992143">prof</span><span class="op" id="992147">,</span>&nbsp;<span class="string" id="992149">&#34;---&nbsp;contention:\ncycles/second=&#34;</span><span class="op" id="992182">)</span>&nbsp;<span class="op" id="992184">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992188">t</span><span class="op" id="992189">.</span><span class="ident" id="992190">Fatalf</span><span class="op" id="992196">(</span><span class="string" id="992197">&#34;Bad&nbsp;profile&nbsp;header:\n%v&#34;</span><span class="op" id="992222">,</span>&nbsp;<span class="ident" id="992224">prof</span><span class="op" id="992228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992235">for</span>&nbsp;<span class="ident" id="992239">_</span><span class="op" id="992240">,</span>&nbsp;<span class="ident" id="992242">test</span>&nbsp;<span class="op" id="992247">:=</span>&nbsp;<span class="keyword" id="992250">range</span>&nbsp;<span class="ident" id="992256">tests</span>&nbsp;<span class="op" id="992262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992266">if</span>&nbsp;<span class="op" id="992269">!</span><span class="ident" id="992270">regexp</span><span class="op" id="992276">.</span><span class="ident" id="992277">MustCompile</span><span class="op" id="992288">(</span><span class="ident" id="992289">test</span><span class="op" id="992293">.</span><span class="ident" id="992294">re</span><span class="op" id="992296">)</span><span class="op" id="992297">.</span><span class="ident" id="992298">MatchString</span><span class="op" id="992309">(</span><span class="ident" id="992310">prof</span><span class="op" id="992314">)</span>&nbsp;<span class="op" id="992316">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992321">t</span><span class="op" id="992322">.</span><span class="ident" id="992323">Fatalf</span><span class="op" id="992329">(</span><span class="string" id="992330">&#34;Bad&nbsp;%v&nbsp;entry,&nbsp;expect:\n%v\ngot:\n%v&#34;</span><span class="op" id="992367">,</span>&nbsp;<span class="ident" id="992369">test</span><span class="op" id="992373">.</span><span class="ident" id="992374">name</span><span class="op" id="992378">,</span>&nbsp;<span class="ident" id="992380">test</span><span class="op" id="992384">.</span><span class="ident" id="992385">re</span><span class="op" id="992387">,</span>&nbsp;<span class="ident" id="992389">prof</span><span class="op" id="992393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992400">}</span><br>
<span class="lineno"></span><span class="op" id="992402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="keyword" id="992405">const</span>&nbsp;<span class="ident" id="992411">blockDelay</span>&nbsp;<span class="op" id="992422">=</span>&nbsp;<span class="num" id="992424">10</span>&nbsp;<span class="op" id="992427">*</span>&nbsp;<span class="ident" id="992429">time</span><span class="op" id="992433">.</span><span class="ident" id="992434">Millisecond</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="992447">func</span>&nbsp;<span class="ident" id="992452">blockChanRecv</span><span class="op" id="992465">(</span><span class="op" id="992466">)</span>&nbsp;<span class="op" id="992468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992471">c</span>&nbsp;<span class="op" id="992473">:=</span>&nbsp;<span class="builtinfunc" id="992476">make</span><span class="op" id="992480">(</span><span class="keyword" id="992481">chan</span>&nbsp;<span class="builtintype" id="992486">bool</span><span class="op" id="992490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992493">go</span>&nbsp;<span class="keyword" id="992496">func</span><span class="op" id="992500">(</span><span class="op" id="992501">)</span>&nbsp;<span class="op" id="992503">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992507">time</span><span class="op" id="992511">.</span><span class="ident" id="992512">Sleep</span><span class="op" id="992517">(</span><span class="ident" id="992518">blockDelay</span><span class="op" id="992528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992532">c</span>&nbsp;<span class="op" id="992534">&lt;-</span>&nbsp;<span class="builtintype" id="992537">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992543">}</span><span class="op" id="992544">(</span><span class="op" id="992545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992548">&lt;-</span><span class="ident" id="992550">c</span><br>
<span class="lineno"></span><span class="op" id="992552">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="992555">func</span>&nbsp;<span class="ident" id="992560">blockChanSend</span><span class="op" id="992573">(</span><span class="op" id="992574">)</span>&nbsp;<span class="op" id="992576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992579">c</span>&nbsp;<span class="op" id="992581">:=</span>&nbsp;<span class="builtinfunc" id="992584">make</span><span class="op" id="992588">(</span><span class="keyword" id="992589">chan</span>&nbsp;<span class="builtintype" id="992594">bool</span><span class="op" id="992598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992601">go</span>&nbsp;<span class="keyword" id="992604">func</span><span class="op" id="992608">(</span><span class="op" id="992609">)</span>&nbsp;<span class="op" id="992611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992615">time</span><span class="op" id="992619">.</span><span class="ident" id="992620">Sleep</span><span class="op" id="992625">(</span><span class="ident" id="992626">blockDelay</span><span class="op" id="992636">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992640">&lt;-</span><span class="ident" id="992642">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992645">}</span><span class="op" id="992646">(</span><span class="op" id="992647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992650">c</span>&nbsp;<span class="op" id="992652">&lt;-</span>&nbsp;<span class="builtintype" id="992655">true</span><br>
<span class="lineno"></span><span class="op" id="992660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="keyword" id="992663">func</span>&nbsp;<span class="ident" id="992668">blockChanClose</span><span class="op" id="992682">(</span><span class="op" id="992683">)</span>&nbsp;<span class="op" id="992685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992688">c</span>&nbsp;<span class="op" id="992690">:=</span>&nbsp;<span class="builtinfunc" id="992693">make</span><span class="op" id="992697">(</span><span class="keyword" id="992698">chan</span>&nbsp;<span class="builtintype" id="992703">bool</span><span class="op" id="992707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992710">go</span>&nbsp;<span class="keyword" id="992713">func</span><span class="op" id="992717">(</span><span class="op" id="992718">)</span>&nbsp;<span class="op" id="992720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992724">time</span><span class="op" id="992728">.</span><span class="ident" id="992729">Sleep</span><span class="op" id="992734">(</span><span class="ident" id="992735">blockDelay</span><span class="op" id="992745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="992749">close</span><span class="op" id="992754">(</span><span class="ident" id="992755">c</span><span class="op" id="992756">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992759">}</span><span class="op" id="992760">(</span><span class="op" id="992761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992764">&lt;-</span><span class="ident" id="992766">c</span><br>
<span class="lineno"></span><span class="op" id="992768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="992771">func</span>&nbsp;<span class="ident" id="992776">blockSelectRecvAsync</span><span class="op" id="992796">(</span><span class="op" id="992797">)</span>&nbsp;<span class="op" id="992799">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992802">c</span>&nbsp;<span class="op" id="992804">:=</span>&nbsp;<span class="builtinfunc" id="992807">make</span><span class="op" id="992811">(</span><span class="keyword" id="992812">chan</span>&nbsp;<span class="builtintype" id="992817">bool</span><span class="op" id="992821">,</span>&nbsp;<span class="num" id="992823">1</span><span class="op" id="992824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992827">c2</span>&nbsp;<span class="op" id="992830">:=</span>&nbsp;<span class="builtinfunc" id="992833">make</span><span class="op" id="992837">(</span><span class="keyword" id="992838">chan</span>&nbsp;<span class="builtintype" id="992843">bool</span><span class="op" id="992847">,</span>&nbsp;<span class="num" id="992849">1</span><span class="op" id="992850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992853">go</span>&nbsp;<span class="keyword" id="992856">func</span><span class="op" id="992860">(</span><span class="op" id="992861">)</span>&nbsp;<span class="op" id="992863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992867">time</span><span class="op" id="992871">.</span><span class="ident" id="992872">Sleep</span><span class="op" id="992877">(</span><span class="ident" id="992878">blockDelay</span><span class="op" id="992888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992892">c</span>&nbsp;<span class="op" id="992894">&lt;-</span>&nbsp;<span class="builtintype" id="992897">true</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992903">}</span><span class="op" id="992904">(</span><span class="op" id="992905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992908">select</span>&nbsp;<span class="op" id="992915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992918">case</span>&nbsp;<span class="op" id="992923">&lt;-</span><span class="ident" id="992925">c</span><span class="op" id="992926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="992929">case</span>&nbsp;<span class="op" id="992934">&lt;-</span><span class="ident" id="992936">c2</span><span class="op" id="992938">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="992941">}</span><br>
<span class="lineno">415</span><span class="op" id="992943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="992946">func</span>&nbsp;<span class="ident" id="992951">blockSelectSendSync</span><span class="op" id="992970">(</span><span class="op" id="992971">)</span>&nbsp;<span class="op" id="992973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992976">c</span>&nbsp;<span class="op" id="992978">:=</span>&nbsp;<span class="builtinfunc" id="992981">make</span><span class="op" id="992985">(</span><span class="keyword" id="992986">chan</span>&nbsp;<span class="builtintype" id="992991">bool</span><span class="op" id="992995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="992998">c2</span>&nbsp;<span class="op" id="993001">:=</span>&nbsp;<span class="builtinfunc" id="993004">make</span><span class="op" id="993008">(</span><span class="keyword" id="993009">chan</span>&nbsp;<span class="builtintype" id="993014">bool</span><span class="op" id="993018">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993021">go</span>&nbsp;<span class="keyword" id="993024">func</span><span class="op" id="993028">(</span><span class="op" id="993029">)</span>&nbsp;<span class="op" id="993031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993035">time</span><span class="op" id="993039">.</span><span class="ident" id="993040">Sleep</span><span class="op" id="993045">(</span><span class="ident" id="993046">blockDelay</span><span class="op" id="993056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="993060">&lt;-</span><span class="ident" id="993062">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="993065">}</span><span class="op" id="993066">(</span><span class="op" id="993067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993070">select</span>&nbsp;<span class="op" id="993077">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993080">case</span>&nbsp;<span class="ident" id="993085">c</span>&nbsp;<span class="op" id="993087">&lt;-</span>&nbsp;<span class="builtintype" id="993090">true</span><span class="op" id="993094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993097">case</span>&nbsp;<span class="ident" id="993102">c2</span>&nbsp;<span class="op" id="993105">&lt;-</span>&nbsp;<span class="builtintype" id="993108">true</span><span class="op" id="993112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="993115">}</span><br>
<span class="lineno"></span><span class="op" id="993117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="993120">func</span>&nbsp;<span class="ident" id="993125">blockMutex</span><span class="op" id="993135">(</span><span class="op" id="993136">)</span>&nbsp;<span class="op" id="993138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993141">var</span>&nbsp;<span class="ident" id="993145">mu</span>&nbsp;<span class="ident" id="993148">sync</span><span class="op" id="993152">.</span><span class="ident" id="993153">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993160">mu</span><span class="op" id="993162">.</span><span class="ident" id="993163">Lock</span><span class="op" id="993167">(</span><span class="op" id="993168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993171">go</span>&nbsp;<span class="keyword" id="993174">func</span><span class="op" id="993178">(</span><span class="op" id="993179">)</span>&nbsp;<span class="op" id="993181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993185">time</span><span class="op" id="993189">.</span><span class="ident" id="993190">Sleep</span><span class="op" id="993195">(</span><span class="ident" id="993196">blockDelay</span><span class="op" id="993206">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993210">mu</span><span class="op" id="993212">.</span><span class="ident" id="993213">Unlock</span><span class="op" id="993219">(</span><span class="op" id="993220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="993223">}</span><span class="op" id="993224">(</span><span class="op" id="993225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993228">mu</span><span class="op" id="993230">.</span><span class="ident" id="993231">Lock</span><span class="op" id="993235">(</span><span class="op" id="993236">)</span><br>
<span class="lineno"></span><span class="op" id="993238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="993241">func</span>&nbsp;<span class="ident" id="993246">blockCond</span><span class="op" id="993255">(</span><span class="op" id="993256">)</span>&nbsp;<span class="op" id="993258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993261">var</span>&nbsp;<span class="ident" id="993265">mu</span>&nbsp;<span class="ident" id="993268">sync</span><span class="op" id="993272">.</span><span class="ident" id="993273">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993280">c</span>&nbsp;<span class="op" id="993282">:=</span>&nbsp;<span class="ident" id="993285">sync</span><span class="op" id="993289">.</span><span class="ident" id="993290">NewCond</span><span class="op" id="993297">(</span><span class="op" id="993298">&amp;</span><span class="ident" id="993299">mu</span><span class="op" id="993301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993304">mu</span><span class="op" id="993306">.</span><span class="ident" id="993307">Lock</span><span class="op" id="993311">(</span><span class="op" id="993312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="993315">go</span>&nbsp;<span class="keyword" id="993318">func</span><span class="op" id="993322">(</span><span class="op" id="993323">)</span>&nbsp;<span class="op" id="993325">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993329">time</span><span class="op" id="993333">.</span><span class="ident" id="993334">Sleep</span><span class="op" id="993339">(</span><span class="ident" id="993340">blockDelay</span><span class="op" id="993350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993354">mu</span><span class="op" id="993356">.</span><span class="ident" id="993357">Lock</span><span class="op" id="993361">(</span><span class="op" id="993362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993366">c</span><span class="op" id="993367">.</span><span class="ident" id="993368">Signal</span><span class="op" id="993374">(</span><span class="op" id="993375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993379">mu</span><span class="op" id="993381">.</span><span class="ident" id="993382">Unlock</span><span class="op" id="993388">(</span><span class="op" id="993389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="993392">}</span><span class="op" id="993393">(</span><span class="op" id="993394">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993397">c</span><span class="op" id="993398">.</span><span class="ident" id="993399">Wait</span><span class="op" id="993403">(</span><span class="op" id="993404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="993407">mu</span><span class="op" id="993409">.</span><span class="ident" id="993410">Unlock</span><span class="op" id="993416">(</span><span class="op" id="993417">)</span><br>
<span class="lineno"></span><span class="op" id="993419">}</span>
</div>
</body>
</html>
