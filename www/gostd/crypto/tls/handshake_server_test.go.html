<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html" class="current">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8474744">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8474799">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8474853">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8474904">package</span>&nbsp;<span class="ident" id="8474912">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8474917">import</span>&nbsp;<span class="op" id="8474924">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8474927">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8474936">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8474952">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8474971">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8474985">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475001">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475017">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475027">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475034">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475040">&#34;math/big&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475052">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475059">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475065">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475076">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475093">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475104">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8475115">&#34;time&#34;</span><br>
<span class="lineno">25</span><span class="op" id="8475122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8475125">//&nbsp;zeroSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;returns&nbsp;an&nbsp;unlimited&nbsp;number&nbsp;of&nbsp;zero&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8475203">type</span>&nbsp;<span class="ident" id="8475208">zeroSource</span>&nbsp;<span class="keyword" id="8475219">struct</span><span class="op" id="8475225">{</span><span class="op" id="8475226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8475229">func</span>&nbsp;<span class="op" id="8475234">(</span><span class="ident" id="8475235">zeroSource</span><span class="op" id="8475245">)</span>&nbsp;<span class="ident" id="8475247">Read</span><span class="op" id="8475251">(</span><span class="ident" id="8475252">b</span>&nbsp;<span class="op" id="8475254">[</span><span class="op" id="8475255">]</span><span class="builtintype" id="8475256">byte</span><span class="op" id="8475260">)</span>&nbsp;<span class="op" id="8475262">(</span><span class="ident" id="8475263">n</span>&nbsp;<span class="builtintype" id="8475265">int</span><span class="op" id="8475268">,</span>&nbsp;<span class="ident" id="8475270">err</span>&nbsp;<span class="builtintype" id="8475274">error</span><span class="op" id="8475279">)</span>&nbsp;<span class="op" id="8475281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475284">for</span>&nbsp;<span class="ident" id="8475288">i</span>&nbsp;<span class="op" id="8475290">:=</span>&nbsp;<span class="keyword" id="8475293">range</span>&nbsp;<span class="ident" id="8475299">b</span>&nbsp;<span class="op" id="8475301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475305">b</span><span class="op" id="8475306">[</span><span class="ident" id="8475307">i</span><span class="op" id="8475308">]</span>&nbsp;<span class="op" id="8475310">=</span>&nbsp;<span class="num" id="8475312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8475319">return</span>&nbsp;<span class="builtinfunc" id="8475326">len</span><span class="op" id="8475329">(</span><span class="ident" id="8475330">b</span><span class="op" id="8475331">)</span><span class="op" id="8475332">,</span>&nbsp;<span class="ident" id="8475334">nil</span><br>
<span class="lineno"></span><span class="op" id="8475338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8475341">var</span>&nbsp;<span class="ident" id="8475345">testConfig</span>&nbsp;<span class="op" id="8475356">*</span><span class="ident" id="8475357">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8475365">func</span>&nbsp;<span class="ident" id="8475370">init</span><span class="op" id="8475374">(</span><span class="op" id="8475375">)</span>&nbsp;<span class="op" id="8475377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475380">testConfig</span>&nbsp;<span class="op" id="8475391">=</span>&nbsp;<span class="op" id="8475393">&amp;</span><span class="ident" id="8475394">Config</span><span class="op" id="8475400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475404">Time</span><span class="op" id="8475408">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8475424">func</span><span class="op" id="8475428">(</span><span class="op" id="8475429">)</span>&nbsp;<span class="ident" id="8475431">time</span><span class="op" id="8475435">.</span><span class="ident" id="8475436">Time</span>&nbsp;<span class="op" id="8475441">{</span>&nbsp;<span class="keyword" id="8475443">return</span>&nbsp;<span class="ident" id="8475450">time</span><span class="op" id="8475454">.</span><span class="ident" id="8475455">Unix</span><span class="op" id="8475459">(</span><span class="num" id="8475460">0</span><span class="op" id="8475461">,</span>&nbsp;<span class="num" id="8475463">0</span><span class="op" id="8475464">)</span>&nbsp;<span class="op" id="8475466">}</span><span class="op" id="8475467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475471">Rand</span><span class="op" id="8475475">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8475491">zeroSource</span><span class="op" id="8475501">{</span><span class="op" id="8475502">}</span><span class="op" id="8475503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475507">Certificates</span><span class="op" id="8475519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8475527">make</span><span class="op" id="8475531">(</span><span class="op" id="8475532">[</span><span class="op" id="8475533">]</span><span class="ident" id="8475534">Certificate</span><span class="op" id="8475545">,</span>&nbsp;<span class="num" id="8475547">2</span><span class="op" id="8475548">)</span><span class="op" id="8475549">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475553">InsecureSkipVerify</span><span class="op" id="8475571">:</span>&nbsp;<span class="builtintype" id="8475573">true</span><span class="op" id="8475577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475581">MinVersion</span><span class="op" id="8475591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8475601">VersionSSL30</span><span class="op" id="8475613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475617">MaxVersion</span><span class="op" id="8475627">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8475637">VersionTLS12</span><span class="op" id="8475649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8475652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475655">testConfig</span><span class="op" id="8475665">.</span><span class="ident" id="8475666">Certificates</span><span class="op" id="8475678">[</span><span class="num" id="8475679">0</span><span class="op" id="8475680">]</span><span class="op" id="8475681">.</span><span class="ident" id="8475682">Certificate</span>&nbsp;<span class="op" id="8475694">=</span>&nbsp;<span class="op" id="8475696">[</span><span class="op" id="8475697">]</span><span class="op" id="8475698">[</span><span class="op" id="8475699">]</span><span class="builtintype" id="8475700">byte</span><span class="op" id="8475704">{</span><span class="ident" id="8475705">testRSACertificate</span><span class="op" id="8475723">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475726">testConfig</span><span class="op" id="8475736">.</span><span class="ident" id="8475737">Certificates</span><span class="op" id="8475749">[</span><span class="num" id="8475750">0</span><span class="op" id="8475751">]</span><span class="op" id="8475752">.</span><span class="ident" id="8475753">PrivateKey</span>&nbsp;<span class="op" id="8475764">=</span>&nbsp;<span class="ident" id="8475766">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475785">testConfig</span><span class="op" id="8475795">.</span><span class="ident" id="8475796">Certificates</span><span class="op" id="8475808">[</span><span class="num" id="8475809">1</span><span class="op" id="8475810">]</span><span class="op" id="8475811">.</span><span class="ident" id="8475812">Certificate</span>&nbsp;<span class="op" id="8475824">=</span>&nbsp;<span class="op" id="8475826">[</span><span class="op" id="8475827">]</span><span class="op" id="8475828">[</span><span class="op" id="8475829">]</span><span class="builtintype" id="8475830">byte</span><span class="op" id="8475834">{</span><span class="ident" id="8475835">testSNICertificate</span><span class="op" id="8475853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475856">testConfig</span><span class="op" id="8475866">.</span><span class="ident" id="8475867">Certificates</span><span class="op" id="8475879">[</span><span class="num" id="8475880">1</span><span class="op" id="8475881">]</span><span class="op" id="8475882">.</span><span class="ident" id="8475883">PrivateKey</span>&nbsp;<span class="op" id="8475894">=</span>&nbsp;<span class="ident" id="8475896">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8475915">testConfig</span><span class="op" id="8475925">.</span><span class="ident" id="8475926">BuildNameToCertificate</span><span class="op" id="8475948">(</span><span class="op" id="8475949">)</span><br>
<span class="lineno"></span><span class="op" id="8475951">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="8475954">func</span>&nbsp;<span class="ident" id="8475959">testClientHelloFailure</span><span class="op" id="8475981">(</span><span class="ident" id="8475982">t</span>&nbsp;<span class="op" id="8475984">*</span><span class="ident" id="8475985">testing</span><span class="op" id="8475992">.</span><span class="ident" id="8475993">T</span><span class="op" id="8475994">,</span>&nbsp;<span class="ident" id="8475996">m</span>&nbsp;<span class="ident" id="8475998">handshakeMessage</span><span class="op" id="8476014">,</span>&nbsp;<span class="ident" id="8476016">expectedSubStr</span>&nbsp;<span class="builtintype" id="8476031">string</span><span class="op" id="8476037">)</span>&nbsp;<span class="op" id="8476039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8476042">//&nbsp;Create&nbsp;in-memory&nbsp;network&nbsp;connection,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8476083">//&nbsp;send&nbsp;message&nbsp;to&nbsp;server.&nbsp;&nbsp;Should&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8476126">//&nbsp;expected&nbsp;error.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476146">c</span><span class="op" id="8476147">,</span>&nbsp;<span class="ident" id="8476149">s</span>&nbsp;<span class="op" id="8476151">:=</span>&nbsp;<span class="ident" id="8476154">net</span><span class="op" id="8476157">.</span><span class="ident" id="8476158">Pipe</span><span class="op" id="8476162">(</span><span class="op" id="8476163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8476166">go</span>&nbsp;<span class="keyword" id="8476169">func</span><span class="op" id="8476173">(</span><span class="op" id="8476174">)</span>&nbsp;<span class="op" id="8476176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476180">cli</span>&nbsp;<span class="op" id="8476184">:=</span>&nbsp;<span class="ident" id="8476187">Client</span><span class="op" id="8476193">(</span><span class="ident" id="8476194">c</span><span class="op" id="8476195">,</span>&nbsp;<span class="ident" id="8476197">testConfig</span><span class="op" id="8476207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8476211">if</span>&nbsp;<span class="ident" id="8476214">ch</span><span class="op" id="8476216">,</span>&nbsp;<span class="ident" id="8476218">ok</span>&nbsp;<span class="op" id="8476221">:=</span>&nbsp;<span class="ident" id="8476224">m</span><span class="op" id="8476225">.</span><span class="op" id="8476226">(</span><span class="op" id="8476227">*</span><span class="ident" id="8476228">clientHelloMsg</span><span class="op" id="8476242">)</span><span class="op" id="8476243">;</span>&nbsp;<span class="ident" id="8476245">ok</span>&nbsp;<span class="op" id="8476248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476253">cli</span><span class="op" id="8476256">.</span><span class="ident" id="8476257">vers</span>&nbsp;<span class="op" id="8476262">=</span>&nbsp;<span class="ident" id="8476264">ch</span><span class="op" id="8476266">.</span><span class="ident" id="8476267">vers</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8476274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476278">cli</span><span class="op" id="8476281">.</span><span class="ident" id="8476282">writeRecord</span><span class="op" id="8476293">(</span><span class="ident" id="8476294">recordTypeHandshake</span><span class="op" id="8476313">,</span>&nbsp;<span class="ident" id="8476315">m</span><span class="op" id="8476316">.</span><span class="ident" id="8476317">marshal</span><span class="op" id="8476324">(</span><span class="op" id="8476325">)</span><span class="op" id="8476326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476330">c</span><span class="op" id="8476331">.</span><span class="ident" id="8476332">Close</span><span class="op" id="8476337">(</span><span class="op" id="8476338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8476341">}</span><span class="op" id="8476342">(</span><span class="op" id="8476343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476346">err</span>&nbsp;<span class="op" id="8476350">:=</span>&nbsp;<span class="ident" id="8476353">Server</span><span class="op" id="8476359">(</span><span class="ident" id="8476360">s</span><span class="op" id="8476361">,</span>&nbsp;<span class="ident" id="8476363">testConfig</span><span class="op" id="8476373">)</span><span class="op" id="8476374">.</span><span class="ident" id="8476375">Handshake</span><span class="op" id="8476384">(</span><span class="op" id="8476385">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476388">s</span><span class="op" id="8476389">.</span><span class="ident" id="8476390">Close</span><span class="op" id="8476395">(</span><span class="op" id="8476396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8476399">if</span>&nbsp;<span class="ident" id="8476402">err</span>&nbsp;<span class="op" id="8476406">==</span>&nbsp;<span class="ident" id="8476409">nil</span>&nbsp;<span class="op" id="8476413">||</span>&nbsp;<span class="op" id="8476416">!</span><span class="ident" id="8476417">strings</span><span class="op" id="8476424">.</span><span class="ident" id="8476425">Contains</span><span class="op" id="8476433">(</span><span class="ident" id="8476434">err</span><span class="op" id="8476437">.</span><span class="ident" id="8476438">Error</span><span class="op" id="8476443">(</span><span class="op" id="8476444">)</span><span class="op" id="8476445">,</span>&nbsp;<span class="ident" id="8476447">expectedSubStr</span><span class="op" id="8476461">)</span>&nbsp;<span class="op" id="8476463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476467">t</span><span class="op" id="8476468">.</span><span class="ident" id="8476469">Errorf</span><span class="op" id="8476475">(</span><span class="string" id="8476476">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected&nbsp;to&nbsp;match&nbsp;substring&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8476525">,</span>&nbsp;<span class="ident" id="8476527">err</span><span class="op" id="8476530">,</span>&nbsp;<span class="ident" id="8476532">expectedSubStr</span><span class="op" id="8476546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8476549">}</span><br>
<span class="lineno"></span><span class="op" id="8476551">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="8476554">func</span>&nbsp;<span class="ident" id="8476559">TestSimpleError</span><span class="op" id="8476574">(</span><span class="ident" id="8476575">t</span>&nbsp;<span class="op" id="8476577">*</span><span class="ident" id="8476578">testing</span><span class="op" id="8476585">.</span><span class="ident" id="8476586">T</span><span class="op" id="8476587">)</span>&nbsp;<span class="op" id="8476589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476592">testClientHelloFailure</span><span class="op" id="8476614">(</span><span class="ident" id="8476615">t</span><span class="op" id="8476616">,</span>&nbsp;<span class="op" id="8476618">&amp;</span><span class="ident" id="8476619">serverHelloDoneMsg</span><span class="op" id="8476637">{</span><span class="op" id="8476638">}</span><span class="op" id="8476639">,</span>&nbsp;<span class="string" id="8476641">&#34;unexpected&nbsp;handshake&nbsp;message&#34;</span><span class="op" id="8476671">)</span><br>
<span class="lineno"></span><span class="op" id="8476673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8476676">var</span>&nbsp;<span class="ident" id="8476680">badProtocolVersions</span>&nbsp;<span class="op" id="8476700">=</span>&nbsp;<span class="op" id="8476702">[</span><span class="op" id="8476703">]</span><span class="builtintype" id="8476704">uint16</span><span class="op" id="8476710">{</span><span class="num" id="8476711">0x0000</span><span class="op" id="8476717">,</span>&nbsp;<span class="num" id="8476719">0x0005</span><span class="op" id="8476725">,</span>&nbsp;<span class="num" id="8476727">0x0100</span><span class="op" id="8476733">,</span>&nbsp;<span class="num" id="8476735">0x0105</span><span class="op" id="8476741">,</span>&nbsp;<span class="num" id="8476743">0x0200</span><span class="op" id="8476749">,</span>&nbsp;<span class="num" id="8476751">0x0205</span><span class="op" id="8476757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8476760">func</span>&nbsp;<span class="ident" id="8476765">TestRejectBadProtocolVersion</span><span class="op" id="8476793">(</span><span class="ident" id="8476794">t</span>&nbsp;<span class="op" id="8476796">*</span><span class="ident" id="8476797">testing</span><span class="op" id="8476804">.</span><span class="ident" id="8476805">T</span><span class="op" id="8476806">)</span>&nbsp;<span class="op" id="8476808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8476811">for</span>&nbsp;<span class="ident" id="8476815">_</span><span class="op" id="8476816">,</span>&nbsp;<span class="ident" id="8476818">v</span>&nbsp;<span class="op" id="8476820">:=</span>&nbsp;<span class="keyword" id="8476823">range</span>&nbsp;<span class="ident" id="8476829">badProtocolVersions</span>&nbsp;<span class="op" id="8476849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476853">testClientHelloFailure</span><span class="op" id="8476875">(</span><span class="ident" id="8476876">t</span><span class="op" id="8476877">,</span>&nbsp;<span class="op" id="8476879">&amp;</span><span class="ident" id="8476880">clientHelloMsg</span><span class="op" id="8476894">{</span><span class="ident" id="8476895">vers</span><span class="op" id="8476899">:</span>&nbsp;<span class="ident" id="8476901">v</span><span class="op" id="8476902">}</span><span class="op" id="8476903">,</span>&nbsp;<span class="string" id="8476905">&#34;unsupported,&nbsp;maximum&nbsp;protocol&nbsp;version&#34;</span><span class="op" id="8476944">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8476947">}</span><br>
<span class="lineno"></span><span class="op" id="8476949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8476952">func</span>&nbsp;<span class="ident" id="8476957">TestNoSuiteOverlap</span><span class="op" id="8476975">(</span><span class="ident" id="8476976">t</span>&nbsp;<span class="op" id="8476978">*</span><span class="ident" id="8476979">testing</span><span class="op" id="8476986">.</span><span class="ident" id="8476987">T</span><span class="op" id="8476988">)</span>&nbsp;<span class="op" id="8476990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8476993">clientHello</span>&nbsp;<span class="op" id="8477005">:=</span>&nbsp;<span class="op" id="8477008">&amp;</span><span class="ident" id="8477009">clientHelloMsg</span><span class="op" id="8477023">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477027">vers</span><span class="op" id="8477031">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8477047">0x0301</span><span class="op" id="8477053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477057">cipherSuites</span><span class="op" id="8477069">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8477077">[</span><span class="op" id="8477078">]</span><span class="builtintype" id="8477079">uint16</span><span class="op" id="8477085">{</span><span class="num" id="8477086">0xff00</span><span class="op" id="8477092">}</span><span class="op" id="8477093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477097">compressionMethods</span><span class="op" id="8477115">:</span>&nbsp;<span class="op" id="8477117">[</span><span class="op" id="8477118">]</span><span class="builtintype" id="8477119">uint8</span><span class="op" id="8477124">{</span><span class="num" id="8477125">0</span><span class="op" id="8477126">}</span><span class="op" id="8477127">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8477130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477133">testClientHelloFailure</span><span class="op" id="8477155">(</span><span class="ident" id="8477156">t</span><span class="op" id="8477157">,</span>&nbsp;<span class="ident" id="8477159">clientHello</span><span class="op" id="8477170">,</span>&nbsp;<span class="string" id="8477172">&#34;no&nbsp;cipher&nbsp;suite&nbsp;supported&nbsp;by&nbsp;both&nbsp;client&nbsp;and&nbsp;server&#34;</span><span class="op" id="8477225">)</span><br>
<span class="lineno">95</span><span class="op" id="8477227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8477230">func</span>&nbsp;<span class="ident" id="8477235">TestNoCompressionOverlap</span><span class="op" id="8477259">(</span><span class="ident" id="8477260">t</span>&nbsp;<span class="op" id="8477262">*</span><span class="ident" id="8477263">testing</span><span class="op" id="8477270">.</span><span class="ident" id="8477271">T</span><span class="op" id="8477272">)</span>&nbsp;<span class="op" id="8477274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477277">clientHello</span>&nbsp;<span class="op" id="8477289">:=</span>&nbsp;<span class="op" id="8477292">&amp;</span><span class="ident" id="8477293">clientHelloMsg</span><span class="op" id="8477307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477311">vers</span><span class="op" id="8477315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8477331">0x0301</span><span class="op" id="8477337">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477341">cipherSuites</span><span class="op" id="8477353">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8477361">[</span><span class="op" id="8477362">]</span><span class="builtintype" id="8477363">uint16</span><span class="op" id="8477369">{</span><span class="ident" id="8477370">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8477394">}</span><span class="op" id="8477395">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477399">compressionMethods</span><span class="op" id="8477417">:</span>&nbsp;<span class="op" id="8477419">[</span><span class="op" id="8477420">]</span><span class="builtintype" id="8477421">uint8</span><span class="op" id="8477426">{</span><span class="num" id="8477427">0xff</span><span class="op" id="8477431">}</span><span class="op" id="8477432">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8477435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477438">testClientHelloFailure</span><span class="op" id="8477460">(</span><span class="ident" id="8477461">t</span><span class="op" id="8477462">,</span>&nbsp;<span class="ident" id="8477464">clientHello</span><span class="op" id="8477475">,</span>&nbsp;<span class="string" id="8477477">&#34;client&nbsp;does&nbsp;not&nbsp;support&nbsp;uncompressed&nbsp;connections&#34;</span><span class="op" id="8477527">)</span><br>
<span class="lineno"></span><span class="op" id="8477529">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="8477532">func</span>&nbsp;<span class="ident" id="8477537">TestTLS12OnlyCipherSuites</span><span class="op" id="8477562">(</span><span class="ident" id="8477563">t</span>&nbsp;<span class="op" id="8477565">*</span><span class="ident" id="8477566">testing</span><span class="op" id="8477573">.</span><span class="ident" id="8477574">T</span><span class="op" id="8477575">)</span>&nbsp;<span class="op" id="8477577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8477580">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;Server&nbsp;doesn&#39;t&nbsp;select&nbsp;a&nbsp;TLS&nbsp;1.2-only&nbsp;cipher&nbsp;suite&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8477651">//&nbsp;the&nbsp;client&nbsp;negotiates&nbsp;TLS&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8477686">var</span>&nbsp;<span class="ident" id="8477690">zeros</span>&nbsp;<span class="op" id="8477696">[</span><span class="num" id="8477697">32</span><span class="op" id="8477699">]</span><span class="builtintype" id="8477700">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477707">clientHello</span>&nbsp;<span class="op" id="8477719">:=</span>&nbsp;<span class="op" id="8477722">&amp;</span><span class="ident" id="8477723">clientHelloMsg</span><span class="op" id="8477737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477741">vers</span><span class="op" id="8477745">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8477749">VersionTLS11</span><span class="op" id="8477761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477765">random</span><span class="op" id="8477771">:</span>&nbsp;<span class="ident" id="8477773">zeros</span><span class="op" id="8477778">[</span><span class="op" id="8477779">:</span><span class="op" id="8477780">]</span><span class="op" id="8477781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8477785">cipherSuites</span><span class="op" id="8477797">:</span>&nbsp;<span class="op" id="8477799">[</span><span class="op" id="8477800">]</span><span class="builtintype" id="8477801">uint16</span><span class="op" id="8477807">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8477812">//&nbsp;The&nbsp;Server,&nbsp;by&nbsp;default,&nbsp;will&nbsp;use&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8477864">//&nbsp;preference&nbsp;order.&nbsp;So&nbsp;the&nbsp;GCM&nbsp;cipher&nbsp;suite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8477912">//&nbsp;will&nbsp;be&nbsp;selected&nbsp;unless&nbsp;it&#39;s&nbsp;excluded&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8477964">//&nbsp;of&nbsp;the&nbsp;version&nbsp;in&nbsp;this&nbsp;ClientHello.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478006">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><span class="op" id="8478043">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478048">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8478072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478076">}</span><span class="op" id="8478077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478081">compressionMethods</span><span class="op" id="8478099">:</span>&nbsp;<span class="op" id="8478101">[</span><span class="op" id="8478102">]</span><span class="builtintype" id="8478103">uint8</span><span class="op" id="8478108">{</span><span class="ident" id="8478109">compressionNone</span><span class="op" id="8478124">}</span><span class="op" id="8478125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478129">supportedCurves</span><span class="op" id="8478144">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8478149">[</span><span class="op" id="8478150">]</span><span class="ident" id="8478151">CurveID</span><span class="op" id="8478158">{</span><span class="ident" id="8478159">CurveP256</span><span class="op" id="8478168">,</span>&nbsp;<span class="ident" id="8478170">CurveP384</span><span class="op" id="8478179">,</span>&nbsp;<span class="ident" id="8478181">CurveP521</span><span class="op" id="8478190">}</span><span class="op" id="8478191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478195">supportedPoints</span><span class="op" id="8478210">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8478215">[</span><span class="op" id="8478216">]</span><span class="builtintype" id="8478217">uint8</span><span class="op" id="8478222">{</span><span class="ident" id="8478223">pointFormatUncompressed</span><span class="op" id="8478246">}</span><span class="op" id="8478247">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478254">c</span><span class="op" id="8478255">,</span>&nbsp;<span class="ident" id="8478257">s</span>&nbsp;<span class="op" id="8478259">:=</span>&nbsp;<span class="ident" id="8478262">net</span><span class="op" id="8478265">.</span><span class="ident" id="8478266">Pipe</span><span class="op" id="8478270">(</span><span class="op" id="8478271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478274">var</span>&nbsp;<span class="ident" id="8478278">reply</span>&nbsp;<span class="keyword" id="8478284">interface</span><span class="op" id="8478293">{</span><span class="op" id="8478294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478297">var</span>&nbsp;<span class="ident" id="8478301">clientErr</span>&nbsp;<span class="builtintype" id="8478311">error</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478318">go</span>&nbsp;<span class="keyword" id="8478321">func</span><span class="op" id="8478325">(</span><span class="op" id="8478326">)</span>&nbsp;<span class="op" id="8478328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478332">cli</span>&nbsp;<span class="op" id="8478336">:=</span>&nbsp;<span class="ident" id="8478339">Client</span><span class="op" id="8478345">(</span><span class="ident" id="8478346">c</span><span class="op" id="8478347">,</span>&nbsp;<span class="ident" id="8478349">testConfig</span><span class="op" id="8478359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478363">cli</span><span class="op" id="8478366">.</span><span class="ident" id="8478367">vers</span>&nbsp;<span class="op" id="8478372">=</span>&nbsp;<span class="ident" id="8478374">clientHello</span><span class="op" id="8478385">.</span><span class="ident" id="8478386">vers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478393">cli</span><span class="op" id="8478396">.</span><span class="ident" id="8478397">writeRecord</span><span class="op" id="8478408">(</span><span class="ident" id="8478409">recordTypeHandshake</span><span class="op" id="8478428">,</span>&nbsp;<span class="ident" id="8478430">clientHello</span><span class="op" id="8478441">.</span><span class="ident" id="8478442">marshal</span><span class="op" id="8478449">(</span><span class="op" id="8478450">)</span><span class="op" id="8478451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478455">reply</span><span class="op" id="8478460">,</span>&nbsp;<span class="ident" id="8478462">clientErr</span>&nbsp;<span class="op" id="8478472">=</span>&nbsp;<span class="ident" id="8478474">cli</span><span class="op" id="8478477">.</span><span class="ident" id="8478478">readHandshake</span><span class="op" id="8478491">(</span><span class="op" id="8478492">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478496">c</span><span class="op" id="8478497">.</span><span class="ident" id="8478498">Close</span><span class="op" id="8478503">(</span><span class="op" id="8478504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478507">}</span><span class="op" id="8478508">(</span><span class="op" id="8478509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478512">config</span>&nbsp;<span class="op" id="8478519">:=</span>&nbsp;<span class="op" id="8478522">*</span><span class="ident" id="8478523">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478535">config</span><span class="op" id="8478541">.</span><span class="ident" id="8478542">CipherSuites</span>&nbsp;<span class="op" id="8478555">=</span>&nbsp;<span class="ident" id="8478557">clientHello</span><span class="op" id="8478568">.</span><span class="ident" id="8478569">cipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478583">Server</span><span class="op" id="8478589">(</span><span class="ident" id="8478590">s</span><span class="op" id="8478591">,</span>&nbsp;<span class="op" id="8478593">&amp;</span><span class="ident" id="8478594">config</span><span class="op" id="8478600">)</span><span class="op" id="8478601">.</span><span class="ident" id="8478602">Handshake</span><span class="op" id="8478611">(</span><span class="op" id="8478612">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478615">s</span><span class="op" id="8478616">.</span><span class="ident" id="8478617">Close</span><span class="op" id="8478622">(</span><span class="op" id="8478623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478626">if</span>&nbsp;<span class="ident" id="8478629">clientErr</span>&nbsp;<span class="op" id="8478639">!=</span>&nbsp;<span class="ident" id="8478642">nil</span>&nbsp;<span class="op" id="8478646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478650">t</span><span class="op" id="8478651">.</span><span class="ident" id="8478652">Fatal</span><span class="op" id="8478657">(</span><span class="ident" id="8478658">clientErr</span><span class="op" id="8478667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478673">serverHello</span><span class="op" id="8478684">,</span>&nbsp;<span class="ident" id="8478686">ok</span>&nbsp;<span class="op" id="8478689">:=</span>&nbsp;<span class="ident" id="8478692">reply</span><span class="op" id="8478697">.</span><span class="op" id="8478698">(</span><span class="op" id="8478699">*</span><span class="ident" id="8478700">serverHelloMsg</span><span class="op" id="8478714">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478717">if</span>&nbsp;<span class="op" id="8478720">!</span><span class="ident" id="8478721">ok</span>&nbsp;<span class="op" id="8478724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478728">t</span><span class="op" id="8478729">.</span><span class="ident" id="8478730">Fatalf</span><span class="op" id="8478736">(</span><span class="string" id="8478737">&#34;didn&#39;t&nbsp;get&nbsp;ServerHello&nbsp;message&nbsp;in&nbsp;reply.&nbsp;Got&nbsp;%v\n&#34;</span><span class="op" id="8478788">,</span>&nbsp;<span class="ident" id="8478790">reply</span><span class="op" id="8478795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478801">if</span>&nbsp;<span class="ident" id="8478804">s</span>&nbsp;<span class="op" id="8478806">:=</span>&nbsp;<span class="ident" id="8478809">serverHello</span><span class="op" id="8478820">.</span><span class="ident" id="8478821">cipherSuite</span><span class="op" id="8478832">;</span>&nbsp;<span class="ident" id="8478834">s</span>&nbsp;<span class="op" id="8478836">!=</span>&nbsp;<span class="ident" id="8478839">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8478864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478868">t</span><span class="op" id="8478869">.</span><span class="ident" id="8478870">Fatalf</span><span class="op" id="8478876">(</span><span class="string" id="8478877">&#34;bad&nbsp;cipher&nbsp;suite&nbsp;from&nbsp;server:&nbsp;%x&#34;</span><span class="op" id="8478911">,</span>&nbsp;<span class="ident" id="8478913">s</span><span class="op" id="8478914">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8478917">}</span><br>
<span class="lineno"></span><span class="op" id="8478919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8478922">func</span>&nbsp;<span class="ident" id="8478927">TestAlertForwarding</span><span class="op" id="8478946">(</span><span class="ident" id="8478947">t</span>&nbsp;<span class="op" id="8478949">*</span><span class="ident" id="8478950">testing</span><span class="op" id="8478957">.</span><span class="ident" id="8478958">T</span><span class="op" id="8478959">)</span>&nbsp;<span class="op" id="8478961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478964">c</span><span class="op" id="8478965">,</span>&nbsp;<span class="ident" id="8478967">s</span>&nbsp;<span class="op" id="8478969">:=</span>&nbsp;<span class="ident" id="8478972">net</span><span class="op" id="8478975">.</span><span class="ident" id="8478976">Pipe</span><span class="op" id="8478980">(</span><span class="op" id="8478981">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8478984">go</span>&nbsp;<span class="keyword" id="8478987">func</span><span class="op" id="8478991">(</span><span class="op" id="8478992">)</span>&nbsp;<span class="op" id="8478994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8478998">Client</span><span class="op" id="8479004">(</span><span class="ident" id="8479005">c</span><span class="op" id="8479006">,</span>&nbsp;<span class="ident" id="8479008">testConfig</span><span class="op" id="8479018">)</span><span class="op" id="8479019">.</span><span class="ident" id="8479020">sendAlert</span><span class="op" id="8479029">(</span><span class="ident" id="8479030">alertUnknownCA</span><span class="op" id="8479044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479048">c</span><span class="op" id="8479049">.</span><span class="ident" id="8479050">Close</span><span class="op" id="8479055">(</span><span class="op" id="8479056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479059">}</span><span class="op" id="8479060">(</span><span class="op" id="8479061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479065">err</span>&nbsp;<span class="op" id="8479069">:=</span>&nbsp;<span class="ident" id="8479072">Server</span><span class="op" id="8479078">(</span><span class="ident" id="8479079">s</span><span class="op" id="8479080">,</span>&nbsp;<span class="ident" id="8479082">testConfig</span><span class="op" id="8479092">)</span><span class="op" id="8479093">.</span><span class="ident" id="8479094">Handshake</span><span class="op" id="8479103">(</span><span class="op" id="8479104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479107">s</span><span class="op" id="8479108">.</span><span class="ident" id="8479109">Close</span><span class="op" id="8479114">(</span><span class="op" id="8479115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479118">if</span>&nbsp;<span class="ident" id="8479121">e</span><span class="op" id="8479122">,</span>&nbsp;<span class="ident" id="8479124">ok</span>&nbsp;<span class="op" id="8479127">:=</span>&nbsp;<span class="ident" id="8479130">err</span><span class="op" id="8479133">.</span><span class="op" id="8479134">(</span><span class="op" id="8479135">*</span><span class="ident" id="8479136">net</span><span class="op" id="8479139">.</span><span class="ident" id="8479140">OpError</span><span class="op" id="8479147">)</span><span class="op" id="8479148">;</span>&nbsp;<span class="op" id="8479150">!</span><span class="ident" id="8479151">ok</span>&nbsp;<span class="op" id="8479154">||</span>&nbsp;<span class="ident" id="8479157">e</span><span class="op" id="8479158">.</span><span class="ident" id="8479159">Err</span>&nbsp;<span class="op" id="8479163">!=</span>&nbsp;<span class="builtintype" id="8479166">error</span><span class="op" id="8479171">(</span><span class="ident" id="8479172">alertUnknownCA</span><span class="op" id="8479186">)</span>&nbsp;<span class="op" id="8479188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479192">t</span><span class="op" id="8479193">.</span><span class="ident" id="8479194">Errorf</span><span class="op" id="8479200">(</span><span class="string" id="8479201">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8479230">,</span>&nbsp;<span class="ident" id="8479232">err</span><span class="op" id="8479235">,</span>&nbsp;<span class="builtintype" id="8479237">error</span><span class="op" id="8479242">(</span><span class="ident" id="8479243">alertUnknownCA</span><span class="op" id="8479257">)</span><span class="op" id="8479258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479261">}</span><br>
<span class="lineno">165</span><span class="op" id="8479263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8479266">func</span>&nbsp;<span class="ident" id="8479271">TestClose</span><span class="op" id="8479280">(</span><span class="ident" id="8479281">t</span>&nbsp;<span class="op" id="8479283">*</span><span class="ident" id="8479284">testing</span><span class="op" id="8479291">.</span><span class="ident" id="8479292">T</span><span class="op" id="8479293">)</span>&nbsp;<span class="op" id="8479295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479298">c</span><span class="op" id="8479299">,</span>&nbsp;<span class="ident" id="8479301">s</span>&nbsp;<span class="op" id="8479303">:=</span>&nbsp;<span class="ident" id="8479306">net</span><span class="op" id="8479309">.</span><span class="ident" id="8479310">Pipe</span><span class="op" id="8479314">(</span><span class="op" id="8479315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479318">go</span>&nbsp;<span class="ident" id="8479321">c</span><span class="op" id="8479322">.</span><span class="ident" id="8479323">Close</span><span class="op" id="8479328">(</span><span class="op" id="8479329">)</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479333">err</span>&nbsp;<span class="op" id="8479337">:=</span>&nbsp;<span class="ident" id="8479340">Server</span><span class="op" id="8479346">(</span><span class="ident" id="8479347">s</span><span class="op" id="8479348">,</span>&nbsp;<span class="ident" id="8479350">testConfig</span><span class="op" id="8479360">)</span><span class="op" id="8479361">.</span><span class="ident" id="8479362">Handshake</span><span class="op" id="8479371">(</span><span class="op" id="8479372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479375">s</span><span class="op" id="8479376">.</span><span class="ident" id="8479377">Close</span><span class="op" id="8479382">(</span><span class="op" id="8479383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479386">if</span>&nbsp;<span class="ident" id="8479389">err</span>&nbsp;<span class="op" id="8479393">!=</span>&nbsp;<span class="ident" id="8479396">io</span><span class="op" id="8479398">.</span><span class="ident" id="8479399">EOF</span>&nbsp;<span class="op" id="8479403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479407">t</span><span class="op" id="8479408">.</span><span class="ident" id="8479409">Errorf</span><span class="op" id="8479415">(</span><span class="string" id="8479416">&#34;Got&nbsp;error:&nbsp;%s;&nbsp;expected:&nbsp;%s&#34;</span><span class="op" id="8479445">,</span>&nbsp;<span class="ident" id="8479447">err</span><span class="op" id="8479450">,</span>&nbsp;<span class="ident" id="8479452">io</span><span class="op" id="8479454">.</span><span class="ident" id="8479455">EOF</span><span class="op" id="8479458">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479461">}</span><br>
<span class="lineno"></span><span class="op" id="8479463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8479466">func</span>&nbsp;<span class="ident" id="8479471">testHandshake</span><span class="op" id="8479484">(</span><span class="ident" id="8479485">clientConfig</span><span class="op" id="8479497">,</span>&nbsp;<span class="ident" id="8479499">serverConfig</span>&nbsp;<span class="op" id="8479512">*</span><span class="ident" id="8479513">Config</span><span class="op" id="8479519">)</span>&nbsp;<span class="op" id="8479521">(</span><span class="ident" id="8479522">state</span>&nbsp;<span class="ident" id="8479528">ConnectionState</span><span class="op" id="8479543">,</span>&nbsp;<span class="ident" id="8479545">err</span>&nbsp;<span class="builtintype" id="8479549">error</span><span class="op" id="8479554">)</span>&nbsp;<span class="op" id="8479556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479559">c</span><span class="op" id="8479560">,</span>&nbsp;<span class="ident" id="8479562">s</span>&nbsp;<span class="op" id="8479564">:=</span>&nbsp;<span class="ident" id="8479567">net</span><span class="op" id="8479570">.</span><span class="ident" id="8479571">Pipe</span><span class="op" id="8479575">(</span><span class="op" id="8479576">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479579">done</span>&nbsp;<span class="op" id="8479584">:=</span>&nbsp;<span class="builtinfunc" id="8479587">make</span><span class="op" id="8479591">(</span><span class="keyword" id="8479592">chan</span>&nbsp;<span class="builtintype" id="8479597">bool</span><span class="op" id="8479601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479604">go</span>&nbsp;<span class="keyword" id="8479607">func</span><span class="op" id="8479611">(</span><span class="op" id="8479612">)</span>&nbsp;<span class="op" id="8479614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479618">cli</span>&nbsp;<span class="op" id="8479622">:=</span>&nbsp;<span class="ident" id="8479625">Client</span><span class="op" id="8479631">(</span><span class="ident" id="8479632">c</span><span class="op" id="8479633">,</span>&nbsp;<span class="ident" id="8479635">clientConfig</span><span class="op" id="8479647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479651">cli</span><span class="op" id="8479654">.</span><span class="ident" id="8479655">Handshake</span><span class="op" id="8479664">(</span><span class="op" id="8479665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479669">c</span><span class="op" id="8479670">.</span><span class="ident" id="8479671">Close</span><span class="op" id="8479676">(</span><span class="op" id="8479677">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479681">done</span>&nbsp;<span class="op" id="8479686">&lt;-</span>&nbsp;<span class="builtintype" id="8479689">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479695">}</span><span class="op" id="8479696">(</span><span class="op" id="8479697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479700">server</span>&nbsp;<span class="op" id="8479707">:=</span>&nbsp;<span class="ident" id="8479710">Server</span><span class="op" id="8479716">(</span><span class="ident" id="8479717">s</span><span class="op" id="8479718">,</span>&nbsp;<span class="ident" id="8479720">serverConfig</span><span class="op" id="8479732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479735">err</span>&nbsp;<span class="op" id="8479739">=</span>&nbsp;<span class="ident" id="8479741">server</span><span class="op" id="8479747">.</span><span class="ident" id="8479748">Handshake</span><span class="op" id="8479757">(</span><span class="op" id="8479758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479761">if</span>&nbsp;<span class="ident" id="8479764">err</span>&nbsp;<span class="op" id="8479768">==</span>&nbsp;<span class="ident" id="8479771">nil</span>&nbsp;<span class="op" id="8479775">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479779">state</span>&nbsp;<span class="op" id="8479785">=</span>&nbsp;<span class="ident" id="8479787">server</span><span class="op" id="8479793">.</span><span class="ident" id="8479794">ConnectionState</span><span class="op" id="8479809">(</span><span class="op" id="8479810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479816">s</span><span class="op" id="8479817">.</span><span class="ident" id="8479818">Close</span><span class="op" id="8479823">(</span><span class="op" id="8479824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479827">&lt;-</span><span class="ident" id="8479829">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8479835">return</span><br>
<span class="lineno">195</span><span class="op" id="8479842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8479845">func</span>&nbsp;<span class="ident" id="8479850">TestVersion</span><span class="op" id="8479861">(</span><span class="ident" id="8479862">t</span>&nbsp;<span class="op" id="8479864">*</span><span class="ident" id="8479865">testing</span><span class="op" id="8479872">.</span><span class="ident" id="8479873">T</span><span class="op" id="8479874">)</span>&nbsp;<span class="op" id="8479876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479879">serverConfig</span>&nbsp;<span class="op" id="8479892">:=</span>&nbsp;<span class="op" id="8479895">&amp;</span><span class="ident" id="8479896">Config</span><span class="op" id="8479902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479906">Certificates</span><span class="op" id="8479918">:</span>&nbsp;<span class="ident" id="8479920">testConfig</span><span class="op" id="8479930">.</span><span class="ident" id="8479931">Certificates</span><span class="op" id="8479943">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479947">MaxVersion</span><span class="op" id="8479957">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8479961">VersionTLS11</span><span class="op" id="8479973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8479976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8479979">clientConfig</span>&nbsp;<span class="op" id="8479992">:=</span>&nbsp;<span class="op" id="8479995">&amp;</span><span class="ident" id="8479996">Config</span><span class="op" id="8480002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480006">InsecureSkipVerify</span><span class="op" id="8480024">:</span>&nbsp;<span class="builtintype" id="8480026">true</span><span class="op" id="8480030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480033">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480036">state</span><span class="op" id="8480041">,</span>&nbsp;<span class="ident" id="8480043">err</span>&nbsp;<span class="op" id="8480047">:=</span>&nbsp;<span class="ident" id="8480050">testHandshake</span><span class="op" id="8480063">(</span><span class="ident" id="8480064">clientConfig</span><span class="op" id="8480076">,</span>&nbsp;<span class="ident" id="8480078">serverConfig</span><span class="op" id="8480090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480093">if</span>&nbsp;<span class="ident" id="8480096">err</span>&nbsp;<span class="op" id="8480100">!=</span>&nbsp;<span class="ident" id="8480103">nil</span>&nbsp;<span class="op" id="8480107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480111">t</span><span class="op" id="8480112">.</span><span class="ident" id="8480113">Fatalf</span><span class="op" id="8480119">(</span><span class="string" id="8480120">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8480142">,</span>&nbsp;<span class="ident" id="8480144">err</span><span class="op" id="8480147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480153">if</span>&nbsp;<span class="ident" id="8480156">state</span><span class="op" id="8480161">.</span><span class="ident" id="8480162">Version</span>&nbsp;<span class="op" id="8480170">!=</span>&nbsp;<span class="ident" id="8480173">VersionTLS11</span>&nbsp;<span class="op" id="8480186">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480190">t</span><span class="op" id="8480191">.</span><span class="ident" id="8480192">Fatalf</span><span class="op" id="8480198">(</span><span class="string" id="8480199">&#34;Incorrect&nbsp;version&nbsp;%x,&nbsp;should&nbsp;be&nbsp;%x&#34;</span><span class="op" id="8480235">,</span>&nbsp;<span class="ident" id="8480237">state</span><span class="op" id="8480242">.</span><span class="ident" id="8480243">Version</span><span class="op" id="8480250">,</span>&nbsp;<span class="ident" id="8480252">VersionTLS11</span><span class="op" id="8480264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480267">}</span><br>
<span class="lineno"></span><span class="op" id="8480269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8480272">func</span>&nbsp;<span class="ident" id="8480277">TestCipherSuitePreference</span><span class="op" id="8480302">(</span><span class="ident" id="8480303">t</span>&nbsp;<span class="op" id="8480305">*</span><span class="ident" id="8480306">testing</span><span class="op" id="8480313">.</span><span class="ident" id="8480314">T</span><span class="op" id="8480315">)</span>&nbsp;<span class="op" id="8480317">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480320">serverConfig</span>&nbsp;<span class="op" id="8480333">:=</span>&nbsp;<span class="op" id="8480336">&amp;</span><span class="ident" id="8480337">Config</span><span class="op" id="8480343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480347">CipherSuites</span><span class="op" id="8480359">:</span>&nbsp;<span class="op" id="8480361">[</span><span class="op" id="8480362">]</span><span class="builtintype" id="8480363">uint16</span><span class="op" id="8480369">{</span><span class="ident" id="8480370">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8480394">,</span>&nbsp;<span class="ident" id="8480396">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8480424">,</span>&nbsp;<span class="ident" id="8480426">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8480456">}</span><span class="op" id="8480457">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480461">Certificates</span><span class="op" id="8480473">:</span>&nbsp;<span class="ident" id="8480475">testConfig</span><span class="op" id="8480485">.</span><span class="ident" id="8480486">Certificates</span><span class="op" id="8480498">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480502">MaxVersion</span><span class="op" id="8480512">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8480516">VersionTLS11</span><span class="op" id="8480528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480531">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480534">clientConfig</span>&nbsp;<span class="op" id="8480547">:=</span>&nbsp;<span class="op" id="8480550">&amp;</span><span class="ident" id="8480551">Config</span><span class="op" id="8480557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480561">CipherSuites</span><span class="op" id="8480573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8480581">[</span><span class="op" id="8480582">]</span><span class="builtintype" id="8480583">uint16</span><span class="op" id="8480589">{</span><span class="ident" id="8480590">TLS_RSA_WITH_AES_128_CBC_SHA</span><span class="op" id="8480618">,</span>&nbsp;<span class="ident" id="8480620">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8480644">}</span><span class="op" id="8480645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480649">InsecureSkipVerify</span><span class="op" id="8480667">:</span>&nbsp;<span class="builtintype" id="8480669">true</span><span class="op" id="8480673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480679">state</span><span class="op" id="8480684">,</span>&nbsp;<span class="ident" id="8480686">err</span>&nbsp;<span class="op" id="8480690">:=</span>&nbsp;<span class="ident" id="8480693">testHandshake</span><span class="op" id="8480706">(</span><span class="ident" id="8480707">clientConfig</span><span class="op" id="8480719">,</span>&nbsp;<span class="ident" id="8480721">serverConfig</span><span class="op" id="8480733">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480736">if</span>&nbsp;<span class="ident" id="8480739">err</span>&nbsp;<span class="op" id="8480743">!=</span>&nbsp;<span class="ident" id="8480746">nil</span>&nbsp;<span class="op" id="8480750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480754">t</span><span class="op" id="8480755">.</span><span class="ident" id="8480756">Fatalf</span><span class="op" id="8480762">(</span><span class="string" id="8480763">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8480785">,</span>&nbsp;<span class="ident" id="8480787">err</span><span class="op" id="8480790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8480796">if</span>&nbsp;<span class="ident" id="8480799">state</span><span class="op" id="8480804">.</span><span class="ident" id="8480805">CipherSuite</span>&nbsp;<span class="op" id="8480817">!=</span>&nbsp;<span class="ident" id="8480820">TLS_RSA_WITH_AES_128_CBC_SHA</span>&nbsp;<span class="op" id="8480849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8480853">//&nbsp;By&nbsp;default&nbsp;the&nbsp;server&nbsp;should&nbsp;use&nbsp;the&nbsp;client&#39;s&nbsp;preference.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480916">t</span><span class="op" id="8480917">.</span><span class="ident" id="8480918">Fatalf</span><span class="op" id="8480924">(</span><span class="string" id="8480925">&#34;Client&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8480967">,</span>&nbsp;<span class="ident" id="8480969">state</span><span class="op" id="8480974">.</span><span class="ident" id="8480975">CipherSuite</span><span class="op" id="8480986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8480989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8480993">serverConfig</span><span class="op" id="8481005">.</span><span class="ident" id="8481006">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8481031">=</span>&nbsp;<span class="builtintype" id="8481033">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481039">state</span><span class="op" id="8481044">,</span>&nbsp;<span class="ident" id="8481046">err</span>&nbsp;<span class="op" id="8481050">=</span>&nbsp;<span class="ident" id="8481052">testHandshake</span><span class="op" id="8481065">(</span><span class="ident" id="8481066">clientConfig</span><span class="op" id="8481078">,</span>&nbsp;<span class="ident" id="8481080">serverConfig</span><span class="op" id="8481092">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481095">if</span>&nbsp;<span class="ident" id="8481098">err</span>&nbsp;<span class="op" id="8481102">!=</span>&nbsp;<span class="ident" id="8481105">nil</span>&nbsp;<span class="op" id="8481109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481113">t</span><span class="op" id="8481114">.</span><span class="ident" id="8481115">Fatalf</span><span class="op" id="8481121">(</span><span class="string" id="8481122">&#34;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8481144">,</span>&nbsp;<span class="ident" id="8481146">err</span><span class="op" id="8481149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8481155">if</span>&nbsp;<span class="ident" id="8481158">state</span><span class="op" id="8481163">.</span><span class="ident" id="8481164">CipherSuite</span>&nbsp;<span class="op" id="8481176">!=</span>&nbsp;<span class="ident" id="8481179">TLS_RSA_WITH_RC4_128_SHA</span>&nbsp;<span class="op" id="8481204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481208">t</span><span class="op" id="8481209">.</span><span class="ident" id="8481210">Fatalf</span><span class="op" id="8481216">(</span><span class="string" id="8481217">&#34;Server&#39;s&nbsp;preference&nbsp;was&nbsp;not&nbsp;used,&nbsp;got&nbsp;%x&#34;</span><span class="op" id="8481259">,</span>&nbsp;<span class="ident" id="8481261">state</span><span class="op" id="8481266">.</span><span class="ident" id="8481267">CipherSuite</span><span class="op" id="8481278">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8481281">}</span><br>
<span class="lineno"></span><span class="op" id="8481283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8481286">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8481361">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="8481377">//&nbsp;serverTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;server&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8481457">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8481476">type</span>&nbsp;<span class="ident" id="8481481">serverTest</span>&nbsp;<span class="keyword" id="8481492">struct</span>&nbsp;<span class="op" id="8481499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481502">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481575">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481616">name</span>&nbsp;<span class="builtintype" id="8481621">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481629">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481695">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481740">command</span>&nbsp;<span class="op" id="8481748">[</span><span class="op" id="8481749">]</span><span class="builtintype" id="8481750">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481758">//&nbsp;expectedPeerCerts&nbsp;contains&nbsp;a&nbsp;list&nbsp;of&nbsp;PEM&nbsp;blocks&nbsp;of&nbsp;expected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481822">//&nbsp;certificates&nbsp;from&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481856">expectedPeerCerts</span>&nbsp;<span class="op" id="8481874">[</span><span class="op" id="8481875">]</span><span class="builtintype" id="8481876">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481884">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8481955">config</span>&nbsp;<span class="op" id="8481962">*</span><span class="ident" id="8481963">Config</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8481971">//&nbsp;expectAlert,&nbsp;if&nbsp;true,&nbsp;indicates&nbsp;that&nbsp;a&nbsp;fatal&nbsp;alert&nbsp;should&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8482045">//&nbsp;when&nbsp;handshaking&nbsp;with&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482083">expectAlert</span>&nbsp;<span class="builtintype" id="8482095">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8482101">//&nbsp;expectHandshakeErrorIncluding,&nbsp;when&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8482170">//&nbsp;that&nbsp;must&nbsp;be&nbsp;a&nbsp;substring&nbsp;of&nbsp;the&nbsp;error&nbsp;resulting&nbsp;from&nbsp;the&nbsp;handshake.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482242">expectHandshakeErrorIncluding</span>&nbsp;<span class="builtintype" id="8482272">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8482280">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8482349">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;false&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8482422">//&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482459">validate</span>&nbsp;<span class="keyword" id="8482468">func</span><span class="op" id="8482472">(</span><span class="ident" id="8482473">ConnectionState</span><span class="op" id="8482488">)</span>&nbsp;<span class="builtintype" id="8482490">error</span><br>
<span class="lineno">270</span><span class="op" id="8482496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8482499">var</span>&nbsp;<span class="ident" id="8482503">defaultClientCommand</span>&nbsp;<span class="op" id="8482524">=</span>&nbsp;<span class="op" id="8482526">[</span><span class="op" id="8482527">]</span><span class="builtintype" id="8482528">string</span><span class="op" id="8482534">{</span><span class="string" id="8482535">&#34;openssl&#34;</span><span class="op" id="8482544">,</span>&nbsp;<span class="string" id="8482546">&#34;s_client&#34;</span><span class="op" id="8482556">,</span>&nbsp;<span class="string" id="8482558">&#34;-no_ticket&#34;</span><span class="op" id="8482570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8482573">//&nbsp;connFromCommand&nbsp;starts&nbsp;opens&nbsp;a&nbsp;listening&nbsp;socket&nbsp;and&nbsp;starts&nbsp;the&nbsp;reference</span><br>
<span class="lineno">275</span><span class="comment" id="8482649">//&nbsp;client&nbsp;to&nbsp;connect&nbsp;to&nbsp;it.&nbsp;It&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;that&nbsp;wraps&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8482729">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="8482744">func</span>&nbsp;<span class="op" id="8482749">(</span><span class="ident" id="8482750">test</span>&nbsp;<span class="op" id="8482755">*</span><span class="ident" id="8482756">serverTest</span><span class="op" id="8482766">)</span>&nbsp;<span class="ident" id="8482768">connFromCommand</span><span class="op" id="8482783">(</span><span class="op" id="8482784">)</span>&nbsp;<span class="op" id="8482786">(</span><span class="ident" id="8482787">conn</span>&nbsp;<span class="op" id="8482792">*</span><span class="ident" id="8482793">recordingConn</span><span class="op" id="8482806">,</span>&nbsp;<span class="ident" id="8482808">child</span>&nbsp;<span class="op" id="8482814">*</span><span class="ident" id="8482815">exec</span><span class="op" id="8482819">.</span><span class="ident" id="8482820">Cmd</span><span class="op" id="8482823">,</span>&nbsp;<span class="ident" id="8482825">err</span>&nbsp;<span class="builtintype" id="8482829">error</span><span class="op" id="8482834">)</span>&nbsp;<span class="op" id="8482836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482839">l</span><span class="op" id="8482840">,</span>&nbsp;<span class="ident" id="8482842">err</span>&nbsp;<span class="op" id="8482846">:=</span>&nbsp;<span class="ident" id="8482849">net</span><span class="op" id="8482852">.</span><span class="ident" id="8482853">ListenTCP</span><span class="op" id="8482862">(</span><span class="string" id="8482863">&#34;tcp&#34;</span><span class="op" id="8482868">,</span>&nbsp;<span class="op" id="8482870">&amp;</span><span class="ident" id="8482871">net</span><span class="op" id="8482874">.</span><span class="ident" id="8482875">TCPAddr</span><span class="op" id="8482882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482886">IP</span><span class="op" id="8482888">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8482892">net</span><span class="op" id="8482895">.</span><span class="ident" id="8482896">IPv4</span><span class="op" id="8482900">(</span><span class="num" id="8482901">127</span><span class="op" id="8482904">,</span>&nbsp;<span class="num" id="8482906">0</span><span class="op" id="8482907">,</span>&nbsp;<span class="num" id="8482909">0</span><span class="op" id="8482910">,</span>&nbsp;<span class="num" id="8482912">1</span><span class="op" id="8482913">)</span><span class="op" id="8482914">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482918">Port</span><span class="op" id="8482922">:</span>&nbsp;<span class="num" id="8482924">0</span><span class="op" id="8482925">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482928">}</span><span class="op" id="8482929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482932">if</span>&nbsp;<span class="ident" id="8482935">err</span>&nbsp;<span class="op" id="8482939">!=</span>&nbsp;<span class="ident" id="8482942">nil</span>&nbsp;<span class="op" id="8482946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482950">return</span>&nbsp;<span class="ident" id="8482957">nil</span><span class="op" id="8482960">,</span>&nbsp;<span class="ident" id="8482962">nil</span><span class="op" id="8482965">,</span>&nbsp;<span class="ident" id="8482967">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8482972">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8482975">defer</span>&nbsp;<span class="ident" id="8482981">l</span><span class="op" id="8482982">.</span><span class="ident" id="8482983">Close</span><span class="op" id="8482988">(</span><span class="op" id="8482989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8482993">port</span>&nbsp;<span class="op" id="8482998">:=</span>&nbsp;<span class="ident" id="8483001">l</span><span class="op" id="8483002">.</span><span class="ident" id="8483003">Addr</span><span class="op" id="8483007">(</span><span class="op" id="8483008">)</span><span class="op" id="8483009">.</span><span class="op" id="8483010">(</span><span class="op" id="8483011">*</span><span class="ident" id="8483012">net</span><span class="op" id="8483015">.</span><span class="ident" id="8483016">TCPAddr</span><span class="op" id="8483023">)</span><span class="op" id="8483024">.</span><span class="ident" id="8483025">Port</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483032">var</span>&nbsp;<span class="ident" id="8483036">command</span>&nbsp;<span class="op" id="8483044">[</span><span class="op" id="8483045">]</span><span class="builtintype" id="8483046">string</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483054">command</span>&nbsp;<span class="op" id="8483062">=</span>&nbsp;<span class="builtinfunc" id="8483064">append</span><span class="op" id="8483070">(</span><span class="ident" id="8483071">command</span><span class="op" id="8483078">,</span>&nbsp;<span class="ident" id="8483080">test</span><span class="op" id="8483084">.</span><span class="ident" id="8483085">command</span><span class="op" id="8483092">...</span><span class="op" id="8483095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483098">if</span>&nbsp;<span class="builtinfunc" id="8483101">len</span><span class="op" id="8483104">(</span><span class="ident" id="8483105">command</span><span class="op" id="8483112">)</span>&nbsp;<span class="op" id="8483114">==</span>&nbsp;<span class="num" id="8483117">0</span>&nbsp;<span class="op" id="8483119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483123">command</span>&nbsp;<span class="op" id="8483131">=</span>&nbsp;<span class="ident" id="8483133">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483158">command</span>&nbsp;<span class="op" id="8483166">=</span>&nbsp;<span class="builtinfunc" id="8483168">append</span><span class="op" id="8483174">(</span><span class="ident" id="8483175">command</span><span class="op" id="8483182">,</span>&nbsp;<span class="string" id="8483184">&#34;-connect&#34;</span><span class="op" id="8483194">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483197">command</span>&nbsp;<span class="op" id="8483205">=</span>&nbsp;<span class="builtinfunc" id="8483207">append</span><span class="op" id="8483213">(</span><span class="ident" id="8483214">command</span><span class="op" id="8483221">,</span>&nbsp;<span class="ident" id="8483223">fmt</span><span class="op" id="8483226">.</span><span class="ident" id="8483227">Sprintf</span><span class="op" id="8483234">(</span><span class="string" id="8483235">&#34;127.0.0.1:%d&#34;</span><span class="op" id="8483249">,</span>&nbsp;<span class="ident" id="8483251">port</span><span class="op" id="8483255">)</span><span class="op" id="8483256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483259">cmd</span>&nbsp;<span class="op" id="8483263">:=</span>&nbsp;<span class="ident" id="8483266">exec</span><span class="op" id="8483270">.</span><span class="ident" id="8483271">Command</span><span class="op" id="8483278">(</span><span class="ident" id="8483279">command</span><span class="op" id="8483286">[</span><span class="num" id="8483287">0</span><span class="op" id="8483288">]</span><span class="op" id="8483289">,</span>&nbsp;<span class="ident" id="8483291">command</span><span class="op" id="8483298">[</span><span class="num" id="8483299">1</span><span class="op" id="8483300">:</span><span class="op" id="8483301">]</span><span class="op" id="8483302">...</span><span class="op" id="8483305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483308">cmd</span><span class="op" id="8483311">.</span><span class="ident" id="8483312">Stdin</span>&nbsp;<span class="op" id="8483318">=</span>&nbsp;<span class="ident" id="8483320">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483325">var</span>&nbsp;<span class="ident" id="8483329">output</span>&nbsp;<span class="ident" id="8483336">bytes</span><span class="op" id="8483341">.</span><span class="ident" id="8483342">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483350">cmd</span><span class="op" id="8483353">.</span><span class="ident" id="8483354">Stdout</span>&nbsp;<span class="op" id="8483361">=</span>&nbsp;<span class="op" id="8483363">&amp;</span><span class="ident" id="8483364">output</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483372">cmd</span><span class="op" id="8483375">.</span><span class="ident" id="8483376">Stderr</span>&nbsp;<span class="op" id="8483383">=</span>&nbsp;<span class="op" id="8483385">&amp;</span><span class="ident" id="8483386">output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483394">if</span>&nbsp;<span class="ident" id="8483397">err</span>&nbsp;<span class="op" id="8483401">:=</span>&nbsp;<span class="ident" id="8483404">cmd</span><span class="op" id="8483407">.</span><span class="ident" id="8483408">Start</span><span class="op" id="8483413">(</span><span class="op" id="8483414">)</span><span class="op" id="8483415">;</span>&nbsp;<span class="ident" id="8483417">err</span>&nbsp;<span class="op" id="8483421">!=</span>&nbsp;<span class="ident" id="8483424">nil</span>&nbsp;<span class="op" id="8483428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483432">return</span>&nbsp;<span class="ident" id="8483439">nil</span><span class="op" id="8483442">,</span>&nbsp;<span class="ident" id="8483444">nil</span><span class="op" id="8483447">,</span>&nbsp;<span class="ident" id="8483449">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483458">connChan</span>&nbsp;<span class="op" id="8483467">:=</span>&nbsp;<span class="builtinfunc" id="8483470">make</span><span class="op" id="8483474">(</span><span class="keyword" id="8483475">chan</span>&nbsp;<span class="keyword" id="8483480">interface</span><span class="op" id="8483489">{</span><span class="op" id="8483490">}</span><span class="op" id="8483491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483494">go</span>&nbsp;<span class="keyword" id="8483497">func</span><span class="op" id="8483501">(</span><span class="op" id="8483502">)</span>&nbsp;<span class="op" id="8483504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483508">tcpConn</span><span class="op" id="8483515">,</span>&nbsp;<span class="ident" id="8483517">err</span>&nbsp;<span class="op" id="8483521">:=</span>&nbsp;<span class="ident" id="8483524">l</span><span class="op" id="8483525">.</span><span class="ident" id="8483526">Accept</span><span class="op" id="8483532">(</span><span class="op" id="8483533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483537">if</span>&nbsp;<span class="ident" id="8483540">err</span>&nbsp;<span class="op" id="8483544">!=</span>&nbsp;<span class="ident" id="8483547">nil</span>&nbsp;<span class="op" id="8483551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483556">connChan</span>&nbsp;<span class="op" id="8483565">&lt;-</span>&nbsp;<span class="ident" id="8483568">err</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483578">connChan</span>&nbsp;<span class="op" id="8483587">&lt;-</span>&nbsp;<span class="ident" id="8483590">tcpConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483599">}</span><span class="op" id="8483600">(</span><span class="op" id="8483601">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483605">var</span>&nbsp;<span class="ident" id="8483609">tcpConn</span>&nbsp;<span class="ident" id="8483617">net</span><span class="op" id="8483620">.</span><span class="ident" id="8483621">Conn</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483627">select</span>&nbsp;<span class="op" id="8483634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483637">case</span>&nbsp;<span class="ident" id="8483642">connOrError</span>&nbsp;<span class="op" id="8483654">:=</span>&nbsp;<span class="op" id="8483657">&lt;-</span><span class="ident" id="8483659">connChan</span><span class="op" id="8483667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483671">if</span>&nbsp;<span class="ident" id="8483674">err</span><span class="op" id="8483677">,</span>&nbsp;<span class="ident" id="8483679">ok</span>&nbsp;<span class="op" id="8483682">:=</span>&nbsp;<span class="ident" id="8483685">connOrError</span><span class="op" id="8483696">.</span><span class="op" id="8483697">(</span><span class="builtintype" id="8483698">error</span><span class="op" id="8483703">)</span><span class="op" id="8483704">;</span>&nbsp;<span class="ident" id="8483706">ok</span>&nbsp;<span class="op" id="8483709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483714">return</span>&nbsp;<span class="ident" id="8483721">nil</span><span class="op" id="8483724">,</span>&nbsp;<span class="ident" id="8483726">nil</span><span class="op" id="8483729">,</span>&nbsp;<span class="ident" id="8483731">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483737">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483741">tcpConn</span>&nbsp;<span class="op" id="8483749">=</span>&nbsp;<span class="ident" id="8483751">connOrError</span><span class="op" id="8483762">.</span><span class="op" id="8483763">(</span><span class="ident" id="8483764">net</span><span class="op" id="8483767">.</span><span class="ident" id="8483768">Conn</span><span class="op" id="8483772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483775">case</span>&nbsp;<span class="op" id="8483780">&lt;-</span><span class="ident" id="8483782">time</span><span class="op" id="8483786">.</span><span class="ident" id="8483787">After</span><span class="op" id="8483792">(</span><span class="num" id="8483793">2</span>&nbsp;<span class="op" id="8483795">*</span>&nbsp;<span class="ident" id="8483797">time</span><span class="op" id="8483801">.</span><span class="ident" id="8483802">Second</span><span class="op" id="8483808">)</span><span class="op" id="8483809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483813">output</span><span class="op" id="8483819">.</span><span class="ident" id="8483820">WriteTo</span><span class="op" id="8483827">(</span><span class="ident" id="8483828">os</span><span class="op" id="8483830">.</span><span class="ident" id="8483831">Stdout</span><span class="op" id="8483837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483841">return</span>&nbsp;<span class="ident" id="8483848">nil</span><span class="op" id="8483851">,</span>&nbsp;<span class="ident" id="8483853">nil</span><span class="op" id="8483856">,</span>&nbsp;<span class="ident" id="8483858">errors</span><span class="op" id="8483864">.</span><span class="ident" id="8483865">New</span><span class="op" id="8483868">(</span><span class="string" id="8483869">&#34;timed&nbsp;out&nbsp;waiting&nbsp;for&nbsp;connection&nbsp;from&nbsp;child&nbsp;process&#34;</span><span class="op" id="8483922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483925">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483929">record</span>&nbsp;<span class="op" id="8483936">:=</span>&nbsp;<span class="op" id="8483939">&amp;</span><span class="ident" id="8483940">recordingConn</span><span class="op" id="8483953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8483957">Conn</span><span class="op" id="8483961">:</span>&nbsp;<span class="ident" id="8483963">tcpConn</span><span class="op" id="8483970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8483973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8483977">return</span>&nbsp;<span class="ident" id="8483984">record</span><span class="op" id="8483990">,</span>&nbsp;<span class="ident" id="8483992">cmd</span><span class="op" id="8483995">,</span>&nbsp;<span class="ident" id="8483997">nil</span><br>
<span class="lineno"></span><span class="op" id="8484001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8484004">func</span>&nbsp;<span class="op" id="8484009">(</span><span class="ident" id="8484010">test</span>&nbsp;<span class="op" id="8484015">*</span><span class="ident" id="8484016">serverTest</span><span class="op" id="8484026">)</span>&nbsp;<span class="ident" id="8484028">dataPath</span><span class="op" id="8484036">(</span><span class="op" id="8484037">)</span>&nbsp;<span class="builtintype" id="8484039">string</span>&nbsp;<span class="op" id="8484046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484049">return</span>&nbsp;<span class="ident" id="8484056">filepath</span><span class="op" id="8484064">.</span><span class="ident" id="8484065">Join</span><span class="op" id="8484069">(</span><span class="string" id="8484070">&#34;testdata&#34;</span><span class="op" id="8484080">,</span>&nbsp;<span class="string" id="8484082">&#34;Server-&#34;</span><span class="op" id="8484091">+</span><span class="ident" id="8484092">test</span><span class="op" id="8484096">.</span><span class="ident" id="8484097">name</span><span class="op" id="8484101">)</span><br>
<span class="lineno">335</span><span class="op" id="8484103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8484106">func</span>&nbsp;<span class="op" id="8484111">(</span><span class="ident" id="8484112">test</span>&nbsp;<span class="op" id="8484117">*</span><span class="ident" id="8484118">serverTest</span><span class="op" id="8484128">)</span>&nbsp;<span class="ident" id="8484130">loadData</span><span class="op" id="8484138">(</span><span class="op" id="8484139">)</span>&nbsp;<span class="op" id="8484141">(</span><span class="ident" id="8484142">flows</span>&nbsp;<span class="op" id="8484148">[</span><span class="op" id="8484149">]</span><span class="op" id="8484150">[</span><span class="op" id="8484151">]</span><span class="builtintype" id="8484152">byte</span><span class="op" id="8484156">,</span>&nbsp;<span class="ident" id="8484158">err</span>&nbsp;<span class="builtintype" id="8484162">error</span><span class="op" id="8484167">)</span>&nbsp;<span class="op" id="8484169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484172">in</span><span class="op" id="8484174">,</span>&nbsp;<span class="ident" id="8484176">err</span>&nbsp;<span class="op" id="8484180">:=</span>&nbsp;<span class="ident" id="8484183">os</span><span class="op" id="8484185">.</span><span class="ident" id="8484186">Open</span><span class="op" id="8484190">(</span><span class="ident" id="8484191">test</span><span class="op" id="8484195">.</span><span class="ident" id="8484196">dataPath</span><span class="op" id="8484204">(</span><span class="op" id="8484205">)</span><span class="op" id="8484206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484209">if</span>&nbsp;<span class="ident" id="8484212">err</span>&nbsp;<span class="op" id="8484216">!=</span>&nbsp;<span class="ident" id="8484219">nil</span>&nbsp;<span class="op" id="8484223">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484227">return</span>&nbsp;<span class="ident" id="8484234">nil</span><span class="op" id="8484237">,</span>&nbsp;<span class="ident" id="8484239">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484247">defer</span>&nbsp;<span class="ident" id="8484253">in</span><span class="op" id="8484255">.</span><span class="ident" id="8484256">Close</span><span class="op" id="8484261">(</span><span class="op" id="8484262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484265">return</span>&nbsp;<span class="ident" id="8484272">parseTestData</span><span class="op" id="8484285">(</span><span class="ident" id="8484286">in</span><span class="op" id="8484288">)</span><br>
<span class="lineno"></span><span class="op" id="8484290">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="8484293">func</span>&nbsp;<span class="op" id="8484298">(</span><span class="ident" id="8484299">test</span>&nbsp;<span class="op" id="8484304">*</span><span class="ident" id="8484305">serverTest</span><span class="op" id="8484315">)</span>&nbsp;<span class="ident" id="8484317">run</span><span class="op" id="8484320">(</span><span class="ident" id="8484321">t</span>&nbsp;<span class="op" id="8484323">*</span><span class="ident" id="8484324">testing</span><span class="op" id="8484331">.</span><span class="ident" id="8484332">T</span><span class="op" id="8484333">,</span>&nbsp;<span class="ident" id="8484335">write</span>&nbsp;<span class="builtintype" id="8484341">bool</span><span class="op" id="8484345">)</span>&nbsp;<span class="op" id="8484347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484350">var</span>&nbsp;<span class="ident" id="8484354">clientConn</span><span class="op" id="8484364">,</span>&nbsp;<span class="ident" id="8484366">serverConn</span>&nbsp;<span class="ident" id="8484377">net</span><span class="op" id="8484380">.</span><span class="ident" id="8484381">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484387">var</span>&nbsp;<span class="ident" id="8484391">recordingConn</span>&nbsp;<span class="op" id="8484405">*</span><span class="ident" id="8484406">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484421">var</span>&nbsp;<span class="ident" id="8484425">childProcess</span>&nbsp;<span class="op" id="8484438">*</span><span class="ident" id="8484439">exec</span><span class="op" id="8484443">.</span><span class="ident" id="8484444">Cmd</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484450">if</span>&nbsp;<span class="ident" id="8484453">write</span>&nbsp;<span class="op" id="8484459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484463">var</span>&nbsp;<span class="ident" id="8484467">err</span>&nbsp;<span class="builtintype" id="8484471">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484479">recordingConn</span><span class="op" id="8484492">,</span>&nbsp;<span class="ident" id="8484494">childProcess</span><span class="op" id="8484506">,</span>&nbsp;<span class="ident" id="8484508">err</span>&nbsp;<span class="op" id="8484512">=</span>&nbsp;<span class="ident" id="8484514">test</span><span class="op" id="8484518">.</span><span class="ident" id="8484519">connFromCommand</span><span class="op" id="8484534">(</span><span class="op" id="8484535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484539">if</span>&nbsp;<span class="ident" id="8484542">err</span>&nbsp;<span class="op" id="8484546">!=</span>&nbsp;<span class="ident" id="8484549">nil</span>&nbsp;<span class="op" id="8484553">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484558">t</span><span class="op" id="8484559">.</span><span class="ident" id="8484560">Fatalf</span><span class="op" id="8484566">(</span><span class="string" id="8484567">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8484599">,</span>&nbsp;<span class="ident" id="8484601">err</span><span class="op" id="8484604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484612">serverConn</span>&nbsp;<span class="op" id="8484623">=</span>&nbsp;<span class="ident" id="8484625">recordingConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484640">}</span>&nbsp;<span class="keyword" id="8484642">else</span>&nbsp;<span class="op" id="8484647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484651">clientConn</span><span class="op" id="8484661">,</span>&nbsp;<span class="ident" id="8484663">serverConn</span>&nbsp;<span class="op" id="8484674">=</span>&nbsp;<span class="ident" id="8484676">net</span><span class="op" id="8484679">.</span><span class="ident" id="8484680">Pipe</span><span class="op" id="8484684">(</span><span class="op" id="8484685">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484691">config</span>&nbsp;<span class="op" id="8484698">:=</span>&nbsp;<span class="ident" id="8484701">test</span><span class="op" id="8484705">.</span><span class="ident" id="8484706">config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484714">if</span>&nbsp;<span class="ident" id="8484717">config</span>&nbsp;<span class="op" id="8484724">==</span>&nbsp;<span class="ident" id="8484727">nil</span>&nbsp;<span class="op" id="8484731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484735">config</span>&nbsp;<span class="op" id="8484742">=</span>&nbsp;<span class="ident" id="8484744">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484756">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484759">server</span>&nbsp;<span class="op" id="8484766">:=</span>&nbsp;<span class="ident" id="8484769">Server</span><span class="op" id="8484775">(</span><span class="ident" id="8484776">serverConn</span><span class="op" id="8484786">,</span>&nbsp;<span class="ident" id="8484788">config</span><span class="op" id="8484794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484797">connStateChan</span>&nbsp;<span class="op" id="8484811">:=</span>&nbsp;<span class="builtinfunc" id="8484814">make</span><span class="op" id="8484818">(</span><span class="keyword" id="8484819">chan</span>&nbsp;<span class="ident" id="8484824">ConnectionState</span><span class="op" id="8484839">,</span>&nbsp;<span class="num" id="8484841">1</span><span class="op" id="8484842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484845">go</span>&nbsp;<span class="keyword" id="8484848">func</span><span class="op" id="8484852">(</span><span class="op" id="8484853">)</span>&nbsp;<span class="op" id="8484855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484859">var</span>&nbsp;<span class="ident" id="8484863">err</span>&nbsp;<span class="builtintype" id="8484867">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484875">if</span>&nbsp;<span class="ident" id="8484878">_</span><span class="op" id="8484879">,</span>&nbsp;<span class="ident" id="8484881">err</span>&nbsp;<span class="op" id="8484885">=</span>&nbsp;<span class="ident" id="8484887">server</span><span class="op" id="8484893">.</span><span class="ident" id="8484894">Write</span><span class="op" id="8484899">(</span><span class="op" id="8484900">[</span><span class="op" id="8484901">]</span><span class="builtintype" id="8484902">byte</span><span class="op" id="8484906">(</span><span class="string" id="8484907">&#34;hello,&nbsp;world\n&#34;</span><span class="op" id="8484923">)</span><span class="op" id="8484924">)</span><span class="op" id="8484925">;</span>&nbsp;<span class="ident" id="8484927">err</span>&nbsp;<span class="op" id="8484931">!=</span>&nbsp;<span class="ident" id="8484934">nil</span>&nbsp;<span class="op" id="8484938">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8484943">t</span><span class="op" id="8484944">.</span><span class="ident" id="8484945">Logf</span><span class="op" id="8484949">(</span><span class="string" id="8484950">&#34;Error&nbsp;from&nbsp;Server.Write:&nbsp;%s&#34;</span><span class="op" id="8484979">,</span>&nbsp;<span class="ident" id="8484981">err</span><span class="op" id="8484984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8484988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8484992">if</span>&nbsp;<span class="builtinfunc" id="8484995">len</span><span class="op" id="8484998">(</span><span class="ident" id="8484999">test</span><span class="op" id="8485003">.</span><span class="ident" id="8485004">expectHandshakeErrorIncluding</span><span class="op" id="8485033">)</span>&nbsp;<span class="op" id="8485035">&gt;</span>&nbsp;<span class="num" id="8485037">0</span>&nbsp;<span class="op" id="8485039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485044">if</span>&nbsp;<span class="ident" id="8485047">err</span>&nbsp;<span class="op" id="8485051">==</span>&nbsp;<span class="ident" id="8485054">nil</span>&nbsp;<span class="op" id="8485058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485064">t</span><span class="op" id="8485065">.</span><span class="ident" id="8485066">Errorf</span><span class="op" id="8485072">(</span><span class="string" id="8485073">&#34;Error&nbsp;expected,&nbsp;but&nbsp;no&nbsp;error&nbsp;returned&#34;</span><span class="op" id="8485112">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485117">}</span>&nbsp;<span class="keyword" id="8485119">else</span>&nbsp;<span class="keyword" id="8485124">if</span>&nbsp;<span class="ident" id="8485127">s</span>&nbsp;<span class="op" id="8485129">:=</span>&nbsp;<span class="ident" id="8485132">err</span><span class="op" id="8485135">.</span><span class="ident" id="8485136">Error</span><span class="op" id="8485141">(</span><span class="op" id="8485142">)</span><span class="op" id="8485143">;</span>&nbsp;<span class="op" id="8485145">!</span><span class="ident" id="8485146">strings</span><span class="op" id="8485153">.</span><span class="ident" id="8485154">Contains</span><span class="op" id="8485162">(</span><span class="ident" id="8485163">s</span><span class="op" id="8485164">,</span>&nbsp;<span class="ident" id="8485166">test</span><span class="op" id="8485170">.</span><span class="ident" id="8485171">expectHandshakeErrorIncluding</span><span class="op" id="8485200">)</span>&nbsp;<span class="op" id="8485202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485208">t</span><span class="op" id="8485209">.</span><span class="ident" id="8485210">Errorf</span><span class="op" id="8485216">(</span><span class="string" id="8485217">&#34;Error&nbsp;expected&nbsp;containing&nbsp;&#39;%s&#39;&nbsp;but&nbsp;got&nbsp;&#39;%s&#39;&#34;</span><span class="op" id="8485262">,</span>&nbsp;<span class="ident" id="8485264">test</span><span class="op" id="8485268">.</span><span class="ident" id="8485269">expectHandshakeErrorIncluding</span><span class="op" id="8485298">,</span>&nbsp;<span class="ident" id="8485300">s</span><span class="op" id="8485301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485314">server</span><span class="op" id="8485320">.</span><span class="ident" id="8485321">Close</span><span class="op" id="8485326">(</span><span class="op" id="8485327">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485331">serverConn</span><span class="op" id="8485341">.</span><span class="ident" id="8485342">Close</span><span class="op" id="8485347">(</span><span class="op" id="8485348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485352">connStateChan</span>&nbsp;<span class="op" id="8485366">&lt;-</span>&nbsp;<span class="ident" id="8485369">server</span><span class="op" id="8485375">.</span><span class="ident" id="8485376">ConnectionState</span><span class="op" id="8485391">(</span><span class="op" id="8485392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485395">}</span><span class="op" id="8485396">(</span><span class="op" id="8485397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485401">if</span>&nbsp;<span class="op" id="8485404">!</span><span class="ident" id="8485405">write</span>&nbsp;<span class="op" id="8485411">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485415">flows</span><span class="op" id="8485420">,</span>&nbsp;<span class="ident" id="8485422">err</span>&nbsp;<span class="op" id="8485426">:=</span>&nbsp;<span class="ident" id="8485429">test</span><span class="op" id="8485433">.</span><span class="ident" id="8485434">loadData</span><span class="op" id="8485442">(</span><span class="op" id="8485443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485447">if</span>&nbsp;<span class="ident" id="8485450">err</span>&nbsp;<span class="op" id="8485454">!=</span>&nbsp;<span class="ident" id="8485457">nil</span>&nbsp;<span class="op" id="8485461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485466">if</span>&nbsp;<span class="op" id="8485469">!</span><span class="ident" id="8485470">test</span><span class="op" id="8485474">.</span><span class="ident" id="8485475">expectAlert</span>&nbsp;<span class="op" id="8485487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485493">t</span><span class="op" id="8485494">.</span><span class="ident" id="8485495">Fatalf</span><span class="op" id="8485501">(</span><span class="string" id="8485502">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s&#34;</span><span class="op" id="8485535">,</span>&nbsp;<span class="ident" id="8485537">test</span><span class="op" id="8485541">.</span><span class="ident" id="8485542">name</span><span class="op" id="8485546">,</span>&nbsp;<span class="ident" id="8485548">test</span><span class="op" id="8485552">.</span><span class="ident" id="8485553">dataPath</span><span class="op" id="8485561">(</span><span class="op" id="8485562">)</span><span class="op" id="8485563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485568">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485576">for</span>&nbsp;<span class="ident" id="8485580">i</span><span class="op" id="8485581">,</span>&nbsp;<span class="ident" id="8485583">b</span>&nbsp;<span class="op" id="8485585">:=</span>&nbsp;<span class="keyword" id="8485588">range</span>&nbsp;<span class="ident" id="8485594">flows</span>&nbsp;<span class="op" id="8485600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485605">if</span>&nbsp;<span class="ident" id="8485608">i</span><span class="op" id="8485609">%</span><span class="num" id="8485610">2</span>&nbsp;<span class="op" id="8485612">==</span>&nbsp;<span class="num" id="8485615">0</span>&nbsp;<span class="op" id="8485617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485623">clientConn</span><span class="op" id="8485633">.</span><span class="ident" id="8485634">Write</span><span class="op" id="8485639">(</span><span class="ident" id="8485640">b</span><span class="op" id="8485641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485647">continue</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485664">bb</span>&nbsp;<span class="op" id="8485667">:=</span>&nbsp;<span class="builtinfunc" id="8485670">make</span><span class="op" id="8485674">(</span><span class="op" id="8485675">[</span><span class="op" id="8485676">]</span><span class="builtintype" id="8485677">byte</span><span class="op" id="8485681">,</span>&nbsp;<span class="builtinfunc" id="8485683">len</span><span class="op" id="8485686">(</span><span class="ident" id="8485687">b</span><span class="op" id="8485688">)</span><span class="op" id="8485689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485694">n</span><span class="op" id="8485695">,</span>&nbsp;<span class="ident" id="8485697">err</span>&nbsp;<span class="op" id="8485701">:=</span>&nbsp;<span class="ident" id="8485704">io</span><span class="op" id="8485706">.</span><span class="ident" id="8485707">ReadFull</span><span class="op" id="8485715">(</span><span class="ident" id="8485716">clientConn</span><span class="op" id="8485726">,</span>&nbsp;<span class="ident" id="8485728">bb</span><span class="op" id="8485730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485735">if</span>&nbsp;<span class="ident" id="8485738">test</span><span class="op" id="8485742">.</span><span class="ident" id="8485743">expectAlert</span>&nbsp;<span class="op" id="8485755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485761">if</span>&nbsp;<span class="ident" id="8485764">err</span>&nbsp;<span class="op" id="8485768">==</span>&nbsp;<span class="ident" id="8485771">nil</span>&nbsp;<span class="op" id="8485775">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485782">t</span><span class="op" id="8485783">.</span><span class="ident" id="8485784">Fatal</span><span class="op" id="8485789">(</span><span class="string" id="8485790">&#34;Expected&nbsp;read&nbsp;failure&nbsp;but&nbsp;read&nbsp;succeeded&#34;</span><span class="op" id="8485832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485843">}</span>&nbsp;<span class="keyword" id="8485845">else</span>&nbsp;<span class="op" id="8485850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485856">if</span>&nbsp;<span class="ident" id="8485859">err</span>&nbsp;<span class="op" id="8485863">!=</span>&nbsp;<span class="ident" id="8485866">nil</span>&nbsp;<span class="op" id="8485870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8485877">t</span><span class="op" id="8485878">.</span><span class="ident" id="8485879">Fatalf</span><span class="op" id="8485885">(</span><span class="string" id="8485886">&#34;%s&nbsp;#%d:&nbsp;%s\nRead&nbsp;%d,&nbsp;wanted&nbsp;%d,&nbsp;got&nbsp;%x,&nbsp;wanted&nbsp;%x\n&#34;</span><span class="op" id="8485939">,</span>&nbsp;<span class="ident" id="8485941">test</span><span class="op" id="8485945">.</span><span class="ident" id="8485946">name</span><span class="op" id="8485950">,</span>&nbsp;<span class="ident" id="8485952">i</span><span class="op" id="8485953">+</span><span class="num" id="8485954">1</span><span class="op" id="8485955">,</span>&nbsp;<span class="ident" id="8485957">err</span><span class="op" id="8485960">,</span>&nbsp;<span class="ident" id="8485962">n</span><span class="op" id="8485963">,</span>&nbsp;<span class="builtinfunc" id="8485965">len</span><span class="op" id="8485968">(</span><span class="ident" id="8485969">bb</span><span class="op" id="8485971">)</span><span class="op" id="8485972">,</span>&nbsp;<span class="ident" id="8485974">bb</span><span class="op" id="8485976">[</span><span class="op" id="8485977">:</span><span class="ident" id="8485978">n</span><span class="op" id="8485979">]</span><span class="op" id="8485980">,</span>&nbsp;<span class="ident" id="8485982">b</span><span class="op" id="8485983">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8485989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8485995">if</span>&nbsp;<span class="op" id="8485998">!</span><span class="ident" id="8485999">bytes</span><span class="op" id="8486004">.</span><span class="ident" id="8486005">Equal</span><span class="op" id="8486010">(</span><span class="ident" id="8486011">b</span><span class="op" id="8486012">,</span>&nbsp;<span class="ident" id="8486014">bb</span><span class="op" id="8486016">)</span>&nbsp;<span class="op" id="8486018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486025">t</span><span class="op" id="8486026">.</span><span class="ident" id="8486027">Fatalf</span><span class="op" id="8486033">(</span><span class="string" id="8486034">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8486076">,</span>&nbsp;<span class="ident" id="8486078">test</span><span class="op" id="8486082">.</span><span class="ident" id="8486083">name</span><span class="op" id="8486087">,</span>&nbsp;<span class="ident" id="8486089">i</span><span class="op" id="8486090">+</span><span class="num" id="8486091">1</span><span class="op" id="8486092">,</span>&nbsp;<span class="ident" id="8486094">bb</span><span class="op" id="8486096">,</span>&nbsp;<span class="ident" id="8486098">b</span><span class="op" id="8486099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486110">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486118">clientConn</span><span class="op" id="8486128">.</span><span class="ident" id="8486129">Close</span><span class="op" id="8486134">(</span><span class="op" id="8486135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486142">connState</span>&nbsp;<span class="op" id="8486152">:=</span>&nbsp;<span class="op" id="8486155">&lt;-</span><span class="ident" id="8486157">connStateChan</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486172">peerCerts</span>&nbsp;<span class="op" id="8486182">:=</span>&nbsp;<span class="ident" id="8486185">connState</span><span class="op" id="8486194">.</span><span class="ident" id="8486195">PeerCertificates</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486213">if</span>&nbsp;<span class="builtinfunc" id="8486216">len</span><span class="op" id="8486219">(</span><span class="ident" id="8486220">peerCerts</span><span class="op" id="8486229">)</span>&nbsp;<span class="op" id="8486231">==</span>&nbsp;<span class="builtinfunc" id="8486234">len</span><span class="op" id="8486237">(</span><span class="ident" id="8486238">test</span><span class="op" id="8486242">.</span><span class="ident" id="8486243">expectedPeerCerts</span><span class="op" id="8486260">)</span>&nbsp;<span class="op" id="8486262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486266">for</span>&nbsp;<span class="ident" id="8486270">i</span><span class="op" id="8486271">,</span>&nbsp;<span class="ident" id="8486273">peerCert</span>&nbsp;<span class="op" id="8486282">:=</span>&nbsp;<span class="keyword" id="8486285">range</span>&nbsp;<span class="ident" id="8486291">peerCerts</span>&nbsp;<span class="op" id="8486301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486306">block</span><span class="op" id="8486311">,</span>&nbsp;<span class="ident" id="8486313">_</span>&nbsp;<span class="op" id="8486315">:=</span>&nbsp;<span class="ident" id="8486318">pem</span><span class="op" id="8486321">.</span><span class="ident" id="8486322">Decode</span><span class="op" id="8486328">(</span><span class="op" id="8486329">[</span><span class="op" id="8486330">]</span><span class="builtintype" id="8486331">byte</span><span class="op" id="8486335">(</span><span class="ident" id="8486336">test</span><span class="op" id="8486340">.</span><span class="ident" id="8486341">expectedPeerCerts</span><span class="op" id="8486358">[</span><span class="ident" id="8486359">i</span><span class="op" id="8486360">]</span><span class="op" id="8486361">)</span><span class="op" id="8486362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486367">if</span>&nbsp;<span class="op" id="8486370">!</span><span class="ident" id="8486371">bytes</span><span class="op" id="8486376">.</span><span class="ident" id="8486377">Equal</span><span class="op" id="8486382">(</span><span class="ident" id="8486383">block</span><span class="op" id="8486388">.</span><span class="ident" id="8486389">Bytes</span><span class="op" id="8486394">,</span>&nbsp;<span class="ident" id="8486396">peerCert</span><span class="op" id="8486404">.</span><span class="ident" id="8486405">Raw</span><span class="op" id="8486408">)</span>&nbsp;<span class="op" id="8486410">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486416">t</span><span class="op" id="8486417">.</span><span class="ident" id="8486418">Fatalf</span><span class="op" id="8486424">(</span><span class="string" id="8486425">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;cert&nbsp;%d&#34;</span><span class="op" id="8486455">,</span>&nbsp;<span class="ident" id="8486457">test</span><span class="op" id="8486461">.</span><span class="ident" id="8486462">name</span><span class="op" id="8486466">,</span>&nbsp;<span class="ident" id="8486468">i</span><span class="op" id="8486469">+</span><span class="num" id="8486470">1</span><span class="op" id="8486471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486483">}</span>&nbsp;<span class="keyword" id="8486485">else</span>&nbsp;<span class="op" id="8486490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486494">t</span><span class="op" id="8486495">.</span><span class="ident" id="8486496">Fatalf</span><span class="op" id="8486502">(</span><span class="string" id="8486503">&#34;%s:&nbsp;mismatch&nbsp;on&nbsp;peer&nbsp;list&nbsp;length:&nbsp;%d&nbsp;(wanted)&nbsp;!=&nbsp;%d&nbsp;(got)&#34;</span><span class="op" id="8486562">,</span>&nbsp;<span class="ident" id="8486564">test</span><span class="op" id="8486568">.</span><span class="ident" id="8486569">name</span><span class="op" id="8486573">,</span>&nbsp;<span class="builtinfunc" id="8486575">len</span><span class="op" id="8486578">(</span><span class="ident" id="8486579">test</span><span class="op" id="8486583">.</span><span class="ident" id="8486584">expectedPeerCerts</span><span class="op" id="8486601">)</span><span class="op" id="8486602">,</span>&nbsp;<span class="builtinfunc" id="8486604">len</span><span class="op" id="8486607">(</span><span class="ident" id="8486608">peerCerts</span><span class="op" id="8486617">)</span><span class="op" id="8486618">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486625">if</span>&nbsp;<span class="ident" id="8486628">test</span><span class="op" id="8486632">.</span><span class="ident" id="8486633">validate</span>&nbsp;<span class="op" id="8486642">!=</span>&nbsp;<span class="ident" id="8486645">nil</span>&nbsp;<span class="op" id="8486649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486653">if</span>&nbsp;<span class="ident" id="8486656">err</span>&nbsp;<span class="op" id="8486660">:=</span>&nbsp;<span class="ident" id="8486663">test</span><span class="op" id="8486667">.</span><span class="ident" id="8486668">validate</span><span class="op" id="8486676">(</span><span class="ident" id="8486677">connState</span><span class="op" id="8486686">)</span><span class="op" id="8486687">;</span>&nbsp;<span class="ident" id="8486689">err</span>&nbsp;<span class="op" id="8486693">!=</span>&nbsp;<span class="ident" id="8486696">nil</span>&nbsp;<span class="op" id="8486700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486705">t</span><span class="op" id="8486706">.</span><span class="ident" id="8486707">Fatalf</span><span class="op" id="8486713">(</span><span class="string" id="8486714">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8486752">,</span>&nbsp;<span class="ident" id="8486754">err</span><span class="op" id="8486757">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486768">if</span>&nbsp;<span class="ident" id="8486771">write</span>&nbsp;<span class="op" id="8486777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486781">path</span>&nbsp;<span class="op" id="8486786">:=</span>&nbsp;<span class="ident" id="8486789">test</span><span class="op" id="8486793">.</span><span class="ident" id="8486794">dataPath</span><span class="op" id="8486802">(</span><span class="op" id="8486803">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486807">out</span><span class="op" id="8486810">,</span>&nbsp;<span class="ident" id="8486812">err</span>&nbsp;<span class="op" id="8486816">:=</span>&nbsp;<span class="ident" id="8486819">os</span><span class="op" id="8486821">.</span><span class="ident" id="8486822">OpenFile</span><span class="op" id="8486830">(</span><span class="ident" id="8486831">path</span><span class="op" id="8486835">,</span>&nbsp;<span class="ident" id="8486837">os</span><span class="op" id="8486839">.</span><span class="ident" id="8486840">O_WRONLY</span><span class="op" id="8486848">|</span><span class="ident" id="8486849">os</span><span class="op" id="8486851">.</span><span class="ident" id="8486852">O_CREATE</span><span class="op" id="8486860">|</span><span class="ident" id="8486861">os</span><span class="op" id="8486863">.</span><span class="ident" id="8486864">O_TRUNC</span><span class="op" id="8486871">,</span>&nbsp;<span class="num" id="8486873">0644</span><span class="op" id="8486877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486881">if</span>&nbsp;<span class="ident" id="8486884">err</span>&nbsp;<span class="op" id="8486888">!=</span>&nbsp;<span class="ident" id="8486891">nil</span>&nbsp;<span class="op" id="8486895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486900">t</span><span class="op" id="8486901">.</span><span class="ident" id="8486902">Fatalf</span><span class="op" id="8486908">(</span><span class="string" id="8486909">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8486943">,</span>&nbsp;<span class="ident" id="8486945">err</span><span class="op" id="8486948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8486952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8486956">defer</span>&nbsp;<span class="ident" id="8486962">out</span><span class="op" id="8486965">.</span><span class="ident" id="8486966">Close</span><span class="op" id="8486971">(</span><span class="op" id="8486972">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8486976">recordingConn</span><span class="op" id="8486989">.</span><span class="ident" id="8486990">Close</span><span class="op" id="8486995">(</span><span class="op" id="8486996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8487000">if</span>&nbsp;<span class="builtinfunc" id="8487003">len</span><span class="op" id="8487006">(</span><span class="ident" id="8487007">recordingConn</span><span class="op" id="8487020">.</span><span class="ident" id="8487021">flows</span><span class="op" id="8487026">)</span>&nbsp;<span class="op" id="8487028">&lt;</span>&nbsp;<span class="num" id="8487030">3</span>&nbsp;<span class="op" id="8487032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487037">childProcess</span><span class="op" id="8487049">.</span><span class="ident" id="8487050">Stdout</span><span class="op" id="8487056">.</span><span class="op" id="8487057">(</span><span class="op" id="8487058">*</span><span class="ident" id="8487059">bytes</span><span class="op" id="8487064">.</span><span class="ident" id="8487065">Buffer</span><span class="op" id="8487071">)</span><span class="op" id="8487072">.</span><span class="ident" id="8487073">WriteTo</span><span class="op" id="8487080">(</span><span class="ident" id="8487081">os</span><span class="op" id="8487083">.</span><span class="ident" id="8487084">Stdout</span><span class="op" id="8487090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8487095">if</span>&nbsp;<span class="builtinfunc" id="8487098">len</span><span class="op" id="8487101">(</span><span class="ident" id="8487102">test</span><span class="op" id="8487106">.</span><span class="ident" id="8487107">expectHandshakeErrorIncluding</span><span class="op" id="8487136">)</span>&nbsp;<span class="op" id="8487138">==</span>&nbsp;<span class="num" id="8487141">0</span>&nbsp;<span class="op" id="8487143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487149">t</span><span class="op" id="8487150">.</span><span class="ident" id="8487151">Fatalf</span><span class="op" id="8487157">(</span><span class="string" id="8487158">&#34;Handshake&nbsp;failed&#34;</span><span class="op" id="8487176">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8487181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8487185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487189">recordingConn</span><span class="op" id="8487202">.</span><span class="ident" id="8487203">WriteTo</span><span class="op" id="8487210">(</span><span class="ident" id="8487211">out</span><span class="op" id="8487214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487218">fmt</span><span class="op" id="8487221">.</span><span class="ident" id="8487222">Printf</span><span class="op" id="8487228">(</span><span class="string" id="8487229">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8487241">,</span>&nbsp;<span class="ident" id="8487243">path</span><span class="op" id="8487247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487251">childProcess</span><span class="op" id="8487263">.</span><span class="ident" id="8487264">Wait</span><span class="op" id="8487268">(</span><span class="op" id="8487269">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8487272">}</span><br>
<span class="lineno"></span><span class="op" id="8487274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487277">func</span>&nbsp;<span class="ident" id="8487282">runServerTestForVersion</span><span class="op" id="8487305">(</span><span class="ident" id="8487306">t</span>&nbsp;<span class="op" id="8487308">*</span><span class="ident" id="8487309">testing</span><span class="op" id="8487316">.</span><span class="ident" id="8487317">T</span><span class="op" id="8487318">,</span>&nbsp;<span class="ident" id="8487320">template</span>&nbsp;<span class="op" id="8487329">*</span><span class="ident" id="8487330">serverTest</span><span class="op" id="8487340">,</span>&nbsp;<span class="ident" id="8487342">prefix</span><span class="op" id="8487348">,</span>&nbsp;<span class="ident" id="8487350">option</span>&nbsp;<span class="builtintype" id="8487357">string</span><span class="op" id="8487363">)</span>&nbsp;<span class="op" id="8487365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487368">test</span>&nbsp;<span class="op" id="8487373">:=</span>&nbsp;<span class="op" id="8487376">*</span><span class="ident" id="8487377">template</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487387">test</span><span class="op" id="8487391">.</span><span class="ident" id="8487392">name</span>&nbsp;<span class="op" id="8487397">=</span>&nbsp;<span class="ident" id="8487399">prefix</span>&nbsp;<span class="op" id="8487406">+</span>&nbsp;<span class="ident" id="8487408">test</span><span class="op" id="8487412">.</span><span class="ident" id="8487413">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8487419">if</span>&nbsp;<span class="builtinfunc" id="8487422">len</span><span class="op" id="8487425">(</span><span class="ident" id="8487426">test</span><span class="op" id="8487430">.</span><span class="ident" id="8487431">command</span><span class="op" id="8487438">)</span>&nbsp;<span class="op" id="8487440">==</span>&nbsp;<span class="num" id="8487443">0</span>&nbsp;<span class="op" id="8487445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487449">test</span><span class="op" id="8487453">.</span><span class="ident" id="8487454">command</span>&nbsp;<span class="op" id="8487462">=</span>&nbsp;<span class="ident" id="8487464">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8487486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487489">test</span><span class="op" id="8487493">.</span><span class="ident" id="8487494">command</span>&nbsp;<span class="op" id="8487502">=</span>&nbsp;<span class="builtinfunc" id="8487504">append</span><span class="op" id="8487510">(</span><span class="op" id="8487511">[</span><span class="op" id="8487512">]</span><span class="builtintype" id="8487513">string</span><span class="op" id="8487519">(</span><span class="ident" id="8487520">nil</span><span class="op" id="8487523">)</span><span class="op" id="8487524">,</span>&nbsp;<span class="ident" id="8487526">test</span><span class="op" id="8487530">.</span><span class="ident" id="8487531">command</span><span class="op" id="8487538">...</span><span class="op" id="8487541">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487544">test</span><span class="op" id="8487548">.</span><span class="ident" id="8487549">command</span>&nbsp;<span class="op" id="8487557">=</span>&nbsp;<span class="builtinfunc" id="8487559">append</span><span class="op" id="8487565">(</span><span class="ident" id="8487566">test</span><span class="op" id="8487570">.</span><span class="ident" id="8487571">command</span><span class="op" id="8487578">,</span>&nbsp;<span class="ident" id="8487580">option</span><span class="op" id="8487586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487589">test</span><span class="op" id="8487593">.</span><span class="ident" id="8487594">run</span><span class="op" id="8487597">(</span><span class="ident" id="8487598">t</span><span class="op" id="8487599">,</span>&nbsp;<span class="op" id="8487601">*</span><span class="ident" id="8487602">update</span><span class="op" id="8487608">)</span><br>
<span class="lineno"></span><span class="op" id="8487610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487613">func</span>&nbsp;<span class="ident" id="8487618">runServerTestSSLv3</span><span class="op" id="8487636">(</span><span class="ident" id="8487637">t</span>&nbsp;<span class="op" id="8487639">*</span><span class="ident" id="8487640">testing</span><span class="op" id="8487647">.</span><span class="ident" id="8487648">T</span><span class="op" id="8487649">,</span>&nbsp;<span class="ident" id="8487651">template</span>&nbsp;<span class="op" id="8487660">*</span><span class="ident" id="8487661">serverTest</span><span class="op" id="8487671">)</span>&nbsp;<span class="op" id="8487673">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487676">runServerTestForVersion</span><span class="op" id="8487699">(</span><span class="ident" id="8487700">t</span><span class="op" id="8487701">,</span>&nbsp;<span class="ident" id="8487703">template</span><span class="op" id="8487711">,</span>&nbsp;<span class="string" id="8487713">&#34;SSLv3-&#34;</span><span class="op" id="8487721">,</span>&nbsp;<span class="string" id="8487723">&#34;-ssl3&#34;</span><span class="op" id="8487730">)</span><br>
<span class="lineno"></span><span class="op" id="8487732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487735">func</span>&nbsp;<span class="ident" id="8487740">runServerTestTLS10</span><span class="op" id="8487758">(</span><span class="ident" id="8487759">t</span>&nbsp;<span class="op" id="8487761">*</span><span class="ident" id="8487762">testing</span><span class="op" id="8487769">.</span><span class="ident" id="8487770">T</span><span class="op" id="8487771">,</span>&nbsp;<span class="ident" id="8487773">template</span>&nbsp;<span class="op" id="8487782">*</span><span class="ident" id="8487783">serverTest</span><span class="op" id="8487793">)</span>&nbsp;<span class="op" id="8487795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487798">runServerTestForVersion</span><span class="op" id="8487821">(</span><span class="ident" id="8487822">t</span><span class="op" id="8487823">,</span>&nbsp;<span class="ident" id="8487825">template</span><span class="op" id="8487833">,</span>&nbsp;<span class="string" id="8487835">&#34;TLSv10-&#34;</span><span class="op" id="8487844">,</span>&nbsp;<span class="string" id="8487846">&#34;-tls1&#34;</span><span class="op" id="8487853">)</span><br>
<span class="lineno">470</span><span class="op" id="8487855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8487858">func</span>&nbsp;<span class="ident" id="8487863">runServerTestTLS11</span><span class="op" id="8487881">(</span><span class="ident" id="8487882">t</span>&nbsp;<span class="op" id="8487884">*</span><span class="ident" id="8487885">testing</span><span class="op" id="8487892">.</span><span class="ident" id="8487893">T</span><span class="op" id="8487894">,</span>&nbsp;<span class="ident" id="8487896">template</span>&nbsp;<span class="op" id="8487905">*</span><span class="ident" id="8487906">serverTest</span><span class="op" id="8487916">)</span>&nbsp;<span class="op" id="8487918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8487921">runServerTestForVersion</span><span class="op" id="8487944">(</span><span class="ident" id="8487945">t</span><span class="op" id="8487946">,</span>&nbsp;<span class="ident" id="8487948">template</span><span class="op" id="8487956">,</span>&nbsp;<span class="string" id="8487958">&#34;TLSv11-&#34;</span><span class="op" id="8487967">,</span>&nbsp;<span class="string" id="8487969">&#34;-tls1_1&#34;</span><span class="op" id="8487978">)</span><br>
<span class="lineno"></span><span class="op" id="8487980">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="8487983">func</span>&nbsp;<span class="ident" id="8487988">runServerTestTLS12</span><span class="op" id="8488006">(</span><span class="ident" id="8488007">t</span>&nbsp;<span class="op" id="8488009">*</span><span class="ident" id="8488010">testing</span><span class="op" id="8488017">.</span><span class="ident" id="8488018">T</span><span class="op" id="8488019">,</span>&nbsp;<span class="ident" id="8488021">template</span>&nbsp;<span class="op" id="8488030">*</span><span class="ident" id="8488031">serverTest</span><span class="op" id="8488041">)</span>&nbsp;<span class="op" id="8488043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488046">runServerTestForVersion</span><span class="op" id="8488069">(</span><span class="ident" id="8488070">t</span><span class="op" id="8488071">,</span>&nbsp;<span class="ident" id="8488073">template</span><span class="op" id="8488081">,</span>&nbsp;<span class="string" id="8488083">&#34;TLSv12-&#34;</span><span class="op" id="8488092">,</span>&nbsp;<span class="string" id="8488094">&#34;-tls1_2&#34;</span><span class="op" id="8488103">)</span><br>
<span class="lineno"></span><span class="op" id="8488105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="8488108">func</span>&nbsp;<span class="ident" id="8488113">TestHandshakeServerRSARC4</span><span class="op" id="8488138">(</span><span class="ident" id="8488139">t</span>&nbsp;<span class="op" id="8488141">*</span><span class="ident" id="8488142">testing</span><span class="op" id="8488149">.</span><span class="ident" id="8488150">T</span><span class="op" id="8488151">)</span>&nbsp;<span class="op" id="8488153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488156">test</span>&nbsp;<span class="op" id="8488161">:=</span>&nbsp;<span class="op" id="8488164">&amp;</span><span class="ident" id="8488165">serverTest</span><span class="op" id="8488175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488179">name</span><span class="op" id="8488183">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8488188">&#34;RSA-RC4&#34;</span><span class="op" id="8488197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488201">command</span><span class="op" id="8488208">:</span>&nbsp;<span class="op" id="8488210">[</span><span class="op" id="8488211">]</span><span class="builtintype" id="8488212">string</span><span class="op" id="8488218">{</span><span class="string" id="8488219">&#34;openssl&#34;</span><span class="op" id="8488228">,</span>&nbsp;<span class="string" id="8488230">&#34;s_client&#34;</span><span class="op" id="8488240">,</span>&nbsp;<span class="string" id="8488242">&#34;-no_ticket&#34;</span><span class="op" id="8488254">,</span>&nbsp;<span class="string" id="8488256">&#34;-cipher&#34;</span><span class="op" id="8488265">,</span>&nbsp;<span class="string" id="8488267">&#34;RC4-SHA&#34;</span><span class="op" id="8488276">}</span><span class="op" id="8488277">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488280">}</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488283">runServerTestSSLv3</span><span class="op" id="8488301">(</span><span class="ident" id="8488302">t</span><span class="op" id="8488303">,</span>&nbsp;<span class="ident" id="8488305">test</span><span class="op" id="8488309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488312">runServerTestTLS10</span><span class="op" id="8488330">(</span><span class="ident" id="8488331">t</span><span class="op" id="8488332">,</span>&nbsp;<span class="ident" id="8488334">test</span><span class="op" id="8488338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488341">runServerTestTLS11</span><span class="op" id="8488359">(</span><span class="ident" id="8488360">t</span><span class="op" id="8488361">,</span>&nbsp;<span class="ident" id="8488363">test</span><span class="op" id="8488367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488370">runServerTestTLS12</span><span class="op" id="8488388">(</span><span class="ident" id="8488389">t</span><span class="op" id="8488390">,</span>&nbsp;<span class="ident" id="8488392">test</span><span class="op" id="8488396">)</span><br>
<span class="lineno"></span><span class="op" id="8488398">}</span><br>
<span class="lineno">490</span><br>
<span class="lineno"></span><span class="keyword" id="8488401">func</span>&nbsp;<span class="ident" id="8488406">TestHandshakeServerRSA3DES</span><span class="op" id="8488432">(</span><span class="ident" id="8488433">t</span>&nbsp;<span class="op" id="8488435">*</span><span class="ident" id="8488436">testing</span><span class="op" id="8488443">.</span><span class="ident" id="8488444">T</span><span class="op" id="8488445">)</span>&nbsp;<span class="op" id="8488447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488450">test</span>&nbsp;<span class="op" id="8488455">:=</span>&nbsp;<span class="op" id="8488458">&amp;</span><span class="ident" id="8488459">serverTest</span><span class="op" id="8488469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488473">name</span><span class="op" id="8488477">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8488482">&#34;RSA-3DES&#34;</span><span class="op" id="8488492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488496">command</span><span class="op" id="8488503">:</span>&nbsp;<span class="op" id="8488505">[</span><span class="op" id="8488506">]</span><span class="builtintype" id="8488507">string</span><span class="op" id="8488513">{</span><span class="string" id="8488514">&#34;openssl&#34;</span><span class="op" id="8488523">,</span>&nbsp;<span class="string" id="8488525">&#34;s_client&#34;</span><span class="op" id="8488535">,</span>&nbsp;<span class="string" id="8488537">&#34;-no_ticket&#34;</span><span class="op" id="8488549">,</span>&nbsp;<span class="string" id="8488551">&#34;-cipher&#34;</span><span class="op" id="8488560">,</span>&nbsp;<span class="string" id="8488562">&#34;DES-CBC3-SHA&#34;</span><span class="op" id="8488576">}</span><span class="op" id="8488577">,</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488583">runServerTestSSLv3</span><span class="op" id="8488601">(</span><span class="ident" id="8488602">t</span><span class="op" id="8488603">,</span>&nbsp;<span class="ident" id="8488605">test</span><span class="op" id="8488609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488612">runServerTestTLS10</span><span class="op" id="8488630">(</span><span class="ident" id="8488631">t</span><span class="op" id="8488632">,</span>&nbsp;<span class="ident" id="8488634">test</span><span class="op" id="8488638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488641">runServerTestTLS12</span><span class="op" id="8488659">(</span><span class="ident" id="8488660">t</span><span class="op" id="8488661">,</span>&nbsp;<span class="ident" id="8488663">test</span><span class="op" id="8488667">)</span><br>
<span class="lineno"></span><span class="op" id="8488669">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="8488672">func</span>&nbsp;<span class="ident" id="8488677">TestHandshakeServerRSAAES</span><span class="op" id="8488702">(</span><span class="ident" id="8488703">t</span>&nbsp;<span class="op" id="8488705">*</span><span class="ident" id="8488706">testing</span><span class="op" id="8488713">.</span><span class="ident" id="8488714">T</span><span class="op" id="8488715">)</span>&nbsp;<span class="op" id="8488717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488720">test</span>&nbsp;<span class="op" id="8488725">:=</span>&nbsp;<span class="op" id="8488728">&amp;</span><span class="ident" id="8488729">serverTest</span><span class="op" id="8488739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488743">name</span><span class="op" id="8488747">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8488752">&#34;RSA-AES&#34;</span><span class="op" id="8488761">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488765">command</span><span class="op" id="8488772">:</span>&nbsp;<span class="op" id="8488774">[</span><span class="op" id="8488775">]</span><span class="builtintype" id="8488776">string</span><span class="op" id="8488782">{</span><span class="string" id="8488783">&#34;openssl&#34;</span><span class="op" id="8488792">,</span>&nbsp;<span class="string" id="8488794">&#34;s_client&#34;</span><span class="op" id="8488804">,</span>&nbsp;<span class="string" id="8488806">&#34;-no_ticket&#34;</span><span class="op" id="8488818">,</span>&nbsp;<span class="string" id="8488820">&#34;-cipher&#34;</span><span class="op" id="8488829">,</span>&nbsp;<span class="string" id="8488831">&#34;AES128-SHA&#34;</span><span class="op" id="8488843">}</span><span class="op" id="8488844">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8488847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488850">runServerTestSSLv3</span><span class="op" id="8488868">(</span><span class="ident" id="8488869">t</span><span class="op" id="8488870">,</span>&nbsp;<span class="ident" id="8488872">test</span><span class="op" id="8488876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488879">runServerTestTLS10</span><span class="op" id="8488897">(</span><span class="ident" id="8488898">t</span><span class="op" id="8488899">,</span>&nbsp;<span class="ident" id="8488901">test</span><span class="op" id="8488905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488908">runServerTestTLS12</span><span class="op" id="8488926">(</span><span class="ident" id="8488927">t</span><span class="op" id="8488928">,</span>&nbsp;<span class="ident" id="8488930">test</span><span class="op" id="8488934">)</span><br>
<span class="lineno"></span><span class="op" id="8488936">}</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span><span class="keyword" id="8488939">func</span>&nbsp;<span class="ident" id="8488944">TestHandshakeServerAESGCM</span><span class="op" id="8488969">(</span><span class="ident" id="8488970">t</span>&nbsp;<span class="op" id="8488972">*</span><span class="ident" id="8488973">testing</span><span class="op" id="8488980">.</span><span class="ident" id="8488981">T</span><span class="op" id="8488982">)</span>&nbsp;<span class="op" id="8488984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8488987">test</span>&nbsp;<span class="op" id="8488992">:=</span>&nbsp;<span class="op" id="8488995">&amp;</span><span class="ident" id="8488996">serverTest</span><span class="op" id="8489006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489010">name</span><span class="op" id="8489014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8489019">&#34;RSA-AES-GCM&#34;</span><span class="op" id="8489032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489036">command</span><span class="op" id="8489043">:</span>&nbsp;<span class="op" id="8489045">[</span><span class="op" id="8489046">]</span><span class="builtintype" id="8489047">string</span><span class="op" id="8489053">{</span><span class="string" id="8489054">&#34;openssl&#34;</span><span class="op" id="8489063">,</span>&nbsp;<span class="string" id="8489065">&#34;s_client&#34;</span><span class="op" id="8489075">,</span>&nbsp;<span class="string" id="8489077">&#34;-no_ticket&#34;</span><span class="op" id="8489089">,</span>&nbsp;<span class="string" id="8489091">&#34;-cipher&#34;</span><span class="op" id="8489100">,</span>&nbsp;<span class="string" id="8489102">&#34;ECDHE-RSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8489131">}</span><span class="op" id="8489132">,</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8489135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489138">runServerTestTLS12</span><span class="op" id="8489156">(</span><span class="ident" id="8489157">t</span><span class="op" id="8489158">,</span>&nbsp;<span class="ident" id="8489160">test</span><span class="op" id="8489164">)</span><br>
<span class="lineno"></span><span class="op" id="8489166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8489169">func</span>&nbsp;<span class="ident" id="8489174">TestHandshakeServerECDHEECDSAAES</span><span class="op" id="8489206">(</span><span class="ident" id="8489207">t</span>&nbsp;<span class="op" id="8489209">*</span><span class="ident" id="8489210">testing</span><span class="op" id="8489217">.</span><span class="ident" id="8489218">T</span><span class="op" id="8489219">)</span>&nbsp;<span class="op" id="8489221">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489224">config</span>&nbsp;<span class="op" id="8489231">:=</span>&nbsp;<span class="op" id="8489234">*</span><span class="ident" id="8489235">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489247">config</span><span class="op" id="8489253">.</span><span class="ident" id="8489254">Certificates</span>&nbsp;<span class="op" id="8489267">=</span>&nbsp;<span class="builtinfunc" id="8489269">make</span><span class="op" id="8489273">(</span><span class="op" id="8489274">[</span><span class="op" id="8489275">]</span><span class="ident" id="8489276">Certificate</span><span class="op" id="8489287">,</span>&nbsp;<span class="num" id="8489289">1</span><span class="op" id="8489290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489293">config</span><span class="op" id="8489299">.</span><span class="ident" id="8489300">Certificates</span><span class="op" id="8489312">[</span><span class="num" id="8489313">0</span><span class="op" id="8489314">]</span><span class="op" id="8489315">.</span><span class="ident" id="8489316">Certificate</span>&nbsp;<span class="op" id="8489328">=</span>&nbsp;<span class="op" id="8489330">[</span><span class="op" id="8489331">]</span><span class="op" id="8489332">[</span><span class="op" id="8489333">]</span><span class="builtintype" id="8489334">byte</span><span class="op" id="8489338">{</span><span class="ident" id="8489339">testECDSACertificate</span><span class="op" id="8489359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489362">config</span><span class="op" id="8489368">.</span><span class="ident" id="8489369">Certificates</span><span class="op" id="8489381">[</span><span class="num" id="8489382">0</span><span class="op" id="8489383">]</span><span class="op" id="8489384">.</span><span class="ident" id="8489385">PrivateKey</span>&nbsp;<span class="op" id="8489396">=</span>&nbsp;<span class="ident" id="8489398">testECDSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489419">config</span><span class="op" id="8489425">.</span><span class="ident" id="8489426">BuildNameToCertificate</span><span class="op" id="8489448">(</span><span class="op" id="8489449">)</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489453">test</span>&nbsp;<span class="op" id="8489458">:=</span>&nbsp;<span class="op" id="8489461">&amp;</span><span class="ident" id="8489462">serverTest</span><span class="op" id="8489472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489476">name</span><span class="op" id="8489480">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8489485">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8489502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489506">command</span><span class="op" id="8489513">:</span>&nbsp;<span class="op" id="8489515">[</span><span class="op" id="8489516">]</span><span class="builtintype" id="8489517">string</span><span class="op" id="8489523">{</span><span class="string" id="8489524">&#34;openssl&#34;</span><span class="op" id="8489533">,</span>&nbsp;<span class="string" id="8489535">&#34;s_client&#34;</span><span class="op" id="8489545">,</span>&nbsp;<span class="string" id="8489547">&#34;-no_ticket&#34;</span><span class="op" id="8489559">,</span>&nbsp;<span class="string" id="8489561">&#34;-cipher&#34;</span><span class="op" id="8489570">,</span>&nbsp;<span class="string" id="8489572">&#34;ECDHE-ECDSA-AES256-SHA&#34;</span><span class="op" id="8489596">}</span><span class="op" id="8489597">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489601">config</span><span class="op" id="8489607">:</span>&nbsp;&nbsp;<span class="op" id="8489610">&amp;</span><span class="ident" id="8489611">config</span><span class="op" id="8489617">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8489620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489623">runServerTestTLS10</span><span class="op" id="8489641">(</span><span class="ident" id="8489642">t</span><span class="op" id="8489643">,</span>&nbsp;<span class="ident" id="8489645">test</span><span class="op" id="8489649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489652">runServerTestTLS12</span><span class="op" id="8489670">(</span><span class="ident" id="8489671">t</span><span class="op" id="8489672">,</span>&nbsp;<span class="ident" id="8489674">test</span><span class="op" id="8489678">)</span><br>
<span class="lineno"></span><span class="op" id="8489680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span><span class="keyword" id="8489683">func</span>&nbsp;<span class="ident" id="8489688">TestHandshakeServerALPN</span><span class="op" id="8489711">(</span><span class="ident" id="8489712">t</span>&nbsp;<span class="op" id="8489714">*</span><span class="ident" id="8489715">testing</span><span class="op" id="8489722">.</span><span class="ident" id="8489723">T</span><span class="op" id="8489724">)</span>&nbsp;<span class="op" id="8489726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489729">config</span>&nbsp;<span class="op" id="8489736">:=</span>&nbsp;<span class="op" id="8489739">*</span><span class="ident" id="8489740">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489752">config</span><span class="op" id="8489758">.</span><span class="ident" id="8489759">NextProtos</span>&nbsp;<span class="op" id="8489770">=</span>&nbsp;<span class="op" id="8489772">[</span><span class="op" id="8489773">]</span><span class="builtintype" id="8489774">string</span><span class="op" id="8489780">{</span><span class="string" id="8489781">&#34;proto1&#34;</span><span class="op" id="8489789">,</span>&nbsp;<span class="string" id="8489791">&#34;proto2&#34;</span><span class="op" id="8489799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489803">test</span>&nbsp;<span class="op" id="8489808">:=</span>&nbsp;<span class="op" id="8489811">&amp;</span><span class="ident" id="8489812">serverTest</span><span class="op" id="8489822">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489826">name</span><span class="op" id="8489830">:</span>&nbsp;<span class="string" id="8489832">&#34;ALPN&#34;</span><span class="op" id="8489838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8489842">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8489908">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8489951">command</span><span class="op" id="8489958">:</span>&nbsp;<span class="op" id="8489960">[</span><span class="op" id="8489961">]</span><span class="builtintype" id="8489962">string</span><span class="op" id="8489968">{</span><span class="string" id="8489969">&#34;openssl&#34;</span><span class="op" id="8489978">,</span>&nbsp;<span class="string" id="8489980">&#34;s_client&#34;</span><span class="op" id="8489990">,</span>&nbsp;<span class="string" id="8489992">&#34;-alpn&#34;</span><span class="op" id="8489999">,</span>&nbsp;<span class="string" id="8490001">&#34;proto2,proto1&#34;</span><span class="op" id="8490016">}</span><span class="op" id="8490017">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490021">config</span><span class="op" id="8490027">:</span>&nbsp;&nbsp;<span class="op" id="8490030">&amp;</span><span class="ident" id="8490031">config</span><span class="op" id="8490037">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490041">validate</span><span class="op" id="8490049">:</span>&nbsp;<span class="keyword" id="8490051">func</span><span class="op" id="8490055">(</span><span class="ident" id="8490056">state</span>&nbsp;<span class="ident" id="8490062">ConnectionState</span><span class="op" id="8490077">)</span>&nbsp;<span class="builtintype" id="8490079">error</span>&nbsp;<span class="op" id="8490085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8490090">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490149">if</span>&nbsp;<span class="ident" id="8490152">state</span><span class="op" id="8490157">.</span><span class="ident" id="8490158">NegotiatedProtocol</span>&nbsp;<span class="op" id="8490177">!=</span>&nbsp;<span class="string" id="8490180">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8490189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490195">return</span>&nbsp;<span class="ident" id="8490202">fmt</span><span class="op" id="8490205">.</span><span class="ident" id="8490206">Errorf</span><span class="op" id="8490212">(</span><span class="string" id="8490213">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8490245">,</span>&nbsp;<span class="ident" id="8490247">state</span><span class="op" id="8490252">.</span><span class="ident" id="8490253">NegotiatedProtocol</span><span class="op" id="8490271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490276">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490281">return</span>&nbsp;<span class="ident" id="8490288">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490294">}</span><span class="op" id="8490295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490301">runServerTestTLS12</span><span class="op" id="8490319">(</span><span class="ident" id="8490320">t</span><span class="op" id="8490321">,</span>&nbsp;<span class="ident" id="8490323">test</span><span class="op" id="8490327">)</span><br>
<span class="lineno"></span><span class="op" id="8490329">}</span><br>
<span class="lineno">555</span><br>
<span class="lineno"></span><span class="keyword" id="8490332">func</span>&nbsp;<span class="ident" id="8490337">TestHandshakeServerALPNNoMatch</span><span class="op" id="8490367">(</span><span class="ident" id="8490368">t</span>&nbsp;<span class="op" id="8490370">*</span><span class="ident" id="8490371">testing</span><span class="op" id="8490378">.</span><span class="ident" id="8490379">T</span><span class="op" id="8490380">)</span>&nbsp;<span class="op" id="8490382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490385">config</span>&nbsp;<span class="op" id="8490392">:=</span>&nbsp;<span class="op" id="8490395">*</span><span class="ident" id="8490396">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490408">config</span><span class="op" id="8490414">.</span><span class="ident" id="8490415">NextProtos</span>&nbsp;<span class="op" id="8490426">=</span>&nbsp;<span class="op" id="8490428">[</span><span class="op" id="8490429">]</span><span class="builtintype" id="8490430">string</span><span class="op" id="8490436">{</span><span class="string" id="8490437">&#34;proto3&#34;</span><span class="op" id="8490445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490449">test</span>&nbsp;<span class="op" id="8490454">:=</span>&nbsp;<span class="op" id="8490457">&amp;</span><span class="ident" id="8490458">serverTest</span><span class="op" id="8490468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490472">name</span><span class="op" id="8490476">:</span>&nbsp;<span class="string" id="8490478">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8490492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8490496">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8490562">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490605">command</span><span class="op" id="8490612">:</span>&nbsp;<span class="op" id="8490614">[</span><span class="op" id="8490615">]</span><span class="builtintype" id="8490616">string</span><span class="op" id="8490622">{</span><span class="string" id="8490623">&#34;openssl&#34;</span><span class="op" id="8490632">,</span>&nbsp;<span class="string" id="8490634">&#34;s_client&#34;</span><span class="op" id="8490644">,</span>&nbsp;<span class="string" id="8490646">&#34;-alpn&#34;</span><span class="op" id="8490653">,</span>&nbsp;<span class="string" id="8490655">&#34;proto2,proto1&#34;</span><span class="op" id="8490670">}</span><span class="op" id="8490671">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490675">config</span><span class="op" id="8490681">:</span>&nbsp;&nbsp;<span class="op" id="8490684">&amp;</span><span class="ident" id="8490685">config</span><span class="op" id="8490691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490695">validate</span><span class="op" id="8490703">:</span>&nbsp;<span class="keyword" id="8490705">func</span><span class="op" id="8490709">(</span><span class="ident" id="8490710">state</span>&nbsp;<span class="ident" id="8490716">ConnectionState</span><span class="op" id="8490731">)</span>&nbsp;<span class="builtintype" id="8490733">error</span>&nbsp;<span class="op" id="8490739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8490744">//&nbsp;Rather&nbsp;than&nbsp;reject&nbsp;the&nbsp;connection,&nbsp;Go&nbsp;doesn&#39;t&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8490803">//&nbsp;a&nbsp;protocol&nbsp;when&nbsp;there&nbsp;is&nbsp;no&nbsp;overlap.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490846">if</span>&nbsp;<span class="ident" id="8490849">state</span><span class="op" id="8490854">.</span><span class="ident" id="8490855">NegotiatedProtocol</span>&nbsp;<span class="op" id="8490874">!=</span>&nbsp;<span class="string" id="8490877">&#34;&#34;</span>&nbsp;<span class="op" id="8490880">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490886">return</span>&nbsp;<span class="ident" id="8490893">fmt</span><span class="op" id="8490896">.</span><span class="ident" id="8490897">Errorf</span><span class="op" id="8490903">(</span><span class="string" id="8490904">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8490932">,</span>&nbsp;<span class="ident" id="8490934">state</span><span class="op" id="8490939">.</span><span class="ident" id="8490940">NegotiatedProtocol</span><span class="op" id="8490958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8490968">return</span>&nbsp;<span class="ident" id="8490975">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490981">}</span><span class="op" id="8490982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8490985">}</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8490988">runServerTestTLS12</span><span class="op" id="8491006">(</span><span class="ident" id="8491007">t</span><span class="op" id="8491008">,</span>&nbsp;<span class="ident" id="8491010">test</span><span class="op" id="8491014">)</span><br>
<span class="lineno"></span><span class="op" id="8491016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8491019">//&nbsp;TestHandshakeServerSNI&nbsp;involves&nbsp;a&nbsp;client&nbsp;sending&nbsp;an&nbsp;SNI&nbsp;extension&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="8491091">//&nbsp;&#34;snitest.com&#34;,&nbsp;which&nbsp;happens&nbsp;to&nbsp;match&nbsp;the&nbsp;CN&nbsp;of&nbsp;testSNICertificate.&nbsp;The&nbsp;test</span><br>
<span class="lineno">580</span><span class="comment" id="8491171">//&nbsp;verifies&nbsp;that&nbsp;the&nbsp;server&nbsp;correctly&nbsp;selects&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8491235">func</span>&nbsp;<span class="ident" id="8491240">TestHandshakeServerSNI</span><span class="op" id="8491262">(</span><span class="ident" id="8491263">t</span>&nbsp;<span class="op" id="8491265">*</span><span class="ident" id="8491266">testing</span><span class="op" id="8491273">.</span><span class="ident" id="8491274">T</span><span class="op" id="8491275">)</span>&nbsp;<span class="op" id="8491277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491280">test</span>&nbsp;<span class="op" id="8491285">:=</span>&nbsp;<span class="op" id="8491288">&amp;</span><span class="ident" id="8491289">serverTest</span><span class="op" id="8491299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491303">name</span><span class="op" id="8491307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491312">&#34;SNI&#34;</span><span class="op" id="8491317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491321">command</span><span class="op" id="8491328">:</span>&nbsp;<span class="op" id="8491330">[</span><span class="op" id="8491331">]</span><span class="builtintype" id="8491332">string</span><span class="op" id="8491338">{</span><span class="string" id="8491339">&#34;openssl&#34;</span><span class="op" id="8491348">,</span>&nbsp;<span class="string" id="8491350">&#34;s_client&#34;</span><span class="op" id="8491360">,</span>&nbsp;<span class="string" id="8491362">&#34;-no_ticket&#34;</span><span class="op" id="8491374">,</span>&nbsp;<span class="string" id="8491376">&#34;-cipher&#34;</span><span class="op" id="8491385">,</span>&nbsp;<span class="string" id="8491387">&#34;AES128-SHA&#34;</span><span class="op" id="8491399">,</span>&nbsp;<span class="string" id="8491401">&#34;-servername&#34;</span><span class="op" id="8491414">,</span>&nbsp;<span class="string" id="8491416">&#34;snitest.com&#34;</span><span class="op" id="8491429">}</span><span class="op" id="8491430">,</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8491433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491436">runServerTestTLS12</span><span class="op" id="8491454">(</span><span class="ident" id="8491455">t</span><span class="op" id="8491456">,</span>&nbsp;<span class="ident" id="8491458">test</span><span class="op" id="8491462">)</span><br>
<span class="lineno"></span><span class="op" id="8491464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8491467">//&nbsp;TestHandshakeServerSNICertForName&nbsp;is&nbsp;similar&nbsp;to&nbsp;TestHandshakeServerSNI,&nbsp;but</span><br>
<span class="lineno">590</span><span class="comment" id="8491546">//&nbsp;tests&nbsp;the&nbsp;dynamic&nbsp;GetCertificate&nbsp;method</span><br>
<span class="lineno"></span><span class="keyword" id="8491589">func</span>&nbsp;<span class="ident" id="8491594">TestHandshakeServerSNIGetCertificate</span><span class="op" id="8491630">(</span><span class="ident" id="8491631">t</span>&nbsp;<span class="op" id="8491633">*</span><span class="ident" id="8491634">testing</span><span class="op" id="8491641">.</span><span class="ident" id="8491642">T</span><span class="op" id="8491643">)</span>&nbsp;<span class="op" id="8491645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491648">config</span>&nbsp;<span class="op" id="8491655">:=</span>&nbsp;<span class="op" id="8491658">*</span><span class="ident" id="8491659">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8491672">//&nbsp;Replace&nbsp;the&nbsp;NameToCertificate&nbsp;map&nbsp;with&nbsp;a&nbsp;GetCertificate&nbsp;function</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491741">nameToCert</span>&nbsp;<span class="op" id="8491752">:=</span>&nbsp;<span class="ident" id="8491755">config</span><span class="op" id="8491761">.</span><span class="ident" id="8491762">NameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491781">config</span><span class="op" id="8491787">.</span><span class="ident" id="8491788">NameToCertificate</span>&nbsp;<span class="op" id="8491806">=</span>&nbsp;<span class="ident" id="8491808">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491813">config</span><span class="op" id="8491819">.</span><span class="ident" id="8491820">GetCertificate</span>&nbsp;<span class="op" id="8491835">=</span>&nbsp;<span class="keyword" id="8491837">func</span><span class="op" id="8491841">(</span><span class="ident" id="8491842">clientHello</span>&nbsp;<span class="op" id="8491854">*</span><span class="ident" id="8491855">ClientHelloInfo</span><span class="op" id="8491870">)</span>&nbsp;<span class="op" id="8491872">(</span><span class="op" id="8491873">*</span><span class="ident" id="8491874">Certificate</span><span class="op" id="8491885">,</span>&nbsp;<span class="builtintype" id="8491887">error</span><span class="op" id="8491892">)</span>&nbsp;<span class="op" id="8491894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491898">cert</span><span class="op" id="8491902">,</span>&nbsp;<span class="ident" id="8491904">_</span>&nbsp;<span class="op" id="8491906">:=</span>&nbsp;<span class="ident" id="8491909">nameToCert</span><span class="op" id="8491919">[</span><span class="ident" id="8491920">clientHello</span><span class="op" id="8491931">.</span><span class="ident" id="8491932">ServerName</span><span class="op" id="8491942">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8491946">return</span>&nbsp;<span class="ident" id="8491953">cert</span><span class="op" id="8491957">,</span>&nbsp;<span class="ident" id="8491959">nil</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8491964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491967">test</span>&nbsp;<span class="op" id="8491972">:=</span>&nbsp;<span class="op" id="8491975">&amp;</span><span class="ident" id="8491976">serverTest</span><span class="op" id="8491986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8491990">name</span><span class="op" id="8491994">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8491999">&#34;SNI&#34;</span><span class="op" id="8492004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492008">command</span><span class="op" id="8492015">:</span>&nbsp;<span class="op" id="8492017">[</span><span class="op" id="8492018">]</span><span class="builtintype" id="8492019">string</span><span class="op" id="8492025">{</span><span class="string" id="8492026">&#34;openssl&#34;</span><span class="op" id="8492035">,</span>&nbsp;<span class="string" id="8492037">&#34;s_client&#34;</span><span class="op" id="8492047">,</span>&nbsp;<span class="string" id="8492049">&#34;-no_ticket&#34;</span><span class="op" id="8492061">,</span>&nbsp;<span class="string" id="8492063">&#34;-cipher&#34;</span><span class="op" id="8492072">,</span>&nbsp;<span class="string" id="8492074">&#34;AES128-SHA&#34;</span><span class="op" id="8492086">,</span>&nbsp;<span class="string" id="8492088">&#34;-servername&#34;</span><span class="op" id="8492101">,</span>&nbsp;<span class="string" id="8492103">&#34;snitest.com&#34;</span><span class="op" id="8492116">}</span><span class="op" id="8492117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492121">config</span><span class="op" id="8492127">:</span>&nbsp;&nbsp;<span class="op" id="8492130">&amp;</span><span class="ident" id="8492131">config</span><span class="op" id="8492137">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492143">runServerTestTLS12</span><span class="op" id="8492161">(</span><span class="ident" id="8492162">t</span><span class="op" id="8492163">,</span>&nbsp;<span class="ident" id="8492165">test</span><span class="op" id="8492169">)</span><br>
<span class="lineno"></span><span class="op" id="8492171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8492174">//&nbsp;TestHandshakeServerSNICertForNameNotFound&nbsp;is&nbsp;similar&nbsp;to</span><br>
<span class="lineno">610</span><span class="comment" id="8492233">//&nbsp;TestHandshakeServerSNICertForName,&nbsp;but&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;when&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8492308">//&nbsp;GetCertificate&nbsp;method&nbsp;doesn&#39;t&nbsp;return&nbsp;a&nbsp;cert,&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;what&#39;s&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8492382">//&nbsp;the&nbsp;NameToCertificate&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8492412">func</span>&nbsp;<span class="ident" id="8492417">TestHandshakeServerSNIGetCertificateNotFound</span><span class="op" id="8492461">(</span><span class="ident" id="8492462">t</span>&nbsp;<span class="op" id="8492464">*</span><span class="ident" id="8492465">testing</span><span class="op" id="8492472">.</span><span class="ident" id="8492473">T</span><span class="op" id="8492474">)</span>&nbsp;<span class="op" id="8492476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492479">config</span>&nbsp;<span class="op" id="8492486">:=</span>&nbsp;<span class="op" id="8492489">*</span><span class="ident" id="8492490">testConfig</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492503">config</span><span class="op" id="8492509">.</span><span class="ident" id="8492510">GetCertificate</span>&nbsp;<span class="op" id="8492525">=</span>&nbsp;<span class="keyword" id="8492527">func</span><span class="op" id="8492531">(</span><span class="ident" id="8492532">clientHello</span>&nbsp;<span class="op" id="8492544">*</span><span class="ident" id="8492545">ClientHelloInfo</span><span class="op" id="8492560">)</span>&nbsp;<span class="op" id="8492562">(</span><span class="op" id="8492563">*</span><span class="ident" id="8492564">Certificate</span><span class="op" id="8492575">,</span>&nbsp;<span class="builtintype" id="8492577">error</span><span class="op" id="8492582">)</span>&nbsp;<span class="op" id="8492584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8492588">return</span>&nbsp;<span class="ident" id="8492595">nil</span><span class="op" id="8492598">,</span>&nbsp;<span class="ident" id="8492600">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492608">test</span>&nbsp;<span class="op" id="8492613">:=</span>&nbsp;<span class="op" id="8492616">&amp;</span><span class="ident" id="8492617">serverTest</span><span class="op" id="8492627">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492631">name</span><span class="op" id="8492635">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8492640">&#34;SNI&#34;</span><span class="op" id="8492645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492649">command</span><span class="op" id="8492656">:</span>&nbsp;<span class="op" id="8492658">[</span><span class="op" id="8492659">]</span><span class="builtintype" id="8492660">string</span><span class="op" id="8492666">{</span><span class="string" id="8492667">&#34;openssl&#34;</span><span class="op" id="8492676">,</span>&nbsp;<span class="string" id="8492678">&#34;s_client&#34;</span><span class="op" id="8492688">,</span>&nbsp;<span class="string" id="8492690">&#34;-no_ticket&#34;</span><span class="op" id="8492702">,</span>&nbsp;<span class="string" id="8492704">&#34;-cipher&#34;</span><span class="op" id="8492713">,</span>&nbsp;<span class="string" id="8492715">&#34;AES128-SHA&#34;</span><span class="op" id="8492727">,</span>&nbsp;<span class="string" id="8492729">&#34;-servername&#34;</span><span class="op" id="8492742">,</span>&nbsp;<span class="string" id="8492744">&#34;snitest.com&#34;</span><span class="op" id="8492757">}</span><span class="op" id="8492758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492762">config</span><span class="op" id="8492768">:</span>&nbsp;&nbsp;<span class="op" id="8492771">&amp;</span><span class="ident" id="8492772">config</span><span class="op" id="8492778">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8492781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492784">runServerTestTLS12</span><span class="op" id="8492802">(</span><span class="ident" id="8492803">t</span><span class="op" id="8492804">,</span>&nbsp;<span class="ident" id="8492806">test</span><span class="op" id="8492810">)</span><br>
<span class="lineno">625</span><span class="op" id="8492812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8492815">//&nbsp;TestHandshakeServerSNICertForNameError&nbsp;tests&nbsp;to&nbsp;make&nbsp;sure&nbsp;that&nbsp;errors&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8492891">//&nbsp;GetCertificate&nbsp;result&nbsp;in&nbsp;a&nbsp;tls&nbsp;alert.</span><br>
<span class="lineno"></span><span class="keyword" id="8492932">func</span>&nbsp;<span class="ident" id="8492937">TestHandshakeServerSNIGetCertificateError</span><span class="op" id="8492978">(</span><span class="ident" id="8492979">t</span>&nbsp;<span class="op" id="8492981">*</span><span class="ident" id="8492982">testing</span><span class="op" id="8492989">.</span><span class="ident" id="8492990">T</span><span class="op" id="8492991">)</span>&nbsp;<span class="op" id="8492993">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8492996">config</span>&nbsp;<span class="op" id="8493003">:=</span>&nbsp;<span class="op" id="8493006">*</span><span class="ident" id="8493007">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493020">config</span><span class="op" id="8493026">.</span><span class="ident" id="8493027">GetCertificate</span>&nbsp;<span class="op" id="8493042">=</span>&nbsp;<span class="keyword" id="8493044">func</span><span class="op" id="8493048">(</span><span class="ident" id="8493049">clientHello</span>&nbsp;<span class="op" id="8493061">*</span><span class="ident" id="8493062">ClientHelloInfo</span><span class="op" id="8493077">)</span>&nbsp;<span class="op" id="8493079">(</span><span class="op" id="8493080">*</span><span class="ident" id="8493081">Certificate</span><span class="op" id="8493092">,</span>&nbsp;<span class="builtintype" id="8493094">error</span><span class="op" id="8493099">)</span>&nbsp;<span class="op" id="8493101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8493105">return</span>&nbsp;<span class="ident" id="8493112">nil</span><span class="op" id="8493115">,</span>&nbsp;<span class="ident" id="8493117">fmt</span><span class="op" id="8493120">.</span><span class="ident" id="8493121">Errorf</span><span class="op" id="8493127">(</span><span class="string" id="8493128">&#34;Test&nbsp;error&nbsp;in&nbsp;GetCertificate&#34;</span><span class="op" id="8493158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8493161">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493164">test</span>&nbsp;<span class="op" id="8493169">:=</span>&nbsp;<span class="op" id="8493172">&amp;</span><span class="ident" id="8493173">serverTest</span><span class="op" id="8493183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493187">name</span><span class="op" id="8493191">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8493200">&#34;SNI&#34;</span><span class="op" id="8493205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493209">command</span><span class="op" id="8493216">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8493222">[</span><span class="op" id="8493223">]</span><span class="builtintype" id="8493224">string</span><span class="op" id="8493230">{</span><span class="string" id="8493231">&#34;openssl&#34;</span><span class="op" id="8493240">,</span>&nbsp;<span class="string" id="8493242">&#34;s_client&#34;</span><span class="op" id="8493252">,</span>&nbsp;<span class="string" id="8493254">&#34;-no_ticket&#34;</span><span class="op" id="8493266">,</span>&nbsp;<span class="string" id="8493268">&#34;-cipher&#34;</span><span class="op" id="8493277">,</span>&nbsp;<span class="string" id="8493279">&#34;AES128-SHA&#34;</span><span class="op" id="8493291">,</span>&nbsp;<span class="string" id="8493293">&#34;-servername&#34;</span><span class="op" id="8493306">,</span>&nbsp;<span class="string" id="8493308">&#34;snitest.com&#34;</span><span class="op" id="8493321">}</span><span class="op" id="8493322">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493326">config</span><span class="op" id="8493332">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8493339">&amp;</span><span class="ident" id="8493340">config</span><span class="op" id="8493346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493350">expectAlert</span><span class="op" id="8493361">:</span>&nbsp;<span class="builtintype" id="8493363">true</span><span class="op" id="8493367">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8493370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493373">runServerTestTLS12</span><span class="op" id="8493391">(</span><span class="ident" id="8493392">t</span><span class="op" id="8493393">,</span>&nbsp;<span class="ident" id="8493395">test</span><span class="op" id="8493399">)</span><br>
<span class="lineno"></span><span class="op" id="8493401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8493404">//&nbsp;TestCipherSuiteCertPreferance&nbsp;ensures&nbsp;that&nbsp;we&nbsp;select&nbsp;an&nbsp;RSA&nbsp;ciphersuite&nbsp;with</span><br>
<span class="lineno">645</span><span class="comment" id="8493484">//&nbsp;an&nbsp;RSA&nbsp;certificate&nbsp;and&nbsp;an&nbsp;ECDSA&nbsp;ciphersuite&nbsp;with&nbsp;an&nbsp;ECDSA&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="8493558">func</span>&nbsp;<span class="ident" id="8493563">TestCipherSuiteCertPreferenceECDSA</span><span class="op" id="8493597">(</span><span class="ident" id="8493598">t</span>&nbsp;<span class="op" id="8493600">*</span><span class="ident" id="8493601">testing</span><span class="op" id="8493608">.</span><span class="ident" id="8493609">T</span><span class="op" id="8493610">)</span>&nbsp;<span class="op" id="8493612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493615">config</span>&nbsp;<span class="op" id="8493622">:=</span>&nbsp;<span class="op" id="8493625">*</span><span class="ident" id="8493626">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493638">config</span><span class="op" id="8493644">.</span><span class="ident" id="8493645">CipherSuites</span>&nbsp;<span class="op" id="8493658">=</span>&nbsp;<span class="op" id="8493660">[</span><span class="op" id="8493661">]</span><span class="builtintype" id="8493662">uint16</span><span class="op" id="8493668">{</span><span class="ident" id="8493669">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8493705">,</span>&nbsp;<span class="ident" id="8493707">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8493741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493744">config</span><span class="op" id="8493750">.</span><span class="ident" id="8493751">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8493776">=</span>&nbsp;<span class="builtintype" id="8493778">true</span><br>
<span class="lineno">650</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493785">test</span>&nbsp;<span class="op" id="8493790">:=</span>&nbsp;<span class="op" id="8493793">&amp;</span><span class="ident" id="8493794">serverTest</span><span class="op" id="8493804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493808">name</span><span class="op" id="8493812">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8493816">&#34;CipherSuiteCertPreferenceRSA&#34;</span><span class="op" id="8493846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493850">config</span><span class="op" id="8493856">:</span>&nbsp;<span class="op" id="8493858">&amp;</span><span class="ident" id="8493859">config</span><span class="op" id="8493865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8493868">}</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493871">runServerTestTLS12</span><span class="op" id="8493889">(</span><span class="ident" id="8493890">t</span><span class="op" id="8493891">,</span>&nbsp;<span class="ident" id="8493893">test</span><span class="op" id="8493897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493901">config</span>&nbsp;<span class="op" id="8493908">=</span>&nbsp;<span class="op" id="8493910">*</span><span class="ident" id="8493911">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8493923">config</span><span class="op" id="8493929">.</span><span class="ident" id="8493930">CipherSuites</span>&nbsp;<span class="op" id="8493943">=</span>&nbsp;<span class="op" id="8493945">[</span><span class="op" id="8493946">]</span><span class="builtintype" id="8493947">uint16</span><span class="op" id="8493953">{</span><span class="ident" id="8493954">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8493988">,</span>&nbsp;<span class="ident" id="8493990">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA</span><span class="op" id="8494026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494029">config</span><span class="op" id="8494035">.</span><span class="ident" id="8494036">Certificates</span>&nbsp;<span class="op" id="8494049">=</span>&nbsp;<span class="op" id="8494051">[</span><span class="op" id="8494052">]</span><span class="ident" id="8494053">Certificate</span><span class="op" id="8494064">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8494068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494073">Certificate</span><span class="op" id="8494084">:</span>&nbsp;<span class="op" id="8494086">[</span><span class="op" id="8494087">]</span><span class="op" id="8494088">[</span><span class="op" id="8494089">]</span><span class="builtintype" id="8494090">byte</span><span class="op" id="8494094">{</span><span class="ident" id="8494095">testECDSACertificate</span><span class="op" id="8494115">}</span><span class="op" id="8494116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494121">PrivateKey</span><span class="op" id="8494131">:</span>&nbsp;&nbsp;<span class="ident" id="8494134">testECDSAPrivateKey</span><span class="op" id="8494153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8494157">}</span><span class="op" id="8494158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8494161">}</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494164">config</span><span class="op" id="8494170">.</span><span class="ident" id="8494171">BuildNameToCertificate</span><span class="op" id="8494193">(</span><span class="op" id="8494194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494197">config</span><span class="op" id="8494203">.</span><span class="ident" id="8494204">PreferServerCipherSuites</span>&nbsp;<span class="op" id="8494229">=</span>&nbsp;<span class="builtintype" id="8494231">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494238">test</span>&nbsp;<span class="op" id="8494243">=</span>&nbsp;<span class="op" id="8494245">&amp;</span><span class="ident" id="8494246">serverTest</span><span class="op" id="8494256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494260">name</span><span class="op" id="8494264">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8494268">&#34;CipherSuiteCertPreferenceECDSA&#34;</span><span class="op" id="8494300">,</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494304">config</span><span class="op" id="8494310">:</span>&nbsp;<span class="op" id="8494312">&amp;</span><span class="ident" id="8494313">config</span><span class="op" id="8494319">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8494322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494325">runServerTestTLS12</span><span class="op" id="8494343">(</span><span class="ident" id="8494344">t</span><span class="op" id="8494345">,</span>&nbsp;<span class="ident" id="8494347">test</span><span class="op" id="8494351">)</span><br>
<span class="lineno"></span><span class="op" id="8494353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span><span class="keyword" id="8494356">func</span>&nbsp;<span class="ident" id="8494361">TestResumption</span><span class="op" id="8494375">(</span><span class="ident" id="8494376">t</span>&nbsp;<span class="op" id="8494378">*</span><span class="ident" id="8494379">testing</span><span class="op" id="8494386">.</span><span class="ident" id="8494387">T</span><span class="op" id="8494388">)</span>&nbsp;<span class="op" id="8494390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494393">sessionFilePath</span>&nbsp;<span class="op" id="8494409">:=</span>&nbsp;<span class="ident" id="8494412">tempFile</span><span class="op" id="8494420">(</span><span class="string" id="8494421">&#34;&#34;</span><span class="op" id="8494423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8494426">defer</span>&nbsp;<span class="ident" id="8494432">os</span><span class="op" id="8494434">.</span><span class="ident" id="8494435">Remove</span><span class="op" id="8494441">(</span><span class="ident" id="8494442">sessionFilePath</span><span class="op" id="8494457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494461">test</span>&nbsp;<span class="op" id="8494466">:=</span>&nbsp;<span class="op" id="8494469">&amp;</span><span class="ident" id="8494470">serverTest</span><span class="op" id="8494480">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494484">name</span><span class="op" id="8494488">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8494493">&#34;IssueTicket&#34;</span><span class="op" id="8494506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494510">command</span><span class="op" id="8494517">:</span>&nbsp;<span class="op" id="8494519">[</span><span class="op" id="8494520">]</span><span class="builtintype" id="8494521">string</span><span class="op" id="8494527">{</span><span class="string" id="8494528">&#34;openssl&#34;</span><span class="op" id="8494537">,</span>&nbsp;<span class="string" id="8494539">&#34;s_client&#34;</span><span class="op" id="8494549">,</span>&nbsp;<span class="string" id="8494551">&#34;-cipher&#34;</span><span class="op" id="8494560">,</span>&nbsp;<span class="string" id="8494562">&#34;RC4-SHA&#34;</span><span class="op" id="8494571">,</span>&nbsp;<span class="string" id="8494573">&#34;-sess_out&#34;</span><span class="op" id="8494584">,</span>&nbsp;<span class="ident" id="8494586">sessionFilePath</span><span class="op" id="8494601">}</span><span class="op" id="8494602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8494605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494608">runServerTestTLS12</span><span class="op" id="8494626">(</span><span class="ident" id="8494627">t</span><span class="op" id="8494628">,</span>&nbsp;<span class="ident" id="8494630">test</span><span class="op" id="8494634">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494638">test</span>&nbsp;<span class="op" id="8494643">=</span>&nbsp;<span class="op" id="8494645">&amp;</span><span class="ident" id="8494646">serverTest</span><span class="op" id="8494656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494660">name</span><span class="op" id="8494664">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8494669">&#34;Resume&#34;</span><span class="op" id="8494677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494681">command</span><span class="op" id="8494688">:</span>&nbsp;<span class="op" id="8494690">[</span><span class="op" id="8494691">]</span><span class="builtintype" id="8494692">string</span><span class="op" id="8494698">{</span><span class="string" id="8494699">&#34;openssl&#34;</span><span class="op" id="8494708">,</span>&nbsp;<span class="string" id="8494710">&#34;s_client&#34;</span><span class="op" id="8494720">,</span>&nbsp;<span class="string" id="8494722">&#34;-cipher&#34;</span><span class="op" id="8494731">,</span>&nbsp;<span class="string" id="8494733">&#34;RC4-SHA&#34;</span><span class="op" id="8494742">,</span>&nbsp;<span class="string" id="8494744">&#34;-sess_in&#34;</span><span class="op" id="8494754">,</span>&nbsp;<span class="ident" id="8494756">sessionFilePath</span><span class="op" id="8494771">}</span><span class="op" id="8494772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8494775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494778">runServerTestTLS12</span><span class="op" id="8494796">(</span><span class="ident" id="8494797">t</span><span class="op" id="8494798">,</span>&nbsp;<span class="ident" id="8494800">test</span><span class="op" id="8494804">)</span><br>
<span class="lineno">690</span><span class="op" id="8494806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8494809">func</span>&nbsp;<span class="ident" id="8494814">TestResumptionDisabled</span><span class="op" id="8494836">(</span><span class="ident" id="8494837">t</span>&nbsp;<span class="op" id="8494839">*</span><span class="ident" id="8494840">testing</span><span class="op" id="8494847">.</span><span class="ident" id="8494848">T</span><span class="op" id="8494849">)</span>&nbsp;<span class="op" id="8494851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494854">sessionFilePath</span>&nbsp;<span class="op" id="8494870">:=</span>&nbsp;<span class="ident" id="8494873">tempFile</span><span class="op" id="8494881">(</span><span class="string" id="8494882">&#34;&#34;</span><span class="op" id="8494884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8494887">defer</span>&nbsp;<span class="ident" id="8494893">os</span><span class="op" id="8494895">.</span><span class="ident" id="8494896">Remove</span><span class="op" id="8494902">(</span><span class="ident" id="8494903">sessionFilePath</span><span class="op" id="8494918">)</span><br>
<span class="lineno">695</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494922">config</span>&nbsp;<span class="op" id="8494929">:=</span>&nbsp;<span class="op" id="8494932">*</span><span class="ident" id="8494933">testConfig</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494946">test</span>&nbsp;<span class="op" id="8494951">:=</span>&nbsp;<span class="op" id="8494954">&amp;</span><span class="ident" id="8494955">serverTest</span><span class="op" id="8494965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8494969">name</span><span class="op" id="8494973">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8494978">&#34;IssueTicketPreDisable&#34;</span><span class="op" id="8495001">,</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495005">command</span><span class="op" id="8495012">:</span>&nbsp;<span class="op" id="8495014">[</span><span class="op" id="8495015">]</span><span class="builtintype" id="8495016">string</span><span class="op" id="8495022">{</span><span class="string" id="8495023">&#34;openssl&#34;</span><span class="op" id="8495032">,</span>&nbsp;<span class="string" id="8495034">&#34;s_client&#34;</span><span class="op" id="8495044">,</span>&nbsp;<span class="string" id="8495046">&#34;-cipher&#34;</span><span class="op" id="8495055">,</span>&nbsp;<span class="string" id="8495057">&#34;RC4-SHA&#34;</span><span class="op" id="8495066">,</span>&nbsp;<span class="string" id="8495068">&#34;-sess_out&#34;</span><span class="op" id="8495079">,</span>&nbsp;<span class="ident" id="8495081">sessionFilePath</span><span class="op" id="8495096">}</span><span class="op" id="8495097">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495101">config</span><span class="op" id="8495107">:</span>&nbsp;&nbsp;<span class="op" id="8495110">&amp;</span><span class="ident" id="8495111">config</span><span class="op" id="8495117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8495120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495123">runServerTestTLS12</span><span class="op" id="8495141">(</span><span class="ident" id="8495142">t</span><span class="op" id="8495143">,</span>&nbsp;<span class="ident" id="8495145">test</span><span class="op" id="8495149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495153">config</span><span class="op" id="8495159">.</span><span class="ident" id="8495160">SessionTicketsDisabled</span>&nbsp;<span class="op" id="8495183">=</span>&nbsp;<span class="builtintype" id="8495185">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495192">test</span>&nbsp;<span class="op" id="8495197">=</span>&nbsp;<span class="op" id="8495199">&amp;</span><span class="ident" id="8495200">serverTest</span><span class="op" id="8495210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495214">name</span><span class="op" id="8495218">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8495223">&#34;ResumeDisabled&#34;</span><span class="op" id="8495239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495243">command</span><span class="op" id="8495250">:</span>&nbsp;<span class="op" id="8495252">[</span><span class="op" id="8495253">]</span><span class="builtintype" id="8495254">string</span><span class="op" id="8495260">{</span><span class="string" id="8495261">&#34;openssl&#34;</span><span class="op" id="8495270">,</span>&nbsp;<span class="string" id="8495272">&#34;s_client&#34;</span><span class="op" id="8495282">,</span>&nbsp;<span class="string" id="8495284">&#34;-cipher&#34;</span><span class="op" id="8495293">,</span>&nbsp;<span class="string" id="8495295">&#34;RC4-SHA&#34;</span><span class="op" id="8495304">,</span>&nbsp;<span class="string" id="8495306">&#34;-sess_in&#34;</span><span class="op" id="8495316">,</span>&nbsp;<span class="ident" id="8495318">sessionFilePath</span><span class="op" id="8495333">}</span><span class="op" id="8495334">,</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495338">config</span><span class="op" id="8495344">:</span>&nbsp;&nbsp;<span class="op" id="8495347">&amp;</span><span class="ident" id="8495348">config</span><span class="op" id="8495354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8495357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495360">runServerTestTLS12</span><span class="op" id="8495378">(</span><span class="ident" id="8495379">t</span><span class="op" id="8495380">,</span>&nbsp;<span class="ident" id="8495382">test</span><span class="op" id="8495386">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8495390">//&nbsp;One&nbsp;needs&nbsp;to&nbsp;manually&nbsp;confirm&nbsp;that&nbsp;the&nbsp;handshake&nbsp;in&nbsp;the&nbsp;golden&nbsp;data</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8495462">//&nbsp;file&nbsp;for&nbsp;ResumeDisabled&nbsp;does&nbsp;not&nbsp;include&nbsp;a&nbsp;resumption&nbsp;handshake.</span><br>
<span class="lineno"></span><span class="op" id="8495530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8495533">func</span>&nbsp;<span class="ident" id="8495538">TestFallbackSCSV</span><span class="op" id="8495554">(</span><span class="ident" id="8495555">t</span>&nbsp;<span class="op" id="8495557">*</span><span class="ident" id="8495558">testing</span><span class="op" id="8495565">.</span><span class="ident" id="8495566">T</span><span class="op" id="8495567">)</span>&nbsp;<span class="op" id="8495569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495572">test</span>&nbsp;<span class="op" id="8495577">:=</span>&nbsp;<span class="op" id="8495580">&amp;</span><span class="ident" id="8495581">serverTest</span><span class="op" id="8495591">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495595">name</span><span class="op" id="8495599">:</span>&nbsp;<span class="string" id="8495601">&#34;FallbackSCSV&#34;</span><span class="op" id="8495615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8495619">//&nbsp;OpenSSL&nbsp;1.0.1j&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;-fallback_scsv&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495680">command</span><span class="op" id="8495687">:</span>&nbsp;<span class="op" id="8495689">[</span><span class="op" id="8495690">]</span><span class="builtintype" id="8495691">string</span><span class="op" id="8495697">{</span><span class="string" id="8495698">&#34;openssl&#34;</span><span class="op" id="8495707">,</span>&nbsp;<span class="string" id="8495709">&#34;s_client&#34;</span><span class="op" id="8495719">,</span>&nbsp;<span class="string" id="8495721">&#34;-fallback_scsv&#34;</span><span class="op" id="8495737">}</span><span class="op" id="8495738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495742">expectHandshakeErrorIncluding</span><span class="op" id="8495771">:</span>&nbsp;<span class="string" id="8495773">&#34;inppropriate&nbsp;protocol&nbsp;fallback&#34;</span><span class="op" id="8495805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8495808">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8495811">runServerTestTLS11</span><span class="op" id="8495829">(</span><span class="ident" id="8495830">t</span><span class="op" id="8495831">,</span>&nbsp;<span class="ident" id="8495833">test</span><span class="op" id="8495837">)</span><br>
<span class="lineno"></span><span class="op" id="8495839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8495842">//&nbsp;cert.pem&nbsp;and&nbsp;key.pem&nbsp;were&nbsp;generated&nbsp;with&nbsp;generate_cert.go</span><br>
<span class="lineno"></span><span class="comment" id="8495903">//&nbsp;Thus,&nbsp;they&nbsp;have&nbsp;no&nbsp;ExtKeyUsage&nbsp;fields&nbsp;and&nbsp;trigger&nbsp;an&nbsp;error</span><br>
<span class="lineno">730</span><span class="comment" id="8495965">//&nbsp;when&nbsp;verification&nbsp;is&nbsp;turned&nbsp;on.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8496001">const</span>&nbsp;<span class="ident" id="8496007">clientCertificatePEM</span>&nbsp;<span class="op" id="8496028">=</span>&nbsp;<span class="string" id="8496030">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB7TCCAVigAwIBAgIBADALBgkqhkiG9w0BAQUwJjEQMA4GA1UEChMHQWNtZSBD<br>
<span class="lineno">735</span>bzESMBAGA1UEAxMJMTI3LjAuMC4xMB4XDTExMTIwODA3NTUxMloXDTEyMTIwNzA4<br>
<span class="lineno"></span>MDAxMlowJjEQMA4GA1UEChMHQWNtZSBDbzESMBAGA1UEAxMJMTI3LjAuMC4xMIGc<br>
<span class="lineno"></span>MAsGCSqGSIb3DQEBAQOBjAAwgYgCgYBO0Hsx44Jk2VnAwoekXh6LczPHY1PfZpIG<br>
<span class="lineno"></span>hPZk1Y/kNqcdK+izIDZFI7Xjla7t4PUgnI2V339aEu+H5Fto5OkOdOwEin/ekyfE<br>
<span class="lineno"></span>ARl6vfLcPRSr0FTKIQzQTW6HLlzF0rtNS0/Otiz3fojsfNcCkXSmHgwa2uNKWi7e<br>
<span class="lineno">740</span>E5xMQIhZkwIDAQABozIwMDAOBgNVHQ8BAf8EBAMCAKAwDQYDVR0OBAYEBAECAwQw<br>
<span class="lineno"></span>DwYDVR0jBAgwBoAEAQIDBDALBgkqhkiG9w0BAQUDgYEANh+zegx1yW43RmEr1b3A<br>
<span class="lineno"></span>p0vMRpqBWHyFeSnIyMZn3TJWRSt1tukkqVCavh9a+hoV2cxVlXIWg7nCto/9iIw4<br>
<span class="lineno"></span>hB2rXZIxE0/9gzvGnfERYraL7KtnvshksBFQRlgXa5kc0x38BvEO5ZaoDPl4ILdE<br>
<span class="lineno"></span>GFGNEH5PlGffo05wc46QkYU=<br>
<span class="lineno">745</span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8496763">const</span>&nbsp;<span class="ident" id="8496769">clientKeyPEM</span>&nbsp;<span class="op" id="8496782">=</span>&nbsp;<span class="string" id="8496784">`<br>
<span class="lineno"></span>-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIICWgIBAAKBgE7QezHjgmTZWcDCh6ReHotzM8djU99mkgaE9mTVj+Q2px0r6LMg<br>
<span class="lineno">750</span>NkUjteOVru3g9SCcjZXff1oS74fkW2jk6Q507ASKf96TJ8QBGXq98tw9FKvQVMoh<br>
<span class="lineno"></span>DNBNbocuXMXSu01LT862LPd+iOx81wKRdKYeDBra40paLt4TnExAiFmTAgMBAAEC<br>
<span class="lineno"></span>gYBxvXd8yNteFTns8A/2yomEMC4yeosJJSpp1CsN3BJ7g8/qTnrVPxBy+RU+qr63<br>
<span class="lineno"></span>t2WquaOu/cr5P8iEsa6lk20tf8pjKLNXeX0b1RTzK8rJLbS7nGzP3tvOhL096VtQ<br>
<span class="lineno"></span>dAo4ROEaro0TzYpHmpciSvxVIeEIAAdFDObDJPKqcJAxyQJBAJizfYgK8Gzx9fsx<br>
<span class="lineno">755</span>hxp+VteCbVPg2euASH5Yv3K5LukRdKoSzHE2grUVQgN/LafC0eZibRanxHegYSr7<br>
<span class="lineno"></span>7qaswKUCQQCEIWor/X4XTMdVj3Oj+vpiw75y/S9gh682+myZL+d/02IEkwnB098P<br>
<span class="lineno"></span>RkKVpenBHyrGg0oeN5La7URILWKj7CPXAkBKo6F+d+phNjwIFoN1Xb/RA32w/D1I<br>
<span class="lineno"></span>saG9sF+UEhRt9AxUfW/U/tIQ9V0ZHHcSg1XaCM5Nvp934brdKdvTOKnJAkBD5h/3<br>
<span class="lineno"></span>Rybatlvg/fzBEaJFyq09zhngkxlZOUtBVTqzl17RVvY2orgH02U4HbCHy4phxOn7<br>
<span class="lineno">760</span>qTdQRYlHRftgnWK1AkANibn9PRYJ7mJyJ9Dyj2QeNcSkSTzrt0tPvUMf4+meJymN<br>
<span class="lineno"></span>1Ntu5+S1DLLzfxlaljWG6ylW6DNxujCyuXIV2rvA<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8497671">const</span>&nbsp;<span class="ident" id="8497677">clientECDSACertificatePEM</span>&nbsp;<span class="op" id="8497703">=</span>&nbsp;<span class="string" id="8497705">`<br>
<span class="lineno">765</span>-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/DCCAV4CCQCaMIRsJjXZFzAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTMyNTUzWhcNMjIxMTEyMTMyNTUzWjBBMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTEMMAoGA1UECBMDTlNXMRAwDgYDVQQHEwdQeXJtb250MRIwEAYDVQQDEwlK<br>
<span class="lineno">770</span>b2VsIFNpbmcwgZswEAYHKoZIzj0CAQYFK4EEACMDgYYABACVjJF1FMBexFe01MNv<br>
<span class="lineno"></span>ja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd3kfDdq0Z9kUs<br>
<span class="lineno"></span>jLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx+U56jb0JuK7q<br>
<span class="lineno"></span>ixgnTy5w/hOWusPTQBbNZU6sER7m8TAJBgcqhkjOPQQBA4GMADCBiAJCAOAUxGBg<br>
<span class="lineno"></span>C3JosDJdYUoCdFzCgbkWqD8pyDbHgf9stlvZcPE4O1BIKJTLCRpS8V3ujfK58PDa<br>
<span class="lineno">775</span>2RU6+b0DeoeiIzXsAkIBo9SKeDUcSpoj0gq+KxAxnZxfvuiRs9oa9V2jI/Umi0Vw<br>
<span class="lineno"></span>jWVim34BmT0Y9hCaOGGbLlfk+syxis7iI6CH8OFnUes=<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8498458">const</span>&nbsp;<span class="ident" id="8498464">clientECDSAKeyPEM</span>&nbsp;<span class="op" id="8498482">=</span>&nbsp;<span class="string" id="8498484">`<br>
<span class="lineno">780</span>-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBkJN9X4IqZIguiEVKMqeBUP5xtRsEv4HJEtOpOGLELwO53SD78Ew8<br>
<span class="lineno">785</span>k+wLWoqizS3NpQyMtrU8JFdWfj+C57UNkOugBwYFK4EEACOhgYkDgYYABACVjJF1<br>
<span class="lineno"></span>FMBexFe01MNvja5oHt1vzobhfm6ySD6B5U7ixohLZNz1MLvT/2XMW/TdtWo+PtAd<br>
<span class="lineno"></span>3kfDdq0Z9kUsjLzYHQFMH3CQRnZIi4+DzEpcj0B22uCJ7B0rxE4wdihBsmKo+1vx<br>
<span class="lineno"></span>+U56jb0JuK7qixgnTy5w/hOWusPTQBbNZU6sER7m8Q==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----`</span><br>
<span class="lineno">790</span><br>
<span class="lineno"></span><span class="keyword" id="8498924">func</span>&nbsp;<span class="ident" id="8498929">TestClientAuth</span><span class="op" id="8498943">(</span><span class="ident" id="8498944">t</span>&nbsp;<span class="op" id="8498946">*</span><span class="ident" id="8498947">testing</span><span class="op" id="8498954">.</span><span class="ident" id="8498955">T</span><span class="op" id="8498956">)</span>&nbsp;<span class="op" id="8498958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8498961">var</span>&nbsp;<span class="ident" id="8498965">certPath</span><span class="op" id="8498973">,</span>&nbsp;<span class="ident" id="8498975">keyPath</span><span class="op" id="8498982">,</span>&nbsp;<span class="ident" id="8498984">ecdsaCertPath</span><span class="op" id="8498997">,</span>&nbsp;<span class="ident" id="8498999">ecdsaKeyPath</span>&nbsp;<span class="builtintype" id="8499012">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499021">if</span>&nbsp;<span class="op" id="8499024">*</span><span class="ident" id="8499025">update</span>&nbsp;<span class="op" id="8499032">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499036">certPath</span>&nbsp;<span class="op" id="8499045">=</span>&nbsp;<span class="ident" id="8499047">tempFile</span><span class="op" id="8499055">(</span><span class="ident" id="8499056">clientCertificatePEM</span><span class="op" id="8499076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499080">defer</span>&nbsp;<span class="ident" id="8499086">os</span><span class="op" id="8499088">.</span><span class="ident" id="8499089">Remove</span><span class="op" id="8499095">(</span><span class="ident" id="8499096">certPath</span><span class="op" id="8499104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499108">keyPath</span>&nbsp;<span class="op" id="8499116">=</span>&nbsp;<span class="ident" id="8499118">tempFile</span><span class="op" id="8499126">(</span><span class="ident" id="8499127">clientKeyPEM</span><span class="op" id="8499139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499143">defer</span>&nbsp;<span class="ident" id="8499149">os</span><span class="op" id="8499151">.</span><span class="ident" id="8499152">Remove</span><span class="op" id="8499158">(</span><span class="ident" id="8499159">keyPath</span><span class="op" id="8499166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499170">ecdsaCertPath</span>&nbsp;<span class="op" id="8499184">=</span>&nbsp;<span class="ident" id="8499186">tempFile</span><span class="op" id="8499194">(</span><span class="ident" id="8499195">clientECDSACertificatePEM</span><span class="op" id="8499220">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499224">defer</span>&nbsp;<span class="ident" id="8499230">os</span><span class="op" id="8499232">.</span><span class="ident" id="8499233">Remove</span><span class="op" id="8499239">(</span><span class="ident" id="8499240">ecdsaCertPath</span><span class="op" id="8499253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499257">ecdsaKeyPath</span>&nbsp;<span class="op" id="8499270">=</span>&nbsp;<span class="ident" id="8499272">tempFile</span><span class="op" id="8499280">(</span><span class="ident" id="8499281">clientECDSAKeyPEM</span><span class="op" id="8499298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8499302">defer</span>&nbsp;<span class="ident" id="8499308">os</span><span class="op" id="8499310">.</span><span class="ident" id="8499311">Remove</span><span class="op" id="8499317">(</span><span class="ident" id="8499318">ecdsaKeyPath</span><span class="op" id="8499330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499337">config</span>&nbsp;<span class="op" id="8499344">:=</span>&nbsp;<span class="op" id="8499347">*</span><span class="ident" id="8499348">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499360">config</span><span class="op" id="8499366">.</span><span class="ident" id="8499367">ClientAuth</span>&nbsp;<span class="op" id="8499378">=</span>&nbsp;<span class="ident" id="8499380">RequestClientCert</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499400">test</span>&nbsp;<span class="op" id="8499405">:=</span>&nbsp;<span class="op" id="8499408">&amp;</span><span class="ident" id="8499409">serverTest</span><span class="op" id="8499419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499423">name</span><span class="op" id="8499427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8499432">&#34;ClientAuthRequestedNotGiven&#34;</span><span class="op" id="8499461">,</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499465">command</span><span class="op" id="8499472">:</span>&nbsp;<span class="op" id="8499474">[</span><span class="op" id="8499475">]</span><span class="builtintype" id="8499476">string</span><span class="op" id="8499482">{</span><span class="string" id="8499483">&#34;openssl&#34;</span><span class="op" id="8499492">,</span>&nbsp;<span class="string" id="8499494">&#34;s_client&#34;</span><span class="op" id="8499504">,</span>&nbsp;<span class="string" id="8499506">&#34;-no_ticket&#34;</span><span class="op" id="8499518">,</span>&nbsp;<span class="string" id="8499520">&#34;-cipher&#34;</span><span class="op" id="8499529">,</span>&nbsp;<span class="string" id="8499531">&#34;RC4-SHA&#34;</span><span class="op" id="8499540">}</span><span class="op" id="8499541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499545">config</span><span class="op" id="8499551">:</span>&nbsp;&nbsp;<span class="op" id="8499554">&amp;</span><span class="ident" id="8499555">config</span><span class="op" id="8499561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499567">runServerTestTLS12</span><span class="op" id="8499585">(</span><span class="ident" id="8499586">t</span><span class="op" id="8499587">,</span>&nbsp;<span class="ident" id="8499589">test</span><span class="op" id="8499593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499597">test</span>&nbsp;<span class="op" id="8499602">=</span>&nbsp;<span class="op" id="8499604">&amp;</span><span class="ident" id="8499605">serverTest</span><span class="op" id="8499615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499619">name</span><span class="op" id="8499623">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8499638">&#34;ClientAuthRequestedAndGiven&#34;</span><span class="op" id="8499667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499671">command</span><span class="op" id="8499678">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8499690">[</span><span class="op" id="8499691">]</span><span class="builtintype" id="8499692">string</span><span class="op" id="8499698">{</span><span class="string" id="8499699">&#34;openssl&#34;</span><span class="op" id="8499708">,</span>&nbsp;<span class="string" id="8499710">&#34;s_client&#34;</span><span class="op" id="8499720">,</span>&nbsp;<span class="string" id="8499722">&#34;-no_ticket&#34;</span><span class="op" id="8499734">,</span>&nbsp;<span class="string" id="8499736">&#34;-cipher&#34;</span><span class="op" id="8499745">,</span>&nbsp;<span class="string" id="8499747">&#34;RC4-SHA&#34;</span><span class="op" id="8499756">,</span>&nbsp;<span class="string" id="8499758">&#34;-cert&#34;</span><span class="op" id="8499765">,</span>&nbsp;<span class="ident" id="8499767">certPath</span><span class="op" id="8499775">,</span>&nbsp;<span class="string" id="8499777">&#34;-key&#34;</span><span class="op" id="8499783">,</span>&nbsp;<span class="ident" id="8499785">keyPath</span><span class="op" id="8499792">}</span><span class="op" id="8499793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499797">config</span><span class="op" id="8499803">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8499816">&amp;</span><span class="ident" id="8499817">config</span><span class="op" id="8499823">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499827">expectedPeerCerts</span><span class="op" id="8499844">:</span>&nbsp;<span class="op" id="8499846">[</span><span class="op" id="8499847">]</span><span class="builtintype" id="8499848">string</span><span class="op" id="8499854">{</span><span class="ident" id="8499855">clientCertificatePEM</span><span class="op" id="8499875">}</span><span class="op" id="8499876">,</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8499879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499882">runServerTestTLS12</span><span class="op" id="8499900">(</span><span class="ident" id="8499901">t</span><span class="op" id="8499902">,</span>&nbsp;<span class="ident" id="8499904">test</span><span class="op" id="8499908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499912">test</span>&nbsp;<span class="op" id="8499917">=</span>&nbsp;<span class="op" id="8499919">&amp;</span><span class="ident" id="8499920">serverTest</span><span class="op" id="8499930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499934">name</span><span class="op" id="8499938">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8499953">&#34;ClientAuthRequestedAndECDSAGiven&#34;</span><span class="op" id="8499987">,</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8499991">command</span><span class="op" id="8499998">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8500010">[</span><span class="op" id="8500011">]</span><span class="builtintype" id="8500012">string</span><span class="op" id="8500018">{</span><span class="string" id="8500019">&#34;openssl&#34;</span><span class="op" id="8500028">,</span>&nbsp;<span class="string" id="8500030">&#34;s_client&#34;</span><span class="op" id="8500040">,</span>&nbsp;<span class="string" id="8500042">&#34;-no_ticket&#34;</span><span class="op" id="8500054">,</span>&nbsp;<span class="string" id="8500056">&#34;-cipher&#34;</span><span class="op" id="8500065">,</span>&nbsp;<span class="string" id="8500067">&#34;RC4-SHA&#34;</span><span class="op" id="8500076">,</span>&nbsp;<span class="string" id="8500078">&#34;-cert&#34;</span><span class="op" id="8500085">,</span>&nbsp;<span class="ident" id="8500087">ecdsaCertPath</span><span class="op" id="8500100">,</span>&nbsp;<span class="string" id="8500102">&#34;-key&#34;</span><span class="op" id="8500108">,</span>&nbsp;<span class="ident" id="8500110">ecdsaKeyPath</span><span class="op" id="8500122">}</span><span class="op" id="8500123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500127">config</span><span class="op" id="8500133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8500146">&amp;</span><span class="ident" id="8500147">config</span><span class="op" id="8500153">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500157">expectedPeerCerts</span><span class="op" id="8500174">:</span>&nbsp;<span class="op" id="8500176">[</span><span class="op" id="8500177">]</span><span class="builtintype" id="8500178">string</span><span class="op" id="8500184">{</span><span class="ident" id="8500185">clientECDSACertificatePEM</span><span class="op" id="8500210">}</span><span class="op" id="8500211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8500214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500217">runServerTestTLS12</span><span class="op" id="8500235">(</span><span class="ident" id="8500236">t</span><span class="op" id="8500237">,</span>&nbsp;<span class="ident" id="8500239">test</span><span class="op" id="8500243">)</span><br>
<span class="lineno">830</span><span class="op" id="8500245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500248">func</span>&nbsp;<span class="ident" id="8500253">bigFromString</span><span class="op" id="8500266">(</span><span class="ident" id="8500267">s</span>&nbsp;<span class="builtintype" id="8500269">string</span><span class="op" id="8500275">)</span>&nbsp;<span class="op" id="8500277">*</span><span class="ident" id="8500278">big</span><span class="op" id="8500281">.</span><span class="ident" id="8500282">Int</span>&nbsp;<span class="op" id="8500286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500289">ret</span>&nbsp;<span class="op" id="8500293">:=</span>&nbsp;<span class="builtinfunc" id="8500296">new</span><span class="op" id="8500299">(</span><span class="ident" id="8500300">big</span><span class="op" id="8500303">.</span><span class="ident" id="8500304">Int</span><span class="op" id="8500307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500310">ret</span><span class="op" id="8500313">.</span><span class="ident" id="8500314">SetString</span><span class="op" id="8500323">(</span><span class="ident" id="8500324">s</span><span class="op" id="8500325">,</span>&nbsp;<span class="num" id="8500327">10</span><span class="op" id="8500329">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500332">return</span>&nbsp;<span class="ident" id="8500339">ret</span><br>
<span class="lineno"></span><span class="op" id="8500343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500346">func</span>&nbsp;<span class="ident" id="8500351">fromHex</span><span class="op" id="8500358">(</span><span class="ident" id="8500359">s</span>&nbsp;<span class="builtintype" id="8500361">string</span><span class="op" id="8500367">)</span>&nbsp;<span class="op" id="8500369">[</span><span class="op" id="8500370">]</span><span class="builtintype" id="8500371">byte</span>&nbsp;<span class="op" id="8500376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8500379">b</span><span class="op" id="8500380">,</span>&nbsp;<span class="ident" id="8500382">_</span>&nbsp;<span class="op" id="8500384">:=</span>&nbsp;<span class="ident" id="8500387">hex</span><span class="op" id="8500390">.</span><span class="ident" id="8500391">DecodeString</span><span class="op" id="8500403">(</span><span class="ident" id="8500404">s</span><span class="op" id="8500405">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8500408">return</span>&nbsp;<span class="ident" id="8500415">b</span><br>
<span class="lineno"></span><span class="op" id="8500417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8500420">var</span>&nbsp;<span class="ident" id="8500424">testRSACertificate</span>&nbsp;<span class="op" id="8500443">=</span>&nbsp;<span class="ident" id="8500445">fromHex</span><span class="op" id="8500452">(</span><span class="string" id="8500453">&#34;308202b030820219a00302010202090085b0bba48a7fb8ca300d06092a864886f70d01010505003045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3130303432343039303933385a170d3131303432343039303933385a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819f300d06092a864886f70d010101050003818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a381a73081a4301d0603551d0e04160414b1ade2855acfcb28db69ce2369ded3268e18883930750603551d23046e306c8014b1ade2855acfcb28db69ce2369ded3268e188839a149a4473045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746482090085b0bba48a7fb8ca300c0603551d13040530030101ff300d06092a864886f70d010105050003818100086c4524c76bb159ab0c52ccf2b014d7879d7a6475b55a9566e4c52b8eae12661feb4f38b36e60d392fdf74108b52513b1187a24fb301dbaed98b917ece7d73159db95d31d78ea50565cd5825a2d5a5f33c4b6d8c97590968c0f5298b5cd981f89205ff2a01ca31b9694dda9fd57e970e8266d71999b266e3850296c90a7bdd9&#34;</span><span class="op" id="8501839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span><span class="keyword" id="8501842">var</span>&nbsp;<span class="ident" id="8501846">testECDSACertificate</span>&nbsp;<span class="op" id="8501867">=</span>&nbsp;<span class="ident" id="8501869">fromHex</span><span class="op" id="8501876">(</span><span class="string" id="8501877">&#34;3082020030820162020900b8bf2d47a0d2ebf4300906072a8648ce3d04013045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c7464301e170d3132313132323135303633325a170d3232313132303135303633325a3045310b3009060355040613024155311330110603550408130a536f6d652d53746174653121301f060355040a1318496e7465726e6574205769646769747320507479204c746430819b301006072a8648ce3d020106052b81040023038186000400c4a1edbe98f90b4873367ec316561122f23d53c33b4d213dcd6b75e6f6b0dc9adf26c1bcb287f072327cb3642f1c90bcea6823107efee325c0483a69e0286dd33700ef0462dd0da09c706283d881d36431aa9e9731bd96b068c09b23de76643f1a5c7fe9120e5858b65f70dd9bd8ead5d7f5d5ccb9b69f30665b669a20e227e5bffe3b300906072a8648ce3d040103818c0030818802420188a24febe245c5487d1bacf5ed989dae4770c05e1bb62fbdf1b64db76140d311a2ceee0b7e927eff769dc33b7ea53fcefa10e259ec472d7cacda4e970e15a06fd00242014dfcbe67139c2d050ebd3fa38c25c13313830d9406bbd4377af6ec7ac9862eddd711697f857c56defb31782be4c7780daecbbe9e4e3624317b6a0f399512078f2a&#34;</span><span class="op" id="8502911">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8502914">var</span>&nbsp;<span class="ident" id="8502918">testSNICertificate</span>&nbsp;<span class="op" id="8502937">=</span>&nbsp;<span class="ident" id="8502939">fromHex</span><span class="op" id="8502946">(</span><span class="string" id="8502947">&#34;308201f23082015da003020102020100300b06092a864886f70d01010530283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d301e170d3132303431313137343033355a170d3133303431313137343533355a30283110300e060355040a130741636d6520436f311430120603550403130b736e69746573742e636f6d30819d300b06092a864886f70d01010103818d0030818902818100bb79d6f517b5e5bf4610d0dc69bee62b07435ad0032d8a7a4385b71452e7a5654c2c78b8238cb5b482e5de1f953b7e62a52ca533d6fe125c7a56fcf506bffa587b263fb5cd04d3d0c921964ac7f4549f5abfef427100fe1899077f7e887d7df10439c4a22edb51c97ce3c04c3b326601cfafb11db8719a1ddbdb896baeda2d790203010001a3323030300e0603551d0f0101ff0404030200a0300d0603551d0e0406040401020304300f0603551d2304083006800401020304300b06092a864886f70d0101050381810089c6455f1c1f5ef8eb1ab174ee2439059f5c4259bb1a8d86cdb1d056f56a717da40e95ab90f59e8deaf627c157995094db0802266eb34fc6842dea8a4b68d9c1389103ab84fb9e1f85d9b5d23ff2312c8670fbb540148245a4ebafe264d90c8a4cf4f85b0fac12ac2fc4a3154bad52462868af96c62c6525d652b6e31845bdcc&#34;</span><span class="op" id="8503953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8503956">var</span>&nbsp;<span class="ident" id="8503960">testRSAPrivateKey</span>&nbsp;<span class="op" id="8503978">=</span>&nbsp;<span class="op" id="8503980">&amp;</span><span class="ident" id="8503981">rsa</span><span class="op" id="8503984">.</span><span class="ident" id="8503985">PrivateKey</span><span class="op" id="8503995">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8503998">PublicKey</span><span class="op" id="8504007">:</span>&nbsp;<span class="ident" id="8504009">rsa</span><span class="op" id="8504012">.</span><span class="ident" id="8504013">PublicKey</span><span class="op" id="8504022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504026">N</span><span class="op" id="8504027">:</span>&nbsp;<span class="ident" id="8504029">bigFromString</span><span class="op" id="8504042">(</span><span class="string" id="8504043">&#34;131650079503776001033793877885499001334664249354723305978524647182322416328664556247316495448366990052837680518067798333412266673813370895702118944398081598789828837447552603077848001020611640547221687072142537202428102790818451901395596882588063427854225330436740647715202971973145151161964464812406232198521&#34;</span><span class="op" id="8504354">)</span><span class="op" id="8504355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504359">E</span><span class="op" id="8504360">:</span>&nbsp;<span class="num" id="8504362">65537</span><span class="op" id="8504367">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8504370">}</span><span class="op" id="8504371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504374">D</span><span class="op" id="8504375">:</span>&nbsp;<span class="ident" id="8504377">bigFromString</span><span class="op" id="8504390">(</span><span class="string" id="8504391">&#34;29354450337804273969007277378287027274721892607543397931919078829901848876371746653677097639302788129485893852488285045793268732234230875671682624082413996177431586734171663258657462237320300610850244186316880055243099640544518318093544057213190320837094958164973959123058337475052510833916491060913053867729&#34;</span><span class="op" id="8504701">)</span><span class="op" id="8504702">,</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504705">Primes</span><span class="op" id="8504711">:</span>&nbsp;<span class="op" id="8504713">[</span><span class="op" id="8504714">]</span><span class="op" id="8504715">*</span><span class="ident" id="8504716">big</span><span class="op" id="8504719">.</span><span class="ident" id="8504720">Int</span><span class="op" id="8504723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504727">bigFromString</span><span class="op" id="8504740">(</span><span class="string" id="8504741">&#34;11969277782311800166562047708379380720136961987713178380670422671426759650127150688426177829077494755200794297055316163155755835813760102405344560929062149&#34;</span><span class="op" id="8504898">)</span><span class="op" id="8504899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8504903">bigFromString</span><span class="op" id="8504916">(</span><span class="string" id="8504917">&#34;10998999429884441391899182616418192492905073053684657075974935218461686523870125521822756579792315215543092255516093840728890783887287417039645833477273829&#34;</span><span class="op" id="8505074">)</span><span class="op" id="8505075">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505078">}</span><span class="op" id="8505079">,</span><br>
<span class="lineno"></span><span class="op" id="8505081">}</span><br>
<span class="lineno">860</span><br>
<span class="lineno"></span><span class="keyword" id="8505084">var</span>&nbsp;<span class="ident" id="8505088">testECDSAPrivateKey</span>&nbsp;<span class="op" id="8505108">=</span>&nbsp;<span class="op" id="8505110">&amp;</span><span class="ident" id="8505111">ecdsa</span><span class="op" id="8505116">.</span><span class="ident" id="8505117">PrivateKey</span><span class="op" id="8505127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505130">PublicKey</span><span class="op" id="8505139">:</span>&nbsp;<span class="ident" id="8505141">ecdsa</span><span class="op" id="8505146">.</span><span class="ident" id="8505147">PublicKey</span><span class="op" id="8505156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505160">Curve</span><span class="op" id="8505165">:</span>&nbsp;<span class="ident" id="8505167">elliptic</span><span class="op" id="8505175">.</span><span class="ident" id="8505176">P521</span><span class="op" id="8505180">(</span><span class="op" id="8505181">)</span><span class="op" id="8505182">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505186">X</span><span class="op" id="8505187">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505193">bigFromString</span><span class="op" id="8505206">(</span><span class="string" id="8505207">&#34;2636411247892461147287360222306590634450676461695221912739908880441342231985950069527906976759812296359387337367668045707086543273113073382714101597903639351&#34;</span><span class="op" id="8505366">)</span><span class="op" id="8505367">,</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505371">Y</span><span class="op" id="8505372">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8505378">bigFromString</span><span class="op" id="8505391">(</span><span class="string" id="8505392">&#34;3204695818431246682253994090650952614555094516658732116404513121125038617915183037601737180082382202488628239201196033284060130040574800684774115478859677243&#34;</span><span class="op" id="8505551">)</span><span class="op" id="8505552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8505555">}</span><span class="op" id="8505556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8505559">D</span><span class="op" id="8505560">:</span>&nbsp;<span class="ident" id="8505562">bigFromString</span><span class="op" id="8505575">(</span><span class="string" id="8505576">&#34;5477294338614160138026852784385529180817726002953041720191098180813046231640184669647735805135001309477695746518160084669446643325196003346204701381388769751&#34;</span><span class="op" id="8505735">)</span><span class="op" id="8505736">,</span><br>
<span class="lineno"></span><span class="op" id="8505738">}</span>
</div>
</body>
</html>
