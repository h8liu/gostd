<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html" class="current">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1764179">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1764234">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1764288">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1764339">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1764417">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1764502">package</span>&nbsp;<span class="ident" id="1764510">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1764516">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1764573">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1764628">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1764704">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1764744">const</span>&nbsp;<span class="op" id="1764750">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1764753">RuneError</span>&nbsp;<span class="op" id="1764763">=</span>&nbsp;<span class="string" id="1764765">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1764778">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1764834">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1764844">=</span>&nbsp;<span class="num" id="1764846">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1764859">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1764937">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1764947">=</span>&nbsp;<span class="string" id="1764949">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1764962">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765000">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765010">=</span>&nbsp;<span class="num" id="1765012">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765025">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1765090">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1765093">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1765156">const</span>&nbsp;<span class="op" id="1765162">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765165">surrogateMin</span>&nbsp;<span class="op" id="1765178">=</span>&nbsp;<span class="num" id="1765180">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765188">surrogateMax</span>&nbsp;<span class="op" id="1765201">=</span>&nbsp;<span class="num" id="1765203">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1765210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1765213">const</span>&nbsp;<span class="op" id="1765219">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765222">t1</span>&nbsp;<span class="op" id="1765225">=</span>&nbsp;<span class="num" id="1765227">0x00</span>&nbsp;<span class="comment" id="1765232">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765246">tx</span>&nbsp;<span class="op" id="1765249">=</span>&nbsp;<span class="num" id="1765251">0x80</span>&nbsp;<span class="comment" id="1765256">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765270">t2</span>&nbsp;<span class="op" id="1765273">=</span>&nbsp;<span class="num" id="1765275">0xC0</span>&nbsp;<span class="comment" id="1765280">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765294">t3</span>&nbsp;<span class="op" id="1765297">=</span>&nbsp;<span class="num" id="1765299">0xE0</span>&nbsp;<span class="comment" id="1765304">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765318">t4</span>&nbsp;<span class="op" id="1765321">=</span>&nbsp;<span class="num" id="1765323">0xF0</span>&nbsp;<span class="comment" id="1765328">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765342">t5</span>&nbsp;<span class="op" id="1765345">=</span>&nbsp;<span class="num" id="1765347">0xF8</span>&nbsp;<span class="comment" id="1765352">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765367">maskx</span>&nbsp;<span class="op" id="1765373">=</span>&nbsp;<span class="num" id="1765375">0x3F</span>&nbsp;<span class="comment" id="1765380">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765394">mask2</span>&nbsp;<span class="op" id="1765400">=</span>&nbsp;<span class="num" id="1765402">0x1F</span>&nbsp;<span class="comment" id="1765407">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765421">mask3</span>&nbsp;<span class="op" id="1765427">=</span>&nbsp;<span class="num" id="1765429">0x0F</span>&nbsp;<span class="comment" id="1765434">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765448">mask4</span>&nbsp;<span class="op" id="1765454">=</span>&nbsp;<span class="num" id="1765456">0x07</span>&nbsp;<span class="comment" id="1765461">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765476">rune1Max</span>&nbsp;<span class="op" id="1765485">=</span>&nbsp;<span class="num" id="1765487">1</span><span class="op" id="1765488">&lt;&lt;</span><span class="num" id="1765490">7</span>&nbsp;<span class="op" id="1765492">-</span>&nbsp;<span class="num" id="1765494">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765497">rune2Max</span>&nbsp;<span class="op" id="1765506">=</span>&nbsp;<span class="num" id="1765508">1</span><span class="op" id="1765509">&lt;&lt;</span><span class="num" id="1765511">11</span>&nbsp;<span class="op" id="1765514">-</span>&nbsp;<span class="num" id="1765516">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765519">rune3Max</span>&nbsp;<span class="op" id="1765528">=</span>&nbsp;<span class="num" id="1765530">1</span><span class="op" id="1765531">&lt;&lt;</span><span class="num" id="1765533">16</span>&nbsp;<span class="op" id="1765536">-</span>&nbsp;<span class="num" id="1765538">1</span><br>
<span class="lineno"></span><span class="op" id="1765540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1765543">func</span>&nbsp;<span class="ident" id="1765548">decodeRuneInternal</span><span class="op" id="1765566">(</span><span class="ident" id="1765567">p</span>&nbsp;<span class="op" id="1765569">[</span><span class="op" id="1765570">]</span><span class="builtintype" id="1765571">byte</span><span class="op" id="1765575">)</span>&nbsp;<span class="op" id="1765577">(</span><span class="ident" id="1765578">r</span>&nbsp;<span class="builtintype" id="1765580">rune</span><span class="op" id="1765584">,</span>&nbsp;<span class="ident" id="1765586">size</span>&nbsp;<span class="builtintype" id="1765591">int</span><span class="op" id="1765594">,</span>&nbsp;<span class="ident" id="1765596">short</span>&nbsp;<span class="builtintype" id="1765602">bool</span><span class="op" id="1765606">)</span>&nbsp;<span class="op" id="1765608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765611">n</span>&nbsp;<span class="op" id="1765613">:=</span>&nbsp;<span class="builtinfunc" id="1765616">len</span><span class="op" id="1765619">(</span><span class="ident" id="1765620">p</span><span class="op" id="1765621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765624">if</span>&nbsp;<span class="ident" id="1765627">n</span>&nbsp;<span class="op" id="1765629">&lt;</span>&nbsp;<span class="num" id="1765631">1</span>&nbsp;<span class="op" id="1765633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765637">return</span>&nbsp;<span class="ident" id="1765644">RuneError</span><span class="op" id="1765653">,</span>&nbsp;<span class="num" id="1765655">0</span><span class="op" id="1765656">,</span>&nbsp;<span class="builtintype" id="1765658">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765664">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765667">c0</span>&nbsp;<span class="op" id="1765670">:=</span>&nbsp;<span class="ident" id="1765673">p</span><span class="op" id="1765674">[</span><span class="num" id="1765675">0</span><span class="op" id="1765676">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765680">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765708">if</span>&nbsp;<span class="ident" id="1765711">c0</span>&nbsp;<span class="op" id="1765714">&lt;</span>&nbsp;<span class="ident" id="1765716">tx</span>&nbsp;<span class="op" id="1765719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765723">return</span>&nbsp;<span class="builtintype" id="1765730">rune</span><span class="op" id="1765734">(</span><span class="ident" id="1765735">c0</span><span class="op" id="1765737">)</span><span class="op" id="1765738">,</span>&nbsp;<span class="num" id="1765740">1</span><span class="op" id="1765741">,</span>&nbsp;<span class="builtintype" id="1765743">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765754">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765788">if</span>&nbsp;<span class="ident" id="1765791">c0</span>&nbsp;<span class="op" id="1765794">&lt;</span>&nbsp;<span class="ident" id="1765796">t2</span>&nbsp;<span class="op" id="1765799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765803">return</span>&nbsp;<span class="ident" id="1765810">RuneError</span><span class="op" id="1765819">,</span>&nbsp;<span class="num" id="1765821">1</span><span class="op" id="1765822">,</span>&nbsp;<span class="builtintype" id="1765824">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765835">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765868">if</span>&nbsp;<span class="ident" id="1765871">n</span>&nbsp;<span class="op" id="1765873">&lt;</span>&nbsp;<span class="num" id="1765875">2</span>&nbsp;<span class="op" id="1765877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765881">return</span>&nbsp;<span class="ident" id="1765888">RuneError</span><span class="op" id="1765897">,</span>&nbsp;<span class="num" id="1765899">1</span><span class="op" id="1765900">,</span>&nbsp;<span class="builtintype" id="1765902">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1765911">c1</span>&nbsp;<span class="op" id="1765914">:=</span>&nbsp;<span class="ident" id="1765917">p</span><span class="op" id="1765918">[</span><span class="num" id="1765919">1</span><span class="op" id="1765920">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765923">if</span>&nbsp;<span class="ident" id="1765926">c1</span>&nbsp;<span class="op" id="1765929">&lt;</span>&nbsp;<span class="ident" id="1765931">tx</span>&nbsp;<span class="op" id="1765934">||</span>&nbsp;<span class="ident" id="1765937">t2</span>&nbsp;<span class="op" id="1765940">&lt;=</span>&nbsp;<span class="ident" id="1765943">c1</span>&nbsp;<span class="op" id="1765946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1765950">return</span>&nbsp;<span class="ident" id="1765957">RuneError</span><span class="op" id="1765966">,</span>&nbsp;<span class="num" id="1765968">1</span><span class="op" id="1765969">,</span>&nbsp;<span class="builtintype" id="1765971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1765978">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1765982">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766011">if</span>&nbsp;<span class="ident" id="1766014">c0</span>&nbsp;<span class="op" id="1766017">&lt;</span>&nbsp;<span class="ident" id="1766019">t3</span>&nbsp;<span class="op" id="1766022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1766026">r</span>&nbsp;<span class="op" id="1766028">=</span>&nbsp;<span class="builtintype" id="1766030">rune</span><span class="op" id="1766034">(</span><span class="ident" id="1766035">c0</span><span class="op" id="1766037">&amp;</span><span class="ident" id="1766038">mask2</span><span class="op" id="1766043">)</span><span class="op" id="1766044">&lt;&lt;</span><span class="num" id="1766046">6</span>&nbsp;<span class="op" id="1766048">|</span>&nbsp;<span class="builtintype" id="1766050">rune</span><span class="op" id="1766054">(</span><span class="ident" id="1766055">c1</span><span class="op" id="1766057">&amp;</span><span class="ident" id="1766058">maskx</span><span class="op" id="1766063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766067">if</span>&nbsp;<span class="ident" id="1766070">r</span>&nbsp;<span class="op" id="1766072">&lt;=</span>&nbsp;<span class="ident" id="1766075">rune1Max</span>&nbsp;<span class="op" id="1766084">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766089">return</span>&nbsp;<span class="ident" id="1766096">RuneError</span><span class="op" id="1766105">,</span>&nbsp;<span class="num" id="1766107">1</span><span class="op" id="1766108">,</span>&nbsp;<span class="builtintype" id="1766110">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766122">return</span>&nbsp;<span class="ident" id="1766129">r</span><span class="op" id="1766130">,</span>&nbsp;<span class="num" id="1766132">2</span><span class="op" id="1766133">,</span>&nbsp;<span class="builtintype" id="1766135">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766146">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766180">if</span>&nbsp;<span class="ident" id="1766183">n</span>&nbsp;<span class="op" id="1766185">&lt;</span>&nbsp;<span class="num" id="1766187">3</span>&nbsp;<span class="op" id="1766189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766193">return</span>&nbsp;<span class="ident" id="1766200">RuneError</span><span class="op" id="1766209">,</span>&nbsp;<span class="num" id="1766211">1</span><span class="op" id="1766212">,</span>&nbsp;<span class="builtintype" id="1766214">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1766223">c2</span>&nbsp;<span class="op" id="1766226">:=</span>&nbsp;<span class="ident" id="1766229">p</span><span class="op" id="1766230">[</span><span class="num" id="1766231">2</span><span class="op" id="1766232">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766235">if</span>&nbsp;<span class="ident" id="1766238">c2</span>&nbsp;<span class="op" id="1766241">&lt;</span>&nbsp;<span class="ident" id="1766243">tx</span>&nbsp;<span class="op" id="1766246">||</span>&nbsp;<span class="ident" id="1766249">t2</span>&nbsp;<span class="op" id="1766252">&lt;=</span>&nbsp;<span class="ident" id="1766255">c2</span>&nbsp;<span class="op" id="1766258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766262">return</span>&nbsp;<span class="ident" id="1766269">RuneError</span><span class="op" id="1766278">,</span>&nbsp;<span class="num" id="1766280">1</span><span class="op" id="1766281">,</span>&nbsp;<span class="builtintype" id="1766283">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766294">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766323">if</span>&nbsp;<span class="ident" id="1766326">c0</span>&nbsp;<span class="op" id="1766329">&lt;</span>&nbsp;<span class="ident" id="1766331">t4</span>&nbsp;<span class="op" id="1766334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1766338">r</span>&nbsp;<span class="op" id="1766340">=</span>&nbsp;<span class="builtintype" id="1766342">rune</span><span class="op" id="1766346">(</span><span class="ident" id="1766347">c0</span><span class="op" id="1766349">&amp;</span><span class="ident" id="1766350">mask3</span><span class="op" id="1766355">)</span><span class="op" id="1766356">&lt;&lt;</span><span class="num" id="1766358">12</span>&nbsp;<span class="op" id="1766361">|</span>&nbsp;<span class="builtintype" id="1766363">rune</span><span class="op" id="1766367">(</span><span class="ident" id="1766368">c1</span><span class="op" id="1766370">&amp;</span><span class="ident" id="1766371">maskx</span><span class="op" id="1766376">)</span><span class="op" id="1766377">&lt;&lt;</span><span class="num" id="1766379">6</span>&nbsp;<span class="op" id="1766381">|</span>&nbsp;<span class="builtintype" id="1766383">rune</span><span class="op" id="1766387">(</span><span class="ident" id="1766388">c2</span><span class="op" id="1766390">&amp;</span><span class="ident" id="1766391">maskx</span><span class="op" id="1766396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766400">if</span>&nbsp;<span class="ident" id="1766403">r</span>&nbsp;<span class="op" id="1766405">&lt;=</span>&nbsp;<span class="ident" id="1766408">rune2Max</span>&nbsp;<span class="op" id="1766417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766422">return</span>&nbsp;<span class="ident" id="1766429">RuneError</span><span class="op" id="1766438">,</span>&nbsp;<span class="num" id="1766440">1</span><span class="op" id="1766441">,</span>&nbsp;<span class="builtintype" id="1766443">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766451">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766455">if</span>&nbsp;<span class="ident" id="1766458">surrogateMin</span>&nbsp;<span class="op" id="1766471">&lt;=</span>&nbsp;<span class="ident" id="1766474">r</span>&nbsp;<span class="op" id="1766476">&amp;&amp;</span>&nbsp;<span class="ident" id="1766479">r</span>&nbsp;<span class="op" id="1766481">&lt;=</span>&nbsp;<span class="ident" id="1766484">surrogateMax</span>&nbsp;<span class="op" id="1766497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766502">return</span>&nbsp;<span class="ident" id="1766509">RuneError</span><span class="op" id="1766518">,</span>&nbsp;<span class="num" id="1766520">1</span><span class="op" id="1766521">,</span>&nbsp;<span class="builtintype" id="1766523">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766535">return</span>&nbsp;<span class="ident" id="1766542">r</span><span class="op" id="1766543">,</span>&nbsp;<span class="num" id="1766545">3</span><span class="op" id="1766546">,</span>&nbsp;<span class="builtintype" id="1766548">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766555">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766559">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766592">if</span>&nbsp;<span class="ident" id="1766595">n</span>&nbsp;<span class="op" id="1766597">&lt;</span>&nbsp;<span class="num" id="1766599">4</span>&nbsp;<span class="op" id="1766601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766605">return</span>&nbsp;<span class="ident" id="1766612">RuneError</span><span class="op" id="1766621">,</span>&nbsp;<span class="num" id="1766623">1</span><span class="op" id="1766624">,</span>&nbsp;<span class="builtintype" id="1766626">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766632">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1766635">c3</span>&nbsp;<span class="op" id="1766638">:=</span>&nbsp;<span class="ident" id="1766641">p</span><span class="op" id="1766642">[</span><span class="num" id="1766643">3</span><span class="op" id="1766644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766647">if</span>&nbsp;<span class="ident" id="1766650">c3</span>&nbsp;<span class="op" id="1766653">&lt;</span>&nbsp;<span class="ident" id="1766655">tx</span>&nbsp;<span class="op" id="1766658">||</span>&nbsp;<span class="ident" id="1766661">t2</span>&nbsp;<span class="op" id="1766664">&lt;=</span>&nbsp;<span class="ident" id="1766667">c3</span>&nbsp;<span class="op" id="1766670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766674">return</span>&nbsp;<span class="ident" id="1766681">RuneError</span><span class="op" id="1766690">,</span>&nbsp;<span class="num" id="1766692">1</span><span class="op" id="1766693">,</span>&nbsp;<span class="builtintype" id="1766695">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766706">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766735">if</span>&nbsp;<span class="ident" id="1766738">c0</span>&nbsp;<span class="op" id="1766741">&lt;</span>&nbsp;<span class="ident" id="1766743">t5</span>&nbsp;<span class="op" id="1766746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1766750">r</span>&nbsp;<span class="op" id="1766752">=</span>&nbsp;<span class="builtintype" id="1766754">rune</span><span class="op" id="1766758">(</span><span class="ident" id="1766759">c0</span><span class="op" id="1766761">&amp;</span><span class="ident" id="1766762">mask4</span><span class="op" id="1766767">)</span><span class="op" id="1766768">&lt;&lt;</span><span class="num" id="1766770">18</span>&nbsp;<span class="op" id="1766773">|</span>&nbsp;<span class="builtintype" id="1766775">rune</span><span class="op" id="1766779">(</span><span class="ident" id="1766780">c1</span><span class="op" id="1766782">&amp;</span><span class="ident" id="1766783">maskx</span><span class="op" id="1766788">)</span><span class="op" id="1766789">&lt;&lt;</span><span class="num" id="1766791">12</span>&nbsp;<span class="op" id="1766794">|</span>&nbsp;<span class="builtintype" id="1766796">rune</span><span class="op" id="1766800">(</span><span class="ident" id="1766801">c2</span><span class="op" id="1766803">&amp;</span><span class="ident" id="1766804">maskx</span><span class="op" id="1766809">)</span><span class="op" id="1766810">&lt;&lt;</span><span class="num" id="1766812">6</span>&nbsp;<span class="op" id="1766814">|</span>&nbsp;<span class="builtintype" id="1766816">rune</span><span class="op" id="1766820">(</span><span class="ident" id="1766821">c3</span><span class="op" id="1766823">&amp;</span><span class="ident" id="1766824">maskx</span><span class="op" id="1766829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766833">if</span>&nbsp;<span class="ident" id="1766836">r</span>&nbsp;<span class="op" id="1766838">&lt;=</span>&nbsp;<span class="ident" id="1766841">rune3Max</span>&nbsp;<span class="op" id="1766850">||</span>&nbsp;<span class="ident" id="1766853">MaxRune</span>&nbsp;<span class="op" id="1766861">&lt;</span>&nbsp;<span class="ident" id="1766863">r</span>&nbsp;<span class="op" id="1766865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766870">return</span>&nbsp;<span class="ident" id="1766877">RuneError</span><span class="op" id="1766886">,</span>&nbsp;<span class="num" id="1766888">1</span><span class="op" id="1766889">,</span>&nbsp;<span class="builtintype" id="1766891">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766903">return</span>&nbsp;<span class="ident" id="1766910">r</span><span class="op" id="1766911">,</span>&nbsp;<span class="num" id="1766913">4</span><span class="op" id="1766914">,</span>&nbsp;<span class="builtintype" id="1766916">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1766923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1766927">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1766937">return</span>&nbsp;<span class="ident" id="1766944">RuneError</span><span class="op" id="1766953">,</span>&nbsp;<span class="num" id="1766955">1</span><span class="op" id="1766956">,</span>&nbsp;<span class="builtintype" id="1766958">false</span><br>
<span class="lineno"></span><span class="op" id="1766964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1766967">func</span>&nbsp;<span class="ident" id="1766972">decodeRuneInStringInternal</span><span class="op" id="1766998">(</span><span class="ident" id="1766999">s</span>&nbsp;<span class="builtintype" id="1767001">string</span><span class="op" id="1767007">)</span>&nbsp;<span class="op" id="1767009">(</span><span class="ident" id="1767010">r</span>&nbsp;<span class="builtintype" id="1767012">rune</span><span class="op" id="1767016">,</span>&nbsp;<span class="ident" id="1767018">size</span>&nbsp;<span class="builtintype" id="1767023">int</span><span class="op" id="1767026">,</span>&nbsp;<span class="ident" id="1767028">short</span>&nbsp;<span class="builtintype" id="1767034">bool</span><span class="op" id="1767038">)</span>&nbsp;<span class="op" id="1767040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1767043">n</span>&nbsp;<span class="op" id="1767045">:=</span>&nbsp;<span class="builtinfunc" id="1767048">len</span><span class="op" id="1767051">(</span><span class="ident" id="1767052">s</span><span class="op" id="1767053">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767056">if</span>&nbsp;<span class="ident" id="1767059">n</span>&nbsp;<span class="op" id="1767061">&lt;</span>&nbsp;<span class="num" id="1767063">1</span>&nbsp;<span class="op" id="1767065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767069">return</span>&nbsp;<span class="ident" id="1767076">RuneError</span><span class="op" id="1767085">,</span>&nbsp;<span class="num" id="1767087">0</span><span class="op" id="1767088">,</span>&nbsp;<span class="builtintype" id="1767090">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1767099">c0</span>&nbsp;<span class="op" id="1767102">:=</span>&nbsp;<span class="ident" id="1767105">s</span><span class="op" id="1767106">[</span><span class="num" id="1767107">0</span><span class="op" id="1767108">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767112">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767140">if</span>&nbsp;<span class="ident" id="1767143">c0</span>&nbsp;<span class="op" id="1767146">&lt;</span>&nbsp;<span class="ident" id="1767148">tx</span>&nbsp;<span class="op" id="1767151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767155">return</span>&nbsp;<span class="builtintype" id="1767162">rune</span><span class="op" id="1767166">(</span><span class="ident" id="1767167">c0</span><span class="op" id="1767169">)</span><span class="op" id="1767170">,</span>&nbsp;<span class="num" id="1767172">1</span><span class="op" id="1767173">,</span>&nbsp;<span class="builtintype" id="1767175">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767186">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767220">if</span>&nbsp;<span class="ident" id="1767223">c0</span>&nbsp;<span class="op" id="1767226">&lt;</span>&nbsp;<span class="ident" id="1767228">t2</span>&nbsp;<span class="op" id="1767231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767235">return</span>&nbsp;<span class="ident" id="1767242">RuneError</span><span class="op" id="1767251">,</span>&nbsp;<span class="num" id="1767253">1</span><span class="op" id="1767254">,</span>&nbsp;<span class="builtintype" id="1767256">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767267">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767300">if</span>&nbsp;<span class="ident" id="1767303">n</span>&nbsp;<span class="op" id="1767305">&lt;</span>&nbsp;<span class="num" id="1767307">2</span>&nbsp;<span class="op" id="1767309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767313">return</span>&nbsp;<span class="ident" id="1767320">RuneError</span><span class="op" id="1767329">,</span>&nbsp;<span class="num" id="1767331">1</span><span class="op" id="1767332">,</span>&nbsp;<span class="builtintype" id="1767334">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1767343">c1</span>&nbsp;<span class="op" id="1767346">:=</span>&nbsp;<span class="ident" id="1767349">s</span><span class="op" id="1767350">[</span><span class="num" id="1767351">1</span><span class="op" id="1767352">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767355">if</span>&nbsp;<span class="ident" id="1767358">c1</span>&nbsp;<span class="op" id="1767361">&lt;</span>&nbsp;<span class="ident" id="1767363">tx</span>&nbsp;<span class="op" id="1767366">||</span>&nbsp;<span class="ident" id="1767369">t2</span>&nbsp;<span class="op" id="1767372">&lt;=</span>&nbsp;<span class="ident" id="1767375">c1</span>&nbsp;<span class="op" id="1767378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767382">return</span>&nbsp;<span class="ident" id="1767389">RuneError</span><span class="op" id="1767398">,</span>&nbsp;<span class="num" id="1767400">1</span><span class="op" id="1767401">,</span>&nbsp;<span class="builtintype" id="1767403">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767414">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767443">if</span>&nbsp;<span class="ident" id="1767446">c0</span>&nbsp;<span class="op" id="1767449">&lt;</span>&nbsp;<span class="ident" id="1767451">t3</span>&nbsp;<span class="op" id="1767454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1767458">r</span>&nbsp;<span class="op" id="1767460">=</span>&nbsp;<span class="builtintype" id="1767462">rune</span><span class="op" id="1767466">(</span><span class="ident" id="1767467">c0</span><span class="op" id="1767469">&amp;</span><span class="ident" id="1767470">mask2</span><span class="op" id="1767475">)</span><span class="op" id="1767476">&lt;&lt;</span><span class="num" id="1767478">6</span>&nbsp;<span class="op" id="1767480">|</span>&nbsp;<span class="builtintype" id="1767482">rune</span><span class="op" id="1767486">(</span><span class="ident" id="1767487">c1</span><span class="op" id="1767489">&amp;</span><span class="ident" id="1767490">maskx</span><span class="op" id="1767495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767499">if</span>&nbsp;<span class="ident" id="1767502">r</span>&nbsp;<span class="op" id="1767504">&lt;=</span>&nbsp;<span class="ident" id="1767507">rune1Max</span>&nbsp;<span class="op" id="1767516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767521">return</span>&nbsp;<span class="ident" id="1767528">RuneError</span><span class="op" id="1767537">,</span>&nbsp;<span class="num" id="1767539">1</span><span class="op" id="1767540">,</span>&nbsp;<span class="builtintype" id="1767542">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767550">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767554">return</span>&nbsp;<span class="ident" id="1767561">r</span><span class="op" id="1767562">,</span>&nbsp;<span class="num" id="1767564">2</span><span class="op" id="1767565">,</span>&nbsp;<span class="builtintype" id="1767567">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767578">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767612">if</span>&nbsp;<span class="ident" id="1767615">n</span>&nbsp;<span class="op" id="1767617">&lt;</span>&nbsp;<span class="num" id="1767619">3</span>&nbsp;<span class="op" id="1767621">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767625">return</span>&nbsp;<span class="ident" id="1767632">RuneError</span><span class="op" id="1767641">,</span>&nbsp;<span class="num" id="1767643">1</span><span class="op" id="1767644">,</span>&nbsp;<span class="builtintype" id="1767646">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1767655">c2</span>&nbsp;<span class="op" id="1767658">:=</span>&nbsp;<span class="ident" id="1767661">s</span><span class="op" id="1767662">[</span><span class="num" id="1767663">2</span><span class="op" id="1767664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767667">if</span>&nbsp;<span class="ident" id="1767670">c2</span>&nbsp;<span class="op" id="1767673">&lt;</span>&nbsp;<span class="ident" id="1767675">tx</span>&nbsp;<span class="op" id="1767678">||</span>&nbsp;<span class="ident" id="1767681">t2</span>&nbsp;<span class="op" id="1767684">&lt;=</span>&nbsp;<span class="ident" id="1767687">c2</span>&nbsp;<span class="op" id="1767690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767694">return</span>&nbsp;<span class="ident" id="1767701">RuneError</span><span class="op" id="1767710">,</span>&nbsp;<span class="num" id="1767712">1</span><span class="op" id="1767713">,</span>&nbsp;<span class="builtintype" id="1767715">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767726">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767755">if</span>&nbsp;<span class="ident" id="1767758">c0</span>&nbsp;<span class="op" id="1767761">&lt;</span>&nbsp;<span class="ident" id="1767763">t4</span>&nbsp;<span class="op" id="1767766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1767770">r</span>&nbsp;<span class="op" id="1767772">=</span>&nbsp;<span class="builtintype" id="1767774">rune</span><span class="op" id="1767778">(</span><span class="ident" id="1767779">c0</span><span class="op" id="1767781">&amp;</span><span class="ident" id="1767782">mask3</span><span class="op" id="1767787">)</span><span class="op" id="1767788">&lt;&lt;</span><span class="num" id="1767790">12</span>&nbsp;<span class="op" id="1767793">|</span>&nbsp;<span class="builtintype" id="1767795">rune</span><span class="op" id="1767799">(</span><span class="ident" id="1767800">c1</span><span class="op" id="1767802">&amp;</span><span class="ident" id="1767803">maskx</span><span class="op" id="1767808">)</span><span class="op" id="1767809">&lt;&lt;</span><span class="num" id="1767811">6</span>&nbsp;<span class="op" id="1767813">|</span>&nbsp;<span class="builtintype" id="1767815">rune</span><span class="op" id="1767819">(</span><span class="ident" id="1767820">c2</span><span class="op" id="1767822">&amp;</span><span class="ident" id="1767823">maskx</span><span class="op" id="1767828">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767832">if</span>&nbsp;<span class="ident" id="1767835">r</span>&nbsp;<span class="op" id="1767837">&lt;=</span>&nbsp;<span class="ident" id="1767840">rune2Max</span>&nbsp;<span class="op" id="1767849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767854">return</span>&nbsp;<span class="ident" id="1767861">RuneError</span><span class="op" id="1767870">,</span>&nbsp;<span class="num" id="1767872">1</span><span class="op" id="1767873">,</span>&nbsp;<span class="builtintype" id="1767875">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767887">if</span>&nbsp;<span class="ident" id="1767890">surrogateMin</span>&nbsp;<span class="op" id="1767903">&lt;=</span>&nbsp;<span class="ident" id="1767906">r</span>&nbsp;<span class="op" id="1767908">&amp;&amp;</span>&nbsp;<span class="ident" id="1767911">r</span>&nbsp;<span class="op" id="1767913">&lt;=</span>&nbsp;<span class="ident" id="1767916">surrogateMax</span>&nbsp;<span class="op" id="1767929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767934">return</span>&nbsp;<span class="ident" id="1767941">RuneError</span><span class="op" id="1767950">,</span>&nbsp;<span class="num" id="1767952">1</span><span class="op" id="1767953">,</span>&nbsp;<span class="builtintype" id="1767955">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1767967">return</span>&nbsp;<span class="ident" id="1767974">r</span><span class="op" id="1767975">,</span>&nbsp;<span class="num" id="1767977">3</span><span class="op" id="1767978">,</span>&nbsp;<span class="builtintype" id="1767980">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1767987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1767991">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768024">if</span>&nbsp;<span class="ident" id="1768027">n</span>&nbsp;<span class="op" id="1768029">&lt;</span>&nbsp;<span class="num" id="1768031">4</span>&nbsp;<span class="op" id="1768033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768037">return</span>&nbsp;<span class="ident" id="1768044">RuneError</span><span class="op" id="1768053">,</span>&nbsp;<span class="num" id="1768055">1</span><span class="op" id="1768056">,</span>&nbsp;<span class="builtintype" id="1768058">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1768064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1768067">c3</span>&nbsp;<span class="op" id="1768070">:=</span>&nbsp;<span class="ident" id="1768073">s</span><span class="op" id="1768074">[</span><span class="num" id="1768075">3</span><span class="op" id="1768076">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768079">if</span>&nbsp;<span class="ident" id="1768082">c3</span>&nbsp;<span class="op" id="1768085">&lt;</span>&nbsp;<span class="ident" id="1768087">tx</span>&nbsp;<span class="op" id="1768090">||</span>&nbsp;<span class="ident" id="1768093">t2</span>&nbsp;<span class="op" id="1768096">&lt;=</span>&nbsp;<span class="ident" id="1768099">c3</span>&nbsp;<span class="op" id="1768102">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768106">return</span>&nbsp;<span class="ident" id="1768113">RuneError</span><span class="op" id="1768122">,</span>&nbsp;<span class="num" id="1768124">1</span><span class="op" id="1768125">,</span>&nbsp;<span class="builtintype" id="1768127">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1768134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1768138">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768167">if</span>&nbsp;<span class="ident" id="1768170">c0</span>&nbsp;<span class="op" id="1768173">&lt;</span>&nbsp;<span class="ident" id="1768175">t5</span>&nbsp;<span class="op" id="1768178">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1768182">r</span>&nbsp;<span class="op" id="1768184">=</span>&nbsp;<span class="builtintype" id="1768186">rune</span><span class="op" id="1768190">(</span><span class="ident" id="1768191">c0</span><span class="op" id="1768193">&amp;</span><span class="ident" id="1768194">mask4</span><span class="op" id="1768199">)</span><span class="op" id="1768200">&lt;&lt;</span><span class="num" id="1768202">18</span>&nbsp;<span class="op" id="1768205">|</span>&nbsp;<span class="builtintype" id="1768207">rune</span><span class="op" id="1768211">(</span><span class="ident" id="1768212">c1</span><span class="op" id="1768214">&amp;</span><span class="ident" id="1768215">maskx</span><span class="op" id="1768220">)</span><span class="op" id="1768221">&lt;&lt;</span><span class="num" id="1768223">12</span>&nbsp;<span class="op" id="1768226">|</span>&nbsp;<span class="builtintype" id="1768228">rune</span><span class="op" id="1768232">(</span><span class="ident" id="1768233">c2</span><span class="op" id="1768235">&amp;</span><span class="ident" id="1768236">maskx</span><span class="op" id="1768241">)</span><span class="op" id="1768242">&lt;&lt;</span><span class="num" id="1768244">6</span>&nbsp;<span class="op" id="1768246">|</span>&nbsp;<span class="builtintype" id="1768248">rune</span><span class="op" id="1768252">(</span><span class="ident" id="1768253">c3</span><span class="op" id="1768255">&amp;</span><span class="ident" id="1768256">maskx</span><span class="op" id="1768261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768265">if</span>&nbsp;<span class="ident" id="1768268">r</span>&nbsp;<span class="op" id="1768270">&lt;=</span>&nbsp;<span class="ident" id="1768273">rune3Max</span>&nbsp;<span class="op" id="1768282">||</span>&nbsp;<span class="ident" id="1768285">MaxRune</span>&nbsp;<span class="op" id="1768293">&lt;</span>&nbsp;<span class="ident" id="1768295">r</span>&nbsp;<span class="op" id="1768297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768302">return</span>&nbsp;<span class="ident" id="1768309">RuneError</span><span class="op" id="1768318">,</span>&nbsp;<span class="num" id="1768320">1</span><span class="op" id="1768321">,</span>&nbsp;<span class="builtintype" id="1768323">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1768331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768335">return</span>&nbsp;<span class="ident" id="1768342">r</span><span class="op" id="1768343">,</span>&nbsp;<span class="num" id="1768345">4</span><span class="op" id="1768346">,</span>&nbsp;<span class="builtintype" id="1768348">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1768355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1768359">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768369">return</span>&nbsp;<span class="ident" id="1768376">RuneError</span><span class="op" id="1768385">,</span>&nbsp;<span class="num" id="1768387">1</span><span class="op" id="1768388">,</span>&nbsp;<span class="builtintype" id="1768390">false</span><br>
<span class="lineno"></span><span class="op" id="1768396">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1768399">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1768486">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1768582">func</span>&nbsp;<span class="ident" id="1768587">FullRune</span><span class="op" id="1768595">(</span><span class="ident" id="1768596">p</span>&nbsp;<span class="op" id="1768598">[</span><span class="op" id="1768599">]</span><span class="builtintype" id="1768600">byte</span><span class="op" id="1768604">)</span>&nbsp;<span class="builtintype" id="1768606">bool</span>&nbsp;<span class="op" id="1768611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1768614">_</span><span class="op" id="1768615">,</span>&nbsp;<span class="ident" id="1768617">_</span><span class="op" id="1768618">,</span>&nbsp;<span class="ident" id="1768620">short</span>&nbsp;<span class="op" id="1768626">:=</span>&nbsp;<span class="ident" id="1768629">decodeRuneInternal</span><span class="op" id="1768647">(</span><span class="ident" id="1768648">p</span><span class="op" id="1768649">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768652">return</span>&nbsp;<span class="op" id="1768659">!</span><span class="ident" id="1768660">short</span><br>
<span class="lineno"></span><span class="op" id="1768666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1768669">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1768733">func</span>&nbsp;<span class="ident" id="1768738">FullRuneInString</span><span class="op" id="1768754">(</span><span class="ident" id="1768755">s</span>&nbsp;<span class="builtintype" id="1768757">string</span><span class="op" id="1768763">)</span>&nbsp;<span class="builtintype" id="1768765">bool</span>&nbsp;<span class="op" id="1768770">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1768773">_</span><span class="op" id="1768774">,</span>&nbsp;<span class="ident" id="1768776">_</span><span class="op" id="1768777">,</span>&nbsp;<span class="ident" id="1768779">short</span>&nbsp;<span class="op" id="1768785">:=</span>&nbsp;<span class="ident" id="1768788">decodeRuneInStringInternal</span><span class="op" id="1768814">(</span><span class="ident" id="1768815">s</span><span class="op" id="1768816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1768819">return</span>&nbsp;<span class="op" id="1768826">!</span><span class="ident" id="1768827">short</span><br>
<span class="lineno"></span><span class="op" id="1768833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1768836">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1768913">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1768991">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1769066">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1769096">//</span><br>
<span class="lineno"></span><span class="comment" id="1769099">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1769174">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1769246">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1769290">func</span>&nbsp;<span class="ident" id="1769295">DecodeRune</span><span class="op" id="1769305">(</span><span class="ident" id="1769306">p</span>&nbsp;<span class="op" id="1769308">[</span><span class="op" id="1769309">]</span><span class="builtintype" id="1769310">byte</span><span class="op" id="1769314">)</span>&nbsp;<span class="op" id="1769316">(</span><span class="ident" id="1769317">r</span>&nbsp;<span class="builtintype" id="1769319">rune</span><span class="op" id="1769323">,</span>&nbsp;<span class="ident" id="1769325">size</span>&nbsp;<span class="builtintype" id="1769330">int</span><span class="op" id="1769333">)</span>&nbsp;<span class="op" id="1769335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769338">r</span><span class="op" id="1769339">,</span>&nbsp;<span class="ident" id="1769341">size</span><span class="op" id="1769345">,</span>&nbsp;<span class="ident" id="1769347">_</span>&nbsp;<span class="op" id="1769349">=</span>&nbsp;<span class="ident" id="1769351">decodeRuneInternal</span><span class="op" id="1769369">(</span><span class="ident" id="1769370">p</span><span class="op" id="1769371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769374">return</span><br>
<span class="lineno">225</span><span class="op" id="1769381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1769384">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1769460">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1769538">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1769612">//</span><br>
<span class="lineno"></span><span class="comment" id="1769615">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1769690">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1769762">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1769806">func</span>&nbsp;<span class="ident" id="1769811">DecodeRuneInString</span><span class="op" id="1769829">(</span><span class="ident" id="1769830">s</span>&nbsp;<span class="builtintype" id="1769832">string</span><span class="op" id="1769838">)</span>&nbsp;<span class="op" id="1769840">(</span><span class="ident" id="1769841">r</span>&nbsp;<span class="builtintype" id="1769843">rune</span><span class="op" id="1769847">,</span>&nbsp;<span class="ident" id="1769849">size</span>&nbsp;<span class="builtintype" id="1769854">int</span><span class="op" id="1769857">)</span>&nbsp;<span class="op" id="1769859">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1769862">r</span><span class="op" id="1769863">,</span>&nbsp;<span class="ident" id="1769865">size</span><span class="op" id="1769869">,</span>&nbsp;<span class="ident" id="1769871">_</span>&nbsp;<span class="op" id="1769873">=</span>&nbsp;<span class="ident" id="1769875">decodeRuneInStringInternal</span><span class="op" id="1769901">(</span><span class="ident" id="1769902">s</span><span class="op" id="1769903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1769906">return</span><br>
<span class="lineno"></span><span class="op" id="1769913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1769916">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1769996">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1770074">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1770149">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1770179">//</span><br>
<span class="lineno"></span><span class="comment" id="1770182">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1770257">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1770329">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1770373">func</span>&nbsp;<span class="ident" id="1770378">DecodeLastRune</span><span class="op" id="1770392">(</span><span class="ident" id="1770393">p</span>&nbsp;<span class="op" id="1770395">[</span><span class="op" id="1770396">]</span><span class="builtintype" id="1770397">byte</span><span class="op" id="1770401">)</span>&nbsp;<span class="op" id="1770403">(</span><span class="ident" id="1770404">r</span>&nbsp;<span class="builtintype" id="1770406">rune</span><span class="op" id="1770410">,</span>&nbsp;<span class="ident" id="1770412">size</span>&nbsp;<span class="builtintype" id="1770417">int</span><span class="op" id="1770420">)</span>&nbsp;<span class="op" id="1770422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770425">end</span>&nbsp;<span class="op" id="1770429">:=</span>&nbsp;<span class="builtinfunc" id="1770432">len</span><span class="op" id="1770435">(</span><span class="ident" id="1770436">p</span><span class="op" id="1770437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770440">if</span>&nbsp;<span class="ident" id="1770443">end</span>&nbsp;<span class="op" id="1770447">==</span>&nbsp;<span class="num" id="1770450">0</span>&nbsp;<span class="op" id="1770452">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770456">return</span>&nbsp;<span class="ident" id="1770463">RuneError</span><span class="op" id="1770472">,</span>&nbsp;<span class="num" id="1770474">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770480">start</span>&nbsp;<span class="op" id="1770486">:=</span>&nbsp;<span class="ident" id="1770489">end</span>&nbsp;<span class="op" id="1770493">-</span>&nbsp;<span class="num" id="1770495">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770498">r</span>&nbsp;<span class="op" id="1770500">=</span>&nbsp;<span class="builtintype" id="1770502">rune</span><span class="op" id="1770506">(</span><span class="ident" id="1770507">p</span><span class="op" id="1770508">[</span><span class="ident" id="1770509">start</span><span class="op" id="1770514">]</span><span class="op" id="1770515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770518">if</span>&nbsp;<span class="ident" id="1770521">r</span>&nbsp;<span class="op" id="1770523">&lt;</span>&nbsp;<span class="ident" id="1770525">RuneSelf</span>&nbsp;<span class="op" id="1770534">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770538">return</span>&nbsp;<span class="ident" id="1770545">r</span><span class="op" id="1770546">,</span>&nbsp;<span class="num" id="1770548">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1770554">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1770604">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1770657">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770676">lim</span>&nbsp;<span class="op" id="1770680">:=</span>&nbsp;<span class="ident" id="1770683">end</span>&nbsp;<span class="op" id="1770687">-</span>&nbsp;<span class="ident" id="1770689">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770697">if</span>&nbsp;<span class="ident" id="1770700">lim</span>&nbsp;<span class="op" id="1770704">&lt;</span>&nbsp;<span class="num" id="1770706">0</span>&nbsp;<span class="op" id="1770708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770712">lim</span>&nbsp;<span class="op" id="1770716">=</span>&nbsp;<span class="num" id="1770718">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770724">for</span>&nbsp;<span class="ident" id="1770728">start</span><span class="op" id="1770733">--</span><span class="op" id="1770735">;</span>&nbsp;<span class="ident" id="1770737">start</span>&nbsp;<span class="op" id="1770743">&gt;=</span>&nbsp;<span class="ident" id="1770746">lim</span><span class="op" id="1770749">;</span>&nbsp;<span class="ident" id="1770751">start</span><span class="op" id="1770756">--</span>&nbsp;<span class="op" id="1770759">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770763">if</span>&nbsp;<span class="ident" id="1770766">RuneStart</span><span class="op" id="1770775">(</span><span class="ident" id="1770776">p</span><span class="op" id="1770777">[</span><span class="ident" id="1770778">start</span><span class="op" id="1770783">]</span><span class="op" id="1770784">)</span>&nbsp;<span class="op" id="1770786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770791">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770805">if</span>&nbsp;<span class="ident" id="1770808">start</span>&nbsp;<span class="op" id="1770814">&lt;</span>&nbsp;<span class="num" id="1770816">0</span>&nbsp;<span class="op" id="1770818">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770822">start</span>&nbsp;<span class="op" id="1770828">=</span>&nbsp;<span class="num" id="1770830">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1770836">r</span><span class="op" id="1770837">,</span>&nbsp;<span class="ident" id="1770839">size</span>&nbsp;<span class="op" id="1770844">=</span>&nbsp;<span class="ident" id="1770846">DecodeRune</span><span class="op" id="1770856">(</span><span class="ident" id="1770857">p</span><span class="op" id="1770858">[</span><span class="ident" id="1770859">start</span><span class="op" id="1770864">:</span><span class="ident" id="1770865">end</span><span class="op" id="1770868">]</span><span class="op" id="1770869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770872">if</span>&nbsp;<span class="ident" id="1770875">start</span><span class="op" id="1770880">+</span><span class="ident" id="1770881">size</span>&nbsp;<span class="op" id="1770886">!=</span>&nbsp;<span class="ident" id="1770889">end</span>&nbsp;<span class="op" id="1770893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770897">return</span>&nbsp;<span class="ident" id="1770904">RuneError</span><span class="op" id="1770913">,</span>&nbsp;<span class="num" id="1770915">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1770918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1770921">return</span>&nbsp;<span class="ident" id="1770928">r</span><span class="op" id="1770929">,</span>&nbsp;<span class="ident" id="1770931">size</span><br>
<span class="lineno"></span><span class="op" id="1770936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1770939">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1771018">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1771098">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1771175">//</span><br>
<span class="lineno"></span><span class="comment" id="1771178">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1771253">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1771325">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1771369">func</span>&nbsp;<span class="ident" id="1771374">DecodeLastRuneInString</span><span class="op" id="1771396">(</span><span class="ident" id="1771397">s</span>&nbsp;<span class="builtintype" id="1771399">string</span><span class="op" id="1771405">)</span>&nbsp;<span class="op" id="1771407">(</span><span class="ident" id="1771408">r</span>&nbsp;<span class="builtintype" id="1771410">rune</span><span class="op" id="1771414">,</span>&nbsp;<span class="ident" id="1771416">size</span>&nbsp;<span class="builtintype" id="1771421">int</span><span class="op" id="1771424">)</span>&nbsp;<span class="op" id="1771426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771429">end</span>&nbsp;<span class="op" id="1771433">:=</span>&nbsp;<span class="builtinfunc" id="1771436">len</span><span class="op" id="1771439">(</span><span class="ident" id="1771440">s</span><span class="op" id="1771441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771444">if</span>&nbsp;<span class="ident" id="1771447">end</span>&nbsp;<span class="op" id="1771451">==</span>&nbsp;<span class="num" id="1771454">0</span>&nbsp;<span class="op" id="1771456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771460">return</span>&nbsp;<span class="ident" id="1771467">RuneError</span><span class="op" id="1771476">,</span>&nbsp;<span class="num" id="1771478">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771484">start</span>&nbsp;<span class="op" id="1771490">:=</span>&nbsp;<span class="ident" id="1771493">end</span>&nbsp;<span class="op" id="1771497">-</span>&nbsp;<span class="num" id="1771499">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771502">r</span>&nbsp;<span class="op" id="1771504">=</span>&nbsp;<span class="builtintype" id="1771506">rune</span><span class="op" id="1771510">(</span><span class="ident" id="1771511">s</span><span class="op" id="1771512">[</span><span class="ident" id="1771513">start</span><span class="op" id="1771518">]</span><span class="op" id="1771519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771522">if</span>&nbsp;<span class="ident" id="1771525">r</span>&nbsp;<span class="op" id="1771527">&lt;</span>&nbsp;<span class="ident" id="1771529">RuneSelf</span>&nbsp;<span class="op" id="1771538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771542">return</span>&nbsp;<span class="ident" id="1771549">r</span><span class="op" id="1771550">,</span>&nbsp;<span class="num" id="1771552">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771558">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771608">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1771661">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771680">lim</span>&nbsp;<span class="op" id="1771684">:=</span>&nbsp;<span class="ident" id="1771687">end</span>&nbsp;<span class="op" id="1771691">-</span>&nbsp;<span class="ident" id="1771693">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771701">if</span>&nbsp;<span class="ident" id="1771704">lim</span>&nbsp;<span class="op" id="1771708">&lt;</span>&nbsp;<span class="num" id="1771710">0</span>&nbsp;<span class="op" id="1771712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771716">lim</span>&nbsp;<span class="op" id="1771720">=</span>&nbsp;<span class="num" id="1771722">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771728">for</span>&nbsp;<span class="ident" id="1771732">start</span><span class="op" id="1771737">--</span><span class="op" id="1771739">;</span>&nbsp;<span class="ident" id="1771741">start</span>&nbsp;<span class="op" id="1771747">&gt;=</span>&nbsp;<span class="ident" id="1771750">lim</span><span class="op" id="1771753">;</span>&nbsp;<span class="ident" id="1771755">start</span><span class="op" id="1771760">--</span>&nbsp;<span class="op" id="1771763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771767">if</span>&nbsp;<span class="ident" id="1771770">RuneStart</span><span class="op" id="1771779">(</span><span class="ident" id="1771780">s</span><span class="op" id="1771781">[</span><span class="ident" id="1771782">start</span><span class="op" id="1771787">]</span><span class="op" id="1771788">)</span>&nbsp;<span class="op" id="1771790">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771795">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771809">if</span>&nbsp;<span class="ident" id="1771812">start</span>&nbsp;<span class="op" id="1771818">&lt;</span>&nbsp;<span class="num" id="1771820">0</span>&nbsp;<span class="op" id="1771822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771826">start</span>&nbsp;<span class="op" id="1771832">=</span>&nbsp;<span class="num" id="1771834">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1771840">r</span><span class="op" id="1771841">,</span>&nbsp;<span class="ident" id="1771843">size</span>&nbsp;<span class="op" id="1771848">=</span>&nbsp;<span class="ident" id="1771850">DecodeRuneInString</span><span class="op" id="1771868">(</span><span class="ident" id="1771869">s</span><span class="op" id="1771870">[</span><span class="ident" id="1771871">start</span><span class="op" id="1771876">:</span><span class="ident" id="1771877">end</span><span class="op" id="1771880">]</span><span class="op" id="1771881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771884">if</span>&nbsp;<span class="ident" id="1771887">start</span><span class="op" id="1771892">+</span><span class="ident" id="1771893">size</span>&nbsp;<span class="op" id="1771898">!=</span>&nbsp;<span class="ident" id="1771901">end</span>&nbsp;<span class="op" id="1771905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771909">return</span>&nbsp;<span class="ident" id="1771916">RuneError</span><span class="op" id="1771925">,</span>&nbsp;<span class="num" id="1771927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1771930">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1771933">return</span>&nbsp;<span class="ident" id="1771940">r</span><span class="op" id="1771941">,</span>&nbsp;<span class="ident" id="1771943">size</span><br>
<span class="lineno"></span><span class="op" id="1771948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1771951">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1772019">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1772089">func</span>&nbsp;<span class="ident" id="1772094">RuneLen</span><span class="op" id="1772101">(</span><span class="ident" id="1772102">r</span>&nbsp;<span class="builtintype" id="1772104">rune</span><span class="op" id="1772108">)</span>&nbsp;<span class="builtintype" id="1772110">int</span>&nbsp;<span class="op" id="1772114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772117">switch</span>&nbsp;<span class="op" id="1772124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772127">case</span>&nbsp;<span class="ident" id="1772132">r</span>&nbsp;<span class="op" id="1772134">&lt;</span>&nbsp;<span class="num" id="1772136">0</span><span class="op" id="1772137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772141">return</span>&nbsp;<span class="op" id="1772148">-</span><span class="num" id="1772149">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772152">case</span>&nbsp;<span class="ident" id="1772157">r</span>&nbsp;<span class="op" id="1772159">&lt;=</span>&nbsp;<span class="ident" id="1772162">rune1Max</span><span class="op" id="1772170">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772174">return</span>&nbsp;<span class="num" id="1772181">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772184">case</span>&nbsp;<span class="ident" id="1772189">r</span>&nbsp;<span class="op" id="1772191">&lt;=</span>&nbsp;<span class="ident" id="1772194">rune2Max</span><span class="op" id="1772202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772206">return</span>&nbsp;<span class="num" id="1772213">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772216">case</span>&nbsp;<span class="ident" id="1772221">surrogateMin</span>&nbsp;<span class="op" id="1772234">&lt;=</span>&nbsp;<span class="ident" id="1772237">r</span>&nbsp;<span class="op" id="1772239">&amp;&amp;</span>&nbsp;<span class="ident" id="1772242">r</span>&nbsp;<span class="op" id="1772244">&lt;=</span>&nbsp;<span class="ident" id="1772247">surrogateMax</span><span class="op" id="1772259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772263">return</span>&nbsp;<span class="op" id="1772270">-</span><span class="num" id="1772271">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772274">case</span>&nbsp;<span class="ident" id="1772279">r</span>&nbsp;<span class="op" id="1772281">&lt;=</span>&nbsp;<span class="ident" id="1772284">rune3Max</span><span class="op" id="1772292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772296">return</span>&nbsp;<span class="num" id="1772303">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772306">case</span>&nbsp;<span class="ident" id="1772311">r</span>&nbsp;<span class="op" id="1772313">&lt;=</span>&nbsp;<span class="ident" id="1772316">MaxRune</span><span class="op" id="1772323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772327">return</span>&nbsp;<span class="num" id="1772334">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1772337">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772340">return</span>&nbsp;<span class="op" id="1772347">-</span><span class="num" id="1772348">1</span><br>
<span class="lineno"></span><span class="op" id="1772350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1772353">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1772442">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1772485">func</span>&nbsp;<span class="ident" id="1772490">EncodeRune</span><span class="op" id="1772500">(</span><span class="ident" id="1772501">p</span>&nbsp;<span class="op" id="1772503">[</span><span class="op" id="1772504">]</span><span class="builtintype" id="1772505">byte</span><span class="op" id="1772509">,</span>&nbsp;<span class="ident" id="1772511">r</span>&nbsp;<span class="builtintype" id="1772513">rune</span><span class="op" id="1772517">)</span>&nbsp;<span class="builtintype" id="1772519">int</span>&nbsp;<span class="op" id="1772523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1772526">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772604">switch</span>&nbsp;<span class="ident" id="1772611">i</span>&nbsp;<span class="op" id="1772613">:=</span>&nbsp;<span class="builtintype" id="1772616">uint32</span><span class="op" id="1772622">(</span><span class="ident" id="1772623">r</span><span class="op" id="1772624">)</span><span class="op" id="1772625">;</span>&nbsp;<span class="op" id="1772627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772630">case</span>&nbsp;<span class="ident" id="1772635">i</span>&nbsp;<span class="op" id="1772637">&lt;=</span>&nbsp;<span class="ident" id="1772640">rune1Max</span><span class="op" id="1772648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772652">p</span><span class="op" id="1772653">[</span><span class="num" id="1772654">0</span><span class="op" id="1772655">]</span>&nbsp;<span class="op" id="1772657">=</span>&nbsp;<span class="builtintype" id="1772659">byte</span><span class="op" id="1772663">(</span><span class="ident" id="1772664">r</span><span class="op" id="1772665">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772669">return</span>&nbsp;<span class="num" id="1772676">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772679">case</span>&nbsp;<span class="ident" id="1772684">i</span>&nbsp;<span class="op" id="1772686">&lt;=</span>&nbsp;<span class="ident" id="1772689">rune2Max</span><span class="op" id="1772697">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772701">p</span><span class="op" id="1772702">[</span><span class="num" id="1772703">0</span><span class="op" id="1772704">]</span>&nbsp;<span class="op" id="1772706">=</span>&nbsp;<span class="ident" id="1772708">t2</span>&nbsp;<span class="op" id="1772711">|</span>&nbsp;<span class="builtintype" id="1772713">byte</span><span class="op" id="1772717">(</span><span class="ident" id="1772718">r</span><span class="op" id="1772719">&gt;&gt;</span><span class="num" id="1772721">6</span><span class="op" id="1772722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772726">p</span><span class="op" id="1772727">[</span><span class="num" id="1772728">1</span><span class="op" id="1772729">]</span>&nbsp;<span class="op" id="1772731">=</span>&nbsp;<span class="ident" id="1772733">tx</span>&nbsp;<span class="op" id="1772736">|</span>&nbsp;<span class="builtintype" id="1772738">byte</span><span class="op" id="1772742">(</span><span class="ident" id="1772743">r</span><span class="op" id="1772744">)</span><span class="op" id="1772745">&amp;</span><span class="ident" id="1772746">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772754">return</span>&nbsp;<span class="num" id="1772761">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772764">case</span>&nbsp;<span class="ident" id="1772769">i</span>&nbsp;<span class="op" id="1772771">&gt;</span>&nbsp;<span class="ident" id="1772773">MaxRune</span><span class="op" id="1772780">,</span>&nbsp;<span class="ident" id="1772782">surrogateMin</span>&nbsp;<span class="op" id="1772795">&lt;=</span>&nbsp;<span class="ident" id="1772798">i</span>&nbsp;<span class="op" id="1772800">&amp;&amp;</span>&nbsp;<span class="ident" id="1772803">i</span>&nbsp;<span class="op" id="1772805">&lt;=</span>&nbsp;<span class="ident" id="1772808">surrogateMax</span><span class="op" id="1772820">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772824">r</span>&nbsp;<span class="op" id="1772826">=</span>&nbsp;<span class="ident" id="1772828">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772840">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772853">case</span>&nbsp;<span class="ident" id="1772858">i</span>&nbsp;<span class="op" id="1772860">&lt;=</span>&nbsp;<span class="ident" id="1772863">rune3Max</span><span class="op" id="1772871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772875">p</span><span class="op" id="1772876">[</span><span class="num" id="1772877">0</span><span class="op" id="1772878">]</span>&nbsp;<span class="op" id="1772880">=</span>&nbsp;<span class="ident" id="1772882">t3</span>&nbsp;<span class="op" id="1772885">|</span>&nbsp;<span class="builtintype" id="1772887">byte</span><span class="op" id="1772891">(</span><span class="ident" id="1772892">r</span><span class="op" id="1772893">&gt;&gt;</span><span class="num" id="1772895">12</span><span class="op" id="1772897">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772901">p</span><span class="op" id="1772902">[</span><span class="num" id="1772903">1</span><span class="op" id="1772904">]</span>&nbsp;<span class="op" id="1772906">=</span>&nbsp;<span class="ident" id="1772908">tx</span>&nbsp;<span class="op" id="1772911">|</span>&nbsp;<span class="builtintype" id="1772913">byte</span><span class="op" id="1772917">(</span><span class="ident" id="1772918">r</span><span class="op" id="1772919">&gt;&gt;</span><span class="num" id="1772921">6</span><span class="op" id="1772922">)</span><span class="op" id="1772923">&amp;</span><span class="ident" id="1772924">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772932">p</span><span class="op" id="1772933">[</span><span class="num" id="1772934">2</span><span class="op" id="1772935">]</span>&nbsp;<span class="op" id="1772937">=</span>&nbsp;<span class="ident" id="1772939">tx</span>&nbsp;<span class="op" id="1772942">|</span>&nbsp;<span class="builtintype" id="1772944">byte</span><span class="op" id="1772948">(</span><span class="ident" id="1772949">r</span><span class="op" id="1772950">)</span><span class="op" id="1772951">&amp;</span><span class="ident" id="1772952">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772960">return</span>&nbsp;<span class="num" id="1772967">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1772970">default</span><span class="op" id="1772977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1772981">p</span><span class="op" id="1772982">[</span><span class="num" id="1772983">0</span><span class="op" id="1772984">]</span>&nbsp;<span class="op" id="1772986">=</span>&nbsp;<span class="ident" id="1772988">t4</span>&nbsp;<span class="op" id="1772991">|</span>&nbsp;<span class="builtintype" id="1772993">byte</span><span class="op" id="1772997">(</span><span class="ident" id="1772998">r</span><span class="op" id="1772999">&gt;&gt;</span><span class="num" id="1773001">18</span><span class="op" id="1773003">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773007">p</span><span class="op" id="1773008">[</span><span class="num" id="1773009">1</span><span class="op" id="1773010">]</span>&nbsp;<span class="op" id="1773012">=</span>&nbsp;<span class="ident" id="1773014">tx</span>&nbsp;<span class="op" id="1773017">|</span>&nbsp;<span class="builtintype" id="1773019">byte</span><span class="op" id="1773023">(</span><span class="ident" id="1773024">r</span><span class="op" id="1773025">&gt;&gt;</span><span class="num" id="1773027">12</span><span class="op" id="1773029">)</span><span class="op" id="1773030">&amp;</span><span class="ident" id="1773031">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773039">p</span><span class="op" id="1773040">[</span><span class="num" id="1773041">2</span><span class="op" id="1773042">]</span>&nbsp;<span class="op" id="1773044">=</span>&nbsp;<span class="ident" id="1773046">tx</span>&nbsp;<span class="op" id="1773049">|</span>&nbsp;<span class="builtintype" id="1773051">byte</span><span class="op" id="1773055">(</span><span class="ident" id="1773056">r</span><span class="op" id="1773057">&gt;&gt;</span><span class="num" id="1773059">6</span><span class="op" id="1773060">)</span><span class="op" id="1773061">&amp;</span><span class="ident" id="1773062">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773070">p</span><span class="op" id="1773071">[</span><span class="num" id="1773072">3</span><span class="op" id="1773073">]</span>&nbsp;<span class="op" id="1773075">=</span>&nbsp;<span class="ident" id="1773077">tx</span>&nbsp;<span class="op" id="1773080">|</span>&nbsp;<span class="builtintype" id="1773082">byte</span><span class="op" id="1773086">(</span><span class="ident" id="1773087">r</span><span class="op" id="1773088">)</span><span class="op" id="1773089">&amp;</span><span class="ident" id="1773090">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773098">return</span>&nbsp;<span class="num" id="1773105">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773108">}</span><br>
<span class="lineno">365</span><span class="op" id="1773110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1773113">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1773181">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1773239">func</span>&nbsp;<span class="ident" id="1773244">RuneCount</span><span class="op" id="1773253">(</span><span class="ident" id="1773254">p</span>&nbsp;<span class="op" id="1773256">[</span><span class="op" id="1773257">]</span><span class="builtintype" id="1773258">byte</span><span class="op" id="1773262">)</span>&nbsp;<span class="builtintype" id="1773264">int</span>&nbsp;<span class="op" id="1773268">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773271">i</span>&nbsp;<span class="op" id="1773273">:=</span>&nbsp;<span class="num" id="1773276">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773279">var</span>&nbsp;<span class="ident" id="1773283">n</span>&nbsp;<span class="builtintype" id="1773285">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773290">for</span>&nbsp;<span class="ident" id="1773294">n</span>&nbsp;<span class="op" id="1773296">=</span>&nbsp;<span class="num" id="1773298">0</span><span class="op" id="1773299">;</span>&nbsp;<span class="ident" id="1773301">i</span>&nbsp;<span class="op" id="1773303">&lt;</span>&nbsp;<span class="builtinfunc" id="1773305">len</span><span class="op" id="1773308">(</span><span class="ident" id="1773309">p</span><span class="op" id="1773310">)</span><span class="op" id="1773311">;</span>&nbsp;<span class="ident" id="1773313">n</span><span class="op" id="1773314">++</span>&nbsp;<span class="op" id="1773317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773321">if</span>&nbsp;<span class="ident" id="1773324">p</span><span class="op" id="1773325">[</span><span class="ident" id="1773326">i</span><span class="op" id="1773327">]</span>&nbsp;<span class="op" id="1773329">&lt;</span>&nbsp;<span class="ident" id="1773331">RuneSelf</span>&nbsp;<span class="op" id="1773340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773345">i</span><span class="op" id="1773346">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773351">}</span>&nbsp;<span class="keyword" id="1773353">else</span>&nbsp;<span class="op" id="1773358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773363">_</span><span class="op" id="1773364">,</span>&nbsp;<span class="ident" id="1773366">size</span>&nbsp;<span class="op" id="1773371">:=</span>&nbsp;<span class="ident" id="1773374">DecodeRune</span><span class="op" id="1773384">(</span><span class="ident" id="1773385">p</span><span class="op" id="1773386">[</span><span class="ident" id="1773387">i</span><span class="op" id="1773388">:</span><span class="op" id="1773389">]</span><span class="op" id="1773390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773395">i</span>&nbsp;<span class="op" id="1773397">+=</span>&nbsp;<span class="ident" id="1773400">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773410">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773413">return</span>&nbsp;<span class="ident" id="1773420">n</span><br>
<span class="lineno"></span><span class="op" id="1773422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1773425">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1773491">func</span>&nbsp;<span class="ident" id="1773496">RuneCountInString</span><span class="op" id="1773513">(</span><span class="ident" id="1773514">s</span>&nbsp;<span class="builtintype" id="1773516">string</span><span class="op" id="1773522">)</span>&nbsp;<span class="op" id="1773524">(</span><span class="ident" id="1773525">n</span>&nbsp;<span class="builtintype" id="1773527">int</span><span class="op" id="1773530">)</span>&nbsp;<span class="op" id="1773532">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773535">for</span>&nbsp;<span class="keyword" id="1773539">range</span>&nbsp;<span class="ident" id="1773545">s</span>&nbsp;<span class="op" id="1773547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773551">n</span><span class="op" id="1773552">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773559">return</span><br>
<span class="lineno"></span><span class="op" id="1773566">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1773569">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1773634">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1773703">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1773726">func</span>&nbsp;<span class="ident" id="1773731">RuneStart</span><span class="op" id="1773740">(</span><span class="ident" id="1773741">b</span>&nbsp;<span class="builtintype" id="1773743">byte</span><span class="op" id="1773747">)</span>&nbsp;<span class="builtintype" id="1773749">bool</span>&nbsp;<span class="op" id="1773754">{</span>&nbsp;<span class="keyword" id="1773756">return</span>&nbsp;<span class="ident" id="1773763">b</span><span class="op" id="1773764">&amp;</span><span class="num" id="1773765">0xC0</span>&nbsp;<span class="op" id="1773770">!=</span>&nbsp;<span class="num" id="1773773">0x80</span>&nbsp;<span class="op" id="1773778">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1773781">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1773856">func</span>&nbsp;<span class="ident" id="1773861">Valid</span><span class="op" id="1773866">(</span><span class="ident" id="1773867">p</span>&nbsp;<span class="op" id="1773869">[</span><span class="op" id="1773870">]</span><span class="builtintype" id="1773871">byte</span><span class="op" id="1773875">)</span>&nbsp;<span class="builtintype" id="1773877">bool</span>&nbsp;<span class="op" id="1773882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773885">i</span>&nbsp;<span class="op" id="1773887">:=</span>&nbsp;<span class="num" id="1773890">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773893">for</span>&nbsp;<span class="ident" id="1773897">i</span>&nbsp;<span class="op" id="1773899">&lt;</span>&nbsp;<span class="builtinfunc" id="1773901">len</span><span class="op" id="1773904">(</span><span class="ident" id="1773905">p</span><span class="op" id="1773906">)</span>&nbsp;<span class="op" id="1773908">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773912">if</span>&nbsp;<span class="ident" id="1773915">p</span><span class="op" id="1773916">[</span><span class="ident" id="1773917">i</span><span class="op" id="1773918">]</span>&nbsp;<span class="op" id="1773920">&lt;</span>&nbsp;<span class="ident" id="1773922">RuneSelf</span>&nbsp;<span class="op" id="1773931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773936">i</span><span class="op" id="1773937">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1773942">}</span>&nbsp;<span class="keyword" id="1773944">else</span>&nbsp;<span class="op" id="1773949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1773954">_</span><span class="op" id="1773955">,</span>&nbsp;<span class="ident" id="1773957">size</span>&nbsp;<span class="op" id="1773962">:=</span>&nbsp;<span class="ident" id="1773965">DecodeRune</span><span class="op" id="1773975">(</span><span class="ident" id="1773976">p</span><span class="op" id="1773977">[</span><span class="ident" id="1773978">i</span><span class="op" id="1773979">:</span><span class="op" id="1773980">]</span><span class="op" id="1773981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1773986">if</span>&nbsp;<span class="ident" id="1773989">size</span>&nbsp;<span class="op" id="1773994">==</span>&nbsp;<span class="num" id="1773997">1</span>&nbsp;<span class="op" id="1773999">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774005">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774045">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774088">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774121">return</span>&nbsp;<span class="builtintype" id="1774128">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774137">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774142">i</span>&nbsp;<span class="op" id="1774144">+=</span>&nbsp;<span class="ident" id="1774147">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774160">return</span>&nbsp;<span class="builtintype" id="1774167">true</span><br>
<span class="lineno"></span><span class="op" id="1774172">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1774175">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1774256">func</span>&nbsp;<span class="ident" id="1774261">ValidString</span><span class="op" id="1774272">(</span><span class="ident" id="1774273">s</span>&nbsp;<span class="builtintype" id="1774275">string</span><span class="op" id="1774281">)</span>&nbsp;<span class="builtintype" id="1774283">bool</span>&nbsp;<span class="op" id="1774288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774291">for</span>&nbsp;<span class="ident" id="1774295">i</span><span class="op" id="1774296">,</span>&nbsp;<span class="ident" id="1774298">r</span>&nbsp;<span class="op" id="1774300">:=</span>&nbsp;<span class="keyword" id="1774303">range</span>&nbsp;<span class="ident" id="1774309">s</span>&nbsp;<span class="op" id="1774311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774315">if</span>&nbsp;<span class="ident" id="1774318">r</span>&nbsp;<span class="op" id="1774320">==</span>&nbsp;<span class="ident" id="1774323">RuneError</span>&nbsp;<span class="op" id="1774333">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774338">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774380">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774430">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1774480">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1774518">_</span><span class="op" id="1774519">,</span>&nbsp;<span class="ident" id="1774521">size</span>&nbsp;<span class="op" id="1774526">:=</span>&nbsp;<span class="ident" id="1774529">DecodeRuneInString</span><span class="op" id="1774547">(</span><span class="ident" id="1774548">s</span><span class="op" id="1774549">[</span><span class="ident" id="1774550">i</span><span class="op" id="1774551">:</span><span class="op" id="1774552">]</span><span class="op" id="1774553">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774558">if</span>&nbsp;<span class="ident" id="1774561">size</span>&nbsp;<span class="op" id="1774566">==</span>&nbsp;<span class="num" id="1774569">1</span>&nbsp;<span class="op" id="1774571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774577">return</span>&nbsp;<span class="builtintype" id="1774584">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774600">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774603">return</span>&nbsp;<span class="builtintype" id="1774610">true</span><br>
<span class="lineno"></span><span class="op" id="1774615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1774618">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1774682">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1774752">func</span>&nbsp;<span class="ident" id="1774757">ValidRune</span><span class="op" id="1774766">(</span><span class="ident" id="1774767">r</span>&nbsp;<span class="builtintype" id="1774769">rune</span><span class="op" id="1774773">)</span>&nbsp;<span class="builtintype" id="1774775">bool</span>&nbsp;<span class="op" id="1774780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774783">switch</span>&nbsp;<span class="op" id="1774790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774793">case</span>&nbsp;<span class="ident" id="1774798">r</span>&nbsp;<span class="op" id="1774800">&lt;</span>&nbsp;<span class="num" id="1774802">0</span><span class="op" id="1774803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774807">return</span>&nbsp;<span class="builtintype" id="1774814">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774821">case</span>&nbsp;<span class="ident" id="1774826">surrogateMin</span>&nbsp;<span class="op" id="1774839">&lt;=</span>&nbsp;<span class="ident" id="1774842">r</span>&nbsp;<span class="op" id="1774844">&amp;&amp;</span>&nbsp;<span class="ident" id="1774847">r</span>&nbsp;<span class="op" id="1774849">&lt;=</span>&nbsp;<span class="ident" id="1774852">surrogateMax</span><span class="op" id="1774864">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774868">return</span>&nbsp;<span class="builtintype" id="1774875">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774882">case</span>&nbsp;<span class="ident" id="1774887">r</span>&nbsp;<span class="op" id="1774889">&gt;</span>&nbsp;<span class="ident" id="1774891">MaxRune</span><span class="op" id="1774898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774902">return</span>&nbsp;<span class="builtintype" id="1774909">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1774916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1774919">return</span>&nbsp;<span class="builtintype" id="1774926">true</span><br>
<span class="lineno">445</span><span class="op" id="1774931">}</span>
</div>
</body>
</html>
