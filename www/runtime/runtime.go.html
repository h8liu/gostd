<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2077794">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2077850">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2077904">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2077955">package</span>&nbsp;<span class="ident" id="2077963">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2077972">var</span>&nbsp;<span class="ident" id="2077976">ticks</span>&nbsp;<span class="keyword" id="2077982">struct</span>&nbsp;<span class="op" id="2077989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2077992">lock</span>&nbsp;<span class="ident" id="2077997"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2179310">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078004">val</span>&nbsp;&nbsp;<span class="ident" id="2078009">uint64</span><br>
<span class="lineno">10</span><span class="op" id="2078016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2078019">var</span>&nbsp;<span class="ident" id="2078023">tls0</span>&nbsp;<span class="op" id="2078028">[</span><span class="num" id="2078029">8</span><span class="op" id="2078030">]</span><span class="builtintype" id="2078031">uintptr</span>&nbsp;<span class="comment" id="2078039">//&nbsp;available&nbsp;storage&nbsp;for&nbsp;m0&#39;s&nbsp;TLS;&nbsp;not&nbsp;necessarily&nbsp;used;&nbsp;opaque&nbsp;to&nbsp;GC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2078110">//&nbsp;Note:&nbsp;Called&nbsp;by&nbsp;runtime/pprof&nbsp;in&nbsp;addition&nbsp;to&nbsp;runtime&nbsp;code.</span><br>
<span class="lineno">15</span><span class="keyword" id="2078172">func</span>&nbsp;<span class="ident" id="2078177">tickspersecond</span><span class="op" id="2078191">(</span><span class="op" id="2078192">)</span>&nbsp;<span class="ident" id="2078194">int64</span>&nbsp;<span class="op" id="2078200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078203">r</span>&nbsp;<span class="op" id="2078205">:=</span>&nbsp;<span class="ident" id="2078208">int64</span><span class="op" id="2078213">(</span><span class="ident" id="2078214"><a href="/runtime/atomic.go.html#1874483">atomicload64</a></span><span class="op" id="2078226">(</span><span class="op" id="2078227">&amp;</span><span class="ident" id="2078228"><a href="/runtime/runtime.go.html#2077976">ticks</a></span><span class="op" id="2078233">.</span><span class="ident" id="2078234">val</span><span class="op" id="2078237">)</span><span class="op" id="2078238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078241">if</span>&nbsp;<span class="ident" id="2078244"><a href="/runtime/runtime.go.html#2078203">r</a></span>&nbsp;<span class="op" id="2078246">!=</span>&nbsp;<span class="num" id="2078249">0</span>&nbsp;<span class="op" id="2078251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078255">return</span>&nbsp;<span class="ident" id="2078262"><a href="/runtime/runtime.go.html#2078203">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2078265">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078268"><a href="/runtime/lock_futex.go.html#1978439">lock</a></span><span class="op" id="2078272">(</span><span class="op" id="2078273">&amp;</span><span class="ident" id="2078274"><a href="/runtime/runtime.go.html#2077976">ticks</a></span><span class="op" id="2078279">.</span><span class="ident" id="2078280">lock</span><span class="op" id="2078284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078287"><a href="/runtime/runtime.go.html#2078203">r</a></span>&nbsp;<span class="op" id="2078289">=</span>&nbsp;<span class="ident" id="2078291">int64</span><span class="op" id="2078296">(</span><span class="ident" id="2078297"><a href="/runtime/runtime.go.html#2077976">ticks</a></span><span class="op" id="2078302">.</span><span class="ident" id="2078303">val</span><span class="op" id="2078306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078309">if</span>&nbsp;<span class="ident" id="2078312"><a href="/runtime/runtime.go.html#2078203">r</a></span>&nbsp;<span class="op" id="2078314">==</span>&nbsp;<span class="num" id="2078317">0</span>&nbsp;<span class="op" id="2078319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078323">t0</span>&nbsp;<span class="op" id="2078326">:=</span>&nbsp;<span class="ident" id="2078329"><a href="/runtime/stubs.go.html#2137038">nanotime</a></span><span class="op" id="2078337">(</span><span class="op" id="2078338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078342">c0</span>&nbsp;<span class="op" id="2078345">:=</span>&nbsp;<span class="ident" id="2078348"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2078356">(</span><span class="op" id="2078357">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078361"><a href="/runtime/stubs.go.html#2137060">usleep</a></span><span class="op" id="2078367">(</span><span class="num" id="2078368">100</span>&nbsp;<span class="op" id="2078372">*</span>&nbsp;<span class="num" id="2078374">1000</span><span class="op" id="2078378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078382">t1</span>&nbsp;<span class="op" id="2078385">:=</span>&nbsp;<span class="ident" id="2078388"><a href="/runtime/stubs.go.html#2137038">nanotime</a></span><span class="op" id="2078396">(</span><span class="op" id="2078397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078401">c1</span>&nbsp;<span class="op" id="2078404">:=</span>&nbsp;<span class="ident" id="2078407"><a href="/runtime/stubs.go.html#2137246">cputicks</a></span><span class="op" id="2078415">(</span><span class="op" id="2078416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078420">if</span>&nbsp;<span class="ident" id="2078423"><a href="/runtime/runtime.go.html#2078382">t1</a></span>&nbsp;<span class="op" id="2078426">==</span>&nbsp;<span class="ident" id="2078429"><a href="/runtime/runtime.go.html#2078323">t0</a></span>&nbsp;<span class="op" id="2078432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078437"><a href="/runtime/runtime.go.html#2078382">t1</a></span><span class="op" id="2078439">++</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2078444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078448"><a href="/runtime/runtime.go.html#2078203">r</a></span>&nbsp;<span class="op" id="2078450">=</span>&nbsp;<span class="op" id="2078452">(</span><span class="ident" id="2078453"><a href="/runtime/runtime.go.html#2078401">c1</a></span>&nbsp;<span class="op" id="2078456">-</span>&nbsp;<span class="ident" id="2078458"><a href="/runtime/runtime.go.html#2078342">c0</a></span><span class="op" id="2078460">)</span>&nbsp;<span class="op" id="2078462">*</span>&nbsp;<span class="num" id="2078464">1000</span>&nbsp;<span class="op" id="2078469">*</span>&nbsp;<span class="num" id="2078471">1000</span>&nbsp;<span class="op" id="2078476">*</span>&nbsp;<span class="num" id="2078478">1000</span>&nbsp;<span class="op" id="2078483">/</span>&nbsp;<span class="op" id="2078485">(</span><span class="ident" id="2078486"><a href="/runtime/runtime.go.html#2078382">t1</a></span>&nbsp;<span class="op" id="2078489">-</span>&nbsp;<span class="ident" id="2078491"><a href="/runtime/runtime.go.html#2078323">t0</a></span><span class="op" id="2078493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078497">if</span>&nbsp;<span class="ident" id="2078500"><a href="/runtime/runtime.go.html#2078203">r</a></span>&nbsp;<span class="op" id="2078502">==</span>&nbsp;<span class="num" id="2078505">0</span>&nbsp;<span class="op" id="2078507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078512"><a href="/runtime/runtime.go.html#2078203">r</a></span><span class="op" id="2078513">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2078518">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078522"><a href="/runtime/atomic.go.html#1874774">atomicstore64</a></span><span class="op" id="2078535">(</span><span class="op" id="2078536">&amp;</span><span class="ident" id="2078537"><a href="/runtime/runtime.go.html#2077976">ticks</a></span><span class="op" id="2078542">.</span><span class="ident" id="2078543">val</span><span class="op" id="2078546">,</span>&nbsp;<span class="ident" id="2078548">uint64</span><span class="op" id="2078554">(</span><span class="ident" id="2078555"><a href="/runtime/runtime.go.html#2078203">r</a></span><span class="op" id="2078556">)</span><span class="op" id="2078557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2078560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078563"><a href="/runtime/lock_futex.go.html#1979731">unlock</a></span><span class="op" id="2078569">(</span><span class="op" id="2078570">&amp;</span><span class="ident" id="2078571"><a href="/runtime/runtime.go.html#2077976">ticks</a></span><span class="op" id="2078576">.</span><span class="ident" id="2078577">lock</span><span class="op" id="2078581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078584">return</span>&nbsp;<span class="ident" id="2078591"><a href="/runtime/runtime.go.html#2078203">r</a></span><br>
<span class="lineno"></span><span class="op" id="2078593">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2078596">func</span>&nbsp;<span class="ident" id="2078601">makeStringSlice</span><span class="op" id="2078616">(</span><span class="ident" id="2078617">n</span>&nbsp;<span class="builtintype" id="2078619">int</span><span class="op" id="2078622">)</span>&nbsp;<span class="op" id="2078624">[</span><span class="op" id="2078625">]</span><span class="builtintype" id="2078626">string</span>&nbsp;<span class="op" id="2078633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078636">return</span>&nbsp;<span class="builtinfunc" id="2078643">make</span><span class="op" id="2078647">(</span><span class="op" id="2078648">[</span><span class="op" id="2078649">]</span><span class="builtintype" id="2078650">string</span><span class="op" id="2078656">,</span>&nbsp;<span class="ident" id="2078658"><a href="/runtime/runtime.go.html#2078617">n</a></span><span class="op" id="2078659">)</span><br>
<span class="lineno"></span><span class="op" id="2078661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="2078664">//&nbsp;TODO:&nbsp;Move&nbsp;to&nbsp;parfor.go&nbsp;when&nbsp;parfor.c&nbsp;becomes&nbsp;parfor.go.</span><br>
<span class="lineno"></span><span class="keyword" id="2078724">func</span>&nbsp;<span class="ident" id="2078729">parforalloc</span><span class="op" id="2078740">(</span><span class="ident" id="2078741">nthrmax</span>&nbsp;<span class="builtintype" id="2078749">uint32</span><span class="op" id="2078755">)</span>&nbsp;<span class="op" id="2078757">*</span><span class="ident" id="2078758"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2183031">parfor</a></span>&nbsp;<span class="op" id="2078765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2078768">return</span>&nbsp;<span class="op" id="2078775">&amp;</span><span class="ident" id="2078776"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2183031">parfor</a></span><span class="op" id="2078782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078786">thr</span><span class="op" id="2078789">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2078795">&amp;</span><span class="builtinfunc" id="2078796">make</span><span class="op" id="2078800">(</span><span class="op" id="2078801">[</span><span class="op" id="2078802">]</span><span class="ident" id="2078803"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2197283">parforthread</a></span><span class="op" id="2078815">,</span>&nbsp;<span class="ident" id="2078817"><a href="/runtime/runtime.go.html#2078741">nthrmax</a></span><span class="op" id="2078824">)</span><span class="op" id="2078825">[</span><span class="num" id="2078826">0</span><span class="op" id="2078827">]</span><span class="op" id="2078828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2078832">nthrmax</span><span class="op" id="2078839">:</span>&nbsp;<span class="ident" id="2078841"><a href="/runtime/runtime.go.html#2078741">nthrmax</a></span><span class="op" id="2078848">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2078851">}</span><br>
<span class="lineno"></span><span class="op" id="2078853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2078856">var</span>&nbsp;<span class="ident" id="2078860">envs</span>&nbsp;<span class="op" id="2078865">[</span><span class="op" id="2078866">]</span><span class="builtintype" id="2078867">string</span><br>
<span class="lineno"></span><span class="keyword" id="2078874">var</span>&nbsp;<span class="ident" id="2078878">argslice</span>&nbsp;<span class="op" id="2078887">[</span><span class="op" id="2078888">]</span><span class="builtintype" id="2078889">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="2078897">//&nbsp;called&nbsp;from&nbsp;syscall</span><br>
<span class="lineno"></span><span class="keyword" id="2078920">func</span>&nbsp;<span class="ident" id="2078925">runtime_envs</span><span class="op" id="2078937">(</span><span class="op" id="2078938">)</span>&nbsp;<span class="op" id="2078940">[</span><span class="op" id="2078941">]</span><span class="builtintype" id="2078942">string</span>&nbsp;<span class="op" id="2078949">{</span>&nbsp;<span class="keyword" id="2078951">return</span>&nbsp;<span class="ident" id="2078958"><a href="/runtime/runtime.go.html#2078860">envs</a></span>&nbsp;<span class="op" id="2078963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2078966">//&nbsp;called&nbsp;from&nbsp;os</span><br>
<span class="lineno">60</span><span class="keyword" id="2078984">func</span>&nbsp;<span class="ident" id="2078989">runtime_args</span><span class="op" id="2079001">(</span><span class="op" id="2079002">)</span>&nbsp;<span class="op" id="2079004">[</span><span class="op" id="2079005">]</span><span class="builtintype" id="2079006">string</span>&nbsp;<span class="op" id="2079013">{</span>&nbsp;<span class="keyword" id="2079015">return</span>&nbsp;<span class="ident" id="2079022"><a href="/runtime/runtime.go.html#2078878">argslice</a></span>&nbsp;<span class="op" id="2079031">}</span>
</div>
</body>
</html>
