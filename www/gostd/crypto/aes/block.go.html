<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html" class="current">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3536382">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3536437">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3536491">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3536542">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="3536606">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="3536668">//</span><br>
<span class="lineno"></span><span class="comment" id="3536671">//&nbsp;&nbsp;&nbsp;&nbsp;rijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="3536693">//</span><br>
<span class="lineno">10</span><span class="comment" id="3536696">//&nbsp;&nbsp;&nbsp;&nbsp;@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="3536728">//</span><br>
<span class="lineno"></span><span class="comment" id="3536731">//&nbsp;&nbsp;&nbsp;&nbsp;Optimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="3536790">//</span><br>
<span class="lineno"></span><span class="comment" id="3536793">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="3536856">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3536925">//&nbsp;&nbsp;&nbsp;&nbsp;@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="3536979">//</span><br>
<span class="lineno"></span><span class="comment" id="3536982">//&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="3537034">//</span><br>
<span class="lineno">20</span><span class="comment" id="3537037">//&nbsp;&nbsp;&nbsp;&nbsp;THIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="3537107">//&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="3537176">//&nbsp;&nbsp;&nbsp;&nbsp;WARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="3537246">//&nbsp;&nbsp;&nbsp;&nbsp;ARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="3537315">//&nbsp;&nbsp;&nbsp;&nbsp;LIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="3537386">//&nbsp;&nbsp;&nbsp;&nbsp;CONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="3537458">//&nbsp;&nbsp;&nbsp;&nbsp;SUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="3537525">//&nbsp;&nbsp;&nbsp;&nbsp;BUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="3537598">//&nbsp;&nbsp;&nbsp;&nbsp;WHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="3537670">//&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="3537739">//&nbsp;&nbsp;&nbsp;&nbsp;EVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="3537793">//</span><br>
<span class="lineno"></span><span class="comment" id="3537796">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="3537879">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3537910">//&nbsp;&nbsp;&nbsp;&nbsp;http://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="3537977">//&nbsp;&nbsp;&nbsp;&nbsp;http://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3538045">package</span>&nbsp;<span class="ident" id="3538053">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3538058">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="3538125">func</span>&nbsp;<span class="ident" id="3538130">encryptBlockGo</span><span class="op" id="3538144">(</span><span class="ident" id="3538145">xk</span>&nbsp;<span class="op" id="3538148">[</span><span class="op" id="3538149">]</span><span class="builtintype" id="3538150">uint32</span><span class="op" id="3538156">,</span>&nbsp;<span class="ident" id="3538158">dst</span><span class="op" id="3538161">,</span>&nbsp;<span class="ident" id="3538163">src</span>&nbsp;<span class="op" id="3538167">[</span><span class="op" id="3538168">]</span><span class="builtintype" id="3538169">byte</span><span class="op" id="3538173">)</span>&nbsp;<span class="op" id="3538175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538178">var</span>&nbsp;<span class="ident" id="3538182">s0</span><span class="op" id="3538184">,</span>&nbsp;<span class="ident" id="3538186">s1</span><span class="op" id="3538188">,</span>&nbsp;<span class="ident" id="3538190">s2</span><span class="op" id="3538192">,</span>&nbsp;<span class="ident" id="3538194">s3</span><span class="op" id="3538196">,</span>&nbsp;<span class="ident" id="3538198">t0</span><span class="op" id="3538200">,</span>&nbsp;<span class="ident" id="3538202">t1</span><span class="op" id="3538204">,</span>&nbsp;<span class="ident" id="3538206">t2</span><span class="op" id="3538208">,</span>&nbsp;<span class="ident" id="3538210">t3</span>&nbsp;<span class="builtintype" id="3538213">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538222">s0</span>&nbsp;<span class="op" id="3538225">=</span>&nbsp;<span class="builtintype" id="3538227">uint32</span><span class="op" id="3538233">(</span><span class="ident" id="3538234">src</span><span class="op" id="3538237">[</span><span class="num" id="3538238">0</span><span class="op" id="3538239">]</span><span class="op" id="3538240">)</span><span class="op" id="3538241">&lt;&lt;</span><span class="num" id="3538243">24</span>&nbsp;<span class="op" id="3538246">|</span>&nbsp;<span class="builtintype" id="3538248">uint32</span><span class="op" id="3538254">(</span><span class="ident" id="3538255">src</span><span class="op" id="3538258">[</span><span class="num" id="3538259">1</span><span class="op" id="3538260">]</span><span class="op" id="3538261">)</span><span class="op" id="3538262">&lt;&lt;</span><span class="num" id="3538264">16</span>&nbsp;<span class="op" id="3538267">|</span>&nbsp;<span class="builtintype" id="3538269">uint32</span><span class="op" id="3538275">(</span><span class="ident" id="3538276">src</span><span class="op" id="3538279">[</span><span class="num" id="3538280">2</span><span class="op" id="3538281">]</span><span class="op" id="3538282">)</span><span class="op" id="3538283">&lt;&lt;</span><span class="num" id="3538285">8</span>&nbsp;<span class="op" id="3538287">|</span>&nbsp;<span class="builtintype" id="3538289">uint32</span><span class="op" id="3538295">(</span><span class="ident" id="3538296">src</span><span class="op" id="3538299">[</span><span class="num" id="3538300">3</span><span class="op" id="3538301">]</span><span class="op" id="3538302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538305">s1</span>&nbsp;<span class="op" id="3538308">=</span>&nbsp;<span class="builtintype" id="3538310">uint32</span><span class="op" id="3538316">(</span><span class="ident" id="3538317">src</span><span class="op" id="3538320">[</span><span class="num" id="3538321">4</span><span class="op" id="3538322">]</span><span class="op" id="3538323">)</span><span class="op" id="3538324">&lt;&lt;</span><span class="num" id="3538326">24</span>&nbsp;<span class="op" id="3538329">|</span>&nbsp;<span class="builtintype" id="3538331">uint32</span><span class="op" id="3538337">(</span><span class="ident" id="3538338">src</span><span class="op" id="3538341">[</span><span class="num" id="3538342">5</span><span class="op" id="3538343">]</span><span class="op" id="3538344">)</span><span class="op" id="3538345">&lt;&lt;</span><span class="num" id="3538347">16</span>&nbsp;<span class="op" id="3538350">|</span>&nbsp;<span class="builtintype" id="3538352">uint32</span><span class="op" id="3538358">(</span><span class="ident" id="3538359">src</span><span class="op" id="3538362">[</span><span class="num" id="3538363">6</span><span class="op" id="3538364">]</span><span class="op" id="3538365">)</span><span class="op" id="3538366">&lt;&lt;</span><span class="num" id="3538368">8</span>&nbsp;<span class="op" id="3538370">|</span>&nbsp;<span class="builtintype" id="3538372">uint32</span><span class="op" id="3538378">(</span><span class="ident" id="3538379">src</span><span class="op" id="3538382">[</span><span class="num" id="3538383">7</span><span class="op" id="3538384">]</span><span class="op" id="3538385">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538388">s2</span>&nbsp;<span class="op" id="3538391">=</span>&nbsp;<span class="builtintype" id="3538393">uint32</span><span class="op" id="3538399">(</span><span class="ident" id="3538400">src</span><span class="op" id="3538403">[</span><span class="num" id="3538404">8</span><span class="op" id="3538405">]</span><span class="op" id="3538406">)</span><span class="op" id="3538407">&lt;&lt;</span><span class="num" id="3538409">24</span>&nbsp;<span class="op" id="3538412">|</span>&nbsp;<span class="builtintype" id="3538414">uint32</span><span class="op" id="3538420">(</span><span class="ident" id="3538421">src</span><span class="op" id="3538424">[</span><span class="num" id="3538425">9</span><span class="op" id="3538426">]</span><span class="op" id="3538427">)</span><span class="op" id="3538428">&lt;&lt;</span><span class="num" id="3538430">16</span>&nbsp;<span class="op" id="3538433">|</span>&nbsp;<span class="builtintype" id="3538435">uint32</span><span class="op" id="3538441">(</span><span class="ident" id="3538442">src</span><span class="op" id="3538445">[</span><span class="num" id="3538446">10</span><span class="op" id="3538448">]</span><span class="op" id="3538449">)</span><span class="op" id="3538450">&lt;&lt;</span><span class="num" id="3538452">8</span>&nbsp;<span class="op" id="3538454">|</span>&nbsp;<span class="builtintype" id="3538456">uint32</span><span class="op" id="3538462">(</span><span class="ident" id="3538463">src</span><span class="op" id="3538466">[</span><span class="num" id="3538467">11</span><span class="op" id="3538469">]</span><span class="op" id="3538470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538473">s3</span>&nbsp;<span class="op" id="3538476">=</span>&nbsp;<span class="builtintype" id="3538478">uint32</span><span class="op" id="3538484">(</span><span class="ident" id="3538485">src</span><span class="op" id="3538488">[</span><span class="num" id="3538489">12</span><span class="op" id="3538491">]</span><span class="op" id="3538492">)</span><span class="op" id="3538493">&lt;&lt;</span><span class="num" id="3538495">24</span>&nbsp;<span class="op" id="3538498">|</span>&nbsp;<span class="builtintype" id="3538500">uint32</span><span class="op" id="3538506">(</span><span class="ident" id="3538507">src</span><span class="op" id="3538510">[</span><span class="num" id="3538511">13</span><span class="op" id="3538513">]</span><span class="op" id="3538514">)</span><span class="op" id="3538515">&lt;&lt;</span><span class="num" id="3538517">16</span>&nbsp;<span class="op" id="3538520">|</span>&nbsp;<span class="builtintype" id="3538522">uint32</span><span class="op" id="3538528">(</span><span class="ident" id="3538529">src</span><span class="op" id="3538532">[</span><span class="num" id="3538533">14</span><span class="op" id="3538535">]</span><span class="op" id="3538536">)</span><span class="op" id="3538537">&lt;&lt;</span><span class="num" id="3538539">8</span>&nbsp;<span class="op" id="3538541">|</span>&nbsp;<span class="builtintype" id="3538543">uint32</span><span class="op" id="3538549">(</span><span class="ident" id="3538550">src</span><span class="op" id="3538553">[</span><span class="num" id="3538554">15</span><span class="op" id="3538556">]</span><span class="op" id="3538557">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3538561">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538603">s0</span>&nbsp;<span class="op" id="3538606">^=</span>&nbsp;<span class="ident" id="3538609">xk</span><span class="op" id="3538611">[</span><span class="num" id="3538612">0</span><span class="op" id="3538613">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538616">s1</span>&nbsp;<span class="op" id="3538619">^=</span>&nbsp;<span class="ident" id="3538622">xk</span><span class="op" id="3538624">[</span><span class="num" id="3538625">1</span><span class="op" id="3538626">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538629">s2</span>&nbsp;<span class="op" id="3538632">^=</span>&nbsp;<span class="ident" id="3538635">xk</span><span class="op" id="3538637">[</span><span class="num" id="3538638">2</span><span class="op" id="3538639">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538642">s3</span>&nbsp;<span class="op" id="3538645">^=</span>&nbsp;<span class="ident" id="3538648">xk</span><span class="op" id="3538650">[</span><span class="num" id="3538651">3</span><span class="op" id="3538652">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3538656">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3538696">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538751">nr</span>&nbsp;<span class="op" id="3538754">:=</span>&nbsp;<span class="builtinfunc" id="3538757">len</span><span class="op" id="3538760">(</span><span class="ident" id="3538761">xk</span><span class="op" id="3538763">)</span><span class="op" id="3538764">/</span><span class="num" id="3538765">4</span>&nbsp;<span class="op" id="3538767">-</span>&nbsp;<span class="num" id="3538769">2</span>&nbsp;<span class="comment" id="3538771">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538806">k</span>&nbsp;<span class="op" id="3538808">:=</span>&nbsp;<span class="num" id="3538811">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3538814">for</span>&nbsp;<span class="ident" id="3538818">r</span>&nbsp;<span class="op" id="3538820">:=</span>&nbsp;<span class="num" id="3538823">0</span><span class="op" id="3538824">;</span>&nbsp;<span class="ident" id="3538826">r</span>&nbsp;<span class="op" id="3538828">&lt;</span>&nbsp;<span class="ident" id="3538830">nr</span><span class="op" id="3538832">;</span>&nbsp;<span class="ident" id="3538834">r</span><span class="op" id="3538835">++</span>&nbsp;<span class="op" id="3538838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538842">t0</span>&nbsp;<span class="op" id="3538845">=</span>&nbsp;<span class="ident" id="3538847">xk</span><span class="op" id="3538849">[</span><span class="ident" id="3538850">k</span><span class="op" id="3538851">+</span><span class="num" id="3538852">0</span><span class="op" id="3538853">]</span>&nbsp;<span class="op" id="3538855">^</span>&nbsp;<span class="ident" id="3538857">te0</span><span class="op" id="3538860">[</span><span class="builtintype" id="3538861">uint8</span><span class="op" id="3538866">(</span><span class="ident" id="3538867">s0</span><span class="op" id="3538869">&gt;&gt;</span><span class="num" id="3538871">24</span><span class="op" id="3538873">)</span><span class="op" id="3538874">]</span>&nbsp;<span class="op" id="3538876">^</span>&nbsp;<span class="ident" id="3538878">te1</span><span class="op" id="3538881">[</span><span class="builtintype" id="3538882">uint8</span><span class="op" id="3538887">(</span><span class="ident" id="3538888">s1</span><span class="op" id="3538890">&gt;&gt;</span><span class="num" id="3538892">16</span><span class="op" id="3538894">)</span><span class="op" id="3538895">]</span>&nbsp;<span class="op" id="3538897">^</span>&nbsp;<span class="ident" id="3538899">te2</span><span class="op" id="3538902">[</span><span class="builtintype" id="3538903">uint8</span><span class="op" id="3538908">(</span><span class="ident" id="3538909">s2</span><span class="op" id="3538911">&gt;&gt;</span><span class="num" id="3538913">8</span><span class="op" id="3538914">)</span><span class="op" id="3538915">]</span>&nbsp;<span class="op" id="3538917">^</span>&nbsp;<span class="ident" id="3538919">te3</span><span class="op" id="3538922">[</span><span class="builtintype" id="3538923">uint8</span><span class="op" id="3538928">(</span><span class="ident" id="3538929">s3</span><span class="op" id="3538931">)</span><span class="op" id="3538932">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3538936">t1</span>&nbsp;<span class="op" id="3538939">=</span>&nbsp;<span class="ident" id="3538941">xk</span><span class="op" id="3538943">[</span><span class="ident" id="3538944">k</span><span class="op" id="3538945">+</span><span class="num" id="3538946">1</span><span class="op" id="3538947">]</span>&nbsp;<span class="op" id="3538949">^</span>&nbsp;<span class="ident" id="3538951">te0</span><span class="op" id="3538954">[</span><span class="builtintype" id="3538955">uint8</span><span class="op" id="3538960">(</span><span class="ident" id="3538961">s1</span><span class="op" id="3538963">&gt;&gt;</span><span class="num" id="3538965">24</span><span class="op" id="3538967">)</span><span class="op" id="3538968">]</span>&nbsp;<span class="op" id="3538970">^</span>&nbsp;<span class="ident" id="3538972">te1</span><span class="op" id="3538975">[</span><span class="builtintype" id="3538976">uint8</span><span class="op" id="3538981">(</span><span class="ident" id="3538982">s2</span><span class="op" id="3538984">&gt;&gt;</span><span class="num" id="3538986">16</span><span class="op" id="3538988">)</span><span class="op" id="3538989">]</span>&nbsp;<span class="op" id="3538991">^</span>&nbsp;<span class="ident" id="3538993">te2</span><span class="op" id="3538996">[</span><span class="builtintype" id="3538997">uint8</span><span class="op" id="3539002">(</span><span class="ident" id="3539003">s3</span><span class="op" id="3539005">&gt;&gt;</span><span class="num" id="3539007">8</span><span class="op" id="3539008">)</span><span class="op" id="3539009">]</span>&nbsp;<span class="op" id="3539011">^</span>&nbsp;<span class="ident" id="3539013">te3</span><span class="op" id="3539016">[</span><span class="builtintype" id="3539017">uint8</span><span class="op" id="3539022">(</span><span class="ident" id="3539023">s0</span><span class="op" id="3539025">)</span><span class="op" id="3539026">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539030">t2</span>&nbsp;<span class="op" id="3539033">=</span>&nbsp;<span class="ident" id="3539035">xk</span><span class="op" id="3539037">[</span><span class="ident" id="3539038">k</span><span class="op" id="3539039">+</span><span class="num" id="3539040">2</span><span class="op" id="3539041">]</span>&nbsp;<span class="op" id="3539043">^</span>&nbsp;<span class="ident" id="3539045">te0</span><span class="op" id="3539048">[</span><span class="builtintype" id="3539049">uint8</span><span class="op" id="3539054">(</span><span class="ident" id="3539055">s2</span><span class="op" id="3539057">&gt;&gt;</span><span class="num" id="3539059">24</span><span class="op" id="3539061">)</span><span class="op" id="3539062">]</span>&nbsp;<span class="op" id="3539064">^</span>&nbsp;<span class="ident" id="3539066">te1</span><span class="op" id="3539069">[</span><span class="builtintype" id="3539070">uint8</span><span class="op" id="3539075">(</span><span class="ident" id="3539076">s3</span><span class="op" id="3539078">&gt;&gt;</span><span class="num" id="3539080">16</span><span class="op" id="3539082">)</span><span class="op" id="3539083">]</span>&nbsp;<span class="op" id="3539085">^</span>&nbsp;<span class="ident" id="3539087">te2</span><span class="op" id="3539090">[</span><span class="builtintype" id="3539091">uint8</span><span class="op" id="3539096">(</span><span class="ident" id="3539097">s0</span><span class="op" id="3539099">&gt;&gt;</span><span class="num" id="3539101">8</span><span class="op" id="3539102">)</span><span class="op" id="3539103">]</span>&nbsp;<span class="op" id="3539105">^</span>&nbsp;<span class="ident" id="3539107">te3</span><span class="op" id="3539110">[</span><span class="builtintype" id="3539111">uint8</span><span class="op" id="3539116">(</span><span class="ident" id="3539117">s1</span><span class="op" id="3539119">)</span><span class="op" id="3539120">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539124">t3</span>&nbsp;<span class="op" id="3539127">=</span>&nbsp;<span class="ident" id="3539129">xk</span><span class="op" id="3539131">[</span><span class="ident" id="3539132">k</span><span class="op" id="3539133">+</span><span class="num" id="3539134">3</span><span class="op" id="3539135">]</span>&nbsp;<span class="op" id="3539137">^</span>&nbsp;<span class="ident" id="3539139">te0</span><span class="op" id="3539142">[</span><span class="builtintype" id="3539143">uint8</span><span class="op" id="3539148">(</span><span class="ident" id="3539149">s3</span><span class="op" id="3539151">&gt;&gt;</span><span class="num" id="3539153">24</span><span class="op" id="3539155">)</span><span class="op" id="3539156">]</span>&nbsp;<span class="op" id="3539158">^</span>&nbsp;<span class="ident" id="3539160">te1</span><span class="op" id="3539163">[</span><span class="builtintype" id="3539164">uint8</span><span class="op" id="3539169">(</span><span class="ident" id="3539170">s0</span><span class="op" id="3539172">&gt;&gt;</span><span class="num" id="3539174">16</span><span class="op" id="3539176">)</span><span class="op" id="3539177">]</span>&nbsp;<span class="op" id="3539179">^</span>&nbsp;<span class="ident" id="3539181">te2</span><span class="op" id="3539184">[</span><span class="builtintype" id="3539185">uint8</span><span class="op" id="3539190">(</span><span class="ident" id="3539191">s1</span><span class="op" id="3539193">&gt;&gt;</span><span class="num" id="3539195">8</span><span class="op" id="3539196">)</span><span class="op" id="3539197">]</span>&nbsp;<span class="op" id="3539199">^</span>&nbsp;<span class="ident" id="3539201">te3</span><span class="op" id="3539204">[</span><span class="builtintype" id="3539205">uint8</span><span class="op" id="3539210">(</span><span class="ident" id="3539211">s2</span><span class="op" id="3539213">)</span><span class="op" id="3539214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539218">k</span>&nbsp;<span class="op" id="3539220">+=</span>&nbsp;<span class="num" id="3539223">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539227">s0</span><span class="op" id="3539229">,</span>&nbsp;<span class="ident" id="3539231">s1</span><span class="op" id="3539233">,</span>&nbsp;<span class="ident" id="3539235">s2</span><span class="op" id="3539237">,</span>&nbsp;<span class="ident" id="3539239">s3</span>&nbsp;<span class="op" id="3539242">=</span>&nbsp;<span class="ident" id="3539244">t0</span><span class="op" id="3539246">,</span>&nbsp;<span class="ident" id="3539248">t1</span><span class="op" id="3539250">,</span>&nbsp;<span class="ident" id="3539252">t2</span><span class="op" id="3539254">,</span>&nbsp;<span class="ident" id="3539256">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3539260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3539264">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539327">s0</span>&nbsp;<span class="op" id="3539330">=</span>&nbsp;<span class="builtintype" id="3539332">uint32</span><span class="op" id="3539338">(</span><span class="ident" id="3539339">sbox0</span><span class="op" id="3539344">[</span><span class="ident" id="3539345">t0</span><span class="op" id="3539347">&gt;&gt;</span><span class="num" id="3539349">24</span><span class="op" id="3539351">]</span><span class="op" id="3539352">)</span><span class="op" id="3539353">&lt;&lt;</span><span class="num" id="3539355">24</span>&nbsp;<span class="op" id="3539358">|</span>&nbsp;<span class="builtintype" id="3539360">uint32</span><span class="op" id="3539366">(</span><span class="ident" id="3539367">sbox0</span><span class="op" id="3539372">[</span><span class="ident" id="3539373">t1</span><span class="op" id="3539375">&gt;&gt;</span><span class="num" id="3539377">16</span><span class="op" id="3539379">&amp;</span><span class="num" id="3539380">0xff</span><span class="op" id="3539384">]</span><span class="op" id="3539385">)</span><span class="op" id="3539386">&lt;&lt;</span><span class="num" id="3539388">16</span>&nbsp;<span class="op" id="3539391">|</span>&nbsp;<span class="builtintype" id="3539393">uint32</span><span class="op" id="3539399">(</span><span class="ident" id="3539400">sbox0</span><span class="op" id="3539405">[</span><span class="ident" id="3539406">t2</span><span class="op" id="3539408">&gt;&gt;</span><span class="num" id="3539410">8</span><span class="op" id="3539411">&amp;</span><span class="num" id="3539412">0xff</span><span class="op" id="3539416">]</span><span class="op" id="3539417">)</span><span class="op" id="3539418">&lt;&lt;</span><span class="num" id="3539420">8</span>&nbsp;<span class="op" id="3539422">|</span>&nbsp;<span class="builtintype" id="3539424">uint32</span><span class="op" id="3539430">(</span><span class="ident" id="3539431">sbox0</span><span class="op" id="3539436">[</span><span class="ident" id="3539437">t3</span><span class="op" id="3539439">&amp;</span><span class="num" id="3539440">0xff</span><span class="op" id="3539444">]</span><span class="op" id="3539445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539448">s1</span>&nbsp;<span class="op" id="3539451">=</span>&nbsp;<span class="builtintype" id="3539453">uint32</span><span class="op" id="3539459">(</span><span class="ident" id="3539460">sbox0</span><span class="op" id="3539465">[</span><span class="ident" id="3539466">t1</span><span class="op" id="3539468">&gt;&gt;</span><span class="num" id="3539470">24</span><span class="op" id="3539472">]</span><span class="op" id="3539473">)</span><span class="op" id="3539474">&lt;&lt;</span><span class="num" id="3539476">24</span>&nbsp;<span class="op" id="3539479">|</span>&nbsp;<span class="builtintype" id="3539481">uint32</span><span class="op" id="3539487">(</span><span class="ident" id="3539488">sbox0</span><span class="op" id="3539493">[</span><span class="ident" id="3539494">t2</span><span class="op" id="3539496">&gt;&gt;</span><span class="num" id="3539498">16</span><span class="op" id="3539500">&amp;</span><span class="num" id="3539501">0xff</span><span class="op" id="3539505">]</span><span class="op" id="3539506">)</span><span class="op" id="3539507">&lt;&lt;</span><span class="num" id="3539509">16</span>&nbsp;<span class="op" id="3539512">|</span>&nbsp;<span class="builtintype" id="3539514">uint32</span><span class="op" id="3539520">(</span><span class="ident" id="3539521">sbox0</span><span class="op" id="3539526">[</span><span class="ident" id="3539527">t3</span><span class="op" id="3539529">&gt;&gt;</span><span class="num" id="3539531">8</span><span class="op" id="3539532">&amp;</span><span class="num" id="3539533">0xff</span><span class="op" id="3539537">]</span><span class="op" id="3539538">)</span><span class="op" id="3539539">&lt;&lt;</span><span class="num" id="3539541">8</span>&nbsp;<span class="op" id="3539543">|</span>&nbsp;<span class="builtintype" id="3539545">uint32</span><span class="op" id="3539551">(</span><span class="ident" id="3539552">sbox0</span><span class="op" id="3539557">[</span><span class="ident" id="3539558">t0</span><span class="op" id="3539560">&amp;</span><span class="num" id="3539561">0xff</span><span class="op" id="3539565">]</span><span class="op" id="3539566">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539569">s2</span>&nbsp;<span class="op" id="3539572">=</span>&nbsp;<span class="builtintype" id="3539574">uint32</span><span class="op" id="3539580">(</span><span class="ident" id="3539581">sbox0</span><span class="op" id="3539586">[</span><span class="ident" id="3539587">t2</span><span class="op" id="3539589">&gt;&gt;</span><span class="num" id="3539591">24</span><span class="op" id="3539593">]</span><span class="op" id="3539594">)</span><span class="op" id="3539595">&lt;&lt;</span><span class="num" id="3539597">24</span>&nbsp;<span class="op" id="3539600">|</span>&nbsp;<span class="builtintype" id="3539602">uint32</span><span class="op" id="3539608">(</span><span class="ident" id="3539609">sbox0</span><span class="op" id="3539614">[</span><span class="ident" id="3539615">t3</span><span class="op" id="3539617">&gt;&gt;</span><span class="num" id="3539619">16</span><span class="op" id="3539621">&amp;</span><span class="num" id="3539622">0xff</span><span class="op" id="3539626">]</span><span class="op" id="3539627">)</span><span class="op" id="3539628">&lt;&lt;</span><span class="num" id="3539630">16</span>&nbsp;<span class="op" id="3539633">|</span>&nbsp;<span class="builtintype" id="3539635">uint32</span><span class="op" id="3539641">(</span><span class="ident" id="3539642">sbox0</span><span class="op" id="3539647">[</span><span class="ident" id="3539648">t0</span><span class="op" id="3539650">&gt;&gt;</span><span class="num" id="3539652">8</span><span class="op" id="3539653">&amp;</span><span class="num" id="3539654">0xff</span><span class="op" id="3539658">]</span><span class="op" id="3539659">)</span><span class="op" id="3539660">&lt;&lt;</span><span class="num" id="3539662">8</span>&nbsp;<span class="op" id="3539664">|</span>&nbsp;<span class="builtintype" id="3539666">uint32</span><span class="op" id="3539672">(</span><span class="ident" id="3539673">sbox0</span><span class="op" id="3539678">[</span><span class="ident" id="3539679">t1</span><span class="op" id="3539681">&amp;</span><span class="num" id="3539682">0xff</span><span class="op" id="3539686">]</span><span class="op" id="3539687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539690">s3</span>&nbsp;<span class="op" id="3539693">=</span>&nbsp;<span class="builtintype" id="3539695">uint32</span><span class="op" id="3539701">(</span><span class="ident" id="3539702">sbox0</span><span class="op" id="3539707">[</span><span class="ident" id="3539708">t3</span><span class="op" id="3539710">&gt;&gt;</span><span class="num" id="3539712">24</span><span class="op" id="3539714">]</span><span class="op" id="3539715">)</span><span class="op" id="3539716">&lt;&lt;</span><span class="num" id="3539718">24</span>&nbsp;<span class="op" id="3539721">|</span>&nbsp;<span class="builtintype" id="3539723">uint32</span><span class="op" id="3539729">(</span><span class="ident" id="3539730">sbox0</span><span class="op" id="3539735">[</span><span class="ident" id="3539736">t0</span><span class="op" id="3539738">&gt;&gt;</span><span class="num" id="3539740">16</span><span class="op" id="3539742">&amp;</span><span class="num" id="3539743">0xff</span><span class="op" id="3539747">]</span><span class="op" id="3539748">)</span><span class="op" id="3539749">&lt;&lt;</span><span class="num" id="3539751">16</span>&nbsp;<span class="op" id="3539754">|</span>&nbsp;<span class="builtintype" id="3539756">uint32</span><span class="op" id="3539762">(</span><span class="ident" id="3539763">sbox0</span><span class="op" id="3539768">[</span><span class="ident" id="3539769">t1</span><span class="op" id="3539771">&gt;&gt;</span><span class="num" id="3539773">8</span><span class="op" id="3539774">&amp;</span><span class="num" id="3539775">0xff</span><span class="op" id="3539779">]</span><span class="op" id="3539780">)</span><span class="op" id="3539781">&lt;&lt;</span><span class="num" id="3539783">8</span>&nbsp;<span class="op" id="3539785">|</span>&nbsp;<span class="builtintype" id="3539787">uint32</span><span class="op" id="3539793">(</span><span class="ident" id="3539794">sbox0</span><span class="op" id="3539799">[</span><span class="ident" id="3539800">t2</span><span class="op" id="3539802">&amp;</span><span class="num" id="3539803">0xff</span><span class="op" id="3539807">]</span><span class="op" id="3539808">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539812">s0</span>&nbsp;<span class="op" id="3539815">^=</span>&nbsp;<span class="ident" id="3539818">xk</span><span class="op" id="3539820">[</span><span class="ident" id="3539821">k</span><span class="op" id="3539822">+</span><span class="num" id="3539823">0</span><span class="op" id="3539824">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539827">s1</span>&nbsp;<span class="op" id="3539830">^=</span>&nbsp;<span class="ident" id="3539833">xk</span><span class="op" id="3539835">[</span><span class="ident" id="3539836">k</span><span class="op" id="3539837">+</span><span class="num" id="3539838">1</span><span class="op" id="3539839">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539842">s2</span>&nbsp;<span class="op" id="3539845">^=</span>&nbsp;<span class="ident" id="3539848">xk</span><span class="op" id="3539850">[</span><span class="ident" id="3539851">k</span><span class="op" id="3539852">+</span><span class="num" id="3539853">2</span><span class="op" id="3539854">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539857">s3</span>&nbsp;<span class="op" id="3539860">^=</span>&nbsp;<span class="ident" id="3539863">xk</span><span class="op" id="3539865">[</span><span class="ident" id="3539866">k</span><span class="op" id="3539867">+</span><span class="num" id="3539868">3</span><span class="op" id="3539869">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539873">dst</span><span class="op" id="3539876">[</span><span class="num" id="3539877">0</span><span class="op" id="3539878">]</span><span class="op" id="3539879">,</span>&nbsp;<span class="ident" id="3539881">dst</span><span class="op" id="3539884">[</span><span class="num" id="3539885">1</span><span class="op" id="3539886">]</span><span class="op" id="3539887">,</span>&nbsp;<span class="ident" id="3539889">dst</span><span class="op" id="3539892">[</span><span class="num" id="3539893">2</span><span class="op" id="3539894">]</span><span class="op" id="3539895">,</span>&nbsp;<span class="ident" id="3539897">dst</span><span class="op" id="3539900">[</span><span class="num" id="3539901">3</span><span class="op" id="3539902">]</span>&nbsp;<span class="op" id="3539904">=</span>&nbsp;<span class="builtintype" id="3539906">byte</span><span class="op" id="3539910">(</span><span class="ident" id="3539911">s0</span><span class="op" id="3539913">&gt;&gt;</span><span class="num" id="3539915">24</span><span class="op" id="3539917">)</span><span class="op" id="3539918">,</span>&nbsp;<span class="builtintype" id="3539920">byte</span><span class="op" id="3539924">(</span><span class="ident" id="3539925">s0</span><span class="op" id="3539927">&gt;&gt;</span><span class="num" id="3539929">16</span><span class="op" id="3539931">)</span><span class="op" id="3539932">,</span>&nbsp;<span class="builtintype" id="3539934">byte</span><span class="op" id="3539938">(</span><span class="ident" id="3539939">s0</span><span class="op" id="3539941">&gt;&gt;</span><span class="num" id="3539943">8</span><span class="op" id="3539944">)</span><span class="op" id="3539945">,</span>&nbsp;<span class="builtintype" id="3539947">byte</span><span class="op" id="3539951">(</span><span class="ident" id="3539952">s0</span><span class="op" id="3539954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3539957">dst</span><span class="op" id="3539960">[</span><span class="num" id="3539961">4</span><span class="op" id="3539962">]</span><span class="op" id="3539963">,</span>&nbsp;<span class="ident" id="3539965">dst</span><span class="op" id="3539968">[</span><span class="num" id="3539969">5</span><span class="op" id="3539970">]</span><span class="op" id="3539971">,</span>&nbsp;<span class="ident" id="3539973">dst</span><span class="op" id="3539976">[</span><span class="num" id="3539977">6</span><span class="op" id="3539978">]</span><span class="op" id="3539979">,</span>&nbsp;<span class="ident" id="3539981">dst</span><span class="op" id="3539984">[</span><span class="num" id="3539985">7</span><span class="op" id="3539986">]</span>&nbsp;<span class="op" id="3539988">=</span>&nbsp;<span class="builtintype" id="3539990">byte</span><span class="op" id="3539994">(</span><span class="ident" id="3539995">s1</span><span class="op" id="3539997">&gt;&gt;</span><span class="num" id="3539999">24</span><span class="op" id="3540001">)</span><span class="op" id="3540002">,</span>&nbsp;<span class="builtintype" id="3540004">byte</span><span class="op" id="3540008">(</span><span class="ident" id="3540009">s1</span><span class="op" id="3540011">&gt;&gt;</span><span class="num" id="3540013">16</span><span class="op" id="3540015">)</span><span class="op" id="3540016">,</span>&nbsp;<span class="builtintype" id="3540018">byte</span><span class="op" id="3540022">(</span><span class="ident" id="3540023">s1</span><span class="op" id="3540025">&gt;&gt;</span><span class="num" id="3540027">8</span><span class="op" id="3540028">)</span><span class="op" id="3540029">,</span>&nbsp;<span class="builtintype" id="3540031">byte</span><span class="op" id="3540035">(</span><span class="ident" id="3540036">s1</span><span class="op" id="3540038">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540041">dst</span><span class="op" id="3540044">[</span><span class="num" id="3540045">8</span><span class="op" id="3540046">]</span><span class="op" id="3540047">,</span>&nbsp;<span class="ident" id="3540049">dst</span><span class="op" id="3540052">[</span><span class="num" id="3540053">9</span><span class="op" id="3540054">]</span><span class="op" id="3540055">,</span>&nbsp;<span class="ident" id="3540057">dst</span><span class="op" id="3540060">[</span><span class="num" id="3540061">10</span><span class="op" id="3540063">]</span><span class="op" id="3540064">,</span>&nbsp;<span class="ident" id="3540066">dst</span><span class="op" id="3540069">[</span><span class="num" id="3540070">11</span><span class="op" id="3540072">]</span>&nbsp;<span class="op" id="3540074">=</span>&nbsp;<span class="builtintype" id="3540076">byte</span><span class="op" id="3540080">(</span><span class="ident" id="3540081">s2</span><span class="op" id="3540083">&gt;&gt;</span><span class="num" id="3540085">24</span><span class="op" id="3540087">)</span><span class="op" id="3540088">,</span>&nbsp;<span class="builtintype" id="3540090">byte</span><span class="op" id="3540094">(</span><span class="ident" id="3540095">s2</span><span class="op" id="3540097">&gt;&gt;</span><span class="num" id="3540099">16</span><span class="op" id="3540101">)</span><span class="op" id="3540102">,</span>&nbsp;<span class="builtintype" id="3540104">byte</span><span class="op" id="3540108">(</span><span class="ident" id="3540109">s2</span><span class="op" id="3540111">&gt;&gt;</span><span class="num" id="3540113">8</span><span class="op" id="3540114">)</span><span class="op" id="3540115">,</span>&nbsp;<span class="builtintype" id="3540117">byte</span><span class="op" id="3540121">(</span><span class="ident" id="3540122">s2</span><span class="op" id="3540124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540127">dst</span><span class="op" id="3540130">[</span><span class="num" id="3540131">12</span><span class="op" id="3540133">]</span><span class="op" id="3540134">,</span>&nbsp;<span class="ident" id="3540136">dst</span><span class="op" id="3540139">[</span><span class="num" id="3540140">13</span><span class="op" id="3540142">]</span><span class="op" id="3540143">,</span>&nbsp;<span class="ident" id="3540145">dst</span><span class="op" id="3540148">[</span><span class="num" id="3540149">14</span><span class="op" id="3540151">]</span><span class="op" id="3540152">,</span>&nbsp;<span class="ident" id="3540154">dst</span><span class="op" id="3540157">[</span><span class="num" id="3540158">15</span><span class="op" id="3540160">]</span>&nbsp;<span class="op" id="3540162">=</span>&nbsp;<span class="builtintype" id="3540164">byte</span><span class="op" id="3540168">(</span><span class="ident" id="3540169">s3</span><span class="op" id="3540171">&gt;&gt;</span><span class="num" id="3540173">24</span><span class="op" id="3540175">)</span><span class="op" id="3540176">,</span>&nbsp;<span class="builtintype" id="3540178">byte</span><span class="op" id="3540182">(</span><span class="ident" id="3540183">s3</span><span class="op" id="3540185">&gt;&gt;</span><span class="num" id="3540187">16</span><span class="op" id="3540189">)</span><span class="op" id="3540190">,</span>&nbsp;<span class="builtintype" id="3540192">byte</span><span class="op" id="3540196">(</span><span class="ident" id="3540197">s3</span><span class="op" id="3540199">&gt;&gt;</span><span class="num" id="3540201">8</span><span class="op" id="3540202">)</span><span class="op" id="3540203">,</span>&nbsp;<span class="builtintype" id="3540205">byte</span><span class="op" id="3540209">(</span><span class="ident" id="3540210">s3</span><span class="op" id="3540212">)</span><br>
<span class="lineno"></span><span class="op" id="3540214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3540217">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="3540284">func</span>&nbsp;<span class="ident" id="3540289">decryptBlockGo</span><span class="op" id="3540303">(</span><span class="ident" id="3540304">xk</span>&nbsp;<span class="op" id="3540307">[</span><span class="op" id="3540308">]</span><span class="builtintype" id="3540309">uint32</span><span class="op" id="3540315">,</span>&nbsp;<span class="ident" id="3540317">dst</span><span class="op" id="3540320">,</span>&nbsp;<span class="ident" id="3540322">src</span>&nbsp;<span class="op" id="3540326">[</span><span class="op" id="3540327">]</span><span class="builtintype" id="3540328">byte</span><span class="op" id="3540332">)</span>&nbsp;<span class="op" id="3540334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540337">var</span>&nbsp;<span class="ident" id="3540341">s0</span><span class="op" id="3540343">,</span>&nbsp;<span class="ident" id="3540345">s1</span><span class="op" id="3540347">,</span>&nbsp;<span class="ident" id="3540349">s2</span><span class="op" id="3540351">,</span>&nbsp;<span class="ident" id="3540353">s3</span><span class="op" id="3540355">,</span>&nbsp;<span class="ident" id="3540357">t0</span><span class="op" id="3540359">,</span>&nbsp;<span class="ident" id="3540361">t1</span><span class="op" id="3540363">,</span>&nbsp;<span class="ident" id="3540365">t2</span><span class="op" id="3540367">,</span>&nbsp;<span class="ident" id="3540369">t3</span>&nbsp;<span class="builtintype" id="3540372">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540381">s0</span>&nbsp;<span class="op" id="3540384">=</span>&nbsp;<span class="builtintype" id="3540386">uint32</span><span class="op" id="3540392">(</span><span class="ident" id="3540393">src</span><span class="op" id="3540396">[</span><span class="num" id="3540397">0</span><span class="op" id="3540398">]</span><span class="op" id="3540399">)</span><span class="op" id="3540400">&lt;&lt;</span><span class="num" id="3540402">24</span>&nbsp;<span class="op" id="3540405">|</span>&nbsp;<span class="builtintype" id="3540407">uint32</span><span class="op" id="3540413">(</span><span class="ident" id="3540414">src</span><span class="op" id="3540417">[</span><span class="num" id="3540418">1</span><span class="op" id="3540419">]</span><span class="op" id="3540420">)</span><span class="op" id="3540421">&lt;&lt;</span><span class="num" id="3540423">16</span>&nbsp;<span class="op" id="3540426">|</span>&nbsp;<span class="builtintype" id="3540428">uint32</span><span class="op" id="3540434">(</span><span class="ident" id="3540435">src</span><span class="op" id="3540438">[</span><span class="num" id="3540439">2</span><span class="op" id="3540440">]</span><span class="op" id="3540441">)</span><span class="op" id="3540442">&lt;&lt;</span><span class="num" id="3540444">8</span>&nbsp;<span class="op" id="3540446">|</span>&nbsp;<span class="builtintype" id="3540448">uint32</span><span class="op" id="3540454">(</span><span class="ident" id="3540455">src</span><span class="op" id="3540458">[</span><span class="num" id="3540459">3</span><span class="op" id="3540460">]</span><span class="op" id="3540461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540464">s1</span>&nbsp;<span class="op" id="3540467">=</span>&nbsp;<span class="builtintype" id="3540469">uint32</span><span class="op" id="3540475">(</span><span class="ident" id="3540476">src</span><span class="op" id="3540479">[</span><span class="num" id="3540480">4</span><span class="op" id="3540481">]</span><span class="op" id="3540482">)</span><span class="op" id="3540483">&lt;&lt;</span><span class="num" id="3540485">24</span>&nbsp;<span class="op" id="3540488">|</span>&nbsp;<span class="builtintype" id="3540490">uint32</span><span class="op" id="3540496">(</span><span class="ident" id="3540497">src</span><span class="op" id="3540500">[</span><span class="num" id="3540501">5</span><span class="op" id="3540502">]</span><span class="op" id="3540503">)</span><span class="op" id="3540504">&lt;&lt;</span><span class="num" id="3540506">16</span>&nbsp;<span class="op" id="3540509">|</span>&nbsp;<span class="builtintype" id="3540511">uint32</span><span class="op" id="3540517">(</span><span class="ident" id="3540518">src</span><span class="op" id="3540521">[</span><span class="num" id="3540522">6</span><span class="op" id="3540523">]</span><span class="op" id="3540524">)</span><span class="op" id="3540525">&lt;&lt;</span><span class="num" id="3540527">8</span>&nbsp;<span class="op" id="3540529">|</span>&nbsp;<span class="builtintype" id="3540531">uint32</span><span class="op" id="3540537">(</span><span class="ident" id="3540538">src</span><span class="op" id="3540541">[</span><span class="num" id="3540542">7</span><span class="op" id="3540543">]</span><span class="op" id="3540544">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540547">s2</span>&nbsp;<span class="op" id="3540550">=</span>&nbsp;<span class="builtintype" id="3540552">uint32</span><span class="op" id="3540558">(</span><span class="ident" id="3540559">src</span><span class="op" id="3540562">[</span><span class="num" id="3540563">8</span><span class="op" id="3540564">]</span><span class="op" id="3540565">)</span><span class="op" id="3540566">&lt;&lt;</span><span class="num" id="3540568">24</span>&nbsp;<span class="op" id="3540571">|</span>&nbsp;<span class="builtintype" id="3540573">uint32</span><span class="op" id="3540579">(</span><span class="ident" id="3540580">src</span><span class="op" id="3540583">[</span><span class="num" id="3540584">9</span><span class="op" id="3540585">]</span><span class="op" id="3540586">)</span><span class="op" id="3540587">&lt;&lt;</span><span class="num" id="3540589">16</span>&nbsp;<span class="op" id="3540592">|</span>&nbsp;<span class="builtintype" id="3540594">uint32</span><span class="op" id="3540600">(</span><span class="ident" id="3540601">src</span><span class="op" id="3540604">[</span><span class="num" id="3540605">10</span><span class="op" id="3540607">]</span><span class="op" id="3540608">)</span><span class="op" id="3540609">&lt;&lt;</span><span class="num" id="3540611">8</span>&nbsp;<span class="op" id="3540613">|</span>&nbsp;<span class="builtintype" id="3540615">uint32</span><span class="op" id="3540621">(</span><span class="ident" id="3540622">src</span><span class="op" id="3540625">[</span><span class="num" id="3540626">11</span><span class="op" id="3540628">]</span><span class="op" id="3540629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540632">s3</span>&nbsp;<span class="op" id="3540635">=</span>&nbsp;<span class="builtintype" id="3540637">uint32</span><span class="op" id="3540643">(</span><span class="ident" id="3540644">src</span><span class="op" id="3540647">[</span><span class="num" id="3540648">12</span><span class="op" id="3540650">]</span><span class="op" id="3540651">)</span><span class="op" id="3540652">&lt;&lt;</span><span class="num" id="3540654">24</span>&nbsp;<span class="op" id="3540657">|</span>&nbsp;<span class="builtintype" id="3540659">uint32</span><span class="op" id="3540665">(</span><span class="ident" id="3540666">src</span><span class="op" id="3540669">[</span><span class="num" id="3540670">13</span><span class="op" id="3540672">]</span><span class="op" id="3540673">)</span><span class="op" id="3540674">&lt;&lt;</span><span class="num" id="3540676">16</span>&nbsp;<span class="op" id="3540679">|</span>&nbsp;<span class="builtintype" id="3540681">uint32</span><span class="op" id="3540687">(</span><span class="ident" id="3540688">src</span><span class="op" id="3540691">[</span><span class="num" id="3540692">14</span><span class="op" id="3540694">]</span><span class="op" id="3540695">)</span><span class="op" id="3540696">&lt;&lt;</span><span class="num" id="3540698">8</span>&nbsp;<span class="op" id="3540700">|</span>&nbsp;<span class="builtintype" id="3540702">uint32</span><span class="op" id="3540708">(</span><span class="ident" id="3540709">src</span><span class="op" id="3540712">[</span><span class="num" id="3540713">15</span><span class="op" id="3540715">]</span><span class="op" id="3540716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3540720">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540762">s0</span>&nbsp;<span class="op" id="3540765">^=</span>&nbsp;<span class="ident" id="3540768">xk</span><span class="op" id="3540770">[</span><span class="num" id="3540771">0</span><span class="op" id="3540772">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540775">s1</span>&nbsp;<span class="op" id="3540778">^=</span>&nbsp;<span class="ident" id="3540781">xk</span><span class="op" id="3540783">[</span><span class="num" id="3540784">1</span><span class="op" id="3540785">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540788">s2</span>&nbsp;<span class="op" id="3540791">^=</span>&nbsp;<span class="ident" id="3540794">xk</span><span class="op" id="3540796">[</span><span class="num" id="3540797">2</span><span class="op" id="3540798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540801">s3</span>&nbsp;<span class="op" id="3540804">^=</span>&nbsp;<span class="ident" id="3540807">xk</span><span class="op" id="3540809">[</span><span class="num" id="3540810">3</span><span class="op" id="3540811">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3540815">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3540855">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540910">nr</span>&nbsp;<span class="op" id="3540913">:=</span>&nbsp;<span class="builtinfunc" id="3540916">len</span><span class="op" id="3540919">(</span><span class="ident" id="3540920">xk</span><span class="op" id="3540922">)</span><span class="op" id="3540923">/</span><span class="num" id="3540924">4</span>&nbsp;<span class="op" id="3540926">-</span>&nbsp;<span class="num" id="3540928">2</span>&nbsp;<span class="comment" id="3540930">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3540965">k</span>&nbsp;<span class="op" id="3540967">:=</span>&nbsp;<span class="num" id="3540970">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3540973">for</span>&nbsp;<span class="ident" id="3540977">r</span>&nbsp;<span class="op" id="3540979">:=</span>&nbsp;<span class="num" id="3540982">0</span><span class="op" id="3540983">;</span>&nbsp;<span class="ident" id="3540985">r</span>&nbsp;<span class="op" id="3540987">&lt;</span>&nbsp;<span class="ident" id="3540989">nr</span><span class="op" id="3540991">;</span>&nbsp;<span class="ident" id="3540993">r</span><span class="op" id="3540994">++</span>&nbsp;<span class="op" id="3540997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541001">t0</span>&nbsp;<span class="op" id="3541004">=</span>&nbsp;<span class="ident" id="3541006">xk</span><span class="op" id="3541008">[</span><span class="ident" id="3541009">k</span><span class="op" id="3541010">+</span><span class="num" id="3541011">0</span><span class="op" id="3541012">]</span>&nbsp;<span class="op" id="3541014">^</span>&nbsp;<span class="ident" id="3541016">td0</span><span class="op" id="3541019">[</span><span class="builtintype" id="3541020">uint8</span><span class="op" id="3541025">(</span><span class="ident" id="3541026">s0</span><span class="op" id="3541028">&gt;&gt;</span><span class="num" id="3541030">24</span><span class="op" id="3541032">)</span><span class="op" id="3541033">]</span>&nbsp;<span class="op" id="3541035">^</span>&nbsp;<span class="ident" id="3541037">td1</span><span class="op" id="3541040">[</span><span class="builtintype" id="3541041">uint8</span><span class="op" id="3541046">(</span><span class="ident" id="3541047">s3</span><span class="op" id="3541049">&gt;&gt;</span><span class="num" id="3541051">16</span><span class="op" id="3541053">)</span><span class="op" id="3541054">]</span>&nbsp;<span class="op" id="3541056">^</span>&nbsp;<span class="ident" id="3541058">td2</span><span class="op" id="3541061">[</span><span class="builtintype" id="3541062">uint8</span><span class="op" id="3541067">(</span><span class="ident" id="3541068">s2</span><span class="op" id="3541070">&gt;&gt;</span><span class="num" id="3541072">8</span><span class="op" id="3541073">)</span><span class="op" id="3541074">]</span>&nbsp;<span class="op" id="3541076">^</span>&nbsp;<span class="ident" id="3541078">td3</span><span class="op" id="3541081">[</span><span class="builtintype" id="3541082">uint8</span><span class="op" id="3541087">(</span><span class="ident" id="3541088">s1</span><span class="op" id="3541090">)</span><span class="op" id="3541091">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541095">t1</span>&nbsp;<span class="op" id="3541098">=</span>&nbsp;<span class="ident" id="3541100">xk</span><span class="op" id="3541102">[</span><span class="ident" id="3541103">k</span><span class="op" id="3541104">+</span><span class="num" id="3541105">1</span><span class="op" id="3541106">]</span>&nbsp;<span class="op" id="3541108">^</span>&nbsp;<span class="ident" id="3541110">td0</span><span class="op" id="3541113">[</span><span class="builtintype" id="3541114">uint8</span><span class="op" id="3541119">(</span><span class="ident" id="3541120">s1</span><span class="op" id="3541122">&gt;&gt;</span><span class="num" id="3541124">24</span><span class="op" id="3541126">)</span><span class="op" id="3541127">]</span>&nbsp;<span class="op" id="3541129">^</span>&nbsp;<span class="ident" id="3541131">td1</span><span class="op" id="3541134">[</span><span class="builtintype" id="3541135">uint8</span><span class="op" id="3541140">(</span><span class="ident" id="3541141">s0</span><span class="op" id="3541143">&gt;&gt;</span><span class="num" id="3541145">16</span><span class="op" id="3541147">)</span><span class="op" id="3541148">]</span>&nbsp;<span class="op" id="3541150">^</span>&nbsp;<span class="ident" id="3541152">td2</span><span class="op" id="3541155">[</span><span class="builtintype" id="3541156">uint8</span><span class="op" id="3541161">(</span><span class="ident" id="3541162">s3</span><span class="op" id="3541164">&gt;&gt;</span><span class="num" id="3541166">8</span><span class="op" id="3541167">)</span><span class="op" id="3541168">]</span>&nbsp;<span class="op" id="3541170">^</span>&nbsp;<span class="ident" id="3541172">td3</span><span class="op" id="3541175">[</span><span class="builtintype" id="3541176">uint8</span><span class="op" id="3541181">(</span><span class="ident" id="3541182">s2</span><span class="op" id="3541184">)</span><span class="op" id="3541185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541189">t2</span>&nbsp;<span class="op" id="3541192">=</span>&nbsp;<span class="ident" id="3541194">xk</span><span class="op" id="3541196">[</span><span class="ident" id="3541197">k</span><span class="op" id="3541198">+</span><span class="num" id="3541199">2</span><span class="op" id="3541200">]</span>&nbsp;<span class="op" id="3541202">^</span>&nbsp;<span class="ident" id="3541204">td0</span><span class="op" id="3541207">[</span><span class="builtintype" id="3541208">uint8</span><span class="op" id="3541213">(</span><span class="ident" id="3541214">s2</span><span class="op" id="3541216">&gt;&gt;</span><span class="num" id="3541218">24</span><span class="op" id="3541220">)</span><span class="op" id="3541221">]</span>&nbsp;<span class="op" id="3541223">^</span>&nbsp;<span class="ident" id="3541225">td1</span><span class="op" id="3541228">[</span><span class="builtintype" id="3541229">uint8</span><span class="op" id="3541234">(</span><span class="ident" id="3541235">s1</span><span class="op" id="3541237">&gt;&gt;</span><span class="num" id="3541239">16</span><span class="op" id="3541241">)</span><span class="op" id="3541242">]</span>&nbsp;<span class="op" id="3541244">^</span>&nbsp;<span class="ident" id="3541246">td2</span><span class="op" id="3541249">[</span><span class="builtintype" id="3541250">uint8</span><span class="op" id="3541255">(</span><span class="ident" id="3541256">s0</span><span class="op" id="3541258">&gt;&gt;</span><span class="num" id="3541260">8</span><span class="op" id="3541261">)</span><span class="op" id="3541262">]</span>&nbsp;<span class="op" id="3541264">^</span>&nbsp;<span class="ident" id="3541266">td3</span><span class="op" id="3541269">[</span><span class="builtintype" id="3541270">uint8</span><span class="op" id="3541275">(</span><span class="ident" id="3541276">s3</span><span class="op" id="3541278">)</span><span class="op" id="3541279">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541283">t3</span>&nbsp;<span class="op" id="3541286">=</span>&nbsp;<span class="ident" id="3541288">xk</span><span class="op" id="3541290">[</span><span class="ident" id="3541291">k</span><span class="op" id="3541292">+</span><span class="num" id="3541293">3</span><span class="op" id="3541294">]</span>&nbsp;<span class="op" id="3541296">^</span>&nbsp;<span class="ident" id="3541298">td0</span><span class="op" id="3541301">[</span><span class="builtintype" id="3541302">uint8</span><span class="op" id="3541307">(</span><span class="ident" id="3541308">s3</span><span class="op" id="3541310">&gt;&gt;</span><span class="num" id="3541312">24</span><span class="op" id="3541314">)</span><span class="op" id="3541315">]</span>&nbsp;<span class="op" id="3541317">^</span>&nbsp;<span class="ident" id="3541319">td1</span><span class="op" id="3541322">[</span><span class="builtintype" id="3541323">uint8</span><span class="op" id="3541328">(</span><span class="ident" id="3541329">s2</span><span class="op" id="3541331">&gt;&gt;</span><span class="num" id="3541333">16</span><span class="op" id="3541335">)</span><span class="op" id="3541336">]</span>&nbsp;<span class="op" id="3541338">^</span>&nbsp;<span class="ident" id="3541340">td2</span><span class="op" id="3541343">[</span><span class="builtintype" id="3541344">uint8</span><span class="op" id="3541349">(</span><span class="ident" id="3541350">s1</span><span class="op" id="3541352">&gt;&gt;</span><span class="num" id="3541354">8</span><span class="op" id="3541355">)</span><span class="op" id="3541356">]</span>&nbsp;<span class="op" id="3541358">^</span>&nbsp;<span class="ident" id="3541360">td3</span><span class="op" id="3541363">[</span><span class="builtintype" id="3541364">uint8</span><span class="op" id="3541369">(</span><span class="ident" id="3541370">s0</span><span class="op" id="3541372">)</span><span class="op" id="3541373">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541377">k</span>&nbsp;<span class="op" id="3541379">+=</span>&nbsp;<span class="num" id="3541382">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541386">s0</span><span class="op" id="3541388">,</span>&nbsp;<span class="ident" id="3541390">s1</span><span class="op" id="3541392">,</span>&nbsp;<span class="ident" id="3541394">s2</span><span class="op" id="3541396">,</span>&nbsp;<span class="ident" id="3541398">s3</span>&nbsp;<span class="op" id="3541401">=</span>&nbsp;<span class="ident" id="3541403">t0</span><span class="op" id="3541405">,</span>&nbsp;<span class="ident" id="3541407">t1</span><span class="op" id="3541409">,</span>&nbsp;<span class="ident" id="3541411">t2</span><span class="op" id="3541413">,</span>&nbsp;<span class="ident" id="3541415">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3541419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3541423">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541486">s0</span>&nbsp;<span class="op" id="3541489">=</span>&nbsp;<span class="builtintype" id="3541491">uint32</span><span class="op" id="3541497">(</span><span class="ident" id="3541498">sbox1</span><span class="op" id="3541503">[</span><span class="ident" id="3541504">t0</span><span class="op" id="3541506">&gt;&gt;</span><span class="num" id="3541508">24</span><span class="op" id="3541510">]</span><span class="op" id="3541511">)</span><span class="op" id="3541512">&lt;&lt;</span><span class="num" id="3541514">24</span>&nbsp;<span class="op" id="3541517">|</span>&nbsp;<span class="builtintype" id="3541519">uint32</span><span class="op" id="3541525">(</span><span class="ident" id="3541526">sbox1</span><span class="op" id="3541531">[</span><span class="ident" id="3541532">t3</span><span class="op" id="3541534">&gt;&gt;</span><span class="num" id="3541536">16</span><span class="op" id="3541538">&amp;</span><span class="num" id="3541539">0xff</span><span class="op" id="3541543">]</span><span class="op" id="3541544">)</span><span class="op" id="3541545">&lt;&lt;</span><span class="num" id="3541547">16</span>&nbsp;<span class="op" id="3541550">|</span>&nbsp;<span class="builtintype" id="3541552">uint32</span><span class="op" id="3541558">(</span><span class="ident" id="3541559">sbox1</span><span class="op" id="3541564">[</span><span class="ident" id="3541565">t2</span><span class="op" id="3541567">&gt;&gt;</span><span class="num" id="3541569">8</span><span class="op" id="3541570">&amp;</span><span class="num" id="3541571">0xff</span><span class="op" id="3541575">]</span><span class="op" id="3541576">)</span><span class="op" id="3541577">&lt;&lt;</span><span class="num" id="3541579">8</span>&nbsp;<span class="op" id="3541581">|</span>&nbsp;<span class="builtintype" id="3541583">uint32</span><span class="op" id="3541589">(</span><span class="ident" id="3541590">sbox1</span><span class="op" id="3541595">[</span><span class="ident" id="3541596">t1</span><span class="op" id="3541598">&amp;</span><span class="num" id="3541599">0xff</span><span class="op" id="3541603">]</span><span class="op" id="3541604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541607">s1</span>&nbsp;<span class="op" id="3541610">=</span>&nbsp;<span class="builtintype" id="3541612">uint32</span><span class="op" id="3541618">(</span><span class="ident" id="3541619">sbox1</span><span class="op" id="3541624">[</span><span class="ident" id="3541625">t1</span><span class="op" id="3541627">&gt;&gt;</span><span class="num" id="3541629">24</span><span class="op" id="3541631">]</span><span class="op" id="3541632">)</span><span class="op" id="3541633">&lt;&lt;</span><span class="num" id="3541635">24</span>&nbsp;<span class="op" id="3541638">|</span>&nbsp;<span class="builtintype" id="3541640">uint32</span><span class="op" id="3541646">(</span><span class="ident" id="3541647">sbox1</span><span class="op" id="3541652">[</span><span class="ident" id="3541653">t0</span><span class="op" id="3541655">&gt;&gt;</span><span class="num" id="3541657">16</span><span class="op" id="3541659">&amp;</span><span class="num" id="3541660">0xff</span><span class="op" id="3541664">]</span><span class="op" id="3541665">)</span><span class="op" id="3541666">&lt;&lt;</span><span class="num" id="3541668">16</span>&nbsp;<span class="op" id="3541671">|</span>&nbsp;<span class="builtintype" id="3541673">uint32</span><span class="op" id="3541679">(</span><span class="ident" id="3541680">sbox1</span><span class="op" id="3541685">[</span><span class="ident" id="3541686">t3</span><span class="op" id="3541688">&gt;&gt;</span><span class="num" id="3541690">8</span><span class="op" id="3541691">&amp;</span><span class="num" id="3541692">0xff</span><span class="op" id="3541696">]</span><span class="op" id="3541697">)</span><span class="op" id="3541698">&lt;&lt;</span><span class="num" id="3541700">8</span>&nbsp;<span class="op" id="3541702">|</span>&nbsp;<span class="builtintype" id="3541704">uint32</span><span class="op" id="3541710">(</span><span class="ident" id="3541711">sbox1</span><span class="op" id="3541716">[</span><span class="ident" id="3541717">t2</span><span class="op" id="3541719">&amp;</span><span class="num" id="3541720">0xff</span><span class="op" id="3541724">]</span><span class="op" id="3541725">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541728">s2</span>&nbsp;<span class="op" id="3541731">=</span>&nbsp;<span class="builtintype" id="3541733">uint32</span><span class="op" id="3541739">(</span><span class="ident" id="3541740">sbox1</span><span class="op" id="3541745">[</span><span class="ident" id="3541746">t2</span><span class="op" id="3541748">&gt;&gt;</span><span class="num" id="3541750">24</span><span class="op" id="3541752">]</span><span class="op" id="3541753">)</span><span class="op" id="3541754">&lt;&lt;</span><span class="num" id="3541756">24</span>&nbsp;<span class="op" id="3541759">|</span>&nbsp;<span class="builtintype" id="3541761">uint32</span><span class="op" id="3541767">(</span><span class="ident" id="3541768">sbox1</span><span class="op" id="3541773">[</span><span class="ident" id="3541774">t1</span><span class="op" id="3541776">&gt;&gt;</span><span class="num" id="3541778">16</span><span class="op" id="3541780">&amp;</span><span class="num" id="3541781">0xff</span><span class="op" id="3541785">]</span><span class="op" id="3541786">)</span><span class="op" id="3541787">&lt;&lt;</span><span class="num" id="3541789">16</span>&nbsp;<span class="op" id="3541792">|</span>&nbsp;<span class="builtintype" id="3541794">uint32</span><span class="op" id="3541800">(</span><span class="ident" id="3541801">sbox1</span><span class="op" id="3541806">[</span><span class="ident" id="3541807">t0</span><span class="op" id="3541809">&gt;&gt;</span><span class="num" id="3541811">8</span><span class="op" id="3541812">&amp;</span><span class="num" id="3541813">0xff</span><span class="op" id="3541817">]</span><span class="op" id="3541818">)</span><span class="op" id="3541819">&lt;&lt;</span><span class="num" id="3541821">8</span>&nbsp;<span class="op" id="3541823">|</span>&nbsp;<span class="builtintype" id="3541825">uint32</span><span class="op" id="3541831">(</span><span class="ident" id="3541832">sbox1</span><span class="op" id="3541837">[</span><span class="ident" id="3541838">t3</span><span class="op" id="3541840">&amp;</span><span class="num" id="3541841">0xff</span><span class="op" id="3541845">]</span><span class="op" id="3541846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541849">s3</span>&nbsp;<span class="op" id="3541852">=</span>&nbsp;<span class="builtintype" id="3541854">uint32</span><span class="op" id="3541860">(</span><span class="ident" id="3541861">sbox1</span><span class="op" id="3541866">[</span><span class="ident" id="3541867">t3</span><span class="op" id="3541869">&gt;&gt;</span><span class="num" id="3541871">24</span><span class="op" id="3541873">]</span><span class="op" id="3541874">)</span><span class="op" id="3541875">&lt;&lt;</span><span class="num" id="3541877">24</span>&nbsp;<span class="op" id="3541880">|</span>&nbsp;<span class="builtintype" id="3541882">uint32</span><span class="op" id="3541888">(</span><span class="ident" id="3541889">sbox1</span><span class="op" id="3541894">[</span><span class="ident" id="3541895">t2</span><span class="op" id="3541897">&gt;&gt;</span><span class="num" id="3541899">16</span><span class="op" id="3541901">&amp;</span><span class="num" id="3541902">0xff</span><span class="op" id="3541906">]</span><span class="op" id="3541907">)</span><span class="op" id="3541908">&lt;&lt;</span><span class="num" id="3541910">16</span>&nbsp;<span class="op" id="3541913">|</span>&nbsp;<span class="builtintype" id="3541915">uint32</span><span class="op" id="3541921">(</span><span class="ident" id="3541922">sbox1</span><span class="op" id="3541927">[</span><span class="ident" id="3541928">t1</span><span class="op" id="3541930">&gt;&gt;</span><span class="num" id="3541932">8</span><span class="op" id="3541933">&amp;</span><span class="num" id="3541934">0xff</span><span class="op" id="3541938">]</span><span class="op" id="3541939">)</span><span class="op" id="3541940">&lt;&lt;</span><span class="num" id="3541942">8</span>&nbsp;<span class="op" id="3541944">|</span>&nbsp;<span class="builtintype" id="3541946">uint32</span><span class="op" id="3541952">(</span><span class="ident" id="3541953">sbox1</span><span class="op" id="3541958">[</span><span class="ident" id="3541959">t0</span><span class="op" id="3541961">&amp;</span><span class="num" id="3541962">0xff</span><span class="op" id="3541966">]</span><span class="op" id="3541967">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541971">s0</span>&nbsp;<span class="op" id="3541974">^=</span>&nbsp;<span class="ident" id="3541977">xk</span><span class="op" id="3541979">[</span><span class="ident" id="3541980">k</span><span class="op" id="3541981">+</span><span class="num" id="3541982">0</span><span class="op" id="3541983">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3541986">s1</span>&nbsp;<span class="op" id="3541989">^=</span>&nbsp;<span class="ident" id="3541992">xk</span><span class="op" id="3541994">[</span><span class="ident" id="3541995">k</span><span class="op" id="3541996">+</span><span class="num" id="3541997">1</span><span class="op" id="3541998">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542001">s2</span>&nbsp;<span class="op" id="3542004">^=</span>&nbsp;<span class="ident" id="3542007">xk</span><span class="op" id="3542009">[</span><span class="ident" id="3542010">k</span><span class="op" id="3542011">+</span><span class="num" id="3542012">2</span><span class="op" id="3542013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542016">s3</span>&nbsp;<span class="op" id="3542019">^=</span>&nbsp;<span class="ident" id="3542022">xk</span><span class="op" id="3542024">[</span><span class="ident" id="3542025">k</span><span class="op" id="3542026">+</span><span class="num" id="3542027">3</span><span class="op" id="3542028">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542032">dst</span><span class="op" id="3542035">[</span><span class="num" id="3542036">0</span><span class="op" id="3542037">]</span><span class="op" id="3542038">,</span>&nbsp;<span class="ident" id="3542040">dst</span><span class="op" id="3542043">[</span><span class="num" id="3542044">1</span><span class="op" id="3542045">]</span><span class="op" id="3542046">,</span>&nbsp;<span class="ident" id="3542048">dst</span><span class="op" id="3542051">[</span><span class="num" id="3542052">2</span><span class="op" id="3542053">]</span><span class="op" id="3542054">,</span>&nbsp;<span class="ident" id="3542056">dst</span><span class="op" id="3542059">[</span><span class="num" id="3542060">3</span><span class="op" id="3542061">]</span>&nbsp;<span class="op" id="3542063">=</span>&nbsp;<span class="builtintype" id="3542065">byte</span><span class="op" id="3542069">(</span><span class="ident" id="3542070">s0</span><span class="op" id="3542072">&gt;&gt;</span><span class="num" id="3542074">24</span><span class="op" id="3542076">)</span><span class="op" id="3542077">,</span>&nbsp;<span class="builtintype" id="3542079">byte</span><span class="op" id="3542083">(</span><span class="ident" id="3542084">s0</span><span class="op" id="3542086">&gt;&gt;</span><span class="num" id="3542088">16</span><span class="op" id="3542090">)</span><span class="op" id="3542091">,</span>&nbsp;<span class="builtintype" id="3542093">byte</span><span class="op" id="3542097">(</span><span class="ident" id="3542098">s0</span><span class="op" id="3542100">&gt;&gt;</span><span class="num" id="3542102">8</span><span class="op" id="3542103">)</span><span class="op" id="3542104">,</span>&nbsp;<span class="builtintype" id="3542106">byte</span><span class="op" id="3542110">(</span><span class="ident" id="3542111">s0</span><span class="op" id="3542113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542116">dst</span><span class="op" id="3542119">[</span><span class="num" id="3542120">4</span><span class="op" id="3542121">]</span><span class="op" id="3542122">,</span>&nbsp;<span class="ident" id="3542124">dst</span><span class="op" id="3542127">[</span><span class="num" id="3542128">5</span><span class="op" id="3542129">]</span><span class="op" id="3542130">,</span>&nbsp;<span class="ident" id="3542132">dst</span><span class="op" id="3542135">[</span><span class="num" id="3542136">6</span><span class="op" id="3542137">]</span><span class="op" id="3542138">,</span>&nbsp;<span class="ident" id="3542140">dst</span><span class="op" id="3542143">[</span><span class="num" id="3542144">7</span><span class="op" id="3542145">]</span>&nbsp;<span class="op" id="3542147">=</span>&nbsp;<span class="builtintype" id="3542149">byte</span><span class="op" id="3542153">(</span><span class="ident" id="3542154">s1</span><span class="op" id="3542156">&gt;&gt;</span><span class="num" id="3542158">24</span><span class="op" id="3542160">)</span><span class="op" id="3542161">,</span>&nbsp;<span class="builtintype" id="3542163">byte</span><span class="op" id="3542167">(</span><span class="ident" id="3542168">s1</span><span class="op" id="3542170">&gt;&gt;</span><span class="num" id="3542172">16</span><span class="op" id="3542174">)</span><span class="op" id="3542175">,</span>&nbsp;<span class="builtintype" id="3542177">byte</span><span class="op" id="3542181">(</span><span class="ident" id="3542182">s1</span><span class="op" id="3542184">&gt;&gt;</span><span class="num" id="3542186">8</span><span class="op" id="3542187">)</span><span class="op" id="3542188">,</span>&nbsp;<span class="builtintype" id="3542190">byte</span><span class="op" id="3542194">(</span><span class="ident" id="3542195">s1</span><span class="op" id="3542197">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542200">dst</span><span class="op" id="3542203">[</span><span class="num" id="3542204">8</span><span class="op" id="3542205">]</span><span class="op" id="3542206">,</span>&nbsp;<span class="ident" id="3542208">dst</span><span class="op" id="3542211">[</span><span class="num" id="3542212">9</span><span class="op" id="3542213">]</span><span class="op" id="3542214">,</span>&nbsp;<span class="ident" id="3542216">dst</span><span class="op" id="3542219">[</span><span class="num" id="3542220">10</span><span class="op" id="3542222">]</span><span class="op" id="3542223">,</span>&nbsp;<span class="ident" id="3542225">dst</span><span class="op" id="3542228">[</span><span class="num" id="3542229">11</span><span class="op" id="3542231">]</span>&nbsp;<span class="op" id="3542233">=</span>&nbsp;<span class="builtintype" id="3542235">byte</span><span class="op" id="3542239">(</span><span class="ident" id="3542240">s2</span><span class="op" id="3542242">&gt;&gt;</span><span class="num" id="3542244">24</span><span class="op" id="3542246">)</span><span class="op" id="3542247">,</span>&nbsp;<span class="builtintype" id="3542249">byte</span><span class="op" id="3542253">(</span><span class="ident" id="3542254">s2</span><span class="op" id="3542256">&gt;&gt;</span><span class="num" id="3542258">16</span><span class="op" id="3542260">)</span><span class="op" id="3542261">,</span>&nbsp;<span class="builtintype" id="3542263">byte</span><span class="op" id="3542267">(</span><span class="ident" id="3542268">s2</span><span class="op" id="3542270">&gt;&gt;</span><span class="num" id="3542272">8</span><span class="op" id="3542273">)</span><span class="op" id="3542274">,</span>&nbsp;<span class="builtintype" id="3542276">byte</span><span class="op" id="3542280">(</span><span class="ident" id="3542281">s2</span><span class="op" id="3542283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542286">dst</span><span class="op" id="3542289">[</span><span class="num" id="3542290">12</span><span class="op" id="3542292">]</span><span class="op" id="3542293">,</span>&nbsp;<span class="ident" id="3542295">dst</span><span class="op" id="3542298">[</span><span class="num" id="3542299">13</span><span class="op" id="3542301">]</span><span class="op" id="3542302">,</span>&nbsp;<span class="ident" id="3542304">dst</span><span class="op" id="3542307">[</span><span class="num" id="3542308">14</span><span class="op" id="3542310">]</span><span class="op" id="3542311">,</span>&nbsp;<span class="ident" id="3542313">dst</span><span class="op" id="3542316">[</span><span class="num" id="3542317">15</span><span class="op" id="3542319">]</span>&nbsp;<span class="op" id="3542321">=</span>&nbsp;<span class="builtintype" id="3542323">byte</span><span class="op" id="3542327">(</span><span class="ident" id="3542328">s3</span><span class="op" id="3542330">&gt;&gt;</span><span class="num" id="3542332">24</span><span class="op" id="3542334">)</span><span class="op" id="3542335">,</span>&nbsp;<span class="builtintype" id="3542337">byte</span><span class="op" id="3542341">(</span><span class="ident" id="3542342">s3</span><span class="op" id="3542344">&gt;&gt;</span><span class="num" id="3542346">16</span><span class="op" id="3542348">)</span><span class="op" id="3542349">,</span>&nbsp;<span class="builtintype" id="3542351">byte</span><span class="op" id="3542355">(</span><span class="ident" id="3542356">s3</span><span class="op" id="3542358">&gt;&gt;</span><span class="num" id="3542360">8</span><span class="op" id="3542361">)</span><span class="op" id="3542362">,</span>&nbsp;<span class="builtintype" id="3542364">byte</span><span class="op" id="3542368">(</span><span class="ident" id="3542369">s3</span><span class="op" id="3542371">)</span><br>
<span class="lineno"></span><span class="op" id="3542373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3542376">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="3542410">func</span>&nbsp;<span class="ident" id="3542415">subw</span><span class="op" id="3542419">(</span><span class="ident" id="3542420">w</span>&nbsp;<span class="builtintype" id="3542422">uint32</span><span class="op" id="3542428">)</span>&nbsp;<span class="builtintype" id="3542430">uint32</span>&nbsp;<span class="op" id="3542437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3542440">return</span>&nbsp;<span class="builtintype" id="3542447">uint32</span><span class="op" id="3542453">(</span><span class="ident" id="3542454">sbox0</span><span class="op" id="3542459">[</span><span class="ident" id="3542460">w</span><span class="op" id="3542461">&gt;&gt;</span><span class="num" id="3542463">24</span><span class="op" id="3542465">]</span><span class="op" id="3542466">)</span><span class="op" id="3542467">&lt;&lt;</span><span class="num" id="3542469">24</span>&nbsp;<span class="op" id="3542472">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542476">uint32</span><span class="op" id="3542482">(</span><span class="ident" id="3542483">sbox0</span><span class="op" id="3542488">[</span><span class="ident" id="3542489">w</span><span class="op" id="3542490">&gt;&gt;</span><span class="num" id="3542492">16</span><span class="op" id="3542494">&amp;</span><span class="num" id="3542495">0xff</span><span class="op" id="3542499">]</span><span class="op" id="3542500">)</span><span class="op" id="3542501">&lt;&lt;</span><span class="num" id="3542503">16</span>&nbsp;<span class="op" id="3542506">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542510">uint32</span><span class="op" id="3542516">(</span><span class="ident" id="3542517">sbox0</span><span class="op" id="3542522">[</span><span class="ident" id="3542523">w</span><span class="op" id="3542524">&gt;&gt;</span><span class="num" id="3542526">8</span><span class="op" id="3542527">&amp;</span><span class="num" id="3542528">0xff</span><span class="op" id="3542532">]</span><span class="op" id="3542533">)</span><span class="op" id="3542534">&lt;&lt;</span><span class="num" id="3542536">8</span>&nbsp;<span class="op" id="3542538">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3542542">uint32</span><span class="op" id="3542548">(</span><span class="ident" id="3542549">sbox0</span><span class="op" id="3542554">[</span><span class="ident" id="3542555">w</span><span class="op" id="3542556">&amp;</span><span class="num" id="3542557">0xff</span><span class="op" id="3542561">]</span><span class="op" id="3542562">)</span><br>
<span class="lineno">135</span><span class="op" id="3542564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3542567">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="3542577">func</span>&nbsp;<span class="ident" id="3542582">rotw</span><span class="op" id="3542586">(</span><span class="ident" id="3542587">w</span>&nbsp;<span class="builtintype" id="3542589">uint32</span><span class="op" id="3542595">)</span>&nbsp;<span class="builtintype" id="3542597">uint32</span>&nbsp;<span class="op" id="3542604">{</span>&nbsp;<span class="keyword" id="3542606">return</span>&nbsp;<span class="ident" id="3542613">w</span><span class="op" id="3542614">&lt;&lt;</span><span class="num" id="3542616">8</span>&nbsp;<span class="op" id="3542618">|</span>&nbsp;<span class="ident" id="3542620">w</span><span class="op" id="3542621">&gt;&gt;</span><span class="num" id="3542623">24</span>&nbsp;<span class="op" id="3542626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3542629">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="3542683">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="3542724">func</span>&nbsp;<span class="ident" id="3542729">expandKeyGo</span><span class="op" id="3542740">(</span><span class="ident" id="3542741">key</span>&nbsp;<span class="op" id="3542745">[</span><span class="op" id="3542746">]</span><span class="builtintype" id="3542747">byte</span><span class="op" id="3542751">,</span>&nbsp;<span class="ident" id="3542753">enc</span><span class="op" id="3542756">,</span>&nbsp;<span class="ident" id="3542758">dec</span>&nbsp;<span class="op" id="3542762">[</span><span class="op" id="3542763">]</span><span class="builtintype" id="3542764">uint32</span><span class="op" id="3542770">)</span>&nbsp;<span class="op" id="3542772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3542775">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3542801">var</span>&nbsp;<span class="ident" id="3542805">i</span>&nbsp;<span class="builtintype" id="3542807">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542812">nk</span>&nbsp;<span class="op" id="3542815">:=</span>&nbsp;<span class="builtinfunc" id="3542818">len</span><span class="op" id="3542821">(</span><span class="ident" id="3542822">key</span><span class="op" id="3542825">)</span>&nbsp;<span class="op" id="3542827">/</span>&nbsp;<span class="num" id="3542829">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3542832">for</span>&nbsp;<span class="ident" id="3542836">i</span>&nbsp;<span class="op" id="3542838">=</span>&nbsp;<span class="num" id="3542840">0</span><span class="op" id="3542841">;</span>&nbsp;<span class="ident" id="3542843">i</span>&nbsp;<span class="op" id="3542845">&lt;</span>&nbsp;<span class="ident" id="3542847">nk</span><span class="op" id="3542849">;</span>&nbsp;<span class="ident" id="3542851">i</span><span class="op" id="3542852">++</span>&nbsp;<span class="op" id="3542855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542859">enc</span><span class="op" id="3542862">[</span><span class="ident" id="3542863">i</span><span class="op" id="3542864">]</span>&nbsp;<span class="op" id="3542866">=</span>&nbsp;<span class="builtintype" id="3542868">uint32</span><span class="op" id="3542874">(</span><span class="ident" id="3542875">key</span><span class="op" id="3542878">[</span><span class="num" id="3542879">4</span><span class="op" id="3542880">*</span><span class="ident" id="3542881">i</span><span class="op" id="3542882">]</span><span class="op" id="3542883">)</span><span class="op" id="3542884">&lt;&lt;</span><span class="num" id="3542886">24</span>&nbsp;<span class="op" id="3542889">|</span>&nbsp;<span class="builtintype" id="3542891">uint32</span><span class="op" id="3542897">(</span><span class="ident" id="3542898">key</span><span class="op" id="3542901">[</span><span class="num" id="3542902">4</span><span class="op" id="3542903">*</span><span class="ident" id="3542904">i</span><span class="op" id="3542905">+</span><span class="num" id="3542906">1</span><span class="op" id="3542907">]</span><span class="op" id="3542908">)</span><span class="op" id="3542909">&lt;&lt;</span><span class="num" id="3542911">16</span>&nbsp;<span class="op" id="3542914">|</span>&nbsp;<span class="builtintype" id="3542916">uint32</span><span class="op" id="3542922">(</span><span class="ident" id="3542923">key</span><span class="op" id="3542926">[</span><span class="num" id="3542927">4</span><span class="op" id="3542928">*</span><span class="ident" id="3542929">i</span><span class="op" id="3542930">+</span><span class="num" id="3542931">2</span><span class="op" id="3542932">]</span><span class="op" id="3542933">)</span><span class="op" id="3542934">&lt;&lt;</span><span class="num" id="3542936">8</span>&nbsp;<span class="op" id="3542938">|</span>&nbsp;<span class="builtintype" id="3542940">uint32</span><span class="op" id="3542946">(</span><span class="ident" id="3542947">key</span><span class="op" id="3542950">[</span><span class="num" id="3542951">4</span><span class="op" id="3542952">*</span><span class="ident" id="3542953">i</span><span class="op" id="3542954">+</span><span class="num" id="3542955">3</span><span class="op" id="3542956">]</span><span class="op" id="3542957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3542960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3542963">for</span>&nbsp;<span class="op" id="3542967">;</span>&nbsp;<span class="ident" id="3542969">i</span>&nbsp;<span class="op" id="3542971">&lt;</span>&nbsp;<span class="builtinfunc" id="3542973">len</span><span class="op" id="3542976">(</span><span class="ident" id="3542977">enc</span><span class="op" id="3542980">)</span><span class="op" id="3542981">;</span>&nbsp;<span class="ident" id="3542983">i</span><span class="op" id="3542984">++</span>&nbsp;<span class="op" id="3542987">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3542991">t</span>&nbsp;<span class="op" id="3542993">:=</span>&nbsp;<span class="ident" id="3542996">enc</span><span class="op" id="3542999">[</span><span class="ident" id="3543000">i</span><span class="op" id="3543001">-</span><span class="num" id="3543002">1</span><span class="op" id="3543003">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3543007">if</span>&nbsp;<span class="ident" id="3543010">i</span><span class="op" id="3543011">%</span><span class="ident" id="3543012">nk</span>&nbsp;<span class="op" id="3543015">==</span>&nbsp;<span class="num" id="3543018">0</span>&nbsp;<span class="op" id="3543020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543025">t</span>&nbsp;<span class="op" id="3543027">=</span>&nbsp;<span class="ident" id="3543029">subw</span><span class="op" id="3543033">(</span><span class="ident" id="3543034">rotw</span><span class="op" id="3543038">(</span><span class="ident" id="3543039">t</span><span class="op" id="3543040">)</span><span class="op" id="3543041">)</span>&nbsp;<span class="op" id="3543043">^</span>&nbsp;<span class="op" id="3543045">(</span><span class="builtintype" id="3543046">uint32</span><span class="op" id="3543052">(</span><span class="ident" id="3543053">powx</span><span class="op" id="3543057">[</span><span class="ident" id="3543058">i</span><span class="op" id="3543059">/</span><span class="ident" id="3543060">nk</span><span class="op" id="3543062">-</span><span class="num" id="3543063">1</span><span class="op" id="3543064">]</span><span class="op" id="3543065">)</span>&nbsp;<span class="op" id="3543067">&lt;&lt;</span>&nbsp;<span class="num" id="3543070">24</span><span class="op" id="3543072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543076">}</span>&nbsp;<span class="keyword" id="3543078">else</span>&nbsp;<span class="keyword" id="3543083">if</span>&nbsp;<span class="ident" id="3543086">nk</span>&nbsp;<span class="op" id="3543089">&gt;</span>&nbsp;<span class="num" id="3543091">6</span>&nbsp;<span class="op" id="3543093">&amp;&amp;</span>&nbsp;<span class="ident" id="3543096">i</span><span class="op" id="3543097">%</span><span class="ident" id="3543098">nk</span>&nbsp;<span class="op" id="3543101">==</span>&nbsp;<span class="num" id="3543104">4</span>&nbsp;<span class="op" id="3543106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543111">t</span>&nbsp;<span class="op" id="3543113">=</span>&nbsp;<span class="ident" id="3543115">subw</span><span class="op" id="3543119">(</span><span class="ident" id="3543120">t</span><span class="op" id="3543121">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543129">enc</span><span class="op" id="3543132">[</span><span class="ident" id="3543133">i</span><span class="op" id="3543134">]</span>&nbsp;<span class="op" id="3543136">=</span>&nbsp;<span class="ident" id="3543138">enc</span><span class="op" id="3543141">[</span><span class="ident" id="3543142">i</span><span class="op" id="3543143">-</span><span class="ident" id="3543144">nk</span><span class="op" id="3543146">]</span>&nbsp;<span class="op" id="3543148">^</span>&nbsp;<span class="ident" id="3543150">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543157">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543204">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3543267">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3543340">if</span>&nbsp;<span class="ident" id="3543343">dec</span>&nbsp;<span class="op" id="3543347">==</span>&nbsp;<span class="builtintype" id="3543350">nil</span>&nbsp;<span class="op" id="3543354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3543358">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543366">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543369">n</span>&nbsp;<span class="op" id="3543371">:=</span>&nbsp;<span class="builtinfunc" id="3543374">len</span><span class="op" id="3543377">(</span><span class="ident" id="3543378">enc</span><span class="op" id="3543381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3543384">for</span>&nbsp;<span class="ident" id="3543388">i</span>&nbsp;<span class="op" id="3543390">:=</span>&nbsp;<span class="num" id="3543393">0</span><span class="op" id="3543394">;</span>&nbsp;<span class="ident" id="3543396">i</span>&nbsp;<span class="op" id="3543398">&lt;</span>&nbsp;<span class="ident" id="3543400">n</span><span class="op" id="3543401">;</span>&nbsp;<span class="ident" id="3543403">i</span>&nbsp;<span class="op" id="3543405">+=</span>&nbsp;<span class="num" id="3543408">4</span>&nbsp;<span class="op" id="3543410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543414">ei</span>&nbsp;<span class="op" id="3543417">:=</span>&nbsp;<span class="ident" id="3543420">n</span>&nbsp;<span class="op" id="3543422">-</span>&nbsp;<span class="ident" id="3543424">i</span>&nbsp;<span class="op" id="3543426">-</span>&nbsp;<span class="num" id="3543428">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3543432">for</span>&nbsp;<span class="ident" id="3543436">j</span>&nbsp;<span class="op" id="3543438">:=</span>&nbsp;<span class="num" id="3543441">0</span><span class="op" id="3543442">;</span>&nbsp;<span class="ident" id="3543444">j</span>&nbsp;<span class="op" id="3543446">&lt;</span>&nbsp;<span class="num" id="3543448">4</span><span class="op" id="3543449">;</span>&nbsp;<span class="ident" id="3543451">j</span><span class="op" id="3543452">++</span>&nbsp;<span class="op" id="3543455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543460">x</span>&nbsp;<span class="op" id="3543462">:=</span>&nbsp;<span class="ident" id="3543465">enc</span><span class="op" id="3543468">[</span><span class="ident" id="3543469">ei</span><span class="op" id="3543471">+</span><span class="ident" id="3543472">j</span><span class="op" id="3543473">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3543478">if</span>&nbsp;<span class="ident" id="3543481">i</span>&nbsp;<span class="op" id="3543483">&gt;</span>&nbsp;<span class="num" id="3543485">0</span>&nbsp;<span class="op" id="3543487">&amp;&amp;</span>&nbsp;<span class="ident" id="3543490">i</span><span class="op" id="3543491">+</span><span class="num" id="3543492">4</span>&nbsp;<span class="op" id="3543494">&lt;</span>&nbsp;<span class="ident" id="3543496">n</span>&nbsp;<span class="op" id="3543498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543504">x</span>&nbsp;<span class="op" id="3543506">=</span>&nbsp;<span class="ident" id="3543508">td0</span><span class="op" id="3543511">[</span><span class="ident" id="3543512">sbox0</span><span class="op" id="3543517">[</span><span class="ident" id="3543518">x</span><span class="op" id="3543519">&gt;&gt;</span><span class="num" id="3543521">24</span><span class="op" id="3543523">]</span><span class="op" id="3543524">]</span>&nbsp;<span class="op" id="3543526">^</span>&nbsp;<span class="ident" id="3543528">td1</span><span class="op" id="3543531">[</span><span class="ident" id="3543532">sbox0</span><span class="op" id="3543537">[</span><span class="ident" id="3543538">x</span><span class="op" id="3543539">&gt;&gt;</span><span class="num" id="3543541">16</span><span class="op" id="3543543">&amp;</span><span class="num" id="3543544">0xff</span><span class="op" id="3543548">]</span><span class="op" id="3543549">]</span>&nbsp;<span class="op" id="3543551">^</span>&nbsp;<span class="ident" id="3543553">td2</span><span class="op" id="3543556">[</span><span class="ident" id="3543557">sbox0</span><span class="op" id="3543562">[</span><span class="ident" id="3543563">x</span><span class="op" id="3543564">&gt;&gt;</span><span class="num" id="3543566">8</span><span class="op" id="3543567">&amp;</span><span class="num" id="3543568">0xff</span><span class="op" id="3543572">]</span><span class="op" id="3543573">]</span>&nbsp;<span class="op" id="3543575">^</span>&nbsp;<span class="ident" id="3543577">td3</span><span class="op" id="3543580">[</span><span class="ident" id="3543581">sbox0</span><span class="op" id="3543586">[</span><span class="ident" id="3543587">x</span><span class="op" id="3543588">&amp;</span><span class="num" id="3543589">0xff</span><span class="op" id="3543593">]</span><span class="op" id="3543594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3543604">dec</span><span class="op" id="3543607">[</span><span class="ident" id="3543608">i</span><span class="op" id="3543609">+</span><span class="ident" id="3543610">j</span><span class="op" id="3543611">]</span>&nbsp;<span class="op" id="3543613">=</span>&nbsp;<span class="ident" id="3543615">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543619">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3543622">}</span><br>
<span class="lineno"></span><span class="op" id="3543624">}</span>
</div>
</body>
</html>
