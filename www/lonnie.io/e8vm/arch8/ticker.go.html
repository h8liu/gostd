<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4887640">package</span>&nbsp;<span class="ident" id="4887648">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4887655">import</span>&nbsp;<span class="op" id="4887662">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4887665">&#34;math/rand&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4887678">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4887685">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887688">//&nbsp;Ticker&nbsp;is&nbsp;a&nbsp;device&nbsp;that&nbsp;generates&nbsp;time&nbsp;interrupts.</span><br>
<span class="lineno"></span><span class="keyword" id="4887742">type</span>&nbsp;<span class="ident" id="4887747">ticker</span>&nbsp;<span class="keyword" id="4887754">struct</span>&nbsp;<span class="op" id="4887761">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887764">intBus</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4887773">intBus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887781">nextTick</span>&nbsp;<span class="builtintype" id="4887790">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887798">Interval</span>&nbsp;<span class="builtintype" id="4887807">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887814">Noise</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4887823">int32</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887830">Rand</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4887839">*</span><span class="ident" id="4887840">rand</span><span class="op" id="4887844">.</span><span class="ident" id="4887845">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887851">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4887860">byte</span><br>
<span class="lineno"></span><span class="op" id="4887865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887868">//&nbsp;NewTicker&nbsp;creates&nbsp;a&nbsp;new&nbsp;time&nbsp;interrupt&nbsp;generator.</span><br>
<span class="lineno">20</span><span class="keyword" id="4887921">func</span>&nbsp;<span class="ident" id="4887926">newTicker</span><span class="op" id="4887935">(</span><span class="ident" id="4887936">bus</span>&nbsp;<span class="ident" id="4887940">intBus</span><span class="op" id="4887946">)</span>&nbsp;<span class="op" id="4887948">*</span><span class="ident" id="4887949">ticker</span>&nbsp;<span class="op" id="4887956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887959">ret</span>&nbsp;<span class="op" id="4887963">:=</span>&nbsp;<span class="builtinfunc" id="4887966">new</span><span class="op" id="4887969">(</span><span class="ident" id="4887970">ticker</span><span class="op" id="4887976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887979">ret</span><span class="op" id="4887982">.</span><span class="ident" id="4887983">intBus</span>&nbsp;<span class="op" id="4887990">=</span>&nbsp;<span class="ident" id="4887992">bus</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887998">ret</span><span class="op" id="4888001">.</span><span class="ident" id="4888002">Interval</span>&nbsp;<span class="op" id="4888011">=</span>&nbsp;<span class="num" id="4888013">1000</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888019">ret</span><span class="op" id="4888022">.</span><span class="ident" id="4888023">Noise</span>&nbsp;<span class="op" id="4888029">=</span>&nbsp;<span class="num" id="4888031">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888035">ret</span><span class="op" id="4888038">.</span><span class="ident" id="4888039">Rand</span>&nbsp;<span class="op" id="4888044">=</span>&nbsp;<span class="ident" id="4888046">rand</span><span class="op" id="4888050">.</span><span class="ident" id="4888051">New</span><span class="op" id="4888054">(</span><span class="ident" id="4888055">rand</span><span class="op" id="4888059">.</span><span class="ident" id="4888060">NewSource</span><span class="op" id="4888069">(</span><span class="ident" id="4888070">time</span><span class="op" id="4888074">.</span><span class="ident" id="4888075">Now</span><span class="op" id="4888078">(</span><span class="op" id="4888079">)</span><span class="op" id="4888080">.</span><span class="ident" id="4888081">UnixNano</span><span class="op" id="4888089">(</span><span class="op" id="4888090">)</span><span class="op" id="4888091">)</span><span class="op" id="4888092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888095">ret</span><span class="op" id="4888098">.</span><span class="ident" id="4888099">Code</span>&nbsp;<span class="op" id="4888104">=</span>&nbsp;<span class="num" id="4888106">2</span>&nbsp;<span class="comment" id="4888108">//&nbsp;time&nbsp;interrupt&nbsp;code</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888133">ret</span><span class="op" id="4888136">.</span><span class="ident" id="4888137">reset</span><span class="op" id="4888142">(</span><span class="op" id="4888143">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888147">return</span>&nbsp;<span class="ident" id="4888154">ret</span><br>
<span class="lineno"></span><span class="op" id="4888158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4888161">func</span>&nbsp;<span class="op" id="4888166">(</span><span class="ident" id="4888167">t</span>&nbsp;<span class="op" id="4888169">*</span><span class="ident" id="4888170">ticker</span><span class="op" id="4888176">)</span>&nbsp;<span class="ident" id="4888178">reset</span><span class="op" id="4888183">(</span><span class="op" id="4888184">)</span>&nbsp;<span class="op" id="4888186">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888189">if</span>&nbsp;<span class="ident" id="4888192">t</span><span class="op" id="4888193">.</span><span class="ident" id="4888194">Noise</span>&nbsp;<span class="op" id="4888200">&lt;</span>&nbsp;<span class="num" id="4888202">0</span>&nbsp;<span class="op" id="4888204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4888208">panic</span><span class="op" id="4888213">(</span><span class="string" id="4888214">&#34;negative&nbsp;ticker&nbsp;noise&#34;</span><span class="op" id="4888237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888243">if</span>&nbsp;<span class="ident" id="4888246">t</span><span class="op" id="4888247">.</span><span class="ident" id="4888248">Interval</span>&nbsp;<span class="op" id="4888257">&lt;</span>&nbsp;<span class="num" id="4888259">0</span>&nbsp;<span class="op" id="4888261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4888265">panic</span><span class="op" id="4888270">(</span><span class="string" id="4888271">&#34;negative&nbsp;ticker&nbsp;interval&#34;</span><span class="op" id="4888297">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888304">noise</span>&nbsp;<span class="op" id="4888310">:=</span>&nbsp;<span class="builtintype" id="4888313">int32</span><span class="op" id="4888318">(</span><span class="num" id="4888319">0</span><span class="op" id="4888320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888323">if</span>&nbsp;<span class="ident" id="4888326">t</span><span class="op" id="4888327">.</span><span class="ident" id="4888328">Noise</span>&nbsp;<span class="op" id="4888334">&gt;</span>&nbsp;<span class="num" id="4888336">0</span>&nbsp;<span class="op" id="4888338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888342">noise</span>&nbsp;<span class="op" id="4888348">=</span>&nbsp;<span class="ident" id="4888350">t</span><span class="op" id="4888351">.</span><span class="ident" id="4888352">Rand</span><span class="op" id="4888356">.</span><span class="ident" id="4888357">Int31n</span><span class="op" id="4888363">(</span><span class="ident" id="4888364">t</span><span class="op" id="4888365">.</span><span class="ident" id="4888366">Noise</span><span class="op" id="4888371">)</span>&nbsp;<span class="op" id="4888373">-</span>&nbsp;<span class="ident" id="4888375">t</span><span class="op" id="4888376">.</span><span class="ident" id="4888377">Noise</span><span class="op" id="4888382">/</span><span class="num" id="4888383">2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888390">next</span>&nbsp;<span class="op" id="4888395">:=</span>&nbsp;<span class="ident" id="4888398">t</span><span class="op" id="4888399">.</span><span class="ident" id="4888400">Interval</span>&nbsp;<span class="op" id="4888409">+</span>&nbsp;<span class="ident" id="4888411">noise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888418">if</span>&nbsp;<span class="ident" id="4888421">next</span>&nbsp;<span class="op" id="4888426">&lt;</span>&nbsp;<span class="num" id="4888428">0</span>&nbsp;<span class="op" id="4888430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888434">next</span>&nbsp;<span class="op" id="4888439">=</span>&nbsp;<span class="num" id="4888441">0</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888448">t</span><span class="op" id="4888449">.</span><span class="ident" id="4888450">nextTick</span>&nbsp;<span class="op" id="4888459">=</span>&nbsp;<span class="ident" id="4888461">next</span><br>
<span class="lineno"></span><span class="op" id="4888466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4888469">//&nbsp;Tick&nbsp;decreases&nbsp;the&nbsp;ticking&nbsp;counter.&nbsp;If&nbsp;the&nbsp;counter&nbsp;reaches&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="4888534">//&nbsp;it&nbsp;will&nbsp;issue&nbsp;interrupts&nbsp;to&nbsp;all&nbsp;cores&nbsp;and&nbsp;reset&nbsp;the&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="4888598">func</span>&nbsp;<span class="op" id="4888603">(</span><span class="ident" id="4888604">t</span>&nbsp;<span class="op" id="4888606">*</span><span class="ident" id="4888607">ticker</span><span class="op" id="4888613">)</span>&nbsp;<span class="ident" id="4888615">Tick</span><span class="op" id="4888619">(</span><span class="op" id="4888620">)</span>&nbsp;<span class="op" id="4888622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888625">if</span>&nbsp;<span class="ident" id="4888628">t</span><span class="op" id="4888629">.</span><span class="ident" id="4888630">nextTick</span>&nbsp;<span class="op" id="4888639">&lt;</span>&nbsp;<span class="num" id="4888641">0</span>&nbsp;<span class="op" id="4888643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4888647">panic</span><span class="op" id="4888652">(</span><span class="string" id="4888653">&#34;bug&#34;</span><span class="op" id="4888658">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888665">if</span>&nbsp;<span class="ident" id="4888668">t</span><span class="op" id="4888669">.</span><span class="ident" id="4888670">nextTick</span>&nbsp;<span class="op" id="4888679">==</span>&nbsp;<span class="num" id="4888682">0</span>&nbsp;<span class="op" id="4888684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888688">intAllCores</span><span class="op" id="4888699">(</span><span class="ident" id="4888700">t</span><span class="op" id="4888701">.</span><span class="ident" id="4888702">intBus</span><span class="op" id="4888708">,</span>&nbsp;<span class="ident" id="4888710">t</span><span class="op" id="4888711">.</span><span class="ident" id="4888712">Code</span><span class="op" id="4888716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888720">t</span><span class="op" id="4888721">.</span><span class="ident" id="4888722">reset</span><span class="op" id="4888727">(</span><span class="op" id="4888728">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888731">}</span>&nbsp;<span class="keyword" id="4888733">else</span>&nbsp;<span class="op" id="4888738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888742">t</span><span class="op" id="4888743">.</span><span class="ident" id="4888744">nextTick</span><span class="op" id="4888752">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888756">}</span><br>
<span class="lineno"></span><span class="op" id="4888758">}</span>
</div>
</body>
</html>
