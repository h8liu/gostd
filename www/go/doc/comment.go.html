<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6208587">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6208642">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6208696">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6208747">//&nbsp;Godoc&nbsp;comment&nbsp;extraction&nbsp;and&nbsp;comment&nbsp;-&gt;&nbsp;HTML&nbsp;formatting.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6208808">package</span>&nbsp;<span class="ident" id="6208816">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6208821">import</span>&nbsp;<span class="op" id="6208828">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208831">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208837">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208847">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208858">&#34;text/template&#34;</span>&nbsp;<span class="comment" id="6208874">//&nbsp;for&nbsp;HTMLEscape</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208893">&#34;unicode&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6208904">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="6208919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6208922">var</span>&nbsp;<span class="op" id="6208926">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208929">ldquo</span>&nbsp;<span class="op" id="6208935">=</span>&nbsp;<span class="op" id="6208937">[</span><span class="op" id="6208938">]</span><span class="builtintype" id="6208939">byte</span><span class="op" id="6208943">(</span><span class="string" id="6208944">&#34;&amp;ldquo;&#34;</span><span class="op" id="6208953">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6208956">rdquo</span>&nbsp;<span class="op" id="6208962">=</span>&nbsp;<span class="op" id="6208964">[</span><span class="op" id="6208965">]</span><span class="builtintype" id="6208966">byte</span><span class="op" id="6208970">(</span><span class="string" id="6208971">&#34;&amp;rdquo;&#34;</span><span class="op" id="6208980">)</span><br>
<span class="lineno"></span><span class="op" id="6208982">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6208985">//&nbsp;Escape&nbsp;comment&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,</span><br>
<span class="lineno"></span><span class="comment" id="6209034">//&nbsp;also&nbsp;turn&nbsp;``&nbsp;into&nbsp;&amp;ldquo;&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;.</span><br>
<span class="lineno">25</span><span class="keyword" id="6209084">func</span>&nbsp;<span class="ident" id="6209089">commentEscape</span><span class="op" id="6209102">(</span><span class="ident" id="6209103">w</span>&nbsp;<span class="ident" id="6209105">io</span><span class="op" id="6209107">.</span><span class="ident" id="6209108">Writer</span><span class="op" id="6209114">,</span>&nbsp;<span class="ident" id="6209116">text</span>&nbsp;<span class="builtintype" id="6209121">string</span><span class="op" id="6209127">,</span>&nbsp;<span class="ident" id="6209129">nice</span>&nbsp;<span class="builtintype" id="6209134">bool</span><span class="op" id="6209138">)</span>&nbsp;<span class="op" id="6209140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209143">last</span>&nbsp;<span class="op" id="6209148">:=</span>&nbsp;<span class="num" id="6209151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209154">if</span>&nbsp;<span class="ident" id="6209157">nice</span>&nbsp;<span class="op" id="6209162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209166">for</span>&nbsp;<span class="ident" id="6209170">i</span>&nbsp;<span class="op" id="6209172">:=</span>&nbsp;<span class="num" id="6209175">0</span><span class="op" id="6209176">;</span>&nbsp;<span class="ident" id="6209178">i</span>&nbsp;<span class="op" id="6209180">&lt;</span>&nbsp;<span class="builtinfunc" id="6209182">len</span><span class="op" id="6209185">(</span><span class="ident" id="6209186">text</span><span class="op" id="6209190">)</span><span class="op" id="6209191">-</span><span class="num" id="6209192">1</span><span class="op" id="6209193">;</span>&nbsp;<span class="ident" id="6209195">i</span><span class="op" id="6209196">++</span>&nbsp;<span class="op" id="6209199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209204">ch</span>&nbsp;<span class="op" id="6209207">:=</span>&nbsp;<span class="ident" id="6209210">text</span><span class="op" id="6209214">[</span><span class="ident" id="6209215">i</span><span class="op" id="6209216">]</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209221">if</span>&nbsp;<span class="ident" id="6209224">ch</span>&nbsp;<span class="op" id="6209227">==</span>&nbsp;<span class="ident" id="6209230">text</span><span class="op" id="6209234">[</span><span class="ident" id="6209235">i</span><span class="op" id="6209236">+</span><span class="num" id="6209237">1</span><span class="op" id="6209238">]</span>&nbsp;<span class="op" id="6209240">&amp;&amp;</span>&nbsp;<span class="op" id="6209243">(</span><span class="ident" id="6209244">ch</span>&nbsp;<span class="op" id="6209247">==</span>&nbsp;<span class="string" id="6209250">&#39;`&#39;</span>&nbsp;<span class="op" id="6209254">||</span>&nbsp;<span class="ident" id="6209257">ch</span>&nbsp;<span class="op" id="6209260">==</span>&nbsp;<span class="string" id="6209263">&#39;\&#39;&#39;</span><span class="op" id="6209267">)</span>&nbsp;<span class="op" id="6209269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209275">template</span><span class="op" id="6209283">.</span><span class="ident" id="6209284">HTMLEscape</span><span class="op" id="6209294">(</span><span class="ident" id="6209295">w</span><span class="op" id="6209296">,</span>&nbsp;<span class="op" id="6209298">[</span><span class="op" id="6209299">]</span><span class="builtintype" id="6209300">byte</span><span class="op" id="6209304">(</span><span class="ident" id="6209305">text</span><span class="op" id="6209309">[</span><span class="ident" id="6209310">last</span><span class="op" id="6209314">:</span><span class="ident" id="6209315">i</span><span class="op" id="6209316">]</span><span class="op" id="6209317">)</span><span class="op" id="6209318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209324">last</span>&nbsp;<span class="op" id="6209329">=</span>&nbsp;<span class="ident" id="6209331">i</span>&nbsp;<span class="op" id="6209333">+</span>&nbsp;<span class="num" id="6209335">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209341">switch</span>&nbsp;<span class="ident" id="6209348">ch</span>&nbsp;<span class="op" id="6209351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209357">case</span>&nbsp;<span class="string" id="6209362">&#39;`&#39;</span><span class="op" id="6209365">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209372">w</span><span class="op" id="6209373">.</span><span class="ident" id="6209374">Write</span><span class="op" id="6209379">(</span><span class="ident" id="6209380">ldquo</span><span class="op" id="6209385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6209391">case</span>&nbsp;<span class="string" id="6209396">&#39;\&#39;&#39;</span><span class="op" id="6209400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209407">w</span><span class="op" id="6209408">.</span><span class="ident" id="6209409">Write</span><span class="op" id="6209414">(</span><span class="ident" id="6209415">rdquo</span><span class="op" id="6209420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209432">i</span><span class="op" id="6209433">++</span>&nbsp;<span class="comment" id="6209436">//&nbsp;loop&nbsp;will&nbsp;add&nbsp;one&nbsp;more</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6209472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209475">template</span><span class="op" id="6209483">.</span><span class="ident" id="6209484">HTMLEscape</span><span class="op" id="6209494">(</span><span class="ident" id="6209495">w</span><span class="op" id="6209496">,</span>&nbsp;<span class="op" id="6209498">[</span><span class="op" id="6209499">]</span><span class="builtintype" id="6209500">byte</span><span class="op" id="6209504">(</span><span class="ident" id="6209505">text</span><span class="op" id="6209509">[</span><span class="ident" id="6209510">last</span><span class="op" id="6209514">:</span><span class="op" id="6209515">]</span><span class="op" id="6209516">)</span><span class="op" id="6209517">)</span><br>
<span class="lineno"></span><span class="op" id="6209519">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6209522">const</span>&nbsp;<span class="op" id="6209528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209531">//&nbsp;Regexp&nbsp;for&nbsp;Go&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209561">identRx</span>&nbsp;<span class="op" id="6209569">=</span>&nbsp;<span class="string" id="6209571">`[\pL_][\pL_0-9]*`</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6209592">//&nbsp;Regexp&nbsp;for&nbsp;URLs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209612">protocol</span>&nbsp;<span class="op" id="6209621">=</span>&nbsp;<span class="string" id="6209623">`https?|ftp|file|gopher|mailto|news|nntp|telnet|wais|prospero`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209687">hostPart</span>&nbsp;<span class="op" id="6209696">=</span>&nbsp;<span class="string" id="6209698">`[a-zA-Z0-9_@\-]+`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209718">filePart</span>&nbsp;<span class="op" id="6209727">=</span>&nbsp;<span class="string" id="6209729">`[a-zA-Z0-9_?%#~&amp;/\-+=()]+`</span>&nbsp;<span class="comment" id="6209757">//&nbsp;parentheses&nbsp;may&nbsp;not&nbsp;be&nbsp;matching;&nbsp;see&nbsp;pairedParensPrefixLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209820">urlRx</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6209829">=</span>&nbsp;<span class="string" id="6209831">`(`</span>&nbsp;<span class="op" id="6209835">+</span>&nbsp;<span class="ident" id="6209837">protocol</span>&nbsp;<span class="op" id="6209846">+</span>&nbsp;<span class="string" id="6209848">`)://`</span>&nbsp;<span class="op" id="6209855">+</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6209859">//&nbsp;http://</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209872">hostPart</span>&nbsp;<span class="op" id="6209881">+</span>&nbsp;<span class="string" id="6209883">`([.:]`</span>&nbsp;<span class="op" id="6209891">+</span>&nbsp;<span class="ident" id="6209893">hostPart</span>&nbsp;<span class="op" id="6209902">+</span>&nbsp;<span class="string" id="6209904">`)*/?`</span>&nbsp;<span class="op" id="6209911">+</span>&nbsp;<span class="comment" id="6209913">//&nbsp;//www.google.com:8080/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6209941">filePart</span>&nbsp;<span class="op" id="6209950">+</span>&nbsp;<span class="string" id="6209952">`([:.,]`</span>&nbsp;<span class="op" id="6209961">+</span>&nbsp;<span class="ident" id="6209963">filePart</span>&nbsp;<span class="op" id="6209972">+</span>&nbsp;<span class="string" id="6209974">`)*`</span><br>
<span class="lineno"></span><span class="op" id="6209979">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6209982">var</span>&nbsp;<span class="ident" id="6209986">matchRx</span>&nbsp;<span class="op" id="6209994">=</span>&nbsp;<span class="ident" id="6209996">regexp</span><span class="op" id="6210002">.</span><span class="ident" id="6210003">MustCompile</span><span class="op" id="6210014">(</span><span class="string" id="6210015">`(`</span>&nbsp;<span class="op" id="6210019">+</span>&nbsp;<span class="ident" id="6210021">urlRx</span>&nbsp;<span class="op" id="6210027">+</span>&nbsp;<span class="string" id="6210029">`)|(`</span>&nbsp;<span class="op" id="6210035">+</span>&nbsp;<span class="ident" id="6210037">identRx</span>&nbsp;<span class="op" id="6210045">+</span>&nbsp;<span class="string" id="6210047">`)`</span><span class="op" id="6210050">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6210053">var</span>&nbsp;<span class="op" id="6210057">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210060">html_a</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210072">=</span>&nbsp;<span class="op" id="6210074">[</span><span class="op" id="6210075">]</span><span class="builtintype" id="6210076">byte</span><span class="op" id="6210080">(</span><span class="string" id="6210081">`&lt;a&nbsp;href=&#34;`</span><span class="op" id="6210092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210095">html_aq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210107">=</span>&nbsp;<span class="op" id="6210109">[</span><span class="op" id="6210110">]</span><span class="builtintype" id="6210111">byte</span><span class="op" id="6210115">(</span><span class="string" id="6210116">`&#34;&gt;`</span><span class="op" id="6210120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210123">html_enda</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6210135">=</span>&nbsp;<span class="op" id="6210137">[</span><span class="op" id="6210138">]</span><span class="builtintype" id="6210139">byte</span><span class="op" id="6210143">(</span><span class="string" id="6210144">&#34;&lt;/a&gt;&#34;</span><span class="op" id="6210150">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210153">html_i</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210165">=</span>&nbsp;<span class="op" id="6210167">[</span><span class="op" id="6210168">]</span><span class="builtintype" id="6210169">byte</span><span class="op" id="6210173">(</span><span class="string" id="6210174">&#34;&lt;i&gt;&#34;</span><span class="op" id="6210179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210182">html_endi</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6210194">=</span>&nbsp;<span class="op" id="6210196">[</span><span class="op" id="6210197">]</span><span class="builtintype" id="6210198">byte</span><span class="op" id="6210202">(</span><span class="string" id="6210203">&#34;&lt;/i&gt;&#34;</span><span class="op" id="6210209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210212">html_p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210224">=</span>&nbsp;<span class="op" id="6210226">[</span><span class="op" id="6210227">]</span><span class="builtintype" id="6210228">byte</span><span class="op" id="6210232">(</span><span class="string" id="6210233">&#34;&lt;p&gt;\n&#34;</span><span class="op" id="6210240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210243">html_endp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6210255">=</span>&nbsp;<span class="op" id="6210257">[</span><span class="op" id="6210258">]</span><span class="builtintype" id="6210259">byte</span><span class="op" id="6210263">(</span><span class="string" id="6210264">&#34;&lt;/p&gt;\n&#34;</span><span class="op" id="6210272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210275">html_pre</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210287">=</span>&nbsp;<span class="op" id="6210289">[</span><span class="op" id="6210290">]</span><span class="builtintype" id="6210291">byte</span><span class="op" id="6210295">(</span><span class="string" id="6210296">&#34;&lt;pre&gt;&#34;</span><span class="op" id="6210303">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210306">html_endpre</span>&nbsp;<span class="op" id="6210318">=</span>&nbsp;<span class="op" id="6210320">[</span><span class="op" id="6210321">]</span><span class="builtintype" id="6210322">byte</span><span class="op" id="6210326">(</span><span class="string" id="6210327">&#34;&lt;/pre&gt;\n&#34;</span><span class="op" id="6210337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210340">html_h</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210352">=</span>&nbsp;<span class="op" id="6210354">[</span><span class="op" id="6210355">]</span><span class="builtintype" id="6210356">byte</span><span class="op" id="6210360">(</span><span class="string" id="6210361">`&lt;h3&nbsp;id=&#34;`</span><span class="op" id="6210371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210374">html_hq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6210386">=</span>&nbsp;<span class="op" id="6210388">[</span><span class="op" id="6210389">]</span><span class="builtintype" id="6210390">byte</span><span class="op" id="6210394">(</span><span class="string" id="6210395">`&#34;&gt;`</span><span class="op" id="6210399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210402">html_endh</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6210414">=</span>&nbsp;<span class="op" id="6210416">[</span><span class="op" id="6210417">]</span><span class="builtintype" id="6210418">byte</span><span class="op" id="6210422">(</span><span class="string" id="6210423">&#34;&lt;/h3&gt;\n&#34;</span><span class="op" id="6210432">)</span><br>
<span class="lineno"></span><span class="op" id="6210434">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="6210437">//&nbsp;pairedParensPrefixLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;longest&nbsp;prefix&nbsp;of&nbsp;s&nbsp;containing&nbsp;paired&nbsp;parentheses.</span><br>
<span class="lineno"></span><span class="keyword" id="6210539">func</span>&nbsp;<span class="ident" id="6210544">pairedParensPrefixLen</span><span class="op" id="6210565">(</span><span class="ident" id="6210566">s</span>&nbsp;<span class="builtintype" id="6210568">string</span><span class="op" id="6210574">)</span>&nbsp;<span class="builtintype" id="6210576">int</span>&nbsp;<span class="op" id="6210580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210583">parens</span>&nbsp;<span class="op" id="6210590">:=</span>&nbsp;<span class="num" id="6210593">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210596">l</span>&nbsp;<span class="op" id="6210598">:=</span>&nbsp;<span class="builtinfunc" id="6210601">len</span><span class="op" id="6210604">(</span><span class="ident" id="6210605">s</span><span class="op" id="6210606">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210609">for</span>&nbsp;<span class="ident" id="6210613">i</span><span class="op" id="6210614">,</span>&nbsp;<span class="ident" id="6210616">ch</span>&nbsp;<span class="op" id="6210619">:=</span>&nbsp;<span class="keyword" id="6210622">range</span>&nbsp;<span class="ident" id="6210628">s</span>&nbsp;<span class="op" id="6210630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210634">switch</span>&nbsp;<span class="ident" id="6210641">ch</span>&nbsp;<span class="op" id="6210644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210648">case</span>&nbsp;<span class="string" id="6210653">&#39;(&#39;</span><span class="op" id="6210656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210661">if</span>&nbsp;<span class="ident" id="6210664">parens</span>&nbsp;<span class="op" id="6210671">==</span>&nbsp;<span class="num" id="6210674">0</span>&nbsp;<span class="op" id="6210676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210682">l</span>&nbsp;<span class="op" id="6210684">=</span>&nbsp;<span class="ident" id="6210686">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210696">parens</span><span class="op" id="6210702">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210707">case</span>&nbsp;<span class="string" id="6210712">&#39;)&#39;</span><span class="op" id="6210715">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210720">parens</span><span class="op" id="6210726">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210732">if</span>&nbsp;<span class="ident" id="6210735">parens</span>&nbsp;<span class="op" id="6210742">==</span>&nbsp;<span class="num" id="6210745">0</span>&nbsp;<span class="op" id="6210747">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6210753">l</span>&nbsp;<span class="op" id="6210755">=</span>&nbsp;<span class="builtinfunc" id="6210757">len</span><span class="op" id="6210760">(</span><span class="ident" id="6210761">s</span><span class="op" id="6210762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210767">}</span>&nbsp;<span class="keyword" id="6210769">else</span>&nbsp;<span class="keyword" id="6210774">if</span>&nbsp;<span class="ident" id="6210777">parens</span>&nbsp;<span class="op" id="6210784">&lt;</span>&nbsp;<span class="num" id="6210786">0</span>&nbsp;<span class="op" id="6210788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210794">return</span>&nbsp;<span class="ident" id="6210801">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210810">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6210813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6210816">return</span>&nbsp;<span class="ident" id="6210823">l</span><br>
<span class="lineno"></span><span class="op" id="6210825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6210828">//&nbsp;Emphasize&nbsp;and&nbsp;escape&nbsp;a&nbsp;line&nbsp;of&nbsp;text&nbsp;for&nbsp;HTML.&nbsp;URLs&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;</span><br>
<span class="lineno">100</span><span class="comment" id="6210908">//&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if</span><br>
<span class="lineno"></span><span class="comment" id="6210988">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="6211065">//&nbsp;into&nbsp;a&nbsp;link).&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6211145">//&nbsp;the&nbsp;corresponding&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL</span><br>
<span class="lineno"></span><span class="comment" id="6211224">//&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;link.&nbsp;If&nbsp;nice&nbsp;is&nbsp;set,&nbsp;the&nbsp;remaining&nbsp;text&#39;s</span><br>
<span class="lineno">105</span><span class="comment" id="6211303">//&nbsp;appearance&nbsp;is&nbsp;improved&nbsp;where&nbsp;it&nbsp;makes&nbsp;sense&nbsp;(e.g.,&nbsp;``&nbsp;is&nbsp;turned&nbsp;into&nbsp;&amp;ldquo;</span><br>
<span class="lineno"></span><span class="comment" id="6211383">//&nbsp;and&nbsp;&#39;&#39;&nbsp;into&nbsp;&amp;rdquo;).</span><br>
<span class="lineno"></span><span class="keyword" id="6211408">func</span>&nbsp;<span class="ident" id="6211413">emphasize</span><span class="op" id="6211422">(</span><span class="ident" id="6211423">w</span>&nbsp;<span class="ident" id="6211425">io</span><span class="op" id="6211427">.</span><span class="ident" id="6211428">Writer</span><span class="op" id="6211434">,</span>&nbsp;<span class="ident" id="6211436">line</span>&nbsp;<span class="builtintype" id="6211441">string</span><span class="op" id="6211447">,</span>&nbsp;<span class="ident" id="6211449">words</span>&nbsp;<span class="keyword" id="6211455">map</span><span class="op" id="6211458">[</span><span class="builtintype" id="6211459">string</span><span class="op" id="6211465">]</span><span class="builtintype" id="6211466">string</span><span class="op" id="6211472">,</span>&nbsp;<span class="ident" id="6211474">nice</span>&nbsp;<span class="builtintype" id="6211479">bool</span><span class="op" id="6211483">)</span>&nbsp;<span class="op" id="6211485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211488">for</span>&nbsp;<span class="op" id="6211492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211496">m</span>&nbsp;<span class="op" id="6211498">:=</span>&nbsp;<span class="ident" id="6211501">matchRx</span><span class="op" id="6211508">.</span><span class="ident" id="6211509">FindStringSubmatchIndex</span><span class="op" id="6211532">(</span><span class="ident" id="6211533">line</span><span class="op" id="6211537">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211541">if</span>&nbsp;<span class="ident" id="6211544">m</span>&nbsp;<span class="op" id="6211546">==</span>&nbsp;<span class="ident" id="6211549">nil</span>&nbsp;<span class="op" id="6211553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211558">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6211566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211570">//&nbsp;m&nbsp;&gt;=&nbsp;6&nbsp;(two&nbsp;parenthesized&nbsp;sub-regexps&nbsp;in&nbsp;matchRx,&nbsp;1st&nbsp;one&nbsp;is&nbsp;urlRx)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211644">//&nbsp;write&nbsp;text&nbsp;before&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211673">commentEscape</span><span class="op" id="6211686">(</span><span class="ident" id="6211687">w</span><span class="op" id="6211688">,</span>&nbsp;<span class="ident" id="6211690">line</span><span class="op" id="6211694">[</span><span class="num" id="6211695">0</span><span class="op" id="6211696">:</span><span class="ident" id="6211697">m</span><span class="op" id="6211698">[</span><span class="num" id="6211699">0</span><span class="op" id="6211700">]</span><span class="op" id="6211701">]</span><span class="op" id="6211702">,</span>&nbsp;<span class="ident" id="6211704">nice</span><span class="op" id="6211708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211713">//&nbsp;adjust&nbsp;match&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211744">match</span>&nbsp;<span class="op" id="6211750">:=</span>&nbsp;<span class="ident" id="6211753">line</span><span class="op" id="6211757">[</span><span class="ident" id="6211758">m</span><span class="op" id="6211759">[</span><span class="num" id="6211760">0</span><span class="op" id="6211761">]</span><span class="op" id="6211762">:</span><span class="ident" id="6211763">m</span><span class="op" id="6211764">[</span><span class="num" id="6211765">1</span><span class="op" id="6211766">]</span><span class="op" id="6211767">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6211771">if</span>&nbsp;<span class="ident" id="6211774">n</span>&nbsp;<span class="op" id="6211776">:=</span>&nbsp;<span class="ident" id="6211779">pairedParensPrefixLen</span><span class="op" id="6211800">(</span><span class="ident" id="6211801">match</span><span class="op" id="6211806">)</span><span class="op" id="6211807">;</span>&nbsp;<span class="ident" id="6211809">n</span>&nbsp;<span class="op" id="6211811">&lt;</span>&nbsp;<span class="builtinfunc" id="6211813">len</span><span class="op" id="6211816">(</span><span class="ident" id="6211817">match</span><span class="op" id="6211822">)</span>&nbsp;<span class="op" id="6211824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211829">//&nbsp;match&nbsp;contains&nbsp;unpaired&nbsp;parentheses&nbsp;(rare);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6211879">//&nbsp;redo&nbsp;matching&nbsp;with&nbsp;shortened&nbsp;line&nbsp;for&nbsp;correct&nbsp;indices</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211939">m</span>&nbsp;<span class="op" id="6211941">=</span>&nbsp;<span class="ident" id="6211943">matchRx</span><span class="op" id="6211950">.</span><span class="ident" id="6211951">FindStringSubmatchIndex</span><span class="op" id="6211974">(</span><span class="ident" id="6211975">line</span><span class="op" id="6211979">[</span><span class="op" id="6211980">:</span><span class="ident" id="6211981">m</span><span class="op" id="6211982">[</span><span class="num" id="6211983">0</span><span class="op" id="6211984">]</span><span class="op" id="6211985">+</span><span class="ident" id="6211986">n</span><span class="op" id="6211987">]</span><span class="op" id="6211988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6211993">match</span>&nbsp;<span class="op" id="6211999">=</span>&nbsp;<span class="ident" id="6212001">match</span><span class="op" id="6212006">[</span><span class="op" id="6212007">:</span><span class="ident" id="6212008">n</span><span class="op" id="6212009">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212018">//&nbsp;analyze&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212037">url</span>&nbsp;<span class="op" id="6212041">:=</span>&nbsp;<span class="string" id="6212044">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212049">italics</span>&nbsp;<span class="op" id="6212057">:=</span>&nbsp;<span class="ident" id="6212060">false</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212068">if</span>&nbsp;<span class="ident" id="6212071">words</span>&nbsp;<span class="op" id="6212077">!=</span>&nbsp;<span class="ident" id="6212080">nil</span>&nbsp;<span class="op" id="6212084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212089">url</span><span class="op" id="6212092">,</span>&nbsp;<span class="ident" id="6212094">italics</span>&nbsp;<span class="op" id="6212102">=</span>&nbsp;<span class="ident" id="6212104">words</span><span class="op" id="6212109">[</span><span class="ident" id="6212110">match</span><span class="op" id="6212115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212123">if</span>&nbsp;<span class="ident" id="6212126">m</span><span class="op" id="6212127">[</span><span class="num" id="6212128">2</span><span class="op" id="6212129">]</span>&nbsp;<span class="op" id="6212131">&gt;=</span>&nbsp;<span class="num" id="6212134">0</span>&nbsp;<span class="op" id="6212136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212141">//&nbsp;match&nbsp;against&nbsp;first&nbsp;parenthesized&nbsp;sub-regexp;&nbsp;must&nbsp;be&nbsp;match&nbsp;against&nbsp;urlRx</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212221">if</span>&nbsp;<span class="op" id="6212224">!</span><span class="ident" id="6212225">italics</span>&nbsp;<span class="op" id="6212233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212239">//&nbsp;no&nbsp;alternative&nbsp;URL&nbsp;in&nbsp;words&nbsp;list,&nbsp;use&nbsp;match&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212298">url</span>&nbsp;<span class="op" id="6212302">=</span>&nbsp;<span class="ident" id="6212304">match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212318">italics</span>&nbsp;<span class="op" id="6212326">=</span>&nbsp;<span class="ident" id="6212328">false</span>&nbsp;<span class="comment" id="6212334">//&nbsp;don&#39;t&nbsp;italicize&nbsp;URLs</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212365">//&nbsp;write&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212382">if</span>&nbsp;<span class="builtinfunc" id="6212385">len</span><span class="op" id="6212388">(</span><span class="ident" id="6212389">url</span><span class="op" id="6212392">)</span>&nbsp;<span class="op" id="6212394">&gt;</span>&nbsp;<span class="num" id="6212396">0</span>&nbsp;<span class="op" id="6212398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212403">w</span><span class="op" id="6212404">.</span><span class="ident" id="6212405">Write</span><span class="op" id="6212410">(</span><span class="ident" id="6212411">html_a</span><span class="op" id="6212417">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212422">template</span><span class="op" id="6212430">.</span><span class="ident" id="6212431">HTMLEscape</span><span class="op" id="6212441">(</span><span class="ident" id="6212442">w</span><span class="op" id="6212443">,</span>&nbsp;<span class="op" id="6212445">[</span><span class="op" id="6212446">]</span><span class="builtintype" id="6212447">byte</span><span class="op" id="6212451">(</span><span class="ident" id="6212452">url</span><span class="op" id="6212455">)</span><span class="op" id="6212456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212461">w</span><span class="op" id="6212462">.</span><span class="ident" id="6212463">Write</span><span class="op" id="6212468">(</span><span class="ident" id="6212469">html_aq</span><span class="op" id="6212476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212484">if</span>&nbsp;<span class="ident" id="6212487">italics</span>&nbsp;<span class="op" id="6212495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212500">w</span><span class="op" id="6212501">.</span><span class="ident" id="6212502">Write</span><span class="op" id="6212507">(</span><span class="ident" id="6212508">html_i</span><span class="op" id="6212514">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212522">commentEscape</span><span class="op" id="6212535">(</span><span class="ident" id="6212536">w</span><span class="op" id="6212537">,</span>&nbsp;<span class="ident" id="6212539">match</span><span class="op" id="6212544">,</span>&nbsp;<span class="ident" id="6212546">nice</span><span class="op" id="6212550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212554">if</span>&nbsp;<span class="ident" id="6212557">italics</span>&nbsp;<span class="op" id="6212565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212570">w</span><span class="op" id="6212571">.</span><span class="ident" id="6212572">Write</span><span class="op" id="6212577">(</span><span class="ident" id="6212578">html_endi</span><span class="op" id="6212587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212591">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212595">if</span>&nbsp;<span class="builtinfunc" id="6212598">len</span><span class="op" id="6212601">(</span><span class="ident" id="6212602">url</span><span class="op" id="6212605">)</span>&nbsp;<span class="op" id="6212607">&gt;</span>&nbsp;<span class="num" id="6212609">0</span>&nbsp;<span class="op" id="6212611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212616">w</span><span class="op" id="6212617">.</span><span class="ident" id="6212618">Write</span><span class="op" id="6212623">(</span><span class="ident" id="6212624">html_enda</span><span class="op" id="6212633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6212642">//&nbsp;advance</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212655">line</span>&nbsp;<span class="op" id="6212660">=</span>&nbsp;<span class="ident" id="6212662">line</span><span class="op" id="6212666">[</span><span class="ident" id="6212667">m</span><span class="op" id="6212668">[</span><span class="num" id="6212669">1</span><span class="op" id="6212670">]</span><span class="op" id="6212671">:</span><span class="op" id="6212672">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212678">commentEscape</span><span class="op" id="6212691">(</span><span class="ident" id="6212692">w</span><span class="op" id="6212693">,</span>&nbsp;<span class="ident" id="6212695">line</span><span class="op" id="6212699">,</span>&nbsp;<span class="ident" id="6212701">nice</span><span class="op" id="6212705">)</span><br>
<span class="lineno"></span><span class="op" id="6212707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="6212710">func</span>&nbsp;<span class="ident" id="6212715">indentLen</span><span class="op" id="6212724">(</span><span class="ident" id="6212725">s</span>&nbsp;<span class="builtintype" id="6212727">string</span><span class="op" id="6212733">)</span>&nbsp;<span class="builtintype" id="6212735">int</span>&nbsp;<span class="op" id="6212739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212742">i</span>&nbsp;<span class="op" id="6212744">:=</span>&nbsp;<span class="num" id="6212747">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212750">for</span>&nbsp;<span class="ident" id="6212754">i</span>&nbsp;<span class="op" id="6212756">&lt;</span>&nbsp;<span class="builtinfunc" id="6212758">len</span><span class="op" id="6212761">(</span><span class="ident" id="6212762">s</span><span class="op" id="6212763">)</span>&nbsp;<span class="op" id="6212765">&amp;&amp;</span>&nbsp;<span class="op" id="6212768">(</span><span class="ident" id="6212769">s</span><span class="op" id="6212770">[</span><span class="ident" id="6212771">i</span><span class="op" id="6212772">]</span>&nbsp;<span class="op" id="6212774">==</span>&nbsp;<span class="string" id="6212777">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6212781">||</span>&nbsp;<span class="ident" id="6212784">s</span><span class="op" id="6212785">[</span><span class="ident" id="6212786">i</span><span class="op" id="6212787">]</span>&nbsp;<span class="op" id="6212789">==</span>&nbsp;<span class="string" id="6212792">&#39;\t&#39;</span><span class="op" id="6212796">)</span>&nbsp;<span class="op" id="6212798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212802">i</span><span class="op" id="6212803">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6212807">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212810">return</span>&nbsp;<span class="ident" id="6212817">i</span><br>
<span class="lineno"></span><span class="op" id="6212819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6212822">func</span>&nbsp;<span class="ident" id="6212827">isBlank</span><span class="op" id="6212834">(</span><span class="ident" id="6212835">s</span>&nbsp;<span class="builtintype" id="6212837">string</span><span class="op" id="6212843">)</span>&nbsp;<span class="builtintype" id="6212845">bool</span>&nbsp;<span class="op" id="6212850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212853">return</span>&nbsp;<span class="builtinfunc" id="6212860">len</span><span class="op" id="6212863">(</span><span class="ident" id="6212864">s</span><span class="op" id="6212865">)</span>&nbsp;<span class="op" id="6212867">==</span>&nbsp;<span class="num" id="6212870">0</span>&nbsp;<span class="op" id="6212872">||</span>&nbsp;<span class="op" id="6212875">(</span><span class="builtinfunc" id="6212876">len</span><span class="op" id="6212879">(</span><span class="ident" id="6212880">s</span><span class="op" id="6212881">)</span>&nbsp;<span class="op" id="6212883">==</span>&nbsp;<span class="num" id="6212886">1</span>&nbsp;<span class="op" id="6212888">&amp;&amp;</span>&nbsp;<span class="ident" id="6212891">s</span><span class="op" id="6212892">[</span><span class="num" id="6212893">0</span><span class="op" id="6212894">]</span>&nbsp;<span class="op" id="6212896">==</span>&nbsp;<span class="string" id="6212899">&#39;\n&#39;</span><span class="op" id="6212903">)</span><br>
<span class="lineno">175</span><span class="op" id="6212905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6212908">func</span>&nbsp;<span class="ident" id="6212913">commonPrefix</span><span class="op" id="6212925">(</span><span class="ident" id="6212926">a</span><span class="op" id="6212927">,</span>&nbsp;<span class="ident" id="6212929">b</span>&nbsp;<span class="builtintype" id="6212931">string</span><span class="op" id="6212937">)</span>&nbsp;<span class="builtintype" id="6212939">string</span>&nbsp;<span class="op" id="6212946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6212949">i</span>&nbsp;<span class="op" id="6212951">:=</span>&nbsp;<span class="num" id="6212954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6212957">for</span>&nbsp;<span class="ident" id="6212961">i</span>&nbsp;<span class="op" id="6212963">&lt;</span>&nbsp;<span class="builtinfunc" id="6212965">len</span><span class="op" id="6212968">(</span><span class="ident" id="6212969">a</span><span class="op" id="6212970">)</span>&nbsp;<span class="op" id="6212972">&amp;&amp;</span>&nbsp;<span class="ident" id="6212975">i</span>&nbsp;<span class="op" id="6212977">&lt;</span>&nbsp;<span class="builtinfunc" id="6212979">len</span><span class="op" id="6212982">(</span><span class="ident" id="6212983">b</span><span class="op" id="6212984">)</span>&nbsp;<span class="op" id="6212986">&amp;&amp;</span>&nbsp;<span class="ident" id="6212989">a</span><span class="op" id="6212990">[</span><span class="ident" id="6212991">i</span><span class="op" id="6212992">]</span>&nbsp;<span class="op" id="6212994">==</span>&nbsp;<span class="ident" id="6212997">b</span><span class="op" id="6212998">[</span><span class="ident" id="6212999">i</span><span class="op" id="6213000">]</span>&nbsp;<span class="op" id="6213002">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213006">i</span><span class="op" id="6213007">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213014">return</span>&nbsp;<span class="ident" id="6213021">a</span><span class="op" id="6213022">[</span><span class="num" id="6213023">0</span><span class="op" id="6213024">:</span><span class="ident" id="6213025">i</span><span class="op" id="6213026">]</span><br>
<span class="lineno"></span><span class="op" id="6213028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="6213031">func</span>&nbsp;<span class="ident" id="6213036">unindent</span><span class="op" id="6213044">(</span><span class="ident" id="6213045">block</span>&nbsp;<span class="op" id="6213051">[</span><span class="op" id="6213052">]</span><span class="builtintype" id="6213053">string</span><span class="op" id="6213059">)</span>&nbsp;<span class="op" id="6213061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213064">if</span>&nbsp;<span class="builtinfunc" id="6213067">len</span><span class="op" id="6213070">(</span><span class="ident" id="6213071">block</span><span class="op" id="6213076">)</span>&nbsp;<span class="op" id="6213078">==</span>&nbsp;<span class="num" id="6213081">0</span>&nbsp;<span class="op" id="6213083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213087">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213099">//&nbsp;compute&nbsp;maximum&nbsp;common&nbsp;white&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213139">prefix</span>&nbsp;<span class="op" id="6213146">:=</span>&nbsp;<span class="ident" id="6213149">block</span><span class="op" id="6213154">[</span><span class="num" id="6213155">0</span><span class="op" id="6213156">]</span><span class="op" id="6213157">[</span><span class="num" id="6213158">0</span><span class="op" id="6213159">:</span><span class="ident" id="6213160">indentLen</span><span class="op" id="6213169">(</span><span class="ident" id="6213170">block</span><span class="op" id="6213175">[</span><span class="num" id="6213176">0</span><span class="op" id="6213177">]</span><span class="op" id="6213178">)</span><span class="op" id="6213179">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213182">for</span>&nbsp;<span class="ident" id="6213186">_</span><span class="op" id="6213187">,</span>&nbsp;<span class="ident" id="6213189">line</span>&nbsp;<span class="op" id="6213194">:=</span>&nbsp;<span class="keyword" id="6213197">range</span>&nbsp;<span class="ident" id="6213203">block</span>&nbsp;<span class="op" id="6213209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213213">if</span>&nbsp;<span class="op" id="6213216">!</span><span class="ident" id="6213217">isBlank</span><span class="op" id="6213224">(</span><span class="ident" id="6213225">line</span><span class="op" id="6213229">)</span>&nbsp;<span class="op" id="6213231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213236">prefix</span>&nbsp;<span class="op" id="6213243">=</span>&nbsp;<span class="ident" id="6213245">commonPrefix</span><span class="op" id="6213257">(</span><span class="ident" id="6213258">prefix</span><span class="op" id="6213264">,</span>&nbsp;<span class="ident" id="6213266">line</span><span class="op" id="6213270">[</span><span class="num" id="6213271">0</span><span class="op" id="6213272">:</span><span class="ident" id="6213273">indentLen</span><span class="op" id="6213282">(</span><span class="ident" id="6213283">line</span><span class="op" id="6213287">)</span><span class="op" id="6213288">]</span><span class="op" id="6213289">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213299">n</span>&nbsp;<span class="op" id="6213301">:=</span>&nbsp;<span class="builtinfunc" id="6213304">len</span><span class="op" id="6213307">(</span><span class="ident" id="6213308">prefix</span><span class="op" id="6213314">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213318">//&nbsp;remove</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213329">for</span>&nbsp;<span class="ident" id="6213333">i</span><span class="op" id="6213334">,</span>&nbsp;<span class="ident" id="6213336">line</span>&nbsp;<span class="op" id="6213341">:=</span>&nbsp;<span class="keyword" id="6213344">range</span>&nbsp;<span class="ident" id="6213350">block</span>&nbsp;<span class="op" id="6213356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213360">if</span>&nbsp;<span class="op" id="6213363">!</span><span class="ident" id="6213364">isBlank</span><span class="op" id="6213371">(</span><span class="ident" id="6213372">line</span><span class="op" id="6213376">)</span>&nbsp;<span class="op" id="6213378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213383">block</span><span class="op" id="6213388">[</span><span class="ident" id="6213389">i</span><span class="op" id="6213390">]</span>&nbsp;<span class="op" id="6213392">=</span>&nbsp;<span class="ident" id="6213394">line</span><span class="op" id="6213398">[</span><span class="ident" id="6213399">n</span><span class="op" id="6213400">:</span><span class="op" id="6213401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213408">}</span><br>
<span class="lineno">205</span><span class="op" id="6213410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6213413">//&nbsp;heading&nbsp;returns&nbsp;the&nbsp;trimmed&nbsp;line&nbsp;if&nbsp;it&nbsp;passes&nbsp;as&nbsp;a&nbsp;section&nbsp;heading;</span><br>
<span class="lineno"></span><span class="comment" id="6213484">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="6213526">func</span>&nbsp;<span class="ident" id="6213531">heading</span><span class="op" id="6213538">(</span><span class="ident" id="6213539">line</span>&nbsp;<span class="builtintype" id="6213544">string</span><span class="op" id="6213550">)</span>&nbsp;<span class="builtintype" id="6213552">string</span>&nbsp;<span class="op" id="6213559">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213562">line</span>&nbsp;<span class="op" id="6213567">=</span>&nbsp;<span class="ident" id="6213569">strings</span><span class="op" id="6213576">.</span><span class="ident" id="6213577">TrimSpace</span><span class="op" id="6213586">(</span><span class="ident" id="6213587">line</span><span class="op" id="6213591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213594">if</span>&nbsp;<span class="builtinfunc" id="6213597">len</span><span class="op" id="6213600">(</span><span class="ident" id="6213601">line</span><span class="op" id="6213605">)</span>&nbsp;<span class="op" id="6213607">==</span>&nbsp;<span class="num" id="6213610">0</span>&nbsp;<span class="op" id="6213612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213616">return</span>&nbsp;<span class="string" id="6213623">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213631">//&nbsp;a&nbsp;heading&nbsp;must&nbsp;start&nbsp;with&nbsp;an&nbsp;uppercase&nbsp;letter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213681">r</span><span class="op" id="6213682">,</span>&nbsp;<span class="ident" id="6213684">_</span>&nbsp;<span class="op" id="6213686">:=</span>&nbsp;<span class="ident" id="6213689">utf8</span><span class="op" id="6213693">.</span><span class="ident" id="6213694">DecodeRuneInString</span><span class="op" id="6213712">(</span><span class="ident" id="6213713">line</span><span class="op" id="6213717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213720">if</span>&nbsp;<span class="op" id="6213723">!</span><span class="ident" id="6213724">unicode</span><span class="op" id="6213731">.</span><span class="ident" id="6213732">IsLetter</span><span class="op" id="6213740">(</span><span class="ident" id="6213741">r</span><span class="op" id="6213742">)</span>&nbsp;<span class="op" id="6213744">||</span>&nbsp;<span class="op" id="6213747">!</span><span class="ident" id="6213748">unicode</span><span class="op" id="6213755">.</span><span class="ident" id="6213756">IsUpper</span><span class="op" id="6213763">(</span><span class="ident" id="6213764">r</span><span class="op" id="6213765">)</span>&nbsp;<span class="op" id="6213767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213771">return</span>&nbsp;<span class="string" id="6213778">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213782">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213786">//&nbsp;it&nbsp;must&nbsp;end&nbsp;in&nbsp;a&nbsp;letter&nbsp;or&nbsp;digit:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6213824">r</span><span class="op" id="6213825">,</span>&nbsp;<span class="ident" id="6213827">_</span>&nbsp;<span class="op" id="6213829">=</span>&nbsp;<span class="ident" id="6213831">utf8</span><span class="op" id="6213835">.</span><span class="ident" id="6213836">DecodeLastRuneInString</span><span class="op" id="6213858">(</span><span class="ident" id="6213859">line</span><span class="op" id="6213863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213866">if</span>&nbsp;<span class="op" id="6213869">!</span><span class="ident" id="6213870">unicode</span><span class="op" id="6213877">.</span><span class="ident" id="6213878">IsLetter</span><span class="op" id="6213886">(</span><span class="ident" id="6213887">r</span><span class="op" id="6213888">)</span>&nbsp;<span class="op" id="6213890">&amp;&amp;</span>&nbsp;<span class="op" id="6213893">!</span><span class="ident" id="6213894">unicode</span><span class="op" id="6213901">.</span><span class="ident" id="6213902">IsDigit</span><span class="op" id="6213909">(</span><span class="ident" id="6213910">r</span><span class="op" id="6213911">)</span>&nbsp;<span class="op" id="6213913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213917">return</span>&nbsp;<span class="string" id="6213924">&#34;&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6213928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6213932">//&nbsp;exclude&nbsp;lines&nbsp;with&nbsp;illegal&nbsp;characters</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6213974">if</span>&nbsp;<span class="ident" id="6213977">strings</span><span class="op" id="6213984">.</span><span class="ident" id="6213985">IndexAny</span><span class="op" id="6213993">(</span><span class="ident" id="6213994">line</span><span class="op" id="6213998">,</span>&nbsp;<span class="string" id="6214000">&#34;,.;:!?+*/=()[]{}_^°&amp;§~%#@&lt;\&#34;&gt;\\&#34;</span><span class="op" id="6214035">)</span>&nbsp;<span class="op" id="6214037">&gt;=</span>&nbsp;<span class="num" id="6214040">0</span>&nbsp;<span class="op" id="6214042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214046">return</span>&nbsp;<span class="string" id="6214053">&#34;&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6214061">//&nbsp;allow&nbsp;&#34;&#39;&#34;&nbsp;for&nbsp;possessive&nbsp;&#34;&#39;s&#34;&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214100">for</span>&nbsp;<span class="ident" id="6214104">b</span>&nbsp;<span class="op" id="6214106">:=</span>&nbsp;<span class="ident" id="6214109">line</span><span class="op" id="6214113">;</span>&nbsp;<span class="op" id="6214115">;</span>&nbsp;<span class="op" id="6214117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214121">i</span>&nbsp;<span class="op" id="6214123">:=</span>&nbsp;<span class="ident" id="6214126">strings</span><span class="op" id="6214133">.</span><span class="ident" id="6214134">IndexRune</span><span class="op" id="6214143">(</span><span class="ident" id="6214144">b</span><span class="op" id="6214145">,</span>&nbsp;<span class="string" id="6214147">&#39;\&#39;&#39;</span><span class="op" id="6214151">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214155">if</span>&nbsp;<span class="ident" id="6214158">i</span>&nbsp;<span class="op" id="6214160">&lt;</span>&nbsp;<span class="num" id="6214162">0</span>&nbsp;<span class="op" id="6214164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214169">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214181">if</span>&nbsp;<span class="ident" id="6214184">i</span><span class="op" id="6214185">+</span><span class="num" id="6214186">1</span>&nbsp;<span class="op" id="6214188">&gt;=</span>&nbsp;<span class="builtinfunc" id="6214191">len</span><span class="op" id="6214194">(</span><span class="ident" id="6214195">b</span><span class="op" id="6214196">)</span>&nbsp;<span class="op" id="6214198">||</span>&nbsp;<span class="ident" id="6214201">b</span><span class="op" id="6214202">[</span><span class="ident" id="6214203">i</span><span class="op" id="6214204">+</span><span class="num" id="6214205">1</span><span class="op" id="6214206">]</span>&nbsp;<span class="op" id="6214208">!=</span>&nbsp;<span class="string" id="6214211">&#39;s&#39;</span>&nbsp;<span class="op" id="6214215">||</span>&nbsp;<span class="op" id="6214218">(</span><span class="ident" id="6214219">i</span><span class="op" id="6214220">+</span><span class="num" id="6214221">2</span>&nbsp;<span class="op" id="6214223">&lt;</span>&nbsp;<span class="builtinfunc" id="6214225">len</span><span class="op" id="6214228">(</span><span class="ident" id="6214229">b</span><span class="op" id="6214230">)</span>&nbsp;<span class="op" id="6214232">&amp;&amp;</span>&nbsp;<span class="ident" id="6214235">b</span><span class="op" id="6214236">[</span><span class="ident" id="6214237">i</span><span class="op" id="6214238">+</span><span class="num" id="6214239">2</span><span class="op" id="6214240">]</span>&nbsp;<span class="op" id="6214242">!=</span>&nbsp;<span class="string" id="6214245">&#39;&nbsp;&#39;</span><span class="op" id="6214248">)</span>&nbsp;<span class="op" id="6214250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214255">return</span>&nbsp;<span class="string" id="6214262">&#34;&#34;</span>&nbsp;<span class="comment" id="6214265">//&nbsp;not&nbsp;followed&nbsp;by&nbsp;&#34;s&nbsp;&#34;</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214295">b</span>&nbsp;<span class="op" id="6214297">=</span>&nbsp;<span class="ident" id="6214299">b</span><span class="op" id="6214300">[</span><span class="ident" id="6214301">i</span><span class="op" id="6214302">+</span><span class="num" id="6214303">2</span><span class="op" id="6214304">:</span><span class="op" id="6214305">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6214308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214312">return</span>&nbsp;<span class="ident" id="6214319">line</span><br>
<span class="lineno">245</span><span class="op" id="6214324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6214327">type</span>&nbsp;<span class="ident" id="6214332">op</span>&nbsp;<span class="builtintype" id="6214335">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6214340">const</span>&nbsp;<span class="op" id="6214346">(</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214349">opPara</span>&nbsp;<span class="ident" id="6214356">op</span>&nbsp;<span class="op" id="6214359">=</span>&nbsp;<span class="ident" id="6214361">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214367">opHead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214375">opPre</span><br>
<span class="lineno"></span><span class="op" id="6214381">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="6214384">type</span>&nbsp;<span class="ident" id="6214389">block</span>&nbsp;<span class="keyword" id="6214395">struct</span>&nbsp;<span class="op" id="6214402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214405">op</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6214411">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6214415">lines</span>&nbsp;<span class="op" id="6214421">[</span><span class="op" id="6214422">]</span><span class="builtintype" id="6214423">string</span><br>
<span class="lineno"></span><span class="op" id="6214430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="6214433">var</span>&nbsp;<span class="ident" id="6214437">nonAlphaNumRx</span>&nbsp;<span class="op" id="6214451">=</span>&nbsp;<span class="ident" id="6214453">regexp</span><span class="op" id="6214459">.</span><span class="ident" id="6214460">MustCompile</span><span class="op" id="6214471">(</span><span class="string" id="6214472">`[^a-zA-Z0-9]`</span><span class="op" id="6214486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6214489">func</span>&nbsp;<span class="ident" id="6214494">anchorID</span><span class="op" id="6214502">(</span><span class="ident" id="6214503">line</span>&nbsp;<span class="builtintype" id="6214508">string</span><span class="op" id="6214514">)</span>&nbsp;<span class="builtintype" id="6214516">string</span>&nbsp;<span class="op" id="6214523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6214526">//&nbsp;Add&nbsp;a&nbsp;&#34;hdr-&#34;&nbsp;prefix&nbsp;to&nbsp;avoid&nbsp;conflicting&nbsp;with&nbsp;IDs&nbsp;used&nbsp;for&nbsp;package&nbsp;symbols.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6214606">return</span>&nbsp;<span class="string" id="6214613">&#34;hdr-&#34;</span>&nbsp;<span class="op" id="6214620">+</span>&nbsp;<span class="ident" id="6214622">nonAlphaNumRx</span><span class="op" id="6214635">.</span><span class="ident" id="6214636">ReplaceAllString</span><span class="op" id="6214652">(</span><span class="ident" id="6214653">line</span><span class="op" id="6214657">,</span>&nbsp;<span class="string" id="6214659">&#34;_&#34;</span><span class="op" id="6214662">)</span><br>
<span class="lineno">265</span><span class="op" id="6214664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6214667">//&nbsp;ToHTML&nbsp;converts&nbsp;comment&nbsp;text&nbsp;to&nbsp;formatted&nbsp;HTML.</span><br>
<span class="lineno"></span><span class="comment" id="6214718">//&nbsp;The&nbsp;comment&nbsp;was&nbsp;prepared&nbsp;by&nbsp;DocReader,</span><br>
<span class="lineno"></span><span class="comment" id="6214760">//&nbsp;so&nbsp;it&nbsp;is&nbsp;known&nbsp;not&nbsp;to&nbsp;have&nbsp;leading,&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">270</span><span class="comment" id="6214820">//&nbsp;nor&nbsp;to&nbsp;have&nbsp;trailing&nbsp;spaces&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;lines.</span><br>
<span class="lineno"></span><span class="comment" id="6214872">//&nbsp;The&nbsp;comment&nbsp;markers&nbsp;have&nbsp;already&nbsp;been&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="6214922">//</span><br>
<span class="lineno"></span><span class="comment" id="6214925">//&nbsp;Each&nbsp;span&nbsp;of&nbsp;unindented&nbsp;non-blank&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="6214986">//&nbsp;a&nbsp;single&nbsp;paragraph.&nbsp;There&nbsp;is&nbsp;one&nbsp;exception&nbsp;to&nbsp;the&nbsp;rule:&nbsp;a&nbsp;span&nbsp;that</span><br>
<span class="lineno">275</span><span class="comment" id="6215057">//&nbsp;consists&nbsp;of&nbsp;a&nbsp;single&nbsp;line,&nbsp;is&nbsp;followed&nbsp;by&nbsp;another&nbsp;paragraph&nbsp;span,</span><br>
<span class="lineno"></span><span class="comment" id="6215126">//&nbsp;begins&nbsp;with&nbsp;a&nbsp;capital&nbsp;letter,&nbsp;and&nbsp;contains&nbsp;no&nbsp;punctuation</span><br>
<span class="lineno"></span><span class="comment" id="6215187">//&nbsp;is&nbsp;formatted&nbsp;as&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span><span class="comment" id="6215217">//</span><br>
<span class="lineno"></span><span class="comment" id="6215220">//&nbsp;A&nbsp;span&nbsp;of&nbsp;indented&nbsp;lines&nbsp;is&nbsp;converted&nbsp;into&nbsp;a&nbsp;&lt;pre&gt;&nbsp;block,</span><br>
<span class="lineno">280</span><span class="comment" id="6215281">//&nbsp;with&nbsp;the&nbsp;common&nbsp;indent&nbsp;prefix&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="6215323">//</span><br>
<span class="lineno"></span><span class="comment" id="6215326">//&nbsp;URLs&nbsp;in&nbsp;the&nbsp;comment&nbsp;text&nbsp;are&nbsp;converted&nbsp;into&nbsp;links;&nbsp;if&nbsp;the&nbsp;URL&nbsp;also&nbsp;appears</span><br>
<span class="lineno"></span><span class="comment" id="6215404">//&nbsp;in&nbsp;the&nbsp;words&nbsp;map,&nbsp;the&nbsp;link&nbsp;is&nbsp;taken&nbsp;from&nbsp;the&nbsp;map&nbsp;(if&nbsp;the&nbsp;corresponding&nbsp;map</span><br>
<span class="lineno"></span><span class="comment" id="6215482">//&nbsp;value&nbsp;is&nbsp;the&nbsp;empty&nbsp;string,&nbsp;the&nbsp;URL&nbsp;is&nbsp;not&nbsp;converted&nbsp;into&nbsp;a&nbsp;link).</span><br>
<span class="lineno">285</span><span class="comment" id="6215551">//</span><br>
<span class="lineno"></span><span class="comment" id="6215554">//&nbsp;Go&nbsp;identifiers&nbsp;that&nbsp;appear&nbsp;in&nbsp;the&nbsp;words&nbsp;map&nbsp;are&nbsp;italicized;&nbsp;if&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="6215638">//&nbsp;map&nbsp;value&nbsp;is&nbsp;not&nbsp;the&nbsp;empty&nbsp;string,&nbsp;it&nbsp;is&nbsp;considered&nbsp;a&nbsp;URL&nbsp;and&nbsp;the&nbsp;word&nbsp;is&nbsp;converted</span><br>
<span class="lineno"></span><span class="comment" id="6215725">//&nbsp;into&nbsp;a&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="6215741">func</span>&nbsp;<span class="ident" id="6215746">ToHTML</span><span class="op" id="6215752">(</span><span class="ident" id="6215753">w</span>&nbsp;<span class="ident" id="6215755">io</span><span class="op" id="6215757">.</span><span class="ident" id="6215758">Writer</span><span class="op" id="6215764">,</span>&nbsp;<span class="ident" id="6215766">text</span>&nbsp;<span class="builtintype" id="6215771">string</span><span class="op" id="6215777">,</span>&nbsp;<span class="ident" id="6215779">words</span>&nbsp;<span class="keyword" id="6215785">map</span><span class="op" id="6215788">[</span><span class="builtintype" id="6215789">string</span><span class="op" id="6215795">]</span><span class="builtintype" id="6215796">string</span><span class="op" id="6215802">)</span>&nbsp;<span class="op" id="6215804">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215807">for</span>&nbsp;<span class="ident" id="6215811">_</span><span class="op" id="6215812">,</span>&nbsp;<span class="ident" id="6215814">b</span>&nbsp;<span class="op" id="6215816">:=</span>&nbsp;<span class="keyword" id="6215819">range</span>&nbsp;<span class="ident" id="6215825">blocks</span><span class="op" id="6215831">(</span><span class="ident" id="6215832">text</span><span class="op" id="6215836">)</span>&nbsp;<span class="op" id="6215838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215842">switch</span>&nbsp;<span class="ident" id="6215849">b</span><span class="op" id="6215850">.</span><span class="ident" id="6215851">op</span>&nbsp;<span class="op" id="6215854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215858">case</span>&nbsp;<span class="ident" id="6215863">opPara</span><span class="op" id="6215869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215874">w</span><span class="op" id="6215875">.</span><span class="ident" id="6215876">Write</span><span class="op" id="6215881">(</span><span class="ident" id="6215882">html_p</span><span class="op" id="6215888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215893">for</span>&nbsp;<span class="ident" id="6215897">_</span><span class="op" id="6215898">,</span>&nbsp;<span class="ident" id="6215900">line</span>&nbsp;<span class="op" id="6215905">:=</span>&nbsp;<span class="keyword" id="6215908">range</span>&nbsp;<span class="ident" id="6215914">b</span><span class="op" id="6215915">.</span><span class="ident" id="6215916">lines</span>&nbsp;<span class="op" id="6215922">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215928">emphasize</span><span class="op" id="6215937">(</span><span class="ident" id="6215938">w</span><span class="op" id="6215939">,</span>&nbsp;<span class="ident" id="6215941">line</span><span class="op" id="6215945">,</span>&nbsp;<span class="ident" id="6215947">words</span><span class="op" id="6215952">,</span>&nbsp;<span class="ident" id="6215954">true</span><span class="op" id="6215958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6215963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6215968">w</span><span class="op" id="6215969">.</span><span class="ident" id="6215970">Write</span><span class="op" id="6215975">(</span><span class="ident" id="6215976">html_endp</span><span class="op" id="6215985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6215989">case</span>&nbsp;<span class="ident" id="6215994">opHead</span><span class="op" id="6216000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216005">w</span><span class="op" id="6216006">.</span><span class="ident" id="6216007">Write</span><span class="op" id="6216012">(</span><span class="ident" id="6216013">html_h</span><span class="op" id="6216019">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216024">id</span>&nbsp;<span class="op" id="6216027">:=</span>&nbsp;<span class="string" id="6216030">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216036">for</span>&nbsp;<span class="ident" id="6216040">_</span><span class="op" id="6216041">,</span>&nbsp;<span class="ident" id="6216043">line</span>&nbsp;<span class="op" id="6216048">:=</span>&nbsp;<span class="keyword" id="6216051">range</span>&nbsp;<span class="ident" id="6216057">b</span><span class="op" id="6216058">.</span><span class="ident" id="6216059">lines</span>&nbsp;<span class="op" id="6216065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216071">if</span>&nbsp;<span class="ident" id="6216074">id</span>&nbsp;<span class="op" id="6216077">==</span>&nbsp;<span class="string" id="6216080">&#34;&#34;</span>&nbsp;<span class="op" id="6216083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216090">id</span>&nbsp;<span class="op" id="6216093">=</span>&nbsp;<span class="ident" id="6216095">anchorID</span><span class="op" id="6216103">(</span><span class="ident" id="6216104">line</span><span class="op" id="6216108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216115">w</span><span class="op" id="6216116">.</span><span class="ident" id="6216117">Write</span><span class="op" id="6216122">(</span><span class="op" id="6216123">[</span><span class="op" id="6216124">]</span><span class="builtintype" id="6216125">byte</span><span class="op" id="6216129">(</span><span class="ident" id="6216130">id</span><span class="op" id="6216132">)</span><span class="op" id="6216133">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216140">w</span><span class="op" id="6216141">.</span><span class="ident" id="6216142">Write</span><span class="op" id="6216147">(</span><span class="ident" id="6216148">html_hq</span><span class="op" id="6216155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216167">commentEscape</span><span class="op" id="6216180">(</span><span class="ident" id="6216181">w</span><span class="op" id="6216182">,</span>&nbsp;<span class="ident" id="6216184">line</span><span class="op" id="6216188">,</span>&nbsp;<span class="ident" id="6216190">true</span><span class="op" id="6216194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216204">if</span>&nbsp;<span class="ident" id="6216207">id</span>&nbsp;<span class="op" id="6216210">==</span>&nbsp;<span class="string" id="6216213">&#34;&#34;</span>&nbsp;<span class="op" id="6216216">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216222">w</span><span class="op" id="6216223">.</span><span class="ident" id="6216224">Write</span><span class="op" id="6216229">(</span><span class="ident" id="6216230">html_hq</span><span class="op" id="6216237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216247">w</span><span class="op" id="6216248">.</span><span class="ident" id="6216249">Write</span><span class="op" id="6216254">(</span><span class="ident" id="6216255">html_endh</span><span class="op" id="6216264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216268">case</span>&nbsp;<span class="ident" id="6216273">opPre</span><span class="op" id="6216278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216283">w</span><span class="op" id="6216284">.</span><span class="ident" id="6216285">Write</span><span class="op" id="6216290">(</span><span class="ident" id="6216291">html_pre</span><span class="op" id="6216299">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216304">for</span>&nbsp;<span class="ident" id="6216308">_</span><span class="op" id="6216309">,</span>&nbsp;<span class="ident" id="6216311">line</span>&nbsp;<span class="op" id="6216316">:=</span>&nbsp;<span class="keyword" id="6216319">range</span>&nbsp;<span class="ident" id="6216325">b</span><span class="op" id="6216326">.</span><span class="ident" id="6216327">lines</span>&nbsp;<span class="op" id="6216333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216339">emphasize</span><span class="op" id="6216348">(</span><span class="ident" id="6216349">w</span><span class="op" id="6216350">,</span>&nbsp;<span class="ident" id="6216352">line</span><span class="op" id="6216356">,</span>&nbsp;<span class="ident" id="6216358">nil</span><span class="op" id="6216361">,</span>&nbsp;<span class="ident" id="6216363">false</span><span class="op" id="6216368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216378">w</span><span class="op" id="6216379">.</span><span class="ident" id="6216380">Write</span><span class="op" id="6216385">(</span><span class="ident" id="6216386">html_endpre</span><span class="op" id="6216397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216401">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216404">}</span><br>
<span class="lineno"></span><span class="op" id="6216406">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6216409">func</span>&nbsp;<span class="ident" id="6216414">blocks</span><span class="op" id="6216420">(</span><span class="ident" id="6216421">text</span>&nbsp;<span class="builtintype" id="6216426">string</span><span class="op" id="6216432">)</span>&nbsp;<span class="op" id="6216434">[</span><span class="op" id="6216435">]</span><span class="ident" id="6216436">block</span>&nbsp;<span class="op" id="6216442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216445">var</span>&nbsp;<span class="op" id="6216449">(</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216453">out</span>&nbsp;&nbsp;<span class="op" id="6216458">[</span><span class="op" id="6216459">]</span><span class="ident" id="6216460">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216468">para</span>&nbsp;<span class="op" id="6216473">[</span><span class="op" id="6216474">]</span><span class="builtintype" id="6216475">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216485">lastWasBlank</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6216500">=</span>&nbsp;<span class="ident" id="6216502">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216510">lastWasHeading</span>&nbsp;<span class="op" id="6216525">=</span>&nbsp;<span class="ident" id="6216527">false</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6216538">close</span>&nbsp;<span class="op" id="6216544">:=</span>&nbsp;<span class="keyword" id="6216547">func</span><span class="op" id="6216551">(</span><span class="op" id="6216552">)</span>&nbsp;<span class="op" id="6216554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216558">if</span>&nbsp;<span class="ident" id="6216561">para</span>&nbsp;<span class="op" id="6216566">!=</span>&nbsp;<span class="ident" id="6216569">nil</span>&nbsp;<span class="op" id="6216573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216578">out</span>&nbsp;<span class="op" id="6216582">=</span>&nbsp;<span class="builtinfunc" id="6216584">append</span><span class="op" id="6216590">(</span><span class="ident" id="6216591">out</span><span class="op" id="6216594">,</span>&nbsp;<span class="ident" id="6216596">block</span><span class="op" id="6216601">{</span><span class="ident" id="6216602">opPara</span><span class="op" id="6216608">,</span>&nbsp;<span class="ident" id="6216610">para</span><span class="op" id="6216614">}</span><span class="op" id="6216615">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216620">para</span>&nbsp;<span class="op" id="6216625">=</span>&nbsp;<span class="ident" id="6216627">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216640">lines</span>&nbsp;<span class="op" id="6216646">:=</span>&nbsp;<span class="ident" id="6216649">strings</span><span class="op" id="6216656">.</span><span class="ident" id="6216657">SplitAfter</span><span class="op" id="6216667">(</span><span class="ident" id="6216668">text</span><span class="op" id="6216672">,</span>&nbsp;<span class="string" id="6216674">&#34;\n&#34;</span><span class="op" id="6216678">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216681">unindent</span><span class="op" id="6216689">(</span><span class="ident" id="6216690">lines</span><span class="op" id="6216695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216698">for</span>&nbsp;<span class="ident" id="6216702">i</span>&nbsp;<span class="op" id="6216704">:=</span>&nbsp;<span class="num" id="6216707">0</span><span class="op" id="6216708">;</span>&nbsp;<span class="ident" id="6216710">i</span>&nbsp;<span class="op" id="6216712">&lt;</span>&nbsp;<span class="builtinfunc" id="6216714">len</span><span class="op" id="6216717">(</span><span class="ident" id="6216718">lines</span><span class="op" id="6216723">)</span><span class="op" id="6216724">;</span>&nbsp;<span class="op" id="6216726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216730">line</span>&nbsp;<span class="op" id="6216735">:=</span>&nbsp;<span class="ident" id="6216738">lines</span><span class="op" id="6216743">[</span><span class="ident" id="6216744">i</span><span class="op" id="6216745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216749">if</span>&nbsp;<span class="ident" id="6216752">isBlank</span><span class="op" id="6216759">(</span><span class="ident" id="6216760">line</span><span class="op" id="6216764">)</span>&nbsp;<span class="op" id="6216766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216771">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6216793">close</span><span class="op" id="6216798">(</span><span class="op" id="6216799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216804">i</span><span class="op" id="6216805">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216811">lastWasBlank</span>&nbsp;<span class="op" id="6216824">=</span>&nbsp;<span class="ident" id="6216826">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216834">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6216845">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216849">if</span>&nbsp;<span class="ident" id="6216852">indentLen</span><span class="op" id="6216861">(</span><span class="ident" id="6216862">line</span><span class="op" id="6216866">)</span>&nbsp;<span class="op" id="6216868">&gt;</span>&nbsp;<span class="num" id="6216870">0</span>&nbsp;<span class="op" id="6216872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216877">//&nbsp;close&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6216899">close</span><span class="op" id="6216904">(</span><span class="op" id="6216905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6216911">//&nbsp;count&nbsp;indented&nbsp;or&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6216947">j</span>&nbsp;<span class="op" id="6216949">:=</span>&nbsp;<span class="ident" id="6216952">i</span>&nbsp;<span class="op" id="6216954">+</span>&nbsp;<span class="num" id="6216956">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6216961">for</span>&nbsp;<span class="ident" id="6216965">j</span>&nbsp;<span class="op" id="6216967">&lt;</span>&nbsp;<span class="builtinfunc" id="6216969">len</span><span class="op" id="6216972">(</span><span class="ident" id="6216973">lines</span><span class="op" id="6216978">)</span>&nbsp;<span class="op" id="6216980">&amp;&amp;</span>&nbsp;<span class="op" id="6216983">(</span><span class="ident" id="6216984">isBlank</span><span class="op" id="6216991">(</span><span class="ident" id="6216992">lines</span><span class="op" id="6216997">[</span><span class="ident" id="6216998">j</span><span class="op" id="6216999">]</span><span class="op" id="6217000">)</span>&nbsp;<span class="op" id="6217002">||</span>&nbsp;<span class="ident" id="6217005">indentLen</span><span class="op" id="6217014">(</span><span class="ident" id="6217015">lines</span><span class="op" id="6217020">[</span><span class="ident" id="6217021">j</span><span class="op" id="6217022">]</span><span class="op" id="6217023">)</span>&nbsp;<span class="op" id="6217025">&gt;</span>&nbsp;<span class="num" id="6217027">0</span><span class="op" id="6217028">)</span>&nbsp;<span class="op" id="6217030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217036">j</span><span class="op" id="6217037">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6217048">//&nbsp;but&nbsp;not&nbsp;trailing&nbsp;blank&nbsp;lines</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217083">for</span>&nbsp;<span class="ident" id="6217087">j</span>&nbsp;<span class="op" id="6217089">&gt;</span>&nbsp;<span class="ident" id="6217091">i</span>&nbsp;<span class="op" id="6217093">&amp;&amp;</span>&nbsp;<span class="ident" id="6217096">isBlank</span><span class="op" id="6217103">(</span><span class="ident" id="6217104">lines</span><span class="op" id="6217109">[</span><span class="ident" id="6217110">j</span><span class="op" id="6217111">-</span><span class="num" id="6217112">1</span><span class="op" id="6217113">]</span><span class="op" id="6217114">)</span>&nbsp;<span class="op" id="6217116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217122">j</span><span class="op" id="6217123">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217134">pre</span>&nbsp;<span class="op" id="6217138">:=</span>&nbsp;<span class="ident" id="6217141">lines</span><span class="op" id="6217146">[</span><span class="ident" id="6217147">i</span><span class="op" id="6217148">:</span><span class="ident" id="6217149">j</span><span class="op" id="6217150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217155">i</span>&nbsp;<span class="op" id="6217157">=</span>&nbsp;<span class="ident" id="6217159">j</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217165">unindent</span><span class="op" id="6217173">(</span><span class="ident" id="6217174">pre</span><span class="op" id="6217177">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6217183">//&nbsp;put&nbsp;those&nbsp;lines&nbsp;in&nbsp;a&nbsp;pre&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217220">out</span>&nbsp;<span class="op" id="6217224">=</span>&nbsp;<span class="builtinfunc" id="6217226">append</span><span class="op" id="6217232">(</span><span class="ident" id="6217233">out</span><span class="op" id="6217236">,</span>&nbsp;<span class="ident" id="6217238">block</span><span class="op" id="6217243">{</span><span class="ident" id="6217244">opPre</span><span class="op" id="6217249">,</span>&nbsp;<span class="ident" id="6217251">pre</span><span class="op" id="6217254">}</span><span class="op" id="6217255">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217260">lastWasHeading</span>&nbsp;<span class="op" id="6217275">=</span>&nbsp;<span class="ident" id="6217277">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217286">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217302">if</span>&nbsp;<span class="ident" id="6217305">lastWasBlank</span>&nbsp;<span class="op" id="6217318">&amp;&amp;</span>&nbsp;<span class="op" id="6217321">!</span><span class="ident" id="6217322">lastWasHeading</span>&nbsp;<span class="op" id="6217337">&amp;&amp;</span>&nbsp;<span class="ident" id="6217340">i</span><span class="op" id="6217341">+</span><span class="num" id="6217342">2</span>&nbsp;<span class="op" id="6217344">&lt;</span>&nbsp;<span class="builtinfunc" id="6217346">len</span><span class="op" id="6217349">(</span><span class="ident" id="6217350">lines</span><span class="op" id="6217355">)</span>&nbsp;<span class="op" id="6217357">&amp;&amp;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217363">isBlank</span><span class="op" id="6217370">(</span><span class="ident" id="6217371">lines</span><span class="op" id="6217376">[</span><span class="ident" id="6217377">i</span><span class="op" id="6217378">+</span><span class="num" id="6217379">1</span><span class="op" id="6217380">]</span><span class="op" id="6217381">)</span>&nbsp;<span class="op" id="6217383">&amp;&amp;</span>&nbsp;<span class="op" id="6217386">!</span><span class="ident" id="6217387">isBlank</span><span class="op" id="6217394">(</span><span class="ident" id="6217395">lines</span><span class="op" id="6217400">[</span><span class="ident" id="6217401">i</span><span class="op" id="6217402">+</span><span class="num" id="6217403">2</span><span class="op" id="6217404">]</span><span class="op" id="6217405">)</span>&nbsp;<span class="op" id="6217407">&amp;&amp;</span>&nbsp;<span class="ident" id="6217410">indentLen</span><span class="op" id="6217419">(</span><span class="ident" id="6217420">lines</span><span class="op" id="6217425">[</span><span class="ident" id="6217426">i</span><span class="op" id="6217427">+</span><span class="num" id="6217428">2</span><span class="op" id="6217429">]</span><span class="op" id="6217430">)</span>&nbsp;<span class="op" id="6217432">==</span>&nbsp;<span class="num" id="6217435">0</span>&nbsp;<span class="op" id="6217437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6217442">//&nbsp;current&nbsp;line&nbsp;is&nbsp;non-blank,&nbsp;surrounded&nbsp;by&nbsp;blank&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6217501">//&nbsp;and&nbsp;the&nbsp;next&nbsp;non-blank&nbsp;line&nbsp;is&nbsp;not&nbsp;indented:&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6217557">//&nbsp;might&nbsp;be&nbsp;a&nbsp;heading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217583">if</span>&nbsp;<span class="ident" id="6217586">head</span>&nbsp;<span class="op" id="6217591">:=</span>&nbsp;<span class="ident" id="6217594">heading</span><span class="op" id="6217601">(</span><span class="ident" id="6217602">line</span><span class="op" id="6217606">)</span><span class="op" id="6217607">;</span>&nbsp;<span class="ident" id="6217609">head</span>&nbsp;<span class="op" id="6217614">!=</span>&nbsp;<span class="string" id="6217617">&#34;&#34;</span>&nbsp;<span class="op" id="6217620">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6217626">close</span><span class="op" id="6217631">(</span><span class="op" id="6217632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217638">out</span>&nbsp;<span class="op" id="6217642">=</span>&nbsp;<span class="builtinfunc" id="6217644">append</span><span class="op" id="6217650">(</span><span class="ident" id="6217651">out</span><span class="op" id="6217654">,</span>&nbsp;<span class="ident" id="6217656">block</span><span class="op" id="6217661">{</span><span class="ident" id="6217662">opHead</span><span class="op" id="6217668">,</span>&nbsp;<span class="op" id="6217670">[</span><span class="op" id="6217671">]</span><span class="builtintype" id="6217672">string</span><span class="op" id="6217678">{</span><span class="ident" id="6217679">head</span><span class="op" id="6217683">}</span><span class="op" id="6217684">}</span><span class="op" id="6217685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217691">i</span>&nbsp;<span class="op" id="6217693">+=</span>&nbsp;<span class="num" id="6217696">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217702">lastWasHeading</span>&nbsp;<span class="op" id="6217717">=</span>&nbsp;<span class="ident" id="6217719">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217728">continue</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6217749">//&nbsp;open&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217769">lastWasBlank</span>&nbsp;<span class="op" id="6217782">=</span>&nbsp;<span class="ident" id="6217784">false</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217792">lastWasHeading</span>&nbsp;<span class="op" id="6217807">=</span>&nbsp;<span class="ident" id="6217809">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217817">para</span>&nbsp;<span class="op" id="6217822">=</span>&nbsp;<span class="builtinfunc" id="6217824">append</span><span class="op" id="6217830">(</span><span class="ident" id="6217831">para</span><span class="op" id="6217835">,</span>&nbsp;<span class="ident" id="6217837">lines</span><span class="op" id="6217842">[</span><span class="ident" id="6217843">i</span><span class="op" id="6217844">]</span><span class="op" id="6217845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217849">i</span><span class="op" id="6217850">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6217854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6217857">close</span><span class="op" id="6217862">(</span><span class="op" id="6217863">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6217867">return</span>&nbsp;<span class="ident" id="6217874">out</span><br>
<span class="lineno"></span><span class="op" id="6217878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6217881">//&nbsp;ToText&nbsp;prepares&nbsp;comment&nbsp;text&nbsp;for&nbsp;presentation&nbsp;in&nbsp;textual&nbsp;output.</span><br>
<span class="lineno">400</span><span class="comment" id="6217949">//&nbsp;It&nbsp;wraps&nbsp;paragraphs&nbsp;of&nbsp;text&nbsp;to&nbsp;width&nbsp;or&nbsp;fewer&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno"></span><span class="comment" id="6218018">//&nbsp;and&nbsp;then&nbsp;prefixes&nbsp;each&nbsp;line&nbsp;with&nbsp;the&nbsp;indent.&nbsp;&nbsp;In&nbsp;preformatted&nbsp;sections</span><br>
<span class="lineno"></span><span class="comment" id="6218092">//&nbsp;(such&nbsp;as&nbsp;program&nbsp;text),&nbsp;it&nbsp;prefixes&nbsp;each&nbsp;non-blank&nbsp;line&nbsp;with&nbsp;preIndent.</span><br>
<span class="lineno"></span><span class="keyword" id="6218167">func</span>&nbsp;<span class="ident" id="6218172">ToText</span><span class="op" id="6218178">(</span><span class="ident" id="6218179">w</span>&nbsp;<span class="ident" id="6218181">io</span><span class="op" id="6218183">.</span><span class="ident" id="6218184">Writer</span><span class="op" id="6218190">,</span>&nbsp;<span class="ident" id="6218192">text</span>&nbsp;<span class="builtintype" id="6218197">string</span><span class="op" id="6218203">,</span>&nbsp;<span class="ident" id="6218205">indent</span><span class="op" id="6218211">,</span>&nbsp;<span class="ident" id="6218213">preIndent</span>&nbsp;<span class="builtintype" id="6218223">string</span><span class="op" id="6218229">,</span>&nbsp;<span class="ident" id="6218231">width</span>&nbsp;<span class="builtintype" id="6218237">int</span><span class="op" id="6218240">)</span>&nbsp;<span class="op" id="6218242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218245">l</span>&nbsp;<span class="op" id="6218247">:=</span>&nbsp;<span class="ident" id="6218250">lineWrapper</span><span class="op" id="6218261">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218265">out</span><span class="op" id="6218268">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6218273">w</span><span class="op" id="6218274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218278">width</span><span class="op" id="6218283">:</span>&nbsp;&nbsp;<span class="ident" id="6218286">width</span><span class="op" id="6218291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218295">indent</span><span class="op" id="6218301">:</span>&nbsp;<span class="ident" id="6218303">indent</span><span class="op" id="6218309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218315">for</span>&nbsp;<span class="ident" id="6218319">_</span><span class="op" id="6218320">,</span>&nbsp;<span class="ident" id="6218322">b</span>&nbsp;<span class="op" id="6218324">:=</span>&nbsp;<span class="keyword" id="6218327">range</span>&nbsp;<span class="ident" id="6218333">blocks</span><span class="op" id="6218339">(</span><span class="ident" id="6218340">text</span><span class="op" id="6218344">)</span>&nbsp;<span class="op" id="6218346">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218350">switch</span>&nbsp;<span class="ident" id="6218357">b</span><span class="op" id="6218358">.</span><span class="ident" id="6218359">op</span>&nbsp;<span class="op" id="6218362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218366">case</span>&nbsp;<span class="ident" id="6218371">opPara</span><span class="op" id="6218377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6218382">//&nbsp;l.write&nbsp;will&nbsp;add&nbsp;leading&nbsp;newline&nbsp;if&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218433">for</span>&nbsp;<span class="ident" id="6218437">_</span><span class="op" id="6218438">,</span>&nbsp;<span class="ident" id="6218440">line</span>&nbsp;<span class="op" id="6218445">:=</span>&nbsp;<span class="keyword" id="6218448">range</span>&nbsp;<span class="ident" id="6218454">b</span><span class="op" id="6218455">.</span><span class="ident" id="6218456">lines</span>&nbsp;<span class="op" id="6218462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218468">l</span><span class="op" id="6218469">.</span><span class="ident" id="6218470">write</span><span class="op" id="6218475">(</span><span class="ident" id="6218476">line</span><span class="op" id="6218480">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218490">l</span><span class="op" id="6218491">.</span><span class="ident" id="6218492">flush</span><span class="op" id="6218497">(</span><span class="op" id="6218498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218502">case</span>&nbsp;<span class="ident" id="6218507">opHead</span><span class="op" id="6218513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218518">w</span><span class="op" id="6218519">.</span><span class="ident" id="6218520">Write</span><span class="op" id="6218525">(</span><span class="ident" id="6218526">nl</span><span class="op" id="6218528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218533">for</span>&nbsp;<span class="ident" id="6218537">_</span><span class="op" id="6218538">,</span>&nbsp;<span class="ident" id="6218540">line</span>&nbsp;<span class="op" id="6218545">:=</span>&nbsp;<span class="keyword" id="6218548">range</span>&nbsp;<span class="ident" id="6218554">b</span><span class="op" id="6218555">.</span><span class="ident" id="6218556">lines</span>&nbsp;<span class="op" id="6218562">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218568">l</span><span class="op" id="6218569">.</span><span class="ident" id="6218570">write</span><span class="op" id="6218575">(</span><span class="ident" id="6218576">line</span>&nbsp;<span class="op" id="6218581">+</span>&nbsp;<span class="string" id="6218583">&#34;\n&#34;</span><span class="op" id="6218587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218597">l</span><span class="op" id="6218598">.</span><span class="ident" id="6218599">flush</span><span class="op" id="6218604">(</span><span class="op" id="6218605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218609">case</span>&nbsp;<span class="ident" id="6218614">opPre</span><span class="op" id="6218619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218624">w</span><span class="op" id="6218625">.</span><span class="ident" id="6218626">Write</span><span class="op" id="6218631">(</span><span class="ident" id="6218632">nl</span><span class="op" id="6218634">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218639">for</span>&nbsp;<span class="ident" id="6218643">_</span><span class="op" id="6218644">,</span>&nbsp;<span class="ident" id="6218646">line</span>&nbsp;<span class="op" id="6218651">:=</span>&nbsp;<span class="keyword" id="6218654">range</span>&nbsp;<span class="ident" id="6218660">b</span><span class="op" id="6218661">.</span><span class="ident" id="6218662">lines</span>&nbsp;<span class="op" id="6218668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218674">if</span>&nbsp;<span class="ident" id="6218677">isBlank</span><span class="op" id="6218684">(</span><span class="ident" id="6218685">line</span><span class="op" id="6218689">)</span>&nbsp;<span class="op" id="6218691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218698">w</span><span class="op" id="6218699">.</span><span class="ident" id="6218700">Write</span><span class="op" id="6218705">(</span><span class="op" id="6218706">[</span><span class="op" id="6218707">]</span><span class="builtintype" id="6218708">byte</span><span class="op" id="6218712">(</span><span class="string" id="6218713">&#34;\n&#34;</span><span class="op" id="6218717">)</span><span class="op" id="6218718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218724">}</span>&nbsp;<span class="keyword" id="6218726">else</span>&nbsp;<span class="op" id="6218731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218738">w</span><span class="op" id="6218739">.</span><span class="ident" id="6218740">Write</span><span class="op" id="6218745">(</span><span class="op" id="6218746">[</span><span class="op" id="6218747">]</span><span class="builtintype" id="6218748">byte</span><span class="op" id="6218752">(</span><span class="ident" id="6218753">preIndent</span><span class="op" id="6218762">)</span><span class="op" id="6218763">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218770">w</span><span class="op" id="6218771">.</span><span class="ident" id="6218772">Write</span><span class="op" id="6218777">(</span><span class="op" id="6218778">[</span><span class="op" id="6218779">]</span><span class="builtintype" id="6218780">byte</span><span class="op" id="6218784">(</span><span class="ident" id="6218785">line</span><span class="op" id="6218789">)</span><span class="op" id="6218790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218808">}</span><br>
<span class="lineno">435</span><span class="op" id="6218810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6218813">type</span>&nbsp;<span class="ident" id="6218818">lineWrapper</span>&nbsp;<span class="keyword" id="6218830">struct</span>&nbsp;<span class="op" id="6218837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218840">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6218850">io</span><span class="op" id="6218852">.</span><span class="ident" id="6218853">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218861">printed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6218871">bool</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218877">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6218887">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218892">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6218902">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218910">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6218920">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218925">pendSpace</span>&nbsp;<span class="builtintype" id="6218935">int</span><br>
<span class="lineno"></span><span class="op" id="6218939">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6218942">var</span>&nbsp;<span class="ident" id="6218946">nl</span>&nbsp;<span class="op" id="6218949">=</span>&nbsp;<span class="op" id="6218951">[</span><span class="op" id="6218952">]</span><span class="builtintype" id="6218953">byte</span><span class="op" id="6218957">(</span><span class="string" id="6218958">&#34;\n&#34;</span><span class="op" id="6218962">)</span><br>
<span class="lineno"></span><span class="keyword" id="6218964">var</span>&nbsp;<span class="ident" id="6218968">space</span>&nbsp;<span class="op" id="6218974">=</span>&nbsp;<span class="op" id="6218976">[</span><span class="op" id="6218977">]</span><span class="builtintype" id="6218978">byte</span><span class="op" id="6218982">(</span><span class="string" id="6218983">&#34;&nbsp;&#34;</span><span class="op" id="6218986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6218989">func</span>&nbsp;<span class="op" id="6218994">(</span><span class="ident" id="6218995">l</span>&nbsp;<span class="op" id="6218997">*</span><span class="ident" id="6218998">lineWrapper</span><span class="op" id="6219009">)</span>&nbsp;<span class="ident" id="6219011">write</span><span class="op" id="6219016">(</span><span class="ident" id="6219017">text</span>&nbsp;<span class="builtintype" id="6219022">string</span><span class="op" id="6219028">)</span>&nbsp;<span class="op" id="6219030">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219033">if</span>&nbsp;<span class="ident" id="6219036">l</span><span class="op" id="6219037">.</span><span class="ident" id="6219038">n</span>&nbsp;<span class="op" id="6219040">==</span>&nbsp;<span class="num" id="6219043">0</span>&nbsp;<span class="op" id="6219045">&amp;&amp;</span>&nbsp;<span class="ident" id="6219048">l</span><span class="op" id="6219049">.</span><span class="ident" id="6219050">printed</span>&nbsp;<span class="op" id="6219058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219062">l</span><span class="op" id="6219063">.</span><span class="ident" id="6219064">out</span><span class="op" id="6219067">.</span><span class="ident" id="6219068">Write</span><span class="op" id="6219073">(</span><span class="ident" id="6219074">nl</span><span class="op" id="6219076">)</span>&nbsp;<span class="comment" id="6219078">//&nbsp;blank&nbsp;line&nbsp;before&nbsp;new&nbsp;paragraph</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219117">l</span><span class="op" id="6219118">.</span><span class="ident" id="6219119">printed</span>&nbsp;<span class="op" id="6219127">=</span>&nbsp;<span class="ident" id="6219129">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219136">for</span>&nbsp;<span class="ident" id="6219140">_</span><span class="op" id="6219141">,</span>&nbsp;<span class="ident" id="6219143">f</span>&nbsp;<span class="op" id="6219145">:=</span>&nbsp;<span class="keyword" id="6219148">range</span>&nbsp;<span class="ident" id="6219154">strings</span><span class="op" id="6219161">.</span><span class="ident" id="6219162">Fields</span><span class="op" id="6219168">(</span><span class="ident" id="6219169">text</span><span class="op" id="6219173">)</span>&nbsp;<span class="op" id="6219175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219179">w</span>&nbsp;<span class="op" id="6219181">:=</span>&nbsp;<span class="ident" id="6219184">utf8</span><span class="op" id="6219188">.</span><span class="ident" id="6219189">RuneCountInString</span><span class="op" id="6219206">(</span><span class="ident" id="6219207">f</span><span class="op" id="6219208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6219212">//&nbsp;wrap&nbsp;if&nbsp;line&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219242">if</span>&nbsp;<span class="ident" id="6219245">l</span><span class="op" id="6219246">.</span><span class="ident" id="6219247">n</span>&nbsp;<span class="op" id="6219249">&gt;</span>&nbsp;<span class="num" id="6219251">0</span>&nbsp;<span class="op" id="6219253">&amp;&amp;</span>&nbsp;<span class="ident" id="6219256">l</span><span class="op" id="6219257">.</span><span class="ident" id="6219258">n</span><span class="op" id="6219259">+</span><span class="ident" id="6219260">l</span><span class="op" id="6219261">.</span><span class="ident" id="6219262">pendSpace</span><span class="op" id="6219271">+</span><span class="ident" id="6219272">w</span>&nbsp;<span class="op" id="6219274">&gt;</span>&nbsp;<span class="ident" id="6219276">l</span><span class="op" id="6219277">.</span><span class="ident" id="6219278">width</span>&nbsp;<span class="op" id="6219284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219289">l</span><span class="op" id="6219290">.</span><span class="ident" id="6219291">out</span><span class="op" id="6219294">.</span><span class="ident" id="6219295">Write</span><span class="op" id="6219300">(</span><span class="ident" id="6219301">nl</span><span class="op" id="6219303">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219308">l</span><span class="op" id="6219309">.</span><span class="ident" id="6219310">n</span>&nbsp;<span class="op" id="6219312">=</span>&nbsp;<span class="num" id="6219314">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219319">l</span><span class="op" id="6219320">.</span><span class="ident" id="6219321">pendSpace</span>&nbsp;<span class="op" id="6219331">=</span>&nbsp;<span class="num" id="6219333">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219341">if</span>&nbsp;<span class="ident" id="6219344">l</span><span class="op" id="6219345">.</span><span class="ident" id="6219346">n</span>&nbsp;<span class="op" id="6219348">==</span>&nbsp;<span class="num" id="6219351">0</span>&nbsp;<span class="op" id="6219353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219358">l</span><span class="op" id="6219359">.</span><span class="ident" id="6219360">out</span><span class="op" id="6219363">.</span><span class="ident" id="6219364">Write</span><span class="op" id="6219369">(</span><span class="op" id="6219370">[</span><span class="op" id="6219371">]</span><span class="builtintype" id="6219372">byte</span><span class="op" id="6219376">(</span><span class="ident" id="6219377">l</span><span class="op" id="6219378">.</span><span class="ident" id="6219379">indent</span><span class="op" id="6219385">)</span><span class="op" id="6219386">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219394">l</span><span class="op" id="6219395">.</span><span class="ident" id="6219396">out</span><span class="op" id="6219399">.</span><span class="ident" id="6219400">Write</span><span class="op" id="6219405">(</span><span class="ident" id="6219406">space</span><span class="op" id="6219411">[</span><span class="op" id="6219412">:</span><span class="ident" id="6219413">l</span><span class="op" id="6219414">.</span><span class="ident" id="6219415">pendSpace</span><span class="op" id="6219424">]</span><span class="op" id="6219425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219429">l</span><span class="op" id="6219430">.</span><span class="ident" id="6219431">out</span><span class="op" id="6219434">.</span><span class="ident" id="6219435">Write</span><span class="op" id="6219440">(</span><span class="op" id="6219441">[</span><span class="op" id="6219442">]</span><span class="builtintype" id="6219443">byte</span><span class="op" id="6219447">(</span><span class="ident" id="6219448">f</span><span class="op" id="6219449">)</span><span class="op" id="6219450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219454">l</span><span class="op" id="6219455">.</span><span class="ident" id="6219456">n</span>&nbsp;<span class="op" id="6219458">+=</span>&nbsp;<span class="ident" id="6219461">l</span><span class="op" id="6219462">.</span><span class="ident" id="6219463">pendSpace</span>&nbsp;<span class="op" id="6219473">+</span>&nbsp;<span class="ident" id="6219475">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219479">l</span><span class="op" id="6219480">.</span><span class="ident" id="6219481">pendSpace</span>&nbsp;<span class="op" id="6219491">=</span>&nbsp;<span class="num" id="6219493">1</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219496">}</span><br>
<span class="lineno"></span><span class="op" id="6219498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6219501">func</span>&nbsp;<span class="op" id="6219506">(</span><span class="ident" id="6219507">l</span>&nbsp;<span class="op" id="6219509">*</span><span class="ident" id="6219510">lineWrapper</span><span class="op" id="6219521">)</span>&nbsp;<span class="ident" id="6219523">flush</span><span class="op" id="6219528">(</span><span class="op" id="6219529">)</span>&nbsp;<span class="op" id="6219531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219534">if</span>&nbsp;<span class="ident" id="6219537">l</span><span class="op" id="6219538">.</span><span class="ident" id="6219539">n</span>&nbsp;<span class="op" id="6219541">==</span>&nbsp;<span class="num" id="6219544">0</span>&nbsp;<span class="op" id="6219546">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219550">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219561">l</span><span class="op" id="6219562">.</span><span class="ident" id="6219563">out</span><span class="op" id="6219566">.</span><span class="ident" id="6219567">Write</span><span class="op" id="6219572">(</span><span class="ident" id="6219573">nl</span><span class="op" id="6219575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219578">l</span><span class="op" id="6219579">.</span><span class="ident" id="6219580">pendSpace</span>&nbsp;<span class="op" id="6219590">=</span>&nbsp;<span class="num" id="6219592">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219595">l</span><span class="op" id="6219596">.</span><span class="ident" id="6219597">n</span>&nbsp;<span class="op" id="6219599">=</span>&nbsp;<span class="num" id="6219601">0</span><br>
<span class="lineno">480</span><span class="op" id="6219603">}</span>
</div>
</body>
</html>
