<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4050100">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4050155">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4050209">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4050260">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="4050335">package</span>&nbsp;<span class="ident" id="4050343">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4050349">import</span>&nbsp;<span class="op" id="4050356">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4050359">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4050369">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4050376">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4050379">func</span>&nbsp;<span class="ident" id="4050384">init</span><span class="op" id="4050388">(</span><span class="op" id="4050389">)</span>&nbsp;<span class="op" id="4050391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050394">crypto</span><span class="op" id="4050400">.</span><span class="ident" id="4050401">RegisterHash</span><span class="op" id="4050413">(</span><span class="ident" id="4050414">crypto</span><span class="op" id="4050420">.</span><span class="ident" id="4050421">SHA1</span><span class="op" id="4050425">,</span>&nbsp;<span class="ident" id="4050427">New</span><span class="op" id="4050430">)</span><br>
<span class="lineno">15</span><span class="op" id="4050432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4050435">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4050476">const</span>&nbsp;<span class="ident" id="4050482">Size</span>&nbsp;<span class="op" id="4050487">=</span>&nbsp;<span class="num" id="4050489">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4050493">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4050528">const</span>&nbsp;<span class="ident" id="4050534">BlockSize</span>&nbsp;<span class="op" id="4050544">=</span>&nbsp;<span class="num" id="4050546">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4050550">const</span>&nbsp;<span class="op" id="4050556">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050559">chunk</span>&nbsp;<span class="op" id="4050565">=</span>&nbsp;<span class="num" id="4050567">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050571">init0</span>&nbsp;<span class="op" id="4050577">=</span>&nbsp;<span class="num" id="4050579">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050591">init1</span>&nbsp;<span class="op" id="4050597">=</span>&nbsp;<span class="num" id="4050599">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050611">init2</span>&nbsp;<span class="op" id="4050617">=</span>&nbsp;<span class="num" id="4050619">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050631">init3</span>&nbsp;<span class="op" id="4050637">=</span>&nbsp;<span class="num" id="4050639">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050651">init4</span>&nbsp;<span class="op" id="4050657">=</span>&nbsp;<span class="num" id="4050659">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="4050670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4050673">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4050732">type</span>&nbsp;<span class="ident" id="4050737">digest</span>&nbsp;<span class="keyword" id="4050744">struct</span>&nbsp;<span class="op" id="4050751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050754">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4050758">[</span><span class="num" id="4050759">5</span><span class="op" id="4050760">]</span><span class="builtintype" id="4050761">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050769">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4050773">[</span><span class="ident" id="4050774">chunk</span><span class="op" id="4050779">]</span><span class="builtintype" id="4050780">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050786">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4050790">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4050795">len</span>&nbsp;<span class="ident" id="4050799">uint64</span><br>
<span class="lineno"></span><span class="op" id="4050806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4050809">func</span>&nbsp;<span class="op" id="4050814">(</span><span class="ident" id="4050815">d</span>&nbsp;<span class="op" id="4050817">*</span><span class="ident" id="4050818">digest</span><span class="op" id="4050824">)</span>&nbsp;<span class="ident" id="4050826">Reset</span><span class="op" id="4050831">(</span><span class="op" id="4050832">)</span>&nbsp;<span class="op" id="4050834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050837">d</span><span class="op" id="4050838">.</span><span class="ident" id="4050839">h</span><span class="op" id="4050840">[</span><span class="num" id="4050841">0</span><span class="op" id="4050842">]</span>&nbsp;<span class="op" id="4050844">=</span>&nbsp;<span class="ident" id="4050846">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050853">d</span><span class="op" id="4050854">.</span><span class="ident" id="4050855">h</span><span class="op" id="4050856">[</span><span class="num" id="4050857">1</span><span class="op" id="4050858">]</span>&nbsp;<span class="op" id="4050860">=</span>&nbsp;<span class="ident" id="4050862">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050869">d</span><span class="op" id="4050870">.</span><span class="ident" id="4050871">h</span><span class="op" id="4050872">[</span><span class="num" id="4050873">2</span><span class="op" id="4050874">]</span>&nbsp;<span class="op" id="4050876">=</span>&nbsp;<span class="ident" id="4050878">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050885">d</span><span class="op" id="4050886">.</span><span class="ident" id="4050887">h</span><span class="op" id="4050888">[</span><span class="num" id="4050889">3</span><span class="op" id="4050890">]</span>&nbsp;<span class="op" id="4050892">=</span>&nbsp;<span class="ident" id="4050894">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050901">d</span><span class="op" id="4050902">.</span><span class="ident" id="4050903">h</span><span class="op" id="4050904">[</span><span class="num" id="4050905">4</span><span class="op" id="4050906">]</span>&nbsp;<span class="op" id="4050908">=</span>&nbsp;<span class="ident" id="4050910">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050917">d</span><span class="op" id="4050918">.</span><span class="ident" id="4050919">nx</span>&nbsp;<span class="op" id="4050922">=</span>&nbsp;<span class="num" id="4050924">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4050927">d</span><span class="op" id="4050928">.</span><span class="builtinfunc" id="4050929">len</span>&nbsp;<span class="op" id="4050933">=</span>&nbsp;<span class="num" id="4050935">0</span><br>
<span class="lineno"></span><span class="op" id="4050937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4050940">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4051000">func</span>&nbsp;<span class="ident" id="4051005">New</span><span class="op" id="4051008">(</span><span class="op" id="4051009">)</span>&nbsp;<span class="ident" id="4051011">hash</span><span class="op" id="4051015">.</span><span class="ident" id="4051016">Hash</span>&nbsp;<span class="op" id="4051021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051024">d</span>&nbsp;<span class="op" id="4051026">:=</span>&nbsp;<span class="builtinfunc" id="4051029">new</span><span class="op" id="4051032">(</span><span class="ident" id="4051033">digest</span><span class="op" id="4051039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051042">d</span><span class="op" id="4051043">.</span><span class="ident" id="4051044">Reset</span><span class="op" id="4051049">(</span><span class="op" id="4051050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051053">return</span>&nbsp;<span class="ident" id="4051060">d</span><br>
<span class="lineno">55</span><span class="op" id="4051062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4051065">func</span>&nbsp;<span class="op" id="4051070">(</span><span class="ident" id="4051071">d</span>&nbsp;<span class="op" id="4051073">*</span><span class="ident" id="4051074">digest</span><span class="op" id="4051080">)</span>&nbsp;<span class="ident" id="4051082">Size</span><span class="op" id="4051086">(</span><span class="op" id="4051087">)</span>&nbsp;<span class="builtintype" id="4051089">int</span>&nbsp;<span class="op" id="4051093">{</span>&nbsp;<span class="keyword" id="4051095">return</span>&nbsp;<span class="ident" id="4051102">Size</span>&nbsp;<span class="op" id="4051107">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4051110">func</span>&nbsp;<span class="op" id="4051115">(</span><span class="ident" id="4051116">d</span>&nbsp;<span class="op" id="4051118">*</span><span class="ident" id="4051119">digest</span><span class="op" id="4051125">)</span>&nbsp;<span class="ident" id="4051127">BlockSize</span><span class="op" id="4051136">(</span><span class="op" id="4051137">)</span>&nbsp;<span class="builtintype" id="4051139">int</span>&nbsp;<span class="op" id="4051143">{</span>&nbsp;<span class="keyword" id="4051145">return</span>&nbsp;<span class="ident" id="4051152">BlockSize</span>&nbsp;<span class="op" id="4051162">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4051165">func</span>&nbsp;<span class="op" id="4051170">(</span><span class="ident" id="4051171">d</span>&nbsp;<span class="op" id="4051173">*</span><span class="ident" id="4051174">digest</span><span class="op" id="4051180">)</span>&nbsp;<span class="ident" id="4051182">Write</span><span class="op" id="4051187">(</span><span class="ident" id="4051188">p</span>&nbsp;<span class="op" id="4051190">[</span><span class="op" id="4051191">]</span><span class="builtintype" id="4051192">byte</span><span class="op" id="4051196">)</span>&nbsp;<span class="op" id="4051198">(</span><span class="ident" id="4051199">nn</span>&nbsp;<span class="builtintype" id="4051202">int</span><span class="op" id="4051205">,</span>&nbsp;<span class="ident" id="4051207">err</span>&nbsp;<span class="builtintype" id="4051211">error</span><span class="op" id="4051216">)</span>&nbsp;<span class="op" id="4051218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051221">nn</span>&nbsp;<span class="op" id="4051224">=</span>&nbsp;<span class="builtinfunc" id="4051226">len</span><span class="op" id="4051229">(</span><span class="ident" id="4051230">p</span><span class="op" id="4051231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051234">d</span><span class="op" id="4051235">.</span><span class="builtinfunc" id="4051236">len</span>&nbsp;<span class="op" id="4051240">+=</span>&nbsp;<span class="ident" id="4051243">uint64</span><span class="op" id="4051249">(</span><span class="ident" id="4051250">nn</span><span class="op" id="4051252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051255">if</span>&nbsp;<span class="ident" id="4051258">d</span><span class="op" id="4051259">.</span><span class="ident" id="4051260">nx</span>&nbsp;<span class="op" id="4051263">&gt;</span>&nbsp;<span class="num" id="4051265">0</span>&nbsp;<span class="op" id="4051267">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051271">n</span>&nbsp;<span class="op" id="4051273">:=</span>&nbsp;<span class="builtinfunc" id="4051276">copy</span><span class="op" id="4051280">(</span><span class="ident" id="4051281">d</span><span class="op" id="4051282">.</span><span class="ident" id="4051283">x</span><span class="op" id="4051284">[</span><span class="ident" id="4051285">d</span><span class="op" id="4051286">.</span><span class="ident" id="4051287">nx</span><span class="op" id="4051289">:</span><span class="op" id="4051290">]</span><span class="op" id="4051291">,</span>&nbsp;<span class="ident" id="4051293">p</span><span class="op" id="4051294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051298">d</span><span class="op" id="4051299">.</span><span class="ident" id="4051300">nx</span>&nbsp;<span class="op" id="4051303">+=</span>&nbsp;<span class="ident" id="4051306">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051310">if</span>&nbsp;<span class="ident" id="4051313">d</span><span class="op" id="4051314">.</span><span class="ident" id="4051315">nx</span>&nbsp;<span class="op" id="4051318">==</span>&nbsp;<span class="ident" id="4051321">chunk</span>&nbsp;<span class="op" id="4051327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051332">block</span><span class="op" id="4051337">(</span><span class="ident" id="4051338">d</span><span class="op" id="4051339">,</span>&nbsp;<span class="ident" id="4051341">d</span><span class="op" id="4051342">.</span><span class="ident" id="4051343">x</span><span class="op" id="4051344">[</span><span class="op" id="4051345">:</span><span class="op" id="4051346">]</span><span class="op" id="4051347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051352">d</span><span class="op" id="4051353">.</span><span class="ident" id="4051354">nx</span>&nbsp;<span class="op" id="4051357">=</span>&nbsp;<span class="num" id="4051359">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4051363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051367">p</span>&nbsp;<span class="op" id="4051369">=</span>&nbsp;<span class="ident" id="4051371">p</span><span class="op" id="4051372">[</span><span class="ident" id="4051373">n</span><span class="op" id="4051374">:</span><span class="op" id="4051375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4051378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051381">if</span>&nbsp;<span class="builtinfunc" id="4051384">len</span><span class="op" id="4051387">(</span><span class="ident" id="4051388">p</span><span class="op" id="4051389">)</span>&nbsp;<span class="op" id="4051391">&gt;=</span>&nbsp;<span class="ident" id="4051394">chunk</span>&nbsp;<span class="op" id="4051400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051404">n</span>&nbsp;<span class="op" id="4051406">:=</span>&nbsp;<span class="builtinfunc" id="4051409">len</span><span class="op" id="4051412">(</span><span class="ident" id="4051413">p</span><span class="op" id="4051414">)</span>&nbsp;<span class="op" id="4051416">&amp;^</span>&nbsp;<span class="op" id="4051419">(</span><span class="ident" id="4051420">chunk</span>&nbsp;<span class="op" id="4051426">-</span>&nbsp;<span class="num" id="4051428">1</span><span class="op" id="4051429">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051433">block</span><span class="op" id="4051438">(</span><span class="ident" id="4051439">d</span><span class="op" id="4051440">,</span>&nbsp;<span class="ident" id="4051442">p</span><span class="op" id="4051443">[</span><span class="op" id="4051444">:</span><span class="ident" id="4051445">n</span><span class="op" id="4051446">]</span><span class="op" id="4051447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051451">p</span>&nbsp;<span class="op" id="4051453">=</span>&nbsp;<span class="ident" id="4051455">p</span><span class="op" id="4051456">[</span><span class="ident" id="4051457">n</span><span class="op" id="4051458">:</span><span class="op" id="4051459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4051462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051465">if</span>&nbsp;<span class="builtinfunc" id="4051468">len</span><span class="op" id="4051471">(</span><span class="ident" id="4051472">p</span><span class="op" id="4051473">)</span>&nbsp;<span class="op" id="4051475">&gt;</span>&nbsp;<span class="num" id="4051477">0</span>&nbsp;<span class="op" id="4051479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051483">d</span><span class="op" id="4051484">.</span><span class="ident" id="4051485">nx</span>&nbsp;<span class="op" id="4051488">=</span>&nbsp;<span class="builtinfunc" id="4051490">copy</span><span class="op" id="4051494">(</span><span class="ident" id="4051495">d</span><span class="op" id="4051496">.</span><span class="ident" id="4051497">x</span><span class="op" id="4051498">[</span><span class="op" id="4051499">:</span><span class="op" id="4051500">]</span><span class="op" id="4051501">,</span>&nbsp;<span class="ident" id="4051503">p</span><span class="op" id="4051504">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4051507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051510">return</span><br>
<span class="lineno"></span><span class="op" id="4051517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4051520">func</span>&nbsp;<span class="op" id="4051525">(</span><span class="ident" id="4051526">d0</span>&nbsp;<span class="op" id="4051529">*</span><span class="ident" id="4051530">digest</span><span class="op" id="4051536">)</span>&nbsp;<span class="ident" id="4051538">Sum</span><span class="op" id="4051541">(</span><span class="ident" id="4051542">in</span>&nbsp;<span class="op" id="4051545">[</span><span class="op" id="4051546">]</span><span class="builtintype" id="4051547">byte</span><span class="op" id="4051551">)</span>&nbsp;<span class="op" id="4051553">[</span><span class="op" id="4051554">]</span><span class="builtintype" id="4051555">byte</span>&nbsp;<span class="op" id="4051560">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4051563">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051630">d</span>&nbsp;<span class="op" id="4051632">:=</span>&nbsp;<span class="op" id="4051635">*</span><span class="ident" id="4051636">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051640">hash</span>&nbsp;<span class="op" id="4051645">:=</span>&nbsp;<span class="ident" id="4051648">d</span><span class="op" id="4051649">.</span><span class="ident" id="4051650">checkSum</span><span class="op" id="4051658">(</span><span class="op" id="4051659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051662">return</span>&nbsp;<span class="builtinfunc" id="4051669">append</span><span class="op" id="4051675">(</span><span class="ident" id="4051676">in</span><span class="op" id="4051678">,</span>&nbsp;<span class="ident" id="4051680">hash</span><span class="op" id="4051684">[</span><span class="op" id="4051685">:</span><span class="op" id="4051686">]</span><span class="op" id="4051687">...</span><span class="op" id="4051690">)</span><br>
<span class="lineno"></span><span class="op" id="4051692">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="4051695">func</span>&nbsp;<span class="op" id="4051700">(</span><span class="ident" id="4051701">d</span>&nbsp;<span class="op" id="4051703">*</span><span class="ident" id="4051704">digest</span><span class="op" id="4051710">)</span>&nbsp;<span class="ident" id="4051712">checkSum</span><span class="op" id="4051720">(</span><span class="op" id="4051721">)</span>&nbsp;<span class="op" id="4051723">[</span><span class="ident" id="4051724">Size</span><span class="op" id="4051728">]</span><span class="builtintype" id="4051729">byte</span>&nbsp;<span class="op" id="4051734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4051737">len</span>&nbsp;<span class="op" id="4051741">:=</span>&nbsp;<span class="ident" id="4051744">d</span><span class="op" id="4051745">.</span><span class="builtinfunc" id="4051746">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4051751">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051811">var</span>&nbsp;<span class="ident" id="4051815">tmp</span>&nbsp;<span class="op" id="4051819">[</span><span class="num" id="4051820">64</span><span class="op" id="4051822">]</span><span class="builtintype" id="4051823">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051829">tmp</span><span class="op" id="4051832">[</span><span class="num" id="4051833">0</span><span class="op" id="4051834">]</span>&nbsp;<span class="op" id="4051836">=</span>&nbsp;<span class="num" id="4051838">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051844">if</span>&nbsp;<span class="builtinfunc" id="4051847">len</span><span class="op" id="4051850">%</span><span class="num" id="4051851">64</span>&nbsp;<span class="op" id="4051854">&lt;</span>&nbsp;<span class="num" id="4051856">56</span>&nbsp;<span class="op" id="4051859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051863">d</span><span class="op" id="4051864">.</span><span class="ident" id="4051865">Write</span><span class="op" id="4051870">(</span><span class="ident" id="4051871">tmp</span><span class="op" id="4051874">[</span><span class="num" id="4051875">0</span>&nbsp;<span class="op" id="4051877">:</span>&nbsp;<span class="num" id="4051879">56</span><span class="op" id="4051881">-</span><span class="builtinfunc" id="4051882">len</span><span class="op" id="4051885">%</span><span class="num" id="4051886">64</span><span class="op" id="4051888">]</span><span class="op" id="4051889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4051892">}</span>&nbsp;<span class="keyword" id="4051894">else</span>&nbsp;<span class="op" id="4051899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4051903">d</span><span class="op" id="4051904">.</span><span class="ident" id="4051905">Write</span><span class="op" id="4051910">(</span><span class="ident" id="4051911">tmp</span><span class="op" id="4051914">[</span><span class="num" id="4051915">0</span>&nbsp;<span class="op" id="4051917">:</span>&nbsp;<span class="num" id="4051919">64</span><span class="op" id="4051921">+</span><span class="num" id="4051922">56</span><span class="op" id="4051924">-</span><span class="builtinfunc" id="4051925">len</span><span class="op" id="4051928">%</span><span class="num" id="4051929">64</span><span class="op" id="4051931">]</span><span class="op" id="4051932">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4051935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4051939">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4051959">len</span>&nbsp;<span class="op" id="4051963">&lt;&lt;=</span>&nbsp;<span class="num" id="4051967">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4051970">for</span>&nbsp;<span class="ident" id="4051974">i</span>&nbsp;<span class="op" id="4051976">:=</span>&nbsp;<span class="builtintype" id="4051979">uint</span><span class="op" id="4051983">(</span><span class="num" id="4051984">0</span><span class="op" id="4051985">)</span><span class="op" id="4051986">;</span>&nbsp;<span class="ident" id="4051988">i</span>&nbsp;<span class="op" id="4051990">&lt;</span>&nbsp;<span class="num" id="4051992">8</span><span class="op" id="4051993">;</span>&nbsp;<span class="ident" id="4051995">i</span><span class="op" id="4051996">++</span>&nbsp;<span class="op" id="4051999">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052003">tmp</span><span class="op" id="4052006">[</span><span class="ident" id="4052007">i</span><span class="op" id="4052008">]</span>&nbsp;<span class="op" id="4052010">=</span>&nbsp;<span class="builtintype" id="4052012">byte</span><span class="op" id="4052016">(</span><span class="builtinfunc" id="4052017">len</span>&nbsp;<span class="op" id="4052021">&gt;&gt;</span>&nbsp;<span class="op" id="4052024">(</span><span class="num" id="4052025">56</span>&nbsp;<span class="op" id="4052028">-</span>&nbsp;<span class="num" id="4052030">8</span><span class="op" id="4052031">*</span><span class="ident" id="4052032">i</span><span class="op" id="4052033">)</span><span class="op" id="4052034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4052037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052040">d</span><span class="op" id="4052041">.</span><span class="ident" id="4052042">Write</span><span class="op" id="4052047">(</span><span class="ident" id="4052048">tmp</span><span class="op" id="4052051">[</span><span class="num" id="4052052">0</span><span class="op" id="4052053">:</span><span class="num" id="4052054">8</span><span class="op" id="4052055">]</span><span class="op" id="4052056">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4052060">if</span>&nbsp;<span class="ident" id="4052063">d</span><span class="op" id="4052064">.</span><span class="ident" id="4052065">nx</span>&nbsp;<span class="op" id="4052068">!=</span>&nbsp;<span class="num" id="4052071">0</span>&nbsp;<span class="op" id="4052073">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4052077">panic</span><span class="op" id="4052082">(</span><span class="string" id="4052083">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4052094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4052097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4052101">var</span>&nbsp;<span class="ident" id="4052105">digest</span>&nbsp;<span class="op" id="4052112">[</span><span class="ident" id="4052113">Size</span><span class="op" id="4052117">]</span><span class="builtintype" id="4052118">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4052124">for</span>&nbsp;<span class="ident" id="4052128">i</span><span class="op" id="4052129">,</span>&nbsp;<span class="ident" id="4052131">s</span>&nbsp;<span class="op" id="4052133">:=</span>&nbsp;<span class="keyword" id="4052136">range</span>&nbsp;<span class="ident" id="4052142">d</span><span class="op" id="4052143">.</span><span class="ident" id="4052144">h</span>&nbsp;<span class="op" id="4052146">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052150">digest</span><span class="op" id="4052156">[</span><span class="ident" id="4052157">i</span><span class="op" id="4052158">*</span><span class="num" id="4052159">4</span><span class="op" id="4052160">]</span>&nbsp;<span class="op" id="4052162">=</span>&nbsp;<span class="builtintype" id="4052164">byte</span><span class="op" id="4052168">(</span><span class="ident" id="4052169">s</span>&nbsp;<span class="op" id="4052171">&gt;&gt;</span>&nbsp;<span class="num" id="4052174">24</span><span class="op" id="4052176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052180">digest</span><span class="op" id="4052186">[</span><span class="ident" id="4052187">i</span><span class="op" id="4052188">*</span><span class="num" id="4052189">4</span><span class="op" id="4052190">+</span><span class="num" id="4052191">1</span><span class="op" id="4052192">]</span>&nbsp;<span class="op" id="4052194">=</span>&nbsp;<span class="builtintype" id="4052196">byte</span><span class="op" id="4052200">(</span><span class="ident" id="4052201">s</span>&nbsp;<span class="op" id="4052203">&gt;&gt;</span>&nbsp;<span class="num" id="4052206">16</span><span class="op" id="4052208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052212">digest</span><span class="op" id="4052218">[</span><span class="ident" id="4052219">i</span><span class="op" id="4052220">*</span><span class="num" id="4052221">4</span><span class="op" id="4052222">+</span><span class="num" id="4052223">2</span><span class="op" id="4052224">]</span>&nbsp;<span class="op" id="4052226">=</span>&nbsp;<span class="builtintype" id="4052228">byte</span><span class="op" id="4052232">(</span><span class="ident" id="4052233">s</span>&nbsp;<span class="op" id="4052235">&gt;&gt;</span>&nbsp;<span class="num" id="4052238">8</span><span class="op" id="4052239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052243">digest</span><span class="op" id="4052249">[</span><span class="ident" id="4052250">i</span><span class="op" id="4052251">*</span><span class="num" id="4052252">4</span><span class="op" id="4052253">+</span><span class="num" id="4052254">3</span><span class="op" id="4052255">]</span>&nbsp;<span class="op" id="4052257">=</span>&nbsp;<span class="builtintype" id="4052259">byte</span><span class="op" id="4052263">(</span><span class="ident" id="4052264">s</span><span class="op" id="4052265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4052268">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4052272">return</span>&nbsp;<span class="ident" id="4052279">digest</span><br>
<span class="lineno"></span><span class="op" id="4052286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4052289">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="4052335">func</span>&nbsp;<span class="ident" id="4052340">Sum</span><span class="op" id="4052343">(</span><span class="ident" id="4052344">data</span>&nbsp;<span class="op" id="4052349">[</span><span class="op" id="4052350">]</span><span class="builtintype" id="4052351">byte</span><span class="op" id="4052355">)</span>&nbsp;<span class="op" id="4052357">[</span><span class="ident" id="4052358">Size</span><span class="op" id="4052362">]</span><span class="builtintype" id="4052363">byte</span>&nbsp;<span class="op" id="4052368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4052371">var</span>&nbsp;<span class="ident" id="4052375">d</span>&nbsp;<span class="ident" id="4052377">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052385">d</span><span class="op" id="4052386">.</span><span class="ident" id="4052387">Reset</span><span class="op" id="4052392">(</span><span class="op" id="4052393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4052396">d</span><span class="op" id="4052397">.</span><span class="ident" id="4052398">Write</span><span class="op" id="4052403">(</span><span class="ident" id="4052404">data</span><span class="op" id="4052408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4052411">return</span>&nbsp;<span class="ident" id="4052418">d</span><span class="op" id="4052419">.</span><span class="ident" id="4052420">checkSum</span><span class="op" id="4052428">(</span><span class="op" id="4052429">)</span><br>
<span class="lineno">130</span><span class="op" id="4052431">}</span>
</div>
</body>
</html>
