<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp</h2>
<ul>
<li><a href="/gostd/regexp/all_test.go.html">all_test.go</a></li>
<li><a href="/gostd/regexp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/regexp/exec.go.html">exec.go</a></li>
<li><a href="/gostd/regexp/exec2_test.go.html">exec2_test.go</a></li>
<li><a href="/gostd/regexp/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/regexp/find_test.go.html">find_test.go</a></li>
<li><a href="/gostd/regexp/onepass.go.html">onepass.go</a></li>
<li><a href="/gostd/regexp/onepass_test.go.html">onepass_test.go</a></li>
<li><a href="/gostd/regexp/regexp.go.html">regexp.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5485067">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5485122">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5485176">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5485227">package</span>&nbsp;<span class="ident" id="5485235">regexp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5485243">import</span>&nbsp;<span class="op" id="5485250">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5485253">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5485259">&#34;regexp/syntax&#34;</span><br>
<span class="lineno">10</span><span class="op" id="5485275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485278">//&nbsp;A&nbsp;queue&nbsp;is&nbsp;a&nbsp;&#39;sparse&nbsp;array&#39;&nbsp;holding&nbsp;pending&nbsp;threads&nbsp;of&nbsp;execution.</span><br>
<span class="lineno"></span><span class="comment" id="5485347">//&nbsp;See&nbsp;http://research.swtch.com/2008/03/using-uninitialized-memory-for-fun-and.html</span><br>
<span class="lineno"></span><span class="keyword" id="5485432">type</span>&nbsp;<span class="ident" id="5485437">queue</span>&nbsp;<span class="keyword" id="5485443">struct</span>&nbsp;<span class="op" id="5485450">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485453">sparse</span>&nbsp;<span class="op" id="5485460">[</span><span class="op" id="5485461">]</span><span class="builtintype" id="5485462">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485470">dense</span>&nbsp;&nbsp;<span class="op" id="5485477">[</span><span class="op" id="5485478">]</span><span class="ident" id="5485479">entry</span><br>
<span class="lineno"></span><span class="op" id="5485485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485488">//&nbsp;A&nbsp;entry&nbsp;is&nbsp;an&nbsp;entry&nbsp;on&nbsp;a&nbsp;queue.</span><br>
<span class="lineno">20</span><span class="comment" id="5485523">//&nbsp;It&nbsp;holds&nbsp;both&nbsp;the&nbsp;instruction&nbsp;pc&nbsp;and&nbsp;the&nbsp;actual&nbsp;thread.</span><br>
<span class="lineno"></span><span class="comment" id="5485582">//&nbsp;Some&nbsp;queue&nbsp;entries&nbsp;are&nbsp;just&nbsp;place&nbsp;holders&nbsp;so&nbsp;that&nbsp;the&nbsp;machine</span><br>
<span class="lineno"></span><span class="comment" id="5485647">//&nbsp;knows&nbsp;it&nbsp;has&nbsp;considered&nbsp;that&nbsp;pc.&nbsp;&nbsp;Such&nbsp;entries&nbsp;have&nbsp;t&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5485712">type</span>&nbsp;<span class="ident" id="5485717">entry</span>&nbsp;<span class="keyword" id="5485723">struct</span>&nbsp;<span class="op" id="5485730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485733">pc</span>&nbsp;<span class="builtintype" id="5485736">uint32</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485744">t</span>&nbsp;&nbsp;<span class="op" id="5485747">*</span><span class="ident" id="5485748">thread</span><br>
<span class="lineno"></span><span class="op" id="5485755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5485758">//&nbsp;A&nbsp;thread&nbsp;is&nbsp;the&nbsp;state&nbsp;of&nbsp;a&nbsp;single&nbsp;path&nbsp;through&nbsp;the&nbsp;machine:</span><br>
<span class="lineno"></span><span class="comment" id="5485821">//&nbsp;an&nbsp;instruction&nbsp;and&nbsp;a&nbsp;corresponding&nbsp;capture&nbsp;array.</span><br>
<span class="lineno">30</span><span class="comment" id="5485874">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp2.html</span><br>
<span class="lineno"></span><span class="keyword" id="5485923">type</span>&nbsp;<span class="ident" id="5485928">thread</span>&nbsp;<span class="keyword" id="5485935">struct</span>&nbsp;<span class="op" id="5485942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5485945">inst</span>&nbsp;<span class="op" id="5485950">*</span><span class="ident" id="5485951">syntax</span><span class="op" id="5485957">.</span><span class="ident" id="5485958">Inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5485964">cap</span>&nbsp;&nbsp;<span class="op" id="5485969">[</span><span class="op" id="5485970">]</span><span class="builtintype" id="5485971">int</span><br>
<span class="lineno"></span><span class="op" id="5485975">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="5485978">//&nbsp;A&nbsp;machine&nbsp;holds&nbsp;all&nbsp;the&nbsp;state&nbsp;during&nbsp;an&nbsp;NFA&nbsp;simulation&nbsp;for&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="5486043">type</span>&nbsp;<span class="ident" id="5486048">machine</span>&nbsp;<span class="keyword" id="5486056">struct</span>&nbsp;<span class="op" id="5486063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486066">re</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486075">*</span><span class="ident" id="5486076">Regexp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486088">//&nbsp;corresponding&nbsp;Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486113">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486122">*</span><span class="ident" id="5486123">syntax</span><span class="op" id="5486129">.</span><span class="ident" id="5486130">Prog</span>&nbsp;<span class="comment" id="5486135">//&nbsp;compiled&nbsp;program</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486156">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486165">*</span><span class="ident" id="5486166">onePassProg</span>&nbsp;<span class="comment" id="5486178">//&nbsp;compiled&nbsp;onepass&nbsp;program,&nbsp;or&nbsp;notOnePass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486222">q0</span><span class="op" id="5486224">,</span>&nbsp;<span class="ident" id="5486226">q1</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5486231">queue</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486244">//&nbsp;two&nbsp;queues&nbsp;for&nbsp;runq,&nbsp;nextq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486275">pool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5486284">[</span><span class="op" id="5486285">]</span><span class="op" id="5486286">*</span><span class="ident" id="5486287">thread</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486297">//&nbsp;pool&nbsp;of&nbsp;available&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486327">matched</span>&nbsp;&nbsp;<span class="builtintype" id="5486336">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486349">//&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486379">matchcap</span>&nbsp;<span class="op" id="5486388">[</span><span class="op" id="5486389">]</span><span class="builtintype" id="5486390">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5486401">//&nbsp;capture&nbsp;information&nbsp;for&nbsp;the&nbsp;match</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5486440">//&nbsp;cached&nbsp;inputs,&nbsp;to&nbsp;avoid&nbsp;allocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486479">inputBytes</span>&nbsp;&nbsp;<span class="ident" id="5486491">inputBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486503">inputString</span>&nbsp;<span class="ident" id="5486515">inputString</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486528">inputReader</span>&nbsp;<span class="ident" id="5486540">inputReader</span><br>
<span class="lineno">50</span><span class="op" id="5486552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5486555">func</span>&nbsp;<span class="op" id="5486560">(</span><span class="ident" id="5486561">m</span>&nbsp;<span class="op" id="5486563">*</span><span class="ident" id="5486564">machine</span><span class="op" id="5486571">)</span>&nbsp;<span class="ident" id="5486573">newInputBytes</span><span class="op" id="5486586">(</span><span class="ident" id="5486587">b</span>&nbsp;<span class="op" id="5486589">[</span><span class="op" id="5486590">]</span><span class="builtintype" id="5486591">byte</span><span class="op" id="5486595">)</span>&nbsp;<span class="ident" id="5486597">input</span>&nbsp;<span class="op" id="5486603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486606">m</span><span class="op" id="5486607">.</span><span class="ident" id="5486608">inputBytes</span><span class="op" id="5486618">.</span><span class="ident" id="5486619">str</span>&nbsp;<span class="op" id="5486623">=</span>&nbsp;<span class="ident" id="5486625">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486628">return</span>&nbsp;<span class="op" id="5486635">&amp;</span><span class="ident" id="5486636">m</span><span class="op" id="5486637">.</span><span class="ident" id="5486638">inputBytes</span><br>
<span class="lineno">55</span><span class="op" id="5486649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5486652">func</span>&nbsp;<span class="op" id="5486657">(</span><span class="ident" id="5486658">m</span>&nbsp;<span class="op" id="5486660">*</span><span class="ident" id="5486661">machine</span><span class="op" id="5486668">)</span>&nbsp;<span class="ident" id="5486670">newInputString</span><span class="op" id="5486684">(</span><span class="ident" id="5486685">s</span>&nbsp;<span class="builtintype" id="5486687">string</span><span class="op" id="5486693">)</span>&nbsp;<span class="ident" id="5486695">input</span>&nbsp;<span class="op" id="5486701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486704">m</span><span class="op" id="5486705">.</span><span class="ident" id="5486706">inputString</span><span class="op" id="5486717">.</span><span class="ident" id="5486718">str</span>&nbsp;<span class="op" id="5486722">=</span>&nbsp;<span class="ident" id="5486724">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486727">return</span>&nbsp;<span class="op" id="5486734">&amp;</span><span class="ident" id="5486735">m</span><span class="op" id="5486736">.</span><span class="ident" id="5486737">inputString</span><br>
<span class="lineno">60</span><span class="op" id="5486749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5486752">func</span>&nbsp;<span class="op" id="5486757">(</span><span class="ident" id="5486758">m</span>&nbsp;<span class="op" id="5486760">*</span><span class="ident" id="5486761">machine</span><span class="op" id="5486768">)</span>&nbsp;<span class="ident" id="5486770">newInputReader</span><span class="op" id="5486784">(</span><span class="ident" id="5486785">r</span>&nbsp;<span class="ident" id="5486787">io</span><span class="op" id="5486789">.</span><span class="ident" id="5486790">RuneReader</span><span class="op" id="5486800">)</span>&nbsp;<span class="ident" id="5486802">input</span>&nbsp;<span class="op" id="5486808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486811">m</span><span class="op" id="5486812">.</span><span class="ident" id="5486813">inputReader</span><span class="op" id="5486824">.</span><span class="ident" id="5486825">r</span>&nbsp;<span class="op" id="5486827">=</span>&nbsp;<span class="ident" id="5486829">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486832">m</span><span class="op" id="5486833">.</span><span class="ident" id="5486834">inputReader</span><span class="op" id="5486845">.</span><span class="ident" id="5486846">atEOT</span>&nbsp;<span class="op" id="5486852">=</span>&nbsp;<span class="builtintype" id="5486854">false</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5486861">m</span><span class="op" id="5486862">.</span><span class="ident" id="5486863">inputReader</span><span class="op" id="5486874">.</span><span class="ident" id="5486875">pos</span>&nbsp;<span class="op" id="5486879">=</span>&nbsp;<span class="num" id="5486881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5486884">return</span>&nbsp;<span class="op" id="5486891">&amp;</span><span class="ident" id="5486892">m</span><span class="op" id="5486893">.</span><span class="ident" id="5486894">inputReader</span><br>
<span class="lineno"></span><span class="op" id="5486906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5486909">//&nbsp;progMachine&nbsp;returns&nbsp;a&nbsp;new&nbsp;machine&nbsp;running&nbsp;the&nbsp;prog&nbsp;p.</span><br>
<span class="lineno">70</span><span class="keyword" id="5486966">func</span>&nbsp;<span class="ident" id="5486971">progMachine</span><span class="op" id="5486982">(</span><span class="ident" id="5486983">p</span>&nbsp;<span class="op" id="5486985">*</span><span class="ident" id="5486986">syntax</span><span class="op" id="5486992">.</span><span class="ident" id="5486993">Prog</span><span class="op" id="5486997">,</span>&nbsp;<span class="ident" id="5486999">op</span>&nbsp;<span class="op" id="5487002">*</span><span class="ident" id="5487003">onePassProg</span><span class="op" id="5487014">)</span>&nbsp;<span class="op" id="5487016">*</span><span class="ident" id="5487017">machine</span>&nbsp;<span class="op" id="5487025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487028">m</span>&nbsp;<span class="op" id="5487030">:=</span>&nbsp;<span class="op" id="5487033">&amp;</span><span class="ident" id="5487034">machine</span><span class="op" id="5487041">{</span><span class="ident" id="5487042">p</span><span class="op" id="5487043">:</span>&nbsp;<span class="ident" id="5487045">p</span><span class="op" id="5487046">,</span>&nbsp;<span class="ident" id="5487048">op</span><span class="op" id="5487050">:</span>&nbsp;<span class="ident" id="5487052">op</span><span class="op" id="5487054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487057">n</span>&nbsp;<span class="op" id="5487059">:=</span>&nbsp;<span class="builtinfunc" id="5487062">len</span><span class="op" id="5487065">(</span><span class="ident" id="5487066">m</span><span class="op" id="5487067">.</span><span class="ident" id="5487068">p</span><span class="op" id="5487069">.</span><span class="ident" id="5487070">Inst</span><span class="op" id="5487074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487077">m</span><span class="op" id="5487078">.</span><span class="ident" id="5487079">q0</span>&nbsp;<span class="op" id="5487082">=</span>&nbsp;<span class="ident" id="5487084">queue</span><span class="op" id="5487089">{</span><span class="builtinfunc" id="5487090">make</span><span class="op" id="5487094">(</span><span class="op" id="5487095">[</span><span class="op" id="5487096">]</span><span class="builtintype" id="5487097">uint32</span><span class="op" id="5487103">,</span>&nbsp;<span class="ident" id="5487105">n</span><span class="op" id="5487106">)</span><span class="op" id="5487107">,</span>&nbsp;<span class="builtinfunc" id="5487109">make</span><span class="op" id="5487113">(</span><span class="op" id="5487114">[</span><span class="op" id="5487115">]</span><span class="ident" id="5487116">entry</span><span class="op" id="5487121">,</span>&nbsp;<span class="num" id="5487123">0</span><span class="op" id="5487124">,</span>&nbsp;<span class="ident" id="5487126">n</span><span class="op" id="5487127">)</span><span class="op" id="5487128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487131">m</span><span class="op" id="5487132">.</span><span class="ident" id="5487133">q1</span>&nbsp;<span class="op" id="5487136">=</span>&nbsp;<span class="ident" id="5487138">queue</span><span class="op" id="5487143">{</span><span class="builtinfunc" id="5487144">make</span><span class="op" id="5487148">(</span><span class="op" id="5487149">[</span><span class="op" id="5487150">]</span><span class="builtintype" id="5487151">uint32</span><span class="op" id="5487157">,</span>&nbsp;<span class="ident" id="5487159">n</span><span class="op" id="5487160">)</span><span class="op" id="5487161">,</span>&nbsp;<span class="builtinfunc" id="5487163">make</span><span class="op" id="5487167">(</span><span class="op" id="5487168">[</span><span class="op" id="5487169">]</span><span class="ident" id="5487170">entry</span><span class="op" id="5487175">,</span>&nbsp;<span class="num" id="5487177">0</span><span class="op" id="5487178">,</span>&nbsp;<span class="ident" id="5487180">n</span><span class="op" id="5487181">)</span><span class="op" id="5487182">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487185">ncap</span>&nbsp;<span class="op" id="5487190">:=</span>&nbsp;<span class="ident" id="5487193">p</span><span class="op" id="5487194">.</span><span class="ident" id="5487195">NumCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487203">if</span>&nbsp;<span class="ident" id="5487206">ncap</span>&nbsp;<span class="op" id="5487211">&lt;</span>&nbsp;<span class="num" id="5487213">2</span>&nbsp;<span class="op" id="5487215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487219">ncap</span>&nbsp;<span class="op" id="5487224">=</span>&nbsp;<span class="num" id="5487226">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487232">m</span><span class="op" id="5487233">.</span><span class="ident" id="5487234">matchcap</span>&nbsp;<span class="op" id="5487243">=</span>&nbsp;<span class="builtinfunc" id="5487245">make</span><span class="op" id="5487249">(</span><span class="op" id="5487250">[</span><span class="op" id="5487251">]</span><span class="builtintype" id="5487252">int</span><span class="op" id="5487255">,</span>&nbsp;<span class="ident" id="5487257">ncap</span><span class="op" id="5487261">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487264">return</span>&nbsp;<span class="ident" id="5487271">m</span><br>
<span class="lineno"></span><span class="op" id="5487273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5487276">func</span>&nbsp;<span class="op" id="5487281">(</span><span class="ident" id="5487282">m</span>&nbsp;<span class="op" id="5487284">*</span><span class="ident" id="5487285">machine</span><span class="op" id="5487292">)</span>&nbsp;<span class="ident" id="5487294">init</span><span class="op" id="5487298">(</span><span class="ident" id="5487299">ncap</span>&nbsp;<span class="builtintype" id="5487304">int</span><span class="op" id="5487307">)</span>&nbsp;<span class="op" id="5487309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487312">for</span>&nbsp;<span class="ident" id="5487316">_</span><span class="op" id="5487317">,</span>&nbsp;<span class="ident" id="5487319">t</span>&nbsp;<span class="op" id="5487321">:=</span>&nbsp;<span class="keyword" id="5487324">range</span>&nbsp;<span class="ident" id="5487330">m</span><span class="op" id="5487331">.</span><span class="ident" id="5487332">pool</span>&nbsp;<span class="op" id="5487337">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487341">t</span><span class="op" id="5487342">.</span><span class="builtinfunc" id="5487343">cap</span>&nbsp;<span class="op" id="5487347">=</span>&nbsp;<span class="ident" id="5487349">t</span><span class="op" id="5487350">.</span><span class="builtinfunc" id="5487351">cap</span><span class="op" id="5487354">[</span><span class="op" id="5487355">:</span><span class="ident" id="5487356">ncap</span><span class="op" id="5487360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487366">m</span><span class="op" id="5487367">.</span><span class="ident" id="5487368">matchcap</span>&nbsp;<span class="op" id="5487377">=</span>&nbsp;<span class="ident" id="5487379">m</span><span class="op" id="5487380">.</span><span class="ident" id="5487381">matchcap</span><span class="op" id="5487389">[</span><span class="op" id="5487390">:</span><span class="ident" id="5487391">ncap</span><span class="op" id="5487395">]</span><br>
<span class="lineno"></span><span class="op" id="5487397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5487400">//&nbsp;alloc&nbsp;allocates&nbsp;a&nbsp;new&nbsp;thread&nbsp;with&nbsp;the&nbsp;given&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5487460">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;free&nbsp;pool&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span><span class="keyword" id="5487498">func</span>&nbsp;<span class="op" id="5487503">(</span><span class="ident" id="5487504">m</span>&nbsp;<span class="op" id="5487506">*</span><span class="ident" id="5487507">machine</span><span class="op" id="5487514">)</span>&nbsp;<span class="ident" id="5487516">alloc</span><span class="op" id="5487521">(</span><span class="ident" id="5487522">i</span>&nbsp;<span class="op" id="5487524">*</span><span class="ident" id="5487525">syntax</span><span class="op" id="5487531">.</span><span class="ident" id="5487532">Inst</span><span class="op" id="5487536">)</span>&nbsp;<span class="op" id="5487538">*</span><span class="ident" id="5487539">thread</span>&nbsp;<span class="op" id="5487546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487549">var</span>&nbsp;<span class="ident" id="5487553">t</span>&nbsp;<span class="op" id="5487555">*</span><span class="ident" id="5487556">thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487564">if</span>&nbsp;<span class="ident" id="5487567">n</span>&nbsp;<span class="op" id="5487569">:=</span>&nbsp;<span class="builtinfunc" id="5487572">len</span><span class="op" id="5487575">(</span><span class="ident" id="5487576">m</span><span class="op" id="5487577">.</span><span class="ident" id="5487578">pool</span><span class="op" id="5487582">)</span><span class="op" id="5487583">;</span>&nbsp;<span class="ident" id="5487585">n</span>&nbsp;<span class="op" id="5487587">&gt;</span>&nbsp;<span class="num" id="5487589">0</span>&nbsp;<span class="op" id="5487591">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487595">t</span>&nbsp;<span class="op" id="5487597">=</span>&nbsp;<span class="ident" id="5487599">m</span><span class="op" id="5487600">.</span><span class="ident" id="5487601">pool</span><span class="op" id="5487605">[</span><span class="ident" id="5487606">n</span><span class="op" id="5487607">-</span><span class="num" id="5487608">1</span><span class="op" id="5487609">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487613">m</span><span class="op" id="5487614">.</span><span class="ident" id="5487615">pool</span>&nbsp;<span class="op" id="5487620">=</span>&nbsp;<span class="ident" id="5487622">m</span><span class="op" id="5487623">.</span><span class="ident" id="5487624">pool</span><span class="op" id="5487628">[</span><span class="op" id="5487629">:</span><span class="ident" id="5487630">n</span><span class="op" id="5487631">-</span><span class="num" id="5487632">1</span><span class="op" id="5487633">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487636">}</span>&nbsp;<span class="keyword" id="5487638">else</span>&nbsp;<span class="op" id="5487643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487647">t</span>&nbsp;<span class="op" id="5487649">=</span>&nbsp;<span class="builtinfunc" id="5487651">new</span><span class="op" id="5487654">(</span><span class="ident" id="5487655">thread</span><span class="op" id="5487661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487665">t</span><span class="op" id="5487666">.</span><span class="builtinfunc" id="5487667">cap</span>&nbsp;<span class="op" id="5487671">=</span>&nbsp;<span class="builtinfunc" id="5487673">make</span><span class="op" id="5487677">(</span><span class="op" id="5487678">[</span><span class="op" id="5487679">]</span><span class="builtintype" id="5487680">int</span><span class="op" id="5487683">,</span>&nbsp;<span class="builtinfunc" id="5487685">len</span><span class="op" id="5487688">(</span><span class="ident" id="5487689">m</span><span class="op" id="5487690">.</span><span class="ident" id="5487691">matchcap</span><span class="op" id="5487699">)</span><span class="op" id="5487700">,</span>&nbsp;<span class="builtinfunc" id="5487702">cap</span><span class="op" id="5487705">(</span><span class="ident" id="5487706">m</span><span class="op" id="5487707">.</span><span class="ident" id="5487708">matchcap</span><span class="op" id="5487716">)</span><span class="op" id="5487717">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5487720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487723">t</span><span class="op" id="5487724">.</span><span class="ident" id="5487725">inst</span>&nbsp;<span class="op" id="5487730">=</span>&nbsp;<span class="ident" id="5487732">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5487735">return</span>&nbsp;<span class="ident" id="5487742">t</span><br>
<span class="lineno"></span><span class="op" id="5487744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5487747">//&nbsp;free&nbsp;returns&nbsp;t&nbsp;to&nbsp;the&nbsp;free&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="5487783">func</span>&nbsp;<span class="op" id="5487788">(</span><span class="ident" id="5487789">m</span>&nbsp;<span class="op" id="5487791">*</span><span class="ident" id="5487792">machine</span><span class="op" id="5487799">)</span>&nbsp;<span class="ident" id="5487801">free</span><span class="op" id="5487805">(</span><span class="ident" id="5487806">t</span>&nbsp;<span class="op" id="5487808">*</span><span class="ident" id="5487809">thread</span><span class="op" id="5487815">)</span>&nbsp;<span class="op" id="5487817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487820">m</span><span class="op" id="5487821">.</span><span class="ident" id="5487822">inputBytes</span><span class="op" id="5487832">.</span><span class="ident" id="5487833">str</span>&nbsp;<span class="op" id="5487837">=</span>&nbsp;<span class="ident" id="5487839">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487844">m</span><span class="op" id="5487845">.</span><span class="ident" id="5487846">inputString</span><span class="op" id="5487857">.</span><span class="ident" id="5487858">str</span>&nbsp;<span class="op" id="5487862">=</span>&nbsp;<span class="string" id="5487864">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487868">m</span><span class="op" id="5487869">.</span><span class="ident" id="5487870">inputReader</span><span class="op" id="5487881">.</span><span class="ident" id="5487882">r</span>&nbsp;<span class="op" id="5487884">=</span>&nbsp;<span class="ident" id="5487886">nil</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5487891">m</span><span class="op" id="5487892">.</span><span class="ident" id="5487893">pool</span>&nbsp;<span class="op" id="5487898">=</span>&nbsp;<span class="builtinfunc" id="5487900">append</span><span class="op" id="5487906">(</span><span class="ident" id="5487907">m</span><span class="op" id="5487908">.</span><span class="ident" id="5487909">pool</span><span class="op" id="5487913">,</span>&nbsp;<span class="ident" id="5487915">t</span><span class="op" id="5487916">)</span><br>
<span class="lineno"></span><span class="op" id="5487918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5487921">//&nbsp;match&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5487979">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno">115</span><span class="comment" id="5488020">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5488073">func</span>&nbsp;<span class="op" id="5488078">(</span><span class="ident" id="5488079">m</span>&nbsp;<span class="op" id="5488081">*</span><span class="ident" id="5488082">machine</span><span class="op" id="5488089">)</span>&nbsp;<span class="ident" id="5488091">match</span><span class="op" id="5488096">(</span><span class="ident" id="5488097">i</span>&nbsp;<span class="ident" id="5488099">input</span><span class="op" id="5488104">,</span>&nbsp;<span class="ident" id="5488106">pos</span>&nbsp;<span class="builtintype" id="5488110">int</span><span class="op" id="5488113">)</span>&nbsp;<span class="builtintype" id="5488115">bool</span>&nbsp;<span class="op" id="5488120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488123">startCond</span>&nbsp;<span class="op" id="5488133">:=</span>&nbsp;<span class="ident" id="5488136">m</span><span class="op" id="5488137">.</span><span class="ident" id="5488138">re</span><span class="op" id="5488140">.</span><span class="ident" id="5488141">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488147">if</span>&nbsp;<span class="ident" id="5488150">startCond</span>&nbsp;<span class="op" id="5488160">==</span>&nbsp;<span class="op" id="5488163">^</span><span class="ident" id="5488164">syntax</span><span class="op" id="5488170">.</span><span class="ident" id="5488171">EmptyOp</span><span class="op" id="5488178">(</span><span class="num" id="5488179">0</span><span class="op" id="5488180">)</span>&nbsp;<span class="op" id="5488182">{</span>&nbsp;<span class="comment" id="5488184">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488200">return</span>&nbsp;<span class="builtintype" id="5488207">false</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488217">m</span><span class="op" id="5488218">.</span><span class="ident" id="5488219">matched</span>&nbsp;<span class="op" id="5488227">=</span>&nbsp;<span class="builtintype" id="5488229">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488236">for</span>&nbsp;<span class="ident" id="5488240">i</span>&nbsp;<span class="op" id="5488242">:=</span>&nbsp;<span class="keyword" id="5488245">range</span>&nbsp;<span class="ident" id="5488251">m</span><span class="op" id="5488252">.</span><span class="ident" id="5488253">matchcap</span>&nbsp;<span class="op" id="5488262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488266">m</span><span class="op" id="5488267">.</span><span class="ident" id="5488268">matchcap</span><span class="op" id="5488276">[</span><span class="ident" id="5488277">i</span><span class="op" id="5488278">]</span>&nbsp;<span class="op" id="5488280">=</span>&nbsp;<span class="op" id="5488282">-</span><span class="num" id="5488283">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488286">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488289">runq</span><span class="op" id="5488293">,</span>&nbsp;<span class="ident" id="5488295">nextq</span>&nbsp;<span class="op" id="5488301">:=</span>&nbsp;<span class="op" id="5488304">&amp;</span><span class="ident" id="5488305">m</span><span class="op" id="5488306">.</span><span class="ident" id="5488307">q0</span><span class="op" id="5488309">,</span>&nbsp;<span class="op" id="5488311">&amp;</span><span class="ident" id="5488312">m</span><span class="op" id="5488313">.</span><span class="ident" id="5488314">q1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488318">r</span><span class="op" id="5488319">,</span>&nbsp;<span class="ident" id="5488321">r1</span>&nbsp;<span class="op" id="5488324">:=</span>&nbsp;<span class="ident" id="5488327">endOfText</span><span class="op" id="5488336">,</span>&nbsp;<span class="ident" id="5488338">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488349">width</span><span class="op" id="5488354">,</span>&nbsp;<span class="ident" id="5488356">width1</span>&nbsp;<span class="op" id="5488363">:=</span>&nbsp;<span class="num" id="5488366">0</span><span class="op" id="5488367">,</span>&nbsp;<span class="num" id="5488369">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488372">r</span><span class="op" id="5488373">,</span>&nbsp;<span class="ident" id="5488375">width</span>&nbsp;<span class="op" id="5488381">=</span>&nbsp;<span class="ident" id="5488383">i</span><span class="op" id="5488384">.</span><span class="ident" id="5488385">step</span><span class="op" id="5488389">(</span><span class="ident" id="5488390">pos</span><span class="op" id="5488393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488396">if</span>&nbsp;<span class="ident" id="5488399">r</span>&nbsp;<span class="op" id="5488401">!=</span>&nbsp;<span class="ident" id="5488404">endOfText</span>&nbsp;<span class="op" id="5488414">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488418">r1</span><span class="op" id="5488420">,</span>&nbsp;<span class="ident" id="5488422">width1</span>&nbsp;<span class="op" id="5488429">=</span>&nbsp;<span class="ident" id="5488431">i</span><span class="op" id="5488432">.</span><span class="ident" id="5488433">step</span><span class="op" id="5488437">(</span><span class="ident" id="5488438">pos</span>&nbsp;<span class="op" id="5488442">+</span>&nbsp;<span class="ident" id="5488444">width</span><span class="op" id="5488449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488455">var</span>&nbsp;<span class="ident" id="5488459">flag</span>&nbsp;<span class="ident" id="5488464">syntax</span><span class="op" id="5488470">.</span><span class="ident" id="5488471">EmptyOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488480">if</span>&nbsp;<span class="ident" id="5488483">pos</span>&nbsp;<span class="op" id="5488487">==</span>&nbsp;<span class="num" id="5488490">0</span>&nbsp;<span class="op" id="5488492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488496">flag</span>&nbsp;<span class="op" id="5488501">=</span>&nbsp;<span class="ident" id="5488503">syntax</span><span class="op" id="5488509">.</span><span class="ident" id="5488510">EmptyOpContext</span><span class="op" id="5488524">(</span><span class="op" id="5488525">-</span><span class="num" id="5488526">1</span><span class="op" id="5488527">,</span>&nbsp;<span class="ident" id="5488529">r</span><span class="op" id="5488530">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488533">}</span>&nbsp;<span class="keyword" id="5488535">else</span>&nbsp;<span class="op" id="5488540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488544">flag</span>&nbsp;<span class="op" id="5488549">=</span>&nbsp;<span class="ident" id="5488551">i</span><span class="op" id="5488552">.</span><span class="ident" id="5488553">context</span><span class="op" id="5488560">(</span><span class="ident" id="5488561">pos</span><span class="op" id="5488564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488570">for</span>&nbsp;<span class="op" id="5488574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488578">if</span>&nbsp;<span class="builtinfunc" id="5488581">len</span><span class="op" id="5488584">(</span><span class="ident" id="5488585">runq</span><span class="op" id="5488589">.</span><span class="ident" id="5488590">dense</span><span class="op" id="5488595">)</span>&nbsp;<span class="op" id="5488597">==</span>&nbsp;<span class="num" id="5488600">0</span>&nbsp;<span class="op" id="5488602">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488607">if</span>&nbsp;<span class="ident" id="5488610">startCond</span><span class="op" id="5488619">&amp;</span><span class="ident" id="5488620">syntax</span><span class="op" id="5488626">.</span><span class="ident" id="5488627">EmptyBeginText</span>&nbsp;<span class="op" id="5488642">!=</span>&nbsp;<span class="num" id="5488645">0</span>&nbsp;<span class="op" id="5488647">&amp;&amp;</span>&nbsp;<span class="ident" id="5488650">pos</span>&nbsp;<span class="op" id="5488654">!=</span>&nbsp;<span class="num" id="5488657">0</span>&nbsp;<span class="op" id="5488659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488665">//&nbsp;Anchored&nbsp;match,&nbsp;past&nbsp;beginning&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488712">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488726">if</span>&nbsp;<span class="ident" id="5488729">m</span><span class="op" id="5488730">.</span><span class="ident" id="5488731">matched</span>&nbsp;<span class="op" id="5488739">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488745">//&nbsp;Have&nbsp;match;&nbsp;finished&nbsp;exploring&nbsp;alternatives.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488797">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5488806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488811">if</span>&nbsp;<span class="builtinfunc" id="5488814">len</span><span class="op" id="5488817">(</span><span class="ident" id="5488818">m</span><span class="op" id="5488819">.</span><span class="ident" id="5488820">re</span><span class="op" id="5488822">.</span><span class="ident" id="5488823">prefix</span><span class="op" id="5488829">)</span>&nbsp;<span class="op" id="5488831">&gt;</span>&nbsp;<span class="num" id="5488833">0</span>&nbsp;<span class="op" id="5488835">&amp;&amp;</span>&nbsp;<span class="ident" id="5488838">r1</span>&nbsp;<span class="op" id="5488841">!=</span>&nbsp;<span class="ident" id="5488844">m</span><span class="op" id="5488845">.</span><span class="ident" id="5488846">re</span><span class="op" id="5488848">.</span><span class="ident" id="5488849">prefixRune</span>&nbsp;<span class="op" id="5488860">&amp;&amp;</span>&nbsp;<span class="ident" id="5488863">i</span><span class="op" id="5488864">.</span><span class="ident" id="5488865">canCheckPrefix</span><span class="op" id="5488879">(</span><span class="op" id="5488880">)</span>&nbsp;<span class="op" id="5488882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5488888">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5488946">advance</span>&nbsp;<span class="op" id="5488954">:=</span>&nbsp;<span class="ident" id="5488957">i</span><span class="op" id="5488958">.</span><span class="ident" id="5488959">index</span><span class="op" id="5488964">(</span><span class="ident" id="5488965">m</span><span class="op" id="5488966">.</span><span class="ident" id="5488967">re</span><span class="op" id="5488969">,</span>&nbsp;<span class="ident" id="5488971">pos</span><span class="op" id="5488974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5488980">if</span>&nbsp;<span class="ident" id="5488983">advance</span>&nbsp;<span class="op" id="5488991">&lt;</span>&nbsp;<span class="num" id="5488993">0</span>&nbsp;<span class="op" id="5488995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489002">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489018">pos</span>&nbsp;<span class="op" id="5489022">+=</span>&nbsp;<span class="ident" id="5489025">advance</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489037">r</span><span class="op" id="5489038">,</span>&nbsp;<span class="ident" id="5489040">width</span>&nbsp;<span class="op" id="5489046">=</span>&nbsp;<span class="ident" id="5489048">i</span><span class="op" id="5489049">.</span><span class="ident" id="5489050">step</span><span class="op" id="5489054">(</span><span class="ident" id="5489055">pos</span><span class="op" id="5489058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489064">r1</span><span class="op" id="5489066">,</span>&nbsp;<span class="ident" id="5489068">width1</span>&nbsp;<span class="op" id="5489075">=</span>&nbsp;<span class="ident" id="5489077">i</span><span class="op" id="5489078">.</span><span class="ident" id="5489079">step</span><span class="op" id="5489083">(</span><span class="ident" id="5489084">pos</span>&nbsp;<span class="op" id="5489088">+</span>&nbsp;<span class="ident" id="5489090">width</span><span class="op" id="5489095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489108">if</span>&nbsp;<span class="op" id="5489111">!</span><span class="ident" id="5489112">m</span><span class="op" id="5489113">.</span><span class="ident" id="5489114">matched</span>&nbsp;<span class="op" id="5489122">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489127">if</span>&nbsp;<span class="builtinfunc" id="5489130">len</span><span class="op" id="5489133">(</span><span class="ident" id="5489134">m</span><span class="op" id="5489135">.</span><span class="ident" id="5489136">matchcap</span><span class="op" id="5489144">)</span>&nbsp;<span class="op" id="5489146">&gt;</span>&nbsp;<span class="num" id="5489148">0</span>&nbsp;<span class="op" id="5489150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489156">m</span><span class="op" id="5489157">.</span><span class="ident" id="5489158">matchcap</span><span class="op" id="5489166">[</span><span class="num" id="5489167">0</span><span class="op" id="5489168">]</span>&nbsp;<span class="op" id="5489170">=</span>&nbsp;<span class="ident" id="5489172">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489184">m</span><span class="op" id="5489185">.</span><span class="ident" id="5489186">add</span><span class="op" id="5489189">(</span><span class="ident" id="5489190">runq</span><span class="op" id="5489194">,</span>&nbsp;<span class="builtintype" id="5489196">uint32</span><span class="op" id="5489202">(</span><span class="ident" id="5489203">m</span><span class="op" id="5489204">.</span><span class="ident" id="5489205">p</span><span class="op" id="5489206">.</span><span class="ident" id="5489207">Start</span><span class="op" id="5489212">)</span><span class="op" id="5489213">,</span>&nbsp;<span class="ident" id="5489215">pos</span><span class="op" id="5489218">,</span>&nbsp;<span class="ident" id="5489220">m</span><span class="op" id="5489221">.</span><span class="ident" id="5489222">matchcap</span><span class="op" id="5489230">,</span>&nbsp;<span class="ident" id="5489232">flag</span><span class="op" id="5489236">,</span>&nbsp;<span class="ident" id="5489238">nil</span><span class="op" id="5489241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489245">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489249">flag</span>&nbsp;<span class="op" id="5489254">=</span>&nbsp;<span class="ident" id="5489256">syntax</span><span class="op" id="5489262">.</span><span class="ident" id="5489263">EmptyOpContext</span><span class="op" id="5489277">(</span><span class="ident" id="5489278">r</span><span class="op" id="5489279">,</span>&nbsp;<span class="ident" id="5489281">r1</span><span class="op" id="5489283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489287">m</span><span class="op" id="5489288">.</span><span class="ident" id="5489289">step</span><span class="op" id="5489293">(</span><span class="ident" id="5489294">runq</span><span class="op" id="5489298">,</span>&nbsp;<span class="ident" id="5489300">nextq</span><span class="op" id="5489305">,</span>&nbsp;<span class="ident" id="5489307">pos</span><span class="op" id="5489310">,</span>&nbsp;<span class="ident" id="5489312">pos</span><span class="op" id="5489315">+</span><span class="ident" id="5489316">width</span><span class="op" id="5489321">,</span>&nbsp;<span class="ident" id="5489323">r</span><span class="op" id="5489324">,</span>&nbsp;<span class="ident" id="5489326">flag</span><span class="op" id="5489330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489334">if</span>&nbsp;<span class="ident" id="5489337">width</span>&nbsp;<span class="op" id="5489343">==</span>&nbsp;<span class="num" id="5489346">0</span>&nbsp;<span class="op" id="5489348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489353">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489361">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489365">if</span>&nbsp;<span class="builtinfunc" id="5489368">len</span><span class="op" id="5489371">(</span><span class="ident" id="5489372">m</span><span class="op" id="5489373">.</span><span class="ident" id="5489374">matchcap</span><span class="op" id="5489382">)</span>&nbsp;<span class="op" id="5489384">==</span>&nbsp;<span class="num" id="5489387">0</span>&nbsp;<span class="op" id="5489389">&amp;&amp;</span>&nbsp;<span class="ident" id="5489392">m</span><span class="op" id="5489393">.</span><span class="ident" id="5489394">matched</span>&nbsp;<span class="op" id="5489402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489407">//&nbsp;Found&nbsp;a&nbsp;match&nbsp;and&nbsp;not&nbsp;paying&nbsp;attention</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489452">//&nbsp;to&nbsp;where&nbsp;it&nbsp;is,&nbsp;so&nbsp;any&nbsp;match&nbsp;will&nbsp;do.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489496">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489504">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489508">pos</span>&nbsp;<span class="op" id="5489512">+=</span>&nbsp;<span class="ident" id="5489515">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489523">r</span><span class="op" id="5489524">,</span>&nbsp;<span class="ident" id="5489526">width</span>&nbsp;<span class="op" id="5489532">=</span>&nbsp;<span class="ident" id="5489534">r1</span><span class="op" id="5489536">,</span>&nbsp;<span class="ident" id="5489538">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489547">if</span>&nbsp;<span class="ident" id="5489550">r</span>&nbsp;<span class="op" id="5489552">!=</span>&nbsp;<span class="ident" id="5489555">endOfText</span>&nbsp;<span class="op" id="5489565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489570">r1</span><span class="op" id="5489572">,</span>&nbsp;<span class="ident" id="5489574">width1</span>&nbsp;<span class="op" id="5489581">=</span>&nbsp;<span class="ident" id="5489583">i</span><span class="op" id="5489584">.</span><span class="ident" id="5489585">step</span><span class="op" id="5489589">(</span><span class="ident" id="5489590">pos</span>&nbsp;<span class="op" id="5489594">+</span>&nbsp;<span class="ident" id="5489596">width</span><span class="op" id="5489601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489605">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489609">runq</span><span class="op" id="5489613">,</span>&nbsp;<span class="ident" id="5489615">nextq</span>&nbsp;<span class="op" id="5489621">=</span>&nbsp;<span class="ident" id="5489623">nextq</span><span class="op" id="5489628">,</span>&nbsp;<span class="ident" id="5489630">runq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489639">m</span><span class="op" id="5489640">.</span><span class="ident" id="5489641">clear</span><span class="op" id="5489646">(</span><span class="ident" id="5489647">nextq</span><span class="op" id="5489652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489655">return</span>&nbsp;<span class="ident" id="5489662">m</span><span class="op" id="5489663">.</span><span class="ident" id="5489664">matched</span><br>
<span class="lineno"></span><span class="op" id="5489672">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="comment" id="5489675">//&nbsp;clear&nbsp;frees&nbsp;all&nbsp;threads&nbsp;on&nbsp;the&nbsp;thread&nbsp;queue.</span><br>
<span class="lineno"></span><span class="keyword" id="5489723">func</span>&nbsp;<span class="op" id="5489728">(</span><span class="ident" id="5489729">m</span>&nbsp;<span class="op" id="5489731">*</span><span class="ident" id="5489732">machine</span><span class="op" id="5489739">)</span>&nbsp;<span class="ident" id="5489741">clear</span><span class="op" id="5489746">(</span><span class="ident" id="5489747">q</span>&nbsp;<span class="op" id="5489749">*</span><span class="ident" id="5489750">queue</span><span class="op" id="5489755">)</span>&nbsp;<span class="op" id="5489757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489760">for</span>&nbsp;<span class="ident" id="5489764">_</span><span class="op" id="5489765">,</span>&nbsp;<span class="ident" id="5489767">d</span>&nbsp;<span class="op" id="5489769">:=</span>&nbsp;<span class="keyword" id="5489772">range</span>&nbsp;<span class="ident" id="5489778">q</span><span class="op" id="5489779">.</span><span class="ident" id="5489780">dense</span>&nbsp;<span class="op" id="5489786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5489790">if</span>&nbsp;<span class="ident" id="5489793">d</span><span class="op" id="5489794">.</span><span class="ident" id="5489795">t</span>&nbsp;<span class="op" id="5489797">!=</span>&nbsp;<span class="ident" id="5489800">nil</span>&nbsp;<span class="op" id="5489804">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5489809">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489827">m</span><span class="op" id="5489828">.</span><span class="ident" id="5489829">pool</span>&nbsp;<span class="op" id="5489834">=</span>&nbsp;<span class="builtinfunc" id="5489836">append</span><span class="op" id="5489842">(</span><span class="ident" id="5489843">m</span><span class="op" id="5489844">.</span><span class="ident" id="5489845">pool</span><span class="op" id="5489849">,</span>&nbsp;<span class="ident" id="5489851">d</span><span class="op" id="5489852">.</span><span class="ident" id="5489853">t</span><span class="op" id="5489854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5489861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5489864">q</span><span class="op" id="5489865">.</span><span class="ident" id="5489866">dense</span>&nbsp;<span class="op" id="5489872">=</span>&nbsp;<span class="ident" id="5489874">q</span><span class="op" id="5489875">.</span><span class="ident" id="5489876">dense</span><span class="op" id="5489881">[</span><span class="op" id="5489882">:</span><span class="num" id="5489883">0</span><span class="op" id="5489884">]</span><br>
<span class="lineno">195</span><span class="op" id="5489886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5489889">//&nbsp;step&nbsp;executes&nbsp;one&nbsp;step&nbsp;of&nbsp;the&nbsp;machine,&nbsp;running&nbsp;each&nbsp;of&nbsp;the&nbsp;threads</span><br>
<span class="lineno"></span><span class="comment" id="5489959">//&nbsp;on&nbsp;runq&nbsp;and&nbsp;appending&nbsp;new&nbsp;threads&nbsp;to&nbsp;nextq.</span><br>
<span class="lineno"></span><span class="comment" id="5490006">//&nbsp;The&nbsp;step&nbsp;processes&nbsp;the&nbsp;rune&nbsp;c&nbsp;(which&nbsp;may&nbsp;be&nbsp;endOfText),</span><br>
<span class="lineno">200</span><span class="comment" id="5490065">//&nbsp;which&nbsp;starts&nbsp;at&nbsp;position&nbsp;pos&nbsp;and&nbsp;ends&nbsp;at&nbsp;nextPos.</span><br>
<span class="lineno"></span><span class="comment" id="5490118">//&nbsp;nextCond&nbsp;gives&nbsp;the&nbsp;setting&nbsp;for&nbsp;the&nbsp;empty-width&nbsp;flags&nbsp;after&nbsp;c.</span><br>
<span class="lineno"></span><span class="keyword" id="5490183">func</span>&nbsp;<span class="op" id="5490188">(</span><span class="ident" id="5490189">m</span>&nbsp;<span class="op" id="5490191">*</span><span class="ident" id="5490192">machine</span><span class="op" id="5490199">)</span>&nbsp;<span class="ident" id="5490201">step</span><span class="op" id="5490205">(</span><span class="ident" id="5490206">runq</span><span class="op" id="5490210">,</span>&nbsp;<span class="ident" id="5490212">nextq</span>&nbsp;<span class="op" id="5490218">*</span><span class="ident" id="5490219">queue</span><span class="op" id="5490224">,</span>&nbsp;<span class="ident" id="5490226">pos</span><span class="op" id="5490229">,</span>&nbsp;<span class="ident" id="5490231">nextPos</span>&nbsp;<span class="builtintype" id="5490239">int</span><span class="op" id="5490242">,</span>&nbsp;<span class="ident" id="5490244">c</span>&nbsp;<span class="builtintype" id="5490246">rune</span><span class="op" id="5490250">,</span>&nbsp;<span class="ident" id="5490252">nextCond</span>&nbsp;<span class="ident" id="5490261">syntax</span><span class="op" id="5490267">.</span><span class="ident" id="5490268">EmptyOp</span><span class="op" id="5490275">)</span>&nbsp;<span class="op" id="5490277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490280">longest</span>&nbsp;<span class="op" id="5490288">:=</span>&nbsp;<span class="ident" id="5490291">m</span><span class="op" id="5490292">.</span><span class="ident" id="5490293">re</span><span class="op" id="5490295">.</span><span class="ident" id="5490296">longest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490305">for</span>&nbsp;<span class="ident" id="5490309">j</span>&nbsp;<span class="op" id="5490311">:=</span>&nbsp;<span class="num" id="5490314">0</span><span class="op" id="5490315">;</span>&nbsp;<span class="ident" id="5490317">j</span>&nbsp;<span class="op" id="5490319">&lt;</span>&nbsp;<span class="builtinfunc" id="5490321">len</span><span class="op" id="5490324">(</span><span class="ident" id="5490325">runq</span><span class="op" id="5490329">.</span><span class="ident" id="5490330">dense</span><span class="op" id="5490335">)</span><span class="op" id="5490336">;</span>&nbsp;<span class="ident" id="5490338">j</span><span class="op" id="5490339">++</span>&nbsp;<span class="op" id="5490342">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490346">d</span>&nbsp;<span class="op" id="5490348">:=</span>&nbsp;<span class="op" id="5490351">&amp;</span><span class="ident" id="5490352">runq</span><span class="op" id="5490356">.</span><span class="ident" id="5490357">dense</span><span class="op" id="5490362">[</span><span class="ident" id="5490363">j</span><span class="op" id="5490364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490368">t</span>&nbsp;<span class="op" id="5490370">:=</span>&nbsp;<span class="ident" id="5490373">d</span><span class="op" id="5490374">.</span><span class="ident" id="5490375">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490379">if</span>&nbsp;<span class="ident" id="5490382">t</span>&nbsp;<span class="op" id="5490384">==</span>&nbsp;<span class="ident" id="5490387">nil</span>&nbsp;<span class="op" id="5490391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490396">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490407">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490411">if</span>&nbsp;<span class="ident" id="5490414">longest</span>&nbsp;<span class="op" id="5490422">&amp;&amp;</span>&nbsp;<span class="ident" id="5490425">m</span><span class="op" id="5490426">.</span><span class="ident" id="5490427">matched</span>&nbsp;<span class="op" id="5490435">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5490438">len</span><span class="op" id="5490441">(</span><span class="ident" id="5490442">t</span><span class="op" id="5490443">.</span><span class="builtinfunc" id="5490444">cap</span><span class="op" id="5490447">)</span>&nbsp;<span class="op" id="5490449">&gt;</span>&nbsp;<span class="num" id="5490451">0</span>&nbsp;<span class="op" id="5490453">&amp;&amp;</span>&nbsp;<span class="ident" id="5490456">m</span><span class="op" id="5490457">.</span><span class="ident" id="5490458">matchcap</span><span class="op" id="5490466">[</span><span class="num" id="5490467">0</span><span class="op" id="5490468">]</span>&nbsp;<span class="op" id="5490470">&lt;</span>&nbsp;<span class="ident" id="5490472">t</span><span class="op" id="5490473">.</span><span class="builtinfunc" id="5490474">cap</span><span class="op" id="5490477">[</span><span class="num" id="5490478">0</span><span class="op" id="5490479">]</span>&nbsp;<span class="op" id="5490481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490486">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490502">m</span><span class="op" id="5490503">.</span><span class="ident" id="5490504">pool</span>&nbsp;<span class="op" id="5490509">=</span>&nbsp;<span class="builtinfunc" id="5490511">append</span><span class="op" id="5490517">(</span><span class="ident" id="5490518">m</span><span class="op" id="5490519">.</span><span class="ident" id="5490520">pool</span><span class="op" id="5490524">,</span>&nbsp;<span class="ident" id="5490526">t</span><span class="op" id="5490527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490532">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490543">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490547">i</span>&nbsp;<span class="op" id="5490549">:=</span>&nbsp;<span class="ident" id="5490552">t</span><span class="op" id="5490553">.</span><span class="ident" id="5490554">inst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490561">add</span>&nbsp;<span class="op" id="5490565">:=</span>&nbsp;<span class="builtintype" id="5490568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490576">switch</span>&nbsp;<span class="ident" id="5490583">i</span><span class="op" id="5490584">.</span><span class="ident" id="5490585">Op</span>&nbsp;<span class="op" id="5490588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490592">default</span><span class="op" id="5490599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5490604">panic</span><span class="op" id="5490609">(</span><span class="string" id="5490610">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5490620">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490625">case</span>&nbsp;<span class="ident" id="5490630">syntax</span><span class="op" id="5490636">.</span><span class="ident" id="5490637">InstMatch</span><span class="op" id="5490646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490651">if</span>&nbsp;<span class="builtinfunc" id="5490654">len</span><span class="op" id="5490657">(</span><span class="ident" id="5490658">t</span><span class="op" id="5490659">.</span><span class="builtinfunc" id="5490660">cap</span><span class="op" id="5490663">)</span>&nbsp;<span class="op" id="5490665">&gt;</span>&nbsp;<span class="num" id="5490667">0</span>&nbsp;<span class="op" id="5490669">&amp;&amp;</span>&nbsp;<span class="op" id="5490672">(</span><span class="op" id="5490673">!</span><span class="ident" id="5490674">longest</span>&nbsp;<span class="op" id="5490682">||</span>&nbsp;<span class="op" id="5490685">!</span><span class="ident" id="5490686">m</span><span class="op" id="5490687">.</span><span class="ident" id="5490688">matched</span>&nbsp;<span class="op" id="5490696">||</span>&nbsp;<span class="ident" id="5490699">m</span><span class="op" id="5490700">.</span><span class="ident" id="5490701">matchcap</span><span class="op" id="5490709">[</span><span class="num" id="5490710">1</span><span class="op" id="5490711">]</span>&nbsp;<span class="op" id="5490713">&lt;</span>&nbsp;<span class="ident" id="5490715">pos</span><span class="op" id="5490718">)</span>&nbsp;<span class="op" id="5490720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490726">t</span><span class="op" id="5490727">.</span><span class="builtinfunc" id="5490728">cap</span><span class="op" id="5490731">[</span><span class="num" id="5490732">1</span><span class="op" id="5490733">]</span>&nbsp;<span class="op" id="5490735">=</span>&nbsp;<span class="ident" id="5490737">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5490745">copy</span><span class="op" id="5490749">(</span><span class="ident" id="5490750">m</span><span class="op" id="5490751">.</span><span class="ident" id="5490752">matchcap</span><span class="op" id="5490760">,</span>&nbsp;<span class="ident" id="5490762">t</span><span class="op" id="5490763">.</span><span class="builtinfunc" id="5490764">cap</span><span class="op" id="5490767">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490777">if</span>&nbsp;<span class="op" id="5490780">!</span><span class="ident" id="5490781">longest</span>&nbsp;<span class="op" id="5490789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490795">//&nbsp;First-match&nbsp;mode:&nbsp;cut&nbsp;off&nbsp;all&nbsp;lower-priority&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490856">for</span>&nbsp;<span class="ident" id="5490860">_</span><span class="op" id="5490861">,</span>&nbsp;<span class="ident" id="5490863">d</span>&nbsp;<span class="op" id="5490865">:=</span>&nbsp;<span class="keyword" id="5490868">range</span>&nbsp;<span class="ident" id="5490874">runq</span><span class="op" id="5490878">.</span><span class="ident" id="5490879">dense</span><span class="op" id="5490884">[</span><span class="ident" id="5490885">j</span><span class="op" id="5490886">+</span><span class="num" id="5490887">1</span><span class="op" id="5490888">:</span><span class="op" id="5490889">]</span>&nbsp;<span class="op" id="5490891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5490898">if</span>&nbsp;<span class="ident" id="5490901">d</span><span class="op" id="5490902">.</span><span class="ident" id="5490903">t</span>&nbsp;<span class="op" id="5490905">!=</span>&nbsp;<span class="ident" id="5490908">nil</span>&nbsp;<span class="op" id="5490912">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5490920">//&nbsp;m.free(d.t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490941">m</span><span class="op" id="5490942">.</span><span class="ident" id="5490943">pool</span>&nbsp;<span class="op" id="5490948">=</span>&nbsp;<span class="builtinfunc" id="5490950">append</span><span class="op" id="5490956">(</span><span class="ident" id="5490957">m</span><span class="op" id="5490958">.</span><span class="ident" id="5490959">pool</span><span class="op" id="5490963">,</span>&nbsp;<span class="ident" id="5490965">d</span><span class="op" id="5490966">.</span><span class="ident" id="5490967">t</span><span class="op" id="5490968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5490981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5490987">runq</span><span class="op" id="5490991">.</span><span class="ident" id="5490992">dense</span>&nbsp;<span class="op" id="5490998">=</span>&nbsp;<span class="ident" id="5491000">runq</span><span class="op" id="5491004">.</span><span class="ident" id="5491005">dense</span><span class="op" id="5491010">[</span><span class="op" id="5491011">:</span><span class="num" id="5491012">0</span><span class="op" id="5491013">]</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491023">m</span><span class="op" id="5491024">.</span><span class="ident" id="5491025">matched</span>&nbsp;<span class="op" id="5491033">=</span>&nbsp;<span class="builtintype" id="5491035">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491043">case</span>&nbsp;<span class="ident" id="5491048">syntax</span><span class="op" id="5491054">.</span><span class="ident" id="5491055">InstRune</span><span class="op" id="5491063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491068">add</span>&nbsp;<span class="op" id="5491072">=</span>&nbsp;<span class="ident" id="5491074">i</span><span class="op" id="5491075">.</span><span class="ident" id="5491076">MatchRune</span><span class="op" id="5491085">(</span><span class="ident" id="5491086">c</span><span class="op" id="5491087">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491091">case</span>&nbsp;<span class="ident" id="5491096">syntax</span><span class="op" id="5491102">.</span><span class="ident" id="5491103">InstRune1</span><span class="op" id="5491112">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491117">add</span>&nbsp;<span class="op" id="5491121">=</span>&nbsp;<span class="ident" id="5491123">c</span>&nbsp;<span class="op" id="5491125">==</span>&nbsp;<span class="ident" id="5491128">i</span><span class="op" id="5491129">.</span><span class="ident" id="5491130">Rune</span><span class="op" id="5491134">[</span><span class="num" id="5491135">0</span><span class="op" id="5491136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491140">case</span>&nbsp;<span class="ident" id="5491145">syntax</span><span class="op" id="5491151">.</span><span class="ident" id="5491152">InstRuneAny</span><span class="op" id="5491163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491168">add</span>&nbsp;<span class="op" id="5491172">=</span>&nbsp;<span class="builtintype" id="5491174">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491181">case</span>&nbsp;<span class="ident" id="5491186">syntax</span><span class="op" id="5491192">.</span><span class="ident" id="5491193">InstRuneAnyNotNL</span><span class="op" id="5491209">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491214">add</span>&nbsp;<span class="op" id="5491218">=</span>&nbsp;<span class="ident" id="5491220">c</span>&nbsp;<span class="op" id="5491222">!=</span>&nbsp;<span class="string" id="5491225">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491236">if</span>&nbsp;<span class="ident" id="5491239">add</span>&nbsp;<span class="op" id="5491243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491248">t</span>&nbsp;<span class="op" id="5491250">=</span>&nbsp;<span class="ident" id="5491252">m</span><span class="op" id="5491253">.</span><span class="ident" id="5491254">add</span><span class="op" id="5491257">(</span><span class="ident" id="5491258">nextq</span><span class="op" id="5491263">,</span>&nbsp;<span class="ident" id="5491265">i</span><span class="op" id="5491266">.</span><span class="ident" id="5491267">Out</span><span class="op" id="5491270">,</span>&nbsp;<span class="ident" id="5491272">nextPos</span><span class="op" id="5491279">,</span>&nbsp;<span class="ident" id="5491281">t</span><span class="op" id="5491282">.</span><span class="builtinfunc" id="5491283">cap</span><span class="op" id="5491286">,</span>&nbsp;<span class="ident" id="5491288">nextCond</span><span class="op" id="5491296">,</span>&nbsp;<span class="ident" id="5491298">t</span><span class="op" id="5491299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491303">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491307">if</span>&nbsp;<span class="ident" id="5491310">t</span>&nbsp;<span class="op" id="5491312">!=</span>&nbsp;<span class="ident" id="5491315">nil</span>&nbsp;<span class="op" id="5491319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5491324">//&nbsp;m.free(t)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491340">m</span><span class="op" id="5491341">.</span><span class="ident" id="5491342">pool</span>&nbsp;<span class="op" id="5491347">=</span>&nbsp;<span class="builtinfunc" id="5491349">append</span><span class="op" id="5491355">(</span><span class="ident" id="5491356">m</span><span class="op" id="5491357">.</span><span class="ident" id="5491358">pool</span><span class="op" id="5491362">,</span>&nbsp;<span class="ident" id="5491364">t</span><span class="op" id="5491365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491372">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491375">runq</span><span class="op" id="5491379">.</span><span class="ident" id="5491380">dense</span>&nbsp;<span class="op" id="5491386">=</span>&nbsp;<span class="ident" id="5491388">runq</span><span class="op" id="5491392">.</span><span class="ident" id="5491393">dense</span><span class="op" id="5491398">[</span><span class="op" id="5491399">:</span><span class="num" id="5491400">0</span><span class="op" id="5491401">]</span><br>
<span class="lineno"></span><span class="op" id="5491403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5491406">//&nbsp;add&nbsp;adds&nbsp;an&nbsp;entry&nbsp;to&nbsp;q&nbsp;for&nbsp;pc,&nbsp;unless&nbsp;the&nbsp;q&nbsp;already&nbsp;has&nbsp;such&nbsp;an&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="5491480">//&nbsp;It&nbsp;also&nbsp;recursively&nbsp;adds&nbsp;an&nbsp;entry&nbsp;for&nbsp;all&nbsp;instructions&nbsp;reachable&nbsp;from&nbsp;pc&nbsp;by&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="5491569">//&nbsp;empty-width&nbsp;conditions&nbsp;satisfied&nbsp;by&nbsp;cond.&nbsp;&nbsp;pos&nbsp;gives&nbsp;the&nbsp;current&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5491646">//&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5491663">func</span>&nbsp;<span class="op" id="5491668">(</span><span class="ident" id="5491669">m</span>&nbsp;<span class="op" id="5491671">*</span><span class="ident" id="5491672">machine</span><span class="op" id="5491679">)</span>&nbsp;<span class="ident" id="5491681">add</span><span class="op" id="5491684">(</span><span class="ident" id="5491685">q</span>&nbsp;<span class="op" id="5491687">*</span><span class="ident" id="5491688">queue</span><span class="op" id="5491693">,</span>&nbsp;<span class="ident" id="5491695">pc</span>&nbsp;<span class="builtintype" id="5491698">uint32</span><span class="op" id="5491704">,</span>&nbsp;<span class="ident" id="5491706">pos</span>&nbsp;<span class="builtintype" id="5491710">int</span><span class="op" id="5491713">,</span>&nbsp;<span class="builtinfunc" id="5491715">cap</span>&nbsp;<span class="op" id="5491719">[</span><span class="op" id="5491720">]</span><span class="builtintype" id="5491721">int</span><span class="op" id="5491724">,</span>&nbsp;<span class="ident" id="5491726">cond</span>&nbsp;<span class="ident" id="5491731">syntax</span><span class="op" id="5491737">.</span><span class="ident" id="5491738">EmptyOp</span><span class="op" id="5491745">,</span>&nbsp;<span class="ident" id="5491747">t</span>&nbsp;<span class="op" id="5491749">*</span><span class="ident" id="5491750">thread</span><span class="op" id="5491756">)</span>&nbsp;<span class="op" id="5491758">*</span><span class="ident" id="5491759">thread</span>&nbsp;<span class="op" id="5491766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491769">if</span>&nbsp;<span class="ident" id="5491772">pc</span>&nbsp;<span class="op" id="5491775">==</span>&nbsp;<span class="num" id="5491778">0</span>&nbsp;<span class="op" id="5491780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491784">return</span>&nbsp;<span class="ident" id="5491791">t</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491797">if</span>&nbsp;<span class="ident" id="5491800">j</span>&nbsp;<span class="op" id="5491802">:=</span>&nbsp;<span class="ident" id="5491805">q</span><span class="op" id="5491806">.</span><span class="ident" id="5491807">sparse</span><span class="op" id="5491813">[</span><span class="ident" id="5491814">pc</span><span class="op" id="5491816">]</span><span class="op" id="5491817">;</span>&nbsp;<span class="ident" id="5491819">j</span>&nbsp;<span class="op" id="5491821">&lt;</span>&nbsp;<span class="builtintype" id="5491823">uint32</span><span class="op" id="5491829">(</span><span class="builtinfunc" id="5491830">len</span><span class="op" id="5491833">(</span><span class="ident" id="5491834">q</span><span class="op" id="5491835">.</span><span class="ident" id="5491836">dense</span><span class="op" id="5491841">)</span><span class="op" id="5491842">)</span>&nbsp;<span class="op" id="5491844">&amp;&amp;</span>&nbsp;<span class="ident" id="5491847">q</span><span class="op" id="5491848">.</span><span class="ident" id="5491849">dense</span><span class="op" id="5491854">[</span><span class="ident" id="5491855">j</span><span class="op" id="5491856">]</span><span class="op" id="5491857">.</span><span class="ident" id="5491858">pc</span>&nbsp;<span class="op" id="5491861">==</span>&nbsp;<span class="ident" id="5491864">pc</span>&nbsp;<span class="op" id="5491867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5491871">return</span>&nbsp;<span class="ident" id="5491878">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5491881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491885">j</span>&nbsp;<span class="op" id="5491887">:=</span>&nbsp;<span class="builtinfunc" id="5491890">len</span><span class="op" id="5491893">(</span><span class="ident" id="5491894">q</span><span class="op" id="5491895">.</span><span class="ident" id="5491896">dense</span><span class="op" id="5491901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491904">q</span><span class="op" id="5491905">.</span><span class="ident" id="5491906">dense</span>&nbsp;<span class="op" id="5491912">=</span>&nbsp;<span class="ident" id="5491914">q</span><span class="op" id="5491915">.</span><span class="ident" id="5491916">dense</span><span class="op" id="5491921">[</span><span class="op" id="5491922">:</span><span class="ident" id="5491923">j</span><span class="op" id="5491924">+</span><span class="num" id="5491925">1</span><span class="op" id="5491926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491929">d</span>&nbsp;<span class="op" id="5491931">:=</span>&nbsp;<span class="op" id="5491934">&amp;</span><span class="ident" id="5491935">q</span><span class="op" id="5491936">.</span><span class="ident" id="5491937">dense</span><span class="op" id="5491942">[</span><span class="ident" id="5491943">j</span><span class="op" id="5491944">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491947">d</span><span class="op" id="5491948">.</span><span class="ident" id="5491949">t</span>&nbsp;<span class="op" id="5491951">=</span>&nbsp;<span class="ident" id="5491953">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491958">d</span><span class="op" id="5491959">.</span><span class="ident" id="5491960">pc</span>&nbsp;<span class="op" id="5491963">=</span>&nbsp;<span class="ident" id="5491965">pc</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491969">q</span><span class="op" id="5491970">.</span><span class="ident" id="5491971">sparse</span><span class="op" id="5491977">[</span><span class="ident" id="5491978">pc</span><span class="op" id="5491980">]</span>&nbsp;<span class="op" id="5491982">=</span>&nbsp;<span class="builtintype" id="5491984">uint32</span><span class="op" id="5491990">(</span><span class="ident" id="5491991">j</span><span class="op" id="5491992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5491996">i</span>&nbsp;<span class="op" id="5491998">:=</span>&nbsp;<span class="op" id="5492001">&amp;</span><span class="ident" id="5492002">m</span><span class="op" id="5492003">.</span><span class="ident" id="5492004">p</span><span class="op" id="5492005">.</span><span class="ident" id="5492006">Inst</span><span class="op" id="5492010">[</span><span class="ident" id="5492011">pc</span><span class="op" id="5492013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492016">switch</span>&nbsp;<span class="ident" id="5492023">i</span><span class="op" id="5492024">.</span><span class="ident" id="5492025">Op</span>&nbsp;<span class="op" id="5492028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492031">default</span><span class="op" id="5492038">:</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5492042">panic</span><span class="op" id="5492047">(</span><span class="string" id="5492048">&#34;unhandled&#34;</span><span class="op" id="5492059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492062">case</span>&nbsp;<span class="ident" id="5492067">syntax</span><span class="op" id="5492073">.</span><span class="ident" id="5492074">InstFail</span><span class="op" id="5492082">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5492086">//&nbsp;nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492098">case</span>&nbsp;<span class="ident" id="5492103">syntax</span><span class="op" id="5492109">.</span><span class="ident" id="5492110">InstAlt</span><span class="op" id="5492117">,</span>&nbsp;<span class="ident" id="5492119">syntax</span><span class="op" id="5492125">.</span><span class="ident" id="5492126">InstAltMatch</span><span class="op" id="5492138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492142">t</span>&nbsp;<span class="op" id="5492144">=</span>&nbsp;<span class="ident" id="5492146">m</span><span class="op" id="5492147">.</span><span class="ident" id="5492148">add</span><span class="op" id="5492151">(</span><span class="ident" id="5492152">q</span><span class="op" id="5492153">,</span>&nbsp;<span class="ident" id="5492155">i</span><span class="op" id="5492156">.</span><span class="ident" id="5492157">Out</span><span class="op" id="5492160">,</span>&nbsp;<span class="ident" id="5492162">pos</span><span class="op" id="5492165">,</span>&nbsp;<span class="builtinfunc" id="5492167">cap</span><span class="op" id="5492170">,</span>&nbsp;<span class="ident" id="5492172">cond</span><span class="op" id="5492176">,</span>&nbsp;<span class="ident" id="5492178">t</span><span class="op" id="5492179">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492183">t</span>&nbsp;<span class="op" id="5492185">=</span>&nbsp;<span class="ident" id="5492187">m</span><span class="op" id="5492188">.</span><span class="ident" id="5492189">add</span><span class="op" id="5492192">(</span><span class="ident" id="5492193">q</span><span class="op" id="5492194">,</span>&nbsp;<span class="ident" id="5492196">i</span><span class="op" id="5492197">.</span><span class="ident" id="5492198">Arg</span><span class="op" id="5492201">,</span>&nbsp;<span class="ident" id="5492203">pos</span><span class="op" id="5492206">,</span>&nbsp;<span class="builtinfunc" id="5492208">cap</span><span class="op" id="5492211">,</span>&nbsp;<span class="ident" id="5492213">cond</span><span class="op" id="5492217">,</span>&nbsp;<span class="ident" id="5492219">t</span><span class="op" id="5492220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492223">case</span>&nbsp;<span class="ident" id="5492228">syntax</span><span class="op" id="5492234">.</span><span class="ident" id="5492235">InstEmptyWidth</span><span class="op" id="5492249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492253">if</span>&nbsp;<span class="ident" id="5492256">syntax</span><span class="op" id="5492262">.</span><span class="ident" id="5492263">EmptyOp</span><span class="op" id="5492270">(</span><span class="ident" id="5492271">i</span><span class="op" id="5492272">.</span><span class="ident" id="5492273">Arg</span><span class="op" id="5492276">)</span><span class="op" id="5492277">&amp;^</span><span class="ident" id="5492279">cond</span>&nbsp;<span class="op" id="5492284">==</span>&nbsp;<span class="num" id="5492287">0</span>&nbsp;<span class="op" id="5492289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492294">t</span>&nbsp;<span class="op" id="5492296">=</span>&nbsp;<span class="ident" id="5492298">m</span><span class="op" id="5492299">.</span><span class="ident" id="5492300">add</span><span class="op" id="5492303">(</span><span class="ident" id="5492304">q</span><span class="op" id="5492305">,</span>&nbsp;<span class="ident" id="5492307">i</span><span class="op" id="5492308">.</span><span class="ident" id="5492309">Out</span><span class="op" id="5492312">,</span>&nbsp;<span class="ident" id="5492314">pos</span><span class="op" id="5492317">,</span>&nbsp;<span class="builtinfunc" id="5492319">cap</span><span class="op" id="5492322">,</span>&nbsp;<span class="ident" id="5492324">cond</span><span class="op" id="5492328">,</span>&nbsp;<span class="ident" id="5492330">t</span><span class="op" id="5492331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492335">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492338">case</span>&nbsp;<span class="ident" id="5492343">syntax</span><span class="op" id="5492349">.</span><span class="ident" id="5492350">InstNop</span><span class="op" id="5492357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492361">t</span>&nbsp;<span class="op" id="5492363">=</span>&nbsp;<span class="ident" id="5492365">m</span><span class="op" id="5492366">.</span><span class="ident" id="5492367">add</span><span class="op" id="5492370">(</span><span class="ident" id="5492371">q</span><span class="op" id="5492372">,</span>&nbsp;<span class="ident" id="5492374">i</span><span class="op" id="5492375">.</span><span class="ident" id="5492376">Out</span><span class="op" id="5492379">,</span>&nbsp;<span class="ident" id="5492381">pos</span><span class="op" id="5492384">,</span>&nbsp;<span class="builtinfunc" id="5492386">cap</span><span class="op" id="5492389">,</span>&nbsp;<span class="ident" id="5492391">cond</span><span class="op" id="5492395">,</span>&nbsp;<span class="ident" id="5492397">t</span><span class="op" id="5492398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492401">case</span>&nbsp;<span class="ident" id="5492406">syntax</span><span class="op" id="5492412">.</span><span class="ident" id="5492413">InstCapture</span><span class="op" id="5492424">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492428">if</span>&nbsp;<span class="builtintype" id="5492431">int</span><span class="op" id="5492434">(</span><span class="ident" id="5492435">i</span><span class="op" id="5492436">.</span><span class="ident" id="5492437">Arg</span><span class="op" id="5492440">)</span>&nbsp;<span class="op" id="5492442">&lt;</span>&nbsp;<span class="builtinfunc" id="5492444">len</span><span class="op" id="5492447">(</span><span class="builtinfunc" id="5492448">cap</span><span class="op" id="5492451">)</span>&nbsp;<span class="op" id="5492453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492458">opos</span>&nbsp;<span class="op" id="5492463">:=</span>&nbsp;<span class="builtinfunc" id="5492466">cap</span><span class="op" id="5492469">[</span><span class="ident" id="5492470">i</span><span class="op" id="5492471">.</span><span class="ident" id="5492472">Arg</span><span class="op" id="5492475">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5492480">cap</span><span class="op" id="5492483">[</span><span class="ident" id="5492484">i</span><span class="op" id="5492485">.</span><span class="ident" id="5492486">Arg</span><span class="op" id="5492489">]</span>&nbsp;<span class="op" id="5492491">=</span>&nbsp;<span class="ident" id="5492493">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492500">m</span><span class="op" id="5492501">.</span><span class="ident" id="5492502">add</span><span class="op" id="5492505">(</span><span class="ident" id="5492506">q</span><span class="op" id="5492507">,</span>&nbsp;<span class="ident" id="5492509">i</span><span class="op" id="5492510">.</span><span class="ident" id="5492511">Out</span><span class="op" id="5492514">,</span>&nbsp;<span class="ident" id="5492516">pos</span><span class="op" id="5492519">,</span>&nbsp;<span class="builtinfunc" id="5492521">cap</span><span class="op" id="5492524">,</span>&nbsp;<span class="ident" id="5492526">cond</span><span class="op" id="5492530">,</span>&nbsp;<span class="ident" id="5492532">nil</span><span class="op" id="5492535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5492540">cap</span><span class="op" id="5492543">[</span><span class="ident" id="5492544">i</span><span class="op" id="5492545">.</span><span class="ident" id="5492546">Arg</span><span class="op" id="5492549">]</span>&nbsp;<span class="op" id="5492551">=</span>&nbsp;<span class="ident" id="5492553">opos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492560">}</span>&nbsp;<span class="keyword" id="5492562">else</span>&nbsp;<span class="op" id="5492567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492572">t</span>&nbsp;<span class="op" id="5492574">=</span>&nbsp;<span class="ident" id="5492576">m</span><span class="op" id="5492577">.</span><span class="ident" id="5492578">add</span><span class="op" id="5492581">(</span><span class="ident" id="5492582">q</span><span class="op" id="5492583">,</span>&nbsp;<span class="ident" id="5492585">i</span><span class="op" id="5492586">.</span><span class="ident" id="5492587">Out</span><span class="op" id="5492590">,</span>&nbsp;<span class="ident" id="5492592">pos</span><span class="op" id="5492595">,</span>&nbsp;<span class="builtinfunc" id="5492597">cap</span><span class="op" id="5492600">,</span>&nbsp;<span class="ident" id="5492602">cond</span><span class="op" id="5492606">,</span>&nbsp;<span class="ident" id="5492608">t</span><span class="op" id="5492609">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492616">case</span>&nbsp;<span class="ident" id="5492621">syntax</span><span class="op" id="5492627">.</span><span class="ident" id="5492628">InstMatch</span><span class="op" id="5492637">,</span>&nbsp;<span class="ident" id="5492639">syntax</span><span class="op" id="5492645">.</span><span class="ident" id="5492646">InstRune</span><span class="op" id="5492654">,</span>&nbsp;<span class="ident" id="5492656">syntax</span><span class="op" id="5492662">.</span><span class="ident" id="5492663">InstRune1</span><span class="op" id="5492672">,</span>&nbsp;<span class="ident" id="5492674">syntax</span><span class="op" id="5492680">.</span><span class="ident" id="5492681">InstRuneAny</span><span class="op" id="5492692">,</span>&nbsp;<span class="ident" id="5492694">syntax</span><span class="op" id="5492700">.</span><span class="ident" id="5492701">InstRuneAnyNotNL</span><span class="op" id="5492717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492721">if</span>&nbsp;<span class="ident" id="5492724">t</span>&nbsp;<span class="op" id="5492726">==</span>&nbsp;<span class="ident" id="5492729">nil</span>&nbsp;<span class="op" id="5492733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492738">t</span>&nbsp;<span class="op" id="5492740">=</span>&nbsp;<span class="ident" id="5492742">m</span><span class="op" id="5492743">.</span><span class="ident" id="5492744">alloc</span><span class="op" id="5492749">(</span><span class="ident" id="5492750">i</span><span class="op" id="5492751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492755">}</span>&nbsp;<span class="keyword" id="5492757">else</span>&nbsp;<span class="op" id="5492762">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492767">t</span><span class="op" id="5492768">.</span><span class="ident" id="5492769">inst</span>&nbsp;<span class="op" id="5492774">=</span>&nbsp;<span class="ident" id="5492776">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492784">if</span>&nbsp;<span class="builtinfunc" id="5492787">len</span><span class="op" id="5492790">(</span><span class="builtinfunc" id="5492791">cap</span><span class="op" id="5492794">)</span>&nbsp;<span class="op" id="5492796">&gt;</span>&nbsp;<span class="num" id="5492798">0</span>&nbsp;<span class="op" id="5492800">&amp;&amp;</span>&nbsp;<span class="op" id="5492803">&amp;</span><span class="ident" id="5492804">t</span><span class="op" id="5492805">.</span><span class="builtinfunc" id="5492806">cap</span><span class="op" id="5492809">[</span><span class="num" id="5492810">0</span><span class="op" id="5492811">]</span>&nbsp;<span class="op" id="5492813">!=</span>&nbsp;<span class="op" id="5492816">&amp;</span><span class="builtinfunc" id="5492817">cap</span><span class="op" id="5492820">[</span><span class="num" id="5492821">0</span><span class="op" id="5492822">]</span>&nbsp;<span class="op" id="5492824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5492829">copy</span><span class="op" id="5492833">(</span><span class="ident" id="5492834">t</span><span class="op" id="5492835">.</span><span class="builtinfunc" id="5492836">cap</span><span class="op" id="5492839">,</span>&nbsp;<span class="builtinfunc" id="5492841">cap</span><span class="op" id="5492844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492848">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492852">d</span><span class="op" id="5492853">.</span><span class="ident" id="5492854">t</span>&nbsp;<span class="op" id="5492856">=</span>&nbsp;<span class="ident" id="5492858">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5492862">t</span>&nbsp;<span class="op" id="5492864">=</span>&nbsp;<span class="ident" id="5492866">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5492871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5492874">return</span>&nbsp;<span class="ident" id="5492881">t</span><br>
<span class="lineno"></span><span class="op" id="5492883">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5492886">//&nbsp;onepass&nbsp;runs&nbsp;the&nbsp;machine&nbsp;over&nbsp;the&nbsp;input&nbsp;starting&nbsp;at&nbsp;pos.</span><br>
<span class="lineno"></span><span class="comment" id="5492946">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;a&nbsp;match&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="5492987">//&nbsp;If&nbsp;so,&nbsp;m.matchcap&nbsp;holds&nbsp;the&nbsp;submatch&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="5493040">func</span>&nbsp;<span class="op" id="5493045">(</span><span class="ident" id="5493046">m</span>&nbsp;<span class="op" id="5493048">*</span><span class="ident" id="5493049">machine</span><span class="op" id="5493056">)</span>&nbsp;<span class="ident" id="5493058">onepass</span><span class="op" id="5493065">(</span><span class="ident" id="5493066">i</span>&nbsp;<span class="ident" id="5493068">input</span><span class="op" id="5493073">,</span>&nbsp;<span class="ident" id="5493075">pos</span>&nbsp;<span class="builtintype" id="5493079">int</span><span class="op" id="5493082">)</span>&nbsp;<span class="builtintype" id="5493084">bool</span>&nbsp;<span class="op" id="5493089">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493092">startCond</span>&nbsp;<span class="op" id="5493102">:=</span>&nbsp;<span class="ident" id="5493105">m</span><span class="op" id="5493106">.</span><span class="ident" id="5493107">re</span><span class="op" id="5493109">.</span><span class="ident" id="5493110">cond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493116">if</span>&nbsp;<span class="ident" id="5493119">startCond</span>&nbsp;<span class="op" id="5493129">==</span>&nbsp;<span class="op" id="5493132">^</span><span class="ident" id="5493133">syntax</span><span class="op" id="5493139">.</span><span class="ident" id="5493140">EmptyOp</span><span class="op" id="5493147">(</span><span class="num" id="5493148">0</span><span class="op" id="5493149">)</span>&nbsp;<span class="op" id="5493151">{</span>&nbsp;<span class="comment" id="5493153">//&nbsp;impossible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493169">return</span>&nbsp;<span class="builtintype" id="5493176">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493186">m</span><span class="op" id="5493187">.</span><span class="ident" id="5493188">matched</span>&nbsp;<span class="op" id="5493196">=</span>&nbsp;<span class="builtintype" id="5493198">false</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493205">for</span>&nbsp;<span class="ident" id="5493209">i</span>&nbsp;<span class="op" id="5493211">:=</span>&nbsp;<span class="keyword" id="5493214">range</span>&nbsp;<span class="ident" id="5493220">m</span><span class="op" id="5493221">.</span><span class="ident" id="5493222">matchcap</span>&nbsp;<span class="op" id="5493231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493235">m</span><span class="op" id="5493236">.</span><span class="ident" id="5493237">matchcap</span><span class="op" id="5493245">[</span><span class="ident" id="5493246">i</span><span class="op" id="5493247">]</span>&nbsp;<span class="op" id="5493249">=</span>&nbsp;<span class="op" id="5493251">-</span><span class="num" id="5493252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493258">r</span><span class="op" id="5493259">,</span>&nbsp;<span class="ident" id="5493261">r1</span>&nbsp;<span class="op" id="5493264">:=</span>&nbsp;<span class="ident" id="5493267">endOfText</span><span class="op" id="5493276">,</span>&nbsp;<span class="ident" id="5493278">endOfText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493289">width</span><span class="op" id="5493294">,</span>&nbsp;<span class="ident" id="5493296">width1</span>&nbsp;<span class="op" id="5493303">:=</span>&nbsp;<span class="num" id="5493306">0</span><span class="op" id="5493307">,</span>&nbsp;<span class="num" id="5493309">0</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493312">r</span><span class="op" id="5493313">,</span>&nbsp;<span class="ident" id="5493315">width</span>&nbsp;<span class="op" id="5493321">=</span>&nbsp;<span class="ident" id="5493323">i</span><span class="op" id="5493324">.</span><span class="ident" id="5493325">step</span><span class="op" id="5493329">(</span><span class="ident" id="5493330">pos</span><span class="op" id="5493333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493336">if</span>&nbsp;<span class="ident" id="5493339">r</span>&nbsp;<span class="op" id="5493341">!=</span>&nbsp;<span class="ident" id="5493344">endOfText</span>&nbsp;<span class="op" id="5493354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493358">r1</span><span class="op" id="5493360">,</span>&nbsp;<span class="ident" id="5493362">width1</span>&nbsp;<span class="op" id="5493369">=</span>&nbsp;<span class="ident" id="5493371">i</span><span class="op" id="5493372">.</span><span class="ident" id="5493373">step</span><span class="op" id="5493377">(</span><span class="ident" id="5493378">pos</span>&nbsp;<span class="op" id="5493382">+</span>&nbsp;<span class="ident" id="5493384">width</span><span class="op" id="5493389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493395">var</span>&nbsp;<span class="ident" id="5493399">flag</span>&nbsp;<span class="ident" id="5493404">syntax</span><span class="op" id="5493410">.</span><span class="ident" id="5493411">EmptyOp</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493420">if</span>&nbsp;<span class="ident" id="5493423">pos</span>&nbsp;<span class="op" id="5493427">==</span>&nbsp;<span class="num" id="5493430">0</span>&nbsp;<span class="op" id="5493432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493436">flag</span>&nbsp;<span class="op" id="5493441">=</span>&nbsp;<span class="ident" id="5493443">syntax</span><span class="op" id="5493449">.</span><span class="ident" id="5493450">EmptyOpContext</span><span class="op" id="5493464">(</span><span class="op" id="5493465">-</span><span class="num" id="5493466">1</span><span class="op" id="5493467">,</span>&nbsp;<span class="ident" id="5493469">r</span><span class="op" id="5493470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493473">}</span>&nbsp;<span class="keyword" id="5493475">else</span>&nbsp;<span class="op" id="5493480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493484">flag</span>&nbsp;<span class="op" id="5493489">=</span>&nbsp;<span class="ident" id="5493491">i</span><span class="op" id="5493492">.</span><span class="ident" id="5493493">context</span><span class="op" id="5493500">(</span><span class="ident" id="5493501">pos</span><span class="op" id="5493504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493507">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493510">pc</span>&nbsp;<span class="op" id="5493513">:=</span>&nbsp;<span class="ident" id="5493516">m</span><span class="op" id="5493517">.</span><span class="ident" id="5493518">op</span><span class="op" id="5493520">.</span><span class="ident" id="5493521">Start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493528">inst</span>&nbsp;<span class="op" id="5493533">:=</span>&nbsp;<span class="ident" id="5493536">m</span><span class="op" id="5493537">.</span><span class="ident" id="5493538">op</span><span class="op" id="5493540">.</span><span class="ident" id="5493541">Inst</span><span class="op" id="5493545">[</span><span class="ident" id="5493546">pc</span><span class="op" id="5493548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493551">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;simple&nbsp;literal&nbsp;prefix,&nbsp;skip&nbsp;over&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493606">if</span>&nbsp;<span class="ident" id="5493609">pos</span>&nbsp;<span class="op" id="5493613">==</span>&nbsp;<span class="num" id="5493616">0</span>&nbsp;<span class="op" id="5493618">&amp;&amp;</span>&nbsp;<span class="ident" id="5493621">syntax</span><span class="op" id="5493627">.</span><span class="ident" id="5493628">EmptyOp</span><span class="op" id="5493635">(</span><span class="ident" id="5493636">inst</span><span class="op" id="5493640">.</span><span class="ident" id="5493641">Arg</span><span class="op" id="5493644">)</span><span class="op" id="5493645">&amp;^</span><span class="ident" id="5493647">flag</span>&nbsp;<span class="op" id="5493652">==</span>&nbsp;<span class="num" id="5493655">0</span>&nbsp;<span class="op" id="5493657">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5493662">len</span><span class="op" id="5493665">(</span><span class="ident" id="5493666">m</span><span class="op" id="5493667">.</span><span class="ident" id="5493668">re</span><span class="op" id="5493670">.</span><span class="ident" id="5493671">prefix</span><span class="op" id="5493677">)</span>&nbsp;<span class="op" id="5493679">&gt;</span>&nbsp;<span class="num" id="5493681">0</span>&nbsp;<span class="op" id="5493683">&amp;&amp;</span>&nbsp;<span class="ident" id="5493686">i</span><span class="op" id="5493687">.</span><span class="ident" id="5493688">canCheckPrefix</span><span class="op" id="5493702">(</span><span class="op" id="5493703">)</span>&nbsp;<span class="op" id="5493705">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5493709">//&nbsp;Match&nbsp;requires&nbsp;literal&nbsp;prefix;&nbsp;fast&nbsp;search&nbsp;for&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493765">if</span>&nbsp;<span class="ident" id="5493768">i</span><span class="op" id="5493769">.</span><span class="ident" id="5493770">hasPrefix</span><span class="op" id="5493779">(</span><span class="ident" id="5493780">m</span><span class="op" id="5493781">.</span><span class="ident" id="5493782">re</span><span class="op" id="5493784">)</span>&nbsp;<span class="op" id="5493786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493791">pos</span>&nbsp;<span class="op" id="5493795">+=</span>&nbsp;<span class="builtinfunc" id="5493798">len</span><span class="op" id="5493801">(</span><span class="ident" id="5493802">m</span><span class="op" id="5493803">.</span><span class="ident" id="5493804">re</span><span class="op" id="5493806">.</span><span class="ident" id="5493807">prefix</span><span class="op" id="5493813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493818">r</span><span class="op" id="5493819">,</span>&nbsp;<span class="ident" id="5493821">width</span>&nbsp;<span class="op" id="5493827">=</span>&nbsp;<span class="ident" id="5493829">i</span><span class="op" id="5493830">.</span><span class="ident" id="5493831">step</span><span class="op" id="5493835">(</span><span class="ident" id="5493836">pos</span><span class="op" id="5493839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493844">r1</span><span class="op" id="5493846">,</span>&nbsp;<span class="ident" id="5493848">width1</span>&nbsp;<span class="op" id="5493855">=</span>&nbsp;<span class="ident" id="5493857">i</span><span class="op" id="5493858">.</span><span class="ident" id="5493859">step</span><span class="op" id="5493863">(</span><span class="ident" id="5493864">pos</span>&nbsp;<span class="op" id="5493868">+</span>&nbsp;<span class="ident" id="5493870">width</span><span class="op" id="5493875">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493880">flag</span>&nbsp;<span class="op" id="5493885">=</span>&nbsp;<span class="ident" id="5493887">i</span><span class="op" id="5493888">.</span><span class="ident" id="5493889">context</span><span class="op" id="5493896">(</span><span class="ident" id="5493897">pos</span><span class="op" id="5493900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493905">pc</span>&nbsp;<span class="op" id="5493908">=</span>&nbsp;<span class="builtintype" id="5493910">int</span><span class="op" id="5493913">(</span><span class="ident" id="5493914">m</span><span class="op" id="5493915">.</span><span class="ident" id="5493916">re</span><span class="op" id="5493918">.</span><span class="ident" id="5493919">prefixEnd</span><span class="op" id="5493928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493932">}</span>&nbsp;<span class="keyword" id="5493934">else</span>&nbsp;<span class="op" id="5493939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493944">return</span>&nbsp;<span class="ident" id="5493951">m</span><span class="op" id="5493952">.</span><span class="ident" id="5493953">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493963">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5493966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5493969">for</span>&nbsp;<span class="op" id="5493973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5493977">inst</span>&nbsp;<span class="op" id="5493982">=</span>&nbsp;<span class="ident" id="5493984">m</span><span class="op" id="5493985">.</span><span class="ident" id="5493986">op</span><span class="op" id="5493988">.</span><span class="ident" id="5493989">Inst</span><span class="op" id="5493993">[</span><span class="ident" id="5493994">pc</span><span class="op" id="5493996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494000">pc</span>&nbsp;<span class="op" id="5494003">=</span>&nbsp;<span class="builtintype" id="5494005">int</span><span class="op" id="5494008">(</span><span class="ident" id="5494009">inst</span><span class="op" id="5494013">.</span><span class="ident" id="5494014">Out</span><span class="op" id="5494017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494021">switch</span>&nbsp;<span class="ident" id="5494028">inst</span><span class="op" id="5494032">.</span><span class="ident" id="5494033">Op</span>&nbsp;<span class="op" id="5494036">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494040">default</span><span class="op" id="5494047">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5494052">panic</span><span class="op" id="5494057">(</span><span class="string" id="5494058">&#34;bad&nbsp;inst&#34;</span><span class="op" id="5494068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494072">case</span>&nbsp;<span class="ident" id="5494077">syntax</span><span class="op" id="5494083">.</span><span class="ident" id="5494084">InstMatch</span><span class="op" id="5494093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494098">m</span><span class="op" id="5494099">.</span><span class="ident" id="5494100">matched</span>&nbsp;<span class="op" id="5494108">=</span>&nbsp;<span class="builtintype" id="5494110">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494118">if</span>&nbsp;<span class="builtinfunc" id="5494121">len</span><span class="op" id="5494124">(</span><span class="ident" id="5494125">m</span><span class="op" id="5494126">.</span><span class="ident" id="5494127">matchcap</span><span class="op" id="5494135">)</span>&nbsp;<span class="op" id="5494137">&gt;</span>&nbsp;<span class="num" id="5494139">0</span>&nbsp;<span class="op" id="5494141">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494147">m</span><span class="op" id="5494148">.</span><span class="ident" id="5494149">matchcap</span><span class="op" id="5494157">[</span><span class="num" id="5494158">0</span><span class="op" id="5494159">]</span>&nbsp;<span class="op" id="5494161">=</span>&nbsp;<span class="num" id="5494163">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494169">m</span><span class="op" id="5494170">.</span><span class="ident" id="5494171">matchcap</span><span class="op" id="5494179">[</span><span class="num" id="5494180">1</span><span class="op" id="5494181">]</span>&nbsp;<span class="op" id="5494183">=</span>&nbsp;<span class="ident" id="5494185">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494197">return</span>&nbsp;<span class="ident" id="5494204">m</span><span class="op" id="5494205">.</span><span class="ident" id="5494206">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494216">case</span>&nbsp;<span class="ident" id="5494221">syntax</span><span class="op" id="5494227">.</span><span class="ident" id="5494228">InstRune</span><span class="op" id="5494236">:</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494241">if</span>&nbsp;<span class="op" id="5494244">!</span><span class="ident" id="5494245">inst</span><span class="op" id="5494249">.</span><span class="ident" id="5494250">MatchRune</span><span class="op" id="5494259">(</span><span class="ident" id="5494260">r</span><span class="op" id="5494261">)</span>&nbsp;<span class="op" id="5494263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494269">return</span>&nbsp;<span class="ident" id="5494276">m</span><span class="op" id="5494277">.</span><span class="ident" id="5494278">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494293">case</span>&nbsp;<span class="ident" id="5494298">syntax</span><span class="op" id="5494304">.</span><span class="ident" id="5494305">InstRune1</span><span class="op" id="5494314">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494319">if</span>&nbsp;<span class="ident" id="5494322">r</span>&nbsp;<span class="op" id="5494324">!=</span>&nbsp;<span class="ident" id="5494327">inst</span><span class="op" id="5494331">.</span><span class="ident" id="5494332">Rune</span><span class="op" id="5494336">[</span><span class="num" id="5494337">0</span><span class="op" id="5494338">]</span>&nbsp;<span class="op" id="5494340">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494346">return</span>&nbsp;<span class="ident" id="5494353">m</span><span class="op" id="5494354">.</span><span class="ident" id="5494355">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494370">case</span>&nbsp;<span class="ident" id="5494375">syntax</span><span class="op" id="5494381">.</span><span class="ident" id="5494382">InstRuneAny</span><span class="op" id="5494393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494398">//&nbsp;Nothing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494411">case</span>&nbsp;<span class="ident" id="5494416">syntax</span><span class="op" id="5494422">.</span><span class="ident" id="5494423">InstRuneAnyNotNL</span><span class="op" id="5494439">:</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494444">if</span>&nbsp;<span class="ident" id="5494447">r</span>&nbsp;<span class="op" id="5494449">==</span>&nbsp;<span class="string" id="5494452">&#39;\n&#39;</span>&nbsp;<span class="op" id="5494457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494463">return</span>&nbsp;<span class="ident" id="5494470">m</span><span class="op" id="5494471">.</span><span class="ident" id="5494472">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494483">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5494487">//&nbsp;peek&nbsp;at&nbsp;the&nbsp;input&nbsp;rune&nbsp;to&nbsp;see&nbsp;which&nbsp;branch&nbsp;of&nbsp;the&nbsp;Alt&nbsp;to&nbsp;take</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494554">case</span>&nbsp;<span class="ident" id="5494559">syntax</span><span class="op" id="5494565">.</span><span class="ident" id="5494566">InstAlt</span><span class="op" id="5494573">,</span>&nbsp;<span class="ident" id="5494575">syntax</span><span class="op" id="5494581">.</span><span class="ident" id="5494582">InstAltMatch</span><span class="op" id="5494594">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494599">pc</span>&nbsp;<span class="op" id="5494602">=</span>&nbsp;<span class="builtintype" id="5494604">int</span><span class="op" id="5494607">(</span><span class="ident" id="5494608">onePassNext</span><span class="op" id="5494619">(</span><span class="op" id="5494620">&amp;</span><span class="ident" id="5494621">inst</span><span class="op" id="5494625">,</span>&nbsp;<span class="ident" id="5494627">r</span><span class="op" id="5494628">)</span><span class="op" id="5494629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494634">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494645">case</span>&nbsp;<span class="ident" id="5494650">syntax</span><span class="op" id="5494656">.</span><span class="ident" id="5494657">InstFail</span><span class="op" id="5494665">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494670">return</span>&nbsp;<span class="ident" id="5494677">m</span><span class="op" id="5494678">.</span><span class="ident" id="5494679">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494689">case</span>&nbsp;<span class="ident" id="5494694">syntax</span><span class="op" id="5494700">.</span><span class="ident" id="5494701">InstNop</span><span class="op" id="5494708">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494713">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494724">case</span>&nbsp;<span class="ident" id="5494729">syntax</span><span class="op" id="5494735">.</span><span class="ident" id="5494736">InstEmptyWidth</span><span class="op" id="5494750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494755">if</span>&nbsp;<span class="ident" id="5494758">syntax</span><span class="op" id="5494764">.</span><span class="ident" id="5494765">EmptyOp</span><span class="op" id="5494772">(</span><span class="ident" id="5494773">inst</span><span class="op" id="5494777">.</span><span class="ident" id="5494778">Arg</span><span class="op" id="5494781">)</span><span class="op" id="5494782">&amp;^</span><span class="ident" id="5494784">flag</span>&nbsp;<span class="op" id="5494789">!=</span>&nbsp;<span class="num" id="5494792">0</span>&nbsp;<span class="op" id="5494794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494800">return</span>&nbsp;<span class="ident" id="5494807">m</span><span class="op" id="5494808">.</span><span class="ident" id="5494809">matched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494820">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494825">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494836">case</span>&nbsp;<span class="ident" id="5494841">syntax</span><span class="op" id="5494847">.</span><span class="ident" id="5494848">InstCapture</span><span class="op" id="5494859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494864">if</span>&nbsp;<span class="builtintype" id="5494867">int</span><span class="op" id="5494870">(</span><span class="ident" id="5494871">inst</span><span class="op" id="5494875">.</span><span class="ident" id="5494876">Arg</span><span class="op" id="5494879">)</span>&nbsp;<span class="op" id="5494881">&lt;</span>&nbsp;<span class="builtinfunc" id="5494883">len</span><span class="op" id="5494886">(</span><span class="ident" id="5494887">m</span><span class="op" id="5494888">.</span><span class="ident" id="5494889">matchcap</span><span class="op" id="5494897">)</span>&nbsp;<span class="op" id="5494899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494905">m</span><span class="op" id="5494906">.</span><span class="ident" id="5494907">matchcap</span><span class="op" id="5494915">[</span><span class="ident" id="5494916">inst</span><span class="op" id="5494920">.</span><span class="ident" id="5494921">Arg</span><span class="op" id="5494924">]</span>&nbsp;<span class="op" id="5494926">=</span>&nbsp;<span class="ident" id="5494928">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494935">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494940">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494955">if</span>&nbsp;<span class="ident" id="5494958">width</span>&nbsp;<span class="op" id="5494964">==</span>&nbsp;<span class="num" id="5494967">0</span>&nbsp;<span class="op" id="5494969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5494974">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5494982">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5494986">flag</span>&nbsp;<span class="op" id="5494991">=</span>&nbsp;<span class="ident" id="5494993">syntax</span><span class="op" id="5494999">.</span><span class="ident" id="5495000">EmptyOpContext</span><span class="op" id="5495014">(</span><span class="ident" id="5495015">r</span><span class="op" id="5495016">,</span>&nbsp;<span class="ident" id="5495018">r1</span><span class="op" id="5495020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495024">pos</span>&nbsp;<span class="op" id="5495028">+=</span>&nbsp;<span class="ident" id="5495031">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495039">r</span><span class="op" id="5495040">,</span>&nbsp;<span class="ident" id="5495042">width</span>&nbsp;<span class="op" id="5495048">=</span>&nbsp;<span class="ident" id="5495050">r1</span><span class="op" id="5495052">,</span>&nbsp;<span class="ident" id="5495054">width1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495063">if</span>&nbsp;<span class="ident" id="5495066">r</span>&nbsp;<span class="op" id="5495068">!=</span>&nbsp;<span class="ident" id="5495071">endOfText</span>&nbsp;<span class="op" id="5495081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495086">r1</span><span class="op" id="5495088">,</span>&nbsp;<span class="ident" id="5495090">width1</span>&nbsp;<span class="op" id="5495097">=</span>&nbsp;<span class="ident" id="5495099">i</span><span class="op" id="5495100">.</span><span class="ident" id="5495101">step</span><span class="op" id="5495105">(</span><span class="ident" id="5495106">pos</span>&nbsp;<span class="op" id="5495110">+</span>&nbsp;<span class="ident" id="5495112">width</span><span class="op" id="5495117">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495127">return</span>&nbsp;<span class="ident" id="5495134">m</span><span class="op" id="5495135">.</span><span class="ident" id="5495136">matched</span><br>
<span class="lineno"></span><span class="op" id="5495144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="5495147">//&nbsp;empty&nbsp;is&nbsp;a&nbsp;non-nil&nbsp;0-element&nbsp;slice,</span><br>
<span class="lineno"></span><span class="comment" id="5495186">//&nbsp;so&nbsp;doExecute&nbsp;can&nbsp;avoid&nbsp;an&nbsp;allocation</span><br>
<span class="lineno"></span><span class="comment" id="5495226">//&nbsp;when&nbsp;0&nbsp;captures&nbsp;are&nbsp;requested&nbsp;from&nbsp;a&nbsp;successful&nbsp;match.</span><br>
<span class="lineno"></span><span class="keyword" id="5495284">var</span>&nbsp;<span class="ident" id="5495288">empty</span>&nbsp;<span class="op" id="5495294">=</span>&nbsp;<span class="builtinfunc" id="5495296">make</span><span class="op" id="5495300">(</span><span class="op" id="5495301">[</span><span class="op" id="5495302">]</span><span class="builtintype" id="5495303">int</span><span class="op" id="5495306">,</span>&nbsp;<span class="num" id="5495308">0</span><span class="op" id="5495309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="5495312">//&nbsp;doExecute&nbsp;finds&nbsp;the&nbsp;leftmost&nbsp;match&nbsp;in&nbsp;the&nbsp;input&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5495375">//&nbsp;the&nbsp;position&nbsp;of&nbsp;its&nbsp;subexpressions.</span><br>
<span class="lineno"></span><span class="keyword" id="5495414">func</span>&nbsp;<span class="op" id="5495419">(</span><span class="ident" id="5495420">re</span>&nbsp;<span class="op" id="5495423">*</span><span class="ident" id="5495424">Regexp</span><span class="op" id="5495430">)</span>&nbsp;<span class="ident" id="5495432">doExecute</span><span class="op" id="5495441">(</span><span class="ident" id="5495442">r</span>&nbsp;<span class="ident" id="5495444">io</span><span class="op" id="5495446">.</span><span class="ident" id="5495447">RuneReader</span><span class="op" id="5495457">,</span>&nbsp;<span class="ident" id="5495459">b</span>&nbsp;<span class="op" id="5495461">[</span><span class="op" id="5495462">]</span><span class="builtintype" id="5495463">byte</span><span class="op" id="5495467">,</span>&nbsp;<span class="ident" id="5495469">s</span>&nbsp;<span class="builtintype" id="5495471">string</span><span class="op" id="5495477">,</span>&nbsp;<span class="ident" id="5495479">pos</span>&nbsp;<span class="builtintype" id="5495483">int</span><span class="op" id="5495486">,</span>&nbsp;<span class="ident" id="5495488">ncap</span>&nbsp;<span class="builtintype" id="5495493">int</span><span class="op" id="5495496">)</span>&nbsp;<span class="op" id="5495498">[</span><span class="op" id="5495499">]</span><span class="builtintype" id="5495500">int</span>&nbsp;<span class="op" id="5495504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495507">m</span>&nbsp;<span class="op" id="5495509">:=</span>&nbsp;<span class="ident" id="5495512">re</span><span class="op" id="5495514">.</span><span class="ident" id="5495515">get</span><span class="op" id="5495518">(</span><span class="op" id="5495519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495522">var</span>&nbsp;<span class="ident" id="5495526">i</span>&nbsp;<span class="ident" id="5495528">input</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495535">if</span>&nbsp;<span class="ident" id="5495538">r</span>&nbsp;<span class="op" id="5495540">!=</span>&nbsp;<span class="ident" id="5495543">nil</span>&nbsp;<span class="op" id="5495547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495551">i</span>&nbsp;<span class="op" id="5495553">=</span>&nbsp;<span class="ident" id="5495555">m</span><span class="op" id="5495556">.</span><span class="ident" id="5495557">newInputReader</span><span class="op" id="5495571">(</span><span class="ident" id="5495572">r</span><span class="op" id="5495573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495576">}</span>&nbsp;<span class="keyword" id="5495578">else</span>&nbsp;<span class="keyword" id="5495583">if</span>&nbsp;<span class="ident" id="5495586">b</span>&nbsp;<span class="op" id="5495588">!=</span>&nbsp;<span class="ident" id="5495591">nil</span>&nbsp;<span class="op" id="5495595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495599">i</span>&nbsp;<span class="op" id="5495601">=</span>&nbsp;<span class="ident" id="5495603">m</span><span class="op" id="5495604">.</span><span class="ident" id="5495605">newInputBytes</span><span class="op" id="5495618">(</span><span class="ident" id="5495619">b</span><span class="op" id="5495620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495623">}</span>&nbsp;<span class="keyword" id="5495625">else</span>&nbsp;<span class="op" id="5495630">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495634">i</span>&nbsp;<span class="op" id="5495636">=</span>&nbsp;<span class="ident" id="5495638">m</span><span class="op" id="5495639">.</span><span class="ident" id="5495640">newInputString</span><span class="op" id="5495654">(</span><span class="ident" id="5495655">s</span><span class="op" id="5495656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495662">if</span>&nbsp;<span class="ident" id="5495665">m</span><span class="op" id="5495666">.</span><span class="ident" id="5495667">op</span>&nbsp;<span class="op" id="5495670">!=</span>&nbsp;<span class="ident" id="5495673">notOnePass</span>&nbsp;<span class="op" id="5495684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495688">if</span>&nbsp;<span class="op" id="5495691">!</span><span class="ident" id="5495692">m</span><span class="op" id="5495693">.</span><span class="ident" id="5495694">onepass</span><span class="op" id="5495701">(</span><span class="ident" id="5495702">i</span><span class="op" id="5495703">,</span>&nbsp;<span class="ident" id="5495705">pos</span><span class="op" id="5495708">)</span>&nbsp;<span class="op" id="5495710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495715">re</span><span class="op" id="5495717">.</span><span class="ident" id="5495718">put</span><span class="op" id="5495721">(</span><span class="ident" id="5495722">m</span><span class="op" id="5495723">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495728">return</span>&nbsp;<span class="ident" id="5495735">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495744">}</span>&nbsp;<span class="keyword" id="5495746">else</span>&nbsp;<span class="op" id="5495751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495755">m</span><span class="op" id="5495756">.</span><span class="ident" id="5495757">init</span><span class="op" id="5495761">(</span><span class="ident" id="5495762">ncap</span><span class="op" id="5495766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495770">if</span>&nbsp;<span class="op" id="5495773">!</span><span class="ident" id="5495774">m</span><span class="op" id="5495775">.</span><span class="ident" id="5495776">match</span><span class="op" id="5495781">(</span><span class="ident" id="5495782">i</span><span class="op" id="5495783">,</span>&nbsp;<span class="ident" id="5495785">pos</span><span class="op" id="5495788">)</span>&nbsp;<span class="op" id="5495790">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495795">re</span><span class="op" id="5495797">.</span><span class="ident" id="5495798">put</span><span class="op" id="5495801">(</span><span class="ident" id="5495802">m</span><span class="op" id="5495803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495808">return</span>&nbsp;<span class="ident" id="5495815">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495827">if</span>&nbsp;<span class="ident" id="5495830">ncap</span>&nbsp;<span class="op" id="5495835">==</span>&nbsp;<span class="num" id="5495838">0</span>&nbsp;<span class="op" id="5495840">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495844">re</span><span class="op" id="5495846">.</span><span class="ident" id="5495847">put</span><span class="op" id="5495850">(</span><span class="ident" id="5495851">m</span><span class="op" id="5495852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495856">return</span>&nbsp;<span class="ident" id="5495863">empty</span>&nbsp;<span class="comment" id="5495869">//&nbsp;empty&nbsp;but&nbsp;not&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5495891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5495894">cap</span>&nbsp;<span class="op" id="5495898">:=</span>&nbsp;<span class="builtinfunc" id="5495901">make</span><span class="op" id="5495905">(</span><span class="op" id="5495906">[</span><span class="op" id="5495907">]</span><span class="builtintype" id="5495908">int</span><span class="op" id="5495911">,</span>&nbsp;<span class="builtinfunc" id="5495913">len</span><span class="op" id="5495916">(</span><span class="ident" id="5495917">m</span><span class="op" id="5495918">.</span><span class="ident" id="5495919">matchcap</span><span class="op" id="5495927">)</span><span class="op" id="5495928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5495931">copy</span><span class="op" id="5495935">(</span><span class="builtinfunc" id="5495936">cap</span><span class="op" id="5495939">,</span>&nbsp;<span class="ident" id="5495941">m</span><span class="op" id="5495942">.</span><span class="ident" id="5495943">matchcap</span><span class="op" id="5495951">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5495954">re</span><span class="op" id="5495956">.</span><span class="ident" id="5495957">put</span><span class="op" id="5495960">(</span><span class="ident" id="5495961">m</span><span class="op" id="5495962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5495965">return</span>&nbsp;<span class="builtinfunc" id="5495972">cap</span><br>
<span class="lineno"></span><span class="op" id="5495976">}</span>
</div>
</body>
</html>
