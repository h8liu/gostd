<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html" class="current">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2478579">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2478634">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2478688">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2478739">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2478809">package</span>&nbsp;<span class="ident" id="2478817">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2478821">import</span>&nbsp;<span class="op" id="2478828">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2478831">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2478837">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2478847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2478850">const</span>&nbsp;<span class="op" id="2478856">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2478859">blockSize</span>&nbsp;<span class="op" id="2478869">=</span>&nbsp;<span class="num" id="2478871">4096</span><br>
<span class="lineno"></span><span class="op" id="2478876">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2478879">func</span>&nbsp;<span class="op" id="2478884">(</span><span class="ident" id="2478885">f</span>&nbsp;<span class="op" id="2478887">*</span><span class="ident" id="2478888">File</span><span class="op" id="2478892">)</span>&nbsp;<span class="ident" id="2478894">readdirnames</span><span class="op" id="2478906">(</span><span class="ident" id="2478907">n</span>&nbsp;<span class="builtintype" id="2478909">int</span><span class="op" id="2478912">)</span>&nbsp;<span class="op" id="2478914">(</span><span class="ident" id="2478915">names</span>&nbsp;<span class="op" id="2478921">[</span><span class="op" id="2478922">]</span><span class="builtintype" id="2478923">string</span><span class="op" id="2478929">,</span>&nbsp;<span class="ident" id="2478931">err</span>&nbsp;<span class="builtintype" id="2478935">error</span><span class="op" id="2478940">)</span>&nbsp;<span class="op" id="2478942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2478945">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2478990">if</span>&nbsp;<span class="ident" id="2478993">f</span><span class="op" id="2478994">.</span><span class="ident" id="2478995">dirinfo</span>&nbsp;<span class="op" id="2479003">==</span>&nbsp;<span class="ident" id="2479006">nil</span>&nbsp;<span class="op" id="2479010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479014">f</span><span class="op" id="2479015">.</span><span class="ident" id="2479016">dirinfo</span>&nbsp;<span class="op" id="2479024">=</span>&nbsp;<span class="builtinfunc" id="2479026">new</span><span class="op" id="2479029">(</span><span class="ident" id="2479030">dirInfo</span><span class="op" id="2479037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2479041">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479088">f</span><span class="op" id="2479089">.</span><span class="ident" id="2479090">dirinfo</span><span class="op" id="2479097">.</span><span class="ident" id="2479098">buf</span>&nbsp;<span class="op" id="2479102">=</span>&nbsp;<span class="builtinfunc" id="2479104">make</span><span class="op" id="2479108">(</span><span class="op" id="2479109">[</span><span class="op" id="2479110">]</span><span class="builtintype" id="2479111">byte</span><span class="op" id="2479115">,</span>&nbsp;<span class="ident" id="2479117">blockSize</span><span class="op" id="2479126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479129">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479132">d</span>&nbsp;<span class="op" id="2479134">:=</span>&nbsp;<span class="ident" id="2479137">f</span><span class="op" id="2479138">.</span><span class="ident" id="2479139">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479149">size</span>&nbsp;<span class="op" id="2479154">:=</span>&nbsp;<span class="ident" id="2479157">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479160">if</span>&nbsp;<span class="ident" id="2479163">size</span>&nbsp;<span class="op" id="2479168">&lt;=</span>&nbsp;<span class="num" id="2479171">0</span>&nbsp;<span class="op" id="2479173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479177">size</span>&nbsp;<span class="op" id="2479182">=</span>&nbsp;<span class="num" id="2479184">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479190">n</span>&nbsp;<span class="op" id="2479192">=</span>&nbsp;<span class="op" id="2479194">-</span><span class="num" id="2479195">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479202">names</span>&nbsp;<span class="op" id="2479208">=</span>&nbsp;<span class="builtinfunc" id="2479210">make</span><span class="op" id="2479214">(</span><span class="op" id="2479215">[</span><span class="op" id="2479216">]</span><span class="builtintype" id="2479217">string</span><span class="op" id="2479223">,</span>&nbsp;<span class="num" id="2479225">0</span><span class="op" id="2479226">,</span>&nbsp;<span class="ident" id="2479228">size</span><span class="op" id="2479232">)</span>&nbsp;<span class="comment" id="2479234">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479263">for</span>&nbsp;<span class="ident" id="2479267">n</span>&nbsp;<span class="op" id="2479269">!=</span>&nbsp;<span class="num" id="2479272">0</span>&nbsp;<span class="op" id="2479274">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2479278">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479314">if</span>&nbsp;<span class="ident" id="2479317">d</span><span class="op" id="2479318">.</span><span class="ident" id="2479319">bufp</span>&nbsp;<span class="op" id="2479324">&gt;=</span>&nbsp;<span class="ident" id="2479327">d</span><span class="op" id="2479328">.</span><span class="ident" id="2479329">nbuf</span>&nbsp;<span class="op" id="2479334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479339">d</span><span class="op" id="2479340">.</span><span class="ident" id="2479341">bufp</span>&nbsp;<span class="op" id="2479346">=</span>&nbsp;<span class="num" id="2479348">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479353">var</span>&nbsp;<span class="ident" id="2479357">errno</span>&nbsp;<span class="builtintype" id="2479363">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479372">d</span><span class="op" id="2479373">.</span><span class="ident" id="2479374">nbuf</span><span class="op" id="2479378">,</span>&nbsp;<span class="ident" id="2479380">errno</span>&nbsp;<span class="op" id="2479386">=</span>&nbsp;<span class="ident" id="2479388">fixCount</span><span class="op" id="2479396">(</span><span class="ident" id="2479397">syscall</span><span class="op" id="2479404">.</span><span class="ident" id="2479405">ReadDirent</span><span class="op" id="2479415">(</span><span class="ident" id="2479416">f</span><span class="op" id="2479417">.</span><span class="ident" id="2479418">fd</span><span class="op" id="2479420">,</span>&nbsp;<span class="ident" id="2479422">d</span><span class="op" id="2479423">.</span><span class="ident" id="2479424">buf</span><span class="op" id="2479427">)</span><span class="op" id="2479428">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479433">if</span>&nbsp;<span class="ident" id="2479436">errno</span>&nbsp;<span class="op" id="2479442">!=</span>&nbsp;<span class="ident" id="2479445">nil</span>&nbsp;<span class="op" id="2479449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479455">return</span>&nbsp;<span class="ident" id="2479462">names</span><span class="op" id="2479467">,</span>&nbsp;<span class="ident" id="2479469">NewSyscallError</span><span class="op" id="2479484">(</span><span class="string" id="2479485">&#34;readdirent&#34;</span><span class="op" id="2479497">,</span>&nbsp;<span class="ident" id="2479499">errno</span><span class="op" id="2479504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479514">if</span>&nbsp;<span class="ident" id="2479517">d</span><span class="op" id="2479518">.</span><span class="ident" id="2479519">nbuf</span>&nbsp;<span class="op" id="2479524">&lt;=</span>&nbsp;<span class="num" id="2479527">0</span>&nbsp;<span class="op" id="2479529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479535">break</span>&nbsp;<span class="comment" id="2479541">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2479560">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479582">var</span>&nbsp;<span class="ident" id="2479586">nb</span><span class="op" id="2479588">,</span>&nbsp;<span class="ident" id="2479590">nc</span>&nbsp;<span class="builtintype" id="2479593">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479599">nb</span><span class="op" id="2479601">,</span>&nbsp;<span class="ident" id="2479603">nc</span><span class="op" id="2479605">,</span>&nbsp;<span class="ident" id="2479607">names</span>&nbsp;<span class="op" id="2479613">=</span>&nbsp;<span class="ident" id="2479615">syscall</span><span class="op" id="2479622">.</span><span class="ident" id="2479623">ParseDirent</span><span class="op" id="2479634">(</span><span class="ident" id="2479635">d</span><span class="op" id="2479636">.</span><span class="ident" id="2479637">buf</span><span class="op" id="2479640">[</span><span class="ident" id="2479641">d</span><span class="op" id="2479642">.</span><span class="ident" id="2479643">bufp</span><span class="op" id="2479647">:</span><span class="ident" id="2479648">d</span><span class="op" id="2479649">.</span><span class="ident" id="2479650">nbuf</span><span class="op" id="2479654">]</span><span class="op" id="2479655">,</span>&nbsp;<span class="ident" id="2479657">n</span><span class="op" id="2479658">,</span>&nbsp;<span class="ident" id="2479660">names</span><span class="op" id="2479665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479669">d</span><span class="op" id="2479670">.</span><span class="ident" id="2479671">bufp</span>&nbsp;<span class="op" id="2479676">+=</span>&nbsp;<span class="ident" id="2479679">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2479684">n</span>&nbsp;<span class="op" id="2479686">-=</span>&nbsp;<span class="ident" id="2479689">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479696">if</span>&nbsp;<span class="ident" id="2479699">n</span>&nbsp;<span class="op" id="2479701">&gt;=</span>&nbsp;<span class="num" id="2479704">0</span>&nbsp;<span class="op" id="2479706">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2479709">len</span><span class="op" id="2479712">(</span><span class="ident" id="2479713">names</span><span class="op" id="2479718">)</span>&nbsp;<span class="op" id="2479720">==</span>&nbsp;<span class="num" id="2479723">0</span>&nbsp;<span class="op" id="2479725">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479729">return</span>&nbsp;<span class="ident" id="2479736">names</span><span class="op" id="2479741">,</span>&nbsp;<span class="ident" id="2479743">io</span><span class="op" id="2479745">.</span><span class="ident" id="2479746">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2479751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2479754">return</span>&nbsp;<span class="ident" id="2479761">names</span><span class="op" id="2479766">,</span>&nbsp;<span class="ident" id="2479768">nil</span><br>
<span class="lineno"></span><span class="op" id="2479772">}</span>
</div>
</body>
</html>
