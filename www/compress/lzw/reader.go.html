<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5496422">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5496477">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5496531">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5496582">//&nbsp;Package&nbsp;lzw&nbsp;implements&nbsp;the&nbsp;Lempel-Ziv-Welch&nbsp;compressed&nbsp;data&nbsp;format,</span><br>
<span class="lineno"></span><span class="comment" id="5496653">//&nbsp;described&nbsp;in&nbsp;T.&nbsp;A.&nbsp;Welch,&nbsp;``A&nbsp;Technique&nbsp;for&nbsp;High-Performance&nbsp;Data</span><br>
<span class="lineno"></span><span class="comment" id="5496722">//&nbsp;Compression&#39;&#39;,&nbsp;Computer,&nbsp;17(6)&nbsp;(June&nbsp;1984),&nbsp;pp&nbsp;8-19.</span><br>
<span class="lineno"></span><span class="comment" id="5496778">//</span><br>
<span class="lineno"></span><span class="comment" id="5496781">//&nbsp;In&nbsp;particular,&nbsp;it&nbsp;implements&nbsp;LZW&nbsp;as&nbsp;used&nbsp;by&nbsp;the&nbsp;GIF&nbsp;and&nbsp;PDF&nbsp;file</span><br>
<span class="lineno">10</span><span class="comment" id="5496849">//&nbsp;formats,&nbsp;which&nbsp;means&nbsp;variable-width&nbsp;codes&nbsp;up&nbsp;to&nbsp;12&nbsp;bits&nbsp;and&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5496922">//&nbsp;two&nbsp;non-literal&nbsp;codes&nbsp;are&nbsp;a&nbsp;clear&nbsp;code&nbsp;and&nbsp;an&nbsp;EOF&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="5496981">//</span><br>
<span class="lineno"></span><span class="comment" id="5496984">//&nbsp;The&nbsp;TIFF&nbsp;file&nbsp;format&nbsp;uses&nbsp;a&nbsp;similar&nbsp;but&nbsp;incompatible&nbsp;version&nbsp;of&nbsp;the&nbsp;LZW</span><br>
<span class="lineno"></span><span class="comment" id="5497059">//&nbsp;algorithm.&nbsp;See&nbsp;the&nbsp;golang.org/x/image/tiff/lzw&nbsp;package&nbsp;for&nbsp;an</span><br>
<span class="lineno">15</span><span class="comment" id="5497124">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="5497143">package</span>&nbsp;<span class="ident" id="5497151">lzw</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5497156">//&nbsp;TODO(nigeltao):&nbsp;check&nbsp;that&nbsp;PDF&nbsp;uses&nbsp;LZW&nbsp;in&nbsp;the&nbsp;same&nbsp;way&nbsp;as&nbsp;GIF,</span><br>
<span class="lineno"></span><span class="comment" id="5497223">//&nbsp;modulo&nbsp;LSB/MSB&nbsp;packing&nbsp;order.</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5497257">import</span>&nbsp;<span class="op" id="5497264">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5497267">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5497276">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5497286">&#34;fmt&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5497293">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5497298">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5497301">//&nbsp;Order&nbsp;specifies&nbsp;the&nbsp;bit&nbsp;ordering&nbsp;in&nbsp;an&nbsp;LZW&nbsp;data&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5497360">type</span>&nbsp;<span class="ident" id="5497365">Order</span>&nbsp;<span class="builtintype" id="5497371">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="5497376">const</span>&nbsp;<span class="op" id="5497382">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497385">//&nbsp;LSB&nbsp;means&nbsp;Least&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;GIF&nbsp;file&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497461">LSB</span>&nbsp;<span class="ident" id="5497465">Order</span>&nbsp;<span class="op" id="5497471">=</span>&nbsp;<span class="ident" id="5497473">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497479">//&nbsp;MSB&nbsp;means&nbsp;Most&nbsp;Significant&nbsp;Bits&nbsp;first,&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;TIFF&nbsp;and&nbsp;PDF</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5497550">//&nbsp;file&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497568">MSB</span><br>
<span class="lineno"></span><span class="op" id="5497572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5497575">const</span>&nbsp;<span class="op" id="5497581">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497584">maxWidth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497603">=</span>&nbsp;<span class="num" id="5497605">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497609">decoderInvalidCode</span>&nbsp;<span class="op" id="5497628">=</span>&nbsp;<span class="num" id="5497630">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497638">flushBuffer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5497657">=</span>&nbsp;<span class="num" id="5497659">1</span>&nbsp;<span class="op" id="5497661">&lt;&lt;</span>&nbsp;<span class="ident" id="5497664">maxWidth</span><br>
<span class="lineno"></span><span class="op" id="5497673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5497676">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;state&nbsp;from&nbsp;which&nbsp;the&nbsp;readXxx&nbsp;method&nbsp;converts&nbsp;a&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="5497746">//&nbsp;stream&nbsp;into&nbsp;a&nbsp;code&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5497776">type</span>&nbsp;<span class="ident" id="5497781">decoder</span>&nbsp;<span class="keyword" id="5497789">struct</span>&nbsp;<span class="op" id="5497796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497799">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5497808">io</span><span class="op" id="5497810">.</span><span class="ident" id="5497811">ByteReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497823">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5497832">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497840">nBits</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5497849">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497855">width</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5497864">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497870">read</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5497879">func</span><span class="op" id="5497883">(</span><span class="op" id="5497884">*</span><span class="ident" id="5497885">decoder</span><span class="op" id="5497892">)</span>&nbsp;<span class="op" id="5497894">(</span><span class="builtintype" id="5497895">uint16</span><span class="op" id="5497901">,</span>&nbsp;<span class="builtintype" id="5497903">error</span><span class="op" id="5497908">)</span>&nbsp;<span class="comment" id="5497910">//&nbsp;readLSB&nbsp;or&nbsp;readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5497933">litWidth</span>&nbsp;<span class="builtintype" id="5497942">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5497973">//&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498008">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5498017">error</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498025">//&nbsp;The&nbsp;first&nbsp;1&lt;&lt;litWidth&nbsp;codes&nbsp;are&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498076">//&nbsp;The&nbsp;next&nbsp;two&nbsp;codes&nbsp;mean&nbsp;clear&nbsp;and&nbsp;EOF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498119">//&nbsp;Other&nbsp;valid&nbsp;codes&nbsp;are&nbsp;in&nbsp;the&nbsp;range&nbsp;[lo,&nbsp;hi]&nbsp;where&nbsp;lo&nbsp;:=&nbsp;clear&nbsp;+&nbsp;2,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498190">//&nbsp;with&nbsp;the&nbsp;upper&nbsp;bound&nbsp;incrementing&nbsp;on&nbsp;each&nbsp;code&nbsp;seen.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498247">//&nbsp;overflow&nbsp;is&nbsp;the&nbsp;code&nbsp;at&nbsp;which&nbsp;hi&nbsp;overflows&nbsp;the&nbsp;code&nbsp;width.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498310">//&nbsp;last&nbsp;is&nbsp;the&nbsp;most&nbsp;recently&nbsp;seen&nbsp;code,&nbsp;or&nbsp;decoderInvalidCode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498374">clear</span><span class="op" id="5498379">,</span>&nbsp;<span class="ident" id="5498381">eof</span><span class="op" id="5498384">,</span>&nbsp;<span class="ident" id="5498386">hi</span><span class="op" id="5498388">,</span>&nbsp;<span class="ident" id="5498390">overflow</span><span class="op" id="5498398">,</span>&nbsp;<span class="ident" id="5498400">last</span>&nbsp;<span class="builtintype" id="5498405">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498414">//&nbsp;Each&nbsp;code&nbsp;c&nbsp;in&nbsp;[lo,&nbsp;hi]&nbsp;expands&nbsp;to&nbsp;two&nbsp;or&nbsp;more&nbsp;bytes.&nbsp;For&nbsp;c&nbsp;!=&nbsp;hi:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498485">//&nbsp;&nbsp;&nbsp;suffix[c]&nbsp;is&nbsp;the&nbsp;last&nbsp;of&nbsp;these&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498529">//&nbsp;&nbsp;&nbsp;prefix[c]&nbsp;is&nbsp;the&nbsp;code&nbsp;for&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498584">//&nbsp;&nbsp;&nbsp;This&nbsp;code&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;literal&nbsp;code&nbsp;or&nbsp;another&nbsp;code&nbsp;in&nbsp;[lo,&nbsp;c).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498657">//&nbsp;The&nbsp;c&nbsp;==&nbsp;hi&nbsp;case&nbsp;is&nbsp;a&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498697">suffix</span>&nbsp;<span class="op" id="5498704">[</span><span class="num" id="5498705">1</span>&nbsp;<span class="op" id="5498707">&lt;&lt;</span>&nbsp;<span class="ident" id="5498710">maxWidth</span><span class="op" id="5498718">]</span><span class="builtintype" id="5498719">uint8</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5498726">prefix</span>&nbsp;<span class="op" id="5498733">[</span><span class="num" id="5498734">1</span>&nbsp;<span class="op" id="5498736">&lt;&lt;</span>&nbsp;<span class="ident" id="5498739">maxWidth</span><span class="op" id="5498747">]</span><span class="builtintype" id="5498748">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498757">//&nbsp;output&nbsp;is&nbsp;the&nbsp;temporary&nbsp;output&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498800">//&nbsp;Literal&nbsp;codes&nbsp;are&nbsp;accumulated&nbsp;from&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498864">//&nbsp;Non-literal&nbsp;codes&nbsp;decode&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;suffixes&nbsp;that&nbsp;are&nbsp;first</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5498934">//&nbsp;written&nbsp;right-to-left&nbsp;from&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;buffer&nbsp;before&nbsp;being&nbsp;copied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499007">//&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499039">//&nbsp;It&nbsp;is&nbsp;flushed&nbsp;when&nbsp;it&nbsp;contains&nbsp;&gt;=&nbsp;1&lt;&lt;maxWidth&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5499096">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;always&nbsp;room&nbsp;to&nbsp;decode&nbsp;an&nbsp;entire&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499155">output</span>&nbsp;<span class="op" id="5499162">[</span><span class="num" id="5499163">2</span>&nbsp;<span class="op" id="5499165">*</span>&nbsp;<span class="num" id="5499167">1</span>&nbsp;<span class="op" id="5499169">&lt;&lt;</span>&nbsp;<span class="ident" id="5499172">maxWidth</span><span class="op" id="5499180">]</span><span class="builtintype" id="5499181">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499187">o</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5499194">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5499201">//&nbsp;write&nbsp;index&nbsp;into&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499229">toRead</span>&nbsp;<span class="op" id="5499236">[</span><span class="op" id="5499237">]</span><span class="builtintype" id="5499238">byte</span>&nbsp;<span class="comment" id="5499243">//&nbsp;bytes&nbsp;to&nbsp;return&nbsp;from&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="5499272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5499275">//&nbsp;readLSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Least&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno">85</span><span class="keyword" id="5499349">func</span>&nbsp;<span class="op" id="5499354">(</span><span class="ident" id="5499355">d</span>&nbsp;<span class="op" id="5499357">*</span><span class="ident" id="5499358">decoder</span><span class="op" id="5499365">)</span>&nbsp;<span class="ident" id="5499367">readLSB</span><span class="op" id="5499374">(</span><span class="op" id="5499375">)</span>&nbsp;<span class="op" id="5499377">(</span><span class="builtintype" id="5499378">uint16</span><span class="op" id="5499384">,</span>&nbsp;<span class="builtintype" id="5499386">error</span><span class="op" id="5499391">)</span>&nbsp;<span class="op" id="5499393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499396">for</span>&nbsp;<span class="ident" id="5499400">d</span><span class="op" id="5499401">.</span><span class="ident" id="5499402">nBits</span>&nbsp;<span class="op" id="5499408">&lt;</span>&nbsp;<span class="ident" id="5499410">d</span><span class="op" id="5499411">.</span><span class="ident" id="5499412">width</span>&nbsp;<span class="op" id="5499418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499422">x</span><span class="op" id="5499423">,</span>&nbsp;<span class="ident" id="5499425">err</span>&nbsp;<span class="op" id="5499429">:=</span>&nbsp;<span class="ident" id="5499432">d</span><span class="op" id="5499433">.</span><span class="ident" id="5499434">r</span><span class="op" id="5499435">.</span><span class="ident" id="5499436">ReadByte</span><span class="op" id="5499444">(</span><span class="op" id="5499445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499449">if</span>&nbsp;<span class="ident" id="5499452">err</span>&nbsp;<span class="op" id="5499456">!=</span>&nbsp;<span class="ident" id="5499459">nil</span>&nbsp;<span class="op" id="5499463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499468">return</span>&nbsp;<span class="num" id="5499475">0</span><span class="op" id="5499476">,</span>&nbsp;<span class="ident" id="5499478">err</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499488">d</span><span class="op" id="5499489">.</span><span class="ident" id="5499490">bits</span>&nbsp;<span class="op" id="5499495">|=</span>&nbsp;<span class="builtintype" id="5499498">uint32</span><span class="op" id="5499504">(</span><span class="ident" id="5499505">x</span><span class="op" id="5499506">)</span>&nbsp;<span class="op" id="5499508">&lt;&lt;</span>&nbsp;<span class="ident" id="5499511">d</span><span class="op" id="5499512">.</span><span class="ident" id="5499513">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499521">d</span><span class="op" id="5499522">.</span><span class="ident" id="5499523">nBits</span>&nbsp;<span class="op" id="5499529">+=</span>&nbsp;<span class="num" id="5499532">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499538">code</span>&nbsp;<span class="op" id="5499543">:=</span>&nbsp;<span class="builtintype" id="5499546">uint16</span><span class="op" id="5499552">(</span><span class="ident" id="5499553">d</span><span class="op" id="5499554">.</span><span class="ident" id="5499555">bits</span>&nbsp;<span class="op" id="5499560">&amp;</span>&nbsp;<span class="op" id="5499562">(</span><span class="num" id="5499563">1</span><span class="op" id="5499564">&lt;&lt;</span><span class="ident" id="5499566">d</span><span class="op" id="5499567">.</span><span class="ident" id="5499568">width</span>&nbsp;<span class="op" id="5499574">-</span>&nbsp;<span class="num" id="5499576">1</span><span class="op" id="5499577">)</span><span class="op" id="5499578">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499581">d</span><span class="op" id="5499582">.</span><span class="ident" id="5499583">bits</span>&nbsp;<span class="op" id="5499588">&gt;&gt;=</span>&nbsp;<span class="ident" id="5499592">d</span><span class="op" id="5499593">.</span><span class="ident" id="5499594">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499601">d</span><span class="op" id="5499602">.</span><span class="ident" id="5499603">nBits</span>&nbsp;<span class="op" id="5499609">-=</span>&nbsp;<span class="ident" id="5499612">d</span><span class="op" id="5499613">.</span><span class="ident" id="5499614">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499621">return</span>&nbsp;<span class="ident" id="5499628">code</span><span class="op" id="5499632">,</span>&nbsp;<span class="ident" id="5499634">nil</span><br>
<span class="lineno"></span><span class="op" id="5499638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5499641">//&nbsp;readMSB&nbsp;returns&nbsp;the&nbsp;next&nbsp;code&nbsp;for&nbsp;&#34;Most&nbsp;Significant&nbsp;Bits&nbsp;first&#34;&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5499714">func</span>&nbsp;<span class="op" id="5499719">(</span><span class="ident" id="5499720">d</span>&nbsp;<span class="op" id="5499722">*</span><span class="ident" id="5499723">decoder</span><span class="op" id="5499730">)</span>&nbsp;<span class="ident" id="5499732">readMSB</span><span class="op" id="5499739">(</span><span class="op" id="5499740">)</span>&nbsp;<span class="op" id="5499742">(</span><span class="builtintype" id="5499743">uint16</span><span class="op" id="5499749">,</span>&nbsp;<span class="builtintype" id="5499751">error</span><span class="op" id="5499756">)</span>&nbsp;<span class="op" id="5499758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499761">for</span>&nbsp;<span class="ident" id="5499765">d</span><span class="op" id="5499766">.</span><span class="ident" id="5499767">nBits</span>&nbsp;<span class="op" id="5499773">&lt;</span>&nbsp;<span class="ident" id="5499775">d</span><span class="op" id="5499776">.</span><span class="ident" id="5499777">width</span>&nbsp;<span class="op" id="5499783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499787">x</span><span class="op" id="5499788">,</span>&nbsp;<span class="ident" id="5499790">err</span>&nbsp;<span class="op" id="5499794">:=</span>&nbsp;<span class="ident" id="5499797">d</span><span class="op" id="5499798">.</span><span class="ident" id="5499799">r</span><span class="op" id="5499800">.</span><span class="ident" id="5499801">ReadByte</span><span class="op" id="5499809">(</span><span class="op" id="5499810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499814">if</span>&nbsp;<span class="ident" id="5499817">err</span>&nbsp;<span class="op" id="5499821">!=</span>&nbsp;<span class="ident" id="5499824">nil</span>&nbsp;<span class="op" id="5499828">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499833">return</span>&nbsp;<span class="num" id="5499840">0</span><span class="op" id="5499841">,</span>&nbsp;<span class="ident" id="5499843">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499853">d</span><span class="op" id="5499854">.</span><span class="ident" id="5499855">bits</span>&nbsp;<span class="op" id="5499860">|=</span>&nbsp;<span class="builtintype" id="5499863">uint32</span><span class="op" id="5499869">(</span><span class="ident" id="5499870">x</span><span class="op" id="5499871">)</span>&nbsp;<span class="op" id="5499873">&lt;&lt;</span>&nbsp;<span class="op" id="5499876">(</span><span class="num" id="5499877">24</span>&nbsp;<span class="op" id="5499880">-</span>&nbsp;<span class="ident" id="5499882">d</span><span class="op" id="5499883">.</span><span class="ident" id="5499884">nBits</span><span class="op" id="5499889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499893">d</span><span class="op" id="5499894">.</span><span class="ident" id="5499895">nBits</span>&nbsp;<span class="op" id="5499901">+=</span>&nbsp;<span class="num" id="5499904">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5499907">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499910">code</span>&nbsp;<span class="op" id="5499915">:=</span>&nbsp;<span class="builtintype" id="5499918">uint16</span><span class="op" id="5499924">(</span><span class="ident" id="5499925">d</span><span class="op" id="5499926">.</span><span class="ident" id="5499927">bits</span>&nbsp;<span class="op" id="5499932">&gt;&gt;</span>&nbsp;<span class="op" id="5499935">(</span><span class="num" id="5499936">32</span>&nbsp;<span class="op" id="5499939">-</span>&nbsp;<span class="ident" id="5499941">d</span><span class="op" id="5499942">.</span><span class="ident" id="5499943">width</span><span class="op" id="5499948">)</span><span class="op" id="5499949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499952">d</span><span class="op" id="5499953">.</span><span class="ident" id="5499954">bits</span>&nbsp;<span class="op" id="5499959">&lt;&lt;=</span>&nbsp;<span class="ident" id="5499963">d</span><span class="op" id="5499964">.</span><span class="ident" id="5499965">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5499972">d</span><span class="op" id="5499973">.</span><span class="ident" id="5499974">nBits</span>&nbsp;<span class="op" id="5499980">-=</span>&nbsp;<span class="ident" id="5499983">d</span><span class="op" id="5499984">.</span><span class="ident" id="5499985">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5499992">return</span>&nbsp;<span class="ident" id="5499999">code</span><span class="op" id="5500003">,</span>&nbsp;<span class="ident" id="5500005">nil</span><br>
<span class="lineno"></span><span class="op" id="5500009">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5500012">func</span>&nbsp;<span class="op" id="5500017">(</span><span class="ident" id="5500018">d</span>&nbsp;<span class="op" id="5500020">*</span><span class="ident" id="5500021">decoder</span><span class="op" id="5500028">)</span>&nbsp;<span class="ident" id="5500030">Read</span><span class="op" id="5500034">(</span><span class="ident" id="5500035">b</span>&nbsp;<span class="op" id="5500037">[</span><span class="op" id="5500038">]</span><span class="builtintype" id="5500039">byte</span><span class="op" id="5500043">)</span>&nbsp;<span class="op" id="5500045">(</span><span class="builtintype" id="5500046">int</span><span class="op" id="5500049">,</span>&nbsp;<span class="builtintype" id="5500051">error</span><span class="op" id="5500056">)</span>&nbsp;<span class="op" id="5500058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500061">for</span>&nbsp;<span class="op" id="5500065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500069">if</span>&nbsp;<span class="builtinfunc" id="5500072">len</span><span class="op" id="5500075">(</span><span class="ident" id="5500076">d</span><span class="op" id="5500077">.</span><span class="ident" id="5500078">toRead</span><span class="op" id="5500084">)</span>&nbsp;<span class="op" id="5500086">&gt;</span>&nbsp;<span class="num" id="5500088">0</span>&nbsp;<span class="op" id="5500090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500095">n</span>&nbsp;<span class="op" id="5500097">:=</span>&nbsp;<span class="builtinfunc" id="5500100">copy</span><span class="op" id="5500104">(</span><span class="ident" id="5500105">b</span><span class="op" id="5500106">,</span>&nbsp;<span class="ident" id="5500108">d</span><span class="op" id="5500109">.</span><span class="ident" id="5500110">toRead</span><span class="op" id="5500116">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500121">d</span><span class="op" id="5500122">.</span><span class="ident" id="5500123">toRead</span>&nbsp;<span class="op" id="5500130">=</span>&nbsp;<span class="ident" id="5500132">d</span><span class="op" id="5500133">.</span><span class="ident" id="5500134">toRead</span><span class="op" id="5500140">[</span><span class="ident" id="5500141">n</span><span class="op" id="5500142">:</span><span class="op" id="5500143">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500148">return</span>&nbsp;<span class="ident" id="5500155">n</span><span class="op" id="5500156">,</span>&nbsp;<span class="ident" id="5500158">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500168">if</span>&nbsp;<span class="ident" id="5500171">d</span><span class="op" id="5500172">.</span><span class="ident" id="5500173">err</span>&nbsp;<span class="op" id="5500177">!=</span>&nbsp;<span class="ident" id="5500180">nil</span>&nbsp;<span class="op" id="5500184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500189">return</span>&nbsp;<span class="num" id="5500196">0</span><span class="op" id="5500197">,</span>&nbsp;<span class="ident" id="5500199">d</span><span class="op" id="5500200">.</span><span class="ident" id="5500201">err</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500211">d</span><span class="op" id="5500212">.</span><span class="ident" id="5500213">decode</span><span class="op" id="5500219">(</span><span class="op" id="5500220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500223">}</span><br>
<span class="lineno"></span><span class="op" id="5500225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5500228">//&nbsp;decode&nbsp;decompresses&nbsp;bytes&nbsp;from&nbsp;r&nbsp;and&nbsp;leaves&nbsp;them&nbsp;in&nbsp;d.toRead.</span><br>
<span class="lineno"></span><span class="comment" id="5500293">//&nbsp;read&nbsp;specifies&nbsp;how&nbsp;to&nbsp;decode&nbsp;bytes&nbsp;into&nbsp;codes.</span><br>
<span class="lineno"></span><span class="comment" id="5500343">//&nbsp;litWidth&nbsp;is&nbsp;the&nbsp;width&nbsp;in&nbsp;bits&nbsp;of&nbsp;literal&nbsp;codes.</span><br>
<span class="lineno"></span><span class="keyword" id="5500394">func</span>&nbsp;<span class="op" id="5500399">(</span><span class="ident" id="5500400">d</span>&nbsp;<span class="op" id="5500402">*</span><span class="ident" id="5500403">decoder</span><span class="op" id="5500410">)</span>&nbsp;<span class="ident" id="5500412">decode</span><span class="op" id="5500418">(</span><span class="op" id="5500419">)</span>&nbsp;<span class="op" id="5500421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500424">//&nbsp;Loop&nbsp;over&nbsp;the&nbsp;code&nbsp;stream,&nbsp;converting&nbsp;codes&nbsp;into&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500497">for</span>&nbsp;<span class="op" id="5500501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500505">code</span><span class="op" id="5500509">,</span>&nbsp;<span class="ident" id="5500511">err</span>&nbsp;<span class="op" id="5500515">:=</span>&nbsp;<span class="ident" id="5500518">d</span><span class="op" id="5500519">.</span><span class="ident" id="5500520">read</span><span class="op" id="5500524">(</span><span class="ident" id="5500525">d</span><span class="op" id="5500526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500530">if</span>&nbsp;<span class="ident" id="5500533">err</span>&nbsp;<span class="op" id="5500537">!=</span>&nbsp;<span class="ident" id="5500540">nil</span>&nbsp;<span class="op" id="5500544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500549">if</span>&nbsp;<span class="ident" id="5500552">err</span>&nbsp;<span class="op" id="5500556">==</span>&nbsp;<span class="ident" id="5500559">io</span><span class="op" id="5500561">.</span><span class="ident" id="5500562">EOF</span>&nbsp;<span class="op" id="5500566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500572">err</span>&nbsp;<span class="op" id="5500576">=</span>&nbsp;<span class="ident" id="5500578">io</span><span class="op" id="5500580">.</span><span class="ident" id="5500581">ErrUnexpectedEOF</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500606">d</span><span class="op" id="5500607">.</span><span class="ident" id="5500608">err</span>&nbsp;<span class="op" id="5500612">=</span>&nbsp;<span class="ident" id="5500614">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500621">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500634">switch</span>&nbsp;<span class="op" id="5500641">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500645">case</span>&nbsp;<span class="ident" id="5500650">code</span>&nbsp;<span class="op" id="5500655">&lt;</span>&nbsp;<span class="ident" id="5500657">d</span><span class="op" id="5500658">.</span><span class="ident" id="5500659">clear</span><span class="op" id="5500664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500669">//&nbsp;We&nbsp;have&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500699">d</span><span class="op" id="5500700">.</span><span class="ident" id="5500701">output</span><span class="op" id="5500707">[</span><span class="ident" id="5500708">d</span><span class="op" id="5500709">.</span><span class="ident" id="5500710">o</span><span class="op" id="5500711">]</span>&nbsp;<span class="op" id="5500713">=</span>&nbsp;<span class="builtintype" id="5500715">uint8</span><span class="op" id="5500720">(</span><span class="ident" id="5500721">code</span><span class="op" id="5500725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500730">d</span><span class="op" id="5500731">.</span><span class="ident" id="5500732">o</span><span class="op" id="5500733">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500739">if</span>&nbsp;<span class="ident" id="5500742">d</span><span class="op" id="5500743">.</span><span class="ident" id="5500744">last</span>&nbsp;<span class="op" id="5500749">!=</span>&nbsp;<span class="ident" id="5500752">decoderInvalidCode</span>&nbsp;<span class="op" id="5500771">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5500777">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500818">d</span><span class="op" id="5500819">.</span><span class="ident" id="5500820">suffix</span><span class="op" id="5500826">[</span><span class="ident" id="5500827">d</span><span class="op" id="5500828">.</span><span class="ident" id="5500829">hi</span><span class="op" id="5500831">]</span>&nbsp;<span class="op" id="5500833">=</span>&nbsp;<span class="builtintype" id="5500835">uint8</span><span class="op" id="5500840">(</span><span class="ident" id="5500841">code</span><span class="op" id="5500845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500851">d</span><span class="op" id="5500852">.</span><span class="ident" id="5500853">prefix</span><span class="op" id="5500859">[</span><span class="ident" id="5500860">d</span><span class="op" id="5500861">.</span><span class="ident" id="5500862">hi</span><span class="op" id="5500864">]</span>&nbsp;<span class="op" id="5500866">=</span>&nbsp;<span class="ident" id="5500868">d</span><span class="op" id="5500869">.</span><span class="ident" id="5500870">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5500878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5500882">case</span>&nbsp;<span class="ident" id="5500887">code</span>&nbsp;<span class="op" id="5500892">==</span>&nbsp;<span class="ident" id="5500895">d</span><span class="op" id="5500896">.</span><span class="ident" id="5500897">clear</span><span class="op" id="5500902">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500907">d</span><span class="op" id="5500908">.</span><span class="ident" id="5500909">width</span>&nbsp;<span class="op" id="5500915">=</span>&nbsp;<span class="num" id="5500917">1</span>&nbsp;<span class="op" id="5500919">+</span>&nbsp;<span class="builtintype" id="5500921">uint</span><span class="op" id="5500925">(</span><span class="ident" id="5500926">d</span><span class="op" id="5500927">.</span><span class="ident" id="5500928">litWidth</span><span class="op" id="5500936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500941">d</span><span class="op" id="5500942">.</span><span class="ident" id="5500943">hi</span>&nbsp;<span class="op" id="5500946">=</span>&nbsp;<span class="ident" id="5500948">d</span><span class="op" id="5500949">.</span><span class="ident" id="5500950">eof</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500957">d</span><span class="op" id="5500958">.</span><span class="ident" id="5500959">overflow</span>&nbsp;<span class="op" id="5500968">=</span>&nbsp;<span class="num" id="5500970">1</span>&nbsp;<span class="op" id="5500972">&lt;&lt;</span>&nbsp;<span class="ident" id="5500975">d</span><span class="op" id="5500976">.</span><span class="ident" id="5500977">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5500986">d</span><span class="op" id="5500987">.</span><span class="ident" id="5500988">last</span>&nbsp;<span class="op" id="5500993">=</span>&nbsp;<span class="ident" id="5500995">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501017">continue</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501028">case</span>&nbsp;<span class="ident" id="5501033">code</span>&nbsp;<span class="op" id="5501038">==</span>&nbsp;<span class="ident" id="5501041">d</span><span class="op" id="5501042">.</span><span class="ident" id="5501043">eof</span><span class="op" id="5501046">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501051">d</span><span class="op" id="5501052">.</span><span class="ident" id="5501053">flush</span><span class="op" id="5501058">(</span><span class="op" id="5501059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501064">d</span><span class="op" id="5501065">.</span><span class="ident" id="5501066">err</span>&nbsp;<span class="op" id="5501070">=</span>&nbsp;<span class="ident" id="5501072">io</span><span class="op" id="5501074">.</span><span class="ident" id="5501075">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501082">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501091">case</span>&nbsp;<span class="ident" id="5501096">code</span>&nbsp;<span class="op" id="5501101">&lt;=</span>&nbsp;<span class="ident" id="5501104">d</span><span class="op" id="5501105">.</span><span class="ident" id="5501106">hi</span><span class="op" id="5501108">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501113">c</span><span class="op" id="5501114">,</span>&nbsp;<span class="ident" id="5501116">i</span>&nbsp;<span class="op" id="5501118">:=</span>&nbsp;<span class="ident" id="5501121">code</span><span class="op" id="5501125">,</span>&nbsp;<span class="builtinfunc" id="5501127">len</span><span class="op" id="5501130">(</span><span class="ident" id="5501131">d</span><span class="op" id="5501132">.</span><span class="ident" id="5501133">output</span><span class="op" id="5501139">)</span><span class="op" id="5501140">-</span><span class="num" id="5501141">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501146">if</span>&nbsp;<span class="ident" id="5501149">code</span>&nbsp;<span class="op" id="5501154">==</span>&nbsp;<span class="ident" id="5501157">d</span><span class="op" id="5501158">.</span><span class="ident" id="5501159">hi</span>&nbsp;<span class="op" id="5501162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501168">//&nbsp;code&nbsp;==&nbsp;hi&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;which&nbsp;expands&nbsp;to&nbsp;the&nbsp;last&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501240">//&nbsp;followed&nbsp;by&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;last&nbsp;expansion.&nbsp;To&nbsp;find&nbsp;the&nbsp;head,&nbsp;we&nbsp;walk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501317">//&nbsp;the&nbsp;prefix&nbsp;chain&nbsp;until&nbsp;we&nbsp;find&nbsp;a&nbsp;literal&nbsp;code.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501371">c</span>&nbsp;<span class="op" id="5501373">=</span>&nbsp;<span class="ident" id="5501375">d</span><span class="op" id="5501376">.</span><span class="ident" id="5501377">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501386">for</span>&nbsp;<span class="ident" id="5501390">c</span>&nbsp;<span class="op" id="5501392">&gt;=</span>&nbsp;<span class="ident" id="5501395">d</span><span class="op" id="5501396">.</span><span class="ident" id="5501397">clear</span>&nbsp;<span class="op" id="5501403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501410">c</span>&nbsp;<span class="op" id="5501412">=</span>&nbsp;<span class="ident" id="5501414">d</span><span class="op" id="5501415">.</span><span class="ident" id="5501416">prefix</span><span class="op" id="5501422">[</span><span class="ident" id="5501423">c</span><span class="op" id="5501424">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501436">d</span><span class="op" id="5501437">.</span><span class="ident" id="5501438">output</span><span class="op" id="5501444">[</span><span class="ident" id="5501445">i</span><span class="op" id="5501446">]</span>&nbsp;<span class="op" id="5501448">=</span>&nbsp;<span class="builtintype" id="5501450">uint8</span><span class="op" id="5501455">(</span><span class="ident" id="5501456">c</span><span class="op" id="5501457">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501463">i</span><span class="op" id="5501464">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501471">c</span>&nbsp;<span class="op" id="5501473">=</span>&nbsp;<span class="ident" id="5501475">d</span><span class="op" id="5501476">.</span><span class="ident" id="5501477">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501490">//&nbsp;Copy&nbsp;the&nbsp;suffix&nbsp;chain&nbsp;into&nbsp;output&nbsp;and&nbsp;then&nbsp;write&nbsp;that&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501556">for</span>&nbsp;<span class="ident" id="5501560">c</span>&nbsp;<span class="op" id="5501562">&gt;=</span>&nbsp;<span class="ident" id="5501565">d</span><span class="op" id="5501566">.</span><span class="ident" id="5501567">clear</span>&nbsp;<span class="op" id="5501573">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501579">d</span><span class="op" id="5501580">.</span><span class="ident" id="5501581">output</span><span class="op" id="5501587">[</span><span class="ident" id="5501588">i</span><span class="op" id="5501589">]</span>&nbsp;<span class="op" id="5501591">=</span>&nbsp;<span class="ident" id="5501593">d</span><span class="op" id="5501594">.</span><span class="ident" id="5501595">suffix</span><span class="op" id="5501601">[</span><span class="ident" id="5501602">c</span><span class="op" id="5501603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501609">i</span><span class="op" id="5501610">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501617">c</span>&nbsp;<span class="op" id="5501619">=</span>&nbsp;<span class="ident" id="5501621">d</span><span class="op" id="5501622">.</span><span class="ident" id="5501623">prefix</span><span class="op" id="5501629">[</span><span class="ident" id="5501630">c</span><span class="op" id="5501631">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501641">d</span><span class="op" id="5501642">.</span><span class="ident" id="5501643">output</span><span class="op" id="5501649">[</span><span class="ident" id="5501650">i</span><span class="op" id="5501651">]</span>&nbsp;<span class="op" id="5501653">=</span>&nbsp;<span class="builtintype" id="5501655">uint8</span><span class="op" id="5501660">(</span><span class="ident" id="5501661">c</span><span class="op" id="5501662">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501667">d</span><span class="op" id="5501668">.</span><span class="ident" id="5501669">o</span>&nbsp;<span class="op" id="5501671">+=</span>&nbsp;<span class="builtinfunc" id="5501674">copy</span><span class="op" id="5501678">(</span><span class="ident" id="5501679">d</span><span class="op" id="5501680">.</span><span class="ident" id="5501681">output</span><span class="op" id="5501687">[</span><span class="ident" id="5501688">d</span><span class="op" id="5501689">.</span><span class="ident" id="5501690">o</span><span class="op" id="5501691">:</span><span class="op" id="5501692">]</span><span class="op" id="5501693">,</span>&nbsp;<span class="ident" id="5501695">d</span><span class="op" id="5501696">.</span><span class="ident" id="5501697">output</span><span class="op" id="5501703">[</span><span class="ident" id="5501704">i</span><span class="op" id="5501705">:</span><span class="op" id="5501706">]</span><span class="op" id="5501707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501712">if</span>&nbsp;<span class="ident" id="5501715">d</span><span class="op" id="5501716">.</span><span class="ident" id="5501717">last</span>&nbsp;<span class="op" id="5501722">!=</span>&nbsp;<span class="ident" id="5501725">decoderInvalidCode</span>&nbsp;<span class="op" id="5501744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5501750">//&nbsp;Save&nbsp;what&nbsp;the&nbsp;hi&nbsp;code&nbsp;expands&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501791">d</span><span class="op" id="5501792">.</span><span class="ident" id="5501793">suffix</span><span class="op" id="5501799">[</span><span class="ident" id="5501800">d</span><span class="op" id="5501801">.</span><span class="ident" id="5501802">hi</span><span class="op" id="5501804">]</span>&nbsp;<span class="op" id="5501806">=</span>&nbsp;<span class="builtintype" id="5501808">uint8</span><span class="op" id="5501813">(</span><span class="ident" id="5501814">c</span><span class="op" id="5501815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501821">d</span><span class="op" id="5501822">.</span><span class="ident" id="5501823">prefix</span><span class="op" id="5501829">[</span><span class="ident" id="5501830">d</span><span class="op" id="5501831">.</span><span class="ident" id="5501832">hi</span><span class="op" id="5501834">]</span>&nbsp;<span class="op" id="5501836">=</span>&nbsp;<span class="ident" id="5501838">d</span><span class="op" id="5501839">.</span><span class="ident" id="5501840">last</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501852">default</span><span class="op" id="5501859">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501864">d</span><span class="op" id="5501865">.</span><span class="ident" id="5501866">err</span>&nbsp;<span class="op" id="5501870">=</span>&nbsp;<span class="ident" id="5501872">errors</span><span class="op" id="5501878">.</span><span class="ident" id="5501879">New</span><span class="op" id="5501882">(</span><span class="string" id="5501883">&#34;lzw:&nbsp;invalid&nbsp;code&#34;</span><span class="op" id="5501902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501907">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5501916">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5501920">d</span><span class="op" id="5501921">.</span><span class="ident" id="5501922">last</span><span class="op" id="5501926">,</span>&nbsp;<span class="ident" id="5501928">d</span><span class="op" id="5501929">.</span><span class="ident" id="5501930">hi</span>&nbsp;<span class="op" id="5501933">=</span>&nbsp;<span class="ident" id="5501935">code</span><span class="op" id="5501939">,</span>&nbsp;<span class="ident" id="5501941">d</span><span class="op" id="5501942">.</span><span class="ident" id="5501943">hi</span><span class="op" id="5501945">+</span><span class="num" id="5501946">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501950">if</span>&nbsp;<span class="ident" id="5501953">d</span><span class="op" id="5501954">.</span><span class="ident" id="5501955">hi</span>&nbsp;<span class="op" id="5501958">&gt;=</span>&nbsp;<span class="ident" id="5501961">d</span><span class="op" id="5501962">.</span><span class="ident" id="5501963">overflow</span>&nbsp;<span class="op" id="5501972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5501977">if</span>&nbsp;<span class="ident" id="5501980">d</span><span class="op" id="5501981">.</span><span class="ident" id="5501982">width</span>&nbsp;<span class="op" id="5501988">==</span>&nbsp;<span class="ident" id="5501991">maxWidth</span>&nbsp;<span class="op" id="5502000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502006">d</span><span class="op" id="5502007">.</span><span class="ident" id="5502008">last</span>&nbsp;<span class="op" id="5502013">=</span>&nbsp;<span class="ident" id="5502015">decoderInvalidCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502037">}</span>&nbsp;<span class="keyword" id="5502039">else</span>&nbsp;<span class="op" id="5502044">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502050">d</span><span class="op" id="5502051">.</span><span class="ident" id="5502052">width</span><span class="op" id="5502057">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502064">d</span><span class="op" id="5502065">.</span><span class="ident" id="5502066">overflow</span>&nbsp;<span class="op" id="5502075">&lt;&lt;=</span>&nbsp;<span class="num" id="5502079">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502092">if</span>&nbsp;<span class="ident" id="5502095">d</span><span class="op" id="5502096">.</span><span class="ident" id="5502097">o</span>&nbsp;<span class="op" id="5502099">&gt;=</span>&nbsp;<span class="ident" id="5502102">flushBuffer</span>&nbsp;<span class="op" id="5502114">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502119">d</span><span class="op" id="5502120">.</span><span class="ident" id="5502121">flush</span><span class="op" id="5502126">(</span><span class="op" id="5502127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502132">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5502144">}</span><br>
<span class="lineno"></span><span class="op" id="5502146">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="5502149">func</span>&nbsp;<span class="op" id="5502154">(</span><span class="ident" id="5502155">d</span>&nbsp;<span class="op" id="5502157">*</span><span class="ident" id="5502158">decoder</span><span class="op" id="5502165">)</span>&nbsp;<span class="ident" id="5502167">flush</span><span class="op" id="5502172">(</span><span class="op" id="5502173">)</span>&nbsp;<span class="op" id="5502175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502178">d</span><span class="op" id="5502179">.</span><span class="ident" id="5502180">toRead</span>&nbsp;<span class="op" id="5502187">=</span>&nbsp;<span class="ident" id="5502189">d</span><span class="op" id="5502190">.</span><span class="ident" id="5502191">output</span><span class="op" id="5502197">[</span><span class="op" id="5502198">:</span><span class="ident" id="5502199">d</span><span class="op" id="5502200">.</span><span class="ident" id="5502201">o</span><span class="op" id="5502202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502205">d</span><span class="op" id="5502206">.</span><span class="ident" id="5502207">o</span>&nbsp;<span class="op" id="5502209">=</span>&nbsp;<span class="num" id="5502211">0</span><br>
<span class="lineno"></span><span class="op" id="5502213">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span><span class="keyword" id="5502216">var</span>&nbsp;<span class="ident" id="5502220">errClosed</span>&nbsp;<span class="op" id="5502230">=</span>&nbsp;<span class="ident" id="5502232">errors</span><span class="op" id="5502238">.</span><span class="ident" id="5502239">New</span><span class="op" id="5502242">(</span><span class="string" id="5502243">&#34;compress/lzw:&nbsp;reader/writer&nbsp;is&nbsp;closed&#34;</span><span class="op" id="5502282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5502285">func</span>&nbsp;<span class="op" id="5502290">(</span><span class="ident" id="5502291">d</span>&nbsp;<span class="op" id="5502293">*</span><span class="ident" id="5502294">decoder</span><span class="op" id="5502301">)</span>&nbsp;<span class="ident" id="5502303">Close</span><span class="op" id="5502308">(</span><span class="op" id="5502309">)</span>&nbsp;<span class="builtintype" id="5502311">error</span>&nbsp;<span class="op" id="5502317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502320">d</span><span class="op" id="5502321">.</span><span class="ident" id="5502322">err</span>&nbsp;<span class="op" id="5502326">=</span>&nbsp;<span class="ident" id="5502328">errClosed</span>&nbsp;<span class="comment" id="5502338">//&nbsp;in&nbsp;case&nbsp;any&nbsp;Reads&nbsp;come&nbsp;along</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502371">return</span>&nbsp;<span class="ident" id="5502378">nil</span><br>
<span class="lineno"></span><span class="op" id="5502382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5502385">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;io.ReadCloser.</span><br>
<span class="lineno"></span><span class="comment" id="5502427">//&nbsp;Reads&nbsp;from&nbsp;the&nbsp;returned&nbsp;io.ReadCloser&nbsp;read&nbsp;and&nbsp;decompress&nbsp;data&nbsp;from&nbsp;r.</span><br>
<span class="lineno">225</span><span class="comment" id="5502501">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5502548">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5502610">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="5502684">//&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="5502705">//&nbsp;The&nbsp;number&nbsp;of&nbsp;bits&nbsp;to&nbsp;use&nbsp;for&nbsp;literal&nbsp;codes,&nbsp;litWidth,&nbsp;must&nbsp;be&nbsp;in&nbsp;the</span><br>
<span class="lineno">230</span><span class="comment" id="5502778">//&nbsp;range&nbsp;[2,8]&nbsp;and&nbsp;is&nbsp;typically&nbsp;8.</span><br>
<span class="lineno"></span><span class="keyword" id="5502813">func</span>&nbsp;<span class="ident" id="5502818">NewReader</span><span class="op" id="5502827">(</span><span class="ident" id="5502828">r</span>&nbsp;<span class="ident" id="5502830">io</span><span class="op" id="5502832">.</span><span class="ident" id="5502833">Reader</span><span class="op" id="5502839">,</span>&nbsp;<span class="ident" id="5502841">order</span>&nbsp;<span class="ident" id="5502847">Order</span><span class="op" id="5502852">,</span>&nbsp;<span class="ident" id="5502854">litWidth</span>&nbsp;<span class="builtintype" id="5502863">int</span><span class="op" id="5502866">)</span>&nbsp;<span class="ident" id="5502868">io</span><span class="op" id="5502870">.</span><span class="ident" id="5502871">ReadCloser</span>&nbsp;<span class="op" id="5502882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502885">d</span>&nbsp;<span class="op" id="5502887">:=</span>&nbsp;<span class="builtinfunc" id="5502890">new</span><span class="op" id="5502893">(</span><span class="ident" id="5502894">decoder</span><span class="op" id="5502901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502904">switch</span>&nbsp;<span class="ident" id="5502911">order</span>&nbsp;<span class="op" id="5502917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502920">case</span>&nbsp;<span class="ident" id="5502925">LSB</span><span class="op" id="5502928">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502932">d</span><span class="op" id="5502933">.</span><span class="ident" id="5502934">read</span>&nbsp;<span class="op" id="5502939">=</span>&nbsp;<span class="op" id="5502941">(</span><span class="op" id="5502942">*</span><span class="ident" id="5502943">decoder</span><span class="op" id="5502950">)</span><span class="op" id="5502951">.</span><span class="ident" id="5502952">readLSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5502961">case</span>&nbsp;<span class="ident" id="5502966">MSB</span><span class="op" id="5502969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5502973">d</span><span class="op" id="5502974">.</span><span class="ident" id="5502975">read</span>&nbsp;<span class="op" id="5502980">=</span>&nbsp;<span class="op" id="5502982">(</span><span class="op" id="5502983">*</span><span class="ident" id="5502984">decoder</span><span class="op" id="5502991">)</span><span class="op" id="5502992">.</span><span class="ident" id="5502993">readMSB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503002">default</span><span class="op" id="5503009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503013">d</span><span class="op" id="5503014">.</span><span class="ident" id="5503015">err</span>&nbsp;<span class="op" id="5503019">=</span>&nbsp;<span class="ident" id="5503021">errors</span><span class="op" id="5503027">.</span><span class="ident" id="5503028">New</span><span class="op" id="5503031">(</span><span class="string" id="5503032">&#34;lzw:&nbsp;unknown&nbsp;order&#34;</span><span class="op" id="5503052">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503056">return</span>&nbsp;<span class="ident" id="5503063">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503069">if</span>&nbsp;<span class="ident" id="5503072">litWidth</span>&nbsp;<span class="op" id="5503081">&lt;</span>&nbsp;<span class="num" id="5503083">2</span>&nbsp;<span class="op" id="5503085">||</span>&nbsp;<span class="num" id="5503088">8</span>&nbsp;<span class="op" id="5503090">&lt;</span>&nbsp;<span class="ident" id="5503092">litWidth</span>&nbsp;<span class="op" id="5503101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503105">d</span><span class="op" id="5503106">.</span><span class="ident" id="5503107">err</span>&nbsp;<span class="op" id="5503111">=</span>&nbsp;<span class="ident" id="5503113">fmt</span><span class="op" id="5503116">.</span><span class="ident" id="5503117">Errorf</span><span class="op" id="5503123">(</span><span class="string" id="5503124">&#34;lzw:&nbsp;litWidth&nbsp;%d&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="5503155">,</span>&nbsp;<span class="ident" id="5503157">litWidth</span><span class="op" id="5503165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503169">return</span>&nbsp;<span class="ident" id="5503176">d</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503182">if</span>&nbsp;<span class="ident" id="5503185">br</span><span class="op" id="5503187">,</span>&nbsp;<span class="ident" id="5503189">ok</span>&nbsp;<span class="op" id="5503192">:=</span>&nbsp;<span class="ident" id="5503195">r</span><span class="op" id="5503196">.</span><span class="op" id="5503197">(</span><span class="ident" id="5503198">io</span><span class="op" id="5503200">.</span><span class="ident" id="5503201">ByteReader</span><span class="op" id="5503211">)</span><span class="op" id="5503212">;</span>&nbsp;<span class="ident" id="5503214">ok</span>&nbsp;<span class="op" id="5503217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503221">d</span><span class="op" id="5503222">.</span><span class="ident" id="5503223">r</span>&nbsp;<span class="op" id="5503225">=</span>&nbsp;<span class="ident" id="5503227">br</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503231">}</span>&nbsp;<span class="keyword" id="5503233">else</span>&nbsp;<span class="op" id="5503238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503242">d</span><span class="op" id="5503243">.</span><span class="ident" id="5503244">r</span>&nbsp;<span class="op" id="5503246">=</span>&nbsp;<span class="ident" id="5503248">bufio</span><span class="op" id="5503253">.</span><span class="ident" id="5503254">NewReader</span><span class="op" id="5503263">(</span><span class="ident" id="5503264">r</span><span class="op" id="5503265">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5503268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503271">d</span><span class="op" id="5503272">.</span><span class="ident" id="5503273">litWidth</span>&nbsp;<span class="op" id="5503282">=</span>&nbsp;<span class="ident" id="5503284">litWidth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503294">d</span><span class="op" id="5503295">.</span><span class="ident" id="5503296">width</span>&nbsp;<span class="op" id="5503302">=</span>&nbsp;<span class="num" id="5503304">1</span>&nbsp;<span class="op" id="5503306">+</span>&nbsp;<span class="builtintype" id="5503308">uint</span><span class="op" id="5503312">(</span><span class="ident" id="5503313">litWidth</span><span class="op" id="5503321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503324">d</span><span class="op" id="5503325">.</span><span class="ident" id="5503326">clear</span>&nbsp;<span class="op" id="5503332">=</span>&nbsp;<span class="builtintype" id="5503334">uint16</span><span class="op" id="5503340">(</span><span class="num" id="5503341">1</span><span class="op" id="5503342">)</span>&nbsp;<span class="op" id="5503344">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5503347">uint</span><span class="op" id="5503351">(</span><span class="ident" id="5503352">litWidth</span><span class="op" id="5503360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503363">d</span><span class="op" id="5503364">.</span><span class="ident" id="5503365">eof</span><span class="op" id="5503368">,</span>&nbsp;<span class="ident" id="5503370">d</span><span class="op" id="5503371">.</span><span class="ident" id="5503372">hi</span>&nbsp;<span class="op" id="5503375">=</span>&nbsp;<span class="ident" id="5503377">d</span><span class="op" id="5503378">.</span><span class="ident" id="5503379">clear</span><span class="op" id="5503384">+</span><span class="num" id="5503385">1</span><span class="op" id="5503386">,</span>&nbsp;<span class="ident" id="5503388">d</span><span class="op" id="5503389">.</span><span class="ident" id="5503390">clear</span><span class="op" id="5503395">+</span><span class="num" id="5503396">1</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503399">d</span><span class="op" id="5503400">.</span><span class="ident" id="5503401">overflow</span>&nbsp;<span class="op" id="5503410">=</span>&nbsp;<span class="builtintype" id="5503412">uint16</span><span class="op" id="5503418">(</span><span class="num" id="5503419">1</span><span class="op" id="5503420">)</span>&nbsp;<span class="op" id="5503422">&lt;&lt;</span>&nbsp;<span class="ident" id="5503425">d</span><span class="op" id="5503426">.</span><span class="ident" id="5503427">width</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5503434">d</span><span class="op" id="5503435">.</span><span class="ident" id="5503436">last</span>&nbsp;<span class="op" id="5503441">=</span>&nbsp;<span class="ident" id="5503443">decoderInvalidCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5503464">return</span>&nbsp;<span class="ident" id="5503471">d</span><br>
<span class="lineno"></span><span class="op" id="5503473">}</span>
</div>
</body>
</html>
