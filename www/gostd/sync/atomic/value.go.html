<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync/atomic</h2>
<ul>
<li><a href="/gostd/sync/atomic/atomic_test.go.html">atomic_test.go</a></li>
<li><a href="/gostd/sync/atomic/doc.go.html">doc.go</a></li>
<li><a href="/gostd/sync/atomic/value.go.html">value.go</a></li>
<li><a href="/gostd/sync/atomic/value_test.go.html">value_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1425052">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1425107">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1425161">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1425212">package</span>&nbsp;<span class="ident" id="1425220">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1425228">import</span>&nbsp;<span class="op" id="1425235">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1425238">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1425247">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1425250">//&nbsp;A&nbsp;Value&nbsp;provides&nbsp;an&nbsp;atomic&nbsp;load&nbsp;and&nbsp;store&nbsp;of&nbsp;a&nbsp;consistently&nbsp;typed&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1425326">//&nbsp;Values&nbsp;can&nbsp;be&nbsp;created&nbsp;as&nbsp;part&nbsp;of&nbsp;other&nbsp;data&nbsp;structures.</span><br>
<span class="lineno"></span><span class="comment" id="1425385">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;a&nbsp;Value&nbsp;returns&nbsp;nil&nbsp;from&nbsp;Load.</span><br>
<span class="lineno"></span><span class="comment" id="1425438">//&nbsp;Once&nbsp;Store&nbsp;has&nbsp;been&nbsp;called,&nbsp;a&nbsp;Value&nbsp;must&nbsp;not&nbsp;be&nbsp;copied.</span><br>
<span class="lineno">15</span><span class="keyword" id="1425497">type</span>&nbsp;<span class="ident" id="1425502">Value</span>&nbsp;<span class="keyword" id="1425508">struct</span>&nbsp;<span class="op" id="1425515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425518">v</span>&nbsp;<span class="keyword" id="1425520">interface</span><span class="op" id="1425529">{</span><span class="op" id="1425530">}</span><br>
<span class="lineno"></span><span class="op" id="1425532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1425535">//&nbsp;ifaceWords&nbsp;is&nbsp;interface{}&nbsp;internal&nbsp;representation.</span><br>
<span class="lineno">20</span><span class="keyword" id="1425589">type</span>&nbsp;<span class="ident" id="1425594">ifaceWords</span>&nbsp;<span class="keyword" id="1425605">struct</span>&nbsp;<span class="op" id="1425612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425615">typ</span>&nbsp;&nbsp;<span class="ident" id="1425620">unsafe</span><span class="op" id="1425626">.</span><span class="ident" id="1425627">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425636">data</span>&nbsp;<span class="ident" id="1425641">unsafe</span><span class="op" id="1425647">.</span><span class="ident" id="1425648">Pointer</span><br>
<span class="lineno"></span><span class="op" id="1425656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1425659">//&nbsp;Load&nbsp;returns&nbsp;the&nbsp;value&nbsp;set&nbsp;by&nbsp;the&nbsp;most&nbsp;recent&nbsp;Store.</span><br>
<span class="lineno"></span><span class="comment" id="1425715">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;there&nbsp;has&nbsp;been&nbsp;no&nbsp;call&nbsp;to&nbsp;Store&nbsp;for&nbsp;this&nbsp;Value.</span><br>
<span class="lineno"></span><span class="keyword" id="1425784">func</span>&nbsp;<span class="op" id="1425789">(</span><span class="ident" id="1425790">v</span>&nbsp;<span class="op" id="1425792">*</span><span class="ident" id="1425793">Value</span><span class="op" id="1425798">)</span>&nbsp;<span class="ident" id="1425800">Load</span><span class="op" id="1425804">(</span><span class="op" id="1425805">)</span>&nbsp;<span class="op" id="1425807">(</span><span class="ident" id="1425808">x</span>&nbsp;<span class="keyword" id="1425810">interface</span><span class="op" id="1425819">{</span><span class="op" id="1425820">}</span><span class="op" id="1425821">)</span>&nbsp;<span class="op" id="1425823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425826">vp</span>&nbsp;<span class="op" id="1425829">:=</span>&nbsp;<span class="op" id="1425832">(</span><span class="op" id="1425833">*</span><span class="ident" id="1425834">ifaceWords</span><span class="op" id="1425844">)</span><span class="op" id="1425845">(</span><span class="ident" id="1425846">unsafe</span><span class="op" id="1425852">.</span><span class="ident" id="1425853">Pointer</span><span class="op" id="1425860">(</span><span class="ident" id="1425861">v</span><span class="op" id="1425862">)</span><span class="op" id="1425863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425866">typ</span>&nbsp;<span class="op" id="1425870">:=</span>&nbsp;<span class="ident" id="1425873">LoadPointer</span><span class="op" id="1425884">(</span><span class="op" id="1425885">&amp;</span><span class="ident" id="1425886">vp</span><span class="op" id="1425888">.</span><span class="ident" id="1425889">typ</span><span class="op" id="1425892">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425895">if</span>&nbsp;<span class="ident" id="1425898">typ</span>&nbsp;<span class="op" id="1425902">==</span>&nbsp;<span class="ident" id="1425905">nil</span>&nbsp;<span class="op" id="1425909">||</span>&nbsp;<span class="builtintype" id="1425912">uintptr</span><span class="op" id="1425919">(</span><span class="ident" id="1425920">typ</span><span class="op" id="1425923">)</span>&nbsp;<span class="op" id="1425925">==</span>&nbsp;<span class="op" id="1425928">^</span><span class="builtintype" id="1425929">uintptr</span><span class="op" id="1425936">(</span><span class="num" id="1425937">0</span><span class="op" id="1425938">)</span>&nbsp;<span class="op" id="1425940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1425944">//&nbsp;First&nbsp;store&nbsp;not&nbsp;yet&nbsp;completed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1425980">return</span>&nbsp;<span class="ident" id="1425987">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1425992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1425995">data</span>&nbsp;<span class="op" id="1426000">:=</span>&nbsp;<span class="ident" id="1426003">LoadPointer</span><span class="op" id="1426014">(</span><span class="op" id="1426015">&amp;</span><span class="ident" id="1426016">vp</span><span class="op" id="1426018">.</span><span class="ident" id="1426019">data</span><span class="op" id="1426023">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426026">xp</span>&nbsp;<span class="op" id="1426029">:=</span>&nbsp;<span class="op" id="1426032">(</span><span class="op" id="1426033">*</span><span class="ident" id="1426034">ifaceWords</span><span class="op" id="1426044">)</span><span class="op" id="1426045">(</span><span class="ident" id="1426046">unsafe</span><span class="op" id="1426052">.</span><span class="ident" id="1426053">Pointer</span><span class="op" id="1426060">(</span><span class="op" id="1426061">&amp;</span><span class="ident" id="1426062">x</span><span class="op" id="1426063">)</span><span class="op" id="1426064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426067">xp</span><span class="op" id="1426069">.</span><span class="ident" id="1426070">typ</span>&nbsp;<span class="op" id="1426074">=</span>&nbsp;<span class="ident" id="1426076">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426081">xp</span><span class="op" id="1426083">.</span><span class="ident" id="1426084">data</span>&nbsp;<span class="op" id="1426089">=</span>&nbsp;<span class="ident" id="1426091">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426097">return</span><br>
<span class="lineno"></span><span class="op" id="1426104">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="1426107">//&nbsp;Store&nbsp;sets&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;Value&nbsp;to&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="1426150">//&nbsp;All&nbsp;calls&nbsp;to&nbsp;Store&nbsp;for&nbsp;a&nbsp;given&nbsp;Value&nbsp;must&nbsp;use&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="1426233">//&nbsp;Store&nbsp;of&nbsp;an&nbsp;inconsistent&nbsp;type&nbsp;panics,&nbsp;as&nbsp;does&nbsp;Store(nil).</span><br>
<span class="lineno"></span><span class="keyword" id="1426294">func</span>&nbsp;<span class="op" id="1426299">(</span><span class="ident" id="1426300">v</span>&nbsp;<span class="op" id="1426302">*</span><span class="ident" id="1426303">Value</span><span class="op" id="1426308">)</span>&nbsp;<span class="ident" id="1426310">Store</span><span class="op" id="1426315">(</span><span class="ident" id="1426316">x</span>&nbsp;<span class="keyword" id="1426318">interface</span><span class="op" id="1426327">{</span><span class="op" id="1426328">}</span><span class="op" id="1426329">)</span>&nbsp;<span class="op" id="1426331">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426334">if</span>&nbsp;<span class="ident" id="1426337">x</span>&nbsp;<span class="op" id="1426339">==</span>&nbsp;<span class="ident" id="1426342">nil</span>&nbsp;<span class="op" id="1426346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1426350">panic</span><span class="op" id="1426355">(</span><span class="string" id="1426356">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;nil&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1426400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426406">vp</span>&nbsp;<span class="op" id="1426409">:=</span>&nbsp;<span class="op" id="1426412">(</span><span class="op" id="1426413">*</span><span class="ident" id="1426414">ifaceWords</span><span class="op" id="1426424">)</span><span class="op" id="1426425">(</span><span class="ident" id="1426426">unsafe</span><span class="op" id="1426432">.</span><span class="ident" id="1426433">Pointer</span><span class="op" id="1426440">(</span><span class="ident" id="1426441">v</span><span class="op" id="1426442">)</span><span class="op" id="1426443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426446">xp</span>&nbsp;<span class="op" id="1426449">:=</span>&nbsp;<span class="op" id="1426452">(</span><span class="op" id="1426453">*</span><span class="ident" id="1426454">ifaceWords</span><span class="op" id="1426464">)</span><span class="op" id="1426465">(</span><span class="ident" id="1426466">unsafe</span><span class="op" id="1426472">.</span><span class="ident" id="1426473">Pointer</span><span class="op" id="1426480">(</span><span class="op" id="1426481">&amp;</span><span class="ident" id="1426482">x</span><span class="op" id="1426483">)</span><span class="op" id="1426484">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426487">for</span>&nbsp;<span class="op" id="1426491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426495">typ</span>&nbsp;<span class="op" id="1426499">:=</span>&nbsp;<span class="ident" id="1426502">LoadPointer</span><span class="op" id="1426513">(</span><span class="op" id="1426514">&amp;</span><span class="ident" id="1426515">vp</span><span class="op" id="1426517">.</span><span class="ident" id="1426518">typ</span><span class="op" id="1426521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426525">if</span>&nbsp;<span class="ident" id="1426528">typ</span>&nbsp;<span class="op" id="1426532">==</span>&nbsp;<span class="ident" id="1426535">nil</span>&nbsp;<span class="op" id="1426539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1426544">//&nbsp;Attempt&nbsp;to&nbsp;start&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1426580">//&nbsp;Disable&nbsp;preemption&nbsp;so&nbsp;that&nbsp;other&nbsp;goroutines&nbsp;can&nbsp;use</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1426638">//&nbsp;active&nbsp;spin&nbsp;wait&nbsp;to&nbsp;wait&nbsp;for&nbsp;completion;&nbsp;and&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1426697">//&nbsp;GC&nbsp;does&nbsp;not&nbsp;see&nbsp;the&nbsp;fake&nbsp;type&nbsp;accidentally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426747">runtime_procPin</span><span class="op" id="1426762">(</span><span class="op" id="1426763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426768">if</span>&nbsp;<span class="op" id="1426771">!</span><span class="ident" id="1426772">CompareAndSwapPointer</span><span class="op" id="1426793">(</span><span class="op" id="1426794">&amp;</span><span class="ident" id="1426795">vp</span><span class="op" id="1426797">.</span><span class="ident" id="1426798">typ</span><span class="op" id="1426801">,</span>&nbsp;<span class="ident" id="1426803">nil</span><span class="op" id="1426806">,</span>&nbsp;<span class="ident" id="1426808">unsafe</span><span class="op" id="1426814">.</span><span class="ident" id="1426815">Pointer</span><span class="op" id="1426822">(</span><span class="op" id="1426823">^</span><span class="builtintype" id="1426824">uintptr</span><span class="op" id="1426831">(</span><span class="num" id="1426832">0</span><span class="op" id="1426833">)</span><span class="op" id="1426834">)</span><span class="op" id="1426835">)</span>&nbsp;<span class="op" id="1426837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426843">runtime_procUnpin</span><span class="op" id="1426860">(</span><span class="op" id="1426861">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1426867">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1426879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1426884">//&nbsp;Complete&nbsp;first&nbsp;store.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426912">StorePointer</span><span class="op" id="1426924">(</span><span class="op" id="1426925">&amp;</span><span class="ident" id="1426926">vp</span><span class="op" id="1426928">.</span><span class="ident" id="1426929">data</span><span class="op" id="1426933">,</span>&nbsp;<span class="ident" id="1426935">xp</span><span class="op" id="1426937">.</span><span class="ident" id="1426938">data</span><span class="op" id="1426942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426947">StorePointer</span><span class="op" id="1426959">(</span><span class="op" id="1426960">&amp;</span><span class="ident" id="1426961">vp</span><span class="op" id="1426963">.</span><span class="ident" id="1426964">typ</span><span class="op" id="1426967">,</span>&nbsp;<span class="ident" id="1426969">xp</span><span class="op" id="1426971">.</span><span class="ident" id="1426972">typ</span><span class="op" id="1426975">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1426980">runtime_procUnpin</span><span class="op" id="1426997">(</span><span class="op" id="1426998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427003">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427016">if</span>&nbsp;<span class="builtintype" id="1427019">uintptr</span><span class="op" id="1427026">(</span><span class="ident" id="1427027">typ</span><span class="op" id="1427030">)</span>&nbsp;<span class="op" id="1427032">==</span>&nbsp;<span class="op" id="1427035">^</span><span class="builtintype" id="1427036">uintptr</span><span class="op" id="1427043">(</span><span class="num" id="1427044">0</span><span class="op" id="1427045">)</span>&nbsp;<span class="op" id="1427047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1427052">//&nbsp;First&nbsp;store&nbsp;in&nbsp;progress.&nbsp;Wait.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1427089">//&nbsp;Since&nbsp;we&nbsp;disable&nbsp;preemption&nbsp;around&nbsp;the&nbsp;first&nbsp;store,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1427147">//&nbsp;we&nbsp;can&nbsp;wait&nbsp;with&nbsp;active&nbsp;spinning.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427187">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1427202">//&nbsp;First&nbsp;store&nbsp;completed.&nbsp;Check&nbsp;type&nbsp;and&nbsp;overwrite&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427261">if</span>&nbsp;<span class="ident" id="1427264">typ</span>&nbsp;<span class="op" id="1427268">!=</span>&nbsp;<span class="ident" id="1427271">xp</span><span class="op" id="1427273">.</span><span class="ident" id="1427274">typ</span>&nbsp;<span class="op" id="1427278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1427283">panic</span><span class="op" id="1427288">(</span><span class="string" id="1427289">&#34;sync/atomic:&nbsp;store&nbsp;of&nbsp;inconsistently&nbsp;typed&nbsp;value&nbsp;into&nbsp;Value&#34;</span><span class="op" id="1427350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1427358">StorePointer</span><span class="op" id="1427370">(</span><span class="op" id="1427371">&amp;</span><span class="ident" id="1427372">vp</span><span class="op" id="1427374">.</span><span class="ident" id="1427375">data</span><span class="op" id="1427379">,</span>&nbsp;<span class="ident" id="1427381">xp</span><span class="op" id="1427383">.</span><span class="ident" id="1427384">data</span><span class="op" id="1427388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1427392">return</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1427400">}</span><br>
<span class="lineno"></span><span class="op" id="1427402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1427405">//&nbsp;Disable/enable&nbsp;preemption,&nbsp;implemented&nbsp;in&nbsp;runtime.</span><br>
<span class="lineno"></span><span class="keyword" id="1427459">func</span>&nbsp;<span class="ident" id="1427464">runtime_procPin</span><span class="op" id="1427479">(</span><span class="op" id="1427480">)</span><br>
<span class="lineno">85</span><span class="keyword" id="1427482">func</span>&nbsp;<span class="ident" id="1427487">runtime_procUnpin</span><span class="op" id="1427504">(</span><span class="op" id="1427505">)</span>
</div>
</body>
</html>
