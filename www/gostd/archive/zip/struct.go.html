<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html" class="current">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6299748">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6299803">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6299857">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6299908">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="6300417">package</span>&nbsp;<span class="ident" id="6300425">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300430">import</span>&nbsp;<span class="op" id="6300437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6300440">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6300446">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6300454">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6300461">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300464">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6300488">const</span>&nbsp;<span class="op" id="6300494">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300497">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6300505">uint16</span>&nbsp;<span class="op" id="6300512">=</span>&nbsp;<span class="num" id="6300514">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300517">Deflate</span>&nbsp;<span class="builtintype" id="6300525">uint16</span>&nbsp;<span class="op" id="6300532">=</span>&nbsp;<span class="num" id="6300534">8</span><br>
<span class="lineno"></span><span class="op" id="6300536">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300539">const</span>&nbsp;<span class="op" id="6300545">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300548">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300573">=</span>&nbsp;<span class="num" id="6300575">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300587">directoryHeaderSignature</span>&nbsp;<span class="op" id="6300612">=</span>&nbsp;<span class="num" id="6300614">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300626">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300651">=</span>&nbsp;<span class="num" id="6300653">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300665">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="6300690">=</span>&nbsp;<span class="num" id="6300692">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300704">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="6300729">=</span>&nbsp;<span class="num" id="6300731">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300743">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="6300768">=</span>&nbsp;<span class="num" id="6300770">0x08074b50</span>&nbsp;<span class="comment" id="6300781">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300828">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300853">=</span>&nbsp;<span class="num" id="6300855">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300866">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300889">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300914">=</span>&nbsp;<span class="num" id="6300916">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300927">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300960">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300985">=</span>&nbsp;<span class="num" id="6300987">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300998">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301012">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301037">=</span>&nbsp;<span class="num" id="6301039">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6301050">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301118">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301143">=</span>&nbsp;<span class="num" id="6301145">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6301156">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301189">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301214">=</span>&nbsp;<span class="num" id="6301216">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6301227">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301231">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301256">=</span>&nbsp;<span class="num" id="6301258">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6301269">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301282">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301333">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301347">=</span>&nbsp;<span class="num" id="6301349">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301352">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6301366">=</span>&nbsp;<span class="num" id="6301368">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301371">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6301385">=</span>&nbsp;<span class="num" id="6301387">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301391">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6301405">=</span>&nbsp;<span class="num" id="6301407">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301411">creatorMacOSX</span>&nbsp;<span class="op" id="6301425">=</span>&nbsp;<span class="num" id="6301427">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301432">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301452">zipVersion20</span>&nbsp;<span class="op" id="6301465">=</span>&nbsp;<span class="num" id="6301467">20</span>&nbsp;<span class="comment" id="6301470">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301478">zipVersion45</span>&nbsp;<span class="op" id="6301491">=</span>&nbsp;<span class="num" id="6301493">45</span>&nbsp;<span class="comment" id="6301496">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301539">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301570">uint16max</span>&nbsp;<span class="op" id="6301580">=</span>&nbsp;<span class="op" id="6301582">(</span><span class="num" id="6301583">1</span>&nbsp;<span class="op" id="6301585">&lt;&lt;</span>&nbsp;<span class="num" id="6301588">16</span><span class="op" id="6301590">)</span>&nbsp;<span class="op" id="6301592">-</span>&nbsp;<span class="num" id="6301594">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301597">uint32max</span>&nbsp;<span class="op" id="6301607">=</span>&nbsp;<span class="op" id="6301609">(</span><span class="num" id="6301610">1</span>&nbsp;<span class="op" id="6301612">&lt;&lt;</span>&nbsp;<span class="num" id="6301615">32</span><span class="op" id="6301617">)</span>&nbsp;<span class="op" id="6301619">-</span>&nbsp;<span class="num" id="6301621">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301625">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301647">zip64ExtraId</span>&nbsp;<span class="op" id="6301660">=</span>&nbsp;<span class="num" id="6301662">0x0001</span>&nbsp;<span class="comment" id="6301669">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="6301711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301714">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6301764">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="6301797">type</span>&nbsp;<span class="ident" id="6301802">FileHeader</span>&nbsp;<span class="keyword" id="6301813">struct</span>&nbsp;<span class="op" id="6301820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301823">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301857">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301920">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6301984">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302001">Name</span>&nbsp;<span class="builtintype" id="6302006">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302015">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302034">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302042">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302061">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302069">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302088">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302096">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302115">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302123">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302142">uint16</span>&nbsp;<span class="comment" id="6302149">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302165">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302184">uint16</span>&nbsp;<span class="comment" id="6302191">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302207">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302226">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302234">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302253">uint32</span>&nbsp;<span class="comment" id="6302260">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302297">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302316">uint32</span>&nbsp;<span class="comment" id="6302323">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302362">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6302381">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302389">UncompressedSize64</span>&nbsp;<span class="ident" id="6302408">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302416">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302435">[</span><span class="op" id="6302436">]</span><span class="builtintype" id="6302437">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302443">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302462">uint32</span>&nbsp;<span class="comment" id="6302469">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302507">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6302526">string</span><br>
<span class="lineno"></span><span class="op" id="6302533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6302536">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6302591">func</span>&nbsp;<span class="op" id="6302596">(</span><span class="ident" id="6302597">h</span>&nbsp;<span class="op" id="6302599">*</span><span class="ident" id="6302600">FileHeader</span><span class="op" id="6302610">)</span>&nbsp;<span class="ident" id="6302612">FileInfo</span><span class="op" id="6302620">(</span><span class="op" id="6302621">)</span>&nbsp;<span class="ident" id="6302623">os</span><span class="op" id="6302625">.</span><span class="ident" id="6302626">FileInfo</span>&nbsp;<span class="op" id="6302635">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302638">return</span>&nbsp;<span class="ident" id="6302645">headerFileInfo</span><span class="op" id="6302659">{</span><span class="ident" id="6302660">h</span><span class="op" id="6302661">}</span><br>
<span class="lineno"></span><span class="op" id="6302663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6302666">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6302708">type</span>&nbsp;<span class="ident" id="6302713">headerFileInfo</span>&nbsp;<span class="keyword" id="6302728">struct</span>&nbsp;<span class="op" id="6302735">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302738">fh</span>&nbsp;<span class="op" id="6302741">*</span><span class="ident" id="6302742">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="6302753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6302756">func</span>&nbsp;<span class="op" id="6302761">(</span><span class="ident" id="6302762">fi</span>&nbsp;<span class="ident" id="6302765">headerFileInfo</span><span class="op" id="6302779">)</span>&nbsp;<span class="ident" id="6302781">Name</span><span class="op" id="6302785">(</span><span class="op" id="6302786">)</span>&nbsp;<span class="builtintype" id="6302788">string</span>&nbsp;<span class="op" id="6302795">{</span>&nbsp;<span class="keyword" id="6302797">return</span>&nbsp;<span class="ident" id="6302804">path</span><span class="op" id="6302808">.</span><span class="ident" id="6302809">Base</span><span class="op" id="6302813">(</span><span class="ident" id="6302814">fi</span><span class="op" id="6302816">.</span><span class="ident" id="6302817">fh</span><span class="op" id="6302819">.</span><span class="ident" id="6302820">Name</span><span class="op" id="6302824">)</span>&nbsp;<span class="op" id="6302826">}</span><br>
<span class="lineno"></span><span class="keyword" id="6302828">func</span>&nbsp;<span class="op" id="6302833">(</span><span class="ident" id="6302834">fi</span>&nbsp;<span class="ident" id="6302837">headerFileInfo</span><span class="op" id="6302851">)</span>&nbsp;<span class="ident" id="6302853">Size</span><span class="op" id="6302857">(</span><span class="op" id="6302858">)</span>&nbsp;<span class="ident" id="6302860">int64</span>&nbsp;<span class="op" id="6302866">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302869">if</span>&nbsp;<span class="ident" id="6302872">fi</span><span class="op" id="6302874">.</span><span class="ident" id="6302875">fh</span><span class="op" id="6302877">.</span><span class="ident" id="6302878">UncompressedSize64</span>&nbsp;<span class="op" id="6302897">&gt;</span>&nbsp;<span class="num" id="6302899">0</span>&nbsp;<span class="op" id="6302901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302905">return</span>&nbsp;<span class="ident" id="6302912">int64</span><span class="op" id="6302917">(</span><span class="ident" id="6302918">fi</span><span class="op" id="6302920">.</span><span class="ident" id="6302921">fh</span><span class="op" id="6302923">.</span><span class="ident" id="6302924">UncompressedSize64</span><span class="op" id="6302942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302948">return</span>&nbsp;<span class="ident" id="6302955">int64</span><span class="op" id="6302960">(</span><span class="ident" id="6302961">fi</span><span class="op" id="6302963">.</span><span class="ident" id="6302964">fh</span><span class="op" id="6302966">.</span><span class="ident" id="6302967">UncompressedSize</span><span class="op" id="6302983">)</span><br>
<span class="lineno"></span><span class="op" id="6302985">}</span><br>
<span class="lineno">110</span><span class="keyword" id="6302987">func</span>&nbsp;<span class="op" id="6302992">(</span><span class="ident" id="6302993">fi</span>&nbsp;<span class="ident" id="6302996">headerFileInfo</span><span class="op" id="6303010">)</span>&nbsp;<span class="ident" id="6303012">IsDir</span><span class="op" id="6303017">(</span><span class="op" id="6303018">)</span>&nbsp;<span class="builtintype" id="6303020">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303032">{</span>&nbsp;<span class="keyword" id="6303034">return</span>&nbsp;<span class="ident" id="6303041">fi</span><span class="op" id="6303043">.</span><span class="ident" id="6303044">Mode</span><span class="op" id="6303048">(</span><span class="op" id="6303049">)</span><span class="op" id="6303050">.</span><span class="ident" id="6303051">IsDir</span><span class="op" id="6303056">(</span><span class="op" id="6303057">)</span>&nbsp;<span class="op" id="6303059">}</span><br>
<span class="lineno"></span><span class="keyword" id="6303061">func</span>&nbsp;<span class="op" id="6303066">(</span><span class="ident" id="6303067">fi</span>&nbsp;<span class="ident" id="6303070">headerFileInfo</span><span class="op" id="6303084">)</span>&nbsp;<span class="ident" id="6303086">ModTime</span><span class="op" id="6303093">(</span><span class="op" id="6303094">)</span>&nbsp;<span class="ident" id="6303096">time</span><span class="op" id="6303100">.</span><span class="ident" id="6303101">Time</span>&nbsp;<span class="op" id="6303106">{</span>&nbsp;<span class="keyword" id="6303108">return</span>&nbsp;<span class="ident" id="6303115">fi</span><span class="op" id="6303117">.</span><span class="ident" id="6303118">fh</span><span class="op" id="6303120">.</span><span class="ident" id="6303121">ModTime</span><span class="op" id="6303128">(</span><span class="op" id="6303129">)</span>&nbsp;<span class="op" id="6303131">}</span><br>
<span class="lineno"></span><span class="keyword" id="6303133">func</span>&nbsp;<span class="op" id="6303138">(</span><span class="ident" id="6303139">fi</span>&nbsp;<span class="ident" id="6303142">headerFileInfo</span><span class="op" id="6303156">)</span>&nbsp;<span class="ident" id="6303158">Mode</span><span class="op" id="6303162">(</span><span class="op" id="6303163">)</span>&nbsp;<span class="ident" id="6303165">os</span><span class="op" id="6303167">.</span><span class="ident" id="6303168">FileMode</span>&nbsp;&nbsp;<span class="op" id="6303178">{</span>&nbsp;<span class="keyword" id="6303180">return</span>&nbsp;<span class="ident" id="6303187">fi</span><span class="op" id="6303189">.</span><span class="ident" id="6303190">fh</span><span class="op" id="6303192">.</span><span class="ident" id="6303193">Mode</span><span class="op" id="6303197">(</span><span class="op" id="6303198">)</span>&nbsp;<span class="op" id="6303200">}</span><br>
<span class="lineno"></span><span class="keyword" id="6303202">func</span>&nbsp;<span class="op" id="6303207">(</span><span class="ident" id="6303208">fi</span>&nbsp;<span class="ident" id="6303211">headerFileInfo</span><span class="op" id="6303225">)</span>&nbsp;<span class="ident" id="6303227">Sys</span><span class="op" id="6303230">(</span><span class="op" id="6303231">)</span>&nbsp;<span class="keyword" id="6303233">interface</span><span class="op" id="6303242">{</span><span class="op" id="6303243">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6303247">{</span>&nbsp;<span class="keyword" id="6303249">return</span>&nbsp;<span class="ident" id="6303256">fi</span><span class="op" id="6303258">.</span><span class="ident" id="6303259">fh</span>&nbsp;<span class="op" id="6303262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="6303265">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6303332">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="6303348">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6303415">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6303486">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="6303555">func</span>&nbsp;<span class="ident" id="6303560">FileInfoHeader</span><span class="op" id="6303574">(</span><span class="ident" id="6303575">fi</span>&nbsp;<span class="ident" id="6303578">os</span><span class="op" id="6303580">.</span><span class="ident" id="6303581">FileInfo</span><span class="op" id="6303589">)</span>&nbsp;<span class="op" id="6303591">(</span><span class="op" id="6303592">*</span><span class="ident" id="6303593">FileHeader</span><span class="op" id="6303603">,</span>&nbsp;<span class="builtintype" id="6303605">error</span><span class="op" id="6303610">)</span>&nbsp;<span class="op" id="6303612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303615">size</span>&nbsp;<span class="op" id="6303620">:=</span>&nbsp;<span class="ident" id="6303623">fi</span><span class="op" id="6303625">.</span><span class="ident" id="6303626">Size</span><span class="op" id="6303630">(</span><span class="op" id="6303631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303634">fh</span>&nbsp;<span class="op" id="6303637">:=</span>&nbsp;<span class="op" id="6303640">&amp;</span><span class="ident" id="6303641">FileHeader</span><span class="op" id="6303651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303655">Name</span><span class="op" id="6303659">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303675">fi</span><span class="op" id="6303677">.</span><span class="ident" id="6303678">Name</span><span class="op" id="6303682">(</span><span class="op" id="6303683">)</span><span class="op" id="6303684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303688">UncompressedSize64</span><span class="op" id="6303706">:</span>&nbsp;<span class="ident" id="6303708">uint64</span><span class="op" id="6303714">(</span><span class="ident" id="6303715">size</span><span class="op" id="6303719">)</span><span class="op" id="6303720">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303726">fh</span><span class="op" id="6303728">.</span><span class="ident" id="6303729">SetModTime</span><span class="op" id="6303739">(</span><span class="ident" id="6303740">fi</span><span class="op" id="6303742">.</span><span class="ident" id="6303743">ModTime</span><span class="op" id="6303750">(</span><span class="op" id="6303751">)</span><span class="op" id="6303752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303755">fh</span><span class="op" id="6303757">.</span><span class="ident" id="6303758">SetMode</span><span class="op" id="6303765">(</span><span class="ident" id="6303766">fi</span><span class="op" id="6303768">.</span><span class="ident" id="6303769">Mode</span><span class="op" id="6303773">(</span><span class="op" id="6303774">)</span><span class="op" id="6303775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303778">if</span>&nbsp;<span class="ident" id="6303781">fh</span><span class="op" id="6303783">.</span><span class="ident" id="6303784">UncompressedSize64</span>&nbsp;<span class="op" id="6303803">&gt;</span>&nbsp;<span class="ident" id="6303805">uint32max</span>&nbsp;<span class="op" id="6303815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303819">fh</span><span class="op" id="6303821">.</span><span class="ident" id="6303822">UncompressedSize</span>&nbsp;<span class="op" id="6303839">=</span>&nbsp;<span class="ident" id="6303841">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303852">}</span>&nbsp;<span class="keyword" id="6303854">else</span>&nbsp;<span class="op" id="6303859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303863">fh</span><span class="op" id="6303865">.</span><span class="ident" id="6303866">UncompressedSize</span>&nbsp;<span class="op" id="6303883">=</span>&nbsp;<span class="builtintype" id="6303885">uint32</span><span class="op" id="6303891">(</span><span class="ident" id="6303892">fh</span><span class="op" id="6303894">.</span><span class="ident" id="6303895">UncompressedSize64</span><span class="op" id="6303913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303919">return</span>&nbsp;<span class="ident" id="6303926">fh</span><span class="op" id="6303928">,</span>&nbsp;<span class="ident" id="6303930">nil</span><br>
<span class="lineno"></span><span class="op" id="6303934">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="6303937">type</span>&nbsp;<span class="ident" id="6303942">directoryEnd</span>&nbsp;<span class="keyword" id="6303955">struct</span>&nbsp;<span class="op" id="6303962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303965">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6303984">uint32</span>&nbsp;<span class="comment" id="6303991">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304002">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6304021">uint32</span>&nbsp;<span class="comment" id="6304028">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304039">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="6304058">uint64</span>&nbsp;<span class="comment" id="6304065">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304076">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6304095">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304103">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304122">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304130">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304149">uint64</span>&nbsp;<span class="comment" id="6304156">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304177">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6304196">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304204">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6304223">string</span><br>
<span class="lineno">145</span><span class="op" id="6304230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6304233">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="6304303">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6304328">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="6304399">func</span>&nbsp;<span class="ident" id="6304404">msDosTimeToTime</span><span class="op" id="6304419">(</span><span class="ident" id="6304420">dosDate</span><span class="op" id="6304427">,</span>&nbsp;<span class="ident" id="6304429">dosTime</span>&nbsp;<span class="builtintype" id="6304437">uint16</span><span class="op" id="6304443">)</span>&nbsp;<span class="ident" id="6304445">time</span><span class="op" id="6304449">.</span><span class="ident" id="6304450">Time</span>&nbsp;<span class="op" id="6304455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304458">return</span>&nbsp;<span class="ident" id="6304465">time</span><span class="op" id="6304469">.</span><span class="ident" id="6304470">Date</span><span class="op" id="6304474">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6304478">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6304547">int</span><span class="op" id="6304550">(</span><span class="ident" id="6304551">dosDate</span><span class="op" id="6304558">&gt;&gt;</span><span class="num" id="6304560">9</span><span class="op" id="6304561">+</span><span class="num" id="6304562">1980</span><span class="op" id="6304566">)</span><span class="op" id="6304567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304571">time</span><span class="op" id="6304575">.</span><span class="ident" id="6304576">Month</span><span class="op" id="6304581">(</span><span class="ident" id="6304582">dosDate</span><span class="op" id="6304589">&gt;&gt;</span><span class="num" id="6304591">5</span><span class="op" id="6304592">&amp;</span><span class="num" id="6304593">0xf</span><span class="op" id="6304596">)</span><span class="op" id="6304597">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6304601">int</span><span class="op" id="6304604">(</span><span class="ident" id="6304605">dosDate</span><span class="op" id="6304612">&amp;</span><span class="num" id="6304613">0x1f</span><span class="op" id="6304617">)</span><span class="op" id="6304618">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6304623">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6304679">int</span><span class="op" id="6304682">(</span><span class="ident" id="6304683">dosTime</span><span class="op" id="6304690">&gt;&gt;</span><span class="num" id="6304692">11</span><span class="op" id="6304694">)</span><span class="op" id="6304695">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6304699">int</span><span class="op" id="6304702">(</span><span class="ident" id="6304703">dosTime</span><span class="op" id="6304710">&gt;&gt;</span><span class="num" id="6304712">5</span><span class="op" id="6304713">&amp;</span><span class="num" id="6304714">0x3f</span><span class="op" id="6304718">)</span><span class="op" id="6304719">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6304723">int</span><span class="op" id="6304726">(</span><span class="ident" id="6304727">dosTime</span><span class="op" id="6304734">&amp;</span><span class="num" id="6304735">0x1f</span><span class="op" id="6304739">*</span><span class="num" id="6304740">2</span><span class="op" id="6304741">)</span><span class="op" id="6304742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6304746">0</span><span class="op" id="6304747">,</span>&nbsp;<span class="comment" id="6304749">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304767">time</span><span class="op" id="6304771">.</span><span class="ident" id="6304772">UTC</span><span class="op" id="6304775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304778">)</span><br>
<span class="lineno">165</span><span class="op" id="6304780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6304783">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6304851">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="6304876">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="6304947">func</span>&nbsp;<span class="ident" id="6304952">timeToMsDosTime</span><span class="op" id="6304967">(</span><span class="ident" id="6304968">t</span>&nbsp;<span class="ident" id="6304970">time</span><span class="op" id="6304974">.</span><span class="ident" id="6304975">Time</span><span class="op" id="6304979">)</span>&nbsp;<span class="op" id="6304981">(</span><span class="ident" id="6304982">fDate</span>&nbsp;<span class="builtintype" id="6304988">uint16</span><span class="op" id="6304994">,</span>&nbsp;<span class="ident" id="6304996">fTime</span>&nbsp;<span class="builtintype" id="6305002">uint16</span><span class="op" id="6305008">)</span>&nbsp;<span class="op" id="6305010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305013">t</span>&nbsp;<span class="op" id="6305015">=</span>&nbsp;<span class="ident" id="6305017">t</span><span class="op" id="6305018">.</span><span class="ident" id="6305019">In</span><span class="op" id="6305021">(</span><span class="ident" id="6305022">time</span><span class="op" id="6305026">.</span><span class="ident" id="6305027">UTC</span><span class="op" id="6305030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305033">fDate</span>&nbsp;<span class="op" id="6305039">=</span>&nbsp;<span class="builtintype" id="6305041">uint16</span><span class="op" id="6305047">(</span><span class="ident" id="6305048">t</span><span class="op" id="6305049">.</span><span class="ident" id="6305050">Day</span><span class="op" id="6305053">(</span><span class="op" id="6305054">)</span>&nbsp;<span class="op" id="6305056">+</span>&nbsp;<span class="builtintype" id="6305058">int</span><span class="op" id="6305061">(</span><span class="ident" id="6305062">t</span><span class="op" id="6305063">.</span><span class="ident" id="6305064">Month</span><span class="op" id="6305069">(</span><span class="op" id="6305070">)</span><span class="op" id="6305071">)</span><span class="op" id="6305072">&lt;&lt;</span><span class="num" id="6305074">5</span>&nbsp;<span class="op" id="6305076">+</span>&nbsp;<span class="op" id="6305078">(</span><span class="ident" id="6305079">t</span><span class="op" id="6305080">.</span><span class="ident" id="6305081">Year</span><span class="op" id="6305085">(</span><span class="op" id="6305086">)</span><span class="op" id="6305087">-</span><span class="num" id="6305088">1980</span><span class="op" id="6305092">)</span><span class="op" id="6305093">&lt;&lt;</span><span class="num" id="6305095">9</span><span class="op" id="6305096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305099">fTime</span>&nbsp;<span class="op" id="6305105">=</span>&nbsp;<span class="builtintype" id="6305107">uint16</span><span class="op" id="6305113">(</span><span class="ident" id="6305114">t</span><span class="op" id="6305115">.</span><span class="ident" id="6305116">Second</span><span class="op" id="6305122">(</span><span class="op" id="6305123">)</span><span class="op" id="6305124">/</span><span class="num" id="6305125">2</span>&nbsp;<span class="op" id="6305127">+</span>&nbsp;<span class="ident" id="6305129">t</span><span class="op" id="6305130">.</span><span class="ident" id="6305131">Minute</span><span class="op" id="6305137">(</span><span class="op" id="6305138">)</span><span class="op" id="6305139">&lt;&lt;</span><span class="num" id="6305141">5</span>&nbsp;<span class="op" id="6305143">+</span>&nbsp;<span class="ident" id="6305145">t</span><span class="op" id="6305146">.</span><span class="ident" id="6305147">Hour</span><span class="op" id="6305151">(</span><span class="op" id="6305152">)</span><span class="op" id="6305153">&lt;&lt;</span><span class="num" id="6305155">11</span><span class="op" id="6305157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305160">return</span><br>
<span class="lineno">175</span><span class="op" id="6305167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305170">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6305219">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="6305244">func</span>&nbsp;<span class="op" id="6305249">(</span><span class="ident" id="6305250">h</span>&nbsp;<span class="op" id="6305252">*</span><span class="ident" id="6305253">FileHeader</span><span class="op" id="6305263">)</span>&nbsp;<span class="ident" id="6305265">ModTime</span><span class="op" id="6305272">(</span><span class="op" id="6305273">)</span>&nbsp;<span class="ident" id="6305275">time</span><span class="op" id="6305279">.</span><span class="ident" id="6305280">Time</span>&nbsp;<span class="op" id="6305285">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305288">return</span>&nbsp;<span class="ident" id="6305295">msDosTimeToTime</span><span class="op" id="6305310">(</span><span class="ident" id="6305311">h</span><span class="op" id="6305312">.</span><span class="ident" id="6305313">ModifiedDate</span><span class="op" id="6305325">,</span>&nbsp;<span class="ident" id="6305327">h</span><span class="op" id="6305328">.</span><span class="ident" id="6305329">ModifiedTime</span><span class="op" id="6305341">)</span><br>
<span class="lineno"></span><span class="op" id="6305343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305346">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="6305432">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="6305457">func</span>&nbsp;<span class="op" id="6305462">(</span><span class="ident" id="6305463">h</span>&nbsp;<span class="op" id="6305465">*</span><span class="ident" id="6305466">FileHeader</span><span class="op" id="6305476">)</span>&nbsp;<span class="ident" id="6305478">SetModTime</span><span class="op" id="6305488">(</span><span class="ident" id="6305489">t</span>&nbsp;<span class="ident" id="6305491">time</span><span class="op" id="6305495">.</span><span class="ident" id="6305496">Time</span><span class="op" id="6305500">)</span>&nbsp;<span class="op" id="6305502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305505">h</span><span class="op" id="6305506">.</span><span class="ident" id="6305507">ModifiedDate</span><span class="op" id="6305519">,</span>&nbsp;<span class="ident" id="6305521">h</span><span class="op" id="6305522">.</span><span class="ident" id="6305523">ModifiedTime</span>&nbsp;<span class="op" id="6305536">=</span>&nbsp;<span class="ident" id="6305538">timeToMsDosTime</span><span class="op" id="6305553">(</span><span class="ident" id="6305554">t</span><span class="op" id="6305555">)</span><br>
<span class="lineno"></span><span class="op" id="6305557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6305560">const</span>&nbsp;<span class="op" id="6305566">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305569">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305629">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305685">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6305694">=</span>&nbsp;<span class="num" id="6305696">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305704">s_IFSOCK</span>&nbsp;<span class="op" id="6305713">=</span>&nbsp;<span class="num" id="6305715">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305723">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="6305732">=</span>&nbsp;<span class="num" id="6305734">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305742">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="6305751">=</span>&nbsp;<span class="num" id="6305753">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305761">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="6305770">=</span>&nbsp;<span class="num" id="6305772">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305780">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="6305789">=</span>&nbsp;<span class="num" id="6305791">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305799">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="6305808">=</span>&nbsp;<span class="num" id="6305810">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305818">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="6305827">=</span>&nbsp;<span class="num" id="6305829">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305837">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="6305846">=</span>&nbsp;<span class="num" id="6305848">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305855">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="6305864">=</span>&nbsp;<span class="num" id="6305866">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305873">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6305882">=</span>&nbsp;<span class="num" id="6305884">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305892">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305906">=</span>&nbsp;<span class="num" id="6305908">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305914">msdosReadOnly</span>&nbsp;<span class="op" id="6305928">=</span>&nbsp;<span class="num" id="6305930">0x01</span><br>
<span class="lineno"></span><span class="op" id="6305935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305938">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6306003">func</span>&nbsp;<span class="op" id="6306008">(</span><span class="ident" id="6306009">h</span>&nbsp;<span class="op" id="6306011">*</span><span class="ident" id="6306012">FileHeader</span><span class="op" id="6306022">)</span>&nbsp;<span class="ident" id="6306024">Mode</span><span class="op" id="6306028">(</span><span class="op" id="6306029">)</span>&nbsp;<span class="op" id="6306031">(</span><span class="ident" id="6306032">mode</span>&nbsp;<span class="ident" id="6306037">os</span><span class="op" id="6306039">.</span><span class="ident" id="6306040">FileMode</span><span class="op" id="6306048">)</span>&nbsp;<span class="op" id="6306050">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306053">switch</span>&nbsp;<span class="ident" id="6306060">h</span><span class="op" id="6306061">.</span><span class="ident" id="6306062">CreatorVersion</span>&nbsp;<span class="op" id="6306077">&gt;&gt;</span>&nbsp;<span class="num" id="6306080">8</span>&nbsp;<span class="op" id="6306082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306085">case</span>&nbsp;<span class="ident" id="6306090">creatorUnix</span><span class="op" id="6306101">,</span>&nbsp;<span class="ident" id="6306103">creatorMacOSX</span><span class="op" id="6306116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306120">mode</span>&nbsp;<span class="op" id="6306125">=</span>&nbsp;<span class="ident" id="6306127">unixModeToFileMode</span><span class="op" id="6306145">(</span><span class="ident" id="6306146">h</span><span class="op" id="6306147">.</span><span class="ident" id="6306148">ExternalAttrs</span>&nbsp;<span class="op" id="6306162">&gt;&gt;</span>&nbsp;<span class="num" id="6306165">16</span><span class="op" id="6306167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306170">case</span>&nbsp;<span class="ident" id="6306175">creatorNTFS</span><span class="op" id="6306186">,</span>&nbsp;<span class="ident" id="6306188">creatorVFAT</span><span class="op" id="6306199">,</span>&nbsp;<span class="ident" id="6306201">creatorFAT</span><span class="op" id="6306211">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306215">mode</span>&nbsp;<span class="op" id="6306220">=</span>&nbsp;<span class="ident" id="6306222">msdosModeToFileMode</span><span class="op" id="6306241">(</span><span class="ident" id="6306242">h</span><span class="op" id="6306243">.</span><span class="ident" id="6306244">ExternalAttrs</span><span class="op" id="6306257">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306263">if</span>&nbsp;<span class="builtinfunc" id="6306266">len</span><span class="op" id="6306269">(</span><span class="ident" id="6306270">h</span><span class="op" id="6306271">.</span><span class="ident" id="6306272">Name</span><span class="op" id="6306276">)</span>&nbsp;<span class="op" id="6306278">&gt;</span>&nbsp;<span class="num" id="6306280">0</span>&nbsp;<span class="op" id="6306282">&amp;&amp;</span>&nbsp;<span class="ident" id="6306285">h</span><span class="op" id="6306286">.</span><span class="ident" id="6306287">Name</span><span class="op" id="6306291">[</span><span class="builtinfunc" id="6306292">len</span><span class="op" id="6306295">(</span><span class="ident" id="6306296">h</span><span class="op" id="6306297">.</span><span class="ident" id="6306298">Name</span><span class="op" id="6306302">)</span><span class="op" id="6306303">-</span><span class="num" id="6306304">1</span><span class="op" id="6306305">]</span>&nbsp;<span class="op" id="6306307">==</span>&nbsp;<span class="string" id="6306310">&#39;/&#39;</span>&nbsp;<span class="op" id="6306314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306318">mode</span>&nbsp;<span class="op" id="6306323">|=</span>&nbsp;<span class="ident" id="6306326">os</span><span class="op" id="6306328">.</span><span class="ident" id="6306329">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306341">return</span>&nbsp;<span class="ident" id="6306348">mode</span><br>
<span class="lineno">220</span><span class="op" id="6306353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6306356">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6306424">func</span>&nbsp;<span class="op" id="6306429">(</span><span class="ident" id="6306430">h</span>&nbsp;<span class="op" id="6306432">*</span><span class="ident" id="6306433">FileHeader</span><span class="op" id="6306443">)</span>&nbsp;<span class="ident" id="6306445">SetMode</span><span class="op" id="6306452">(</span><span class="ident" id="6306453">mode</span>&nbsp;<span class="ident" id="6306458">os</span><span class="op" id="6306460">.</span><span class="ident" id="6306461">FileMode</span><span class="op" id="6306469">)</span>&nbsp;<span class="op" id="6306471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306474">h</span><span class="op" id="6306475">.</span><span class="ident" id="6306476">CreatorVersion</span>&nbsp;<span class="op" id="6306491">=</span>&nbsp;<span class="ident" id="6306493">h</span><span class="op" id="6306494">.</span><span class="ident" id="6306495">CreatorVersion</span><span class="op" id="6306509">&amp;</span><span class="num" id="6306510">0xff</span>&nbsp;<span class="op" id="6306515">|</span>&nbsp;<span class="ident" id="6306517">creatorUnix</span><span class="op" id="6306528">&lt;&lt;</span><span class="num" id="6306530">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306533">h</span><span class="op" id="6306534">.</span><span class="ident" id="6306535">ExternalAttrs</span>&nbsp;<span class="op" id="6306549">=</span>&nbsp;<span class="ident" id="6306551">fileModeToUnixMode</span><span class="op" id="6306569">(</span><span class="ident" id="6306570">mode</span><span class="op" id="6306574">)</span>&nbsp;<span class="op" id="6306576">&lt;&lt;</span>&nbsp;<span class="num" id="6306579">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306584">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306640">if</span>&nbsp;<span class="ident" id="6306643">mode</span><span class="op" id="6306647">&amp;</span><span class="ident" id="6306648">os</span><span class="op" id="6306650">.</span><span class="ident" id="6306651">ModeDir</span>&nbsp;<span class="op" id="6306659">!=</span>&nbsp;<span class="num" id="6306662">0</span>&nbsp;<span class="op" id="6306664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306668">h</span><span class="op" id="6306669">.</span><span class="ident" id="6306670">ExternalAttrs</span>&nbsp;<span class="op" id="6306684">|=</span>&nbsp;<span class="ident" id="6306687">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306700">if</span>&nbsp;<span class="ident" id="6306703">mode</span><span class="op" id="6306707">&amp;</span><span class="num" id="6306708">0200</span>&nbsp;<span class="op" id="6306713">==</span>&nbsp;<span class="num" id="6306716">0</span>&nbsp;<span class="op" id="6306718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306722">h</span><span class="op" id="6306723">.</span><span class="ident" id="6306724">ExternalAttrs</span>&nbsp;<span class="op" id="6306738">|=</span>&nbsp;<span class="ident" id="6306741">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306756">}</span><br>
<span class="lineno"></span><span class="op" id="6306758">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6306761">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="6306827">func</span>&nbsp;<span class="op" id="6306832">(</span><span class="ident" id="6306833">fh</span>&nbsp;<span class="op" id="6306836">*</span><span class="ident" id="6306837">FileHeader</span><span class="op" id="6306847">)</span>&nbsp;<span class="ident" id="6306849">isZip64</span><span class="op" id="6306856">(</span><span class="op" id="6306857">)</span>&nbsp;<span class="builtintype" id="6306859">bool</span>&nbsp;<span class="op" id="6306864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306867">return</span>&nbsp;<span class="ident" id="6306874">fh</span><span class="op" id="6306876">.</span><span class="ident" id="6306877">CompressedSize64</span>&nbsp;<span class="op" id="6306894">&gt;</span>&nbsp;<span class="ident" id="6306896">uint32max</span>&nbsp;<span class="op" id="6306906">||</span>&nbsp;<span class="ident" id="6306909">fh</span><span class="op" id="6306911">.</span><span class="ident" id="6306912">UncompressedSize64</span>&nbsp;<span class="op" id="6306931">&gt;</span>&nbsp;<span class="ident" id="6306933">uint32max</span><br>
<span class="lineno"></span><span class="op" id="6306943">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="6306946">func</span>&nbsp;<span class="ident" id="6306951">msdosModeToFileMode</span><span class="op" id="6306970">(</span><span class="ident" id="6306971">m</span>&nbsp;<span class="builtintype" id="6306973">uint32</span><span class="op" id="6306979">)</span>&nbsp;<span class="op" id="6306981">(</span><span class="ident" id="6306982">mode</span>&nbsp;<span class="ident" id="6306987">os</span><span class="op" id="6306989">.</span><span class="ident" id="6306990">FileMode</span><span class="op" id="6306998">)</span>&nbsp;<span class="op" id="6307000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307003">if</span>&nbsp;<span class="ident" id="6307006">m</span><span class="op" id="6307007">&amp;</span><span class="ident" id="6307008">msdosDir</span>&nbsp;<span class="op" id="6307017">!=</span>&nbsp;<span class="num" id="6307020">0</span>&nbsp;<span class="op" id="6307022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307026">mode</span>&nbsp;<span class="op" id="6307031">=</span>&nbsp;<span class="ident" id="6307033">os</span><span class="op" id="6307035">.</span><span class="ident" id="6307036">ModeDir</span>&nbsp;<span class="op" id="6307044">|</span>&nbsp;<span class="num" id="6307046">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307052">}</span>&nbsp;<span class="keyword" id="6307054">else</span>&nbsp;<span class="op" id="6307059">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307063">mode</span>&nbsp;<span class="op" id="6307068">=</span>&nbsp;<span class="num" id="6307070">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307079">if</span>&nbsp;<span class="ident" id="6307082">m</span><span class="op" id="6307083">&amp;</span><span class="ident" id="6307084">msdosReadOnly</span>&nbsp;<span class="op" id="6307098">!=</span>&nbsp;<span class="num" id="6307101">0</span>&nbsp;<span class="op" id="6307103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307107">mode</span>&nbsp;<span class="op" id="6307112">&amp;^=</span>&nbsp;<span class="num" id="6307116">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307122">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307125">return</span>&nbsp;<span class="ident" id="6307132">mode</span><br>
<span class="lineno"></span><span class="op" id="6307137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6307140">func</span>&nbsp;<span class="ident" id="6307145">fileModeToUnixMode</span><span class="op" id="6307163">(</span><span class="ident" id="6307164">mode</span>&nbsp;<span class="ident" id="6307169">os</span><span class="op" id="6307171">.</span><span class="ident" id="6307172">FileMode</span><span class="op" id="6307180">)</span>&nbsp;<span class="builtintype" id="6307182">uint32</span>&nbsp;<span class="op" id="6307189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307192">var</span>&nbsp;<span class="ident" id="6307196">m</span>&nbsp;<span class="builtintype" id="6307198">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307206">switch</span>&nbsp;<span class="ident" id="6307213">mode</span>&nbsp;<span class="op" id="6307218">&amp;</span>&nbsp;<span class="ident" id="6307220">os</span><span class="op" id="6307222">.</span><span class="ident" id="6307223">ModeType</span>&nbsp;<span class="op" id="6307232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307235">default</span><span class="op" id="6307242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307246">m</span>&nbsp;<span class="op" id="6307248">=</span>&nbsp;<span class="ident" id="6307250">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307259">case</span>&nbsp;<span class="ident" id="6307264">os</span><span class="op" id="6307266">.</span><span class="ident" id="6307267">ModeDir</span><span class="op" id="6307274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307278">m</span>&nbsp;<span class="op" id="6307280">=</span>&nbsp;<span class="ident" id="6307282">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307291">case</span>&nbsp;<span class="ident" id="6307296">os</span><span class="op" id="6307298">.</span><span class="ident" id="6307299">ModeSymlink</span><span class="op" id="6307310">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307314">m</span>&nbsp;<span class="op" id="6307316">=</span>&nbsp;<span class="ident" id="6307318">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307327">case</span>&nbsp;<span class="ident" id="6307332">os</span><span class="op" id="6307334">.</span><span class="ident" id="6307335">ModeNamedPipe</span><span class="op" id="6307348">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307352">m</span>&nbsp;<span class="op" id="6307354">=</span>&nbsp;<span class="ident" id="6307356">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307365">case</span>&nbsp;<span class="ident" id="6307370">os</span><span class="op" id="6307372">.</span><span class="ident" id="6307373">ModeSocket</span><span class="op" id="6307383">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307387">m</span>&nbsp;<span class="op" id="6307389">=</span>&nbsp;<span class="ident" id="6307391">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307401">case</span>&nbsp;<span class="ident" id="6307406">os</span><span class="op" id="6307408">.</span><span class="ident" id="6307409">ModeDevice</span><span class="op" id="6307419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307423">if</span>&nbsp;<span class="ident" id="6307426">mode</span><span class="op" id="6307430">&amp;</span><span class="ident" id="6307431">os</span><span class="op" id="6307433">.</span><span class="ident" id="6307434">ModeCharDevice</span>&nbsp;<span class="op" id="6307449">!=</span>&nbsp;<span class="num" id="6307452">0</span>&nbsp;<span class="op" id="6307454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307459">m</span>&nbsp;<span class="op" id="6307461">=</span>&nbsp;<span class="ident" id="6307463">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307473">}</span>&nbsp;<span class="keyword" id="6307475">else</span>&nbsp;<span class="op" id="6307480">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307485">m</span>&nbsp;<span class="op" id="6307487">=</span>&nbsp;<span class="ident" id="6307489">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307505">if</span>&nbsp;<span class="ident" id="6307508">mode</span><span class="op" id="6307512">&amp;</span><span class="ident" id="6307513">os</span><span class="op" id="6307515">.</span><span class="ident" id="6307516">ModeSetuid</span>&nbsp;<span class="op" id="6307527">!=</span>&nbsp;<span class="num" id="6307530">0</span>&nbsp;<span class="op" id="6307532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307536">m</span>&nbsp;<span class="op" id="6307538">|=</span>&nbsp;<span class="ident" id="6307541">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307553">if</span>&nbsp;<span class="ident" id="6307556">mode</span><span class="op" id="6307560">&amp;</span><span class="ident" id="6307561">os</span><span class="op" id="6307563">.</span><span class="ident" id="6307564">ModeSetgid</span>&nbsp;<span class="op" id="6307575">!=</span>&nbsp;<span class="num" id="6307578">0</span>&nbsp;<span class="op" id="6307580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307584">m</span>&nbsp;<span class="op" id="6307586">|=</span>&nbsp;<span class="ident" id="6307589">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307601">if</span>&nbsp;<span class="ident" id="6307604">mode</span><span class="op" id="6307608">&amp;</span><span class="ident" id="6307609">os</span><span class="op" id="6307611">.</span><span class="ident" id="6307612">ModeSticky</span>&nbsp;<span class="op" id="6307623">!=</span>&nbsp;<span class="num" id="6307626">0</span>&nbsp;<span class="op" id="6307628">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307632">m</span>&nbsp;<span class="op" id="6307634">|=</span>&nbsp;<span class="ident" id="6307637">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307649">return</span>&nbsp;<span class="ident" id="6307656">m</span>&nbsp;<span class="op" id="6307658">|</span>&nbsp;<span class="builtintype" id="6307660">uint32</span><span class="op" id="6307666">(</span><span class="ident" id="6307667">mode</span><span class="op" id="6307671">&amp;</span><span class="num" id="6307672">0777</span><span class="op" id="6307676">)</span><br>
<span class="lineno"></span><span class="op" id="6307678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6307681">func</span>&nbsp;<span class="ident" id="6307686">unixModeToFileMode</span><span class="op" id="6307704">(</span><span class="ident" id="6307705">m</span>&nbsp;<span class="builtintype" id="6307707">uint32</span><span class="op" id="6307713">)</span>&nbsp;<span class="ident" id="6307715">os</span><span class="op" id="6307717">.</span><span class="ident" id="6307718">FileMode</span>&nbsp;<span class="op" id="6307727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307730">mode</span>&nbsp;<span class="op" id="6307735">:=</span>&nbsp;<span class="ident" id="6307738">os</span><span class="op" id="6307740">.</span><span class="ident" id="6307741">FileMode</span><span class="op" id="6307749">(</span><span class="ident" id="6307750">m</span>&nbsp;<span class="op" id="6307752">&amp;</span>&nbsp;<span class="num" id="6307754">0777</span><span class="op" id="6307758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307761">switch</span>&nbsp;<span class="ident" id="6307768">m</span>&nbsp;<span class="op" id="6307770">&amp;</span>&nbsp;<span class="ident" id="6307772">s_IFMT</span>&nbsp;<span class="op" id="6307779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307782">case</span>&nbsp;<span class="ident" id="6307787">s_IFBLK</span><span class="op" id="6307794">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307798">mode</span>&nbsp;<span class="op" id="6307803">|=</span>&nbsp;<span class="ident" id="6307806">os</span><span class="op" id="6307808">.</span><span class="ident" id="6307809">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307821">case</span>&nbsp;<span class="ident" id="6307826">s_IFCHR</span><span class="op" id="6307833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307837">mode</span>&nbsp;<span class="op" id="6307842">|=</span>&nbsp;<span class="ident" id="6307845">os</span><span class="op" id="6307847">.</span><span class="ident" id="6307848">ModeDevice</span>&nbsp;<span class="op" id="6307859">|</span>&nbsp;<span class="ident" id="6307861">os</span><span class="op" id="6307863">.</span><span class="ident" id="6307864">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307880">case</span>&nbsp;<span class="ident" id="6307885">s_IFDIR</span><span class="op" id="6307892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307896">mode</span>&nbsp;<span class="op" id="6307901">|=</span>&nbsp;<span class="ident" id="6307904">os</span><span class="op" id="6307906">.</span><span class="ident" id="6307907">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307916">case</span>&nbsp;<span class="ident" id="6307921">s_IFIFO</span><span class="op" id="6307928">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307932">mode</span>&nbsp;<span class="op" id="6307937">|=</span>&nbsp;<span class="ident" id="6307940">os</span><span class="op" id="6307942">.</span><span class="ident" id="6307943">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307958">case</span>&nbsp;<span class="ident" id="6307963">s_IFLNK</span><span class="op" id="6307970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307974">mode</span>&nbsp;<span class="op" id="6307979">|=</span>&nbsp;<span class="ident" id="6307982">os</span><span class="op" id="6307984">.</span><span class="ident" id="6307985">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307998">case</span>&nbsp;<span class="ident" id="6308003">s_IFREG</span><span class="op" id="6308010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6308014">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308032">case</span>&nbsp;<span class="ident" id="6308037">s_IFSOCK</span><span class="op" id="6308045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308049">mode</span>&nbsp;<span class="op" id="6308054">|=</span>&nbsp;<span class="ident" id="6308057">os</span><span class="op" id="6308059">.</span><span class="ident" id="6308060">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308075">if</span>&nbsp;<span class="ident" id="6308078">m</span><span class="op" id="6308079">&amp;</span><span class="ident" id="6308080">s_ISGID</span>&nbsp;<span class="op" id="6308088">!=</span>&nbsp;<span class="num" id="6308091">0</span>&nbsp;<span class="op" id="6308093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308097">mode</span>&nbsp;<span class="op" id="6308102">|=</span>&nbsp;<span class="ident" id="6308105">os</span><span class="op" id="6308107">.</span><span class="ident" id="6308108">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308123">if</span>&nbsp;<span class="ident" id="6308126">m</span><span class="op" id="6308127">&amp;</span><span class="ident" id="6308128">s_ISUID</span>&nbsp;<span class="op" id="6308136">!=</span>&nbsp;<span class="num" id="6308139">0</span>&nbsp;<span class="op" id="6308141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308145">mode</span>&nbsp;<span class="op" id="6308150">|=</span>&nbsp;<span class="ident" id="6308153">os</span><span class="op" id="6308155">.</span><span class="ident" id="6308156">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308171">if</span>&nbsp;<span class="ident" id="6308174">m</span><span class="op" id="6308175">&amp;</span><span class="ident" id="6308176">s_ISVTX</span>&nbsp;<span class="op" id="6308184">!=</span>&nbsp;<span class="num" id="6308187">0</span>&nbsp;<span class="op" id="6308189">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308193">mode</span>&nbsp;<span class="op" id="6308198">|=</span>&nbsp;<span class="ident" id="6308201">os</span><span class="op" id="6308203">.</span><span class="ident" id="6308204">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308219">return</span>&nbsp;<span class="ident" id="6308226">mode</span><br>
<span class="lineno"></span><span class="op" id="6308231">}</span>
</div>
</body>
</html>
