<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html" class="current">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7577710">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7577765">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7577819">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7577870">package</span>&nbsp;<span class="ident" id="7577878">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7577885">import</span>&nbsp;<span class="op" id="7577892">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7577895">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7577902">&#34;math/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7577915">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7577923">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7577933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7577936">func</span>&nbsp;<span class="ident" id="7577941">checkPos</span><span class="op" id="7577949">(</span><span class="ident" id="7577950">t</span>&nbsp;<span class="op" id="7577952">*</span><span class="ident" id="7577953">testing</span><span class="op" id="7577960">.</span><span class="ident" id="7577961">T</span><span class="op" id="7577962">,</span>&nbsp;<span class="ident" id="7577964">msg</span>&nbsp;<span class="builtintype" id="7577968">string</span><span class="op" id="7577974">,</span>&nbsp;<span class="ident" id="7577976">got</span><span class="op" id="7577979">,</span>&nbsp;<span class="ident" id="7577981">want</span>&nbsp;<span class="ident" id="7577986">Position</span><span class="op" id="7577994">)</span>&nbsp;<span class="op" id="7577996">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7577999">if</span>&nbsp;<span class="ident" id="7578002">got</span><span class="op" id="7578005">.</span><span class="ident" id="7578006">Filename</span>&nbsp;<span class="op" id="7578015">!=</span>&nbsp;<span class="ident" id="7578018">want</span><span class="op" id="7578022">.</span><span class="ident" id="7578023">Filename</span>&nbsp;<span class="op" id="7578032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578036">t</span><span class="op" id="7578037">.</span><span class="ident" id="7578038">Errorf</span><span class="op" id="7578044">(</span><span class="string" id="7578045">&#34;%s:&nbsp;got&nbsp;filename&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7578077">,</span>&nbsp;<span class="ident" id="7578079">msg</span><span class="op" id="7578082">,</span>&nbsp;<span class="ident" id="7578084">got</span><span class="op" id="7578087">.</span><span class="ident" id="7578088">Filename</span><span class="op" id="7578096">,</span>&nbsp;<span class="ident" id="7578098">want</span><span class="op" id="7578102">.</span><span class="ident" id="7578103">Filename</span><span class="op" id="7578111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7578117">if</span>&nbsp;<span class="ident" id="7578120">got</span><span class="op" id="7578123">.</span><span class="ident" id="7578124">Offset</span>&nbsp;<span class="op" id="7578131">!=</span>&nbsp;<span class="ident" id="7578134">want</span><span class="op" id="7578138">.</span><span class="ident" id="7578139">Offset</span>&nbsp;<span class="op" id="7578146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578150">t</span><span class="op" id="7578151">.</span><span class="ident" id="7578152">Errorf</span><span class="op" id="7578158">(</span><span class="string" id="7578159">&#34;%s:&nbsp;got&nbsp;offset&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7578189">,</span>&nbsp;<span class="ident" id="7578191">msg</span><span class="op" id="7578194">,</span>&nbsp;<span class="ident" id="7578196">got</span><span class="op" id="7578199">.</span><span class="ident" id="7578200">Offset</span><span class="op" id="7578206">,</span>&nbsp;<span class="ident" id="7578208">want</span><span class="op" id="7578212">.</span><span class="ident" id="7578213">Offset</span><span class="op" id="7578219">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7578225">if</span>&nbsp;<span class="ident" id="7578228">got</span><span class="op" id="7578231">.</span><span class="ident" id="7578232">Line</span>&nbsp;<span class="op" id="7578237">!=</span>&nbsp;<span class="ident" id="7578240">want</span><span class="op" id="7578244">.</span><span class="ident" id="7578245">Line</span>&nbsp;<span class="op" id="7578250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578254">t</span><span class="op" id="7578255">.</span><span class="ident" id="7578256">Errorf</span><span class="op" id="7578262">(</span><span class="string" id="7578263">&#34;%s:&nbsp;got&nbsp;line&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7578291">,</span>&nbsp;<span class="ident" id="7578293">msg</span><span class="op" id="7578296">,</span>&nbsp;<span class="ident" id="7578298">got</span><span class="op" id="7578301">.</span><span class="ident" id="7578302">Line</span><span class="op" id="7578306">,</span>&nbsp;<span class="ident" id="7578308">want</span><span class="op" id="7578312">.</span><span class="ident" id="7578313">Line</span><span class="op" id="7578317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7578323">if</span>&nbsp;<span class="ident" id="7578326">got</span><span class="op" id="7578329">.</span><span class="ident" id="7578330">Column</span>&nbsp;<span class="op" id="7578337">!=</span>&nbsp;<span class="ident" id="7578340">want</span><span class="op" id="7578344">.</span><span class="ident" id="7578345">Column</span>&nbsp;<span class="op" id="7578352">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578356">t</span><span class="op" id="7578357">.</span><span class="ident" id="7578358">Errorf</span><span class="op" id="7578364">(</span><span class="string" id="7578365">&#34;%s:&nbsp;got&nbsp;column&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7578395">,</span>&nbsp;<span class="ident" id="7578397">msg</span><span class="op" id="7578400">,</span>&nbsp;<span class="ident" id="7578402">got</span><span class="op" id="7578405">.</span><span class="ident" id="7578406">Column</span><span class="op" id="7578412">,</span>&nbsp;<span class="ident" id="7578414">want</span><span class="op" id="7578418">.</span><span class="ident" id="7578419">Column</span><span class="op" id="7578425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578428">}</span><br>
<span class="lineno"></span><span class="op" id="7578430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578433">func</span>&nbsp;<span class="ident" id="7578438">TestNoPos</span><span class="op" id="7578447">(</span><span class="ident" id="7578448">t</span>&nbsp;<span class="op" id="7578450">*</span><span class="ident" id="7578451">testing</span><span class="op" id="7578458">.</span><span class="ident" id="7578459">T</span><span class="op" id="7578460">)</span>&nbsp;<span class="op" id="7578462">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7578465">if</span>&nbsp;<span class="ident" id="7578468">NoPos</span><span class="op" id="7578473">.</span><span class="ident" id="7578474">IsValid</span><span class="op" id="7578481">(</span><span class="op" id="7578482">)</span>&nbsp;<span class="op" id="7578484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578488">t</span><span class="op" id="7578489">.</span><span class="ident" id="7578490">Errorf</span><span class="op" id="7578496">(</span><span class="string" id="7578497">&#34;NoPos&nbsp;should&nbsp;not&nbsp;be&nbsp;valid&#34;</span><span class="op" id="7578524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7578530">var</span>&nbsp;<span class="ident" id="7578534">fset</span>&nbsp;<span class="op" id="7578539">*</span><span class="ident" id="7578540">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578549">checkPos</span><span class="op" id="7578557">(</span><span class="ident" id="7578558">t</span><span class="op" id="7578559">,</span>&nbsp;<span class="string" id="7578561">&#34;nil&nbsp;NoPos&#34;</span><span class="op" id="7578572">,</span>&nbsp;<span class="ident" id="7578574">fset</span><span class="op" id="7578578">.</span><span class="ident" id="7578579">Position</span><span class="op" id="7578587">(</span><span class="ident" id="7578588">NoPos</span><span class="op" id="7578593">)</span><span class="op" id="7578594">,</span>&nbsp;<span class="ident" id="7578596">Position</span><span class="op" id="7578604">{</span><span class="op" id="7578605">}</span><span class="op" id="7578606">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578609">fset</span>&nbsp;<span class="op" id="7578614">=</span>&nbsp;<span class="ident" id="7578616">NewFileSet</span><span class="op" id="7578626">(</span><span class="op" id="7578627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578630">checkPos</span><span class="op" id="7578638">(</span><span class="ident" id="7578639">t</span><span class="op" id="7578640">,</span>&nbsp;<span class="string" id="7578642">&#34;fset&nbsp;NoPos&#34;</span><span class="op" id="7578654">,</span>&nbsp;<span class="ident" id="7578656">fset</span><span class="op" id="7578660">.</span><span class="ident" id="7578661">Position</span><span class="op" id="7578669">(</span><span class="ident" id="7578670">NoPos</span><span class="op" id="7578675">)</span><span class="op" id="7578676">,</span>&nbsp;<span class="ident" id="7578678">Position</span><span class="op" id="7578686">{</span><span class="op" id="7578687">}</span><span class="op" id="7578688">)</span><br>
<span class="lineno"></span><span class="op" id="7578690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7578693">var</span>&nbsp;<span class="ident" id="7578697">tests</span>&nbsp;<span class="op" id="7578703">=</span>&nbsp;<span class="op" id="7578705">[</span><span class="op" id="7578706">]</span><span class="keyword" id="7578707">struct</span>&nbsp;<span class="op" id="7578714">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578717">filename</span>&nbsp;<span class="builtintype" id="7578726">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578734">source</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7578743">[</span><span class="op" id="7578744">]</span><span class="builtintype" id="7578745">byte</span>&nbsp;<span class="comment" id="7578750">//&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578765">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7578774">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7578779">lines</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7578788">[</span><span class="op" id="7578789">]</span><span class="builtintype" id="7578790">int</span><br>
<span class="lineno"></span><span class="op" id="7578794">}</span><span class="op" id="7578795">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578798">{</span><span class="string" id="7578799">&#34;a&#34;</span><span class="op" id="7578802">,</span>&nbsp;<span class="op" id="7578804">[</span><span class="op" id="7578805">]</span><span class="builtintype" id="7578806">byte</span><span class="op" id="7578810">{</span><span class="op" id="7578811">}</span><span class="op" id="7578812">,</span>&nbsp;<span class="num" id="7578814">0</span><span class="op" id="7578815">,</span>&nbsp;<span class="op" id="7578817">[</span><span class="op" id="7578818">]</span><span class="builtintype" id="7578819">int</span><span class="op" id="7578822">{</span><span class="op" id="7578823">}</span><span class="op" id="7578824">}</span><span class="op" id="7578825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578828">{</span><span class="string" id="7578829">&#34;b&#34;</span><span class="op" id="7578832">,</span>&nbsp;<span class="op" id="7578834">[</span><span class="op" id="7578835">]</span><span class="builtintype" id="7578836">byte</span><span class="op" id="7578840">(</span><span class="string" id="7578841">&#34;01234&#34;</span><span class="op" id="7578848">)</span><span class="op" id="7578849">,</span>&nbsp;<span class="num" id="7578851">5</span><span class="op" id="7578852">,</span>&nbsp;<span class="op" id="7578854">[</span><span class="op" id="7578855">]</span><span class="builtintype" id="7578856">int</span><span class="op" id="7578859">{</span><span class="num" id="7578860">0</span><span class="op" id="7578861">}</span><span class="op" id="7578862">}</span><span class="op" id="7578863">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578866">{</span><span class="string" id="7578867">&#34;c&#34;</span><span class="op" id="7578870">,</span>&nbsp;<span class="op" id="7578872">[</span><span class="op" id="7578873">]</span><span class="builtintype" id="7578874">byte</span><span class="op" id="7578878">(</span><span class="string" id="7578879">&#34;\n\n\n\n\n\n\n\n\n&#34;</span><span class="op" id="7578899">)</span><span class="op" id="7578900">,</span>&nbsp;<span class="num" id="7578902">9</span><span class="op" id="7578903">,</span>&nbsp;<span class="op" id="7578905">[</span><span class="op" id="7578906">]</span><span class="builtintype" id="7578907">int</span><span class="op" id="7578910">{</span><span class="num" id="7578911">0</span><span class="op" id="7578912">,</span>&nbsp;<span class="num" id="7578914">1</span><span class="op" id="7578915">,</span>&nbsp;<span class="num" id="7578917">2</span><span class="op" id="7578918">,</span>&nbsp;<span class="num" id="7578920">3</span><span class="op" id="7578921">,</span>&nbsp;<span class="num" id="7578923">4</span><span class="op" id="7578924">,</span>&nbsp;<span class="num" id="7578926">5</span><span class="op" id="7578927">,</span>&nbsp;<span class="num" id="7578929">6</span><span class="op" id="7578930">,</span>&nbsp;<span class="num" id="7578932">7</span><span class="op" id="7578933">,</span>&nbsp;<span class="num" id="7578935">8</span><span class="op" id="7578936">}</span><span class="op" id="7578937">}</span><span class="op" id="7578938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7578941">{</span><span class="string" id="7578942">&#34;d&#34;</span><span class="op" id="7578945">,</span>&nbsp;<span class="ident" id="7578947">nil</span><span class="op" id="7578950">,</span>&nbsp;<span class="num" id="7578952">100</span><span class="op" id="7578955">,</span>&nbsp;<span class="op" id="7578957">[</span><span class="op" id="7578958">]</span><span class="builtintype" id="7578959">int</span><span class="op" id="7578962">{</span><span class="num" id="7578963">0</span><span class="op" id="7578964">,</span>&nbsp;<span class="num" id="7578966">5</span><span class="op" id="7578967">,</span>&nbsp;<span class="num" id="7578969">10</span><span class="op" id="7578971">,</span>&nbsp;<span class="num" id="7578973">20</span><span class="op" id="7578975">,</span>&nbsp;<span class="num" id="7578977">30</span><span class="op" id="7578979">,</span>&nbsp;<span class="num" id="7578981">70</span><span class="op" id="7578983">,</span>&nbsp;<span class="num" id="7578985">71</span><span class="op" id="7578987">,</span>&nbsp;<span class="num" id="7578989">72</span><span class="op" id="7578991">,</span>&nbsp;<span class="num" id="7578993">80</span><span class="op" id="7578995">,</span>&nbsp;<span class="num" id="7578997">85</span><span class="op" id="7578999">,</span>&nbsp;<span class="num" id="7579001">90</span><span class="op" id="7579003">,</span>&nbsp;<span class="num" id="7579005">99</span><span class="op" id="7579007">}</span><span class="op" id="7579008">}</span><span class="op" id="7579009">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579012">{</span><span class="string" id="7579013">&#34;e&#34;</span><span class="op" id="7579016">,</span>&nbsp;<span class="ident" id="7579018">nil</span><span class="op" id="7579021">,</span>&nbsp;<span class="num" id="7579023">777</span><span class="op" id="7579026">,</span>&nbsp;<span class="op" id="7579028">[</span><span class="op" id="7579029">]</span><span class="builtintype" id="7579030">int</span><span class="op" id="7579033">{</span><span class="num" id="7579034">0</span><span class="op" id="7579035">,</span>&nbsp;<span class="num" id="7579037">80</span><span class="op" id="7579039">,</span>&nbsp;<span class="num" id="7579041">100</span><span class="op" id="7579044">,</span>&nbsp;<span class="num" id="7579046">120</span><span class="op" id="7579049">,</span>&nbsp;<span class="num" id="7579051">130</span><span class="op" id="7579054">,</span>&nbsp;<span class="num" id="7579056">180</span><span class="op" id="7579059">,</span>&nbsp;<span class="num" id="7579061">267</span><span class="op" id="7579064">,</span>&nbsp;<span class="num" id="7579066">455</span><span class="op" id="7579069">,</span>&nbsp;<span class="num" id="7579071">500</span><span class="op" id="7579074">,</span>&nbsp;<span class="num" id="7579076">567</span><span class="op" id="7579079">,</span>&nbsp;<span class="num" id="7579081">620</span><span class="op" id="7579084">}</span><span class="op" id="7579085">}</span><span class="op" id="7579086">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579089">{</span><span class="string" id="7579090">&#34;f&#34;</span><span class="op" id="7579093">,</span>&nbsp;<span class="op" id="7579095">[</span><span class="op" id="7579096">]</span><span class="builtintype" id="7579097">byte</span><span class="op" id="7579101">(</span><span class="string" id="7579102">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;&#34;</span><span class="op" id="7579131">)</span><span class="op" id="7579132">,</span>&nbsp;<span class="num" id="7579134">23</span><span class="op" id="7579136">,</span>&nbsp;<span class="op" id="7579138">[</span><span class="op" id="7579139">]</span><span class="builtintype" id="7579140">int</span><span class="op" id="7579143">{</span><span class="num" id="7579144">0</span><span class="op" id="7579145">,</span>&nbsp;<span class="num" id="7579147">10</span><span class="op" id="7579149">,</span>&nbsp;<span class="num" id="7579151">11</span><span class="op" id="7579153">}</span><span class="op" id="7579154">}</span><span class="op" id="7579155">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579158">{</span><span class="string" id="7579159">&#34;g&#34;</span><span class="op" id="7579162">,</span>&nbsp;<span class="op" id="7579164">[</span><span class="op" id="7579165">]</span><span class="builtintype" id="7579166">byte</span><span class="op" id="7579170">(</span><span class="string" id="7579171">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&#34;</span><span class="op" id="7579202">)</span><span class="op" id="7579203">,</span>&nbsp;<span class="num" id="7579205">24</span><span class="op" id="7579207">,</span>&nbsp;<span class="op" id="7579209">[</span><span class="op" id="7579210">]</span><span class="builtintype" id="7579211">int</span><span class="op" id="7579214">{</span><span class="num" id="7579215">0</span><span class="op" id="7579216">,</span>&nbsp;<span class="num" id="7579218">10</span><span class="op" id="7579220">,</span>&nbsp;<span class="num" id="7579222">11</span><span class="op" id="7579224">}</span><span class="op" id="7579225">}</span><span class="op" id="7579226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579229">{</span><span class="string" id="7579230">&#34;h&#34;</span><span class="op" id="7579233">,</span>&nbsp;<span class="op" id="7579235">[</span><span class="op" id="7579236">]</span><span class="builtintype" id="7579237">byte</span><span class="op" id="7579241">(</span><span class="string" id="7579242">&#34;package&nbsp;p\n\nimport&nbsp;\&#34;fmt\&#34;\n&nbsp;&#34;</span><span class="op" id="7579274">)</span><span class="op" id="7579275">,</span>&nbsp;<span class="num" id="7579277">25</span><span class="op" id="7579279">,</span>&nbsp;<span class="op" id="7579281">[</span><span class="op" id="7579282">]</span><span class="builtintype" id="7579283">int</span><span class="op" id="7579286">{</span><span class="num" id="7579287">0</span><span class="op" id="7579288">,</span>&nbsp;<span class="num" id="7579290">10</span><span class="op" id="7579292">,</span>&nbsp;<span class="num" id="7579294">11</span><span class="op" id="7579296">,</span>&nbsp;<span class="num" id="7579298">24</span><span class="op" id="7579300">}</span><span class="op" id="7579301">}</span><span class="op" id="7579302">,</span><br>
<span class="lineno"></span><span class="op" id="7579304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7579307">func</span>&nbsp;<span class="ident" id="7579312">linecol</span><span class="op" id="7579319">(</span><span class="ident" id="7579320">lines</span>&nbsp;<span class="op" id="7579326">[</span><span class="op" id="7579327">]</span><span class="builtintype" id="7579328">int</span><span class="op" id="7579331">,</span>&nbsp;<span class="ident" id="7579333">offs</span>&nbsp;<span class="builtintype" id="7579338">int</span><span class="op" id="7579341">)</span>&nbsp;<span class="op" id="7579343">(</span><span class="builtintype" id="7579344">int</span><span class="op" id="7579347">,</span>&nbsp;<span class="builtintype" id="7579349">int</span><span class="op" id="7579352">)</span>&nbsp;<span class="op" id="7579354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579357">prevLineOffs</span>&nbsp;<span class="op" id="7579370">:=</span>&nbsp;<span class="num" id="7579373">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579376">for</span>&nbsp;<span class="ident" id="7579380">line</span><span class="op" id="7579384">,</span>&nbsp;<span class="ident" id="7579386">lineOffs</span>&nbsp;<span class="op" id="7579395">:=</span>&nbsp;<span class="keyword" id="7579398">range</span>&nbsp;<span class="ident" id="7579404">lines</span>&nbsp;<span class="op" id="7579410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579414">if</span>&nbsp;<span class="ident" id="7579417">offs</span>&nbsp;<span class="op" id="7579422">&lt;</span>&nbsp;<span class="ident" id="7579424">lineOffs</span>&nbsp;<span class="op" id="7579433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579438">return</span>&nbsp;<span class="ident" id="7579445">line</span><span class="op" id="7579449">,</span>&nbsp;<span class="ident" id="7579451">offs</span>&nbsp;<span class="op" id="7579456">-</span>&nbsp;<span class="ident" id="7579458">prevLineOffs</span>&nbsp;<span class="op" id="7579471">+</span>&nbsp;<span class="num" id="7579473">1</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579481">prevLineOffs</span>&nbsp;<span class="op" id="7579494">=</span>&nbsp;<span class="ident" id="7579496">lineOffs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579509">return</span>&nbsp;<span class="builtinfunc" id="7579516">len</span><span class="op" id="7579519">(</span><span class="ident" id="7579520">lines</span><span class="op" id="7579525">)</span><span class="op" id="7579526">,</span>&nbsp;<span class="ident" id="7579528">offs</span>&nbsp;<span class="op" id="7579533">-</span>&nbsp;<span class="ident" id="7579535">prevLineOffs</span>&nbsp;<span class="op" id="7579548">+</span>&nbsp;<span class="num" id="7579550">1</span><br>
<span class="lineno"></span><span class="op" id="7579552">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7579555">func</span>&nbsp;<span class="ident" id="7579560">verifyPositions</span><span class="op" id="7579575">(</span><span class="ident" id="7579576">t</span>&nbsp;<span class="op" id="7579578">*</span><span class="ident" id="7579579">testing</span><span class="op" id="7579586">.</span><span class="ident" id="7579587">T</span><span class="op" id="7579588">,</span>&nbsp;<span class="ident" id="7579590">fset</span>&nbsp;<span class="op" id="7579595">*</span><span class="ident" id="7579596">FileSet</span><span class="op" id="7579603">,</span>&nbsp;<span class="ident" id="7579605">f</span>&nbsp;<span class="op" id="7579607">*</span><span class="ident" id="7579608">File</span><span class="op" id="7579612">,</span>&nbsp;<span class="ident" id="7579614">lines</span>&nbsp;<span class="op" id="7579620">[</span><span class="op" id="7579621">]</span><span class="builtintype" id="7579622">int</span><span class="op" id="7579625">)</span>&nbsp;<span class="op" id="7579627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579630">for</span>&nbsp;<span class="ident" id="7579634">offs</span>&nbsp;<span class="op" id="7579639">:=</span>&nbsp;<span class="num" id="7579642">0</span><span class="op" id="7579643">;</span>&nbsp;<span class="ident" id="7579645">offs</span>&nbsp;<span class="op" id="7579650">&lt;</span>&nbsp;<span class="ident" id="7579652">f</span><span class="op" id="7579653">.</span><span class="ident" id="7579654">Size</span><span class="op" id="7579658">(</span><span class="op" id="7579659">)</span><span class="op" id="7579660">;</span>&nbsp;<span class="ident" id="7579662">offs</span><span class="op" id="7579666">++</span>&nbsp;<span class="op" id="7579669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579673">p</span>&nbsp;<span class="op" id="7579675">:=</span>&nbsp;<span class="ident" id="7579678">f</span><span class="op" id="7579679">.</span><span class="ident" id="7579680">Pos</span><span class="op" id="7579683">(</span><span class="ident" id="7579684">offs</span><span class="op" id="7579688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579692">offs2</span>&nbsp;<span class="op" id="7579698">:=</span>&nbsp;<span class="ident" id="7579701">f</span><span class="op" id="7579702">.</span><span class="ident" id="7579703">Offset</span><span class="op" id="7579709">(</span><span class="ident" id="7579710">p</span><span class="op" id="7579711">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7579715">if</span>&nbsp;<span class="ident" id="7579718">offs2</span>&nbsp;<span class="op" id="7579724">!=</span>&nbsp;<span class="ident" id="7579727">offs</span>&nbsp;<span class="op" id="7579732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579737">t</span><span class="op" id="7579738">.</span><span class="ident" id="7579739">Errorf</span><span class="op" id="7579745">(</span><span class="string" id="7579746">&#34;%s,&nbsp;Offset:&nbsp;got&nbsp;offset&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7579782">,</span>&nbsp;<span class="ident" id="7579784">f</span><span class="op" id="7579785">.</span><span class="ident" id="7579786">Name</span><span class="op" id="7579790">(</span><span class="op" id="7579791">)</span><span class="op" id="7579792">,</span>&nbsp;<span class="ident" id="7579794">offs2</span><span class="op" id="7579799">,</span>&nbsp;<span class="ident" id="7579801">offs</span><span class="op" id="7579805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7579809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579813">line</span><span class="op" id="7579817">,</span>&nbsp;<span class="ident" id="7579819">col</span>&nbsp;<span class="op" id="7579823">:=</span>&nbsp;<span class="ident" id="7579826">linecol</span><span class="op" id="7579833">(</span><span class="ident" id="7579834">lines</span><span class="op" id="7579839">,</span>&nbsp;<span class="ident" id="7579841">offs</span><span class="op" id="7579845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579849">msg</span>&nbsp;<span class="op" id="7579853">:=</span>&nbsp;<span class="ident" id="7579856">fmt</span><span class="op" id="7579859">.</span><span class="ident" id="7579860">Sprintf</span><span class="op" id="7579867">(</span><span class="string" id="7579868">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7579892">,</span>&nbsp;<span class="ident" id="7579894">f</span><span class="op" id="7579895">.</span><span class="ident" id="7579896">Name</span><span class="op" id="7579900">(</span><span class="op" id="7579901">)</span><span class="op" id="7579902">,</span>&nbsp;<span class="ident" id="7579904">offs</span><span class="op" id="7579908">,</span>&nbsp;<span class="ident" id="7579910">p</span><span class="op" id="7579911">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579915">checkPos</span><span class="op" id="7579923">(</span><span class="ident" id="7579924">t</span><span class="op" id="7579925">,</span>&nbsp;<span class="ident" id="7579927">msg</span><span class="op" id="7579930">,</span>&nbsp;<span class="ident" id="7579932">f</span><span class="op" id="7579933">.</span><span class="ident" id="7579934">Position</span><span class="op" id="7579942">(</span><span class="ident" id="7579943">f</span><span class="op" id="7579944">.</span><span class="ident" id="7579945">Pos</span><span class="op" id="7579948">(</span><span class="ident" id="7579949">offs</span><span class="op" id="7579953">)</span><span class="op" id="7579954">)</span><span class="op" id="7579955">,</span>&nbsp;<span class="ident" id="7579957">Position</span><span class="op" id="7579965">{</span><span class="ident" id="7579966">f</span><span class="op" id="7579967">.</span><span class="ident" id="7579968">Name</span><span class="op" id="7579972">(</span><span class="op" id="7579973">)</span><span class="op" id="7579974">,</span>&nbsp;<span class="ident" id="7579976">offs</span><span class="op" id="7579980">,</span>&nbsp;<span class="ident" id="7579982">line</span><span class="op" id="7579986">,</span>&nbsp;<span class="ident" id="7579988">col</span><span class="op" id="7579991">}</span><span class="op" id="7579992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7579996">checkPos</span><span class="op" id="7580004">(</span><span class="ident" id="7580005">t</span><span class="op" id="7580006">,</span>&nbsp;<span class="ident" id="7580008">msg</span><span class="op" id="7580011">,</span>&nbsp;<span class="ident" id="7580013">fset</span><span class="op" id="7580017">.</span><span class="ident" id="7580018">Position</span><span class="op" id="7580026">(</span><span class="ident" id="7580027">p</span><span class="op" id="7580028">)</span><span class="op" id="7580029">,</span>&nbsp;<span class="ident" id="7580031">Position</span><span class="op" id="7580039">{</span><span class="ident" id="7580040">f</span><span class="op" id="7580041">.</span><span class="ident" id="7580042">Name</span><span class="op" id="7580046">(</span><span class="op" id="7580047">)</span><span class="op" id="7580048">,</span>&nbsp;<span class="ident" id="7580050">offs</span><span class="op" id="7580054">,</span>&nbsp;<span class="ident" id="7580056">line</span><span class="op" id="7580060">,</span>&nbsp;<span class="ident" id="7580062">col</span><span class="op" id="7580065">}</span><span class="op" id="7580066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580069">}</span><br>
<span class="lineno"></span><span class="op" id="7580071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7580074">func</span>&nbsp;<span class="ident" id="7580079">makeTestSource</span><span class="op" id="7580093">(</span><span class="ident" id="7580094">size</span>&nbsp;<span class="builtintype" id="7580099">int</span><span class="op" id="7580102">,</span>&nbsp;<span class="ident" id="7580104">lines</span>&nbsp;<span class="op" id="7580110">[</span><span class="op" id="7580111">]</span><span class="builtintype" id="7580112">int</span><span class="op" id="7580115">)</span>&nbsp;<span class="op" id="7580117">[</span><span class="op" id="7580118">]</span><span class="builtintype" id="7580119">byte</span>&nbsp;<span class="op" id="7580124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580127">src</span>&nbsp;<span class="op" id="7580131">:=</span>&nbsp;<span class="builtinfunc" id="7580134">make</span><span class="op" id="7580138">(</span><span class="op" id="7580139">[</span><span class="op" id="7580140">]</span><span class="builtintype" id="7580141">byte</span><span class="op" id="7580145">,</span>&nbsp;<span class="ident" id="7580147">size</span><span class="op" id="7580151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580154">for</span>&nbsp;<span class="ident" id="7580158">_</span><span class="op" id="7580159">,</span>&nbsp;<span class="ident" id="7580161">offs</span>&nbsp;<span class="op" id="7580166">:=</span>&nbsp;<span class="keyword" id="7580169">range</span>&nbsp;<span class="ident" id="7580175">lines</span>&nbsp;<span class="op" id="7580181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580185">if</span>&nbsp;<span class="ident" id="7580188">offs</span>&nbsp;<span class="op" id="7580193">&gt;</span>&nbsp;<span class="num" id="7580195">0</span>&nbsp;<span class="op" id="7580197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580202">src</span><span class="op" id="7580205">[</span><span class="ident" id="7580206">offs</span><span class="op" id="7580210">-</span><span class="num" id="7580211">1</span><span class="op" id="7580212">]</span>&nbsp;<span class="op" id="7580214">=</span>&nbsp;<span class="string" id="7580216">&#39;\n&#39;</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580229">return</span>&nbsp;<span class="ident" id="7580236">src</span><br>
<span class="lineno"></span><span class="op" id="7580240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7580243">func</span>&nbsp;<span class="ident" id="7580248">TestPositions</span><span class="op" id="7580261">(</span><span class="ident" id="7580262">t</span>&nbsp;<span class="op" id="7580264">*</span><span class="ident" id="7580265">testing</span><span class="op" id="7580272">.</span><span class="ident" id="7580273">T</span><span class="op" id="7580274">)</span>&nbsp;<span class="op" id="7580276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580279">const</span>&nbsp;<span class="ident" id="7580285">delta</span>&nbsp;<span class="op" id="7580291">=</span>&nbsp;<span class="num" id="7580293">7</span>&nbsp;<span class="comment" id="7580295">//&nbsp;a&nbsp;non-zero&nbsp;base&nbsp;offset&nbsp;increment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580332">fset</span>&nbsp;<span class="op" id="7580337">:=</span>&nbsp;<span class="ident" id="7580340">NewFileSet</span><span class="op" id="7580350">(</span><span class="op" id="7580351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580354">for</span>&nbsp;<span class="ident" id="7580358">_</span><span class="op" id="7580359">,</span>&nbsp;<span class="ident" id="7580361">test</span>&nbsp;<span class="op" id="7580366">:=</span>&nbsp;<span class="keyword" id="7580369">range</span>&nbsp;<span class="ident" id="7580375">tests</span>&nbsp;<span class="op" id="7580381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7580385">//&nbsp;verify&nbsp;consistency&nbsp;of&nbsp;test&nbsp;case</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580422">if</span>&nbsp;<span class="ident" id="7580425">test</span><span class="op" id="7580429">.</span><span class="ident" id="7580430">source</span>&nbsp;<span class="op" id="7580437">!=</span>&nbsp;<span class="ident" id="7580440">nil</span>&nbsp;<span class="op" id="7580444">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="7580447">len</span><span class="op" id="7580450">(</span><span class="ident" id="7580451">test</span><span class="op" id="7580455">.</span><span class="ident" id="7580456">source</span><span class="op" id="7580462">)</span>&nbsp;<span class="op" id="7580464">!=</span>&nbsp;<span class="ident" id="7580467">test</span><span class="op" id="7580471">.</span><span class="ident" id="7580472">size</span>&nbsp;<span class="op" id="7580477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580482">t</span><span class="op" id="7580483">.</span><span class="ident" id="7580484">Errorf</span><span class="op" id="7580490">(</span><span class="string" id="7580491">&#34;%s:&nbsp;inconsistent&nbsp;test&nbsp;case:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7580546">,</span>&nbsp;<span class="ident" id="7580548">test</span><span class="op" id="7580552">.</span><span class="ident" id="7580553">filename</span><span class="op" id="7580561">,</span>&nbsp;<span class="builtinfunc" id="7580563">len</span><span class="op" id="7580566">(</span><span class="ident" id="7580567">test</span><span class="op" id="7580571">.</span><span class="ident" id="7580572">source</span><span class="op" id="7580578">)</span><span class="op" id="7580579">,</span>&nbsp;<span class="ident" id="7580581">test</span><span class="op" id="7580585">.</span><span class="ident" id="7580586">size</span><span class="op" id="7580590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7580599">//&nbsp;add&nbsp;file&nbsp;and&nbsp;verify&nbsp;name&nbsp;and&nbsp;size</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580638">f</span>&nbsp;<span class="op" id="7580640">:=</span>&nbsp;<span class="ident" id="7580643">fset</span><span class="op" id="7580647">.</span><span class="ident" id="7580648">AddFile</span><span class="op" id="7580655">(</span><span class="ident" id="7580656">test</span><span class="op" id="7580660">.</span><span class="ident" id="7580661">filename</span><span class="op" id="7580669">,</span>&nbsp;<span class="ident" id="7580671">fset</span><span class="op" id="7580675">.</span><span class="ident" id="7580676">Base</span><span class="op" id="7580680">(</span><span class="op" id="7580681">)</span><span class="op" id="7580682">+</span><span class="ident" id="7580683">delta</span><span class="op" id="7580688">,</span>&nbsp;<span class="ident" id="7580690">test</span><span class="op" id="7580694">.</span><span class="ident" id="7580695">size</span><span class="op" id="7580699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580703">if</span>&nbsp;<span class="ident" id="7580706">f</span><span class="op" id="7580707">.</span><span class="ident" id="7580708">Name</span><span class="op" id="7580712">(</span><span class="op" id="7580713">)</span>&nbsp;<span class="op" id="7580715">!=</span>&nbsp;<span class="ident" id="7580718">test</span><span class="op" id="7580722">.</span><span class="ident" id="7580723">filename</span>&nbsp;<span class="op" id="7580732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580737">t</span><span class="op" id="7580738">.</span><span class="ident" id="7580739">Errorf</span><span class="op" id="7580745">(</span><span class="string" id="7580746">&#34;got&nbsp;filename&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7580772">,</span>&nbsp;<span class="ident" id="7580774">f</span><span class="op" id="7580775">.</span><span class="ident" id="7580776">Name</span><span class="op" id="7580780">(</span><span class="op" id="7580781">)</span><span class="op" id="7580782">,</span>&nbsp;<span class="ident" id="7580784">test</span><span class="op" id="7580788">.</span><span class="ident" id="7580789">filename</span><span class="op" id="7580797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580805">if</span>&nbsp;<span class="ident" id="7580808">f</span><span class="op" id="7580809">.</span><span class="ident" id="7580810">Size</span><span class="op" id="7580814">(</span><span class="op" id="7580815">)</span>&nbsp;<span class="op" id="7580817">!=</span>&nbsp;<span class="ident" id="7580820">test</span><span class="op" id="7580824">.</span><span class="ident" id="7580825">size</span>&nbsp;<span class="op" id="7580830">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580835">t</span><span class="op" id="7580836">.</span><span class="ident" id="7580837">Errorf</span><span class="op" id="7580843">(</span><span class="string" id="7580844">&#34;%s:&nbsp;got&nbsp;file&nbsp;size&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7580875">,</span>&nbsp;<span class="ident" id="7580877">f</span><span class="op" id="7580878">.</span><span class="ident" id="7580879">Name</span><span class="op" id="7580883">(</span><span class="op" id="7580884">)</span><span class="op" id="7580885">,</span>&nbsp;<span class="ident" id="7580887">f</span><span class="op" id="7580888">.</span><span class="ident" id="7580889">Size</span><span class="op" id="7580893">(</span><span class="op" id="7580894">)</span><span class="op" id="7580895">,</span>&nbsp;<span class="ident" id="7580897">test</span><span class="op" id="7580901">.</span><span class="ident" id="7580902">size</span><span class="op" id="7580906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7580910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7580914">if</span>&nbsp;<span class="ident" id="7580917">fset</span><span class="op" id="7580921">.</span><span class="ident" id="7580922">File</span><span class="op" id="7580926">(</span><span class="ident" id="7580927">f</span><span class="op" id="7580928">.</span><span class="ident" id="7580929">Pos</span><span class="op" id="7580932">(</span><span class="num" id="7580933">0</span><span class="op" id="7580934">)</span><span class="op" id="7580935">)</span>&nbsp;<span class="op" id="7580937">!=</span>&nbsp;<span class="ident" id="7580940">f</span>&nbsp;<span class="op" id="7580942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7580947">t</span><span class="op" id="7580948">.</span><span class="ident" id="7580949">Errorf</span><span class="op" id="7580955">(</span><span class="string" id="7580956">&#34;%s:&nbsp;f.Pos(0)&nbsp;was&nbsp;not&nbsp;found&nbsp;in&nbsp;f&#34;</span><span class="op" id="7580989">,</span>&nbsp;<span class="ident" id="7580991">f</span><span class="op" id="7580992">.</span><span class="ident" id="7580993">Name</span><span class="op" id="7580997">(</span><span class="op" id="7580998">)</span><span class="op" id="7580999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581003">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7581008">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581061">for</span>&nbsp;<span class="ident" id="7581065">i</span><span class="op" id="7581066">,</span>&nbsp;<span class="ident" id="7581068">offset</span>&nbsp;<span class="op" id="7581075">:=</span>&nbsp;<span class="keyword" id="7581078">range</span>&nbsp;<span class="ident" id="7581084">test</span><span class="op" id="7581088">.</span><span class="ident" id="7581089">lines</span>&nbsp;<span class="op" id="7581095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581100">f</span><span class="op" id="7581101">.</span><span class="ident" id="7581102">AddLine</span><span class="op" id="7581109">(</span><span class="ident" id="7581110">offset</span><span class="op" id="7581116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581121">if</span>&nbsp;<span class="ident" id="7581124">f</span><span class="op" id="7581125">.</span><span class="ident" id="7581126">LineCount</span><span class="op" id="7581135">(</span><span class="op" id="7581136">)</span>&nbsp;<span class="op" id="7581138">!=</span>&nbsp;<span class="ident" id="7581141">i</span><span class="op" id="7581142">+</span><span class="num" id="7581143">1</span>&nbsp;<span class="op" id="7581145">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581151">t</span><span class="op" id="7581152">.</span><span class="ident" id="7581153">Errorf</span><span class="op" id="7581159">(</span><span class="string" id="7581160">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7581201">,</span>&nbsp;<span class="ident" id="7581203">f</span><span class="op" id="7581204">.</span><span class="ident" id="7581205">Name</span><span class="op" id="7581209">(</span><span class="op" id="7581210">)</span><span class="op" id="7581211">,</span>&nbsp;<span class="ident" id="7581213">f</span><span class="op" id="7581214">.</span><span class="ident" id="7581215">LineCount</span><span class="op" id="7581224">(</span><span class="op" id="7581225">)</span><span class="op" id="7581226">,</span>&nbsp;<span class="ident" id="7581228">i</span><span class="op" id="7581229">+</span><span class="num" id="7581230">1</span><span class="op" id="7581231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7581241">//&nbsp;adding&nbsp;the&nbsp;same&nbsp;offset&nbsp;again&nbsp;should&nbsp;be&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581294">f</span><span class="op" id="7581295">.</span><span class="ident" id="7581296">AddLine</span><span class="op" id="7581303">(</span><span class="ident" id="7581304">offset</span><span class="op" id="7581310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581315">if</span>&nbsp;<span class="ident" id="7581318">f</span><span class="op" id="7581319">.</span><span class="ident" id="7581320">LineCount</span><span class="op" id="7581329">(</span><span class="op" id="7581330">)</span>&nbsp;<span class="op" id="7581332">!=</span>&nbsp;<span class="ident" id="7581335">i</span><span class="op" id="7581336">+</span><span class="num" id="7581337">1</span>&nbsp;<span class="op" id="7581339">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581345">t</span><span class="op" id="7581346">.</span><span class="ident" id="7581347">Errorf</span><span class="op" id="7581353">(</span><span class="string" id="7581354">&#34;%s,&nbsp;AddLine:&nbsp;got&nbsp;unchanged&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7581405">,</span>&nbsp;<span class="ident" id="7581407">f</span><span class="op" id="7581408">.</span><span class="ident" id="7581409">Name</span><span class="op" id="7581413">(</span><span class="op" id="7581414">)</span><span class="op" id="7581415">,</span>&nbsp;<span class="ident" id="7581417">f</span><span class="op" id="7581418">.</span><span class="ident" id="7581419">LineCount</span><span class="op" id="7581428">(</span><span class="op" id="7581429">)</span><span class="op" id="7581430">,</span>&nbsp;<span class="ident" id="7581432">i</span><span class="op" id="7581433">+</span><span class="num" id="7581434">1</span><span class="op" id="7581435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581445">verifyPositions</span><span class="op" id="7581460">(</span><span class="ident" id="7581461">t</span><span class="op" id="7581462">,</span>&nbsp;<span class="ident" id="7581464">fset</span><span class="op" id="7581468">,</span>&nbsp;<span class="ident" id="7581470">f</span><span class="op" id="7581471">,</span>&nbsp;<span class="ident" id="7581473">test</span><span class="op" id="7581477">.</span><span class="ident" id="7581478">lines</span><span class="op" id="7581483">[</span><span class="num" id="7581484">0</span><span class="op" id="7581485">:</span><span class="ident" id="7581486">i</span><span class="op" id="7581487">+</span><span class="num" id="7581488">1</span><span class="op" id="7581489">]</span><span class="op" id="7581490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7581499">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLines&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581553">if</span>&nbsp;<span class="ident" id="7581556">ok</span>&nbsp;<span class="op" id="7581559">:=</span>&nbsp;<span class="ident" id="7581562">f</span><span class="op" id="7581563">.</span><span class="ident" id="7581564">SetLines</span><span class="op" id="7581572">(</span><span class="ident" id="7581573">test</span><span class="op" id="7581577">.</span><span class="ident" id="7581578">lines</span><span class="op" id="7581583">)</span><span class="op" id="7581584">;</span>&nbsp;<span class="op" id="7581586">!</span><span class="ident" id="7581587">ok</span>&nbsp;<span class="op" id="7581590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581595">t</span><span class="op" id="7581596">.</span><span class="ident" id="7581597">Errorf</span><span class="op" id="7581603">(</span><span class="string" id="7581604">&#34;%s:&nbsp;SetLines&nbsp;failed&#34;</span><span class="op" id="7581625">,</span>&nbsp;<span class="ident" id="7581627">f</span><span class="op" id="7581628">.</span><span class="ident" id="7581629">Name</span><span class="op" id="7581633">(</span><span class="op" id="7581634">)</span><span class="op" id="7581635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581643">if</span>&nbsp;<span class="ident" id="7581646">f</span><span class="op" id="7581647">.</span><span class="ident" id="7581648">LineCount</span><span class="op" id="7581657">(</span><span class="op" id="7581658">)</span>&nbsp;<span class="op" id="7581660">!=</span>&nbsp;<span class="builtinfunc" id="7581663">len</span><span class="op" id="7581666">(</span><span class="ident" id="7581667">test</span><span class="op" id="7581671">.</span><span class="ident" id="7581672">lines</span><span class="op" id="7581677">)</span>&nbsp;<span class="op" id="7581679">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581684">t</span><span class="op" id="7581685">.</span><span class="ident" id="7581686">Errorf</span><span class="op" id="7581692">(</span><span class="string" id="7581693">&#34;%s,&nbsp;SetLines:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7581735">,</span>&nbsp;<span class="ident" id="7581737">f</span><span class="op" id="7581738">.</span><span class="ident" id="7581739">Name</span><span class="op" id="7581743">(</span><span class="op" id="7581744">)</span><span class="op" id="7581745">,</span>&nbsp;<span class="ident" id="7581747">f</span><span class="op" id="7581748">.</span><span class="ident" id="7581749">LineCount</span><span class="op" id="7581758">(</span><span class="op" id="7581759">)</span><span class="op" id="7581760">,</span>&nbsp;<span class="builtinfunc" id="7581762">len</span><span class="op" id="7581765">(</span><span class="ident" id="7581766">test</span><span class="op" id="7581770">.</span><span class="ident" id="7581771">lines</span><span class="op" id="7581776">)</span><span class="op" id="7581777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7581781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581785">verifyPositions</span><span class="op" id="7581800">(</span><span class="ident" id="7581801">t</span><span class="op" id="7581802">,</span>&nbsp;<span class="ident" id="7581804">fset</span><span class="op" id="7581808">,</span>&nbsp;<span class="ident" id="7581810">f</span><span class="op" id="7581811">,</span>&nbsp;<span class="ident" id="7581813">test</span><span class="op" id="7581817">.</span><span class="ident" id="7581818">lines</span><span class="op" id="7581823">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7581828">//&nbsp;add&nbsp;lines&nbsp;with&nbsp;SetLinesForContent&nbsp;and&nbsp;verify&nbsp;all&nbsp;positions</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581892">src</span>&nbsp;<span class="op" id="7581896">:=</span>&nbsp;<span class="ident" id="7581899">test</span><span class="op" id="7581903">.</span><span class="ident" id="7581904">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7581913">if</span>&nbsp;<span class="ident" id="7581916">src</span>&nbsp;<span class="op" id="7581920">==</span>&nbsp;<span class="ident" id="7581923">nil</span>&nbsp;<span class="op" id="7581927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7581932">//&nbsp;no&nbsp;test&nbsp;source&nbsp;available&nbsp;-&nbsp;create&nbsp;one&nbsp;from&nbsp;scratch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7581989">src</span>&nbsp;<span class="op" id="7581993">=</span>&nbsp;<span class="ident" id="7581995">makeTestSource</span><span class="op" id="7582009">(</span><span class="ident" id="7582010">test</span><span class="op" id="7582014">.</span><span class="ident" id="7582015">size</span><span class="op" id="7582019">,</span>&nbsp;<span class="ident" id="7582021">test</span><span class="op" id="7582025">.</span><span class="ident" id="7582026">lines</span><span class="op" id="7582031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582035">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582039">f</span><span class="op" id="7582040">.</span><span class="ident" id="7582041">SetLinesForContent</span><span class="op" id="7582059">(</span><span class="ident" id="7582060">src</span><span class="op" id="7582063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582067">if</span>&nbsp;<span class="ident" id="7582070">f</span><span class="op" id="7582071">.</span><span class="ident" id="7582072">LineCount</span><span class="op" id="7582081">(</span><span class="op" id="7582082">)</span>&nbsp;<span class="op" id="7582084">!=</span>&nbsp;<span class="builtinfunc" id="7582087">len</span><span class="op" id="7582090">(</span><span class="ident" id="7582091">test</span><span class="op" id="7582095">.</span><span class="ident" id="7582096">lines</span><span class="op" id="7582101">)</span>&nbsp;<span class="op" id="7582103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582108">t</span><span class="op" id="7582109">.</span><span class="ident" id="7582110">Errorf</span><span class="op" id="7582116">(</span><span class="string" id="7582117">&#34;%s,&nbsp;SetLinesForContent:&nbsp;got&nbsp;line&nbsp;count&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7582169">,</span>&nbsp;<span class="ident" id="7582171">f</span><span class="op" id="7582172">.</span><span class="ident" id="7582173">Name</span><span class="op" id="7582177">(</span><span class="op" id="7582178">)</span><span class="op" id="7582179">,</span>&nbsp;<span class="ident" id="7582181">f</span><span class="op" id="7582182">.</span><span class="ident" id="7582183">LineCount</span><span class="op" id="7582192">(</span><span class="op" id="7582193">)</span><span class="op" id="7582194">,</span>&nbsp;<span class="builtinfunc" id="7582196">len</span><span class="op" id="7582199">(</span><span class="ident" id="7582200">test</span><span class="op" id="7582204">.</span><span class="ident" id="7582205">lines</span><span class="op" id="7582210">)</span><span class="op" id="7582211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582219">verifyPositions</span><span class="op" id="7582234">(</span><span class="ident" id="7582235">t</span><span class="op" id="7582236">,</span>&nbsp;<span class="ident" id="7582238">fset</span><span class="op" id="7582242">,</span>&nbsp;<span class="ident" id="7582244">f</span><span class="op" id="7582245">,</span>&nbsp;<span class="ident" id="7582247">test</span><span class="op" id="7582251">.</span><span class="ident" id="7582252">lines</span><span class="op" id="7582257">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582260">}</span><br>
<span class="lineno"></span><span class="op" id="7582262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7582265">func</span>&nbsp;<span class="ident" id="7582270">TestLineInfo</span><span class="op" id="7582282">(</span><span class="ident" id="7582283">t</span>&nbsp;<span class="op" id="7582285">*</span><span class="ident" id="7582286">testing</span><span class="op" id="7582293">.</span><span class="ident" id="7582294">T</span><span class="op" id="7582295">)</span>&nbsp;<span class="op" id="7582297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582300">fset</span>&nbsp;<span class="op" id="7582305">:=</span>&nbsp;<span class="ident" id="7582308">NewFileSet</span><span class="op" id="7582318">(</span><span class="op" id="7582319">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582322">f</span>&nbsp;<span class="op" id="7582324">:=</span>&nbsp;<span class="ident" id="7582327">fset</span><span class="op" id="7582331">.</span><span class="ident" id="7582332">AddFile</span><span class="op" id="7582339">(</span><span class="string" id="7582340">&#34;foo&#34;</span><span class="op" id="7582345">,</span>&nbsp;<span class="ident" id="7582347">fset</span><span class="op" id="7582351">.</span><span class="ident" id="7582352">Base</span><span class="op" id="7582356">(</span><span class="op" id="7582357">)</span><span class="op" id="7582358">,</span>&nbsp;<span class="num" id="7582360">500</span><span class="op" id="7582363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582366">lines</span>&nbsp;<span class="op" id="7582372">:=</span>&nbsp;<span class="op" id="7582375">[</span><span class="op" id="7582376">]</span><span class="builtintype" id="7582377">int</span><span class="op" id="7582380">{</span><span class="num" id="7582381">0</span><span class="op" id="7582382">,</span>&nbsp;<span class="num" id="7582384">42</span><span class="op" id="7582386">,</span>&nbsp;<span class="num" id="7582388">77</span><span class="op" id="7582390">,</span>&nbsp;<span class="num" id="7582392">100</span><span class="op" id="7582395">,</span>&nbsp;<span class="num" id="7582397">210</span><span class="op" id="7582400">,</span>&nbsp;<span class="num" id="7582402">220</span><span class="op" id="7582405">,</span>&nbsp;<span class="num" id="7582407">277</span><span class="op" id="7582410">,</span>&nbsp;<span class="num" id="7582412">300</span><span class="op" id="7582415">,</span>&nbsp;<span class="num" id="7582417">333</span><span class="op" id="7582420">,</span>&nbsp;<span class="num" id="7582422">401</span><span class="op" id="7582425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7582428">//&nbsp;add&nbsp;lines&nbsp;individually&nbsp;and&nbsp;provide&nbsp;alternative&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582496">for</span>&nbsp;<span class="ident" id="7582500">_</span><span class="op" id="7582501">,</span>&nbsp;<span class="ident" id="7582503">offs</span>&nbsp;<span class="op" id="7582508">:=</span>&nbsp;<span class="keyword" id="7582511">range</span>&nbsp;<span class="ident" id="7582517">lines</span>&nbsp;<span class="op" id="7582523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582527">f</span><span class="op" id="7582528">.</span><span class="ident" id="7582529">AddLine</span><span class="op" id="7582536">(</span><span class="ident" id="7582537">offs</span><span class="op" id="7582541">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582545">f</span><span class="op" id="7582546">.</span><span class="ident" id="7582547">AddLineInfo</span><span class="op" id="7582558">(</span><span class="ident" id="7582559">offs</span><span class="op" id="7582563">,</span>&nbsp;<span class="string" id="7582565">&#34;bar&#34;</span><span class="op" id="7582570">,</span>&nbsp;<span class="num" id="7582572">42</span><span class="op" id="7582574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7582580">//&nbsp;verify&nbsp;positions&nbsp;for&nbsp;all&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582617">for</span>&nbsp;<span class="ident" id="7582621">offs</span>&nbsp;<span class="op" id="7582626">:=</span>&nbsp;<span class="num" id="7582629">0</span><span class="op" id="7582630">;</span>&nbsp;<span class="ident" id="7582632">offs</span>&nbsp;<span class="op" id="7582637">&lt;=</span>&nbsp;<span class="ident" id="7582640">f</span><span class="op" id="7582641">.</span><span class="ident" id="7582642">Size</span><span class="op" id="7582646">(</span><span class="op" id="7582647">)</span><span class="op" id="7582648">;</span>&nbsp;<span class="ident" id="7582650">offs</span><span class="op" id="7582654">++</span>&nbsp;<span class="op" id="7582657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582661">p</span>&nbsp;<span class="op" id="7582663">:=</span>&nbsp;<span class="ident" id="7582666">f</span><span class="op" id="7582667">.</span><span class="ident" id="7582668">Pos</span><span class="op" id="7582671">(</span><span class="ident" id="7582672">offs</span><span class="op" id="7582676">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582680">_</span><span class="op" id="7582681">,</span>&nbsp;<span class="ident" id="7582683">col</span>&nbsp;<span class="op" id="7582687">:=</span>&nbsp;<span class="ident" id="7582690">linecol</span><span class="op" id="7582697">(</span><span class="ident" id="7582698">lines</span><span class="op" id="7582703">,</span>&nbsp;<span class="ident" id="7582705">offs</span><span class="op" id="7582709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582713">msg</span>&nbsp;<span class="op" id="7582717">:=</span>&nbsp;<span class="ident" id="7582720">fmt</span><span class="op" id="7582723">.</span><span class="ident" id="7582724">Sprintf</span><span class="op" id="7582731">(</span><span class="string" id="7582732">&#34;%s&nbsp;(offs&nbsp;=&nbsp;%d,&nbsp;p&nbsp;=&nbsp;%d)&#34;</span><span class="op" id="7582756">,</span>&nbsp;<span class="ident" id="7582758">f</span><span class="op" id="7582759">.</span><span class="ident" id="7582760">Name</span><span class="op" id="7582764">(</span><span class="op" id="7582765">)</span><span class="op" id="7582766">,</span>&nbsp;<span class="ident" id="7582768">offs</span><span class="op" id="7582772">,</span>&nbsp;<span class="ident" id="7582774">p</span><span class="op" id="7582775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582779">checkPos</span><span class="op" id="7582787">(</span><span class="ident" id="7582788">t</span><span class="op" id="7582789">,</span>&nbsp;<span class="ident" id="7582791">msg</span><span class="op" id="7582794">,</span>&nbsp;<span class="ident" id="7582796">f</span><span class="op" id="7582797">.</span><span class="ident" id="7582798">Position</span><span class="op" id="7582806">(</span><span class="ident" id="7582807">f</span><span class="op" id="7582808">.</span><span class="ident" id="7582809">Pos</span><span class="op" id="7582812">(</span><span class="ident" id="7582813">offs</span><span class="op" id="7582817">)</span><span class="op" id="7582818">)</span><span class="op" id="7582819">,</span>&nbsp;<span class="ident" id="7582821">Position</span><span class="op" id="7582829">{</span><span class="string" id="7582830">&#34;bar&#34;</span><span class="op" id="7582835">,</span>&nbsp;<span class="ident" id="7582837">offs</span><span class="op" id="7582841">,</span>&nbsp;<span class="num" id="7582843">42</span><span class="op" id="7582845">,</span>&nbsp;<span class="ident" id="7582847">col</span><span class="op" id="7582850">}</span><span class="op" id="7582851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582855">checkPos</span><span class="op" id="7582863">(</span><span class="ident" id="7582864">t</span><span class="op" id="7582865">,</span>&nbsp;<span class="ident" id="7582867">msg</span><span class="op" id="7582870">,</span>&nbsp;<span class="ident" id="7582872">fset</span><span class="op" id="7582876">.</span><span class="ident" id="7582877">Position</span><span class="op" id="7582885">(</span><span class="ident" id="7582886">p</span><span class="op" id="7582887">)</span><span class="op" id="7582888">,</span>&nbsp;<span class="ident" id="7582890">Position</span><span class="op" id="7582898">{</span><span class="string" id="7582899">&#34;bar&#34;</span><span class="op" id="7582904">,</span>&nbsp;<span class="ident" id="7582906">offs</span><span class="op" id="7582910">,</span>&nbsp;<span class="num" id="7582912">42</span><span class="op" id="7582914">,</span>&nbsp;<span class="ident" id="7582916">col</span><span class="op" id="7582919">}</span><span class="op" id="7582920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7582923">}</span><br>
<span class="lineno">165</span><span class="op" id="7582925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7582928">func</span>&nbsp;<span class="ident" id="7582933">TestFiles</span><span class="op" id="7582942">(</span><span class="ident" id="7582943">t</span>&nbsp;<span class="op" id="7582945">*</span><span class="ident" id="7582946">testing</span><span class="op" id="7582953">.</span><span class="ident" id="7582954">T</span><span class="op" id="7582955">)</span>&nbsp;<span class="op" id="7582957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7582960">fset</span>&nbsp;<span class="op" id="7582965">:=</span>&nbsp;<span class="ident" id="7582968">NewFileSet</span><span class="op" id="7582978">(</span><span class="op" id="7582979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7582982">for</span>&nbsp;<span class="ident" id="7582986">i</span><span class="op" id="7582987">,</span>&nbsp;<span class="ident" id="7582989">test</span>&nbsp;<span class="op" id="7582994">:=</span>&nbsp;<span class="keyword" id="7582997">range</span>&nbsp;<span class="ident" id="7583003">tests</span>&nbsp;<span class="op" id="7583009">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583013">base</span>&nbsp;<span class="op" id="7583018">:=</span>&nbsp;<span class="ident" id="7583021">fset</span><span class="op" id="7583025">.</span><span class="ident" id="7583026">Base</span><span class="op" id="7583030">(</span><span class="op" id="7583031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583035">if</span>&nbsp;<span class="ident" id="7583038">i</span><span class="op" id="7583039">%</span><span class="num" id="7583040">2</span>&nbsp;<span class="op" id="7583042">==</span>&nbsp;<span class="num" id="7583045">1</span>&nbsp;<span class="op" id="7583047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7583052">//&nbsp;Setting&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7583099">//&nbsp;fset.Base(),&nbsp;so&nbsp;test&nbsp;some&nbsp;of&nbsp;each.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583140">base</span>&nbsp;<span class="op" id="7583145">=</span>&nbsp;<span class="op" id="7583147">-</span><span class="num" id="7583148">1</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583156">fset</span><span class="op" id="7583160">.</span><span class="ident" id="7583161">AddFile</span><span class="op" id="7583168">(</span><span class="ident" id="7583169">test</span><span class="op" id="7583173">.</span><span class="ident" id="7583174">filename</span><span class="op" id="7583182">,</span>&nbsp;<span class="ident" id="7583184">base</span><span class="op" id="7583188">,</span>&nbsp;<span class="ident" id="7583190">test</span><span class="op" id="7583194">.</span><span class="ident" id="7583195">size</span><span class="op" id="7583199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583203">j</span>&nbsp;<span class="op" id="7583205">:=</span>&nbsp;<span class="num" id="7583208">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583212">fset</span><span class="op" id="7583216">.</span><span class="ident" id="7583217">Iterate</span><span class="op" id="7583224">(</span><span class="keyword" id="7583225">func</span><span class="op" id="7583229">(</span><span class="ident" id="7583230">f</span>&nbsp;<span class="op" id="7583232">*</span><span class="ident" id="7583233">File</span><span class="op" id="7583237">)</span>&nbsp;<span class="builtintype" id="7583239">bool</span>&nbsp;<span class="op" id="7583244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583249">if</span>&nbsp;<span class="ident" id="7583252">f</span><span class="op" id="7583253">.</span><span class="ident" id="7583254">Name</span><span class="op" id="7583258">(</span><span class="op" id="7583259">)</span>&nbsp;<span class="op" id="7583261">!=</span>&nbsp;<span class="ident" id="7583264">tests</span><span class="op" id="7583269">[</span><span class="ident" id="7583270">j</span><span class="op" id="7583271">]</span><span class="op" id="7583272">.</span><span class="ident" id="7583273">filename</span>&nbsp;<span class="op" id="7583282">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583288">t</span><span class="op" id="7583289">.</span><span class="ident" id="7583290">Errorf</span><span class="op" id="7583296">(</span><span class="string" id="7583297">&#34;got&nbsp;filename&nbsp;=&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7583325">,</span>&nbsp;<span class="ident" id="7583327">f</span><span class="op" id="7583328">.</span><span class="ident" id="7583329">Name</span><span class="op" id="7583333">(</span><span class="op" id="7583334">)</span><span class="op" id="7583335">,</span>&nbsp;<span class="ident" id="7583337">tests</span><span class="op" id="7583342">[</span><span class="ident" id="7583343">j</span><span class="op" id="7583344">]</span><span class="op" id="7583345">.</span><span class="ident" id="7583346">filename</span><span class="op" id="7583354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583364">j</span><span class="op" id="7583365">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583371">return</span>&nbsp;<span class="builtintype" id="7583378">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583385">}</span><span class="op" id="7583386">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583390">if</span>&nbsp;<span class="ident" id="7583393">j</span>&nbsp;<span class="op" id="7583395">!=</span>&nbsp;<span class="ident" id="7583398">i</span><span class="op" id="7583399">+</span><span class="num" id="7583400">1</span>&nbsp;<span class="op" id="7583402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583407">t</span><span class="op" id="7583408">.</span><span class="ident" id="7583409">Errorf</span><span class="op" id="7583415">(</span><span class="string" id="7583416">&#34;got&nbsp;%d&nbsp;files;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7583439">,</span>&nbsp;<span class="ident" id="7583441">j</span><span class="op" id="7583442">,</span>&nbsp;<span class="ident" id="7583444">i</span><span class="op" id="7583445">+</span><span class="num" id="7583446">1</span><span class="op" id="7583447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583454">}</span><br>
<span class="lineno"></span><span class="op" id="7583456">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="7583459">//&nbsp;FileSet.File&nbsp;should&nbsp;return&nbsp;nil&nbsp;if&nbsp;Pos&nbsp;is&nbsp;past&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="keyword" id="7583532">func</span>&nbsp;<span class="ident" id="7583537">TestFileSetPastEnd</span><span class="op" id="7583555">(</span><span class="ident" id="7583556">t</span>&nbsp;<span class="op" id="7583558">*</span><span class="ident" id="7583559">testing</span><span class="op" id="7583566">.</span><span class="ident" id="7583567">T</span><span class="op" id="7583568">)</span>&nbsp;<span class="op" id="7583570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583573">fset</span>&nbsp;<span class="op" id="7583578">:=</span>&nbsp;<span class="ident" id="7583581">NewFileSet</span><span class="op" id="7583591">(</span><span class="op" id="7583592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583595">for</span>&nbsp;<span class="ident" id="7583599">_</span><span class="op" id="7583600">,</span>&nbsp;<span class="ident" id="7583602">test</span>&nbsp;<span class="op" id="7583607">:=</span>&nbsp;<span class="keyword" id="7583610">range</span>&nbsp;<span class="ident" id="7583616">tests</span>&nbsp;<span class="op" id="7583622">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583626">fset</span><span class="op" id="7583630">.</span><span class="ident" id="7583631">AddFile</span><span class="op" id="7583638">(</span><span class="ident" id="7583639">test</span><span class="op" id="7583643">.</span><span class="ident" id="7583644">filename</span><span class="op" id="7583652">,</span>&nbsp;<span class="ident" id="7583654">fset</span><span class="op" id="7583658">.</span><span class="ident" id="7583659">Base</span><span class="op" id="7583663">(</span><span class="op" id="7583664">)</span><span class="op" id="7583665">,</span>&nbsp;<span class="ident" id="7583667">test</span><span class="op" id="7583671">.</span><span class="ident" id="7583672">size</span><span class="op" id="7583676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583682">if</span>&nbsp;<span class="ident" id="7583685">f</span>&nbsp;<span class="op" id="7583687">:=</span>&nbsp;<span class="ident" id="7583690">fset</span><span class="op" id="7583694">.</span><span class="ident" id="7583695">File</span><span class="op" id="7583699">(</span><span class="ident" id="7583700">Pos</span><span class="op" id="7583703">(</span><span class="ident" id="7583704">fset</span><span class="op" id="7583708">.</span><span class="ident" id="7583709">Base</span><span class="op" id="7583713">(</span><span class="op" id="7583714">)</span><span class="op" id="7583715">)</span><span class="op" id="7583716">)</span><span class="op" id="7583717">;</span>&nbsp;<span class="ident" id="7583719">f</span>&nbsp;<span class="op" id="7583721">!=</span>&nbsp;<span class="ident" id="7583724">nil</span>&nbsp;<span class="op" id="7583728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583732">t</span><span class="op" id="7583733">.</span><span class="ident" id="7583734">Errorf</span><span class="op" id="7583740">(</span><span class="string" id="7583741">&#34;got&nbsp;%v,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7583759">,</span>&nbsp;<span class="ident" id="7583761">f</span><span class="op" id="7583762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583765">}</span><br>
<span class="lineno">200</span><span class="op" id="7583767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7583770">func</span>&nbsp;<span class="ident" id="7583775">TestFileSetCacheUnlikely</span><span class="op" id="7583799">(</span><span class="ident" id="7583800">t</span>&nbsp;<span class="op" id="7583802">*</span><span class="ident" id="7583803">testing</span><span class="op" id="7583810">.</span><span class="ident" id="7583811">T</span><span class="op" id="7583812">)</span>&nbsp;<span class="op" id="7583814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583817">fset</span>&nbsp;<span class="op" id="7583822">:=</span>&nbsp;<span class="ident" id="7583825">NewFileSet</span><span class="op" id="7583835">(</span><span class="op" id="7583836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583839">offsets</span>&nbsp;<span class="op" id="7583847">:=</span>&nbsp;<span class="builtinfunc" id="7583850">make</span><span class="op" id="7583854">(</span><span class="keyword" id="7583855">map</span><span class="op" id="7583858">[</span><span class="builtintype" id="7583859">string</span><span class="op" id="7583865">]</span><span class="builtintype" id="7583866">int</span><span class="op" id="7583869">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583872">for</span>&nbsp;<span class="ident" id="7583876">_</span><span class="op" id="7583877">,</span>&nbsp;<span class="ident" id="7583879">test</span>&nbsp;<span class="op" id="7583884">:=</span>&nbsp;<span class="keyword" id="7583887">range</span>&nbsp;<span class="ident" id="7583893">tests</span>&nbsp;<span class="op" id="7583899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583903">offsets</span><span class="op" id="7583910">[</span><span class="ident" id="7583911">test</span><span class="op" id="7583915">.</span><span class="ident" id="7583916">filename</span><span class="op" id="7583924">]</span>&nbsp;<span class="op" id="7583926">=</span>&nbsp;<span class="ident" id="7583928">fset</span><span class="op" id="7583932">.</span><span class="ident" id="7583933">Base</span><span class="op" id="7583937">(</span><span class="op" id="7583938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7583942">fset</span><span class="op" id="7583946">.</span><span class="ident" id="7583947">AddFile</span><span class="op" id="7583954">(</span><span class="ident" id="7583955">test</span><span class="op" id="7583959">.</span><span class="ident" id="7583960">filename</span><span class="op" id="7583968">,</span>&nbsp;<span class="ident" id="7583970">fset</span><span class="op" id="7583974">.</span><span class="ident" id="7583975">Base</span><span class="op" id="7583979">(</span><span class="op" id="7583980">)</span><span class="op" id="7583981">,</span>&nbsp;<span class="ident" id="7583983">test</span><span class="op" id="7583987">.</span><span class="ident" id="7583988">size</span><span class="op" id="7583992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7583995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7583998">for</span>&nbsp;<span class="ident" id="7584002">file</span><span class="op" id="7584006">,</span>&nbsp;<span class="ident" id="7584008">pos</span>&nbsp;<span class="op" id="7584012">:=</span>&nbsp;<span class="keyword" id="7584015">range</span>&nbsp;<span class="ident" id="7584021">offsets</span>&nbsp;<span class="op" id="7584029">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584033">f</span>&nbsp;<span class="op" id="7584035">:=</span>&nbsp;<span class="ident" id="7584038">fset</span><span class="op" id="7584042">.</span><span class="ident" id="7584043">File</span><span class="op" id="7584047">(</span><span class="ident" id="7584048">Pos</span><span class="op" id="7584051">(</span><span class="ident" id="7584052">pos</span><span class="op" id="7584055">)</span><span class="op" id="7584056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584060">if</span>&nbsp;<span class="ident" id="7584063">f</span><span class="op" id="7584064">.</span><span class="ident" id="7584065">Name</span><span class="op" id="7584069">(</span><span class="op" id="7584070">)</span>&nbsp;<span class="op" id="7584072">!=</span>&nbsp;<span class="ident" id="7584075">file</span>&nbsp;<span class="op" id="7584080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584085">t</span><span class="op" id="7584086">.</span><span class="ident" id="7584087">Errorf</span><span class="op" id="7584093">(</span><span class="string" id="7584094">&#34;got&nbsp;%q&nbsp;at&nbsp;position&nbsp;%d,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7584126">,</span>&nbsp;<span class="ident" id="7584128">f</span><span class="op" id="7584129">.</span><span class="ident" id="7584130">Name</span><span class="op" id="7584134">(</span><span class="op" id="7584135">)</span><span class="op" id="7584136">,</span>&nbsp;<span class="ident" id="7584138">pos</span><span class="op" id="7584141">,</span>&nbsp;<span class="ident" id="7584143">file</span><span class="op" id="7584147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584154">}</span><br>
<span class="lineno">215</span><span class="op" id="7584156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7584159">//&nbsp;issue&nbsp;4345.&nbsp;Test&nbsp;concurrent&nbsp;use&nbsp;of&nbsp;FileSet.Pos&nbsp;does&nbsp;not&nbsp;trigger&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="7584228">//&nbsp;race&nbsp;in&nbsp;the&nbsp;FileSet&nbsp;position&nbsp;cache.</span><br>
<span class="lineno"></span><span class="keyword" id="7584267">func</span>&nbsp;<span class="ident" id="7584272">TestFileSetRace</span><span class="op" id="7584287">(</span><span class="ident" id="7584288">t</span>&nbsp;<span class="op" id="7584290">*</span><span class="ident" id="7584291">testing</span><span class="op" id="7584298">.</span><span class="ident" id="7584299">T</span><span class="op" id="7584300">)</span>&nbsp;<span class="op" id="7584302">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584305">fset</span>&nbsp;<span class="op" id="7584310">:=</span>&nbsp;<span class="ident" id="7584313">NewFileSet</span><span class="op" id="7584323">(</span><span class="op" id="7584324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584327">for</span>&nbsp;<span class="ident" id="7584331">i</span>&nbsp;<span class="op" id="7584333">:=</span>&nbsp;<span class="num" id="7584336">0</span><span class="op" id="7584337">;</span>&nbsp;<span class="ident" id="7584339">i</span>&nbsp;<span class="op" id="7584341">&lt;</span>&nbsp;<span class="num" id="7584343">100</span><span class="op" id="7584346">;</span>&nbsp;<span class="ident" id="7584348">i</span><span class="op" id="7584349">++</span>&nbsp;<span class="op" id="7584352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584356">fset</span><span class="op" id="7584360">.</span><span class="ident" id="7584361">AddFile</span><span class="op" id="7584368">(</span><span class="ident" id="7584369">fmt</span><span class="op" id="7584372">.</span><span class="ident" id="7584373">Sprintf</span><span class="op" id="7584380">(</span><span class="string" id="7584381">&#34;file-%d&#34;</span><span class="op" id="7584390">,</span>&nbsp;<span class="ident" id="7584392">i</span><span class="op" id="7584393">)</span><span class="op" id="7584394">,</span>&nbsp;<span class="ident" id="7584396">fset</span><span class="op" id="7584400">.</span><span class="ident" id="7584401">Base</span><span class="op" id="7584405">(</span><span class="op" id="7584406">)</span><span class="op" id="7584407">,</span>&nbsp;<span class="num" id="7584409">1031</span><span class="op" id="7584413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584419">max</span>&nbsp;<span class="op" id="7584423">:=</span>&nbsp;<span class="builtintype" id="7584426">int32</span><span class="op" id="7584431">(</span><span class="ident" id="7584432">fset</span><span class="op" id="7584436">.</span><span class="ident" id="7584437">Base</span><span class="op" id="7584441">(</span><span class="op" id="7584442">)</span><span class="op" id="7584443">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584446">var</span>&nbsp;<span class="ident" id="7584450">stop</span>&nbsp;<span class="ident" id="7584455">sync</span><span class="op" id="7584459">.</span><span class="ident" id="7584460">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584471">r</span>&nbsp;<span class="op" id="7584473">:=</span>&nbsp;<span class="ident" id="7584476">rand</span><span class="op" id="7584480">.</span><span class="ident" id="7584481">New</span><span class="op" id="7584484">(</span><span class="ident" id="7584485">rand</span><span class="op" id="7584489">.</span><span class="ident" id="7584490">NewSource</span><span class="op" id="7584499">(</span><span class="num" id="7584500">7</span><span class="op" id="7584501">)</span><span class="op" id="7584502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584505">for</span>&nbsp;<span class="ident" id="7584509">i</span>&nbsp;<span class="op" id="7584511">:=</span>&nbsp;<span class="num" id="7584514">0</span><span class="op" id="7584515">;</span>&nbsp;<span class="ident" id="7584517">i</span>&nbsp;<span class="op" id="7584519">&lt;</span>&nbsp;<span class="num" id="7584521">2</span><span class="op" id="7584522">;</span>&nbsp;<span class="ident" id="7584524">i</span><span class="op" id="7584525">++</span>&nbsp;<span class="op" id="7584528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584532">r</span>&nbsp;<span class="op" id="7584534">:=</span>&nbsp;<span class="ident" id="7584537">rand</span><span class="op" id="7584541">.</span><span class="ident" id="7584542">New</span><span class="op" id="7584545">(</span><span class="ident" id="7584546">rand</span><span class="op" id="7584550">.</span><span class="ident" id="7584551">NewSource</span><span class="op" id="7584560">(</span><span class="ident" id="7584561">r</span><span class="op" id="7584562">.</span><span class="ident" id="7584563">Int63</span><span class="op" id="7584568">(</span><span class="op" id="7584569">)</span><span class="op" id="7584570">)</span><span class="op" id="7584571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584575">stop</span><span class="op" id="7584579">.</span><span class="ident" id="7584580">Add</span><span class="op" id="7584583">(</span><span class="num" id="7584584">1</span><span class="op" id="7584585">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584589">go</span>&nbsp;<span class="keyword" id="7584592">func</span><span class="op" id="7584596">(</span><span class="op" id="7584597">)</span>&nbsp;<span class="op" id="7584599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584604">for</span>&nbsp;<span class="ident" id="7584608">i</span>&nbsp;<span class="op" id="7584610">:=</span>&nbsp;<span class="num" id="7584613">0</span><span class="op" id="7584614">;</span>&nbsp;<span class="ident" id="7584616">i</span>&nbsp;<span class="op" id="7584618">&lt;</span>&nbsp;<span class="num" id="7584620">1000</span><span class="op" id="7584624">;</span>&nbsp;<span class="ident" id="7584626">i</span><span class="op" id="7584627">++</span>&nbsp;<span class="op" id="7584630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584636">fset</span><span class="op" id="7584640">.</span><span class="ident" id="7584641">Position</span><span class="op" id="7584649">(</span><span class="ident" id="7584650">Pos</span><span class="op" id="7584653">(</span><span class="ident" id="7584654">r</span><span class="op" id="7584655">.</span><span class="ident" id="7584656">Int31n</span><span class="op" id="7584662">(</span><span class="ident" id="7584663">max</span><span class="op" id="7584666">)</span><span class="op" id="7584667">)</span><span class="op" id="7584668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584678">stop</span><span class="op" id="7584682">.</span><span class="ident" id="7584683">Done</span><span class="op" id="7584687">(</span><span class="op" id="7584688">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584692">}</span><span class="op" id="7584693">(</span><span class="op" id="7584694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7584697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584700">stop</span><span class="op" id="7584704">.</span><span class="ident" id="7584705">Wait</span><span class="op" id="7584709">(</span><span class="op" id="7584710">)</span><br>
<span class="lineno"></span><span class="op" id="7584712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7584715">func</span>&nbsp;<span class="ident" id="7584720">TestPositionFor</span><span class="op" id="7584735">(</span><span class="ident" id="7584736">t</span>&nbsp;<span class="op" id="7584738">*</span><span class="ident" id="7584739">testing</span><span class="op" id="7584746">.</span><span class="ident" id="7584747">T</span><span class="op" id="7584748">)</span>&nbsp;<span class="op" id="7584750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584753">src</span>&nbsp;<span class="op" id="7584757">:=</span>&nbsp;<span class="op" id="7584760">[</span><span class="op" id="7584761">]</span><span class="builtintype" id="7584762">byte</span><span class="op" id="7584766">(</span><span class="string" id="7584767">`<br>
<span class="lineno"></span>foo<br>
<span class="lineno"></span>b<br>
<span class="lineno"></span>ar<br>
<span class="lineno">245</span>//line&nbsp;:100<br>
<span class="lineno"></span>foobar<br>
<span class="lineno"></span>//line&nbsp;bar:3<br>
<span class="lineno"></span>done<br>
<span class="lineno"></span>`</span><span class="op" id="7584816">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584820">const</span>&nbsp;<span class="ident" id="7584826">filename</span>&nbsp;<span class="op" id="7584835">=</span>&nbsp;<span class="string" id="7584837">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584844">fset</span>&nbsp;<span class="op" id="7584849">:=</span>&nbsp;<span class="ident" id="7584852">NewFileSet</span><span class="op" id="7584862">(</span><span class="op" id="7584863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584866">f</span>&nbsp;<span class="op" id="7584868">:=</span>&nbsp;<span class="ident" id="7584871">fset</span><span class="op" id="7584875">.</span><span class="ident" id="7584876">AddFile</span><span class="op" id="7584883">(</span><span class="ident" id="7584884">filename</span><span class="op" id="7584892">,</span>&nbsp;<span class="ident" id="7584894">fset</span><span class="op" id="7584898">.</span><span class="ident" id="7584899">Base</span><span class="op" id="7584903">(</span><span class="op" id="7584904">)</span><span class="op" id="7584905">,</span>&nbsp;<span class="builtinfunc" id="7584907">len</span><span class="op" id="7584910">(</span><span class="ident" id="7584911">src</span><span class="op" id="7584914">)</span><span class="op" id="7584915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7584918">f</span><span class="op" id="7584919">.</span><span class="ident" id="7584920">SetLinesForContent</span><span class="op" id="7584938">(</span><span class="ident" id="7584939">src</span><span class="op" id="7584942">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7584946">//&nbsp;verify&nbsp;position&nbsp;info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7584971">for</span>&nbsp;<span class="ident" id="7584975">i</span><span class="op" id="7584976">,</span>&nbsp;<span class="ident" id="7584978">offs</span>&nbsp;<span class="op" id="7584983">:=</span>&nbsp;<span class="keyword" id="7584986">range</span>&nbsp;<span class="ident" id="7584992">f</span><span class="op" id="7584993">.</span><span class="ident" id="7584994">lines</span>&nbsp;<span class="op" id="7585000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585004">got1</span>&nbsp;<span class="op" id="7585009">:=</span>&nbsp;<span class="ident" id="7585012">f</span><span class="op" id="7585013">.</span><span class="ident" id="7585014">PositionFor</span><span class="op" id="7585025">(</span><span class="ident" id="7585026">f</span><span class="op" id="7585027">.</span><span class="ident" id="7585028">Pos</span><span class="op" id="7585031">(</span><span class="ident" id="7585032">offs</span><span class="op" id="7585036">)</span><span class="op" id="7585037">,</span>&nbsp;<span class="builtintype" id="7585039">false</span><span class="op" id="7585044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585048">got2</span>&nbsp;<span class="op" id="7585053">:=</span>&nbsp;<span class="ident" id="7585056">f</span><span class="op" id="7585057">.</span><span class="ident" id="7585058">PositionFor</span><span class="op" id="7585069">(</span><span class="ident" id="7585070">f</span><span class="op" id="7585071">.</span><span class="ident" id="7585072">Pos</span><span class="op" id="7585075">(</span><span class="ident" id="7585076">offs</span><span class="op" id="7585080">)</span><span class="op" id="7585081">,</span>&nbsp;<span class="builtintype" id="7585083">true</span><span class="op" id="7585087">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585091">got3</span>&nbsp;<span class="op" id="7585096">:=</span>&nbsp;<span class="ident" id="7585099">f</span><span class="op" id="7585100">.</span><span class="ident" id="7585101">Position</span><span class="op" id="7585109">(</span><span class="ident" id="7585110">f</span><span class="op" id="7585111">.</span><span class="ident" id="7585112">Pos</span><span class="op" id="7585115">(</span><span class="ident" id="7585116">offs</span><span class="op" id="7585120">)</span><span class="op" id="7585121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585125">want</span>&nbsp;<span class="op" id="7585130">:=</span>&nbsp;<span class="ident" id="7585133">Position</span><span class="op" id="7585141">{</span><span class="ident" id="7585142">filename</span><span class="op" id="7585150">,</span>&nbsp;<span class="ident" id="7585152">offs</span><span class="op" id="7585156">,</span>&nbsp;<span class="ident" id="7585158">i</span>&nbsp;<span class="op" id="7585160">+</span>&nbsp;<span class="num" id="7585162">1</span><span class="op" id="7585163">,</span>&nbsp;<span class="num" id="7585165">1</span><span class="op" id="7585166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585170">checkPos</span><span class="op" id="7585178">(</span><span class="ident" id="7585179">t</span><span class="op" id="7585180">,</span>&nbsp;<span class="string" id="7585182">&#34;1.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7585209">,</span>&nbsp;<span class="ident" id="7585211">got1</span><span class="op" id="7585215">,</span>&nbsp;<span class="ident" id="7585217">want</span><span class="op" id="7585221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585225">checkPos</span><span class="op" id="7585233">(</span><span class="ident" id="7585234">t</span><span class="op" id="7585235">,</span>&nbsp;<span class="string" id="7585237">&#34;1.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7585262">,</span>&nbsp;<span class="ident" id="7585264">got2</span><span class="op" id="7585268">,</span>&nbsp;<span class="ident" id="7585270">want</span><span class="op" id="7585274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585278">checkPos</span><span class="op" id="7585286">(</span><span class="ident" id="7585287">t</span><span class="op" id="7585288">,</span>&nbsp;<span class="string" id="7585290">&#34;1.&nbsp;Position&#34;</span><span class="op" id="7585303">,</span>&nbsp;<span class="ident" id="7585305">got3</span><span class="op" id="7585309">,</span>&nbsp;<span class="ident" id="7585311">want</span><span class="op" id="7585315">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7585322">//&nbsp;manually&nbsp;add&nbsp;//line&nbsp;info&nbsp;on&nbsp;lines&nbsp;l1,&nbsp;l2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585367">const</span>&nbsp;<span class="ident" id="7585373">l1</span><span class="op" id="7585375">,</span>&nbsp;<span class="ident" id="7585377">l2</span>&nbsp;<span class="op" id="7585380">=</span>&nbsp;<span class="num" id="7585382">5</span><span class="op" id="7585383">,</span>&nbsp;<span class="num" id="7585385">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585388">f</span><span class="op" id="7585389">.</span><span class="ident" id="7585390">AddLineInfo</span><span class="op" id="7585401">(</span><span class="ident" id="7585402">f</span><span class="op" id="7585403">.</span><span class="ident" id="7585404">lines</span><span class="op" id="7585409">[</span><span class="ident" id="7585410">l1</span><span class="op" id="7585412">-</span><span class="num" id="7585413">1</span><span class="op" id="7585414">]</span><span class="op" id="7585415">,</span>&nbsp;<span class="string" id="7585417">&#34;&#34;</span><span class="op" id="7585419">,</span>&nbsp;<span class="num" id="7585421">100</span><span class="op" id="7585424">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585427">f</span><span class="op" id="7585428">.</span><span class="ident" id="7585429">AddLineInfo</span><span class="op" id="7585440">(</span><span class="ident" id="7585441">f</span><span class="op" id="7585442">.</span><span class="ident" id="7585443">lines</span><span class="op" id="7585448">[</span><span class="ident" id="7585449">l2</span><span class="op" id="7585451">-</span><span class="num" id="7585452">1</span><span class="op" id="7585453">]</span><span class="op" id="7585454">,</span>&nbsp;<span class="string" id="7585456">&#34;bar&#34;</span><span class="op" id="7585461">,</span>&nbsp;<span class="num" id="7585463">3</span><span class="op" id="7585464">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7585468">//&nbsp;unadjusted&nbsp;position&nbsp;info&nbsp;must&nbsp;remain&nbsp;unchanged</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585519">for</span>&nbsp;<span class="ident" id="7585523">i</span><span class="op" id="7585524">,</span>&nbsp;<span class="ident" id="7585526">offs</span>&nbsp;<span class="op" id="7585531">:=</span>&nbsp;<span class="keyword" id="7585534">range</span>&nbsp;<span class="ident" id="7585540">f</span><span class="op" id="7585541">.</span><span class="ident" id="7585542">lines</span>&nbsp;<span class="op" id="7585548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585552">got1</span>&nbsp;<span class="op" id="7585557">:=</span>&nbsp;<span class="ident" id="7585560">f</span><span class="op" id="7585561">.</span><span class="ident" id="7585562">PositionFor</span><span class="op" id="7585573">(</span><span class="ident" id="7585574">f</span><span class="op" id="7585575">.</span><span class="ident" id="7585576">Pos</span><span class="op" id="7585579">(</span><span class="ident" id="7585580">offs</span><span class="op" id="7585584">)</span><span class="op" id="7585585">,</span>&nbsp;<span class="builtintype" id="7585587">false</span><span class="op" id="7585592">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585596">want</span>&nbsp;<span class="op" id="7585601">:=</span>&nbsp;<span class="ident" id="7585604">Position</span><span class="op" id="7585612">{</span><span class="ident" id="7585613">filename</span><span class="op" id="7585621">,</span>&nbsp;<span class="ident" id="7585623">offs</span><span class="op" id="7585627">,</span>&nbsp;<span class="ident" id="7585629">i</span>&nbsp;<span class="op" id="7585631">+</span>&nbsp;<span class="num" id="7585633">1</span><span class="op" id="7585634">,</span>&nbsp;<span class="num" id="7585636">1</span><span class="op" id="7585637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585641">checkPos</span><span class="op" id="7585649">(</span><span class="ident" id="7585650">t</span><span class="op" id="7585651">,</span>&nbsp;<span class="string" id="7585653">&#34;2.&nbsp;PositionFor&nbsp;unadjusted&#34;</span><span class="op" id="7585680">,</span>&nbsp;<span class="ident" id="7585682">got1</span><span class="op" id="7585686">,</span>&nbsp;<span class="ident" id="7585688">want</span><span class="op" id="7585692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7585695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7585699">//&nbsp;adjusted&nbsp;position&nbsp;info&nbsp;should&nbsp;have&nbsp;changed</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585746">for</span>&nbsp;<span class="ident" id="7585750">i</span><span class="op" id="7585751">,</span>&nbsp;<span class="ident" id="7585753">offs</span>&nbsp;<span class="op" id="7585758">:=</span>&nbsp;<span class="keyword" id="7585761">range</span>&nbsp;<span class="ident" id="7585767">f</span><span class="op" id="7585768">.</span><span class="ident" id="7585769">lines</span>&nbsp;<span class="op" id="7585775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585779">got2</span>&nbsp;<span class="op" id="7585784">:=</span>&nbsp;<span class="ident" id="7585787">f</span><span class="op" id="7585788">.</span><span class="ident" id="7585789">PositionFor</span><span class="op" id="7585800">(</span><span class="ident" id="7585801">f</span><span class="op" id="7585802">.</span><span class="ident" id="7585803">Pos</span><span class="op" id="7585806">(</span><span class="ident" id="7585807">offs</span><span class="op" id="7585811">)</span><span class="op" id="7585812">,</span>&nbsp;<span class="builtintype" id="7585814">true</span><span class="op" id="7585818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585822">got3</span>&nbsp;<span class="op" id="7585827">:=</span>&nbsp;<span class="ident" id="7585830">f</span><span class="op" id="7585831">.</span><span class="ident" id="7585832">Position</span><span class="op" id="7585840">(</span><span class="ident" id="7585841">f</span><span class="op" id="7585842">.</span><span class="ident" id="7585843">Pos</span><span class="op" id="7585846">(</span><span class="ident" id="7585847">offs</span><span class="op" id="7585851">)</span><span class="op" id="7585852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585856">want</span>&nbsp;<span class="op" id="7585861">:=</span>&nbsp;<span class="ident" id="7585864">Position</span><span class="op" id="7585872">{</span><span class="ident" id="7585873">filename</span><span class="op" id="7585881">,</span>&nbsp;<span class="ident" id="7585883">offs</span><span class="op" id="7585887">,</span>&nbsp;<span class="ident" id="7585889">i</span>&nbsp;<span class="op" id="7585891">+</span>&nbsp;<span class="num" id="7585893">1</span><span class="op" id="7585894">,</span>&nbsp;<span class="num" id="7585896">1</span><span class="op" id="7585897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7585901">//&nbsp;manually&nbsp;compute&nbsp;wanted&nbsp;filename&nbsp;and&nbsp;line</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585948">line</span>&nbsp;<span class="op" id="7585953">:=</span>&nbsp;<span class="ident" id="7585956">want</span><span class="op" id="7585960">.</span><span class="ident" id="7585961">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7585968">if</span>&nbsp;<span class="ident" id="7585971">i</span><span class="op" id="7585972">+</span><span class="num" id="7585973">1</span>&nbsp;<span class="op" id="7585975">&gt;=</span>&nbsp;<span class="ident" id="7585978">l1</span>&nbsp;<span class="op" id="7585981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7585986">want</span><span class="op" id="7585990">.</span><span class="ident" id="7585991">Filename</span>&nbsp;<span class="op" id="7586000">=</span>&nbsp;<span class="string" id="7586002">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586008">want</span><span class="op" id="7586012">.</span><span class="ident" id="7586013">Line</span>&nbsp;<span class="op" id="7586018">=</span>&nbsp;<span class="ident" id="7586020">line</span>&nbsp;<span class="op" id="7586025">-</span>&nbsp;<span class="ident" id="7586027">l1</span>&nbsp;<span class="op" id="7586030">+</span>&nbsp;<span class="num" id="7586032">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586038">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7586042">if</span>&nbsp;<span class="ident" id="7586045">i</span><span class="op" id="7586046">+</span><span class="num" id="7586047">1</span>&nbsp;<span class="op" id="7586049">&gt;=</span>&nbsp;<span class="ident" id="7586052">l2</span>&nbsp;<span class="op" id="7586055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586060">want</span><span class="op" id="7586064">.</span><span class="ident" id="7586065">Filename</span>&nbsp;<span class="op" id="7586074">=</span>&nbsp;<span class="string" id="7586076">&#34;bar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586085">want</span><span class="op" id="7586089">.</span><span class="ident" id="7586090">Line</span>&nbsp;<span class="op" id="7586095">=</span>&nbsp;<span class="ident" id="7586097">line</span>&nbsp;<span class="op" id="7586102">-</span>&nbsp;<span class="ident" id="7586104">l2</span>&nbsp;<span class="op" id="7586107">+</span>&nbsp;<span class="num" id="7586109">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586117">checkPos</span><span class="op" id="7586125">(</span><span class="ident" id="7586126">t</span><span class="op" id="7586127">,</span>&nbsp;<span class="string" id="7586129">&#34;3.&nbsp;PositionFor&nbsp;adjusted&#34;</span><span class="op" id="7586154">,</span>&nbsp;<span class="ident" id="7586156">got2</span><span class="op" id="7586160">,</span>&nbsp;<span class="ident" id="7586162">want</span><span class="op" id="7586166">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7586170">checkPos</span><span class="op" id="7586178">(</span><span class="ident" id="7586179">t</span><span class="op" id="7586180">,</span>&nbsp;<span class="string" id="7586182">&#34;3.&nbsp;Position&#34;</span><span class="op" id="7586195">,</span>&nbsp;<span class="ident" id="7586197">got3</span><span class="op" id="7586201">,</span>&nbsp;<span class="ident" id="7586203">want</span><span class="op" id="7586207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7586210">}</span><br>
<span class="lineno"></span><span class="op" id="7586212">}</span>
</div>
</body>
</html>
