<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3470389">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3470444">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3470498">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3470549">package</span>&nbsp;<span class="ident" id="3470557">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3470562">import</span>&nbsp;<span class="op" id="3470569">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470572">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470581">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470595">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470612">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470627">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470644">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470661">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3470671">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="3470676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3470679">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="3470754">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="3470803">type</span>&nbsp;<span class="ident" id="3470808">sessionState</span>&nbsp;<span class="keyword" id="3470821">struct</span>&nbsp;<span class="op" id="3470828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470831">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3470844">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470852">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="3470865">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470873">masterSecret</span>&nbsp;<span class="op" id="3470886">[</span><span class="op" id="3470887">]</span><span class="builtintype" id="3470888">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470894">certificates</span>&nbsp;<span class="op" id="3470907">[</span><span class="op" id="3470908">]</span><span class="op" id="3470909">[</span><span class="op" id="3470910">]</span><span class="builtintype" id="3470911">byte</span><br>
<span class="lineno">25</span><span class="op" id="3470916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3470919">func</span>&nbsp;<span class="op" id="3470924">(</span><span class="ident" id="3470925">s</span>&nbsp;<span class="op" id="3470927">*</span><span class="ident" id="3470928">sessionState</span><span class="op" id="3470940">)</span>&nbsp;<span class="ident" id="3470942">equal</span><span class="op" id="3470947">(</span><span class="ident" id="3470948">i</span>&nbsp;<span class="keyword" id="3470950">interface</span><span class="op" id="3470959">{</span><span class="op" id="3470960">}</span><span class="op" id="3470961">)</span>&nbsp;<span class="builtintype" id="3470963">bool</span>&nbsp;<span class="op" id="3470968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3470971">s1</span><span class="op" id="3470973">,</span>&nbsp;<span class="ident" id="3470975">ok</span>&nbsp;<span class="op" id="3470978">:=</span>&nbsp;<span class="ident" id="3470981">i</span><span class="op" id="3470982">.</span><span class="op" id="3470983">(</span><span class="op" id="3470984">*</span><span class="ident" id="3470985">sessionState</span><span class="op" id="3470997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471000">if</span>&nbsp;<span class="op" id="3471003">!</span><span class="ident" id="3471004">ok</span>&nbsp;<span class="op" id="3471007">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471011">return</span>&nbsp;<span class="builtintype" id="3471018">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471029">if</span>&nbsp;<span class="ident" id="3471032">s</span><span class="op" id="3471033">.</span><span class="ident" id="3471034">vers</span>&nbsp;<span class="op" id="3471039">!=</span>&nbsp;<span class="ident" id="3471042">s1</span><span class="op" id="3471044">.</span><span class="ident" id="3471045">vers</span>&nbsp;<span class="op" id="3471050">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471055">s</span><span class="op" id="3471056">.</span><span class="ident" id="3471057">cipherSuite</span>&nbsp;<span class="op" id="3471069">!=</span>&nbsp;<span class="ident" id="3471072">s1</span><span class="op" id="3471074">.</span><span class="ident" id="3471075">cipherSuite</span>&nbsp;<span class="op" id="3471087">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471092">!</span><span class="ident" id="3471093">bytes</span><span class="op" id="3471098">.</span><span class="ident" id="3471099">Equal</span><span class="op" id="3471104">(</span><span class="ident" id="3471105">s</span><span class="op" id="3471106">.</span><span class="ident" id="3471107">masterSecret</span><span class="op" id="3471119">,</span>&nbsp;<span class="ident" id="3471121">s1</span><span class="op" id="3471123">.</span><span class="ident" id="3471124">masterSecret</span><span class="op" id="3471136">)</span>&nbsp;<span class="op" id="3471138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471142">return</span>&nbsp;<span class="builtintype" id="3471149">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471160">if</span>&nbsp;<span class="builtinfunc" id="3471163">len</span><span class="op" id="3471166">(</span><span class="ident" id="3471167">s</span><span class="op" id="3471168">.</span><span class="ident" id="3471169">certificates</span><span class="op" id="3471181">)</span>&nbsp;<span class="op" id="3471183">!=</span>&nbsp;<span class="builtinfunc" id="3471186">len</span><span class="op" id="3471189">(</span><span class="ident" id="3471190">s1</span><span class="op" id="3471192">.</span><span class="ident" id="3471193">certificates</span><span class="op" id="3471205">)</span>&nbsp;<span class="op" id="3471207">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471211">return</span>&nbsp;<span class="builtintype" id="3471218">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471229">for</span>&nbsp;<span class="ident" id="3471233">i</span>&nbsp;<span class="op" id="3471235">:=</span>&nbsp;<span class="keyword" id="3471238">range</span>&nbsp;<span class="ident" id="3471244">s</span><span class="op" id="3471245">.</span><span class="ident" id="3471246">certificates</span>&nbsp;<span class="op" id="3471259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471263">if</span>&nbsp;<span class="op" id="3471266">!</span><span class="ident" id="3471267">bytes</span><span class="op" id="3471272">.</span><span class="ident" id="3471273">Equal</span><span class="op" id="3471278">(</span><span class="ident" id="3471279">s</span><span class="op" id="3471280">.</span><span class="ident" id="3471281">certificates</span><span class="op" id="3471293">[</span><span class="ident" id="3471294">i</span><span class="op" id="3471295">]</span><span class="op" id="3471296">,</span>&nbsp;<span class="ident" id="3471298">s1</span><span class="op" id="3471300">.</span><span class="ident" id="3471301">certificates</span><span class="op" id="3471313">[</span><span class="ident" id="3471314">i</span><span class="op" id="3471315">]</span><span class="op" id="3471316">)</span>&nbsp;<span class="op" id="3471318">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471323">return</span>&nbsp;<span class="builtintype" id="3471330">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471345">return</span>&nbsp;<span class="builtintype" id="3471352">true</span><br>
<span class="lineno">50</span><span class="op" id="3471357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3471360">func</span>&nbsp;<span class="op" id="3471365">(</span><span class="ident" id="3471366">s</span>&nbsp;<span class="op" id="3471368">*</span><span class="ident" id="3471369">sessionState</span><span class="op" id="3471381">)</span>&nbsp;<span class="ident" id="3471383">marshal</span><span class="op" id="3471390">(</span><span class="op" id="3471391">)</span>&nbsp;<span class="op" id="3471393">[</span><span class="op" id="3471394">]</span><span class="builtintype" id="3471395">byte</span>&nbsp;<span class="op" id="3471400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471403">length</span>&nbsp;<span class="op" id="3471410">:=</span>&nbsp;<span class="num" id="3471413">2</span>&nbsp;<span class="op" id="3471415">+</span>&nbsp;<span class="num" id="3471417">2</span>&nbsp;<span class="op" id="3471419">+</span>&nbsp;<span class="num" id="3471421">2</span>&nbsp;<span class="op" id="3471423">+</span>&nbsp;<span class="builtinfunc" id="3471425">len</span><span class="op" id="3471428">(</span><span class="ident" id="3471429">s</span><span class="op" id="3471430">.</span><span class="ident" id="3471431">masterSecret</span><span class="op" id="3471443">)</span>&nbsp;<span class="op" id="3471445">+</span>&nbsp;<span class="num" id="3471447">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471450">for</span>&nbsp;<span class="ident" id="3471454">_</span><span class="op" id="3471455">,</span>&nbsp;<span class="ident" id="3471457">cert</span>&nbsp;<span class="op" id="3471462">:=</span>&nbsp;<span class="keyword" id="3471465">range</span>&nbsp;<span class="ident" id="3471471">s</span><span class="op" id="3471472">.</span><span class="ident" id="3471473">certificates</span>&nbsp;<span class="op" id="3471486">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471490">length</span>&nbsp;<span class="op" id="3471497">+=</span>&nbsp;<span class="num" id="3471500">4</span>&nbsp;<span class="op" id="3471502">+</span>&nbsp;<span class="builtinfunc" id="3471504">len</span><span class="op" id="3471507">(</span><span class="ident" id="3471508">cert</span><span class="op" id="3471512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3471515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471519">ret</span>&nbsp;<span class="op" id="3471523">:=</span>&nbsp;<span class="builtinfunc" id="3471526">make</span><span class="op" id="3471530">(</span><span class="op" id="3471531">[</span><span class="op" id="3471532">]</span><span class="builtintype" id="3471533">byte</span><span class="op" id="3471537">,</span>&nbsp;<span class="ident" id="3471539">length</span><span class="op" id="3471545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471548">x</span>&nbsp;<span class="op" id="3471550">:=</span>&nbsp;<span class="ident" id="3471553">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471558">x</span><span class="op" id="3471559">[</span><span class="num" id="3471560">0</span><span class="op" id="3471561">]</span>&nbsp;<span class="op" id="3471563">=</span>&nbsp;<span class="builtintype" id="3471565">byte</span><span class="op" id="3471569">(</span><span class="ident" id="3471570">s</span><span class="op" id="3471571">.</span><span class="ident" id="3471572">vers</span>&nbsp;<span class="op" id="3471577">&gt;&gt;</span>&nbsp;<span class="num" id="3471580">8</span><span class="op" id="3471581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471584">x</span><span class="op" id="3471585">[</span><span class="num" id="3471586">1</span><span class="op" id="3471587">]</span>&nbsp;<span class="op" id="3471589">=</span>&nbsp;<span class="builtintype" id="3471591">byte</span><span class="op" id="3471595">(</span><span class="ident" id="3471596">s</span><span class="op" id="3471597">.</span><span class="ident" id="3471598">vers</span><span class="op" id="3471602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471605">x</span><span class="op" id="3471606">[</span><span class="num" id="3471607">2</span><span class="op" id="3471608">]</span>&nbsp;<span class="op" id="3471610">=</span>&nbsp;<span class="builtintype" id="3471612">byte</span><span class="op" id="3471616">(</span><span class="ident" id="3471617">s</span><span class="op" id="3471618">.</span><span class="ident" id="3471619">cipherSuite</span>&nbsp;<span class="op" id="3471631">&gt;&gt;</span>&nbsp;<span class="num" id="3471634">8</span><span class="op" id="3471635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471638">x</span><span class="op" id="3471639">[</span><span class="num" id="3471640">3</span><span class="op" id="3471641">]</span>&nbsp;<span class="op" id="3471643">=</span>&nbsp;<span class="builtintype" id="3471645">byte</span><span class="op" id="3471649">(</span><span class="ident" id="3471650">s</span><span class="op" id="3471651">.</span><span class="ident" id="3471652">cipherSuite</span><span class="op" id="3471663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471666">x</span><span class="op" id="3471667">[</span><span class="num" id="3471668">4</span><span class="op" id="3471669">]</span>&nbsp;<span class="op" id="3471671">=</span>&nbsp;<span class="builtintype" id="3471673">byte</span><span class="op" id="3471677">(</span><span class="builtinfunc" id="3471678">len</span><span class="op" id="3471681">(</span><span class="ident" id="3471682">s</span><span class="op" id="3471683">.</span><span class="ident" id="3471684">masterSecret</span><span class="op" id="3471696">)</span>&nbsp;<span class="op" id="3471698">&gt;&gt;</span>&nbsp;<span class="num" id="3471701">8</span><span class="op" id="3471702">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471705">x</span><span class="op" id="3471706">[</span><span class="num" id="3471707">5</span><span class="op" id="3471708">]</span>&nbsp;<span class="op" id="3471710">=</span>&nbsp;<span class="builtintype" id="3471712">byte</span><span class="op" id="3471716">(</span><span class="builtinfunc" id="3471717">len</span><span class="op" id="3471720">(</span><span class="ident" id="3471721">s</span><span class="op" id="3471722">.</span><span class="ident" id="3471723">masterSecret</span><span class="op" id="3471735">)</span><span class="op" id="3471736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471739">x</span>&nbsp;<span class="op" id="3471741">=</span>&nbsp;<span class="ident" id="3471743">x</span><span class="op" id="3471744">[</span><span class="num" id="3471745">6</span><span class="op" id="3471746">:</span><span class="op" id="3471747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3471750">copy</span><span class="op" id="3471754">(</span><span class="ident" id="3471755">x</span><span class="op" id="3471756">,</span>&nbsp;<span class="ident" id="3471758">s</span><span class="op" id="3471759">.</span><span class="ident" id="3471760">masterSecret</span><span class="op" id="3471772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471775">x</span>&nbsp;<span class="op" id="3471777">=</span>&nbsp;<span class="ident" id="3471779">x</span><span class="op" id="3471780">[</span><span class="builtinfunc" id="3471781">len</span><span class="op" id="3471784">(</span><span class="ident" id="3471785">s</span><span class="op" id="3471786">.</span><span class="ident" id="3471787">masterSecret</span><span class="op" id="3471799">)</span><span class="op" id="3471800">:</span><span class="op" id="3471801">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471805">x</span><span class="op" id="3471806">[</span><span class="num" id="3471807">0</span><span class="op" id="3471808">]</span>&nbsp;<span class="op" id="3471810">=</span>&nbsp;<span class="builtintype" id="3471812">byte</span><span class="op" id="3471816">(</span><span class="builtinfunc" id="3471817">len</span><span class="op" id="3471820">(</span><span class="ident" id="3471821">s</span><span class="op" id="3471822">.</span><span class="ident" id="3471823">certificates</span><span class="op" id="3471835">)</span>&nbsp;<span class="op" id="3471837">&gt;&gt;</span>&nbsp;<span class="num" id="3471840">8</span><span class="op" id="3471841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471844">x</span><span class="op" id="3471845">[</span><span class="num" id="3471846">1</span><span class="op" id="3471847">]</span>&nbsp;<span class="op" id="3471849">=</span>&nbsp;<span class="builtintype" id="3471851">byte</span><span class="op" id="3471855">(</span><span class="builtinfunc" id="3471856">len</span><span class="op" id="3471859">(</span><span class="ident" id="3471860">s</span><span class="op" id="3471861">.</span><span class="ident" id="3471862">certificates</span><span class="op" id="3471874">)</span><span class="op" id="3471875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471878">x</span>&nbsp;<span class="op" id="3471880">=</span>&nbsp;<span class="ident" id="3471882">x</span><span class="op" id="3471883">[</span><span class="num" id="3471884">2</span><span class="op" id="3471885">:</span><span class="op" id="3471886">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3471890">for</span>&nbsp;<span class="ident" id="3471894">_</span><span class="op" id="3471895">,</span>&nbsp;<span class="ident" id="3471897">cert</span>&nbsp;<span class="op" id="3471902">:=</span>&nbsp;<span class="keyword" id="3471905">range</span>&nbsp;<span class="ident" id="3471911">s</span><span class="op" id="3471912">.</span><span class="ident" id="3471913">certificates</span>&nbsp;<span class="op" id="3471926">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471930">x</span><span class="op" id="3471931">[</span><span class="num" id="3471932">0</span><span class="op" id="3471933">]</span>&nbsp;<span class="op" id="3471935">=</span>&nbsp;<span class="builtintype" id="3471937">byte</span><span class="op" id="3471941">(</span><span class="builtinfunc" id="3471942">len</span><span class="op" id="3471945">(</span><span class="ident" id="3471946">cert</span><span class="op" id="3471950">)</span>&nbsp;<span class="op" id="3471952">&gt;&gt;</span>&nbsp;<span class="num" id="3471955">24</span><span class="op" id="3471957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471961">x</span><span class="op" id="3471962">[</span><span class="num" id="3471963">1</span><span class="op" id="3471964">]</span>&nbsp;<span class="op" id="3471966">=</span>&nbsp;<span class="builtintype" id="3471968">byte</span><span class="op" id="3471972">(</span><span class="builtinfunc" id="3471973">len</span><span class="op" id="3471976">(</span><span class="ident" id="3471977">cert</span><span class="op" id="3471981">)</span>&nbsp;<span class="op" id="3471983">&gt;&gt;</span>&nbsp;<span class="num" id="3471986">16</span><span class="op" id="3471988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3471992">x</span><span class="op" id="3471993">[</span><span class="num" id="3471994">2</span><span class="op" id="3471995">]</span>&nbsp;<span class="op" id="3471997">=</span>&nbsp;<span class="builtintype" id="3471999">byte</span><span class="op" id="3472003">(</span><span class="builtinfunc" id="3472004">len</span><span class="op" id="3472007">(</span><span class="ident" id="3472008">cert</span><span class="op" id="3472012">)</span>&nbsp;<span class="op" id="3472014">&gt;&gt;</span>&nbsp;<span class="num" id="3472017">8</span><span class="op" id="3472018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472022">x</span><span class="op" id="3472023">[</span><span class="num" id="3472024">3</span><span class="op" id="3472025">]</span>&nbsp;<span class="op" id="3472027">=</span>&nbsp;<span class="builtintype" id="3472029">byte</span><span class="op" id="3472033">(</span><span class="builtinfunc" id="3472034">len</span><span class="op" id="3472037">(</span><span class="ident" id="3472038">cert</span><span class="op" id="3472042">)</span><span class="op" id="3472043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3472047">copy</span><span class="op" id="3472051">(</span><span class="ident" id="3472052">x</span><span class="op" id="3472053">[</span><span class="num" id="3472054">4</span><span class="op" id="3472055">:</span><span class="op" id="3472056">]</span><span class="op" id="3472057">,</span>&nbsp;<span class="ident" id="3472059">cert</span><span class="op" id="3472063">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472067">x</span>&nbsp;<span class="op" id="3472069">=</span>&nbsp;<span class="ident" id="3472071">x</span><span class="op" id="3472072">[</span><span class="num" id="3472073">4</span><span class="op" id="3472074">+</span><span class="builtinfunc" id="3472075">len</span><span class="op" id="3472078">(</span><span class="ident" id="3472079">cert</span><span class="op" id="3472083">)</span><span class="op" id="3472084">:</span><span class="op" id="3472085">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472092">return</span>&nbsp;<span class="ident" id="3472099">ret</span><br>
<span class="lineno"></span><span class="op" id="3472103">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3472106">func</span>&nbsp;<span class="op" id="3472111">(</span><span class="ident" id="3472112">s</span>&nbsp;<span class="op" id="3472114">*</span><span class="ident" id="3472115">sessionState</span><span class="op" id="3472127">)</span>&nbsp;<span class="ident" id="3472129">unmarshal</span><span class="op" id="3472138">(</span><span class="ident" id="3472139">data</span>&nbsp;<span class="op" id="3472144">[</span><span class="op" id="3472145">]</span><span class="builtintype" id="3472146">byte</span><span class="op" id="3472150">)</span>&nbsp;<span class="builtintype" id="3472152">bool</span>&nbsp;<span class="op" id="3472157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472160">if</span>&nbsp;<span class="builtinfunc" id="3472163">len</span><span class="op" id="3472166">(</span><span class="ident" id="3472167">data</span><span class="op" id="3472171">)</span>&nbsp;<span class="op" id="3472173">&lt;</span>&nbsp;<span class="num" id="3472175">8</span>&nbsp;<span class="op" id="3472177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472181">return</span>&nbsp;<span class="builtintype" id="3472188">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472195">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472199">s</span><span class="op" id="3472200">.</span><span class="ident" id="3472201">vers</span>&nbsp;<span class="op" id="3472206">=</span>&nbsp;<span class="builtintype" id="3472208">uint16</span><span class="op" id="3472214">(</span><span class="ident" id="3472215">data</span><span class="op" id="3472219">[</span><span class="num" id="3472220">0</span><span class="op" id="3472221">]</span><span class="op" id="3472222">)</span><span class="op" id="3472223">&lt;&lt;</span><span class="num" id="3472225">8</span>&nbsp;<span class="op" id="3472227">|</span>&nbsp;<span class="builtintype" id="3472229">uint16</span><span class="op" id="3472235">(</span><span class="ident" id="3472236">data</span><span class="op" id="3472240">[</span><span class="num" id="3472241">1</span><span class="op" id="3472242">]</span><span class="op" id="3472243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472246">s</span><span class="op" id="3472247">.</span><span class="ident" id="3472248">cipherSuite</span>&nbsp;<span class="op" id="3472260">=</span>&nbsp;<span class="builtintype" id="3472262">uint16</span><span class="op" id="3472268">(</span><span class="ident" id="3472269">data</span><span class="op" id="3472273">[</span><span class="num" id="3472274">2</span><span class="op" id="3472275">]</span><span class="op" id="3472276">)</span><span class="op" id="3472277">&lt;&lt;</span><span class="num" id="3472279">8</span>&nbsp;<span class="op" id="3472281">|</span>&nbsp;<span class="builtintype" id="3472283">uint16</span><span class="op" id="3472289">(</span><span class="ident" id="3472290">data</span><span class="op" id="3472294">[</span><span class="num" id="3472295">3</span><span class="op" id="3472296">]</span><span class="op" id="3472297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472300">masterSecretLen</span>&nbsp;<span class="op" id="3472316">:=</span>&nbsp;<span class="builtintype" id="3472319">int</span><span class="op" id="3472322">(</span><span class="ident" id="3472323">data</span><span class="op" id="3472327">[</span><span class="num" id="3472328">4</span><span class="op" id="3472329">]</span><span class="op" id="3472330">)</span><span class="op" id="3472331">&lt;&lt;</span><span class="num" id="3472333">8</span>&nbsp;<span class="op" id="3472335">|</span>&nbsp;<span class="builtintype" id="3472337">int</span><span class="op" id="3472340">(</span><span class="ident" id="3472341">data</span><span class="op" id="3472345">[</span><span class="num" id="3472346">5</span><span class="op" id="3472347">]</span><span class="op" id="3472348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472351">data</span>&nbsp;<span class="op" id="3472356">=</span>&nbsp;<span class="ident" id="3472358">data</span><span class="op" id="3472362">[</span><span class="num" id="3472363">6</span><span class="op" id="3472364">:</span><span class="op" id="3472365">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472368">if</span>&nbsp;<span class="builtinfunc" id="3472371">len</span><span class="op" id="3472374">(</span><span class="ident" id="3472375">data</span><span class="op" id="3472379">)</span>&nbsp;<span class="op" id="3472381">&lt;</span>&nbsp;<span class="ident" id="3472383">masterSecretLen</span>&nbsp;<span class="op" id="3472399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472403">return</span>&nbsp;<span class="builtintype" id="3472410">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472421">s</span><span class="op" id="3472422">.</span><span class="ident" id="3472423">masterSecret</span>&nbsp;<span class="op" id="3472436">=</span>&nbsp;<span class="ident" id="3472438">data</span><span class="op" id="3472442">[</span><span class="op" id="3472443">:</span><span class="ident" id="3472444">masterSecretLen</span><span class="op" id="3472459">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472462">data</span>&nbsp;<span class="op" id="3472467">=</span>&nbsp;<span class="ident" id="3472469">data</span><span class="op" id="3472473">[</span><span class="ident" id="3472474">masterSecretLen</span><span class="op" id="3472489">:</span><span class="op" id="3472490">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472494">if</span>&nbsp;<span class="builtinfunc" id="3472497">len</span><span class="op" id="3472500">(</span><span class="ident" id="3472501">data</span><span class="op" id="3472505">)</span>&nbsp;<span class="op" id="3472507">&lt;</span>&nbsp;<span class="num" id="3472509">2</span>&nbsp;<span class="op" id="3472511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472515">return</span>&nbsp;<span class="builtintype" id="3472522">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472529">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472533">numCerts</span>&nbsp;<span class="op" id="3472542">:=</span>&nbsp;<span class="builtintype" id="3472545">int</span><span class="op" id="3472548">(</span><span class="ident" id="3472549">data</span><span class="op" id="3472553">[</span><span class="num" id="3472554">0</span><span class="op" id="3472555">]</span><span class="op" id="3472556">)</span><span class="op" id="3472557">&lt;&lt;</span><span class="num" id="3472559">8</span>&nbsp;<span class="op" id="3472561">|</span>&nbsp;<span class="builtintype" id="3472563">int</span><span class="op" id="3472566">(</span><span class="ident" id="3472567">data</span><span class="op" id="3472571">[</span><span class="num" id="3472572">1</span><span class="op" id="3472573">]</span><span class="op" id="3472574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472577">data</span>&nbsp;<span class="op" id="3472582">=</span>&nbsp;<span class="ident" id="3472584">data</span><span class="op" id="3472588">[</span><span class="num" id="3472589">2</span><span class="op" id="3472590">:</span><span class="op" id="3472591">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472595">s</span><span class="op" id="3472596">.</span><span class="ident" id="3472597">certificates</span>&nbsp;<span class="op" id="3472610">=</span>&nbsp;<span class="builtinfunc" id="3472612">make</span><span class="op" id="3472616">(</span><span class="op" id="3472617">[</span><span class="op" id="3472618">]</span><span class="op" id="3472619">[</span><span class="op" id="3472620">]</span><span class="builtintype" id="3472621">byte</span><span class="op" id="3472625">,</span>&nbsp;<span class="ident" id="3472627">numCerts</span><span class="op" id="3472635">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472638">for</span>&nbsp;<span class="ident" id="3472642">i</span>&nbsp;<span class="op" id="3472644">:=</span>&nbsp;<span class="keyword" id="3472647">range</span>&nbsp;<span class="ident" id="3472653">s</span><span class="op" id="3472654">.</span><span class="ident" id="3472655">certificates</span>&nbsp;<span class="op" id="3472668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472672">if</span>&nbsp;<span class="builtinfunc" id="3472675">len</span><span class="op" id="3472678">(</span><span class="ident" id="3472679">data</span><span class="op" id="3472683">)</span>&nbsp;<span class="op" id="3472685">&lt;</span>&nbsp;<span class="num" id="3472687">4</span>&nbsp;<span class="op" id="3472689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472694">return</span>&nbsp;<span class="builtintype" id="3472701">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472713">certLen</span>&nbsp;<span class="op" id="3472721">:=</span>&nbsp;<span class="builtintype" id="3472724">int</span><span class="op" id="3472727">(</span><span class="ident" id="3472728">data</span><span class="op" id="3472732">[</span><span class="num" id="3472733">0</span><span class="op" id="3472734">]</span><span class="op" id="3472735">)</span><span class="op" id="3472736">&lt;&lt;</span><span class="num" id="3472738">24</span>&nbsp;<span class="op" id="3472741">|</span>&nbsp;<span class="builtintype" id="3472743">int</span><span class="op" id="3472746">(</span><span class="ident" id="3472747">data</span><span class="op" id="3472751">[</span><span class="num" id="3472752">1</span><span class="op" id="3472753">]</span><span class="op" id="3472754">)</span><span class="op" id="3472755">&lt;&lt;</span><span class="num" id="3472757">16</span>&nbsp;<span class="op" id="3472760">|</span>&nbsp;<span class="builtintype" id="3472762">int</span><span class="op" id="3472765">(</span><span class="ident" id="3472766">data</span><span class="op" id="3472770">[</span><span class="num" id="3472771">2</span><span class="op" id="3472772">]</span><span class="op" id="3472773">)</span><span class="op" id="3472774">&lt;&lt;</span><span class="num" id="3472776">8</span>&nbsp;<span class="op" id="3472778">|</span>&nbsp;<span class="builtintype" id="3472780">int</span><span class="op" id="3472783">(</span><span class="ident" id="3472784">data</span><span class="op" id="3472788">[</span><span class="num" id="3472789">3</span><span class="op" id="3472790">]</span><span class="op" id="3472791">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472795">data</span>&nbsp;<span class="op" id="3472800">=</span>&nbsp;<span class="ident" id="3472802">data</span><span class="op" id="3472806">[</span><span class="num" id="3472807">4</span><span class="op" id="3472808">:</span><span class="op" id="3472809">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472813">if</span>&nbsp;<span class="ident" id="3472816">certLen</span>&nbsp;<span class="op" id="3472824">&lt;</span>&nbsp;<span class="num" id="3472826">0</span>&nbsp;<span class="op" id="3472828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472833">return</span>&nbsp;<span class="builtintype" id="3472840">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472852">if</span>&nbsp;<span class="builtinfunc" id="3472855">len</span><span class="op" id="3472858">(</span><span class="ident" id="3472859">data</span><span class="op" id="3472863">)</span>&nbsp;<span class="op" id="3472865">&lt;</span>&nbsp;<span class="ident" id="3472867">certLen</span>&nbsp;<span class="op" id="3472875">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472880">return</span>&nbsp;<span class="builtintype" id="3472887">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472899">s</span><span class="op" id="3472900">.</span><span class="ident" id="3472901">certificates</span><span class="op" id="3472913">[</span><span class="ident" id="3472914">i</span><span class="op" id="3472915">]</span>&nbsp;<span class="op" id="3472917">=</span>&nbsp;<span class="ident" id="3472919">data</span><span class="op" id="3472923">[</span><span class="op" id="3472924">:</span><span class="ident" id="3472925">certLen</span><span class="op" id="3472932">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3472936">data</span>&nbsp;<span class="op" id="3472941">=</span>&nbsp;<span class="ident" id="3472943">data</span><span class="op" id="3472947">[</span><span class="ident" id="3472948">certLen</span><span class="op" id="3472955">:</span><span class="op" id="3472956">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472959">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472963">if</span>&nbsp;<span class="builtinfunc" id="3472966">len</span><span class="op" id="3472969">(</span><span class="ident" id="3472970">data</span><span class="op" id="3472974">)</span>&nbsp;<span class="op" id="3472976">&gt;</span>&nbsp;<span class="num" id="3472978">0</span>&nbsp;<span class="op" id="3472980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3472984">return</span>&nbsp;<span class="builtintype" id="3472991">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3472998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473002">return</span>&nbsp;<span class="builtintype" id="3473009">true</span><br>
<span class="lineno"></span><span class="op" id="3473014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3473017">func</span>&nbsp;<span class="op" id="3473022">(</span><span class="ident" id="3473023">c</span>&nbsp;<span class="op" id="3473025">*</span><span class="ident" id="3473026">Conn</span><span class="op" id="3473030">)</span>&nbsp;<span class="ident" id="3473032">encryptTicket</span><span class="op" id="3473045">(</span><span class="ident" id="3473046">state</span>&nbsp;<span class="op" id="3473052">*</span><span class="ident" id="3473053">sessionState</span><span class="op" id="3473065">)</span>&nbsp;<span class="op" id="3473067">(</span><span class="op" id="3473068">[</span><span class="op" id="3473069">]</span><span class="builtintype" id="3473070">byte</span><span class="op" id="3473074">,</span>&nbsp;<span class="builtintype" id="3473076">error</span><span class="op" id="3473081">)</span>&nbsp;<span class="op" id="3473083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473086">serialized</span>&nbsp;<span class="op" id="3473097">:=</span>&nbsp;<span class="ident" id="3473100">state</span><span class="op" id="3473105">.</span><span class="ident" id="3473106">marshal</span><span class="op" id="3473113">(</span><span class="op" id="3473114">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473117">encrypted</span>&nbsp;<span class="op" id="3473127">:=</span>&nbsp;<span class="builtinfunc" id="3473130">make</span><span class="op" id="3473134">(</span><span class="op" id="3473135">[</span><span class="op" id="3473136">]</span><span class="builtintype" id="3473137">byte</span><span class="op" id="3473141">,</span>&nbsp;<span class="ident" id="3473143">aes</span><span class="op" id="3473146">.</span><span class="ident" id="3473147">BlockSize</span><span class="op" id="3473156">+</span><span class="builtinfunc" id="3473157">len</span><span class="op" id="3473160">(</span><span class="ident" id="3473161">serialized</span><span class="op" id="3473171">)</span><span class="op" id="3473172">+</span><span class="ident" id="3473173">sha256</span><span class="op" id="3473179">.</span><span class="ident" id="3473180">Size</span><span class="op" id="3473184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473187">iv</span>&nbsp;<span class="op" id="3473190">:=</span>&nbsp;<span class="ident" id="3473193">encrypted</span><span class="op" id="3473202">[</span><span class="op" id="3473203">:</span><span class="ident" id="3473204">aes</span><span class="op" id="3473207">.</span><span class="ident" id="3473208">BlockSize</span><span class="op" id="3473217">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473220">macBytes</span>&nbsp;<span class="op" id="3473229">:=</span>&nbsp;<span class="ident" id="3473232">encrypted</span><span class="op" id="3473241">[</span><span class="builtinfunc" id="3473242">len</span><span class="op" id="3473245">(</span><span class="ident" id="3473246">encrypted</span><span class="op" id="3473255">)</span><span class="op" id="3473256">-</span><span class="ident" id="3473257">sha256</span><span class="op" id="3473263">.</span><span class="ident" id="3473264">Size</span><span class="op" id="3473268">:</span><span class="op" id="3473269">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473273">if</span>&nbsp;<span class="ident" id="3473276">_</span><span class="op" id="3473277">,</span>&nbsp;<span class="ident" id="3473279">err</span>&nbsp;<span class="op" id="3473283">:=</span>&nbsp;<span class="ident" id="3473286">io</span><span class="op" id="3473288">.</span><span class="ident" id="3473289">ReadFull</span><span class="op" id="3473297">(</span><span class="ident" id="3473298">c</span><span class="op" id="3473299">.</span><span class="ident" id="3473300">config</span><span class="op" id="3473306">.</span><span class="ident" id="3473307">rand</span><span class="op" id="3473311">(</span><span class="op" id="3473312">)</span><span class="op" id="3473313">,</span>&nbsp;<span class="ident" id="3473315">iv</span><span class="op" id="3473317">)</span><span class="op" id="3473318">;</span>&nbsp;<span class="ident" id="3473320">err</span>&nbsp;<span class="op" id="3473324">!=</span>&nbsp;<span class="ident" id="3473327">nil</span>&nbsp;<span class="op" id="3473331">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473335">return</span>&nbsp;<span class="ident" id="3473342">nil</span><span class="op" id="3473345">,</span>&nbsp;<span class="ident" id="3473347">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473355">block</span><span class="op" id="3473360">,</span>&nbsp;<span class="ident" id="3473362">err</span>&nbsp;<span class="op" id="3473366">:=</span>&nbsp;<span class="ident" id="3473369">aes</span><span class="op" id="3473372">.</span><span class="ident" id="3473373">NewCipher</span><span class="op" id="3473382">(</span><span class="ident" id="3473383">c</span><span class="op" id="3473384">.</span><span class="ident" id="3473385">config</span><span class="op" id="3473391">.</span><span class="ident" id="3473392">SessionTicketKey</span><span class="op" id="3473408">[</span><span class="op" id="3473409">:</span><span class="num" id="3473410">16</span><span class="op" id="3473412">]</span><span class="op" id="3473413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473416">if</span>&nbsp;<span class="ident" id="3473419">err</span>&nbsp;<span class="op" id="3473423">!=</span>&nbsp;<span class="ident" id="3473426">nil</span>&nbsp;<span class="op" id="3473430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473434">return</span>&nbsp;<span class="ident" id="3473441">nil</span><span class="op" id="3473444">,</span>&nbsp;<span class="ident" id="3473446">errors</span><span class="op" id="3473452">.</span><span class="ident" id="3473453">New</span><span class="op" id="3473456">(</span><span class="string" id="3473457">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="3473514">+</span>&nbsp;<span class="ident" id="3473516">err</span><span class="op" id="3473519">.</span><span class="ident" id="3473520">Error</span><span class="op" id="3473525">(</span><span class="op" id="3473526">)</span><span class="op" id="3473527">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473533">cipher</span><span class="op" id="3473539">.</span><span class="ident" id="3473540">NewCTR</span><span class="op" id="3473546">(</span><span class="ident" id="3473547">block</span><span class="op" id="3473552">,</span>&nbsp;<span class="ident" id="3473554">iv</span><span class="op" id="3473556">)</span><span class="op" id="3473557">.</span><span class="ident" id="3473558">XORKeyStream</span><span class="op" id="3473570">(</span><span class="ident" id="3473571">encrypted</span><span class="op" id="3473580">[</span><span class="ident" id="3473581">aes</span><span class="op" id="3473584">.</span><span class="ident" id="3473585">BlockSize</span><span class="op" id="3473594">:</span><span class="op" id="3473595">]</span><span class="op" id="3473596">,</span>&nbsp;<span class="ident" id="3473598">serialized</span><span class="op" id="3473608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473612">mac</span>&nbsp;<span class="op" id="3473616">:=</span>&nbsp;<span class="ident" id="3473619">hmac</span><span class="op" id="3473623">.</span><span class="ident" id="3473624">New</span><span class="op" id="3473627">(</span><span class="ident" id="3473628">sha256</span><span class="op" id="3473634">.</span><span class="ident" id="3473635">New</span><span class="op" id="3473638">,</span>&nbsp;<span class="ident" id="3473640">c</span><span class="op" id="3473641">.</span><span class="ident" id="3473642">config</span><span class="op" id="3473648">.</span><span class="ident" id="3473649">SessionTicketKey</span><span class="op" id="3473665">[</span><span class="num" id="3473666">16</span><span class="op" id="3473668">:</span><span class="num" id="3473669">32</span><span class="op" id="3473671">]</span><span class="op" id="3473672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473675">mac</span><span class="op" id="3473678">.</span><span class="ident" id="3473679">Write</span><span class="op" id="3473684">(</span><span class="ident" id="3473685">encrypted</span><span class="op" id="3473694">[</span><span class="op" id="3473695">:</span><span class="builtinfunc" id="3473696">len</span><span class="op" id="3473699">(</span><span class="ident" id="3473700">encrypted</span><span class="op" id="3473709">)</span><span class="op" id="3473710">-</span><span class="ident" id="3473711">sha256</span><span class="op" id="3473717">.</span><span class="ident" id="3473718">Size</span><span class="op" id="3473722">]</span><span class="op" id="3473723">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473726">mac</span><span class="op" id="3473729">.</span><span class="ident" id="3473730">Sum</span><span class="op" id="3473733">(</span><span class="ident" id="3473734">macBytes</span><span class="op" id="3473742">[</span><span class="op" id="3473743">:</span><span class="num" id="3473744">0</span><span class="op" id="3473745">]</span><span class="op" id="3473746">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473750">return</span>&nbsp;<span class="ident" id="3473757">encrypted</span><span class="op" id="3473766">,</span>&nbsp;<span class="ident" id="3473768">nil</span><br>
<span class="lineno"></span><span class="op" id="3473772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="3473775">func</span>&nbsp;<span class="op" id="3473780">(</span><span class="ident" id="3473781">c</span>&nbsp;<span class="op" id="3473783">*</span><span class="ident" id="3473784">Conn</span><span class="op" id="3473788">)</span>&nbsp;<span class="ident" id="3473790">decryptTicket</span><span class="op" id="3473803">(</span><span class="ident" id="3473804">encrypted</span>&nbsp;<span class="op" id="3473814">[</span><span class="op" id="3473815">]</span><span class="builtintype" id="3473816">byte</span><span class="op" id="3473820">)</span>&nbsp;<span class="op" id="3473822">(</span><span class="op" id="3473823">*</span><span class="ident" id="3473824">sessionState</span><span class="op" id="3473836">,</span>&nbsp;<span class="builtintype" id="3473838">bool</span><span class="op" id="3473842">)</span>&nbsp;<span class="op" id="3473844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473847">if</span>&nbsp;<span class="ident" id="3473850">c</span><span class="op" id="3473851">.</span><span class="ident" id="3473852">config</span><span class="op" id="3473858">.</span><span class="ident" id="3473859">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3473882">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3473887">len</span><span class="op" id="3473890">(</span><span class="ident" id="3473891">encrypted</span><span class="op" id="3473900">)</span>&nbsp;<span class="op" id="3473902">&lt;</span>&nbsp;<span class="ident" id="3473904">aes</span><span class="op" id="3473907">.</span><span class="ident" id="3473908">BlockSize</span><span class="op" id="3473917">+</span><span class="ident" id="3473918">sha256</span><span class="op" id="3473924">.</span><span class="ident" id="3473925">Size</span>&nbsp;<span class="op" id="3473930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3473934">return</span>&nbsp;<span class="ident" id="3473941">nil</span><span class="op" id="3473944">,</span>&nbsp;<span class="builtintype" id="3473946">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3473953">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473957">iv</span>&nbsp;<span class="op" id="3473960">:=</span>&nbsp;<span class="ident" id="3473963">encrypted</span><span class="op" id="3473972">[</span><span class="op" id="3473973">:</span><span class="ident" id="3473974">aes</span><span class="op" id="3473977">.</span><span class="ident" id="3473978">BlockSize</span><span class="op" id="3473987">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3473990">macBytes</span>&nbsp;<span class="op" id="3473999">:=</span>&nbsp;<span class="ident" id="3474002">encrypted</span><span class="op" id="3474011">[</span><span class="builtinfunc" id="3474012">len</span><span class="op" id="3474015">(</span><span class="ident" id="3474016">encrypted</span><span class="op" id="3474025">)</span><span class="op" id="3474026">-</span><span class="ident" id="3474027">sha256</span><span class="op" id="3474033">.</span><span class="ident" id="3474034">Size</span><span class="op" id="3474038">:</span><span class="op" id="3474039">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474043">mac</span>&nbsp;<span class="op" id="3474047">:=</span>&nbsp;<span class="ident" id="3474050">hmac</span><span class="op" id="3474054">.</span><span class="ident" id="3474055">New</span><span class="op" id="3474058">(</span><span class="ident" id="3474059">sha256</span><span class="op" id="3474065">.</span><span class="ident" id="3474066">New</span><span class="op" id="3474069">,</span>&nbsp;<span class="ident" id="3474071">c</span><span class="op" id="3474072">.</span><span class="ident" id="3474073">config</span><span class="op" id="3474079">.</span><span class="ident" id="3474080">SessionTicketKey</span><span class="op" id="3474096">[</span><span class="num" id="3474097">16</span><span class="op" id="3474099">:</span><span class="num" id="3474100">32</span><span class="op" id="3474102">]</span><span class="op" id="3474103">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474106">mac</span><span class="op" id="3474109">.</span><span class="ident" id="3474110">Write</span><span class="op" id="3474115">(</span><span class="ident" id="3474116">encrypted</span><span class="op" id="3474125">[</span><span class="op" id="3474126">:</span><span class="builtinfunc" id="3474127">len</span><span class="op" id="3474130">(</span><span class="ident" id="3474131">encrypted</span><span class="op" id="3474140">)</span><span class="op" id="3474141">-</span><span class="ident" id="3474142">sha256</span><span class="op" id="3474148">.</span><span class="ident" id="3474149">Size</span><span class="op" id="3474153">]</span><span class="op" id="3474154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474157">expected</span>&nbsp;<span class="op" id="3474166">:=</span>&nbsp;<span class="ident" id="3474169">mac</span><span class="op" id="3474172">.</span><span class="ident" id="3474173">Sum</span><span class="op" id="3474176">(</span><span class="ident" id="3474177">nil</span><span class="op" id="3474180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474184">if</span>&nbsp;<span class="ident" id="3474187">subtle</span><span class="op" id="3474193">.</span><span class="ident" id="3474194">ConstantTimeCompare</span><span class="op" id="3474213">(</span><span class="ident" id="3474214">macBytes</span><span class="op" id="3474222">,</span>&nbsp;<span class="ident" id="3474224">expected</span><span class="op" id="3474232">)</span>&nbsp;<span class="op" id="3474234">!=</span>&nbsp;<span class="num" id="3474237">1</span>&nbsp;<span class="op" id="3474239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474243">return</span>&nbsp;<span class="ident" id="3474250">nil</span><span class="op" id="3474253">,</span>&nbsp;<span class="builtintype" id="3474255">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3474262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474266">block</span><span class="op" id="3474271">,</span>&nbsp;<span class="ident" id="3474273">err</span>&nbsp;<span class="op" id="3474277">:=</span>&nbsp;<span class="ident" id="3474280">aes</span><span class="op" id="3474283">.</span><span class="ident" id="3474284">NewCipher</span><span class="op" id="3474293">(</span><span class="ident" id="3474294">c</span><span class="op" id="3474295">.</span><span class="ident" id="3474296">config</span><span class="op" id="3474302">.</span><span class="ident" id="3474303">SessionTicketKey</span><span class="op" id="3474319">[</span><span class="op" id="3474320">:</span><span class="num" id="3474321">16</span><span class="op" id="3474323">]</span><span class="op" id="3474324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474327">if</span>&nbsp;<span class="ident" id="3474330">err</span>&nbsp;<span class="op" id="3474334">!=</span>&nbsp;<span class="ident" id="3474337">nil</span>&nbsp;<span class="op" id="3474341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474345">return</span>&nbsp;<span class="ident" id="3474352">nil</span><span class="op" id="3474355">,</span>&nbsp;<span class="builtintype" id="3474357">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3474364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474367">ciphertext</span>&nbsp;<span class="op" id="3474378">:=</span>&nbsp;<span class="ident" id="3474381">encrypted</span><span class="op" id="3474390">[</span><span class="ident" id="3474391">aes</span><span class="op" id="3474394">.</span><span class="ident" id="3474395">BlockSize</span>&nbsp;<span class="op" id="3474405">:</span>&nbsp;<span class="builtinfunc" id="3474407">len</span><span class="op" id="3474410">(</span><span class="ident" id="3474411">encrypted</span><span class="op" id="3474420">)</span><span class="op" id="3474421">-</span><span class="ident" id="3474422">sha256</span><span class="op" id="3474428">.</span><span class="ident" id="3474429">Size</span><span class="op" id="3474433">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474436">plaintext</span>&nbsp;<span class="op" id="3474446">:=</span>&nbsp;<span class="ident" id="3474449">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474461">cipher</span><span class="op" id="3474467">.</span><span class="ident" id="3474468">NewCTR</span><span class="op" id="3474474">(</span><span class="ident" id="3474475">block</span><span class="op" id="3474480">,</span>&nbsp;<span class="ident" id="3474482">iv</span><span class="op" id="3474484">)</span><span class="op" id="3474485">.</span><span class="ident" id="3474486">XORKeyStream</span><span class="op" id="3474498">(</span><span class="ident" id="3474499">plaintext</span><span class="op" id="3474508">,</span>&nbsp;<span class="ident" id="3474510">ciphertext</span><span class="op" id="3474520">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474524">state</span>&nbsp;<span class="op" id="3474530">:=</span>&nbsp;<span class="builtinfunc" id="3474533">new</span><span class="op" id="3474536">(</span><span class="ident" id="3474537">sessionState</span><span class="op" id="3474549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3474552">ok</span>&nbsp;<span class="op" id="3474555">:=</span>&nbsp;<span class="ident" id="3474558">state</span><span class="op" id="3474563">.</span><span class="ident" id="3474564">unmarshal</span><span class="op" id="3474573">(</span><span class="ident" id="3474574">plaintext</span><span class="op" id="3474583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3474586">return</span>&nbsp;<span class="ident" id="3474593">state</span><span class="op" id="3474598">,</span>&nbsp;<span class="ident" id="3474600">ok</span><br>
<span class="lineno"></span><span class="op" id="3474603">}</span>
</div>
</body>
</html>
