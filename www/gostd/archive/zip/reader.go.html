<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6045474">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6045529">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6045583">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6045634">package</span>&nbsp;<span class="ident" id="6045642">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045647">import</span>&nbsp;<span class="op" id="6045654">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045657">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045666">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045685">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045695">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045703">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045717">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6045723">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6045728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045731">var</span>&nbsp;<span class="op" id="6045735">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045738">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045751">=</span>&nbsp;<span class="ident" id="6045753">errors</span><span class="op" id="6045759">.</span><span class="ident" id="6045760">New</span><span class="op" id="6045763">(</span><span class="string" id="6045764">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6045791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045794">ErrAlgorithm</span>&nbsp;<span class="op" id="6045807">=</span>&nbsp;<span class="ident" id="6045809">errors</span><span class="op" id="6045815">.</span><span class="ident" id="6045816">New</span><span class="op" id="6045819">(</span><span class="string" id="6045820">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6045860">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045863">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6045876">=</span>&nbsp;<span class="ident" id="6045878">errors</span><span class="op" id="6045884">.</span><span class="ident" id="6045885">New</span><span class="op" id="6045888">(</span><span class="string" id="6045889">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6045910">)</span><br>
<span class="lineno"></span><span class="op" id="6045912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045915">type</span>&nbsp;<span class="ident" id="6045920">Reader</span>&nbsp;<span class="keyword" id="6045927">struct</span>&nbsp;<span class="op" id="6045934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045937">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6045945">io</span><span class="op" id="6045947">.</span><span class="ident" id="6045948">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045958">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6045966">[</span><span class="op" id="6045967">]</span><span class="op" id="6045968">*</span><span class="ident" id="6045969">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6045975">Comment</span>&nbsp;<span class="builtintype" id="6045983">string</span><br>
<span class="lineno"></span><span class="op" id="6045990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6045993">type</span>&nbsp;<span class="ident" id="6045998">ReadCloser</span>&nbsp;<span class="keyword" id="6046009">struct</span>&nbsp;<span class="op" id="6046016">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046019">f</span>&nbsp;<span class="op" id="6046021">*</span><span class="ident" id="6046022">os</span><span class="op" id="6046024">.</span><span class="ident" id="6046025">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046031">Reader</span><br>
<span class="lineno"></span><span class="op" id="6046038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6046041">type</span>&nbsp;<span class="ident" id="6046046">File</span>&nbsp;<span class="keyword" id="6046051">struct</span>&nbsp;<span class="op" id="6046058">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046061">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046073">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046086">io</span><span class="op" id="6046088">.</span><span class="ident" id="6046089">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046099">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046112">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046119">headerOffset</span>&nbsp;<span class="ident" id="6046132">int64</span><br>
<span class="lineno"></span><span class="op" id="6046138">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6046141">func</span>&nbsp;<span class="op" id="6046146">(</span><span class="ident" id="6046147">f</span>&nbsp;<span class="op" id="6046149">*</span><span class="ident" id="6046150">File</span><span class="op" id="6046154">)</span>&nbsp;<span class="ident" id="6046156">hasDataDescriptor</span><span class="op" id="6046173">(</span><span class="op" id="6046174">)</span>&nbsp;<span class="builtintype" id="6046176">bool</span>&nbsp;<span class="op" id="6046181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046184">return</span>&nbsp;<span class="ident" id="6046191">f</span><span class="op" id="6046192">.</span><span class="ident" id="6046193">Flags</span><span class="op" id="6046198">&amp;</span><span class="num" id="6046199">0x8</span>&nbsp;<span class="op" id="6046203">!=</span>&nbsp;<span class="num" id="6046206">0</span><br>
<span class="lineno"></span><span class="op" id="6046208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6046211">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6046291">func</span>&nbsp;<span class="ident" id="6046296">OpenReader</span><span class="op" id="6046306">(</span><span class="ident" id="6046307">name</span>&nbsp;<span class="builtintype" id="6046312">string</span><span class="op" id="6046318">)</span>&nbsp;<span class="op" id="6046320">(</span><span class="op" id="6046321">*</span><span class="ident" id="6046322">ReadCloser</span><span class="op" id="6046332">,</span>&nbsp;<span class="builtintype" id="6046334">error</span><span class="op" id="6046339">)</span>&nbsp;<span class="op" id="6046341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046344">f</span><span class="op" id="6046345">,</span>&nbsp;<span class="ident" id="6046347">err</span>&nbsp;<span class="op" id="6046351">:=</span>&nbsp;<span class="ident" id="6046354">os</span><span class="op" id="6046356">.</span><span class="ident" id="6046357">Open</span><span class="op" id="6046361">(</span><span class="ident" id="6046362">name</span><span class="op" id="6046366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046369">if</span>&nbsp;<span class="ident" id="6046372">err</span>&nbsp;<span class="op" id="6046376">!=</span>&nbsp;<span class="ident" id="6046379">nil</span>&nbsp;<span class="op" id="6046383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046387">return</span>&nbsp;<span class="ident" id="6046394">nil</span><span class="op" id="6046397">,</span>&nbsp;<span class="ident" id="6046399">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6046404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046407">fi</span><span class="op" id="6046409">,</span>&nbsp;<span class="ident" id="6046411">err</span>&nbsp;<span class="op" id="6046415">:=</span>&nbsp;<span class="ident" id="6046418">f</span><span class="op" id="6046419">.</span><span class="ident" id="6046420">Stat</span><span class="op" id="6046424">(</span><span class="op" id="6046425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046428">if</span>&nbsp;<span class="ident" id="6046431">err</span>&nbsp;<span class="op" id="6046435">!=</span>&nbsp;<span class="ident" id="6046438">nil</span>&nbsp;<span class="op" id="6046442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046446">f</span><span class="op" id="6046447">.</span><span class="ident" id="6046448">Close</span><span class="op" id="6046453">(</span><span class="op" id="6046454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046458">return</span>&nbsp;<span class="ident" id="6046465">nil</span><span class="op" id="6046468">,</span>&nbsp;<span class="ident" id="6046470">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6046475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046478">r</span>&nbsp;<span class="op" id="6046480">:=</span>&nbsp;<span class="builtinfunc" id="6046483">new</span><span class="op" id="6046486">(</span><span class="ident" id="6046487">ReadCloser</span><span class="op" id="6046497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046500">if</span>&nbsp;<span class="ident" id="6046503">err</span>&nbsp;<span class="op" id="6046507">:=</span>&nbsp;<span class="ident" id="6046510">r</span><span class="op" id="6046511">.</span><span class="ident" id="6046512">init</span><span class="op" id="6046516">(</span><span class="ident" id="6046517">f</span><span class="op" id="6046518">,</span>&nbsp;<span class="ident" id="6046520">fi</span><span class="op" id="6046522">.</span><span class="ident" id="6046523">Size</span><span class="op" id="6046527">(</span><span class="op" id="6046528">)</span><span class="op" id="6046529">)</span><span class="op" id="6046530">;</span>&nbsp;<span class="ident" id="6046532">err</span>&nbsp;<span class="op" id="6046536">!=</span>&nbsp;<span class="ident" id="6046539">nil</span>&nbsp;<span class="op" id="6046543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046547">f</span><span class="op" id="6046548">.</span><span class="ident" id="6046549">Close</span><span class="op" id="6046554">(</span><span class="op" id="6046555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046559">return</span>&nbsp;<span class="ident" id="6046566">nil</span><span class="op" id="6046569">,</span>&nbsp;<span class="ident" id="6046571">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6046576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046579">r</span><span class="op" id="6046580">.</span><span class="ident" id="6046581">f</span>&nbsp;<span class="op" id="6046583">=</span>&nbsp;<span class="ident" id="6046585">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046588">return</span>&nbsp;<span class="ident" id="6046595">r</span><span class="op" id="6046596">,</span>&nbsp;<span class="ident" id="6046598">nil</span><br>
<span class="lineno"></span><span class="op" id="6046602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6046605">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6046675">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6046708">func</span>&nbsp;<span class="ident" id="6046713">NewReader</span><span class="op" id="6046722">(</span><span class="ident" id="6046723">r</span>&nbsp;<span class="ident" id="6046725">io</span><span class="op" id="6046727">.</span><span class="ident" id="6046728">ReaderAt</span><span class="op" id="6046736">,</span>&nbsp;<span class="ident" id="6046738">size</span>&nbsp;<span class="ident" id="6046743">int64</span><span class="op" id="6046748">)</span>&nbsp;<span class="op" id="6046750">(</span><span class="op" id="6046751">*</span><span class="ident" id="6046752">Reader</span><span class="op" id="6046758">,</span>&nbsp;<span class="builtintype" id="6046760">error</span><span class="op" id="6046765">)</span>&nbsp;<span class="op" id="6046767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046770">zr</span>&nbsp;<span class="op" id="6046773">:=</span>&nbsp;<span class="builtinfunc" id="6046776">new</span><span class="op" id="6046779">(</span><span class="ident" id="6046780">Reader</span><span class="op" id="6046786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046789">if</span>&nbsp;<span class="ident" id="6046792">err</span>&nbsp;<span class="op" id="6046796">:=</span>&nbsp;<span class="ident" id="6046799">zr</span><span class="op" id="6046801">.</span><span class="ident" id="6046802">init</span><span class="op" id="6046806">(</span><span class="ident" id="6046807">r</span><span class="op" id="6046808">,</span>&nbsp;<span class="ident" id="6046810">size</span><span class="op" id="6046814">)</span><span class="op" id="6046815">;</span>&nbsp;<span class="ident" id="6046817">err</span>&nbsp;<span class="op" id="6046821">!=</span>&nbsp;<span class="ident" id="6046824">nil</span>&nbsp;<span class="op" id="6046828">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046832">return</span>&nbsp;<span class="ident" id="6046839">nil</span><span class="op" id="6046842">,</span>&nbsp;<span class="ident" id="6046844">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6046849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046852">return</span>&nbsp;<span class="ident" id="6046859">zr</span><span class="op" id="6046861">,</span>&nbsp;<span class="ident" id="6046863">nil</span><br>
<span class="lineno"></span><span class="op" id="6046867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6046870">func</span>&nbsp;<span class="op" id="6046875">(</span><span class="ident" id="6046876">z</span>&nbsp;<span class="op" id="6046878">*</span><span class="ident" id="6046879">Reader</span><span class="op" id="6046885">)</span>&nbsp;<span class="ident" id="6046887">init</span><span class="op" id="6046891">(</span><span class="ident" id="6046892">r</span>&nbsp;<span class="ident" id="6046894">io</span><span class="op" id="6046896">.</span><span class="ident" id="6046897">ReaderAt</span><span class="op" id="6046905">,</span>&nbsp;<span class="ident" id="6046907">size</span>&nbsp;<span class="ident" id="6046912">int64</span><span class="op" id="6046917">)</span>&nbsp;<span class="builtintype" id="6046919">error</span>&nbsp;<span class="op" id="6046925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6046928">end</span><span class="op" id="6046931">,</span>&nbsp;<span class="ident" id="6046933">err</span>&nbsp;<span class="op" id="6046937">:=</span>&nbsp;<span class="ident" id="6046940">readDirectoryEnd</span><span class="op" id="6046956">(</span><span class="ident" id="6046957">r</span><span class="op" id="6046958">,</span>&nbsp;<span class="ident" id="6046960">size</span><span class="op" id="6046964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046967">if</span>&nbsp;<span class="ident" id="6046970">err</span>&nbsp;<span class="op" id="6046974">!=</span>&nbsp;<span class="ident" id="6046977">nil</span>&nbsp;<span class="op" id="6046981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6046985">return</span>&nbsp;<span class="ident" id="6046992">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6046997">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047000">z</span><span class="op" id="6047001">.</span><span class="ident" id="6047002">r</span>&nbsp;<span class="op" id="6047004">=</span>&nbsp;<span class="ident" id="6047006">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047009">z</span><span class="op" id="6047010">.</span><span class="ident" id="6047011">File</span>&nbsp;<span class="op" id="6047016">=</span>&nbsp;<span class="builtinfunc" id="6047018">make</span><span class="op" id="6047022">(</span><span class="op" id="6047023">[</span><span class="op" id="6047024">]</span><span class="op" id="6047025">*</span><span class="ident" id="6047026">File</span><span class="op" id="6047030">,</span>&nbsp;<span class="num" id="6047032">0</span><span class="op" id="6047033">,</span>&nbsp;<span class="ident" id="6047035">end</span><span class="op" id="6047038">.</span><span class="ident" id="6047039">directoryRecords</span><span class="op" id="6047055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047058">z</span><span class="op" id="6047059">.</span><span class="ident" id="6047060">Comment</span>&nbsp;<span class="op" id="6047068">=</span>&nbsp;<span class="ident" id="6047070">end</span><span class="op" id="6047073">.</span><span class="ident" id="6047074">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047083">rs</span>&nbsp;<span class="op" id="6047086">:=</span>&nbsp;<span class="ident" id="6047089">io</span><span class="op" id="6047091">.</span><span class="ident" id="6047092">NewSectionReader</span><span class="op" id="6047108">(</span><span class="ident" id="6047109">r</span><span class="op" id="6047110">,</span>&nbsp;<span class="num" id="6047112">0</span><span class="op" id="6047113">,</span>&nbsp;<span class="ident" id="6047115">size</span><span class="op" id="6047119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047122">if</span>&nbsp;<span class="ident" id="6047125">_</span><span class="op" id="6047126">,</span>&nbsp;<span class="ident" id="6047128">err</span>&nbsp;<span class="op" id="6047132">=</span>&nbsp;<span class="ident" id="6047134">rs</span><span class="op" id="6047136">.</span><span class="ident" id="6047137">Seek</span><span class="op" id="6047141">(</span><span class="ident" id="6047142">int64</span><span class="op" id="6047147">(</span><span class="ident" id="6047148">end</span><span class="op" id="6047151">.</span><span class="ident" id="6047152">directoryOffset</span><span class="op" id="6047167">)</span><span class="op" id="6047168">,</span>&nbsp;<span class="ident" id="6047170">os</span><span class="op" id="6047172">.</span><span class="ident" id="6047173">SEEK_SET</span><span class="op" id="6047181">)</span><span class="op" id="6047182">;</span>&nbsp;<span class="ident" id="6047184">err</span>&nbsp;<span class="op" id="6047188">!=</span>&nbsp;<span class="ident" id="6047191">nil</span>&nbsp;<span class="op" id="6047195">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047199">return</span>&nbsp;<span class="ident" id="6047206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6047211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047214">buf</span>&nbsp;<span class="op" id="6047218">:=</span>&nbsp;<span class="ident" id="6047221">bufio</span><span class="op" id="6047226">.</span><span class="ident" id="6047227">NewReader</span><span class="op" id="6047236">(</span><span class="ident" id="6047237">rs</span><span class="op" id="6047239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6047243">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6047312">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6047370">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6047438">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047484">for</span>&nbsp;<span class="op" id="6047488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047492">f</span>&nbsp;<span class="op" id="6047494">:=</span>&nbsp;<span class="op" id="6047497">&amp;</span><span class="ident" id="6047498">File</span><span class="op" id="6047502">{</span><span class="ident" id="6047503">zipr</span><span class="op" id="6047507">:</span>&nbsp;<span class="ident" id="6047509">r</span><span class="op" id="6047510">,</span>&nbsp;<span class="ident" id="6047512">zipsize</span><span class="op" id="6047519">:</span>&nbsp;<span class="ident" id="6047521">size</span><span class="op" id="6047525">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047529">err</span>&nbsp;<span class="op" id="6047533">=</span>&nbsp;<span class="ident" id="6047535">readDirectoryHeader</span><span class="op" id="6047554">(</span><span class="ident" id="6047555">f</span><span class="op" id="6047556">,</span>&nbsp;<span class="ident" id="6047558">buf</span><span class="op" id="6047561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047565">if</span>&nbsp;<span class="ident" id="6047568">err</span>&nbsp;<span class="op" id="6047572">==</span>&nbsp;<span class="ident" id="6047575">ErrFormat</span>&nbsp;<span class="op" id="6047585">||</span>&nbsp;<span class="ident" id="6047588">err</span>&nbsp;<span class="op" id="6047592">==</span>&nbsp;<span class="ident" id="6047595">io</span><span class="op" id="6047597">.</span><span class="ident" id="6047598">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6047615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047620">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6047628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047632">if</span>&nbsp;<span class="ident" id="6047635">err</span>&nbsp;<span class="op" id="6047639">!=</span>&nbsp;<span class="ident" id="6047642">nil</span>&nbsp;<span class="op" id="6047646">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047651">return</span>&nbsp;<span class="ident" id="6047658">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6047664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6047668">z</span><span class="op" id="6047669">.</span><span class="ident" id="6047670">File</span>&nbsp;<span class="op" id="6047675">=</span>&nbsp;<span class="builtinfunc" id="6047677">append</span><span class="op" id="6047683">(</span><span class="ident" id="6047684">z</span><span class="op" id="6047685">.</span><span class="ident" id="6047686">File</span><span class="op" id="6047690">,</span>&nbsp;<span class="ident" id="6047692">f</span><span class="op" id="6047693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6047696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047699">if</span>&nbsp;<span class="builtintype" id="6047702">uint16</span><span class="op" id="6047708">(</span><span class="builtinfunc" id="6047709">len</span><span class="op" id="6047712">(</span><span class="ident" id="6047713">z</span><span class="op" id="6047714">.</span><span class="ident" id="6047715">File</span><span class="op" id="6047719">)</span><span class="op" id="6047720">)</span>&nbsp;<span class="op" id="6047722">!=</span>&nbsp;<span class="builtintype" id="6047725">uint16</span><span class="op" id="6047731">(</span><span class="ident" id="6047732">end</span><span class="op" id="6047735">.</span><span class="ident" id="6047736">directoryRecords</span><span class="op" id="6047752">)</span>&nbsp;<span class="op" id="6047754">{</span>&nbsp;<span class="comment" id="6047756">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6047787">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6047840">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047884">return</span>&nbsp;<span class="ident" id="6047891">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6047896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6047899">return</span>&nbsp;<span class="ident" id="6047906">nil</span><br>
<span class="lineno">110</span><span class="op" id="6047910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6047913">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6047974">func</span>&nbsp;<span class="op" id="6047979">(</span><span class="ident" id="6047980">rc</span>&nbsp;<span class="op" id="6047983">*</span><span class="ident" id="6047984">ReadCloser</span><span class="op" id="6047994">)</span>&nbsp;<span class="ident" id="6047996">Close</span><span class="op" id="6048001">(</span><span class="op" id="6048002">)</span>&nbsp;<span class="builtintype" id="6048004">error</span>&nbsp;<span class="op" id="6048010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048013">return</span>&nbsp;<span class="ident" id="6048020">rc</span><span class="op" id="6048022">.</span><span class="ident" id="6048023">f</span><span class="op" id="6048024">.</span><span class="ident" id="6048025">Close</span><span class="op" id="6048030">(</span><span class="op" id="6048031">)</span><br>
<span class="lineno">115</span><span class="op" id="6048033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6048036">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6048103">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6048155">//</span><br>
<span class="lineno">120</span><span class="comment" id="6048158">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6048219">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6048264">func</span>&nbsp;<span class="op" id="6048269">(</span><span class="ident" id="6048270">f</span>&nbsp;<span class="op" id="6048272">*</span><span class="ident" id="6048273">File</span><span class="op" id="6048277">)</span>&nbsp;<span class="ident" id="6048279">DataOffset</span><span class="op" id="6048289">(</span><span class="op" id="6048290">)</span>&nbsp;<span class="op" id="6048292">(</span><span class="ident" id="6048293">offset</span>&nbsp;<span class="ident" id="6048300">int64</span><span class="op" id="6048305">,</span>&nbsp;<span class="ident" id="6048307">err</span>&nbsp;<span class="builtintype" id="6048311">error</span><span class="op" id="6048316">)</span>&nbsp;<span class="op" id="6048318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048321">bodyOffset</span><span class="op" id="6048331">,</span>&nbsp;<span class="ident" id="6048333">err</span>&nbsp;<span class="op" id="6048337">:=</span>&nbsp;<span class="ident" id="6048340">f</span><span class="op" id="6048341">.</span><span class="ident" id="6048342">findBodyOffset</span><span class="op" id="6048356">(</span><span class="op" id="6048357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048360">if</span>&nbsp;<span class="ident" id="6048363">err</span>&nbsp;<span class="op" id="6048367">!=</span>&nbsp;<span class="ident" id="6048370">nil</span>&nbsp;<span class="op" id="6048374">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048378">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6048386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048389">return</span>&nbsp;<span class="ident" id="6048396">f</span><span class="op" id="6048397">.</span><span class="ident" id="6048398">headerOffset</span>&nbsp;<span class="op" id="6048411">+</span>&nbsp;<span class="ident" id="6048413">bodyOffset</span><span class="op" id="6048423">,</span>&nbsp;<span class="ident" id="6048425">nil</span><br>
<span class="lineno"></span><span class="op" id="6048429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6048432">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6048506">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6048550">func</span>&nbsp;<span class="op" id="6048555">(</span><span class="ident" id="6048556">f</span>&nbsp;<span class="op" id="6048558">*</span><span class="ident" id="6048559">File</span><span class="op" id="6048563">)</span>&nbsp;<span class="ident" id="6048565">Open</span><span class="op" id="6048569">(</span><span class="op" id="6048570">)</span>&nbsp;<span class="op" id="6048572">(</span><span class="ident" id="6048573">rc</span>&nbsp;<span class="ident" id="6048576">io</span><span class="op" id="6048578">.</span><span class="ident" id="6048579">ReadCloser</span><span class="op" id="6048589">,</span>&nbsp;<span class="ident" id="6048591">err</span>&nbsp;<span class="builtintype" id="6048595">error</span><span class="op" id="6048600">)</span>&nbsp;<span class="op" id="6048602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048605">bodyOffset</span><span class="op" id="6048615">,</span>&nbsp;<span class="ident" id="6048617">err</span>&nbsp;<span class="op" id="6048621">:=</span>&nbsp;<span class="ident" id="6048624">f</span><span class="op" id="6048625">.</span><span class="ident" id="6048626">findBodyOffset</span><span class="op" id="6048640">(</span><span class="op" id="6048641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048644">if</span>&nbsp;<span class="ident" id="6048647">err</span>&nbsp;<span class="op" id="6048651">!=</span>&nbsp;<span class="ident" id="6048654">nil</span>&nbsp;<span class="op" id="6048658">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048662">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6048670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048673">size</span>&nbsp;<span class="op" id="6048678">:=</span>&nbsp;<span class="ident" id="6048681">int64</span><span class="op" id="6048686">(</span><span class="ident" id="6048687">f</span><span class="op" id="6048688">.</span><span class="ident" id="6048689">CompressedSize64</span><span class="op" id="6048705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048708">r</span>&nbsp;<span class="op" id="6048710">:=</span>&nbsp;<span class="ident" id="6048713">io</span><span class="op" id="6048715">.</span><span class="ident" id="6048716">NewSectionReader</span><span class="op" id="6048732">(</span><span class="ident" id="6048733">f</span><span class="op" id="6048734">.</span><span class="ident" id="6048735">zipr</span><span class="op" id="6048739">,</span>&nbsp;<span class="ident" id="6048741">f</span><span class="op" id="6048742">.</span><span class="ident" id="6048743">headerOffset</span><span class="op" id="6048755">+</span><span class="ident" id="6048756">bodyOffset</span><span class="op" id="6048766">,</span>&nbsp;<span class="ident" id="6048768">size</span><span class="op" id="6048772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048775">dcomp</span>&nbsp;<span class="op" id="6048781">:=</span>&nbsp;<span class="ident" id="6048784">decompressor</span><span class="op" id="6048796">(</span><span class="ident" id="6048797">f</span><span class="op" id="6048798">.</span><span class="ident" id="6048799">Method</span><span class="op" id="6048805">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048808">if</span>&nbsp;<span class="ident" id="6048811">dcomp</span>&nbsp;<span class="op" id="6048817">==</span>&nbsp;<span class="ident" id="6048820">nil</span>&nbsp;<span class="op" id="6048824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048828">err</span>&nbsp;<span class="op" id="6048832">=</span>&nbsp;<span class="ident" id="6048834">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048849">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6048857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048860">rc</span>&nbsp;<span class="op" id="6048863">=</span>&nbsp;<span class="ident" id="6048865">dcomp</span><span class="op" id="6048870">(</span><span class="ident" id="6048871">r</span><span class="op" id="6048872">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048875">var</span>&nbsp;<span class="ident" id="6048879">desr</span>&nbsp;<span class="ident" id="6048884">io</span><span class="op" id="6048886">.</span><span class="ident" id="6048887">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6048895">if</span>&nbsp;<span class="ident" id="6048898">f</span><span class="op" id="6048899">.</span><span class="ident" id="6048900">hasDataDescriptor</span><span class="op" id="6048917">(</span><span class="op" id="6048918">)</span>&nbsp;<span class="op" id="6048920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6048924">desr</span>&nbsp;<span class="op" id="6048929">=</span>&nbsp;<span class="ident" id="6048931">io</span><span class="op" id="6048933">.</span><span class="ident" id="6048934">NewSectionReader</span><span class="op" id="6048950">(</span><span class="ident" id="6048951">f</span><span class="op" id="6048952">.</span><span class="ident" id="6048953">zipr</span><span class="op" id="6048957">,</span>&nbsp;<span class="ident" id="6048959">f</span><span class="op" id="6048960">.</span><span class="ident" id="6048961">headerOffset</span><span class="op" id="6048973">+</span><span class="ident" id="6048974">bodyOffset</span><span class="op" id="6048984">+</span><span class="ident" id="6048985">size</span><span class="op" id="6048989">,</span>&nbsp;<span class="ident" id="6048991">dataDescriptorLen</span><span class="op" id="6049008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049014">rc</span>&nbsp;<span class="op" id="6049017">=</span>&nbsp;<span class="op" id="6049019">&amp;</span><span class="ident" id="6049020">checksumReader</span><span class="op" id="6049034">{</span><span class="ident" id="6049035">rc</span><span class="op" id="6049037">,</span>&nbsp;<span class="ident" id="6049039">crc32</span><span class="op" id="6049044">.</span><span class="ident" id="6049045">NewIEEE</span><span class="op" id="6049052">(</span><span class="op" id="6049053">)</span><span class="op" id="6049054">,</span>&nbsp;<span class="ident" id="6049056">f</span><span class="op" id="6049057">,</span>&nbsp;<span class="ident" id="6049059">desr</span><span class="op" id="6049063">,</span>&nbsp;<span class="ident" id="6049065">nil</span><span class="op" id="6049068">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049071">return</span><br>
<span class="lineno"></span><span class="op" id="6049078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6049081">type</span>&nbsp;<span class="ident" id="6049086">checksumReader</span>&nbsp;<span class="keyword" id="6049101">struct</span>&nbsp;<span class="op" id="6049108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049111">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6049116">io</span><span class="op" id="6049118">.</span><span class="ident" id="6049119">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049131">hash</span>&nbsp;<span class="ident" id="6049136">hash</span><span class="op" id="6049140">.</span><span class="ident" id="6049141">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049149">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049154">*</span><span class="ident" id="6049155">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049161">desr</span>&nbsp;<span class="ident" id="6049166">io</span><span class="op" id="6049168">.</span><span class="ident" id="6049169">Reader</span>&nbsp;<span class="comment" id="6049176">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049226">err</span>&nbsp;&nbsp;<span class="builtintype" id="6049231">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049241">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6049257">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6049260">func</span>&nbsp;<span class="op" id="6049265">(</span><span class="ident" id="6049266">r</span>&nbsp;<span class="op" id="6049268">*</span><span class="ident" id="6049269">checksumReader</span><span class="op" id="6049283">)</span>&nbsp;<span class="ident" id="6049285">Read</span><span class="op" id="6049289">(</span><span class="ident" id="6049290">b</span>&nbsp;<span class="op" id="6049292">[</span><span class="op" id="6049293">]</span><span class="builtintype" id="6049294">byte</span><span class="op" id="6049298">)</span>&nbsp;<span class="op" id="6049300">(</span><span class="ident" id="6049301">n</span>&nbsp;<span class="builtintype" id="6049303">int</span><span class="op" id="6049306">,</span>&nbsp;<span class="ident" id="6049308">err</span>&nbsp;<span class="builtintype" id="6049312">error</span><span class="op" id="6049317">)</span>&nbsp;<span class="op" id="6049319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049322">if</span>&nbsp;<span class="ident" id="6049325">r</span><span class="op" id="6049326">.</span><span class="ident" id="6049327">err</span>&nbsp;<span class="op" id="6049331">!=</span>&nbsp;<span class="ident" id="6049334">nil</span>&nbsp;<span class="op" id="6049338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049342">return</span>&nbsp;<span class="num" id="6049349">0</span><span class="op" id="6049350">,</span>&nbsp;<span class="ident" id="6049352">r</span><span class="op" id="6049353">.</span><span class="ident" id="6049354">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049359">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049362">n</span><span class="op" id="6049363">,</span>&nbsp;<span class="ident" id="6049365">err</span>&nbsp;<span class="op" id="6049369">=</span>&nbsp;<span class="ident" id="6049371">r</span><span class="op" id="6049372">.</span><span class="ident" id="6049373">rc</span><span class="op" id="6049375">.</span><span class="ident" id="6049376">Read</span><span class="op" id="6049380">(</span><span class="ident" id="6049381">b</span><span class="op" id="6049382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049385">r</span><span class="op" id="6049386">.</span><span class="ident" id="6049387">hash</span><span class="op" id="6049391">.</span><span class="ident" id="6049392">Write</span><span class="op" id="6049397">(</span><span class="ident" id="6049398">b</span><span class="op" id="6049399">[</span><span class="op" id="6049400">:</span><span class="ident" id="6049401">n</span><span class="op" id="6049402">]</span><span class="op" id="6049403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049406">if</span>&nbsp;<span class="ident" id="6049409">err</span>&nbsp;<span class="op" id="6049413">==</span>&nbsp;<span class="ident" id="6049416">nil</span>&nbsp;<span class="op" id="6049420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049424">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049432">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049435">if</span>&nbsp;<span class="ident" id="6049438">err</span>&nbsp;<span class="op" id="6049442">==</span>&nbsp;<span class="ident" id="6049445">io</span><span class="op" id="6049447">.</span><span class="ident" id="6049448">EOF</span>&nbsp;<span class="op" id="6049452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049456">if</span>&nbsp;<span class="ident" id="6049459">r</span><span class="op" id="6049460">.</span><span class="ident" id="6049461">desr</span>&nbsp;<span class="op" id="6049466">!=</span>&nbsp;<span class="ident" id="6049469">nil</span>&nbsp;<span class="op" id="6049473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049478">if</span>&nbsp;<span class="ident" id="6049481">err1</span>&nbsp;<span class="op" id="6049486">:=</span>&nbsp;<span class="ident" id="6049489">readDataDescriptor</span><span class="op" id="6049507">(</span><span class="ident" id="6049508">r</span><span class="op" id="6049509">.</span><span class="ident" id="6049510">desr</span><span class="op" id="6049514">,</span>&nbsp;<span class="ident" id="6049516">r</span><span class="op" id="6049517">.</span><span class="ident" id="6049518">f</span><span class="op" id="6049519">)</span><span class="op" id="6049520">;</span>&nbsp;<span class="ident" id="6049522">err1</span>&nbsp;<span class="op" id="6049527">!=</span>&nbsp;<span class="ident" id="6049530">nil</span>&nbsp;<span class="op" id="6049534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049540">err</span>&nbsp;<span class="op" id="6049544">=</span>&nbsp;<span class="ident" id="6049546">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049554">}</span>&nbsp;<span class="keyword" id="6049556">else</span>&nbsp;<span class="keyword" id="6049561">if</span>&nbsp;<span class="ident" id="6049564">r</span><span class="op" id="6049565">.</span><span class="ident" id="6049566">hash</span><span class="op" id="6049570">.</span><span class="ident" id="6049571">Sum32</span><span class="op" id="6049576">(</span><span class="op" id="6049577">)</span>&nbsp;<span class="op" id="6049579">!=</span>&nbsp;<span class="ident" id="6049582">r</span><span class="op" id="6049583">.</span><span class="ident" id="6049584">f</span><span class="op" id="6049585">.</span><span class="ident" id="6049586">CRC32</span>&nbsp;<span class="op" id="6049592">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049598">err</span>&nbsp;<span class="op" id="6049602">=</span>&nbsp;<span class="ident" id="6049604">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049623">}</span>&nbsp;<span class="keyword" id="6049625">else</span>&nbsp;<span class="op" id="6049630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6049635">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6049692">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6049751">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049802">if</span>&nbsp;<span class="ident" id="6049805">r</span><span class="op" id="6049806">.</span><span class="ident" id="6049807">f</span><span class="op" id="6049808">.</span><span class="ident" id="6049809">CRC32</span>&nbsp;<span class="op" id="6049815">!=</span>&nbsp;<span class="num" id="6049818">0</span>&nbsp;<span class="op" id="6049820">&amp;&amp;</span>&nbsp;<span class="ident" id="6049823">r</span><span class="op" id="6049824">.</span><span class="ident" id="6049825">hash</span><span class="op" id="6049829">.</span><span class="ident" id="6049830">Sum32</span><span class="op" id="6049835">(</span><span class="op" id="6049836">)</span>&nbsp;<span class="op" id="6049838">!=</span>&nbsp;<span class="ident" id="6049841">r</span><span class="op" id="6049842">.</span><span class="ident" id="6049843">f</span><span class="op" id="6049844">.</span><span class="ident" id="6049845">CRC32</span>&nbsp;<span class="op" id="6049851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049857">err</span>&nbsp;<span class="op" id="6049861">=</span>&nbsp;<span class="ident" id="6049863">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049882">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6049885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6049888">r</span><span class="op" id="6049889">.</span><span class="ident" id="6049890">err</span>&nbsp;<span class="op" id="6049894">=</span>&nbsp;<span class="ident" id="6049896">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6049901">return</span><br>
<span class="lineno"></span><span class="op" id="6049908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6049911">func</span>&nbsp;<span class="op" id="6049916">(</span><span class="ident" id="6049917">r</span>&nbsp;<span class="op" id="6049919">*</span><span class="ident" id="6049920">checksumReader</span><span class="op" id="6049934">)</span>&nbsp;<span class="ident" id="6049936">Close</span><span class="op" id="6049941">(</span><span class="op" id="6049942">)</span>&nbsp;<span class="builtintype" id="6049944">error</span>&nbsp;<span class="op" id="6049950">{</span>&nbsp;<span class="keyword" id="6049952">return</span>&nbsp;<span class="ident" id="6049959">r</span><span class="op" id="6049960">.</span><span class="ident" id="6049961">rc</span><span class="op" id="6049963">.</span><span class="ident" id="6049964">Close</span><span class="op" id="6049969">(</span><span class="op" id="6049970">)</span>&nbsp;<span class="op" id="6049972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6049975">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6050047">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6050084">func</span>&nbsp;<span class="op" id="6050089">(</span><span class="ident" id="6050090">f</span>&nbsp;<span class="op" id="6050092">*</span><span class="ident" id="6050093">File</span><span class="op" id="6050097">)</span>&nbsp;<span class="ident" id="6050099">findBodyOffset</span><span class="op" id="6050113">(</span><span class="op" id="6050114">)</span>&nbsp;<span class="op" id="6050116">(</span><span class="ident" id="6050117">int64</span><span class="op" id="6050122">,</span>&nbsp;<span class="builtintype" id="6050124">error</span><span class="op" id="6050129">)</span>&nbsp;<span class="op" id="6050131">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050134">var</span>&nbsp;<span class="ident" id="6050138">buf</span>&nbsp;<span class="op" id="6050142">[</span><span class="ident" id="6050143">fileHeaderLen</span><span class="op" id="6050156">]</span><span class="builtintype" id="6050157">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050163">if</span>&nbsp;<span class="ident" id="6050166">_</span><span class="op" id="6050167">,</span>&nbsp;<span class="ident" id="6050169">err</span>&nbsp;<span class="op" id="6050173">:=</span>&nbsp;<span class="ident" id="6050176">f</span><span class="op" id="6050177">.</span><span class="ident" id="6050178">zipr</span><span class="op" id="6050182">.</span><span class="ident" id="6050183">ReadAt</span><span class="op" id="6050189">(</span><span class="ident" id="6050190">buf</span><span class="op" id="6050193">[</span><span class="op" id="6050194">:</span><span class="op" id="6050195">]</span><span class="op" id="6050196">,</span>&nbsp;<span class="ident" id="6050198">f</span><span class="op" id="6050199">.</span><span class="ident" id="6050200">headerOffset</span><span class="op" id="6050212">)</span><span class="op" id="6050213">;</span>&nbsp;<span class="ident" id="6050215">err</span>&nbsp;<span class="op" id="6050219">!=</span>&nbsp;<span class="ident" id="6050222">nil</span>&nbsp;<span class="op" id="6050226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050230">return</span>&nbsp;<span class="num" id="6050237">0</span><span class="op" id="6050238">,</span>&nbsp;<span class="ident" id="6050240">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6050245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6050248">b</span>&nbsp;<span class="op" id="6050250">:=</span>&nbsp;<span class="ident" id="6050253">readBuf</span><span class="op" id="6050260">(</span><span class="ident" id="6050261">buf</span><span class="op" id="6050264">[</span><span class="op" id="6050265">:</span><span class="op" id="6050266">]</span><span class="op" id="6050267">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050270">if</span>&nbsp;<span class="ident" id="6050273">sig</span>&nbsp;<span class="op" id="6050277">:=</span>&nbsp;<span class="ident" id="6050280">b</span><span class="op" id="6050281">.</span><span class="builtintype" id="6050282">uint32</span><span class="op" id="6050288">(</span><span class="op" id="6050289">)</span><span class="op" id="6050290">;</span>&nbsp;<span class="ident" id="6050292">sig</span>&nbsp;<span class="op" id="6050296">!=</span>&nbsp;<span class="ident" id="6050299">fileHeaderSignature</span>&nbsp;<span class="op" id="6050319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050323">return</span>&nbsp;<span class="num" id="6050330">0</span><span class="op" id="6050331">,</span>&nbsp;<span class="ident" id="6050333">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6050344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6050347">b</span>&nbsp;<span class="op" id="6050349">=</span>&nbsp;<span class="ident" id="6050351">b</span><span class="op" id="6050352">[</span><span class="num" id="6050353">22</span><span class="op" id="6050355">:</span><span class="op" id="6050356">]</span>&nbsp;<span class="comment" id="6050358">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6050391">filenameLen</span>&nbsp;<span class="op" id="6050403">:=</span>&nbsp;<span class="builtintype" id="6050406">int</span><span class="op" id="6050409">(</span><span class="ident" id="6050410">b</span><span class="op" id="6050411">.</span><span class="builtintype" id="6050412">uint16</span><span class="op" id="6050418">(</span><span class="op" id="6050419">)</span><span class="op" id="6050420">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6050423">extraLen</span>&nbsp;<span class="op" id="6050432">:=</span>&nbsp;<span class="builtintype" id="6050435">int</span><span class="op" id="6050438">(</span><span class="ident" id="6050439">b</span><span class="op" id="6050440">.</span><span class="builtintype" id="6050441">uint16</span><span class="op" id="6050447">(</span><span class="op" id="6050448">)</span><span class="op" id="6050449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050452">return</span>&nbsp;<span class="ident" id="6050459">int64</span><span class="op" id="6050464">(</span><span class="ident" id="6050465">fileHeaderLen</span>&nbsp;<span class="op" id="6050479">+</span>&nbsp;<span class="ident" id="6050481">filenameLen</span>&nbsp;<span class="op" id="6050493">+</span>&nbsp;<span class="ident" id="6050495">extraLen</span><span class="op" id="6050503">)</span><span class="op" id="6050504">,</span>&nbsp;<span class="ident" id="6050506">nil</span><br>
<span class="lineno"></span><span class="op" id="6050510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6050513">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6050580">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6050651">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6050713">func</span>&nbsp;<span class="ident" id="6050718">readDirectoryHeader</span><span class="op" id="6050737">(</span><span class="ident" id="6050738">f</span>&nbsp;<span class="op" id="6050740">*</span><span class="ident" id="6050741">File</span><span class="op" id="6050745">,</span>&nbsp;<span class="ident" id="6050747">r</span>&nbsp;<span class="ident" id="6050749">io</span><span class="op" id="6050751">.</span><span class="ident" id="6050752">Reader</span><span class="op" id="6050758">)</span>&nbsp;<span class="builtintype" id="6050760">error</span>&nbsp;<span class="op" id="6050766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050769">var</span>&nbsp;<span class="ident" id="6050773">buf</span>&nbsp;<span class="op" id="6050777">[</span><span class="ident" id="6050778">directoryHeaderLen</span><span class="op" id="6050796">]</span><span class="builtintype" id="6050797">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050803">if</span>&nbsp;<span class="ident" id="6050806">_</span><span class="op" id="6050807">,</span>&nbsp;<span class="ident" id="6050809">err</span>&nbsp;<span class="op" id="6050813">:=</span>&nbsp;<span class="ident" id="6050816">io</span><span class="op" id="6050818">.</span><span class="ident" id="6050819">ReadFull</span><span class="op" id="6050827">(</span><span class="ident" id="6050828">r</span><span class="op" id="6050829">,</span>&nbsp;<span class="ident" id="6050831">buf</span><span class="op" id="6050834">[</span><span class="op" id="6050835">:</span><span class="op" id="6050836">]</span><span class="op" id="6050837">)</span><span class="op" id="6050838">;</span>&nbsp;<span class="ident" id="6050840">err</span>&nbsp;<span class="op" id="6050844">!=</span>&nbsp;<span class="ident" id="6050847">nil</span>&nbsp;<span class="op" id="6050851">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050855">return</span>&nbsp;<span class="ident" id="6050862">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6050867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6050870">b</span>&nbsp;<span class="op" id="6050872">:=</span>&nbsp;<span class="ident" id="6050875">readBuf</span><span class="op" id="6050882">(</span><span class="ident" id="6050883">buf</span><span class="op" id="6050886">[</span><span class="op" id="6050887">:</span><span class="op" id="6050888">]</span><span class="op" id="6050889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050892">if</span>&nbsp;<span class="ident" id="6050895">sig</span>&nbsp;<span class="op" id="6050899">:=</span>&nbsp;<span class="ident" id="6050902">b</span><span class="op" id="6050903">.</span><span class="builtintype" id="6050904">uint32</span><span class="op" id="6050910">(</span><span class="op" id="6050911">)</span><span class="op" id="6050912">;</span>&nbsp;<span class="ident" id="6050914">sig</span>&nbsp;<span class="op" id="6050918">!=</span>&nbsp;<span class="ident" id="6050921">directoryHeaderSignature</span>&nbsp;<span class="op" id="6050946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6050950">return</span>&nbsp;<span class="ident" id="6050957">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6050968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6050971">f</span><span class="op" id="6050972">.</span><span class="ident" id="6050973">CreatorVersion</span>&nbsp;<span class="op" id="6050988">=</span>&nbsp;<span class="ident" id="6050990">b</span><span class="op" id="6050991">.</span><span class="builtintype" id="6050992">uint16</span><span class="op" id="6050998">(</span><span class="op" id="6050999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051002">f</span><span class="op" id="6051003">.</span><span class="ident" id="6051004">ReaderVersion</span>&nbsp;<span class="op" id="6051018">=</span>&nbsp;<span class="ident" id="6051020">b</span><span class="op" id="6051021">.</span><span class="builtintype" id="6051022">uint16</span><span class="op" id="6051028">(</span><span class="op" id="6051029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051032">f</span><span class="op" id="6051033">.</span><span class="ident" id="6051034">Flags</span>&nbsp;<span class="op" id="6051040">=</span>&nbsp;<span class="ident" id="6051042">b</span><span class="op" id="6051043">.</span><span class="builtintype" id="6051044">uint16</span><span class="op" id="6051050">(</span><span class="op" id="6051051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051054">f</span><span class="op" id="6051055">.</span><span class="ident" id="6051056">Method</span>&nbsp;<span class="op" id="6051063">=</span>&nbsp;<span class="ident" id="6051065">b</span><span class="op" id="6051066">.</span><span class="builtintype" id="6051067">uint16</span><span class="op" id="6051073">(</span><span class="op" id="6051074">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051077">f</span><span class="op" id="6051078">.</span><span class="ident" id="6051079">ModifiedTime</span>&nbsp;<span class="op" id="6051092">=</span>&nbsp;<span class="ident" id="6051094">b</span><span class="op" id="6051095">.</span><span class="builtintype" id="6051096">uint16</span><span class="op" id="6051102">(</span><span class="op" id="6051103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051106">f</span><span class="op" id="6051107">.</span><span class="ident" id="6051108">ModifiedDate</span>&nbsp;<span class="op" id="6051121">=</span>&nbsp;<span class="ident" id="6051123">b</span><span class="op" id="6051124">.</span><span class="builtintype" id="6051125">uint16</span><span class="op" id="6051131">(</span><span class="op" id="6051132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051135">f</span><span class="op" id="6051136">.</span><span class="ident" id="6051137">CRC32</span>&nbsp;<span class="op" id="6051143">=</span>&nbsp;<span class="ident" id="6051145">b</span><span class="op" id="6051146">.</span><span class="builtintype" id="6051147">uint32</span><span class="op" id="6051153">(</span><span class="op" id="6051154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051157">f</span><span class="op" id="6051158">.</span><span class="ident" id="6051159">CompressedSize</span>&nbsp;<span class="op" id="6051174">=</span>&nbsp;<span class="ident" id="6051176">b</span><span class="op" id="6051177">.</span><span class="builtintype" id="6051178">uint32</span><span class="op" id="6051184">(</span><span class="op" id="6051185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051188">f</span><span class="op" id="6051189">.</span><span class="ident" id="6051190">UncompressedSize</span>&nbsp;<span class="op" id="6051207">=</span>&nbsp;<span class="ident" id="6051209">b</span><span class="op" id="6051210">.</span><span class="builtintype" id="6051211">uint32</span><span class="op" id="6051217">(</span><span class="op" id="6051218">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051221">f</span><span class="op" id="6051222">.</span><span class="ident" id="6051223">CompressedSize64</span>&nbsp;<span class="op" id="6051240">=</span>&nbsp;<span class="ident" id="6051242">uint64</span><span class="op" id="6051248">(</span><span class="ident" id="6051249">f</span><span class="op" id="6051250">.</span><span class="ident" id="6051251">CompressedSize</span><span class="op" id="6051265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051268">f</span><span class="op" id="6051269">.</span><span class="ident" id="6051270">UncompressedSize64</span>&nbsp;<span class="op" id="6051289">=</span>&nbsp;<span class="ident" id="6051291">uint64</span><span class="op" id="6051297">(</span><span class="ident" id="6051298">f</span><span class="op" id="6051299">.</span><span class="ident" id="6051300">UncompressedSize</span><span class="op" id="6051316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051319">filenameLen</span>&nbsp;<span class="op" id="6051331">:=</span>&nbsp;<span class="builtintype" id="6051334">int</span><span class="op" id="6051337">(</span><span class="ident" id="6051338">b</span><span class="op" id="6051339">.</span><span class="builtintype" id="6051340">uint16</span><span class="op" id="6051346">(</span><span class="op" id="6051347">)</span><span class="op" id="6051348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051351">extraLen</span>&nbsp;<span class="op" id="6051360">:=</span>&nbsp;<span class="builtintype" id="6051363">int</span><span class="op" id="6051366">(</span><span class="ident" id="6051367">b</span><span class="op" id="6051368">.</span><span class="builtintype" id="6051369">uint16</span><span class="op" id="6051375">(</span><span class="op" id="6051376">)</span><span class="op" id="6051377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051380">commentLen</span>&nbsp;<span class="op" id="6051391">:=</span>&nbsp;<span class="builtintype" id="6051394">int</span><span class="op" id="6051397">(</span><span class="ident" id="6051398">b</span><span class="op" id="6051399">.</span><span class="builtintype" id="6051400">uint16</span><span class="op" id="6051406">(</span><span class="op" id="6051407">)</span><span class="op" id="6051408">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051411">b</span>&nbsp;<span class="op" id="6051413">=</span>&nbsp;<span class="ident" id="6051415">b</span><span class="op" id="6051416">[</span><span class="num" id="6051417">4</span><span class="op" id="6051418">:</span><span class="op" id="6051419">]</span>&nbsp;<span class="comment" id="6051421">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051487">f</span><span class="op" id="6051488">.</span><span class="ident" id="6051489">ExternalAttrs</span>&nbsp;<span class="op" id="6051503">=</span>&nbsp;<span class="ident" id="6051505">b</span><span class="op" id="6051506">.</span><span class="builtintype" id="6051507">uint32</span><span class="op" id="6051513">(</span><span class="op" id="6051514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051517">f</span><span class="op" id="6051518">.</span><span class="ident" id="6051519">headerOffset</span>&nbsp;<span class="op" id="6051532">=</span>&nbsp;<span class="ident" id="6051534">int64</span><span class="op" id="6051539">(</span><span class="ident" id="6051540">b</span><span class="op" id="6051541">.</span><span class="builtintype" id="6051542">uint32</span><span class="op" id="6051548">(</span><span class="op" id="6051549">)</span><span class="op" id="6051550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051553">d</span>&nbsp;<span class="op" id="6051555">:=</span>&nbsp;<span class="builtinfunc" id="6051558">make</span><span class="op" id="6051562">(</span><span class="op" id="6051563">[</span><span class="op" id="6051564">]</span><span class="builtintype" id="6051565">byte</span><span class="op" id="6051569">,</span>&nbsp;<span class="ident" id="6051571">filenameLen</span><span class="op" id="6051582">+</span><span class="ident" id="6051583">extraLen</span><span class="op" id="6051591">+</span><span class="ident" id="6051592">commentLen</span><span class="op" id="6051602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051605">if</span>&nbsp;<span class="ident" id="6051608">_</span><span class="op" id="6051609">,</span>&nbsp;<span class="ident" id="6051611">err</span>&nbsp;<span class="op" id="6051615">:=</span>&nbsp;<span class="ident" id="6051618">io</span><span class="op" id="6051620">.</span><span class="ident" id="6051621">ReadFull</span><span class="op" id="6051629">(</span><span class="ident" id="6051630">r</span><span class="op" id="6051631">,</span>&nbsp;<span class="ident" id="6051633">d</span><span class="op" id="6051634">)</span><span class="op" id="6051635">;</span>&nbsp;<span class="ident" id="6051637">err</span>&nbsp;<span class="op" id="6051641">!=</span>&nbsp;<span class="ident" id="6051644">nil</span>&nbsp;<span class="op" id="6051648">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051652">return</span>&nbsp;<span class="ident" id="6051659">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6051664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051667">f</span><span class="op" id="6051668">.</span><span class="ident" id="6051669">Name</span>&nbsp;<span class="op" id="6051674">=</span>&nbsp;<span class="builtintype" id="6051676">string</span><span class="op" id="6051682">(</span><span class="ident" id="6051683">d</span><span class="op" id="6051684">[</span><span class="op" id="6051685">:</span><span class="ident" id="6051686">filenameLen</span><span class="op" id="6051697">]</span><span class="op" id="6051698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051701">f</span><span class="op" id="6051702">.</span><span class="ident" id="6051703">Extra</span>&nbsp;<span class="op" id="6051709">=</span>&nbsp;<span class="ident" id="6051711">d</span><span class="op" id="6051712">[</span><span class="ident" id="6051713">filenameLen</span>&nbsp;<span class="op" id="6051725">:</span>&nbsp;<span class="ident" id="6051727">filenameLen</span><span class="op" id="6051738">+</span><span class="ident" id="6051739">extraLen</span><span class="op" id="6051747">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051750">f</span><span class="op" id="6051751">.</span><span class="ident" id="6051752">Comment</span>&nbsp;<span class="op" id="6051760">=</span>&nbsp;<span class="builtintype" id="6051762">string</span><span class="op" id="6051768">(</span><span class="ident" id="6051769">d</span><span class="op" id="6051770">[</span><span class="ident" id="6051771">filenameLen</span><span class="op" id="6051782">+</span><span class="ident" id="6051783">extraLen</span><span class="op" id="6051791">:</span><span class="op" id="6051792">]</span><span class="op" id="6051793">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051797">if</span>&nbsp;<span class="builtinfunc" id="6051800">len</span><span class="op" id="6051803">(</span><span class="ident" id="6051804">f</span><span class="op" id="6051805">.</span><span class="ident" id="6051806">Extra</span><span class="op" id="6051811">)</span>&nbsp;<span class="op" id="6051813">&gt;</span>&nbsp;<span class="num" id="6051815">0</span>&nbsp;<span class="op" id="6051817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051821">b</span>&nbsp;<span class="op" id="6051823">:=</span>&nbsp;<span class="ident" id="6051826">readBuf</span><span class="op" id="6051833">(</span><span class="ident" id="6051834">f</span><span class="op" id="6051835">.</span><span class="ident" id="6051836">Extra</span><span class="op" id="6051841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051845">for</span>&nbsp;<span class="builtinfunc" id="6051849">len</span><span class="op" id="6051852">(</span><span class="ident" id="6051853">b</span><span class="op" id="6051854">)</span>&nbsp;<span class="op" id="6051856">&gt;=</span>&nbsp;<span class="num" id="6051859">4</span>&nbsp;<span class="op" id="6051861">{</span>&nbsp;<span class="comment" id="6051863">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051896">tag</span>&nbsp;<span class="op" id="6051900">:=</span>&nbsp;<span class="ident" id="6051903">b</span><span class="op" id="6051904">.</span><span class="builtintype" id="6051905">uint16</span><span class="op" id="6051911">(</span><span class="op" id="6051912">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6051917">size</span>&nbsp;<span class="op" id="6051922">:=</span>&nbsp;<span class="ident" id="6051925">b</span><span class="op" id="6051926">.</span><span class="builtintype" id="6051927">uint16</span><span class="op" id="6051933">(</span><span class="op" id="6051934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051939">if</span>&nbsp;<span class="builtintype" id="6051942">int</span><span class="op" id="6051945">(</span><span class="ident" id="6051946">size</span><span class="op" id="6051950">)</span>&nbsp;<span class="op" id="6051952">&gt;</span>&nbsp;<span class="builtinfunc" id="6051954">len</span><span class="op" id="6051957">(</span><span class="ident" id="6051958">b</span><span class="op" id="6051959">)</span>&nbsp;<span class="op" id="6051961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051967">return</span>&nbsp;<span class="ident" id="6051974">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6051987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6051992">if</span>&nbsp;<span class="ident" id="6051995">tag</span>&nbsp;<span class="op" id="6051999">==</span>&nbsp;<span class="ident" id="6052002">zip64ExtraId</span>&nbsp;<span class="op" id="6052015">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052021">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052079">eb</span>&nbsp;<span class="op" id="6052082">:=</span>&nbsp;<span class="ident" id="6052085">readBuf</span><span class="op" id="6052092">(</span><span class="ident" id="6052093">b</span><span class="op" id="6052094">[</span><span class="op" id="6052095">:</span><span class="ident" id="6052096">size</span><span class="op" id="6052100">]</span><span class="op" id="6052101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052107">if</span>&nbsp;<span class="builtinfunc" id="6052110">len</span><span class="op" id="6052113">(</span><span class="ident" id="6052114">eb</span><span class="op" id="6052116">)</span>&nbsp;<span class="op" id="6052118">&gt;=</span>&nbsp;<span class="num" id="6052121">8</span>&nbsp;<span class="op" id="6052123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052130">f</span><span class="op" id="6052131">.</span><span class="ident" id="6052132">UncompressedSize64</span>&nbsp;<span class="op" id="6052151">=</span>&nbsp;<span class="ident" id="6052153">eb</span><span class="op" id="6052155">.</span><span class="ident" id="6052156">uint64</span><span class="op" id="6052162">(</span><span class="op" id="6052163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052169">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052175">if</span>&nbsp;<span class="builtinfunc" id="6052178">len</span><span class="op" id="6052181">(</span><span class="ident" id="6052182">eb</span><span class="op" id="6052184">)</span>&nbsp;<span class="op" id="6052186">&gt;=</span>&nbsp;<span class="num" id="6052189">8</span>&nbsp;<span class="op" id="6052191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052198">f</span><span class="op" id="6052199">.</span><span class="ident" id="6052200">CompressedSize64</span>&nbsp;<span class="op" id="6052217">=</span>&nbsp;<span class="ident" id="6052219">eb</span><span class="op" id="6052221">.</span><span class="ident" id="6052222">uint64</span><span class="op" id="6052228">(</span><span class="op" id="6052229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052241">if</span>&nbsp;<span class="builtinfunc" id="6052244">len</span><span class="op" id="6052247">(</span><span class="ident" id="6052248">eb</span><span class="op" id="6052250">)</span>&nbsp;<span class="op" id="6052252">&gt;=</span>&nbsp;<span class="num" id="6052255">8</span>&nbsp;<span class="op" id="6052257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052264">f</span><span class="op" id="6052265">.</span><span class="ident" id="6052266">headerOffset</span>&nbsp;<span class="op" id="6052279">=</span>&nbsp;<span class="ident" id="6052281">int64</span><span class="op" id="6052286">(</span><span class="ident" id="6052287">eb</span><span class="op" id="6052289">.</span><span class="ident" id="6052290">uint64</span><span class="op" id="6052296">(</span><span class="op" id="6052297">)</span><span class="op" id="6052298">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6052314">b</span>&nbsp;<span class="op" id="6052316">=</span>&nbsp;<span class="ident" id="6052318">b</span><span class="op" id="6052319">[</span><span class="ident" id="6052320">size</span><span class="op" id="6052324">:</span><span class="op" id="6052325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052333">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052377">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052434">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052487">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052524">for</span>&nbsp;<span class="ident" id="6052528">_</span><span class="op" id="6052529">,</span>&nbsp;<span class="ident" id="6052531">v</span>&nbsp;<span class="op" id="6052533">:=</span>&nbsp;<span class="keyword" id="6052536">range</span>&nbsp;<span class="ident" id="6052542">b</span>&nbsp;<span class="op" id="6052544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052549">if</span>&nbsp;<span class="ident" id="6052552">v</span>&nbsp;<span class="op" id="6052554">!=</span>&nbsp;<span class="num" id="6052557">0</span>&nbsp;<span class="op" id="6052559">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052565">return</span>&nbsp;<span class="ident" id="6052572">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6052592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052595">return</span>&nbsp;<span class="ident" id="6052602">nil</span><br>
<span class="lineno">280</span><span class="op" id="6052606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6052609">func</span>&nbsp;<span class="ident" id="6052614">readDataDescriptor</span><span class="op" id="6052632">(</span><span class="ident" id="6052633">r</span>&nbsp;<span class="ident" id="6052635">io</span><span class="op" id="6052637">.</span><span class="ident" id="6052638">Reader</span><span class="op" id="6052644">,</span>&nbsp;<span class="ident" id="6052646">f</span>&nbsp;<span class="op" id="6052648">*</span><span class="ident" id="6052649">File</span><span class="op" id="6052653">)</span>&nbsp;<span class="builtintype" id="6052655">error</span>&nbsp;<span class="op" id="6052661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6052664">var</span>&nbsp;<span class="ident" id="6052668">buf</span>&nbsp;<span class="op" id="6052672">[</span><span class="ident" id="6052673">dataDescriptorLen</span><span class="op" id="6052690">]</span><span class="builtintype" id="6052691">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052698">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052753">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052815">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052872">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052927">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6052987">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053051">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053091">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053095">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053156">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053211">if</span>&nbsp;<span class="ident" id="6053214">_</span><span class="op" id="6053215">,</span>&nbsp;<span class="ident" id="6053217">err</span>&nbsp;<span class="op" id="6053221">:=</span>&nbsp;<span class="ident" id="6053224">io</span><span class="op" id="6053226">.</span><span class="ident" id="6053227">ReadFull</span><span class="op" id="6053235">(</span><span class="ident" id="6053236">r</span><span class="op" id="6053237">,</span>&nbsp;<span class="ident" id="6053239">buf</span><span class="op" id="6053242">[</span><span class="op" id="6053243">:</span><span class="num" id="6053244">4</span><span class="op" id="6053245">]</span><span class="op" id="6053246">)</span><span class="op" id="6053247">;</span>&nbsp;<span class="ident" id="6053249">err</span>&nbsp;<span class="op" id="6053253">!=</span>&nbsp;<span class="ident" id="6053256">nil</span>&nbsp;<span class="op" id="6053260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053264">return</span>&nbsp;<span class="ident" id="6053271">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053279">off</span>&nbsp;<span class="op" id="6053283">:=</span>&nbsp;<span class="num" id="6053286">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053289">maybeSig</span>&nbsp;<span class="op" id="6053298">:=</span>&nbsp;<span class="ident" id="6053301">readBuf</span><span class="op" id="6053308">(</span><span class="ident" id="6053309">buf</span><span class="op" id="6053312">[</span><span class="op" id="6053313">:</span><span class="num" id="6053314">4</span><span class="op" id="6053315">]</span><span class="op" id="6053316">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053319">if</span>&nbsp;<span class="ident" id="6053322">maybeSig</span><span class="op" id="6053330">.</span><span class="builtintype" id="6053331">uint32</span><span class="op" id="6053337">(</span><span class="op" id="6053338">)</span>&nbsp;<span class="op" id="6053340">!=</span>&nbsp;<span class="ident" id="6053343">dataDescriptorSignature</span>&nbsp;<span class="op" id="6053367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053371">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053422">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053434">off</span>&nbsp;<span class="op" id="6053438">+=</span>&nbsp;<span class="num" id="6053441">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053444">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053447">if</span>&nbsp;<span class="ident" id="6053450">_</span><span class="op" id="6053451">,</span>&nbsp;<span class="ident" id="6053453">err</span>&nbsp;<span class="op" id="6053457">:=</span>&nbsp;<span class="ident" id="6053460">io</span><span class="op" id="6053462">.</span><span class="ident" id="6053463">ReadFull</span><span class="op" id="6053471">(</span><span class="ident" id="6053472">r</span><span class="op" id="6053473">,</span>&nbsp;<span class="ident" id="6053475">buf</span><span class="op" id="6053478">[</span><span class="ident" id="6053479">off</span><span class="op" id="6053482">:</span><span class="num" id="6053483">12</span><span class="op" id="6053485">]</span><span class="op" id="6053486">)</span><span class="op" id="6053487">;</span>&nbsp;<span class="ident" id="6053489">err</span>&nbsp;<span class="op" id="6053493">!=</span>&nbsp;<span class="ident" id="6053496">nil</span>&nbsp;<span class="op" id="6053500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053504">return</span>&nbsp;<span class="ident" id="6053511">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6053519">b</span>&nbsp;<span class="op" id="6053521">:=</span>&nbsp;<span class="ident" id="6053524">readBuf</span><span class="op" id="6053531">(</span><span class="ident" id="6053532">buf</span><span class="op" id="6053535">[</span><span class="op" id="6053536">:</span><span class="num" id="6053537">12</span><span class="op" id="6053539">]</span><span class="op" id="6053540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053543">if</span>&nbsp;<span class="ident" id="6053546">b</span><span class="op" id="6053547">.</span><span class="builtintype" id="6053548">uint32</span><span class="op" id="6053554">(</span><span class="op" id="6053555">)</span>&nbsp;<span class="op" id="6053557">!=</span>&nbsp;<span class="ident" id="6053560">f</span><span class="op" id="6053561">.</span><span class="ident" id="6053562">CRC32</span>&nbsp;<span class="op" id="6053568">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053572">return</span>&nbsp;<span class="ident" id="6053579">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6053592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053596">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053664">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053721">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053785">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053849">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6053873">return</span>&nbsp;<span class="ident" id="6053880">nil</span><br>
<span class="lineno">320</span><span class="op" id="6053884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6053887">func</span>&nbsp;<span class="ident" id="6053892">readDirectoryEnd</span><span class="op" id="6053908">(</span><span class="ident" id="6053909">r</span>&nbsp;<span class="ident" id="6053911">io</span><span class="op" id="6053913">.</span><span class="ident" id="6053914">ReaderAt</span><span class="op" id="6053922">,</span>&nbsp;<span class="ident" id="6053924">size</span>&nbsp;<span class="ident" id="6053929">int64</span><span class="op" id="6053934">)</span>&nbsp;<span class="op" id="6053936">(</span><span class="ident" id="6053937">dir</span>&nbsp;<span class="op" id="6053941">*</span><span class="ident" id="6053942">directoryEnd</span><span class="op" id="6053954">,</span>&nbsp;<span class="ident" id="6053956">err</span>&nbsp;<span class="builtintype" id="6053960">error</span><span class="op" id="6053965">)</span>&nbsp;<span class="op" id="6053967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6053970">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054042">var</span>&nbsp;<span class="ident" id="6054046">buf</span>&nbsp;<span class="op" id="6054050">[</span><span class="op" id="6054051">]</span><span class="builtintype" id="6054052">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054058">var</span>&nbsp;<span class="ident" id="6054062">directoryEndOffset</span>&nbsp;<span class="ident" id="6054081">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054088">for</span>&nbsp;<span class="ident" id="6054092">i</span><span class="op" id="6054093">,</span>&nbsp;<span class="ident" id="6054095">bLen</span>&nbsp;<span class="op" id="6054100">:=</span>&nbsp;<span class="keyword" id="6054103">range</span>&nbsp;<span class="op" id="6054109">[</span><span class="op" id="6054110">]</span><span class="ident" id="6054111">int64</span><span class="op" id="6054116">{</span><span class="num" id="6054117">1024</span><span class="op" id="6054121">,</span>&nbsp;<span class="num" id="6054123">65</span>&nbsp;<span class="op" id="6054126">*</span>&nbsp;<span class="num" id="6054128">1024</span><span class="op" id="6054132">}</span>&nbsp;<span class="op" id="6054134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054138">if</span>&nbsp;<span class="ident" id="6054141">bLen</span>&nbsp;<span class="op" id="6054146">&gt;</span>&nbsp;<span class="ident" id="6054148">size</span>&nbsp;<span class="op" id="6054153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054158">bLen</span>&nbsp;<span class="op" id="6054163">=</span>&nbsp;<span class="ident" id="6054165">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054172">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054176">buf</span>&nbsp;<span class="op" id="6054180">=</span>&nbsp;<span class="builtinfunc" id="6054182">make</span><span class="op" id="6054186">(</span><span class="op" id="6054187">[</span><span class="op" id="6054188">]</span><span class="builtintype" id="6054189">byte</span><span class="op" id="6054193">,</span>&nbsp;<span class="builtintype" id="6054195">int</span><span class="op" id="6054198">(</span><span class="ident" id="6054199">bLen</span><span class="op" id="6054203">)</span><span class="op" id="6054204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054208">if</span>&nbsp;<span class="ident" id="6054211">_</span><span class="op" id="6054212">,</span>&nbsp;<span class="ident" id="6054214">err</span>&nbsp;<span class="op" id="6054218">:=</span>&nbsp;<span class="ident" id="6054221">r</span><span class="op" id="6054222">.</span><span class="ident" id="6054223">ReadAt</span><span class="op" id="6054229">(</span><span class="ident" id="6054230">buf</span><span class="op" id="6054233">,</span>&nbsp;<span class="ident" id="6054235">size</span><span class="op" id="6054239">-</span><span class="ident" id="6054240">bLen</span><span class="op" id="6054244">)</span><span class="op" id="6054245">;</span>&nbsp;<span class="ident" id="6054247">err</span>&nbsp;<span class="op" id="6054251">!=</span>&nbsp;<span class="ident" id="6054254">nil</span>&nbsp;<span class="op" id="6054258">&amp;&amp;</span>&nbsp;<span class="ident" id="6054261">err</span>&nbsp;<span class="op" id="6054265">!=</span>&nbsp;<span class="ident" id="6054268">io</span><span class="op" id="6054270">.</span><span class="ident" id="6054271">EOF</span>&nbsp;<span class="op" id="6054275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054280">return</span>&nbsp;<span class="ident" id="6054287">nil</span><span class="op" id="6054290">,</span>&nbsp;<span class="ident" id="6054292">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054302">if</span>&nbsp;<span class="ident" id="6054305">p</span>&nbsp;<span class="op" id="6054307">:=</span>&nbsp;<span class="ident" id="6054310">findSignatureInBlock</span><span class="op" id="6054330">(</span><span class="ident" id="6054331">buf</span><span class="op" id="6054334">)</span><span class="op" id="6054335">;</span>&nbsp;<span class="ident" id="6054337">p</span>&nbsp;<span class="op" id="6054339">&gt;=</span>&nbsp;<span class="num" id="6054342">0</span>&nbsp;<span class="op" id="6054344">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054349">buf</span>&nbsp;<span class="op" id="6054353">=</span>&nbsp;<span class="ident" id="6054355">buf</span><span class="op" id="6054358">[</span><span class="ident" id="6054359">p</span><span class="op" id="6054360">:</span><span class="op" id="6054361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054366">directoryEndOffset</span>&nbsp;<span class="op" id="6054385">=</span>&nbsp;<span class="ident" id="6054387">size</span>&nbsp;<span class="op" id="6054392">-</span>&nbsp;<span class="ident" id="6054394">bLen</span>&nbsp;<span class="op" id="6054399">+</span>&nbsp;<span class="ident" id="6054401">int64</span><span class="op" id="6054406">(</span><span class="ident" id="6054407">p</span><span class="op" id="6054408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054413">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054425">if</span>&nbsp;<span class="ident" id="6054428">i</span>&nbsp;<span class="op" id="6054430">==</span>&nbsp;<span class="num" id="6054433">1</span>&nbsp;<span class="op" id="6054435">||</span>&nbsp;<span class="ident" id="6054438">bLen</span>&nbsp;<span class="op" id="6054443">==</span>&nbsp;<span class="ident" id="6054446">size</span>&nbsp;<span class="op" id="6054451">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054456">return</span>&nbsp;<span class="ident" id="6054463">nil</span><span class="op" id="6054466">,</span>&nbsp;<span class="ident" id="6054468">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6054487">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054515">b</span>&nbsp;<span class="op" id="6054517">:=</span>&nbsp;<span class="ident" id="6054520">readBuf</span><span class="op" id="6054527">(</span><span class="ident" id="6054528">buf</span><span class="op" id="6054531">[</span><span class="num" id="6054532">4</span><span class="op" id="6054533">:</span><span class="op" id="6054534">]</span><span class="op" id="6054535">)</span>&nbsp;<span class="comment" id="6054537">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054556">d</span>&nbsp;<span class="op" id="6054558">:=</span>&nbsp;<span class="op" id="6054561">&amp;</span><span class="ident" id="6054562">directoryEnd</span><span class="op" id="6054574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054578">diskNbr</span><span class="op" id="6054585">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6054598">uint32</span><span class="op" id="6054604">(</span><span class="ident" id="6054605">b</span><span class="op" id="6054606">.</span><span class="builtintype" id="6054607">uint16</span><span class="op" id="6054613">(</span><span class="op" id="6054614">)</span><span class="op" id="6054615">)</span><span class="op" id="6054616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054620">dirDiskNbr</span><span class="op" id="6054630">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6054640">uint32</span><span class="op" id="6054646">(</span><span class="ident" id="6054647">b</span><span class="op" id="6054648">.</span><span class="builtintype" id="6054649">uint16</span><span class="op" id="6054655">(</span><span class="op" id="6054656">)</span><span class="op" id="6054657">)</span><span class="op" id="6054658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054662">dirRecordsThisDisk</span><span class="op" id="6054680">:</span>&nbsp;<span class="ident" id="6054682">uint64</span><span class="op" id="6054688">(</span><span class="ident" id="6054689">b</span><span class="op" id="6054690">.</span><span class="builtintype" id="6054691">uint16</span><span class="op" id="6054697">(</span><span class="op" id="6054698">)</span><span class="op" id="6054699">)</span><span class="op" id="6054700">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054704">directoryRecords</span><span class="op" id="6054720">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6054724">uint64</span><span class="op" id="6054730">(</span><span class="ident" id="6054731">b</span><span class="op" id="6054732">.</span><span class="builtintype" id="6054733">uint16</span><span class="op" id="6054739">(</span><span class="op" id="6054740">)</span><span class="op" id="6054741">)</span><span class="op" id="6054742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054746">directorySize</span><span class="op" id="6054759">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054766">uint64</span><span class="op" id="6054772">(</span><span class="ident" id="6054773">b</span><span class="op" id="6054774">.</span><span class="builtintype" id="6054775">uint32</span><span class="op" id="6054781">(</span><span class="op" id="6054782">)</span><span class="op" id="6054783">)</span><span class="op" id="6054784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054788">directoryOffset</span><span class="op" id="6054803">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054808">uint64</span><span class="op" id="6054814">(</span><span class="ident" id="6054815">b</span><span class="op" id="6054816">.</span><span class="builtintype" id="6054817">uint32</span><span class="op" id="6054823">(</span><span class="op" id="6054824">)</span><span class="op" id="6054825">)</span><span class="op" id="6054826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054830">commentLen</span><span class="op" id="6054840">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6054850">b</span><span class="op" id="6054851">.</span><span class="builtintype" id="6054852">uint16</span><span class="op" id="6054858">(</span><span class="op" id="6054859">)</span><span class="op" id="6054860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054863">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054866">l</span>&nbsp;<span class="op" id="6054868">:=</span>&nbsp;<span class="builtintype" id="6054871">int</span><span class="op" id="6054874">(</span><span class="ident" id="6054875">d</span><span class="op" id="6054876">.</span><span class="ident" id="6054877">commentLen</span><span class="op" id="6054887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054890">if</span>&nbsp;<span class="ident" id="6054893">l</span>&nbsp;<span class="op" id="6054895">&gt;</span>&nbsp;<span class="builtinfunc" id="6054897">len</span><span class="op" id="6054900">(</span><span class="ident" id="6054901">b</span><span class="op" id="6054902">)</span>&nbsp;<span class="op" id="6054904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6054908">return</span>&nbsp;<span class="ident" id="6054915">nil</span><span class="op" id="6054918">,</span>&nbsp;<span class="ident" id="6054920">errors</span><span class="op" id="6054926">.</span><span class="ident" id="6054927">New</span><span class="op" id="6054930">(</span><span class="string" id="6054931">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6054960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6054963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054966">d</span><span class="op" id="6054967">.</span><span class="ident" id="6054968">comment</span>&nbsp;<span class="op" id="6054976">=</span>&nbsp;<span class="builtintype" id="6054978">string</span><span class="op" id="6054984">(</span><span class="ident" id="6054985">b</span><span class="op" id="6054986">[</span><span class="op" id="6054987">:</span><span class="ident" id="6054988">l</span><span class="op" id="6054989">]</span><span class="op" id="6054990">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054994">p</span><span class="op" id="6054995">,</span>&nbsp;<span class="ident" id="6054997">err</span>&nbsp;<span class="op" id="6055001">:=</span>&nbsp;<span class="ident" id="6055004">findDirectory64End</span><span class="op" id="6055022">(</span><span class="ident" id="6055023">r</span><span class="op" id="6055024">,</span>&nbsp;<span class="ident" id="6055026">directoryEndOffset</span><span class="op" id="6055044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055047">if</span>&nbsp;<span class="ident" id="6055050">err</span>&nbsp;<span class="op" id="6055054">==</span>&nbsp;<span class="ident" id="6055057">nil</span>&nbsp;<span class="op" id="6055061">&amp;&amp;</span>&nbsp;<span class="ident" id="6055064">p</span>&nbsp;<span class="op" id="6055066">&gt;=</span>&nbsp;<span class="num" id="6055069">0</span>&nbsp;<span class="op" id="6055071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055075">err</span>&nbsp;<span class="op" id="6055079">=</span>&nbsp;<span class="ident" id="6055081">readDirectory64End</span><span class="op" id="6055099">(</span><span class="ident" id="6055100">r</span><span class="op" id="6055101">,</span>&nbsp;<span class="ident" id="6055103">p</span><span class="op" id="6055104">,</span>&nbsp;<span class="ident" id="6055106">d</span><span class="op" id="6055107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055110">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055113">if</span>&nbsp;<span class="ident" id="6055116">err</span>&nbsp;<span class="op" id="6055120">!=</span>&nbsp;<span class="ident" id="6055123">nil</span>&nbsp;<span class="op" id="6055127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055131">return</span>&nbsp;<span class="ident" id="6055138">nil</span><span class="op" id="6055141">,</span>&nbsp;<span class="ident" id="6055143">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6055152">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055215">if</span>&nbsp;<span class="ident" id="6055218">o</span>&nbsp;<span class="op" id="6055220">:=</span>&nbsp;<span class="ident" id="6055223">int64</span><span class="op" id="6055228">(</span><span class="ident" id="6055229">d</span><span class="op" id="6055230">.</span><span class="ident" id="6055231">directoryOffset</span><span class="op" id="6055246">)</span><span class="op" id="6055247">;</span>&nbsp;<span class="ident" id="6055249">o</span>&nbsp;<span class="op" id="6055251">&lt;</span>&nbsp;<span class="num" id="6055253">0</span>&nbsp;<span class="op" id="6055255">||</span>&nbsp;<span class="ident" id="6055258">o</span>&nbsp;<span class="op" id="6055260">&gt;=</span>&nbsp;<span class="ident" id="6055263">size</span>&nbsp;<span class="op" id="6055268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055272">return</span>&nbsp;<span class="ident" id="6055279">nil</span><span class="op" id="6055282">,</span>&nbsp;<span class="ident" id="6055284">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055298">return</span>&nbsp;<span class="ident" id="6055305">d</span><span class="op" id="6055306">,</span>&nbsp;<span class="ident" id="6055308">nil</span><br>
<span class="lineno"></span><span class="op" id="6055312">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6055315">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6055385">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6055455">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6055465">func</span>&nbsp;<span class="ident" id="6055470">findDirectory64End</span><span class="op" id="6055488">(</span><span class="ident" id="6055489">r</span>&nbsp;<span class="ident" id="6055491">io</span><span class="op" id="6055493">.</span><span class="ident" id="6055494">ReaderAt</span><span class="op" id="6055502">,</span>&nbsp;<span class="ident" id="6055504">directoryEndOffset</span>&nbsp;<span class="ident" id="6055523">int64</span><span class="op" id="6055528">)</span>&nbsp;<span class="op" id="6055530">(</span><span class="ident" id="6055531">int64</span><span class="op" id="6055536">,</span>&nbsp;<span class="builtintype" id="6055538">error</span><span class="op" id="6055543">)</span>&nbsp;<span class="op" id="6055545">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055548">locOffset</span>&nbsp;<span class="op" id="6055558">:=</span>&nbsp;<span class="ident" id="6055561">directoryEndOffset</span>&nbsp;<span class="op" id="6055580">-</span>&nbsp;<span class="ident" id="6055582">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055601">if</span>&nbsp;<span class="ident" id="6055604">locOffset</span>&nbsp;<span class="op" id="6055614">&lt;</span>&nbsp;<span class="num" id="6055616">0</span>&nbsp;<span class="op" id="6055618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055622">return</span>&nbsp;<span class="op" id="6055629">-</span><span class="num" id="6055630">1</span><span class="op" id="6055631">,</span>&nbsp;<span class="ident" id="6055633">nil</span>&nbsp;<span class="comment" id="6055637">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055690">buf</span>&nbsp;<span class="op" id="6055694">:=</span>&nbsp;<span class="builtinfunc" id="6055697">make</span><span class="op" id="6055701">(</span><span class="op" id="6055702">[</span><span class="op" id="6055703">]</span><span class="builtintype" id="6055704">byte</span><span class="op" id="6055708">,</span>&nbsp;<span class="ident" id="6055710">directory64LocLen</span><span class="op" id="6055727">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055730">if</span>&nbsp;<span class="ident" id="6055733">_</span><span class="op" id="6055734">,</span>&nbsp;<span class="ident" id="6055736">err</span>&nbsp;<span class="op" id="6055740">:=</span>&nbsp;<span class="ident" id="6055743">r</span><span class="op" id="6055744">.</span><span class="ident" id="6055745">ReadAt</span><span class="op" id="6055751">(</span><span class="ident" id="6055752">buf</span><span class="op" id="6055755">,</span>&nbsp;<span class="ident" id="6055757">locOffset</span><span class="op" id="6055766">)</span><span class="op" id="6055767">;</span>&nbsp;<span class="ident" id="6055769">err</span>&nbsp;<span class="op" id="6055773">!=</span>&nbsp;<span class="ident" id="6055776">nil</span>&nbsp;<span class="op" id="6055780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055784">return</span>&nbsp;<span class="op" id="6055791">-</span><span class="num" id="6055792">1</span><span class="op" id="6055793">,</span>&nbsp;<span class="ident" id="6055795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055803">b</span>&nbsp;<span class="op" id="6055805">:=</span>&nbsp;<span class="ident" id="6055808">readBuf</span><span class="op" id="6055815">(</span><span class="ident" id="6055816">buf</span><span class="op" id="6055819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055822">if</span>&nbsp;<span class="ident" id="6055825">sig</span>&nbsp;<span class="op" id="6055829">:=</span>&nbsp;<span class="ident" id="6055832">b</span><span class="op" id="6055833">.</span><span class="builtintype" id="6055834">uint32</span><span class="op" id="6055840">(</span><span class="op" id="6055841">)</span><span class="op" id="6055842">;</span>&nbsp;<span class="ident" id="6055844">sig</span>&nbsp;<span class="op" id="6055848">!=</span>&nbsp;<span class="ident" id="6055851">directory64LocSignature</span>&nbsp;<span class="op" id="6055875">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055879">return</span>&nbsp;<span class="op" id="6055886">-</span><span class="num" id="6055887">1</span><span class="op" id="6055888">,</span>&nbsp;<span class="ident" id="6055890">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055898">b</span>&nbsp;<span class="op" id="6055900">=</span>&nbsp;<span class="ident" id="6055902">b</span><span class="op" id="6055903">[</span><span class="num" id="6055904">4</span><span class="op" id="6055905">:</span><span class="op" id="6055906">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6055914">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055995">p</span>&nbsp;<span class="op" id="6055997">:=</span>&nbsp;<span class="ident" id="6056000">b</span><span class="op" id="6056001">.</span><span class="ident" id="6056002">uint64</span><span class="op" id="6056008">(</span><span class="op" id="6056009">)</span>&nbsp;<span class="comment" id="6056011">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056076">return</span>&nbsp;<span class="ident" id="6056083">int64</span><span class="op" id="6056088">(</span><span class="ident" id="6056089">p</span><span class="op" id="6056090">)</span><span class="op" id="6056091">,</span>&nbsp;<span class="ident" id="6056093">nil</span><br>
<span class="lineno">395</span><span class="op" id="6056097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6056100">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6056168">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6056222">func</span>&nbsp;<span class="ident" id="6056227">readDirectory64End</span><span class="op" id="6056245">(</span><span class="ident" id="6056246">r</span>&nbsp;<span class="ident" id="6056248">io</span><span class="op" id="6056250">.</span><span class="ident" id="6056251">ReaderAt</span><span class="op" id="6056259">,</span>&nbsp;<span class="ident" id="6056261">offset</span>&nbsp;<span class="ident" id="6056268">int64</span><span class="op" id="6056273">,</span>&nbsp;<span class="ident" id="6056275">d</span>&nbsp;<span class="op" id="6056277">*</span><span class="ident" id="6056278">directoryEnd</span><span class="op" id="6056290">)</span>&nbsp;<span class="op" id="6056292">(</span><span class="ident" id="6056293">err</span>&nbsp;<span class="builtintype" id="6056297">error</span><span class="op" id="6056302">)</span>&nbsp;<span class="op" id="6056304">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056307">buf</span>&nbsp;<span class="op" id="6056311">:=</span>&nbsp;<span class="builtinfunc" id="6056314">make</span><span class="op" id="6056318">(</span><span class="op" id="6056319">[</span><span class="op" id="6056320">]</span><span class="builtintype" id="6056321">byte</span><span class="op" id="6056325">,</span>&nbsp;<span class="ident" id="6056327">directory64EndLen</span><span class="op" id="6056344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056347">if</span>&nbsp;<span class="ident" id="6056350">_</span><span class="op" id="6056351">,</span>&nbsp;<span class="ident" id="6056353">err</span>&nbsp;<span class="op" id="6056357">:=</span>&nbsp;<span class="ident" id="6056360">r</span><span class="op" id="6056361">.</span><span class="ident" id="6056362">ReadAt</span><span class="op" id="6056368">(</span><span class="ident" id="6056369">buf</span><span class="op" id="6056372">,</span>&nbsp;<span class="ident" id="6056374">offset</span><span class="op" id="6056380">)</span><span class="op" id="6056381">;</span>&nbsp;<span class="ident" id="6056383">err</span>&nbsp;<span class="op" id="6056387">!=</span>&nbsp;<span class="ident" id="6056390">nil</span>&nbsp;<span class="op" id="6056394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056398">return</span>&nbsp;<span class="ident" id="6056405">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056414">b</span>&nbsp;<span class="op" id="6056416">:=</span>&nbsp;<span class="ident" id="6056419">readBuf</span><span class="op" id="6056426">(</span><span class="ident" id="6056427">buf</span><span class="op" id="6056430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056433">if</span>&nbsp;<span class="ident" id="6056436">sig</span>&nbsp;<span class="op" id="6056440">:=</span>&nbsp;<span class="ident" id="6056443">b</span><span class="op" id="6056444">.</span><span class="builtintype" id="6056445">uint32</span><span class="op" id="6056451">(</span><span class="op" id="6056452">)</span><span class="op" id="6056453">;</span>&nbsp;<span class="ident" id="6056455">sig</span>&nbsp;<span class="op" id="6056459">!=</span>&nbsp;<span class="ident" id="6056462">directory64EndSignature</span>&nbsp;<span class="op" id="6056486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056490">return</span>&nbsp;<span class="ident" id="6056497">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056512">b</span>&nbsp;<span class="op" id="6056514">=</span>&nbsp;<span class="ident" id="6056516">b</span><span class="op" id="6056517">[</span><span class="num" id="6056518">12</span><span class="op" id="6056520">:</span><span class="op" id="6056521">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056546">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056613">d</span><span class="op" id="6056614">.</span><span class="ident" id="6056615">diskNbr</span>&nbsp;<span class="op" id="6056623">=</span>&nbsp;<span class="ident" id="6056625">b</span><span class="op" id="6056626">.</span><span class="builtintype" id="6056627">uint32</span><span class="op" id="6056633">(</span><span class="op" id="6056634">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056647">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056671">d</span><span class="op" id="6056672">.</span><span class="ident" id="6056673">dirDiskNbr</span>&nbsp;<span class="op" id="6056684">=</span>&nbsp;<span class="ident" id="6056686">b</span><span class="op" id="6056687">.</span><span class="builtintype" id="6056688">uint32</span><span class="op" id="6056694">(</span><span class="op" id="6056695">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056705">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056768">d</span><span class="op" id="6056769">.</span><span class="ident" id="6056770">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6056789">=</span>&nbsp;<span class="ident" id="6056791">b</span><span class="op" id="6056792">.</span><span class="ident" id="6056793">uint64</span><span class="op" id="6056799">(</span><span class="op" id="6056800">)</span>&nbsp;<span class="comment" id="6056802">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056868">d</span><span class="op" id="6056869">.</span><span class="ident" id="6056870">directoryRecords</span>&nbsp;<span class="op" id="6056887">=</span>&nbsp;<span class="ident" id="6056889">b</span><span class="op" id="6056890">.</span><span class="ident" id="6056891">uint64</span><span class="op" id="6056897">(</span><span class="op" id="6056898">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6056902">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056955">d</span><span class="op" id="6056956">.</span><span class="ident" id="6056957">directorySize</span>&nbsp;<span class="op" id="6056971">=</span>&nbsp;<span class="ident" id="6056973">b</span><span class="op" id="6056974">.</span><span class="ident" id="6056975">uint64</span><span class="op" id="6056981">(</span><span class="op" id="6056982">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6056989">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057023">d</span><span class="op" id="6057024">.</span><span class="ident" id="6057025">directoryOffset</span>&nbsp;<span class="op" id="6057041">=</span>&nbsp;<span class="ident" id="6057043">b</span><span class="op" id="6057044">.</span><span class="ident" id="6057045">uint64</span><span class="op" id="6057051">(</span><span class="op" id="6057052">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6057057">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057140">return</span>&nbsp;<span class="ident" id="6057147">nil</span><br>
<span class="lineno"></span><span class="op" id="6057151">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6057154">func</span>&nbsp;<span class="ident" id="6057159">findSignatureInBlock</span><span class="op" id="6057179">(</span><span class="ident" id="6057180">b</span>&nbsp;<span class="op" id="6057182">[</span><span class="op" id="6057183">]</span><span class="builtintype" id="6057184">byte</span><span class="op" id="6057188">)</span>&nbsp;<span class="builtintype" id="6057190">int</span>&nbsp;<span class="op" id="6057194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057197">for</span>&nbsp;<span class="ident" id="6057201">i</span>&nbsp;<span class="op" id="6057203">:=</span>&nbsp;<span class="builtinfunc" id="6057206">len</span><span class="op" id="6057209">(</span><span class="ident" id="6057210">b</span><span class="op" id="6057211">)</span>&nbsp;<span class="op" id="6057213">-</span>&nbsp;<span class="ident" id="6057215">directoryEndLen</span><span class="op" id="6057230">;</span>&nbsp;<span class="ident" id="6057232">i</span>&nbsp;<span class="op" id="6057234">&gt;=</span>&nbsp;<span class="num" id="6057237">0</span><span class="op" id="6057238">;</span>&nbsp;<span class="ident" id="6057240">i</span><span class="op" id="6057241">--</span>&nbsp;<span class="op" id="6057244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6057248">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057301">if</span>&nbsp;<span class="ident" id="6057304">b</span><span class="op" id="6057305">[</span><span class="ident" id="6057306">i</span><span class="op" id="6057307">]</span>&nbsp;<span class="op" id="6057309">==</span>&nbsp;<span class="string" id="6057312">&#39;P&#39;</span>&nbsp;<span class="op" id="6057316">&amp;&amp;</span>&nbsp;<span class="ident" id="6057319">b</span><span class="op" id="6057320">[</span><span class="ident" id="6057321">i</span><span class="op" id="6057322">+</span><span class="num" id="6057323">1</span><span class="op" id="6057324">]</span>&nbsp;<span class="op" id="6057326">==</span>&nbsp;<span class="string" id="6057329">&#39;K&#39;</span>&nbsp;<span class="op" id="6057333">&amp;&amp;</span>&nbsp;<span class="ident" id="6057336">b</span><span class="op" id="6057337">[</span><span class="ident" id="6057338">i</span><span class="op" id="6057339">+</span><span class="num" id="6057340">2</span><span class="op" id="6057341">]</span>&nbsp;<span class="op" id="6057343">==</span>&nbsp;<span class="num" id="6057346">0x05</span>&nbsp;<span class="op" id="6057351">&amp;&amp;</span>&nbsp;<span class="ident" id="6057354">b</span><span class="op" id="6057355">[</span><span class="ident" id="6057356">i</span><span class="op" id="6057357">+</span><span class="num" id="6057358">3</span><span class="op" id="6057359">]</span>&nbsp;<span class="op" id="6057361">==</span>&nbsp;<span class="num" id="6057364">0x06</span>&nbsp;<span class="op" id="6057369">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6057374">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057403">n</span>&nbsp;<span class="op" id="6057405">:=</span>&nbsp;<span class="builtintype" id="6057408">int</span><span class="op" id="6057411">(</span><span class="ident" id="6057412">b</span><span class="op" id="6057413">[</span><span class="ident" id="6057414">i</span><span class="op" id="6057415">+</span><span class="ident" id="6057416">directoryEndLen</span><span class="op" id="6057431">-</span><span class="num" id="6057432">2</span><span class="op" id="6057433">]</span><span class="op" id="6057434">)</span>&nbsp;<span class="op" id="6057436">|</span>&nbsp;<span class="builtintype" id="6057438">int</span><span class="op" id="6057441">(</span><span class="ident" id="6057442">b</span><span class="op" id="6057443">[</span><span class="ident" id="6057444">i</span><span class="op" id="6057445">+</span><span class="ident" id="6057446">directoryEndLen</span><span class="op" id="6057461">-</span><span class="num" id="6057462">1</span><span class="op" id="6057463">]</span><span class="op" id="6057464">)</span><span class="op" id="6057465">&lt;&lt;</span><span class="num" id="6057467">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057472">if</span>&nbsp;<span class="ident" id="6057475">n</span><span class="op" id="6057476">+</span><span class="ident" id="6057477">directoryEndLen</span><span class="op" id="6057492">+</span><span class="ident" id="6057493">i</span>&nbsp;<span class="op" id="6057495">&lt;=</span>&nbsp;<span class="builtinfunc" id="6057498">len</span><span class="op" id="6057501">(</span><span class="ident" id="6057502">b</span><span class="op" id="6057503">)</span>&nbsp;<span class="op" id="6057505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057511">return</span>&nbsp;<span class="ident" id="6057518">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057523">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057533">return</span>&nbsp;<span class="op" id="6057540">-</span><span class="num" id="6057541">1</span><br>
<span class="lineno"></span><span class="op" id="6057543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6057546">type</span>&nbsp;<span class="ident" id="6057551">readBuf</span>&nbsp;<span class="op" id="6057559">[</span><span class="op" id="6057560">]</span><span class="builtintype" id="6057561">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6057567">func</span>&nbsp;<span class="op" id="6057572">(</span><span class="ident" id="6057573">b</span>&nbsp;<span class="op" id="6057575">*</span><span class="ident" id="6057576">readBuf</span><span class="op" id="6057583">)</span>&nbsp;<span class="builtintype" id="6057585">uint16</span><span class="op" id="6057591">(</span><span class="op" id="6057592">)</span>&nbsp;<span class="builtintype" id="6057594">uint16</span>&nbsp;<span class="op" id="6057601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057604">v</span>&nbsp;<span class="op" id="6057606">:=</span>&nbsp;<span class="ident" id="6057609">binary</span><span class="op" id="6057615">.</span><span class="ident" id="6057616">LittleEndian</span><span class="op" id="6057628">.</span><span class="ident" id="6057629">Uint16</span><span class="op" id="6057635">(</span><span class="op" id="6057636">*</span><span class="ident" id="6057637">b</span><span class="op" id="6057638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057641">*</span><span class="ident" id="6057642">b</span>&nbsp;<span class="op" id="6057644">=</span>&nbsp;<span class="op" id="6057646">(</span><span class="op" id="6057647">*</span><span class="ident" id="6057648">b</span><span class="op" id="6057649">)</span><span class="op" id="6057650">[</span><span class="num" id="6057651">2</span><span class="op" id="6057652">:</span><span class="op" id="6057653">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057656">return</span>&nbsp;<span class="ident" id="6057663">v</span><br>
<span class="lineno"></span><span class="op" id="6057665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6057668">func</span>&nbsp;<span class="op" id="6057673">(</span><span class="ident" id="6057674">b</span>&nbsp;<span class="op" id="6057676">*</span><span class="ident" id="6057677">readBuf</span><span class="op" id="6057684">)</span>&nbsp;<span class="builtintype" id="6057686">uint32</span><span class="op" id="6057692">(</span><span class="op" id="6057693">)</span>&nbsp;<span class="builtintype" id="6057695">uint32</span>&nbsp;<span class="op" id="6057702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057705">v</span>&nbsp;<span class="op" id="6057707">:=</span>&nbsp;<span class="ident" id="6057710">binary</span><span class="op" id="6057716">.</span><span class="ident" id="6057717">LittleEndian</span><span class="op" id="6057729">.</span><span class="ident" id="6057730">Uint32</span><span class="op" id="6057736">(</span><span class="op" id="6057737">*</span><span class="ident" id="6057738">b</span><span class="op" id="6057739">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057742">*</span><span class="ident" id="6057743">b</span>&nbsp;<span class="op" id="6057745">=</span>&nbsp;<span class="op" id="6057747">(</span><span class="op" id="6057748">*</span><span class="ident" id="6057749">b</span><span class="op" id="6057750">)</span><span class="op" id="6057751">[</span><span class="num" id="6057752">4</span><span class="op" id="6057753">:</span><span class="op" id="6057754">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057757">return</span>&nbsp;<span class="ident" id="6057764">v</span><br>
<span class="lineno"></span><span class="op" id="6057766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6057769">func</span>&nbsp;<span class="op" id="6057774">(</span><span class="ident" id="6057775">b</span>&nbsp;<span class="op" id="6057777">*</span><span class="ident" id="6057778">readBuf</span><span class="op" id="6057785">)</span>&nbsp;<span class="ident" id="6057787">uint64</span><span class="op" id="6057793">(</span><span class="op" id="6057794">)</span>&nbsp;<span class="ident" id="6057796">uint64</span>&nbsp;<span class="op" id="6057803">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057806">v</span>&nbsp;<span class="op" id="6057808">:=</span>&nbsp;<span class="ident" id="6057811">binary</span><span class="op" id="6057817">.</span><span class="ident" id="6057818">LittleEndian</span><span class="op" id="6057830">.</span><span class="ident" id="6057831">Uint64</span><span class="op" id="6057837">(</span><span class="op" id="6057838">*</span><span class="ident" id="6057839">b</span><span class="op" id="6057840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057843">*</span><span class="ident" id="6057844">b</span>&nbsp;<span class="op" id="6057846">=</span>&nbsp;<span class="op" id="6057848">(</span><span class="op" id="6057849">*</span><span class="ident" id="6057850">b</span><span class="op" id="6057851">)</span><span class="op" id="6057852">[</span><span class="num" id="6057853">8</span><span class="op" id="6057854">:</span><span class="op" id="6057855">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057858">return</span>&nbsp;<span class="ident" id="6057865">v</span><br>
<span class="lineno"></span><span class="op" id="6057867">}</span>
</div>
</body>
</html>
