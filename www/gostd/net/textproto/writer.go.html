<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4310616">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4310672">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4310726">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4310777">package</span>&nbsp;<span class="ident" id="4310785">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4310796">import</span>&nbsp;<span class="op" id="4310803">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310806">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310815">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4310822">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4310827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4310830">//&nbsp;A&nbsp;Writer&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="4310885">//&nbsp;requests&nbsp;or&nbsp;responses&nbsp;to&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="4310949">type</span>&nbsp;<span class="ident" id="4310954">Writer</span>&nbsp;<span class="keyword" id="4310961">struct</span>&nbsp;<span class="op" id="4310968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310971">W</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4310975">*</span><span class="ident" id="4310976">bufio</span><span class="op" id="4310981">.</span><span class="ident" id="4310982">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4310990">dot</span>&nbsp;<span class="op" id="4310994">*</span><span class="ident" id="4310995">dotWriter</span><br>
<span class="lineno"></span><span class="op" id="4311005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4311008">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4311056">func</span>&nbsp;<span class="ident" id="4311061">NewWriter</span><span class="op" id="4311070">(</span><span class="ident" id="4311071">w</span>&nbsp;<span class="op" id="4311073">*</span><span class="ident" id="4311074">bufio</span><span class="op" id="4311079">.</span><span class="ident" id="4311080">Writer</span><span class="op" id="4311086">)</span>&nbsp;<span class="op" id="4311088">*</span><span class="ident" id="4311089">Writer</span>&nbsp;<span class="op" id="4311096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311099">return</span>&nbsp;<span class="op" id="4311106">&amp;</span><span class="ident" id="4311107">Writer</span><span class="op" id="4311113">{</span><span class="ident" id="4311114">W</span><span class="op" id="4311115">:</span>&nbsp;<span class="ident" id="4311117">w</span><span class="op" id="4311118">}</span><br>
<span class="lineno"></span><span class="op" id="4311120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4311123">var</span>&nbsp;<span class="ident" id="4311127">crnl</span>&nbsp;<span class="op" id="4311132">=</span>&nbsp;<span class="op" id="4311134">[</span><span class="op" id="4311135">]</span><span class="builtintype" id="4311136">byte</span><span class="op" id="4311140">{</span><span class="string" id="4311141">&#39;\r&#39;</span><span class="op" id="4311145">,</span>&nbsp;<span class="string" id="4311147">&#39;\n&#39;</span><span class="op" id="4311151">}</span><br>
<span class="lineno"></span><span class="keyword" id="4311153">var</span>&nbsp;<span class="ident" id="4311157">dotcrnl</span>&nbsp;<span class="op" id="4311165">=</span>&nbsp;<span class="op" id="4311167">[</span><span class="op" id="4311168">]</span><span class="builtintype" id="4311169">byte</span><span class="op" id="4311173">{</span><span class="string" id="4311174">&#39;.&#39;</span><span class="op" id="4311177">,</span>&nbsp;<span class="string" id="4311179">&#39;\r&#39;</span><span class="op" id="4311183">,</span>&nbsp;<span class="string" id="4311185">&#39;\n&#39;</span><span class="op" id="4311189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4311192">//&nbsp;PrintfLine&nbsp;writes&nbsp;the&nbsp;formatted&nbsp;output&nbsp;followed&nbsp;by&nbsp;\r\n.</span><br>
<span class="lineno"></span><span class="keyword" id="4311252">func</span>&nbsp;<span class="op" id="4311257">(</span><span class="ident" id="4311258">w</span>&nbsp;<span class="op" id="4311260">*</span><span class="ident" id="4311261">Writer</span><span class="op" id="4311267">)</span>&nbsp;<span class="ident" id="4311269">PrintfLine</span><span class="op" id="4311279">(</span><span class="ident" id="4311280">format</span>&nbsp;<span class="builtintype" id="4311287">string</span><span class="op" id="4311293">,</span>&nbsp;<span class="ident" id="4311295">args</span>&nbsp;<span class="op" id="4311300">...</span><span class="keyword" id="4311303">interface</span><span class="op" id="4311312">{</span><span class="op" id="4311313">}</span><span class="op" id="4311314">)</span>&nbsp;<span class="builtintype" id="4311316">error</span>&nbsp;<span class="op" id="4311322">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311325">w</span><span class="op" id="4311326">.</span><span class="ident" id="4311327">closeDot</span><span class="op" id="4311335">(</span><span class="op" id="4311336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311339">fmt</span><span class="op" id="4311342">.</span><span class="ident" id="4311343">Fprintf</span><span class="op" id="4311350">(</span><span class="ident" id="4311351">w</span><span class="op" id="4311352">.</span><span class="ident" id="4311353">W</span><span class="op" id="4311354">,</span>&nbsp;<span class="ident" id="4311356">format</span><span class="op" id="4311362">,</span>&nbsp;<span class="ident" id="4311364">args</span><span class="op" id="4311368">...</span><span class="op" id="4311371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311374">w</span><span class="op" id="4311375">.</span><span class="ident" id="4311376">W</span><span class="op" id="4311377">.</span><span class="ident" id="4311378">Write</span><span class="op" id="4311383">(</span><span class="ident" id="4311384">crnl</span><span class="op" id="4311388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311391">return</span>&nbsp;<span class="ident" id="4311398">w</span><span class="op" id="4311399">.</span><span class="ident" id="4311400">W</span><span class="op" id="4311401">.</span><span class="ident" id="4311402">Flush</span><span class="op" id="4311407">(</span><span class="op" id="4311408">)</span><br>
<span class="lineno"></span><span class="op" id="4311410">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="4311413">//&nbsp;DotWriter&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;a&nbsp;dot-encoding&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4311490">//&nbsp;It&nbsp;takes&nbsp;care&nbsp;of&nbsp;inserting&nbsp;leading&nbsp;dots&nbsp;when&nbsp;necessary,</span><br>
<span class="lineno"></span><span class="comment" id="4311549">//&nbsp;translating&nbsp;line-ending&nbsp;\n&nbsp;into&nbsp;\r\n,&nbsp;and&nbsp;adding&nbsp;the&nbsp;final&nbsp;.\r\n&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4311622">//&nbsp;when&nbsp;the&nbsp;DotWriter&nbsp;is&nbsp;closed.&nbsp;&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the</span><br>
<span class="lineno">40</span><span class="comment" id="4311684">//&nbsp;DotWriter&nbsp;before&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4311736">//</span><br>
<span class="lineno"></span><span class="comment" id="4311739">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Reader&#39;s&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4311826">func</span>&nbsp;<span class="op" id="4311831">(</span><span class="ident" id="4311832">w</span>&nbsp;<span class="op" id="4311834">*</span><span class="ident" id="4311835">Writer</span><span class="op" id="4311841">)</span>&nbsp;<span class="ident" id="4311843">DotWriter</span><span class="op" id="4311852">(</span><span class="op" id="4311853">)</span>&nbsp;<span class="ident" id="4311855">io</span><span class="op" id="4311857">.</span><span class="ident" id="4311858">WriteCloser</span>&nbsp;<span class="op" id="4311870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311873">w</span><span class="op" id="4311874">.</span><span class="ident" id="4311875">closeDot</span><span class="op" id="4311883">(</span><span class="op" id="4311884">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311887">w</span><span class="op" id="4311888">.</span><span class="ident" id="4311889">dot</span>&nbsp;<span class="op" id="4311893">=</span>&nbsp;<span class="op" id="4311895">&amp;</span><span class="ident" id="4311896">dotWriter</span><span class="op" id="4311905">{</span><span class="ident" id="4311906">w</span><span class="op" id="4311907">:</span>&nbsp;<span class="ident" id="4311909">w</span><span class="op" id="4311910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311913">return</span>&nbsp;<span class="ident" id="4311920">w</span><span class="op" id="4311921">.</span><span class="ident" id="4311922">dot</span><br>
<span class="lineno"></span><span class="op" id="4311926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4311929">func</span>&nbsp;<span class="op" id="4311934">(</span><span class="ident" id="4311935">w</span>&nbsp;<span class="op" id="4311937">*</span><span class="ident" id="4311938">Writer</span><span class="op" id="4311944">)</span>&nbsp;<span class="ident" id="4311946">closeDot</span><span class="op" id="4311954">(</span><span class="op" id="4311955">)</span>&nbsp;<span class="op" id="4311957">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4311960">if</span>&nbsp;<span class="ident" id="4311963">w</span><span class="op" id="4311964">.</span><span class="ident" id="4311965">dot</span>&nbsp;<span class="op" id="4311969">!=</span>&nbsp;<span class="ident" id="4311972">nil</span>&nbsp;<span class="op" id="4311976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4311980">w</span><span class="op" id="4311981">.</span><span class="ident" id="4311982">dot</span><span class="op" id="4311985">.</span><span class="ident" id="4311986">Close</span><span class="op" id="4311991">(</span><span class="op" id="4311992">)</span>&nbsp;<span class="comment" id="4311994">//&nbsp;sets&nbsp;w.dot&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312015">}</span><br>
<span class="lineno"></span><span class="op" id="4312017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4312020">type</span>&nbsp;<span class="ident" id="4312025">dotWriter</span>&nbsp;<span class="keyword" id="4312035">struct</span>&nbsp;<span class="op" id="4312042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312045">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4312051">*</span><span class="ident" id="4312052">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312060">state</span>&nbsp;<span class="builtintype" id="4312066">int</span><br>
<span class="lineno"></span><span class="op" id="4312070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4312073">const</span>&nbsp;<span class="op" id="4312079">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312082">wstateBeginLine</span>&nbsp;<span class="op" id="4312098">=</span>&nbsp;<span class="ident" id="4312100">iota</span>&nbsp;<span class="comment" id="4312105">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312156">wstateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4312179">//&nbsp;wrote&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312218">wstateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4312241">//&nbsp;writing&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span><span class="op" id="4312275">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4312278">func</span>&nbsp;<span class="op" id="4312283">(</span><span class="ident" id="4312284">d</span>&nbsp;<span class="op" id="4312286">*</span><span class="ident" id="4312287">dotWriter</span><span class="op" id="4312296">)</span>&nbsp;<span class="ident" id="4312298">Write</span><span class="op" id="4312303">(</span><span class="ident" id="4312304">b</span>&nbsp;<span class="op" id="4312306">[</span><span class="op" id="4312307">]</span><span class="builtintype" id="4312308">byte</span><span class="op" id="4312312">)</span>&nbsp;<span class="op" id="4312314">(</span><span class="ident" id="4312315">n</span>&nbsp;<span class="builtintype" id="4312317">int</span><span class="op" id="4312320">,</span>&nbsp;<span class="ident" id="4312322">err</span>&nbsp;<span class="builtintype" id="4312326">error</span><span class="op" id="4312331">)</span>&nbsp;<span class="op" id="4312333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312336">bw</span>&nbsp;<span class="op" id="4312339">:=</span>&nbsp;<span class="ident" id="4312342">d</span><span class="op" id="4312343">.</span><span class="ident" id="4312344">w</span><span class="op" id="4312345">.</span><span class="ident" id="4312346">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312349">for</span>&nbsp;<span class="ident" id="4312353">n</span>&nbsp;<span class="op" id="4312355">&lt;</span>&nbsp;<span class="builtinfunc" id="4312357">len</span><span class="op" id="4312360">(</span><span class="ident" id="4312361">b</span><span class="op" id="4312362">)</span>&nbsp;<span class="op" id="4312364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312368">c</span>&nbsp;<span class="op" id="4312370">:=</span>&nbsp;<span class="ident" id="4312373">b</span><span class="op" id="4312374">[</span><span class="ident" id="4312375">n</span><span class="op" id="4312376">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312380">switch</span>&nbsp;<span class="ident" id="4312387">d</span><span class="op" id="4312388">.</span><span class="ident" id="4312389">state</span>&nbsp;<span class="op" id="4312395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312399">case</span>&nbsp;<span class="ident" id="4312404">wstateBeginLine</span><span class="op" id="4312419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312424">d</span><span class="op" id="4312425">.</span><span class="ident" id="4312426">state</span>&nbsp;<span class="op" id="4312432">=</span>&nbsp;<span class="ident" id="4312434">wstateData</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312448">if</span>&nbsp;<span class="ident" id="4312451">c</span>&nbsp;<span class="op" id="4312453">==</span>&nbsp;<span class="string" id="4312456">&#39;.&#39;</span>&nbsp;<span class="op" id="4312460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4312466">//&nbsp;escape&nbsp;leading&nbsp;dot</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312492">bw</span><span class="op" id="4312494">.</span><span class="ident" id="4312495">WriteByte</span><span class="op" id="4312504">(</span><span class="string" id="4312505">&#39;.&#39;</span><span class="op" id="4312508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312518">fallthrough</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312533">case</span>&nbsp;<span class="ident" id="4312538">wstateData</span><span class="op" id="4312548">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312553">if</span>&nbsp;<span class="ident" id="4312556">c</span>&nbsp;<span class="op" id="4312558">==</span>&nbsp;<span class="string" id="4312561">&#39;\r&#39;</span>&nbsp;<span class="op" id="4312566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312572">d</span><span class="op" id="4312573">.</span><span class="ident" id="4312574">state</span>&nbsp;<span class="op" id="4312580">=</span>&nbsp;<span class="ident" id="4312582">wstateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312599">if</span>&nbsp;<span class="ident" id="4312602">c</span>&nbsp;<span class="op" id="4312604">==</span>&nbsp;<span class="string" id="4312607">&#39;\n&#39;</span>&nbsp;<span class="op" id="4312612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312618">bw</span><span class="op" id="4312620">.</span><span class="ident" id="4312621">WriteByte</span><span class="op" id="4312630">(</span><span class="string" id="4312631">&#39;\r&#39;</span><span class="op" id="4312635">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312641">d</span><span class="op" id="4312642">.</span><span class="ident" id="4312643">state</span>&nbsp;<span class="op" id="4312649">=</span>&nbsp;<span class="ident" id="4312651">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312675">case</span>&nbsp;<span class="ident" id="4312680">wstateCR</span><span class="op" id="4312688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312693">d</span><span class="op" id="4312694">.</span><span class="ident" id="4312695">state</span>&nbsp;<span class="op" id="4312701">=</span>&nbsp;<span class="ident" id="4312703">wstateData</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312717">if</span>&nbsp;<span class="ident" id="4312720">c</span>&nbsp;<span class="op" id="4312722">==</span>&nbsp;<span class="string" id="4312725">&#39;\n&#39;</span>&nbsp;<span class="op" id="4312730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312736">d</span><span class="op" id="4312737">.</span><span class="ident" id="4312738">state</span>&nbsp;<span class="op" id="4312744">=</span>&nbsp;<span class="ident" id="4312746">wstateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312773">if</span>&nbsp;<span class="ident" id="4312776">err</span>&nbsp;<span class="op" id="4312780">=</span>&nbsp;<span class="ident" id="4312782">bw</span><span class="op" id="4312784">.</span><span class="ident" id="4312785">WriteByte</span><span class="op" id="4312794">(</span><span class="ident" id="4312795">c</span><span class="op" id="4312796">)</span><span class="op" id="4312797">;</span>&nbsp;<span class="ident" id="4312799">err</span>&nbsp;<span class="op" id="4312803">!=</span>&nbsp;<span class="ident" id="4312806">nil</span>&nbsp;<span class="op" id="4312810">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312815">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312827">n</span><span class="op" id="4312828">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312835">return</span><br>
<span class="lineno">100</span><span class="op" id="4312842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4312845">func</span>&nbsp;<span class="op" id="4312850">(</span><span class="ident" id="4312851">d</span>&nbsp;<span class="op" id="4312853">*</span><span class="ident" id="4312854">dotWriter</span><span class="op" id="4312863">)</span>&nbsp;<span class="ident" id="4312865">Close</span><span class="op" id="4312870">(</span><span class="op" id="4312871">)</span>&nbsp;<span class="builtintype" id="4312873">error</span>&nbsp;<span class="op" id="4312879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312882">if</span>&nbsp;<span class="ident" id="4312885">d</span><span class="op" id="4312886">.</span><span class="ident" id="4312887">w</span><span class="op" id="4312888">.</span><span class="ident" id="4312889">dot</span>&nbsp;<span class="op" id="4312893">==</span>&nbsp;<span class="ident" id="4312896">d</span>&nbsp;<span class="op" id="4312898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312902">d</span><span class="op" id="4312903">.</span><span class="ident" id="4312904">w</span><span class="op" id="4312905">.</span><span class="ident" id="4312906">dot</span>&nbsp;<span class="op" id="4312910">=</span>&nbsp;<span class="ident" id="4312912">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4312917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312920">bw</span>&nbsp;<span class="op" id="4312923">:=</span>&nbsp;<span class="ident" id="4312926">d</span><span class="op" id="4312927">.</span><span class="ident" id="4312928">w</span><span class="op" id="4312929">.</span><span class="ident" id="4312930">W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312933">switch</span>&nbsp;<span class="ident" id="4312940">d</span><span class="op" id="4312941">.</span><span class="ident" id="4312942">state</span>&nbsp;<span class="op" id="4312948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312951">default</span><span class="op" id="4312958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4312962">bw</span><span class="op" id="4312964">.</span><span class="ident" id="4312965">WriteByte</span><span class="op" id="4312974">(</span><span class="string" id="4312975">&#39;\r&#39;</span><span class="op" id="4312979">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312983">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4312996">case</span>&nbsp;<span class="ident" id="4313001">wstateCR</span><span class="op" id="4313009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313013">bw</span><span class="op" id="4313015">.</span><span class="ident" id="4313016">WriteByte</span><span class="op" id="4313025">(</span><span class="string" id="4313026">&#39;\n&#39;</span><span class="op" id="4313030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313034">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313047">case</span>&nbsp;<span class="ident" id="4313052">wstateBeginLine</span><span class="op" id="4313067">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313071">bw</span><span class="op" id="4313073">.</span><span class="ident" id="4313074">Write</span><span class="op" id="4313079">(</span><span class="ident" id="4313080">dotcrnl</span><span class="op" id="4313087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4313090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4313093">return</span>&nbsp;<span class="ident" id="4313100">bw</span><span class="op" id="4313102">.</span><span class="ident" id="4313103">Flush</span><span class="op" id="4313108">(</span><span class="op" id="4313109">)</span><br>
<span class="lineno"></span><span class="op" id="4313111">}</span>
</div>
</body>
</html>
