<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3621725">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3621780">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3621834">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3621885">package</span>&nbsp;<span class="ident" id="3621893">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3621901">import</span>&nbsp;<span class="op" id="3621908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621911">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621928">&#34;errors&#34;</span><br>
<span class="lineno">10</span><span class="op" id="3621937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3621940">//&nbsp;AEAD&nbsp;is&nbsp;a&nbsp;cipher&nbsp;mode&nbsp;providing&nbsp;authenticated&nbsp;encryption&nbsp;with&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3622016">//&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3622025">type</span>&nbsp;<span class="ident" id="3622030">AEAD</span>&nbsp;<span class="keyword" id="3622035">interface</span>&nbsp;<span class="op" id="3622045">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622048">//&nbsp;NonceSize&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;nonce&nbsp;that&nbsp;must&nbsp;be&nbsp;passed&nbsp;to&nbsp;Seal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622120">//&nbsp;and&nbsp;Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622134">NonceSize</span><span class="op" id="3622143">(</span><span class="op" id="3622144">)</span>&nbsp;<span class="builtintype" id="3622146">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622152">//&nbsp;Overhead&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;difference&nbsp;between&nbsp;the&nbsp;lengths&nbsp;of&nbsp;a</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622221">//&nbsp;plaintext&nbsp;and&nbsp;ciphertext.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622251">Overhead</span><span class="op" id="3622259">(</span><span class="op" id="3622260">)</span>&nbsp;<span class="builtintype" id="3622262">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622268">//&nbsp;Seal&nbsp;encrypts&nbsp;and&nbsp;authenticates&nbsp;plaintext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622333">//&nbsp;additional&nbsp;data&nbsp;and&nbsp;appends&nbsp;the&nbsp;result&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622406">//&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()&nbsp;bytes&nbsp;long&nbsp;and&nbsp;unique&nbsp;for&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622477">//&nbsp;time,&nbsp;for&nbsp;a&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622504">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622508">//&nbsp;The&nbsp;plaintext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622567">Seal</span><span class="op" id="3622571">(</span><span class="ident" id="3622572">dst</span><span class="op" id="3622575">,</span>&nbsp;<span class="ident" id="3622577">nonce</span><span class="op" id="3622582">,</span>&nbsp;<span class="ident" id="3622584">plaintext</span><span class="op" id="3622593">,</span>&nbsp;<span class="ident" id="3622595">data</span>&nbsp;<span class="op" id="3622600">[</span><span class="op" id="3622601">]</span><span class="builtintype" id="3622602">byte</span><span class="op" id="3622606">)</span>&nbsp;<span class="op" id="3622608">[</span><span class="op" id="3622609">]</span><span class="builtintype" id="3622610">byte</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622617">//&nbsp;Open&nbsp;decrypts&nbsp;and&nbsp;authenticates&nbsp;ciphertext,&nbsp;authenticates&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622683">//&nbsp;additional&nbsp;data&nbsp;and,&nbsp;if&nbsp;successful,&nbsp;appends&nbsp;the&nbsp;resulting&nbsp;plaintext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622755">//&nbsp;to&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;updated&nbsp;slice.&nbsp;The&nbsp;nonce&nbsp;must&nbsp;be&nbsp;NonceSize()</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622826">//&nbsp;bytes&nbsp;long&nbsp;and&nbsp;both&nbsp;it&nbsp;and&nbsp;the&nbsp;additional&nbsp;data&nbsp;must&nbsp;match&nbsp;the</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622892">//&nbsp;value&nbsp;passed&nbsp;to&nbsp;Seal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622918">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622922">//&nbsp;The&nbsp;ciphertext&nbsp;and&nbsp;dst&nbsp;may&nbsp;alias&nbsp;exactly&nbsp;or&nbsp;not&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622982">Open</span><span class="op" id="3622986">(</span><span class="ident" id="3622987">dst</span><span class="op" id="3622990">,</span>&nbsp;<span class="ident" id="3622992">nonce</span><span class="op" id="3622997">,</span>&nbsp;<span class="ident" id="3622999">ciphertext</span><span class="op" id="3623009">,</span>&nbsp;<span class="ident" id="3623011">data</span>&nbsp;<span class="op" id="3623016">[</span><span class="op" id="3623017">]</span><span class="builtintype" id="3623018">byte</span><span class="op" id="3623022">)</span>&nbsp;<span class="op" id="3623024">(</span><span class="op" id="3623025">[</span><span class="op" id="3623026">]</span><span class="builtintype" id="3623027">byte</span><span class="op" id="3623031">,</span>&nbsp;<span class="builtintype" id="3623033">error</span><span class="op" id="3623038">)</span><br>
<span class="lineno"></span><span class="op" id="3623040">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3623043">//&nbsp;gcmFieldElement&nbsp;represents&nbsp;a&nbsp;value&nbsp;in&nbsp;GF(2¹²⁸).&nbsp;In&nbsp;order&nbsp;to&nbsp;reflect&nbsp;the&nbsp;GCM</span><br>
<span class="lineno"></span><span class="comment" id="3623126">//&nbsp;standard&nbsp;and&nbsp;make&nbsp;getUint64&nbsp;suitable&nbsp;for&nbsp;marshaling&nbsp;these&nbsp;values,&nbsp;the&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="3623204">//&nbsp;are&nbsp;stored&nbsp;backwards.&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="3623242">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁰&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno">45</span><span class="comment" id="3623303">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶³&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.low&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="3623364">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x⁶⁴&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&gt;&gt;&nbsp;63.</span><br>
<span class="lineno"></span><span class="comment" id="3623429">//&nbsp;&nbsp;&nbsp;the&nbsp;coefficient&nbsp;of&nbsp;x¹²⁷&nbsp;can&nbsp;be&nbsp;obtained&nbsp;by&nbsp;v.high&nbsp;&amp;&nbsp;1.</span><br>
<span class="lineno"></span><span class="keyword" id="3623493">type</span>&nbsp;<span class="ident" id="3623498">gcmFieldElement</span>&nbsp;<span class="keyword" id="3623514">struct</span>&nbsp;<span class="op" id="3623521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623524">low</span><span class="op" id="3623527">,</span>&nbsp;<span class="ident" id="3623529">high</span>&nbsp;<span class="ident" id="3623534">uint64</span><br>
<span class="lineno">50</span><span class="op" id="3623541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3623544">//&nbsp;gcm&nbsp;represents&nbsp;a&nbsp;Galois&nbsp;Counter&nbsp;Mode&nbsp;with&nbsp;a&nbsp;specific&nbsp;key.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3623609">//&nbsp;http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/gcm/gcm-revised-spec.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="3623704">type</span>&nbsp;<span class="ident" id="3623709">gcm</span>&nbsp;<span class="keyword" id="3623713">struct</span>&nbsp;<span class="op" id="3623720">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623723">cipher</span>&nbsp;<span class="ident" id="3623730">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623737">//&nbsp;productTable&nbsp;contains&nbsp;the&nbsp;first&nbsp;sixteen&nbsp;powers&nbsp;of&nbsp;the&nbsp;key,&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623803">//&nbsp;However,&nbsp;they&nbsp;are&nbsp;in&nbsp;bit&nbsp;reversed&nbsp;order.&nbsp;See&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623860">productTable</span>&nbsp;<span class="op" id="3623873">[</span><span class="num" id="3623874">16</span><span class="op" id="3623876">]</span><span class="ident" id="3623877">gcmFieldElement</span><br>
<span class="lineno"></span><span class="op" id="3623893">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3623896">//&nbsp;NewGCM&nbsp;returns&nbsp;the&nbsp;given&nbsp;128-bit,&nbsp;block&nbsp;cipher&nbsp;wrapped&nbsp;in&nbsp;Galois&nbsp;Counter&nbsp;Mode.</span><br>
<span class="lineno"></span><span class="keyword" id="3623978">func</span>&nbsp;<span class="ident" id="3623983">NewGCM</span><span class="op" id="3623989">(</span><span class="ident" id="3623990">cipher</span>&nbsp;<span class="ident" id="3623997">Block</span><span class="op" id="3624002">)</span>&nbsp;<span class="op" id="3624004">(</span><span class="ident" id="3624005">AEAD</span><span class="op" id="3624009">,</span>&nbsp;<span class="builtintype" id="3624011">error</span><span class="op" id="3624016">)</span>&nbsp;<span class="op" id="3624018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624021">if</span>&nbsp;<span class="ident" id="3624024">cipher</span><span class="op" id="3624030">.</span><span class="ident" id="3624031">BlockSize</span><span class="op" id="3624040">(</span><span class="op" id="3624041">)</span>&nbsp;<span class="op" id="3624043">!=</span>&nbsp;<span class="ident" id="3624046">gcmBlockSize</span>&nbsp;<span class="op" id="3624059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624063">return</span>&nbsp;<span class="ident" id="3624070">nil</span><span class="op" id="3624073">,</span>&nbsp;<span class="ident" id="3624075">errors</span><span class="op" id="3624081">.</span><span class="ident" id="3624082">New</span><span class="op" id="3624085">(</span><span class="string" id="3624086">&#34;cipher:&nbsp;NewGCM&nbsp;requires&nbsp;128-bit&nbsp;block&nbsp;cipher&#34;</span><span class="op" id="3624132">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624139">var</span>&nbsp;<span class="ident" id="3624143">key</span>&nbsp;<span class="op" id="3624147">[</span><span class="ident" id="3624148">gcmBlockSize</span><span class="op" id="3624160">]</span><span class="builtintype" id="3624161">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624167">cipher</span><span class="op" id="3624173">.</span><span class="ident" id="3624174">Encrypt</span><span class="op" id="3624181">(</span><span class="ident" id="3624182">key</span><span class="op" id="3624185">[</span><span class="op" id="3624186">:</span><span class="op" id="3624187">]</span><span class="op" id="3624188">,</span>&nbsp;<span class="ident" id="3624190">key</span><span class="op" id="3624193">[</span><span class="op" id="3624194">:</span><span class="op" id="3624195">]</span><span class="op" id="3624196">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624200">g</span>&nbsp;<span class="op" id="3624202">:=</span>&nbsp;<span class="op" id="3624205">&amp;</span><span class="ident" id="3624206">gcm</span><span class="op" id="3624209">{</span><span class="ident" id="3624210">cipher</span><span class="op" id="3624216">:</span>&nbsp;<span class="ident" id="3624218">cipher</span><span class="op" id="3624224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624228">//&nbsp;We&nbsp;precompute&nbsp;16&nbsp;multiples&nbsp;of&nbsp;|key|.&nbsp;However,&nbsp;when&nbsp;we&nbsp;do&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624297">//&nbsp;into&nbsp;this&nbsp;table&nbsp;we&#39;ll&nbsp;be&nbsp;using&nbsp;bits&nbsp;from&nbsp;a&nbsp;field&nbsp;element&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624362">//&nbsp;therefore&nbsp;the&nbsp;bits&nbsp;will&nbsp;be&nbsp;in&nbsp;the&nbsp;reverse&nbsp;order.&nbsp;So&nbsp;normally&nbsp;one</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624431">//&nbsp;would&nbsp;expect,&nbsp;say,&nbsp;4*key&nbsp;to&nbsp;be&nbsp;in&nbsp;index&nbsp;4&nbsp;of&nbsp;the&nbsp;table&nbsp;but&nbsp;due&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624501">//&nbsp;this&nbsp;bit&nbsp;ordering&nbsp;it&nbsp;will&nbsp;actually&nbsp;be&nbsp;in&nbsp;index&nbsp;0010&nbsp;(base&nbsp;2)&nbsp;=&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624571">x</span>&nbsp;<span class="op" id="3624573">:=</span>&nbsp;<span class="ident" id="3624576">gcmFieldElement</span><span class="op" id="3624591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624595">getUint64</span><span class="op" id="3624604">(</span><span class="ident" id="3624605">key</span><span class="op" id="3624608">[</span><span class="op" id="3624609">:</span><span class="num" id="3624610">8</span><span class="op" id="3624611">]</span><span class="op" id="3624612">)</span><span class="op" id="3624613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624617">getUint64</span><span class="op" id="3624626">(</span><span class="ident" id="3624627">key</span><span class="op" id="3624630">[</span><span class="num" id="3624631">8</span><span class="op" id="3624632">:</span><span class="op" id="3624633">]</span><span class="op" id="3624634">)</span><span class="op" id="3624635">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624641">g</span><span class="op" id="3624642">.</span><span class="ident" id="3624643">productTable</span><span class="op" id="3624655">[</span><span class="ident" id="3624656">reverseBits</span><span class="op" id="3624667">(</span><span class="num" id="3624668">1</span><span class="op" id="3624669">)</span><span class="op" id="3624670">]</span>&nbsp;<span class="op" id="3624672">=</span>&nbsp;<span class="ident" id="3624674">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624678">for</span>&nbsp;<span class="ident" id="3624682">i</span>&nbsp;<span class="op" id="3624684">:=</span>&nbsp;<span class="num" id="3624687">2</span><span class="op" id="3624688">;</span>&nbsp;<span class="ident" id="3624690">i</span>&nbsp;<span class="op" id="3624692">&lt;</span>&nbsp;<span class="num" id="3624694">16</span><span class="op" id="3624696">;</span>&nbsp;<span class="ident" id="3624698">i</span>&nbsp;<span class="op" id="3624700">+=</span>&nbsp;<span class="num" id="3624703">2</span>&nbsp;<span class="op" id="3624705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624709">g</span><span class="op" id="3624710">.</span><span class="ident" id="3624711">productTable</span><span class="op" id="3624723">[</span><span class="ident" id="3624724">reverseBits</span><span class="op" id="3624735">(</span><span class="ident" id="3624736">i</span><span class="op" id="3624737">)</span><span class="op" id="3624738">]</span>&nbsp;<span class="op" id="3624740">=</span>&nbsp;<span class="ident" id="3624742">gcmDouble</span><span class="op" id="3624751">(</span><span class="op" id="3624752">&amp;</span><span class="ident" id="3624753">g</span><span class="op" id="3624754">.</span><span class="ident" id="3624755">productTable</span><span class="op" id="3624767">[</span><span class="ident" id="3624768">reverseBits</span><span class="op" id="3624779">(</span><span class="ident" id="3624780">i</span><span class="op" id="3624781">/</span><span class="num" id="3624782">2</span><span class="op" id="3624783">)</span><span class="op" id="3624784">]</span><span class="op" id="3624785">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624789">g</span><span class="op" id="3624790">.</span><span class="ident" id="3624791">productTable</span><span class="op" id="3624803">[</span><span class="ident" id="3624804">reverseBits</span><span class="op" id="3624815">(</span><span class="ident" id="3624816">i</span><span class="op" id="3624817">+</span><span class="num" id="3624818">1</span><span class="op" id="3624819">)</span><span class="op" id="3624820">]</span>&nbsp;<span class="op" id="3624822">=</span>&nbsp;<span class="ident" id="3624824">gcmAdd</span><span class="op" id="3624830">(</span><span class="op" id="3624831">&amp;</span><span class="ident" id="3624832">g</span><span class="op" id="3624833">.</span><span class="ident" id="3624834">productTable</span><span class="op" id="3624846">[</span><span class="ident" id="3624847">reverseBits</span><span class="op" id="3624858">(</span><span class="ident" id="3624859">i</span><span class="op" id="3624860">)</span><span class="op" id="3624861">]</span><span class="op" id="3624862">,</span>&nbsp;<span class="op" id="3624864">&amp;</span><span class="ident" id="3624865">x</span><span class="op" id="3624866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624873">return</span>&nbsp;<span class="ident" id="3624880">g</span><span class="op" id="3624881">,</span>&nbsp;<span class="ident" id="3624883">nil</span><br>
<span class="lineno"></span><span class="op" id="3624887">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3624890">const</span>&nbsp;<span class="op" id="3624896">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624899">gcmBlockSize</span>&nbsp;<span class="op" id="3624912">=</span>&nbsp;<span class="num" id="3624914">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624918">gcmTagSize</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3624931">=</span>&nbsp;<span class="num" id="3624933">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624937">gcmNonceSize</span>&nbsp;<span class="op" id="3624950">=</span>&nbsp;<span class="num" id="3624952">12</span><br>
<span class="lineno">95</span><span class="op" id="3624955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3624958">func</span>&nbsp;<span class="op" id="3624963">(</span><span class="op" id="3624964">*</span><span class="ident" id="3624965">gcm</span><span class="op" id="3624968">)</span>&nbsp;<span class="ident" id="3624970">NonceSize</span><span class="op" id="3624979">(</span><span class="op" id="3624980">)</span>&nbsp;<span class="builtintype" id="3624982">int</span>&nbsp;<span class="op" id="3624986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624989">return</span>&nbsp;<span class="ident" id="3624996">gcmNonceSize</span><br>
<span class="lineno"></span><span class="op" id="3625009">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="3625012">func</span>&nbsp;<span class="op" id="3625017">(</span><span class="op" id="3625018">*</span><span class="ident" id="3625019">gcm</span><span class="op" id="3625022">)</span>&nbsp;<span class="ident" id="3625024">Overhead</span><span class="op" id="3625032">(</span><span class="op" id="3625033">)</span>&nbsp;<span class="builtintype" id="3625035">int</span>&nbsp;<span class="op" id="3625039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625042">return</span>&nbsp;<span class="ident" id="3625049">gcmTagSize</span><br>
<span class="lineno"></span><span class="op" id="3625060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="3625063">func</span>&nbsp;<span class="op" id="3625068">(</span><span class="ident" id="3625069">g</span>&nbsp;<span class="op" id="3625071">*</span><span class="ident" id="3625072">gcm</span><span class="op" id="3625075">)</span>&nbsp;<span class="ident" id="3625077">Seal</span><span class="op" id="3625081">(</span><span class="ident" id="3625082">dst</span><span class="op" id="3625085">,</span>&nbsp;<span class="ident" id="3625087">nonce</span><span class="op" id="3625092">,</span>&nbsp;<span class="ident" id="3625094">plaintext</span><span class="op" id="3625103">,</span>&nbsp;<span class="ident" id="3625105">data</span>&nbsp;<span class="op" id="3625110">[</span><span class="op" id="3625111">]</span><span class="builtintype" id="3625112">byte</span><span class="op" id="3625116">)</span>&nbsp;<span class="op" id="3625118">[</span><span class="op" id="3625119">]</span><span class="builtintype" id="3625120">byte</span>&nbsp;<span class="op" id="3625125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625128">if</span>&nbsp;<span class="builtinfunc" id="3625131">len</span><span class="op" id="3625134">(</span><span class="ident" id="3625135">nonce</span><span class="op" id="3625140">)</span>&nbsp;<span class="op" id="3625142">!=</span>&nbsp;<span class="ident" id="3625145">gcmNonceSize</span>&nbsp;<span class="op" id="3625158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3625162">panic</span><span class="op" id="3625167">(</span><span class="string" id="3625168">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3625213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625216">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625220">ret</span><span class="op" id="3625223">,</span>&nbsp;<span class="ident" id="3625225">out</span>&nbsp;<span class="op" id="3625229">:=</span>&nbsp;<span class="ident" id="3625232">sliceForAppend</span><span class="op" id="3625246">(</span><span class="ident" id="3625247">dst</span><span class="op" id="3625250">,</span>&nbsp;<span class="builtinfunc" id="3625252">len</span><span class="op" id="3625255">(</span><span class="ident" id="3625256">plaintext</span><span class="op" id="3625265">)</span><span class="op" id="3625266">+</span><span class="ident" id="3625267">gcmTagSize</span><span class="op" id="3625277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3625281">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625312">var</span>&nbsp;<span class="ident" id="3625316">counter</span><span class="op" id="3625323">,</span>&nbsp;<span class="ident" id="3625325">tagMask</span>&nbsp;<span class="op" id="3625333">[</span><span class="ident" id="3625334">gcmBlockSize</span><span class="op" id="3625346">]</span><span class="builtintype" id="3625347">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3625353">copy</span><span class="op" id="3625357">(</span><span class="ident" id="3625358">counter</span><span class="op" id="3625365">[</span><span class="op" id="3625366">:</span><span class="op" id="3625367">]</span><span class="op" id="3625368">,</span>&nbsp;<span class="ident" id="3625370">nonce</span><span class="op" id="3625375">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625378">counter</span><span class="op" id="3625385">[</span><span class="ident" id="3625386">gcmBlockSize</span><span class="op" id="3625398">-</span><span class="num" id="3625399">1</span><span class="op" id="3625400">]</span>&nbsp;<span class="op" id="3625402">=</span>&nbsp;<span class="num" id="3625404">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625408">g</span><span class="op" id="3625409">.</span><span class="ident" id="3625410">cipher</span><span class="op" id="3625416">.</span><span class="ident" id="3625417">Encrypt</span><span class="op" id="3625424">(</span><span class="ident" id="3625425">tagMask</span><span class="op" id="3625432">[</span><span class="op" id="3625433">:</span><span class="op" id="3625434">]</span><span class="op" id="3625435">,</span>&nbsp;<span class="ident" id="3625437">counter</span><span class="op" id="3625444">[</span><span class="op" id="3625445">:</span><span class="op" id="3625446">]</span><span class="op" id="3625447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625450">gcmInc32</span><span class="op" id="3625458">(</span><span class="op" id="3625459">&amp;</span><span class="ident" id="3625460">counter</span><span class="op" id="3625467">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625471">g</span><span class="op" id="3625472">.</span><span class="ident" id="3625473">counterCrypt</span><span class="op" id="3625485">(</span><span class="ident" id="3625486">out</span><span class="op" id="3625489">,</span>&nbsp;<span class="ident" id="3625491">plaintext</span><span class="op" id="3625500">,</span>&nbsp;<span class="op" id="3625502">&amp;</span><span class="ident" id="3625503">counter</span><span class="op" id="3625510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625513">g</span><span class="op" id="3625514">.</span><span class="ident" id="3625515">auth</span><span class="op" id="3625519">(</span><span class="ident" id="3625520">out</span><span class="op" id="3625523">[</span><span class="builtinfunc" id="3625524">len</span><span class="op" id="3625527">(</span><span class="ident" id="3625528">plaintext</span><span class="op" id="3625537">)</span><span class="op" id="3625538">:</span><span class="op" id="3625539">]</span><span class="op" id="3625540">,</span>&nbsp;<span class="ident" id="3625542">out</span><span class="op" id="3625545">[</span><span class="op" id="3625546">:</span><span class="builtinfunc" id="3625547">len</span><span class="op" id="3625550">(</span><span class="ident" id="3625551">plaintext</span><span class="op" id="3625560">)</span><span class="op" id="3625561">]</span><span class="op" id="3625562">,</span>&nbsp;<span class="ident" id="3625564">data</span><span class="op" id="3625568">,</span>&nbsp;<span class="op" id="3625570">&amp;</span><span class="ident" id="3625571">tagMask</span><span class="op" id="3625578">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625582">return</span>&nbsp;<span class="ident" id="3625589">ret</span><br>
<span class="lineno"></span><span class="op" id="3625593">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="3625596">var</span>&nbsp;<span class="ident" id="3625600">errOpen</span>&nbsp;<span class="op" id="3625608">=</span>&nbsp;<span class="ident" id="3625610">errors</span><span class="op" id="3625616">.</span><span class="ident" id="3625617">New</span><span class="op" id="3625620">(</span><span class="string" id="3625621">&#34;cipher:&nbsp;message&nbsp;authentication&nbsp;failed&#34;</span><span class="op" id="3625660">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3625663">func</span>&nbsp;<span class="op" id="3625668">(</span><span class="ident" id="3625669">g</span>&nbsp;<span class="op" id="3625671">*</span><span class="ident" id="3625672">gcm</span><span class="op" id="3625675">)</span>&nbsp;<span class="ident" id="3625677">Open</span><span class="op" id="3625681">(</span><span class="ident" id="3625682">dst</span><span class="op" id="3625685">,</span>&nbsp;<span class="ident" id="3625687">nonce</span><span class="op" id="3625692">,</span>&nbsp;<span class="ident" id="3625694">ciphertext</span><span class="op" id="3625704">,</span>&nbsp;<span class="ident" id="3625706">data</span>&nbsp;<span class="op" id="3625711">[</span><span class="op" id="3625712">]</span><span class="builtintype" id="3625713">byte</span><span class="op" id="3625717">)</span>&nbsp;<span class="op" id="3625719">(</span><span class="op" id="3625720">[</span><span class="op" id="3625721">]</span><span class="builtintype" id="3625722">byte</span><span class="op" id="3625726">,</span>&nbsp;<span class="builtintype" id="3625728">error</span><span class="op" id="3625733">)</span>&nbsp;<span class="op" id="3625735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625738">if</span>&nbsp;<span class="builtinfunc" id="3625741">len</span><span class="op" id="3625744">(</span><span class="ident" id="3625745">nonce</span><span class="op" id="3625750">)</span>&nbsp;<span class="op" id="3625752">!=</span>&nbsp;<span class="ident" id="3625755">gcmNonceSize</span>&nbsp;<span class="op" id="3625768">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3625772">panic</span><span class="op" id="3625777">(</span><span class="string" id="3625778">&#34;cipher:&nbsp;incorrect&nbsp;nonce&nbsp;length&nbsp;given&nbsp;to&nbsp;GCM&#34;</span><span class="op" id="3625823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625830">if</span>&nbsp;<span class="builtinfunc" id="3625833">len</span><span class="op" id="3625836">(</span><span class="ident" id="3625837">ciphertext</span><span class="op" id="3625847">)</span>&nbsp;<span class="op" id="3625849">&lt;</span>&nbsp;<span class="ident" id="3625851">gcmTagSize</span>&nbsp;<span class="op" id="3625862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625866">return</span>&nbsp;<span class="ident" id="3625873">nil</span><span class="op" id="3625876">,</span>&nbsp;<span class="ident" id="3625878">errOpen</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625890">tag</span>&nbsp;<span class="op" id="3625894">:=</span>&nbsp;<span class="ident" id="3625897">ciphertext</span><span class="op" id="3625907">[</span><span class="builtinfunc" id="3625908">len</span><span class="op" id="3625911">(</span><span class="ident" id="3625912">ciphertext</span><span class="op" id="3625922">)</span><span class="op" id="3625923">-</span><span class="ident" id="3625924">gcmTagSize</span><span class="op" id="3625934">:</span><span class="op" id="3625935">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625938">ciphertext</span>&nbsp;<span class="op" id="3625949">=</span>&nbsp;<span class="ident" id="3625951">ciphertext</span><span class="op" id="3625961">[</span><span class="op" id="3625962">:</span><span class="builtinfunc" id="3625963">len</span><span class="op" id="3625966">(</span><span class="ident" id="3625967">ciphertext</span><span class="op" id="3625977">)</span><span class="op" id="3625978">-</span><span class="ident" id="3625979">gcmTagSize</span><span class="op" id="3625989">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3625993">//&nbsp;See&nbsp;GCM&nbsp;spec,&nbsp;section&nbsp;7.1.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626024">var</span>&nbsp;<span class="ident" id="3626028">counter</span><span class="op" id="3626035">,</span>&nbsp;<span class="ident" id="3626037">tagMask</span>&nbsp;<span class="op" id="3626045">[</span><span class="ident" id="3626046">gcmBlockSize</span><span class="op" id="3626058">]</span><span class="builtintype" id="3626059">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3626065">copy</span><span class="op" id="3626069">(</span><span class="ident" id="3626070">counter</span><span class="op" id="3626077">[</span><span class="op" id="3626078">:</span><span class="op" id="3626079">]</span><span class="op" id="3626080">,</span>&nbsp;<span class="ident" id="3626082">nonce</span><span class="op" id="3626087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626090">counter</span><span class="op" id="3626097">[</span><span class="ident" id="3626098">gcmBlockSize</span><span class="op" id="3626110">-</span><span class="num" id="3626111">1</span><span class="op" id="3626112">]</span>&nbsp;<span class="op" id="3626114">=</span>&nbsp;<span class="num" id="3626116">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626120">g</span><span class="op" id="3626121">.</span><span class="ident" id="3626122">cipher</span><span class="op" id="3626128">.</span><span class="ident" id="3626129">Encrypt</span><span class="op" id="3626136">(</span><span class="ident" id="3626137">tagMask</span><span class="op" id="3626144">[</span><span class="op" id="3626145">:</span><span class="op" id="3626146">]</span><span class="op" id="3626147">,</span>&nbsp;<span class="ident" id="3626149">counter</span><span class="op" id="3626156">[</span><span class="op" id="3626157">:</span><span class="op" id="3626158">]</span><span class="op" id="3626159">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626162">gcmInc32</span><span class="op" id="3626170">(</span><span class="op" id="3626171">&amp;</span><span class="ident" id="3626172">counter</span><span class="op" id="3626179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626183">var</span>&nbsp;<span class="ident" id="3626187">expectedTag</span>&nbsp;<span class="op" id="3626199">[</span><span class="ident" id="3626200">gcmTagSize</span><span class="op" id="3626210">]</span><span class="builtintype" id="3626211">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626217">g</span><span class="op" id="3626218">.</span><span class="ident" id="3626219">auth</span><span class="op" id="3626223">(</span><span class="ident" id="3626224">expectedTag</span><span class="op" id="3626235">[</span><span class="op" id="3626236">:</span><span class="op" id="3626237">]</span><span class="op" id="3626238">,</span>&nbsp;<span class="ident" id="3626240">ciphertext</span><span class="op" id="3626250">,</span>&nbsp;<span class="ident" id="3626252">data</span><span class="op" id="3626256">,</span>&nbsp;<span class="op" id="3626258">&amp;</span><span class="ident" id="3626259">tagMask</span><span class="op" id="3626266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626270">if</span>&nbsp;<span class="ident" id="3626273">subtle</span><span class="op" id="3626279">.</span><span class="ident" id="3626280">ConstantTimeCompare</span><span class="op" id="3626299">(</span><span class="ident" id="3626300">expectedTag</span><span class="op" id="3626311">[</span><span class="op" id="3626312">:</span><span class="op" id="3626313">]</span><span class="op" id="3626314">,</span>&nbsp;<span class="ident" id="3626316">tag</span><span class="op" id="3626319">)</span>&nbsp;<span class="op" id="3626321">!=</span>&nbsp;<span class="num" id="3626324">1</span>&nbsp;<span class="op" id="3626326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626330">return</span>&nbsp;<span class="ident" id="3626337">nil</span><span class="op" id="3626340">,</span>&nbsp;<span class="ident" id="3626342">errOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3626351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626355">ret</span><span class="op" id="3626358">,</span>&nbsp;<span class="ident" id="3626360">out</span>&nbsp;<span class="op" id="3626364">:=</span>&nbsp;<span class="ident" id="3626367">sliceForAppend</span><span class="op" id="3626381">(</span><span class="ident" id="3626382">dst</span><span class="op" id="3626385">,</span>&nbsp;<span class="builtinfunc" id="3626387">len</span><span class="op" id="3626390">(</span><span class="ident" id="3626391">ciphertext</span><span class="op" id="3626401">)</span><span class="op" id="3626402">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626405">g</span><span class="op" id="3626406">.</span><span class="ident" id="3626407">counterCrypt</span><span class="op" id="3626419">(</span><span class="ident" id="3626420">out</span><span class="op" id="3626423">,</span>&nbsp;<span class="ident" id="3626425">ciphertext</span><span class="op" id="3626435">,</span>&nbsp;<span class="op" id="3626437">&amp;</span><span class="ident" id="3626438">counter</span><span class="op" id="3626445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626449">return</span>&nbsp;<span class="ident" id="3626456">ret</span><span class="op" id="3626459">,</span>&nbsp;<span class="ident" id="3626461">nil</span><br>
<span class="lineno"></span><span class="op" id="3626465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="3626468">//&nbsp;reverseBits&nbsp;reverses&nbsp;the&nbsp;order&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;4-bit&nbsp;number&nbsp;in&nbsp;i.</span><br>
<span class="lineno"></span><span class="keyword" id="3626536">func</span>&nbsp;<span class="ident" id="3626541">reverseBits</span><span class="op" id="3626552">(</span><span class="ident" id="3626553">i</span>&nbsp;<span class="builtintype" id="3626555">int</span><span class="op" id="3626558">)</span>&nbsp;<span class="builtintype" id="3626560">int</span>&nbsp;<span class="op" id="3626564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626567">i</span>&nbsp;<span class="op" id="3626569">=</span>&nbsp;<span class="op" id="3626571">(</span><span class="op" id="3626572">(</span><span class="ident" id="3626573">i</span>&nbsp;<span class="op" id="3626575">&lt;&lt;</span>&nbsp;<span class="num" id="3626578">2</span><span class="op" id="3626579">)</span>&nbsp;<span class="op" id="3626581">&amp;</span>&nbsp;<span class="num" id="3626583">0xc</span><span class="op" id="3626586">)</span>&nbsp;<span class="op" id="3626588">|</span>&nbsp;<span class="op" id="3626590">(</span><span class="op" id="3626591">(</span><span class="ident" id="3626592">i</span>&nbsp;<span class="op" id="3626594">&gt;&gt;</span>&nbsp;<span class="num" id="3626597">2</span><span class="op" id="3626598">)</span>&nbsp;<span class="op" id="3626600">&amp;</span>&nbsp;<span class="num" id="3626602">0x3</span><span class="op" id="3626605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626608">i</span>&nbsp;<span class="op" id="3626610">=</span>&nbsp;<span class="op" id="3626612">(</span><span class="op" id="3626613">(</span><span class="ident" id="3626614">i</span>&nbsp;<span class="op" id="3626616">&lt;&lt;</span>&nbsp;<span class="num" id="3626619">1</span><span class="op" id="3626620">)</span>&nbsp;<span class="op" id="3626622">&amp;</span>&nbsp;<span class="num" id="3626624">0xa</span><span class="op" id="3626627">)</span>&nbsp;<span class="op" id="3626629">|</span>&nbsp;<span class="op" id="3626631">(</span><span class="op" id="3626632">(</span><span class="ident" id="3626633">i</span>&nbsp;<span class="op" id="3626635">&gt;&gt;</span>&nbsp;<span class="num" id="3626638">1</span><span class="op" id="3626639">)</span>&nbsp;<span class="op" id="3626641">&amp;</span>&nbsp;<span class="num" id="3626643">0x5</span><span class="op" id="3626646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626649">return</span>&nbsp;<span class="ident" id="3626656">i</span><br>
<span class="lineno">165</span><span class="op" id="3626658">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3626661">//&nbsp;gcmAdd&nbsp;adds&nbsp;two&nbsp;elements&nbsp;of&nbsp;GF(2¹²⁸)&nbsp;and&nbsp;returns&nbsp;the&nbsp;sum.</span><br>
<span class="lineno"></span><span class="keyword" id="3626726">func</span>&nbsp;<span class="ident" id="3626731">gcmAdd</span><span class="op" id="3626737">(</span><span class="ident" id="3626738">x</span><span class="op" id="3626739">,</span>&nbsp;<span class="ident" id="3626741">y</span>&nbsp;<span class="op" id="3626743">*</span><span class="ident" id="3626744">gcmFieldElement</span><span class="op" id="3626759">)</span>&nbsp;<span class="ident" id="3626761">gcmFieldElement</span>&nbsp;<span class="op" id="3626777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3626780">//&nbsp;Addition&nbsp;in&nbsp;a&nbsp;characteristic&nbsp;2&nbsp;field&nbsp;is&nbsp;just&nbsp;XOR.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3626834">return</span>&nbsp;<span class="ident" id="3626841">gcmFieldElement</span><span class="op" id="3626856">{</span><span class="ident" id="3626857">x</span><span class="op" id="3626858">.</span><span class="ident" id="3626859">low</span>&nbsp;<span class="op" id="3626863">^</span>&nbsp;<span class="ident" id="3626865">y</span><span class="op" id="3626866">.</span><span class="ident" id="3626867">low</span><span class="op" id="3626870">,</span>&nbsp;<span class="ident" id="3626872">x</span><span class="op" id="3626873">.</span><span class="ident" id="3626874">high</span>&nbsp;<span class="op" id="3626879">^</span>&nbsp;<span class="ident" id="3626881">y</span><span class="op" id="3626882">.</span><span class="ident" id="3626883">high</span><span class="op" id="3626887">}</span><br>
<span class="lineno"></span><span class="op" id="3626889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3626892">//&nbsp;gcmDouble&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;doubling&nbsp;an&nbsp;element&nbsp;of&nbsp;GF(2¹²⁸).</span><br>
<span class="lineno"></span><span class="keyword" id="3626964">func</span>&nbsp;<span class="ident" id="3626969">gcmDouble</span><span class="op" id="3626978">(</span><span class="ident" id="3626979">x</span>&nbsp;<span class="op" id="3626981">*</span><span class="ident" id="3626982">gcmFieldElement</span><span class="op" id="3626997">)</span>&nbsp;<span class="op" id="3626999">(</span><span class="ident" id="3627000">double</span>&nbsp;<span class="ident" id="3627007">gcmFieldElement</span><span class="op" id="3627022">)</span>&nbsp;<span class="op" id="3627024">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627027">msbSet</span>&nbsp;<span class="op" id="3627034">:=</span>&nbsp;<span class="ident" id="3627037">x</span><span class="op" id="3627038">.</span><span class="ident" id="3627039">high</span><span class="op" id="3627043">&amp;</span><span class="num" id="3627044">1</span>&nbsp;<span class="op" id="3627046">==</span>&nbsp;<span class="num" id="3627049">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627053">//&nbsp;Because&nbsp;of&nbsp;the&nbsp;bit-ordering,&nbsp;doubling&nbsp;is&nbsp;actually&nbsp;a&nbsp;right&nbsp;shift.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627122">double</span><span class="op" id="3627128">.</span><span class="ident" id="3627129">high</span>&nbsp;<span class="op" id="3627134">=</span>&nbsp;<span class="ident" id="3627136">x</span><span class="op" id="3627137">.</span><span class="ident" id="3627138">high</span>&nbsp;<span class="op" id="3627143">&gt;&gt;</span>&nbsp;<span class="num" id="3627146">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627149">double</span><span class="op" id="3627155">.</span><span class="ident" id="3627156">high</span>&nbsp;<span class="op" id="3627161">|=</span>&nbsp;<span class="ident" id="3627164">x</span><span class="op" id="3627165">.</span><span class="ident" id="3627166">low</span>&nbsp;<span class="op" id="3627170">&lt;&lt;</span>&nbsp;<span class="num" id="3627173">63</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627177">double</span><span class="op" id="3627183">.</span><span class="ident" id="3627184">low</span>&nbsp;<span class="op" id="3627188">=</span>&nbsp;<span class="ident" id="3627190">x</span><span class="op" id="3627191">.</span><span class="ident" id="3627192">low</span>&nbsp;<span class="op" id="3627196">&gt;&gt;</span>&nbsp;<span class="num" id="3627199">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627203">//&nbsp;If&nbsp;the&nbsp;most-significant&nbsp;bit&nbsp;was&nbsp;set&nbsp;before&nbsp;shifting&nbsp;then&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627268">//&nbsp;conceptually,&nbsp;becomes&nbsp;a&nbsp;term&nbsp;of&nbsp;x^128.&nbsp;This&nbsp;is&nbsp;greater&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627336">//&nbsp;irreducible&nbsp;polynomial&nbsp;so&nbsp;the&nbsp;result&nbsp;has&nbsp;to&nbsp;be&nbsp;reduced.&nbsp;The</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627400">//&nbsp;irreducible&nbsp;polynomial&nbsp;is&nbsp;1+x+x^2+x^7+x^128.&nbsp;We&nbsp;can&nbsp;subtract&nbsp;that&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627473">//&nbsp;eliminate&nbsp;the&nbsp;term&nbsp;at&nbsp;x^128&nbsp;which&nbsp;also&nbsp;means&nbsp;subtracting&nbsp;the&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627544">//&nbsp;four&nbsp;terms.&nbsp;In&nbsp;characteristic&nbsp;2&nbsp;fields,&nbsp;subtraction&nbsp;==&nbsp;addition&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627615">//&nbsp;XOR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627624">if</span>&nbsp;<span class="ident" id="3627627">msbSet</span>&nbsp;<span class="op" id="3627634">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627638">double</span><span class="op" id="3627644">.</span><span class="ident" id="3627645">low</span>&nbsp;<span class="op" id="3627649">^=</span>&nbsp;<span class="num" id="3627652">0xe100000000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3627672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627676">return</span><br>
<span class="lineno"></span><span class="op" id="3627683">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="keyword" id="3627686">var</span>&nbsp;<span class="ident" id="3627690">gcmReductionTable</span>&nbsp;<span class="op" id="3627708">=</span>&nbsp;<span class="op" id="3627710">[</span><span class="op" id="3627711">]</span><span class="builtintype" id="3627712">uint16</span><span class="op" id="3627718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3627721">0x0000</span><span class="op" id="3627727">,</span>&nbsp;<span class="num" id="3627729">0x1c20</span><span class="op" id="3627735">,</span>&nbsp;<span class="num" id="3627737">0x3840</span><span class="op" id="3627743">,</span>&nbsp;<span class="num" id="3627745">0x2460</span><span class="op" id="3627751">,</span>&nbsp;<span class="num" id="3627753">0x7080</span><span class="op" id="3627759">,</span>&nbsp;<span class="num" id="3627761">0x6ca0</span><span class="op" id="3627767">,</span>&nbsp;<span class="num" id="3627769">0x48c0</span><span class="op" id="3627775">,</span>&nbsp;<span class="num" id="3627777">0x54e0</span><span class="op" id="3627783">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3627786">0xe100</span><span class="op" id="3627792">,</span>&nbsp;<span class="num" id="3627794">0xfd20</span><span class="op" id="3627800">,</span>&nbsp;<span class="num" id="3627802">0xd940</span><span class="op" id="3627808">,</span>&nbsp;<span class="num" id="3627810">0xc560</span><span class="op" id="3627816">,</span>&nbsp;<span class="num" id="3627818">0x9180</span><span class="op" id="3627824">,</span>&nbsp;<span class="num" id="3627826">0x8da0</span><span class="op" id="3627832">,</span>&nbsp;<span class="num" id="3627834">0xa9c0</span><span class="op" id="3627840">,</span>&nbsp;<span class="num" id="3627842">0xb5e0</span><span class="op" id="3627848">,</span><br>
<span class="lineno"></span><span class="op" id="3627850">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="3627853">//&nbsp;mul&nbsp;sets&nbsp;y&nbsp;to&nbsp;y*H,&nbsp;where&nbsp;H&nbsp;is&nbsp;the&nbsp;GCM&nbsp;key,&nbsp;fixed&nbsp;during&nbsp;NewGCM.</span><br>
<span class="lineno"></span><span class="keyword" id="3627920">func</span>&nbsp;<span class="op" id="3627925">(</span><span class="ident" id="3627926">g</span>&nbsp;<span class="op" id="3627928">*</span><span class="ident" id="3627929">gcm</span><span class="op" id="3627932">)</span>&nbsp;<span class="ident" id="3627934">mul</span><span class="op" id="3627937">(</span><span class="ident" id="3627938">y</span>&nbsp;<span class="op" id="3627940">*</span><span class="ident" id="3627941">gcmFieldElement</span><span class="op" id="3627956">)</span>&nbsp;<span class="op" id="3627958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627961">var</span>&nbsp;<span class="ident" id="3627965">z</span>&nbsp;<span class="ident" id="3627967">gcmFieldElement</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3627985">for</span>&nbsp;<span class="ident" id="3627989">i</span>&nbsp;<span class="op" id="3627991">:=</span>&nbsp;<span class="num" id="3627994">0</span><span class="op" id="3627995">;</span>&nbsp;<span class="ident" id="3627997">i</span>&nbsp;<span class="op" id="3627999">&lt;</span>&nbsp;<span class="num" id="3628001">2</span><span class="op" id="3628002">;</span>&nbsp;<span class="ident" id="3628004">i</span><span class="op" id="3628005">++</span>&nbsp;<span class="op" id="3628008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628012">word</span>&nbsp;<span class="op" id="3628017">:=</span>&nbsp;<span class="ident" id="3628020">y</span><span class="op" id="3628021">.</span><span class="ident" id="3628022">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628029">if</span>&nbsp;<span class="ident" id="3628032">i</span>&nbsp;<span class="op" id="3628034">==</span>&nbsp;<span class="num" id="3628037">1</span>&nbsp;<span class="op" id="3628039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628044">word</span>&nbsp;<span class="op" id="3628049">=</span>&nbsp;<span class="ident" id="3628051">y</span><span class="op" id="3628052">.</span><span class="ident" id="3628053">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628059">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628064">//&nbsp;Multiplication&nbsp;works&nbsp;by&nbsp;multiplying&nbsp;z&nbsp;by&nbsp;16&nbsp;and&nbsp;adding&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628127">//&nbsp;one&nbsp;of&nbsp;the&nbsp;precomputed&nbsp;multiples&nbsp;of&nbsp;H.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628171">for</span>&nbsp;<span class="ident" id="3628175">j</span>&nbsp;<span class="op" id="3628177">:=</span>&nbsp;<span class="num" id="3628180">0</span><span class="op" id="3628181">;</span>&nbsp;<span class="ident" id="3628183">j</span>&nbsp;<span class="op" id="3628185">&lt;</span>&nbsp;<span class="num" id="3628187">64</span><span class="op" id="3628189">;</span>&nbsp;<span class="ident" id="3628191">j</span>&nbsp;<span class="op" id="3628193">+=</span>&nbsp;<span class="num" id="3628196">4</span>&nbsp;<span class="op" id="3628198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628203">msw</span>&nbsp;<span class="op" id="3628207">:=</span>&nbsp;<span class="ident" id="3628210">z</span><span class="op" id="3628211">.</span><span class="ident" id="3628212">high</span>&nbsp;<span class="op" id="3628217">&amp;</span>&nbsp;<span class="num" id="3628219">0xf</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628226">z</span><span class="op" id="3628227">.</span><span class="ident" id="3628228">high</span>&nbsp;<span class="op" id="3628233">&gt;&gt;=</span>&nbsp;<span class="num" id="3628237">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628242">z</span><span class="op" id="3628243">.</span><span class="ident" id="3628244">high</span>&nbsp;<span class="op" id="3628249">|=</span>&nbsp;<span class="ident" id="3628252">z</span><span class="op" id="3628253">.</span><span class="ident" id="3628254">low</span>&nbsp;<span class="op" id="3628258">&lt;&lt;</span>&nbsp;<span class="num" id="3628261">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628267">z</span><span class="op" id="3628268">.</span><span class="ident" id="3628269">low</span>&nbsp;<span class="op" id="3628273">&gt;&gt;=</span>&nbsp;<span class="num" id="3628277">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628282">z</span><span class="op" id="3628283">.</span><span class="ident" id="3628284">low</span>&nbsp;<span class="op" id="3628288">^=</span>&nbsp;<span class="ident" id="3628291">uint64</span><span class="op" id="3628297">(</span><span class="ident" id="3628298">gcmReductionTable</span><span class="op" id="3628315">[</span><span class="ident" id="3628316">msw</span><span class="op" id="3628319">]</span><span class="op" id="3628320">)</span>&nbsp;<span class="op" id="3628322">&lt;&lt;</span>&nbsp;<span class="num" id="3628325">48</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628332">//&nbsp;the&nbsp;values&nbsp;in&nbsp;|table|&nbsp;are&nbsp;ordered&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628376">//&nbsp;little-endian&nbsp;bit&nbsp;positions.&nbsp;See&nbsp;the&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628427">//&nbsp;in&nbsp;NewGCM.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628444">t</span>&nbsp;<span class="op" id="3628446">:=</span>&nbsp;<span class="op" id="3628449">&amp;</span><span class="ident" id="3628450">g</span><span class="op" id="3628451">.</span><span class="ident" id="3628452">productTable</span><span class="op" id="3628464">[</span><span class="ident" id="3628465">word</span><span class="op" id="3628469">&amp;</span><span class="num" id="3628470">0xf</span><span class="op" id="3628473">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628479">z</span><span class="op" id="3628480">.</span><span class="ident" id="3628481">low</span>&nbsp;<span class="op" id="3628485">^=</span>&nbsp;<span class="ident" id="3628488">t</span><span class="op" id="3628489">.</span><span class="ident" id="3628490">low</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628497">z</span><span class="op" id="3628498">.</span><span class="ident" id="3628499">high</span>&nbsp;<span class="op" id="3628504">^=</span>&nbsp;<span class="ident" id="3628507">t</span><span class="op" id="3628508">.</span><span class="ident" id="3628509">high</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628517">word</span>&nbsp;<span class="op" id="3628522">&gt;&gt;=</span>&nbsp;<span class="num" id="3628526">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628533">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628537">*</span><span class="ident" id="3628538">y</span>&nbsp;<span class="op" id="3628540">=</span>&nbsp;<span class="ident" id="3628542">z</span><br>
<span class="lineno"></span><span class="op" id="3628544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3628547">//&nbsp;updateBlocks&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;blocks,&nbsp;based&nbsp;on</span><br>
<span class="lineno">235</span><span class="comment" id="3628622">//&nbsp;Horner&#39;s&nbsp;rule.&nbsp;There&nbsp;must&nbsp;be&nbsp;a&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;in&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3628698">func</span>&nbsp;<span class="op" id="3628703">(</span><span class="ident" id="3628704">g</span>&nbsp;<span class="op" id="3628706">*</span><span class="ident" id="3628707">gcm</span><span class="op" id="3628710">)</span>&nbsp;<span class="ident" id="3628712">updateBlocks</span><span class="op" id="3628724">(</span><span class="ident" id="3628725">y</span>&nbsp;<span class="op" id="3628727">*</span><span class="ident" id="3628728">gcmFieldElement</span><span class="op" id="3628743">,</span>&nbsp;<span class="ident" id="3628745">blocks</span>&nbsp;<span class="op" id="3628752">[</span><span class="op" id="3628753">]</span><span class="builtintype" id="3628754">byte</span><span class="op" id="3628758">)</span>&nbsp;<span class="op" id="3628760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3628763">for</span>&nbsp;<span class="builtinfunc" id="3628767">len</span><span class="op" id="3628770">(</span><span class="ident" id="3628771">blocks</span><span class="op" id="3628777">)</span>&nbsp;<span class="op" id="3628779">&gt;</span>&nbsp;<span class="num" id="3628781">0</span>&nbsp;<span class="op" id="3628783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628787">y</span><span class="op" id="3628788">.</span><span class="ident" id="3628789">low</span>&nbsp;<span class="op" id="3628793">^=</span>&nbsp;<span class="ident" id="3628796">getUint64</span><span class="op" id="3628805">(</span><span class="ident" id="3628806">blocks</span><span class="op" id="3628812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628816">y</span><span class="op" id="3628817">.</span><span class="ident" id="3628818">high</span>&nbsp;<span class="op" id="3628823">^=</span>&nbsp;<span class="ident" id="3628826">getUint64</span><span class="op" id="3628835">(</span><span class="ident" id="3628836">blocks</span><span class="op" id="3628842">[</span><span class="num" id="3628843">8</span><span class="op" id="3628844">:</span><span class="op" id="3628845">]</span><span class="op" id="3628846">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628850">g</span><span class="op" id="3628851">.</span><span class="ident" id="3628852">mul</span><span class="op" id="3628855">(</span><span class="ident" id="3628856">y</span><span class="op" id="3628857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628861">blocks</span>&nbsp;<span class="op" id="3628868">=</span>&nbsp;<span class="ident" id="3628870">blocks</span><span class="op" id="3628876">[</span><span class="ident" id="3628877">gcmBlockSize</span><span class="op" id="3628889">:</span><span class="op" id="3628890">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3628893">}</span><br>
<span class="lineno"></span><span class="op" id="3628895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="3628898">//&nbsp;update&nbsp;extends&nbsp;y&nbsp;with&nbsp;more&nbsp;polynomial&nbsp;terms&nbsp;from&nbsp;data.&nbsp;If&nbsp;data&nbsp;is&nbsp;not&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3628973">//&nbsp;multiple&nbsp;of&nbsp;gcmBlockSize&nbsp;bytes&nbsp;long&nbsp;then&nbsp;the&nbsp;remainder&nbsp;is&nbsp;zero&nbsp;padded.</span><br>
<span class="lineno"></span><span class="keyword" id="3629047">func</span>&nbsp;<span class="op" id="3629052">(</span><span class="ident" id="3629053">g</span>&nbsp;<span class="op" id="3629055">*</span><span class="ident" id="3629056">gcm</span><span class="op" id="3629059">)</span>&nbsp;<span class="ident" id="3629061">update</span><span class="op" id="3629067">(</span><span class="ident" id="3629068">y</span>&nbsp;<span class="op" id="3629070">*</span><span class="ident" id="3629071">gcmFieldElement</span><span class="op" id="3629086">,</span>&nbsp;<span class="ident" id="3629088">data</span>&nbsp;<span class="op" id="3629093">[</span><span class="op" id="3629094">]</span><span class="builtintype" id="3629095">byte</span><span class="op" id="3629099">)</span>&nbsp;<span class="op" id="3629101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629104">fullBlocks</span>&nbsp;<span class="op" id="3629115">:=</span>&nbsp;<span class="op" id="3629118">(</span><span class="builtinfunc" id="3629119">len</span><span class="op" id="3629122">(</span><span class="ident" id="3629123">data</span><span class="op" id="3629127">)</span>&nbsp;<span class="op" id="3629129">&gt;&gt;</span>&nbsp;<span class="num" id="3629132">4</span><span class="op" id="3629133">)</span>&nbsp;<span class="op" id="3629135">&lt;&lt;</span>&nbsp;<span class="num" id="3629138">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629141">g</span><span class="op" id="3629142">.</span><span class="ident" id="3629143">updateBlocks</span><span class="op" id="3629155">(</span><span class="ident" id="3629156">y</span><span class="op" id="3629157">,</span>&nbsp;<span class="ident" id="3629159">data</span><span class="op" id="3629163">[</span><span class="op" id="3629164">:</span><span class="ident" id="3629165">fullBlocks</span><span class="op" id="3629175">]</span><span class="op" id="3629176">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629180">if</span>&nbsp;<span class="builtinfunc" id="3629183">len</span><span class="op" id="3629186">(</span><span class="ident" id="3629187">data</span><span class="op" id="3629191">)</span>&nbsp;<span class="op" id="3629193">!=</span>&nbsp;<span class="ident" id="3629196">fullBlocks</span>&nbsp;<span class="op" id="3629207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629211">var</span>&nbsp;<span class="ident" id="3629215">partialBlock</span>&nbsp;<span class="op" id="3629228">[</span><span class="ident" id="3629229">gcmBlockSize</span><span class="op" id="3629241">]</span><span class="builtintype" id="3629242">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3629249">copy</span><span class="op" id="3629253">(</span><span class="ident" id="3629254">partialBlock</span><span class="op" id="3629266">[</span><span class="op" id="3629267">:</span><span class="op" id="3629268">]</span><span class="op" id="3629269">,</span>&nbsp;<span class="ident" id="3629271">data</span><span class="op" id="3629275">[</span><span class="ident" id="3629276">fullBlocks</span><span class="op" id="3629286">:</span><span class="op" id="3629287">]</span><span class="op" id="3629288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629292">g</span><span class="op" id="3629293">.</span><span class="ident" id="3629294">updateBlocks</span><span class="op" id="3629306">(</span><span class="ident" id="3629307">y</span><span class="op" id="3629308">,</span>&nbsp;<span class="ident" id="3629310">partialBlock</span><span class="op" id="3629322">[</span><span class="op" id="3629323">:</span><span class="op" id="3629324">]</span><span class="op" id="3629325">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629328">}</span><br>
<span class="lineno"></span><span class="op" id="3629330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3629333">//&nbsp;gcmInc32&nbsp;treats&nbsp;the&nbsp;final&nbsp;four&nbsp;bytes&nbsp;of&nbsp;counterBlock&nbsp;as&nbsp;a&nbsp;big-endian&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="3629411">//&nbsp;and&nbsp;increments&nbsp;it.</span><br>
<span class="lineno">260</span><span class="keyword" id="3629433">func</span>&nbsp;<span class="ident" id="3629438">gcmInc32</span><span class="op" id="3629446">(</span><span class="ident" id="3629447">counterBlock</span>&nbsp;<span class="op" id="3629460">*</span><span class="op" id="3629461">[</span><span class="num" id="3629462">16</span><span class="op" id="3629464">]</span><span class="builtintype" id="3629465">byte</span><span class="op" id="3629469">)</span>&nbsp;<span class="op" id="3629471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629474">for</span>&nbsp;<span class="ident" id="3629478">i</span>&nbsp;<span class="op" id="3629480">:=</span>&nbsp;<span class="ident" id="3629483">gcmBlockSize</span>&nbsp;<span class="op" id="3629496">-</span>&nbsp;<span class="num" id="3629498">1</span><span class="op" id="3629499">;</span>&nbsp;<span class="ident" id="3629501">i</span>&nbsp;<span class="op" id="3629503">&gt;=</span>&nbsp;<span class="ident" id="3629506">gcmBlockSize</span><span class="op" id="3629518">-</span><span class="num" id="3629519">4</span><span class="op" id="3629520">;</span>&nbsp;<span class="ident" id="3629522">i</span><span class="op" id="3629523">--</span>&nbsp;<span class="op" id="3629526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629530">counterBlock</span><span class="op" id="3629542">[</span><span class="ident" id="3629543">i</span><span class="op" id="3629544">]</span><span class="op" id="3629545">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629550">if</span>&nbsp;<span class="ident" id="3629553">counterBlock</span><span class="op" id="3629565">[</span><span class="ident" id="3629566">i</span><span class="op" id="3629567">]</span>&nbsp;<span class="op" id="3629569">!=</span>&nbsp;<span class="num" id="3629572">0</span>&nbsp;<span class="op" id="3629574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629579">break</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3629590">}</span><br>
<span class="lineno"></span><span class="op" id="3629592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3629595">//&nbsp;sliceForAppend&nbsp;takes&nbsp;a&nbsp;slice&nbsp;and&nbsp;a&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes.&nbsp;It&nbsp;returns&nbsp;a</span><br>
<span class="lineno">270</span><span class="comment" id="3629673">//&nbsp;slice&nbsp;with&nbsp;the&nbsp;contents&nbsp;of&nbsp;the&nbsp;given&nbsp;slice&nbsp;followed&nbsp;by&nbsp;that&nbsp;many&nbsp;bytes&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3629753">//&nbsp;second&nbsp;slice&nbsp;that&nbsp;aliases&nbsp;into&nbsp;it&nbsp;and&nbsp;contains&nbsp;only&nbsp;the&nbsp;extra&nbsp;bytes.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3629832">//&nbsp;original&nbsp;slice&nbsp;has&nbsp;sufficient&nbsp;capacity&nbsp;then&nbsp;no&nbsp;allocation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="3629907">func</span>&nbsp;<span class="ident" id="3629912">sliceForAppend</span><span class="op" id="3629926">(</span><span class="ident" id="3629927">in</span>&nbsp;<span class="op" id="3629930">[</span><span class="op" id="3629931">]</span><span class="builtintype" id="3629932">byte</span><span class="op" id="3629936">,</span>&nbsp;<span class="ident" id="3629938">n</span>&nbsp;<span class="builtintype" id="3629940">int</span><span class="op" id="3629943">)</span>&nbsp;<span class="op" id="3629945">(</span><span class="ident" id="3629946">head</span><span class="op" id="3629950">,</span>&nbsp;<span class="ident" id="3629952">tail</span>&nbsp;<span class="op" id="3629957">[</span><span class="op" id="3629958">]</span><span class="builtintype" id="3629959">byte</span><span class="op" id="3629963">)</span>&nbsp;<span class="op" id="3629965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3629968">if</span>&nbsp;<span class="ident" id="3629971">total</span>&nbsp;<span class="op" id="3629977">:=</span>&nbsp;<span class="builtinfunc" id="3629980">len</span><span class="op" id="3629983">(</span><span class="ident" id="3629984">in</span><span class="op" id="3629986">)</span>&nbsp;<span class="op" id="3629988">+</span>&nbsp;<span class="ident" id="3629990">n</span><span class="op" id="3629991">;</span>&nbsp;<span class="builtinfunc" id="3629993">cap</span><span class="op" id="3629996">(</span><span class="ident" id="3629997">in</span><span class="op" id="3629999">)</span>&nbsp;<span class="op" id="3630001">&gt;=</span>&nbsp;<span class="ident" id="3630004">total</span>&nbsp;<span class="op" id="3630010">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630014">head</span>&nbsp;<span class="op" id="3630019">=</span>&nbsp;<span class="ident" id="3630021">in</span><span class="op" id="3630023">[</span><span class="op" id="3630024">:</span><span class="ident" id="3630025">total</span><span class="op" id="3630030">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630033">}</span>&nbsp;<span class="keyword" id="3630035">else</span>&nbsp;<span class="op" id="3630040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630044">head</span>&nbsp;<span class="op" id="3630049">=</span>&nbsp;<span class="builtinfunc" id="3630051">make</span><span class="op" id="3630055">(</span><span class="op" id="3630056">[</span><span class="op" id="3630057">]</span><span class="builtintype" id="3630058">byte</span><span class="op" id="3630062">,</span>&nbsp;<span class="ident" id="3630064">total</span><span class="op" id="3630069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3630073">copy</span><span class="op" id="3630077">(</span><span class="ident" id="3630078">head</span><span class="op" id="3630082">,</span>&nbsp;<span class="ident" id="3630084">in</span><span class="op" id="3630086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630089">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630092">tail</span>&nbsp;<span class="op" id="3630097">=</span>&nbsp;<span class="ident" id="3630099">head</span><span class="op" id="3630103">[</span><span class="builtinfunc" id="3630104">len</span><span class="op" id="3630107">(</span><span class="ident" id="3630108">in</span><span class="op" id="3630110">)</span><span class="op" id="3630111">:</span><span class="op" id="3630112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630115">return</span><br>
<span class="lineno"></span><span class="op" id="3630122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3630125">//&nbsp;counterCrypt&nbsp;crypts&nbsp;in&nbsp;to&nbsp;out&nbsp;using&nbsp;g.cipher&nbsp;in&nbsp;counter&nbsp;mode.</span><br>
<span class="lineno">285</span><span class="keyword" id="3630190">func</span>&nbsp;<span class="op" id="3630195">(</span><span class="ident" id="3630196">g</span>&nbsp;<span class="op" id="3630198">*</span><span class="ident" id="3630199">gcm</span><span class="op" id="3630202">)</span>&nbsp;<span class="ident" id="3630204">counterCrypt</span><span class="op" id="3630216">(</span><span class="ident" id="3630217">out</span><span class="op" id="3630220">,</span>&nbsp;<span class="ident" id="3630222">in</span>&nbsp;<span class="op" id="3630225">[</span><span class="op" id="3630226">]</span><span class="builtintype" id="3630227">byte</span><span class="op" id="3630231">,</span>&nbsp;<span class="ident" id="3630233">counter</span>&nbsp;<span class="op" id="3630241">*</span><span class="op" id="3630242">[</span><span class="ident" id="3630243">gcmBlockSize</span><span class="op" id="3630255">]</span><span class="builtintype" id="3630256">byte</span><span class="op" id="3630260">)</span>&nbsp;<span class="op" id="3630262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630265">var</span>&nbsp;<span class="ident" id="3630269">mask</span>&nbsp;<span class="op" id="3630274">[</span><span class="ident" id="3630275">gcmBlockSize</span><span class="op" id="3630287">]</span><span class="builtintype" id="3630288">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630295">for</span>&nbsp;<span class="builtinfunc" id="3630299">len</span><span class="op" id="3630302">(</span><span class="ident" id="3630303">in</span><span class="op" id="3630305">)</span>&nbsp;<span class="op" id="3630307">&gt;=</span>&nbsp;<span class="ident" id="3630310">gcmBlockSize</span>&nbsp;<span class="op" id="3630323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630327">g</span><span class="op" id="3630328">.</span><span class="ident" id="3630329">cipher</span><span class="op" id="3630335">.</span><span class="ident" id="3630336">Encrypt</span><span class="op" id="3630343">(</span><span class="ident" id="3630344">mask</span><span class="op" id="3630348">[</span><span class="op" id="3630349">:</span><span class="op" id="3630350">]</span><span class="op" id="3630351">,</span>&nbsp;<span class="ident" id="3630353">counter</span><span class="op" id="3630360">[</span><span class="op" id="3630361">:</span><span class="op" id="3630362">]</span><span class="op" id="3630363">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630367">gcmInc32</span><span class="op" id="3630375">(</span><span class="ident" id="3630376">counter</span><span class="op" id="3630383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630388">xorWords</span><span class="op" id="3630396">(</span><span class="ident" id="3630397">out</span><span class="op" id="3630400">,</span>&nbsp;<span class="ident" id="3630402">in</span><span class="op" id="3630404">,</span>&nbsp;<span class="ident" id="3630406">mask</span><span class="op" id="3630410">[</span><span class="op" id="3630411">:</span><span class="op" id="3630412">]</span><span class="op" id="3630413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630417">out</span>&nbsp;<span class="op" id="3630421">=</span>&nbsp;<span class="ident" id="3630423">out</span><span class="op" id="3630426">[</span><span class="ident" id="3630427">gcmBlockSize</span><span class="op" id="3630439">:</span><span class="op" id="3630440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630444">in</span>&nbsp;<span class="op" id="3630447">=</span>&nbsp;<span class="ident" id="3630449">in</span><span class="op" id="3630451">[</span><span class="ident" id="3630452">gcmBlockSize</span><span class="op" id="3630464">:</span><span class="op" id="3630465">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630472">if</span>&nbsp;<span class="builtinfunc" id="3630475">len</span><span class="op" id="3630478">(</span><span class="ident" id="3630479">in</span><span class="op" id="3630481">)</span>&nbsp;<span class="op" id="3630483">&gt;</span>&nbsp;<span class="num" id="3630485">0</span>&nbsp;<span class="op" id="3630487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630491">g</span><span class="op" id="3630492">.</span><span class="ident" id="3630493">cipher</span><span class="op" id="3630499">.</span><span class="ident" id="3630500">Encrypt</span><span class="op" id="3630507">(</span><span class="ident" id="3630508">mask</span><span class="op" id="3630512">[</span><span class="op" id="3630513">:</span><span class="op" id="3630514">]</span><span class="op" id="3630515">,</span>&nbsp;<span class="ident" id="3630517">counter</span><span class="op" id="3630524">[</span><span class="op" id="3630525">:</span><span class="op" id="3630526">]</span><span class="op" id="3630527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630531">gcmInc32</span><span class="op" id="3630539">(</span><span class="ident" id="3630540">counter</span><span class="op" id="3630547">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630551">xorBytes</span><span class="op" id="3630559">(</span><span class="ident" id="3630560">out</span><span class="op" id="3630563">,</span>&nbsp;<span class="ident" id="3630565">in</span><span class="op" id="3630567">,</span>&nbsp;<span class="ident" id="3630569">mask</span><span class="op" id="3630573">[</span><span class="op" id="3630574">:</span><span class="op" id="3630575">]</span><span class="op" id="3630576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3630579">}</span><br>
<span class="lineno"></span><span class="op" id="3630581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3630584">//&nbsp;auth&nbsp;calculates&nbsp;GHASH(ciphertext,&nbsp;additionalData),&nbsp;masks&nbsp;the&nbsp;result&nbsp;with</span><br>
<span class="lineno">305</span><span class="comment" id="3630660">//&nbsp;tagMask&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span><span class="keyword" id="3630701">func</span>&nbsp;<span class="op" id="3630706">(</span><span class="ident" id="3630707">g</span>&nbsp;<span class="op" id="3630709">*</span><span class="ident" id="3630710">gcm</span><span class="op" id="3630713">)</span>&nbsp;<span class="ident" id="3630715">auth</span><span class="op" id="3630719">(</span><span class="ident" id="3630720">out</span><span class="op" id="3630723">,</span>&nbsp;<span class="ident" id="3630725">ciphertext</span><span class="op" id="3630735">,</span>&nbsp;<span class="ident" id="3630737">additionalData</span>&nbsp;<span class="op" id="3630752">[</span><span class="op" id="3630753">]</span><span class="builtintype" id="3630754">byte</span><span class="op" id="3630758">,</span>&nbsp;<span class="ident" id="3630760">tagMask</span>&nbsp;<span class="op" id="3630768">*</span><span class="op" id="3630769">[</span><span class="ident" id="3630770">gcmTagSize</span><span class="op" id="3630780">]</span><span class="builtintype" id="3630781">byte</span><span class="op" id="3630785">)</span>&nbsp;<span class="op" id="3630787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3630790">var</span>&nbsp;<span class="ident" id="3630794">y</span>&nbsp;<span class="ident" id="3630796">gcmFieldElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630813">g</span><span class="op" id="3630814">.</span><span class="ident" id="3630815">update</span><span class="op" id="3630821">(</span><span class="op" id="3630822">&amp;</span><span class="ident" id="3630823">y</span><span class="op" id="3630824">,</span>&nbsp;<span class="ident" id="3630826">additionalData</span><span class="op" id="3630840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630843">g</span><span class="op" id="3630844">.</span><span class="ident" id="3630845">update</span><span class="op" id="3630851">(</span><span class="op" id="3630852">&amp;</span><span class="ident" id="3630853">y</span><span class="op" id="3630854">,</span>&nbsp;<span class="ident" id="3630856">ciphertext</span><span class="op" id="3630866">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630870">y</span><span class="op" id="3630871">.</span><span class="ident" id="3630872">low</span>&nbsp;<span class="op" id="3630876">^=</span>&nbsp;<span class="ident" id="3630879">uint64</span><span class="op" id="3630885">(</span><span class="builtinfunc" id="3630886">len</span><span class="op" id="3630889">(</span><span class="ident" id="3630890">additionalData</span><span class="op" id="3630904">)</span><span class="op" id="3630905">)</span>&nbsp;<span class="op" id="3630907">*</span>&nbsp;<span class="num" id="3630909">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630912">y</span><span class="op" id="3630913">.</span><span class="ident" id="3630914">high</span>&nbsp;<span class="op" id="3630919">^=</span>&nbsp;<span class="ident" id="3630922">uint64</span><span class="op" id="3630928">(</span><span class="builtinfunc" id="3630929">len</span><span class="op" id="3630932">(</span><span class="ident" id="3630933">ciphertext</span><span class="op" id="3630943">)</span><span class="op" id="3630944">)</span>&nbsp;<span class="op" id="3630946">*</span>&nbsp;<span class="num" id="3630948">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630952">g</span><span class="op" id="3630953">.</span><span class="ident" id="3630954">mul</span><span class="op" id="3630957">(</span><span class="op" id="3630958">&amp;</span><span class="ident" id="3630959">y</span><span class="op" id="3630960">)</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630964">putUint64</span><span class="op" id="3630973">(</span><span class="ident" id="3630974">out</span><span class="op" id="3630977">,</span>&nbsp;<span class="ident" id="3630979">y</span><span class="op" id="3630980">.</span><span class="ident" id="3630981">low</span><span class="op" id="3630984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630987">putUint64</span><span class="op" id="3630996">(</span><span class="ident" id="3630997">out</span><span class="op" id="3631000">[</span><span class="num" id="3631001">8</span><span class="op" id="3631002">:</span><span class="op" id="3631003">]</span><span class="op" id="3631004">,</span>&nbsp;<span class="ident" id="3631006">y</span><span class="op" id="3631007">.</span><span class="ident" id="3631008">high</span><span class="op" id="3631012">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631016">xorWords</span><span class="op" id="3631024">(</span><span class="ident" id="3631025">out</span><span class="op" id="3631028">,</span>&nbsp;<span class="ident" id="3631030">out</span><span class="op" id="3631033">,</span>&nbsp;<span class="ident" id="3631035">tagMask</span><span class="op" id="3631042">[</span><span class="op" id="3631043">:</span><span class="op" id="3631044">]</span><span class="op" id="3631045">)</span><br>
<span class="lineno">320</span><span class="op" id="3631047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3631050">func</span>&nbsp;<span class="ident" id="3631055">getUint64</span><span class="op" id="3631064">(</span><span class="ident" id="3631065">data</span>&nbsp;<span class="op" id="3631070">[</span><span class="op" id="3631071">]</span><span class="builtintype" id="3631072">byte</span><span class="op" id="3631076">)</span>&nbsp;<span class="ident" id="3631078">uint64</span>&nbsp;<span class="op" id="3631085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631088">r</span>&nbsp;<span class="op" id="3631090">:=</span>&nbsp;<span class="ident" id="3631093">uint64</span><span class="op" id="3631099">(</span><span class="ident" id="3631100">data</span><span class="op" id="3631104">[</span><span class="num" id="3631105">0</span><span class="op" id="3631106">]</span><span class="op" id="3631107">)</span><span class="op" id="3631108">&lt;&lt;</span><span class="num" id="3631110">56</span>&nbsp;<span class="op" id="3631113">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631117">uint64</span><span class="op" id="3631123">(</span><span class="ident" id="3631124">data</span><span class="op" id="3631128">[</span><span class="num" id="3631129">1</span><span class="op" id="3631130">]</span><span class="op" id="3631131">)</span><span class="op" id="3631132">&lt;&lt;</span><span class="num" id="3631134">48</span>&nbsp;<span class="op" id="3631137">|</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631141">uint64</span><span class="op" id="3631147">(</span><span class="ident" id="3631148">data</span><span class="op" id="3631152">[</span><span class="num" id="3631153">2</span><span class="op" id="3631154">]</span><span class="op" id="3631155">)</span><span class="op" id="3631156">&lt;&lt;</span><span class="num" id="3631158">40</span>&nbsp;<span class="op" id="3631161">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631165">uint64</span><span class="op" id="3631171">(</span><span class="ident" id="3631172">data</span><span class="op" id="3631176">[</span><span class="num" id="3631177">3</span><span class="op" id="3631178">]</span><span class="op" id="3631179">)</span><span class="op" id="3631180">&lt;&lt;</span><span class="num" id="3631182">32</span>&nbsp;<span class="op" id="3631185">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631189">uint64</span><span class="op" id="3631195">(</span><span class="ident" id="3631196">data</span><span class="op" id="3631200">[</span><span class="num" id="3631201">4</span><span class="op" id="3631202">]</span><span class="op" id="3631203">)</span><span class="op" id="3631204">&lt;&lt;</span><span class="num" id="3631206">24</span>&nbsp;<span class="op" id="3631209">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631213">uint64</span><span class="op" id="3631219">(</span><span class="ident" id="3631220">data</span><span class="op" id="3631224">[</span><span class="num" id="3631225">5</span><span class="op" id="3631226">]</span><span class="op" id="3631227">)</span><span class="op" id="3631228">&lt;&lt;</span><span class="num" id="3631230">16</span>&nbsp;<span class="op" id="3631233">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631237">uint64</span><span class="op" id="3631243">(</span><span class="ident" id="3631244">data</span><span class="op" id="3631248">[</span><span class="num" id="3631249">6</span><span class="op" id="3631250">]</span><span class="op" id="3631251">)</span><span class="op" id="3631252">&lt;&lt;</span><span class="num" id="3631254">8</span>&nbsp;<span class="op" id="3631256">|</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631260">uint64</span><span class="op" id="3631266">(</span><span class="ident" id="3631267">data</span><span class="op" id="3631271">[</span><span class="num" id="3631272">7</span><span class="op" id="3631273">]</span><span class="op" id="3631274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3631277">return</span>&nbsp;<span class="ident" id="3631284">r</span><br>
<span class="lineno"></span><span class="op" id="3631286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3631289">func</span>&nbsp;<span class="ident" id="3631294">putUint64</span><span class="op" id="3631303">(</span><span class="ident" id="3631304">out</span>&nbsp;<span class="op" id="3631308">[</span><span class="op" id="3631309">]</span><span class="builtintype" id="3631310">byte</span><span class="op" id="3631314">,</span>&nbsp;<span class="ident" id="3631316">v</span>&nbsp;<span class="ident" id="3631318">uint64</span><span class="op" id="3631324">)</span>&nbsp;<span class="op" id="3631326">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631329">out</span><span class="op" id="3631332">[</span><span class="num" id="3631333">0</span><span class="op" id="3631334">]</span>&nbsp;<span class="op" id="3631336">=</span>&nbsp;<span class="builtintype" id="3631338">byte</span><span class="op" id="3631342">(</span><span class="ident" id="3631343">v</span>&nbsp;<span class="op" id="3631345">&gt;&gt;</span>&nbsp;<span class="num" id="3631348">56</span><span class="op" id="3631350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631353">out</span><span class="op" id="3631356">[</span><span class="num" id="3631357">1</span><span class="op" id="3631358">]</span>&nbsp;<span class="op" id="3631360">=</span>&nbsp;<span class="builtintype" id="3631362">byte</span><span class="op" id="3631366">(</span><span class="ident" id="3631367">v</span>&nbsp;<span class="op" id="3631369">&gt;&gt;</span>&nbsp;<span class="num" id="3631372">48</span><span class="op" id="3631374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631377">out</span><span class="op" id="3631380">[</span><span class="num" id="3631381">2</span><span class="op" id="3631382">]</span>&nbsp;<span class="op" id="3631384">=</span>&nbsp;<span class="builtintype" id="3631386">byte</span><span class="op" id="3631390">(</span><span class="ident" id="3631391">v</span>&nbsp;<span class="op" id="3631393">&gt;&gt;</span>&nbsp;<span class="num" id="3631396">40</span><span class="op" id="3631398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631401">out</span><span class="op" id="3631404">[</span><span class="num" id="3631405">3</span><span class="op" id="3631406">]</span>&nbsp;<span class="op" id="3631408">=</span>&nbsp;<span class="builtintype" id="3631410">byte</span><span class="op" id="3631414">(</span><span class="ident" id="3631415">v</span>&nbsp;<span class="op" id="3631417">&gt;&gt;</span>&nbsp;<span class="num" id="3631420">32</span><span class="op" id="3631422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631425">out</span><span class="op" id="3631428">[</span><span class="num" id="3631429">4</span><span class="op" id="3631430">]</span>&nbsp;<span class="op" id="3631432">=</span>&nbsp;<span class="builtintype" id="3631434">byte</span><span class="op" id="3631438">(</span><span class="ident" id="3631439">v</span>&nbsp;<span class="op" id="3631441">&gt;&gt;</span>&nbsp;<span class="num" id="3631444">24</span><span class="op" id="3631446">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631449">out</span><span class="op" id="3631452">[</span><span class="num" id="3631453">5</span><span class="op" id="3631454">]</span>&nbsp;<span class="op" id="3631456">=</span>&nbsp;<span class="builtintype" id="3631458">byte</span><span class="op" id="3631462">(</span><span class="ident" id="3631463">v</span>&nbsp;<span class="op" id="3631465">&gt;&gt;</span>&nbsp;<span class="num" id="3631468">16</span><span class="op" id="3631470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631473">out</span><span class="op" id="3631476">[</span><span class="num" id="3631477">6</span><span class="op" id="3631478">]</span>&nbsp;<span class="op" id="3631480">=</span>&nbsp;<span class="builtintype" id="3631482">byte</span><span class="op" id="3631486">(</span><span class="ident" id="3631487">v</span>&nbsp;<span class="op" id="3631489">&gt;&gt;</span>&nbsp;<span class="num" id="3631492">8</span><span class="op" id="3631493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631496">out</span><span class="op" id="3631499">[</span><span class="num" id="3631500">7</span><span class="op" id="3631501">]</span>&nbsp;<span class="op" id="3631503">=</span>&nbsp;<span class="builtintype" id="3631505">byte</span><span class="op" id="3631509">(</span><span class="ident" id="3631510">v</span><span class="op" id="3631511">)</span><br>
<span class="lineno"></span><span class="op" id="3631513">}</span>
</div>
</body>
</html>
