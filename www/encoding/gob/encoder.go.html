<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5129230">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5129285">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5129339">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5129390">package</span>&nbsp;<span class="ident" id="5129398">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5129403">import</span>&nbsp;<span class="op" id="5129410">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5129413">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5129419">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5129430">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5129437">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5129440">//&nbsp;An&nbsp;Encoder&nbsp;manages&nbsp;the&nbsp;transmission&nbsp;of&nbsp;type&nbsp;and&nbsp;data&nbsp;information&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5129515">//&nbsp;other&nbsp;side&nbsp;of&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">15</span><span class="keyword" id="5129546">type</span>&nbsp;<span class="ident" id="5129551">Encoder</span>&nbsp;<span class="keyword" id="5129559">struct</span>&nbsp;<span class="op" id="5129566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129569">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5129580"><a href="/encoding/gob/encoder.go.html#5129430">sync</a></span><span class="op" id="5129584">.</span><span class="ident" id="5129585">Mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5129604">//&nbsp;each&nbsp;item&nbsp;must&nbsp;be&nbsp;sent&nbsp;atomically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129642">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5129653">[</span><span class="op" id="5129654">]</span><span class="ident" id="5129655"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5129657">.</span><span class="ident" id="5129658">Writer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5129677">//&nbsp;where&nbsp;to&nbsp;send&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129704">sent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5129715">map</span><span class="op" id="5129718">[</span><span class="ident" id="5129719"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5129726">.</span><span class="ident" id="5129727">Type</span><span class="op" id="5129731">]</span><span class="ident" id="5129732"><a href="/encoding/gob/type.go.html#5143835">typeId</a></span>&nbsp;<span class="comment" id="5129739">//&nbsp;which&nbsp;types&nbsp;we&#39;ve&nbsp;already&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129774">countState</span>&nbsp;<span class="op" id="5129785">*</span><span class="ident" id="5129786"><a href="/encoding/gob/encode.go.html#5109586">encoderState</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5129809">//&nbsp;stage&nbsp;for&nbsp;writing&nbsp;counts</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129838">freeList</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5129849">*</span><span class="ident" id="5129850"><a href="/encoding/gob/encode.go.html#5109586">encoderState</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5129873">//&nbsp;list&nbsp;of&nbsp;free&nbsp;encoderStates;&nbsp;avoids&nbsp;reallocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129925">byteBuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5129936"><a href="/encoding/gob/encode.go.html#5110138">encBuffer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5129960">//&nbsp;buffer&nbsp;for&nbsp;top-level&nbsp;encoderState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5129998">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5130009">error</span><br>
<span class="lineno"></span><span class="op" id="5130015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5130018">//&nbsp;Before&nbsp;we&nbsp;encode&nbsp;a&nbsp;message,&nbsp;we&nbsp;reserve&nbsp;space&nbsp;at&nbsp;the&nbsp;head&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5130085">//&nbsp;buffer&nbsp;in&nbsp;which&nbsp;to&nbsp;encode&nbsp;its&nbsp;length.&nbsp;This&nbsp;means&nbsp;we&nbsp;can&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5130152">//&nbsp;buffer&nbsp;to&nbsp;assemble&nbsp;the&nbsp;message&nbsp;without&nbsp;another&nbsp;allocation.</span><br>
<span class="lineno"></span><span class="keyword" id="5130214">const</span>&nbsp;<span class="ident" id="5130220">maxLength</span>&nbsp;<span class="op" id="5130230">=</span>&nbsp;<span class="num" id="5130232">9</span>&nbsp;<span class="comment" id="5130234">//&nbsp;Maximum&nbsp;size&nbsp;of&nbsp;an&nbsp;encoded&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5130272">var</span>&nbsp;<span class="ident" id="5130276">spaceForLength</span>&nbsp;<span class="op" id="5130291">=</span>&nbsp;<span class="builtinfunc" id="5130293">make</span><span class="op" id="5130297">(</span><span class="op" id="5130298">[</span><span class="op" id="5130299">]</span><span class="builtintype" id="5130300">byte</span><span class="op" id="5130304">,</span>&nbsp;<span class="ident" id="5130306"><a href="/encoding/gob/encoder.go.html#5130220">maxLength</a></span><span class="op" id="5130315">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5130318">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;will&nbsp;transmit&nbsp;on&nbsp;the&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5130391">func</span>&nbsp;<span class="ident" id="5130396">NewEncoder</span><span class="op" id="5130406">(</span><span class="ident" id="5130407">w</span>&nbsp;<span class="ident" id="5130409"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5130411">.</span><span class="ident" id="5130412">Writer</span><span class="op" id="5130418">)</span>&nbsp;<span class="op" id="5130420">*</span><span class="ident" id="5130421"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span>&nbsp;<span class="op" id="5130429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130432">enc</span>&nbsp;<span class="op" id="5130436">:=</span>&nbsp;<span class="builtinfunc" id="5130439">new</span><span class="op" id="5130442">(</span><span class="ident" id="5130443"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5130450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130453"><a href="/encoding/gob/encoder.go.html#5130432">enc</a></span><span class="op" id="5130456">.</span><span class="ident" id="5130457">w</span>&nbsp;<span class="op" id="5130459">=</span>&nbsp;<span class="op" id="5130461">[</span><span class="op" id="5130462">]</span><span class="ident" id="5130463"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5130465">.</span><span class="ident" id="5130466">Writer</span><span class="op" id="5130472">{</span><span class="ident" id="5130473"><a href="/encoding/gob/encoder.go.html#5130407">w</a></span><span class="op" id="5130474">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130477"><a href="/encoding/gob/encoder.go.html#5130432">enc</a></span><span class="op" id="5130480">.</span><span class="ident" id="5130481">sent</span>&nbsp;<span class="op" id="5130486">=</span>&nbsp;<span class="builtinfunc" id="5130488">make</span><span class="op" id="5130492">(</span><span class="keyword" id="5130493">map</span><span class="op" id="5130496">[</span><span class="ident" id="5130497"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5130504">.</span><span class="ident" id="5130505">Type</span><span class="op" id="5130509">]</span><span class="ident" id="5130510"><a href="/encoding/gob/type.go.html#5143835">typeId</a></span><span class="op" id="5130516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130519"><a href="/encoding/gob/encoder.go.html#5130432">enc</a></span><span class="op" id="5130522">.</span><span class="ident" id="5130523">countState</span>&nbsp;<span class="op" id="5130534">=</span>&nbsp;<span class="ident" id="5130536"><a href="/encoding/gob/encoder.go.html#5130432">enc</a></span><span class="op" id="5130539">.</span><span class="ident" id="5130540">newEncoderState</span><span class="op" id="5130555">(</span><span class="builtinfunc" id="5130556">new</span><span class="op" id="5130559">(</span><span class="ident" id="5130560"><a href="/encoding/gob/encode.go.html#5110138">encBuffer</a></span><span class="op" id="5130569">)</span><span class="op" id="5130570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130573">return</span>&nbsp;<span class="ident" id="5130580"><a href="/encoding/gob/encoder.go.html#5130432">enc</a></span><br>
<span class="lineno"></span><span class="op" id="5130584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="5130587">//&nbsp;writer()&nbsp;returns&nbsp;the&nbsp;innermost&nbsp;writer&nbsp;the&nbsp;encoder&nbsp;is&nbsp;using</span><br>
<span class="lineno"></span><span class="keyword" id="5130649">func</span>&nbsp;<span class="op" id="5130654">(</span><span class="ident" id="5130655">enc</span>&nbsp;<span class="op" id="5130659">*</span><span class="ident" id="5130660"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5130667">)</span>&nbsp;<span class="ident" id="5130669">writer</span><span class="op" id="5130675">(</span><span class="op" id="5130676">)</span>&nbsp;<span class="ident" id="5130678"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5130680">.</span><span class="ident" id="5130681">Writer</span>&nbsp;<span class="op" id="5130688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130691">return</span>&nbsp;<span class="ident" id="5130698"><a href="/encoding/gob/encoder.go.html#5130655">enc</a></span><span class="op" id="5130701">.</span><span class="ident" id="5130702">w</span><span class="op" id="5130703">[</span><span class="builtinfunc" id="5130704">len</span><span class="op" id="5130707">(</span><span class="ident" id="5130708"><a href="/encoding/gob/encoder.go.html#5130655">enc</a></span><span class="op" id="5130711">.</span><span class="ident" id="5130712">w</span><span class="op" id="5130713">)</span><span class="op" id="5130714">-</span><span class="num" id="5130715">1</span><span class="op" id="5130716">]</span><br>
<span class="lineno"></span><span class="op" id="5130718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5130721">//&nbsp;pushWriter&nbsp;adds&nbsp;a&nbsp;writer&nbsp;to&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5130765">func</span>&nbsp;<span class="op" id="5130770">(</span><span class="ident" id="5130771">enc</span>&nbsp;<span class="op" id="5130775">*</span><span class="ident" id="5130776"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5130783">)</span>&nbsp;<span class="ident" id="5130785">pushWriter</span><span class="op" id="5130795">(</span><span class="ident" id="5130796">w</span>&nbsp;<span class="ident" id="5130798"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5130800">.</span><span class="ident" id="5130801">Writer</span><span class="op" id="5130807">)</span>&nbsp;<span class="op" id="5130809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130812"><a href="/encoding/gob/encoder.go.html#5130771">enc</a></span><span class="op" id="5130815">.</span><span class="ident" id="5130816">w</span>&nbsp;<span class="op" id="5130818">=</span>&nbsp;<span class="builtinfunc" id="5130820">append</span><span class="op" id="5130826">(</span><span class="ident" id="5130827"><a href="/encoding/gob/encoder.go.html#5130771">enc</a></span><span class="op" id="5130830">.</span><span class="ident" id="5130831">w</span><span class="op" id="5130832">,</span>&nbsp;<span class="ident" id="5130834"><a href="/encoding/gob/encoder.go.html#5130796">w</a></span><span class="op" id="5130835">)</span><br>
<span class="lineno"></span><span class="op" id="5130837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5130840">//&nbsp;popWriter&nbsp;pops&nbsp;the&nbsp;innermost&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5130880">func</span>&nbsp;<span class="op" id="5130885">(</span><span class="ident" id="5130886">enc</span>&nbsp;<span class="op" id="5130890">*</span><span class="ident" id="5130891"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5130898">)</span>&nbsp;<span class="ident" id="5130900">popWriter</span><span class="op" id="5130909">(</span><span class="op" id="5130910">)</span>&nbsp;<span class="op" id="5130912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5130915"><a href="/encoding/gob/encoder.go.html#5130886">enc</a></span><span class="op" id="5130918">.</span><span class="ident" id="5130919">w</span>&nbsp;<span class="op" id="5130921">=</span>&nbsp;<span class="ident" id="5130923"><a href="/encoding/gob/encoder.go.html#5130886">enc</a></span><span class="op" id="5130926">.</span><span class="ident" id="5130927">w</span><span class="op" id="5130928">[</span><span class="num" id="5130929">0</span>&nbsp;<span class="op" id="5130931">:</span>&nbsp;<span class="builtinfunc" id="5130933">len</span><span class="op" id="5130936">(</span><span class="ident" id="5130937"><a href="/encoding/gob/encoder.go.html#5130886">enc</a></span><span class="op" id="5130940">.</span><span class="ident" id="5130941">w</span><span class="op" id="5130942">)</span><span class="op" id="5130943">-</span><span class="num" id="5130944">1</span><span class="op" id="5130945">]</span><br>
<span class="lineno"></span><span class="op" id="5130947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5130950">func</span>&nbsp;<span class="op" id="5130955">(</span><span class="ident" id="5130956">enc</span>&nbsp;<span class="op" id="5130960">*</span><span class="ident" id="5130961"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5130968">)</span>&nbsp;<span class="ident" id="5130970">setError</span><span class="op" id="5130978">(</span><span class="ident" id="5130979">err</span>&nbsp;<span class="builtintype" id="5130983">error</span><span class="op" id="5130988">)</span>&nbsp;<span class="op" id="5130990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5130993">if</span>&nbsp;<span class="ident" id="5130996"><a href="/encoding/gob/encoder.go.html#5130956">enc</a></span><span class="op" id="5130999">.</span><span class="ident" id="5131000">err</span>&nbsp;<span class="op" id="5131004">==</span>&nbsp;<span class="ident" id="5131007">nil</span>&nbsp;<span class="op" id="5131011">{</span>&nbsp;<span class="comment" id="5131013">//&nbsp;remember&nbsp;the&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131038"><a href="/encoding/gob/encoder.go.html#5130956">enc</a></span><span class="op" id="5131041">.</span><span class="ident" id="5131042">err</span>&nbsp;<span class="op" id="5131046">=</span>&nbsp;<span class="ident" id="5131048"><a href="/encoding/gob/encoder.go.html#5130979">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131053">}</span><br>
<span class="lineno"></span><span class="op" id="5131055">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="5131058">//&nbsp;writeMessage&nbsp;sends&nbsp;the&nbsp;data&nbsp;item&nbsp;preceded&nbsp;by&nbsp;a&nbsp;unsigned&nbsp;count&nbsp;of&nbsp;its&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5131138">func</span>&nbsp;<span class="op" id="5131143">(</span><span class="ident" id="5131144">enc</span>&nbsp;<span class="op" id="5131148">*</span><span class="ident" id="5131149"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5131156">)</span>&nbsp;<span class="ident" id="5131158">writeMessage</span><span class="op" id="5131170">(</span><span class="ident" id="5131171">w</span>&nbsp;<span class="ident" id="5131173"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5131175">.</span><span class="ident" id="5131176">Writer</span><span class="op" id="5131182">,</span>&nbsp;<span class="ident" id="5131184">b</span>&nbsp;<span class="op" id="5131186">*</span><span class="ident" id="5131187"><a href="/encoding/gob/encode.go.html#5110138">encBuffer</a></span><span class="op" id="5131196">)</span>&nbsp;<span class="op" id="5131198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131201">//&nbsp;Space&nbsp;has&nbsp;been&nbsp;reserved&nbsp;for&nbsp;the&nbsp;length&nbsp;at&nbsp;the&nbsp;head&nbsp;of&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131272">//&nbsp;This&nbsp;is&nbsp;a&nbsp;little&nbsp;dirty:&nbsp;we&nbsp;grab&nbsp;the&nbsp;slice&nbsp;from&nbsp;the&nbsp;bytes.Buffer&nbsp;and&nbsp;massage</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131352">//&nbsp;it&nbsp;by&nbsp;hand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131368">message</span>&nbsp;<span class="op" id="5131376">:=</span>&nbsp;<span class="ident" id="5131379"><a href="/encoding/gob/encoder.go.html#5131184">b</a></span><span class="op" id="5131380">.</span><span class="ident" id="5131381">Bytes</span><span class="op" id="5131386">(</span><span class="op" id="5131387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131390">messageLen</span>&nbsp;<span class="op" id="5131401">:=</span>&nbsp;<span class="builtinfunc" id="5131404">len</span><span class="op" id="5131407">(</span><span class="ident" id="5131408"><a href="/encoding/gob/encoder.go.html#5131368">message</a></span><span class="op" id="5131415">)</span>&nbsp;<span class="op" id="5131417">-</span>&nbsp;<span class="ident" id="5131419"><a href="/encoding/gob/encoder.go.html#5130220">maxLength</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131430">//&nbsp;Encode&nbsp;the&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131453"><a href="/encoding/gob/encoder.go.html#5131144">enc</a></span><span class="op" id="5131456">.</span><span class="ident" id="5131457">countState</span><span class="op" id="5131467">.</span><span class="ident" id="5131468">b</span><span class="op" id="5131469">.</span><span class="ident" id="5131470">Reset</span><span class="op" id="5131475">(</span><span class="op" id="5131476">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131479"><a href="/encoding/gob/encoder.go.html#5131144">enc</a></span><span class="op" id="5131482">.</span><span class="ident" id="5131483">countState</span><span class="op" id="5131493">.</span><span class="ident" id="5131494">encodeUint</span><span class="op" id="5131504">(</span><span class="ident" id="5131505">uint64</span><span class="op" id="5131511">(</span><span class="ident" id="5131512"><a href="/encoding/gob/encoder.go.html#5131390">messageLen</a></span><span class="op" id="5131522">)</span><span class="op" id="5131523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131526">//&nbsp;Copy&nbsp;the&nbsp;length&nbsp;to&nbsp;be&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131577">offset</span>&nbsp;<span class="op" id="5131584">:=</span>&nbsp;<span class="ident" id="5131587"><a href="/encoding/gob/encoder.go.html#5130220">maxLength</a></span>&nbsp;<span class="op" id="5131597">-</span>&nbsp;<span class="ident" id="5131599"><a href="/encoding/gob/encoder.go.html#5131144">enc</a></span><span class="op" id="5131602">.</span><span class="ident" id="5131603">countState</span><span class="op" id="5131613">.</span><span class="ident" id="5131614">b</span><span class="op" id="5131615">.</span><span class="ident" id="5131616">Len</span><span class="op" id="5131619">(</span><span class="op" id="5131620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5131623">copy</span><span class="op" id="5131627">(</span><span class="ident" id="5131628"><a href="/encoding/gob/encoder.go.html#5131368">message</a></span><span class="op" id="5131635">[</span><span class="ident" id="5131636"><a href="/encoding/gob/encoder.go.html#5131577">offset</a></span><span class="op" id="5131642">:</span><span class="op" id="5131643">]</span><span class="op" id="5131644">,</span>&nbsp;<span class="ident" id="5131646"><a href="/encoding/gob/encoder.go.html#5131144">enc</a></span><span class="op" id="5131649">.</span><span class="ident" id="5131650">countState</span><span class="op" id="5131660">.</span><span class="ident" id="5131661">b</span><span class="op" id="5131662">.</span><span class="ident" id="5131663">Bytes</span><span class="op" id="5131668">(</span><span class="op" id="5131669">)</span><span class="op" id="5131670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131673">//&nbsp;Write&nbsp;the&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131693">_</span><span class="op" id="5131694">,</span>&nbsp;<span class="ident" id="5131696">err</span>&nbsp;<span class="op" id="5131700">:=</span>&nbsp;<span class="ident" id="5131703"><a href="/encoding/gob/encoder.go.html#5131171">w</a></span><span class="op" id="5131704">.</span><span class="ident" id="5131705">Write</span><span class="op" id="5131710">(</span><span class="ident" id="5131711"><a href="/encoding/gob/encoder.go.html#5131368">message</a></span><span class="op" id="5131718">[</span><span class="ident" id="5131719"><a href="/encoding/gob/encoder.go.html#5131577">offset</a></span><span class="op" id="5131725">:</span><span class="op" id="5131726">]</span><span class="op" id="5131727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5131730">//&nbsp;Drain&nbsp;the&nbsp;buffer&nbsp;and&nbsp;restore&nbsp;the&nbsp;space&nbsp;at&nbsp;the&nbsp;front&nbsp;for&nbsp;the&nbsp;count&nbsp;of&nbsp;the&nbsp;next&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131821"><a href="/encoding/gob/encoder.go.html#5131184">b</a></span><span class="op" id="5131822">.</span><span class="ident" id="5131823">Reset</span><span class="op" id="5131828">(</span><span class="op" id="5131829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131832"><a href="/encoding/gob/encoder.go.html#5131184">b</a></span><span class="op" id="5131833">.</span><span class="ident" id="5131834">Write</span><span class="op" id="5131839">(</span><span class="ident" id="5131840"><a href="/encoding/gob/encoder.go.html#5130276">spaceForLength</a></span><span class="op" id="5131854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5131857">if</span>&nbsp;<span class="ident" id="5131860"><a href="/encoding/gob/encoder.go.html#5131696">err</a></span>&nbsp;<span class="op" id="5131864">!=</span>&nbsp;<span class="ident" id="5131867">nil</span>&nbsp;<span class="op" id="5131871">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5131875"><a href="/encoding/gob/encoder.go.html#5131144">enc</a></span><span class="op" id="5131878">.</span><span class="ident" id="5131879">setError</span><span class="op" id="5131887">(</span><span class="ident" id="5131888"><a href="/encoding/gob/encoder.go.html#5131696">err</a></span><span class="op" id="5131891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5131894">}</span><br>
<span class="lineno"></span><span class="op" id="5131896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5131899">//&nbsp;sendActualType&nbsp;sends&nbsp;the&nbsp;requested&nbsp;type,&nbsp;without&nbsp;further&nbsp;investigation,&nbsp;unless</span><br>
<span class="lineno">85</span><span class="comment" id="5131981">//&nbsp;it&#39;s&nbsp;been&nbsp;sent&nbsp;before.</span><br>
<span class="lineno"></span><span class="keyword" id="5132007">func</span>&nbsp;<span class="op" id="5132012">(</span><span class="ident" id="5132013">enc</span>&nbsp;<span class="op" id="5132017">*</span><span class="ident" id="5132018"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5132025">)</span>&nbsp;<span class="ident" id="5132027">sendActualType</span><span class="op" id="5132041">(</span><span class="ident" id="5132042">w</span>&nbsp;<span class="ident" id="5132044"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5132046">.</span><span class="ident" id="5132047">Writer</span><span class="op" id="5132053">,</span>&nbsp;<span class="ident" id="5132055">state</span>&nbsp;<span class="op" id="5132061">*</span><span class="ident" id="5132062"><a href="/encoding/gob/encode.go.html#5109586">encoderState</a></span><span class="op" id="5132074">,</span>&nbsp;<span class="ident" id="5132076">ut</span>&nbsp;<span class="op" id="5132079">*</span><span class="ident" id="5132080"><a href="/encoding/gob/type.go.html#5138634">userTypeInfo</a></span><span class="op" id="5132092">,</span>&nbsp;<span class="ident" id="5132094">actual</span>&nbsp;<span class="ident" id="5132101"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5132108">.</span><span class="ident" id="5132109">Type</span><span class="op" id="5132113">)</span>&nbsp;<span class="op" id="5132115">(</span><span class="ident" id="5132116">sent</span>&nbsp;<span class="builtintype" id="5132121">bool</span><span class="op" id="5132125">)</span>&nbsp;<span class="op" id="5132127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132130">if</span>&nbsp;<span class="ident" id="5132133">_</span><span class="op" id="5132134">,</span>&nbsp;<span class="ident" id="5132136">alreadySent</span>&nbsp;<span class="op" id="5132148">:=</span>&nbsp;<span class="ident" id="5132151"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132154">.</span><span class="ident" id="5132155">sent</span><span class="op" id="5132159">[</span><span class="ident" id="5132160"><a href="/encoding/gob/encoder.go.html#5132094">actual</a></span><span class="op" id="5132166">]</span><span class="op" id="5132167">;</span>&nbsp;<span class="ident" id="5132169"><a href="/encoding/gob/encoder.go.html#5132136">alreadySent</a></span>&nbsp;<span class="op" id="5132181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132185">return</span>&nbsp;<span class="ident" id="5132192">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132199">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132202">info</span><span class="op" id="5132206">,</span>&nbsp;<span class="ident" id="5132208">err</span>&nbsp;<span class="op" id="5132212">:=</span>&nbsp;<span class="ident" id="5132215"><a href="/encoding/gob/type.go.html#5158904">getTypeInfo</a></span><span class="op" id="5132226">(</span><span class="ident" id="5132227"><a href="/encoding/gob/encoder.go.html#5132076">ut</a></span><span class="op" id="5132229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132232">if</span>&nbsp;<span class="ident" id="5132235"><a href="/encoding/gob/encoder.go.html#5132208">err</a></span>&nbsp;<span class="op" id="5132239">!=</span>&nbsp;<span class="ident" id="5132242">nil</span>&nbsp;<span class="op" id="5132246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132250"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132253">.</span><span class="ident" id="5132254">setError</span><span class="op" id="5132262">(</span><span class="ident" id="5132263"><a href="/encoding/gob/encoder.go.html#5132208">err</a></span><span class="op" id="5132266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132270">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132278">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5132281">//&nbsp;Send&nbsp;the&nbsp;pair&nbsp;(-id,&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5132311">//&nbsp;Id:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132319"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5132324">.</span><span class="ident" id="5132325">encodeInt</span><span class="op" id="5132334">(</span><span class="op" id="5132335">-</span><span class="ident" id="5132336">int64</span><span class="op" id="5132341">(</span><span class="ident" id="5132342"><a href="/encoding/gob/encoder.go.html#5132202">info</a></span><span class="op" id="5132346">.</span><span class="ident" id="5132347">id</span><span class="op" id="5132349">)</span><span class="op" id="5132350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5132353">//&nbsp;Type:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132363"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132366">.</span><span class="ident" id="5132367">encode</span><span class="op" id="5132373">(</span><span class="ident" id="5132374"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5132379">.</span><span class="ident" id="5132380">b</span><span class="op" id="5132381">,</span>&nbsp;<span class="ident" id="5132383"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5132390">.</span><span class="ident" id="5132391">ValueOf</span><span class="op" id="5132398">(</span><span class="ident" id="5132399"><a href="/encoding/gob/encoder.go.html#5132202">info</a></span><span class="op" id="5132403">.</span><span class="ident" id="5132404">wire</span><span class="op" id="5132408">)</span><span class="op" id="5132409">,</span>&nbsp;<span class="ident" id="5132411"><a href="/encoding/gob/type.go.html#5146993">wireTypeUserInfo</a></span><span class="op" id="5132427">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132430"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132433">.</span><span class="ident" id="5132434">writeMessage</span><span class="op" id="5132446">(</span><span class="ident" id="5132447"><a href="/encoding/gob/encoder.go.html#5132042">w</a></span><span class="op" id="5132448">,</span>&nbsp;<span class="ident" id="5132450"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5132455">.</span><span class="ident" id="5132456">b</span><span class="op" id="5132457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132460">if</span>&nbsp;<span class="ident" id="5132463"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132466">.</span><span class="ident" id="5132467">err</span>&nbsp;<span class="op" id="5132471">!=</span>&nbsp;<span class="ident" id="5132474">nil</span>&nbsp;<span class="op" id="5132478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132482">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5132494">//&nbsp;Remember&nbsp;we&#39;ve&nbsp;sent&nbsp;this&nbsp;type,&nbsp;both&nbsp;what&nbsp;the&nbsp;user&nbsp;gave&nbsp;us&nbsp;and&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132575"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132578">.</span><span class="ident" id="5132579">sent</span><span class="op" id="5132583">[</span><span class="ident" id="5132584"><a href="/encoding/gob/encoder.go.html#5132076">ut</a></span><span class="op" id="5132586">.</span><span class="ident" id="5132587">base</span><span class="op" id="5132591">]</span>&nbsp;<span class="op" id="5132593">=</span>&nbsp;<span class="ident" id="5132595"><a href="/encoding/gob/encoder.go.html#5132202">info</a></span><span class="op" id="5132599">.</span><span class="ident" id="5132600">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132604">if</span>&nbsp;<span class="ident" id="5132607"><a href="/encoding/gob/encoder.go.html#5132076">ut</a></span><span class="op" id="5132609">.</span><span class="ident" id="5132610">user</span>&nbsp;<span class="op" id="5132615">!=</span>&nbsp;<span class="ident" id="5132618"><a href="/encoding/gob/encoder.go.html#5132076">ut</a></span><span class="op" id="5132620">.</span><span class="ident" id="5132621">base</span>&nbsp;<span class="op" id="5132626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132630"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132633">.</span><span class="ident" id="5132634">sent</span><span class="op" id="5132638">[</span><span class="ident" id="5132639"><a href="/encoding/gob/encoder.go.html#5132076">ut</a></span><span class="op" id="5132641">.</span><span class="ident" id="5132642">user</span><span class="op" id="5132646">]</span>&nbsp;<span class="op" id="5132648">=</span>&nbsp;<span class="ident" id="5132650"><a href="/encoding/gob/encoder.go.html#5132202">info</a></span><span class="op" id="5132654">.</span><span class="ident" id="5132655">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132659">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5132662">//&nbsp;Now&nbsp;send&nbsp;the&nbsp;inner&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132691">switch</span>&nbsp;<span class="ident" id="5132698">st</span>&nbsp;<span class="op" id="5132701">:=</span>&nbsp;<span class="ident" id="5132704"><a href="/encoding/gob/encoder.go.html#5132094">actual</a></span><span class="op" id="5132710">;</span>&nbsp;<span class="ident" id="5132712"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5132714">.</span><span class="ident" id="5132715">Kind</span><span class="op" id="5132719">(</span><span class="op" id="5132720">)</span>&nbsp;<span class="op" id="5132722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132725">case</span>&nbsp;<span class="ident" id="5132730"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5132737">.</span><span class="ident" id="5132738">Struct</span><span class="op" id="5132744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132748">for</span>&nbsp;<span class="ident" id="5132752">i</span>&nbsp;<span class="op" id="5132754">:=</span>&nbsp;<span class="num" id="5132757">0</span><span class="op" id="5132758">;</span>&nbsp;<span class="ident" id="5132760"><a href="/encoding/gob/encoder.go.html#5132752">i</a></span>&nbsp;<span class="op" id="5132762">&lt;</span>&nbsp;<span class="ident" id="5132764"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5132766">.</span><span class="ident" id="5132767">NumField</span><span class="op" id="5132775">(</span><span class="op" id="5132776">)</span><span class="op" id="5132777">;</span>&nbsp;<span class="ident" id="5132779"><a href="/encoding/gob/encoder.go.html#5132752">i</a></span><span class="op" id="5132780">++</span>&nbsp;<span class="op" id="5132783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132788">if</span>&nbsp;<span class="ident" id="5132791"><a href="/encoding/gob/type.go.html#5154699">isExported</a></span><span class="op" id="5132801">(</span><span class="ident" id="5132802"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5132804">.</span><span class="ident" id="5132805">Field</span><span class="op" id="5132810">(</span><span class="ident" id="5132811"><a href="/encoding/gob/encoder.go.html#5132752">i</a></span><span class="op" id="5132812">)</span><span class="op" id="5132813">.</span><span class="ident" id="5132814">Name</span><span class="op" id="5132818">)</span>&nbsp;<span class="op" id="5132820">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132826"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132829">.</span><span class="ident" id="5132830">sendType</span><span class="op" id="5132838">(</span><span class="ident" id="5132839"><a href="/encoding/gob/encoder.go.html#5132042">w</a></span><span class="op" id="5132840">,</span>&nbsp;<span class="ident" id="5132842"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5132847">,</span>&nbsp;<span class="ident" id="5132849"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5132851">.</span><span class="ident" id="5132852">Field</span><span class="op" id="5132857">(</span><span class="ident" id="5132858"><a href="/encoding/gob/encoder.go.html#5132752">i</a></span><span class="op" id="5132859">)</span><span class="op" id="5132860">.</span><span class="ident" id="5132861">Type</span><span class="op" id="5132865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5132874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132877">case</span>&nbsp;<span class="ident" id="5132882"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5132889">.</span><span class="ident" id="5132890">Array</span><span class="op" id="5132895">,</span>&nbsp;<span class="ident" id="5132897"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5132904">.</span><span class="ident" id="5132905">Slice</span><span class="op" id="5132910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132914"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132917">.</span><span class="ident" id="5132918">sendType</span><span class="op" id="5132926">(</span><span class="ident" id="5132927"><a href="/encoding/gob/encoder.go.html#5132042">w</a></span><span class="op" id="5132928">,</span>&nbsp;<span class="ident" id="5132930"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5132935">,</span>&nbsp;<span class="ident" id="5132937"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5132939">.</span><span class="ident" id="5132940">Elem</span><span class="op" id="5132944">(</span><span class="op" id="5132945">)</span><span class="op" id="5132946">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5132949">case</span>&nbsp;<span class="ident" id="5132954"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5132961">.</span><span class="ident" id="5132962">Map</span><span class="op" id="5132965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5132969"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5132972">.</span><span class="ident" id="5132973">sendType</span><span class="op" id="5132981">(</span><span class="ident" id="5132982"><a href="/encoding/gob/encoder.go.html#5132042">w</a></span><span class="op" id="5132983">,</span>&nbsp;<span class="ident" id="5132985"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5132990">,</span>&nbsp;<span class="ident" id="5132992"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5132994">.</span><span class="ident" id="5132995">Key</span><span class="op" id="5132998">(</span><span class="op" id="5132999">)</span><span class="op" id="5133000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133004"><a href="/encoding/gob/encoder.go.html#5132013">enc</a></span><span class="op" id="5133007">.</span><span class="ident" id="5133008">sendType</span><span class="op" id="5133016">(</span><span class="ident" id="5133017"><a href="/encoding/gob/encoder.go.html#5132042">w</a></span><span class="op" id="5133018">,</span>&nbsp;<span class="ident" id="5133020"><a href="/encoding/gob/encoder.go.html#5132055">state</a></span><span class="op" id="5133025">,</span>&nbsp;<span class="ident" id="5133027"><a href="/encoding/gob/encoder.go.html#5132698">st</a></span><span class="op" id="5133029">.</span><span class="ident" id="5133030">Elem</span><span class="op" id="5133034">(</span><span class="op" id="5133035">)</span><span class="op" id="5133036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5133039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133042">return</span>&nbsp;<span class="ident" id="5133049">true</span><br>
<span class="lineno">125</span><span class="op" id="5133054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5133057">//&nbsp;sendType&nbsp;sends&nbsp;the&nbsp;type&nbsp;info&nbsp;to&nbsp;the&nbsp;other&nbsp;side,&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="5133122">func</span>&nbsp;<span class="op" id="5133127">(</span><span class="ident" id="5133128">enc</span>&nbsp;<span class="op" id="5133132">*</span><span class="ident" id="5133133"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5133140">)</span>&nbsp;<span class="ident" id="5133142">sendType</span><span class="op" id="5133150">(</span><span class="ident" id="5133151">w</span>&nbsp;<span class="ident" id="5133153"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5133155">.</span><span class="ident" id="5133156">Writer</span><span class="op" id="5133162">,</span>&nbsp;<span class="ident" id="5133164">state</span>&nbsp;<span class="op" id="5133170">*</span><span class="ident" id="5133171"><a href="/encoding/gob/encode.go.html#5109586">encoderState</a></span><span class="op" id="5133183">,</span>&nbsp;<span class="ident" id="5133185">origt</span>&nbsp;<span class="ident" id="5133191"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5133198">.</span><span class="ident" id="5133199">Type</span><span class="op" id="5133203">)</span>&nbsp;<span class="op" id="5133205">(</span><span class="ident" id="5133206">sent</span>&nbsp;<span class="builtintype" id="5133211">bool</span><span class="op" id="5133215">)</span>&nbsp;<span class="op" id="5133217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5133220">ut</span>&nbsp;<span class="op" id="5133223">:=</span>&nbsp;<span class="ident" id="5133226"><a href="/encoding/gob/type.go.html#5143544">userType</a></span><span class="op" id="5133234">(</span><span class="ident" id="5133235"><a href="/encoding/gob/encoder.go.html#5133185">origt</a></span><span class="op" id="5133240">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133243">if</span>&nbsp;<span class="ident" id="5133246"><a href="/encoding/gob/encoder.go.html#5133220">ut</a></span><span class="op" id="5133248">.</span><span class="ident" id="5133249">externalEnc</span>&nbsp;<span class="op" id="5133261">!=</span>&nbsp;<span class="num" id="5133264">0</span>&nbsp;<span class="op" id="5133266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133270">//&nbsp;The&nbsp;rules&nbsp;are&nbsp;different:&nbsp;regardless&nbsp;of&nbsp;the&nbsp;underlying&nbsp;type&#39;s&nbsp;representation,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133352">//&nbsp;we&nbsp;need&nbsp;to&nbsp;tell&nbsp;the&nbsp;other&nbsp;side&nbsp;that&nbsp;the&nbsp;base&nbsp;type&nbsp;is&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133424">return</span>&nbsp;<span class="ident" id="5133431"><a href="/encoding/gob/encoder.go.html#5133128">enc</a></span><span class="op" id="5133434">.</span><span class="ident" id="5133435">sendActualType</span><span class="op" id="5133449">(</span><span class="ident" id="5133450"><a href="/encoding/gob/encoder.go.html#5133151">w</a></span><span class="op" id="5133451">,</span>&nbsp;<span class="ident" id="5133453"><a href="/encoding/gob/encoder.go.html#5133164">state</a></span><span class="op" id="5133458">,</span>&nbsp;<span class="ident" id="5133460"><a href="/encoding/gob/encoder.go.html#5133220">ut</a></span><span class="op" id="5133462">,</span>&nbsp;<span class="ident" id="5133464"><a href="/encoding/gob/encoder.go.html#5133220">ut</a></span><span class="op" id="5133466">.</span><span class="ident" id="5133467">base</span><span class="op" id="5133471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5133474">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133478">//&nbsp;It&#39;s&nbsp;a&nbsp;concrete&nbsp;value,&nbsp;so&nbsp;drill&nbsp;down&nbsp;to&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133537">switch</span>&nbsp;<span class="ident" id="5133544">rt</span>&nbsp;<span class="op" id="5133547">:=</span>&nbsp;<span class="ident" id="5133550"><a href="/encoding/gob/encoder.go.html#5133220">ut</a></span><span class="op" id="5133552">.</span><span class="ident" id="5133553">base</span><span class="op" id="5133557">;</span>&nbsp;<span class="ident" id="5133559"><a href="/encoding/gob/encoder.go.html#5133544">rt</a></span><span class="op" id="5133561">.</span><span class="ident" id="5133562">Kind</span><span class="op" id="5133566">(</span><span class="op" id="5133567">)</span>&nbsp;<span class="op" id="5133569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133572">default</span><span class="op" id="5133579">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133583">//&nbsp;Basic&nbsp;types&nbsp;and&nbsp;interfaces&nbsp;do&nbsp;not&nbsp;need&nbsp;to&nbsp;be&nbsp;described.</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133644">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133652">case</span>&nbsp;<span class="ident" id="5133657"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5133664">.</span><span class="ident" id="5133665">Slice</span><span class="op" id="5133670">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133674">//&nbsp;If&nbsp;it&#39;s&nbsp;[]uint8,&nbsp;don&#39;t&nbsp;send;&nbsp;it&#39;s&nbsp;considered&nbsp;basic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133731">if</span>&nbsp;<span class="ident" id="5133734"><a href="/encoding/gob/encoder.go.html#5133544">rt</a></span><span class="op" id="5133736">.</span><span class="ident" id="5133737">Elem</span><span class="op" id="5133741">(</span><span class="op" id="5133742">)</span><span class="op" id="5133743">.</span><span class="ident" id="5133744">Kind</span><span class="op" id="5133748">(</span><span class="op" id="5133749">)</span>&nbsp;<span class="op" id="5133751">==</span>&nbsp;<span class="ident" id="5133754"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5133761">.</span><span class="ident" id="5133762">Uint8</span>&nbsp;<span class="op" id="5133768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133773">return</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5133782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133786">//&nbsp;Otherwise&nbsp;we&nbsp;do&nbsp;send.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133813">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133820">case</span>&nbsp;<span class="ident" id="5133825"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5133832">.</span><span class="ident" id="5133833">Array</span><span class="op" id="5133838">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133842">//&nbsp;arrays&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;lengths&nbsp;and&nbsp;element&nbsp;types.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133911">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5133918">case</span>&nbsp;<span class="ident" id="5133923"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5133930">.</span><span class="ident" id="5133931">Map</span><span class="op" id="5133934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5133938">//&nbsp;maps&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;lengths&nbsp;and&nbsp;key/value&nbsp;types.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134007">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134014">case</span>&nbsp;<span class="ident" id="5134019"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5134026">.</span><span class="ident" id="5134027">Struct</span><span class="op" id="5134033">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134037">//&nbsp;structs&nbsp;must&nbsp;be&nbsp;sent&nbsp;so&nbsp;we&nbsp;know&nbsp;their&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134088">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134095">case</span>&nbsp;<span class="ident" id="5134100"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5134107">.</span><span class="ident" id="5134108">Chan</span><span class="op" id="5134112">,</span>&nbsp;<span class="ident" id="5134114"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5134121">.</span><span class="ident" id="5134122">Func</span><span class="op" id="5134126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134130">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here,&nbsp;it&#39;s&nbsp;a&nbsp;field&nbsp;of&nbsp;a&nbsp;struct;&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134188">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134200">return</span>&nbsp;<span class="ident" id="5134207"><a href="/encoding/gob/encoder.go.html#5133128">enc</a></span><span class="op" id="5134210">.</span><span class="ident" id="5134211">sendActualType</span><span class="op" id="5134225">(</span><span class="ident" id="5134226"><a href="/encoding/gob/encoder.go.html#5133151">w</a></span><span class="op" id="5134227">,</span>&nbsp;<span class="ident" id="5134229"><a href="/encoding/gob/encoder.go.html#5133164">state</a></span><span class="op" id="5134234">,</span>&nbsp;<span class="ident" id="5134236"><a href="/encoding/gob/encoder.go.html#5133220">ut</a></span><span class="op" id="5134238">,</span>&nbsp;<span class="ident" id="5134240"><a href="/encoding/gob/encoder.go.html#5133220">ut</a></span><span class="op" id="5134242">.</span><span class="ident" id="5134243">base</span><span class="op" id="5134247">)</span><br>
<span class="lineno"></span><span class="op" id="5134249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5134252">//&nbsp;Encode&nbsp;transmits&nbsp;the&nbsp;data&nbsp;item&nbsp;represented&nbsp;by&nbsp;the&nbsp;empty&nbsp;interface&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="5134328">//&nbsp;guaranteeing&nbsp;that&nbsp;all&nbsp;necessary&nbsp;type&nbsp;information&nbsp;has&nbsp;been&nbsp;transmitted&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5134408">func</span>&nbsp;<span class="op" id="5134413">(</span><span class="ident" id="5134414">enc</span>&nbsp;<span class="op" id="5134418">*</span><span class="ident" id="5134419"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5134426">)</span>&nbsp;<span class="ident" id="5134428">Encode</span><span class="op" id="5134434">(</span><span class="ident" id="5134435">e</span>&nbsp;<span class="keyword" id="5134437">interface</span><span class="op" id="5134446">{</span><span class="op" id="5134447">}</span><span class="op" id="5134448">)</span>&nbsp;<span class="builtintype" id="5134450">error</span>&nbsp;<span class="op" id="5134456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134459">return</span>&nbsp;<span class="ident" id="5134466"><a href="/encoding/gob/encoder.go.html#5134414">enc</a></span><span class="op" id="5134469">.</span><span class="ident" id="5134470">EncodeValue</span><span class="op" id="5134481">(</span><span class="ident" id="5134482"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5134489">.</span><span class="ident" id="5134490">ValueOf</span><span class="op" id="5134497">(</span><span class="ident" id="5134498"><a href="/encoding/gob/encoder.go.html#5134435">e</a></span><span class="op" id="5134499">)</span><span class="op" id="5134500">)</span><br>
<span class="lineno"></span><span class="op" id="5134502">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="comment" id="5134505">//&nbsp;sendTypeDescriptor&nbsp;makes&nbsp;sure&nbsp;the&nbsp;remote&nbsp;side&nbsp;knows&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5134577">//&nbsp;It&nbsp;will&nbsp;send&nbsp;a&nbsp;descriptor&nbsp;if&nbsp;this&nbsp;is&nbsp;the&nbsp;first&nbsp;time&nbsp;the&nbsp;type&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="5134650">//&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="5134659">func</span>&nbsp;<span class="op" id="5134664">(</span><span class="ident" id="5134665">enc</span>&nbsp;<span class="op" id="5134669">*</span><span class="ident" id="5134670"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5134677">)</span>&nbsp;<span class="ident" id="5134679">sendTypeDescriptor</span><span class="op" id="5134697">(</span><span class="ident" id="5134698">w</span>&nbsp;<span class="ident" id="5134700"><a href="/encoding/gob/encoder.go.html#5129413">io</a></span><span class="op" id="5134702">.</span><span class="ident" id="5134703">Writer</span><span class="op" id="5134709">,</span>&nbsp;<span class="ident" id="5134711">state</span>&nbsp;<span class="op" id="5134717">*</span><span class="ident" id="5134718"><a href="/encoding/gob/encode.go.html#5109586">encoderState</a></span><span class="op" id="5134730">,</span>&nbsp;<span class="ident" id="5134732">ut</span>&nbsp;<span class="op" id="5134735">*</span><span class="ident" id="5134736"><a href="/encoding/gob/type.go.html#5138634">userTypeInfo</a></span><span class="op" id="5134748">)</span>&nbsp;<span class="op" id="5134750">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134753">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;type&nbsp;is&nbsp;known&nbsp;to&nbsp;the&nbsp;other&nbsp;side.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134804">//&nbsp;First,&nbsp;have&nbsp;we&nbsp;already&nbsp;sent&nbsp;this&nbsp;type?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134847">rt</span>&nbsp;<span class="op" id="5134850">:=</span>&nbsp;<span class="ident" id="5134853"><a href="/encoding/gob/encoder.go.html#5134732">ut</a></span><span class="op" id="5134855">.</span><span class="ident" id="5134856">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134862">if</span>&nbsp;<span class="ident" id="5134865"><a href="/encoding/gob/encoder.go.html#5134732">ut</a></span><span class="op" id="5134867">.</span><span class="ident" id="5134868">externalEnc</span>&nbsp;<span class="op" id="5134880">!=</span>&nbsp;<span class="num" id="5134883">0</span>&nbsp;<span class="op" id="5134885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134889"><a href="/encoding/gob/encoder.go.html#5134847">rt</a></span>&nbsp;<span class="op" id="5134892">=</span>&nbsp;<span class="ident" id="5134894"><a href="/encoding/gob/encoder.go.html#5134732">ut</a></span><span class="op" id="5134896">.</span><span class="ident" id="5134897">user</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5134903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5134906">if</span>&nbsp;<span class="ident" id="5134909">_</span><span class="op" id="5134910">,</span>&nbsp;<span class="ident" id="5134912">alreadySent</span>&nbsp;<span class="op" id="5134924">:=</span>&nbsp;<span class="ident" id="5134927"><a href="/encoding/gob/encoder.go.html#5134665">enc</a></span><span class="op" id="5134930">.</span><span class="ident" id="5134931">sent</span><span class="op" id="5134935">[</span><span class="ident" id="5134936"><a href="/encoding/gob/encoder.go.html#5134847">rt</a></span><span class="op" id="5134938">]</span><span class="op" id="5134939">;</span>&nbsp;<span class="op" id="5134941">!</span><span class="ident" id="5134942"><a href="/encoding/gob/encoder.go.html#5134912">alreadySent</a></span>&nbsp;<span class="op" id="5134954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5134958">//&nbsp;No,&nbsp;so&nbsp;send&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5134979">sent</span>&nbsp;<span class="op" id="5134984">:=</span>&nbsp;<span class="ident" id="5134987"><a href="/encoding/gob/encoder.go.html#5134665">enc</a></span><span class="op" id="5134990">.</span><span class="ident" id="5134991">sendType</span><span class="op" id="5134999">(</span><span class="ident" id="5135000"><a href="/encoding/gob/encoder.go.html#5134698">w</a></span><span class="op" id="5135001">,</span>&nbsp;<span class="ident" id="5135003"><a href="/encoding/gob/encoder.go.html#5134711">state</a></span><span class="op" id="5135008">,</span>&nbsp;<span class="ident" id="5135010"><a href="/encoding/gob/encoder.go.html#5134847">rt</a></span><span class="op" id="5135012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135016">if</span>&nbsp;<span class="ident" id="5135019"><a href="/encoding/gob/encoder.go.html#5134665">enc</a></span><span class="op" id="5135022">.</span><span class="ident" id="5135023">err</span>&nbsp;<span class="op" id="5135027">!=</span>&nbsp;<span class="ident" id="5135030">nil</span>&nbsp;<span class="op" id="5135034">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135039">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135052">//&nbsp;If&nbsp;the&nbsp;type&nbsp;info&nbsp;has&nbsp;still&nbsp;not&nbsp;been&nbsp;transmitted,&nbsp;it&nbsp;means&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135123">//&nbsp;a&nbsp;singleton&nbsp;basic&nbsp;type&nbsp;(int,&nbsp;[]byte&nbsp;etc.)&nbsp;at&nbsp;top&nbsp;level.&nbsp;&nbsp;We&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135194">//&nbsp;need&nbsp;to&nbsp;send&nbsp;the&nbsp;type&nbsp;info&nbsp;but&nbsp;we&nbsp;do&nbsp;need&nbsp;to&nbsp;update&nbsp;enc.sent.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135261">if</span>&nbsp;<span class="op" id="5135264">!</span><span class="ident" id="5135265"><a href="/encoding/gob/encoder.go.html#5134979">sent</a></span>&nbsp;<span class="op" id="5135270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135275">info</span><span class="op" id="5135279">,</span>&nbsp;<span class="ident" id="5135281">err</span>&nbsp;<span class="op" id="5135285">:=</span>&nbsp;<span class="ident" id="5135288"><a href="/encoding/gob/type.go.html#5158904">getTypeInfo</a></span><span class="op" id="5135299">(</span><span class="ident" id="5135300"><a href="/encoding/gob/encoder.go.html#5134732">ut</a></span><span class="op" id="5135302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135307">if</span>&nbsp;<span class="ident" id="5135310"><a href="/encoding/gob/encoder.go.html#5135281">err</a></span>&nbsp;<span class="op" id="5135314">!=</span>&nbsp;<span class="ident" id="5135317">nil</span>&nbsp;<span class="op" id="5135321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135327"><a href="/encoding/gob/encoder.go.html#5134665">enc</a></span><span class="op" id="5135330">.</span><span class="ident" id="5135331">setError</span><span class="op" id="5135339">(</span><span class="ident" id="5135340"><a href="/encoding/gob/encoder.go.html#5135281">err</a></span><span class="op" id="5135343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135349">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135364"><a href="/encoding/gob/encoder.go.html#5134665">enc</a></span><span class="op" id="5135367">.</span><span class="ident" id="5135368">sent</span><span class="op" id="5135372">[</span><span class="ident" id="5135373"><a href="/encoding/gob/encoder.go.html#5134847">rt</a></span><span class="op" id="5135375">]</span>&nbsp;<span class="op" id="5135377">=</span>&nbsp;<span class="ident" id="5135379"><a href="/encoding/gob/encoder.go.html#5135275">info</a></span><span class="op" id="5135383">.</span><span class="ident" id="5135384">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5135392">}</span><br>
<span class="lineno"></span><span class="op" id="5135394">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="5135397">//&nbsp;sendTypeId&nbsp;sends&nbsp;the&nbsp;id,&nbsp;which&nbsp;must&nbsp;have&nbsp;already&nbsp;been&nbsp;defined.</span><br>
<span class="lineno"></span><span class="keyword" id="5135463">func</span>&nbsp;<span class="op" id="5135468">(</span><span class="ident" id="5135469">enc</span>&nbsp;<span class="op" id="5135473">*</span><span class="ident" id="5135474"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5135481">)</span>&nbsp;<span class="ident" id="5135483">sendTypeId</span><span class="op" id="5135493">(</span><span class="ident" id="5135494">state</span>&nbsp;<span class="op" id="5135500">*</span><span class="ident" id="5135501"><a href="/encoding/gob/encode.go.html#5109586">encoderState</a></span><span class="op" id="5135513">,</span>&nbsp;<span class="ident" id="5135515">ut</span>&nbsp;<span class="op" id="5135518">*</span><span class="ident" id="5135519"><a href="/encoding/gob/type.go.html#5138634">userTypeInfo</a></span><span class="op" id="5135531">)</span>&nbsp;<span class="op" id="5135533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135536">//&nbsp;Identify&nbsp;the&nbsp;type&nbsp;of&nbsp;this&nbsp;top-level&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5135583"><a href="/encoding/gob/encoder.go.html#5135494">state</a></span><span class="op" id="5135588">.</span><span class="ident" id="5135589">encodeInt</span><span class="op" id="5135598">(</span><span class="ident" id="5135599">int64</span><span class="op" id="5135604">(</span><span class="ident" id="5135605"><a href="/encoding/gob/encoder.go.html#5135469">enc</a></span><span class="op" id="5135608">.</span><span class="ident" id="5135609">sent</span><span class="op" id="5135613">[</span><span class="ident" id="5135614"><a href="/encoding/gob/encoder.go.html#5135515">ut</a></span><span class="op" id="5135616">.</span><span class="ident" id="5135617">base</span><span class="op" id="5135621">]</span><span class="op" id="5135622">)</span><span class="op" id="5135623">)</span><br>
<span class="lineno">205</span><span class="op" id="5135625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5135628">//&nbsp;EncodeValue&nbsp;transmits&nbsp;the&nbsp;data&nbsp;item&nbsp;represented&nbsp;by&nbsp;the&nbsp;reflection&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="5135704">//&nbsp;guaranteeing&nbsp;that&nbsp;all&nbsp;necessary&nbsp;type&nbsp;information&nbsp;has&nbsp;been&nbsp;transmitted&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="5135784">func</span>&nbsp;<span class="op" id="5135789">(</span><span class="ident" id="5135790">enc</span>&nbsp;<span class="op" id="5135794">*</span><span class="ident" id="5135795"><a href="/encoding/gob/encoder.go.html#5129551">Encoder</a></span><span class="op" id="5135802">)</span>&nbsp;<span class="ident" id="5135804">EncodeValue</span><span class="op" id="5135815">(</span><span class="ident" id="5135816">value</span>&nbsp;<span class="ident" id="5135822"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5135829">.</span><span class="ident" id="5135830">Value</span><span class="op" id="5135835">)</span>&nbsp;<span class="builtintype" id="5135837">error</span>&nbsp;<span class="op" id="5135843">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135846">//&nbsp;Gobs&nbsp;contain&nbsp;values.&nbsp;They&nbsp;cannot&nbsp;represent&nbsp;nil&nbsp;pointers,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5135913">//&nbsp;have&nbsp;no&nbsp;value&nbsp;to&nbsp;encode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5135942">if</span>&nbsp;<span class="ident" id="5135945"><a href="/encoding/gob/encoder.go.html#5135816">value</a></span><span class="op" id="5135950">.</span><span class="ident" id="5135951">Kind</span><span class="op" id="5135955">(</span><span class="op" id="5135956">)</span>&nbsp;<span class="op" id="5135958">==</span>&nbsp;<span class="ident" id="5135961"><a href="/encoding/gob/encoder.go.html#5129419">reflect</a></span><span class="op" id="5135968">.</span><span class="ident" id="5135969">Ptr</span>&nbsp;<span class="op" id="5135973">&amp;&amp;</span>&nbsp;<span class="ident" id="5135976"><a href="/encoding/gob/encoder.go.html#5135816">value</a></span><span class="op" id="5135981">.</span><span class="ident" id="5135982">IsNil</span><span class="op" id="5135987">(</span><span class="op" id="5135988">)</span>&nbsp;<span class="op" id="5135990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5135994">panic</span><span class="op" id="5135999">(</span><span class="string" id="5136000">&#34;gob:&nbsp;cannot&nbsp;encode&nbsp;nil&nbsp;pointer&nbsp;of&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="5136042">+</span>&nbsp;<span class="ident" id="5136044"><a href="/encoding/gob/encoder.go.html#5135816">value</a></span><span class="op" id="5136049">.</span><span class="ident" id="5136050">Type</span><span class="op" id="5136054">(</span><span class="op" id="5136055">)</span><span class="op" id="5136056">.</span><span class="ident" id="5136057">String</span><span class="op" id="5136063">(</span><span class="op" id="5136064">)</span><span class="op" id="5136065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136068">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136072">//&nbsp;Make&nbsp;sure&nbsp;we&#39;re&nbsp;single-threaded&nbsp;through&nbsp;here,&nbsp;so&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136134">//&nbsp;goroutines&nbsp;can&nbsp;share&nbsp;an&nbsp;encoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136171"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136174">.</span><span class="ident" id="5136175">mutex</span><span class="op" id="5136180">.</span><span class="ident" id="5136181">Lock</span><span class="op" id="5136185">(</span><span class="op" id="5136186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136189">defer</span>&nbsp;<span class="ident" id="5136195"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136198">.</span><span class="ident" id="5136199">mutex</span><span class="op" id="5136204">.</span><span class="ident" id="5136205">Unlock</span><span class="op" id="5136211">(</span><span class="op" id="5136212">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136216">//&nbsp;Remove&nbsp;any&nbsp;nested&nbsp;writers&nbsp;remaining&nbsp;due&nbsp;to&nbsp;previous&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136280"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136283">.</span><span class="ident" id="5136284">w</span>&nbsp;<span class="op" id="5136286">=</span>&nbsp;<span class="ident" id="5136288"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136291">.</span><span class="ident" id="5136292">w</span><span class="op" id="5136293">[</span><span class="num" id="5136294">0</span><span class="op" id="5136295">:</span><span class="num" id="5136296">1</span><span class="op" id="5136297">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136301">ut</span><span class="op" id="5136303">,</span>&nbsp;<span class="ident" id="5136305">err</span>&nbsp;<span class="op" id="5136309">:=</span>&nbsp;<span class="ident" id="5136312"><a href="/encoding/gob/type.go.html#5139807">validUserType</a></span><span class="op" id="5136325">(</span><span class="ident" id="5136326"><a href="/encoding/gob/encoder.go.html#5135816">value</a></span><span class="op" id="5136331">.</span><span class="ident" id="5136332">Type</span><span class="op" id="5136336">(</span><span class="op" id="5136337">)</span><span class="op" id="5136338">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136341">if</span>&nbsp;<span class="ident" id="5136344"><a href="/encoding/gob/encoder.go.html#5136305">err</a></span>&nbsp;<span class="op" id="5136348">!=</span>&nbsp;<span class="ident" id="5136351">nil</span>&nbsp;<span class="op" id="5136355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136359">return</span>&nbsp;<span class="ident" id="5136366"><a href="/encoding/gob/encoder.go.html#5136305">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136371">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136375"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136378">.</span><span class="ident" id="5136379">err</span>&nbsp;<span class="op" id="5136383">=</span>&nbsp;<span class="ident" id="5136385">nil</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136390"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136393">.</span><span class="ident" id="5136394">byteBuf</span><span class="op" id="5136401">.</span><span class="ident" id="5136402">Reset</span><span class="op" id="5136407">(</span><span class="op" id="5136408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136411"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136414">.</span><span class="ident" id="5136415">byteBuf</span><span class="op" id="5136422">.</span><span class="ident" id="5136423">Write</span><span class="op" id="5136428">(</span><span class="ident" id="5136429"><a href="/encoding/gob/encoder.go.html#5130276">spaceForLength</a></span><span class="op" id="5136443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136446">state</span>&nbsp;<span class="op" id="5136452">:=</span>&nbsp;<span class="ident" id="5136455"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136458">.</span><span class="ident" id="5136459">newEncoderState</span><span class="op" id="5136474">(</span><span class="op" id="5136475">&amp;</span><span class="ident" id="5136476"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136479">.</span><span class="ident" id="5136480">byteBuf</span><span class="op" id="5136487">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136491"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136494">.</span><span class="ident" id="5136495">sendTypeDescriptor</span><span class="op" id="5136513">(</span><span class="ident" id="5136514"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136517">.</span><span class="ident" id="5136518">writer</span><span class="op" id="5136524">(</span><span class="op" id="5136525">)</span><span class="op" id="5136526">,</span>&nbsp;<span class="ident" id="5136528"><a href="/encoding/gob/encoder.go.html#5136446">state</a></span><span class="op" id="5136533">,</span>&nbsp;<span class="ident" id="5136535"><a href="/encoding/gob/encoder.go.html#5136301">ut</a></span><span class="op" id="5136537">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136540"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136543">.</span><span class="ident" id="5136544">sendTypeId</span><span class="op" id="5136554">(</span><span class="ident" id="5136555"><a href="/encoding/gob/encoder.go.html#5136446">state</a></span><span class="op" id="5136560">,</span>&nbsp;<span class="ident" id="5136562"><a href="/encoding/gob/encoder.go.html#5136301">ut</a></span><span class="op" id="5136564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136567">if</span>&nbsp;<span class="ident" id="5136570"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136573">.</span><span class="ident" id="5136574">err</span>&nbsp;<span class="op" id="5136578">!=</span>&nbsp;<span class="ident" id="5136581">nil</span>&nbsp;<span class="op" id="5136585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136589">return</span>&nbsp;<span class="ident" id="5136596"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136599">.</span><span class="ident" id="5136600">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5136609">//&nbsp;Encode&nbsp;the&nbsp;object.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136632"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136635">.</span><span class="ident" id="5136636">encode</span><span class="op" id="5136642">(</span><span class="ident" id="5136643"><a href="/encoding/gob/encoder.go.html#5136446">state</a></span><span class="op" id="5136648">.</span><span class="ident" id="5136649">b</span><span class="op" id="5136650">,</span>&nbsp;<span class="ident" id="5136652"><a href="/encoding/gob/encoder.go.html#5135816">value</a></span><span class="op" id="5136657">,</span>&nbsp;<span class="ident" id="5136659"><a href="/encoding/gob/encoder.go.html#5136301">ut</a></span><span class="op" id="5136661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136664">if</span>&nbsp;<span class="ident" id="5136667"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136670">.</span><span class="ident" id="5136671">err</span>&nbsp;<span class="op" id="5136675">==</span>&nbsp;<span class="ident" id="5136678">nil</span>&nbsp;<span class="op" id="5136682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136686"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136689">.</span><span class="ident" id="5136690">writeMessage</span><span class="op" id="5136702">(</span><span class="ident" id="5136703"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136706">.</span><span class="ident" id="5136707">writer</span><span class="op" id="5136713">(</span><span class="op" id="5136714">)</span><span class="op" id="5136715">,</span>&nbsp;<span class="ident" id="5136717"><a href="/encoding/gob/encoder.go.html#5136446">state</a></span><span class="op" id="5136722">.</span><span class="ident" id="5136723">b</span><span class="op" id="5136724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5136727">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5136731"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136734">.</span><span class="ident" id="5136735">freeEncoderState</span><span class="op" id="5136751">(</span><span class="ident" id="5136752"><a href="/encoding/gob/encoder.go.html#5136446">state</a></span><span class="op" id="5136757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5136760">return</span>&nbsp;<span class="ident" id="5136767"><a href="/encoding/gob/encoder.go.html#5135790">enc</a></span><span class="op" id="5136770">.</span><span class="ident" id="5136771">err</span><br>
<span class="lineno"></span><span class="op" id="5136775">}</span>
</div>
</body>
</html>
