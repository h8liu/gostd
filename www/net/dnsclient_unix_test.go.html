<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7847952">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7848007">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7848061">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7848112">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848177">package</span>&nbsp;<span class="ident" id="7848185">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848190">import</span>&nbsp;<span class="op" id="7848197">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848200">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848206">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848219">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848225">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848233">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848244">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7848255">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7848262">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848265">var</span>&nbsp;<span class="ident" id="7848269">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="7848295">=</span>&nbsp;<span class="op" id="7848297">[</span><span class="op" id="7848298">]</span><span class="keyword" id="7848299">struct</span>&nbsp;<span class="op" id="7848306">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848309">server</span>&nbsp;&nbsp;<span class="builtintype" id="7848317">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848325">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7848333">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848341">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7848349">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848357">timeout</span>&nbsp;<span class="builtintype" id="7848365">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848370">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7848378">int</span><br>
<span class="lineno">25</span><span class="op" id="7848382">}</span><span class="op" id="7848383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7848386">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7848445">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848485">{</span><span class="string" id="7848486">&#34;8.8.8.8:53&#34;</span><span class="op" id="7848498">,</span>&nbsp;<span class="string" id="7848500">&#34;com.&#34;</span><span class="op" id="7848506">,</span>&nbsp;<span class="ident" id="7848508"><a href="/net/dnsmsg.go.html#1360131">dnsTypeALL</a></span><span class="op" id="7848518">,</span>&nbsp;<span class="num" id="7848520">2</span><span class="op" id="7848521">,</span>&nbsp;<span class="ident" id="7848523"><a href="/net/dnsmsg.go.html#1360301">dnsRcodeSuccess</a></span><span class="op" id="7848538">}</span><span class="op" id="7848539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848542">{</span><span class="string" id="7848543">&#34;8.8.4.4:53&#34;</span><span class="op" id="7848555">,</span>&nbsp;<span class="string" id="7848557">&#34;com.&#34;</span><span class="op" id="7848563">,</span>&nbsp;<span class="ident" id="7848565"><a href="/net/dnsmsg.go.html#1360131">dnsTypeALL</a></span><span class="op" id="7848575">,</span>&nbsp;<span class="num" id="7848577">4</span><span class="op" id="7848578">,</span>&nbsp;<span class="ident" id="7848580"><a href="/net/dnsmsg.go.html#1360301">dnsRcodeSuccess</a></span><span class="op" id="7848595">}</span><span class="op" id="7848596">,</span><br>
<span class="lineno">30</span><span class="op" id="7848598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7848601">func</span>&nbsp;<span class="ident" id="7848606">TestDNSTransportFallback</span><span class="op" id="7848630">(</span><span class="ident" id="7848631">t</span>&nbsp;<span class="op" id="7848633">*</span><span class="ident" id="7848634"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7848641">.</span><span class="ident" id="7848642">T</span><span class="op" id="7848643">)</span>&nbsp;<span class="op" id="7848645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848648">if</span>&nbsp;<span class="ident" id="7848651"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7848658">.</span><span class="ident" id="7848659">Short</span><span class="op" id="7848664">(</span><span class="op" id="7848665">)</span>&nbsp;<span class="op" id="7848667">||</span>&nbsp;<span class="op" id="7848670">!</span><span class="op" id="7848671">*</span><span class="ident" id="7848672"><a href="/net/lookup_test.go.html#7913432">testExternal</a></span>&nbsp;<span class="op" id="7848685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848689"><a href="/net/dnsclient_unix_test.go.html#7848631">t</a></span><span class="op" id="7848690">.</span><span class="ident" id="7848691">Skip</span><span class="op" id="7848695">(</span><span class="string" id="7848696">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7848737">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848744">for</span>&nbsp;<span class="ident" id="7848748">_</span><span class="op" id="7848749">,</span>&nbsp;<span class="ident" id="7848751">tt</span>&nbsp;<span class="op" id="7848754">:=</span>&nbsp;<span class="keyword" id="7848757">range</span>&nbsp;<span class="ident" id="7848763"><a href="/net/dnsclient_unix_test.go.html#7848269">dnsTransportFallbackTests</a></span>&nbsp;<span class="op" id="7848789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848793">timeout</span>&nbsp;<span class="op" id="7848801">:=</span>&nbsp;<span class="ident" id="7848804"><a href="/net/dnsclient_unix_test.go.html#7848255">time</a></span><span class="op" id="7848808">.</span><span class="ident" id="7848809">Duration</span><span class="op" id="7848817">(</span><span class="ident" id="7848818"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7848820">.</span><span class="ident" id="7848821">timeout</span><span class="op" id="7848828">)</span>&nbsp;<span class="op" id="7848830">*</span>&nbsp;<span class="ident" id="7848832"><a href="/net/dnsclient_unix_test.go.html#7848255">time</a></span><span class="op" id="7848836">.</span><span class="ident" id="7848837">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848846">msg</span><span class="op" id="7848849">,</span>&nbsp;<span class="ident" id="7848851">err</span>&nbsp;<span class="op" id="7848855">:=</span>&nbsp;<span class="ident" id="7848858"><a href="/net/dnsclient_unix.go.html#1348486">exchange</a></span><span class="op" id="7848866">(</span><span class="ident" id="7848867"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7848869">.</span><span class="ident" id="7848870">server</span><span class="op" id="7848876">,</span>&nbsp;<span class="ident" id="7848878"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7848880">.</span><span class="ident" id="7848881">name</span><span class="op" id="7848885">,</span>&nbsp;<span class="ident" id="7848887"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7848889">.</span><span class="ident" id="7848890">qtype</span><span class="op" id="7848895">,</span>&nbsp;<span class="ident" id="7848897"><a href="/net/dnsclient_unix_test.go.html#7848793">timeout</a></span><span class="op" id="7848904">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848908">if</span>&nbsp;<span class="ident" id="7848911"><a href="/net/dnsclient_unix_test.go.html#7848851">err</a></span>&nbsp;<span class="op" id="7848915">!=</span>&nbsp;<span class="ident" id="7848918">nil</span>&nbsp;<span class="op" id="7848922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7848927"><a href="/net/dnsclient_unix_test.go.html#7848631">t</a></span><span class="op" id="7848928">.</span><span class="ident" id="7848929">Error</span><span class="op" id="7848934">(</span><span class="ident" id="7848935"><a href="/net/dnsclient_unix_test.go.html#7848851">err</a></span><span class="op" id="7848938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848943">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7848954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848958">switch</span>&nbsp;<span class="ident" id="7848965"><a href="/net/dnsclient_unix_test.go.html#7848846">msg</a></span><span class="op" id="7848968">.</span><span class="ident" id="7848969">rcode</span>&nbsp;<span class="op" id="7848975">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7848979">case</span>&nbsp;<span class="ident" id="7848984"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7848986">.</span><span class="ident" id="7848987">rcode</span><span class="op" id="7848992">,</span>&nbsp;<span class="ident" id="7848994"><a href="/net/dnsmsg.go.html#1360357">dnsRcodeServerFailure</a></span><span class="op" id="7849015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849019">default</span><span class="op" id="7849026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849031"><a href="/net/dnsclient_unix_test.go.html#7848631">t</a></span><span class="op" id="7849032">.</span><span class="ident" id="7849033">Errorf</span><span class="op" id="7849039">(</span><span class="string" id="7849040">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7849065">,</span>&nbsp;<span class="ident" id="7849067"><a href="/net/dnsclient_unix_test.go.html#7848846">msg</a></span><span class="op" id="7849070">.</span><span class="ident" id="7849071">rcode</span><span class="op" id="7849076">,</span>&nbsp;<span class="ident" id="7849078"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7849080">.</span><span class="ident" id="7849081">server</span><span class="op" id="7849087">,</span>&nbsp;<span class="ident" id="7849089"><a href="/net/dnsclient_unix_test.go.html#7848751">tt</a></span><span class="op" id="7849091">.</span><span class="ident" id="7849092">rcode</span><span class="op" id="7849097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849102">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849113">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849116">}</span><br>
<span class="lineno"></span><span class="op" id="7849118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7849121">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="7849188">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="7849205">var</span>&nbsp;<span class="ident" id="7849209">specialDomainNameTests</span>&nbsp;<span class="op" id="7849232">=</span>&nbsp;<span class="op" id="7849234">[</span><span class="op" id="7849235">]</span><span class="keyword" id="7849236">struct</span>&nbsp;<span class="op" id="7849243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849246">name</span>&nbsp;&nbsp;<span class="builtintype" id="7849252">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849260">qtype</span>&nbsp;<span class="builtintype" id="7849266">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849274">rcode</span>&nbsp;<span class="builtintype" id="7849280">int</span><br>
<span class="lineno"></span><span class="op" id="7849284">}</span><span class="op" id="7849285">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849288">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849352">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849379">{</span><span class="string" id="7849380">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="7849407">,</span>&nbsp;<span class="ident" id="7849409"><a href="/net/dnsmsg.go.html#1359904">dnsTypePTR</a></span><span class="op" id="7849419">,</span>&nbsp;<span class="ident" id="7849421"><a href="/net/dnsmsg.go.html#1360385">dnsRcodeNameError</a></span><span class="op" id="7849438">}</span><span class="op" id="7849439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849442">{</span><span class="string" id="7849443">&#34;test.&#34;</span><span class="op" id="7849450">,</span>&nbsp;<span class="ident" id="7849452"><a href="/net/dnsmsg.go.html#1360131">dnsTypeALL</a></span><span class="op" id="7849462">,</span>&nbsp;<span class="ident" id="7849464"><a href="/net/dnsmsg.go.html#1360385">dnsRcodeNameError</a></span><span class="op" id="7849481">}</span><span class="op" id="7849482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849485">{</span><span class="string" id="7849486">&#34;example.com.&#34;</span><span class="op" id="7849500">,</span>&nbsp;<span class="ident" id="7849502"><a href="/net/dnsmsg.go.html#1360131">dnsTypeALL</a></span><span class="op" id="7849512">,</span>&nbsp;<span class="ident" id="7849514"><a href="/net/dnsmsg.go.html#1360301">dnsRcodeSuccess</a></span><span class="op" id="7849529">}</span><span class="op" id="7849530">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849534">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849594">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849653">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7849713">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849766">{</span><span class="string" id="7849767">&#34;localhost.&#34;</span><span class="op" id="7849779">,</span>&nbsp;<span class="ident" id="7849781"><a href="/net/dnsmsg.go.html#1360131">dnsTypeALL</a></span><span class="op" id="7849791">,</span>&nbsp;<span class="ident" id="7849793"><a href="/net/dnsmsg.go.html#1360385">dnsRcodeNameError</a></span><span class="op" id="7849810">}</span><span class="op" id="7849811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849814">{</span><span class="string" id="7849815">&#34;invalid.&#34;</span><span class="op" id="7849825">,</span>&nbsp;<span class="ident" id="7849827"><a href="/net/dnsmsg.go.html#1360131">dnsTypeALL</a></span><span class="op" id="7849837">,</span>&nbsp;<span class="ident" id="7849839"><a href="/net/dnsmsg.go.html#1360385">dnsRcodeNameError</a></span><span class="op" id="7849856">}</span><span class="op" id="7849857">,</span><br>
<span class="lineno"></span><span class="op" id="7849859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7849862">func</span>&nbsp;<span class="ident" id="7849867">TestSpecialDomainName</span><span class="op" id="7849888">(</span><span class="ident" id="7849889">t</span>&nbsp;<span class="op" id="7849891">*</span><span class="ident" id="7849892"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7849899">.</span><span class="ident" id="7849900">T</span><span class="op" id="7849901">)</span>&nbsp;<span class="op" id="7849903">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7849906">if</span>&nbsp;<span class="ident" id="7849909"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7849916">.</span><span class="ident" id="7849917">Short</span><span class="op" id="7849922">(</span><span class="op" id="7849923">)</span>&nbsp;<span class="op" id="7849925">||</span>&nbsp;<span class="op" id="7849928">!</span><span class="op" id="7849929">*</span><span class="ident" id="7849930"><a href="/net/lookup_test.go.html#7913432">testExternal</a></span>&nbsp;<span class="op" id="7849943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7849947"><a href="/net/dnsclient_unix_test.go.html#7849889">t</a></span><span class="op" id="7849948">.</span><span class="ident" id="7849949">Skip</span><span class="op" id="7849953">(</span><span class="string" id="7849954">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7849995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7849998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850002">server</span>&nbsp;<span class="op" id="7850009">:=</span>&nbsp;<span class="string" id="7850012">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850026">for</span>&nbsp;<span class="ident" id="7850030">_</span><span class="op" id="7850031">,</span>&nbsp;<span class="ident" id="7850033">tt</span>&nbsp;<span class="op" id="7850036">:=</span>&nbsp;<span class="keyword" id="7850039">range</span>&nbsp;<span class="ident" id="7850045"><a href="/net/dnsclient_unix_test.go.html#7849209">specialDomainNameTests</a></span>&nbsp;<span class="op" id="7850068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850072">msg</span><span class="op" id="7850075">,</span>&nbsp;<span class="ident" id="7850077">err</span>&nbsp;<span class="op" id="7850081">:=</span>&nbsp;<span class="ident" id="7850084"><a href="/net/dnsclient_unix.go.html#1348486">exchange</a></span><span class="op" id="7850092">(</span><span class="ident" id="7850093"><a href="/net/dnsclient_unix_test.go.html#7850002">server</a></span><span class="op" id="7850099">,</span>&nbsp;<span class="ident" id="7850101"><a href="/net/dnsclient_unix_test.go.html#7850033">tt</a></span><span class="op" id="7850103">.</span><span class="ident" id="7850104">name</span><span class="op" id="7850108">,</span>&nbsp;<span class="ident" id="7850110"><a href="/net/dnsclient_unix_test.go.html#7850033">tt</a></span><span class="op" id="7850112">.</span><span class="ident" id="7850113">qtype</span><span class="op" id="7850118">,</span>&nbsp;<span class="num" id="7850120">0</span><span class="op" id="7850121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850125">if</span>&nbsp;<span class="ident" id="7850128"><a href="/net/dnsclient_unix_test.go.html#7850077">err</a></span>&nbsp;<span class="op" id="7850132">!=</span>&nbsp;<span class="ident" id="7850135">nil</span>&nbsp;<span class="op" id="7850139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850144"><a href="/net/dnsclient_unix_test.go.html#7849889">t</a></span><span class="op" id="7850145">.</span><span class="ident" id="7850146">Error</span><span class="op" id="7850151">(</span><span class="ident" id="7850152"><a href="/net/dnsclient_unix_test.go.html#7850077">err</a></span><span class="op" id="7850155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850160">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850175">switch</span>&nbsp;<span class="ident" id="7850182"><a href="/net/dnsclient_unix_test.go.html#7850072">msg</a></span><span class="op" id="7850185">.</span><span class="ident" id="7850186">rcode</span>&nbsp;<span class="op" id="7850192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850196">case</span>&nbsp;<span class="ident" id="7850201"><a href="/net/dnsclient_unix_test.go.html#7850033">tt</a></span><span class="op" id="7850203">.</span><span class="ident" id="7850204">rcode</span><span class="op" id="7850209">,</span>&nbsp;<span class="ident" id="7850211"><a href="/net/dnsmsg.go.html#1360357">dnsRcodeServerFailure</a></span><span class="op" id="7850232">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850236">default</span><span class="op" id="7850243">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850248"><a href="/net/dnsclient_unix_test.go.html#7849889">t</a></span><span class="op" id="7850249">.</span><span class="ident" id="7850250">Errorf</span><span class="op" id="7850256">(</span><span class="string" id="7850257">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7850282">,</span>&nbsp;<span class="ident" id="7850284"><a href="/net/dnsclient_unix_test.go.html#7850072">msg</a></span><span class="op" id="7850287">.</span><span class="ident" id="7850288">rcode</span><span class="op" id="7850293">,</span>&nbsp;<span class="ident" id="7850295"><a href="/net/dnsclient_unix_test.go.html#7850002">server</a></span><span class="op" id="7850301">,</span>&nbsp;<span class="ident" id="7850303"><a href="/net/dnsclient_unix_test.go.html#7850033">tt</a></span><span class="op" id="7850305">.</span><span class="ident" id="7850306">rcode</span><span class="op" id="7850311">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850316">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850330">}</span><br>
<span class="lineno"></span><span class="op" id="7850332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="7850335">type</span>&nbsp;<span class="ident" id="7850340">resolvConfTest</span>&nbsp;<span class="keyword" id="7850355">struct</span>&nbsp;<span class="op" id="7850362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850365">*</span><span class="ident" id="7850366"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7850373">.</span><span class="ident" id="7850374">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850377">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7850385">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850393">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7850401">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850409">started</span>&nbsp;<span class="builtintype" id="7850417">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850423">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7850431">chan</span>&nbsp;<span class="keyword" id="7850436">chan</span>&nbsp;<span class="keyword" id="7850441">struct</span><span class="op" id="7850447">{</span><span class="op" id="7850448">}</span><br>
<span class="lineno"></span><span class="op" id="7850450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850453">func</span>&nbsp;<span class="ident" id="7850458">newResolvConfTest</span><span class="op" id="7850475">(</span><span class="ident" id="7850476">t</span>&nbsp;<span class="op" id="7850478">*</span><span class="ident" id="7850479"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7850486">.</span><span class="ident" id="7850487">T</span><span class="op" id="7850488">)</span>&nbsp;<span class="op" id="7850490">*</span><span class="ident" id="7850491"><a href="/net/dnsclient_unix_test.go.html#7850340">resolvConfTest</a></span>&nbsp;<span class="op" id="7850506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850509">dir</span><span class="op" id="7850512">,</span>&nbsp;<span class="ident" id="7850514">err</span>&nbsp;<span class="op" id="7850518">:=</span>&nbsp;<span class="ident" id="7850521"><a href="/net/dnsclient_unix_test.go.html#7848206">ioutil</a></span><span class="op" id="7850527">.</span><span class="ident" id="7850528">TempDir</span><span class="op" id="7850535">(</span><span class="string" id="7850536">&#34;&#34;</span><span class="op" id="7850538">,</span>&nbsp;<span class="string" id="7850540">&#34;resolvConfTest&#34;</span><span class="op" id="7850556">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850559">if</span>&nbsp;<span class="ident" id="7850562"><a href="/net/dnsclient_unix_test.go.html#7850514">err</a></span>&nbsp;<span class="op" id="7850566">!=</span>&nbsp;<span class="ident" id="7850569">nil</span>&nbsp;<span class="op" id="7850573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850577"><a href="/net/dnsclient_unix_test.go.html#7850476">t</a></span><span class="op" id="7850578">.</span><span class="ident" id="7850579">Fatalf</span><span class="op" id="7850585">(</span><span class="string" id="7850586">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="7850617">,</span>&nbsp;<span class="ident" id="7850619"><a href="/net/dnsclient_unix_test.go.html#7850514">err</a></span><span class="op" id="7850622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7850629">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850664"><a href="/net/dnsclient_unix.go.html#1350987">onceLoadConfig</a></span><span class="op" id="7850678">.</span><span class="ident" id="7850679">Do</span><span class="op" id="7850681">(</span><span class="keyword" id="7850682">func</span><span class="op" id="7850686">(</span><span class="op" id="7850687">)</span>&nbsp;<span class="op" id="7850689">{</span><span class="op" id="7850690">}</span><span class="op" id="7850691">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850695">r</span>&nbsp;<span class="op" id="7850697">:=</span>&nbsp;<span class="op" id="7850700">&amp;</span><span class="ident" id="7850701"><a href="/net/dnsclient_unix_test.go.html#7850340">resolvConfTest</a></span><span class="op" id="7850715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850719">T</span><span class="op" id="7850720">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7850726"><a href="/net/dnsclient_unix_test.go.html#7850476">t</a></span><span class="op" id="7850727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850731">dir</span><span class="op" id="7850734">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7850738"><a href="/net/dnsclient_unix_test.go.html#7850509">dir</a></span><span class="op" id="7850741">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850745">path</span><span class="op" id="7850749">:</span>&nbsp;&nbsp;<span class="ident" id="7850752"><a href="/net/dnsclient_unix_test.go.html#7848225">path</a></span><span class="op" id="7850756">.</span><span class="ident" id="7850757">Join</span><span class="op" id="7850761">(</span><span class="ident" id="7850762"><a href="/net/dnsclient_unix_test.go.html#7850509">dir</a></span><span class="op" id="7850765">,</span>&nbsp;<span class="string" id="7850767">&#34;resolv.conf&#34;</span><span class="op" id="7850780">)</span><span class="op" id="7850781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850785">quitc</span><span class="op" id="7850790">:</span>&nbsp;<span class="builtinfunc" id="7850792">make</span><span class="op" id="7850796">(</span><span class="keyword" id="7850797">chan</span>&nbsp;<span class="keyword" id="7850802">chan</span>&nbsp;<span class="keyword" id="7850807">struct</span><span class="op" id="7850813">{</span><span class="op" id="7850814">}</span><span class="op" id="7850815">)</span><span class="op" id="7850816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7850819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7850823">return</span>&nbsp;<span class="ident" id="7850830"><a href="/net/dnsclient_unix_test.go.html#7850695">r</a></span><br>
<span class="lineno">120</span><span class="op" id="7850832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850835">func</span>&nbsp;<span class="op" id="7850840">(</span><span class="ident" id="7850841">r</span>&nbsp;<span class="op" id="7850843">*</span><span class="ident" id="7850844"><a href="/net/dnsclient_unix_test.go.html#7850340">resolvConfTest</a></span><span class="op" id="7850858">)</span>&nbsp;<span class="ident" id="7850860">Start</span><span class="op" id="7850865">(</span><span class="op" id="7850866">)</span>&nbsp;<span class="op" id="7850868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850871"><a href="/net/dnsclient_unix.go.html#1351151">loadConfig</a></span><span class="op" id="7850881">(</span><span class="ident" id="7850882"><a href="/net/dnsclient_unix_test.go.html#7850841">r</a></span><span class="op" id="7850883">.</span><span class="ident" id="7850884">path</span><span class="op" id="7850888">,</span>&nbsp;<span class="num" id="7850890">100</span><span class="op" id="7850893">*</span><span class="ident" id="7850894"><a href="/net/dnsclient_unix_test.go.html#7848255">time</a></span><span class="op" id="7850898">.</span><span class="ident" id="7850899">Millisecond</span><span class="op" id="7850910">,</span>&nbsp;<span class="ident" id="7850912"><a href="/net/dnsclient_unix_test.go.html#7850841">r</a></span><span class="op" id="7850913">.</span><span class="ident" id="7850914">quitc</span><span class="op" id="7850919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7850922"><a href="/net/dnsclient_unix_test.go.html#7850841">r</a></span><span class="op" id="7850923">.</span><span class="ident" id="7850924">started</span>&nbsp;<span class="op" id="7850932">=</span>&nbsp;<span class="builtintype" id="7850934">true</span><br>
<span class="lineno">125</span><span class="op" id="7850939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7850942">func</span>&nbsp;<span class="op" id="7850947">(</span><span class="ident" id="7850948">r</span>&nbsp;<span class="op" id="7850950">*</span><span class="ident" id="7850951"><a href="/net/dnsclient_unix_test.go.html#7850340">resolvConfTest</a></span><span class="op" id="7850965">)</span>&nbsp;<span class="ident" id="7850967">SetConf</span><span class="op" id="7850974">(</span><span class="ident" id="7850975">s</span>&nbsp;<span class="builtintype" id="7850977">string</span><span class="op" id="7850983">)</span>&nbsp;<span class="op" id="7850985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7850988">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7851057">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851112"><a href="/net/dnsclient_unix_test.go.html#7848255">time</a></span><span class="op" id="7851116">.</span><span class="ident" id="7851117">Sleep</span><span class="op" id="7851122">(</span><span class="ident" id="7851123"><a href="/net/dnsclient_unix_test.go.html#7848255">time</a></span><span class="op" id="7851127">.</span><span class="ident" id="7851128">Second</span><span class="op" id="7851134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851138">f</span><span class="op" id="7851139">,</span>&nbsp;<span class="ident" id="7851141">err</span>&nbsp;<span class="op" id="7851145">:=</span>&nbsp;<span class="ident" id="7851148"><a href="/net/dnsclient_unix_test.go.html#7848219">os</a></span><span class="op" id="7851150">.</span><span class="ident" id="7851151">OpenFile</span><span class="op" id="7851159">(</span><span class="ident" id="7851160"><a href="/net/dnsclient_unix_test.go.html#7850948">r</a></span><span class="op" id="7851161">.</span><span class="ident" id="7851162">path</span><span class="op" id="7851166">,</span>&nbsp;<span class="ident" id="7851168"><a href="/net/dnsclient_unix_test.go.html#7848219">os</a></span><span class="op" id="7851170">.</span><span class="ident" id="7851171">O_CREATE</span><span class="op" id="7851179">|</span><span class="ident" id="7851180"><a href="/net/dnsclient_unix_test.go.html#7848219">os</a></span><span class="op" id="7851182">.</span><span class="ident" id="7851183">O_TRUNC</span><span class="op" id="7851190">|</span><span class="ident" id="7851191"><a href="/net/dnsclient_unix_test.go.html#7848219">os</a></span><span class="op" id="7851193">.</span><span class="ident" id="7851194">O_WRONLY</span><span class="op" id="7851202">,</span>&nbsp;<span class="num" id="7851204">0600</span><span class="op" id="7851208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851211">if</span>&nbsp;<span class="ident" id="7851214"><a href="/net/dnsclient_unix_test.go.html#7851141">err</a></span>&nbsp;<span class="op" id="7851218">!=</span>&nbsp;<span class="ident" id="7851221">nil</span>&nbsp;<span class="op" id="7851225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851229"><a href="/net/dnsclient_unix_test.go.html#7850948">r</a></span><span class="op" id="7851230">.</span><span class="ident" id="7851231">Fatalf</span><span class="op" id="7851237">(</span><span class="string" id="7851238">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7851273">,</span>&nbsp;<span class="ident" id="7851275"><a href="/net/dnsclient_unix_test.go.html#7850948">r</a></span><span class="op" id="7851276">.</span><span class="ident" id="7851277">path</span><span class="op" id="7851281">,</span>&nbsp;<span class="ident" id="7851283"><a href="/net/dnsclient_unix_test.go.html#7851141">err</a></span><span class="op" id="7851286">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851292">if</span>&nbsp;<span class="ident" id="7851295">_</span><span class="op" id="7851296">,</span>&nbsp;<span class="ident" id="7851298">err</span>&nbsp;<span class="op" id="7851302">:=</span>&nbsp;<span class="ident" id="7851305"><a href="/net/dnsclient_unix_test.go.html#7848200">io</a></span><span class="op" id="7851307">.</span><span class="ident" id="7851308">WriteString</span><span class="op" id="7851319">(</span><span class="ident" id="7851320"><a href="/net/dnsclient_unix_test.go.html#7851138">f</a></span><span class="op" id="7851321">,</span>&nbsp;<span class="ident" id="7851323"><a href="/net/dnsclient_unix_test.go.html#7850975">s</a></span><span class="op" id="7851324">)</span><span class="op" id="7851325">;</span>&nbsp;<span class="ident" id="7851327"><a href="/net/dnsclient_unix_test.go.html#7851298">err</a></span>&nbsp;<span class="op" id="7851331">!=</span>&nbsp;<span class="ident" id="7851334">nil</span>&nbsp;<span class="op" id="7851338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851342"><a href="/net/dnsclient_unix_test.go.html#7851138">f</a></span><span class="op" id="7851343">.</span><span class="ident" id="7851344">Close</span><span class="op" id="7851349">(</span><span class="op" id="7851350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851354"><a href="/net/dnsclient_unix_test.go.html#7850948">r</a></span><span class="op" id="7851355">.</span><span class="ident" id="7851356">Fatalf</span><span class="op" id="7851362">(</span><span class="string" id="7851363">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="7851394">,</span>&nbsp;<span class="ident" id="7851396"><a href="/net/dnsclient_unix_test.go.html#7851298">err</a></span><span class="op" id="7851399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851402">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851405"><a href="/net/dnsclient_unix_test.go.html#7851138">f</a></span><span class="op" id="7851406">.</span><span class="ident" id="7851407">Close</span><span class="op" id="7851412">(</span><span class="op" id="7851413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851417">if</span>&nbsp;<span class="ident" id="7851420"><a href="/net/dnsclient_unix_test.go.html#7850948">r</a></span><span class="op" id="7851421">.</span><span class="ident" id="7851422">started</span>&nbsp;<span class="op" id="7851430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851434"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7851437">.</span><span class="ident" id="7851438">ch</span>&nbsp;<span class="op" id="7851441">&lt;-</span>&nbsp;<span class="keyword" id="7851444">struct</span><span class="op" id="7851450">{</span><span class="op" id="7851451">}</span><span class="op" id="7851452">{</span><span class="op" id="7851453">}</span>&nbsp;<span class="comment" id="7851455">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851472"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7851475">.</span><span class="ident" id="7851476">ch</span>&nbsp;<span class="op" id="7851479">&lt;-</span>&nbsp;<span class="keyword" id="7851482">struct</span><span class="op" id="7851488">{</span><span class="op" id="7851489">}</span><span class="op" id="7851490">{</span><span class="op" id="7851491">}</span>&nbsp;<span class="comment" id="7851493">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851523"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7851526">.</span><span class="ident" id="7851527">ch</span>&nbsp;<span class="op" id="7851530">&lt;-</span>&nbsp;<span class="keyword" id="7851533">struct</span><span class="op" id="7851539">{</span><span class="op" id="7851540">}</span><span class="op" id="7851541">{</span><span class="op" id="7851542">}</span>&nbsp;<span class="comment" id="7851544">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851576">}</span><br>
<span class="lineno"></span><span class="op" id="7851578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7851581">func</span>&nbsp;<span class="op" id="7851586">(</span><span class="ident" id="7851587">r</span>&nbsp;<span class="op" id="7851589">*</span><span class="ident" id="7851590"><a href="/net/dnsclient_unix_test.go.html#7850340">resolvConfTest</a></span><span class="op" id="7851604">)</span>&nbsp;<span class="ident" id="7851606">WantServers</span><span class="op" id="7851617">(</span><span class="ident" id="7851618">want</span>&nbsp;<span class="op" id="7851623">[</span><span class="op" id="7851624">]</span><span class="builtintype" id="7851625">string</span><span class="op" id="7851631">)</span>&nbsp;<span class="op" id="7851633">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851636"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7851639">.</span><span class="ident" id="7851640">mu</span><span class="op" id="7851642">.</span><span class="ident" id="7851643">RLock</span><span class="op" id="7851648">(</span><span class="op" id="7851649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851652">defer</span>&nbsp;<span class="ident" id="7851658"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7851661">.</span><span class="ident" id="7851662">mu</span><span class="op" id="7851664">.</span><span class="ident" id="7851665">RUnlock</span><span class="op" id="7851672">(</span><span class="op" id="7851673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851676">if</span>&nbsp;<span class="ident" id="7851679">got</span>&nbsp;<span class="op" id="7851683">:=</span>&nbsp;<span class="ident" id="7851686"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7851689">.</span><span class="ident" id="7851690">dnsConfig</span><span class="op" id="7851699">.</span><span class="ident" id="7851700">servers</span><span class="op" id="7851707">;</span>&nbsp;<span class="op" id="7851709">!</span><span class="ident" id="7851710"><a href="/net/dnsclient_unix_test.go.html#7848233">reflect</a></span><span class="op" id="7851717">.</span><span class="ident" id="7851718">DeepEqual</span><span class="op" id="7851727">(</span><span class="ident" id="7851728"><a href="/net/dnsclient_unix_test.go.html#7851679">got</a></span><span class="op" id="7851731">,</span>&nbsp;<span class="ident" id="7851733"><a href="/net/dnsclient_unix_test.go.html#7851618">want</a></span><span class="op" id="7851737">)</span>&nbsp;<span class="op" id="7851739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851743"><a href="/net/dnsclient_unix_test.go.html#7851587">r</a></span><span class="op" id="7851744">.</span><span class="ident" id="7851745">Fatalf</span><span class="op" id="7851751">(</span><span class="string" id="7851752">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7851798">,</span>&nbsp;<span class="ident" id="7851800"><a href="/net/dnsclient_unix_test.go.html#7851679">got</a></span><span class="op" id="7851803">,</span>&nbsp;<span class="ident" id="7851805"><a href="/net/dnsclient_unix_test.go.html#7851618">want</a></span><span class="op" id="7851809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851812">}</span><br>
<span class="lineno">155</span><span class="op" id="7851814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7851817">func</span>&nbsp;<span class="op" id="7851822">(</span><span class="ident" id="7851823">r</span>&nbsp;<span class="op" id="7851825">*</span><span class="ident" id="7851826"><a href="/net/dnsclient_unix_test.go.html#7850340">resolvConfTest</a></span><span class="op" id="7851840">)</span>&nbsp;<span class="ident" id="7851842">Close</span><span class="op" id="7851847">(</span><span class="op" id="7851848">)</span>&nbsp;<span class="op" id="7851850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851853">resp</span>&nbsp;<span class="op" id="7851858">:=</span>&nbsp;<span class="builtinfunc" id="7851861">make</span><span class="op" id="7851865">(</span><span class="keyword" id="7851866">chan</span>&nbsp;<span class="keyword" id="7851871">struct</span><span class="op" id="7851877">{</span><span class="op" id="7851878">}</span><span class="op" id="7851879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851882"><a href="/net/dnsclient_unix_test.go.html#7851823">r</a></span><span class="op" id="7851883">.</span><span class="ident" id="7851884">quitc</span>&nbsp;<span class="op" id="7851890">&lt;-</span>&nbsp;<span class="ident" id="7851893"><a href="/net/dnsclient_unix_test.go.html#7851853">resp</a></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7851899">&lt;-</span><span class="ident" id="7851901"><a href="/net/dnsclient_unix_test.go.html#7851853">resp</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7851907">if</span>&nbsp;<span class="ident" id="7851910">err</span>&nbsp;<span class="op" id="7851914">:=</span>&nbsp;<span class="ident" id="7851917"><a href="/net/dnsclient_unix_test.go.html#7848219">os</a></span><span class="op" id="7851919">.</span><span class="ident" id="7851920">RemoveAll</span><span class="op" id="7851929">(</span><span class="ident" id="7851930"><a href="/net/dnsclient_unix_test.go.html#7851823">r</a></span><span class="op" id="7851931">.</span><span class="ident" id="7851932">dir</span><span class="op" id="7851935">)</span><span class="op" id="7851936">;</span>&nbsp;<span class="ident" id="7851938"><a href="/net/dnsclient_unix_test.go.html#7851910">err</a></span>&nbsp;<span class="op" id="7851942">!=</span>&nbsp;<span class="ident" id="7851945">nil</span>&nbsp;<span class="op" id="7851949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7851953"><a href="/net/dnsclient_unix_test.go.html#7851823">r</a></span><span class="op" id="7851954">.</span><span class="ident" id="7851955">Logf</span><span class="op" id="7851959">(</span><span class="string" id="7851960">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="7851994">,</span>&nbsp;<span class="ident" id="7851996"><a href="/net/dnsclient_unix_test.go.html#7851823">r</a></span><span class="op" id="7851997">.</span><span class="ident" id="7851998">dir</span><span class="op" id="7852001">,</span>&nbsp;<span class="ident" id="7852003"><a href="/net/dnsclient_unix_test.go.html#7851910">err</a></span><span class="op" id="7852006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852009">}</span><br>
<span class="lineno"></span><span class="op" id="7852011">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7852014">func</span>&nbsp;<span class="ident" id="7852019">TestReloadResolvConfFail</span><span class="op" id="7852043">(</span><span class="ident" id="7852044">t</span>&nbsp;<span class="op" id="7852046">*</span><span class="ident" id="7852047"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7852054">.</span><span class="ident" id="7852055">T</span><span class="op" id="7852056">)</span>&nbsp;<span class="op" id="7852058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852061">if</span>&nbsp;<span class="ident" id="7852064"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7852071">.</span><span class="ident" id="7852072">Short</span><span class="op" id="7852077">(</span><span class="op" id="7852078">)</span>&nbsp;<span class="op" id="7852080">||</span>&nbsp;<span class="op" id="7852083">!</span><span class="op" id="7852084">*</span><span class="ident" id="7852085"><a href="/net/lookup_test.go.html#7913432">testExternal</a></span>&nbsp;<span class="op" id="7852098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852102"><a href="/net/dnsclient_unix_test.go.html#7852044">t</a></span><span class="op" id="7852103">.</span><span class="ident" id="7852104">Skip</span><span class="op" id="7852108">(</span><span class="string" id="7852109">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7852150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852153">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852157">r</span>&nbsp;<span class="op" id="7852159">:=</span>&nbsp;<span class="ident" id="7852162"><a href="/net/dnsclient_unix_test.go.html#7850458">newResolvConfTest</a></span><span class="op" id="7852179">(</span><span class="ident" id="7852180"><a href="/net/dnsclient_unix_test.go.html#7852044">t</a></span><span class="op" id="7852181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852184">defer</span>&nbsp;<span class="ident" id="7852190"><a href="/net/dnsclient_unix_test.go.html#7852157">r</a></span><span class="op" id="7852191">.</span><span class="ident" id="7852192">Close</span><span class="op" id="7852197">(</span><span class="op" id="7852198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7852202">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852241"><a href="/net/dnsclient_unix_test.go.html#7852157">r</a></span><span class="op" id="7852242">.</span><span class="ident" id="7852243">Start</span><span class="op" id="7852248">(</span><span class="op" id="7852249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852252">if</span>&nbsp;<span class="ident" id="7852255">_</span><span class="op" id="7852256">,</span>&nbsp;<span class="ident" id="7852258">err</span>&nbsp;<span class="op" id="7852262">:=</span>&nbsp;<span class="ident" id="7852265"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7852275">(</span><span class="string" id="7852276">&#34;golang.org&#34;</span><span class="op" id="7852288">)</span><span class="op" id="7852289">;</span>&nbsp;<span class="ident" id="7852291"><a href="/net/dnsclient_unix_test.go.html#7852258">err</a></span>&nbsp;<span class="op" id="7852295">==</span>&nbsp;<span class="ident" id="7852298">nil</span>&nbsp;<span class="op" id="7852302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852306"><a href="/net/dnsclient_unix_test.go.html#7852044">t</a></span><span class="op" id="7852307">.</span><span class="ident" id="7852308">Fatal</span><span class="op" id="7852313">(</span><span class="string" id="7852314">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="7852345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852352"><a href="/net/dnsclient_unix_test.go.html#7852157">r</a></span><span class="op" id="7852353">.</span><span class="ident" id="7852354">SetConf</span><span class="op" id="7852361">(</span><span class="string" id="7852362">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7852382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852385">if</span>&nbsp;<span class="ident" id="7852388">_</span><span class="op" id="7852389">,</span>&nbsp;<span class="ident" id="7852391">err</span>&nbsp;<span class="op" id="7852395">:=</span>&nbsp;<span class="ident" id="7852398"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7852408">(</span><span class="string" id="7852409">&#34;golang.org&#34;</span><span class="op" id="7852421">)</span><span class="op" id="7852422">;</span>&nbsp;<span class="ident" id="7852424"><a href="/net/dnsclient_unix_test.go.html#7852391">err</a></span>&nbsp;<span class="op" id="7852428">!=</span>&nbsp;<span class="ident" id="7852431">nil</span>&nbsp;<span class="op" id="7852435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852439"><a href="/net/dnsclient_unix_test.go.html#7852044">t</a></span><span class="op" id="7852440">.</span><span class="ident" id="7852441">Fatalf</span><span class="op" id="7852447">(</span><span class="string" id="7852448">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7852486">,</span>&nbsp;<span class="ident" id="7852488"><a href="/net/dnsclient_unix_test.go.html#7852391">err</a></span><span class="op" id="7852491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7852498">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7852546">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852590"><a href="/net/dnsclient_unix_test.go.html#7852157">r</a></span><span class="op" id="7852591">.</span><span class="ident" id="7852592">SetConf</span><span class="op" id="7852599">(</span><span class="string" id="7852600">&#34;&#34;</span><span class="op" id="7852602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852605">if</span>&nbsp;<span class="ident" id="7852608">_</span><span class="op" id="7852609">,</span>&nbsp;<span class="ident" id="7852611">err</span>&nbsp;<span class="op" id="7852615">:=</span>&nbsp;<span class="ident" id="7852618"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7852628">(</span><span class="string" id="7852629">&#34;golang.org&#34;</span><span class="op" id="7852641">)</span><span class="op" id="7852642">;</span>&nbsp;<span class="ident" id="7852644"><a href="/net/dnsclient_unix_test.go.html#7852611">err</a></span>&nbsp;<span class="op" id="7852648">!=</span>&nbsp;<span class="ident" id="7852651">nil</span>&nbsp;<span class="op" id="7852655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852659"><a href="/net/dnsclient_unix_test.go.html#7852044">t</a></span><span class="op" id="7852660">.</span><span class="ident" id="7852661">Fatalf</span><span class="op" id="7852667">(</span><span class="string" id="7852668">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7852711">,</span>&nbsp;<span class="ident" id="7852713"><a href="/net/dnsclient_unix_test.go.html#7852611">err</a></span><span class="op" id="7852716">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852719">}</span><br>
<span class="lineno"></span><span class="op" id="7852721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7852724">func</span>&nbsp;<span class="ident" id="7852729">TestReloadResolvConfChange</span><span class="op" id="7852755">(</span><span class="ident" id="7852756">t</span>&nbsp;<span class="op" id="7852758">*</span><span class="ident" id="7852759"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7852766">.</span><span class="ident" id="7852767">T</span><span class="op" id="7852768">)</span>&nbsp;<span class="op" id="7852770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852773">if</span>&nbsp;<span class="ident" id="7852776"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7852783">.</span><span class="ident" id="7852784">Short</span><span class="op" id="7852789">(</span><span class="op" id="7852790">)</span>&nbsp;<span class="op" id="7852792">||</span>&nbsp;<span class="op" id="7852795">!</span><span class="op" id="7852796">*</span><span class="ident" id="7852797"><a href="/net/lookup_test.go.html#7913432">testExternal</a></span>&nbsp;<span class="op" id="7852810">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852814"><a href="/net/dnsclient_unix_test.go.html#7852756">t</a></span><span class="op" id="7852815">.</span><span class="ident" id="7852816">Skip</span><span class="op" id="7852820">(</span><span class="string" id="7852821">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7852862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7852865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852869">r</span>&nbsp;<span class="op" id="7852871">:=</span>&nbsp;<span class="ident" id="7852874"><a href="/net/dnsclient_unix_test.go.html#7850458">newResolvConfTest</a></span><span class="op" id="7852891">(</span><span class="ident" id="7852892"><a href="/net/dnsclient_unix_test.go.html#7852756">t</a></span><span class="op" id="7852893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852896">defer</span>&nbsp;<span class="ident" id="7852902"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7852903">.</span><span class="ident" id="7852904">Close</span><span class="op" id="7852909">(</span><span class="op" id="7852910">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852914"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7852915">.</span><span class="ident" id="7852916">SetConf</span><span class="op" id="7852923">(</span><span class="string" id="7852924">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="7852944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7852947"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7852948">.</span><span class="ident" id="7852949">Start</span><span class="op" id="7852954">(</span><span class="op" id="7852955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7852959">if</span>&nbsp;<span class="ident" id="7852962">_</span><span class="op" id="7852963">,</span>&nbsp;<span class="ident" id="7852965">err</span>&nbsp;<span class="op" id="7852969">:=</span>&nbsp;<span class="ident" id="7852972"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7852982">(</span><span class="string" id="7852983">&#34;golang.org&#34;</span><span class="op" id="7852995">)</span><span class="op" id="7852996">;</span>&nbsp;<span class="ident" id="7852998"><a href="/net/dnsclient_unix_test.go.html#7852965">err</a></span>&nbsp;<span class="op" id="7853002">!=</span>&nbsp;<span class="ident" id="7853005">nil</span>&nbsp;<span class="op" id="7853009">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853013"><a href="/net/dnsclient_unix_test.go.html#7852756">t</a></span><span class="op" id="7853014">.</span><span class="ident" id="7853015">Fatalf</span><span class="op" id="7853021">(</span><span class="string" id="7853022">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7853051">,</span>&nbsp;<span class="ident" id="7853053"><a href="/net/dnsclient_unix_test.go.html#7852965">err</a></span><span class="op" id="7853056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7853059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853062"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7853063">.</span><span class="ident" id="7853064">WantServers</span><span class="op" id="7853075">(</span><span class="op" id="7853076">[</span><span class="op" id="7853077">]</span><span class="builtintype" id="7853078">string</span><span class="op" id="7853084">{</span><span class="string" id="7853085">&#34;8.8.8.8&#34;</span><span class="op" id="7853094">}</span><span class="op" id="7853095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7853099">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7853150">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853190"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7853191">.</span><span class="ident" id="7853192">SetConf</span><span class="op" id="7853199">(</span><span class="string" id="7853200">&#34;&#34;</span><span class="op" id="7853202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7853205">if</span>&nbsp;<span class="ident" id="7853208">_</span><span class="op" id="7853209">,</span>&nbsp;<span class="ident" id="7853211">err</span>&nbsp;<span class="op" id="7853215">:=</span>&nbsp;<span class="ident" id="7853218"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7853228">(</span><span class="string" id="7853229">&#34;golang.org&#34;</span><span class="op" id="7853241">)</span><span class="op" id="7853242">;</span>&nbsp;<span class="ident" id="7853244"><a href="/net/dnsclient_unix_test.go.html#7853211">err</a></span>&nbsp;<span class="op" id="7853248">!=</span>&nbsp;<span class="ident" id="7853251">nil</span>&nbsp;<span class="op" id="7853255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853259"><a href="/net/dnsclient_unix_test.go.html#7852756">t</a></span><span class="op" id="7853260">.</span><span class="ident" id="7853261">Fatalf</span><span class="op" id="7853267">(</span><span class="string" id="7853268">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7853302">,</span>&nbsp;<span class="ident" id="7853304"><a href="/net/dnsclient_unix_test.go.html#7853211">err</a></span><span class="op" id="7853307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7853310">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7853314">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853357"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7853358">.</span><span class="ident" id="7853359">SetConf</span><span class="op" id="7853366">(</span><span class="string" id="7853367">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="7853387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853390"><a href="/net/dnsclient_unix_test.go.html#7852869">r</a></span><span class="op" id="7853391">.</span><span class="ident" id="7853392">WantServers</span><span class="op" id="7853403">(</span><span class="op" id="7853404">[</span><span class="op" id="7853405">]</span><span class="builtintype" id="7853406">string</span><span class="op" id="7853412">{</span><span class="string" id="7853413">&#34;8.8.4.4&#34;</span><span class="op" id="7853422">}</span><span class="op" id="7853423">)</span><br>
<span class="lineno"></span><span class="op" id="7853425">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="7853428">func</span>&nbsp;<span class="ident" id="7853433">BenchmarkGoLookupIP</span><span class="op" id="7853452">(</span><span class="ident" id="7853453">b</span>&nbsp;<span class="op" id="7853455">*</span><span class="ident" id="7853456"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7853463">.</span><span class="ident" id="7853464">B</span><span class="op" id="7853465">)</span>&nbsp;<span class="op" id="7853467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7853470">for</span>&nbsp;<span class="ident" id="7853474">i</span>&nbsp;<span class="op" id="7853476">:=</span>&nbsp;<span class="num" id="7853479">0</span><span class="op" id="7853480">;</span>&nbsp;<span class="ident" id="7853482"><a href="/net/dnsclient_unix_test.go.html#7853474">i</a></span>&nbsp;<span class="op" id="7853484">&lt;</span>&nbsp;<span class="ident" id="7853486"><a href="/net/dnsclient_unix_test.go.html#7853453">b</a></span><span class="op" id="7853487">.</span><span class="ident" id="7853488">N</span><span class="op" id="7853489">;</span>&nbsp;<span class="ident" id="7853491"><a href="/net/dnsclient_unix_test.go.html#7853474">i</a></span><span class="op" id="7853492">++</span>&nbsp;<span class="op" id="7853495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853499"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7853509">(</span><span class="string" id="7853510">&#34;www.example.com&#34;</span><span class="op" id="7853527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7853530">}</span><br>
<span class="lineno">225</span><span class="op" id="7853532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7853535">func</span>&nbsp;<span class="ident" id="7853540">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="7853569">(</span><span class="ident" id="7853570">b</span>&nbsp;<span class="op" id="7853572">*</span><span class="ident" id="7853573"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7853580">.</span><span class="ident" id="7853581">B</span><span class="op" id="7853582">)</span>&nbsp;<span class="op" id="7853584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7853587">for</span>&nbsp;<span class="ident" id="7853591">i</span>&nbsp;<span class="op" id="7853593">:=</span>&nbsp;<span class="num" id="7853596">0</span><span class="op" id="7853597">;</span>&nbsp;<span class="ident" id="7853599"><a href="/net/dnsclient_unix_test.go.html#7853591">i</a></span>&nbsp;<span class="op" id="7853601">&lt;</span>&nbsp;<span class="ident" id="7853603"><a href="/net/dnsclient_unix_test.go.html#7853570">b</a></span><span class="op" id="7853604">.</span><span class="ident" id="7853605">N</span><span class="op" id="7853606">;</span>&nbsp;<span class="ident" id="7853608"><a href="/net/dnsclient_unix_test.go.html#7853591">i</a></span><span class="op" id="7853609">++</span>&nbsp;<span class="op" id="7853612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853616"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7853626">(</span><span class="string" id="7853627">&#34;some.nonexistent&#34;</span><span class="op" id="7853645">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7853648">}</span><br>
<span class="lineno"></span><span class="op" id="7853650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7853653">func</span>&nbsp;<span class="ident" id="7853658">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="7853697">(</span><span class="ident" id="7853698">b</span>&nbsp;<span class="op" id="7853700">*</span><span class="ident" id="7853701"><a href="/net/dnsclient_unix_test.go.html#7848244">testing</a></span><span class="op" id="7853708">.</span><span class="ident" id="7853709">B</span><span class="op" id="7853710">)</span>&nbsp;<span class="op" id="7853712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853715"><a href="/net/dnsclient_unix.go.html#1350987">onceLoadConfig</a></span><span class="op" id="7853729">.</span><span class="ident" id="7853730">Do</span><span class="op" id="7853732">(</span><span class="ident" id="7853733"><a href="/net/dnsclient_unix.go.html#1351069">loadDefaultConfig</a></span><span class="op" id="7853750">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7853753">if</span>&nbsp;<span class="ident" id="7853756"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7853759">.</span><span class="ident" id="7853760">dnserr</span>&nbsp;<span class="op" id="7853767">!=</span>&nbsp;<span class="ident" id="7853770">nil</span>&nbsp;<span class="op" id="7853774">||</span>&nbsp;<span class="ident" id="7853777"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7853780">.</span><span class="ident" id="7853781">dnsConfig</span>&nbsp;<span class="op" id="7853791">==</span>&nbsp;<span class="ident" id="7853794">nil</span>&nbsp;<span class="op" id="7853798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853802"><a href="/net/dnsclient_unix_test.go.html#7853698">b</a></span><span class="op" id="7853803">.</span><span class="ident" id="7853804">Fatalf</span><span class="op" id="7853810">(</span><span class="string" id="7853811">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7853834">,</span>&nbsp;<span class="ident" id="7853836"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7853839">.</span><span class="ident" id="7853840">dnserr</span><span class="op" id="7853846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7853849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7853852">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7853916">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853953">orig</span>&nbsp;<span class="op" id="7853958">:=</span>&nbsp;<span class="ident" id="7853961"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7853964">.</span><span class="ident" id="7853965">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7853976"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7853979">.</span><span class="ident" id="7853980">dnsConfig</span><span class="op" id="7853989">.</span><span class="ident" id="7853990">servers</span>&nbsp;<span class="op" id="7853998">=</span>&nbsp;<span class="builtinfunc" id="7854000">append</span><span class="op" id="7854006">(</span><span class="op" id="7854007">[</span><span class="op" id="7854008">]</span><span class="builtintype" id="7854009">string</span><span class="op" id="7854015">{</span><span class="string" id="7854016">&#34;203.0.113.254&#34;</span><span class="op" id="7854031">}</span><span class="op" id="7854032">,</span>&nbsp;<span class="ident" id="7854034"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7854037">.</span><span class="ident" id="7854038">dnsConfig</span><span class="op" id="7854047">.</span><span class="ident" id="7854048">servers</span><span class="op" id="7854055">...</span><span class="op" id="7854058">)</span>&nbsp;<span class="comment" id="7854060">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7854099">for</span>&nbsp;<span class="ident" id="7854103">i</span>&nbsp;<span class="op" id="7854105">:=</span>&nbsp;<span class="num" id="7854108">0</span><span class="op" id="7854109">;</span>&nbsp;<span class="ident" id="7854111"><a href="/net/dnsclient_unix_test.go.html#7854103">i</a></span>&nbsp;<span class="op" id="7854113">&lt;</span>&nbsp;<span class="ident" id="7854115"><a href="/net/dnsclient_unix_test.go.html#7853698">b</a></span><span class="op" id="7854116">.</span><span class="ident" id="7854117">N</span><span class="op" id="7854118">;</span>&nbsp;<span class="ident" id="7854120"><a href="/net/dnsclient_unix_test.go.html#7854103">i</a></span><span class="op" id="7854121">++</span>&nbsp;<span class="op" id="7854124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7854128"><a href="/net/dnsclient_unix.go.html#1354683">goLookupIP</a></span><span class="op" id="7854138">(</span><span class="string" id="7854139">&#34;www.example.com&#34;</span><span class="op" id="7854156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7854159">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7854162"><a href="/net/dnsclient_unix.go.html#1350847">cfg</a></span><span class="op" id="7854165">.</span><span class="ident" id="7854166">dnsConfig</span>&nbsp;<span class="op" id="7854176">=</span>&nbsp;<span class="ident" id="7854178"><a href="/net/dnsclient_unix_test.go.html#7853953">orig</a></span><br>
<span class="lineno"></span><span class="op" id="7854183">}</span>
</div>
</body>
</html>
