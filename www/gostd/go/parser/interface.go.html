<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html" class="current">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4459624">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4459679">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4459733">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4459784">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459858">package</span>&nbsp;<span class="ident" id="4459866">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459874">import</span>&nbsp;<span class="op" id="4459881">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459884">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459893">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459903">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459913">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459925">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459931">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459944">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459950">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4459967">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4459977">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4459980">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="4460047">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4460115">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="4460172">//</span><br>
<span class="lineno">25</span><span class="keyword" id="4460175">func</span>&nbsp;<span class="ident" id="4460180">readSource</span><span class="op" id="4460190">(</span><span class="ident" id="4460191">filename</span>&nbsp;<span class="builtintype" id="4460200">string</span><span class="op" id="4460206">,</span>&nbsp;<span class="ident" id="4460208">src</span>&nbsp;<span class="keyword" id="4460212">interface</span><span class="op" id="4460221">{</span><span class="op" id="4460222">}</span><span class="op" id="4460223">)</span>&nbsp;<span class="op" id="4460225">(</span><span class="op" id="4460226">[</span><span class="op" id="4460227">]</span><span class="builtintype" id="4460228">byte</span><span class="op" id="4460232">,</span>&nbsp;<span class="builtintype" id="4460234">error</span><span class="op" id="4460239">)</span>&nbsp;<span class="op" id="4460241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460244">if</span>&nbsp;<span class="ident" id="4460247">src</span>&nbsp;<span class="op" id="4460251">!=</span>&nbsp;<span class="ident" id="4460254">nil</span>&nbsp;<span class="op" id="4460258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460262">switch</span>&nbsp;<span class="ident" id="4460269">s</span>&nbsp;<span class="op" id="4460271">:=</span>&nbsp;<span class="ident" id="4460274">src</span><span class="op" id="4460277">.</span><span class="op" id="4460278">(</span><span class="keyword" id="4460279">type</span><span class="op" id="4460283">)</span>&nbsp;<span class="op" id="4460285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460289">case</span>&nbsp;<span class="builtintype" id="4460294">string</span><span class="op" id="4460300">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460305">return</span>&nbsp;<span class="op" id="4460312">[</span><span class="op" id="4460313">]</span><span class="builtintype" id="4460314">byte</span><span class="op" id="4460318">(</span><span class="ident" id="4460319">s</span><span class="op" id="4460320">)</span><span class="op" id="4460321">,</span>&nbsp;<span class="ident" id="4460323">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460329">case</span>&nbsp;<span class="op" id="4460334">[</span><span class="op" id="4460335">]</span><span class="builtintype" id="4460336">byte</span><span class="op" id="4460340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460345">return</span>&nbsp;<span class="ident" id="4460352">s</span><span class="op" id="4460353">,</span>&nbsp;<span class="ident" id="4460355">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460361">case</span>&nbsp;<span class="op" id="4460366">*</span><span class="ident" id="4460367">bytes</span><span class="op" id="4460372">.</span><span class="ident" id="4460373">Buffer</span><span class="op" id="4460379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4460384">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460448">if</span>&nbsp;<span class="ident" id="4460451">s</span>&nbsp;<span class="op" id="4460453">!=</span>&nbsp;<span class="ident" id="4460456">nil</span>&nbsp;<span class="op" id="4460460">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460466">return</span>&nbsp;<span class="ident" id="4460473">s</span><span class="op" id="4460474">.</span><span class="ident" id="4460475">Bytes</span><span class="op" id="4460480">(</span><span class="op" id="4460481">)</span><span class="op" id="4460482">,</span>&nbsp;<span class="ident" id="4460484">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460495">case</span>&nbsp;<span class="ident" id="4460500">io</span><span class="op" id="4460502">.</span><span class="ident" id="4460503">Reader</span><span class="op" id="4460509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460514">var</span>&nbsp;<span class="ident" id="4460518">buf</span>&nbsp;<span class="ident" id="4460522">bytes</span><span class="op" id="4460527">.</span><span class="ident" id="4460528">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460538">if</span>&nbsp;<span class="ident" id="4460541">_</span><span class="op" id="4460542">,</span>&nbsp;<span class="ident" id="4460544">err</span>&nbsp;<span class="op" id="4460548">:=</span>&nbsp;<span class="ident" id="4460551">io</span><span class="op" id="4460553">.</span><span class="ident" id="4460554">Copy</span><span class="op" id="4460558">(</span><span class="op" id="4460559">&amp;</span><span class="ident" id="4460560">buf</span><span class="op" id="4460563">,</span>&nbsp;<span class="ident" id="4460565">s</span><span class="op" id="4460566">)</span><span class="op" id="4460567">;</span>&nbsp;<span class="ident" id="4460569">err</span>&nbsp;<span class="op" id="4460573">!=</span>&nbsp;<span class="ident" id="4460576">nil</span>&nbsp;<span class="op" id="4460580">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460586">return</span>&nbsp;<span class="ident" id="4460593">nil</span><span class="op" id="4460596">,</span>&nbsp;<span class="ident" id="4460598">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460610">return</span>&nbsp;<span class="ident" id="4460617">buf</span><span class="op" id="4460620">.</span><span class="ident" id="4460621">Bytes</span><span class="op" id="4460626">(</span><span class="op" id="4460627">)</span><span class="op" id="4460628">,</span>&nbsp;<span class="ident" id="4460630">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460640">return</span>&nbsp;<span class="ident" id="4460647">nil</span><span class="op" id="4460650">,</span>&nbsp;<span class="ident" id="4460652">errors</span><span class="op" id="4460658">.</span><span class="ident" id="4460659">New</span><span class="op" id="4460662">(</span><span class="string" id="4460663">&#34;invalid&nbsp;source&#34;</span><span class="op" id="4460679">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460685">return</span>&nbsp;<span class="ident" id="4460692">ioutil</span><span class="op" id="4460698">.</span><span class="ident" id="4460699">ReadFile</span><span class="op" id="4460707">(</span><span class="ident" id="4460708">filename</span><span class="op" id="4460716">)</span><br>
<span class="lineno"></span><span class="op" id="4460718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4460721">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="4460763">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="4460831">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="4460856">//</span><br>
<span class="lineno"></span><span class="keyword" id="4460859">type</span>&nbsp;<span class="ident" id="4460864">Mode</span>&nbsp;<span class="builtintype" id="4460869">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4460875">const</span>&nbsp;<span class="op" id="4460881">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460884">PackageClauseOnly</span>&nbsp;<span class="ident" id="4460902">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460919">=</span>&nbsp;<span class="num" id="4460921">1</span>&nbsp;<span class="op" id="4460923">&lt;&lt;</span>&nbsp;<span class="ident" id="4460926">iota</span>&nbsp;<span class="comment" id="4460931">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460969">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461016">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461059">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461106">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461145">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461192">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461232">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461279">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461309">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461356">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461406">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461424">=</span>&nbsp;<span class="ident" id="4461426">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4461453">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="4461517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="4461520">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4461595">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="4461667">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="4461729">//</span><br>
<span class="lineno"></span><span class="comment" id="4461732">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4461807">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="4461882">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="4461945">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="4462012">//</span><br>
<span class="lineno"></span><span class="comment" id="4462015">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="4462089">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4462163">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="4462181">//</span><br>
<span class="lineno"></span><span class="comment" id="4462184">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4462257">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="4462326">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="4462397">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="4462470">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="4462544">//</span><br>
<span class="lineno"></span><span class="keyword" id="4462547">func</span>&nbsp;<span class="ident" id="4462552">ParseFile</span><span class="op" id="4462561">(</span><span class="ident" id="4462562">fset</span>&nbsp;<span class="op" id="4462567">*</span><span class="ident" id="4462568">token</span><span class="op" id="4462573">.</span><span class="ident" id="4462574">FileSet</span><span class="op" id="4462581">,</span>&nbsp;<span class="ident" id="4462583">filename</span>&nbsp;<span class="builtintype" id="4462592">string</span><span class="op" id="4462598">,</span>&nbsp;<span class="ident" id="4462600">src</span>&nbsp;<span class="keyword" id="4462604">interface</span><span class="op" id="4462613">{</span><span class="op" id="4462614">}</span><span class="op" id="4462615">,</span>&nbsp;<span class="ident" id="4462617">mode</span>&nbsp;<span class="ident" id="4462622">Mode</span><span class="op" id="4462626">)</span>&nbsp;<span class="op" id="4462628">(</span><span class="ident" id="4462629">f</span>&nbsp;<span class="op" id="4462631">*</span><span class="ident" id="4462632">ast</span><span class="op" id="4462635">.</span><span class="ident" id="4462636">File</span><span class="op" id="4462640">,</span>&nbsp;<span class="ident" id="4462642">err</span>&nbsp;<span class="builtintype" id="4462646">error</span><span class="op" id="4462651">)</span>&nbsp;<span class="op" id="4462653">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4462656">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462671">text</span><span class="op" id="4462675">,</span>&nbsp;<span class="ident" id="4462677">err</span>&nbsp;<span class="op" id="4462681">:=</span>&nbsp;<span class="ident" id="4462684">readSource</span><span class="op" id="4462694">(</span><span class="ident" id="4462695">filename</span><span class="op" id="4462703">,</span>&nbsp;<span class="ident" id="4462705">src</span><span class="op" id="4462708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462711">if</span>&nbsp;<span class="ident" id="4462714">err</span>&nbsp;<span class="op" id="4462718">!=</span>&nbsp;<span class="ident" id="4462721">nil</span>&nbsp;<span class="op" id="4462725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462729">return</span>&nbsp;<span class="ident" id="4462736">nil</span><span class="op" id="4462739">,</span>&nbsp;<span class="ident" id="4462741">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462746">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462750">var</span>&nbsp;<span class="ident" id="4462754">p</span>&nbsp;<span class="ident" id="4462756">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462764">defer</span>&nbsp;<span class="keyword" id="4462770">func</span><span class="op" id="4462774">(</span><span class="op" id="4462775">)</span>&nbsp;<span class="op" id="4462777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462781">if</span>&nbsp;<span class="ident" id="4462784">e</span>&nbsp;<span class="op" id="4462786">:=</span>&nbsp;<span class="builtinfunc" id="4462789">recover</span><span class="op" id="4462796">(</span><span class="op" id="4462797">)</span><span class="op" id="4462798">;</span>&nbsp;<span class="ident" id="4462800">e</span>&nbsp;<span class="op" id="4462802">!=</span>&nbsp;<span class="ident" id="4462805">nil</span>&nbsp;<span class="op" id="4462809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4462814">_</span>&nbsp;<span class="op" id="4462816">=</span>&nbsp;<span class="ident" id="4462818">e</span><span class="op" id="4462819">.</span><span class="op" id="4462820">(</span><span class="ident" id="4462821">bailout</span><span class="op" id="4462828">)</span>&nbsp;<span class="comment" id="4462830">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4462867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4462872">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4462895">if</span>&nbsp;<span class="ident" id="4462898">f</span>&nbsp;<span class="op" id="4462900">==</span>&nbsp;<span class="ident" id="4462903">nil</span>&nbsp;<span class="op" id="4462907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4462912">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4462965">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4463016">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463032">f</span>&nbsp;<span class="op" id="4463034">=</span>&nbsp;<span class="op" id="4463036">&amp;</span><span class="ident" id="4463037">ast</span><span class="op" id="4463040">.</span><span class="ident" id="4463041">File</span><span class="op" id="4463045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463051">Name</span><span class="op" id="4463055">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4463058">new</span><span class="op" id="4463061">(</span><span class="ident" id="4463062">ast</span><span class="op" id="4463065">.</span><span class="ident" id="4463066">Ident</span><span class="op" id="4463071">)</span><span class="op" id="4463072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463078">Scope</span><span class="op" id="4463083">:</span>&nbsp;<span class="ident" id="4463085">ast</span><span class="op" id="4463088">.</span><span class="ident" id="4463089">NewScope</span><span class="op" id="4463097">(</span><span class="ident" id="4463098">nil</span><span class="op" id="4463101">)</span><span class="op" id="4463102">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463116">p</span><span class="op" id="4463117">.</span><span class="ident" id="4463118">errors</span><span class="op" id="4463124">.</span><span class="ident" id="4463125">Sort</span><span class="op" id="4463129">(</span><span class="op" id="4463130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463134">err</span>&nbsp;<span class="op" id="4463138">=</span>&nbsp;<span class="ident" id="4463140">p</span><span class="op" id="4463141">.</span><span class="ident" id="4463142">errors</span><span class="op" id="4463148">.</span><span class="ident" id="4463149">Err</span><span class="op" id="4463152">(</span><span class="op" id="4463153">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4463156">}</span><span class="op" id="4463157">(</span><span class="op" id="4463158">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4463162">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463179">p</span><span class="op" id="4463180">.</span><span class="ident" id="4463181">init</span><span class="op" id="4463185">(</span><span class="ident" id="4463186">fset</span><span class="op" id="4463190">,</span>&nbsp;<span class="ident" id="4463192">filename</span><span class="op" id="4463200">,</span>&nbsp;<span class="ident" id="4463202">text</span><span class="op" id="4463206">,</span>&nbsp;<span class="ident" id="4463208">mode</span><span class="op" id="4463212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463215">f</span>&nbsp;<span class="op" id="4463217">=</span>&nbsp;<span class="ident" id="4463219">p</span><span class="op" id="4463220">.</span><span class="ident" id="4463221">parseFile</span><span class="op" id="4463230">(</span><span class="op" id="4463231">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4463235">return</span><br>
<span class="lineno"></span><span class="op" id="4463242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4463245">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="4463321">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="4463397">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="4463433">//</span><br>
<span class="lineno"></span><span class="comment" id="4463436">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="4463513">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="4463590">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="4463659">//</span><br>
<span class="lineno"></span><span class="comment" id="4463662">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4463739">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4463816">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="4463857">//</span><br>
<span class="lineno"></span><span class="keyword" id="4463860">func</span>&nbsp;<span class="ident" id="4463865">ParseDir</span><span class="op" id="4463873">(</span><span class="ident" id="4463874">fset</span>&nbsp;<span class="op" id="4463879">*</span><span class="ident" id="4463880">token</span><span class="op" id="4463885">.</span><span class="ident" id="4463886">FileSet</span><span class="op" id="4463893">,</span>&nbsp;<span class="ident" id="4463895">path</span>&nbsp;<span class="builtintype" id="4463900">string</span><span class="op" id="4463906">,</span>&nbsp;<span class="ident" id="4463908">filter</span>&nbsp;<span class="keyword" id="4463915">func</span><span class="op" id="4463919">(</span><span class="ident" id="4463920">os</span><span class="op" id="4463922">.</span><span class="ident" id="4463923">FileInfo</span><span class="op" id="4463931">)</span>&nbsp;<span class="builtintype" id="4463933">bool</span><span class="op" id="4463937">,</span>&nbsp;<span class="ident" id="4463939">mode</span>&nbsp;<span class="ident" id="4463944">Mode</span><span class="op" id="4463948">)</span>&nbsp;<span class="op" id="4463950">(</span><span class="ident" id="4463951">pkgs</span>&nbsp;<span class="keyword" id="4463956">map</span><span class="op" id="4463959">[</span><span class="builtintype" id="4463960">string</span><span class="op" id="4463966">]</span><span class="op" id="4463967">*</span><span class="ident" id="4463968">ast</span><span class="op" id="4463971">.</span><span class="ident" id="4463972">Package</span><span class="op" id="4463979">,</span>&nbsp;<span class="ident" id="4463981">first</span>&nbsp;<span class="builtintype" id="4463987">error</span><span class="op" id="4463992">)</span>&nbsp;<span class="op" id="4463994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4463997">fd</span><span class="op" id="4463999">,</span>&nbsp;<span class="ident" id="4464001">err</span>&nbsp;<span class="op" id="4464005">:=</span>&nbsp;<span class="ident" id="4464008">os</span><span class="op" id="4464010">.</span><span class="ident" id="4464011">Open</span><span class="op" id="4464015">(</span><span class="ident" id="4464016">path</span><span class="op" id="4464020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464023">if</span>&nbsp;<span class="ident" id="4464026">err</span>&nbsp;<span class="op" id="4464030">!=</span>&nbsp;<span class="ident" id="4464033">nil</span>&nbsp;<span class="op" id="4464037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464041">return</span>&nbsp;<span class="ident" id="4464048">nil</span><span class="op" id="4464051">,</span>&nbsp;<span class="ident" id="4464053">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464061">defer</span>&nbsp;<span class="ident" id="4464067">fd</span><span class="op" id="4464069">.</span><span class="ident" id="4464070">Close</span><span class="op" id="4464075">(</span><span class="op" id="4464076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464080">list</span><span class="op" id="4464084">,</span>&nbsp;<span class="ident" id="4464086">err</span>&nbsp;<span class="op" id="4464090">:=</span>&nbsp;<span class="ident" id="4464093">fd</span><span class="op" id="4464095">.</span><span class="ident" id="4464096">Readdir</span><span class="op" id="4464103">(</span><span class="op" id="4464104">-</span><span class="num" id="4464105">1</span><span class="op" id="4464106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464109">if</span>&nbsp;<span class="ident" id="4464112">err</span>&nbsp;<span class="op" id="4464116">!=</span>&nbsp;<span class="ident" id="4464119">nil</span>&nbsp;<span class="op" id="4464123">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464127">return</span>&nbsp;<span class="ident" id="4464134">nil</span><span class="op" id="4464137">,</span>&nbsp;<span class="ident" id="4464139">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464148">pkgs</span>&nbsp;<span class="op" id="4464153">=</span>&nbsp;<span class="builtinfunc" id="4464155">make</span><span class="op" id="4464159">(</span><span class="keyword" id="4464160">map</span><span class="op" id="4464163">[</span><span class="builtintype" id="4464164">string</span><span class="op" id="4464170">]</span><span class="op" id="4464171">*</span><span class="ident" id="4464172">ast</span><span class="op" id="4464175">.</span><span class="ident" id="4464176">Package</span><span class="op" id="4464183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464186">for</span>&nbsp;<span class="ident" id="4464190">_</span><span class="op" id="4464191">,</span>&nbsp;<span class="ident" id="4464193">d</span>&nbsp;<span class="op" id="4464195">:=</span>&nbsp;<span class="keyword" id="4464198">range</span>&nbsp;<span class="ident" id="4464204">list</span>&nbsp;<span class="op" id="4464209">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464213">if</span>&nbsp;<span class="ident" id="4464216">strings</span><span class="op" id="4464223">.</span><span class="ident" id="4464224">HasSuffix</span><span class="op" id="4464233">(</span><span class="ident" id="4464234">d</span><span class="op" id="4464235">.</span><span class="ident" id="4464236">Name</span><span class="op" id="4464240">(</span><span class="op" id="4464241">)</span><span class="op" id="4464242">,</span>&nbsp;<span class="string" id="4464244">&#34;.go&#34;</span><span class="op" id="4464249">)</span>&nbsp;<span class="op" id="4464251">&amp;&amp;</span>&nbsp;<span class="op" id="4464254">(</span><span class="ident" id="4464255">filter</span>&nbsp;<span class="op" id="4464262">==</span>&nbsp;<span class="ident" id="4464265">nil</span>&nbsp;<span class="op" id="4464269">||</span>&nbsp;<span class="ident" id="4464272">filter</span><span class="op" id="4464278">(</span><span class="ident" id="4464279">d</span><span class="op" id="4464280">)</span><span class="op" id="4464281">)</span>&nbsp;<span class="op" id="4464283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464288">filename</span>&nbsp;<span class="op" id="4464297">:=</span>&nbsp;<span class="ident" id="4464300">filepath</span><span class="op" id="4464308">.</span><span class="ident" id="4464309">Join</span><span class="op" id="4464313">(</span><span class="ident" id="4464314">path</span><span class="op" id="4464318">,</span>&nbsp;<span class="ident" id="4464320">d</span><span class="op" id="4464321">.</span><span class="ident" id="4464322">Name</span><span class="op" id="4464326">(</span><span class="op" id="4464327">)</span><span class="op" id="4464328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464333">if</span>&nbsp;<span class="ident" id="4464336">src</span><span class="op" id="4464339">,</span>&nbsp;<span class="ident" id="4464341">err</span>&nbsp;<span class="op" id="4464345">:=</span>&nbsp;<span class="ident" id="4464348">ParseFile</span><span class="op" id="4464357">(</span><span class="ident" id="4464358">fset</span><span class="op" id="4464362">,</span>&nbsp;<span class="ident" id="4464364">filename</span><span class="op" id="4464372">,</span>&nbsp;<span class="ident" id="4464374">nil</span><span class="op" id="4464377">,</span>&nbsp;<span class="ident" id="4464379">mode</span><span class="op" id="4464383">)</span><span class="op" id="4464384">;</span>&nbsp;<span class="ident" id="4464386">err</span>&nbsp;<span class="op" id="4464390">==</span>&nbsp;<span class="ident" id="4464393">nil</span>&nbsp;<span class="op" id="4464397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464403">name</span>&nbsp;<span class="op" id="4464408">:=</span>&nbsp;<span class="ident" id="4464411">src</span><span class="op" id="4464414">.</span><span class="ident" id="4464415">Name</span><span class="op" id="4464419">.</span><span class="ident" id="4464420">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464429">pkg</span><span class="op" id="4464432">,</span>&nbsp;<span class="ident" id="4464434">found</span>&nbsp;<span class="op" id="4464440">:=</span>&nbsp;<span class="ident" id="4464443">pkgs</span><span class="op" id="4464447">[</span><span class="ident" id="4464448">name</span><span class="op" id="4464452">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464458">if</span>&nbsp;<span class="op" id="4464461">!</span><span class="ident" id="4464462">found</span>&nbsp;<span class="op" id="4464468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464475">pkg</span>&nbsp;<span class="op" id="4464479">=</span>&nbsp;<span class="op" id="4464481">&amp;</span><span class="ident" id="4464482">ast</span><span class="op" id="4464485">.</span><span class="ident" id="4464486">Package</span><span class="op" id="4464493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464501">Name</span><span class="op" id="4464505">:</span>&nbsp;&nbsp;<span class="ident" id="4464508">name</span><span class="op" id="4464512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464520">Files</span><span class="op" id="4464525">:</span>&nbsp;<span class="builtinfunc" id="4464527">make</span><span class="op" id="4464531">(</span><span class="keyword" id="4464532">map</span><span class="op" id="4464535">[</span><span class="builtintype" id="4464536">string</span><span class="op" id="4464542">]</span><span class="op" id="4464543">*</span><span class="ident" id="4464544">ast</span><span class="op" id="4464547">.</span><span class="ident" id="4464548">File</span><span class="op" id="4464552">)</span><span class="op" id="4464553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464560">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464567">pkgs</span><span class="op" id="4464571">[</span><span class="ident" id="4464572">name</span><span class="op" id="4464576">]</span>&nbsp;<span class="op" id="4464578">=</span>&nbsp;<span class="ident" id="4464580">pkg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464594">pkg</span><span class="op" id="4464597">.</span><span class="ident" id="4464598">Files</span><span class="op" id="4464603">[</span><span class="ident" id="4464604">filename</span><span class="op" id="4464612">]</span>&nbsp;<span class="op" id="4464614">=</span>&nbsp;<span class="ident" id="4464616">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464623">}</span>&nbsp;<span class="keyword" id="4464625">else</span>&nbsp;<span class="keyword" id="4464630">if</span>&nbsp;<span class="ident" id="4464633">first</span>&nbsp;<span class="op" id="4464639">==</span>&nbsp;<span class="ident" id="4464642">nil</span>&nbsp;<span class="op" id="4464646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464652">first</span>&nbsp;<span class="op" id="4464658">=</span>&nbsp;<span class="ident" id="4464660">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4464674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464678">return</span><br>
<span class="lineno">165</span><span class="op" id="4464685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4464688">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="4464769">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4464849">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="4464891">//</span><br>
<span class="lineno"></span><span class="keyword" id="4464894">func</span>&nbsp;<span class="ident" id="4464899">ParseExpr</span><span class="op" id="4464908">(</span><span class="ident" id="4464909">x</span>&nbsp;<span class="builtintype" id="4464911">string</span><span class="op" id="4464917">)</span>&nbsp;<span class="op" id="4464919">(</span><span class="ident" id="4464920">ast</span><span class="op" id="4464923">.</span><span class="ident" id="4464924">Expr</span><span class="op" id="4464928">,</span>&nbsp;<span class="builtintype" id="4464930">error</span><span class="op" id="4464935">)</span>&nbsp;<span class="op" id="4464937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4464940">var</span>&nbsp;<span class="ident" id="4464944">p</span>&nbsp;<span class="ident" id="4464946">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4464954">p</span><span class="op" id="4464955">.</span><span class="ident" id="4464956">init</span><span class="op" id="4464960">(</span><span class="ident" id="4464961">token</span><span class="op" id="4464966">.</span><span class="ident" id="4464967">NewFileSet</span><span class="op" id="4464977">(</span><span class="op" id="4464978">)</span><span class="op" id="4464979">,</span>&nbsp;<span class="string" id="4464981">&#34;&#34;</span><span class="op" id="4464983">,</span>&nbsp;<span class="op" id="4464985">[</span><span class="op" id="4464986">]</span><span class="builtintype" id="4464987">byte</span><span class="op" id="4464991">(</span><span class="ident" id="4464992">x</span><span class="op" id="4464993">)</span><span class="op" id="4464994">,</span>&nbsp;<span class="num" id="4464996">0</span><span class="op" id="4464997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4465001">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4465058">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4465115">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4465174">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465205">p</span><span class="op" id="4465206">.</span><span class="ident" id="4465207">openScope</span><span class="op" id="4465216">(</span><span class="op" id="4465217">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465220">p</span><span class="op" id="4465221">.</span><span class="ident" id="4465222">pkgScope</span>&nbsp;<span class="op" id="4465231">=</span>&nbsp;<span class="ident" id="4465233">p</span><span class="op" id="4465234">.</span><span class="ident" id="4465235">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465245">e</span>&nbsp;<span class="op" id="4465247">:=</span>&nbsp;<span class="ident" id="4465250">p</span><span class="op" id="4465251">.</span><span class="ident" id="4465252">parseRhsOrType</span><span class="op" id="4465266">(</span><span class="op" id="4465267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465270">p</span><span class="op" id="4465271">.</span><span class="ident" id="4465272">closeScope</span><span class="op" id="4465282">(</span><span class="op" id="4465283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465286">assert</span><span class="op" id="4465292">(</span><span class="ident" id="4465293">p</span><span class="op" id="4465294">.</span><span class="ident" id="4465295">topScope</span>&nbsp;<span class="op" id="4465304">==</span>&nbsp;<span class="ident" id="4465307">nil</span><span class="op" id="4465310">,</span>&nbsp;<span class="string" id="4465312">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="4465331">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4465335">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4465380">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465424">if</span>&nbsp;<span class="ident" id="4465427">p</span><span class="op" id="4465428">.</span><span class="ident" id="4465429">tok</span>&nbsp;<span class="op" id="4465433">==</span>&nbsp;<span class="ident" id="4465436">token</span><span class="op" id="4465441">.</span><span class="ident" id="4465442">SEMICOLON</span>&nbsp;<span class="op" id="4465452">&amp;&amp;</span>&nbsp;<span class="ident" id="4465455">p</span><span class="op" id="4465456">.</span><span class="ident" id="4465457">lit</span>&nbsp;<span class="op" id="4465461">==</span>&nbsp;<span class="string" id="4465464">&#34;\n&#34;</span>&nbsp;<span class="op" id="4465469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465473">p</span><span class="op" id="4465474">.</span><span class="ident" id="4465475">next</span><span class="op" id="4465479">(</span><span class="op" id="4465480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4465483">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465486">p</span><span class="op" id="4465487">.</span><span class="ident" id="4465488">expect</span><span class="op" id="4465494">(</span><span class="ident" id="4465495">token</span><span class="op" id="4465500">.</span><span class="ident" id="4465501">EOF</span><span class="op" id="4465504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465508">if</span>&nbsp;<span class="ident" id="4465511">p</span><span class="op" id="4465512">.</span><span class="ident" id="4465513">errors</span><span class="op" id="4465519">.</span><span class="ident" id="4465520">Len</span><span class="op" id="4465523">(</span><span class="op" id="4465524">)</span>&nbsp;<span class="op" id="4465526">&gt;</span>&nbsp;<span class="num" id="4465528">0</span>&nbsp;<span class="op" id="4465530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4465534">p</span><span class="op" id="4465535">.</span><span class="ident" id="4465536">errors</span><span class="op" id="4465542">.</span><span class="ident" id="4465543">Sort</span><span class="op" id="4465547">(</span><span class="op" id="4465548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465552">return</span>&nbsp;<span class="ident" id="4465559">nil</span><span class="op" id="4465562">,</span>&nbsp;<span class="ident" id="4465564">p</span><span class="op" id="4465565">.</span><span class="ident" id="4465566">errors</span><span class="op" id="4465572">.</span><span class="ident" id="4465573">Err</span><span class="op" id="4465576">(</span><span class="op" id="4465577">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4465580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4465584">return</span>&nbsp;<span class="ident" id="4465591">e</span><span class="op" id="4465592">,</span>&nbsp;<span class="ident" id="4465594">nil</span><br>
<span class="lineno"></span><span class="op" id="4465598">}</span>
</div>
</body>
</html>
