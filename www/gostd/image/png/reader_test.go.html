<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6942602">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6942657">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6942711">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6942762">package</span>&nbsp;<span class="ident" id="6942770">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6942775">import</span>&nbsp;<span class="op" id="6942782">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942785">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942794">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942801">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942810">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942825">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942831">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942844">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942850">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942861">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6942871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6942874">var</span>&nbsp;<span class="ident" id="6942878">filenames</span>&nbsp;<span class="op" id="6942888">=</span>&nbsp;<span class="op" id="6942890">[</span><span class="op" id="6942891">]</span><span class="builtintype" id="6942892">string</span><span class="op" id="6942898">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942901">&#34;basn0g01&#34;</span><span class="op" id="6942911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942914">&#34;basn0g01-30&#34;</span><span class="op" id="6942927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942930">&#34;basn0g02&#34;</span><span class="op" id="6942940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942943">&#34;basn0g02-29&#34;</span><span class="op" id="6942956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942959">&#34;basn0g04&#34;</span><span class="op" id="6942969">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942972">&#34;basn0g04-31&#34;</span><span class="op" id="6942985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942988">&#34;basn0g08&#34;</span><span class="op" id="6942998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943001">&#34;basn0g16&#34;</span><span class="op" id="6943011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943014">&#34;basn2c08&#34;</span><span class="op" id="6943024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943027">&#34;basn2c16&#34;</span><span class="op" id="6943037">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943040">&#34;basn3p01&#34;</span><span class="op" id="6943050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943053">&#34;basn3p02&#34;</span><span class="op" id="6943063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943066">&#34;basn3p04&#34;</span><span class="op" id="6943076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943079">&#34;basn3p04-31i&#34;</span><span class="op" id="6943093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943096">&#34;basn3p08&#34;</span><span class="op" id="6943106">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943109">&#34;basn3p08-trns&#34;</span><span class="op" id="6943124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943127">&#34;basn4a08&#34;</span><span class="op" id="6943137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943140">&#34;basn4a16&#34;</span><span class="op" id="6943150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943153">&#34;basn6a08&#34;</span><span class="op" id="6943163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943166">&#34;basn6a16&#34;</span><span class="op" id="6943176">,</span><br>
<span class="lineno">40</span><span class="op" id="6943178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6943181">var</span>&nbsp;<span class="ident" id="6943185">filenamesPaletted</span>&nbsp;<span class="op" id="6943203">=</span>&nbsp;<span class="op" id="6943205">[</span><span class="op" id="6943206">]</span><span class="builtintype" id="6943207">string</span><span class="op" id="6943213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943216">&#34;basn3p01&#34;</span><span class="op" id="6943226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943229">&#34;basn3p02&#34;</span><span class="op" id="6943239">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943242">&#34;basn3p04&#34;</span><span class="op" id="6943252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943255">&#34;basn3p08&#34;</span><span class="op" id="6943265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943268">&#34;basn3p08-trns&#34;</span><span class="op" id="6943283">,</span><br>
<span class="lineno"></span><span class="op" id="6943285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6943288">var</span>&nbsp;<span class="ident" id="6943292">filenamesShort</span>&nbsp;<span class="op" id="6943307">=</span>&nbsp;<span class="op" id="6943309">[</span><span class="op" id="6943310">]</span><span class="builtintype" id="6943311">string</span><span class="op" id="6943317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943320">&#34;basn0g01&#34;</span><span class="op" id="6943330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943333">&#34;basn0g04-31&#34;</span><span class="op" id="6943346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6943349">&#34;basn6a16&#34;</span><span class="op" id="6943359">,</span><br>
<span class="lineno"></span><span class="op" id="6943361">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6943364">func</span>&nbsp;<span class="ident" id="6943369">readPNG</span><span class="op" id="6943376">(</span><span class="ident" id="6943377">filename</span>&nbsp;<span class="builtintype" id="6943386">string</span><span class="op" id="6943392">)</span>&nbsp;<span class="op" id="6943394">(</span><span class="ident" id="6943395">image</span><span class="op" id="6943400">.</span><span class="ident" id="6943401">Image</span><span class="op" id="6943406">,</span>&nbsp;<span class="builtintype" id="6943408">error</span><span class="op" id="6943413">)</span>&nbsp;<span class="op" id="6943415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943418">f</span><span class="op" id="6943419">,</span>&nbsp;<span class="ident" id="6943421">err</span>&nbsp;<span class="op" id="6943425">:=</span>&nbsp;<span class="ident" id="6943428">os</span><span class="op" id="6943430">.</span><span class="ident" id="6943431">Open</span><span class="op" id="6943435">(</span><span class="ident" id="6943436">filename</span><span class="op" id="6943444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943447">if</span>&nbsp;<span class="ident" id="6943450">err</span>&nbsp;<span class="op" id="6943454">!=</span>&nbsp;<span class="ident" id="6943457">nil</span>&nbsp;<span class="op" id="6943461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943465">return</span>&nbsp;<span class="ident" id="6943472">nil</span><span class="op" id="6943475">,</span>&nbsp;<span class="ident" id="6943477">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6943482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943485">defer</span>&nbsp;<span class="ident" id="6943491">f</span><span class="op" id="6943492">.</span><span class="ident" id="6943493">Close</span><span class="op" id="6943498">(</span><span class="op" id="6943499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943502">return</span>&nbsp;<span class="ident" id="6943509">Decode</span><span class="op" id="6943515">(</span><span class="ident" id="6943516">f</span><span class="op" id="6943517">)</span><br>
<span class="lineno"></span><span class="op" id="6943519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6943522">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="6943572">func</span>&nbsp;<span class="ident" id="6943577">sng</span><span class="op" id="6943580">(</span><span class="ident" id="6943581">w</span>&nbsp;<span class="ident" id="6943583">io</span><span class="op" id="6943585">.</span><span class="ident" id="6943586">WriteCloser</span><span class="op" id="6943597">,</span>&nbsp;<span class="ident" id="6943599">filename</span>&nbsp;<span class="builtintype" id="6943608">string</span><span class="op" id="6943614">,</span>&nbsp;<span class="ident" id="6943616">png</span>&nbsp;<span class="ident" id="6943620">image</span><span class="op" id="6943625">.</span><span class="ident" id="6943626">Image</span><span class="op" id="6943631">)</span>&nbsp;<span class="op" id="6943633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943636">defer</span>&nbsp;<span class="ident" id="6943642">w</span><span class="op" id="6943643">.</span><span class="ident" id="6943644">Close</span><span class="op" id="6943649">(</span><span class="op" id="6943650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943653">bounds</span>&nbsp;<span class="op" id="6943660">:=</span>&nbsp;<span class="ident" id="6943663">png</span><span class="op" id="6943666">.</span><span class="ident" id="6943667">Bounds</span><span class="op" id="6943673">(</span><span class="op" id="6943674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943677">cm</span>&nbsp;<span class="op" id="6943680">:=</span>&nbsp;<span class="ident" id="6943683">png</span><span class="op" id="6943686">.</span><span class="ident" id="6943687">ColorModel</span><span class="op" id="6943697">(</span><span class="op" id="6943698">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943701">var</span>&nbsp;<span class="ident" id="6943705">bitdepth</span>&nbsp;<span class="builtintype" id="6943714">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943719">switch</span>&nbsp;<span class="ident" id="6943726">cm</span>&nbsp;<span class="op" id="6943729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943732">case</span>&nbsp;<span class="ident" id="6943737">color</span><span class="op" id="6943742">.</span><span class="ident" id="6943743">RGBAModel</span><span class="op" id="6943752">,</span>&nbsp;<span class="ident" id="6943754">color</span><span class="op" id="6943759">.</span><span class="ident" id="6943760">NRGBAModel</span><span class="op" id="6943770">,</span>&nbsp;<span class="ident" id="6943772">color</span><span class="op" id="6943777">.</span><span class="ident" id="6943778">AlphaModel</span><span class="op" id="6943788">,</span>&nbsp;<span class="ident" id="6943790">color</span><span class="op" id="6943795">.</span><span class="ident" id="6943796">GrayModel</span><span class="op" id="6943805">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943809">bitdepth</span>&nbsp;<span class="op" id="6943818">=</span>&nbsp;<span class="num" id="6943820">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943823">default</span><span class="op" id="6943830">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943834">bitdepth</span>&nbsp;<span class="op" id="6943843">=</span>&nbsp;<span class="num" id="6943845">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6943849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943852">cpm</span><span class="op" id="6943855">,</span>&nbsp;<span class="ident" id="6943857">_</span>&nbsp;<span class="op" id="6943859">:=</span>&nbsp;<span class="ident" id="6943862">cm</span><span class="op" id="6943864">.</span><span class="op" id="6943865">(</span><span class="ident" id="6943866">color</span><span class="op" id="6943871">.</span><span class="ident" id="6943872">Palette</span><span class="op" id="6943879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943882">var</span>&nbsp;<span class="ident" id="6943886">paletted</span>&nbsp;<span class="op" id="6943895">*</span><span class="ident" id="6943896">image</span><span class="op" id="6943901">.</span><span class="ident" id="6943902">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943912">if</span>&nbsp;<span class="ident" id="6943915">cpm</span>&nbsp;<span class="op" id="6943919">!=</span>&nbsp;<span class="ident" id="6943922">nil</span>&nbsp;<span class="op" id="6943926">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943930">switch</span>&nbsp;<span class="op" id="6943937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943941">case</span>&nbsp;<span class="builtinfunc" id="6943946">len</span><span class="op" id="6943949">(</span><span class="ident" id="6943950">cpm</span><span class="op" id="6943953">)</span>&nbsp;<span class="op" id="6943955">&lt;=</span>&nbsp;<span class="num" id="6943958">2</span><span class="op" id="6943959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943964">bitdepth</span>&nbsp;<span class="op" id="6943973">=</span>&nbsp;<span class="num" id="6943975">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943979">case</span>&nbsp;<span class="builtinfunc" id="6943984">len</span><span class="op" id="6943987">(</span><span class="ident" id="6943988">cpm</span><span class="op" id="6943991">)</span>&nbsp;<span class="op" id="6943993">&lt;=</span>&nbsp;<span class="num" id="6943996">4</span><span class="op" id="6943997">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944002">bitdepth</span>&nbsp;<span class="op" id="6944011">=</span>&nbsp;<span class="num" id="6944013">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944017">case</span>&nbsp;<span class="builtinfunc" id="6944022">len</span><span class="op" id="6944025">(</span><span class="ident" id="6944026">cpm</span><span class="op" id="6944029">)</span>&nbsp;<span class="op" id="6944031">&lt;=</span>&nbsp;<span class="num" id="6944034">16</span><span class="op" id="6944036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944041">bitdepth</span>&nbsp;<span class="op" id="6944050">=</span>&nbsp;<span class="num" id="6944052">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944056">default</span><span class="op" id="6944063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944068">bitdepth</span>&nbsp;<span class="op" id="6944077">=</span>&nbsp;<span class="num" id="6944079">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6944083">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944087">paletted</span>&nbsp;<span class="op" id="6944096">=</span>&nbsp;<span class="ident" id="6944098">png</span><span class="op" id="6944101">.</span><span class="op" id="6944102">(</span><span class="op" id="6944103">*</span><span class="ident" id="6944104">image</span><span class="op" id="6944109">.</span><span class="ident" id="6944110">Paletted</span><span class="op" id="6944118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6944121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6944125">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944158">io</span><span class="op" id="6944160">.</span><span class="ident" id="6944161">WriteString</span><span class="op" id="6944172">(</span><span class="ident" id="6944173">w</span><span class="op" id="6944174">,</span>&nbsp;<span class="string" id="6944176">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="6944189">+</span><span class="ident" id="6944190">filename</span><span class="op" id="6944198">+</span><span class="string" id="6944199">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="6944215">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944218">fmt</span><span class="op" id="6944221">.</span><span class="ident" id="6944222">Fprintf</span><span class="op" id="6944229">(</span><span class="ident" id="6944230">w</span><span class="op" id="6944231">,</span>&nbsp;<span class="string" id="6944233">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="6944277">,</span>&nbsp;<span class="ident" id="6944279">bounds</span><span class="op" id="6944285">.</span><span class="ident" id="6944286">Dx</span><span class="op" id="6944288">(</span><span class="op" id="6944289">)</span><span class="op" id="6944290">,</span>&nbsp;<span class="ident" id="6944292">bounds</span><span class="op" id="6944298">.</span><span class="ident" id="6944299">Dy</span><span class="op" id="6944301">(</span><span class="op" id="6944302">)</span><span class="op" id="6944303">,</span>&nbsp;<span class="ident" id="6944305">bitdepth</span><span class="op" id="6944313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944316">switch</span>&nbsp;<span class="op" id="6944323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944326">case</span>&nbsp;<span class="ident" id="6944331">cm</span>&nbsp;<span class="op" id="6944334">==</span>&nbsp;<span class="ident" id="6944337">color</span><span class="op" id="6944342">.</span><span class="ident" id="6944343">RGBAModel</span><span class="op" id="6944352">,</span>&nbsp;<span class="ident" id="6944354">cm</span>&nbsp;<span class="op" id="6944357">==</span>&nbsp;<span class="ident" id="6944360">color</span><span class="op" id="6944365">.</span><span class="ident" id="6944366">RGBA64Model</span><span class="op" id="6944377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944381">io</span><span class="op" id="6944383">.</span><span class="ident" id="6944384">WriteString</span><span class="op" id="6944395">(</span><span class="ident" id="6944396">w</span><span class="op" id="6944397">,</span>&nbsp;<span class="string" id="6944399">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="6944419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944422">case</span>&nbsp;<span class="ident" id="6944427">cm</span>&nbsp;<span class="op" id="6944430">==</span>&nbsp;<span class="ident" id="6944433">color</span><span class="op" id="6944438">.</span><span class="ident" id="6944439">NRGBAModel</span><span class="op" id="6944449">,</span>&nbsp;<span class="ident" id="6944451">cm</span>&nbsp;<span class="op" id="6944454">==</span>&nbsp;<span class="ident" id="6944457">color</span><span class="op" id="6944462">.</span><span class="ident" id="6944463">NRGBA64Model</span><span class="op" id="6944475">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944479">io</span><span class="op" id="6944481">.</span><span class="ident" id="6944482">WriteString</span><span class="op" id="6944493">(</span><span class="ident" id="6944494">w</span><span class="op" id="6944495">,</span>&nbsp;<span class="string" id="6944497">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="6944523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944526">case</span>&nbsp;<span class="ident" id="6944531">cm</span>&nbsp;<span class="op" id="6944534">==</span>&nbsp;<span class="ident" id="6944537">color</span><span class="op" id="6944542">.</span><span class="ident" id="6944543">GrayModel</span><span class="op" id="6944552">,</span>&nbsp;<span class="ident" id="6944554">cm</span>&nbsp;<span class="op" id="6944557">==</span>&nbsp;<span class="ident" id="6944560">color</span><span class="op" id="6944565">.</span><span class="ident" id="6944566">Gray16Model</span><span class="op" id="6944577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944581">io</span><span class="op" id="6944583">.</span><span class="ident" id="6944584">WriteString</span><span class="op" id="6944595">(</span><span class="ident" id="6944596">w</span><span class="op" id="6944597">,</span>&nbsp;<span class="string" id="6944599">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="6944623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944626">case</span>&nbsp;<span class="ident" id="6944631">cpm</span>&nbsp;<span class="op" id="6944635">!=</span>&nbsp;<span class="ident" id="6944638">nil</span><span class="op" id="6944641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944645">io</span><span class="op" id="6944647">.</span><span class="ident" id="6944648">WriteString</span><span class="op" id="6944659">(</span><span class="ident" id="6944660">w</span><span class="op" id="6944661">,</span>&nbsp;<span class="string" id="6944663">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="6944691">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944694">default</span><span class="op" id="6944701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944705">io</span><span class="op" id="6944707">.</span><span class="ident" id="6944708">WriteString</span><span class="op" id="6944719">(</span><span class="ident" id="6944720">w</span><span class="op" id="6944721">,</span>&nbsp;<span class="string" id="6944723">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="6944758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6944761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944764">io</span><span class="op" id="6944766">.</span><span class="ident" id="6944767">WriteString</span><span class="op" id="6944778">(</span><span class="ident" id="6944779">w</span><span class="op" id="6944780">,</span>&nbsp;<span class="string" id="6944782">&#34;}\n&#34;</span><span class="op" id="6944787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6944791">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6944884">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944969">io</span><span class="op" id="6944971">.</span><span class="ident" id="6944972">WriteString</span><span class="op" id="6944983">(</span><span class="ident" id="6944984">w</span><span class="op" id="6944985">,</span>&nbsp;<span class="string" id="6944987">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="6945004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6945008">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945053">if</span>&nbsp;<span class="ident" id="6945056">cpm</span>&nbsp;<span class="op" id="6945060">!=</span>&nbsp;<span class="ident" id="6945063">nil</span>&nbsp;<span class="op" id="6945067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945071">lastAlpha</span>&nbsp;<span class="op" id="6945081">:=</span>&nbsp;<span class="op" id="6945084">-</span><span class="num" id="6945085">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945089">io</span><span class="op" id="6945091">.</span><span class="ident" id="6945092">WriteString</span><span class="op" id="6945103">(</span><span class="ident" id="6945104">w</span><span class="op" id="6945105">,</span>&nbsp;<span class="string" id="6945107">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="6945117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945121">for</span>&nbsp;<span class="ident" id="6945125">i</span><span class="op" id="6945126">,</span>&nbsp;<span class="ident" id="6945128">c</span>&nbsp;<span class="op" id="6945130">:=</span>&nbsp;<span class="keyword" id="6945133">range</span>&nbsp;<span class="ident" id="6945139">cpm</span>&nbsp;<span class="op" id="6945143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945148">var</span>&nbsp;<span class="ident" id="6945152">r</span><span class="op" id="6945153">,</span>&nbsp;<span class="ident" id="6945155">g</span><span class="op" id="6945156">,</span>&nbsp;<span class="ident" id="6945158">b</span><span class="op" id="6945159">,</span>&nbsp;<span class="ident" id="6945161">a</span>&nbsp;<span class="builtintype" id="6945163">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945172">switch</span>&nbsp;<span class="ident" id="6945179">c</span>&nbsp;<span class="op" id="6945181">:=</span>&nbsp;<span class="ident" id="6945184">c</span><span class="op" id="6945185">.</span><span class="op" id="6945186">(</span><span class="keyword" id="6945187">type</span><span class="op" id="6945191">)</span>&nbsp;<span class="op" id="6945193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945198">case</span>&nbsp;<span class="ident" id="6945203">color</span><span class="op" id="6945208">.</span><span class="ident" id="6945209">RGBA</span><span class="op" id="6945213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945219">r</span><span class="op" id="6945220">,</span>&nbsp;<span class="ident" id="6945222">g</span><span class="op" id="6945223">,</span>&nbsp;<span class="ident" id="6945225">b</span><span class="op" id="6945226">,</span>&nbsp;<span class="ident" id="6945228">a</span>&nbsp;<span class="op" id="6945230">=</span>&nbsp;<span class="ident" id="6945232">c</span><span class="op" id="6945233">.</span><span class="ident" id="6945234">R</span><span class="op" id="6945235">,</span>&nbsp;<span class="ident" id="6945237">c</span><span class="op" id="6945238">.</span><span class="ident" id="6945239">G</span><span class="op" id="6945240">,</span>&nbsp;<span class="ident" id="6945242">c</span><span class="op" id="6945243">.</span><span class="ident" id="6945244">B</span><span class="op" id="6945245">,</span>&nbsp;<span class="num" id="6945247">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945255">case</span>&nbsp;<span class="ident" id="6945260">color</span><span class="op" id="6945265">.</span><span class="ident" id="6945266">NRGBA</span><span class="op" id="6945271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945277">r</span><span class="op" id="6945278">,</span>&nbsp;<span class="ident" id="6945280">g</span><span class="op" id="6945281">,</span>&nbsp;<span class="ident" id="6945283">b</span><span class="op" id="6945284">,</span>&nbsp;<span class="ident" id="6945286">a</span>&nbsp;<span class="op" id="6945288">=</span>&nbsp;<span class="ident" id="6945290">c</span><span class="op" id="6945291">.</span><span class="ident" id="6945292">R</span><span class="op" id="6945293">,</span>&nbsp;<span class="ident" id="6945295">c</span><span class="op" id="6945296">.</span><span class="ident" id="6945297">G</span><span class="op" id="6945298">,</span>&nbsp;<span class="ident" id="6945300">c</span><span class="op" id="6945301">.</span><span class="ident" id="6945302">B</span><span class="op" id="6945303">,</span>&nbsp;<span class="ident" id="6945305">c</span><span class="op" id="6945306">.</span><span class="ident" id="6945307">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945312">default</span><span class="op" id="6945319">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6945325">panic</span><span class="op" id="6945330">(</span><span class="string" id="6945331">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="6945359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945369">if</span>&nbsp;<span class="ident" id="6945372">a</span>&nbsp;<span class="op" id="6945374">!=</span>&nbsp;<span class="num" id="6945377">0xff</span>&nbsp;<span class="op" id="6945382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945388">lastAlpha</span>&nbsp;<span class="op" id="6945398">=</span>&nbsp;<span class="ident" id="6945400">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945410">fmt</span><span class="op" id="6945413">.</span><span class="ident" id="6945414">Fprintf</span><span class="op" id="6945421">(</span><span class="ident" id="6945422">w</span><span class="op" id="6945423">,</span>&nbsp;<span class="string" id="6945425">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="6945481">,</span>&nbsp;<span class="ident" id="6945483">r</span><span class="op" id="6945484">,</span>&nbsp;<span class="ident" id="6945486">g</span><span class="op" id="6945487">,</span>&nbsp;<span class="ident" id="6945489">b</span><span class="op" id="6945490">,</span>&nbsp;<span class="ident" id="6945492">r</span><span class="op" id="6945493">,</span>&nbsp;<span class="ident" id="6945495">g</span><span class="op" id="6945496">,</span>&nbsp;<span class="ident" id="6945498">b</span><span class="op" id="6945499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945507">io</span><span class="op" id="6945509">.</span><span class="ident" id="6945510">WriteString</span><span class="op" id="6945521">(</span><span class="ident" id="6945522">w</span><span class="op" id="6945523">,</span>&nbsp;<span class="string" id="6945525">&#34;}\n&#34;</span><span class="op" id="6945530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945534">if</span>&nbsp;<span class="ident" id="6945537">lastAlpha</span>&nbsp;<span class="op" id="6945547">!=</span>&nbsp;<span class="op" id="6945550">-</span><span class="num" id="6945551">1</span>&nbsp;<span class="op" id="6945553">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945558">io</span><span class="op" id="6945560">.</span><span class="ident" id="6945561">WriteString</span><span class="op" id="6945572">(</span><span class="ident" id="6945573">w</span><span class="op" id="6945574">,</span>&nbsp;<span class="string" id="6945576">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="6945586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945591">for</span>&nbsp;<span class="ident" id="6945595">i</span>&nbsp;<span class="op" id="6945597">:=</span>&nbsp;<span class="num" id="6945600">0</span><span class="op" id="6945601">;</span>&nbsp;<span class="ident" id="6945603">i</span>&nbsp;<span class="op" id="6945605">&lt;=</span>&nbsp;<span class="ident" id="6945608">lastAlpha</span><span class="op" id="6945617">;</span>&nbsp;<span class="ident" id="6945619">i</span><span class="op" id="6945620">++</span>&nbsp;<span class="op" id="6945623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945629">_</span><span class="op" id="6945630">,</span>&nbsp;<span class="ident" id="6945632">_</span><span class="op" id="6945633">,</span>&nbsp;<span class="ident" id="6945635">_</span><span class="op" id="6945636">,</span>&nbsp;<span class="ident" id="6945638">a</span>&nbsp;<span class="op" id="6945640">:=</span>&nbsp;<span class="ident" id="6945643">cpm</span><span class="op" id="6945646">[</span><span class="ident" id="6945647">i</span><span class="op" id="6945648">]</span><span class="op" id="6945649">.</span><span class="ident" id="6945650">RGBA</span><span class="op" id="6945654">(</span><span class="op" id="6945655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945661">a</span>&nbsp;<span class="op" id="6945663">&gt;&gt;=</span>&nbsp;<span class="num" id="6945667">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945673">fmt</span><span class="op" id="6945676">.</span><span class="ident" id="6945677">Fprintf</span><span class="op" id="6945684">(</span><span class="ident" id="6945685">w</span><span class="op" id="6945686">,</span>&nbsp;<span class="string" id="6945688">&#34;&nbsp;%d&#34;</span><span class="op" id="6945693">,</span>&nbsp;<span class="ident" id="6945695">a</span><span class="op" id="6945696">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945706">io</span><span class="op" id="6945708">.</span><span class="ident" id="6945709">WriteString</span><span class="op" id="6945720">(</span><span class="ident" id="6945721">w</span><span class="op" id="6945722">,</span>&nbsp;<span class="string" id="6945724">&#34;}\n&#34;</span><span class="op" id="6945729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6945740">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945761">io</span><span class="op" id="6945763">.</span><span class="ident" id="6945764">WriteString</span><span class="op" id="6945775">(</span><span class="ident" id="6945776">w</span><span class="op" id="6945777">,</span>&nbsp;<span class="string" id="6945779">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="6945806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945809">for</span>&nbsp;<span class="ident" id="6945813">y</span>&nbsp;<span class="op" id="6945815">:=</span>&nbsp;<span class="ident" id="6945818">bounds</span><span class="op" id="6945824">.</span><span class="ident" id="6945825">Min</span><span class="op" id="6945828">.</span><span class="ident" id="6945829">Y</span><span class="op" id="6945830">;</span>&nbsp;<span class="ident" id="6945832">y</span>&nbsp;<span class="op" id="6945834">&lt;</span>&nbsp;<span class="ident" id="6945836">bounds</span><span class="op" id="6945842">.</span><span class="ident" id="6945843">Max</span><span class="op" id="6945846">.</span><span class="ident" id="6945847">Y</span><span class="op" id="6945848">;</span>&nbsp;<span class="ident" id="6945850">y</span><span class="op" id="6945851">++</span>&nbsp;<span class="op" id="6945854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945858">switch</span>&nbsp;<span class="op" id="6945865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945869">case</span>&nbsp;<span class="ident" id="6945874">cm</span>&nbsp;<span class="op" id="6945877">==</span>&nbsp;<span class="ident" id="6945880">color</span><span class="op" id="6945885">.</span><span class="ident" id="6945886">GrayModel</span><span class="op" id="6945895">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945900">for</span>&nbsp;<span class="ident" id="6945904">x</span>&nbsp;<span class="op" id="6945906">:=</span>&nbsp;<span class="ident" id="6945909">bounds</span><span class="op" id="6945915">.</span><span class="ident" id="6945916">Min</span><span class="op" id="6945919">.</span><span class="ident" id="6945920">X</span><span class="op" id="6945921">;</span>&nbsp;<span class="ident" id="6945923">x</span>&nbsp;<span class="op" id="6945925">&lt;</span>&nbsp;<span class="ident" id="6945927">bounds</span><span class="op" id="6945933">.</span><span class="ident" id="6945934">Max</span><span class="op" id="6945937">.</span><span class="ident" id="6945938">X</span><span class="op" id="6945939">;</span>&nbsp;<span class="ident" id="6945941">x</span><span class="op" id="6945942">++</span>&nbsp;<span class="op" id="6945945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945951">gray</span>&nbsp;<span class="op" id="6945956">:=</span>&nbsp;<span class="ident" id="6945959">png</span><span class="op" id="6945962">.</span><span class="ident" id="6945963">At</span><span class="op" id="6945965">(</span><span class="ident" id="6945966">x</span><span class="op" id="6945967">,</span>&nbsp;<span class="ident" id="6945969">y</span><span class="op" id="6945970">)</span><span class="op" id="6945971">.</span><span class="op" id="6945972">(</span><span class="ident" id="6945973">color</span><span class="op" id="6945978">.</span><span class="ident" id="6945979">Gray</span><span class="op" id="6945983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945989">fmt</span><span class="op" id="6945992">.</span><span class="ident" id="6945993">Fprintf</span><span class="op" id="6946000">(</span><span class="ident" id="6946001">w</span><span class="op" id="6946002">,</span>&nbsp;<span class="string" id="6946004">&#34;%02x&#34;</span><span class="op" id="6946010">,</span>&nbsp;<span class="ident" id="6946012">gray</span><span class="op" id="6946016">.</span><span class="ident" id="6946017">Y</span><span class="op" id="6946018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946027">case</span>&nbsp;<span class="ident" id="6946032">cm</span>&nbsp;<span class="op" id="6946035">==</span>&nbsp;<span class="ident" id="6946038">color</span><span class="op" id="6946043">.</span><span class="ident" id="6946044">Gray16Model</span><span class="op" id="6946055">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946060">for</span>&nbsp;<span class="ident" id="6946064">x</span>&nbsp;<span class="op" id="6946066">:=</span>&nbsp;<span class="ident" id="6946069">bounds</span><span class="op" id="6946075">.</span><span class="ident" id="6946076">Min</span><span class="op" id="6946079">.</span><span class="ident" id="6946080">X</span><span class="op" id="6946081">;</span>&nbsp;<span class="ident" id="6946083">x</span>&nbsp;<span class="op" id="6946085">&lt;</span>&nbsp;<span class="ident" id="6946087">bounds</span><span class="op" id="6946093">.</span><span class="ident" id="6946094">Max</span><span class="op" id="6946097">.</span><span class="ident" id="6946098">X</span><span class="op" id="6946099">;</span>&nbsp;<span class="ident" id="6946101">x</span><span class="op" id="6946102">++</span>&nbsp;<span class="op" id="6946105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946111">gray16</span>&nbsp;<span class="op" id="6946118">:=</span>&nbsp;<span class="ident" id="6946121">png</span><span class="op" id="6946124">.</span><span class="ident" id="6946125">At</span><span class="op" id="6946127">(</span><span class="ident" id="6946128">x</span><span class="op" id="6946129">,</span>&nbsp;<span class="ident" id="6946131">y</span><span class="op" id="6946132">)</span><span class="op" id="6946133">.</span><span class="op" id="6946134">(</span><span class="ident" id="6946135">color</span><span class="op" id="6946140">.</span><span class="ident" id="6946141">Gray16</span><span class="op" id="6946147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946153">fmt</span><span class="op" id="6946156">.</span><span class="ident" id="6946157">Fprintf</span><span class="op" id="6946164">(</span><span class="ident" id="6946165">w</span><span class="op" id="6946166">,</span>&nbsp;<span class="string" id="6946168">&#34;%04x&nbsp;&#34;</span><span class="op" id="6946175">,</span>&nbsp;<span class="ident" id="6946177">gray16</span><span class="op" id="6946183">.</span><span class="ident" id="6946184">Y</span><span class="op" id="6946185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946194">case</span>&nbsp;<span class="ident" id="6946199">cm</span>&nbsp;<span class="op" id="6946202">==</span>&nbsp;<span class="ident" id="6946205">color</span><span class="op" id="6946210">.</span><span class="ident" id="6946211">RGBAModel</span><span class="op" id="6946220">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946225">for</span>&nbsp;<span class="ident" id="6946229">x</span>&nbsp;<span class="op" id="6946231">:=</span>&nbsp;<span class="ident" id="6946234">bounds</span><span class="op" id="6946240">.</span><span class="ident" id="6946241">Min</span><span class="op" id="6946244">.</span><span class="ident" id="6946245">X</span><span class="op" id="6946246">;</span>&nbsp;<span class="ident" id="6946248">x</span>&nbsp;<span class="op" id="6946250">&lt;</span>&nbsp;<span class="ident" id="6946252">bounds</span><span class="op" id="6946258">.</span><span class="ident" id="6946259">Max</span><span class="op" id="6946262">.</span><span class="ident" id="6946263">X</span><span class="op" id="6946264">;</span>&nbsp;<span class="ident" id="6946266">x</span><span class="op" id="6946267">++</span>&nbsp;<span class="op" id="6946270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946276">rgba</span>&nbsp;<span class="op" id="6946281">:=</span>&nbsp;<span class="ident" id="6946284">png</span><span class="op" id="6946287">.</span><span class="ident" id="6946288">At</span><span class="op" id="6946290">(</span><span class="ident" id="6946291">x</span><span class="op" id="6946292">,</span>&nbsp;<span class="ident" id="6946294">y</span><span class="op" id="6946295">)</span><span class="op" id="6946296">.</span><span class="op" id="6946297">(</span><span class="ident" id="6946298">color</span><span class="op" id="6946303">.</span><span class="ident" id="6946304">RGBA</span><span class="op" id="6946308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946314">fmt</span><span class="op" id="6946317">.</span><span class="ident" id="6946318">Fprintf</span><span class="op" id="6946325">(</span><span class="ident" id="6946326">w</span><span class="op" id="6946327">,</span>&nbsp;<span class="string" id="6946329">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6946344">,</span>&nbsp;<span class="ident" id="6946346">rgba</span><span class="op" id="6946350">.</span><span class="ident" id="6946351">R</span><span class="op" id="6946352">,</span>&nbsp;<span class="ident" id="6946354">rgba</span><span class="op" id="6946358">.</span><span class="ident" id="6946359">G</span><span class="op" id="6946360">,</span>&nbsp;<span class="ident" id="6946362">rgba</span><span class="op" id="6946366">.</span><span class="ident" id="6946367">B</span><span class="op" id="6946368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946377">case</span>&nbsp;<span class="ident" id="6946382">cm</span>&nbsp;<span class="op" id="6946385">==</span>&nbsp;<span class="ident" id="6946388">color</span><span class="op" id="6946393">.</span><span class="ident" id="6946394">RGBA64Model</span><span class="op" id="6946405">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946410">for</span>&nbsp;<span class="ident" id="6946414">x</span>&nbsp;<span class="op" id="6946416">:=</span>&nbsp;<span class="ident" id="6946419">bounds</span><span class="op" id="6946425">.</span><span class="ident" id="6946426">Min</span><span class="op" id="6946429">.</span><span class="ident" id="6946430">X</span><span class="op" id="6946431">;</span>&nbsp;<span class="ident" id="6946433">x</span>&nbsp;<span class="op" id="6946435">&lt;</span>&nbsp;<span class="ident" id="6946437">bounds</span><span class="op" id="6946443">.</span><span class="ident" id="6946444">Max</span><span class="op" id="6946447">.</span><span class="ident" id="6946448">X</span><span class="op" id="6946449">;</span>&nbsp;<span class="ident" id="6946451">x</span><span class="op" id="6946452">++</span>&nbsp;<span class="op" id="6946455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946461">rgba64</span>&nbsp;<span class="op" id="6946468">:=</span>&nbsp;<span class="ident" id="6946471">png</span><span class="op" id="6946474">.</span><span class="ident" id="6946475">At</span><span class="op" id="6946477">(</span><span class="ident" id="6946478">x</span><span class="op" id="6946479">,</span>&nbsp;<span class="ident" id="6946481">y</span><span class="op" id="6946482">)</span><span class="op" id="6946483">.</span><span class="op" id="6946484">(</span><span class="ident" id="6946485">color</span><span class="op" id="6946490">.</span><span class="ident" id="6946491">RGBA64</span><span class="op" id="6946497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946503">fmt</span><span class="op" id="6946506">.</span><span class="ident" id="6946507">Fprintf</span><span class="op" id="6946514">(</span><span class="ident" id="6946515">w</span><span class="op" id="6946516">,</span>&nbsp;<span class="string" id="6946518">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6946533">,</span>&nbsp;<span class="ident" id="6946535">rgba64</span><span class="op" id="6946541">.</span><span class="ident" id="6946542">R</span><span class="op" id="6946543">,</span>&nbsp;<span class="ident" id="6946545">rgba64</span><span class="op" id="6946551">.</span><span class="ident" id="6946552">G</span><span class="op" id="6946553">,</span>&nbsp;<span class="ident" id="6946555">rgba64</span><span class="op" id="6946561">.</span><span class="ident" id="6946562">B</span><span class="op" id="6946563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946572">case</span>&nbsp;<span class="ident" id="6946577">cm</span>&nbsp;<span class="op" id="6946580">==</span>&nbsp;<span class="ident" id="6946583">color</span><span class="op" id="6946588">.</span><span class="ident" id="6946589">NRGBAModel</span><span class="op" id="6946599">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946604">for</span>&nbsp;<span class="ident" id="6946608">x</span>&nbsp;<span class="op" id="6946610">:=</span>&nbsp;<span class="ident" id="6946613">bounds</span><span class="op" id="6946619">.</span><span class="ident" id="6946620">Min</span><span class="op" id="6946623">.</span><span class="ident" id="6946624">X</span><span class="op" id="6946625">;</span>&nbsp;<span class="ident" id="6946627">x</span>&nbsp;<span class="op" id="6946629">&lt;</span>&nbsp;<span class="ident" id="6946631">bounds</span><span class="op" id="6946637">.</span><span class="ident" id="6946638">Max</span><span class="op" id="6946641">.</span><span class="ident" id="6946642">X</span><span class="op" id="6946643">;</span>&nbsp;<span class="ident" id="6946645">x</span><span class="op" id="6946646">++</span>&nbsp;<span class="op" id="6946649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946655">nrgba</span>&nbsp;<span class="op" id="6946661">:=</span>&nbsp;<span class="ident" id="6946664">png</span><span class="op" id="6946667">.</span><span class="ident" id="6946668">At</span><span class="op" id="6946670">(</span><span class="ident" id="6946671">x</span><span class="op" id="6946672">,</span>&nbsp;<span class="ident" id="6946674">y</span><span class="op" id="6946675">)</span><span class="op" id="6946676">.</span><span class="op" id="6946677">(</span><span class="ident" id="6946678">color</span><span class="op" id="6946683">.</span><span class="ident" id="6946684">NRGBA</span><span class="op" id="6946689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946695">fmt</span><span class="op" id="6946698">.</span><span class="ident" id="6946699">Fprintf</span><span class="op" id="6946706">(</span><span class="ident" id="6946707">w</span><span class="op" id="6946708">,</span>&nbsp;<span class="string" id="6946710">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6946729">,</span>&nbsp;<span class="ident" id="6946731">nrgba</span><span class="op" id="6946736">.</span><span class="ident" id="6946737">R</span><span class="op" id="6946738">,</span>&nbsp;<span class="ident" id="6946740">nrgba</span><span class="op" id="6946745">.</span><span class="ident" id="6946746">G</span><span class="op" id="6946747">,</span>&nbsp;<span class="ident" id="6946749">nrgba</span><span class="op" id="6946754">.</span><span class="ident" id="6946755">B</span><span class="op" id="6946756">,</span>&nbsp;<span class="ident" id="6946758">nrgba</span><span class="op" id="6946763">.</span><span class="ident" id="6946764">A</span><span class="op" id="6946765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946774">case</span>&nbsp;<span class="ident" id="6946779">cm</span>&nbsp;<span class="op" id="6946782">==</span>&nbsp;<span class="ident" id="6946785">color</span><span class="op" id="6946790">.</span><span class="ident" id="6946791">NRGBA64Model</span><span class="op" id="6946803">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946808">for</span>&nbsp;<span class="ident" id="6946812">x</span>&nbsp;<span class="op" id="6946814">:=</span>&nbsp;<span class="ident" id="6946817">bounds</span><span class="op" id="6946823">.</span><span class="ident" id="6946824">Min</span><span class="op" id="6946827">.</span><span class="ident" id="6946828">X</span><span class="op" id="6946829">;</span>&nbsp;<span class="ident" id="6946831">x</span>&nbsp;<span class="op" id="6946833">&lt;</span>&nbsp;<span class="ident" id="6946835">bounds</span><span class="op" id="6946841">.</span><span class="ident" id="6946842">Max</span><span class="op" id="6946845">.</span><span class="ident" id="6946846">X</span><span class="op" id="6946847">;</span>&nbsp;<span class="ident" id="6946849">x</span><span class="op" id="6946850">++</span>&nbsp;<span class="op" id="6946853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946859">nrgba64</span>&nbsp;<span class="op" id="6946867">:=</span>&nbsp;<span class="ident" id="6946870">png</span><span class="op" id="6946873">.</span><span class="ident" id="6946874">At</span><span class="op" id="6946876">(</span><span class="ident" id="6946877">x</span><span class="op" id="6946878">,</span>&nbsp;<span class="ident" id="6946880">y</span><span class="op" id="6946881">)</span><span class="op" id="6946882">.</span><span class="op" id="6946883">(</span><span class="ident" id="6946884">color</span><span class="op" id="6946889">.</span><span class="ident" id="6946890">NRGBA64</span><span class="op" id="6946897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946903">fmt</span><span class="op" id="6946906">.</span><span class="ident" id="6946907">Fprintf</span><span class="op" id="6946914">(</span><span class="ident" id="6946915">w</span><span class="op" id="6946916">,</span>&nbsp;<span class="string" id="6946918">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6946937">,</span>&nbsp;<span class="ident" id="6946939">nrgba64</span><span class="op" id="6946946">.</span><span class="ident" id="6946947">R</span><span class="op" id="6946948">,</span>&nbsp;<span class="ident" id="6946950">nrgba64</span><span class="op" id="6946957">.</span><span class="ident" id="6946958">G</span><span class="op" id="6946959">,</span>&nbsp;<span class="ident" id="6946961">nrgba64</span><span class="op" id="6946968">.</span><span class="ident" id="6946969">B</span><span class="op" id="6946970">,</span>&nbsp;<span class="ident" id="6946972">nrgba64</span><span class="op" id="6946979">.</span><span class="ident" id="6946980">A</span><span class="op" id="6946981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946990">case</span>&nbsp;<span class="ident" id="6946995">cpm</span>&nbsp;<span class="op" id="6946999">!=</span>&nbsp;<span class="ident" id="6947002">nil</span><span class="op" id="6947005">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947010">var</span>&nbsp;<span class="ident" id="6947014">b</span><span class="op" id="6947015">,</span>&nbsp;<span class="ident" id="6947017">c</span>&nbsp;<span class="builtintype" id="6947019">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947026">for</span>&nbsp;<span class="ident" id="6947030">x</span>&nbsp;<span class="op" id="6947032">:=</span>&nbsp;<span class="ident" id="6947035">bounds</span><span class="op" id="6947041">.</span><span class="ident" id="6947042">Min</span><span class="op" id="6947045">.</span><span class="ident" id="6947046">X</span><span class="op" id="6947047">;</span>&nbsp;<span class="ident" id="6947049">x</span>&nbsp;<span class="op" id="6947051">&lt;</span>&nbsp;<span class="ident" id="6947053">bounds</span><span class="op" id="6947059">.</span><span class="ident" id="6947060">Max</span><span class="op" id="6947063">.</span><span class="ident" id="6947064">X</span><span class="op" id="6947065">;</span>&nbsp;<span class="ident" id="6947067">x</span><span class="op" id="6947068">++</span>&nbsp;<span class="op" id="6947071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947077">b</span>&nbsp;<span class="op" id="6947079">=</span>&nbsp;<span class="ident" id="6947081">b</span><span class="op" id="6947082">&lt;&lt;</span><span class="builtintype" id="6947084">uint</span><span class="op" id="6947088">(</span><span class="ident" id="6947089">bitdepth</span><span class="op" id="6947097">)</span>&nbsp;<span class="op" id="6947099">|</span>&nbsp;<span class="builtintype" id="6947101">int</span><span class="op" id="6947104">(</span><span class="ident" id="6947105">paletted</span><span class="op" id="6947113">.</span><span class="ident" id="6947114">ColorIndexAt</span><span class="op" id="6947126">(</span><span class="ident" id="6947127">x</span><span class="op" id="6947128">,</span>&nbsp;<span class="ident" id="6947130">y</span><span class="op" id="6947131">)</span><span class="op" id="6947132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947138">c</span><span class="op" id="6947139">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947146">if</span>&nbsp;<span class="ident" id="6947149">c</span>&nbsp;<span class="op" id="6947151">==</span>&nbsp;<span class="num" id="6947154">8</span><span class="op" id="6947155">/</span><span class="ident" id="6947156">bitdepth</span>&nbsp;<span class="op" id="6947165">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947172">fmt</span><span class="op" id="6947175">.</span><span class="ident" id="6947176">Fprintf</span><span class="op" id="6947183">(</span><span class="ident" id="6947184">w</span><span class="op" id="6947185">,</span>&nbsp;<span class="string" id="6947187">&#34;%02x&#34;</span><span class="op" id="6947193">,</span>&nbsp;<span class="ident" id="6947195">b</span><span class="op" id="6947196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947203">b</span>&nbsp;<span class="op" id="6947205">=</span>&nbsp;<span class="num" id="6947207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947214">c</span>&nbsp;<span class="op" id="6947216">=</span>&nbsp;<span class="num" id="6947218">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947229">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947234">if</span>&nbsp;<span class="ident" id="6947237">c</span>&nbsp;<span class="op" id="6947239">!=</span>&nbsp;<span class="num" id="6947242">0</span>&nbsp;<span class="op" id="6947244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947250">for</span>&nbsp;<span class="ident" id="6947254">c</span>&nbsp;<span class="op" id="6947256">!=</span>&nbsp;<span class="num" id="6947259">8</span><span class="op" id="6947260">/</span><span class="ident" id="6947261">bitdepth</span>&nbsp;<span class="op" id="6947270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947277">b</span>&nbsp;<span class="op" id="6947279">=</span>&nbsp;<span class="ident" id="6947281">b</span>&nbsp;<span class="op" id="6947283">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6947286">uint</span><span class="op" id="6947290">(</span><span class="ident" id="6947291">bitdepth</span><span class="op" id="6947299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947306">c</span><span class="op" id="6947307">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947314">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947320">fmt</span><span class="op" id="6947323">.</span><span class="ident" id="6947324">Fprintf</span><span class="op" id="6947331">(</span><span class="ident" id="6947332">w</span><span class="op" id="6947333">,</span>&nbsp;<span class="string" id="6947335">&#34;%02x&#34;</span><span class="op" id="6947341">,</span>&nbsp;<span class="ident" id="6947343">b</span><span class="op" id="6947344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947357">io</span><span class="op" id="6947359">.</span><span class="ident" id="6947360">WriteString</span><span class="op" id="6947371">(</span><span class="ident" id="6947372">w</span><span class="op" id="6947373">,</span>&nbsp;<span class="string" id="6947375">&#34;\n&#34;</span><span class="op" id="6947379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947382">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947385">io</span><span class="op" id="6947387">.</span><span class="ident" id="6947388">WriteString</span><span class="op" id="6947399">(</span><span class="ident" id="6947400">w</span><span class="op" id="6947401">,</span>&nbsp;<span class="string" id="6947403">&#34;}\n&#34;</span><span class="op" id="6947408">)</span><br>
<span class="lineno"></span><span class="op" id="6947410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6947413">func</span>&nbsp;<span class="ident" id="6947418">TestReader</span><span class="op" id="6947428">(</span><span class="ident" id="6947429">t</span>&nbsp;<span class="op" id="6947431">*</span><span class="ident" id="6947432">testing</span><span class="op" id="6947439">.</span><span class="ident" id="6947440">T</span><span class="op" id="6947441">)</span>&nbsp;<span class="op" id="6947443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947446">names</span>&nbsp;<span class="op" id="6947452">:=</span>&nbsp;<span class="ident" id="6947455">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947466">if</span>&nbsp;<span class="ident" id="6947469">testing</span><span class="op" id="6947476">.</span><span class="ident" id="6947477">Short</span><span class="op" id="6947482">(</span><span class="op" id="6947483">)</span>&nbsp;<span class="op" id="6947485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947489">names</span>&nbsp;<span class="op" id="6947495">=</span>&nbsp;<span class="ident" id="6947497">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947516">for</span>&nbsp;<span class="ident" id="6947520">_</span><span class="op" id="6947521">,</span>&nbsp;<span class="ident" id="6947523">fn</span>&nbsp;<span class="op" id="6947526">:=</span>&nbsp;<span class="keyword" id="6947529">range</span>&nbsp;<span class="ident" id="6947535">names</span>&nbsp;<span class="op" id="6947541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947545">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947570">img</span><span class="op" id="6947573">,</span>&nbsp;<span class="ident" id="6947575">err</span>&nbsp;<span class="op" id="6947579">:=</span>&nbsp;<span class="ident" id="6947582">readPNG</span><span class="op" id="6947589">(</span><span class="string" id="6947590">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6947611">+</span>&nbsp;<span class="ident" id="6947613">fn</span>&nbsp;<span class="op" id="6947616">+</span>&nbsp;<span class="string" id="6947618">&#34;.png&#34;</span><span class="op" id="6947624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947628">if</span>&nbsp;<span class="ident" id="6947631">err</span>&nbsp;<span class="op" id="6947635">!=</span>&nbsp;<span class="ident" id="6947638">nil</span>&nbsp;<span class="op" id="6947642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947647">t</span><span class="op" id="6947648">.</span><span class="ident" id="6947649">Error</span><span class="op" id="6947654">(</span><span class="ident" id="6947655">fn</span><span class="op" id="6947657">,</span>&nbsp;<span class="ident" id="6947659">err</span><span class="op" id="6947662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947667">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947678">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947683">if</span>&nbsp;<span class="ident" id="6947686">fn</span>&nbsp;<span class="op" id="6947689">==</span>&nbsp;<span class="string" id="6947692">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="6947703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947708">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947785">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947831">c</span>&nbsp;<span class="op" id="6947833">:=</span>&nbsp;<span class="ident" id="6947836">img</span><span class="op" id="6947839">.</span><span class="ident" id="6947840">At</span><span class="op" id="6947842">(</span><span class="num" id="6947843">2</span><span class="op" id="6947844">,</span>&nbsp;<span class="num" id="6947846">1</span><span class="op" id="6947847">)</span><span class="op" id="6947848">.</span><span class="op" id="6947849">(</span><span class="ident" id="6947850">color</span><span class="op" id="6947855">.</span><span class="ident" id="6947856">NRGBA64</span><span class="op" id="6947863">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6947868">if</span>&nbsp;<span class="ident" id="6947871">c</span><span class="op" id="6947872">.</span><span class="ident" id="6947873">R</span>&nbsp;<span class="op" id="6947875">!=</span>&nbsp;<span class="num" id="6947878">0x11a7</span>&nbsp;<span class="op" id="6947885">||</span>&nbsp;<span class="ident" id="6947888">c</span><span class="op" id="6947889">.</span><span class="ident" id="6947890">G</span>&nbsp;<span class="op" id="6947892">!=</span>&nbsp;<span class="num" id="6947895">0x11a7</span>&nbsp;<span class="op" id="6947902">||</span>&nbsp;<span class="ident" id="6947905">c</span><span class="op" id="6947906">.</span><span class="ident" id="6947907">B</span>&nbsp;<span class="op" id="6947909">!=</span>&nbsp;<span class="num" id="6947912">0x11a7</span>&nbsp;<span class="op" id="6947919">||</span>&nbsp;<span class="ident" id="6947922">c</span><span class="op" id="6947923">.</span><span class="ident" id="6947924">A</span>&nbsp;<span class="op" id="6947926">!=</span>&nbsp;<span class="num" id="6947929">0x1085</span>&nbsp;<span class="op" id="6947936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947942">t</span><span class="op" id="6947943">.</span><span class="ident" id="6947944">Error</span><span class="op" id="6947949">(</span><span class="ident" id="6947950">fn</span><span class="op" id="6947952">,</span>&nbsp;<span class="ident" id="6947954">fmt</span><span class="op" id="6947957">.</span><span class="ident" id="6947958">Errorf</span><span class="op" id="6947964">(</span><span class="string" id="6947965">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="6947998">,</span>&nbsp;<span class="ident" id="6948000">c</span><span class="op" id="6948001">)</span><span class="op" id="6948002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948012">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948023">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948028">piper</span><span class="op" id="6948033">,</span>&nbsp;<span class="ident" id="6948035">pipew</span>&nbsp;<span class="op" id="6948041">:=</span>&nbsp;<span class="ident" id="6948044">io</span><span class="op" id="6948046">.</span><span class="ident" id="6948047">Pipe</span><span class="op" id="6948051">(</span><span class="op" id="6948052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948056">pb</span>&nbsp;<span class="op" id="6948059">:=</span>&nbsp;<span class="ident" id="6948062">bufio</span><span class="op" id="6948067">.</span><span class="ident" id="6948068">NewScanner</span><span class="op" id="6948078">(</span><span class="ident" id="6948079">piper</span><span class="op" id="6948084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948088">go</span>&nbsp;<span class="ident" id="6948091">sng</span><span class="op" id="6948094">(</span><span class="ident" id="6948095">pipew</span><span class="op" id="6948100">,</span>&nbsp;<span class="ident" id="6948102">fn</span><span class="op" id="6948104">,</span>&nbsp;<span class="ident" id="6948106">img</span><span class="op" id="6948109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948113">defer</span>&nbsp;<span class="ident" id="6948119">piper</span><span class="op" id="6948124">.</span><span class="ident" id="6948125">Close</span><span class="op" id="6948130">(</span><span class="op" id="6948131">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6948136">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948161">sf</span><span class="op" id="6948163">,</span>&nbsp;<span class="ident" id="6948165">err</span>&nbsp;<span class="op" id="6948169">:=</span>&nbsp;<span class="ident" id="6948172">os</span><span class="op" id="6948174">.</span><span class="ident" id="6948175">Open</span><span class="op" id="6948179">(</span><span class="string" id="6948180">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6948201">+</span>&nbsp;<span class="ident" id="6948203">fn</span>&nbsp;<span class="op" id="6948206">+</span>&nbsp;<span class="string" id="6948208">&#34;.sng&#34;</span><span class="op" id="6948214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948218">if</span>&nbsp;<span class="ident" id="6948221">err</span>&nbsp;<span class="op" id="6948225">!=</span>&nbsp;<span class="ident" id="6948228">nil</span>&nbsp;<span class="op" id="6948232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948237">t</span><span class="op" id="6948238">.</span><span class="ident" id="6948239">Error</span><span class="op" id="6948244">(</span><span class="ident" id="6948245">fn</span><span class="op" id="6948247">,</span>&nbsp;<span class="ident" id="6948249">err</span><span class="op" id="6948252">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948257">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948272">defer</span>&nbsp;<span class="ident" id="6948278">sf</span><span class="op" id="6948280">.</span><span class="ident" id="6948281">Close</span><span class="op" id="6948286">(</span><span class="op" id="6948287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948291">sb</span>&nbsp;<span class="op" id="6948294">:=</span>&nbsp;<span class="ident" id="6948297">bufio</span><span class="op" id="6948302">.</span><span class="ident" id="6948303">NewScanner</span><span class="op" id="6948313">(</span><span class="ident" id="6948314">sf</span><span class="op" id="6948316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948320">if</span>&nbsp;<span class="ident" id="6948323">err</span>&nbsp;<span class="op" id="6948327">!=</span>&nbsp;<span class="ident" id="6948330">nil</span>&nbsp;<span class="op" id="6948334">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948339">t</span><span class="op" id="6948340">.</span><span class="ident" id="6948341">Error</span><span class="op" id="6948346">(</span><span class="ident" id="6948347">fn</span><span class="op" id="6948349">,</span>&nbsp;<span class="ident" id="6948351">err</span><span class="op" id="6948354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948359">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6948375">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948426">for</span>&nbsp;<span class="op" id="6948430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948435">pdone</span>&nbsp;<span class="op" id="6948441">:=</span>&nbsp;<span class="op" id="6948444">!</span><span class="ident" id="6948445">pb</span><span class="op" id="6948447">.</span><span class="ident" id="6948448">Scan</span><span class="op" id="6948452">(</span><span class="op" id="6948453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948458">sdone</span>&nbsp;<span class="op" id="6948464">:=</span>&nbsp;<span class="op" id="6948467">!</span><span class="ident" id="6948468">sb</span><span class="op" id="6948470">.</span><span class="ident" id="6948471">Scan</span><span class="op" id="6948475">(</span><span class="op" id="6948476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948481">if</span>&nbsp;<span class="ident" id="6948484">pdone</span>&nbsp;<span class="op" id="6948490">&amp;&amp;</span>&nbsp;<span class="ident" id="6948493">sdone</span>&nbsp;<span class="op" id="6948499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948505">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948519">if</span>&nbsp;<span class="ident" id="6948522">pdone</span>&nbsp;<span class="op" id="6948528">||</span>&nbsp;<span class="ident" id="6948531">sdone</span>&nbsp;<span class="op" id="6948537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948543">t</span><span class="op" id="6948544">.</span><span class="ident" id="6948545">Errorf</span><span class="op" id="6948551">(</span><span class="string" id="6948552">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="6948573">,</span>&nbsp;<span class="ident" id="6948575">fn</span><span class="op" id="6948577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948583">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948592">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948597">ps</span>&nbsp;<span class="op" id="6948600">:=</span>&nbsp;<span class="ident" id="6948603">pb</span><span class="op" id="6948605">.</span><span class="ident" id="6948606">Text</span><span class="op" id="6948610">(</span><span class="op" id="6948611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948616">ss</span>&nbsp;<span class="op" id="6948619">:=</span>&nbsp;<span class="ident" id="6948622">sb</span><span class="op" id="6948624">.</span><span class="ident" id="6948625">Text</span><span class="op" id="6948629">(</span><span class="op" id="6948630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948635">if</span>&nbsp;<span class="ident" id="6948638">ps</span>&nbsp;<span class="op" id="6948641">!=</span>&nbsp;<span class="ident" id="6948644">ss</span>&nbsp;<span class="op" id="6948647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948653">t</span><span class="op" id="6948654">.</span><span class="ident" id="6948655">Errorf</span><span class="op" id="6948661">(</span><span class="string" id="6948662">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="6948692">,</span>&nbsp;<span class="ident" id="6948694">fn</span><span class="op" id="6948696">,</span>&nbsp;<span class="ident" id="6948698">ps</span><span class="op" id="6948700">,</span>&nbsp;<span class="ident" id="6948702">ss</span><span class="op" id="6948704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948710">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948727">if</span>&nbsp;<span class="ident" id="6948730">pb</span><span class="op" id="6948732">.</span><span class="ident" id="6948733">Err</span><span class="op" id="6948736">(</span><span class="op" id="6948737">)</span>&nbsp;<span class="op" id="6948739">!=</span>&nbsp;<span class="ident" id="6948742">nil</span>&nbsp;<span class="op" id="6948746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948751">t</span><span class="op" id="6948752">.</span><span class="ident" id="6948753">Error</span><span class="op" id="6948758">(</span><span class="ident" id="6948759">fn</span><span class="op" id="6948761">,</span>&nbsp;<span class="ident" id="6948763">pb</span><span class="op" id="6948765">.</span><span class="ident" id="6948766">Err</span><span class="op" id="6948769">(</span><span class="op" id="6948770">)</span><span class="op" id="6948771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948775">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6948779">if</span>&nbsp;<span class="ident" id="6948782">sb</span><span class="op" id="6948784">.</span><span class="ident" id="6948785">Err</span><span class="op" id="6948788">(</span><span class="op" id="6948789">)</span>&nbsp;<span class="op" id="6948791">!=</span>&nbsp;<span class="ident" id="6948794">nil</span>&nbsp;<span class="op" id="6948798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948803">t</span><span class="op" id="6948804">.</span><span class="ident" id="6948805">Error</span><span class="op" id="6948810">(</span><span class="ident" id="6948811">fn</span><span class="op" id="6948813">,</span>&nbsp;<span class="ident" id="6948815">sb</span><span class="op" id="6948817">.</span><span class="ident" id="6948818">Err</span><span class="op" id="6948821">(</span><span class="op" id="6948822">)</span><span class="op" id="6948823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948830">}</span><br>
<span class="lineno"></span><span class="op" id="6948832">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6948835">var</span>&nbsp;<span class="ident" id="6948839">readerErrors</span>&nbsp;<span class="op" id="6948852">=</span>&nbsp;<span class="op" id="6948854">[</span><span class="op" id="6948855">]</span><span class="keyword" id="6948856">struct</span>&nbsp;<span class="op" id="6948863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948866">file</span>&nbsp;<span class="builtintype" id="6948871">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6948879">err</span>&nbsp;&nbsp;<span class="builtintype" id="6948884">string</span><br>
<span class="lineno"></span><span class="op" id="6948891">}</span><span class="op" id="6948892">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948895">{</span><span class="string" id="6948896">&#34;invalid-zlib.png&#34;</span><span class="op" id="6948914">,</span>&nbsp;<span class="string" id="6948916">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="6948940">}</span><span class="op" id="6948941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948944">{</span><span class="string" id="6948945">&#34;invalid-crc32.png&#34;</span><span class="op" id="6948964">,</span>&nbsp;<span class="string" id="6948966">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6948984">}</span><span class="op" id="6948985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6948988">{</span><span class="string" id="6948989">&#34;invalid-noend.png&#34;</span><span class="op" id="6949008">,</span>&nbsp;<span class="string" id="6949010">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6949026">}</span><span class="op" id="6949027">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949030">{</span><span class="string" id="6949031">&#34;invalid-trunc.png&#34;</span><span class="op" id="6949050">,</span>&nbsp;<span class="string" id="6949052">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6949068">}</span><span class="op" id="6949069">,</span><br>
<span class="lineno"></span><span class="op" id="6949071">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6949074">func</span>&nbsp;<span class="ident" id="6949079">TestReaderError</span><span class="op" id="6949094">(</span><span class="ident" id="6949095">t</span>&nbsp;<span class="op" id="6949097">*</span><span class="ident" id="6949098">testing</span><span class="op" id="6949105">.</span><span class="ident" id="6949106">T</span><span class="op" id="6949107">)</span>&nbsp;<span class="op" id="6949109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949112">for</span>&nbsp;<span class="ident" id="6949116">_</span><span class="op" id="6949117">,</span>&nbsp;<span class="ident" id="6949119">tt</span>&nbsp;<span class="op" id="6949122">:=</span>&nbsp;<span class="keyword" id="6949125">range</span>&nbsp;<span class="ident" id="6949131">readerErrors</span>&nbsp;<span class="op" id="6949144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949148">img</span><span class="op" id="6949151">,</span>&nbsp;<span class="ident" id="6949153">err</span>&nbsp;<span class="op" id="6949157">:=</span>&nbsp;<span class="ident" id="6949160">readPNG</span><span class="op" id="6949167">(</span><span class="string" id="6949168">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="6949180">+</span>&nbsp;<span class="ident" id="6949182">tt</span><span class="op" id="6949184">.</span><span class="ident" id="6949185">file</span><span class="op" id="6949189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949193">if</span>&nbsp;<span class="ident" id="6949196">err</span>&nbsp;<span class="op" id="6949200">==</span>&nbsp;<span class="ident" id="6949203">nil</span>&nbsp;<span class="op" id="6949207">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949212">t</span><span class="op" id="6949213">.</span><span class="ident" id="6949214">Errorf</span><span class="op" id="6949220">(</span><span class="string" id="6949221">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="6949249">,</span>&nbsp;<span class="ident" id="6949251">tt</span><span class="op" id="6949253">.</span><span class="ident" id="6949254">file</span><span class="op" id="6949258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949263">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949278">if</span>&nbsp;<span class="op" id="6949281">!</span><span class="ident" id="6949282">strings</span><span class="op" id="6949289">.</span><span class="ident" id="6949290">Contains</span><span class="op" id="6949298">(</span><span class="ident" id="6949299">err</span><span class="op" id="6949302">.</span><span class="ident" id="6949303">Error</span><span class="op" id="6949308">(</span><span class="op" id="6949309">)</span><span class="op" id="6949310">,</span>&nbsp;<span class="ident" id="6949312">tt</span><span class="op" id="6949314">.</span><span class="ident" id="6949315">err</span><span class="op" id="6949318">)</span>&nbsp;<span class="op" id="6949320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949325">t</span><span class="op" id="6949326">.</span><span class="ident" id="6949327">Errorf</span><span class="op" id="6949333">(</span><span class="string" id="6949334">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6949360">,</span>&nbsp;<span class="ident" id="6949362">tt</span><span class="op" id="6949364">.</span><span class="ident" id="6949365">file</span><span class="op" id="6949369">,</span>&nbsp;<span class="ident" id="6949371">err</span><span class="op" id="6949374">,</span>&nbsp;<span class="ident" id="6949376">tt</span><span class="op" id="6949378">.</span><span class="ident" id="6949379">err</span><span class="op" id="6949382">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949390">if</span>&nbsp;<span class="ident" id="6949393">img</span>&nbsp;<span class="op" id="6949397">!=</span>&nbsp;<span class="ident" id="6949400">nil</span>&nbsp;<span class="op" id="6949404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949409">t</span><span class="op" id="6949410">.</span><span class="ident" id="6949411">Errorf</span><span class="op" id="6949417">(</span><span class="string" id="6949418">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="6949451">,</span>&nbsp;<span class="ident" id="6949453">tt</span><span class="op" id="6949455">.</span><span class="ident" id="6949456">file</span><span class="op" id="6949460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949467">}</span><br>
<span class="lineno">295</span><span class="op" id="6949469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6949472">func</span>&nbsp;<span class="ident" id="6949477">TestPalettedDecodeConfig</span><span class="op" id="6949501">(</span><span class="ident" id="6949502">t</span>&nbsp;<span class="op" id="6949504">*</span><span class="ident" id="6949505">testing</span><span class="op" id="6949512">.</span><span class="ident" id="6949513">T</span><span class="op" id="6949514">)</span>&nbsp;<span class="op" id="6949516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949519">for</span>&nbsp;<span class="ident" id="6949523">_</span><span class="op" id="6949524">,</span>&nbsp;<span class="ident" id="6949526">fn</span>&nbsp;<span class="op" id="6949529">:=</span>&nbsp;<span class="keyword" id="6949532">range</span>&nbsp;<span class="ident" id="6949538">filenamesPaletted</span>&nbsp;<span class="op" id="6949556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949560">f</span><span class="op" id="6949561">,</span>&nbsp;<span class="ident" id="6949563">err</span>&nbsp;<span class="op" id="6949567">:=</span>&nbsp;<span class="ident" id="6949570">os</span><span class="op" id="6949572">.</span><span class="ident" id="6949573">Open</span><span class="op" id="6949577">(</span><span class="string" id="6949578">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6949599">+</span>&nbsp;<span class="ident" id="6949601">fn</span>&nbsp;<span class="op" id="6949604">+</span>&nbsp;<span class="string" id="6949606">&#34;.png&#34;</span><span class="op" id="6949612">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949616">if</span>&nbsp;<span class="ident" id="6949619">err</span>&nbsp;<span class="op" id="6949623">!=</span>&nbsp;<span class="ident" id="6949626">nil</span>&nbsp;<span class="op" id="6949630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949635">t</span><span class="op" id="6949636">.</span><span class="ident" id="6949637">Errorf</span><span class="op" id="6949643">(</span><span class="string" id="6949644">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6949665">,</span>&nbsp;<span class="ident" id="6949667">fn</span><span class="op" id="6949669">,</span>&nbsp;<span class="ident" id="6949671">err</span><span class="op" id="6949674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949679">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949694">defer</span>&nbsp;<span class="ident" id="6949700">f</span><span class="op" id="6949701">.</span><span class="ident" id="6949702">Close</span><span class="op" id="6949707">(</span><span class="op" id="6949708">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949712">cfg</span><span class="op" id="6949715">,</span>&nbsp;<span class="ident" id="6949717">err</span>&nbsp;<span class="op" id="6949721">:=</span>&nbsp;<span class="ident" id="6949724">DecodeConfig</span><span class="op" id="6949736">(</span><span class="ident" id="6949737">f</span><span class="op" id="6949738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949742">if</span>&nbsp;<span class="ident" id="6949745">err</span>&nbsp;<span class="op" id="6949749">!=</span>&nbsp;<span class="ident" id="6949752">nil</span>&nbsp;<span class="op" id="6949756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949761">t</span><span class="op" id="6949762">.</span><span class="ident" id="6949763">Errorf</span><span class="op" id="6949769">(</span><span class="string" id="6949770">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6949778">,</span>&nbsp;<span class="ident" id="6949780">fn</span><span class="op" id="6949782">,</span>&nbsp;<span class="ident" id="6949784">err</span><span class="op" id="6949787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949792">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949803">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949807">pal</span><span class="op" id="6949810">,</span>&nbsp;<span class="ident" id="6949812">ok</span>&nbsp;<span class="op" id="6949815">:=</span>&nbsp;<span class="ident" id="6949818">cfg</span><span class="op" id="6949821">.</span><span class="ident" id="6949822">ColorModel</span><span class="op" id="6949832">.</span><span class="op" id="6949833">(</span><span class="ident" id="6949834">color</span><span class="op" id="6949839">.</span><span class="ident" id="6949840">Palette</span><span class="op" id="6949847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949851">if</span>&nbsp;<span class="op" id="6949854">!</span><span class="ident" id="6949855">ok</span>&nbsp;<span class="op" id="6949858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949863">t</span><span class="op" id="6949864">.</span><span class="ident" id="6949865">Errorf</span><span class="op" id="6949871">(</span><span class="string" id="6949872">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="6949907">,</span>&nbsp;<span class="ident" id="6949909">fn</span><span class="op" id="6949911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949916">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949927">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949931">if</span>&nbsp;<span class="ident" id="6949934">pal</span>&nbsp;<span class="op" id="6949938">==</span>&nbsp;<span class="ident" id="6949941">nil</span>&nbsp;<span class="op" id="6949945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949950">t</span><span class="op" id="6949951">.</span><span class="ident" id="6949952">Errorf</span><span class="op" id="6949958">(</span><span class="string" id="6949959">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="6949988">,</span>&nbsp;<span class="ident" id="6949990">fn</span><span class="op" id="6949992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6949997">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950011">}</span><br>
<span class="lineno">320</span><span class="op" id="6950013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6950016">func</span>&nbsp;<span class="ident" id="6950021">benchmarkDecode</span><span class="op" id="6950036">(</span><span class="ident" id="6950037">b</span>&nbsp;<span class="op" id="6950039">*</span><span class="ident" id="6950040">testing</span><span class="op" id="6950047">.</span><span class="ident" id="6950048">B</span><span class="op" id="6950049">,</span>&nbsp;<span class="ident" id="6950051">filename</span>&nbsp;<span class="builtintype" id="6950060">string</span><span class="op" id="6950066">,</span>&nbsp;<span class="ident" id="6950068">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6950082">int</span><span class="op" id="6950085">)</span>&nbsp;<span class="op" id="6950087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950090">b</span><span class="op" id="6950091">.</span><span class="ident" id="6950092">StopTimer</span><span class="op" id="6950101">(</span><span class="op" id="6950102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950105">data</span><span class="op" id="6950109">,</span>&nbsp;<span class="ident" id="6950111">err</span>&nbsp;<span class="op" id="6950115">:=</span>&nbsp;<span class="ident" id="6950118">ioutil</span><span class="op" id="6950124">.</span><span class="ident" id="6950125">ReadFile</span><span class="op" id="6950133">(</span><span class="ident" id="6950134">filename</span><span class="op" id="6950142">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6950145">if</span>&nbsp;<span class="ident" id="6950148">err</span>&nbsp;<span class="op" id="6950152">!=</span>&nbsp;<span class="ident" id="6950155">nil</span>&nbsp;<span class="op" id="6950159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950163">b</span><span class="op" id="6950164">.</span><span class="ident" id="6950165">Fatal</span><span class="op" id="6950170">(</span><span class="ident" id="6950171">err</span><span class="op" id="6950174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950180">s</span>&nbsp;<span class="op" id="6950182">:=</span>&nbsp;<span class="builtintype" id="6950185">string</span><span class="op" id="6950191">(</span><span class="ident" id="6950192">data</span><span class="op" id="6950196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950199">cfg</span><span class="op" id="6950202">,</span>&nbsp;<span class="ident" id="6950204">err</span>&nbsp;<span class="op" id="6950208">:=</span>&nbsp;<span class="ident" id="6950211">DecodeConfig</span><span class="op" id="6950223">(</span><span class="ident" id="6950224">strings</span><span class="op" id="6950231">.</span><span class="ident" id="6950232">NewReader</span><span class="op" id="6950241">(</span><span class="ident" id="6950242">s</span><span class="op" id="6950243">)</span><span class="op" id="6950244">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6950247">if</span>&nbsp;<span class="ident" id="6950250">err</span>&nbsp;<span class="op" id="6950254">!=</span>&nbsp;<span class="ident" id="6950257">nil</span>&nbsp;<span class="op" id="6950261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950265">b</span><span class="op" id="6950266">.</span><span class="ident" id="6950267">Fatal</span><span class="op" id="6950272">(</span><span class="ident" id="6950273">err</span><span class="op" id="6950276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950279">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950282">b</span><span class="op" id="6950283">.</span><span class="ident" id="6950284">SetBytes</span><span class="op" id="6950292">(</span><span class="ident" id="6950293">int64</span><span class="op" id="6950298">(</span><span class="ident" id="6950299">cfg</span><span class="op" id="6950302">.</span><span class="ident" id="6950303">Width</span>&nbsp;<span class="op" id="6950309">*</span>&nbsp;<span class="ident" id="6950311">cfg</span><span class="op" id="6950314">.</span><span class="ident" id="6950315">Height</span>&nbsp;<span class="op" id="6950322">*</span>&nbsp;<span class="ident" id="6950324">bytesPerPixel</span><span class="op" id="6950337">)</span><span class="op" id="6950338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950341">b</span><span class="op" id="6950342">.</span><span class="ident" id="6950343">StartTimer</span><span class="op" id="6950353">(</span><span class="op" id="6950354">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6950357">for</span>&nbsp;<span class="ident" id="6950361">i</span>&nbsp;<span class="op" id="6950363">:=</span>&nbsp;<span class="num" id="6950366">0</span><span class="op" id="6950367">;</span>&nbsp;<span class="ident" id="6950369">i</span>&nbsp;<span class="op" id="6950371">&lt;</span>&nbsp;<span class="ident" id="6950373">b</span><span class="op" id="6950374">.</span><span class="ident" id="6950375">N</span><span class="op" id="6950376">;</span>&nbsp;<span class="ident" id="6950378">i</span><span class="op" id="6950379">++</span>&nbsp;<span class="op" id="6950382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950386">Decode</span><span class="op" id="6950392">(</span><span class="ident" id="6950393">strings</span><span class="op" id="6950400">.</span><span class="ident" id="6950401">NewReader</span><span class="op" id="6950410">(</span><span class="ident" id="6950411">s</span><span class="op" id="6950412">)</span><span class="op" id="6950413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950416">}</span><br>
<span class="lineno"></span><span class="op" id="6950418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6950421">func</span>&nbsp;<span class="ident" id="6950426">BenchmarkDecodeGray</span><span class="op" id="6950445">(</span><span class="ident" id="6950446">b</span>&nbsp;<span class="op" id="6950448">*</span><span class="ident" id="6950449">testing</span><span class="op" id="6950456">.</span><span class="ident" id="6950457">B</span><span class="op" id="6950458">)</span>&nbsp;<span class="op" id="6950460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950463">benchmarkDecode</span><span class="op" id="6950478">(</span><span class="ident" id="6950479">b</span><span class="op" id="6950480">,</span>&nbsp;<span class="string" id="6950482">&#34;testdata/benchGray.png&#34;</span><span class="op" id="6950506">,</span>&nbsp;<span class="num" id="6950508">1</span><span class="op" id="6950509">)</span><br>
<span class="lineno"></span><span class="op" id="6950511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6950514">func</span>&nbsp;<span class="ident" id="6950519">BenchmarkDecodeNRGBAGradient</span><span class="op" id="6950547">(</span><span class="ident" id="6950548">b</span>&nbsp;<span class="op" id="6950550">*</span><span class="ident" id="6950551">testing</span><span class="op" id="6950558">.</span><span class="ident" id="6950559">B</span><span class="op" id="6950560">)</span>&nbsp;<span class="op" id="6950562">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950565">benchmarkDecode</span><span class="op" id="6950580">(</span><span class="ident" id="6950581">b</span><span class="op" id="6950582">,</span>&nbsp;<span class="string" id="6950584">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="6950618">,</span>&nbsp;<span class="num" id="6950620">4</span><span class="op" id="6950621">)</span><br>
<span class="lineno"></span><span class="op" id="6950623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6950626">func</span>&nbsp;<span class="ident" id="6950631">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="6950657">(</span><span class="ident" id="6950658">b</span>&nbsp;<span class="op" id="6950660">*</span><span class="ident" id="6950661">testing</span><span class="op" id="6950668">.</span><span class="ident" id="6950669">B</span><span class="op" id="6950670">)</span>&nbsp;<span class="op" id="6950672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950675">benchmarkDecode</span><span class="op" id="6950690">(</span><span class="ident" id="6950691">b</span><span class="op" id="6950692">,</span>&nbsp;<span class="string" id="6950694">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="6950726">,</span>&nbsp;<span class="num" id="6950728">4</span><span class="op" id="6950729">)</span><br>
<span class="lineno">350</span><span class="op" id="6950731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6950734">func</span>&nbsp;<span class="ident" id="6950739">BenchmarkDecodePaletted</span><span class="op" id="6950762">(</span><span class="ident" id="6950763">b</span>&nbsp;<span class="op" id="6950765">*</span><span class="ident" id="6950766">testing</span><span class="op" id="6950773">.</span><span class="ident" id="6950774">B</span><span class="op" id="6950775">)</span>&nbsp;<span class="op" id="6950777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950780">benchmarkDecode</span><span class="op" id="6950795">(</span><span class="ident" id="6950796">b</span><span class="op" id="6950797">,</span>&nbsp;<span class="string" id="6950799">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="6950827">,</span>&nbsp;<span class="num" id="6950829">1</span><span class="op" id="6950830">)</span><br>
<span class="lineno"></span><span class="op" id="6950832">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6950835">func</span>&nbsp;<span class="ident" id="6950840">BenchmarkDecodeRGB</span><span class="op" id="6950858">(</span><span class="ident" id="6950859">b</span>&nbsp;<span class="op" id="6950861">*</span><span class="ident" id="6950862">testing</span><span class="op" id="6950869">.</span><span class="ident" id="6950870">B</span><span class="op" id="6950871">)</span>&nbsp;<span class="op" id="6950873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950876">benchmarkDecode</span><span class="op" id="6950891">(</span><span class="ident" id="6950892">b</span><span class="op" id="6950893">,</span>&nbsp;<span class="string" id="6950895">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="6950918">,</span>&nbsp;<span class="num" id="6950920">4</span><span class="op" id="6950921">)</span><br>
<span class="lineno"></span><span class="op" id="6950923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="6950926">func</span>&nbsp;<span class="ident" id="6950931">BenchmarkDecodeInterlacing</span><span class="op" id="6950957">(</span><span class="ident" id="6950958">b</span>&nbsp;<span class="op" id="6950960">*</span><span class="ident" id="6950961">testing</span><span class="op" id="6950968">.</span><span class="ident" id="6950969">B</span><span class="op" id="6950970">)</span>&nbsp;<span class="op" id="6950972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950975">benchmarkDecode</span><span class="op" id="6950990">(</span><span class="ident" id="6950991">b</span><span class="op" id="6950992">,</span>&nbsp;<span class="string" id="6950994">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="6951027">,</span>&nbsp;<span class="num" id="6951029">4</span><span class="op" id="6951030">)</span><br>
<span class="lineno"></span><span class="op" id="6951032">}</span>
</div>
</body>
</html>
