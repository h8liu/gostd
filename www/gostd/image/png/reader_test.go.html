<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6930053">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6930108">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6930162">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6930213">package</span>&nbsp;<span class="ident" id="6930221">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930226">import</span>&nbsp;<span class="op" id="6930233">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930236">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930245">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930252">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930261">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930276">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930282">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930295">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930301">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930312">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6930322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930325">var</span>&nbsp;<span class="ident" id="6930329">filenames</span>&nbsp;<span class="op" id="6930339">=</span>&nbsp;<span class="op" id="6930341">[</span><span class="op" id="6930342">]</span><span class="builtintype" id="6930343">string</span><span class="op" id="6930349">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930352">&#34;basn0g01&#34;</span><span class="op" id="6930362">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930365">&#34;basn0g01-30&#34;</span><span class="op" id="6930378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930381">&#34;basn0g02&#34;</span><span class="op" id="6930391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930394">&#34;basn0g02-29&#34;</span><span class="op" id="6930407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930410">&#34;basn0g04&#34;</span><span class="op" id="6930420">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930423">&#34;basn0g04-31&#34;</span><span class="op" id="6930436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930439">&#34;basn0g08&#34;</span><span class="op" id="6930449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930452">&#34;basn0g16&#34;</span><span class="op" id="6930462">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930465">&#34;basn2c08&#34;</span><span class="op" id="6930475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930478">&#34;basn2c16&#34;</span><span class="op" id="6930488">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930491">&#34;basn3p01&#34;</span><span class="op" id="6930501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930504">&#34;basn3p02&#34;</span><span class="op" id="6930514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930517">&#34;basn3p04&#34;</span><span class="op" id="6930527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930530">&#34;basn3p04-31i&#34;</span><span class="op" id="6930544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930547">&#34;basn3p08&#34;</span><span class="op" id="6930557">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930560">&#34;basn3p08-trns&#34;</span><span class="op" id="6930575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930578">&#34;basn4a08&#34;</span><span class="op" id="6930588">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930591">&#34;basn4a16&#34;</span><span class="op" id="6930601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930604">&#34;basn6a08&#34;</span><span class="op" id="6930614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930617">&#34;basn6a16&#34;</span><span class="op" id="6930627">,</span><br>
<span class="lineno">40</span><span class="op" id="6930629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930632">var</span>&nbsp;<span class="ident" id="6930636">filenamesPaletted</span>&nbsp;<span class="op" id="6930654">=</span>&nbsp;<span class="op" id="6930656">[</span><span class="op" id="6930657">]</span><span class="builtintype" id="6930658">string</span><span class="op" id="6930664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930667">&#34;basn3p01&#34;</span><span class="op" id="6930677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930680">&#34;basn3p02&#34;</span><span class="op" id="6930690">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930693">&#34;basn3p04&#34;</span><span class="op" id="6930703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930706">&#34;basn3p08&#34;</span><span class="op" id="6930716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930719">&#34;basn3p08-trns&#34;</span><span class="op" id="6930734">,</span><br>
<span class="lineno"></span><span class="op" id="6930736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="6930739">var</span>&nbsp;<span class="ident" id="6930743">filenamesShort</span>&nbsp;<span class="op" id="6930758">=</span>&nbsp;<span class="op" id="6930760">[</span><span class="op" id="6930761">]</span><span class="builtintype" id="6930762">string</span><span class="op" id="6930768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930771">&#34;basn0g01&#34;</span><span class="op" id="6930781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930784">&#34;basn0g04-31&#34;</span><span class="op" id="6930797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6930800">&#34;basn6a16&#34;</span><span class="op" id="6930810">,</span><br>
<span class="lineno"></span><span class="op" id="6930812">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6930815">func</span>&nbsp;<span class="ident" id="6930820">readPNG</span><span class="op" id="6930827">(</span><span class="ident" id="6930828">filename</span>&nbsp;<span class="builtintype" id="6930837">string</span><span class="op" id="6930843">)</span>&nbsp;<span class="op" id="6930845">(</span><span class="ident" id="6930846">image</span><span class="op" id="6930851">.</span><span class="ident" id="6930852">Image</span><span class="op" id="6930857">,</span>&nbsp;<span class="builtintype" id="6930859">error</span><span class="op" id="6930864">)</span>&nbsp;<span class="op" id="6930866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6930869">f</span><span class="op" id="6930870">,</span>&nbsp;<span class="ident" id="6930872">err</span>&nbsp;<span class="op" id="6930876">:=</span>&nbsp;<span class="ident" id="6930879">os</span><span class="op" id="6930881">.</span><span class="ident" id="6930882">Open</span><span class="op" id="6930886">(</span><span class="ident" id="6930887">filename</span><span class="op" id="6930895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930898">if</span>&nbsp;<span class="ident" id="6930901">err</span>&nbsp;<span class="op" id="6930905">!=</span>&nbsp;<span class="builtintype" id="6930908">nil</span>&nbsp;<span class="op" id="6930912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930916">return</span>&nbsp;<span class="builtintype" id="6930923">nil</span><span class="op" id="6930926">,</span>&nbsp;<span class="ident" id="6930928">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6930933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930936">defer</span>&nbsp;<span class="ident" id="6930942">f</span><span class="op" id="6930943">.</span><span class="ident" id="6930944">Close</span><span class="op" id="6930949">(</span><span class="op" id="6930950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6930953">return</span>&nbsp;<span class="ident" id="6930960">Decode</span><span class="op" id="6930966">(</span><span class="ident" id="6930967">f</span><span class="op" id="6930968">)</span><br>
<span class="lineno"></span><span class="op" id="6930970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6930973">//&nbsp;An&nbsp;approximation&nbsp;of&nbsp;the&nbsp;sng&nbsp;command-line&nbsp;tool.</span><br>
<span class="lineno"></span><span class="keyword" id="6931023">func</span>&nbsp;<span class="ident" id="6931028">sng</span><span class="op" id="6931031">(</span><span class="ident" id="6931032">w</span>&nbsp;<span class="ident" id="6931034">io</span><span class="op" id="6931036">.</span><span class="ident" id="6931037">WriteCloser</span><span class="op" id="6931048">,</span>&nbsp;<span class="ident" id="6931050">filename</span>&nbsp;<span class="builtintype" id="6931059">string</span><span class="op" id="6931065">,</span>&nbsp;<span class="ident" id="6931067">png</span>&nbsp;<span class="ident" id="6931071">image</span><span class="op" id="6931076">.</span><span class="ident" id="6931077">Image</span><span class="op" id="6931082">)</span>&nbsp;<span class="op" id="6931084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931087">defer</span>&nbsp;<span class="ident" id="6931093">w</span><span class="op" id="6931094">.</span><span class="ident" id="6931095">Close</span><span class="op" id="6931100">(</span><span class="op" id="6931101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931104">bounds</span>&nbsp;<span class="op" id="6931111">:=</span>&nbsp;<span class="ident" id="6931114">png</span><span class="op" id="6931117">.</span><span class="ident" id="6931118">Bounds</span><span class="op" id="6931124">(</span><span class="op" id="6931125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931128">cm</span>&nbsp;<span class="op" id="6931131">:=</span>&nbsp;<span class="ident" id="6931134">png</span><span class="op" id="6931137">.</span><span class="ident" id="6931138">ColorModel</span><span class="op" id="6931148">(</span><span class="op" id="6931149">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931152">var</span>&nbsp;<span class="ident" id="6931156">bitdepth</span>&nbsp;<span class="builtintype" id="6931165">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931170">switch</span>&nbsp;<span class="ident" id="6931177">cm</span>&nbsp;<span class="op" id="6931180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931183">case</span>&nbsp;<span class="ident" id="6931188">color</span><span class="op" id="6931193">.</span><span class="ident" id="6931194">RGBAModel</span><span class="op" id="6931203">,</span>&nbsp;<span class="ident" id="6931205">color</span><span class="op" id="6931210">.</span><span class="ident" id="6931211">NRGBAModel</span><span class="op" id="6931221">,</span>&nbsp;<span class="ident" id="6931223">color</span><span class="op" id="6931228">.</span><span class="ident" id="6931229">AlphaModel</span><span class="op" id="6931239">,</span>&nbsp;<span class="ident" id="6931241">color</span><span class="op" id="6931246">.</span><span class="ident" id="6931247">GrayModel</span><span class="op" id="6931256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931260">bitdepth</span>&nbsp;<span class="op" id="6931269">=</span>&nbsp;<span class="num" id="6931271">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931274">default</span><span class="op" id="6931281">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931285">bitdepth</span>&nbsp;<span class="op" id="6931294">=</span>&nbsp;<span class="num" id="6931296">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931303">cpm</span><span class="op" id="6931306">,</span>&nbsp;<span class="ident" id="6931308">_</span>&nbsp;<span class="op" id="6931310">:=</span>&nbsp;<span class="ident" id="6931313">cm</span><span class="op" id="6931315">.</span><span class="op" id="6931316">(</span><span class="ident" id="6931317">color</span><span class="op" id="6931322">.</span><span class="ident" id="6931323">Palette</span><span class="op" id="6931330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931333">var</span>&nbsp;<span class="ident" id="6931337">paletted</span>&nbsp;<span class="op" id="6931346">*</span><span class="ident" id="6931347">image</span><span class="op" id="6931352">.</span><span class="ident" id="6931353">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931363">if</span>&nbsp;<span class="ident" id="6931366">cpm</span>&nbsp;<span class="op" id="6931370">!=</span>&nbsp;<span class="builtintype" id="6931373">nil</span>&nbsp;<span class="op" id="6931377">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931381">switch</span>&nbsp;<span class="op" id="6931388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931392">case</span>&nbsp;<span class="builtinfunc" id="6931397">len</span><span class="op" id="6931400">(</span><span class="ident" id="6931401">cpm</span><span class="op" id="6931404">)</span>&nbsp;<span class="op" id="6931406">&lt;=</span>&nbsp;<span class="num" id="6931409">2</span><span class="op" id="6931410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931415">bitdepth</span>&nbsp;<span class="op" id="6931424">=</span>&nbsp;<span class="num" id="6931426">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931430">case</span>&nbsp;<span class="builtinfunc" id="6931435">len</span><span class="op" id="6931438">(</span><span class="ident" id="6931439">cpm</span><span class="op" id="6931442">)</span>&nbsp;<span class="op" id="6931444">&lt;=</span>&nbsp;<span class="num" id="6931447">4</span><span class="op" id="6931448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931453">bitdepth</span>&nbsp;<span class="op" id="6931462">=</span>&nbsp;<span class="num" id="6931464">2</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931468">case</span>&nbsp;<span class="builtinfunc" id="6931473">len</span><span class="op" id="6931476">(</span><span class="ident" id="6931477">cpm</span><span class="op" id="6931480">)</span>&nbsp;<span class="op" id="6931482">&lt;=</span>&nbsp;<span class="num" id="6931485">16</span><span class="op" id="6931487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931492">bitdepth</span>&nbsp;<span class="op" id="6931501">=</span>&nbsp;<span class="num" id="6931503">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931507">default</span><span class="op" id="6931514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931519">bitdepth</span>&nbsp;<span class="op" id="6931528">=</span>&nbsp;<span class="num" id="6931530">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931534">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931538">paletted</span>&nbsp;<span class="op" id="6931547">=</span>&nbsp;<span class="ident" id="6931549">png</span><span class="op" id="6931552">.</span><span class="op" id="6931553">(</span><span class="op" id="6931554">*</span><span class="ident" id="6931555">image</span><span class="op" id="6931560">.</span><span class="ident" id="6931561">Paletted</span><span class="op" id="6931569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6931572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6931576">//&nbsp;Write&nbsp;the&nbsp;filename&nbsp;and&nbsp;IHDR.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931609">io</span><span class="op" id="6931611">.</span><span class="ident" id="6931612">WriteString</span><span class="op" id="6931623">(</span><span class="ident" id="6931624">w</span><span class="op" id="6931625">,</span>&nbsp;<span class="string" id="6931627">&#34;#SNG:&nbsp;from&nbsp;&#34;</span><span class="op" id="6931640">+</span><span class="ident" id="6931641">filename</span><span class="op" id="6931649">+</span><span class="string" id="6931650">&#34;.png\nIHDR&nbsp;{\n&#34;</span><span class="op" id="6931666">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931669">fmt</span><span class="op" id="6931672">.</span><span class="ident" id="6931673">Fprintf</span><span class="op" id="6931680">(</span><span class="ident" id="6931681">w</span><span class="op" id="6931682">,</span>&nbsp;<span class="string" id="6931684">&#34;&nbsp;&nbsp;&nbsp;&nbsp;width:&nbsp;%d;&nbsp;height:&nbsp;%d;&nbsp;bitdepth:&nbsp;%d;\n&#34;</span><span class="op" id="6931728">,</span>&nbsp;<span class="ident" id="6931730">bounds</span><span class="op" id="6931736">.</span><span class="ident" id="6931737">Dx</span><span class="op" id="6931739">(</span><span class="op" id="6931740">)</span><span class="op" id="6931741">,</span>&nbsp;<span class="ident" id="6931743">bounds</span><span class="op" id="6931749">.</span><span class="ident" id="6931750">Dy</span><span class="op" id="6931752">(</span><span class="op" id="6931753">)</span><span class="op" id="6931754">,</span>&nbsp;<span class="ident" id="6931756">bitdepth</span><span class="op" id="6931764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931767">switch</span>&nbsp;<span class="op" id="6931774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931777">case</span>&nbsp;<span class="ident" id="6931782">cm</span>&nbsp;<span class="op" id="6931785">==</span>&nbsp;<span class="ident" id="6931788">color</span><span class="op" id="6931793">.</span><span class="ident" id="6931794">RGBAModel</span><span class="op" id="6931803">,</span>&nbsp;<span class="ident" id="6931805">cm</span>&nbsp;<span class="op" id="6931808">==</span>&nbsp;<span class="ident" id="6931811">color</span><span class="op" id="6931816">.</span><span class="ident" id="6931817">RGBA64Model</span><span class="op" id="6931828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931832">io</span><span class="op" id="6931834">.</span><span class="ident" id="6931835">WriteString</span><span class="op" id="6931846">(</span><span class="ident" id="6931847">w</span><span class="op" id="6931848">,</span>&nbsp;<span class="string" id="6931850">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color;\n&#34;</span><span class="op" id="6931870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931873">case</span>&nbsp;<span class="ident" id="6931878">cm</span>&nbsp;<span class="op" id="6931881">==</span>&nbsp;<span class="ident" id="6931884">color</span><span class="op" id="6931889">.</span><span class="ident" id="6931890">NRGBAModel</span><span class="op" id="6931900">,</span>&nbsp;<span class="ident" id="6931902">cm</span>&nbsp;<span class="op" id="6931905">==</span>&nbsp;<span class="ident" id="6931908">color</span><span class="op" id="6931913">.</span><span class="ident" id="6931914">NRGBA64Model</span><span class="op" id="6931926">:</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6931930">io</span><span class="op" id="6931932">.</span><span class="ident" id="6931933">WriteString</span><span class="op" id="6931944">(</span><span class="ident" id="6931945">w</span><span class="op" id="6931946">,</span>&nbsp;<span class="string" id="6931948">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;alpha;\n&#34;</span><span class="op" id="6931974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6931977">case</span>&nbsp;<span class="ident" id="6931982">cm</span>&nbsp;<span class="op" id="6931985">==</span>&nbsp;<span class="ident" id="6931988">color</span><span class="op" id="6931993">.</span><span class="ident" id="6931994">GrayModel</span><span class="op" id="6932003">,</span>&nbsp;<span class="ident" id="6932005">cm</span>&nbsp;<span class="op" id="6932008">==</span>&nbsp;<span class="ident" id="6932011">color</span><span class="op" id="6932016">.</span><span class="ident" id="6932017">Gray16Model</span><span class="op" id="6932028">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932032">io</span><span class="op" id="6932034">.</span><span class="ident" id="6932035">WriteString</span><span class="op" id="6932046">(</span><span class="ident" id="6932047">w</span><span class="op" id="6932048">,</span>&nbsp;<span class="string" id="6932050">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;grayscale;\n&#34;</span><span class="op" id="6932074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932077">case</span>&nbsp;<span class="ident" id="6932082">cpm</span>&nbsp;<span class="op" id="6932086">!=</span>&nbsp;<span class="builtintype" id="6932089">nil</span><span class="op" id="6932092">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932096">io</span><span class="op" id="6932098">.</span><span class="ident" id="6932099">WriteString</span><span class="op" id="6932110">(</span><span class="ident" id="6932111">w</span><span class="op" id="6932112">,</span>&nbsp;<span class="string" id="6932114">&#34;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;color&nbsp;palette;\n&#34;</span><span class="op" id="6932142">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932145">default</span><span class="op" id="6932152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932156">io</span><span class="op" id="6932158">.</span><span class="ident" id="6932159">WriteString</span><span class="op" id="6932170">(</span><span class="ident" id="6932171">w</span><span class="op" id="6932172">,</span>&nbsp;<span class="string" id="6932174">&#34;unknown&nbsp;PNG&nbsp;decoder&nbsp;color&nbsp;model\n&#34;</span><span class="op" id="6932209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932215">io</span><span class="op" id="6932217">.</span><span class="ident" id="6932218">WriteString</span><span class="op" id="6932229">(</span><span class="ident" id="6932230">w</span><span class="op" id="6932231">,</span>&nbsp;<span class="string" id="6932233">&#34;}\n&#34;</span><span class="op" id="6932238">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6932242">//&nbsp;We&nbsp;fake&nbsp;a&nbsp;gAMA&nbsp;output.&nbsp;The&nbsp;test&nbsp;files&nbsp;have&nbsp;a&nbsp;gAMA&nbsp;chunk&nbsp;but&nbsp;the&nbsp;go&nbsp;PNG&nbsp;parser&nbsp;ignores&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6932335">//&nbsp;(the&nbsp;PNG&nbsp;spec&nbsp;section&nbsp;11.3&nbsp;says&nbsp;&#34;Ancillary&nbsp;chunks&nbsp;may&nbsp;be&nbsp;ignored&nbsp;by&nbsp;a&nbsp;decoder&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932420">io</span><span class="op" id="6932422">.</span><span class="ident" id="6932423">WriteString</span><span class="op" id="6932434">(</span><span class="ident" id="6932435">w</span><span class="op" id="6932436">,</span>&nbsp;<span class="string" id="6932438">&#34;gAMA&nbsp;{1.0000}\n&#34;</span><span class="op" id="6932455">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6932459">//&nbsp;Write&nbsp;the&nbsp;PLTE&nbsp;and&nbsp;tRNS&nbsp;(if&nbsp;applicable).</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932504">if</span>&nbsp;<span class="ident" id="6932507">cpm</span>&nbsp;<span class="op" id="6932511">!=</span>&nbsp;<span class="builtintype" id="6932514">nil</span>&nbsp;<span class="op" id="6932518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932522">lastAlpha</span>&nbsp;<span class="op" id="6932532">:=</span>&nbsp;<span class="op" id="6932535">-</span><span class="num" id="6932536">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932540">io</span><span class="op" id="6932542">.</span><span class="ident" id="6932543">WriteString</span><span class="op" id="6932554">(</span><span class="ident" id="6932555">w</span><span class="op" id="6932556">,</span>&nbsp;<span class="string" id="6932558">&#34;PLTE&nbsp;{\n&#34;</span><span class="op" id="6932568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932572">for</span>&nbsp;<span class="ident" id="6932576">i</span><span class="op" id="6932577">,</span>&nbsp;<span class="ident" id="6932579">c</span>&nbsp;<span class="op" id="6932581">:=</span>&nbsp;<span class="keyword" id="6932584">range</span>&nbsp;<span class="ident" id="6932590">cpm</span>&nbsp;<span class="op" id="6932594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932599">var</span>&nbsp;<span class="ident" id="6932603">r</span><span class="op" id="6932604">,</span>&nbsp;<span class="ident" id="6932606">g</span><span class="op" id="6932607">,</span>&nbsp;<span class="ident" id="6932609">b</span><span class="op" id="6932610">,</span>&nbsp;<span class="ident" id="6932612">a</span>&nbsp;<span class="builtintype" id="6932614">uint8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932623">switch</span>&nbsp;<span class="ident" id="6932630">c</span>&nbsp;<span class="op" id="6932632">:=</span>&nbsp;<span class="ident" id="6932635">c</span><span class="op" id="6932636">.</span><span class="op" id="6932637">(</span><span class="keyword" id="6932638">type</span><span class="op" id="6932642">)</span>&nbsp;<span class="op" id="6932644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932649">case</span>&nbsp;<span class="ident" id="6932654">color</span><span class="op" id="6932659">.</span><span class="ident" id="6932660">RGBA</span><span class="op" id="6932664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932670">r</span><span class="op" id="6932671">,</span>&nbsp;<span class="ident" id="6932673">g</span><span class="op" id="6932674">,</span>&nbsp;<span class="ident" id="6932676">b</span><span class="op" id="6932677">,</span>&nbsp;<span class="ident" id="6932679">a</span>&nbsp;<span class="op" id="6932681">=</span>&nbsp;<span class="ident" id="6932683">c</span><span class="op" id="6932684">.</span><span class="ident" id="6932685">R</span><span class="op" id="6932686">,</span>&nbsp;<span class="ident" id="6932688">c</span><span class="op" id="6932689">.</span><span class="ident" id="6932690">G</span><span class="op" id="6932691">,</span>&nbsp;<span class="ident" id="6932693">c</span><span class="op" id="6932694">.</span><span class="ident" id="6932695">B</span><span class="op" id="6932696">,</span>&nbsp;<span class="num" id="6932698">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932706">case</span>&nbsp;<span class="ident" id="6932711">color</span><span class="op" id="6932716">.</span><span class="ident" id="6932717">NRGBA</span><span class="op" id="6932722">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932728">r</span><span class="op" id="6932729">,</span>&nbsp;<span class="ident" id="6932731">g</span><span class="op" id="6932732">,</span>&nbsp;<span class="ident" id="6932734">b</span><span class="op" id="6932735">,</span>&nbsp;<span class="ident" id="6932737">a</span>&nbsp;<span class="op" id="6932739">=</span>&nbsp;<span class="ident" id="6932741">c</span><span class="op" id="6932742">.</span><span class="ident" id="6932743">R</span><span class="op" id="6932744">,</span>&nbsp;<span class="ident" id="6932746">c</span><span class="op" id="6932747">.</span><span class="ident" id="6932748">G</span><span class="op" id="6932749">,</span>&nbsp;<span class="ident" id="6932751">c</span><span class="op" id="6932752">.</span><span class="ident" id="6932753">B</span><span class="op" id="6932754">,</span>&nbsp;<span class="ident" id="6932756">c</span><span class="op" id="6932757">.</span><span class="ident" id="6932758">A</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932763">default</span><span class="op" id="6932770">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6932776">panic</span><span class="op" id="6932781">(</span><span class="string" id="6932782">&#34;unknown&nbsp;palette&nbsp;color&nbsp;type&#34;</span><span class="op" id="6932810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932820">if</span>&nbsp;<span class="ident" id="6932823">a</span>&nbsp;<span class="op" id="6932825">!=</span>&nbsp;<span class="num" id="6932828">0xff</span>&nbsp;<span class="op" id="6932833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932839">lastAlpha</span>&nbsp;<span class="op" id="6932849">=</span>&nbsp;<span class="ident" id="6932851">i</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932861">fmt</span><span class="op" id="6932864">.</span><span class="ident" id="6932865">Fprintf</span><span class="op" id="6932872">(</span><span class="ident" id="6932873">w</span><span class="op" id="6932874">,</span>&nbsp;<span class="string" id="6932876">&#34;&nbsp;&nbsp;&nbsp;&nbsp;(%3d,%3d,%3d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;rgb&nbsp;=&nbsp;(0x%02x,0x%02x,0x%02x)\n&#34;</span><span class="op" id="6932932">,</span>&nbsp;<span class="ident" id="6932934">r</span><span class="op" id="6932935">,</span>&nbsp;<span class="ident" id="6932937">g</span><span class="op" id="6932938">,</span>&nbsp;<span class="ident" id="6932940">b</span><span class="op" id="6932941">,</span>&nbsp;<span class="ident" id="6932943">r</span><span class="op" id="6932944">,</span>&nbsp;<span class="ident" id="6932946">g</span><span class="op" id="6932947">,</span>&nbsp;<span class="ident" id="6932949">b</span><span class="op" id="6932950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6932954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6932958">io</span><span class="op" id="6932960">.</span><span class="ident" id="6932961">WriteString</span><span class="op" id="6932972">(</span><span class="ident" id="6932973">w</span><span class="op" id="6932974">,</span>&nbsp;<span class="string" id="6932976">&#34;}\n&#34;</span><span class="op" id="6932981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6932985">if</span>&nbsp;<span class="ident" id="6932988">lastAlpha</span>&nbsp;<span class="op" id="6932998">!=</span>&nbsp;<span class="op" id="6933001">-</span><span class="num" id="6933002">1</span>&nbsp;<span class="op" id="6933004">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933009">io</span><span class="op" id="6933011">.</span><span class="ident" id="6933012">WriteString</span><span class="op" id="6933023">(</span><span class="ident" id="6933024">w</span><span class="op" id="6933025">,</span>&nbsp;<span class="string" id="6933027">&#34;tRNS&nbsp;{\n&#34;</span><span class="op" id="6933037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933042">for</span>&nbsp;<span class="ident" id="6933046">i</span>&nbsp;<span class="op" id="6933048">:=</span>&nbsp;<span class="num" id="6933051">0</span><span class="op" id="6933052">;</span>&nbsp;<span class="ident" id="6933054">i</span>&nbsp;<span class="op" id="6933056">&lt;=</span>&nbsp;<span class="ident" id="6933059">lastAlpha</span><span class="op" id="6933068">;</span>&nbsp;<span class="ident" id="6933070">i</span><span class="op" id="6933071">++</span>&nbsp;<span class="op" id="6933074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933080">_</span><span class="op" id="6933081">,</span>&nbsp;<span class="ident" id="6933083">_</span><span class="op" id="6933084">,</span>&nbsp;<span class="ident" id="6933086">_</span><span class="op" id="6933087">,</span>&nbsp;<span class="ident" id="6933089">a</span>&nbsp;<span class="op" id="6933091">:=</span>&nbsp;<span class="ident" id="6933094">cpm</span><span class="op" id="6933097">[</span><span class="ident" id="6933098">i</span><span class="op" id="6933099">]</span><span class="op" id="6933100">.</span><span class="ident" id="6933101">RGBA</span><span class="op" id="6933105">(</span><span class="op" id="6933106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933112">a</span>&nbsp;<span class="op" id="6933114">&gt;&gt;=</span>&nbsp;<span class="num" id="6933118">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933124">fmt</span><span class="op" id="6933127">.</span><span class="ident" id="6933128">Fprintf</span><span class="op" id="6933135">(</span><span class="ident" id="6933136">w</span><span class="op" id="6933137">,</span>&nbsp;<span class="string" id="6933139">&#34;&nbsp;%d&#34;</span><span class="op" id="6933144">,</span>&nbsp;<span class="ident" id="6933146">a</span><span class="op" id="6933147">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933157">io</span><span class="op" id="6933159">.</span><span class="ident" id="6933160">WriteString</span><span class="op" id="6933171">(</span><span class="ident" id="6933172">w</span><span class="op" id="6933173">,</span>&nbsp;<span class="string" id="6933175">&#34;}\n&#34;</span><span class="op" id="6933180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6933191">//&nbsp;Write&nbsp;the&nbsp;IMAGE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933212">io</span><span class="op" id="6933214">.</span><span class="ident" id="6933215">WriteString</span><span class="op" id="6933226">(</span><span class="ident" id="6933227">w</span><span class="op" id="6933228">,</span>&nbsp;<span class="string" id="6933230">&#34;IMAGE&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;pixels&nbsp;hex\n&#34;</span><span class="op" id="6933257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933260">for</span>&nbsp;<span class="ident" id="6933264">y</span>&nbsp;<span class="op" id="6933266">:=</span>&nbsp;<span class="ident" id="6933269">bounds</span><span class="op" id="6933275">.</span><span class="ident" id="6933276">Min</span><span class="op" id="6933279">.</span><span class="ident" id="6933280">Y</span><span class="op" id="6933281">;</span>&nbsp;<span class="ident" id="6933283">y</span>&nbsp;<span class="op" id="6933285">&lt;</span>&nbsp;<span class="ident" id="6933287">bounds</span><span class="op" id="6933293">.</span><span class="ident" id="6933294">Max</span><span class="op" id="6933297">.</span><span class="ident" id="6933298">Y</span><span class="op" id="6933299">;</span>&nbsp;<span class="ident" id="6933301">y</span><span class="op" id="6933302">++</span>&nbsp;<span class="op" id="6933305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933309">switch</span>&nbsp;<span class="op" id="6933316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933320">case</span>&nbsp;<span class="ident" id="6933325">cm</span>&nbsp;<span class="op" id="6933328">==</span>&nbsp;<span class="ident" id="6933331">color</span><span class="op" id="6933336">.</span><span class="ident" id="6933337">GrayModel</span><span class="op" id="6933346">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933351">for</span>&nbsp;<span class="ident" id="6933355">x</span>&nbsp;<span class="op" id="6933357">:=</span>&nbsp;<span class="ident" id="6933360">bounds</span><span class="op" id="6933366">.</span><span class="ident" id="6933367">Min</span><span class="op" id="6933370">.</span><span class="ident" id="6933371">X</span><span class="op" id="6933372">;</span>&nbsp;<span class="ident" id="6933374">x</span>&nbsp;<span class="op" id="6933376">&lt;</span>&nbsp;<span class="ident" id="6933378">bounds</span><span class="op" id="6933384">.</span><span class="ident" id="6933385">Max</span><span class="op" id="6933388">.</span><span class="ident" id="6933389">X</span><span class="op" id="6933390">;</span>&nbsp;<span class="ident" id="6933392">x</span><span class="op" id="6933393">++</span>&nbsp;<span class="op" id="6933396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933402">gray</span>&nbsp;<span class="op" id="6933407">:=</span>&nbsp;<span class="ident" id="6933410">png</span><span class="op" id="6933413">.</span><span class="ident" id="6933414">At</span><span class="op" id="6933416">(</span><span class="ident" id="6933417">x</span><span class="op" id="6933418">,</span>&nbsp;<span class="ident" id="6933420">y</span><span class="op" id="6933421">)</span><span class="op" id="6933422">.</span><span class="op" id="6933423">(</span><span class="ident" id="6933424">color</span><span class="op" id="6933429">.</span><span class="ident" id="6933430">Gray</span><span class="op" id="6933434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933440">fmt</span><span class="op" id="6933443">.</span><span class="ident" id="6933444">Fprintf</span><span class="op" id="6933451">(</span><span class="ident" id="6933452">w</span><span class="op" id="6933453">,</span>&nbsp;<span class="string" id="6933455">&#34;%02x&#34;</span><span class="op" id="6933461">,</span>&nbsp;<span class="ident" id="6933463">gray</span><span class="op" id="6933467">.</span><span class="ident" id="6933468">Y</span><span class="op" id="6933469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933478">case</span>&nbsp;<span class="ident" id="6933483">cm</span>&nbsp;<span class="op" id="6933486">==</span>&nbsp;<span class="ident" id="6933489">color</span><span class="op" id="6933494">.</span><span class="ident" id="6933495">Gray16Model</span><span class="op" id="6933506">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933511">for</span>&nbsp;<span class="ident" id="6933515">x</span>&nbsp;<span class="op" id="6933517">:=</span>&nbsp;<span class="ident" id="6933520">bounds</span><span class="op" id="6933526">.</span><span class="ident" id="6933527">Min</span><span class="op" id="6933530">.</span><span class="ident" id="6933531">X</span><span class="op" id="6933532">;</span>&nbsp;<span class="ident" id="6933534">x</span>&nbsp;<span class="op" id="6933536">&lt;</span>&nbsp;<span class="ident" id="6933538">bounds</span><span class="op" id="6933544">.</span><span class="ident" id="6933545">Max</span><span class="op" id="6933548">.</span><span class="ident" id="6933549">X</span><span class="op" id="6933550">;</span>&nbsp;<span class="ident" id="6933552">x</span><span class="op" id="6933553">++</span>&nbsp;<span class="op" id="6933556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933562">gray16</span>&nbsp;<span class="op" id="6933569">:=</span>&nbsp;<span class="ident" id="6933572">png</span><span class="op" id="6933575">.</span><span class="ident" id="6933576">At</span><span class="op" id="6933578">(</span><span class="ident" id="6933579">x</span><span class="op" id="6933580">,</span>&nbsp;<span class="ident" id="6933582">y</span><span class="op" id="6933583">)</span><span class="op" id="6933584">.</span><span class="op" id="6933585">(</span><span class="ident" id="6933586">color</span><span class="op" id="6933591">.</span><span class="ident" id="6933592">Gray16</span><span class="op" id="6933598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933604">fmt</span><span class="op" id="6933607">.</span><span class="ident" id="6933608">Fprintf</span><span class="op" id="6933615">(</span><span class="ident" id="6933616">w</span><span class="op" id="6933617">,</span>&nbsp;<span class="string" id="6933619">&#34;%04x&nbsp;&#34;</span><span class="op" id="6933626">,</span>&nbsp;<span class="ident" id="6933628">gray16</span><span class="op" id="6933634">.</span><span class="ident" id="6933635">Y</span><span class="op" id="6933636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933645">case</span>&nbsp;<span class="ident" id="6933650">cm</span>&nbsp;<span class="op" id="6933653">==</span>&nbsp;<span class="ident" id="6933656">color</span><span class="op" id="6933661">.</span><span class="ident" id="6933662">RGBAModel</span><span class="op" id="6933671">:</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933676">for</span>&nbsp;<span class="ident" id="6933680">x</span>&nbsp;<span class="op" id="6933682">:=</span>&nbsp;<span class="ident" id="6933685">bounds</span><span class="op" id="6933691">.</span><span class="ident" id="6933692">Min</span><span class="op" id="6933695">.</span><span class="ident" id="6933696">X</span><span class="op" id="6933697">;</span>&nbsp;<span class="ident" id="6933699">x</span>&nbsp;<span class="op" id="6933701">&lt;</span>&nbsp;<span class="ident" id="6933703">bounds</span><span class="op" id="6933709">.</span><span class="ident" id="6933710">Max</span><span class="op" id="6933713">.</span><span class="ident" id="6933714">X</span><span class="op" id="6933715">;</span>&nbsp;<span class="ident" id="6933717">x</span><span class="op" id="6933718">++</span>&nbsp;<span class="op" id="6933721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933727">rgba</span>&nbsp;<span class="op" id="6933732">:=</span>&nbsp;<span class="ident" id="6933735">png</span><span class="op" id="6933738">.</span><span class="ident" id="6933739">At</span><span class="op" id="6933741">(</span><span class="ident" id="6933742">x</span><span class="op" id="6933743">,</span>&nbsp;<span class="ident" id="6933745">y</span><span class="op" id="6933746">)</span><span class="op" id="6933747">.</span><span class="op" id="6933748">(</span><span class="ident" id="6933749">color</span><span class="op" id="6933754">.</span><span class="ident" id="6933755">RGBA</span><span class="op" id="6933759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933765">fmt</span><span class="op" id="6933768">.</span><span class="ident" id="6933769">Fprintf</span><span class="op" id="6933776">(</span><span class="ident" id="6933777">w</span><span class="op" id="6933778">,</span>&nbsp;<span class="string" id="6933780">&#34;%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6933795">,</span>&nbsp;<span class="ident" id="6933797">rgba</span><span class="op" id="6933801">.</span><span class="ident" id="6933802">R</span><span class="op" id="6933803">,</span>&nbsp;<span class="ident" id="6933805">rgba</span><span class="op" id="6933809">.</span><span class="ident" id="6933810">G</span><span class="op" id="6933811">,</span>&nbsp;<span class="ident" id="6933813">rgba</span><span class="op" id="6933817">.</span><span class="ident" id="6933818">B</span><span class="op" id="6933819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6933824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933828">case</span>&nbsp;<span class="ident" id="6933833">cm</span>&nbsp;<span class="op" id="6933836">==</span>&nbsp;<span class="ident" id="6933839">color</span><span class="op" id="6933844">.</span><span class="ident" id="6933845">RGBA64Model</span><span class="op" id="6933856">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6933861">for</span>&nbsp;<span class="ident" id="6933865">x</span>&nbsp;<span class="op" id="6933867">:=</span>&nbsp;<span class="ident" id="6933870">bounds</span><span class="op" id="6933876">.</span><span class="ident" id="6933877">Min</span><span class="op" id="6933880">.</span><span class="ident" id="6933881">X</span><span class="op" id="6933882">;</span>&nbsp;<span class="ident" id="6933884">x</span>&nbsp;<span class="op" id="6933886">&lt;</span>&nbsp;<span class="ident" id="6933888">bounds</span><span class="op" id="6933894">.</span><span class="ident" id="6933895">Max</span><span class="op" id="6933898">.</span><span class="ident" id="6933899">X</span><span class="op" id="6933900">;</span>&nbsp;<span class="ident" id="6933902">x</span><span class="op" id="6933903">++</span>&nbsp;<span class="op" id="6933906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933912">rgba64</span>&nbsp;<span class="op" id="6933919">:=</span>&nbsp;<span class="ident" id="6933922">png</span><span class="op" id="6933925">.</span><span class="ident" id="6933926">At</span><span class="op" id="6933928">(</span><span class="ident" id="6933929">x</span><span class="op" id="6933930">,</span>&nbsp;<span class="ident" id="6933932">y</span><span class="op" id="6933933">)</span><span class="op" id="6933934">.</span><span class="op" id="6933935">(</span><span class="ident" id="6933936">color</span><span class="op" id="6933941">.</span><span class="ident" id="6933942">RGBA64</span><span class="op" id="6933948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6933954">fmt</span><span class="op" id="6933957">.</span><span class="ident" id="6933958">Fprintf</span><span class="op" id="6933965">(</span><span class="ident" id="6933966">w</span><span class="op" id="6933967">,</span>&nbsp;<span class="string" id="6933969">&#34;%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6933984">,</span>&nbsp;<span class="ident" id="6933986">rgba64</span><span class="op" id="6933992">.</span><span class="ident" id="6933993">R</span><span class="op" id="6933994">,</span>&nbsp;<span class="ident" id="6933996">rgba64</span><span class="op" id="6934002">.</span><span class="ident" id="6934003">G</span><span class="op" id="6934004">,</span>&nbsp;<span class="ident" id="6934006">rgba64</span><span class="op" id="6934012">.</span><span class="ident" id="6934013">B</span><span class="op" id="6934014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934023">case</span>&nbsp;<span class="ident" id="6934028">cm</span>&nbsp;<span class="op" id="6934031">==</span>&nbsp;<span class="ident" id="6934034">color</span><span class="op" id="6934039">.</span><span class="ident" id="6934040">NRGBAModel</span><span class="op" id="6934050">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934055">for</span>&nbsp;<span class="ident" id="6934059">x</span>&nbsp;<span class="op" id="6934061">:=</span>&nbsp;<span class="ident" id="6934064">bounds</span><span class="op" id="6934070">.</span><span class="ident" id="6934071">Min</span><span class="op" id="6934074">.</span><span class="ident" id="6934075">X</span><span class="op" id="6934076">;</span>&nbsp;<span class="ident" id="6934078">x</span>&nbsp;<span class="op" id="6934080">&lt;</span>&nbsp;<span class="ident" id="6934082">bounds</span><span class="op" id="6934088">.</span><span class="ident" id="6934089">Max</span><span class="op" id="6934092">.</span><span class="ident" id="6934093">X</span><span class="op" id="6934094">;</span>&nbsp;<span class="ident" id="6934096">x</span><span class="op" id="6934097">++</span>&nbsp;<span class="op" id="6934100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934106">nrgba</span>&nbsp;<span class="op" id="6934112">:=</span>&nbsp;<span class="ident" id="6934115">png</span><span class="op" id="6934118">.</span><span class="ident" id="6934119">At</span><span class="op" id="6934121">(</span><span class="ident" id="6934122">x</span><span class="op" id="6934123">,</span>&nbsp;<span class="ident" id="6934125">y</span><span class="op" id="6934126">)</span><span class="op" id="6934127">.</span><span class="op" id="6934128">(</span><span class="ident" id="6934129">color</span><span class="op" id="6934134">.</span><span class="ident" id="6934135">NRGBA</span><span class="op" id="6934140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934146">fmt</span><span class="op" id="6934149">.</span><span class="ident" id="6934150">Fprintf</span><span class="op" id="6934157">(</span><span class="ident" id="6934158">w</span><span class="op" id="6934159">,</span>&nbsp;<span class="string" id="6934161">&#34;%02x%02x%02x%02x&nbsp;&#34;</span><span class="op" id="6934180">,</span>&nbsp;<span class="ident" id="6934182">nrgba</span><span class="op" id="6934187">.</span><span class="ident" id="6934188">R</span><span class="op" id="6934189">,</span>&nbsp;<span class="ident" id="6934191">nrgba</span><span class="op" id="6934196">.</span><span class="ident" id="6934197">G</span><span class="op" id="6934198">,</span>&nbsp;<span class="ident" id="6934200">nrgba</span><span class="op" id="6934205">.</span><span class="ident" id="6934206">B</span><span class="op" id="6934207">,</span>&nbsp;<span class="ident" id="6934209">nrgba</span><span class="op" id="6934214">.</span><span class="ident" id="6934215">A</span><span class="op" id="6934216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934225">case</span>&nbsp;<span class="ident" id="6934230">cm</span>&nbsp;<span class="op" id="6934233">==</span>&nbsp;<span class="ident" id="6934236">color</span><span class="op" id="6934241">.</span><span class="ident" id="6934242">NRGBA64Model</span><span class="op" id="6934254">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934259">for</span>&nbsp;<span class="ident" id="6934263">x</span>&nbsp;<span class="op" id="6934265">:=</span>&nbsp;<span class="ident" id="6934268">bounds</span><span class="op" id="6934274">.</span><span class="ident" id="6934275">Min</span><span class="op" id="6934278">.</span><span class="ident" id="6934279">X</span><span class="op" id="6934280">;</span>&nbsp;<span class="ident" id="6934282">x</span>&nbsp;<span class="op" id="6934284">&lt;</span>&nbsp;<span class="ident" id="6934286">bounds</span><span class="op" id="6934292">.</span><span class="ident" id="6934293">Max</span><span class="op" id="6934296">.</span><span class="ident" id="6934297">X</span><span class="op" id="6934298">;</span>&nbsp;<span class="ident" id="6934300">x</span><span class="op" id="6934301">++</span>&nbsp;<span class="op" id="6934304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934310">nrgba64</span>&nbsp;<span class="op" id="6934318">:=</span>&nbsp;<span class="ident" id="6934321">png</span><span class="op" id="6934324">.</span><span class="ident" id="6934325">At</span><span class="op" id="6934327">(</span><span class="ident" id="6934328">x</span><span class="op" id="6934329">,</span>&nbsp;<span class="ident" id="6934331">y</span><span class="op" id="6934332">)</span><span class="op" id="6934333">.</span><span class="op" id="6934334">(</span><span class="ident" id="6934335">color</span><span class="op" id="6934340">.</span><span class="ident" id="6934341">NRGBA64</span><span class="op" id="6934348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934354">fmt</span><span class="op" id="6934357">.</span><span class="ident" id="6934358">Fprintf</span><span class="op" id="6934365">(</span><span class="ident" id="6934366">w</span><span class="op" id="6934367">,</span>&nbsp;<span class="string" id="6934369">&#34;%04x%04x%04x%04x&nbsp;&#34;</span><span class="op" id="6934388">,</span>&nbsp;<span class="ident" id="6934390">nrgba64</span><span class="op" id="6934397">.</span><span class="ident" id="6934398">R</span><span class="op" id="6934399">,</span>&nbsp;<span class="ident" id="6934401">nrgba64</span><span class="op" id="6934408">.</span><span class="ident" id="6934409">G</span><span class="op" id="6934410">,</span>&nbsp;<span class="ident" id="6934412">nrgba64</span><span class="op" id="6934419">.</span><span class="ident" id="6934420">B</span><span class="op" id="6934421">,</span>&nbsp;<span class="ident" id="6934423">nrgba64</span><span class="op" id="6934430">.</span><span class="ident" id="6934431">A</span><span class="op" id="6934432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934441">case</span>&nbsp;<span class="ident" id="6934446">cpm</span>&nbsp;<span class="op" id="6934450">!=</span>&nbsp;<span class="builtintype" id="6934453">nil</span><span class="op" id="6934456">:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934461">var</span>&nbsp;<span class="ident" id="6934465">b</span><span class="op" id="6934466">,</span>&nbsp;<span class="ident" id="6934468">c</span>&nbsp;<span class="builtintype" id="6934470">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934477">for</span>&nbsp;<span class="ident" id="6934481">x</span>&nbsp;<span class="op" id="6934483">:=</span>&nbsp;<span class="ident" id="6934486">bounds</span><span class="op" id="6934492">.</span><span class="ident" id="6934493">Min</span><span class="op" id="6934496">.</span><span class="ident" id="6934497">X</span><span class="op" id="6934498">;</span>&nbsp;<span class="ident" id="6934500">x</span>&nbsp;<span class="op" id="6934502">&lt;</span>&nbsp;<span class="ident" id="6934504">bounds</span><span class="op" id="6934510">.</span><span class="ident" id="6934511">Max</span><span class="op" id="6934514">.</span><span class="ident" id="6934515">X</span><span class="op" id="6934516">;</span>&nbsp;<span class="ident" id="6934518">x</span><span class="op" id="6934519">++</span>&nbsp;<span class="op" id="6934522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934528">b</span>&nbsp;<span class="op" id="6934530">=</span>&nbsp;<span class="ident" id="6934532">b</span><span class="op" id="6934533">&lt;&lt;</span><span class="builtintype" id="6934535">uint</span><span class="op" id="6934539">(</span><span class="ident" id="6934540">bitdepth</span><span class="op" id="6934548">)</span>&nbsp;<span class="op" id="6934550">|</span>&nbsp;<span class="builtintype" id="6934552">int</span><span class="op" id="6934555">(</span><span class="ident" id="6934556">paletted</span><span class="op" id="6934564">.</span><span class="ident" id="6934565">ColorIndexAt</span><span class="op" id="6934577">(</span><span class="ident" id="6934578">x</span><span class="op" id="6934579">,</span>&nbsp;<span class="ident" id="6934581">y</span><span class="op" id="6934582">)</span><span class="op" id="6934583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934589">c</span><span class="op" id="6934590">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934597">if</span>&nbsp;<span class="ident" id="6934600">c</span>&nbsp;<span class="op" id="6934602">==</span>&nbsp;<span class="num" id="6934605">8</span><span class="op" id="6934606">/</span><span class="ident" id="6934607">bitdepth</span>&nbsp;<span class="op" id="6934616">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934623">fmt</span><span class="op" id="6934626">.</span><span class="ident" id="6934627">Fprintf</span><span class="op" id="6934634">(</span><span class="ident" id="6934635">w</span><span class="op" id="6934636">,</span>&nbsp;<span class="string" id="6934638">&#34;%02x&#34;</span><span class="op" id="6934644">,</span>&nbsp;<span class="ident" id="6934646">b</span><span class="op" id="6934647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934654">b</span>&nbsp;<span class="op" id="6934656">=</span>&nbsp;<span class="num" id="6934658">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934665">c</span>&nbsp;<span class="op" id="6934667">=</span>&nbsp;<span class="num" id="6934669">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934680">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934685">if</span>&nbsp;<span class="ident" id="6934688">c</span>&nbsp;<span class="op" id="6934690">!=</span>&nbsp;<span class="num" id="6934693">0</span>&nbsp;<span class="op" id="6934695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934701">for</span>&nbsp;<span class="ident" id="6934705">c</span>&nbsp;<span class="op" id="6934707">!=</span>&nbsp;<span class="num" id="6934710">8</span><span class="op" id="6934711">/</span><span class="ident" id="6934712">bitdepth</span>&nbsp;<span class="op" id="6934721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934728">b</span>&nbsp;<span class="op" id="6934730">=</span>&nbsp;<span class="ident" id="6934732">b</span>&nbsp;<span class="op" id="6934734">&lt;&lt;</span>&nbsp;<span class="builtintype" id="6934737">uint</span><span class="op" id="6934741">(</span><span class="ident" id="6934742">bitdepth</span><span class="op" id="6934750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934757">c</span><span class="op" id="6934758">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934765">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934771">fmt</span><span class="op" id="6934774">.</span><span class="ident" id="6934775">Fprintf</span><span class="op" id="6934782">(</span><span class="ident" id="6934783">w</span><span class="op" id="6934784">,</span>&nbsp;<span class="string" id="6934786">&#34;%02x&#34;</span><span class="op" id="6934792">,</span>&nbsp;<span class="ident" id="6934794">b</span><span class="op" id="6934795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934808">io</span><span class="op" id="6934810">.</span><span class="ident" id="6934811">WriteString</span><span class="op" id="6934822">(</span><span class="ident" id="6934823">w</span><span class="op" id="6934824">,</span>&nbsp;<span class="string" id="6934826">&#34;\n&#34;</span><span class="op" id="6934830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934833">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934836">io</span><span class="op" id="6934838">.</span><span class="ident" id="6934839">WriteString</span><span class="op" id="6934850">(</span><span class="ident" id="6934851">w</span><span class="op" id="6934852">,</span>&nbsp;<span class="string" id="6934854">&#34;}\n&#34;</span><span class="op" id="6934859">)</span><br>
<span class="lineno"></span><span class="op" id="6934861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6934864">func</span>&nbsp;<span class="ident" id="6934869">TestReader</span><span class="op" id="6934879">(</span><span class="ident" id="6934880">t</span>&nbsp;<span class="op" id="6934882">*</span><span class="ident" id="6934883">testing</span><span class="op" id="6934890">.</span><span class="ident" id="6934891">T</span><span class="op" id="6934892">)</span>&nbsp;<span class="op" id="6934894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934897">names</span>&nbsp;<span class="op" id="6934903">:=</span>&nbsp;<span class="ident" id="6934906">filenames</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934917">if</span>&nbsp;<span class="ident" id="6934920">testing</span><span class="op" id="6934927">.</span><span class="ident" id="6934928">Short</span><span class="op" id="6934933">(</span><span class="op" id="6934934">)</span>&nbsp;<span class="op" id="6934936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6934940">names</span>&nbsp;<span class="op" id="6934946">=</span>&nbsp;<span class="ident" id="6934948">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6934964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6934967">for</span>&nbsp;<span class="ident" id="6934971">_</span><span class="op" id="6934972">,</span>&nbsp;<span class="ident" id="6934974">fn</span>&nbsp;<span class="op" id="6934977">:=</span>&nbsp;<span class="keyword" id="6934980">range</span>&nbsp;<span class="ident" id="6934986">names</span>&nbsp;<span class="op" id="6934992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6934996">//&nbsp;Read&nbsp;the&nbsp;.png&nbsp;file.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935021">img</span><span class="op" id="6935024">,</span>&nbsp;<span class="ident" id="6935026">err</span>&nbsp;<span class="op" id="6935030">:=</span>&nbsp;<span class="ident" id="6935033">readPNG</span><span class="op" id="6935040">(</span><span class="string" id="6935041">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6935062">+</span>&nbsp;<span class="ident" id="6935064">fn</span>&nbsp;<span class="op" id="6935067">+</span>&nbsp;<span class="string" id="6935069">&#34;.png&#34;</span><span class="op" id="6935075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935079">if</span>&nbsp;<span class="ident" id="6935082">err</span>&nbsp;<span class="op" id="6935086">!=</span>&nbsp;<span class="builtintype" id="6935089">nil</span>&nbsp;<span class="op" id="6935093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935098">t</span><span class="op" id="6935099">.</span><span class="ident" id="6935100">Error</span><span class="op" id="6935105">(</span><span class="ident" id="6935106">fn</span><span class="op" id="6935108">,</span>&nbsp;<span class="ident" id="6935110">err</span><span class="op" id="6935113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935118">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935129">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935134">if</span>&nbsp;<span class="ident" id="6935137">fn</span>&nbsp;<span class="op" id="6935140">==</span>&nbsp;<span class="string" id="6935143">&#34;basn4a16&#34;</span>&nbsp;<span class="op" id="6935154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6935159">//&nbsp;basn4a16.sng&nbsp;is&nbsp;gray&nbsp;+&nbsp;alpha&nbsp;but&nbsp;sng()&nbsp;will&nbsp;produce&nbsp;true&nbsp;color&nbsp;+&nbsp;alpha</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6935236">//&nbsp;so&nbsp;we&nbsp;just&nbsp;check&nbsp;a&nbsp;single&nbsp;random&nbsp;pixel.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935282">c</span>&nbsp;<span class="op" id="6935284">:=</span>&nbsp;<span class="ident" id="6935287">img</span><span class="op" id="6935290">.</span><span class="ident" id="6935291">At</span><span class="op" id="6935293">(</span><span class="num" id="6935294">2</span><span class="op" id="6935295">,</span>&nbsp;<span class="num" id="6935297">1</span><span class="op" id="6935298">)</span><span class="op" id="6935299">.</span><span class="op" id="6935300">(</span><span class="ident" id="6935301">color</span><span class="op" id="6935306">.</span><span class="ident" id="6935307">NRGBA64</span><span class="op" id="6935314">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935319">if</span>&nbsp;<span class="ident" id="6935322">c</span><span class="op" id="6935323">.</span><span class="ident" id="6935324">R</span>&nbsp;<span class="op" id="6935326">!=</span>&nbsp;<span class="num" id="6935329">0x11a7</span>&nbsp;<span class="op" id="6935336">||</span>&nbsp;<span class="ident" id="6935339">c</span><span class="op" id="6935340">.</span><span class="ident" id="6935341">G</span>&nbsp;<span class="op" id="6935343">!=</span>&nbsp;<span class="num" id="6935346">0x11a7</span>&nbsp;<span class="op" id="6935353">||</span>&nbsp;<span class="ident" id="6935356">c</span><span class="op" id="6935357">.</span><span class="ident" id="6935358">B</span>&nbsp;<span class="op" id="6935360">!=</span>&nbsp;<span class="num" id="6935363">0x11a7</span>&nbsp;<span class="op" id="6935370">||</span>&nbsp;<span class="ident" id="6935373">c</span><span class="op" id="6935374">.</span><span class="ident" id="6935375">A</span>&nbsp;<span class="op" id="6935377">!=</span>&nbsp;<span class="num" id="6935380">0x1085</span>&nbsp;<span class="op" id="6935387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935393">t</span><span class="op" id="6935394">.</span><span class="ident" id="6935395">Error</span><span class="op" id="6935400">(</span><span class="ident" id="6935401">fn</span><span class="op" id="6935403">,</span>&nbsp;<span class="ident" id="6935405">fmt</span><span class="op" id="6935408">.</span><span class="ident" id="6935409">Errorf</span><span class="op" id="6935415">(</span><span class="string" id="6935416">&#34;wrong&nbsp;pixel&nbsp;value&nbsp;at&nbsp;(2,&nbsp;1):&nbsp;%x&#34;</span><span class="op" id="6935449">,</span>&nbsp;<span class="ident" id="6935451">c</span><span class="op" id="6935452">)</span><span class="op" id="6935453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935463">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935474">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935479">piper</span><span class="op" id="6935484">,</span>&nbsp;<span class="ident" id="6935486">pipew</span>&nbsp;<span class="op" id="6935492">:=</span>&nbsp;<span class="ident" id="6935495">io</span><span class="op" id="6935497">.</span><span class="ident" id="6935498">Pipe</span><span class="op" id="6935502">(</span><span class="op" id="6935503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935507">pb</span>&nbsp;<span class="op" id="6935510">:=</span>&nbsp;<span class="ident" id="6935513">bufio</span><span class="op" id="6935518">.</span><span class="ident" id="6935519">NewScanner</span><span class="op" id="6935529">(</span><span class="ident" id="6935530">piper</span><span class="op" id="6935535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935539">go</span>&nbsp;<span class="ident" id="6935542">sng</span><span class="op" id="6935545">(</span><span class="ident" id="6935546">pipew</span><span class="op" id="6935551">,</span>&nbsp;<span class="ident" id="6935553">fn</span><span class="op" id="6935555">,</span>&nbsp;<span class="ident" id="6935557">img</span><span class="op" id="6935560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935564">defer</span>&nbsp;<span class="ident" id="6935570">piper</span><span class="op" id="6935575">.</span><span class="ident" id="6935576">Close</span><span class="op" id="6935581">(</span><span class="op" id="6935582">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6935587">//&nbsp;Read&nbsp;the&nbsp;.sng&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935612">sf</span><span class="op" id="6935614">,</span>&nbsp;<span class="ident" id="6935616">err</span>&nbsp;<span class="op" id="6935620">:=</span>&nbsp;<span class="ident" id="6935623">os</span><span class="op" id="6935625">.</span><span class="ident" id="6935626">Open</span><span class="op" id="6935630">(</span><span class="string" id="6935631">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6935652">+</span>&nbsp;<span class="ident" id="6935654">fn</span>&nbsp;<span class="op" id="6935657">+</span>&nbsp;<span class="string" id="6935659">&#34;.sng&#34;</span><span class="op" id="6935665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935669">if</span>&nbsp;<span class="ident" id="6935672">err</span>&nbsp;<span class="op" id="6935676">!=</span>&nbsp;<span class="builtintype" id="6935679">nil</span>&nbsp;<span class="op" id="6935683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935688">t</span><span class="op" id="6935689">.</span><span class="ident" id="6935690">Error</span><span class="op" id="6935695">(</span><span class="ident" id="6935696">fn</span><span class="op" id="6935698">,</span>&nbsp;<span class="ident" id="6935700">err</span><span class="op" id="6935703">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935708">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935723">defer</span>&nbsp;<span class="ident" id="6935729">sf</span><span class="op" id="6935731">.</span><span class="ident" id="6935732">Close</span><span class="op" id="6935737">(</span><span class="op" id="6935738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935742">sb</span>&nbsp;<span class="op" id="6935745">:=</span>&nbsp;<span class="ident" id="6935748">bufio</span><span class="op" id="6935753">.</span><span class="ident" id="6935754">NewScanner</span><span class="op" id="6935764">(</span><span class="ident" id="6935765">sf</span><span class="op" id="6935767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935771">if</span>&nbsp;<span class="ident" id="6935774">err</span>&nbsp;<span class="op" id="6935778">!=</span>&nbsp;<span class="builtintype" id="6935781">nil</span>&nbsp;<span class="op" id="6935785">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935790">t</span><span class="op" id="6935791">.</span><span class="ident" id="6935792">Error</span><span class="op" id="6935797">(</span><span class="ident" id="6935798">fn</span><span class="op" id="6935800">,</span>&nbsp;<span class="ident" id="6935802">err</span><span class="op" id="6935805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935810">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6935826">//&nbsp;Compare&nbsp;the&nbsp;two,&nbsp;in&nbsp;SNG&nbsp;format,&nbsp;line&nbsp;by&nbsp;line.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935877">for</span>&nbsp;<span class="op" id="6935881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935886">pdone</span>&nbsp;<span class="op" id="6935892">:=</span>&nbsp;<span class="op" id="6935895">!</span><span class="ident" id="6935896">pb</span><span class="op" id="6935898">.</span><span class="ident" id="6935899">Scan</span><span class="op" id="6935903">(</span><span class="op" id="6935904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935909">sdone</span>&nbsp;<span class="op" id="6935915">:=</span>&nbsp;<span class="op" id="6935918">!</span><span class="ident" id="6935919">sb</span><span class="op" id="6935921">.</span><span class="ident" id="6935922">Scan</span><span class="op" id="6935926">(</span><span class="op" id="6935927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935932">if</span>&nbsp;<span class="ident" id="6935935">pdone</span>&nbsp;<span class="op" id="6935941">&amp;&amp;</span>&nbsp;<span class="ident" id="6935944">sdone</span>&nbsp;<span class="op" id="6935950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935956">break</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6935965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6935970">if</span>&nbsp;<span class="ident" id="6935973">pdone</span>&nbsp;<span class="op" id="6935979">||</span>&nbsp;<span class="ident" id="6935982">sdone</span>&nbsp;<span class="op" id="6935988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6935994">t</span><span class="op" id="6935995">.</span><span class="ident" id="6935996">Errorf</span><span class="op" id="6936002">(</span><span class="string" id="6936003">&#34;%s:&nbsp;Different&nbsp;sizes&#34;</span><span class="op" id="6936024">,</span>&nbsp;<span class="ident" id="6936026">fn</span><span class="op" id="6936028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936034">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936043">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936048">ps</span>&nbsp;<span class="op" id="6936051">:=</span>&nbsp;<span class="ident" id="6936054">pb</span><span class="op" id="6936056">.</span><span class="ident" id="6936057">Text</span><span class="op" id="6936061">(</span><span class="op" id="6936062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936067">ss</span>&nbsp;<span class="op" id="6936070">:=</span>&nbsp;<span class="ident" id="6936073">sb</span><span class="op" id="6936075">.</span><span class="ident" id="6936076">Text</span><span class="op" id="6936080">(</span><span class="op" id="6936081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936086">if</span>&nbsp;<span class="ident" id="6936089">ps</span>&nbsp;<span class="op" id="6936092">!=</span>&nbsp;<span class="ident" id="6936095">ss</span>&nbsp;<span class="op" id="6936098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936104">t</span><span class="op" id="6936105">.</span><span class="ident" id="6936106">Errorf</span><span class="op" id="6936112">(</span><span class="string" id="6936113">&#34;%s:&nbsp;Mismatch\n%sversus\n%s\n&#34;</span><span class="op" id="6936143">,</span>&nbsp;<span class="ident" id="6936145">fn</span><span class="op" id="6936147">,</span>&nbsp;<span class="ident" id="6936149">ps</span><span class="op" id="6936151">,</span>&nbsp;<span class="ident" id="6936153">ss</span><span class="op" id="6936155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936161">break</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936178">if</span>&nbsp;<span class="ident" id="6936181">pb</span><span class="op" id="6936183">.</span><span class="ident" id="6936184">Err</span><span class="op" id="6936187">(</span><span class="op" id="6936188">)</span>&nbsp;<span class="op" id="6936190">!=</span>&nbsp;<span class="builtintype" id="6936193">nil</span>&nbsp;<span class="op" id="6936197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936202">t</span><span class="op" id="6936203">.</span><span class="ident" id="6936204">Error</span><span class="op" id="6936209">(</span><span class="ident" id="6936210">fn</span><span class="op" id="6936212">,</span>&nbsp;<span class="ident" id="6936214">pb</span><span class="op" id="6936216">.</span><span class="ident" id="6936217">Err</span><span class="op" id="6936220">(</span><span class="op" id="6936221">)</span><span class="op" id="6936222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936226">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936230">if</span>&nbsp;<span class="ident" id="6936233">sb</span><span class="op" id="6936235">.</span><span class="ident" id="6936236">Err</span><span class="op" id="6936239">(</span><span class="op" id="6936240">)</span>&nbsp;<span class="op" id="6936242">!=</span>&nbsp;<span class="builtintype" id="6936245">nil</span>&nbsp;<span class="op" id="6936249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936254">t</span><span class="op" id="6936255">.</span><span class="ident" id="6936256">Error</span><span class="op" id="6936261">(</span><span class="ident" id="6936262">fn</span><span class="op" id="6936264">,</span>&nbsp;<span class="ident" id="6936266">sb</span><span class="op" id="6936268">.</span><span class="ident" id="6936269">Err</span><span class="op" id="6936272">(</span><span class="op" id="6936273">)</span><span class="op" id="6936274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936281">}</span><br>
<span class="lineno"></span><span class="op" id="6936283">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="6936286">var</span>&nbsp;<span class="ident" id="6936290">readerErrors</span>&nbsp;<span class="op" id="6936303">=</span>&nbsp;<span class="op" id="6936305">[</span><span class="op" id="6936306">]</span><span class="keyword" id="6936307">struct</span>&nbsp;<span class="op" id="6936314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936317">file</span>&nbsp;<span class="builtintype" id="6936322">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936330">err</span>&nbsp;&nbsp;<span class="builtintype" id="6936335">string</span><br>
<span class="lineno"></span><span class="op" id="6936342">}</span><span class="op" id="6936343">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936346">{</span><span class="string" id="6936347">&#34;invalid-zlib.png&#34;</span><span class="op" id="6936365">,</span>&nbsp;<span class="string" id="6936367">&#34;zlib:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="6936391">}</span><span class="op" id="6936392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936395">{</span><span class="string" id="6936396">&#34;invalid-crc32.png&#34;</span><span class="op" id="6936415">,</span>&nbsp;<span class="string" id="6936417">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="6936435">}</span><span class="op" id="6936436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936439">{</span><span class="string" id="6936440">&#34;invalid-noend.png&#34;</span><span class="op" id="6936459">,</span>&nbsp;<span class="string" id="6936461">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6936477">}</span><span class="op" id="6936478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936481">{</span><span class="string" id="6936482">&#34;invalid-trunc.png&#34;</span><span class="op" id="6936501">,</span>&nbsp;<span class="string" id="6936503">&#34;unexpected&nbsp;EOF&#34;</span><span class="op" id="6936519">}</span><span class="op" id="6936520">,</span><br>
<span class="lineno"></span><span class="op" id="6936522">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="6936525">func</span>&nbsp;<span class="ident" id="6936530">TestReaderError</span><span class="op" id="6936545">(</span><span class="ident" id="6936546">t</span>&nbsp;<span class="op" id="6936548">*</span><span class="ident" id="6936549">testing</span><span class="op" id="6936556">.</span><span class="ident" id="6936557">T</span><span class="op" id="6936558">)</span>&nbsp;<span class="op" id="6936560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936563">for</span>&nbsp;<span class="ident" id="6936567">_</span><span class="op" id="6936568">,</span>&nbsp;<span class="ident" id="6936570">tt</span>&nbsp;<span class="op" id="6936573">:=</span>&nbsp;<span class="keyword" id="6936576">range</span>&nbsp;<span class="ident" id="6936582">readerErrors</span>&nbsp;<span class="op" id="6936595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936599">img</span><span class="op" id="6936602">,</span>&nbsp;<span class="ident" id="6936604">err</span>&nbsp;<span class="op" id="6936608">:=</span>&nbsp;<span class="ident" id="6936611">readPNG</span><span class="op" id="6936618">(</span><span class="string" id="6936619">&#34;testdata/&#34;</span>&nbsp;<span class="op" id="6936631">+</span>&nbsp;<span class="ident" id="6936633">tt</span><span class="op" id="6936635">.</span><span class="ident" id="6936636">file</span><span class="op" id="6936640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936644">if</span>&nbsp;<span class="ident" id="6936647">err</span>&nbsp;<span class="op" id="6936651">==</span>&nbsp;<span class="builtintype" id="6936654">nil</span>&nbsp;<span class="op" id="6936658">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936663">t</span><span class="op" id="6936664">.</span><span class="ident" id="6936665">Errorf</span><span class="op" id="6936671">(</span><span class="string" id="6936672">&#34;decoding&nbsp;%s:&nbsp;missing&nbsp;error&#34;</span><span class="op" id="6936700">,</span>&nbsp;<span class="ident" id="6936702">tt</span><span class="op" id="6936704">.</span><span class="ident" id="6936705">file</span><span class="op" id="6936709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936714">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936729">if</span>&nbsp;<span class="op" id="6936732">!</span><span class="ident" id="6936733">strings</span><span class="op" id="6936740">.</span><span class="ident" id="6936741">Contains</span><span class="op" id="6936749">(</span><span class="ident" id="6936750">err</span><span class="op" id="6936753">.</span><span class="ident" id="6936754">Error</span><span class="op" id="6936759">(</span><span class="op" id="6936760">)</span><span class="op" id="6936761">,</span>&nbsp;<span class="ident" id="6936763">tt</span><span class="op" id="6936765">.</span><span class="ident" id="6936766">err</span><span class="op" id="6936769">)</span>&nbsp;<span class="op" id="6936771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936776">t</span><span class="op" id="6936777">.</span><span class="ident" id="6936778">Errorf</span><span class="op" id="6936784">(</span><span class="string" id="6936785">&#34;decoding&nbsp;%s:&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="6936811">,</span>&nbsp;<span class="ident" id="6936813">tt</span><span class="op" id="6936815">.</span><span class="ident" id="6936816">file</span><span class="op" id="6936820">,</span>&nbsp;<span class="ident" id="6936822">err</span><span class="op" id="6936825">,</span>&nbsp;<span class="ident" id="6936827">tt</span><span class="op" id="6936829">.</span><span class="ident" id="6936830">err</span><span class="op" id="6936833">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936841">if</span>&nbsp;<span class="ident" id="6936844">img</span>&nbsp;<span class="op" id="6936848">!=</span>&nbsp;<span class="builtintype" id="6936851">nil</span>&nbsp;<span class="op" id="6936855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6936860">t</span><span class="op" id="6936861">.</span><span class="ident" id="6936862">Errorf</span><span class="op" id="6936868">(</span><span class="string" id="6936869">&#34;decoding&nbsp;%s:&nbsp;have&nbsp;image&nbsp;+&nbsp;error&#34;</span><span class="op" id="6936902">,</span>&nbsp;<span class="ident" id="6936904">tt</span><span class="op" id="6936906">.</span><span class="ident" id="6936907">file</span><span class="op" id="6936911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6936918">}</span><br>
<span class="lineno">295</span><span class="op" id="6936920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6936923">func</span>&nbsp;<span class="ident" id="6936928">TestPalettedDecodeConfig</span><span class="op" id="6936952">(</span><span class="ident" id="6936953">t</span>&nbsp;<span class="op" id="6936955">*</span><span class="ident" id="6936956">testing</span><span class="op" id="6936963">.</span><span class="ident" id="6936964">T</span><span class="op" id="6936965">)</span>&nbsp;<span class="op" id="6936967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6936970">for</span>&nbsp;<span class="ident" id="6936974">_</span><span class="op" id="6936975">,</span>&nbsp;<span class="ident" id="6936977">fn</span>&nbsp;<span class="op" id="6936980">:=</span>&nbsp;<span class="keyword" id="6936983">range</span>&nbsp;<span class="ident" id="6936989">filenamesPaletted</span>&nbsp;<span class="op" id="6937007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937011">f</span><span class="op" id="6937012">,</span>&nbsp;<span class="ident" id="6937014">err</span>&nbsp;<span class="op" id="6937018">:=</span>&nbsp;<span class="ident" id="6937021">os</span><span class="op" id="6937023">.</span><span class="ident" id="6937024">Open</span><span class="op" id="6937028">(</span><span class="string" id="6937029">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6937050">+</span>&nbsp;<span class="ident" id="6937052">fn</span>&nbsp;<span class="op" id="6937055">+</span>&nbsp;<span class="string" id="6937057">&#34;.png&#34;</span><span class="op" id="6937063">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937067">if</span>&nbsp;<span class="ident" id="6937070">err</span>&nbsp;<span class="op" id="6937074">!=</span>&nbsp;<span class="builtintype" id="6937077">nil</span>&nbsp;<span class="op" id="6937081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937086">t</span><span class="op" id="6937087">.</span><span class="ident" id="6937088">Errorf</span><span class="op" id="6937094">(</span><span class="string" id="6937095">&#34;%s:&nbsp;open&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6937116">,</span>&nbsp;<span class="ident" id="6937118">fn</span><span class="op" id="6937120">,</span>&nbsp;<span class="ident" id="6937122">err</span><span class="op" id="6937125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937130">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937145">defer</span>&nbsp;<span class="ident" id="6937151">f</span><span class="op" id="6937152">.</span><span class="ident" id="6937153">Close</span><span class="op" id="6937158">(</span><span class="op" id="6937159">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937163">cfg</span><span class="op" id="6937166">,</span>&nbsp;<span class="ident" id="6937168">err</span>&nbsp;<span class="op" id="6937172">:=</span>&nbsp;<span class="ident" id="6937175">DecodeConfig</span><span class="op" id="6937187">(</span><span class="ident" id="6937188">f</span><span class="op" id="6937189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937193">if</span>&nbsp;<span class="ident" id="6937196">err</span>&nbsp;<span class="op" id="6937200">!=</span>&nbsp;<span class="builtintype" id="6937203">nil</span>&nbsp;<span class="op" id="6937207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937212">t</span><span class="op" id="6937213">.</span><span class="ident" id="6937214">Errorf</span><span class="op" id="6937220">(</span><span class="string" id="6937221">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="6937229">,</span>&nbsp;<span class="ident" id="6937231">fn</span><span class="op" id="6937233">,</span>&nbsp;<span class="ident" id="6937235">err</span><span class="op" id="6937238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937243">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937254">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937258">pal</span><span class="op" id="6937261">,</span>&nbsp;<span class="ident" id="6937263">ok</span>&nbsp;<span class="op" id="6937266">:=</span>&nbsp;<span class="ident" id="6937269">cfg</span><span class="op" id="6937272">.</span><span class="ident" id="6937273">ColorModel</span><span class="op" id="6937283">.</span><span class="op" id="6937284">(</span><span class="ident" id="6937285">color</span><span class="op" id="6937290">.</span><span class="ident" id="6937291">Palette</span><span class="op" id="6937298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937302">if</span>&nbsp;<span class="op" id="6937305">!</span><span class="ident" id="6937306">ok</span>&nbsp;<span class="op" id="6937309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937314">t</span><span class="op" id="6937315">.</span><span class="ident" id="6937316">Errorf</span><span class="op" id="6937322">(</span><span class="string" id="6937323">&#34;%s:&nbsp;expected&nbsp;paletted&nbsp;color&nbsp;model&#34;</span><span class="op" id="6937358">,</span>&nbsp;<span class="ident" id="6937360">fn</span><span class="op" id="6937362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937367">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937378">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937382">if</span>&nbsp;<span class="ident" id="6937385">pal</span>&nbsp;<span class="op" id="6937389">==</span>&nbsp;<span class="builtintype" id="6937392">nil</span>&nbsp;<span class="op" id="6937396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937401">t</span><span class="op" id="6937402">.</span><span class="ident" id="6937403">Errorf</span><span class="op" id="6937409">(</span><span class="string" id="6937410">&#34;%s:&nbsp;palette&nbsp;not&nbsp;initialized&#34;</span><span class="op" id="6937439">,</span>&nbsp;<span class="ident" id="6937441">fn</span><span class="op" id="6937443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937448">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937462">}</span><br>
<span class="lineno">320</span><span class="op" id="6937464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937467">func</span>&nbsp;<span class="ident" id="6937472">benchmarkDecode</span><span class="op" id="6937487">(</span><span class="ident" id="6937488">b</span>&nbsp;<span class="op" id="6937490">*</span><span class="ident" id="6937491">testing</span><span class="op" id="6937498">.</span><span class="ident" id="6937499">B</span><span class="op" id="6937500">,</span>&nbsp;<span class="ident" id="6937502">filename</span>&nbsp;<span class="builtintype" id="6937511">string</span><span class="op" id="6937517">,</span>&nbsp;<span class="ident" id="6937519">bytesPerPixel</span>&nbsp;<span class="builtintype" id="6937533">int</span><span class="op" id="6937536">)</span>&nbsp;<span class="op" id="6937538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937541">b</span><span class="op" id="6937542">.</span><span class="ident" id="6937543">StopTimer</span><span class="op" id="6937552">(</span><span class="op" id="6937553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937556">data</span><span class="op" id="6937560">,</span>&nbsp;<span class="ident" id="6937562">err</span>&nbsp;<span class="op" id="6937566">:=</span>&nbsp;<span class="ident" id="6937569">ioutil</span><span class="op" id="6937575">.</span><span class="ident" id="6937576">ReadFile</span><span class="op" id="6937584">(</span><span class="ident" id="6937585">filename</span><span class="op" id="6937593">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937596">if</span>&nbsp;<span class="ident" id="6937599">err</span>&nbsp;<span class="op" id="6937603">!=</span>&nbsp;<span class="builtintype" id="6937606">nil</span>&nbsp;<span class="op" id="6937610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937614">b</span><span class="op" id="6937615">.</span><span class="ident" id="6937616">Fatal</span><span class="op" id="6937621">(</span><span class="ident" id="6937622">err</span><span class="op" id="6937625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937631">s</span>&nbsp;<span class="op" id="6937633">:=</span>&nbsp;<span class="builtintype" id="6937636">string</span><span class="op" id="6937642">(</span><span class="ident" id="6937643">data</span><span class="op" id="6937647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937650">cfg</span><span class="op" id="6937653">,</span>&nbsp;<span class="ident" id="6937655">err</span>&nbsp;<span class="op" id="6937659">:=</span>&nbsp;<span class="ident" id="6937662">DecodeConfig</span><span class="op" id="6937674">(</span><span class="ident" id="6937675">strings</span><span class="op" id="6937682">.</span><span class="ident" id="6937683">NewReader</span><span class="op" id="6937692">(</span><span class="ident" id="6937693">s</span><span class="op" id="6937694">)</span><span class="op" id="6937695">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937698">if</span>&nbsp;<span class="ident" id="6937701">err</span>&nbsp;<span class="op" id="6937705">!=</span>&nbsp;<span class="builtintype" id="6937708">nil</span>&nbsp;<span class="op" id="6937712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937716">b</span><span class="op" id="6937717">.</span><span class="ident" id="6937718">Fatal</span><span class="op" id="6937723">(</span><span class="ident" id="6937724">err</span><span class="op" id="6937727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937733">b</span><span class="op" id="6937734">.</span><span class="ident" id="6937735">SetBytes</span><span class="op" id="6937743">(</span><span class="ident" id="6937744">int64</span><span class="op" id="6937749">(</span><span class="ident" id="6937750">cfg</span><span class="op" id="6937753">.</span><span class="ident" id="6937754">Width</span>&nbsp;<span class="op" id="6937760">*</span>&nbsp;<span class="ident" id="6937762">cfg</span><span class="op" id="6937765">.</span><span class="ident" id="6937766">Height</span>&nbsp;<span class="op" id="6937773">*</span>&nbsp;<span class="ident" id="6937775">bytesPerPixel</span><span class="op" id="6937788">)</span><span class="op" id="6937789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937792">b</span><span class="op" id="6937793">.</span><span class="ident" id="6937794">StartTimer</span><span class="op" id="6937804">(</span><span class="op" id="6937805">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6937808">for</span>&nbsp;<span class="ident" id="6937812">i</span>&nbsp;<span class="op" id="6937814">:=</span>&nbsp;<span class="num" id="6937817">0</span><span class="op" id="6937818">;</span>&nbsp;<span class="ident" id="6937820">i</span>&nbsp;<span class="op" id="6937822">&lt;</span>&nbsp;<span class="ident" id="6937824">b</span><span class="op" id="6937825">.</span><span class="ident" id="6937826">N</span><span class="op" id="6937827">;</span>&nbsp;<span class="ident" id="6937829">i</span><span class="op" id="6937830">++</span>&nbsp;<span class="op" id="6937833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937837">Decode</span><span class="op" id="6937843">(</span><span class="ident" id="6937844">strings</span><span class="op" id="6937851">.</span><span class="ident" id="6937852">NewReader</span><span class="op" id="6937861">(</span><span class="ident" id="6937862">s</span><span class="op" id="6937863">)</span><span class="op" id="6937864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6937867">}</span><br>
<span class="lineno"></span><span class="op" id="6937869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="6937872">func</span>&nbsp;<span class="ident" id="6937877">BenchmarkDecodeGray</span><span class="op" id="6937896">(</span><span class="ident" id="6937897">b</span>&nbsp;<span class="op" id="6937899">*</span><span class="ident" id="6937900">testing</span><span class="op" id="6937907">.</span><span class="ident" id="6937908">B</span><span class="op" id="6937909">)</span>&nbsp;<span class="op" id="6937911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6937914">benchmarkDecode</span><span class="op" id="6937929">(</span><span class="ident" id="6937930">b</span><span class="op" id="6937931">,</span>&nbsp;<span class="string" id="6937933">&#34;testdata/benchGray.png&#34;</span><span class="op" id="6937957">,</span>&nbsp;<span class="num" id="6937959">1</span><span class="op" id="6937960">)</span><br>
<span class="lineno"></span><span class="op" id="6937962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937965">func</span>&nbsp;<span class="ident" id="6937970">BenchmarkDecodeNRGBAGradient</span><span class="op" id="6937998">(</span><span class="ident" id="6937999">b</span>&nbsp;<span class="op" id="6938001">*</span><span class="ident" id="6938002">testing</span><span class="op" id="6938009">.</span><span class="ident" id="6938010">B</span><span class="op" id="6938011">)</span>&nbsp;<span class="op" id="6938013">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938016">benchmarkDecode</span><span class="op" id="6938031">(</span><span class="ident" id="6938032">b</span><span class="op" id="6938033">,</span>&nbsp;<span class="string" id="6938035">&#34;testdata/benchNRGBA-gradient.png&#34;</span><span class="op" id="6938069">,</span>&nbsp;<span class="num" id="6938071">4</span><span class="op" id="6938072">)</span><br>
<span class="lineno"></span><span class="op" id="6938074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6938077">func</span>&nbsp;<span class="ident" id="6938082">BenchmarkDecodeNRGBAOpaque</span><span class="op" id="6938108">(</span><span class="ident" id="6938109">b</span>&nbsp;<span class="op" id="6938111">*</span><span class="ident" id="6938112">testing</span><span class="op" id="6938119">.</span><span class="ident" id="6938120">B</span><span class="op" id="6938121">)</span>&nbsp;<span class="op" id="6938123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938126">benchmarkDecode</span><span class="op" id="6938141">(</span><span class="ident" id="6938142">b</span><span class="op" id="6938143">,</span>&nbsp;<span class="string" id="6938145">&#34;testdata/benchNRGBA-opaque.png&#34;</span><span class="op" id="6938177">,</span>&nbsp;<span class="num" id="6938179">4</span><span class="op" id="6938180">)</span><br>
<span class="lineno">350</span><span class="op" id="6938182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6938185">func</span>&nbsp;<span class="ident" id="6938190">BenchmarkDecodePaletted</span><span class="op" id="6938213">(</span><span class="ident" id="6938214">b</span>&nbsp;<span class="op" id="6938216">*</span><span class="ident" id="6938217">testing</span><span class="op" id="6938224">.</span><span class="ident" id="6938225">B</span><span class="op" id="6938226">)</span>&nbsp;<span class="op" id="6938228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938231">benchmarkDecode</span><span class="op" id="6938246">(</span><span class="ident" id="6938247">b</span><span class="op" id="6938248">,</span>&nbsp;<span class="string" id="6938250">&#34;testdata/benchPaletted.png&#34;</span><span class="op" id="6938278">,</span>&nbsp;<span class="num" id="6938280">1</span><span class="op" id="6938281">)</span><br>
<span class="lineno"></span><span class="op" id="6938283">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="keyword" id="6938286">func</span>&nbsp;<span class="ident" id="6938291">BenchmarkDecodeRGB</span><span class="op" id="6938309">(</span><span class="ident" id="6938310">b</span>&nbsp;<span class="op" id="6938312">*</span><span class="ident" id="6938313">testing</span><span class="op" id="6938320">.</span><span class="ident" id="6938321">B</span><span class="op" id="6938322">)</span>&nbsp;<span class="op" id="6938324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938327">benchmarkDecode</span><span class="op" id="6938342">(</span><span class="ident" id="6938343">b</span><span class="op" id="6938344">,</span>&nbsp;<span class="string" id="6938346">&#34;testdata/benchRGB.png&#34;</span><span class="op" id="6938369">,</span>&nbsp;<span class="num" id="6938371">4</span><span class="op" id="6938372">)</span><br>
<span class="lineno"></span><span class="op" id="6938374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="6938377">func</span>&nbsp;<span class="ident" id="6938382">BenchmarkDecodeInterlacing</span><span class="op" id="6938408">(</span><span class="ident" id="6938409">b</span>&nbsp;<span class="op" id="6938411">*</span><span class="ident" id="6938412">testing</span><span class="op" id="6938419">.</span><span class="ident" id="6938420">B</span><span class="op" id="6938421">)</span>&nbsp;<span class="op" id="6938423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938426">benchmarkDecode</span><span class="op" id="6938441">(</span><span class="ident" id="6938442">b</span><span class="op" id="6938443">,</span>&nbsp;<span class="string" id="6938445">&#34;testdata/benchRGB-interlace.png&#34;</span><span class="op" id="6938478">,</span>&nbsp;<span class="num" id="6938480">4</span><span class="op" id="6938481">)</span><br>
<span class="lineno"></span><span class="op" id="6938483">}</span>
</div>
</body>
</html>
