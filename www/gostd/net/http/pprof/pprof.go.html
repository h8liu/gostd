<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html" class="current">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3461966">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3462022">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3462076">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3462127">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="3462194">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="3462253">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="3462294">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="3462341">//</span><br>
<span class="lineno">10</span><span class="comment" id="3462344">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3462409">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="3462443">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="3462494">//</span><br>
<span class="lineno"></span><span class="comment" id="3462497">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="3462551">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3462580">//</span><br>
<span class="lineno"></span><span class="comment" id="3462583">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="3462649">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3462717">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="3462762">//</span><br>
<span class="lineno"></span><span class="comment" id="3462765">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="3462781">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="3462842">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="3462850">//</span><br>
<span class="lineno">25</span><span class="comment" id="3462853">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="3462909">//</span><br>
<span class="lineno"></span><span class="comment" id="3462912">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="3462968">//</span><br>
<span class="lineno"></span><span class="comment" id="3462971">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="3463013">//</span><br>
<span class="lineno"></span><span class="comment" id="3463016">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="3463075">//</span><br>
<span class="lineno"></span><span class="comment" id="3463078">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="3463127">//</span><br>
<span class="lineno">35</span><span class="comment" id="3463130">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="3463187">//</span><br>
<span class="lineno"></span><span class="comment" id="3463190">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="3463265">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="3463285">//</span><br>
<span class="lineno">40</span><span class="comment" id="3463288">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="3463336">//</span><br>
<span class="lineno"></span><span class="comment" id="3463339">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="3463400">//</span><br>
<span class="lineno"></span><span class="keyword" id="3463403">package</span>&nbsp;<span class="ident" id="3463411">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3463418">import</span>&nbsp;<span class="op" id="3463425">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463428">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463437">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463446">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463453">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463470">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463476">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463483">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463495">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463501">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463512">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463529">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463540">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3463551">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="3463558">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3463561">func</span>&nbsp;<span class="ident" id="3463566">init</span><span class="op" id="3463570">(</span><span class="op" id="3463571">)</span>&nbsp;<span class="op" id="3463573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463576">http</span><span class="op" id="3463580">.</span><span class="ident" id="3463581">Handle</span><span class="op" id="3463587">(</span><span class="string" id="3463588">&#34;/debug/pprof/&#34;</span><span class="op" id="3463603">,</span>&nbsp;<span class="ident" id="3463605">http</span><span class="op" id="3463609">.</span><span class="ident" id="3463610">HandlerFunc</span><span class="op" id="3463621">(</span><span class="ident" id="3463622">Index</span><span class="op" id="3463627">)</span><span class="op" id="3463628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463631">http</span><span class="op" id="3463635">.</span><span class="ident" id="3463636">Handle</span><span class="op" id="3463642">(</span><span class="string" id="3463643">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="3463665">,</span>&nbsp;<span class="ident" id="3463667">http</span><span class="op" id="3463671">.</span><span class="ident" id="3463672">HandlerFunc</span><span class="op" id="3463683">(</span><span class="ident" id="3463684">Cmdline</span><span class="op" id="3463691">)</span><span class="op" id="3463692">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463695">http</span><span class="op" id="3463699">.</span><span class="ident" id="3463700">Handle</span><span class="op" id="3463706">(</span><span class="string" id="3463707">&#34;/debug/pprof/profile&#34;</span><span class="op" id="3463729">,</span>&nbsp;<span class="ident" id="3463731">http</span><span class="op" id="3463735">.</span><span class="ident" id="3463736">HandlerFunc</span><span class="op" id="3463747">(</span><span class="ident" id="3463748">Profile</span><span class="op" id="3463755">)</span><span class="op" id="3463756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3463759">http</span><span class="op" id="3463763">.</span><span class="ident" id="3463764">Handle</span><span class="op" id="3463770">(</span><span class="string" id="3463771">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="3463792">,</span>&nbsp;<span class="ident" id="3463794">http</span><span class="op" id="3463798">.</span><span class="ident" id="3463799">HandlerFunc</span><span class="op" id="3463810">(</span><span class="ident" id="3463811">Symbol</span><span class="op" id="3463817">)</span><span class="op" id="3463818">)</span><br>
<span class="lineno"></span><span class="op" id="3463820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3463823">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="3463870">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="3463926">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="3463994">func</span>&nbsp;<span class="ident" id="3463999">Cmdline</span><span class="op" id="3464006">(</span><span class="ident" id="3464007">w</span>&nbsp;<span class="ident" id="3464009">http</span><span class="op" id="3464013">.</span><span class="ident" id="3464014">ResponseWriter</span><span class="op" id="3464028">,</span>&nbsp;<span class="ident" id="3464030">r</span>&nbsp;<span class="op" id="3464032">*</span><span class="ident" id="3464033">http</span><span class="op" id="3464037">.</span><span class="ident" id="3464038">Request</span><span class="op" id="3464045">)</span>&nbsp;<span class="op" id="3464047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464050">w</span><span class="op" id="3464051">.</span><span class="ident" id="3464052">Header</span><span class="op" id="3464058">(</span><span class="op" id="3464059">)</span><span class="op" id="3464060">.</span><span class="ident" id="3464061">Set</span><span class="op" id="3464064">(</span><span class="string" id="3464065">&#34;Content-Type&#34;</span><span class="op" id="3464079">,</span>&nbsp;<span class="string" id="3464081">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3464108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464111">fmt</span><span class="op" id="3464114">.</span><span class="ident" id="3464115">Fprintf</span><span class="op" id="3464122">(</span><span class="ident" id="3464123">w</span><span class="op" id="3464124">,</span>&nbsp;<span class="ident" id="3464126">strings</span><span class="op" id="3464133">.</span><span class="ident" id="3464134">Join</span><span class="op" id="3464138">(</span><span class="ident" id="3464139">os</span><span class="op" id="3464141">.</span><span class="ident" id="3464142">Args</span><span class="op" id="3464146">,</span>&nbsp;<span class="string" id="3464148">&#34;\x00&#34;</span><span class="op" id="3464154">)</span><span class="op" id="3464155">)</span><br>
<span class="lineno">75</span><span class="op" id="3464157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3464160">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="3464218">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="3464286">func</span>&nbsp;<span class="ident" id="3464291">Profile</span><span class="op" id="3464298">(</span><span class="ident" id="3464299">w</span>&nbsp;<span class="ident" id="3464301">http</span><span class="op" id="3464305">.</span><span class="ident" id="3464306">ResponseWriter</span><span class="op" id="3464320">,</span>&nbsp;<span class="ident" id="3464322">r</span>&nbsp;<span class="op" id="3464324">*</span><span class="ident" id="3464325">http</span><span class="op" id="3464329">.</span><span class="ident" id="3464330">Request</span><span class="op" id="3464337">)</span>&nbsp;<span class="op" id="3464339">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464342">sec</span><span class="op" id="3464345">,</span>&nbsp;<span class="ident" id="3464347">_</span>&nbsp;<span class="op" id="3464349">:=</span>&nbsp;<span class="ident" id="3464352">strconv</span><span class="op" id="3464359">.</span><span class="ident" id="3464360">ParseInt</span><span class="op" id="3464368">(</span><span class="ident" id="3464369">r</span><span class="op" id="3464370">.</span><span class="ident" id="3464371">FormValue</span><span class="op" id="3464380">(</span><span class="string" id="3464381">&#34;seconds&#34;</span><span class="op" id="3464390">)</span><span class="op" id="3464391">,</span>&nbsp;<span class="num" id="3464393">10</span><span class="op" id="3464395">,</span>&nbsp;<span class="num" id="3464397">64</span><span class="op" id="3464399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464402">if</span>&nbsp;<span class="ident" id="3464405">sec</span>&nbsp;<span class="op" id="3464409">==</span>&nbsp;<span class="num" id="3464412">0</span>&nbsp;<span class="op" id="3464414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464418">sec</span>&nbsp;<span class="op" id="3464422">=</span>&nbsp;<span class="num" id="3464424">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3464428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464432">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464489">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464531">w</span><span class="op" id="3464532">.</span><span class="ident" id="3464533">Header</span><span class="op" id="3464539">(</span><span class="op" id="3464540">)</span><span class="op" id="3464541">.</span><span class="ident" id="3464542">Set</span><span class="op" id="3464545">(</span><span class="string" id="3464546">&#34;Content-Type&#34;</span><span class="op" id="3464560">,</span>&nbsp;<span class="string" id="3464562">&#34;application/octet-stream&#34;</span><span class="op" id="3464588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464591">if</span>&nbsp;<span class="ident" id="3464594">err</span>&nbsp;<span class="op" id="3464598">:=</span>&nbsp;<span class="ident" id="3464601">pprof</span><span class="op" id="3464606">.</span><span class="ident" id="3464607">StartCPUProfile</span><span class="op" id="3464622">(</span><span class="ident" id="3464623">w</span><span class="op" id="3464624">)</span><span class="op" id="3464625">;</span>&nbsp;<span class="ident" id="3464627">err</span>&nbsp;<span class="op" id="3464631">!=</span>&nbsp;<span class="ident" id="3464634">nil</span>&nbsp;<span class="op" id="3464638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464642">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464689">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3464733">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464759">w</span><span class="op" id="3464760">.</span><span class="ident" id="3464761">Header</span><span class="op" id="3464767">(</span><span class="op" id="3464768">)</span><span class="op" id="3464769">.</span><span class="ident" id="3464770">Set</span><span class="op" id="3464773">(</span><span class="string" id="3464774">&#34;Content-Type&#34;</span><span class="op" id="3464788">,</span>&nbsp;<span class="string" id="3464790">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3464817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464821">w</span><span class="op" id="3464822">.</span><span class="ident" id="3464823">WriteHeader</span><span class="op" id="3464834">(</span><span class="ident" id="3464835">http</span><span class="op" id="3464839">.</span><span class="ident" id="3464840">StatusInternalServerError</span><span class="op" id="3464865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464869">fmt</span><span class="op" id="3464872">.</span><span class="ident" id="3464873">Fprintf</span><span class="op" id="3464880">(</span><span class="ident" id="3464881">w</span><span class="op" id="3464882">,</span>&nbsp;<span class="string" id="3464884">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="3464922">,</span>&nbsp;<span class="ident" id="3464924">err</span><span class="op" id="3464927">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3464931">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3464939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464942">time</span><span class="op" id="3464946">.</span><span class="ident" id="3464947">Sleep</span><span class="op" id="3464952">(</span><span class="ident" id="3464953">time</span><span class="op" id="3464957">.</span><span class="ident" id="3464958">Duration</span><span class="op" id="3464966">(</span><span class="ident" id="3464967">sec</span><span class="op" id="3464970">)</span>&nbsp;<span class="op" id="3464972">*</span>&nbsp;<span class="ident" id="3464974">time</span><span class="op" id="3464978">.</span><span class="ident" id="3464979">Second</span><span class="op" id="3464985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3464988">pprof</span><span class="op" id="3464993">.</span><span class="ident" id="3464994">StopCPUProfile</span><span class="op" id="3465008">(</span><span class="op" id="3465009">)</span><br>
<span class="lineno"></span><span class="op" id="3465011">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3465014">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="3465077">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="3465148">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="3465215">func</span>&nbsp;<span class="ident" id="3465220">Symbol</span><span class="op" id="3465226">(</span><span class="ident" id="3465227">w</span>&nbsp;<span class="ident" id="3465229">http</span><span class="op" id="3465233">.</span><span class="ident" id="3465234">ResponseWriter</span><span class="op" id="3465248">,</span>&nbsp;<span class="ident" id="3465250">r</span>&nbsp;<span class="op" id="3465252">*</span><span class="ident" id="3465253">http</span><span class="op" id="3465257">.</span><span class="ident" id="3465258">Request</span><span class="op" id="3465265">)</span>&nbsp;<span class="op" id="3465267">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465270">w</span><span class="op" id="3465271">.</span><span class="ident" id="3465272">Header</span><span class="op" id="3465278">(</span><span class="op" id="3465279">)</span><span class="op" id="3465280">.</span><span class="ident" id="3465281">Set</span><span class="op" id="3465284">(</span><span class="string" id="3465285">&#34;Content-Type&#34;</span><span class="op" id="3465299">,</span>&nbsp;<span class="string" id="3465301">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3465328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3465332">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3465379">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465428">var</span>&nbsp;<span class="ident" id="3465432">buf</span>&nbsp;<span class="ident" id="3465436">bytes</span><span class="op" id="3465441">.</span><span class="ident" id="3465442">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3465451">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3465502">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3465560">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465612">fmt</span><span class="op" id="3465615">.</span><span class="ident" id="3465616">Fprintf</span><span class="op" id="3465623">(</span><span class="op" id="3465624">&amp;</span><span class="ident" id="3465625">buf</span><span class="op" id="3465628">,</span>&nbsp;<span class="string" id="3465630">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="3465648">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465652">var</span>&nbsp;<span class="ident" id="3465656">b</span>&nbsp;<span class="op" id="3465658">*</span><span class="ident" id="3465659">bufio</span><span class="op" id="3465664">.</span><span class="ident" id="3465665">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465673">if</span>&nbsp;<span class="ident" id="3465676">r</span><span class="op" id="3465677">.</span><span class="ident" id="3465678">Method</span>&nbsp;<span class="op" id="3465685">==</span>&nbsp;<span class="string" id="3465688">&#34;POST&#34;</span>&nbsp;<span class="op" id="3465695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465699">b</span>&nbsp;<span class="op" id="3465701">=</span>&nbsp;<span class="ident" id="3465703">bufio</span><span class="op" id="3465708">.</span><span class="ident" id="3465709">NewReader</span><span class="op" id="3465718">(</span><span class="ident" id="3465719">r</span><span class="op" id="3465720">.</span><span class="ident" id="3465721">Body</span><span class="op" id="3465725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465728">}</span>&nbsp;<span class="keyword" id="3465730">else</span>&nbsp;<span class="op" id="3465735">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465739">b</span>&nbsp;<span class="op" id="3465741">=</span>&nbsp;<span class="ident" id="3465743">bufio</span><span class="op" id="3465748">.</span><span class="ident" id="3465749">NewReader</span><span class="op" id="3465758">(</span><span class="ident" id="3465759">strings</span><span class="op" id="3465766">.</span><span class="ident" id="3465767">NewReader</span><span class="op" id="3465776">(</span><span class="ident" id="3465777">r</span><span class="op" id="3465778">.</span><span class="ident" id="3465779">URL</span><span class="op" id="3465782">.</span><span class="ident" id="3465783">RawQuery</span><span class="op" id="3465791">)</span><span class="op" id="3465792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465799">for</span>&nbsp;<span class="op" id="3465803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465807">word</span><span class="op" id="3465811">,</span>&nbsp;<span class="ident" id="3465813">err</span>&nbsp;<span class="op" id="3465817">:=</span>&nbsp;<span class="ident" id="3465820">b</span><span class="op" id="3465821">.</span><span class="ident" id="3465822">ReadSlice</span><span class="op" id="3465831">(</span><span class="string" id="3465832">&#39;+&#39;</span><span class="op" id="3465835">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465839">if</span>&nbsp;<span class="ident" id="3465842">err</span>&nbsp;<span class="op" id="3465846">==</span>&nbsp;<span class="ident" id="3465849">nil</span>&nbsp;<span class="op" id="3465853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465858">word</span>&nbsp;<span class="op" id="3465863">=</span>&nbsp;<span class="ident" id="3465865">word</span><span class="op" id="3465869">[</span><span class="num" id="3465870">0</span>&nbsp;<span class="op" id="3465872">:</span>&nbsp;<span class="builtinfunc" id="3465874">len</span><span class="op" id="3465877">(</span><span class="ident" id="3465878">word</span><span class="op" id="3465882">)</span><span class="op" id="3465883">-</span><span class="num" id="3465884">1</span><span class="op" id="3465885">]</span>&nbsp;<span class="comment" id="3465887">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3465899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465903">pc</span><span class="op" id="3465905">,</span>&nbsp;<span class="ident" id="3465907">_</span>&nbsp;<span class="op" id="3465909">:=</span>&nbsp;<span class="ident" id="3465912">strconv</span><span class="op" id="3465919">.</span><span class="ident" id="3465920">ParseUint</span><span class="op" id="3465929">(</span><span class="builtintype" id="3465930">string</span><span class="op" id="3465936">(</span><span class="ident" id="3465937">word</span><span class="op" id="3465941">)</span><span class="op" id="3465942">,</span>&nbsp;<span class="num" id="3465944">0</span><span class="op" id="3465945">,</span>&nbsp;<span class="num" id="3465947">64</span><span class="op" id="3465949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3465953">if</span>&nbsp;<span class="ident" id="3465956">pc</span>&nbsp;<span class="op" id="3465959">!=</span>&nbsp;<span class="num" id="3465962">0</span>&nbsp;<span class="op" id="3465964">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3465969">f</span>&nbsp;<span class="op" id="3465971">:=</span>&nbsp;<span class="ident" id="3465974">runtime</span><span class="op" id="3465981">.</span><span class="ident" id="3465982">FuncForPC</span><span class="op" id="3465991">(</span><span class="builtintype" id="3465992">uintptr</span><span class="op" id="3465999">(</span><span class="ident" id="3466000">pc</span><span class="op" id="3466002">)</span><span class="op" id="3466003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466008">if</span>&nbsp;<span class="ident" id="3466011">f</span>&nbsp;<span class="op" id="3466013">!=</span>&nbsp;<span class="ident" id="3466016">nil</span>&nbsp;<span class="op" id="3466020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466026">fmt</span><span class="op" id="3466029">.</span><span class="ident" id="3466030">Fprintf</span><span class="op" id="3466037">(</span><span class="op" id="3466038">&amp;</span><span class="ident" id="3466039">buf</span><span class="op" id="3466042">,</span>&nbsp;<span class="string" id="3466044">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="3466054">,</span>&nbsp;<span class="ident" id="3466056">pc</span><span class="op" id="3466058">,</span>&nbsp;<span class="ident" id="3466060">f</span><span class="op" id="3466061">.</span><span class="ident" id="3466062">Name</span><span class="op" id="3466066">(</span><span class="op" id="3466067">)</span><span class="op" id="3466068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466077">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3466082">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3466130">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466188">if</span>&nbsp;<span class="ident" id="3466191">err</span>&nbsp;<span class="op" id="3466195">!=</span>&nbsp;<span class="ident" id="3466198">nil</span>&nbsp;<span class="op" id="3466202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466207">if</span>&nbsp;<span class="ident" id="3466210">err</span>&nbsp;<span class="op" id="3466214">!=</span>&nbsp;<span class="ident" id="3466217">io</span><span class="op" id="3466219">.</span><span class="ident" id="3466220">EOF</span>&nbsp;<span class="op" id="3466224">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466230">fmt</span><span class="op" id="3466233">.</span><span class="ident" id="3466234">Fprintf</span><span class="op" id="3466241">(</span><span class="op" id="3466242">&amp;</span><span class="ident" id="3466243">buf</span><span class="op" id="3466246">,</span>&nbsp;<span class="string" id="3466248">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="3466271">,</span>&nbsp;<span class="ident" id="3466273">err</span><span class="op" id="3466276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466286">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466297">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466301">w</span><span class="op" id="3466302">.</span><span class="ident" id="3466303">Write</span><span class="op" id="3466308">(</span><span class="ident" id="3466309">buf</span><span class="op" id="3466312">.</span><span class="ident" id="3466313">Bytes</span><span class="op" id="3466318">(</span><span class="op" id="3466319">)</span><span class="op" id="3466320">)</span><br>
<span class="lineno"></span><span class="op" id="3466322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466325">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="3466391">func</span>&nbsp;<span class="ident" id="3466396">Handler</span><span class="op" id="3466403">(</span><span class="ident" id="3466404">name</span>&nbsp;<span class="builtintype" id="3466409">string</span><span class="op" id="3466415">)</span>&nbsp;<span class="ident" id="3466417">http</span><span class="op" id="3466421">.</span><span class="ident" id="3466422">Handler</span>&nbsp;<span class="op" id="3466430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466433">return</span>&nbsp;<span class="ident" id="3466440">handler</span><span class="op" id="3466447">(</span><span class="ident" id="3466448">name</span><span class="op" id="3466452">)</span><br>
<span class="lineno"></span><span class="op" id="3466454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3466457">type</span>&nbsp;<span class="ident" id="3466462">handler</span>&nbsp;<span class="builtintype" id="3466470">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="3466478">func</span>&nbsp;<span class="op" id="3466483">(</span><span class="ident" id="3466484">name</span>&nbsp;<span class="ident" id="3466489">handler</span><span class="op" id="3466496">)</span>&nbsp;<span class="ident" id="3466498">ServeHTTP</span><span class="op" id="3466507">(</span><span class="ident" id="3466508">w</span>&nbsp;<span class="ident" id="3466510">http</span><span class="op" id="3466514">.</span><span class="ident" id="3466515">ResponseWriter</span><span class="op" id="3466529">,</span>&nbsp;<span class="ident" id="3466531">r</span>&nbsp;<span class="op" id="3466533">*</span><span class="ident" id="3466534">http</span><span class="op" id="3466538">.</span><span class="ident" id="3466539">Request</span><span class="op" id="3466546">)</span>&nbsp;<span class="op" id="3466548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466551">w</span><span class="op" id="3466552">.</span><span class="ident" id="3466553">Header</span><span class="op" id="3466559">(</span><span class="op" id="3466560">)</span><span class="op" id="3466561">.</span><span class="ident" id="3466562">Set</span><span class="op" id="3466565">(</span><span class="string" id="3466566">&#34;Content-Type&#34;</span><span class="op" id="3466580">,</span>&nbsp;<span class="string" id="3466582">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="3466609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466612">debug</span><span class="op" id="3466617">,</span>&nbsp;<span class="ident" id="3466619">_</span>&nbsp;<span class="op" id="3466621">:=</span>&nbsp;<span class="ident" id="3466624">strconv</span><span class="op" id="3466631">.</span><span class="ident" id="3466632">Atoi</span><span class="op" id="3466636">(</span><span class="ident" id="3466637">r</span><span class="op" id="3466638">.</span><span class="ident" id="3466639">FormValue</span><span class="op" id="3466648">(</span><span class="string" id="3466649">&#34;debug&#34;</span><span class="op" id="3466656">)</span><span class="op" id="3466657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466660">p</span>&nbsp;<span class="op" id="3466662">:=</span>&nbsp;<span class="ident" id="3466665">pprof</span><span class="op" id="3466670">.</span><span class="ident" id="3466671">Lookup</span><span class="op" id="3466677">(</span><span class="builtintype" id="3466678">string</span><span class="op" id="3466684">(</span><span class="ident" id="3466685">name</span><span class="op" id="3466689">)</span><span class="op" id="3466690">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466693">if</span>&nbsp;<span class="ident" id="3466696">p</span>&nbsp;<span class="op" id="3466698">==</span>&nbsp;<span class="ident" id="3466701">nil</span>&nbsp;<span class="op" id="3466705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466709">w</span><span class="op" id="3466710">.</span><span class="ident" id="3466711">WriteHeader</span><span class="op" id="3466722">(</span><span class="num" id="3466723">404</span><span class="op" id="3466726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466730">fmt</span><span class="op" id="3466733">.</span><span class="ident" id="3466734">Fprintf</span><span class="op" id="3466741">(</span><span class="ident" id="3466742">w</span><span class="op" id="3466743">,</span>&nbsp;<span class="string" id="3466745">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="3466768">,</span>&nbsp;<span class="ident" id="3466770">name</span><span class="op" id="3466774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466778">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466786">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466789">gc</span><span class="op" id="3466791">,</span>&nbsp;<span class="ident" id="3466793">_</span>&nbsp;<span class="op" id="3466795">:=</span>&nbsp;<span class="ident" id="3466798">strconv</span><span class="op" id="3466805">.</span><span class="ident" id="3466806">Atoi</span><span class="op" id="3466810">(</span><span class="ident" id="3466811">r</span><span class="op" id="3466812">.</span><span class="ident" id="3466813">FormValue</span><span class="op" id="3466822">(</span><span class="string" id="3466823">&#34;gc&#34;</span><span class="op" id="3466827">)</span><span class="op" id="3466828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466831">if</span>&nbsp;<span class="ident" id="3466834">name</span>&nbsp;<span class="op" id="3466839">==</span>&nbsp;<span class="string" id="3466842">&#34;heap&#34;</span>&nbsp;<span class="op" id="3466849">&amp;&amp;</span>&nbsp;<span class="ident" id="3466852">gc</span>&nbsp;<span class="op" id="3466855">&gt;</span>&nbsp;<span class="num" id="3466857">0</span>&nbsp;<span class="op" id="3466859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466863">runtime</span><span class="op" id="3466870">.</span><span class="ident" id="3466871">GC</span><span class="op" id="3466873">(</span><span class="op" id="3466874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3466877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3466880">p</span><span class="op" id="3466881">.</span><span class="ident" id="3466882">WriteTo</span><span class="op" id="3466889">(</span><span class="ident" id="3466890">w</span><span class="op" id="3466891">,</span>&nbsp;<span class="ident" id="3466893">debug</span><span class="op" id="3466898">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3466901">return</span><br>
<span class="lineno"></span><span class="op" id="3466908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3466911">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3466984">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="3467047">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="3467116">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="3467151">func</span>&nbsp;<span class="ident" id="3467156">Index</span><span class="op" id="3467161">(</span><span class="ident" id="3467162">w</span>&nbsp;<span class="ident" id="3467164">http</span><span class="op" id="3467168">.</span><span class="ident" id="3467169">ResponseWriter</span><span class="op" id="3467183">,</span>&nbsp;<span class="ident" id="3467185">r</span>&nbsp;<span class="op" id="3467187">*</span><span class="ident" id="3467188">http</span><span class="op" id="3467192">.</span><span class="ident" id="3467193">Request</span><span class="op" id="3467200">)</span>&nbsp;<span class="op" id="3467202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467205">if</span>&nbsp;<span class="ident" id="3467208">strings</span><span class="op" id="3467215">.</span><span class="ident" id="3467216">HasPrefix</span><span class="op" id="3467225">(</span><span class="ident" id="3467226">r</span><span class="op" id="3467227">.</span><span class="ident" id="3467228">URL</span><span class="op" id="3467231">.</span><span class="ident" id="3467232">Path</span><span class="op" id="3467236">,</span>&nbsp;<span class="string" id="3467238">&#34;/debug/pprof/&#34;</span><span class="op" id="3467253">)</span>&nbsp;<span class="op" id="3467255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467259">name</span>&nbsp;<span class="op" id="3467264">:=</span>&nbsp;<span class="ident" id="3467267">strings</span><span class="op" id="3467274">.</span><span class="ident" id="3467275">TrimPrefix</span><span class="op" id="3467285">(</span><span class="ident" id="3467286">r</span><span class="op" id="3467287">.</span><span class="ident" id="3467288">URL</span><span class="op" id="3467291">.</span><span class="ident" id="3467292">Path</span><span class="op" id="3467296">,</span>&nbsp;<span class="string" id="3467298">&#34;/debug/pprof/&#34;</span><span class="op" id="3467313">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467317">if</span>&nbsp;<span class="ident" id="3467320">name</span>&nbsp;<span class="op" id="3467325">!=</span>&nbsp;<span class="string" id="3467328">&#34;&#34;</span>&nbsp;<span class="op" id="3467331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467336">handler</span><span class="op" id="3467343">(</span><span class="ident" id="3467344">name</span><span class="op" id="3467348">)</span><span class="op" id="3467349">.</span><span class="ident" id="3467350">ServeHTTP</span><span class="op" id="3467359">(</span><span class="ident" id="3467360">w</span><span class="op" id="3467361">,</span>&nbsp;<span class="ident" id="3467363">r</span><span class="op" id="3467364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467369">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467381">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467385">profiles</span>&nbsp;<span class="op" id="3467394">:=</span>&nbsp;<span class="ident" id="3467397">pprof</span><span class="op" id="3467402">.</span><span class="ident" id="3467403">Profiles</span><span class="op" id="3467411">(</span><span class="op" id="3467412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3467415">if</span>&nbsp;<span class="ident" id="3467418">err</span>&nbsp;<span class="op" id="3467422">:=</span>&nbsp;<span class="ident" id="3467425">indexTmpl</span><span class="op" id="3467434">.</span><span class="ident" id="3467435">Execute</span><span class="op" id="3467442">(</span><span class="ident" id="3467443">w</span><span class="op" id="3467444">,</span>&nbsp;<span class="ident" id="3467446">profiles</span><span class="op" id="3467454">)</span><span class="op" id="3467455">;</span>&nbsp;<span class="ident" id="3467457">err</span>&nbsp;<span class="op" id="3467461">!=</span>&nbsp;<span class="ident" id="3467464">nil</span>&nbsp;<span class="op" id="3467468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3467472">log</span><span class="op" id="3467475">.</span><span class="ident" id="3467476">Print</span><span class="op" id="3467481">(</span><span class="ident" id="3467482">err</span><span class="op" id="3467485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3467488">}</span><br>
<span class="lineno">190</span><span class="op" id="3467490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3467493">var</span>&nbsp;<span class="ident" id="3467497">indexTmpl</span>&nbsp;<span class="op" id="3467507">=</span>&nbsp;<span class="ident" id="3467509">template</span><span class="op" id="3467517">.</span><span class="ident" id="3467518">Must</span><span class="op" id="3467522">(</span><span class="ident" id="3467523">template</span><span class="op" id="3467531">.</span><span class="ident" id="3467532">New</span><span class="op" id="3467535">(</span><span class="string" id="3467536">&#34;index&#34;</span><span class="op" id="3467543">)</span><span class="op" id="3467544">.</span><span class="ident" id="3467545">Parse</span><span class="op" id="3467550">(</span><span class="string" id="3467551">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="3467870">)</span><span class="op" id="3467871">)</span>
</div>
</body>
</html>
