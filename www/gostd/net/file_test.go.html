<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6595065">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6595120">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6595174">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6595225">package</span>&nbsp;<span class="ident" id="6595233">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595238">import</span>&nbsp;<span class="op" id="6595245">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6595248">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6595254">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6595265">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6595276">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6595286">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595289">type</span>&nbsp;<span class="ident" id="6595294">listenerFile</span>&nbsp;<span class="keyword" id="6595307">interface</span>&nbsp;<span class="op" id="6595317">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595320">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595330">File</span><span class="op" id="6595334">(</span><span class="op" id="6595335">)</span>&nbsp;<span class="op" id="6595337">(</span><span class="ident" id="6595338">f</span>&nbsp;<span class="op" id="6595340">*</span><span class="ident" id="6595341">os</span><span class="op" id="6595343">.</span><span class="ident" id="6595344">File</span><span class="op" id="6595348">,</span>&nbsp;<span class="ident" id="6595350">err</span>&nbsp;<span class="builtintype" id="6595354">error</span><span class="op" id="6595359">)</span><br>
<span class="lineno"></span><span class="op" id="6595361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595364">type</span>&nbsp;<span class="ident" id="6595369">packetConnFile</span>&nbsp;<span class="keyword" id="6595384">interface</span>&nbsp;<span class="op" id="6595394">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595397">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595409">File</span><span class="op" id="6595413">(</span><span class="op" id="6595414">)</span>&nbsp;<span class="op" id="6595416">(</span><span class="ident" id="6595417">f</span>&nbsp;<span class="op" id="6595419">*</span><span class="ident" id="6595420">os</span><span class="op" id="6595422">.</span><span class="ident" id="6595423">File</span><span class="op" id="6595427">,</span>&nbsp;<span class="ident" id="6595429">err</span>&nbsp;<span class="builtintype" id="6595433">error</span><span class="op" id="6595438">)</span><br>
<span class="lineno"></span><span class="op" id="6595440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595443">type</span>&nbsp;<span class="ident" id="6595448">connFile</span>&nbsp;<span class="keyword" id="6595457">interface</span>&nbsp;<span class="op" id="6595467">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595470">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595476">File</span><span class="op" id="6595480">(</span><span class="op" id="6595481">)</span>&nbsp;<span class="op" id="6595483">(</span><span class="ident" id="6595484">f</span>&nbsp;<span class="op" id="6595486">*</span><span class="ident" id="6595487">os</span><span class="op" id="6595489">.</span><span class="ident" id="6595490">File</span><span class="op" id="6595494">,</span>&nbsp;<span class="ident" id="6595496">err</span>&nbsp;<span class="builtintype" id="6595500">error</span><span class="op" id="6595505">)</span><br>
<span class="lineno"></span><span class="op" id="6595507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595510">func</span>&nbsp;<span class="ident" id="6595515">testFileListener</span><span class="op" id="6595531">(</span><span class="ident" id="6595532">t</span>&nbsp;<span class="op" id="6595534">*</span><span class="ident" id="6595535">testing</span><span class="op" id="6595542">.</span><span class="ident" id="6595543">T</span><span class="op" id="6595544">,</span>&nbsp;<span class="ident" id="6595546">net</span><span class="op" id="6595549">,</span>&nbsp;<span class="ident" id="6595551">laddr</span>&nbsp;<span class="builtintype" id="6595557">string</span><span class="op" id="6595563">)</span>&nbsp;<span class="op" id="6595565">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595568">switch</span>&nbsp;<span class="ident" id="6595575">net</span>&nbsp;<span class="op" id="6595579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595582">case</span>&nbsp;<span class="string" id="6595587">&#34;tcp&#34;</span><span class="op" id="6595592">,</span>&nbsp;<span class="string" id="6595594">&#34;tcp4&#34;</span><span class="op" id="6595600">,</span>&nbsp;<span class="string" id="6595602">&#34;tcp6&#34;</span><span class="op" id="6595608">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595612">laddr</span>&nbsp;<span class="op" id="6595618">+=</span>&nbsp;<span class="string" id="6595621">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6595626">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595652">l</span><span class="op" id="6595653">,</span>&nbsp;<span class="ident" id="6595655">err</span>&nbsp;<span class="op" id="6595659">:=</span>&nbsp;<span class="ident" id="6595662">Listen</span><span class="op" id="6595668">(</span><span class="ident" id="6595669">net</span><span class="op" id="6595672">,</span>&nbsp;<span class="ident" id="6595674">laddr</span><span class="op" id="6595679">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595682">if</span>&nbsp;<span class="ident" id="6595685">err</span>&nbsp;<span class="op" id="6595689">!=</span>&nbsp;<span class="ident" id="6595692">nil</span>&nbsp;<span class="op" id="6595696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595700">t</span><span class="op" id="6595701">.</span><span class="ident" id="6595702">Fatalf</span><span class="op" id="6595708">(</span><span class="string" id="6595709">&#34;Listen&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6595728">,</span>&nbsp;<span class="ident" id="6595730">err</span><span class="op" id="6595733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595739">defer</span>&nbsp;<span class="ident" id="6595745">l</span><span class="op" id="6595746">.</span><span class="ident" id="6595747">Close</span><span class="op" id="6595752">(</span><span class="op" id="6595753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595756">lf</span>&nbsp;<span class="op" id="6595759">:=</span>&nbsp;<span class="ident" id="6595762">l</span><span class="op" id="6595763">.</span><span class="op" id="6595764">(</span><span class="ident" id="6595765">listenerFile</span><span class="op" id="6595777">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595780">f</span><span class="op" id="6595781">,</span>&nbsp;<span class="ident" id="6595783">err</span>&nbsp;<span class="op" id="6595787">:=</span>&nbsp;<span class="ident" id="6595790">lf</span><span class="op" id="6595792">.</span><span class="ident" id="6595793">File</span><span class="op" id="6595797">(</span><span class="op" id="6595798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595801">if</span>&nbsp;<span class="ident" id="6595804">err</span>&nbsp;<span class="op" id="6595808">!=</span>&nbsp;<span class="ident" id="6595811">nil</span>&nbsp;<span class="op" id="6595815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595819">t</span><span class="op" id="6595820">.</span><span class="ident" id="6595821">Fatalf</span><span class="op" id="6595827">(</span><span class="string" id="6595828">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6595845">,</span>&nbsp;<span class="ident" id="6595847">err</span><span class="op" id="6595850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595856">c</span><span class="op" id="6595857">,</span>&nbsp;<span class="ident" id="6595859">err</span>&nbsp;<span class="op" id="6595863">:=</span>&nbsp;<span class="ident" id="6595866">FileListener</span><span class="op" id="6595878">(</span><span class="ident" id="6595879">f</span><span class="op" id="6595880">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595883">if</span>&nbsp;<span class="ident" id="6595886">err</span>&nbsp;<span class="op" id="6595890">!=</span>&nbsp;<span class="ident" id="6595893">nil</span>&nbsp;<span class="op" id="6595897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595901">t</span><span class="op" id="6595902">.</span><span class="ident" id="6595903">Fatalf</span><span class="op" id="6595909">(</span><span class="string" id="6595910">&#34;FileListener&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6595935">,</span>&nbsp;<span class="ident" id="6595937">err</span><span class="op" id="6595940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595946">if</span>&nbsp;<span class="op" id="6595949">!</span><span class="ident" id="6595950">reflect</span><span class="op" id="6595957">.</span><span class="ident" id="6595958">DeepEqual</span><span class="op" id="6595967">(</span><span class="ident" id="6595968">l</span><span class="op" id="6595969">.</span><span class="ident" id="6595970">Addr</span><span class="op" id="6595974">(</span><span class="op" id="6595975">)</span><span class="op" id="6595976">,</span>&nbsp;<span class="ident" id="6595978">c</span><span class="op" id="6595979">.</span><span class="ident" id="6595980">Addr</span><span class="op" id="6595984">(</span><span class="op" id="6595985">)</span><span class="op" id="6595986">)</span>&nbsp;<span class="op" id="6595988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595992">t</span><span class="op" id="6595993">.</span><span class="ident" id="6595994">Fatalf</span><span class="op" id="6596000">(</span><span class="string" id="6596001">&#34;Addrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6596030">,</span>&nbsp;<span class="ident" id="6596032">l</span><span class="op" id="6596033">.</span><span class="ident" id="6596034">Addr</span><span class="op" id="6596038">(</span><span class="op" id="6596039">)</span><span class="op" id="6596040">,</span>&nbsp;<span class="ident" id="6596042">c</span><span class="op" id="6596043">.</span><span class="ident" id="6596044">Addr</span><span class="op" id="6596048">(</span><span class="op" id="6596049">)</span><span class="op" id="6596050">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596056">if</span>&nbsp;<span class="ident" id="6596059">err</span>&nbsp;<span class="op" id="6596063">:=</span>&nbsp;<span class="ident" id="6596066">c</span><span class="op" id="6596067">.</span><span class="ident" id="6596068">Close</span><span class="op" id="6596073">(</span><span class="op" id="6596074">)</span><span class="op" id="6596075">;</span>&nbsp;<span class="ident" id="6596077">err</span>&nbsp;<span class="op" id="6596081">!=</span>&nbsp;<span class="ident" id="6596084">nil</span>&nbsp;<span class="op" id="6596088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596092">t</span><span class="op" id="6596093">.</span><span class="ident" id="6596094">Fatalf</span><span class="op" id="6596100">(</span><span class="string" id="6596101">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6596119">,</span>&nbsp;<span class="ident" id="6596121">err</span><span class="op" id="6596124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596130">if</span>&nbsp;<span class="ident" id="6596133">err</span>&nbsp;<span class="op" id="6596137">:=</span>&nbsp;<span class="ident" id="6596140">f</span><span class="op" id="6596141">.</span><span class="ident" id="6596142">Close</span><span class="op" id="6596147">(</span><span class="op" id="6596148">)</span><span class="op" id="6596149">;</span>&nbsp;<span class="ident" id="6596151">err</span>&nbsp;<span class="op" id="6596155">!=</span>&nbsp;<span class="ident" id="6596158">nil</span>&nbsp;<span class="op" id="6596162">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596166">t</span><span class="op" id="6596167">.</span><span class="ident" id="6596168">Fatalf</span><span class="op" id="6596174">(</span><span class="string" id="6596175">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6596193">,</span>&nbsp;<span class="ident" id="6596195">err</span><span class="op" id="6596198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596201">}</span><br>
<span class="lineno"></span><span class="op" id="6596203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6596206">var</span>&nbsp;<span class="ident" id="6596210">fileListenerTests</span>&nbsp;<span class="op" id="6596228">=</span>&nbsp;<span class="op" id="6596230">[</span><span class="op" id="6596231">]</span><span class="keyword" id="6596232">struct</span>&nbsp;<span class="op" id="6596239">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596242">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6596248">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596256">laddr</span>&nbsp;<span class="builtintype" id="6596262">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596270">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6596276">bool</span>&nbsp;<span class="comment" id="6596281">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596322">linux</span>&nbsp;<span class="builtintype" id="6596328">bool</span>&nbsp;<span class="comment" id="6596333">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6596387">}</span><span class="op" id="6596388">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596391">{</span><span class="ident" id="6596392">net</span><span class="op" id="6596395">:</span>&nbsp;<span class="string" id="6596397">&#34;tcp&#34;</span><span class="op" id="6596402">,</span>&nbsp;<span class="ident" id="6596404">laddr</span><span class="op" id="6596409">:</span>&nbsp;<span class="string" id="6596411">&#34;&#34;</span><span class="op" id="6596413">}</span><span class="op" id="6596414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596417">{</span><span class="ident" id="6596418">net</span><span class="op" id="6596421">:</span>&nbsp;<span class="string" id="6596423">&#34;tcp&#34;</span><span class="op" id="6596428">,</span>&nbsp;<span class="ident" id="6596430">laddr</span><span class="op" id="6596435">:</span>&nbsp;<span class="string" id="6596437">&#34;0.0.0.0&#34;</span><span class="op" id="6596446">}</span><span class="op" id="6596447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596450">{</span><span class="ident" id="6596451">net</span><span class="op" id="6596454">:</span>&nbsp;<span class="string" id="6596456">&#34;tcp&#34;</span><span class="op" id="6596461">,</span>&nbsp;<span class="ident" id="6596463">laddr</span><span class="op" id="6596468">:</span>&nbsp;<span class="string" id="6596470">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6596488">}</span><span class="op" id="6596489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596492">{</span><span class="ident" id="6596493">net</span><span class="op" id="6596496">:</span>&nbsp;<span class="string" id="6596498">&#34;tcp&#34;</span><span class="op" id="6596503">,</span>&nbsp;<span class="ident" id="6596505">laddr</span><span class="op" id="6596510">:</span>&nbsp;<span class="string" id="6596512">&#34;[::]&#34;</span><span class="op" id="6596518">,</span>&nbsp;<span class="ident" id="6596520">ipv6</span><span class="op" id="6596524">:</span>&nbsp;<span class="builtintype" id="6596526">true</span><span class="op" id="6596530">}</span><span class="op" id="6596531">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596535">{</span><span class="ident" id="6596536">net</span><span class="op" id="6596539">:</span>&nbsp;<span class="string" id="6596541">&#34;tcp&#34;</span><span class="op" id="6596546">,</span>&nbsp;<span class="ident" id="6596548">laddr</span><span class="op" id="6596553">:</span>&nbsp;<span class="string" id="6596555">&#34;127.0.0.1&#34;</span><span class="op" id="6596566">}</span><span class="op" id="6596567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596570">{</span><span class="ident" id="6596571">net</span><span class="op" id="6596574">:</span>&nbsp;<span class="string" id="6596576">&#34;tcp&#34;</span><span class="op" id="6596581">,</span>&nbsp;<span class="ident" id="6596583">laddr</span><span class="op" id="6596588">:</span>&nbsp;<span class="string" id="6596590">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6596610">}</span><span class="op" id="6596611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596614">{</span><span class="ident" id="6596615">net</span><span class="op" id="6596618">:</span>&nbsp;<span class="string" id="6596620">&#34;tcp&#34;</span><span class="op" id="6596625">,</span>&nbsp;<span class="ident" id="6596627">laddr</span><span class="op" id="6596632">:</span>&nbsp;<span class="string" id="6596634">&#34;[::1]&#34;</span><span class="op" id="6596641">,</span>&nbsp;<span class="ident" id="6596643">ipv6</span><span class="op" id="6596647">:</span>&nbsp;<span class="builtintype" id="6596649">true</span><span class="op" id="6596653">}</span><span class="op" id="6596654">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596658">{</span><span class="ident" id="6596659">net</span><span class="op" id="6596662">:</span>&nbsp;<span class="string" id="6596664">&#34;tcp4&#34;</span><span class="op" id="6596670">,</span>&nbsp;<span class="ident" id="6596672">laddr</span><span class="op" id="6596677">:</span>&nbsp;<span class="string" id="6596679">&#34;&#34;</span><span class="op" id="6596681">}</span><span class="op" id="6596682">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596685">{</span><span class="ident" id="6596686">net</span><span class="op" id="6596689">:</span>&nbsp;<span class="string" id="6596691">&#34;tcp4&#34;</span><span class="op" id="6596697">,</span>&nbsp;<span class="ident" id="6596699">laddr</span><span class="op" id="6596704">:</span>&nbsp;<span class="string" id="6596706">&#34;0.0.0.0&#34;</span><span class="op" id="6596715">}</span><span class="op" id="6596716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596719">{</span><span class="ident" id="6596720">net</span><span class="op" id="6596723">:</span>&nbsp;<span class="string" id="6596725">&#34;tcp4&#34;</span><span class="op" id="6596731">,</span>&nbsp;<span class="ident" id="6596733">laddr</span><span class="op" id="6596738">:</span>&nbsp;<span class="string" id="6596740">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6596758">}</span><span class="op" id="6596759">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596763">{</span><span class="ident" id="6596764">net</span><span class="op" id="6596767">:</span>&nbsp;<span class="string" id="6596769">&#34;tcp4&#34;</span><span class="op" id="6596775">,</span>&nbsp;<span class="ident" id="6596777">laddr</span><span class="op" id="6596782">:</span>&nbsp;<span class="string" id="6596784">&#34;127.0.0.1&#34;</span><span class="op" id="6596795">}</span><span class="op" id="6596796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596799">{</span><span class="ident" id="6596800">net</span><span class="op" id="6596803">:</span>&nbsp;<span class="string" id="6596805">&#34;tcp4&#34;</span><span class="op" id="6596811">,</span>&nbsp;<span class="ident" id="6596813">laddr</span><span class="op" id="6596818">:</span>&nbsp;<span class="string" id="6596820">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6596840">}</span><span class="op" id="6596841">,</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596845">{</span><span class="ident" id="6596846">net</span><span class="op" id="6596849">:</span>&nbsp;<span class="string" id="6596851">&#34;tcp6&#34;</span><span class="op" id="6596857">,</span>&nbsp;<span class="ident" id="6596859">laddr</span><span class="op" id="6596864">:</span>&nbsp;<span class="string" id="6596866">&#34;&#34;</span><span class="op" id="6596868">,</span>&nbsp;<span class="ident" id="6596870">ipv6</span><span class="op" id="6596874">:</span>&nbsp;<span class="builtintype" id="6596876">true</span><span class="op" id="6596880">}</span><span class="op" id="6596881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596884">{</span><span class="ident" id="6596885">net</span><span class="op" id="6596888">:</span>&nbsp;<span class="string" id="6596890">&#34;tcp6&#34;</span><span class="op" id="6596896">,</span>&nbsp;<span class="ident" id="6596898">laddr</span><span class="op" id="6596903">:</span>&nbsp;<span class="string" id="6596905">&#34;[::]&#34;</span><span class="op" id="6596911">,</span>&nbsp;<span class="ident" id="6596913">ipv6</span><span class="op" id="6596917">:</span>&nbsp;<span class="builtintype" id="6596919">true</span><span class="op" id="6596923">}</span><span class="op" id="6596924">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596928">{</span><span class="ident" id="6596929">net</span><span class="op" id="6596932">:</span>&nbsp;<span class="string" id="6596934">&#34;tcp6&#34;</span><span class="op" id="6596940">,</span>&nbsp;<span class="ident" id="6596942">laddr</span><span class="op" id="6596947">:</span>&nbsp;<span class="string" id="6596949">&#34;[::1]&#34;</span><span class="op" id="6596956">,</span>&nbsp;<span class="ident" id="6596958">ipv6</span><span class="op" id="6596962">:</span>&nbsp;<span class="builtintype" id="6596964">true</span><span class="op" id="6596968">}</span><span class="op" id="6596969">,</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596973">{</span><span class="ident" id="6596974">net</span><span class="op" id="6596977">:</span>&nbsp;<span class="string" id="6596979">&#34;unix&#34;</span><span class="op" id="6596985">,</span>&nbsp;<span class="ident" id="6596987">laddr</span><span class="op" id="6596992">:</span>&nbsp;<span class="string" id="6596994">&#34;@gotest/net&#34;</span><span class="op" id="6597007">,</span>&nbsp;<span class="ident" id="6597009">linux</span><span class="op" id="6597014">:</span>&nbsp;<span class="builtintype" id="6597016">true</span><span class="op" id="6597020">}</span><span class="op" id="6597021">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597024">{</span><span class="ident" id="6597025">net</span><span class="op" id="6597028">:</span>&nbsp;<span class="string" id="6597030">&#34;unixpacket&#34;</span><span class="op" id="6597042">,</span>&nbsp;<span class="ident" id="6597044">laddr</span><span class="op" id="6597049">:</span>&nbsp;<span class="string" id="6597051">&#34;@gotest/net&#34;</span><span class="op" id="6597064">,</span>&nbsp;<span class="ident" id="6597066">linux</span><span class="op" id="6597071">:</span>&nbsp;<span class="builtintype" id="6597073">true</span><span class="op" id="6597077">}</span><span class="op" id="6597078">,</span><br>
<span class="lineno"></span><span class="op" id="6597080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6597083">func</span>&nbsp;<span class="ident" id="6597088">TestFileListener</span><span class="op" id="6597104">(</span><span class="ident" id="6597105">t</span>&nbsp;<span class="op" id="6597107">*</span><span class="ident" id="6597108">testing</span><span class="op" id="6597115">.</span><span class="ident" id="6597116">T</span><span class="op" id="6597117">)</span>&nbsp;<span class="op" id="6597119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597122">switch</span>&nbsp;<span class="ident" id="6597129">runtime</span><span class="op" id="6597136">.</span><span class="ident" id="6597137">GOOS</span>&nbsp;<span class="op" id="6597142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597145">case</span>&nbsp;<span class="string" id="6597150">&#34;nacl&#34;</span><span class="op" id="6597156">,</span>&nbsp;<span class="string" id="6597158">&#34;windows&#34;</span><span class="op" id="6597167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597171">t</span><span class="op" id="6597172">.</span><span class="ident" id="6597173">Skipf</span><span class="op" id="6597178">(</span><span class="string" id="6597179">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6597200">,</span>&nbsp;<span class="ident" id="6597202">runtime</span><span class="op" id="6597209">.</span><span class="ident" id="6597210">GOOS</span><span class="op" id="6597214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597217">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597221">for</span>&nbsp;<span class="ident" id="6597225">_</span><span class="op" id="6597226">,</span>&nbsp;<span class="ident" id="6597228">tt</span>&nbsp;<span class="op" id="6597231">:=</span>&nbsp;<span class="keyword" id="6597234">range</span>&nbsp;<span class="ident" id="6597240">fileListenerTests</span>&nbsp;<span class="op" id="6597258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597262">if</span>&nbsp;<span class="ident" id="6597265">skipServerTest</span><span class="op" id="6597279">(</span><span class="ident" id="6597280">tt</span><span class="op" id="6597282">.</span><span class="ident" id="6597283">net</span><span class="op" id="6597286">,</span>&nbsp;<span class="string" id="6597288">&#34;unix&#34;</span><span class="op" id="6597294">,</span>&nbsp;<span class="ident" id="6597296">tt</span><span class="op" id="6597298">.</span><span class="ident" id="6597299">laddr</span><span class="op" id="6597304">,</span>&nbsp;<span class="ident" id="6597306">tt</span><span class="op" id="6597308">.</span><span class="ident" id="6597309">ipv6</span><span class="op" id="6597313">,</span>&nbsp;<span class="builtintype" id="6597315">false</span><span class="op" id="6597320">,</span>&nbsp;<span class="ident" id="6597322">tt</span><span class="op" id="6597324">.</span><span class="ident" id="6597325">linux</span><span class="op" id="6597330">)</span>&nbsp;<span class="op" id="6597332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597337">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597348">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597352">if</span>&nbsp;<span class="ident" id="6597355">skipServerTest</span><span class="op" id="6597369">(</span><span class="ident" id="6597370">tt</span><span class="op" id="6597372">.</span><span class="ident" id="6597373">net</span><span class="op" id="6597376">,</span>&nbsp;<span class="string" id="6597378">&#34;unixpacket&#34;</span><span class="op" id="6597390">,</span>&nbsp;<span class="ident" id="6597392">tt</span><span class="op" id="6597394">.</span><span class="ident" id="6597395">laddr</span><span class="op" id="6597400">,</span>&nbsp;<span class="ident" id="6597402">tt</span><span class="op" id="6597404">.</span><span class="ident" id="6597405">ipv6</span><span class="op" id="6597409">,</span>&nbsp;<span class="builtintype" id="6597411">false</span><span class="op" id="6597416">,</span>&nbsp;<span class="ident" id="6597418">tt</span><span class="op" id="6597420">.</span><span class="ident" id="6597421">linux</span><span class="op" id="6597426">)</span>&nbsp;<span class="op" id="6597428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597433">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597448">testFileListener</span><span class="op" id="6597464">(</span><span class="ident" id="6597465">t</span><span class="op" id="6597466">,</span>&nbsp;<span class="ident" id="6597468">tt</span><span class="op" id="6597470">.</span><span class="ident" id="6597471">net</span><span class="op" id="6597474">,</span>&nbsp;<span class="ident" id="6597476">tt</span><span class="op" id="6597478">.</span><span class="ident" id="6597479">laddr</span><span class="op" id="6597484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597487">}</span><br>
<span class="lineno">105</span><span class="op" id="6597489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6597492">func</span>&nbsp;<span class="ident" id="6597497">testFilePacketConn</span><span class="op" id="6597515">(</span><span class="ident" id="6597516">t</span>&nbsp;<span class="op" id="6597518">*</span><span class="ident" id="6597519">testing</span><span class="op" id="6597526">.</span><span class="ident" id="6597527">T</span><span class="op" id="6597528">,</span>&nbsp;<span class="ident" id="6597530">pcf</span>&nbsp;<span class="ident" id="6597534">packetConnFile</span><span class="op" id="6597548">,</span>&nbsp;<span class="ident" id="6597550">listen</span>&nbsp;<span class="builtintype" id="6597557">bool</span><span class="op" id="6597561">)</span>&nbsp;<span class="op" id="6597563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597566">f</span><span class="op" id="6597567">,</span>&nbsp;<span class="ident" id="6597569">err</span>&nbsp;<span class="op" id="6597573">:=</span>&nbsp;<span class="ident" id="6597576">pcf</span><span class="op" id="6597579">.</span><span class="ident" id="6597580">File</span><span class="op" id="6597584">(</span><span class="op" id="6597585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597588">if</span>&nbsp;<span class="ident" id="6597591">err</span>&nbsp;<span class="op" id="6597595">!=</span>&nbsp;<span class="ident" id="6597598">nil</span>&nbsp;<span class="op" id="6597602">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597606">t</span><span class="op" id="6597607">.</span><span class="ident" id="6597608">Fatalf</span><span class="op" id="6597614">(</span><span class="string" id="6597615">&#34;File&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6597632">,</span>&nbsp;<span class="ident" id="6597634">err</span><span class="op" id="6597637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597643">c</span><span class="op" id="6597644">,</span>&nbsp;<span class="ident" id="6597646">err</span>&nbsp;<span class="op" id="6597650">:=</span>&nbsp;<span class="ident" id="6597653">FilePacketConn</span><span class="op" id="6597667">(</span><span class="ident" id="6597668">f</span><span class="op" id="6597669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597672">if</span>&nbsp;<span class="ident" id="6597675">err</span>&nbsp;<span class="op" id="6597679">!=</span>&nbsp;<span class="ident" id="6597682">nil</span>&nbsp;<span class="op" id="6597686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597690">t</span><span class="op" id="6597691">.</span><span class="ident" id="6597692">Fatalf</span><span class="op" id="6597698">(</span><span class="string" id="6597699">&#34;FilePacketConn&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6597726">,</span>&nbsp;<span class="ident" id="6597728">err</span><span class="op" id="6597731">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597737">if</span>&nbsp;<span class="op" id="6597740">!</span><span class="ident" id="6597741">reflect</span><span class="op" id="6597748">.</span><span class="ident" id="6597749">DeepEqual</span><span class="op" id="6597758">(</span><span class="ident" id="6597759">pcf</span><span class="op" id="6597762">.</span><span class="ident" id="6597763">LocalAddr</span><span class="op" id="6597772">(</span><span class="op" id="6597773">)</span><span class="op" id="6597774">,</span>&nbsp;<span class="ident" id="6597776">c</span><span class="op" id="6597777">.</span><span class="ident" id="6597778">LocalAddr</span><span class="op" id="6597787">(</span><span class="op" id="6597788">)</span><span class="op" id="6597789">)</span>&nbsp;<span class="op" id="6597791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597795">t</span><span class="op" id="6597796">.</span><span class="ident" id="6597797">Fatalf</span><span class="op" id="6597803">(</span><span class="string" id="6597804">&#34;LocalAddrs&nbsp;not&nbsp;equal:&nbsp;%#v&nbsp;!=&nbsp;%#v&#34;</span><span class="op" id="6597838">,</span>&nbsp;<span class="ident" id="6597840">pcf</span><span class="op" id="6597843">.</span><span class="ident" id="6597844">LocalAddr</span><span class="op" id="6597853">(</span><span class="op" id="6597854">)</span><span class="op" id="6597855">,</span>&nbsp;<span class="ident" id="6597857">c</span><span class="op" id="6597858">.</span><span class="ident" id="6597859">LocalAddr</span><span class="op" id="6597868">(</span><span class="op" id="6597869">)</span><span class="op" id="6597870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597876">if</span>&nbsp;<span class="ident" id="6597879">listen</span>&nbsp;<span class="op" id="6597886">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597890">if</span>&nbsp;<span class="ident" id="6597893">_</span><span class="op" id="6597894">,</span>&nbsp;<span class="ident" id="6597896">err</span>&nbsp;<span class="op" id="6597900">:=</span>&nbsp;<span class="ident" id="6597903">c</span><span class="op" id="6597904">.</span><span class="ident" id="6597905">WriteTo</span><span class="op" id="6597912">(</span><span class="op" id="6597913">[</span><span class="op" id="6597914">]</span><span class="builtintype" id="6597915">byte</span><span class="op" id="6597919">{</span><span class="op" id="6597920">}</span><span class="op" id="6597921">,</span>&nbsp;<span class="ident" id="6597923">c</span><span class="op" id="6597924">.</span><span class="ident" id="6597925">LocalAddr</span><span class="op" id="6597934">(</span><span class="op" id="6597935">)</span><span class="op" id="6597936">)</span><span class="op" id="6597937">;</span>&nbsp;<span class="ident" id="6597939">err</span>&nbsp;<span class="op" id="6597943">!=</span>&nbsp;<span class="ident" id="6597946">nil</span>&nbsp;<span class="op" id="6597950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597955">t</span><span class="op" id="6597956">.</span><span class="ident" id="6597957">Fatalf</span><span class="op" id="6597963">(</span><span class="string" id="6597964">&#34;WriteTo&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6597984">,</span>&nbsp;<span class="ident" id="6597986">err</span><span class="op" id="6597989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597999">if</span>&nbsp;<span class="ident" id="6598002">err</span>&nbsp;<span class="op" id="6598006">:=</span>&nbsp;<span class="ident" id="6598009">c</span><span class="op" id="6598010">.</span><span class="ident" id="6598011">Close</span><span class="op" id="6598016">(</span><span class="op" id="6598017">)</span><span class="op" id="6598018">;</span>&nbsp;<span class="ident" id="6598020">err</span>&nbsp;<span class="op" id="6598024">!=</span>&nbsp;<span class="ident" id="6598027">nil</span>&nbsp;<span class="op" id="6598031">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598035">t</span><span class="op" id="6598036">.</span><span class="ident" id="6598037">Fatalf</span><span class="op" id="6598043">(</span><span class="string" id="6598044">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598062">,</span>&nbsp;<span class="ident" id="6598064">err</span><span class="op" id="6598067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598073">if</span>&nbsp;<span class="ident" id="6598076">err</span>&nbsp;<span class="op" id="6598080">:=</span>&nbsp;<span class="ident" id="6598083">f</span><span class="op" id="6598084">.</span><span class="ident" id="6598085">Close</span><span class="op" id="6598090">(</span><span class="op" id="6598091">)</span><span class="op" id="6598092">;</span>&nbsp;<span class="ident" id="6598094">err</span>&nbsp;<span class="op" id="6598098">!=</span>&nbsp;<span class="ident" id="6598101">nil</span>&nbsp;<span class="op" id="6598105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598109">t</span><span class="op" id="6598110">.</span><span class="ident" id="6598111">Fatalf</span><span class="op" id="6598117">(</span><span class="string" id="6598118">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598136">,</span>&nbsp;<span class="ident" id="6598138">err</span><span class="op" id="6598141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598144">}</span><br>
<span class="lineno">130</span><span class="op" id="6598146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6598149">func</span>&nbsp;<span class="ident" id="6598154">testFilePacketConnListen</span><span class="op" id="6598178">(</span><span class="ident" id="6598179">t</span>&nbsp;<span class="op" id="6598181">*</span><span class="ident" id="6598182">testing</span><span class="op" id="6598189">.</span><span class="ident" id="6598190">T</span><span class="op" id="6598191">,</span>&nbsp;<span class="ident" id="6598193">net</span><span class="op" id="6598196">,</span>&nbsp;<span class="ident" id="6598198">laddr</span>&nbsp;<span class="builtintype" id="6598204">string</span><span class="op" id="6598210">)</span>&nbsp;<span class="op" id="6598212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598215">switch</span>&nbsp;<span class="ident" id="6598222">net</span>&nbsp;<span class="op" id="6598226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598229">case</span>&nbsp;<span class="string" id="6598234">&#34;udp&#34;</span><span class="op" id="6598239">,</span>&nbsp;<span class="string" id="6598241">&#34;udp4&#34;</span><span class="op" id="6598247">,</span>&nbsp;<span class="string" id="6598249">&#34;udp6&#34;</span><span class="op" id="6598255">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598259">laddr</span>&nbsp;<span class="op" id="6598265">+=</span>&nbsp;<span class="string" id="6598268">&#34;:0&#34;</span>&nbsp;<span class="comment" id="6598273">//&nbsp;any&nbsp;available&nbsp;port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598299">l</span><span class="op" id="6598300">,</span>&nbsp;<span class="ident" id="6598302">err</span>&nbsp;<span class="op" id="6598306">:=</span>&nbsp;<span class="ident" id="6598309">ListenPacket</span><span class="op" id="6598321">(</span><span class="ident" id="6598322">net</span><span class="op" id="6598325">,</span>&nbsp;<span class="ident" id="6598327">laddr</span><span class="op" id="6598332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598335">if</span>&nbsp;<span class="ident" id="6598338">err</span>&nbsp;<span class="op" id="6598342">!=</span>&nbsp;<span class="ident" id="6598345">nil</span>&nbsp;<span class="op" id="6598349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598353">t</span><span class="op" id="6598354">.</span><span class="ident" id="6598355">Fatalf</span><span class="op" id="6598361">(</span><span class="string" id="6598362">&#34;ListenPacket&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598387">,</span>&nbsp;<span class="ident" id="6598389">err</span><span class="op" id="6598392">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598398">testFilePacketConn</span><span class="op" id="6598416">(</span><span class="ident" id="6598417">t</span><span class="op" id="6598418">,</span>&nbsp;<span class="ident" id="6598420">l</span><span class="op" id="6598421">.</span><span class="op" id="6598422">(</span><span class="ident" id="6598423">packetConnFile</span><span class="op" id="6598437">)</span><span class="op" id="6598438">,</span>&nbsp;<span class="builtintype" id="6598440">true</span><span class="op" id="6598444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598447">if</span>&nbsp;<span class="ident" id="6598450">err</span>&nbsp;<span class="op" id="6598454">:=</span>&nbsp;<span class="ident" id="6598457">l</span><span class="op" id="6598458">.</span><span class="ident" id="6598459">Close</span><span class="op" id="6598464">(</span><span class="op" id="6598465">)</span><span class="op" id="6598466">;</span>&nbsp;<span class="ident" id="6598468">err</span>&nbsp;<span class="op" id="6598472">!=</span>&nbsp;<span class="ident" id="6598475">nil</span>&nbsp;<span class="op" id="6598479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598483">t</span><span class="op" id="6598484">.</span><span class="ident" id="6598485">Fatalf</span><span class="op" id="6598491">(</span><span class="string" id="6598492">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598510">,</span>&nbsp;<span class="ident" id="6598512">err</span><span class="op" id="6598515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598518">}</span><br>
<span class="lineno">145</span><span class="op" id="6598520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6598523">func</span>&nbsp;<span class="ident" id="6598528">testFilePacketConnDial</span><span class="op" id="6598550">(</span><span class="ident" id="6598551">t</span>&nbsp;<span class="op" id="6598553">*</span><span class="ident" id="6598554">testing</span><span class="op" id="6598561">.</span><span class="ident" id="6598562">T</span><span class="op" id="6598563">,</span>&nbsp;<span class="ident" id="6598565">net</span><span class="op" id="6598568">,</span>&nbsp;<span class="ident" id="6598570">raddr</span>&nbsp;<span class="builtintype" id="6598576">string</span><span class="op" id="6598582">)</span>&nbsp;<span class="op" id="6598584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598587">switch</span>&nbsp;<span class="ident" id="6598594">net</span>&nbsp;<span class="op" id="6598598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598601">case</span>&nbsp;<span class="string" id="6598606">&#34;udp&#34;</span><span class="op" id="6598611">,</span>&nbsp;<span class="string" id="6598613">&#34;udp4&#34;</span><span class="op" id="6598619">,</span>&nbsp;<span class="string" id="6598621">&#34;udp6&#34;</span><span class="op" id="6598627">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598631">raddr</span>&nbsp;<span class="op" id="6598637">+=</span>&nbsp;<span class="string" id="6598640">&#34;:12345&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598653">c</span><span class="op" id="6598654">,</span>&nbsp;<span class="ident" id="6598656">err</span>&nbsp;<span class="op" id="6598660">:=</span>&nbsp;<span class="ident" id="6598663">Dial</span><span class="op" id="6598667">(</span><span class="ident" id="6598668">net</span><span class="op" id="6598671">,</span>&nbsp;<span class="ident" id="6598673">raddr</span><span class="op" id="6598678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598681">if</span>&nbsp;<span class="ident" id="6598684">err</span>&nbsp;<span class="op" id="6598688">!=</span>&nbsp;<span class="ident" id="6598691">nil</span>&nbsp;<span class="op" id="6598695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598699">t</span><span class="op" id="6598700">.</span><span class="ident" id="6598701">Fatalf</span><span class="op" id="6598707">(</span><span class="string" id="6598708">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598725">,</span>&nbsp;<span class="ident" id="6598727">err</span><span class="op" id="6598730">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598736">testFilePacketConn</span><span class="op" id="6598754">(</span><span class="ident" id="6598755">t</span><span class="op" id="6598756">,</span>&nbsp;<span class="ident" id="6598758">c</span><span class="op" id="6598759">.</span><span class="op" id="6598760">(</span><span class="ident" id="6598761">packetConnFile</span><span class="op" id="6598775">)</span><span class="op" id="6598776">,</span>&nbsp;<span class="builtintype" id="6598778">false</span><span class="op" id="6598783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6598786">if</span>&nbsp;<span class="ident" id="6598789">err</span>&nbsp;<span class="op" id="6598793">:=</span>&nbsp;<span class="ident" id="6598796">c</span><span class="op" id="6598797">.</span><span class="ident" id="6598798">Close</span><span class="op" id="6598803">(</span><span class="op" id="6598804">)</span><span class="op" id="6598805">;</span>&nbsp;<span class="ident" id="6598807">err</span>&nbsp;<span class="op" id="6598811">!=</span>&nbsp;<span class="ident" id="6598814">nil</span>&nbsp;<span class="op" id="6598818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598822">t</span><span class="op" id="6598823">.</span><span class="ident" id="6598824">Fatalf</span><span class="op" id="6598830">(</span><span class="string" id="6598831">&#34;Close&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6598849">,</span>&nbsp;<span class="ident" id="6598851">err</span><span class="op" id="6598854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598857">}</span><br>
<span class="lineno">160</span><span class="op" id="6598859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6598862">var</span>&nbsp;<span class="ident" id="6598866">filePacketConnTests</span>&nbsp;<span class="op" id="6598886">=</span>&nbsp;<span class="op" id="6598888">[</span><span class="op" id="6598889">]</span><span class="keyword" id="6598890">struct</span>&nbsp;<span class="op" id="6598897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598900">net</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6598906">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598914">addr</span>&nbsp;&nbsp;<span class="builtintype" id="6598920">string</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598928">ipv6</span>&nbsp;&nbsp;<span class="builtintype" id="6598934">bool</span>&nbsp;<span class="comment" id="6598939">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598980">linux</span>&nbsp;<span class="builtintype" id="6598986">bool</span>&nbsp;<span class="comment" id="6598991">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="6599045">}</span><span class="op" id="6599046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599049">{</span><span class="ident" id="6599050">net</span><span class="op" id="6599053">:</span>&nbsp;<span class="string" id="6599055">&#34;udp&#34;</span><span class="op" id="6599060">,</span>&nbsp;<span class="ident" id="6599062">addr</span><span class="op" id="6599066">:</span>&nbsp;<span class="string" id="6599068">&#34;127.0.0.1&#34;</span><span class="op" id="6599079">}</span><span class="op" id="6599080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599083">{</span><span class="ident" id="6599084">net</span><span class="op" id="6599087">:</span>&nbsp;<span class="string" id="6599089">&#34;udp&#34;</span><span class="op" id="6599094">,</span>&nbsp;<span class="ident" id="6599096">addr</span><span class="op" id="6599100">:</span>&nbsp;<span class="string" id="6599102">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6599122">}</span><span class="op" id="6599123">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599126">{</span><span class="ident" id="6599127">net</span><span class="op" id="6599130">:</span>&nbsp;<span class="string" id="6599132">&#34;udp&#34;</span><span class="op" id="6599137">,</span>&nbsp;<span class="ident" id="6599139">addr</span><span class="op" id="6599143">:</span>&nbsp;<span class="string" id="6599145">&#34;[::1]&#34;</span><span class="op" id="6599152">,</span>&nbsp;<span class="ident" id="6599154">ipv6</span><span class="op" id="6599158">:</span>&nbsp;<span class="builtintype" id="6599160">true</span><span class="op" id="6599164">}</span><span class="op" id="6599165">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599169">{</span><span class="ident" id="6599170">net</span><span class="op" id="6599173">:</span>&nbsp;<span class="string" id="6599175">&#34;udp4&#34;</span><span class="op" id="6599181">,</span>&nbsp;<span class="ident" id="6599183">addr</span><span class="op" id="6599187">:</span>&nbsp;<span class="string" id="6599189">&#34;127.0.0.1&#34;</span><span class="op" id="6599200">}</span><span class="op" id="6599201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599204">{</span><span class="ident" id="6599205">net</span><span class="op" id="6599208">:</span>&nbsp;<span class="string" id="6599210">&#34;udp4&#34;</span><span class="op" id="6599216">,</span>&nbsp;<span class="ident" id="6599218">addr</span><span class="op" id="6599222">:</span>&nbsp;<span class="string" id="6599224">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="6599244">}</span><span class="op" id="6599245">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599249">{</span><span class="ident" id="6599250">net</span><span class="op" id="6599253">:</span>&nbsp;<span class="string" id="6599255">&#34;udp6&#34;</span><span class="op" id="6599261">,</span>&nbsp;<span class="ident" id="6599263">addr</span><span class="op" id="6599267">:</span>&nbsp;<span class="string" id="6599269">&#34;[::1]&#34;</span><span class="op" id="6599276">,</span>&nbsp;<span class="ident" id="6599278">ipv6</span><span class="op" id="6599282">:</span>&nbsp;<span class="builtintype" id="6599284">true</span><span class="op" id="6599288">}</span><span class="op" id="6599289">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599293">{</span><span class="ident" id="6599294">net</span><span class="op" id="6599297">:</span>&nbsp;<span class="string" id="6599299">&#34;ip4:icmp&#34;</span><span class="op" id="6599309">,</span>&nbsp;<span class="ident" id="6599311">addr</span><span class="op" id="6599315">:</span>&nbsp;<span class="string" id="6599317">&#34;127.0.0.1&#34;</span><span class="op" id="6599328">}</span><span class="op" id="6599329">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599333">{</span><span class="ident" id="6599334">net</span><span class="op" id="6599337">:</span>&nbsp;<span class="string" id="6599339">&#34;unixgram&#34;</span><span class="op" id="6599349">,</span>&nbsp;<span class="ident" id="6599351">addr</span><span class="op" id="6599355">:</span>&nbsp;<span class="string" id="6599357">&#34;@gotest3/net&#34;</span><span class="op" id="6599371">,</span>&nbsp;<span class="ident" id="6599373">linux</span><span class="op" id="6599378">:</span>&nbsp;<span class="builtintype" id="6599380">true</span><span class="op" id="6599384">}</span><span class="op" id="6599385">,</span><br>
<span class="lineno">180</span><span class="op" id="6599387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6599390">func</span>&nbsp;<span class="ident" id="6599395">TestFilePacketConn</span><span class="op" id="6599413">(</span><span class="ident" id="6599414">t</span>&nbsp;<span class="op" id="6599416">*</span><span class="ident" id="6599417">testing</span><span class="op" id="6599424">.</span><span class="ident" id="6599425">T</span><span class="op" id="6599426">)</span>&nbsp;<span class="op" id="6599428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599431">switch</span>&nbsp;<span class="ident" id="6599438">runtime</span><span class="op" id="6599445">.</span><span class="ident" id="6599446">GOOS</span>&nbsp;<span class="op" id="6599451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599454">case</span>&nbsp;<span class="string" id="6599459">&#34;nacl&#34;</span><span class="op" id="6599465">,</span>&nbsp;<span class="string" id="6599467">&#34;plan9&#34;</span><span class="op" id="6599474">,</span>&nbsp;<span class="string" id="6599476">&#34;windows&#34;</span><span class="op" id="6599485">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599489">t</span><span class="op" id="6599490">.</span><span class="ident" id="6599491">Skipf</span><span class="op" id="6599496">(</span><span class="string" id="6599497">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="6599518">,</span>&nbsp;<span class="ident" id="6599520">runtime</span><span class="op" id="6599527">.</span><span class="ident" id="6599528">GOOS</span><span class="op" id="6599532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599539">for</span>&nbsp;<span class="ident" id="6599543">_</span><span class="op" id="6599544">,</span>&nbsp;<span class="ident" id="6599546">tt</span>&nbsp;<span class="op" id="6599549">:=</span>&nbsp;<span class="keyword" id="6599552">range</span>&nbsp;<span class="ident" id="6599558">filePacketConnTests</span>&nbsp;<span class="op" id="6599578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599582">if</span>&nbsp;<span class="ident" id="6599585">skipServerTest</span><span class="op" id="6599599">(</span><span class="ident" id="6599600">tt</span><span class="op" id="6599602">.</span><span class="ident" id="6599603">net</span><span class="op" id="6599606">,</span>&nbsp;<span class="string" id="6599608">&#34;unixgram&#34;</span><span class="op" id="6599618">,</span>&nbsp;<span class="ident" id="6599620">tt</span><span class="op" id="6599622">.</span><span class="ident" id="6599623">addr</span><span class="op" id="6599627">,</span>&nbsp;<span class="ident" id="6599629">tt</span><span class="op" id="6599631">.</span><span class="ident" id="6599632">ipv6</span><span class="op" id="6599636">,</span>&nbsp;<span class="builtintype" id="6599638">false</span><span class="op" id="6599643">,</span>&nbsp;<span class="ident" id="6599645">tt</span><span class="op" id="6599647">.</span><span class="ident" id="6599648">linux</span><span class="op" id="6599653">)</span>&nbsp;<span class="op" id="6599655">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599660">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599675">if</span>&nbsp;<span class="ident" id="6599678">os</span><span class="op" id="6599680">.</span><span class="ident" id="6599681">Getuid</span><span class="op" id="6599687">(</span><span class="op" id="6599688">)</span>&nbsp;<span class="op" id="6599690">!=</span>&nbsp;<span class="num" id="6599693">0</span>&nbsp;<span class="op" id="6599695">&amp;&amp;</span>&nbsp;<span class="ident" id="6599698">tt</span><span class="op" id="6599700">.</span><span class="ident" id="6599701">net</span>&nbsp;<span class="op" id="6599705">==</span>&nbsp;<span class="string" id="6599708">&#34;ip4:icmp&#34;</span>&nbsp;<span class="op" id="6599719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599724">t</span><span class="op" id="6599725">.</span><span class="ident" id="6599726">Log</span><span class="op" id="6599729">(</span><span class="string" id="6599730">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="6599759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599764">continue</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599779">testFilePacketConnListen</span><span class="op" id="6599803">(</span><span class="ident" id="6599804">t</span><span class="op" id="6599805">,</span>&nbsp;<span class="ident" id="6599807">tt</span><span class="op" id="6599809">.</span><span class="ident" id="6599810">net</span><span class="op" id="6599813">,</span>&nbsp;<span class="ident" id="6599815">tt</span><span class="op" id="6599817">.</span><span class="ident" id="6599818">addr</span><span class="op" id="6599822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599826">switch</span>&nbsp;<span class="ident" id="6599833">tt</span><span class="op" id="6599835">.</span><span class="ident" id="6599836">addr</span>&nbsp;<span class="op" id="6599841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599845">case</span>&nbsp;<span class="string" id="6599850">&#34;&#34;</span><span class="op" id="6599852">,</span>&nbsp;<span class="string" id="6599854">&#34;0.0.0.0&#34;</span><span class="op" id="6599863">,</span>&nbsp;<span class="string" id="6599865">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="6599883">,</span>&nbsp;<span class="string" id="6599885">&#34;[::]&#34;</span><span class="op" id="6599891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599895">default</span><span class="op" id="6599902">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6599907">if</span>&nbsp;<span class="ident" id="6599910">tt</span><span class="op" id="6599912">.</span><span class="ident" id="6599913">net</span>&nbsp;<span class="op" id="6599917">!=</span>&nbsp;<span class="string" id="6599920">&#34;unixgram&#34;</span>&nbsp;<span class="op" id="6599931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6599937">testFilePacketConnDial</span><span class="op" id="6599959">(</span><span class="ident" id="6599960">t</span><span class="op" id="6599961">,</span>&nbsp;<span class="ident" id="6599963">tt</span><span class="op" id="6599965">.</span><span class="ident" id="6599966">net</span><span class="op" id="6599969">,</span>&nbsp;<span class="ident" id="6599971">tt</span><span class="op" id="6599973">.</span><span class="ident" id="6599974">addr</span><span class="op" id="6599978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6599990">}</span><br>
<span class="lineno">205</span><span class="op" id="6599992">}</span>
</div>
</body>
</html>
