<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/textproto</h2>
<ul>
<li><a href="/gostd/net/textproto/header.go.html">header.go</a></li>
<li><a href="/gostd/net/textproto/pipeline.go.html">pipeline.go</a></li>
<li><a href="/gostd/net/textproto/reader.go.html">reader.go</a></li>
<li><a href="/gostd/net/textproto/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/net/textproto/textproto.go.html">textproto.go</a></li>
<li><a href="/gostd/net/textproto/writer.go.html">writer.go</a></li>
<li><a href="/gostd/net/textproto/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3399487">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3399543">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3399597">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3399648">package</span>&nbsp;<span class="ident" id="3399656">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3399667">import</span>&nbsp;<span class="op" id="3399674">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399677">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399686">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399695">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399701">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399714">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3399725">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3399735">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3399738">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3399803">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3399868">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3399918">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3399982">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3400039">type</span>&nbsp;<span class="ident" id="3400044">Reader</span>&nbsp;<span class="keyword" id="3400051">struct</span>&nbsp;<span class="op" id="3400058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400061">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3400065">*</span><span class="ident" id="3400066">bufio</span><span class="op" id="3400071">.</span><span class="ident" id="3400072">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400080">dot</span>&nbsp;<span class="op" id="3400084">*</span><span class="ident" id="3400085">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400096">buf</span>&nbsp;<span class="op" id="3400100">[</span><span class="op" id="3400101">]</span><span class="builtintype" id="3400102">byte</span>&nbsp;<span class="comment" id="3400107">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3400156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3400159">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3400209">func</span>&nbsp;<span class="ident" id="3400214">NewReader</span><span class="op" id="3400223">(</span><span class="ident" id="3400224">r</span>&nbsp;<span class="op" id="3400226">*</span><span class="ident" id="3400227">bufio</span><span class="op" id="3400232">.</span><span class="ident" id="3400233">Reader</span><span class="op" id="3400239">)</span>&nbsp;<span class="op" id="3400241">*</span><span class="ident" id="3400242">Reader</span>&nbsp;<span class="op" id="3400249">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400252">return</span>&nbsp;<span class="op" id="3400259">&amp;</span><span class="ident" id="3400260">Reader</span><span class="op" id="3400266">{</span><span class="ident" id="3400267">R</span><span class="op" id="3400268">:</span>&nbsp;<span class="ident" id="3400270">r</span><span class="op" id="3400271">}</span><br>
<span class="lineno"></span><span class="op" id="3400273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3400276">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3400316">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3400374">func</span>&nbsp;<span class="op" id="3400379">(</span><span class="ident" id="3400380">r</span>&nbsp;<span class="op" id="3400382">*</span><span class="ident" id="3400383">Reader</span><span class="op" id="3400389">)</span>&nbsp;<span class="ident" id="3400391">ReadLine</span><span class="op" id="3400399">(</span><span class="op" id="3400400">)</span>&nbsp;<span class="op" id="3400402">(</span><span class="builtintype" id="3400403">string</span><span class="op" id="3400409">,</span>&nbsp;<span class="builtintype" id="3400411">error</span><span class="op" id="3400416">)</span>&nbsp;<span class="op" id="3400418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400421">line</span><span class="op" id="3400425">,</span>&nbsp;<span class="ident" id="3400427">err</span>&nbsp;<span class="op" id="3400431">:=</span>&nbsp;<span class="ident" id="3400434">r</span><span class="op" id="3400435">.</span><span class="ident" id="3400436">readLineSlice</span><span class="op" id="3400449">(</span><span class="op" id="3400450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400453">return</span>&nbsp;<span class="builtintype" id="3400460">string</span><span class="op" id="3400466">(</span><span class="ident" id="3400467">line</span><span class="op" id="3400471">)</span><span class="op" id="3400472">,</span>&nbsp;<span class="ident" id="3400474">err</span><br>
<span class="lineno"></span><span class="op" id="3400478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3400481">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3400557">func</span>&nbsp;<span class="op" id="3400562">(</span><span class="ident" id="3400563">r</span>&nbsp;<span class="op" id="3400565">*</span><span class="ident" id="3400566">Reader</span><span class="op" id="3400572">)</span>&nbsp;<span class="ident" id="3400574">ReadLineBytes</span><span class="op" id="3400587">(</span><span class="op" id="3400588">)</span>&nbsp;<span class="op" id="3400590">(</span><span class="op" id="3400591">[</span><span class="op" id="3400592">]</span><span class="builtintype" id="3400593">byte</span><span class="op" id="3400597">,</span>&nbsp;<span class="builtintype" id="3400599">error</span><span class="op" id="3400604">)</span>&nbsp;<span class="op" id="3400606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400609">line</span><span class="op" id="3400613">,</span>&nbsp;<span class="ident" id="3400615">err</span>&nbsp;<span class="op" id="3400619">:=</span>&nbsp;<span class="ident" id="3400622">r</span><span class="op" id="3400623">.</span><span class="ident" id="3400624">readLineSlice</span><span class="op" id="3400637">(</span><span class="op" id="3400638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400641">if</span>&nbsp;<span class="ident" id="3400644">line</span>&nbsp;<span class="op" id="3400649">!=</span>&nbsp;<span class="ident" id="3400652">nil</span>&nbsp;<span class="op" id="3400656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400660">buf</span>&nbsp;<span class="op" id="3400664">:=</span>&nbsp;<span class="builtinfunc" id="3400667">make</span><span class="op" id="3400671">(</span><span class="op" id="3400672">[</span><span class="op" id="3400673">]</span><span class="builtintype" id="3400674">byte</span><span class="op" id="3400678">,</span>&nbsp;<span class="builtinfunc" id="3400680">len</span><span class="op" id="3400683">(</span><span class="ident" id="3400684">line</span><span class="op" id="3400688">)</span><span class="op" id="3400689">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3400693">copy</span><span class="op" id="3400697">(</span><span class="ident" id="3400698">buf</span><span class="op" id="3400701">,</span>&nbsp;<span class="ident" id="3400703">line</span><span class="op" id="3400707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400711">line</span>&nbsp;<span class="op" id="3400716">=</span>&nbsp;<span class="ident" id="3400718">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400726">return</span>&nbsp;<span class="ident" id="3400733">line</span><span class="op" id="3400737">,</span>&nbsp;<span class="ident" id="3400739">err</span><br>
<span class="lineno"></span><span class="op" id="3400743">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3400746">func</span>&nbsp;<span class="op" id="3400751">(</span><span class="ident" id="3400752">r</span>&nbsp;<span class="op" id="3400754">*</span><span class="ident" id="3400755">Reader</span><span class="op" id="3400761">)</span>&nbsp;<span class="ident" id="3400763">readLineSlice</span><span class="op" id="3400776">(</span><span class="op" id="3400777">)</span>&nbsp;<span class="op" id="3400779">(</span><span class="op" id="3400780">[</span><span class="op" id="3400781">]</span><span class="builtintype" id="3400782">byte</span><span class="op" id="3400786">,</span>&nbsp;<span class="builtintype" id="3400788">error</span><span class="op" id="3400793">)</span>&nbsp;<span class="op" id="3400795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400798">r</span><span class="op" id="3400799">.</span><span class="ident" id="3400800">closeDot</span><span class="op" id="3400808">(</span><span class="op" id="3400809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400812">var</span>&nbsp;<span class="ident" id="3400816">line</span>&nbsp;<span class="op" id="3400821">[</span><span class="op" id="3400822">]</span><span class="builtintype" id="3400823">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400829">for</span>&nbsp;<span class="op" id="3400833">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3400837">l</span><span class="op" id="3400838">,</span>&nbsp;<span class="ident" id="3400840">more</span><span class="op" id="3400844">,</span>&nbsp;<span class="ident" id="3400846">err</span>&nbsp;<span class="op" id="3400850">:=</span>&nbsp;<span class="ident" id="3400853">r</span><span class="op" id="3400854">.</span><span class="ident" id="3400855">R</span><span class="op" id="3400856">.</span><span class="ident" id="3400857">ReadLine</span><span class="op" id="3400865">(</span><span class="op" id="3400866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400870">if</span>&nbsp;<span class="ident" id="3400873">err</span>&nbsp;<span class="op" id="3400877">!=</span>&nbsp;<span class="ident" id="3400880">nil</span>&nbsp;<span class="op" id="3400884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400889">return</span>&nbsp;<span class="ident" id="3400896">nil</span><span class="op" id="3400899">,</span>&nbsp;<span class="ident" id="3400901">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3400907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3400911">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3400971">if</span>&nbsp;<span class="ident" id="3400974">line</span>&nbsp;<span class="op" id="3400979">==</span>&nbsp;<span class="ident" id="3400982">nil</span>&nbsp;<span class="op" id="3400986">&amp;&amp;</span>&nbsp;<span class="op" id="3400989">!</span><span class="ident" id="3400990">more</span>&nbsp;<span class="op" id="3400995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401000">return</span>&nbsp;<span class="ident" id="3401007">l</span><span class="op" id="3401008">,</span>&nbsp;<span class="ident" id="3401010">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401020">line</span>&nbsp;<span class="op" id="3401025">=</span>&nbsp;<span class="builtinfunc" id="3401027">append</span><span class="op" id="3401033">(</span><span class="ident" id="3401034">line</span><span class="op" id="3401038">,</span>&nbsp;<span class="ident" id="3401040">l</span><span class="op" id="3401041">...</span><span class="op" id="3401044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401048">if</span>&nbsp;<span class="op" id="3401051">!</span><span class="ident" id="3401052">more</span>&nbsp;<span class="op" id="3401057">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401062">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3401073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401076">return</span>&nbsp;<span class="ident" id="3401083">line</span><span class="op" id="3401087">,</span>&nbsp;<span class="ident" id="3401089">nil</span><br>
<span class="lineno"></span><span class="op" id="3401093">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3401096">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3401157">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3401206">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3401268">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3401331">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3401390">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3401453">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3401469">//</span><br>
<span class="lineno"></span><span class="comment" id="3401472">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3401509">//</span><br>
<span class="lineno"></span><span class="comment" id="3401512">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3401522">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3401540">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3401550">//</span><br>
<span class="lineno">85</span><span class="comment" id="3401553">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3401626">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3401666">//</span><br>
<span class="lineno"></span><span class="comment" id="3401669">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3401730">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3401733">func</span>&nbsp;<span class="op" id="3401738">(</span><span class="ident" id="3401739">r</span>&nbsp;<span class="op" id="3401741">*</span><span class="ident" id="3401742">Reader</span><span class="op" id="3401748">)</span>&nbsp;<span class="ident" id="3401750">ReadContinuedLine</span><span class="op" id="3401767">(</span><span class="op" id="3401768">)</span>&nbsp;<span class="op" id="3401770">(</span><span class="builtintype" id="3401771">string</span><span class="op" id="3401777">,</span>&nbsp;<span class="builtintype" id="3401779">error</span><span class="op" id="3401784">)</span>&nbsp;<span class="op" id="3401786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401789">line</span><span class="op" id="3401793">,</span>&nbsp;<span class="ident" id="3401795">err</span>&nbsp;<span class="op" id="3401799">:=</span>&nbsp;<span class="ident" id="3401802">r</span><span class="op" id="3401803">.</span><span class="ident" id="3401804">readContinuedLineSlice</span><span class="op" id="3401826">(</span><span class="op" id="3401827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3401830">return</span>&nbsp;<span class="builtintype" id="3401837">string</span><span class="op" id="3401843">(</span><span class="ident" id="3401844">line</span><span class="op" id="3401848">)</span><span class="op" id="3401849">,</span>&nbsp;<span class="ident" id="3401851">err</span><br>
<span class="lineno"></span><span class="op" id="3401855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3401858">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3401927">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3401967">func</span>&nbsp;<span class="ident" id="3401972">trim</span><span class="op" id="3401976">(</span><span class="ident" id="3401977">s</span>&nbsp;<span class="op" id="3401979">[</span><span class="op" id="3401980">]</span><span class="builtintype" id="3401981">byte</span><span class="op" id="3401985">)</span>&nbsp;<span class="op" id="3401987">[</span><span class="op" id="3401988">]</span><span class="builtintype" id="3401989">byte</span>&nbsp;<span class="op" id="3401994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3401997">i</span>&nbsp;<span class="op" id="3401999">:=</span>&nbsp;<span class="num" id="3402002">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402005">for</span>&nbsp;<span class="ident" id="3402009">i</span>&nbsp;<span class="op" id="3402011">&lt;</span>&nbsp;<span class="builtinfunc" id="3402013">len</span><span class="op" id="3402016">(</span><span class="ident" id="3402017">s</span><span class="op" id="3402018">)</span>&nbsp;<span class="op" id="3402020">&amp;&amp;</span>&nbsp;<span class="op" id="3402023">(</span><span class="ident" id="3402024">s</span><span class="op" id="3402025">[</span><span class="ident" id="3402026">i</span><span class="op" id="3402027">]</span>&nbsp;<span class="op" id="3402029">==</span>&nbsp;<span class="string" id="3402032">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3402036">||</span>&nbsp;<span class="ident" id="3402039">s</span><span class="op" id="3402040">[</span><span class="ident" id="3402041">i</span><span class="op" id="3402042">]</span>&nbsp;<span class="op" id="3402044">==</span>&nbsp;<span class="string" id="3402047">&#39;\t&#39;</span><span class="op" id="3402051">)</span>&nbsp;<span class="op" id="3402053">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402057">i</span><span class="op" id="3402058">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402065">n</span>&nbsp;<span class="op" id="3402067">:=</span>&nbsp;<span class="builtinfunc" id="3402070">len</span><span class="op" id="3402073">(</span><span class="ident" id="3402074">s</span><span class="op" id="3402075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402078">for</span>&nbsp;<span class="ident" id="3402082">n</span>&nbsp;<span class="op" id="3402084">&gt;</span>&nbsp;<span class="ident" id="3402086">i</span>&nbsp;<span class="op" id="3402088">&amp;&amp;</span>&nbsp;<span class="op" id="3402091">(</span><span class="ident" id="3402092">s</span><span class="op" id="3402093">[</span><span class="ident" id="3402094">n</span><span class="op" id="3402095">-</span><span class="num" id="3402096">1</span><span class="op" id="3402097">]</span>&nbsp;<span class="op" id="3402099">==</span>&nbsp;<span class="string" id="3402102">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3402106">||</span>&nbsp;<span class="ident" id="3402109">s</span><span class="op" id="3402110">[</span><span class="ident" id="3402111">n</span><span class="op" id="3402112">-</span><span class="num" id="3402113">1</span><span class="op" id="3402114">]</span>&nbsp;<span class="op" id="3402116">==</span>&nbsp;<span class="string" id="3402119">&#39;\t&#39;</span><span class="op" id="3402123">)</span>&nbsp;<span class="op" id="3402125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402129">n</span><span class="op" id="3402130">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402137">return</span>&nbsp;<span class="ident" id="3402144">s</span><span class="op" id="3402145">[</span><span class="ident" id="3402146">i</span><span class="op" id="3402147">:</span><span class="ident" id="3402148">n</span><span class="op" id="3402149">]</span><br>
<span class="lineno"></span><span class="op" id="3402151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3402154">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3402210">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3402251">func</span>&nbsp;<span class="op" id="3402256">(</span><span class="ident" id="3402257">r</span>&nbsp;<span class="op" id="3402259">*</span><span class="ident" id="3402260">Reader</span><span class="op" id="3402266">)</span>&nbsp;<span class="ident" id="3402268">ReadContinuedLineBytes</span><span class="op" id="3402290">(</span><span class="op" id="3402291">)</span>&nbsp;<span class="op" id="3402293">(</span><span class="op" id="3402294">[</span><span class="op" id="3402295">]</span><span class="builtintype" id="3402296">byte</span><span class="op" id="3402300">,</span>&nbsp;<span class="builtintype" id="3402302">error</span><span class="op" id="3402307">)</span>&nbsp;<span class="op" id="3402309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402312">line</span><span class="op" id="3402316">,</span>&nbsp;<span class="ident" id="3402318">err</span>&nbsp;<span class="op" id="3402322">:=</span>&nbsp;<span class="ident" id="3402325">r</span><span class="op" id="3402326">.</span><span class="ident" id="3402327">readContinuedLineSlice</span><span class="op" id="3402349">(</span><span class="op" id="3402350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402353">if</span>&nbsp;<span class="ident" id="3402356">line</span>&nbsp;<span class="op" id="3402361">!=</span>&nbsp;<span class="ident" id="3402364">nil</span>&nbsp;<span class="op" id="3402368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402372">buf</span>&nbsp;<span class="op" id="3402376">:=</span>&nbsp;<span class="builtinfunc" id="3402379">make</span><span class="op" id="3402383">(</span><span class="op" id="3402384">[</span><span class="op" id="3402385">]</span><span class="builtintype" id="3402386">byte</span><span class="op" id="3402390">,</span>&nbsp;<span class="builtinfunc" id="3402392">len</span><span class="op" id="3402395">(</span><span class="ident" id="3402396">line</span><span class="op" id="3402400">)</span><span class="op" id="3402401">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3402405">copy</span><span class="op" id="3402409">(</span><span class="ident" id="3402410">buf</span><span class="op" id="3402413">,</span>&nbsp;<span class="ident" id="3402415">line</span><span class="op" id="3402419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402423">line</span>&nbsp;<span class="op" id="3402428">=</span>&nbsp;<span class="ident" id="3402430">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402438">return</span>&nbsp;<span class="ident" id="3402445">line</span><span class="op" id="3402449">,</span>&nbsp;<span class="ident" id="3402451">err</span><br>
<span class="lineno"></span><span class="op" id="3402455">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3402458">func</span>&nbsp;<span class="op" id="3402463">(</span><span class="ident" id="3402464">r</span>&nbsp;<span class="op" id="3402466">*</span><span class="ident" id="3402467">Reader</span><span class="op" id="3402473">)</span>&nbsp;<span class="ident" id="3402475">readContinuedLineSlice</span><span class="op" id="3402497">(</span><span class="op" id="3402498">)</span>&nbsp;<span class="op" id="3402500">(</span><span class="op" id="3402501">[</span><span class="op" id="3402502">]</span><span class="builtintype" id="3402503">byte</span><span class="op" id="3402507">,</span>&nbsp;<span class="builtintype" id="3402509">error</span><span class="op" id="3402514">)</span>&nbsp;<span class="op" id="3402516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402519">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402544">line</span><span class="op" id="3402548">,</span>&nbsp;<span class="ident" id="3402550">err</span>&nbsp;<span class="op" id="3402554">:=</span>&nbsp;<span class="ident" id="3402557">r</span><span class="op" id="3402558">.</span><span class="ident" id="3402559">readLineSlice</span><span class="op" id="3402572">(</span><span class="op" id="3402573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402576">if</span>&nbsp;<span class="ident" id="3402579">err</span>&nbsp;<span class="op" id="3402583">!=</span>&nbsp;<span class="ident" id="3402586">nil</span>&nbsp;<span class="op" id="3402590">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402594">return</span>&nbsp;<span class="ident" id="3402601">nil</span><span class="op" id="3402604">,</span>&nbsp;<span class="ident" id="3402606">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402614">if</span>&nbsp;<span class="builtinfunc" id="3402617">len</span><span class="op" id="3402620">(</span><span class="ident" id="3402621">line</span><span class="op" id="3402625">)</span>&nbsp;<span class="op" id="3402627">==</span>&nbsp;<span class="num" id="3402630">0</span>&nbsp;<span class="op" id="3402632">{</span>&nbsp;<span class="comment" id="3402634">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402668">return</span>&nbsp;<span class="ident" id="3402675">line</span><span class="op" id="3402679">,</span>&nbsp;<span class="ident" id="3402681">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3402686">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402690">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402761">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402833">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3402905">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402934">if</span>&nbsp;<span class="ident" id="3402937">r</span><span class="op" id="3402938">.</span><span class="ident" id="3402939">R</span><span class="op" id="3402940">.</span><span class="ident" id="3402941">Buffered</span><span class="op" id="3402949">(</span><span class="op" id="3402950">)</span>&nbsp;<span class="op" id="3402952">&gt;</span>&nbsp;<span class="num" id="3402954">1</span>&nbsp;<span class="op" id="3402956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3402960">peek</span><span class="op" id="3402964">,</span>&nbsp;<span class="ident" id="3402966">err</span>&nbsp;<span class="op" id="3402970">:=</span>&nbsp;<span class="ident" id="3402973">r</span><span class="op" id="3402974">.</span><span class="ident" id="3402975">R</span><span class="op" id="3402976">.</span><span class="ident" id="3402977">Peek</span><span class="op" id="3402981">(</span><span class="num" id="3402982">1</span><span class="op" id="3402983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3402987">if</span>&nbsp;<span class="ident" id="3402990">err</span>&nbsp;<span class="op" id="3402994">==</span>&nbsp;<span class="ident" id="3402997">nil</span>&nbsp;<span class="op" id="3403001">&amp;&amp;</span>&nbsp;<span class="ident" id="3403004">isASCIILetter</span><span class="op" id="3403017">(</span><span class="ident" id="3403018">peek</span><span class="op" id="3403022">[</span><span class="num" id="3403023">0</span><span class="op" id="3403024">]</span><span class="op" id="3403025">)</span>&nbsp;<span class="op" id="3403027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403032">return</span>&nbsp;<span class="ident" id="3403039">trim</span><span class="op" id="3403043">(</span><span class="ident" id="3403044">line</span><span class="op" id="3403048">)</span><span class="op" id="3403049">,</span>&nbsp;<span class="ident" id="3403051">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403057">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403064">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403131">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403160">r</span><span class="op" id="3403161">.</span><span class="ident" id="3403162">buf</span>&nbsp;<span class="op" id="3403166">=</span>&nbsp;<span class="builtinfunc" id="3403168">append</span><span class="op" id="3403174">(</span><span class="ident" id="3403175">r</span><span class="op" id="3403176">.</span><span class="ident" id="3403177">buf</span><span class="op" id="3403180">[</span><span class="op" id="3403181">:</span><span class="num" id="3403182">0</span><span class="op" id="3403183">]</span><span class="op" id="3403184">,</span>&nbsp;<span class="ident" id="3403186">trim</span><span class="op" id="3403190">(</span><span class="ident" id="3403191">line</span><span class="op" id="3403195">)</span><span class="op" id="3403196">...</span><span class="op" id="3403199">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403203">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403232">for</span>&nbsp;<span class="ident" id="3403236">r</span><span class="op" id="3403237">.</span><span class="ident" id="3403238">skipSpace</span><span class="op" id="3403247">(</span><span class="op" id="3403248">)</span>&nbsp;<span class="op" id="3403250">&gt;</span>&nbsp;<span class="num" id="3403252">0</span>&nbsp;<span class="op" id="3403254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403258">line</span><span class="op" id="3403262">,</span>&nbsp;<span class="ident" id="3403264">err</span>&nbsp;<span class="op" id="3403268">:=</span>&nbsp;<span class="ident" id="3403271">r</span><span class="op" id="3403272">.</span><span class="ident" id="3403273">readLineSlice</span><span class="op" id="3403286">(</span><span class="op" id="3403287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403291">if</span>&nbsp;<span class="ident" id="3403294">err</span>&nbsp;<span class="op" id="3403298">!=</span>&nbsp;<span class="ident" id="3403301">nil</span>&nbsp;<span class="op" id="3403305">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403310">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403322">r</span><span class="op" id="3403323">.</span><span class="ident" id="3403324">buf</span>&nbsp;<span class="op" id="3403328">=</span>&nbsp;<span class="builtinfunc" id="3403330">append</span><span class="op" id="3403336">(</span><span class="ident" id="3403337">r</span><span class="op" id="3403338">.</span><span class="ident" id="3403339">buf</span><span class="op" id="3403342">,</span>&nbsp;<span class="string" id="3403344">&#39;&nbsp;&#39;</span><span class="op" id="3403347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403351">r</span><span class="op" id="3403352">.</span><span class="ident" id="3403353">buf</span>&nbsp;<span class="op" id="3403357">=</span>&nbsp;<span class="builtinfunc" id="3403359">append</span><span class="op" id="3403365">(</span><span class="ident" id="3403366">r</span><span class="op" id="3403367">.</span><span class="ident" id="3403368">buf</span><span class="op" id="3403371">,</span>&nbsp;<span class="ident" id="3403373">line</span><span class="op" id="3403377">...</span><span class="op" id="3403380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403383">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403386">return</span>&nbsp;<span class="ident" id="3403393">r</span><span class="op" id="3403394">.</span><span class="ident" id="3403395">buf</span><span class="op" id="3403398">,</span>&nbsp;<span class="ident" id="3403400">nil</span><br>
<span class="lineno"></span><span class="op" id="3403404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3403407">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3403485">func</span>&nbsp;<span class="op" id="3403490">(</span><span class="ident" id="3403491">r</span>&nbsp;<span class="op" id="3403493">*</span><span class="ident" id="3403494">Reader</span><span class="op" id="3403500">)</span>&nbsp;<span class="ident" id="3403502">skipSpace</span><span class="op" id="3403511">(</span><span class="op" id="3403512">)</span>&nbsp;<span class="builtintype" id="3403514">int</span>&nbsp;<span class="op" id="3403518">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403521">n</span>&nbsp;<span class="op" id="3403523">:=</span>&nbsp;<span class="num" id="3403526">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403529">for</span>&nbsp;<span class="op" id="3403533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403537">c</span><span class="op" id="3403538">,</span>&nbsp;<span class="ident" id="3403540">err</span>&nbsp;<span class="op" id="3403544">:=</span>&nbsp;<span class="ident" id="3403547">r</span><span class="op" id="3403548">.</span><span class="ident" id="3403549">R</span><span class="op" id="3403550">.</span><span class="ident" id="3403551">ReadByte</span><span class="op" id="3403559">(</span><span class="op" id="3403560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403564">if</span>&nbsp;<span class="ident" id="3403567">err</span>&nbsp;<span class="op" id="3403571">!=</span>&nbsp;<span class="ident" id="3403574">nil</span>&nbsp;<span class="op" id="3403578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3403583">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403626">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403638">if</span>&nbsp;<span class="ident" id="3403641">c</span>&nbsp;<span class="op" id="3403643">!=</span>&nbsp;<span class="string" id="3403646">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3403650">&amp;&amp;</span>&nbsp;<span class="ident" id="3403653">c</span>&nbsp;<span class="op" id="3403655">!=</span>&nbsp;<span class="string" id="3403658">&#39;\t&#39;</span>&nbsp;<span class="op" id="3403663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403668">r</span><span class="op" id="3403669">.</span><span class="ident" id="3403670">R</span><span class="op" id="3403671">.</span><span class="ident" id="3403672">UnreadByte</span><span class="op" id="3403682">(</span><span class="op" id="3403683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403688">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403700">n</span><span class="op" id="3403701">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403708">return</span>&nbsp;<span class="ident" id="3403715">n</span><br>
<span class="lineno"></span><span class="op" id="3403717">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3403720">func</span>&nbsp;<span class="op" id="3403725">(</span><span class="ident" id="3403726">r</span>&nbsp;<span class="op" id="3403728">*</span><span class="ident" id="3403729">Reader</span><span class="op" id="3403735">)</span>&nbsp;<span class="ident" id="3403737">readCodeLine</span><span class="op" id="3403749">(</span><span class="ident" id="3403750">expectCode</span>&nbsp;<span class="builtintype" id="3403761">int</span><span class="op" id="3403764">)</span>&nbsp;<span class="op" id="3403766">(</span><span class="ident" id="3403767">code</span>&nbsp;<span class="builtintype" id="3403772">int</span><span class="op" id="3403775">,</span>&nbsp;<span class="ident" id="3403777">continued</span>&nbsp;<span class="builtintype" id="3403787">bool</span><span class="op" id="3403791">,</span>&nbsp;<span class="ident" id="3403793">message</span>&nbsp;<span class="builtintype" id="3403801">string</span><span class="op" id="3403807">,</span>&nbsp;<span class="ident" id="3403809">err</span>&nbsp;<span class="builtintype" id="3403813">error</span><span class="op" id="3403818">)</span>&nbsp;<span class="op" id="3403820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3403823">line</span><span class="op" id="3403827">,</span>&nbsp;<span class="ident" id="3403829">err</span>&nbsp;<span class="op" id="3403833">:=</span>&nbsp;<span class="ident" id="3403836">r</span><span class="op" id="3403837">.</span><span class="ident" id="3403838">ReadLine</span><span class="op" id="3403846">(</span><span class="op" id="3403847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403850">if</span>&nbsp;<span class="ident" id="3403853">err</span>&nbsp;<span class="op" id="3403857">!=</span>&nbsp;<span class="ident" id="3403860">nil</span>&nbsp;<span class="op" id="3403864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403868">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3403876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3403879">return</span>&nbsp;<span class="ident" id="3403886">parseCodeLine</span><span class="op" id="3403899">(</span><span class="ident" id="3403900">line</span><span class="op" id="3403904">,</span>&nbsp;<span class="ident" id="3403906">expectCode</span><span class="op" id="3403916">)</span><br>
<span class="lineno"></span><span class="op" id="3403918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3403921">func</span>&nbsp;<span class="ident" id="3403926">parseCodeLine</span><span class="op" id="3403939">(</span><span class="ident" id="3403940">line</span>&nbsp;<span class="builtintype" id="3403945">string</span><span class="op" id="3403951">,</span>&nbsp;<span class="ident" id="3403953">expectCode</span>&nbsp;<span class="builtintype" id="3403964">int</span><span class="op" id="3403967">)</span>&nbsp;<span class="op" id="3403969">(</span><span class="ident" id="3403970">code</span>&nbsp;<span class="builtintype" id="3403975">int</span><span class="op" id="3403978">,</span>&nbsp;<span class="ident" id="3403980">continued</span>&nbsp;<span class="builtintype" id="3403990">bool</span><span class="op" id="3403994">,</span>&nbsp;<span class="ident" id="3403996">message</span>&nbsp;<span class="builtintype" id="3404004">string</span><span class="op" id="3404010">,</span>&nbsp;<span class="ident" id="3404012">err</span>&nbsp;<span class="builtintype" id="3404016">error</span><span class="op" id="3404021">)</span>&nbsp;<span class="op" id="3404023">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404026">if</span>&nbsp;<span class="builtinfunc" id="3404029">len</span><span class="op" id="3404032">(</span><span class="ident" id="3404033">line</span><span class="op" id="3404037">)</span>&nbsp;<span class="op" id="3404039">&lt;</span>&nbsp;<span class="num" id="3404041">4</span>&nbsp;<span class="op" id="3404043">||</span>&nbsp;<span class="ident" id="3404046">line</span><span class="op" id="3404050">[</span><span class="num" id="3404051">3</span><span class="op" id="3404052">]</span>&nbsp;<span class="op" id="3404054">!=</span>&nbsp;<span class="string" id="3404057">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3404061">&amp;&amp;</span>&nbsp;<span class="ident" id="3404064">line</span><span class="op" id="3404068">[</span><span class="num" id="3404069">3</span><span class="op" id="3404070">]</span>&nbsp;<span class="op" id="3404072">!=</span>&nbsp;<span class="string" id="3404075">&#39;-&#39;</span>&nbsp;<span class="op" id="3404079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404083">err</span>&nbsp;<span class="op" id="3404087">=</span>&nbsp;<span class="ident" id="3404089">ProtocolError</span><span class="op" id="3404102">(</span><span class="string" id="3404103">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3404122">+</span>&nbsp;<span class="ident" id="3404124">line</span><span class="op" id="3404128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404132">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404143">continued</span>&nbsp;<span class="op" id="3404153">=</span>&nbsp;<span class="ident" id="3404155">line</span><span class="op" id="3404159">[</span><span class="num" id="3404160">3</span><span class="op" id="3404161">]</span>&nbsp;<span class="op" id="3404163">==</span>&nbsp;<span class="string" id="3404166">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404171">code</span><span class="op" id="3404175">,</span>&nbsp;<span class="ident" id="3404177">err</span>&nbsp;<span class="op" id="3404181">=</span>&nbsp;<span class="ident" id="3404183">strconv</span><span class="op" id="3404190">.</span><span class="ident" id="3404191">Atoi</span><span class="op" id="3404195">(</span><span class="ident" id="3404196">line</span><span class="op" id="3404200">[</span><span class="num" id="3404201">0</span><span class="op" id="3404202">:</span><span class="num" id="3404203">3</span><span class="op" id="3404204">]</span><span class="op" id="3404205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404208">if</span>&nbsp;<span class="ident" id="3404211">err</span>&nbsp;<span class="op" id="3404215">!=</span>&nbsp;<span class="ident" id="3404218">nil</span>&nbsp;<span class="op" id="3404222">||</span>&nbsp;<span class="ident" id="3404225">code</span>&nbsp;<span class="op" id="3404230">&lt;</span>&nbsp;<span class="num" id="3404232">100</span>&nbsp;<span class="op" id="3404236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404240">err</span>&nbsp;<span class="op" id="3404244">=</span>&nbsp;<span class="ident" id="3404246">ProtocolError</span><span class="op" id="3404259">(</span><span class="string" id="3404260">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3404286">+</span>&nbsp;<span class="ident" id="3404288">line</span><span class="op" id="3404292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404296">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404304">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404307">message</span>&nbsp;<span class="op" id="3404315">=</span>&nbsp;<span class="ident" id="3404317">line</span><span class="op" id="3404321">[</span><span class="num" id="3404322">4</span><span class="op" id="3404323">:</span><span class="op" id="3404324">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404327">if</span>&nbsp;<span class="num" id="3404330">1</span>&nbsp;<span class="op" id="3404332">&lt;=</span>&nbsp;<span class="ident" id="3404335">expectCode</span>&nbsp;<span class="op" id="3404346">&amp;&amp;</span>&nbsp;<span class="ident" id="3404349">expectCode</span>&nbsp;<span class="op" id="3404360">&lt;</span>&nbsp;<span class="num" id="3404362">10</span>&nbsp;<span class="op" id="3404365">&amp;&amp;</span>&nbsp;<span class="ident" id="3404368">code</span><span class="op" id="3404372">/</span><span class="num" id="3404373">100</span>&nbsp;<span class="op" id="3404377">!=</span>&nbsp;<span class="ident" id="3404380">expectCode</span>&nbsp;<span class="op" id="3404391">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3404396">10</span>&nbsp;<span class="op" id="3404399">&lt;=</span>&nbsp;<span class="ident" id="3404402">expectCode</span>&nbsp;<span class="op" id="3404413">&amp;&amp;</span>&nbsp;<span class="ident" id="3404416">expectCode</span>&nbsp;<span class="op" id="3404427">&lt;</span>&nbsp;<span class="num" id="3404429">100</span>&nbsp;<span class="op" id="3404433">&amp;&amp;</span>&nbsp;<span class="ident" id="3404436">code</span><span class="op" id="3404440">/</span><span class="num" id="3404441">10</span>&nbsp;<span class="op" id="3404444">!=</span>&nbsp;<span class="ident" id="3404447">expectCode</span>&nbsp;<span class="op" id="3404458">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3404463">100</span>&nbsp;<span class="op" id="3404467">&lt;=</span>&nbsp;<span class="ident" id="3404470">expectCode</span>&nbsp;<span class="op" id="3404481">&amp;&amp;</span>&nbsp;<span class="ident" id="3404484">expectCode</span>&nbsp;<span class="op" id="3404495">&lt;</span>&nbsp;<span class="num" id="3404497">1000</span>&nbsp;<span class="op" id="3404502">&amp;&amp;</span>&nbsp;<span class="ident" id="3404505">code</span>&nbsp;<span class="op" id="3404510">!=</span>&nbsp;<span class="ident" id="3404513">expectCode</span>&nbsp;<span class="op" id="3404524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3404528">err</span>&nbsp;<span class="op" id="3404532">=</span>&nbsp;<span class="op" id="3404534">&amp;</span><span class="ident" id="3404535">Error</span><span class="op" id="3404540">{</span><span class="ident" id="3404541">code</span><span class="op" id="3404545">,</span>&nbsp;<span class="ident" id="3404547">message</span><span class="op" id="3404554">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3404557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3404560">return</span><br>
<span class="lineno"></span><span class="op" id="3404567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3404570">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3404625">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3404641">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3404700">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3404767">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3404800">//</span><br>
<span class="lineno">210</span><span class="comment" id="3404803">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3404875">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3404938">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3405004">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3405049">//</span><br>
<span class="lineno">215</span><span class="comment" id="3405052">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3405117">//</span><br>
<span class="lineno"></span><span class="comment" id="3405120">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3405181">//</span><br>
<span class="lineno"></span><span class="keyword" id="3405184">func</span>&nbsp;<span class="op" id="3405189">(</span><span class="ident" id="3405190">r</span>&nbsp;<span class="op" id="3405192">*</span><span class="ident" id="3405193">Reader</span><span class="op" id="3405199">)</span>&nbsp;<span class="ident" id="3405201">ReadCodeLine</span><span class="op" id="3405213">(</span><span class="ident" id="3405214">expectCode</span>&nbsp;<span class="builtintype" id="3405225">int</span><span class="op" id="3405228">)</span>&nbsp;<span class="op" id="3405230">(</span><span class="ident" id="3405231">code</span>&nbsp;<span class="builtintype" id="3405236">int</span><span class="op" id="3405239">,</span>&nbsp;<span class="ident" id="3405241">message</span>&nbsp;<span class="builtintype" id="3405249">string</span><span class="op" id="3405255">,</span>&nbsp;<span class="ident" id="3405257">err</span>&nbsp;<span class="builtintype" id="3405261">error</span><span class="op" id="3405266">)</span>&nbsp;<span class="op" id="3405268">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405271">code</span><span class="op" id="3405275">,</span>&nbsp;<span class="ident" id="3405277">continued</span><span class="op" id="3405286">,</span>&nbsp;<span class="ident" id="3405288">message</span><span class="op" id="3405295">,</span>&nbsp;<span class="ident" id="3405297">err</span>&nbsp;<span class="op" id="3405301">:=</span>&nbsp;<span class="ident" id="3405304">r</span><span class="op" id="3405305">.</span><span class="ident" id="3405306">readCodeLine</span><span class="op" id="3405318">(</span><span class="ident" id="3405319">expectCode</span><span class="op" id="3405329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405332">if</span>&nbsp;<span class="ident" id="3405335">err</span>&nbsp;<span class="op" id="3405339">==</span>&nbsp;<span class="ident" id="3405342">nil</span>&nbsp;<span class="op" id="3405346">&amp;&amp;</span>&nbsp;<span class="ident" id="3405349">continued</span>&nbsp;<span class="op" id="3405359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3405363">err</span>&nbsp;<span class="op" id="3405367">=</span>&nbsp;<span class="ident" id="3405369">ProtocolError</span><span class="op" id="3405382">(</span><span class="string" id="3405383">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3405418">+</span>&nbsp;<span class="ident" id="3405420">message</span><span class="op" id="3405427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3405430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3405433">return</span><br>
<span class="lineno">225</span><span class="op" id="3405440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3405443">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3405500">//</span><br>
<span class="lineno"></span><span class="comment" id="3405503">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3405526">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3405549">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3405556">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3405579">//</span><br>
<span class="lineno"></span><span class="comment" id="3405582">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3405657">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3405728">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3405795">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3405827">//</span><br>
<span class="lineno"></span><span class="comment" id="3405830">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3405897">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3405909">//</span><br>
<span class="lineno"></span><span class="comment" id="3405912">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3405984">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3406047">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3406113">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3406158">//</span><br>
<span class="lineno"></span><span class="comment" id="3406161">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3406222">//</span><br>
<span class="lineno"></span><span class="keyword" id="3406225">func</span>&nbsp;<span class="op" id="3406230">(</span><span class="ident" id="3406231">r</span>&nbsp;<span class="op" id="3406233">*</span><span class="ident" id="3406234">Reader</span><span class="op" id="3406240">)</span>&nbsp;<span class="ident" id="3406242">ReadResponse</span><span class="op" id="3406254">(</span><span class="ident" id="3406255">expectCode</span>&nbsp;<span class="builtintype" id="3406266">int</span><span class="op" id="3406269">)</span>&nbsp;<span class="op" id="3406271">(</span><span class="ident" id="3406272">code</span>&nbsp;<span class="builtintype" id="3406277">int</span><span class="op" id="3406280">,</span>&nbsp;<span class="ident" id="3406282">message</span>&nbsp;<span class="builtintype" id="3406290">string</span><span class="op" id="3406296">,</span>&nbsp;<span class="ident" id="3406298">err</span>&nbsp;<span class="builtintype" id="3406302">error</span><span class="op" id="3406307">)</span>&nbsp;<span class="op" id="3406309">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406312">code</span><span class="op" id="3406316">,</span>&nbsp;<span class="ident" id="3406318">continued</span><span class="op" id="3406327">,</span>&nbsp;<span class="ident" id="3406329">message</span><span class="op" id="3406336">,</span>&nbsp;<span class="ident" id="3406338">err</span>&nbsp;<span class="op" id="3406342">:=</span>&nbsp;<span class="ident" id="3406345">r</span><span class="op" id="3406346">.</span><span class="ident" id="3406347">readCodeLine</span><span class="op" id="3406359">(</span><span class="ident" id="3406360">expectCode</span><span class="op" id="3406370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406373">for</span>&nbsp;<span class="ident" id="3406377">err</span>&nbsp;<span class="op" id="3406381">==</span>&nbsp;<span class="ident" id="3406384">nil</span>&nbsp;<span class="op" id="3406388">&amp;&amp;</span>&nbsp;<span class="ident" id="3406391">continued</span>&nbsp;<span class="op" id="3406401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406405">line</span><span class="op" id="3406409">,</span>&nbsp;<span class="ident" id="3406411">err</span>&nbsp;<span class="op" id="3406415">:=</span>&nbsp;<span class="ident" id="3406418">r</span><span class="op" id="3406419">.</span><span class="ident" id="3406420">ReadLine</span><span class="op" id="3406428">(</span><span class="op" id="3406429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406433">if</span>&nbsp;<span class="ident" id="3406436">err</span>&nbsp;<span class="op" id="3406440">!=</span>&nbsp;<span class="ident" id="3406443">nil</span>&nbsp;<span class="op" id="3406447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406452">return</span>&nbsp;<span class="num" id="3406459">0</span><span class="op" id="3406460">,</span>&nbsp;<span class="string" id="3406462">&#34;&#34;</span><span class="op" id="3406464">,</span>&nbsp;<span class="ident" id="3406466">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406477">var</span>&nbsp;<span class="ident" id="3406481">code2</span>&nbsp;<span class="builtintype" id="3406487">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406493">var</span>&nbsp;<span class="ident" id="3406497">moreMessage</span>&nbsp;<span class="builtintype" id="3406509">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406518">code2</span><span class="op" id="3406523">,</span>&nbsp;<span class="ident" id="3406525">continued</span><span class="op" id="3406534">,</span>&nbsp;<span class="ident" id="3406536">moreMessage</span><span class="op" id="3406547">,</span>&nbsp;<span class="ident" id="3406549">err</span>&nbsp;<span class="op" id="3406553">=</span>&nbsp;<span class="ident" id="3406555">parseCodeLine</span><span class="op" id="3406568">(</span><span class="ident" id="3406569">line</span><span class="op" id="3406573">,</span>&nbsp;<span class="ident" id="3406575">expectCode</span><span class="op" id="3406585">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406589">if</span>&nbsp;<span class="ident" id="3406592">err</span>&nbsp;<span class="op" id="3406596">!=</span>&nbsp;<span class="ident" id="3406599">nil</span>&nbsp;<span class="op" id="3406603">||</span>&nbsp;<span class="ident" id="3406606">code2</span>&nbsp;<span class="op" id="3406612">!=</span>&nbsp;<span class="ident" id="3406615">code</span>&nbsp;<span class="op" id="3406620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406625">message</span>&nbsp;<span class="op" id="3406633">+=</span>&nbsp;<span class="string" id="3406636">&#34;\n&#34;</span>&nbsp;<span class="op" id="3406641">+</span>&nbsp;<span class="ident" id="3406643">strings</span><span class="op" id="3406650">.</span><span class="ident" id="3406651">TrimRight</span><span class="op" id="3406660">(</span><span class="ident" id="3406661">line</span><span class="op" id="3406665">,</span>&nbsp;<span class="string" id="3406667">&#34;\r\n&#34;</span><span class="op" id="3406673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406678">continued</span>&nbsp;<span class="op" id="3406688">=</span>&nbsp;<span class="builtintype" id="3406690">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406698">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406709">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3406713">message</span>&nbsp;<span class="op" id="3406721">+=</span>&nbsp;<span class="string" id="3406724">&#34;\n&#34;</span>&nbsp;<span class="op" id="3406729">+</span>&nbsp;<span class="ident" id="3406731">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3406744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3406747">return</span><br>
<span class="lineno"></span><span class="op" id="3406754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3406757">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3406822">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3406874">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3406931">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3406952">//</span><br>
<span class="lineno">275</span><span class="comment" id="3406955">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3407012">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3407080">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3407144">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3407211">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3407269">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3407310">//</span><br>
<span class="lineno"></span><span class="comment" id="3407313">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3407370">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3407429">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3407500">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3407562">func</span>&nbsp;<span class="op" id="3407567">(</span><span class="ident" id="3407568">r</span>&nbsp;<span class="op" id="3407570">*</span><span class="ident" id="3407571">Reader</span><span class="op" id="3407577">)</span>&nbsp;<span class="ident" id="3407579">DotReader</span><span class="op" id="3407588">(</span><span class="op" id="3407589">)</span>&nbsp;<span class="ident" id="3407591">io</span><span class="op" id="3407593">.</span><span class="ident" id="3407594">Reader</span>&nbsp;<span class="op" id="3407601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407604">r</span><span class="op" id="3407605">.</span><span class="ident" id="3407606">closeDot</span><span class="op" id="3407614">(</span><span class="op" id="3407615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407618">r</span><span class="op" id="3407619">.</span><span class="ident" id="3407620">dot</span>&nbsp;<span class="op" id="3407624">=</span>&nbsp;<span class="op" id="3407626">&amp;</span><span class="ident" id="3407627">dotReader</span><span class="op" id="3407636">{</span><span class="ident" id="3407637">r</span><span class="op" id="3407638">:</span>&nbsp;<span class="ident" id="3407640">r</span><span class="op" id="3407641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407644">return</span>&nbsp;<span class="ident" id="3407651">r</span><span class="op" id="3407652">.</span><span class="ident" id="3407653">dot</span><br>
<span class="lineno">290</span><span class="op" id="3407657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3407660">type</span>&nbsp;<span class="ident" id="3407665">dotReader</span>&nbsp;<span class="keyword" id="3407675">struct</span>&nbsp;<span class="op" id="3407682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407685">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3407691">*</span><span class="ident" id="3407692">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407700">state</span>&nbsp;<span class="builtintype" id="3407706">int</span><br>
<span class="lineno">295</span><span class="op" id="3407710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3407713">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3407781">func</span>&nbsp;<span class="op" id="3407786">(</span><span class="ident" id="3407787">d</span>&nbsp;<span class="op" id="3407789">*</span><span class="ident" id="3407790">dotReader</span><span class="op" id="3407799">)</span>&nbsp;<span class="ident" id="3407801">Read</span><span class="op" id="3407805">(</span><span class="ident" id="3407806">b</span>&nbsp;<span class="op" id="3407808">[</span><span class="op" id="3407809">]</span><span class="builtintype" id="3407810">byte</span><span class="op" id="3407814">)</span>&nbsp;<span class="op" id="3407816">(</span><span class="ident" id="3407817">n</span>&nbsp;<span class="builtintype" id="3407819">int</span><span class="op" id="3407822">,</span>&nbsp;<span class="ident" id="3407824">err</span>&nbsp;<span class="builtintype" id="3407828">error</span><span class="op" id="3407833">)</span>&nbsp;<span class="op" id="3407835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407838">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407885">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3407940">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3407974">const</span>&nbsp;<span class="op" id="3407980">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3407984">stateBeginLine</span>&nbsp;<span class="op" id="3407999">=</span>&nbsp;<span class="ident" id="3408001">iota</span>&nbsp;<span class="comment" id="3408006">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408058">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408080">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408113">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408135">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408170">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408192">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408231">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408253">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408289">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3408311">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408345">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408348">br</span>&nbsp;<span class="op" id="3408351">:=</span>&nbsp;<span class="ident" id="3408354">d</span><span class="op" id="3408355">.</span><span class="ident" id="3408356">r</span><span class="op" id="3408357">.</span><span class="ident" id="3408358">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408361">for</span>&nbsp;<span class="ident" id="3408365">n</span>&nbsp;<span class="op" id="3408367">&lt;</span>&nbsp;<span class="builtinfunc" id="3408369">len</span><span class="op" id="3408372">(</span><span class="ident" id="3408373">b</span><span class="op" id="3408374">)</span>&nbsp;<span class="op" id="3408376">&amp;&amp;</span>&nbsp;<span class="ident" id="3408379">d</span><span class="op" id="3408380">.</span><span class="ident" id="3408381">state</span>&nbsp;<span class="op" id="3408387">!=</span>&nbsp;<span class="ident" id="3408390">stateEOF</span>&nbsp;<span class="op" id="3408399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408403">var</span>&nbsp;<span class="ident" id="3408407">c</span>&nbsp;<span class="builtintype" id="3408409">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408416">c</span><span class="op" id="3408417">,</span>&nbsp;<span class="ident" id="3408419">err</span>&nbsp;<span class="op" id="3408423">=</span>&nbsp;<span class="ident" id="3408425">br</span><span class="op" id="3408427">.</span><span class="ident" id="3408428">ReadByte</span><span class="op" id="3408436">(</span><span class="op" id="3408437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408441">if</span>&nbsp;<span class="ident" id="3408444">err</span>&nbsp;<span class="op" id="3408448">!=</span>&nbsp;<span class="ident" id="3408451">nil</span>&nbsp;<span class="op" id="3408455">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408460">if</span>&nbsp;<span class="ident" id="3408463">err</span>&nbsp;<span class="op" id="3408467">==</span>&nbsp;<span class="ident" id="3408470">io</span><span class="op" id="3408472">.</span><span class="ident" id="3408473">EOF</span>&nbsp;<span class="op" id="3408477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408483">err</span>&nbsp;<span class="op" id="3408487">=</span>&nbsp;<span class="ident" id="3408489">io</span><span class="op" id="3408491">.</span><span class="ident" id="3408492">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408517">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408525">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408529">switch</span>&nbsp;<span class="ident" id="3408536">d</span><span class="op" id="3408537">.</span><span class="ident" id="3408538">state</span>&nbsp;<span class="op" id="3408544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408548">case</span>&nbsp;<span class="ident" id="3408553">stateBeginLine</span><span class="op" id="3408567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408572">if</span>&nbsp;<span class="ident" id="3408575">c</span>&nbsp;<span class="op" id="3408577">==</span>&nbsp;<span class="string" id="3408580">&#39;.&#39;</span>&nbsp;<span class="op" id="3408584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408590">d</span><span class="op" id="3408591">.</span><span class="ident" id="3408592">state</span>&nbsp;<span class="op" id="3408598">=</span>&nbsp;<span class="ident" id="3408600">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408613">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408630">if</span>&nbsp;<span class="ident" id="3408633">c</span>&nbsp;<span class="op" id="3408635">==</span>&nbsp;<span class="string" id="3408638">&#39;\r&#39;</span>&nbsp;<span class="op" id="3408643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408649">d</span><span class="op" id="3408650">.</span><span class="ident" id="3408651">state</span>&nbsp;<span class="op" id="3408657">=</span>&nbsp;<span class="ident" id="3408659">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408671">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408683">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408688">d</span><span class="op" id="3408689">.</span><span class="ident" id="3408690">state</span>&nbsp;<span class="op" id="3408696">=</span>&nbsp;<span class="ident" id="3408698">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408711">case</span>&nbsp;<span class="ident" id="3408716">stateDot</span><span class="op" id="3408724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408729">if</span>&nbsp;<span class="ident" id="3408732">c</span>&nbsp;<span class="op" id="3408734">==</span>&nbsp;<span class="string" id="3408737">&#39;\r&#39;</span>&nbsp;<span class="op" id="3408742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408748">d</span><span class="op" id="3408749">.</span><span class="ident" id="3408750">state</span>&nbsp;<span class="op" id="3408756">=</span>&nbsp;<span class="ident" id="3408758">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408773">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408790">if</span>&nbsp;<span class="ident" id="3408793">c</span>&nbsp;<span class="op" id="3408795">==</span>&nbsp;<span class="string" id="3408798">&#39;\n&#39;</span>&nbsp;<span class="op" id="3408803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408809">d</span><span class="op" id="3408810">.</span><span class="ident" id="3408811">state</span>&nbsp;<span class="op" id="3408817">=</span>&nbsp;<span class="ident" id="3408819">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408832">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408849">d</span><span class="op" id="3408850">.</span><span class="ident" id="3408851">state</span>&nbsp;<span class="op" id="3408857">=</span>&nbsp;<span class="ident" id="3408859">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408872">case</span>&nbsp;<span class="ident" id="3408877">stateDotCR</span><span class="op" id="3408887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408892">if</span>&nbsp;<span class="ident" id="3408895">c</span>&nbsp;<span class="op" id="3408897">==</span>&nbsp;<span class="string" id="3408900">&#39;\n&#39;</span>&nbsp;<span class="op" id="3408905">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3408911">d</span><span class="op" id="3408912">.</span><span class="ident" id="3408913">state</span>&nbsp;<span class="op" id="3408919">=</span>&nbsp;<span class="ident" id="3408921">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3408934">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3408946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408951">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3408976">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409021">br</span><span class="op" id="3409023">.</span><span class="ident" id="3409024">UnreadByte</span><span class="op" id="3409034">(</span><span class="op" id="3409035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409040">c</span>&nbsp;<span class="op" id="3409042">=</span>&nbsp;<span class="string" id="3409044">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409052">d</span><span class="op" id="3409053">.</span><span class="ident" id="3409054">state</span>&nbsp;<span class="op" id="3409060">=</span>&nbsp;<span class="ident" id="3409062">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409075">case</span>&nbsp;<span class="ident" id="3409080">stateCR</span><span class="op" id="3409087">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409092">if</span>&nbsp;<span class="ident" id="3409095">c</span>&nbsp;<span class="op" id="3409097">==</span>&nbsp;<span class="string" id="3409100">&#39;\n&#39;</span>&nbsp;<span class="op" id="3409105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409111">d</span><span class="op" id="3409112">.</span><span class="ident" id="3409113">state</span>&nbsp;<span class="op" id="3409119">=</span>&nbsp;<span class="ident" id="3409121">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409140">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409154">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409193">br</span><span class="op" id="3409195">.</span><span class="ident" id="3409196">UnreadByte</span><span class="op" id="3409206">(</span><span class="op" id="3409207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409212">c</span>&nbsp;<span class="op" id="3409214">=</span>&nbsp;<span class="string" id="3409216">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409224">d</span><span class="op" id="3409225">.</span><span class="ident" id="3409226">state</span>&nbsp;<span class="op" id="3409232">=</span>&nbsp;<span class="ident" id="3409234">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409247">case</span>&nbsp;<span class="ident" id="3409252">stateData</span><span class="op" id="3409261">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409266">if</span>&nbsp;<span class="ident" id="3409269">c</span>&nbsp;<span class="op" id="3409271">==</span>&nbsp;<span class="string" id="3409274">&#39;\r&#39;</span>&nbsp;<span class="op" id="3409279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409285">d</span><span class="op" id="3409286">.</span><span class="ident" id="3409287">state</span>&nbsp;<span class="op" id="3409293">=</span>&nbsp;<span class="ident" id="3409295">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409307">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409324">if</span>&nbsp;<span class="ident" id="3409327">c</span>&nbsp;<span class="op" id="3409329">==</span>&nbsp;<span class="string" id="3409332">&#39;\n&#39;</span>&nbsp;<span class="op" id="3409337">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409343">d</span><span class="op" id="3409344">.</span><span class="ident" id="3409345">state</span>&nbsp;<span class="op" id="3409351">=</span>&nbsp;<span class="ident" id="3409353">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409379">b</span><span class="op" id="3409380">[</span><span class="ident" id="3409381">n</span><span class="op" id="3409382">]</span>&nbsp;<span class="op" id="3409384">=</span>&nbsp;<span class="ident" id="3409386">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409390">n</span><span class="op" id="3409391">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409398">if</span>&nbsp;<span class="ident" id="3409401">err</span>&nbsp;<span class="op" id="3409405">==</span>&nbsp;<span class="ident" id="3409408">nil</span>&nbsp;<span class="op" id="3409412">&amp;&amp;</span>&nbsp;<span class="ident" id="3409415">d</span><span class="op" id="3409416">.</span><span class="ident" id="3409417">state</span>&nbsp;<span class="op" id="3409423">==</span>&nbsp;<span class="ident" id="3409426">stateEOF</span>&nbsp;<span class="op" id="3409435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409439">err</span>&nbsp;<span class="op" id="3409443">=</span>&nbsp;<span class="ident" id="3409445">io</span><span class="op" id="3409447">.</span><span class="ident" id="3409448">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409456">if</span>&nbsp;<span class="ident" id="3409459">err</span>&nbsp;<span class="op" id="3409463">!=</span>&nbsp;<span class="ident" id="3409466">nil</span>&nbsp;<span class="op" id="3409470">&amp;&amp;</span>&nbsp;<span class="ident" id="3409473">d</span><span class="op" id="3409474">.</span><span class="ident" id="3409475">r</span><span class="op" id="3409476">.</span><span class="ident" id="3409477">dot</span>&nbsp;<span class="op" id="3409481">==</span>&nbsp;<span class="ident" id="3409484">d</span>&nbsp;<span class="op" id="3409486">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409490">d</span><span class="op" id="3409491">.</span><span class="ident" id="3409492">r</span><span class="op" id="3409493">.</span><span class="ident" id="3409494">dot</span>&nbsp;<span class="op" id="3409498">=</span>&nbsp;<span class="ident" id="3409500">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409508">return</span><br>
<span class="lineno"></span><span class="op" id="3409515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3409518">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3409567">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3409623">func</span>&nbsp;<span class="op" id="3409628">(</span><span class="ident" id="3409629">r</span>&nbsp;<span class="op" id="3409631">*</span><span class="ident" id="3409632">Reader</span><span class="op" id="3409638">)</span>&nbsp;<span class="ident" id="3409640">closeDot</span><span class="op" id="3409648">(</span><span class="op" id="3409649">)</span>&nbsp;<span class="op" id="3409651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409654">if</span>&nbsp;<span class="ident" id="3409657">r</span><span class="op" id="3409658">.</span><span class="ident" id="3409659">dot</span>&nbsp;<span class="op" id="3409663">==</span>&nbsp;<span class="ident" id="3409666">nil</span>&nbsp;<span class="op" id="3409670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409674">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409685">buf</span>&nbsp;<span class="op" id="3409689">:=</span>&nbsp;<span class="builtinfunc" id="3409692">make</span><span class="op" id="3409696">(</span><span class="op" id="3409697">[</span><span class="op" id="3409698">]</span><span class="builtintype" id="3409699">byte</span><span class="op" id="3409703">,</span>&nbsp;<span class="num" id="3409705">128</span><span class="op" id="3409708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3409711">for</span>&nbsp;<span class="ident" id="3409715">r</span><span class="op" id="3409716">.</span><span class="ident" id="3409717">dot</span>&nbsp;<span class="op" id="3409721">!=</span>&nbsp;<span class="ident" id="3409724">nil</span>&nbsp;<span class="op" id="3409728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409732">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3409772">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3409803">r</span><span class="op" id="3409804">.</span><span class="ident" id="3409805">dot</span><span class="op" id="3409808">.</span><span class="ident" id="3409809">Read</span><span class="op" id="3409813">(</span><span class="ident" id="3409814">buf</span><span class="op" id="3409817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3409820">}</span><br>
<span class="lineno"></span><span class="op" id="3409822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3409825">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3409892">//</span><br>
<span class="lineno"></span><span class="comment" id="3409895">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3409977">func</span>&nbsp;<span class="op" id="3409982">(</span><span class="ident" id="3409983">r</span>&nbsp;<span class="op" id="3409985">*</span><span class="ident" id="3409986">Reader</span><span class="op" id="3409992">)</span>&nbsp;<span class="ident" id="3409994">ReadDotBytes</span><span class="op" id="3410006">(</span><span class="op" id="3410007">)</span>&nbsp;<span class="op" id="3410009">(</span><span class="op" id="3410010">[</span><span class="op" id="3410011">]</span><span class="builtintype" id="3410012">byte</span><span class="op" id="3410016">,</span>&nbsp;<span class="builtintype" id="3410018">error</span><span class="op" id="3410023">)</span>&nbsp;<span class="op" id="3410025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410028">return</span>&nbsp;<span class="ident" id="3410035">ioutil</span><span class="op" id="3410041">.</span><span class="ident" id="3410042">ReadAll</span><span class="op" id="3410049">(</span><span class="ident" id="3410050">r</span><span class="op" id="3410051">.</span><span class="ident" id="3410052">DotReader</span><span class="op" id="3410061">(</span><span class="op" id="3410062">)</span><span class="op" id="3410063">)</span><br>
<span class="lineno"></span><span class="op" id="3410065">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3410068">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3410125">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3410202">//</span><br>
<span class="lineno"></span><span class="comment" id="3410205">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3410287">func</span>&nbsp;<span class="op" id="3410292">(</span><span class="ident" id="3410293">r</span>&nbsp;<span class="op" id="3410295">*</span><span class="ident" id="3410296">Reader</span><span class="op" id="3410302">)</span>&nbsp;<span class="ident" id="3410304">ReadDotLines</span><span class="op" id="3410316">(</span><span class="op" id="3410317">)</span>&nbsp;<span class="op" id="3410319">(</span><span class="op" id="3410320">[</span><span class="op" id="3410321">]</span><span class="builtintype" id="3410322">string</span><span class="op" id="3410328">,</span>&nbsp;<span class="builtintype" id="3410330">error</span><span class="op" id="3410335">)</span>&nbsp;<span class="op" id="3410337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410340">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410389">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410439">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410492">var</span>&nbsp;<span class="ident" id="3410496">v</span>&nbsp;<span class="op" id="3410498">[</span><span class="op" id="3410499">]</span><span class="builtintype" id="3410500">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410508">var</span>&nbsp;<span class="ident" id="3410512">err</span>&nbsp;<span class="builtintype" id="3410516">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410523">for</span>&nbsp;<span class="op" id="3410527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410531">var</span>&nbsp;<span class="ident" id="3410535">line</span>&nbsp;<span class="builtintype" id="3410540">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410549">line</span><span class="op" id="3410553">,</span>&nbsp;<span class="ident" id="3410555">err</span>&nbsp;<span class="op" id="3410559">=</span>&nbsp;<span class="ident" id="3410561">r</span><span class="op" id="3410562">.</span><span class="ident" id="3410563">ReadLine</span><span class="op" id="3410571">(</span><span class="op" id="3410572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410576">if</span>&nbsp;<span class="ident" id="3410579">err</span>&nbsp;<span class="op" id="3410583">!=</span>&nbsp;<span class="ident" id="3410586">nil</span>&nbsp;<span class="op" id="3410590">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410595">if</span>&nbsp;<span class="ident" id="3410598">err</span>&nbsp;<span class="op" id="3410602">==</span>&nbsp;<span class="ident" id="3410605">io</span><span class="op" id="3410607">.</span><span class="ident" id="3410608">EOF</span>&nbsp;<span class="op" id="3410612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410618">err</span>&nbsp;<span class="op" id="3410622">=</span>&nbsp;<span class="ident" id="3410624">io</span><span class="op" id="3410626">.</span><span class="ident" id="3410627">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410652">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410660">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3410665">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410718">if</span>&nbsp;<span class="builtinfunc" id="3410721">len</span><span class="op" id="3410724">(</span><span class="ident" id="3410725">line</span><span class="op" id="3410729">)</span>&nbsp;<span class="op" id="3410731">&gt;</span>&nbsp;<span class="num" id="3410733">0</span>&nbsp;<span class="op" id="3410735">&amp;&amp;</span>&nbsp;<span class="ident" id="3410738">line</span><span class="op" id="3410742">[</span><span class="num" id="3410743">0</span><span class="op" id="3410744">]</span>&nbsp;<span class="op" id="3410746">==</span>&nbsp;<span class="string" id="3410749">&#39;.&#39;</span>&nbsp;<span class="op" id="3410753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410758">if</span>&nbsp;<span class="builtinfunc" id="3410761">len</span><span class="op" id="3410764">(</span><span class="ident" id="3410765">line</span><span class="op" id="3410769">)</span>&nbsp;<span class="op" id="3410771">==</span>&nbsp;<span class="num" id="3410774">1</span>&nbsp;<span class="op" id="3410776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410782">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410796">line</span>&nbsp;<span class="op" id="3410801">=</span>&nbsp;<span class="ident" id="3410803">line</span><span class="op" id="3410807">[</span><span class="num" id="3410808">1</span><span class="op" id="3410809">:</span><span class="op" id="3410810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3410818">v</span>&nbsp;<span class="op" id="3410820">=</span>&nbsp;<span class="builtinfunc" id="3410822">append</span><span class="op" id="3410828">(</span><span class="ident" id="3410829">v</span><span class="op" id="3410830">,</span>&nbsp;<span class="ident" id="3410832">line</span><span class="op" id="3410836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3410839">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3410842">return</span>&nbsp;<span class="ident" id="3410849">v</span><span class="op" id="3410850">,</span>&nbsp;<span class="ident" id="3410852">err</span><br>
<span class="lineno"></span><span class="op" id="3410856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3410859">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3410911">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3410978">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3411005">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3411065">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3411131">//</span><br>
<span class="lineno"></span><span class="comment" id="3411134">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3411171">//</span><br>
<span class="lineno"></span><span class="comment" id="3411174">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3411193">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3411211">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3411234">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3411253">//</span><br>
<span class="lineno"></span><span class="comment" id="3411256">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3411309">//</span><br>
<span class="lineno"></span><span class="comment" id="3411312">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3411336">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3411374">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3411413">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="3411418">//</span><br>
<span class="lineno"></span><span class="keyword" id="3411421">func</span>&nbsp;<span class="op" id="3411426">(</span><span class="ident" id="3411427">r</span>&nbsp;<span class="op" id="3411429">*</span><span class="ident" id="3411430">Reader</span><span class="op" id="3411436">)</span>&nbsp;<span class="ident" id="3411438">ReadMIMEHeader</span><span class="op" id="3411452">(</span><span class="op" id="3411453">)</span>&nbsp;<span class="op" id="3411455">(</span><span class="ident" id="3411456">MIMEHeader</span><span class="op" id="3411466">,</span>&nbsp;<span class="builtintype" id="3411468">error</span><span class="op" id="3411473">)</span>&nbsp;<span class="op" id="3411475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411478">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411544">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411604">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411672">var</span>&nbsp;<span class="ident" id="3411676">strs</span>&nbsp;<span class="op" id="3411681">[</span><span class="op" id="3411682">]</span><span class="builtintype" id="3411683">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411691">hint</span>&nbsp;<span class="op" id="3411696">:=</span>&nbsp;<span class="ident" id="3411699">r</span><span class="op" id="3411700">.</span><span class="ident" id="3411701">upcomingHeaderNewlines</span><span class="op" id="3411723">(</span><span class="op" id="3411724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411727">if</span>&nbsp;<span class="ident" id="3411730">hint</span>&nbsp;<span class="op" id="3411735">&gt;</span>&nbsp;<span class="num" id="3411737">0</span>&nbsp;<span class="op" id="3411739">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411743">strs</span>&nbsp;<span class="op" id="3411748">=</span>&nbsp;<span class="builtinfunc" id="3411750">make</span><span class="op" id="3411754">(</span><span class="op" id="3411755">[</span><span class="op" id="3411756">]</span><span class="builtintype" id="3411757">string</span><span class="op" id="3411763">,</span>&nbsp;<span class="ident" id="3411765">hint</span><span class="op" id="3411769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411776">m</span>&nbsp;<span class="op" id="3411778">:=</span>&nbsp;<span class="builtinfunc" id="3411781">make</span><span class="op" id="3411785">(</span><span class="ident" id="3411786">MIMEHeader</span><span class="op" id="3411796">,</span>&nbsp;<span class="ident" id="3411798">hint</span><span class="op" id="3411802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411805">for</span>&nbsp;<span class="op" id="3411809">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3411813">kv</span><span class="op" id="3411815">,</span>&nbsp;<span class="ident" id="3411817">err</span>&nbsp;<span class="op" id="3411821">:=</span>&nbsp;<span class="ident" id="3411824">r</span><span class="op" id="3411825">.</span><span class="ident" id="3411826">readContinuedLineSlice</span><span class="op" id="3411848">(</span><span class="op" id="3411849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411853">if</span>&nbsp;<span class="builtinfunc" id="3411856">len</span><span class="op" id="3411859">(</span><span class="ident" id="3411860">kv</span><span class="op" id="3411862">)</span>&nbsp;<span class="op" id="3411864">==</span>&nbsp;<span class="num" id="3411867">0</span>&nbsp;<span class="op" id="3411869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3411874">return</span>&nbsp;<span class="ident" id="3411881">m</span><span class="op" id="3411882">,</span>&nbsp;<span class="ident" id="3411884">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3411890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411895">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3411952">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412005">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412034">i</span>&nbsp;<span class="op" id="3412036">:=</span>&nbsp;<span class="ident" id="3412039">bytes</span><span class="op" id="3412044">.</span><span class="ident" id="3412045">IndexByte</span><span class="op" id="3412054">(</span><span class="ident" id="3412055">kv</span><span class="op" id="3412057">,</span>&nbsp;<span class="string" id="3412059">&#39;:&#39;</span><span class="op" id="3412062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412066">if</span>&nbsp;<span class="ident" id="3412069">i</span>&nbsp;<span class="op" id="3412071">&lt;</span>&nbsp;<span class="num" id="3412073">0</span>&nbsp;<span class="op" id="3412075">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412080">return</span>&nbsp;<span class="ident" id="3412087">m</span><span class="op" id="3412088">,</span>&nbsp;<span class="ident" id="3412090">ProtocolError</span><span class="op" id="3412103">(</span><span class="string" id="3412104">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3412135">+</span>&nbsp;<span class="builtintype" id="3412137">string</span><span class="op" id="3412143">(</span><span class="ident" id="3412144">kv</span><span class="op" id="3412146">)</span><span class="op" id="3412147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412155">endKey</span>&nbsp;<span class="op" id="3412162">:=</span>&nbsp;<span class="ident" id="3412165">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412169">for</span>&nbsp;<span class="ident" id="3412173">endKey</span>&nbsp;<span class="op" id="3412180">&gt;</span>&nbsp;<span class="num" id="3412182">0</span>&nbsp;<span class="op" id="3412184">&amp;&amp;</span>&nbsp;<span class="ident" id="3412187">kv</span><span class="op" id="3412189">[</span><span class="ident" id="3412190">endKey</span><span class="op" id="3412196">-</span><span class="num" id="3412197">1</span><span class="op" id="3412198">]</span>&nbsp;<span class="op" id="3412200">==</span>&nbsp;<span class="string" id="3412203">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3412207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412212">endKey</span><span class="op" id="3412218">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412227">key</span>&nbsp;<span class="op" id="3412231">:=</span>&nbsp;<span class="ident" id="3412234">canonicalMIMEHeaderKey</span><span class="op" id="3412256">(</span><span class="ident" id="3412257">kv</span><span class="op" id="3412259">[</span><span class="op" id="3412260">:</span><span class="ident" id="3412261">endKey</span><span class="op" id="3412267">]</span><span class="op" id="3412268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412273">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412308">i</span><span class="op" id="3412309">++</span>&nbsp;<span class="comment" id="3412312">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412328">for</span>&nbsp;<span class="ident" id="3412332">i</span>&nbsp;<span class="op" id="3412334">&lt;</span>&nbsp;<span class="builtinfunc" id="3412336">len</span><span class="op" id="3412339">(</span><span class="ident" id="3412340">kv</span><span class="op" id="3412342">)</span>&nbsp;<span class="op" id="3412344">&amp;&amp;</span>&nbsp;<span class="op" id="3412347">(</span><span class="ident" id="3412348">kv</span><span class="op" id="3412350">[</span><span class="ident" id="3412351">i</span><span class="op" id="3412352">]</span>&nbsp;<span class="op" id="3412354">==</span>&nbsp;<span class="string" id="3412357">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3412361">||</span>&nbsp;<span class="ident" id="3412364">kv</span><span class="op" id="3412366">[</span><span class="ident" id="3412367">i</span><span class="op" id="3412368">]</span>&nbsp;<span class="op" id="3412370">==</span>&nbsp;<span class="string" id="3412373">&#39;\t&#39;</span><span class="op" id="3412377">)</span>&nbsp;<span class="op" id="3412379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412384">i</span><span class="op" id="3412385">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412394">value</span>&nbsp;<span class="op" id="3412400">:=</span>&nbsp;<span class="builtintype" id="3412403">string</span><span class="op" id="3412409">(</span><span class="ident" id="3412410">kv</span><span class="op" id="3412412">[</span><span class="ident" id="3412413">i</span><span class="op" id="3412414">:</span><span class="op" id="3412415">]</span><span class="op" id="3412416">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412421">vv</span>&nbsp;<span class="op" id="3412424">:=</span>&nbsp;<span class="ident" id="3412427">m</span><span class="op" id="3412428">[</span><span class="ident" id="3412429">key</span><span class="op" id="3412432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412436">if</span>&nbsp;<span class="ident" id="3412439">vv</span>&nbsp;<span class="op" id="3412442">==</span>&nbsp;<span class="ident" id="3412445">nil</span>&nbsp;<span class="op" id="3412449">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3412452">len</span><span class="op" id="3412455">(</span><span class="ident" id="3412456">strs</span><span class="op" id="3412460">)</span>&nbsp;<span class="op" id="3412462">&gt;</span>&nbsp;<span class="num" id="3412464">0</span>&nbsp;<span class="op" id="3412466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412471">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412529">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412569">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3412630">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412683">vv</span><span class="op" id="3412685">,</span>&nbsp;<span class="ident" id="3412687">strs</span>&nbsp;<span class="op" id="3412692">=</span>&nbsp;<span class="ident" id="3412694">strs</span><span class="op" id="3412698">[</span><span class="op" id="3412699">:</span><span class="num" id="3412700">1</span><span class="op" id="3412701">:</span><span class="num" id="3412702">1</span><span class="op" id="3412703">]</span><span class="op" id="3412704">,</span>&nbsp;<span class="ident" id="3412706">strs</span><span class="op" id="3412710">[</span><span class="num" id="3412711">1</span><span class="op" id="3412712">:</span><span class="op" id="3412713">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412718">vv</span><span class="op" id="3412720">[</span><span class="num" id="3412721">0</span><span class="op" id="3412722">]</span>&nbsp;<span class="op" id="3412724">=</span>&nbsp;<span class="ident" id="3412726">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412735">m</span><span class="op" id="3412736">[</span><span class="ident" id="3412737">key</span><span class="op" id="3412740">]</span>&nbsp;<span class="op" id="3412742">=</span>&nbsp;<span class="ident" id="3412744">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412749">}</span>&nbsp;<span class="keyword" id="3412751">else</span>&nbsp;<span class="op" id="3412756">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3412761">m</span><span class="op" id="3412762">[</span><span class="ident" id="3412763">key</span><span class="op" id="3412766">]</span>&nbsp;<span class="op" id="3412768">=</span>&nbsp;<span class="builtinfunc" id="3412770">append</span><span class="op" id="3412776">(</span><span class="ident" id="3412777">vv</span><span class="op" id="3412779">,</span>&nbsp;<span class="ident" id="3412781">value</span><span class="op" id="3412786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412795">if</span>&nbsp;<span class="ident" id="3412798">err</span>&nbsp;<span class="op" id="3412802">!=</span>&nbsp;<span class="ident" id="3412805">nil</span>&nbsp;<span class="op" id="3412809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3412814">return</span>&nbsp;<span class="ident" id="3412821">m</span><span class="op" id="3412822">,</span>&nbsp;<span class="ident" id="3412824">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3412833">}</span><br>
<span class="lineno"></span><span class="op" id="3412835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3412838">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3412915">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3412982">func</span>&nbsp;<span class="op" id="3412987">(</span><span class="ident" id="3412988">r</span>&nbsp;<span class="op" id="3412990">*</span><span class="ident" id="3412991">Reader</span><span class="op" id="3412997">)</span>&nbsp;<span class="ident" id="3412999">upcomingHeaderNewlines</span><span class="op" id="3413021">(</span><span class="op" id="3413022">)</span>&nbsp;<span class="op" id="3413024">(</span><span class="ident" id="3413025">n</span>&nbsp;<span class="builtintype" id="3413027">int</span><span class="op" id="3413030">)</span>&nbsp;<span class="op" id="3413032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413035">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413073">r</span><span class="op" id="3413074">.</span><span class="ident" id="3413075">R</span><span class="op" id="3413076">.</span><span class="ident" id="3413077">Peek</span><span class="op" id="3413081">(</span><span class="num" id="3413082">1</span><span class="op" id="3413083">)</span>&nbsp;<span class="comment" id="3413085">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413118">s</span>&nbsp;<span class="op" id="3413120">:=</span>&nbsp;<span class="ident" id="3413123">r</span><span class="op" id="3413124">.</span><span class="ident" id="3413125">R</span><span class="op" id="3413126">.</span><span class="ident" id="3413127">Buffered</span><span class="op" id="3413135">(</span><span class="op" id="3413136">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413139">if</span>&nbsp;<span class="ident" id="3413142">s</span>&nbsp;<span class="op" id="3413144">==</span>&nbsp;<span class="num" id="3413147">0</span>&nbsp;<span class="op" id="3413149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413153">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413164">peek</span><span class="op" id="3413168">,</span>&nbsp;<span class="ident" id="3413170">_</span>&nbsp;<span class="op" id="3413172">:=</span>&nbsp;<span class="ident" id="3413175">r</span><span class="op" id="3413176">.</span><span class="ident" id="3413177">R</span><span class="op" id="3413178">.</span><span class="ident" id="3413179">Peek</span><span class="op" id="3413183">(</span><span class="ident" id="3413184">s</span><span class="op" id="3413185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413188">for</span>&nbsp;<span class="builtinfunc" id="3413192">len</span><span class="op" id="3413195">(</span><span class="ident" id="3413196">peek</span><span class="op" id="3413200">)</span>&nbsp;<span class="op" id="3413202">&gt;</span>&nbsp;<span class="num" id="3413204">0</span>&nbsp;<span class="op" id="3413206">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413210">i</span>&nbsp;<span class="op" id="3413212">:=</span>&nbsp;<span class="ident" id="3413215">bytes</span><span class="op" id="3413220">.</span><span class="ident" id="3413221">IndexByte</span><span class="op" id="3413230">(</span><span class="ident" id="3413231">peek</span><span class="op" id="3413235">,</span>&nbsp;<span class="string" id="3413237">&#39;\n&#39;</span><span class="op" id="3413241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413245">if</span>&nbsp;<span class="ident" id="3413248">i</span>&nbsp;<span class="op" id="3413250">&lt;</span>&nbsp;<span class="num" id="3413252">3</span>&nbsp;<span class="op" id="3413254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413259">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413318">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413373">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413386">n</span><span class="op" id="3413387">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413392">peek</span>&nbsp;<span class="op" id="3413397">=</span>&nbsp;<span class="ident" id="3413399">peek</span><span class="op" id="3413403">[</span><span class="ident" id="3413404">i</span><span class="op" id="3413405">+</span><span class="num" id="3413406">1</span><span class="op" id="3413407">:</span><span class="op" id="3413408">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3413411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413414">return</span><br>
<span class="lineno">535</span><span class="op" id="3413421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3413424">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3413486">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3413549">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3413608">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3413666">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3413727">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3413777">func</span>&nbsp;<span class="ident" id="3413782">CanonicalMIMEHeaderKey</span><span class="op" id="3413804">(</span><span class="ident" id="3413805">s</span>&nbsp;<span class="builtintype" id="3413807">string</span><span class="op" id="3413813">)</span>&nbsp;<span class="builtintype" id="3413815">string</span>&nbsp;<span class="op" id="3413822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3413825">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413865">upper</span>&nbsp;<span class="op" id="3413871">:=</span>&nbsp;<span class="builtintype" id="3413874">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413880">for</span>&nbsp;<span class="ident" id="3413884">i</span>&nbsp;<span class="op" id="3413886">:=</span>&nbsp;<span class="num" id="3413889">0</span><span class="op" id="3413890">;</span>&nbsp;<span class="ident" id="3413892">i</span>&nbsp;<span class="op" id="3413894">&lt;</span>&nbsp;<span class="builtinfunc" id="3413896">len</span><span class="op" id="3413899">(</span><span class="ident" id="3413900">s</span><span class="op" id="3413901">)</span><span class="op" id="3413902">;</span>&nbsp;<span class="ident" id="3413904">i</span><span class="op" id="3413905">++</span>&nbsp;<span class="op" id="3413908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3413912">c</span>&nbsp;<span class="op" id="3413914">:=</span>&nbsp;<span class="ident" id="3413917">s</span><span class="op" id="3413918">[</span><span class="ident" id="3413919">i</span><span class="op" id="3413920">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413924">if</span>&nbsp;<span class="ident" id="3413927">upper</span>&nbsp;<span class="op" id="3413933">&amp;&amp;</span>&nbsp;<span class="string" id="3413936">&#39;a&#39;</span>&nbsp;<span class="op" id="3413940">&lt;=</span>&nbsp;<span class="ident" id="3413943">c</span>&nbsp;<span class="op" id="3413945">&amp;&amp;</span>&nbsp;<span class="ident" id="3413948">c</span>&nbsp;<span class="op" id="3413950">&lt;=</span>&nbsp;<span class="string" id="3413953">&#39;z&#39;</span>&nbsp;<span class="op" id="3413957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3413962">return</span>&nbsp;<span class="ident" id="3413969">canonicalMIMEHeaderKey</span><span class="op" id="3413991">(</span><span class="op" id="3413992">[</span><span class="op" id="3413993">]</span><span class="builtintype" id="3413994">byte</span><span class="op" id="3413998">(</span><span class="ident" id="3413999">s</span><span class="op" id="3414000">)</span><span class="op" id="3414001">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414009">if</span>&nbsp;<span class="op" id="3414012">!</span><span class="ident" id="3414013">upper</span>&nbsp;<span class="op" id="3414019">&amp;&amp;</span>&nbsp;<span class="string" id="3414022">&#39;A&#39;</span>&nbsp;<span class="op" id="3414026">&lt;=</span>&nbsp;<span class="ident" id="3414029">c</span>&nbsp;<span class="op" id="3414031">&amp;&amp;</span>&nbsp;<span class="ident" id="3414034">c</span>&nbsp;<span class="op" id="3414036">&lt;=</span>&nbsp;<span class="string" id="3414039">&#39;Z&#39;</span>&nbsp;<span class="op" id="3414043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414048">return</span>&nbsp;<span class="ident" id="3414055">canonicalMIMEHeaderKey</span><span class="op" id="3414077">(</span><span class="op" id="3414078">[</span><span class="op" id="3414079">]</span><span class="builtintype" id="3414080">byte</span><span class="op" id="3414084">(</span><span class="ident" id="3414085">s</span><span class="op" id="3414086">)</span><span class="op" id="3414087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414095">upper</span>&nbsp;<span class="op" id="3414101">=</span>&nbsp;<span class="ident" id="3414103">c</span>&nbsp;<span class="op" id="3414105">==</span>&nbsp;<span class="string" id="3414108">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414116">return</span>&nbsp;<span class="ident" id="3414123">s</span><br>
<span class="lineno"></span><span class="op" id="3414125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3414128">const</span>&nbsp;<span class="ident" id="3414134">toLower</span>&nbsp;<span class="op" id="3414142">=</span>&nbsp;<span class="string" id="3414144">&#39;a&#39;</span>&nbsp;<span class="op" id="3414148">-</span>&nbsp;<span class="string" id="3414150">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3414155">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3414219">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3414285">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3414296">func</span>&nbsp;<span class="ident" id="3414301">canonicalMIMEHeaderKey</span><span class="op" id="3414323">(</span><span class="ident" id="3414324">a</span>&nbsp;<span class="op" id="3414326">[</span><span class="op" id="3414327">]</span><span class="builtintype" id="3414328">byte</span><span class="op" id="3414332">)</span>&nbsp;<span class="builtintype" id="3414334">string</span>&nbsp;<span class="op" id="3414341">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414344">upper</span>&nbsp;<span class="op" id="3414350">:=</span>&nbsp;<span class="builtintype" id="3414353">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414359">for</span>&nbsp;<span class="ident" id="3414363">i</span><span class="op" id="3414364">,</span>&nbsp;<span class="ident" id="3414366">c</span>&nbsp;<span class="op" id="3414368">:=</span>&nbsp;<span class="keyword" id="3414371">range</span>&nbsp;<span class="ident" id="3414377">a</span>&nbsp;<span class="op" id="3414379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414383">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414426">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414463">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414507">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414563">if</span>&nbsp;<span class="ident" id="3414566">c</span>&nbsp;<span class="op" id="3414568">==</span>&nbsp;<span class="string" id="3414571">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3414575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414580">c</span>&nbsp;<span class="op" id="3414582">=</span>&nbsp;<span class="string" id="3414584">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414590">}</span>&nbsp;<span class="keyword" id="3414592">else</span>&nbsp;<span class="keyword" id="3414597">if</span>&nbsp;<span class="ident" id="3414600">upper</span>&nbsp;<span class="op" id="3414606">&amp;&amp;</span>&nbsp;<span class="string" id="3414609">&#39;a&#39;</span>&nbsp;<span class="op" id="3414613">&lt;=</span>&nbsp;<span class="ident" id="3414616">c</span>&nbsp;<span class="op" id="3414618">&amp;&amp;</span>&nbsp;<span class="ident" id="3414621">c</span>&nbsp;<span class="op" id="3414623">&lt;=</span>&nbsp;<span class="string" id="3414626">&#39;z&#39;</span>&nbsp;<span class="op" id="3414630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414635">c</span>&nbsp;<span class="op" id="3414637">-=</span>&nbsp;<span class="ident" id="3414640">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414650">}</span>&nbsp;<span class="keyword" id="3414652">else</span>&nbsp;<span class="keyword" id="3414657">if</span>&nbsp;<span class="op" id="3414660">!</span><span class="ident" id="3414661">upper</span>&nbsp;<span class="op" id="3414667">&amp;&amp;</span>&nbsp;<span class="string" id="3414670">&#39;A&#39;</span>&nbsp;<span class="op" id="3414674">&lt;=</span>&nbsp;<span class="ident" id="3414677">c</span>&nbsp;<span class="op" id="3414679">&amp;&amp;</span>&nbsp;<span class="ident" id="3414682">c</span>&nbsp;<span class="op" id="3414684">&lt;=</span>&nbsp;<span class="string" id="3414687">&#39;Z&#39;</span>&nbsp;<span class="op" id="3414691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414696">c</span>&nbsp;<span class="op" id="3414698">+=</span>&nbsp;<span class="ident" id="3414701">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414715">a</span><span class="op" id="3414716">[</span><span class="ident" id="3414717">i</span><span class="op" id="3414718">]</span>&nbsp;<span class="op" id="3414720">=</span>&nbsp;<span class="ident" id="3414722">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3414726">upper</span>&nbsp;<span class="op" id="3414732">=</span>&nbsp;<span class="ident" id="3414734">c</span>&nbsp;<span class="op" id="3414736">==</span>&nbsp;<span class="string" id="3414739">&#39;-&#39;</span>&nbsp;<span class="comment" id="3414743">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414764">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414826">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3414886">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414917">if</span>&nbsp;<span class="ident" id="3414920">v</span>&nbsp;<span class="op" id="3414922">:=</span>&nbsp;<span class="ident" id="3414925">commonHeader</span><span class="op" id="3414937">[</span><span class="builtintype" id="3414938">string</span><span class="op" id="3414944">(</span><span class="ident" id="3414945">a</span><span class="op" id="3414946">)</span><span class="op" id="3414947">]</span><span class="op" id="3414948">;</span>&nbsp;<span class="ident" id="3414950">v</span>&nbsp;<span class="op" id="3414952">!=</span>&nbsp;<span class="string" id="3414955">&#34;&#34;</span>&nbsp;<span class="op" id="3414958">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414962">return</span>&nbsp;<span class="ident" id="3414969">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3414972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3414975">return</span>&nbsp;<span class="builtintype" id="3414982">string</span><span class="op" id="3414988">(</span><span class="ident" id="3414989">a</span><span class="op" id="3414990">)</span><br>
<span class="lineno"></span><span class="op" id="3414992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3414995">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3415042">var</span>&nbsp;<span class="ident" id="3415046">commonHeader</span>&nbsp;<span class="op" id="3415059">=</span>&nbsp;<span class="builtinfunc" id="3415061">make</span><span class="op" id="3415065">(</span><span class="keyword" id="3415066">map</span><span class="op" id="3415069">[</span><span class="builtintype" id="3415070">string</span><span class="op" id="3415076">]</span><span class="builtintype" id="3415077">string</span><span class="op" id="3415083">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3415086">func</span>&nbsp;<span class="ident" id="3415091">init</span><span class="op" id="3415095">(</span><span class="op" id="3415096">)</span>&nbsp;<span class="op" id="3415098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3415101">for</span>&nbsp;<span class="ident" id="3415105">_</span><span class="op" id="3415106">,</span>&nbsp;<span class="ident" id="3415108">v</span>&nbsp;<span class="op" id="3415110">:=</span>&nbsp;<span class="keyword" id="3415113">range</span>&nbsp;<span class="op" id="3415119">[</span><span class="op" id="3415120">]</span><span class="builtintype" id="3415121">string</span><span class="op" id="3415127">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415131">&#34;Accept&#34;</span><span class="op" id="3415139">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415143">&#34;Accept-Charset&#34;</span><span class="op" id="3415159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415163">&#34;Accept-Encoding&#34;</span><span class="op" id="3415180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415184">&#34;Accept-Language&#34;</span><span class="op" id="3415201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415205">&#34;Accept-Ranges&#34;</span><span class="op" id="3415220">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415224">&#34;Cache-Control&#34;</span><span class="op" id="3415239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415243">&#34;Cc&#34;</span><span class="op" id="3415247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415251">&#34;Connection&#34;</span><span class="op" id="3415263">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415267">&#34;Content-Id&#34;</span><span class="op" id="3415279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415283">&#34;Content-Language&#34;</span><span class="op" id="3415301">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415305">&#34;Content-Length&#34;</span><span class="op" id="3415321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415325">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3415352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415356">&#34;Content-Type&#34;</span><span class="op" id="3415370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415374">&#34;Cookie&#34;</span><span class="op" id="3415382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415386">&#34;Date&#34;</span><span class="op" id="3415392">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415396">&#34;Dkim-Signature&#34;</span><span class="op" id="3415412">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415416">&#34;Etag&#34;</span><span class="op" id="3415422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415426">&#34;Expires&#34;</span><span class="op" id="3415435">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415439">&#34;From&#34;</span><span class="op" id="3415445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415449">&#34;Host&#34;</span><span class="op" id="3415455">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415459">&#34;If-Modified-Since&#34;</span><span class="op" id="3415478">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415482">&#34;If-None-Match&#34;</span><span class="op" id="3415497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415501">&#34;In-Reply-To&#34;</span><span class="op" id="3415514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415518">&#34;Last-Modified&#34;</span><span class="op" id="3415533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415537">&#34;Location&#34;</span><span class="op" id="3415547">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415551">&#34;Message-Id&#34;</span><span class="op" id="3415563">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415567">&#34;Mime-Version&#34;</span><span class="op" id="3415581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415585">&#34;Pragma&#34;</span><span class="op" id="3415593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415597">&#34;Received&#34;</span><span class="op" id="3415607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415611">&#34;Return-Path&#34;</span><span class="op" id="3415624">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415628">&#34;Server&#34;</span><span class="op" id="3415636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415640">&#34;Set-Cookie&#34;</span><span class="op" id="3415652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415656">&#34;Subject&#34;</span><span class="op" id="3415665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415669">&#34;To&#34;</span><span class="op" id="3415673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415677">&#34;User-Agent&#34;</span><span class="op" id="3415689">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415693">&#34;Via&#34;</span><span class="op" id="3415698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415702">&#34;X-Forwarded-For&#34;</span><span class="op" id="3415719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415723">&#34;X-Imforwards&#34;</span><span class="op" id="3415737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3415741">&#34;X-Powered-By&#34;</span><span class="op" id="3415755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415758">}</span>&nbsp;<span class="op" id="3415760">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3415764">commonHeader</span><span class="op" id="3415776">[</span><span class="ident" id="3415777">v</span><span class="op" id="3415778">]</span>&nbsp;<span class="op" id="3415780">=</span>&nbsp;<span class="ident" id="3415782">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3415785">}</span><br>
<span class="lineno"></span><span class="op" id="3415787">}</span>
</div>
</body>
</html>
