<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1948630">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1948685">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1948739">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1948790">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1948868">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1948953">package</span>&nbsp;<span class="ident" id="1948961">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1948967">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1949024">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1949079">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1949155">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1949195">const</span>&nbsp;<span class="op" id="1949201">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949204">RuneError</span>&nbsp;<span class="op" id="1949214">=</span>&nbsp;<span class="string" id="1949216">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1949229">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949285">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1949295">=</span>&nbsp;<span class="num" id="1949297">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1949310">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949388">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1949398">=</span>&nbsp;<span class="string" id="1949400">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1949413">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949451">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1949461">=</span>&nbsp;<span class="num" id="1949463">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1949476">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1949541">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1949544">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1949607">const</span>&nbsp;<span class="op" id="1949613">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949616">surrogateMin</span>&nbsp;<span class="op" id="1949629">=</span>&nbsp;<span class="num" id="1949631">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949639">surrogateMax</span>&nbsp;<span class="op" id="1949652">=</span>&nbsp;<span class="num" id="1949654">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1949661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1949664">const</span>&nbsp;<span class="op" id="1949670">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949673">t1</span>&nbsp;<span class="op" id="1949676">=</span>&nbsp;<span class="num" id="1949678">0x00</span>&nbsp;<span class="comment" id="1949683">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949697">tx</span>&nbsp;<span class="op" id="1949700">=</span>&nbsp;<span class="num" id="1949702">0x80</span>&nbsp;<span class="comment" id="1949707">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949721">t2</span>&nbsp;<span class="op" id="1949724">=</span>&nbsp;<span class="num" id="1949726">0xC0</span>&nbsp;<span class="comment" id="1949731">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949745">t3</span>&nbsp;<span class="op" id="1949748">=</span>&nbsp;<span class="num" id="1949750">0xE0</span>&nbsp;<span class="comment" id="1949755">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949769">t4</span>&nbsp;<span class="op" id="1949772">=</span>&nbsp;<span class="num" id="1949774">0xF0</span>&nbsp;<span class="comment" id="1949779">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949793">t5</span>&nbsp;<span class="op" id="1949796">=</span>&nbsp;<span class="num" id="1949798">0xF8</span>&nbsp;<span class="comment" id="1949803">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949818">maskx</span>&nbsp;<span class="op" id="1949824">=</span>&nbsp;<span class="num" id="1949826">0x3F</span>&nbsp;<span class="comment" id="1949831">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949845">mask2</span>&nbsp;<span class="op" id="1949851">=</span>&nbsp;<span class="num" id="1949853">0x1F</span>&nbsp;<span class="comment" id="1949858">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949872">mask3</span>&nbsp;<span class="op" id="1949878">=</span>&nbsp;<span class="num" id="1949880">0x0F</span>&nbsp;<span class="comment" id="1949885">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949899">mask4</span>&nbsp;<span class="op" id="1949905">=</span>&nbsp;<span class="num" id="1949907">0x07</span>&nbsp;<span class="comment" id="1949912">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949927">rune1Max</span>&nbsp;<span class="op" id="1949936">=</span>&nbsp;<span class="num" id="1949938">1</span><span class="op" id="1949939">&lt;&lt;</span><span class="num" id="1949941">7</span>&nbsp;<span class="op" id="1949943">-</span>&nbsp;<span class="num" id="1949945">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949948">rune2Max</span>&nbsp;<span class="op" id="1949957">=</span>&nbsp;<span class="num" id="1949959">1</span><span class="op" id="1949960">&lt;&lt;</span><span class="num" id="1949962">11</span>&nbsp;<span class="op" id="1949965">-</span>&nbsp;<span class="num" id="1949967">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1949970">rune3Max</span>&nbsp;<span class="op" id="1949979">=</span>&nbsp;<span class="num" id="1949981">1</span><span class="op" id="1949982">&lt;&lt;</span><span class="num" id="1949984">16</span>&nbsp;<span class="op" id="1949987">-</span>&nbsp;<span class="num" id="1949989">1</span><br>
<span class="lineno"></span><span class="op" id="1949991">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1949994">func</span>&nbsp;<span class="ident" id="1949999">decodeRuneInternal</span><span class="op" id="1950017">(</span><span class="ident" id="1950018">p</span>&nbsp;<span class="op" id="1950020">[</span><span class="op" id="1950021">]</span><span class="builtintype" id="1950022">byte</span><span class="op" id="1950026">)</span>&nbsp;<span class="op" id="1950028">(</span><span class="ident" id="1950029">r</span>&nbsp;<span class="builtintype" id="1950031">rune</span><span class="op" id="1950035">,</span>&nbsp;<span class="ident" id="1950037">size</span>&nbsp;<span class="builtintype" id="1950042">int</span><span class="op" id="1950045">,</span>&nbsp;<span class="ident" id="1950047">short</span>&nbsp;<span class="builtintype" id="1950053">bool</span><span class="op" id="1950057">)</span>&nbsp;<span class="op" id="1950059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950062">n</span>&nbsp;<span class="op" id="1950064">:=</span>&nbsp;<span class="builtinfunc" id="1950067">len</span><span class="op" id="1950070">(</span><span class="ident" id="1950071">p</span><span class="op" id="1950072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950075">if</span>&nbsp;<span class="ident" id="1950078">n</span>&nbsp;<span class="op" id="1950080">&lt;</span>&nbsp;<span class="num" id="1950082">1</span>&nbsp;<span class="op" id="1950084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950088">return</span>&nbsp;<span class="ident" id="1950095">RuneError</span><span class="op" id="1950104">,</span>&nbsp;<span class="num" id="1950106">0</span><span class="op" id="1950107">,</span>&nbsp;<span class="builtintype" id="1950109">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950115">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950118">c0</span>&nbsp;<span class="op" id="1950121">:=</span>&nbsp;<span class="ident" id="1950124">p</span><span class="op" id="1950125">[</span><span class="num" id="1950126">0</span><span class="op" id="1950127">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950131">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950159">if</span>&nbsp;<span class="ident" id="1950162">c0</span>&nbsp;<span class="op" id="1950165">&lt;</span>&nbsp;<span class="ident" id="1950167">tx</span>&nbsp;<span class="op" id="1950170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950174">return</span>&nbsp;<span class="builtintype" id="1950181">rune</span><span class="op" id="1950185">(</span><span class="ident" id="1950186">c0</span><span class="op" id="1950188">)</span><span class="op" id="1950189">,</span>&nbsp;<span class="num" id="1950191">1</span><span class="op" id="1950192">,</span>&nbsp;<span class="builtintype" id="1950194">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950205">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950239">if</span>&nbsp;<span class="ident" id="1950242">c0</span>&nbsp;<span class="op" id="1950245">&lt;</span>&nbsp;<span class="ident" id="1950247">t2</span>&nbsp;<span class="op" id="1950250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950254">return</span>&nbsp;<span class="ident" id="1950261">RuneError</span><span class="op" id="1950270">,</span>&nbsp;<span class="num" id="1950272">1</span><span class="op" id="1950273">,</span>&nbsp;<span class="builtintype" id="1950275">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950286">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950319">if</span>&nbsp;<span class="ident" id="1950322">n</span>&nbsp;<span class="op" id="1950324">&lt;</span>&nbsp;<span class="num" id="1950326">2</span>&nbsp;<span class="op" id="1950328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950332">return</span>&nbsp;<span class="ident" id="1950339">RuneError</span><span class="op" id="1950348">,</span>&nbsp;<span class="num" id="1950350">1</span><span class="op" id="1950351">,</span>&nbsp;<span class="builtintype" id="1950353">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950362">c1</span>&nbsp;<span class="op" id="1950365">:=</span>&nbsp;<span class="ident" id="1950368">p</span><span class="op" id="1950369">[</span><span class="num" id="1950370">1</span><span class="op" id="1950371">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950374">if</span>&nbsp;<span class="ident" id="1950377">c1</span>&nbsp;<span class="op" id="1950380">&lt;</span>&nbsp;<span class="ident" id="1950382">tx</span>&nbsp;<span class="op" id="1950385">||</span>&nbsp;<span class="ident" id="1950388">t2</span>&nbsp;<span class="op" id="1950391">&lt;=</span>&nbsp;<span class="ident" id="1950394">c1</span>&nbsp;<span class="op" id="1950397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950401">return</span>&nbsp;<span class="ident" id="1950408">RuneError</span><span class="op" id="1950417">,</span>&nbsp;<span class="num" id="1950419">1</span><span class="op" id="1950420">,</span>&nbsp;<span class="builtintype" id="1950422">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950429">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950433">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950462">if</span>&nbsp;<span class="ident" id="1950465">c0</span>&nbsp;<span class="op" id="1950468">&lt;</span>&nbsp;<span class="ident" id="1950470">t3</span>&nbsp;<span class="op" id="1950473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950477">r</span>&nbsp;<span class="op" id="1950479">=</span>&nbsp;<span class="builtintype" id="1950481">rune</span><span class="op" id="1950485">(</span><span class="ident" id="1950486">c0</span><span class="op" id="1950488">&amp;</span><span class="ident" id="1950489">mask2</span><span class="op" id="1950494">)</span><span class="op" id="1950495">&lt;&lt;</span><span class="num" id="1950497">6</span>&nbsp;<span class="op" id="1950499">|</span>&nbsp;<span class="builtintype" id="1950501">rune</span><span class="op" id="1950505">(</span><span class="ident" id="1950506">c1</span><span class="op" id="1950508">&amp;</span><span class="ident" id="1950509">maskx</span><span class="op" id="1950514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950518">if</span>&nbsp;<span class="ident" id="1950521">r</span>&nbsp;<span class="op" id="1950523">&lt;=</span>&nbsp;<span class="ident" id="1950526">rune1Max</span>&nbsp;<span class="op" id="1950535">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950540">return</span>&nbsp;<span class="ident" id="1950547">RuneError</span><span class="op" id="1950556">,</span>&nbsp;<span class="num" id="1950558">1</span><span class="op" id="1950559">,</span>&nbsp;<span class="builtintype" id="1950561">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950573">return</span>&nbsp;<span class="ident" id="1950580">r</span><span class="op" id="1950581">,</span>&nbsp;<span class="num" id="1950583">2</span><span class="op" id="1950584">,</span>&nbsp;<span class="builtintype" id="1950586">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950597">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950631">if</span>&nbsp;<span class="ident" id="1950634">n</span>&nbsp;<span class="op" id="1950636">&lt;</span>&nbsp;<span class="num" id="1950638">3</span>&nbsp;<span class="op" id="1950640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950644">return</span>&nbsp;<span class="ident" id="1950651">RuneError</span><span class="op" id="1950660">,</span>&nbsp;<span class="num" id="1950662">1</span><span class="op" id="1950663">,</span>&nbsp;<span class="builtintype" id="1950665">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950674">c2</span>&nbsp;<span class="op" id="1950677">:=</span>&nbsp;<span class="ident" id="1950680">p</span><span class="op" id="1950681">[</span><span class="num" id="1950682">2</span><span class="op" id="1950683">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950686">if</span>&nbsp;<span class="ident" id="1950689">c2</span>&nbsp;<span class="op" id="1950692">&lt;</span>&nbsp;<span class="ident" id="1950694">tx</span>&nbsp;<span class="op" id="1950697">||</span>&nbsp;<span class="ident" id="1950700">t2</span>&nbsp;<span class="op" id="1950703">&lt;=</span>&nbsp;<span class="ident" id="1950706">c2</span>&nbsp;<span class="op" id="1950709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950713">return</span>&nbsp;<span class="ident" id="1950720">RuneError</span><span class="op" id="1950729">,</span>&nbsp;<span class="num" id="1950731">1</span><span class="op" id="1950732">,</span>&nbsp;<span class="builtintype" id="1950734">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1950745">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950774">if</span>&nbsp;<span class="ident" id="1950777">c0</span>&nbsp;<span class="op" id="1950780">&lt;</span>&nbsp;<span class="ident" id="1950782">t4</span>&nbsp;<span class="op" id="1950785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1950789">r</span>&nbsp;<span class="op" id="1950791">=</span>&nbsp;<span class="builtintype" id="1950793">rune</span><span class="op" id="1950797">(</span><span class="ident" id="1950798">c0</span><span class="op" id="1950800">&amp;</span><span class="ident" id="1950801">mask3</span><span class="op" id="1950806">)</span><span class="op" id="1950807">&lt;&lt;</span><span class="num" id="1950809">12</span>&nbsp;<span class="op" id="1950812">|</span>&nbsp;<span class="builtintype" id="1950814">rune</span><span class="op" id="1950818">(</span><span class="ident" id="1950819">c1</span><span class="op" id="1950821">&amp;</span><span class="ident" id="1950822">maskx</span><span class="op" id="1950827">)</span><span class="op" id="1950828">&lt;&lt;</span><span class="num" id="1950830">6</span>&nbsp;<span class="op" id="1950832">|</span>&nbsp;<span class="builtintype" id="1950834">rune</span><span class="op" id="1950838">(</span><span class="ident" id="1950839">c2</span><span class="op" id="1950841">&amp;</span><span class="ident" id="1950842">maskx</span><span class="op" id="1950847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950851">if</span>&nbsp;<span class="ident" id="1950854">r</span>&nbsp;<span class="op" id="1950856">&lt;=</span>&nbsp;<span class="ident" id="1950859">rune2Max</span>&nbsp;<span class="op" id="1950868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950873">return</span>&nbsp;<span class="ident" id="1950880">RuneError</span><span class="op" id="1950889">,</span>&nbsp;<span class="num" id="1950891">1</span><span class="op" id="1950892">,</span>&nbsp;<span class="builtintype" id="1950894">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950902">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950906">if</span>&nbsp;<span class="ident" id="1950909">surrogateMin</span>&nbsp;<span class="op" id="1950922">&lt;=</span>&nbsp;<span class="ident" id="1950925">r</span>&nbsp;<span class="op" id="1950927">&amp;&amp;</span>&nbsp;<span class="ident" id="1950930">r</span>&nbsp;<span class="op" id="1950932">&lt;=</span>&nbsp;<span class="ident" id="1950935">surrogateMax</span>&nbsp;<span class="op" id="1950948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950953">return</span>&nbsp;<span class="ident" id="1950960">RuneError</span><span class="op" id="1950969">,</span>&nbsp;<span class="num" id="1950971">1</span><span class="op" id="1950972">,</span>&nbsp;<span class="builtintype" id="1950974">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1950982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1950986">return</span>&nbsp;<span class="ident" id="1950993">r</span><span class="op" id="1950994">,</span>&nbsp;<span class="num" id="1950996">3</span><span class="op" id="1950997">,</span>&nbsp;<span class="builtintype" id="1950999">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951006">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951010">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951043">if</span>&nbsp;<span class="ident" id="1951046">n</span>&nbsp;<span class="op" id="1951048">&lt;</span>&nbsp;<span class="num" id="1951050">4</span>&nbsp;<span class="op" id="1951052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951056">return</span>&nbsp;<span class="ident" id="1951063">RuneError</span><span class="op" id="1951072">,</span>&nbsp;<span class="num" id="1951074">1</span><span class="op" id="1951075">,</span>&nbsp;<span class="builtintype" id="1951077">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951083">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951086">c3</span>&nbsp;<span class="op" id="1951089">:=</span>&nbsp;<span class="ident" id="1951092">p</span><span class="op" id="1951093">[</span><span class="num" id="1951094">3</span><span class="op" id="1951095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951098">if</span>&nbsp;<span class="ident" id="1951101">c3</span>&nbsp;<span class="op" id="1951104">&lt;</span>&nbsp;<span class="ident" id="1951106">tx</span>&nbsp;<span class="op" id="1951109">||</span>&nbsp;<span class="ident" id="1951112">t2</span>&nbsp;<span class="op" id="1951115">&lt;=</span>&nbsp;<span class="ident" id="1951118">c3</span>&nbsp;<span class="op" id="1951121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951125">return</span>&nbsp;<span class="ident" id="1951132">RuneError</span><span class="op" id="1951141">,</span>&nbsp;<span class="num" id="1951143">1</span><span class="op" id="1951144">,</span>&nbsp;<span class="builtintype" id="1951146">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951157">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951186">if</span>&nbsp;<span class="ident" id="1951189">c0</span>&nbsp;<span class="op" id="1951192">&lt;</span>&nbsp;<span class="ident" id="1951194">t5</span>&nbsp;<span class="op" id="1951197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951201">r</span>&nbsp;<span class="op" id="1951203">=</span>&nbsp;<span class="builtintype" id="1951205">rune</span><span class="op" id="1951209">(</span><span class="ident" id="1951210">c0</span><span class="op" id="1951212">&amp;</span><span class="ident" id="1951213">mask4</span><span class="op" id="1951218">)</span><span class="op" id="1951219">&lt;&lt;</span><span class="num" id="1951221">18</span>&nbsp;<span class="op" id="1951224">|</span>&nbsp;<span class="builtintype" id="1951226">rune</span><span class="op" id="1951230">(</span><span class="ident" id="1951231">c1</span><span class="op" id="1951233">&amp;</span><span class="ident" id="1951234">maskx</span><span class="op" id="1951239">)</span><span class="op" id="1951240">&lt;&lt;</span><span class="num" id="1951242">12</span>&nbsp;<span class="op" id="1951245">|</span>&nbsp;<span class="builtintype" id="1951247">rune</span><span class="op" id="1951251">(</span><span class="ident" id="1951252">c2</span><span class="op" id="1951254">&amp;</span><span class="ident" id="1951255">maskx</span><span class="op" id="1951260">)</span><span class="op" id="1951261">&lt;&lt;</span><span class="num" id="1951263">6</span>&nbsp;<span class="op" id="1951265">|</span>&nbsp;<span class="builtintype" id="1951267">rune</span><span class="op" id="1951271">(</span><span class="ident" id="1951272">c3</span><span class="op" id="1951274">&amp;</span><span class="ident" id="1951275">maskx</span><span class="op" id="1951280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951284">if</span>&nbsp;<span class="ident" id="1951287">r</span>&nbsp;<span class="op" id="1951289">&lt;=</span>&nbsp;<span class="ident" id="1951292">rune3Max</span>&nbsp;<span class="op" id="1951301">||</span>&nbsp;<span class="ident" id="1951304">MaxRune</span>&nbsp;<span class="op" id="1951312">&lt;</span>&nbsp;<span class="ident" id="1951314">r</span>&nbsp;<span class="op" id="1951316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951321">return</span>&nbsp;<span class="ident" id="1951328">RuneError</span><span class="op" id="1951337">,</span>&nbsp;<span class="num" id="1951339">1</span><span class="op" id="1951340">,</span>&nbsp;<span class="builtintype" id="1951342">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951354">return</span>&nbsp;<span class="ident" id="1951361">r</span><span class="op" id="1951362">,</span>&nbsp;<span class="num" id="1951364">4</span><span class="op" id="1951365">,</span>&nbsp;<span class="builtintype" id="1951367">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951378">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951388">return</span>&nbsp;<span class="ident" id="1951395">RuneError</span><span class="op" id="1951404">,</span>&nbsp;<span class="num" id="1951406">1</span><span class="op" id="1951407">,</span>&nbsp;<span class="builtintype" id="1951409">false</span><br>
<span class="lineno"></span><span class="op" id="1951415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1951418">func</span>&nbsp;<span class="ident" id="1951423">decodeRuneInStringInternal</span><span class="op" id="1951449">(</span><span class="ident" id="1951450">s</span>&nbsp;<span class="builtintype" id="1951452">string</span><span class="op" id="1951458">)</span>&nbsp;<span class="op" id="1951460">(</span><span class="ident" id="1951461">r</span>&nbsp;<span class="builtintype" id="1951463">rune</span><span class="op" id="1951467">,</span>&nbsp;<span class="ident" id="1951469">size</span>&nbsp;<span class="builtintype" id="1951474">int</span><span class="op" id="1951477">,</span>&nbsp;<span class="ident" id="1951479">short</span>&nbsp;<span class="builtintype" id="1951485">bool</span><span class="op" id="1951489">)</span>&nbsp;<span class="op" id="1951491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951494">n</span>&nbsp;<span class="op" id="1951496">:=</span>&nbsp;<span class="builtinfunc" id="1951499">len</span><span class="op" id="1951502">(</span><span class="ident" id="1951503">s</span><span class="op" id="1951504">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951507">if</span>&nbsp;<span class="ident" id="1951510">n</span>&nbsp;<span class="op" id="1951512">&lt;</span>&nbsp;<span class="num" id="1951514">1</span>&nbsp;<span class="op" id="1951516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951520">return</span>&nbsp;<span class="ident" id="1951527">RuneError</span><span class="op" id="1951536">,</span>&nbsp;<span class="num" id="1951538">0</span><span class="op" id="1951539">,</span>&nbsp;<span class="builtintype" id="1951541">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951550">c0</span>&nbsp;<span class="op" id="1951553">:=</span>&nbsp;<span class="ident" id="1951556">s</span><span class="op" id="1951557">[</span><span class="num" id="1951558">0</span><span class="op" id="1951559">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951563">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951591">if</span>&nbsp;<span class="ident" id="1951594">c0</span>&nbsp;<span class="op" id="1951597">&lt;</span>&nbsp;<span class="ident" id="1951599">tx</span>&nbsp;<span class="op" id="1951602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951606">return</span>&nbsp;<span class="builtintype" id="1951613">rune</span><span class="op" id="1951617">(</span><span class="ident" id="1951618">c0</span><span class="op" id="1951620">)</span><span class="op" id="1951621">,</span>&nbsp;<span class="num" id="1951623">1</span><span class="op" id="1951624">,</span>&nbsp;<span class="builtintype" id="1951626">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951637">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951671">if</span>&nbsp;<span class="ident" id="1951674">c0</span>&nbsp;<span class="op" id="1951677">&lt;</span>&nbsp;<span class="ident" id="1951679">t2</span>&nbsp;<span class="op" id="1951682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951686">return</span>&nbsp;<span class="ident" id="1951693">RuneError</span><span class="op" id="1951702">,</span>&nbsp;<span class="num" id="1951704">1</span><span class="op" id="1951705">,</span>&nbsp;<span class="builtintype" id="1951707">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951718">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951751">if</span>&nbsp;<span class="ident" id="1951754">n</span>&nbsp;<span class="op" id="1951756">&lt;</span>&nbsp;<span class="num" id="1951758">2</span>&nbsp;<span class="op" id="1951760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951764">return</span>&nbsp;<span class="ident" id="1951771">RuneError</span><span class="op" id="1951780">,</span>&nbsp;<span class="num" id="1951782">1</span><span class="op" id="1951783">,</span>&nbsp;<span class="builtintype" id="1951785">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951794">c1</span>&nbsp;<span class="op" id="1951797">:=</span>&nbsp;<span class="ident" id="1951800">s</span><span class="op" id="1951801">[</span><span class="num" id="1951802">1</span><span class="op" id="1951803">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951806">if</span>&nbsp;<span class="ident" id="1951809">c1</span>&nbsp;<span class="op" id="1951812">&lt;</span>&nbsp;<span class="ident" id="1951814">tx</span>&nbsp;<span class="op" id="1951817">||</span>&nbsp;<span class="ident" id="1951820">t2</span>&nbsp;<span class="op" id="1951823">&lt;=</span>&nbsp;<span class="ident" id="1951826">c1</span>&nbsp;<span class="op" id="1951829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951833">return</span>&nbsp;<span class="ident" id="1951840">RuneError</span><span class="op" id="1951849">,</span>&nbsp;<span class="num" id="1951851">1</span><span class="op" id="1951852">,</span>&nbsp;<span class="builtintype" id="1951854">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1951861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1951865">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951894">if</span>&nbsp;<span class="ident" id="1951897">c0</span>&nbsp;<span class="op" id="1951900">&lt;</span>&nbsp;<span class="ident" id="1951902">t3</span>&nbsp;<span class="op" id="1951905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1951909">r</span>&nbsp;<span class="op" id="1951911">=</span>&nbsp;<span class="builtintype" id="1951913">rune</span><span class="op" id="1951917">(</span><span class="ident" id="1951918">c0</span><span class="op" id="1951920">&amp;</span><span class="ident" id="1951921">mask2</span><span class="op" id="1951926">)</span><span class="op" id="1951927">&lt;&lt;</span><span class="num" id="1951929">6</span>&nbsp;<span class="op" id="1951931">|</span>&nbsp;<span class="builtintype" id="1951933">rune</span><span class="op" id="1951937">(</span><span class="ident" id="1951938">c1</span><span class="op" id="1951940">&amp;</span><span class="ident" id="1951941">maskx</span><span class="op" id="1951946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951950">if</span>&nbsp;<span class="ident" id="1951953">r</span>&nbsp;<span class="op" id="1951955">&lt;=</span>&nbsp;<span class="ident" id="1951958">rune1Max</span>&nbsp;<span class="op" id="1951967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1951972">return</span>&nbsp;<span class="ident" id="1951979">RuneError</span><span class="op" id="1951988">,</span>&nbsp;<span class="num" id="1951990">1</span><span class="op" id="1951991">,</span>&nbsp;<span class="builtintype" id="1951993">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952001">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952005">return</span>&nbsp;<span class="ident" id="1952012">r</span><span class="op" id="1952013">,</span>&nbsp;<span class="num" id="1952015">2</span><span class="op" id="1952016">,</span>&nbsp;<span class="builtintype" id="1952018">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952029">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952063">if</span>&nbsp;<span class="ident" id="1952066">n</span>&nbsp;<span class="op" id="1952068">&lt;</span>&nbsp;<span class="num" id="1952070">3</span>&nbsp;<span class="op" id="1952072">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952076">return</span>&nbsp;<span class="ident" id="1952083">RuneError</span><span class="op" id="1952092">,</span>&nbsp;<span class="num" id="1952094">1</span><span class="op" id="1952095">,</span>&nbsp;<span class="builtintype" id="1952097">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952106">c2</span>&nbsp;<span class="op" id="1952109">:=</span>&nbsp;<span class="ident" id="1952112">s</span><span class="op" id="1952113">[</span><span class="num" id="1952114">2</span><span class="op" id="1952115">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952118">if</span>&nbsp;<span class="ident" id="1952121">c2</span>&nbsp;<span class="op" id="1952124">&lt;</span>&nbsp;<span class="ident" id="1952126">tx</span>&nbsp;<span class="op" id="1952129">||</span>&nbsp;<span class="ident" id="1952132">t2</span>&nbsp;<span class="op" id="1952135">&lt;=</span>&nbsp;<span class="ident" id="1952138">c2</span>&nbsp;<span class="op" id="1952141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952145">return</span>&nbsp;<span class="ident" id="1952152">RuneError</span><span class="op" id="1952161">,</span>&nbsp;<span class="num" id="1952163">1</span><span class="op" id="1952164">,</span>&nbsp;<span class="builtintype" id="1952166">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952177">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952206">if</span>&nbsp;<span class="ident" id="1952209">c0</span>&nbsp;<span class="op" id="1952212">&lt;</span>&nbsp;<span class="ident" id="1952214">t4</span>&nbsp;<span class="op" id="1952217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952221">r</span>&nbsp;<span class="op" id="1952223">=</span>&nbsp;<span class="builtintype" id="1952225">rune</span><span class="op" id="1952229">(</span><span class="ident" id="1952230">c0</span><span class="op" id="1952232">&amp;</span><span class="ident" id="1952233">mask3</span><span class="op" id="1952238">)</span><span class="op" id="1952239">&lt;&lt;</span><span class="num" id="1952241">12</span>&nbsp;<span class="op" id="1952244">|</span>&nbsp;<span class="builtintype" id="1952246">rune</span><span class="op" id="1952250">(</span><span class="ident" id="1952251">c1</span><span class="op" id="1952253">&amp;</span><span class="ident" id="1952254">maskx</span><span class="op" id="1952259">)</span><span class="op" id="1952260">&lt;&lt;</span><span class="num" id="1952262">6</span>&nbsp;<span class="op" id="1952264">|</span>&nbsp;<span class="builtintype" id="1952266">rune</span><span class="op" id="1952270">(</span><span class="ident" id="1952271">c2</span><span class="op" id="1952273">&amp;</span><span class="ident" id="1952274">maskx</span><span class="op" id="1952279">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952283">if</span>&nbsp;<span class="ident" id="1952286">r</span>&nbsp;<span class="op" id="1952288">&lt;=</span>&nbsp;<span class="ident" id="1952291">rune2Max</span>&nbsp;<span class="op" id="1952300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952305">return</span>&nbsp;<span class="ident" id="1952312">RuneError</span><span class="op" id="1952321">,</span>&nbsp;<span class="num" id="1952323">1</span><span class="op" id="1952324">,</span>&nbsp;<span class="builtintype" id="1952326">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952338">if</span>&nbsp;<span class="ident" id="1952341">surrogateMin</span>&nbsp;<span class="op" id="1952354">&lt;=</span>&nbsp;<span class="ident" id="1952357">r</span>&nbsp;<span class="op" id="1952359">&amp;&amp;</span>&nbsp;<span class="ident" id="1952362">r</span>&nbsp;<span class="op" id="1952364">&lt;=</span>&nbsp;<span class="ident" id="1952367">surrogateMax</span>&nbsp;<span class="op" id="1952380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952385">return</span>&nbsp;<span class="ident" id="1952392">RuneError</span><span class="op" id="1952401">,</span>&nbsp;<span class="num" id="1952403">1</span><span class="op" id="1952404">,</span>&nbsp;<span class="builtintype" id="1952406">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952418">return</span>&nbsp;<span class="ident" id="1952425">r</span><span class="op" id="1952426">,</span>&nbsp;<span class="num" id="1952428">3</span><span class="op" id="1952429">,</span>&nbsp;<span class="builtintype" id="1952431">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952442">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952475">if</span>&nbsp;<span class="ident" id="1952478">n</span>&nbsp;<span class="op" id="1952480">&lt;</span>&nbsp;<span class="num" id="1952482">4</span>&nbsp;<span class="op" id="1952484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952488">return</span>&nbsp;<span class="ident" id="1952495">RuneError</span><span class="op" id="1952504">,</span>&nbsp;<span class="num" id="1952506">1</span><span class="op" id="1952507">,</span>&nbsp;<span class="builtintype" id="1952509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952518">c3</span>&nbsp;<span class="op" id="1952521">:=</span>&nbsp;<span class="ident" id="1952524">s</span><span class="op" id="1952525">[</span><span class="num" id="1952526">3</span><span class="op" id="1952527">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952530">if</span>&nbsp;<span class="ident" id="1952533">c3</span>&nbsp;<span class="op" id="1952536">&lt;</span>&nbsp;<span class="ident" id="1952538">tx</span>&nbsp;<span class="op" id="1952541">||</span>&nbsp;<span class="ident" id="1952544">t2</span>&nbsp;<span class="op" id="1952547">&lt;=</span>&nbsp;<span class="ident" id="1952550">c3</span>&nbsp;<span class="op" id="1952553">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952557">return</span>&nbsp;<span class="ident" id="1952564">RuneError</span><span class="op" id="1952573">,</span>&nbsp;<span class="num" id="1952575">1</span><span class="op" id="1952576">,</span>&nbsp;<span class="builtintype" id="1952578">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952589">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952618">if</span>&nbsp;<span class="ident" id="1952621">c0</span>&nbsp;<span class="op" id="1952624">&lt;</span>&nbsp;<span class="ident" id="1952626">t5</span>&nbsp;<span class="op" id="1952629">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1952633">r</span>&nbsp;<span class="op" id="1952635">=</span>&nbsp;<span class="builtintype" id="1952637">rune</span><span class="op" id="1952641">(</span><span class="ident" id="1952642">c0</span><span class="op" id="1952644">&amp;</span><span class="ident" id="1952645">mask4</span><span class="op" id="1952650">)</span><span class="op" id="1952651">&lt;&lt;</span><span class="num" id="1952653">18</span>&nbsp;<span class="op" id="1952656">|</span>&nbsp;<span class="builtintype" id="1952658">rune</span><span class="op" id="1952662">(</span><span class="ident" id="1952663">c1</span><span class="op" id="1952665">&amp;</span><span class="ident" id="1952666">maskx</span><span class="op" id="1952671">)</span><span class="op" id="1952672">&lt;&lt;</span><span class="num" id="1952674">12</span>&nbsp;<span class="op" id="1952677">|</span>&nbsp;<span class="builtintype" id="1952679">rune</span><span class="op" id="1952683">(</span><span class="ident" id="1952684">c2</span><span class="op" id="1952686">&amp;</span><span class="ident" id="1952687">maskx</span><span class="op" id="1952692">)</span><span class="op" id="1952693">&lt;&lt;</span><span class="num" id="1952695">6</span>&nbsp;<span class="op" id="1952697">|</span>&nbsp;<span class="builtintype" id="1952699">rune</span><span class="op" id="1952703">(</span><span class="ident" id="1952704">c3</span><span class="op" id="1952706">&amp;</span><span class="ident" id="1952707">maskx</span><span class="op" id="1952712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952716">if</span>&nbsp;<span class="ident" id="1952719">r</span>&nbsp;<span class="op" id="1952721">&lt;=</span>&nbsp;<span class="ident" id="1952724">rune3Max</span>&nbsp;<span class="op" id="1952733">||</span>&nbsp;<span class="ident" id="1952736">MaxRune</span>&nbsp;<span class="op" id="1952744">&lt;</span>&nbsp;<span class="ident" id="1952746">r</span>&nbsp;<span class="op" id="1952748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952753">return</span>&nbsp;<span class="ident" id="1952760">RuneError</span><span class="op" id="1952769">,</span>&nbsp;<span class="num" id="1952771">1</span><span class="op" id="1952772">,</span>&nbsp;<span class="builtintype" id="1952774">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952786">return</span>&nbsp;<span class="ident" id="1952793">r</span><span class="op" id="1952794">,</span>&nbsp;<span class="num" id="1952796">4</span><span class="op" id="1952797">,</span>&nbsp;<span class="builtintype" id="1952799">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1952806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1952810">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1952820">return</span>&nbsp;<span class="ident" id="1952827">RuneError</span><span class="op" id="1952836">,</span>&nbsp;<span class="num" id="1952838">1</span><span class="op" id="1952839">,</span>&nbsp;<span class="builtintype" id="1952841">false</span><br>
<span class="lineno"></span><span class="op" id="1952847">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1952850">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1952937">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1953033">func</span>&nbsp;<span class="ident" id="1953038">FullRune</span><span class="op" id="1953046">(</span><span class="ident" id="1953047">p</span>&nbsp;<span class="op" id="1953049">[</span><span class="op" id="1953050">]</span><span class="builtintype" id="1953051">byte</span><span class="op" id="1953055">)</span>&nbsp;<span class="builtintype" id="1953057">bool</span>&nbsp;<span class="op" id="1953062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953065">_</span><span class="op" id="1953066">,</span>&nbsp;<span class="ident" id="1953068">_</span><span class="op" id="1953069">,</span>&nbsp;<span class="ident" id="1953071">short</span>&nbsp;<span class="op" id="1953077">:=</span>&nbsp;<span class="ident" id="1953080">decodeRuneInternal</span><span class="op" id="1953098">(</span><span class="ident" id="1953099">p</span><span class="op" id="1953100">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953103">return</span>&nbsp;<span class="op" id="1953110">!</span><span class="ident" id="1953111">short</span><br>
<span class="lineno"></span><span class="op" id="1953117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1953120">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1953184">func</span>&nbsp;<span class="ident" id="1953189">FullRuneInString</span><span class="op" id="1953205">(</span><span class="ident" id="1953206">s</span>&nbsp;<span class="builtintype" id="1953208">string</span><span class="op" id="1953214">)</span>&nbsp;<span class="builtintype" id="1953216">bool</span>&nbsp;<span class="op" id="1953221">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953224">_</span><span class="op" id="1953225">,</span>&nbsp;<span class="ident" id="1953227">_</span><span class="op" id="1953228">,</span>&nbsp;<span class="ident" id="1953230">short</span>&nbsp;<span class="op" id="1953236">:=</span>&nbsp;<span class="ident" id="1953239">decodeRuneInStringInternal</span><span class="op" id="1953265">(</span><span class="ident" id="1953266">s</span><span class="op" id="1953267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953270">return</span>&nbsp;<span class="op" id="1953277">!</span><span class="ident" id="1953278">short</span><br>
<span class="lineno"></span><span class="op" id="1953284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1953287">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1953364">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1953442">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1953517">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1953547">//</span><br>
<span class="lineno"></span><span class="comment" id="1953550">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1953625">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1953697">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1953741">func</span>&nbsp;<span class="ident" id="1953746">DecodeRune</span><span class="op" id="1953756">(</span><span class="ident" id="1953757">p</span>&nbsp;<span class="op" id="1953759">[</span><span class="op" id="1953760">]</span><span class="builtintype" id="1953761">byte</span><span class="op" id="1953765">)</span>&nbsp;<span class="op" id="1953767">(</span><span class="ident" id="1953768">r</span>&nbsp;<span class="builtintype" id="1953770">rune</span><span class="op" id="1953774">,</span>&nbsp;<span class="ident" id="1953776">size</span>&nbsp;<span class="builtintype" id="1953781">int</span><span class="op" id="1953784">)</span>&nbsp;<span class="op" id="1953786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1953789">r</span><span class="op" id="1953790">,</span>&nbsp;<span class="ident" id="1953792">size</span><span class="op" id="1953796">,</span>&nbsp;<span class="ident" id="1953798">_</span>&nbsp;<span class="op" id="1953800">=</span>&nbsp;<span class="ident" id="1953802">decodeRuneInternal</span><span class="op" id="1953820">(</span><span class="ident" id="1953821">p</span><span class="op" id="1953822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1953825">return</span><br>
<span class="lineno">225</span><span class="op" id="1953832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1953835">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1953911">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1953989">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1954063">//</span><br>
<span class="lineno"></span><span class="comment" id="1954066">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1954141">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1954213">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1954257">func</span>&nbsp;<span class="ident" id="1954262">DecodeRuneInString</span><span class="op" id="1954280">(</span><span class="ident" id="1954281">s</span>&nbsp;<span class="builtintype" id="1954283">string</span><span class="op" id="1954289">)</span>&nbsp;<span class="op" id="1954291">(</span><span class="ident" id="1954292">r</span>&nbsp;<span class="builtintype" id="1954294">rune</span><span class="op" id="1954298">,</span>&nbsp;<span class="ident" id="1954300">size</span>&nbsp;<span class="builtintype" id="1954305">int</span><span class="op" id="1954308">)</span>&nbsp;<span class="op" id="1954310">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1954313">r</span><span class="op" id="1954314">,</span>&nbsp;<span class="ident" id="1954316">size</span><span class="op" id="1954320">,</span>&nbsp;<span class="ident" id="1954322">_</span>&nbsp;<span class="op" id="1954324">=</span>&nbsp;<span class="ident" id="1954326">decodeRuneInStringInternal</span><span class="op" id="1954352">(</span><span class="ident" id="1954353">s</span><span class="op" id="1954354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1954357">return</span><br>
<span class="lineno"></span><span class="op" id="1954364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1954367">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1954447">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1954525">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1954600">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1954630">//</span><br>
<span class="lineno"></span><span class="comment" id="1954633">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1954708">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1954780">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1954824">func</span>&nbsp;<span class="ident" id="1954829">DecodeLastRune</span><span class="op" id="1954843">(</span><span class="ident" id="1954844">p</span>&nbsp;<span class="op" id="1954846">[</span><span class="op" id="1954847">]</span><span class="builtintype" id="1954848">byte</span><span class="op" id="1954852">)</span>&nbsp;<span class="op" id="1954854">(</span><span class="ident" id="1954855">r</span>&nbsp;<span class="builtintype" id="1954857">rune</span><span class="op" id="1954861">,</span>&nbsp;<span class="ident" id="1954863">size</span>&nbsp;<span class="builtintype" id="1954868">int</span><span class="op" id="1954871">)</span>&nbsp;<span class="op" id="1954873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1954876">end</span>&nbsp;<span class="op" id="1954880">:=</span>&nbsp;<span class="builtinfunc" id="1954883">len</span><span class="op" id="1954886">(</span><span class="ident" id="1954887">p</span><span class="op" id="1954888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1954891">if</span>&nbsp;<span class="ident" id="1954894">end</span>&nbsp;<span class="op" id="1954898">==</span>&nbsp;<span class="num" id="1954901">0</span>&nbsp;<span class="op" id="1954903">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1954907">return</span>&nbsp;<span class="ident" id="1954914">RuneError</span><span class="op" id="1954923">,</span>&nbsp;<span class="num" id="1954925">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1954928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1954931">start</span>&nbsp;<span class="op" id="1954937">:=</span>&nbsp;<span class="ident" id="1954940">end</span>&nbsp;<span class="op" id="1954944">-</span>&nbsp;<span class="num" id="1954946">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1954949">r</span>&nbsp;<span class="op" id="1954951">=</span>&nbsp;<span class="builtintype" id="1954953">rune</span><span class="op" id="1954957">(</span><span class="ident" id="1954958">p</span><span class="op" id="1954959">[</span><span class="ident" id="1954960">start</span><span class="op" id="1954965">]</span><span class="op" id="1954966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1954969">if</span>&nbsp;<span class="ident" id="1954972">r</span>&nbsp;<span class="op" id="1954974">&lt;</span>&nbsp;<span class="ident" id="1954976">RuneSelf</span>&nbsp;<span class="op" id="1954985">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1954989">return</span>&nbsp;<span class="ident" id="1954996">r</span><span class="op" id="1954997">,</span>&nbsp;<span class="num" id="1954999">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1955005">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1955055">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1955108">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955127">lim</span>&nbsp;<span class="op" id="1955131">:=</span>&nbsp;<span class="ident" id="1955134">end</span>&nbsp;<span class="op" id="1955138">-</span>&nbsp;<span class="ident" id="1955140">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955148">if</span>&nbsp;<span class="ident" id="1955151">lim</span>&nbsp;<span class="op" id="1955155">&lt;</span>&nbsp;<span class="num" id="1955157">0</span>&nbsp;<span class="op" id="1955159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955163">lim</span>&nbsp;<span class="op" id="1955167">=</span>&nbsp;<span class="num" id="1955169">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955175">for</span>&nbsp;<span class="ident" id="1955179">start</span><span class="op" id="1955184">--</span><span class="op" id="1955186">;</span>&nbsp;<span class="ident" id="1955188">start</span>&nbsp;<span class="op" id="1955194">&gt;=</span>&nbsp;<span class="ident" id="1955197">lim</span><span class="op" id="1955200">;</span>&nbsp;<span class="ident" id="1955202">start</span><span class="op" id="1955207">--</span>&nbsp;<span class="op" id="1955210">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955214">if</span>&nbsp;<span class="ident" id="1955217">RuneStart</span><span class="op" id="1955226">(</span><span class="ident" id="1955227">p</span><span class="op" id="1955228">[</span><span class="ident" id="1955229">start</span><span class="op" id="1955234">]</span><span class="op" id="1955235">)</span>&nbsp;<span class="op" id="1955237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955242">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955256">if</span>&nbsp;<span class="ident" id="1955259">start</span>&nbsp;<span class="op" id="1955265">&lt;</span>&nbsp;<span class="num" id="1955267">0</span>&nbsp;<span class="op" id="1955269">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955273">start</span>&nbsp;<span class="op" id="1955279">=</span>&nbsp;<span class="num" id="1955281">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955287">r</span><span class="op" id="1955288">,</span>&nbsp;<span class="ident" id="1955290">size</span>&nbsp;<span class="op" id="1955295">=</span>&nbsp;<span class="ident" id="1955297">DecodeRune</span><span class="op" id="1955307">(</span><span class="ident" id="1955308">p</span><span class="op" id="1955309">[</span><span class="ident" id="1955310">start</span><span class="op" id="1955315">:</span><span class="ident" id="1955316">end</span><span class="op" id="1955319">]</span><span class="op" id="1955320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955323">if</span>&nbsp;<span class="ident" id="1955326">start</span><span class="op" id="1955331">+</span><span class="ident" id="1955332">size</span>&nbsp;<span class="op" id="1955337">!=</span>&nbsp;<span class="ident" id="1955340">end</span>&nbsp;<span class="op" id="1955344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955348">return</span>&nbsp;<span class="ident" id="1955355">RuneError</span><span class="op" id="1955364">,</span>&nbsp;<span class="num" id="1955366">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955372">return</span>&nbsp;<span class="ident" id="1955379">r</span><span class="op" id="1955380">,</span>&nbsp;<span class="ident" id="1955382">size</span><br>
<span class="lineno"></span><span class="op" id="1955387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1955390">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1955469">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1955549">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1955626">//</span><br>
<span class="lineno"></span><span class="comment" id="1955629">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1955704">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1955776">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1955820">func</span>&nbsp;<span class="ident" id="1955825">DecodeLastRuneInString</span><span class="op" id="1955847">(</span><span class="ident" id="1955848">s</span>&nbsp;<span class="builtintype" id="1955850">string</span><span class="op" id="1955856">)</span>&nbsp;<span class="op" id="1955858">(</span><span class="ident" id="1955859">r</span>&nbsp;<span class="builtintype" id="1955861">rune</span><span class="op" id="1955865">,</span>&nbsp;<span class="ident" id="1955867">size</span>&nbsp;<span class="builtintype" id="1955872">int</span><span class="op" id="1955875">)</span>&nbsp;<span class="op" id="1955877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955880">end</span>&nbsp;<span class="op" id="1955884">:=</span>&nbsp;<span class="builtinfunc" id="1955887">len</span><span class="op" id="1955890">(</span><span class="ident" id="1955891">s</span><span class="op" id="1955892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955895">if</span>&nbsp;<span class="ident" id="1955898">end</span>&nbsp;<span class="op" id="1955902">==</span>&nbsp;<span class="num" id="1955905">0</span>&nbsp;<span class="op" id="1955907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955911">return</span>&nbsp;<span class="ident" id="1955918">RuneError</span><span class="op" id="1955927">,</span>&nbsp;<span class="num" id="1955929">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1955932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955935">start</span>&nbsp;<span class="op" id="1955941">:=</span>&nbsp;<span class="ident" id="1955944">end</span>&nbsp;<span class="op" id="1955948">-</span>&nbsp;<span class="num" id="1955950">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1955953">r</span>&nbsp;<span class="op" id="1955955">=</span>&nbsp;<span class="builtintype" id="1955957">rune</span><span class="op" id="1955961">(</span><span class="ident" id="1955962">s</span><span class="op" id="1955963">[</span><span class="ident" id="1955964">start</span><span class="op" id="1955969">]</span><span class="op" id="1955970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955973">if</span>&nbsp;<span class="ident" id="1955976">r</span>&nbsp;<span class="op" id="1955978">&lt;</span>&nbsp;<span class="ident" id="1955980">RuneSelf</span>&nbsp;<span class="op" id="1955989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1955993">return</span>&nbsp;<span class="ident" id="1956000">r</span><span class="op" id="1956001">,</span>&nbsp;<span class="num" id="1956003">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1956009">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1956059">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1956112">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1956131">lim</span>&nbsp;<span class="op" id="1956135">:=</span>&nbsp;<span class="ident" id="1956138">end</span>&nbsp;<span class="op" id="1956142">-</span>&nbsp;<span class="ident" id="1956144">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956152">if</span>&nbsp;<span class="ident" id="1956155">lim</span>&nbsp;<span class="op" id="1956159">&lt;</span>&nbsp;<span class="num" id="1956161">0</span>&nbsp;<span class="op" id="1956163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1956167">lim</span>&nbsp;<span class="op" id="1956171">=</span>&nbsp;<span class="num" id="1956173">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956179">for</span>&nbsp;<span class="ident" id="1956183">start</span><span class="op" id="1956188">--</span><span class="op" id="1956190">;</span>&nbsp;<span class="ident" id="1956192">start</span>&nbsp;<span class="op" id="1956198">&gt;=</span>&nbsp;<span class="ident" id="1956201">lim</span><span class="op" id="1956204">;</span>&nbsp;<span class="ident" id="1956206">start</span><span class="op" id="1956211">--</span>&nbsp;<span class="op" id="1956214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956218">if</span>&nbsp;<span class="ident" id="1956221">RuneStart</span><span class="op" id="1956230">(</span><span class="ident" id="1956231">s</span><span class="op" id="1956232">[</span><span class="ident" id="1956233">start</span><span class="op" id="1956238">]</span><span class="op" id="1956239">)</span>&nbsp;<span class="op" id="1956241">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956246">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956260">if</span>&nbsp;<span class="ident" id="1956263">start</span>&nbsp;<span class="op" id="1956269">&lt;</span>&nbsp;<span class="num" id="1956271">0</span>&nbsp;<span class="op" id="1956273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1956277">start</span>&nbsp;<span class="op" id="1956283">=</span>&nbsp;<span class="num" id="1956285">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1956291">r</span><span class="op" id="1956292">,</span>&nbsp;<span class="ident" id="1956294">size</span>&nbsp;<span class="op" id="1956299">=</span>&nbsp;<span class="ident" id="1956301">DecodeRuneInString</span><span class="op" id="1956319">(</span><span class="ident" id="1956320">s</span><span class="op" id="1956321">[</span><span class="ident" id="1956322">start</span><span class="op" id="1956327">:</span><span class="ident" id="1956328">end</span><span class="op" id="1956331">]</span><span class="op" id="1956332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956335">if</span>&nbsp;<span class="ident" id="1956338">start</span><span class="op" id="1956343">+</span><span class="ident" id="1956344">size</span>&nbsp;<span class="op" id="1956349">!=</span>&nbsp;<span class="ident" id="1956352">end</span>&nbsp;<span class="op" id="1956356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956360">return</span>&nbsp;<span class="ident" id="1956367">RuneError</span><span class="op" id="1956376">,</span>&nbsp;<span class="num" id="1956378">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956381">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956384">return</span>&nbsp;<span class="ident" id="1956391">r</span><span class="op" id="1956392">,</span>&nbsp;<span class="ident" id="1956394">size</span><br>
<span class="lineno"></span><span class="op" id="1956399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1956402">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1956470">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1956540">func</span>&nbsp;<span class="ident" id="1956545">RuneLen</span><span class="op" id="1956552">(</span><span class="ident" id="1956553">r</span>&nbsp;<span class="builtintype" id="1956555">rune</span><span class="op" id="1956559">)</span>&nbsp;<span class="builtintype" id="1956561">int</span>&nbsp;<span class="op" id="1956565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956568">switch</span>&nbsp;<span class="op" id="1956575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956578">case</span>&nbsp;<span class="ident" id="1956583">r</span>&nbsp;<span class="op" id="1956585">&lt;</span>&nbsp;<span class="num" id="1956587">0</span><span class="op" id="1956588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956592">return</span>&nbsp;<span class="op" id="1956599">-</span><span class="num" id="1956600">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956603">case</span>&nbsp;<span class="ident" id="1956608">r</span>&nbsp;<span class="op" id="1956610">&lt;=</span>&nbsp;<span class="ident" id="1956613">rune1Max</span><span class="op" id="1956621">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956625">return</span>&nbsp;<span class="num" id="1956632">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956635">case</span>&nbsp;<span class="ident" id="1956640">r</span>&nbsp;<span class="op" id="1956642">&lt;=</span>&nbsp;<span class="ident" id="1956645">rune2Max</span><span class="op" id="1956653">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956657">return</span>&nbsp;<span class="num" id="1956664">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956667">case</span>&nbsp;<span class="ident" id="1956672">surrogateMin</span>&nbsp;<span class="op" id="1956685">&lt;=</span>&nbsp;<span class="ident" id="1956688">r</span>&nbsp;<span class="op" id="1956690">&amp;&amp;</span>&nbsp;<span class="ident" id="1956693">r</span>&nbsp;<span class="op" id="1956695">&lt;=</span>&nbsp;<span class="ident" id="1956698">surrogateMax</span><span class="op" id="1956710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956714">return</span>&nbsp;<span class="op" id="1956721">-</span><span class="num" id="1956722">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956725">case</span>&nbsp;<span class="ident" id="1956730">r</span>&nbsp;<span class="op" id="1956732">&lt;=</span>&nbsp;<span class="ident" id="1956735">rune3Max</span><span class="op" id="1956743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956747">return</span>&nbsp;<span class="num" id="1956754">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956757">case</span>&nbsp;<span class="ident" id="1956762">r</span>&nbsp;<span class="op" id="1956764">&lt;=</span>&nbsp;<span class="ident" id="1956767">MaxRune</span><span class="op" id="1956774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956778">return</span>&nbsp;<span class="num" id="1956785">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1956788">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1956791">return</span>&nbsp;<span class="op" id="1956798">-</span><span class="num" id="1956799">1</span><br>
<span class="lineno"></span><span class="op" id="1956801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1956804">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1956893">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1956936">func</span>&nbsp;<span class="ident" id="1956941">EncodeRune</span><span class="op" id="1956951">(</span><span class="ident" id="1956952">p</span>&nbsp;<span class="op" id="1956954">[</span><span class="op" id="1956955">]</span><span class="builtintype" id="1956956">byte</span><span class="op" id="1956960">,</span>&nbsp;<span class="ident" id="1956962">r</span>&nbsp;<span class="builtintype" id="1956964">rune</span><span class="op" id="1956968">)</span>&nbsp;<span class="builtintype" id="1956970">int</span>&nbsp;<span class="op" id="1956974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1956977">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957055">switch</span>&nbsp;<span class="ident" id="1957062">i</span>&nbsp;<span class="op" id="1957064">:=</span>&nbsp;<span class="builtintype" id="1957067">uint32</span><span class="op" id="1957073">(</span><span class="ident" id="1957074">r</span><span class="op" id="1957075">)</span><span class="op" id="1957076">;</span>&nbsp;<span class="op" id="1957078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957081">case</span>&nbsp;<span class="ident" id="1957086">i</span>&nbsp;<span class="op" id="1957088">&lt;=</span>&nbsp;<span class="ident" id="1957091">rune1Max</span><span class="op" id="1957099">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957103">p</span><span class="op" id="1957104">[</span><span class="num" id="1957105">0</span><span class="op" id="1957106">]</span>&nbsp;<span class="op" id="1957108">=</span>&nbsp;<span class="builtintype" id="1957110">byte</span><span class="op" id="1957114">(</span><span class="ident" id="1957115">r</span><span class="op" id="1957116">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957120">return</span>&nbsp;<span class="num" id="1957127">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957130">case</span>&nbsp;<span class="ident" id="1957135">i</span>&nbsp;<span class="op" id="1957137">&lt;=</span>&nbsp;<span class="ident" id="1957140">rune2Max</span><span class="op" id="1957148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957152">p</span><span class="op" id="1957153">[</span><span class="num" id="1957154">0</span><span class="op" id="1957155">]</span>&nbsp;<span class="op" id="1957157">=</span>&nbsp;<span class="ident" id="1957159">t2</span>&nbsp;<span class="op" id="1957162">|</span>&nbsp;<span class="builtintype" id="1957164">byte</span><span class="op" id="1957168">(</span><span class="ident" id="1957169">r</span><span class="op" id="1957170">&gt;&gt;</span><span class="num" id="1957172">6</span><span class="op" id="1957173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957177">p</span><span class="op" id="1957178">[</span><span class="num" id="1957179">1</span><span class="op" id="1957180">]</span>&nbsp;<span class="op" id="1957182">=</span>&nbsp;<span class="ident" id="1957184">tx</span>&nbsp;<span class="op" id="1957187">|</span>&nbsp;<span class="builtintype" id="1957189">byte</span><span class="op" id="1957193">(</span><span class="ident" id="1957194">r</span><span class="op" id="1957195">)</span><span class="op" id="1957196">&amp;</span><span class="ident" id="1957197">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957205">return</span>&nbsp;<span class="num" id="1957212">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957215">case</span>&nbsp;<span class="ident" id="1957220">i</span>&nbsp;<span class="op" id="1957222">&gt;</span>&nbsp;<span class="ident" id="1957224">MaxRune</span><span class="op" id="1957231">,</span>&nbsp;<span class="ident" id="1957233">surrogateMin</span>&nbsp;<span class="op" id="1957246">&lt;=</span>&nbsp;<span class="ident" id="1957249">i</span>&nbsp;<span class="op" id="1957251">&amp;&amp;</span>&nbsp;<span class="ident" id="1957254">i</span>&nbsp;<span class="op" id="1957256">&lt;=</span>&nbsp;<span class="ident" id="1957259">surrogateMax</span><span class="op" id="1957271">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957275">r</span>&nbsp;<span class="op" id="1957277">=</span>&nbsp;<span class="ident" id="1957279">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957291">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957304">case</span>&nbsp;<span class="ident" id="1957309">i</span>&nbsp;<span class="op" id="1957311">&lt;=</span>&nbsp;<span class="ident" id="1957314">rune3Max</span><span class="op" id="1957322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957326">p</span><span class="op" id="1957327">[</span><span class="num" id="1957328">0</span><span class="op" id="1957329">]</span>&nbsp;<span class="op" id="1957331">=</span>&nbsp;<span class="ident" id="1957333">t3</span>&nbsp;<span class="op" id="1957336">|</span>&nbsp;<span class="builtintype" id="1957338">byte</span><span class="op" id="1957342">(</span><span class="ident" id="1957343">r</span><span class="op" id="1957344">&gt;&gt;</span><span class="num" id="1957346">12</span><span class="op" id="1957348">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957352">p</span><span class="op" id="1957353">[</span><span class="num" id="1957354">1</span><span class="op" id="1957355">]</span>&nbsp;<span class="op" id="1957357">=</span>&nbsp;<span class="ident" id="1957359">tx</span>&nbsp;<span class="op" id="1957362">|</span>&nbsp;<span class="builtintype" id="1957364">byte</span><span class="op" id="1957368">(</span><span class="ident" id="1957369">r</span><span class="op" id="1957370">&gt;&gt;</span><span class="num" id="1957372">6</span><span class="op" id="1957373">)</span><span class="op" id="1957374">&amp;</span><span class="ident" id="1957375">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957383">p</span><span class="op" id="1957384">[</span><span class="num" id="1957385">2</span><span class="op" id="1957386">]</span>&nbsp;<span class="op" id="1957388">=</span>&nbsp;<span class="ident" id="1957390">tx</span>&nbsp;<span class="op" id="1957393">|</span>&nbsp;<span class="builtintype" id="1957395">byte</span><span class="op" id="1957399">(</span><span class="ident" id="1957400">r</span><span class="op" id="1957401">)</span><span class="op" id="1957402">&amp;</span><span class="ident" id="1957403">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957411">return</span>&nbsp;<span class="num" id="1957418">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957421">default</span><span class="op" id="1957428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957432">p</span><span class="op" id="1957433">[</span><span class="num" id="1957434">0</span><span class="op" id="1957435">]</span>&nbsp;<span class="op" id="1957437">=</span>&nbsp;<span class="ident" id="1957439">t4</span>&nbsp;<span class="op" id="1957442">|</span>&nbsp;<span class="builtintype" id="1957444">byte</span><span class="op" id="1957448">(</span><span class="ident" id="1957449">r</span><span class="op" id="1957450">&gt;&gt;</span><span class="num" id="1957452">18</span><span class="op" id="1957454">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957458">p</span><span class="op" id="1957459">[</span><span class="num" id="1957460">1</span><span class="op" id="1957461">]</span>&nbsp;<span class="op" id="1957463">=</span>&nbsp;<span class="ident" id="1957465">tx</span>&nbsp;<span class="op" id="1957468">|</span>&nbsp;<span class="builtintype" id="1957470">byte</span><span class="op" id="1957474">(</span><span class="ident" id="1957475">r</span><span class="op" id="1957476">&gt;&gt;</span><span class="num" id="1957478">12</span><span class="op" id="1957480">)</span><span class="op" id="1957481">&amp;</span><span class="ident" id="1957482">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957490">p</span><span class="op" id="1957491">[</span><span class="num" id="1957492">2</span><span class="op" id="1957493">]</span>&nbsp;<span class="op" id="1957495">=</span>&nbsp;<span class="ident" id="1957497">tx</span>&nbsp;<span class="op" id="1957500">|</span>&nbsp;<span class="builtintype" id="1957502">byte</span><span class="op" id="1957506">(</span><span class="ident" id="1957507">r</span><span class="op" id="1957508">&gt;&gt;</span><span class="num" id="1957510">6</span><span class="op" id="1957511">)</span><span class="op" id="1957512">&amp;</span><span class="ident" id="1957513">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957521">p</span><span class="op" id="1957522">[</span><span class="num" id="1957523">3</span><span class="op" id="1957524">]</span>&nbsp;<span class="op" id="1957526">=</span>&nbsp;<span class="ident" id="1957528">tx</span>&nbsp;<span class="op" id="1957531">|</span>&nbsp;<span class="builtintype" id="1957533">byte</span><span class="op" id="1957537">(</span><span class="ident" id="1957538">r</span><span class="op" id="1957539">)</span><span class="op" id="1957540">&amp;</span><span class="ident" id="1957541">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957549">return</span>&nbsp;<span class="num" id="1957556">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1957559">}</span><br>
<span class="lineno">365</span><span class="op" id="1957561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1957564">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1957632">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1957690">func</span>&nbsp;<span class="ident" id="1957695">RuneCount</span><span class="op" id="1957704">(</span><span class="ident" id="1957705">p</span>&nbsp;<span class="op" id="1957707">[</span><span class="op" id="1957708">]</span><span class="builtintype" id="1957709">byte</span><span class="op" id="1957713">)</span>&nbsp;<span class="builtintype" id="1957715">int</span>&nbsp;<span class="op" id="1957719">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957722">i</span>&nbsp;<span class="op" id="1957724">:=</span>&nbsp;<span class="num" id="1957727">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957730">var</span>&nbsp;<span class="ident" id="1957734">n</span>&nbsp;<span class="builtintype" id="1957736">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957741">for</span>&nbsp;<span class="ident" id="1957745">n</span>&nbsp;<span class="op" id="1957747">=</span>&nbsp;<span class="num" id="1957749">0</span><span class="op" id="1957750">;</span>&nbsp;<span class="ident" id="1957752">i</span>&nbsp;<span class="op" id="1957754">&lt;</span>&nbsp;<span class="builtinfunc" id="1957756">len</span><span class="op" id="1957759">(</span><span class="ident" id="1957760">p</span><span class="op" id="1957761">)</span><span class="op" id="1957762">;</span>&nbsp;<span class="ident" id="1957764">n</span><span class="op" id="1957765">++</span>&nbsp;<span class="op" id="1957768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957772">if</span>&nbsp;<span class="ident" id="1957775">p</span><span class="op" id="1957776">[</span><span class="ident" id="1957777">i</span><span class="op" id="1957778">]</span>&nbsp;<span class="op" id="1957780">&lt;</span>&nbsp;<span class="ident" id="1957782">RuneSelf</span>&nbsp;<span class="op" id="1957791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957796">i</span><span class="op" id="1957797">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1957802">}</span>&nbsp;<span class="keyword" id="1957804">else</span>&nbsp;<span class="op" id="1957809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957814">_</span><span class="op" id="1957815">,</span>&nbsp;<span class="ident" id="1957817">size</span>&nbsp;<span class="op" id="1957822">:=</span>&nbsp;<span class="ident" id="1957825">DecodeRune</span><span class="op" id="1957835">(</span><span class="ident" id="1957836">p</span><span class="op" id="1957837">[</span><span class="ident" id="1957838">i</span><span class="op" id="1957839">:</span><span class="op" id="1957840">]</span><span class="op" id="1957841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1957846">i</span>&nbsp;<span class="op" id="1957848">+=</span>&nbsp;<span class="ident" id="1957851">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1957858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1957861">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957864">return</span>&nbsp;<span class="ident" id="1957871">n</span><br>
<span class="lineno"></span><span class="op" id="1957873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1957876">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1957942">func</span>&nbsp;<span class="ident" id="1957947">RuneCountInString</span><span class="op" id="1957964">(</span><span class="ident" id="1957965">s</span>&nbsp;<span class="builtintype" id="1957967">string</span><span class="op" id="1957973">)</span>&nbsp;<span class="op" id="1957975">(</span><span class="ident" id="1957976">n</span>&nbsp;<span class="builtintype" id="1957978">int</span><span class="op" id="1957981">)</span>&nbsp;<span class="op" id="1957983">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1957986">for</span>&nbsp;<span class="keyword" id="1957990">range</span>&nbsp;<span class="ident" id="1957996">s</span>&nbsp;<span class="op" id="1957998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1958002">n</span><span class="op" id="1958003">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1958007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958010">return</span><br>
<span class="lineno"></span><span class="op" id="1958017">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1958020">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1958085">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1958154">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1958177">func</span>&nbsp;<span class="ident" id="1958182">RuneStart</span><span class="op" id="1958191">(</span><span class="ident" id="1958192">b</span>&nbsp;<span class="builtintype" id="1958194">byte</span><span class="op" id="1958198">)</span>&nbsp;<span class="builtintype" id="1958200">bool</span>&nbsp;<span class="op" id="1958205">{</span>&nbsp;<span class="keyword" id="1958207">return</span>&nbsp;<span class="ident" id="1958214">b</span><span class="op" id="1958215">&amp;</span><span class="num" id="1958216">0xC0</span>&nbsp;<span class="op" id="1958221">!=</span>&nbsp;<span class="num" id="1958224">0x80</span>&nbsp;<span class="op" id="1958229">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1958232">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1958307">func</span>&nbsp;<span class="ident" id="1958312">Valid</span><span class="op" id="1958317">(</span><span class="ident" id="1958318">p</span>&nbsp;<span class="op" id="1958320">[</span><span class="op" id="1958321">]</span><span class="builtintype" id="1958322">byte</span><span class="op" id="1958326">)</span>&nbsp;<span class="builtintype" id="1958328">bool</span>&nbsp;<span class="op" id="1958333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1958336">i</span>&nbsp;<span class="op" id="1958338">:=</span>&nbsp;<span class="num" id="1958341">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958344">for</span>&nbsp;<span class="ident" id="1958348">i</span>&nbsp;<span class="op" id="1958350">&lt;</span>&nbsp;<span class="builtinfunc" id="1958352">len</span><span class="op" id="1958355">(</span><span class="ident" id="1958356">p</span><span class="op" id="1958357">)</span>&nbsp;<span class="op" id="1958359">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958363">if</span>&nbsp;<span class="ident" id="1958366">p</span><span class="op" id="1958367">[</span><span class="ident" id="1958368">i</span><span class="op" id="1958369">]</span>&nbsp;<span class="op" id="1958371">&lt;</span>&nbsp;<span class="ident" id="1958373">RuneSelf</span>&nbsp;<span class="op" id="1958382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1958387">i</span><span class="op" id="1958388">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1958393">}</span>&nbsp;<span class="keyword" id="1958395">else</span>&nbsp;<span class="op" id="1958400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1958405">_</span><span class="op" id="1958406">,</span>&nbsp;<span class="ident" id="1958408">size</span>&nbsp;<span class="op" id="1958413">:=</span>&nbsp;<span class="ident" id="1958416">DecodeRune</span><span class="op" id="1958426">(</span><span class="ident" id="1958427">p</span><span class="op" id="1958428">[</span><span class="ident" id="1958429">i</span><span class="op" id="1958430">:</span><span class="op" id="1958431">]</span><span class="op" id="1958432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958437">if</span>&nbsp;<span class="ident" id="1958440">size</span>&nbsp;<span class="op" id="1958445">==</span>&nbsp;<span class="num" id="1958448">1</span>&nbsp;<span class="op" id="1958450">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958456">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958496">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958539">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958572">return</span>&nbsp;<span class="builtintype" id="1958579">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1958588">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1958593">i</span>&nbsp;<span class="op" id="1958595">+=</span>&nbsp;<span class="ident" id="1958598">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1958605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1958608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958611">return</span>&nbsp;<span class="builtintype" id="1958618">true</span><br>
<span class="lineno"></span><span class="op" id="1958623">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1958626">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1958707">func</span>&nbsp;<span class="ident" id="1958712">ValidString</span><span class="op" id="1958723">(</span><span class="ident" id="1958724">s</span>&nbsp;<span class="builtintype" id="1958726">string</span><span class="op" id="1958732">)</span>&nbsp;<span class="builtintype" id="1958734">bool</span>&nbsp;<span class="op" id="1958739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958742">for</span>&nbsp;<span class="ident" id="1958746">i</span><span class="op" id="1958747">,</span>&nbsp;<span class="ident" id="1958749">r</span>&nbsp;<span class="op" id="1958751">:=</span>&nbsp;<span class="keyword" id="1958754">range</span>&nbsp;<span class="ident" id="1958760">s</span>&nbsp;<span class="op" id="1958762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1958766">if</span>&nbsp;<span class="ident" id="1958769">r</span>&nbsp;<span class="op" id="1958771">==</span>&nbsp;<span class="ident" id="1958774">RuneError</span>&nbsp;<span class="op" id="1958784">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958789">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958831">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958881">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1958931">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1958969">_</span><span class="op" id="1958970">,</span>&nbsp;<span class="ident" id="1958972">size</span>&nbsp;<span class="op" id="1958977">:=</span>&nbsp;<span class="ident" id="1958980">DecodeRuneInString</span><span class="op" id="1958998">(</span><span class="ident" id="1958999">s</span><span class="op" id="1959000">[</span><span class="ident" id="1959001">i</span><span class="op" id="1959002">:</span><span class="op" id="1959003">]</span><span class="op" id="1959004">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959009">if</span>&nbsp;<span class="ident" id="1959012">size</span>&nbsp;<span class="op" id="1959017">==</span>&nbsp;<span class="num" id="1959020">1</span>&nbsp;<span class="op" id="1959022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959028">return</span>&nbsp;<span class="builtintype" id="1959035">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1959044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1959048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1959051">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959054">return</span>&nbsp;<span class="builtintype" id="1959061">true</span><br>
<span class="lineno"></span><span class="op" id="1959066">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1959069">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1959133">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1959203">func</span>&nbsp;<span class="ident" id="1959208">ValidRune</span><span class="op" id="1959217">(</span><span class="ident" id="1959218">r</span>&nbsp;<span class="builtintype" id="1959220">rune</span><span class="op" id="1959224">)</span>&nbsp;<span class="builtintype" id="1959226">bool</span>&nbsp;<span class="op" id="1959231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959234">switch</span>&nbsp;<span class="op" id="1959241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959244">case</span>&nbsp;<span class="ident" id="1959249">r</span>&nbsp;<span class="op" id="1959251">&lt;</span>&nbsp;<span class="num" id="1959253">0</span><span class="op" id="1959254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959258">return</span>&nbsp;<span class="builtintype" id="1959265">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959272">case</span>&nbsp;<span class="ident" id="1959277">surrogateMin</span>&nbsp;<span class="op" id="1959290">&lt;=</span>&nbsp;<span class="ident" id="1959293">r</span>&nbsp;<span class="op" id="1959295">&amp;&amp;</span>&nbsp;<span class="ident" id="1959298">r</span>&nbsp;<span class="op" id="1959300">&lt;=</span>&nbsp;<span class="ident" id="1959303">surrogateMax</span><span class="op" id="1959315">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959319">return</span>&nbsp;<span class="builtintype" id="1959326">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959333">case</span>&nbsp;<span class="ident" id="1959338">r</span>&nbsp;<span class="op" id="1959340">&gt;</span>&nbsp;<span class="ident" id="1959342">MaxRune</span><span class="op" id="1959349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959353">return</span>&nbsp;<span class="builtintype" id="1959360">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1959367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1959370">return</span>&nbsp;<span class="builtintype" id="1959377">true</span><br>
<span class="lineno">445</span><span class="op" id="1959382">}</span>
</div>
</body>
</html>
