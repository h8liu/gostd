<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html" class="current">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1610831">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1610886">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1610940">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1610991">package</span>&nbsp;<span class="ident" id="1610999">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611008">import</span>&nbsp;<span class="string" id="1611015">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611025">var</span>&nbsp;<span class="ident" id="1611029">indexError</span>&nbsp;<span class="op" id="1611040">=</span>&nbsp;<span class="builtintype" id="1611042">error</span><span class="op" id="1611047">(</span><span class="ident" id="1611048">errorString</span><span class="op" id="1611059">(</span><span class="string" id="1611060">&#34;index&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1611080">)</span><span class="op" id="1611081">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1611084">func</span>&nbsp;<span class="ident" id="1611089">panicindex</span><span class="op" id="1611099">(</span><span class="op" id="1611100">)</span>&nbsp;<span class="op" id="1611102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1611105">panic</span><span class="op" id="1611110">(</span><span class="ident" id="1611111">indexError</span><span class="op" id="1611121">)</span><br>
<span class="lineno"></span><span class="op" id="1611123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="1611126">var</span>&nbsp;<span class="ident" id="1611130">sliceError</span>&nbsp;<span class="op" id="1611141">=</span>&nbsp;<span class="builtintype" id="1611143">error</span><span class="op" id="1611148">(</span><span class="ident" id="1611149">errorString</span><span class="op" id="1611160">(</span><span class="string" id="1611161">&#34;slice&nbsp;bounds&nbsp;out&nbsp;of&nbsp;range&#34;</span><span class="op" id="1611188">)</span><span class="op" id="1611189">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611192">func</span>&nbsp;<span class="ident" id="1611197">panicslice</span><span class="op" id="1611207">(</span><span class="op" id="1611208">)</span>&nbsp;<span class="op" id="1611210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1611213">panic</span><span class="op" id="1611218">(</span><span class="ident" id="1611219">sliceError</span><span class="op" id="1611229">)</span><br>
<span class="lineno"></span><span class="op" id="1611231">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="1611234">var</span>&nbsp;<span class="ident" id="1611238">divideError</span>&nbsp;<span class="op" id="1611250">=</span>&nbsp;<span class="builtintype" id="1611252">error</span><span class="op" id="1611257">(</span><span class="ident" id="1611258">errorString</span><span class="op" id="1611269">(</span><span class="string" id="1611270">&#34;integer&nbsp;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="1611294">)</span><span class="op" id="1611295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611298">func</span>&nbsp;<span class="ident" id="1611303">panicdivide</span><span class="op" id="1611314">(</span><span class="op" id="1611315">)</span>&nbsp;<span class="op" id="1611317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1611320">panic</span><span class="op" id="1611325">(</span><span class="ident" id="1611326">divideError</span><span class="op" id="1611337">)</span><br>
<span class="lineno">25</span><span class="op" id="1611339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611342">var</span>&nbsp;<span class="ident" id="1611346">overflowError</span>&nbsp;<span class="op" id="1611360">=</span>&nbsp;<span class="builtintype" id="1611362">error</span><span class="op" id="1611367">(</span><span class="ident" id="1611368">errorString</span><span class="op" id="1611379">(</span><span class="string" id="1611380">&#34;integer&nbsp;overflow&#34;</span><span class="op" id="1611398">)</span><span class="op" id="1611399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611402">func</span>&nbsp;<span class="ident" id="1611407">panicoverflow</span><span class="op" id="1611420">(</span><span class="op" id="1611421">)</span>&nbsp;<span class="op" id="1611423">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1611426">panic</span><span class="op" id="1611431">(</span><span class="ident" id="1611432">overflowError</span><span class="op" id="1611445">)</span><br>
<span class="lineno"></span><span class="op" id="1611447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611450">var</span>&nbsp;<span class="ident" id="1611454">floatError</span>&nbsp;<span class="op" id="1611465">=</span>&nbsp;<span class="builtintype" id="1611467">error</span><span class="op" id="1611472">(</span><span class="ident" id="1611473">errorString</span><span class="op" id="1611484">(</span><span class="string" id="1611485">&#34;floating&nbsp;point&nbsp;error&#34;</span><span class="op" id="1611507">)</span><span class="op" id="1611508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="1611511">func</span>&nbsp;<span class="ident" id="1611516">panicfloat</span><span class="op" id="1611526">(</span><span class="op" id="1611527">)</span>&nbsp;<span class="op" id="1611529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1611532">panic</span><span class="op" id="1611537">(</span><span class="ident" id="1611538">floatError</span><span class="op" id="1611548">)</span><br>
<span class="lineno"></span><span class="op" id="1611550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611553">var</span>&nbsp;<span class="ident" id="1611557">memoryError</span>&nbsp;<span class="op" id="1611569">=</span>&nbsp;<span class="builtintype" id="1611571">error</span><span class="op" id="1611576">(</span><span class="ident" id="1611577">errorString</span><span class="op" id="1611588">(</span><span class="string" id="1611589">&#34;invalid&nbsp;memory&nbsp;address&nbsp;or&nbsp;nil&nbsp;pointer&nbsp;dereference&#34;</span><span class="op" id="1611640">)</span><span class="op" id="1611641">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1611644">func</span>&nbsp;<span class="ident" id="1611649">panicmem</span><span class="op" id="1611657">(</span><span class="op" id="1611658">)</span>&nbsp;<span class="op" id="1611660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1611663">panic</span><span class="op" id="1611668">(</span><span class="ident" id="1611669">memoryError</span><span class="op" id="1611680">)</span><br>
<span class="lineno"></span><span class="op" id="1611682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1611685">func</span>&nbsp;<span class="ident" id="1611690">throwreturn</span><span class="op" id="1611701">(</span><span class="op" id="1611702">)</span>&nbsp;<span class="op" id="1611704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611707">gothrow</span><span class="op" id="1611714">(</span><span class="string" id="1611715">&#34;no&nbsp;return&nbsp;at&nbsp;end&nbsp;of&nbsp;a&nbsp;typed&nbsp;function&nbsp;-&nbsp;compiler&nbsp;is&nbsp;broken&#34;</span><span class="op" id="1611774">)</span><br>
<span class="lineno"></span><span class="op" id="1611776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1611779">func</span>&nbsp;<span class="ident" id="1611784">throwinit</span><span class="op" id="1611793">(</span><span class="op" id="1611794">)</span>&nbsp;<span class="op" id="1611796">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1611799">gothrow</span><span class="op" id="1611806">(</span><span class="string" id="1611807">&#34;recursive&nbsp;call&nbsp;during&nbsp;initialization&nbsp;-&nbsp;linker&nbsp;skew&#34;</span><span class="op" id="1611859">)</span><br>
<span class="lineno"></span><span class="op" id="1611861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1611864">//&nbsp;Create&nbsp;a&nbsp;new&nbsp;deferred&nbsp;function&nbsp;fn&nbsp;with&nbsp;siz&nbsp;bytes&nbsp;of&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1611930">//&nbsp;The&nbsp;compiler&nbsp;turns&nbsp;a&nbsp;defer&nbsp;statement&nbsp;into&nbsp;a&nbsp;call&nbsp;to&nbsp;this.</span><br>
<span class="lineno">55</span><span class="comment" id="1611991">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1612004">func</span>&nbsp;<span class="ident" id="1612009">deferproc</span><span class="op" id="1612018">(</span><span class="ident" id="1612019">siz</span>&nbsp;<span class="builtintype" id="1612023">int32</span><span class="op" id="1612028">,</span>&nbsp;<span class="ident" id="1612030">fn</span>&nbsp;<span class="op" id="1612033">*</span><span class="ident" id="1612034">funcval</span><span class="op" id="1612041">)</span>&nbsp;<span class="op" id="1612043">{</span>&nbsp;<span class="comment" id="1612045">//&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;follow&nbsp;fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612075">//&nbsp;the&nbsp;arguments&nbsp;of&nbsp;fn&nbsp;are&nbsp;in&nbsp;a&nbsp;perilous&nbsp;state.&nbsp;&nbsp;The&nbsp;stack&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612139">//&nbsp;for&nbsp;deferproc&nbsp;does&nbsp;not&nbsp;describe&nbsp;them.&nbsp;&nbsp;So&nbsp;we&nbsp;can&#39;t&nbsp;let&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612206">//&nbsp;collection&nbsp;or&nbsp;stack&nbsp;copying&nbsp;trigger&nbsp;until&nbsp;we&#39;ve&nbsp;copied&nbsp;them&nbsp;out</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612274">//&nbsp;to&nbsp;somewhere&nbsp;safe.&nbsp;&nbsp;deferproc_m&nbsp;does&nbsp;that.&nbsp;&nbsp;Until&nbsp;deferproc_m,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612341">//&nbsp;we&nbsp;can&nbsp;only&nbsp;call&nbsp;nosplit&nbsp;routines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612380">argp</span>&nbsp;<span class="op" id="1612385">:=</span>&nbsp;<span class="builtintype" id="1612388">uintptr</span><span class="op" id="1612395">(</span><span class="ident" id="1612396">unsafe</span><span class="op" id="1612402">.</span><span class="ident" id="1612403">Pointer</span><span class="op" id="1612410">(</span><span class="op" id="1612411">&amp;</span><span class="ident" id="1612412">fn</span><span class="op" id="1612414">)</span><span class="op" id="1612415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612418">argp</span>&nbsp;<span class="op" id="1612423">+=</span>&nbsp;<span class="ident" id="1612426">unsafe</span><span class="op" id="1612432">.</span><span class="ident" id="1612433">Sizeof</span><span class="op" id="1612439">(</span><span class="ident" id="1612440">fn</span><span class="op" id="1612442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612445">if</span>&nbsp;<span class="ident" id="1612448">GOARCH</span>&nbsp;<span class="op" id="1612455">==</span>&nbsp;<span class="string" id="1612458">&#34;arm&#34;</span>&nbsp;<span class="op" id="1612464">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612468">argp</span>&nbsp;<span class="op" id="1612473">+=</span>&nbsp;<span class="ident" id="1612476">ptrSize</span>&nbsp;<span class="comment" id="1612484">//&nbsp;skip&nbsp;caller&#39;s&nbsp;saved&nbsp;link&nbsp;register</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612525">mp</span>&nbsp;<span class="op" id="1612528">:=</span>&nbsp;<span class="ident" id="1612531">acquirem</span><span class="op" id="1612539">(</span><span class="op" id="1612540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612543">mp</span><span class="op" id="1612545">.</span><span class="ident" id="1612546">scalararg</span><span class="op" id="1612555">[</span><span class="num" id="1612556">0</span><span class="op" id="1612557">]</span>&nbsp;<span class="op" id="1612559">=</span>&nbsp;<span class="builtintype" id="1612561">uintptr</span><span class="op" id="1612568">(</span><span class="ident" id="1612569">siz</span><span class="op" id="1612572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612575">mp</span><span class="op" id="1612577">.</span><span class="ident" id="1612578">ptrarg</span><span class="op" id="1612584">[</span><span class="num" id="1612585">0</span><span class="op" id="1612586">]</span>&nbsp;<span class="op" id="1612588">=</span>&nbsp;<span class="ident" id="1612590">unsafe</span><span class="op" id="1612596">.</span><span class="ident" id="1612597">Pointer</span><span class="op" id="1612604">(</span><span class="ident" id="1612605">fn</span><span class="op" id="1612607">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612610">mp</span><span class="op" id="1612612">.</span><span class="ident" id="1612613">scalararg</span><span class="op" id="1612622">[</span><span class="num" id="1612623">1</span><span class="op" id="1612624">]</span>&nbsp;<span class="op" id="1612626">=</span>&nbsp;<span class="ident" id="1612628">argp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612634">mp</span><span class="op" id="1612636">.</span><span class="ident" id="1612637">scalararg</span><span class="op" id="1612646">[</span><span class="num" id="1612647">2</span><span class="op" id="1612648">]</span>&nbsp;<span class="op" id="1612650">=</span>&nbsp;<span class="ident" id="1612652">getcallerpc</span><span class="op" id="1612663">(</span><span class="ident" id="1612664">unsafe</span><span class="op" id="1612670">.</span><span class="ident" id="1612671">Pointer</span><span class="op" id="1612678">(</span><span class="op" id="1612679">&amp;</span><span class="ident" id="1612680">siz</span><span class="op" id="1612683">)</span><span class="op" id="1612684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1612688">if</span>&nbsp;<span class="ident" id="1612691">mp</span><span class="op" id="1612693">.</span><span class="ident" id="1612694">curg</span>&nbsp;<span class="op" id="1612699">!=</span>&nbsp;<span class="ident" id="1612702">getg</span><span class="op" id="1612706">(</span><span class="op" id="1612707">)</span>&nbsp;<span class="op" id="1612709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612713">//&nbsp;go&nbsp;code&nbsp;on&nbsp;the&nbsp;m&nbsp;stack&nbsp;can&#39;t&nbsp;defer</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612753">gothrow</span><span class="op" id="1612760">(</span><span class="string" id="1612761">&#34;defer&nbsp;on&nbsp;m&#34;</span><span class="op" id="1612773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1612776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612780">onM</span><span class="op" id="1612783">(</span><span class="ident" id="1612784">deferproc_m</span><span class="op" id="1612795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1612799">releasem</span><span class="op" id="1612807">(</span><span class="ident" id="1612808">mp</span><span class="op" id="1612810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612814">//&nbsp;deferproc&nbsp;returns&nbsp;0&nbsp;normally.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612848">//&nbsp;a&nbsp;deferred&nbsp;func&nbsp;that&nbsp;stops&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612887">//&nbsp;makes&nbsp;the&nbsp;deferproc&nbsp;return&nbsp;1.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612921">//&nbsp;the&nbsp;code&nbsp;the&nbsp;compiler&nbsp;generates&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1612964">//&nbsp;checks&nbsp;the&nbsp;return&nbsp;value&nbsp;and&nbsp;jumps&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1613009">//&nbsp;end&nbsp;of&nbsp;the&nbsp;function&nbsp;if&nbsp;deferproc&nbsp;returns&nbsp;!=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1613060">return0</span><span class="op" id="1613067">(</span><span class="op" id="1613068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1613071">//&nbsp;No&nbsp;code&nbsp;can&nbsp;go&nbsp;here&nbsp;-&nbsp;the&nbsp;C&nbsp;return&nbsp;register&nbsp;has</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1613123">//&nbsp;been&nbsp;set&nbsp;and&nbsp;must&nbsp;not&nbsp;be&nbsp;clobbered.</span><br>
<span class="lineno"></span><span class="op" id="1613162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1613165">//&nbsp;Small&nbsp;malloc&nbsp;size&nbsp;classes&nbsp;&gt;=&nbsp;16&nbsp;are&nbsp;the&nbsp;multiples&nbsp;of&nbsp;16:&nbsp;16,&nbsp;32,&nbsp;48,&nbsp;64,&nbsp;80,&nbsp;96,&nbsp;112,&nbsp;128,&nbsp;144,&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="1613268">//&nbsp;Each&nbsp;P&nbsp;holds&nbsp;a&nbsp;pool&nbsp;for&nbsp;defers&nbsp;with&nbsp;small&nbsp;arg&nbsp;sizes.</span><br>
<span class="lineno">95</span><span class="comment" id="1613324">//&nbsp;Assign&nbsp;defer&nbsp;allocations&nbsp;to&nbsp;pools&nbsp;by&nbsp;rounding&nbsp;to&nbsp;16,&nbsp;to&nbsp;match&nbsp;malloc&nbsp;size&nbsp;classes.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1613411">const</span>&nbsp;<span class="op" id="1613417">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1613420">deferHeaderSize</span>&nbsp;<span class="op" id="1613436">=</span>&nbsp;<span class="ident" id="1613438">unsafe</span><span class="op" id="1613444">.</span><span class="ident" id="1613445">Sizeof</span><span class="op" id="1613451">(</span><span class="ident" id="1613452">_defer</span><span class="op" id="1613458">{</span><span class="op" id="1613459">}</span><span class="op" id="1613460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1613463">minDeferAlloc</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1613479">=</span>&nbsp;<span class="op" id="1613481">(</span><span class="ident" id="1613482">deferHeaderSize</span>&nbsp;<span class="op" id="1613498">+</span>&nbsp;<span class="num" id="1613500">15</span><span class="op" id="1613502">)</span>&nbsp;<span class="op" id="1613504">&amp;^</span>&nbsp;<span class="num" id="1613507">15</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1613511">minDeferArgs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1613527">=</span>&nbsp;<span class="ident" id="1613529">minDeferAlloc</span>&nbsp;<span class="op" id="1613543">-</span>&nbsp;<span class="ident" id="1613545">deferHeaderSize</span><br>
<span class="lineno"></span><span class="op" id="1613561">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1613564">//&nbsp;defer&nbsp;size&nbsp;class&nbsp;for&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="comment" id="1613600">//go:nosplit</span><br>
<span class="lineno">105</span><span class="keyword" id="1613613">func</span>&nbsp;<span class="ident" id="1613618">deferclass</span><span class="op" id="1613628">(</span><span class="ident" id="1613629">siz</span>&nbsp;<span class="builtintype" id="1613633">uintptr</span><span class="op" id="1613640">)</span>&nbsp;<span class="builtintype" id="1613642">uintptr</span>&nbsp;<span class="op" id="1613650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613653">if</span>&nbsp;<span class="ident" id="1613656">siz</span>&nbsp;<span class="op" id="1613660">&lt;=</span>&nbsp;<span class="ident" id="1613663">minDeferArgs</span>&nbsp;<span class="op" id="1613676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613680">return</span>&nbsp;<span class="num" id="1613687">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1613690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613693">return</span>&nbsp;<span class="op" id="1613700">(</span><span class="ident" id="1613701">siz</span>&nbsp;<span class="op" id="1613705">-</span>&nbsp;<span class="ident" id="1613707">minDeferArgs</span>&nbsp;<span class="op" id="1613720">+</span>&nbsp;<span class="num" id="1613722">15</span><span class="op" id="1613724">)</span>&nbsp;<span class="op" id="1613726">/</span>&nbsp;<span class="num" id="1613728">16</span><br>
<span class="lineno">110</span><span class="op" id="1613731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1613734">//&nbsp;total&nbsp;size&nbsp;of&nbsp;memory&nbsp;block&nbsp;for&nbsp;defer&nbsp;with&nbsp;arg&nbsp;size&nbsp;sz</span><br>
<span class="lineno"></span><span class="keyword" id="1613791">func</span>&nbsp;<span class="ident" id="1613796">totaldefersize</span><span class="op" id="1613810">(</span><span class="ident" id="1613811">siz</span>&nbsp;<span class="builtintype" id="1613815">uintptr</span><span class="op" id="1613822">)</span>&nbsp;<span class="builtintype" id="1613824">uintptr</span>&nbsp;<span class="op" id="1613832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613835">if</span>&nbsp;<span class="ident" id="1613838">siz</span>&nbsp;<span class="op" id="1613842">&lt;=</span>&nbsp;<span class="ident" id="1613845">minDeferArgs</span>&nbsp;<span class="op" id="1613858">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613862">return</span>&nbsp;<span class="ident" id="1613869">minDeferAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1613884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1613887">return</span>&nbsp;<span class="ident" id="1613894">deferHeaderSize</span>&nbsp;<span class="op" id="1613910">+</span>&nbsp;<span class="ident" id="1613912">siz</span><br>
<span class="lineno"></span><span class="op" id="1613916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="1613919">//&nbsp;Ensure&nbsp;that&nbsp;defer&nbsp;arg&nbsp;sizes&nbsp;that&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;defer&nbsp;size&nbsp;class</span><br>
<span class="lineno"></span><span class="comment" id="1613988">//&nbsp;also&nbsp;map&nbsp;to&nbsp;the&nbsp;same&nbsp;malloc&nbsp;size&nbsp;class.</span><br>
<span class="lineno"></span><span class="keyword" id="1614031">func</span>&nbsp;<span class="ident" id="1614036">testdefersizes</span><span class="op" id="1614050">(</span><span class="op" id="1614051">)</span>&nbsp;<span class="op" id="1614053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614056">var</span>&nbsp;<span class="ident" id="1614060">m</span>&nbsp;<span class="op" id="1614062">[</span><span class="builtinfunc" id="1614063">len</span><span class="op" id="1614066">(</span><span class="ident" id="1614067">p</span><span class="op" id="1614068">{</span><span class="op" id="1614069">}</span><span class="op" id="1614070">.</span><span class="ident" id="1614071">deferpool</span><span class="op" id="1614080">)</span><span class="op" id="1614081">]</span><span class="builtintype" id="1614082">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614090">for</span>&nbsp;<span class="ident" id="1614094">i</span>&nbsp;<span class="op" id="1614096">:=</span>&nbsp;<span class="keyword" id="1614099">range</span>&nbsp;<span class="ident" id="1614105">m</span>&nbsp;<span class="op" id="1614107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614111">m</span><span class="op" id="1614112">[</span><span class="ident" id="1614113">i</span><span class="op" id="1614114">]</span>&nbsp;<span class="op" id="1614116">=</span>&nbsp;<span class="op" id="1614118">-</span><span class="num" id="1614119">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614125">for</span>&nbsp;<span class="ident" id="1614129">i</span>&nbsp;<span class="op" id="1614131">:=</span>&nbsp;<span class="builtintype" id="1614134">uintptr</span><span class="op" id="1614141">(</span><span class="num" id="1614142">0</span><span class="op" id="1614143">)</span><span class="op" id="1614144">;</span>&nbsp;<span class="op" id="1614146">;</span>&nbsp;<span class="ident" id="1614148">i</span><span class="op" id="1614149">++</span>&nbsp;<span class="op" id="1614152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614156">defersc</span>&nbsp;<span class="op" id="1614164">:=</span>&nbsp;<span class="ident" id="1614167">deferclass</span><span class="op" id="1614177">(</span><span class="ident" id="1614178">i</span><span class="op" id="1614179">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614183">if</span>&nbsp;<span class="ident" id="1614186">defersc</span>&nbsp;<span class="op" id="1614194">&gt;=</span>&nbsp;<span class="builtintype" id="1614197">uintptr</span><span class="op" id="1614204">(</span><span class="builtinfunc" id="1614205">len</span><span class="op" id="1614208">(</span><span class="ident" id="1614209">m</span><span class="op" id="1614210">)</span><span class="op" id="1614211">)</span>&nbsp;<span class="op" id="1614213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614218">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614230">siz</span>&nbsp;<span class="op" id="1614234">:=</span>&nbsp;<span class="ident" id="1614237">goroundupsize</span><span class="op" id="1614250">(</span><span class="ident" id="1614251">totaldefersize</span><span class="op" id="1614265">(</span><span class="ident" id="1614266">i</span><span class="op" id="1614267">)</span><span class="op" id="1614268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614272">if</span>&nbsp;<span class="ident" id="1614275">m</span><span class="op" id="1614276">[</span><span class="ident" id="1614277">defersc</span><span class="op" id="1614284">]</span>&nbsp;<span class="op" id="1614286">&lt;</span>&nbsp;<span class="num" id="1614288">0</span>&nbsp;<span class="op" id="1614290">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614295">m</span><span class="op" id="1614296">[</span><span class="ident" id="1614297">defersc</span><span class="op" id="1614304">]</span>&nbsp;<span class="op" id="1614306">=</span>&nbsp;<span class="builtintype" id="1614308">int32</span><span class="op" id="1614313">(</span><span class="ident" id="1614314">siz</span><span class="op" id="1614317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614322">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614337">if</span>&nbsp;<span class="ident" id="1614340">m</span><span class="op" id="1614341">[</span><span class="ident" id="1614342">defersc</span><span class="op" id="1614349">]</span>&nbsp;<span class="op" id="1614351">!=</span>&nbsp;<span class="builtintype" id="1614354">int32</span><span class="op" id="1614359">(</span><span class="ident" id="1614360">siz</span><span class="op" id="1614363">)</span>&nbsp;<span class="op" id="1614365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1614370">print</span><span class="op" id="1614375">(</span><span class="string" id="1614376">&#34;bad&nbsp;defer&nbsp;size&nbsp;class:&nbsp;i=&#34;</span><span class="op" id="1614402">,</span>&nbsp;<span class="ident" id="1614404">i</span><span class="op" id="1614405">,</span>&nbsp;<span class="string" id="1614407">&#34;&nbsp;siz=&#34;</span><span class="op" id="1614414">,</span>&nbsp;<span class="ident" id="1614416">siz</span><span class="op" id="1614419">,</span>&nbsp;<span class="string" id="1614421">&#34;&nbsp;defersc=&#34;</span><span class="op" id="1614432">,</span>&nbsp;<span class="ident" id="1614434">defersc</span><span class="op" id="1614441">,</span>&nbsp;<span class="string" id="1614443">&#34;\n&#34;</span><span class="op" id="1614447">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614452">gothrow</span><span class="op" id="1614459">(</span><span class="string" id="1614460">&#34;bad&nbsp;defer&nbsp;size&nbsp;class&#34;</span><span class="op" id="1614482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1614489">}</span><br>
<span class="lineno"></span><span class="op" id="1614491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="1614494">//&nbsp;The&nbsp;arguments&nbsp;associated&nbsp;with&nbsp;a&nbsp;deferred&nbsp;call&nbsp;are&nbsp;stored</span><br>
<span class="lineno"></span><span class="comment" id="1614554">//&nbsp;immediately&nbsp;after&nbsp;the&nbsp;_defer&nbsp;header&nbsp;in&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1614604">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1614617">func</span>&nbsp;<span class="ident" id="1614622">deferArgs</span><span class="op" id="1614631">(</span><span class="ident" id="1614632">d</span>&nbsp;<span class="op" id="1614634">*</span><span class="ident" id="1614635">_defer</span><span class="op" id="1614641">)</span>&nbsp;<span class="ident" id="1614643">unsafe</span><span class="op" id="1614649">.</span><span class="ident" id="1614650">Pointer</span>&nbsp;<span class="op" id="1614658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614661">return</span>&nbsp;<span class="ident" id="1614668">add</span><span class="op" id="1614671">(</span><span class="ident" id="1614672">unsafe</span><span class="op" id="1614678">.</span><span class="ident" id="1614679">Pointer</span><span class="op" id="1614686">(</span><span class="ident" id="1614687">d</span><span class="op" id="1614688">)</span><span class="op" id="1614689">,</span>&nbsp;<span class="ident" id="1614691">unsafe</span><span class="op" id="1614697">.</span><span class="ident" id="1614698">Sizeof</span><span class="op" id="1614704">(</span><span class="op" id="1614705">*</span><span class="ident" id="1614706">d</span><span class="op" id="1614707">)</span><span class="op" id="1614708">)</span><br>
<span class="lineno">150</span><span class="op" id="1614710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1614713">var</span>&nbsp;<span class="ident" id="1614717">deferType</span>&nbsp;<span class="op" id="1614727">*</span><span class="ident" id="1614728">_type</span>&nbsp;<span class="comment" id="1614734">//&nbsp;type&nbsp;of&nbsp;_defer&nbsp;struct</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1614760">func</span>&nbsp;<span class="ident" id="1614765">init</span><span class="op" id="1614769">(</span><span class="op" id="1614770">)</span>&nbsp;<span class="op" id="1614772">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1614775">var</span>&nbsp;<span class="ident" id="1614779">x</span>&nbsp;<span class="keyword" id="1614781">interface</span><span class="op" id="1614790">{</span><span class="op" id="1614791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614794">x</span>&nbsp;<span class="op" id="1614796">=</span>&nbsp;<span class="op" id="1614798">(</span><span class="op" id="1614799">*</span><span class="ident" id="1614800">_defer</span><span class="op" id="1614806">)</span><span class="op" id="1614807">(</span><span class="builtintype" id="1614808">nil</span><span class="op" id="1614811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1614814">deferType</span>&nbsp;<span class="op" id="1614824">=</span>&nbsp;<span class="op" id="1614826">(</span><span class="op" id="1614827">*</span><span class="op" id="1614828">(</span><span class="op" id="1614829">*</span><span class="op" id="1614830">*</span><span class="ident" id="1614831">ptrtype</span><span class="op" id="1614838">)</span><span class="op" id="1614839">(</span><span class="ident" id="1614840">unsafe</span><span class="op" id="1614846">.</span><span class="ident" id="1614847">Pointer</span><span class="op" id="1614854">(</span><span class="op" id="1614855">&amp;</span><span class="ident" id="1614856">x</span><span class="op" id="1614857">)</span><span class="op" id="1614858">)</span><span class="op" id="1614859">)</span><span class="op" id="1614860">.</span><span class="ident" id="1614861">elem</span><br>
<span class="lineno"></span><span class="op" id="1614866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="1614869">//&nbsp;Allocate&nbsp;a&nbsp;Defer,&nbsp;usually&nbsp;using&nbsp;per-P&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="1614916">//&nbsp;Each&nbsp;defer&nbsp;must&nbsp;be&nbsp;released&nbsp;with&nbsp;freedefer.</span><br>
<span class="lineno"></span><span class="comment" id="1614963">//&nbsp;Note:&nbsp;runs&nbsp;on&nbsp;M&nbsp;stack</span><br>
<span class="lineno"></span><span class="keyword" id="1614988">func</span>&nbsp;<span class="ident" id="1614993">newdefer</span><span class="op" id="1615001">(</span><span class="ident" id="1615002">siz</span>&nbsp;<span class="builtintype" id="1615006">int32</span><span class="op" id="1615011">)</span>&nbsp;<span class="op" id="1615013">*</span><span class="ident" id="1615014">_defer</span>&nbsp;<span class="op" id="1615021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615024">var</span>&nbsp;<span class="ident" id="1615028">d</span>&nbsp;<span class="op" id="1615030">*</span><span class="ident" id="1615031">_defer</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615039">sc</span>&nbsp;<span class="op" id="1615042">:=</span>&nbsp;<span class="ident" id="1615045">deferclass</span><span class="op" id="1615055">(</span><span class="builtintype" id="1615056">uintptr</span><span class="op" id="1615063">(</span><span class="ident" id="1615064">siz</span><span class="op" id="1615067">)</span><span class="op" id="1615068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615071">mp</span>&nbsp;<span class="op" id="1615074">:=</span>&nbsp;<span class="ident" id="1615077">acquirem</span><span class="op" id="1615085">(</span><span class="op" id="1615086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615089">if</span>&nbsp;<span class="ident" id="1615092">sc</span>&nbsp;<span class="op" id="1615095">&lt;</span>&nbsp;<span class="builtintype" id="1615097">uintptr</span><span class="op" id="1615104">(</span><span class="builtinfunc" id="1615105">len</span><span class="op" id="1615108">(</span><span class="ident" id="1615109">p</span><span class="op" id="1615110">{</span><span class="op" id="1615111">}</span><span class="op" id="1615112">.</span><span class="ident" id="1615113">deferpool</span><span class="op" id="1615122">)</span><span class="op" id="1615123">)</span>&nbsp;<span class="op" id="1615125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615129">pp</span>&nbsp;<span class="op" id="1615132">:=</span>&nbsp;<span class="ident" id="1615135">mp</span><span class="op" id="1615137">.</span><span class="ident" id="1615138">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615142">d</span>&nbsp;<span class="op" id="1615144">=</span>&nbsp;<span class="ident" id="1615146">pp</span><span class="op" id="1615148">.</span><span class="ident" id="1615149">deferpool</span><span class="op" id="1615158">[</span><span class="ident" id="1615159">sc</span><span class="op" id="1615161">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615165">if</span>&nbsp;<span class="ident" id="1615168">d</span>&nbsp;<span class="op" id="1615170">!=</span>&nbsp;<span class="builtintype" id="1615173">nil</span>&nbsp;<span class="op" id="1615177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615182">pp</span><span class="op" id="1615184">.</span><span class="ident" id="1615185">deferpool</span><span class="op" id="1615194">[</span><span class="ident" id="1615195">sc</span><span class="op" id="1615197">]</span>&nbsp;<span class="op" id="1615199">=</span>&nbsp;<span class="ident" id="1615201">d</span><span class="op" id="1615202">.</span><span class="ident" id="1615203">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615216">if</span>&nbsp;<span class="ident" id="1615219">d</span>&nbsp;<span class="op" id="1615221">==</span>&nbsp;<span class="builtintype" id="1615224">nil</span>&nbsp;<span class="op" id="1615228">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1615232">//&nbsp;Allocate&nbsp;new&nbsp;defer+args.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615262">total</span>&nbsp;<span class="op" id="1615268">:=</span>&nbsp;<span class="ident" id="1615271">goroundupsize</span><span class="op" id="1615284">(</span><span class="ident" id="1615285">totaldefersize</span><span class="op" id="1615299">(</span><span class="builtintype" id="1615300">uintptr</span><span class="op" id="1615307">(</span><span class="ident" id="1615308">siz</span><span class="op" id="1615311">)</span><span class="op" id="1615312">)</span><span class="op" id="1615313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615317">d</span>&nbsp;<span class="op" id="1615319">=</span>&nbsp;<span class="op" id="1615321">(</span><span class="op" id="1615322">*</span><span class="ident" id="1615323">_defer</span><span class="op" id="1615329">)</span><span class="op" id="1615330">(</span><span class="ident" id="1615331">mallocgc</span><span class="op" id="1615339">(</span><span class="ident" id="1615340">total</span><span class="op" id="1615345">,</span>&nbsp;<span class="ident" id="1615347">deferType</span><span class="op" id="1615356">,</span>&nbsp;<span class="num" id="1615358">0</span><span class="op" id="1615359">)</span><span class="op" id="1615360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615366">d</span><span class="op" id="1615367">.</span><span class="ident" id="1615368">siz</span>&nbsp;<span class="op" id="1615372">=</span>&nbsp;<span class="ident" id="1615374">siz</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615379">gp</span>&nbsp;<span class="op" id="1615382">:=</span>&nbsp;<span class="ident" id="1615385">mp</span><span class="op" id="1615387">.</span><span class="ident" id="1615388">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615394">d</span><span class="op" id="1615395">.</span><span class="ident" id="1615396">link</span>&nbsp;<span class="op" id="1615401">=</span>&nbsp;<span class="ident" id="1615403">gp</span><span class="op" id="1615405">.</span><span class="ident" id="1615406">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615414">gp</span><span class="op" id="1615416">.</span><span class="ident" id="1615417">_defer</span>&nbsp;<span class="op" id="1615424">=</span>&nbsp;<span class="ident" id="1615426">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615429">releasem</span><span class="op" id="1615437">(</span><span class="ident" id="1615438">mp</span><span class="op" id="1615440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615443">return</span>&nbsp;<span class="ident" id="1615450">d</span><br>
<span class="lineno">185</span><span class="op" id="1615452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1615455">//&nbsp;Free&nbsp;the&nbsp;given&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1615480">//&nbsp;The&nbsp;defer&nbsp;cannot&nbsp;be&nbsp;used&nbsp;after&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span><span class="comment" id="1615525">//go:nosplit</span><br>
<span class="lineno">190</span><span class="keyword" id="1615538">func</span>&nbsp;<span class="ident" id="1615543">freedefer</span><span class="op" id="1615552">(</span><span class="ident" id="1615553">d</span>&nbsp;<span class="op" id="1615555">*</span><span class="ident" id="1615556">_defer</span><span class="op" id="1615562">)</span>&nbsp;<span class="op" id="1615564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615567">if</span>&nbsp;<span class="ident" id="1615570">d</span><span class="op" id="1615571">.</span><span class="ident" id="1615572">_panic</span>&nbsp;<span class="op" id="1615579">!=</span>&nbsp;<span class="builtintype" id="1615582">nil</span>&nbsp;<span class="op" id="1615586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615590">freedeferpanic</span><span class="op" id="1615604">(</span><span class="op" id="1615605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615611">if</span>&nbsp;<span class="ident" id="1615614">d</span><span class="op" id="1615615">.</span><span class="ident" id="1615616">fn</span>&nbsp;<span class="op" id="1615619">!=</span>&nbsp;<span class="builtintype" id="1615622">nil</span>&nbsp;<span class="op" id="1615626">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615630">freedeferfn</span><span class="op" id="1615641">(</span><span class="op" id="1615642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615648">sc</span>&nbsp;<span class="op" id="1615651">:=</span>&nbsp;<span class="ident" id="1615654">deferclass</span><span class="op" id="1615664">(</span><span class="builtintype" id="1615665">uintptr</span><span class="op" id="1615672">(</span><span class="ident" id="1615673">d</span><span class="op" id="1615674">.</span><span class="ident" id="1615675">siz</span><span class="op" id="1615678">)</span><span class="op" id="1615679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1615682">if</span>&nbsp;<span class="ident" id="1615685">sc</span>&nbsp;<span class="op" id="1615688">&lt;</span>&nbsp;<span class="builtintype" id="1615690">uintptr</span><span class="op" id="1615697">(</span><span class="builtinfunc" id="1615698">len</span><span class="op" id="1615701">(</span><span class="ident" id="1615702">p</span><span class="op" id="1615703">{</span><span class="op" id="1615704">}</span><span class="op" id="1615705">.</span><span class="ident" id="1615706">deferpool</span><span class="op" id="1615715">)</span><span class="op" id="1615716">)</span>&nbsp;<span class="op" id="1615718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615722">mp</span>&nbsp;<span class="op" id="1615725">:=</span>&nbsp;<span class="ident" id="1615728">acquirem</span><span class="op" id="1615736">(</span><span class="op" id="1615737">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615741">pp</span>&nbsp;<span class="op" id="1615744">:=</span>&nbsp;<span class="ident" id="1615747">mp</span><span class="op" id="1615749">.</span><span class="ident" id="1615750">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615754">*</span><span class="ident" id="1615755">d</span>&nbsp;<span class="op" id="1615757">=</span>&nbsp;<span class="ident" id="1615759">_defer</span><span class="op" id="1615765">{</span><span class="op" id="1615766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615770">d</span><span class="op" id="1615771">.</span><span class="ident" id="1615772">link</span>&nbsp;<span class="op" id="1615777">=</span>&nbsp;<span class="ident" id="1615779">pp</span><span class="op" id="1615781">.</span><span class="ident" id="1615782">deferpool</span><span class="op" id="1615791">[</span><span class="ident" id="1615792">sc</span><span class="op" id="1615794">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615798">pp</span><span class="op" id="1615800">.</span><span class="ident" id="1615801">deferpool</span><span class="op" id="1615810">[</span><span class="ident" id="1615811">sc</span><span class="op" id="1615813">]</span>&nbsp;<span class="op" id="1615815">=</span>&nbsp;<span class="ident" id="1615817">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1615821">releasem</span><span class="op" id="1615829">(</span><span class="ident" id="1615830">mp</span><span class="op" id="1615832">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1615835">}</span><br>
<span class="lineno"></span><span class="op" id="1615837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1615840">//&nbsp;Separate&nbsp;function&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;split&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1615889">//&nbsp;Windows&nbsp;otherwise&nbsp;runs&nbsp;out&nbsp;of&nbsp;stack&nbsp;space.</span><br>
<span class="lineno">210</span><span class="keyword" id="1615935">func</span>&nbsp;<span class="ident" id="1615940">freedeferpanic</span><span class="op" id="1615954">(</span><span class="op" id="1615955">)</span>&nbsp;<span class="op" id="1615957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1615960">//&nbsp;_panic&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1616017">gothrow</span><span class="op" id="1616024">(</span><span class="string" id="1616025">&#34;freedefer&nbsp;with&nbsp;d._panic&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1616057">)</span><br>
<span class="lineno"></span><span class="op" id="1616059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1616062">func</span>&nbsp;<span class="ident" id="1616067">freedeferfn</span><span class="op" id="1616078">(</span><span class="op" id="1616079">)</span>&nbsp;<span class="op" id="1616081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1616084">//&nbsp;fn&nbsp;must&nbsp;be&nbsp;cleared&nbsp;before&nbsp;d&nbsp;is&nbsp;unlinked&nbsp;from&nbsp;gp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1616137">gothrow</span><span class="op" id="1616144">(</span><span class="string" id="1616145">&#34;freedefer&nbsp;with&nbsp;d.fn&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="1616173">)</span><br>
<span class="lineno"></span><span class="op" id="1616175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="1616178">//&nbsp;Run&nbsp;a&nbsp;deferred&nbsp;function&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span><span class="comment" id="1616222">//&nbsp;The&nbsp;compiler&nbsp;inserts&nbsp;a&nbsp;call&nbsp;to&nbsp;this&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="1616279">//&nbsp;function&nbsp;which&nbsp;calls&nbsp;defer.</span><br>
<span class="lineno"></span><span class="comment" id="1616310">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;deferred&nbsp;function,&nbsp;this&nbsp;will&nbsp;call&nbsp;runtimejmpdefer,</span><br>
<span class="lineno"></span><span class="comment" id="1616380">//&nbsp;which&nbsp;will&nbsp;jump&nbsp;to&nbsp;the&nbsp;deferred&nbsp;function&nbsp;such&nbsp;that&nbsp;it&nbsp;appears</span><br>
<span class="lineno">225</span><span class="comment" id="1616445">//&nbsp;to&nbsp;have&nbsp;been&nbsp;called&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;deferreturn&nbsp;at&nbsp;the&nbsp;point</span><br>
<span class="lineno"></span><span class="comment" id="1616510">//&nbsp;just&nbsp;before&nbsp;deferreturn&nbsp;was&nbsp;called.&nbsp;&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;deferreturn</span><br>
<span class="lineno"></span><span class="comment" id="1616581">//&nbsp;is&nbsp;called&nbsp;again&nbsp;and&nbsp;again&nbsp;until&nbsp;there&nbsp;are&nbsp;no&nbsp;more&nbsp;deferred&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="1616654">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;we&nbsp;reuse&nbsp;the&nbsp;caller&#39;s&nbsp;frame&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1616719">//&nbsp;call&nbsp;the&nbsp;deferred&nbsp;function.</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="1616751">//&nbsp;The&nbsp;single&nbsp;argument&nbsp;isn&#39;t&nbsp;actually&nbsp;used&nbsp;-&nbsp;it&nbsp;just&nbsp;has&nbsp;its&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="1616820">//&nbsp;taken&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;matched&nbsp;against&nbsp;pending&nbsp;defers.</span><br>
<span class="lineno"></span><span class="comment" id="1616874">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1616887">func</span>&nbsp;<span class="ident" id="1616892">deferreturn</span><span class="op" id="1616903">(</span><span class="ident" id="1616904">arg0</span>&nbsp;<span class="builtintype" id="1616909">uintptr</span><span class="op" id="1616916">)</span>&nbsp;<span class="op" id="1616918">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1616921">gp</span>&nbsp;<span class="op" id="1616924">:=</span>&nbsp;<span class="ident" id="1616927">getg</span><span class="op" id="1616931">(</span><span class="op" id="1616932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1616935">d</span>&nbsp;<span class="op" id="1616937">:=</span>&nbsp;<span class="ident" id="1616940">gp</span><span class="op" id="1616942">.</span><span class="ident" id="1616943">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1616951">if</span>&nbsp;<span class="ident" id="1616954">d</span>&nbsp;<span class="op" id="1616956">==</span>&nbsp;<span class="builtintype" id="1616959">nil</span>&nbsp;<span class="op" id="1616963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1616967">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1616975">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1616978">argp</span>&nbsp;<span class="op" id="1616983">:=</span>&nbsp;<span class="builtintype" id="1616986">uintptr</span><span class="op" id="1616993">(</span><span class="ident" id="1616994">unsafe</span><span class="op" id="1617000">.</span><span class="ident" id="1617001">Pointer</span><span class="op" id="1617008">(</span><span class="op" id="1617009">&amp;</span><span class="ident" id="1617010">arg0</span><span class="op" id="1617014">)</span><span class="op" id="1617015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1617018">if</span>&nbsp;<span class="ident" id="1617021">d</span><span class="op" id="1617022">.</span><span class="ident" id="1617023">argp</span>&nbsp;<span class="op" id="1617028">!=</span>&nbsp;<span class="ident" id="1617031">argp</span>&nbsp;<span class="op" id="1617036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1617040">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1617048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617052">//&nbsp;Moving&nbsp;arguments&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617081">//&nbsp;Do&nbsp;not&nbsp;allow&nbsp;preemption&nbsp;here,&nbsp;because&nbsp;the&nbsp;garbage&nbsp;collector</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617145">//&nbsp;won&#39;t&nbsp;know&nbsp;the&nbsp;form&nbsp;of&nbsp;the&nbsp;arguments&nbsp;until&nbsp;the&nbsp;jmpdefer&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617209">//&nbsp;flip&nbsp;the&nbsp;PC&nbsp;over&nbsp;to&nbsp;fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617237">mp</span>&nbsp;<span class="op" id="1617240">:=</span>&nbsp;<span class="ident" id="1617243">acquirem</span><span class="op" id="1617251">(</span><span class="op" id="1617252">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617255">memmove</span><span class="op" id="1617262">(</span><span class="ident" id="1617263">unsafe</span><span class="op" id="1617269">.</span><span class="ident" id="1617270">Pointer</span><span class="op" id="1617277">(</span><span class="ident" id="1617278">argp</span><span class="op" id="1617282">)</span><span class="op" id="1617283">,</span>&nbsp;<span class="ident" id="1617285">deferArgs</span><span class="op" id="1617294">(</span><span class="ident" id="1617295">d</span><span class="op" id="1617296">)</span><span class="op" id="1617297">,</span>&nbsp;<span class="builtintype" id="1617299">uintptr</span><span class="op" id="1617306">(</span><span class="ident" id="1617307">d</span><span class="op" id="1617308">.</span><span class="ident" id="1617309">siz</span><span class="op" id="1617312">)</span><span class="op" id="1617313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617316">fn</span>&nbsp;<span class="op" id="1617319">:=</span>&nbsp;<span class="ident" id="1617322">d</span><span class="op" id="1617323">.</span><span class="ident" id="1617324">fn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617328">d</span><span class="op" id="1617329">.</span><span class="ident" id="1617330">fn</span>&nbsp;<span class="op" id="1617333">=</span>&nbsp;<span class="builtintype" id="1617335">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617340">gp</span><span class="op" id="1617342">.</span><span class="ident" id="1617343">_defer</span>&nbsp;<span class="op" id="1617350">=</span>&nbsp;<span class="ident" id="1617352">d</span><span class="op" id="1617353">.</span><span class="ident" id="1617354">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617360">freedefer</span><span class="op" id="1617369">(</span><span class="ident" id="1617370">d</span><span class="op" id="1617371">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617374">releasem</span><span class="op" id="1617382">(</span><span class="ident" id="1617383">mp</span><span class="op" id="1617385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1617388">jmpdefer</span><span class="op" id="1617396">(</span><span class="ident" id="1617397">fn</span><span class="op" id="1617399">,</span>&nbsp;<span class="ident" id="1617401">argp</span><span class="op" id="1617405">)</span><br>
<span class="lineno"></span><span class="op" id="1617407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1617410">//&nbsp;Goexit&nbsp;terminates&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.&nbsp;&nbsp;No&nbsp;other&nbsp;goroutine&nbsp;is&nbsp;affected.</span><br>
<span class="lineno">260</span><span class="comment" id="1617493">//&nbsp;Goexit&nbsp;runs&nbsp;all&nbsp;deferred&nbsp;calls&nbsp;before&nbsp;terminating&nbsp;the&nbsp;goroutine.&nbsp;&nbsp;Because&nbsp;Goexit</span><br>
<span class="lineno"></span><span class="comment" id="1617577">//&nbsp;is&nbsp;not&nbsp;panic,&nbsp;however,&nbsp;any&nbsp;recover&nbsp;calls&nbsp;in&nbsp;those&nbsp;deferred&nbsp;functions&nbsp;will&nbsp;return&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="1617666">//</span><br>
<span class="lineno"></span><span class="comment" id="1617669">//&nbsp;Calling&nbsp;Goexit&nbsp;from&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;terminates&nbsp;that&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1617737">//&nbsp;without&nbsp;func&nbsp;main&nbsp;returning.&nbsp;Since&nbsp;func&nbsp;main&nbsp;has&nbsp;not&nbsp;returned,</span><br>
<span class="lineno">265</span><span class="comment" id="1617803">//&nbsp;the&nbsp;program&nbsp;continues&nbsp;execution&nbsp;of&nbsp;other&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1617859">//&nbsp;If&nbsp;all&nbsp;other&nbsp;goroutines&nbsp;exit,&nbsp;the&nbsp;program&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="1617913">func</span>&nbsp;<span class="ident" id="1617918">Goexit</span><span class="op" id="1617924">(</span><span class="op" id="1617925">)</span>&nbsp;<span class="op" id="1617927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617930">//&nbsp;Run&nbsp;all&nbsp;deferred&nbsp;functions&nbsp;for&nbsp;the&nbsp;current&nbsp;goroutine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1617988">//&nbsp;This&nbsp;code&nbsp;is&nbsp;similar&nbsp;to&nbsp;gopanic,&nbsp;see&nbsp;that&nbsp;implementation</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618049">//&nbsp;for&nbsp;detailed&nbsp;comments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618076">gp</span>&nbsp;<span class="op" id="1618079">:=</span>&nbsp;<span class="ident" id="1618082">getg</span><span class="op" id="1618086">(</span><span class="op" id="1618087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618090">for</span>&nbsp;<span class="op" id="1618094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618098">d</span>&nbsp;<span class="op" id="1618100">:=</span>&nbsp;<span class="ident" id="1618103">gp</span><span class="op" id="1618105">.</span><span class="ident" id="1618106">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618115">if</span>&nbsp;<span class="ident" id="1618118">d</span>&nbsp;<span class="op" id="1618120">==</span>&nbsp;<span class="builtintype" id="1618123">nil</span>&nbsp;<span class="op" id="1618127">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618132">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618144">if</span>&nbsp;<span class="ident" id="1618147">d</span><span class="op" id="1618148">.</span><span class="ident" id="1618149">started</span>&nbsp;<span class="op" id="1618157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618162">if</span>&nbsp;<span class="ident" id="1618165">d</span><span class="op" id="1618166">.</span><span class="ident" id="1618167">_panic</span>&nbsp;<span class="op" id="1618174">!=</span>&nbsp;<span class="builtintype" id="1618177">nil</span>&nbsp;<span class="op" id="1618181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618187">d</span><span class="op" id="1618188">.</span><span class="ident" id="1618189">_panic</span><span class="op" id="1618195">.</span><span class="ident" id="1618196">aborted</span>&nbsp;<span class="op" id="1618204">=</span>&nbsp;<span class="builtintype" id="1618206">true</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618215">d</span><span class="op" id="1618216">.</span><span class="ident" id="1618217">_panic</span>&nbsp;<span class="op" id="1618224">=</span>&nbsp;<span class="builtintype" id="1618226">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618238">d</span><span class="op" id="1618239">.</span><span class="ident" id="1618240">fn</span>&nbsp;<span class="op" id="1618243">=</span>&nbsp;<span class="builtintype" id="1618245">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618252">gp</span><span class="op" id="1618254">.</span><span class="ident" id="1618255">_defer</span>&nbsp;<span class="op" id="1618262">=</span>&nbsp;<span class="ident" id="1618264">d</span><span class="op" id="1618265">.</span><span class="ident" id="1618266">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618274">freedefer</span><span class="op" id="1618283">(</span><span class="ident" id="1618284">d</span><span class="op" id="1618285">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618290">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618305">d</span><span class="op" id="1618306">.</span><span class="ident" id="1618307">started</span>&nbsp;<span class="op" id="1618315">=</span>&nbsp;<span class="builtintype" id="1618317">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618324">reflectcall</span><span class="op" id="1618335">(</span><span class="ident" id="1618336">unsafe</span><span class="op" id="1618342">.</span><span class="ident" id="1618343">Pointer</span><span class="op" id="1618350">(</span><span class="ident" id="1618351">d</span><span class="op" id="1618352">.</span><span class="ident" id="1618353">fn</span><span class="op" id="1618355">)</span><span class="op" id="1618356">,</span>&nbsp;<span class="ident" id="1618358">deferArgs</span><span class="op" id="1618367">(</span><span class="ident" id="1618368">d</span><span class="op" id="1618369">)</span><span class="op" id="1618370">,</span>&nbsp;<span class="builtintype" id="1618372">uint32</span><span class="op" id="1618378">(</span><span class="ident" id="1618379">d</span><span class="op" id="1618380">.</span><span class="ident" id="1618381">siz</span><span class="op" id="1618384">)</span><span class="op" id="1618385">,</span>&nbsp;<span class="builtintype" id="1618387">uint32</span><span class="op" id="1618393">(</span><span class="ident" id="1618394">d</span><span class="op" id="1618395">.</span><span class="ident" id="1618396">siz</span><span class="op" id="1618399">)</span><span class="op" id="1618400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618404">if</span>&nbsp;<span class="ident" id="1618407">gp</span><span class="op" id="1618409">.</span><span class="ident" id="1618410">_defer</span>&nbsp;<span class="op" id="1618417">!=</span>&nbsp;<span class="ident" id="1618420">d</span>&nbsp;<span class="op" id="1618422">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618427">gothrow</span><span class="op" id="1618434">(</span><span class="string" id="1618435">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;Goexit&#34;</span><span class="op" id="1618462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618470">d</span><span class="op" id="1618471">.</span><span class="ident" id="1618472">_panic</span>&nbsp;<span class="op" id="1618479">=</span>&nbsp;<span class="builtintype" id="1618481">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618487">d</span><span class="op" id="1618488">.</span><span class="ident" id="1618489">fn</span>&nbsp;<span class="op" id="1618492">=</span>&nbsp;<span class="builtintype" id="1618494">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618500">gp</span><span class="op" id="1618502">.</span><span class="ident" id="1618503">_defer</span>&nbsp;<span class="op" id="1618510">=</span>&nbsp;<span class="ident" id="1618512">d</span><span class="op" id="1618513">.</span><span class="ident" id="1618514">link</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618521">freedefer</span><span class="op" id="1618530">(</span><span class="ident" id="1618531">d</span><span class="op" id="1618532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1618536">//&nbsp;Note:&nbsp;we&nbsp;ignore&nbsp;recovers&nbsp;here&nbsp;because&nbsp;Goexit&nbsp;isn&#39;t&nbsp;a&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618602">goexit</span><span class="op" id="1618608">(</span><span class="op" id="1618609">)</span><br>
<span class="lineno"></span><span class="op" id="1618611">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="1618614">func</span>&nbsp;<span class="ident" id="1618619">canpanic</span><span class="op" id="1618627">(</span><span class="op" id="1618628">*</span><span class="ident" id="1618629">g</span><span class="op" id="1618630">)</span>&nbsp;<span class="builtintype" id="1618632">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1618638">//&nbsp;Print&nbsp;all&nbsp;currently&nbsp;active&nbsp;panics.&nbsp;&nbsp;Used&nbsp;when&nbsp;crashing.</span><br>
<span class="lineno"></span><span class="keyword" id="1618697">func</span>&nbsp;<span class="ident" id="1618702">printpanics</span><span class="op" id="1618713">(</span><span class="ident" id="1618714">p</span>&nbsp;<span class="op" id="1618716">*</span><span class="ident" id="1618717">_panic</span><span class="op" id="1618723">)</span>&nbsp;<span class="op" id="1618725">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618728">if</span>&nbsp;<span class="ident" id="1618731">p</span><span class="op" id="1618732">.</span><span class="ident" id="1618733">link</span>&nbsp;<span class="op" id="1618738">!=</span>&nbsp;<span class="builtintype" id="1618741">nil</span>&nbsp;<span class="op" id="1618745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618749">printpanics</span><span class="op" id="1618760">(</span><span class="ident" id="1618761">p</span><span class="op" id="1618762">.</span><span class="ident" id="1618763">link</span><span class="op" id="1618767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1618771">print</span><span class="op" id="1618776">(</span><span class="string" id="1618777">&#34;\t&#34;</span><span class="op" id="1618781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1618787">print</span><span class="op" id="1618792">(</span><span class="string" id="1618793">&#34;panic:&nbsp;&#34;</span><span class="op" id="1618802">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618805">printany</span><span class="op" id="1618813">(</span><span class="ident" id="1618814">p</span><span class="op" id="1618815">.</span><span class="ident" id="1618816">arg</span><span class="op" id="1618819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618822">if</span>&nbsp;<span class="ident" id="1618825">p</span><span class="op" id="1618826">.</span><span class="ident" id="1618827">recovered</span>&nbsp;<span class="op" id="1618837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1618841">print</span><span class="op" id="1618846">(</span><span class="string" id="1618847">&#34;&nbsp;[recovered]&#34;</span><span class="op" id="1618861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1618864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1618867">print</span><span class="op" id="1618872">(</span><span class="string" id="1618873">&#34;\n&#34;</span><span class="op" id="1618877">)</span><br>
<span class="lineno">315</span><span class="op" id="1618879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1618882">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;panic.</span><br>
<span class="lineno"></span><span class="keyword" id="1618939">func</span>&nbsp;<span class="ident" id="1618944">gopanic</span><span class="op" id="1618951">(</span><span class="ident" id="1618952">e</span>&nbsp;<span class="keyword" id="1618954">interface</span><span class="op" id="1618963">{</span><span class="op" id="1618964">}</span><span class="op" id="1618965">)</span>&nbsp;<span class="op" id="1618967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1618970">gp</span>&nbsp;<span class="op" id="1618973">:=</span>&nbsp;<span class="ident" id="1618976">getg</span><span class="op" id="1618980">(</span><span class="op" id="1618981">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1618984">if</span>&nbsp;<span class="ident" id="1618987">gp</span><span class="op" id="1618989">.</span><span class="ident" id="1618990">m</span><span class="op" id="1618991">.</span><span class="ident" id="1618992">curg</span>&nbsp;<span class="op" id="1618997">!=</span>&nbsp;<span class="ident" id="1619000">gp</span>&nbsp;<span class="op" id="1619003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619007">gothrow</span><span class="op" id="1619014">(</span><span class="string" id="1619015">&#34;panic&nbsp;on&nbsp;m&nbsp;stack&#34;</span><span class="op" id="1619033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619040">//&nbsp;m.softfloat&nbsp;is&nbsp;set&nbsp;during&nbsp;software&nbsp;floating&nbsp;point.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619095">//&nbsp;It&nbsp;increments&nbsp;m.locks&nbsp;to&nbsp;avoid&nbsp;preemption.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619142">//&nbsp;We&nbsp;moved&nbsp;the&nbsp;memory&nbsp;loads&nbsp;out,&nbsp;so&nbsp;there&nbsp;shouldn&#39;t&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619199">//&nbsp;any&nbsp;reason&nbsp;for&nbsp;it&nbsp;to&nbsp;panic&nbsp;anymore.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619239">if</span>&nbsp;<span class="ident" id="1619242">gp</span><span class="op" id="1619244">.</span><span class="ident" id="1619245">m</span><span class="op" id="1619246">.</span><span class="ident" id="1619247">softfloat</span>&nbsp;<span class="op" id="1619257">!=</span>&nbsp;<span class="num" id="1619260">0</span>&nbsp;<span class="op" id="1619262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619266">gp</span><span class="op" id="1619268">.</span><span class="ident" id="1619269">m</span><span class="op" id="1619270">.</span><span class="ident" id="1619271">locks</span><span class="op" id="1619276">--</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619281">gp</span><span class="op" id="1619283">.</span><span class="ident" id="1619284">m</span><span class="op" id="1619285">.</span><span class="ident" id="1619286">softfloat</span>&nbsp;<span class="op" id="1619296">=</span>&nbsp;<span class="num" id="1619298">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619302">gothrow</span><span class="op" id="1619309">(</span><span class="string" id="1619310">&#34;panic&nbsp;during&nbsp;softfloat&#34;</span><span class="op" id="1619334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619340">if</span>&nbsp;<span class="ident" id="1619343">gp</span><span class="op" id="1619345">.</span><span class="ident" id="1619346">m</span><span class="op" id="1619347">.</span><span class="ident" id="1619348">mallocing</span>&nbsp;<span class="op" id="1619358">!=</span>&nbsp;<span class="num" id="1619361">0</span>&nbsp;<span class="op" id="1619363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1619367">print</span><span class="op" id="1619372">(</span><span class="string" id="1619373">&#34;panic:&nbsp;&#34;</span><span class="op" id="1619382">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619386">printany</span><span class="op" id="1619394">(</span><span class="ident" id="1619395">e</span><span class="op" id="1619396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1619400">print</span><span class="op" id="1619405">(</span><span class="string" id="1619406">&#34;\n&#34;</span><span class="op" id="1619410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619414">gothrow</span><span class="op" id="1619421">(</span><span class="string" id="1619422">&#34;panic&nbsp;during&nbsp;malloc&#34;</span><span class="op" id="1619443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619449">if</span>&nbsp;<span class="ident" id="1619452">gp</span><span class="op" id="1619454">.</span><span class="ident" id="1619455">m</span><span class="op" id="1619456">.</span><span class="ident" id="1619457">gcing</span>&nbsp;<span class="op" id="1619463">!=</span>&nbsp;<span class="num" id="1619466">0</span>&nbsp;<span class="op" id="1619468">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1619472">print</span><span class="op" id="1619477">(</span><span class="string" id="1619478">&#34;panic:&nbsp;&#34;</span><span class="op" id="1619487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619491">printany</span><span class="op" id="1619499">(</span><span class="ident" id="1619500">e</span><span class="op" id="1619501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1619505">print</span><span class="op" id="1619510">(</span><span class="string" id="1619511">&#34;\n&#34;</span><span class="op" id="1619515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619519">gothrow</span><span class="op" id="1619526">(</span><span class="string" id="1619527">&#34;panic&nbsp;during&nbsp;gc&#34;</span><span class="op" id="1619544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619547">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619550">if</span>&nbsp;<span class="ident" id="1619553">gp</span><span class="op" id="1619555">.</span><span class="ident" id="1619556">m</span><span class="op" id="1619557">.</span><span class="ident" id="1619558">locks</span>&nbsp;<span class="op" id="1619564">!=</span>&nbsp;<span class="num" id="1619567">0</span>&nbsp;<span class="op" id="1619569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1619573">print</span><span class="op" id="1619578">(</span><span class="string" id="1619579">&#34;panic:&nbsp;&#34;</span><span class="op" id="1619588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619592">printany</span><span class="op" id="1619600">(</span><span class="ident" id="1619601">e</span><span class="op" id="1619602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1619606">print</span><span class="op" id="1619611">(</span><span class="string" id="1619612">&#34;\n&#34;</span><span class="op" id="1619616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619620">gothrow</span><span class="op" id="1619627">(</span><span class="string" id="1619628">&#34;panic&nbsp;holding&nbsp;locks&#34;</span><span class="op" id="1619649">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619656">var</span>&nbsp;<span class="ident" id="1619660">p</span>&nbsp;<span class="ident" id="1619662">_panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619670">p</span><span class="op" id="1619671">.</span><span class="ident" id="1619672">arg</span>&nbsp;<span class="op" id="1619676">=</span>&nbsp;<span class="ident" id="1619678">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619681">p</span><span class="op" id="1619682">.</span><span class="ident" id="1619683">link</span>&nbsp;<span class="op" id="1619688">=</span>&nbsp;<span class="ident" id="1619690">gp</span><span class="op" id="1619692">.</span><span class="ident" id="1619693">_panic</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619701">gp</span><span class="op" id="1619703">.</span><span class="ident" id="1619704">_panic</span>&nbsp;<span class="op" id="1619711">=</span>&nbsp;<span class="op" id="1619713">(</span><span class="op" id="1619714">*</span><span class="ident" id="1619715">_panic</span><span class="op" id="1619721">)</span><span class="op" id="1619722">(</span><span class="ident" id="1619723">noescape</span><span class="op" id="1619731">(</span><span class="ident" id="1619732">unsafe</span><span class="op" id="1619738">.</span><span class="ident" id="1619739">Pointer</span><span class="op" id="1619746">(</span><span class="op" id="1619747">&amp;</span><span class="ident" id="1619748">p</span><span class="op" id="1619749">)</span><span class="op" id="1619750">)</span><span class="op" id="1619751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619755">for</span>&nbsp;<span class="op" id="1619759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1619763">d</span>&nbsp;<span class="op" id="1619765">:=</span>&nbsp;<span class="ident" id="1619768">gp</span><span class="op" id="1619770">.</span><span class="ident" id="1619771">_defer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619780">if</span>&nbsp;<span class="ident" id="1619783">d</span>&nbsp;<span class="op" id="1619785">==</span>&nbsp;<span class="builtintype" id="1619788">nil</span>&nbsp;<span class="op" id="1619792">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1619797">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1619805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619810">//&nbsp;If&nbsp;defer&nbsp;was&nbsp;started&nbsp;by&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;(and,&nbsp;since&nbsp;we&#39;re&nbsp;back&nbsp;here,&nbsp;that&nbsp;triggered&nbsp;a&nbsp;new&nbsp;panic),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1619921">//&nbsp;take&nbsp;defer&nbsp;off&nbsp;list.&nbsp;The&nbsp;earlier&nbsp;panic&nbsp;or&nbsp;Goexit&nbsp;will&nbsp;not&nbsp;continue&nbsp;running.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620002">if</span>&nbsp;<span class="ident" id="1620005">d</span><span class="op" id="1620006">.</span><span class="ident" id="1620007">started</span>&nbsp;<span class="op" id="1620015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620020">if</span>&nbsp;<span class="ident" id="1620023">d</span><span class="op" id="1620024">.</span><span class="ident" id="1620025">_panic</span>&nbsp;<span class="op" id="1620032">!=</span>&nbsp;<span class="builtintype" id="1620035">nil</span>&nbsp;<span class="op" id="1620039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620045">d</span><span class="op" id="1620046">.</span><span class="ident" id="1620047">_panic</span><span class="op" id="1620053">.</span><span class="ident" id="1620054">aborted</span>&nbsp;<span class="op" id="1620062">=</span>&nbsp;<span class="builtintype" id="1620064">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620077">d</span><span class="op" id="1620078">.</span><span class="ident" id="1620079">_panic</span>&nbsp;<span class="op" id="1620086">=</span>&nbsp;<span class="builtintype" id="1620088">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620095">d</span><span class="op" id="1620096">.</span><span class="ident" id="1620097">fn</span>&nbsp;<span class="op" id="1620100">=</span>&nbsp;<span class="builtintype" id="1620102">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620109">gp</span><span class="op" id="1620111">.</span><span class="ident" id="1620112">_defer</span>&nbsp;<span class="op" id="1620119">=</span>&nbsp;<span class="ident" id="1620121">d</span><span class="op" id="1620122">.</span><span class="ident" id="1620123">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620131">freedefer</span><span class="op" id="1620140">(</span><span class="ident" id="1620141">d</span><span class="op" id="1620142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620147">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620158">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620163">//&nbsp;Mark&nbsp;defer&nbsp;as&nbsp;started,&nbsp;but&nbsp;keep&nbsp;on&nbsp;list,&nbsp;so&nbsp;that&nbsp;traceback</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620227">//&nbsp;can&nbsp;find&nbsp;and&nbsp;update&nbsp;the&nbsp;defer&#39;s&nbsp;argument&nbsp;frame&nbsp;if&nbsp;stack&nbsp;growth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620295">//&nbsp;or&nbsp;a&nbsp;garbage&nbsp;collection&nbsp;hapens&nbsp;before&nbsp;reflectcall&nbsp;starts&nbsp;executing&nbsp;d.fn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620373">d</span><span class="op" id="1620374">.</span><span class="ident" id="1620375">started</span>&nbsp;<span class="op" id="1620383">=</span>&nbsp;<span class="builtintype" id="1620385">true</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620393">//&nbsp;Record&nbsp;the&nbsp;panic&nbsp;that&nbsp;is&nbsp;running&nbsp;the&nbsp;defer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620442">//&nbsp;If&nbsp;there&nbsp;is&nbsp;a&nbsp;new&nbsp;panic&nbsp;during&nbsp;the&nbsp;deferred&nbsp;call,&nbsp;that&nbsp;panic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620508">//&nbsp;will&nbsp;find&nbsp;d&nbsp;in&nbsp;the&nbsp;list&nbsp;and&nbsp;will&nbsp;mark&nbsp;d._panic&nbsp;(this&nbsp;panic)&nbsp;aborted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620582">d</span><span class="op" id="1620583">.</span><span class="ident" id="1620584">_panic</span>&nbsp;<span class="op" id="1620591">=</span>&nbsp;<span class="op" id="1620593">(</span><span class="op" id="1620594">*</span><span class="ident" id="1620595">_panic</span><span class="op" id="1620601">)</span><span class="op" id="1620602">(</span><span class="ident" id="1620603">noescape</span><span class="op" id="1620611">(</span><span class="op" id="1620612">(</span><span class="ident" id="1620613">unsafe</span><span class="op" id="1620619">.</span><span class="ident" id="1620620">Pointer</span><span class="op" id="1620627">)</span><span class="op" id="1620628">(</span><span class="op" id="1620629">&amp;</span><span class="ident" id="1620630">p</span><span class="op" id="1620631">)</span><span class="op" id="1620632">)</span><span class="op" id="1620633">)</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620638">p</span><span class="op" id="1620639">.</span><span class="ident" id="1620640">argp</span>&nbsp;<span class="op" id="1620645">=</span>&nbsp;<span class="ident" id="1620647">unsafe</span><span class="op" id="1620653">.</span><span class="ident" id="1620654">Pointer</span><span class="op" id="1620661">(</span><span class="ident" id="1620662">getargp</span><span class="op" id="1620669">(</span><span class="num" id="1620670">0</span><span class="op" id="1620671">)</span><span class="op" id="1620672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620676">reflectcall</span><span class="op" id="1620687">(</span><span class="ident" id="1620688">unsafe</span><span class="op" id="1620694">.</span><span class="ident" id="1620695">Pointer</span><span class="op" id="1620702">(</span><span class="ident" id="1620703">d</span><span class="op" id="1620704">.</span><span class="ident" id="1620705">fn</span><span class="op" id="1620707">)</span><span class="op" id="1620708">,</span>&nbsp;<span class="ident" id="1620710">deferArgs</span><span class="op" id="1620719">(</span><span class="ident" id="1620720">d</span><span class="op" id="1620721">)</span><span class="op" id="1620722">,</span>&nbsp;<span class="builtintype" id="1620724">uint32</span><span class="op" id="1620730">(</span><span class="ident" id="1620731">d</span><span class="op" id="1620732">.</span><span class="ident" id="1620733">siz</span><span class="op" id="1620736">)</span><span class="op" id="1620737">,</span>&nbsp;<span class="builtintype" id="1620739">uint32</span><span class="op" id="1620745">(</span><span class="ident" id="1620746">d</span><span class="op" id="1620747">.</span><span class="ident" id="1620748">siz</span><span class="op" id="1620751">)</span><span class="op" id="1620752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620756">p</span><span class="op" id="1620757">.</span><span class="ident" id="1620758">argp</span>&nbsp;<span class="op" id="1620763">=</span>&nbsp;<span class="builtintype" id="1620765">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620772">//&nbsp;reflectcall&nbsp;did&nbsp;not&nbsp;panic.&nbsp;Remove&nbsp;d.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1620814">if</span>&nbsp;<span class="ident" id="1620817">gp</span><span class="op" id="1620819">.</span><span class="ident" id="1620820">_defer</span>&nbsp;<span class="op" id="1620827">!=</span>&nbsp;<span class="ident" id="1620830">d</span>&nbsp;<span class="op" id="1620832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620837">gothrow</span><span class="op" id="1620844">(</span><span class="string" id="1620845">&#34;bad&nbsp;defer&nbsp;entry&nbsp;in&nbsp;panic&#34;</span><span class="op" id="1620871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1620875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620879">d</span><span class="op" id="1620880">.</span><span class="ident" id="1620881">_panic</span>&nbsp;<span class="op" id="1620888">=</span>&nbsp;<span class="builtintype" id="1620890">nil</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620896">d</span><span class="op" id="1620897">.</span><span class="ident" id="1620898">fn</span>&nbsp;<span class="op" id="1620901">=</span>&nbsp;<span class="builtintype" id="1620903">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1620909">gp</span><span class="op" id="1620911">.</span><span class="ident" id="1620912">_defer</span>&nbsp;<span class="op" id="1620919">=</span>&nbsp;<span class="ident" id="1620921">d</span><span class="op" id="1620922">.</span><span class="ident" id="1620923">link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1620931">//&nbsp;trigger&nbsp;shrinkage&nbsp;to&nbsp;test&nbsp;stack&nbsp;copy.&nbsp;&nbsp;See&nbsp;stack_test.go:TestStackPanic</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621008">//GC()</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621018">pc</span>&nbsp;<span class="op" id="1621021">:=</span>&nbsp;<span class="ident" id="1621024">d</span><span class="op" id="1621025">.</span><span class="ident" id="1621026">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621031">argp</span>&nbsp;<span class="op" id="1621036">:=</span>&nbsp;<span class="ident" id="1621039">unsafe</span><span class="op" id="1621045">.</span><span class="ident" id="1621046">Pointer</span><span class="op" id="1621053">(</span><span class="ident" id="1621054">d</span><span class="op" id="1621055">.</span><span class="ident" id="1621056">argp</span><span class="op" id="1621060">)</span>&nbsp;<span class="comment" id="1621062">//&nbsp;must&nbsp;be&nbsp;pointer&nbsp;so&nbsp;it&nbsp;gets&nbsp;adjusted&nbsp;during&nbsp;stack&nbsp;copy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621121">freedefer</span><span class="op" id="1621130">(</span><span class="ident" id="1621131">d</span><span class="op" id="1621132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621136">if</span>&nbsp;<span class="ident" id="1621139">p</span><span class="op" id="1621140">.</span><span class="ident" id="1621141">recovered</span>&nbsp;<span class="op" id="1621151">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621156">gp</span><span class="op" id="1621158">.</span><span class="ident" id="1621159">_panic</span>&nbsp;<span class="op" id="1621166">=</span>&nbsp;<span class="ident" id="1621168">p</span><span class="op" id="1621169">.</span><span class="ident" id="1621170">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621178">//&nbsp;Aborted&nbsp;panics&nbsp;are&nbsp;marked&nbsp;but&nbsp;remain&nbsp;on&nbsp;the&nbsp;g.panic&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621242">//&nbsp;Remove&nbsp;them&nbsp;from&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621275">for</span>&nbsp;<span class="ident" id="1621279">gp</span><span class="op" id="1621281">.</span><span class="ident" id="1621282">_panic</span>&nbsp;<span class="op" id="1621289">!=</span>&nbsp;<span class="builtintype" id="1621292">nil</span>&nbsp;<span class="op" id="1621296">&amp;&amp;</span>&nbsp;<span class="ident" id="1621299">gp</span><span class="op" id="1621301">.</span><span class="ident" id="1621302">_panic</span><span class="op" id="1621308">.</span><span class="ident" id="1621309">aborted</span>&nbsp;<span class="op" id="1621317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621323">gp</span><span class="op" id="1621325">.</span><span class="ident" id="1621326">_panic</span>&nbsp;<span class="op" id="1621333">=</span>&nbsp;<span class="ident" id="1621335">gp</span><span class="op" id="1621337">.</span><span class="ident" id="1621338">_panic</span><span class="op" id="1621344">.</span><span class="ident" id="1621345">link</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1621358">if</span>&nbsp;<span class="ident" id="1621361">gp</span><span class="op" id="1621363">.</span><span class="ident" id="1621364">_panic</span>&nbsp;<span class="op" id="1621371">==</span>&nbsp;<span class="builtintype" id="1621374">nil</span>&nbsp;<span class="op" id="1621378">{</span>&nbsp;<span class="comment" id="1621380">//&nbsp;must&nbsp;be&nbsp;done&nbsp;with&nbsp;signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621412">gp</span><span class="op" id="1621414">.</span><span class="ident" id="1621415">sig</span>&nbsp;<span class="op" id="1621419">=</span>&nbsp;<span class="num" id="1621421">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621431">//&nbsp;Pass&nbsp;information&nbsp;about&nbsp;recovering&nbsp;frame&nbsp;to&nbsp;recovery.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621490">gp</span><span class="op" id="1621492">.</span><span class="ident" id="1621493">sigcode0</span>&nbsp;<span class="op" id="1621502">=</span>&nbsp;<span class="builtintype" id="1621504">uintptr</span><span class="op" id="1621511">(</span><span class="ident" id="1621512">argp</span><span class="op" id="1621516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621521">gp</span><span class="op" id="1621523">.</span><span class="ident" id="1621524">sigcode1</span>&nbsp;<span class="op" id="1621533">=</span>&nbsp;<span class="ident" id="1621535">pc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621541">mcall</span><span class="op" id="1621546">(</span><span class="ident" id="1621547">recovery_m</span><span class="op" id="1621557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621562">gothrow</span><span class="op" id="1621569">(</span><span class="string" id="1621570">&#34;recovery&nbsp;failed&#34;</span><span class="op" id="1621587">)</span>&nbsp;<span class="comment" id="1621589">//&nbsp;mcall&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621618">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621625">//&nbsp;ran&nbsp;out&nbsp;of&nbsp;deferred&nbsp;calls&nbsp;-&nbsp;old-school&nbsp;panic&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621678">startpanic</span><span class="op" id="1621688">(</span><span class="op" id="1621689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621692">printpanics</span><span class="op" id="1621703">(</span><span class="ident" id="1621704">gp</span><span class="op" id="1621706">.</span><span class="ident" id="1621707">_panic</span><span class="op" id="1621713">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1621716">dopanic</span><span class="op" id="1621723">(</span><span class="num" id="1621724">0</span><span class="op" id="1621725">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621733">//&nbsp;should&nbsp;not&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1621755">*</span><span class="op" id="1621756">(</span><span class="op" id="1621757">*</span><span class="builtintype" id="1621758">int</span><span class="op" id="1621761">)</span><span class="op" id="1621762">(</span><span class="builtintype" id="1621763">nil</span><span class="op" id="1621766">)</span>&nbsp;<span class="op" id="1621768">=</span>&nbsp;<span class="num" id="1621770">0</span>&nbsp;<span class="comment" id="1621772">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1621787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1621790">//&nbsp;getargp&nbsp;returns&nbsp;the&nbsp;location&nbsp;where&nbsp;the&nbsp;caller</span><br>
<span class="lineno">430</span><span class="comment" id="1621839">//&nbsp;writes&nbsp;outgoing&nbsp;function&nbsp;call&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="1621883">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1621896">func</span>&nbsp;<span class="ident" id="1621901">getargp</span><span class="op" id="1621908">(</span><span class="ident" id="1621909">x</span>&nbsp;<span class="builtintype" id="1621911">int</span><span class="op" id="1621914">)</span>&nbsp;<span class="builtintype" id="1621916">uintptr</span>&nbsp;<span class="op" id="1621924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621927">//&nbsp;x&nbsp;is&nbsp;an&nbsp;argument&nbsp;mainly&nbsp;so&nbsp;that&nbsp;we&nbsp;can&nbsp;return&nbsp;its&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1621990">//&nbsp;However,&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;the&nbsp;function&nbsp;complex&nbsp;enough</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622047">//&nbsp;that&nbsp;it&nbsp;won&#39;t&nbsp;be&nbsp;inlined.&nbsp;We&nbsp;always&nbsp;pass&nbsp;x&nbsp;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622112">//&nbsp;does&nbsp;nothing&nbsp;other&nbsp;than&nbsp;keep&nbsp;the&nbsp;compiler&nbsp;from&nbsp;thinking</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622172">//&nbsp;the&nbsp;function&nbsp;is&nbsp;simple&nbsp;enough&nbsp;to&nbsp;inline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622217">if</span>&nbsp;<span class="ident" id="1622220">x</span>&nbsp;<span class="op" id="1622222">&gt;</span>&nbsp;<span class="num" id="1622224">0</span>&nbsp;<span class="op" id="1622226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622230">return</span>&nbsp;<span class="ident" id="1622237">getcallersp</span><span class="op" id="1622248">(</span><span class="ident" id="1622249">unsafe</span><span class="op" id="1622255">.</span><span class="ident" id="1622256">Pointer</span><span class="op" id="1622263">(</span><span class="op" id="1622264">&amp;</span><span class="ident" id="1622265">x</span><span class="op" id="1622266">)</span><span class="op" id="1622267">)</span>&nbsp;<span class="op" id="1622269">*</span>&nbsp;<span class="num" id="1622271">0</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1622274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1622277">return</span>&nbsp;<span class="builtintype" id="1622284">uintptr</span><span class="op" id="1622291">(</span><span class="ident" id="1622292">noescape</span><span class="op" id="1622300">(</span><span class="ident" id="1622301">unsafe</span><span class="op" id="1622307">.</span><span class="ident" id="1622308">Pointer</span><span class="op" id="1622315">(</span><span class="op" id="1622316">&amp;</span><span class="ident" id="1622317">x</span><span class="op" id="1622318">)</span><span class="op" id="1622319">)</span><span class="op" id="1622320">)</span><br>
<span class="lineno"></span><span class="op" id="1622322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1622325">//&nbsp;The&nbsp;implementation&nbsp;of&nbsp;the&nbsp;predeclared&nbsp;function&nbsp;recover.</span><br>
<span class="lineno">445</span><span class="comment" id="1622384">//&nbsp;Cannot&nbsp;split&nbsp;the&nbsp;stack&nbsp;because&nbsp;it&nbsp;needs&nbsp;to&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="1622439">//&nbsp;find&nbsp;the&nbsp;stack&nbsp;segment&nbsp;of&nbsp;its&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="1622480">//</span><br>
<span class="lineno"></span><span class="comment" id="1622483">//&nbsp;TODO(rsc):&nbsp;Once&nbsp;we&nbsp;commit&nbsp;to&nbsp;CopyStackAlways,</span><br>
<span class="lineno"></span><span class="comment" id="1622532">//&nbsp;this&nbsp;doesn&#39;t&nbsp;need&nbsp;to&nbsp;be&nbsp;nosplit.</span><br>
<span class="lineno">450</span><span class="comment" id="1622568">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1622581">func</span>&nbsp;<span class="ident" id="1622586">gorecover</span><span class="op" id="1622595">(</span><span class="ident" id="1622596">argp</span>&nbsp;<span class="builtintype" id="1622601">uintptr</span><span class="op" id="1622608">)</span>&nbsp;<span class="keyword" id="1622610">interface</span><span class="op" id="1622619">{</span><span class="op" id="1622620">}</span>&nbsp;<span class="op" id="1622622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622625">//&nbsp;Must&nbsp;be&nbsp;in&nbsp;a&nbsp;function&nbsp;running&nbsp;as&nbsp;part&nbsp;of&nbsp;a&nbsp;deferred&nbsp;call&nbsp;during&nbsp;the&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622704">//&nbsp;Must&nbsp;be&nbsp;called&nbsp;from&nbsp;the&nbsp;topmost&nbsp;function&nbsp;of&nbsp;the&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622761">//&nbsp;(the&nbsp;function&nbsp;used&nbsp;in&nbsp;the&nbsp;defer&nbsp;statement).</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622809">//&nbsp;p.argp&nbsp;is&nbsp;the&nbsp;argument&nbsp;pointer&nbsp;of&nbsp;that&nbsp;topmost&nbsp;deferred&nbsp;function&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622884">//&nbsp;Compare&nbsp;against&nbsp;argp&nbsp;reported&nbsp;by&nbsp;caller.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1622929">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;the&nbsp;caller&nbsp;is&nbsp;the&nbsp;one&nbsp;who&nbsp;can&nbsp;recover.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1622987">gp</span>&nbsp;<span class="op" id="1622990">:=</span>&nbsp;<span class="ident" id="1622993">getg</span><span class="op" id="1622997">(</span><span class="op" id="1622998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623001">p</span>&nbsp;<span class="op" id="1623003">:=</span>&nbsp;<span class="ident" id="1623006">gp</span><span class="op" id="1623008">.</span><span class="ident" id="1623009">_panic</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623017">if</span>&nbsp;<span class="ident" id="1623020">p</span>&nbsp;<span class="op" id="1623022">!=</span>&nbsp;<span class="builtintype" id="1623025">nil</span>&nbsp;<span class="op" id="1623029">&amp;&amp;</span>&nbsp;<span class="op" id="1623032">!</span><span class="ident" id="1623033">p</span><span class="op" id="1623034">.</span><span class="ident" id="1623035">recovered</span>&nbsp;<span class="op" id="1623045">&amp;&amp;</span>&nbsp;<span class="ident" id="1623048">argp</span>&nbsp;<span class="op" id="1623053">==</span>&nbsp;<span class="builtintype" id="1623056">uintptr</span><span class="op" id="1623063">(</span><span class="ident" id="1623064">p</span><span class="op" id="1623065">.</span><span class="ident" id="1623066">argp</span><span class="op" id="1623070">)</span>&nbsp;<span class="op" id="1623072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623076">p</span><span class="op" id="1623077">.</span><span class="ident" id="1623078">recovered</span>&nbsp;<span class="op" id="1623088">=</span>&nbsp;<span class="builtintype" id="1623090">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623097">return</span>&nbsp;<span class="ident" id="1623104">p</span><span class="op" id="1623105">.</span><span class="ident" id="1623106">arg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623114">return</span>&nbsp;<span class="builtintype" id="1623121">nil</span><br>
<span class="lineno">465</span><span class="op" id="1623125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1623128">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1623141">func</span>&nbsp;<span class="ident" id="1623146">startpanic</span><span class="op" id="1623156">(</span><span class="op" id="1623157">)</span>&nbsp;<span class="op" id="1623159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623162">onM_signalok</span><span class="op" id="1623174">(</span><span class="ident" id="1623175">startpanic_m</span><span class="op" id="1623187">)</span><br>
<span class="lineno">470</span><span class="op" id="1623189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1623192">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1623205">func</span>&nbsp;<span class="ident" id="1623210">dopanic</span><span class="op" id="1623217">(</span><span class="ident" id="1623218">unused</span>&nbsp;<span class="builtintype" id="1623225">int</span><span class="op" id="1623228">)</span>&nbsp;<span class="op" id="1623230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623233">gp</span>&nbsp;<span class="op" id="1623236">:=</span>&nbsp;<span class="ident" id="1623239">getg</span><span class="op" id="1623243">(</span><span class="op" id="1623244">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623247">mp</span>&nbsp;<span class="op" id="1623250">:=</span>&nbsp;<span class="ident" id="1623253">acquirem</span><span class="op" id="1623261">(</span><span class="op" id="1623262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623265">mp</span><span class="op" id="1623267">.</span><span class="ident" id="1623268">ptrarg</span><span class="op" id="1623274">[</span><span class="num" id="1623275">0</span><span class="op" id="1623276">]</span>&nbsp;<span class="op" id="1623278">=</span>&nbsp;<span class="ident" id="1623280">unsafe</span><span class="op" id="1623286">.</span><span class="ident" id="1623287">Pointer</span><span class="op" id="1623294">(</span><span class="ident" id="1623295">gp</span><span class="op" id="1623297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623300">mp</span><span class="op" id="1623302">.</span><span class="ident" id="1623303">scalararg</span><span class="op" id="1623312">[</span><span class="num" id="1623313">0</span><span class="op" id="1623314">]</span>&nbsp;<span class="op" id="1623316">=</span>&nbsp;<span class="ident" id="1623318">getcallerpc</span><span class="op" id="1623329">(</span><span class="op" id="1623330">(</span><span class="ident" id="1623331">unsafe</span><span class="op" id="1623337">.</span><span class="ident" id="1623338">Pointer</span><span class="op" id="1623345">)</span><span class="op" id="1623346">(</span><span class="op" id="1623347">&amp;</span><span class="ident" id="1623348">unused</span><span class="op" id="1623354">)</span><span class="op" id="1623355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623358">mp</span><span class="op" id="1623360">.</span><span class="ident" id="1623361">scalararg</span><span class="op" id="1623370">[</span><span class="num" id="1623371">1</span><span class="op" id="1623372">]</span>&nbsp;<span class="op" id="1623374">=</span>&nbsp;<span class="ident" id="1623376">getcallersp</span><span class="op" id="1623387">(</span><span class="op" id="1623388">(</span><span class="ident" id="1623389">unsafe</span><span class="op" id="1623395">.</span><span class="ident" id="1623396">Pointer</span><span class="op" id="1623403">)</span><span class="op" id="1623404">(</span><span class="op" id="1623405">&amp;</span><span class="ident" id="1623406">unused</span><span class="op" id="1623412">)</span><span class="op" id="1623413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623416">onM_signalok</span><span class="op" id="1623428">(</span><span class="ident" id="1623429">dopanic_m</span><span class="op" id="1623438">)</span>&nbsp;<span class="comment" id="1623440">//&nbsp;should&nbsp;never&nbsp;return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623464">*</span><span class="op" id="1623465">(</span><span class="op" id="1623466">*</span><span class="builtintype" id="1623467">int</span><span class="op" id="1623470">)</span><span class="op" id="1623471">(</span><span class="builtintype" id="1623472">nil</span><span class="op" id="1623475">)</span>&nbsp;<span class="op" id="1623477">=</span>&nbsp;<span class="num" id="1623479">0</span><br>
<span class="lineno"></span><span class="op" id="1623481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1623484">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1623497">func</span>&nbsp;<span class="ident" id="1623502">throw</span><span class="op" id="1623507">(</span><span class="ident" id="1623508">s</span>&nbsp;<span class="op" id="1623510">*</span><span class="builtintype" id="1623511">byte</span><span class="op" id="1623515">)</span>&nbsp;<span class="op" id="1623517">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623520">gp</span>&nbsp;<span class="op" id="1623523">:=</span>&nbsp;<span class="ident" id="1623526">getg</span><span class="op" id="1623530">(</span><span class="op" id="1623531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623534">if</span>&nbsp;<span class="ident" id="1623537">gp</span><span class="op" id="1623539">.</span><span class="ident" id="1623540">m</span><span class="op" id="1623541">.</span><span class="ident" id="1623542">throwing</span>&nbsp;<span class="op" id="1623551">==</span>&nbsp;<span class="num" id="1623554">0</span>&nbsp;<span class="op" id="1623556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623560">gp</span><span class="op" id="1623562">.</span><span class="ident" id="1623563">m</span><span class="op" id="1623564">.</span><span class="ident" id="1623565">throwing</span>&nbsp;<span class="op" id="1623574">=</span>&nbsp;<span class="num" id="1623576">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623582">startpanic</span><span class="op" id="1623592">(</span><span class="op" id="1623593">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1623596">print</span><span class="op" id="1623601">(</span><span class="string" id="1623602">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1623617">,</span>&nbsp;<span class="ident" id="1623619">gostringnocopy</span><span class="op" id="1623633">(</span><span class="ident" id="1623634">s</span><span class="op" id="1623635">)</span><span class="op" id="1623636">,</span>&nbsp;<span class="string" id="1623638">&#34;\n&#34;</span><span class="op" id="1623642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623645">dopanic</span><span class="op" id="1623652">(</span><span class="num" id="1623653">0</span><span class="op" id="1623654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623657">*</span><span class="op" id="1623658">(</span><span class="op" id="1623659">*</span><span class="builtintype" id="1623660">int</span><span class="op" id="1623663">)</span><span class="op" id="1623664">(</span><span class="builtintype" id="1623665">nil</span><span class="op" id="1623668">)</span>&nbsp;<span class="op" id="1623670">=</span>&nbsp;<span class="num" id="1623672">0</span>&nbsp;<span class="comment" id="1623674">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno"></span><span class="op" id="1623689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="1623692">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1623705">func</span>&nbsp;<span class="ident" id="1623710">gothrow</span><span class="op" id="1623717">(</span><span class="ident" id="1623718">s</span>&nbsp;<span class="builtintype" id="1623720">string</span><span class="op" id="1623726">)</span>&nbsp;<span class="op" id="1623728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623731">gp</span>&nbsp;<span class="op" id="1623734">:=</span>&nbsp;<span class="ident" id="1623737">getg</span><span class="op" id="1623741">(</span><span class="op" id="1623742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1623745">if</span>&nbsp;<span class="ident" id="1623748">gp</span><span class="op" id="1623750">.</span><span class="ident" id="1623751">m</span><span class="op" id="1623752">.</span><span class="ident" id="1623753">throwing</span>&nbsp;<span class="op" id="1623762">==</span>&nbsp;<span class="num" id="1623765">0</span>&nbsp;<span class="op" id="1623767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623771">gp</span><span class="op" id="1623773">.</span><span class="ident" id="1623774">m</span><span class="op" id="1623775">.</span><span class="ident" id="1623776">throwing</span>&nbsp;<span class="op" id="1623785">=</span>&nbsp;<span class="num" id="1623787">1</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623793">startpanic</span><span class="op" id="1623803">(</span><span class="op" id="1623804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1623807">print</span><span class="op" id="1623812">(</span><span class="string" id="1623813">&#34;fatal&nbsp;error:&nbsp;&#34;</span><span class="op" id="1623828">,</span>&nbsp;<span class="ident" id="1623830">s</span><span class="op" id="1623831">,</span>&nbsp;<span class="string" id="1623833">&#34;\n&#34;</span><span class="op" id="1623837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1623840">dopanic</span><span class="op" id="1623847">(</span><span class="num" id="1623848">0</span><span class="op" id="1623849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1623852">*</span><span class="op" id="1623853">(</span><span class="op" id="1623854">*</span><span class="builtintype" id="1623855">int</span><span class="op" id="1623858">)</span><span class="op" id="1623859">(</span><span class="builtintype" id="1623860">nil</span><span class="op" id="1623863">)</span>&nbsp;<span class="op" id="1623865">=</span>&nbsp;<span class="num" id="1623867">0</span>&nbsp;<span class="comment" id="1623869">//&nbsp;not&nbsp;reached</span><br>
<span class="lineno">505</span><span class="op" id="1623884">}</span>
</div>
</body>
</html>
