<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html" class="current">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4557755">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4557810">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4557864">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4557915">package</span>&nbsp;<span class="ident" id="4557923">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4557928">import</span>&nbsp;<span class="op" id="4557935">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4557938">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4557948">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4557964">&#34;crypto/elliptic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4557983">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4557997">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558011">&#34;crypto/sha1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558026">&#34;crypto/sha256&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558043">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558058">&#34;encoding/asn1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558075">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558085">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4558091">&#34;math/big&#34;</span><br>
<span class="lineno">20</span><span class="op" id="4558102">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4558105">var</span>&nbsp;<span class="ident" id="4558109">errClientKeyExchange</span>&nbsp;<span class="op" id="4558130">=</span>&nbsp;<span class="ident" id="4558132"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4558138">.</span><span class="ident" id="4558139"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4558142">(</span><span class="string" id="4558143">&#34;tls:&nbsp;invalid&nbsp;ClientKeyExchange&nbsp;message&#34;</span><span class="op" id="4558183">)</span><br>
<span class="lineno"></span><span class="keyword" id="4558185">var</span>&nbsp;<span class="ident" id="4558189">errServerKeyExchange</span>&nbsp;<span class="op" id="4558210">=</span>&nbsp;<span class="ident" id="4558212"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4558218">.</span><span class="ident" id="4558219"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4558222">(</span><span class="string" id="4558223">&#34;tls:&nbsp;invalid&nbsp;ServerKeyExchange&nbsp;message&#34;</span><span class="op" id="4558263">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4558266">//&nbsp;rsaKeyAgreement&nbsp;implements&nbsp;the&nbsp;standard&nbsp;TLS&nbsp;key&nbsp;agreement&nbsp;where&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span><span class="comment" id="4558344">//&nbsp;encrypts&nbsp;the&nbsp;pre-master&nbsp;secret&nbsp;to&nbsp;the&nbsp;server&#39;s&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4558406">type</span>&nbsp;<span class="ident" id="4558411">rsaKeyAgreement</span>&nbsp;<span class="keyword" id="4558427">struct</span><span class="op" id="4558433">{</span><span class="op" id="4558434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4558437">func</span>&nbsp;<span class="op" id="4558442">(</span><span class="ident" id="4558443">ka</span>&nbsp;<span class="ident" id="4558446"><a href="/gostd/crypto/tls/key_agreement.go.html#4558411">rsaKeyAgreement</a></span><span class="op" id="4558461">)</span>&nbsp;<span class="ident" id="4558463">generateServerKeyExchange</span><span class="op" id="4558488">(</span><span class="ident" id="4558489">config</span>&nbsp;<span class="op" id="4558496">*</span><span class="ident" id="4558497"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4558503">,</span>&nbsp;<span class="ident" id="4558505">cert</span>&nbsp;<span class="op" id="4558510">*</span><span class="ident" id="4558511"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4558522">,</span>&nbsp;<span class="ident" id="4558524">clientHello</span>&nbsp;<span class="op" id="4558536">*</span><span class="ident" id="4558537"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4558551">,</span>&nbsp;<span class="ident" id="4558553">hello</span>&nbsp;<span class="op" id="4558559">*</span><span class="ident" id="4558560"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="4558574">)</span>&nbsp;<span class="op" id="4558576">(</span><span class="op" id="4558577">*</span><span class="ident" id="4558578"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526463">serverKeyExchangeMsg</a></span><span class="op" id="4558598">,</span>&nbsp;<span class="builtintype" id="4558600">error</span><span class="op" id="4558605">)</span>&nbsp;<span class="op" id="4558607">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558610">return</span>&nbsp;<span class="builtintype" id="4558617">nil</span><span class="op" id="4558620">,</span>&nbsp;<span class="builtintype" id="4558622">nil</span><br>
<span class="lineno"></span><span class="op" id="4558626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4558629">func</span>&nbsp;<span class="op" id="4558634">(</span><span class="ident" id="4558635">ka</span>&nbsp;<span class="ident" id="4558638"><a href="/gostd/crypto/tls/key_agreement.go.html#4558411">rsaKeyAgreement</a></span><span class="op" id="4558653">)</span>&nbsp;<span class="ident" id="4558655">processClientKeyExchange</span><span class="op" id="4558679">(</span><span class="ident" id="4558680">config</span>&nbsp;<span class="op" id="4558687">*</span><span class="ident" id="4558688"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4558694">,</span>&nbsp;<span class="ident" id="4558696">cert</span>&nbsp;<span class="op" id="4558701">*</span><span class="ident" id="4558702"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4558713">,</span>&nbsp;<span class="ident" id="4558715">ckx</span>&nbsp;<span class="op" id="4558719">*</span><span class="ident" id="4558720"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4558740">,</span>&nbsp;<span class="ident" id="4558742">version</span>&nbsp;<span class="builtintype" id="4558750">uint16</span><span class="op" id="4558756">)</span>&nbsp;<span class="op" id="4558758">(</span><span class="op" id="4558759">[</span><span class="op" id="4558760">]</span><span class="builtintype" id="4558761">byte</span><span class="op" id="4558765">,</span>&nbsp;<span class="builtintype" id="4558767">error</span><span class="op" id="4558772">)</span>&nbsp;<span class="op" id="4558774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558777">preMasterSecret</span>&nbsp;<span class="op" id="4558793">:=</span>&nbsp;<span class="builtinfunc" id="4558796">make</span><span class="op" id="4558800">(</span><span class="op" id="4558801">[</span><span class="op" id="4558802">]</span><span class="builtintype" id="4558803">byte</span><span class="op" id="4558807">,</span>&nbsp;<span class="num" id="4558809">48</span><span class="op" id="4558811">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558814">_</span><span class="op" id="4558815">,</span>&nbsp;<span class="ident" id="4558817">err</span>&nbsp;<span class="op" id="4558821">:=</span>&nbsp;<span class="ident" id="4558824"><a href="/gostd/crypto/tls/key_agreement.go.html#4558085">io</a></span><span class="op" id="4558826">.</span><span class="ident" id="4558827"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4558835">(</span><span class="ident" id="4558836"><a href="/gostd/crypto/tls/key_agreement.go.html#4558680">config</a></span><span class="op" id="4558842">.</span><span class="ident" id="4558843"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4558847">(</span><span class="op" id="4558848">)</span><span class="op" id="4558849">,</span>&nbsp;<span class="ident" id="4558851"><a href="/gostd/crypto/tls/key_agreement.go.html#4558777">preMasterSecret</a></span><span class="op" id="4558866">[</span><span class="num" id="4558867">2</span><span class="op" id="4558868">:</span><span class="op" id="4558869">]</span><span class="op" id="4558870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558873">if</span>&nbsp;<span class="ident" id="4558876"><a href="/gostd/crypto/tls/key_agreement.go.html#4558817">err</a></span>&nbsp;<span class="op" id="4558880">!=</span>&nbsp;<span class="builtintype" id="4558883">nil</span>&nbsp;<span class="op" id="4558887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558891">return</span>&nbsp;<span class="builtintype" id="4558898">nil</span><span class="op" id="4558901">,</span>&nbsp;<span class="ident" id="4558903"><a href="/gostd/crypto/tls/key_agreement.go.html#4558817">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558912">if</span>&nbsp;<span class="builtinfunc" id="4558915">len</span><span class="op" id="4558918">(</span><span class="ident" id="4558919"><a href="/gostd/crypto/tls/key_agreement.go.html#4558715">ckx</a></span><span class="op" id="4558922">.</span><span class="ident" id="4558923"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4558933">)</span>&nbsp;<span class="op" id="4558935">&lt;</span>&nbsp;<span class="num" id="4558937">2</span>&nbsp;<span class="op" id="4558939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4558943">return</span>&nbsp;<span class="builtintype" id="4558950">nil</span><span class="op" id="4558953">,</span>&nbsp;<span class="ident" id="4558955"><a href="/gostd/crypto/tls/key_agreement.go.html#4558109">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4558977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4558981">ciphertext</span>&nbsp;<span class="op" id="4558992">:=</span>&nbsp;<span class="ident" id="4558995"><a href="/gostd/crypto/tls/key_agreement.go.html#4558715">ckx</a></span><span class="op" id="4558998">.</span><span class="ident" id="4558999"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559011">if</span>&nbsp;<span class="ident" id="4559014"><a href="/gostd/crypto/tls/key_agreement.go.html#4558742">version</a></span>&nbsp;<span class="op" id="4559022">!=</span>&nbsp;<span class="ident" id="4559025"><a href="/gostd/crypto/tls/common.go.html#4442440">VersionSSL30</a></span>&nbsp;<span class="op" id="4559038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559042">ciphertextLen</span>&nbsp;<span class="op" id="4559056">:=</span>&nbsp;<span class="builtintype" id="4559059">int</span><span class="op" id="4559062">(</span><span class="ident" id="4559063"><a href="/gostd/crypto/tls/key_agreement.go.html#4558715">ckx</a></span><span class="op" id="4559066">.</span><span class="ident" id="4559067"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4559077">[</span><span class="num" id="4559078">0</span><span class="op" id="4559079">]</span><span class="op" id="4559080">)</span><span class="op" id="4559081">&lt;&lt;</span><span class="num" id="4559083">8</span>&nbsp;<span class="op" id="4559085">|</span>&nbsp;<span class="builtintype" id="4559087">int</span><span class="op" id="4559090">(</span><span class="ident" id="4559091"><a href="/gostd/crypto/tls/key_agreement.go.html#4558715">ckx</a></span><span class="op" id="4559094">.</span><span class="ident" id="4559095"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4559105">[</span><span class="num" id="4559106">1</span><span class="op" id="4559107">]</span><span class="op" id="4559108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559112">if</span>&nbsp;<span class="ident" id="4559115"><a href="/gostd/crypto/tls/key_agreement.go.html#4559042">ciphertextLen</a></span>&nbsp;<span class="op" id="4559129">!=</span>&nbsp;<span class="builtinfunc" id="4559132">len</span><span class="op" id="4559135">(</span><span class="ident" id="4559136"><a href="/gostd/crypto/tls/key_agreement.go.html#4558715">ckx</a></span><span class="op" id="4559139">.</span><span class="ident" id="4559140"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4559150">)</span><span class="op" id="4559151">-</span><span class="num" id="4559152">2</span>&nbsp;<span class="op" id="4559154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559159">return</span>&nbsp;<span class="builtintype" id="4559166">nil</span><span class="op" id="4559169">,</span>&nbsp;<span class="ident" id="4559171"><a href="/gostd/crypto/tls/key_agreement.go.html#4558109">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559194">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559198"><a href="/gostd/crypto/tls/key_agreement.go.html#4558981">ciphertext</a></span>&nbsp;<span class="op" id="4559209">=</span>&nbsp;<span class="ident" id="4559211"><a href="/gostd/crypto/tls/key_agreement.go.html#4558715">ckx</a></span><span class="op" id="4559214">.</span><span class="ident" id="4559215"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4559225">[</span><span class="num" id="4559226">2</span><span class="op" id="4559227">:</span><span class="op" id="4559228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4559235"><a href="/gostd/crypto/tls/key_agreement.go.html#4558817">err</a></span>&nbsp;<span class="op" id="4559239">=</span>&nbsp;<span class="ident" id="4559241"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4559244">.</span><span class="ident" id="4559245"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4726989">DecryptPKCS1v15SessionKey</a></span><span class="op" id="4559270">(</span><span class="ident" id="4559271"><a href="/gostd/crypto/tls/key_agreement.go.html#4558680">config</a></span><span class="op" id="4559277">.</span><span class="ident" id="4559278"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4559282">(</span><span class="op" id="4559283">)</span><span class="op" id="4559284">,</span>&nbsp;<span class="ident" id="4559286"><a href="/gostd/crypto/tls/key_agreement.go.html#4558696">cert</a></span><span class="op" id="4559290">.</span><span class="ident" id="4559291"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4559301">.</span><span class="op" id="4559302">(</span><span class="op" id="4559303">*</span><span class="ident" id="4559304"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4559307">.</span><span class="ident" id="4559308"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4559318">)</span><span class="op" id="4559319">,</span>&nbsp;<span class="ident" id="4559321"><a href="/gostd/crypto/tls/key_agreement.go.html#4558981">ciphertext</a></span><span class="op" id="4559331">,</span>&nbsp;<span class="ident" id="4559333"><a href="/gostd/crypto/tls/key_agreement.go.html#4558777">preMasterSecret</a></span><span class="op" id="4559348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559351">if</span>&nbsp;<span class="ident" id="4559354"><a href="/gostd/crypto/tls/key_agreement.go.html#4558817">err</a></span>&nbsp;<span class="op" id="4559358">!=</span>&nbsp;<span class="builtintype" id="4559361">nil</span>&nbsp;<span class="op" id="4559365">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559369">return</span>&nbsp;<span class="builtintype" id="4559376">nil</span><span class="op" id="4559379">,</span>&nbsp;<span class="ident" id="4559381"><a href="/gostd/crypto/tls/key_agreement.go.html#4558817">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4559386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559389">//&nbsp;We&nbsp;don&#39;t&nbsp;check&nbsp;the&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;premaster&nbsp;secret.&nbsp;&nbsp;For&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559462">//&nbsp;by&nbsp;checking&nbsp;it,&nbsp;we&nbsp;would&nbsp;leak&nbsp;information&nbsp;about&nbsp;the&nbsp;validity&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559534">//&nbsp;encrypted&nbsp;pre-master&nbsp;secret.&nbsp;Secondly,&nbsp;it&nbsp;provides&nbsp;only&nbsp;a&nbsp;small</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559602">//&nbsp;benefit&nbsp;against&nbsp;a&nbsp;downgrade&nbsp;attack&nbsp;and&nbsp;some&nbsp;implementations&nbsp;send&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559675">//&nbsp;wrong&nbsp;version&nbsp;anyway.&nbsp;See&nbsp;the&nbsp;discussion&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4559742">//&nbsp;7.4.7.1&nbsp;of&nbsp;RFC&nbsp;4346.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559767">return</span>&nbsp;<span class="ident" id="4559774"><a href="/gostd/crypto/tls/key_agreement.go.html#4558777">preMasterSecret</a></span><span class="op" id="4559789">,</span>&nbsp;<span class="builtintype" id="4559791">nil</span><br>
<span class="lineno"></span><span class="op" id="4559795">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="4559798">func</span>&nbsp;<span class="op" id="4559803">(</span><span class="ident" id="4559804">ka</span>&nbsp;<span class="ident" id="4559807"><a href="/gostd/crypto/tls/key_agreement.go.html#4558411">rsaKeyAgreement</a></span><span class="op" id="4559822">)</span>&nbsp;<span class="ident" id="4559824">processServerKeyExchange</span><span class="op" id="4559848">(</span><span class="ident" id="4559849">config</span>&nbsp;<span class="op" id="4559856">*</span><span class="ident" id="4559857"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4559863">,</span>&nbsp;<span class="ident" id="4559865">clientHello</span>&nbsp;<span class="op" id="4559877">*</span><span class="ident" id="4559878"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4559892">,</span>&nbsp;<span class="ident" id="4559894">serverHello</span>&nbsp;<span class="op" id="4559906">*</span><span class="ident" id="4559907"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="4559921">,</span>&nbsp;<span class="ident" id="4559923">cert</span>&nbsp;<span class="op" id="4559928">*</span><span class="ident" id="4559929"><a href="/gostd/crypto/tls/key_agreement.go.html#4558043">x509</a></span><span class="op" id="4559933">.</span><span class="ident" id="4559934"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><span class="op" id="4559945">,</span>&nbsp;<span class="ident" id="4559947">skx</span>&nbsp;<span class="op" id="4559951">*</span><span class="ident" id="4559952"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526463">serverKeyExchangeMsg</a></span><span class="op" id="4559972">)</span>&nbsp;<span class="builtintype" id="4559974">error</span>&nbsp;<span class="op" id="4559980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4559983">return</span>&nbsp;<span class="ident" id="4559990"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4559996">.</span><span class="ident" id="4559997"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4560000">(</span><span class="string" id="4560001">&#34;tls:&nbsp;unexpected&nbsp;ServerKeyExchange&#34;</span><span class="op" id="4560036">)</span><br>
<span class="lineno"></span><span class="op" id="4560038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4560041">func</span>&nbsp;<span class="op" id="4560046">(</span><span class="ident" id="4560047">ka</span>&nbsp;<span class="ident" id="4560050"><a href="/gostd/crypto/tls/key_agreement.go.html#4558411">rsaKeyAgreement</a></span><span class="op" id="4560065">)</span>&nbsp;<span class="ident" id="4560067">generateClientKeyExchange</span><span class="op" id="4560092">(</span><span class="ident" id="4560093">config</span>&nbsp;<span class="op" id="4560100">*</span><span class="ident" id="4560101"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4560107">,</span>&nbsp;<span class="ident" id="4560109">clientHello</span>&nbsp;<span class="op" id="4560121">*</span><span class="ident" id="4560122"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4560136">,</span>&nbsp;<span class="ident" id="4560138">cert</span>&nbsp;<span class="op" id="4560143">*</span><span class="ident" id="4560144"><a href="/gostd/crypto/tls/key_agreement.go.html#4558043">x509</a></span><span class="op" id="4560148">.</span><span class="ident" id="4560149"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><span class="op" id="4560160">)</span>&nbsp;<span class="op" id="4560162">(</span><span class="op" id="4560163">[</span><span class="op" id="4560164">]</span><span class="builtintype" id="4560165">byte</span><span class="op" id="4560169">,</span>&nbsp;<span class="op" id="4560171">*</span><span class="ident" id="4560172"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4560192">,</span>&nbsp;<span class="builtintype" id="4560194">error</span><span class="op" id="4560199">)</span>&nbsp;<span class="op" id="4560201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560204">preMasterSecret</span>&nbsp;<span class="op" id="4560220">:=</span>&nbsp;<span class="builtinfunc" id="4560223">make</span><span class="op" id="4560227">(</span><span class="op" id="4560228">[</span><span class="op" id="4560229">]</span><span class="builtintype" id="4560230">byte</span><span class="op" id="4560234">,</span>&nbsp;<span class="num" id="4560236">48</span><span class="op" id="4560238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560241"><a href="/gostd/crypto/tls/key_agreement.go.html#4560204">preMasterSecret</a></span><span class="op" id="4560256">[</span><span class="num" id="4560257">0</span><span class="op" id="4560258">]</span>&nbsp;<span class="op" id="4560260">=</span>&nbsp;<span class="builtintype" id="4560262">byte</span><span class="op" id="4560266">(</span><span class="ident" id="4560267"><a href="/gostd/crypto/tls/key_agreement.go.html#4560109">clientHello</a></span><span class="op" id="4560278">.</span><span class="ident" id="4560279"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span>&nbsp;<span class="op" id="4560284">&gt;&gt;</span>&nbsp;<span class="num" id="4560287">8</span><span class="op" id="4560288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560291"><a href="/gostd/crypto/tls/key_agreement.go.html#4560204">preMasterSecret</a></span><span class="op" id="4560306">[</span><span class="num" id="4560307">1</span><span class="op" id="4560308">]</span>&nbsp;<span class="op" id="4560310">=</span>&nbsp;<span class="builtintype" id="4560312">byte</span><span class="op" id="4560316">(</span><span class="ident" id="4560317"><a href="/gostd/crypto/tls/key_agreement.go.html#4560109">clientHello</a></span><span class="op" id="4560328">.</span><span class="ident" id="4560329"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508319">vers</a></span><span class="op" id="4560333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560336">_</span><span class="op" id="4560337">,</span>&nbsp;<span class="ident" id="4560339">err</span>&nbsp;<span class="op" id="4560343">:=</span>&nbsp;<span class="ident" id="4560346"><a href="/gostd/crypto/tls/key_agreement.go.html#4558085">io</a></span><span class="op" id="4560348">.</span><span class="ident" id="4560349"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4560357">(</span><span class="ident" id="4560358"><a href="/gostd/crypto/tls/key_agreement.go.html#4560093">config</a></span><span class="op" id="4560364">.</span><span class="ident" id="4560365"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4560369">(</span><span class="op" id="4560370">)</span><span class="op" id="4560371">,</span>&nbsp;<span class="ident" id="4560373"><a href="/gostd/crypto/tls/key_agreement.go.html#4560204">preMasterSecret</a></span><span class="op" id="4560388">[</span><span class="num" id="4560389">2</span><span class="op" id="4560390">:</span><span class="op" id="4560391">]</span><span class="op" id="4560392">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560395">if</span>&nbsp;<span class="ident" id="4560398"><a href="/gostd/crypto/tls/key_agreement.go.html#4560339">err</a></span>&nbsp;<span class="op" id="4560402">!=</span>&nbsp;<span class="builtintype" id="4560405">nil</span>&nbsp;<span class="op" id="4560409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560413">return</span>&nbsp;<span class="builtintype" id="4560420">nil</span><span class="op" id="4560423">,</span>&nbsp;<span class="builtintype" id="4560425">nil</span><span class="op" id="4560428">,</span>&nbsp;<span class="ident" id="4560430"><a href="/gostd/crypto/tls/key_agreement.go.html#4560339">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560439">encrypted</span><span class="op" id="4560448">,</span>&nbsp;<span class="ident" id="4560450"><a href="/gostd/crypto/tls/key_agreement.go.html#4560339">err</a></span>&nbsp;<span class="op" id="4560454">:=</span>&nbsp;<span class="ident" id="4560457"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4560460">.</span><span class="ident" id="4560461"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724961">EncryptPKCS1v15</a></span><span class="op" id="4560476">(</span><span class="ident" id="4560477"><a href="/gostd/crypto/tls/key_agreement.go.html#4560093">config</a></span><span class="op" id="4560483">.</span><span class="ident" id="4560484"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4560488">(</span><span class="op" id="4560489">)</span><span class="op" id="4560490">,</span>&nbsp;<span class="ident" id="4560492"><a href="/gostd/crypto/tls/key_agreement.go.html#4560138">cert</a></span><span class="op" id="4560496">.</span><span class="ident" id="4560497"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4560506">.</span><span class="op" id="4560507">(</span><span class="op" id="4560508">*</span><span class="ident" id="4560509"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4560512">.</span><span class="ident" id="4560513"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4560522">)</span><span class="op" id="4560523">,</span>&nbsp;<span class="ident" id="4560525"><a href="/gostd/crypto/tls/key_agreement.go.html#4560204">preMasterSecret</a></span><span class="op" id="4560540">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560543">if</span>&nbsp;<span class="ident" id="4560546"><a href="/gostd/crypto/tls/key_agreement.go.html#4560339">err</a></span>&nbsp;<span class="op" id="4560550">!=</span>&nbsp;<span class="builtintype" id="4560553">nil</span>&nbsp;<span class="op" id="4560557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560561">return</span>&nbsp;<span class="builtintype" id="4560568">nil</span><span class="op" id="4560571">,</span>&nbsp;<span class="builtintype" id="4560573">nil</span><span class="op" id="4560576">,</span>&nbsp;<span class="ident" id="4560578"><a href="/gostd/crypto/tls/key_agreement.go.html#4560339">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4560583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560586">ckx</span>&nbsp;<span class="op" id="4560590">:=</span>&nbsp;<span class="builtinfunc" id="4560593">new</span><span class="op" id="4560596">(</span><span class="ident" id="4560597"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4560617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560620"><a href="/gostd/crypto/tls/key_agreement.go.html#4560586">ckx</a></span><span class="op" id="4560623">.</span><span class="ident" id="4560624"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span>&nbsp;<span class="op" id="4560635">=</span>&nbsp;<span class="builtinfunc" id="4560637">make</span><span class="op" id="4560641">(</span><span class="op" id="4560642">[</span><span class="op" id="4560643">]</span><span class="builtintype" id="4560644">byte</span><span class="op" id="4560648">,</span>&nbsp;<span class="builtinfunc" id="4560650">len</span><span class="op" id="4560653">(</span><span class="ident" id="4560654"><a href="/gostd/crypto/tls/key_agreement.go.html#4560439">encrypted</a></span><span class="op" id="4560663">)</span><span class="op" id="4560664">+</span><span class="num" id="4560665">2</span><span class="op" id="4560666">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560669"><a href="/gostd/crypto/tls/key_agreement.go.html#4560586">ckx</a></span><span class="op" id="4560672">.</span><span class="ident" id="4560673"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4560683">[</span><span class="num" id="4560684">0</span><span class="op" id="4560685">]</span>&nbsp;<span class="op" id="4560687">=</span>&nbsp;<span class="builtintype" id="4560689">byte</span><span class="op" id="4560693">(</span><span class="builtinfunc" id="4560694">len</span><span class="op" id="4560697">(</span><span class="ident" id="4560698"><a href="/gostd/crypto/tls/key_agreement.go.html#4560439">encrypted</a></span><span class="op" id="4560707">)</span>&nbsp;<span class="op" id="4560709">&gt;&gt;</span>&nbsp;<span class="num" id="4560712">8</span><span class="op" id="4560713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560716"><a href="/gostd/crypto/tls/key_agreement.go.html#4560586">ckx</a></span><span class="op" id="4560719">.</span><span class="ident" id="4560720"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4560730">[</span><span class="num" id="4560731">1</span><span class="op" id="4560732">]</span>&nbsp;<span class="op" id="4560734">=</span>&nbsp;<span class="builtintype" id="4560736">byte</span><span class="op" id="4560740">(</span><span class="builtinfunc" id="4560741">len</span><span class="op" id="4560744">(</span><span class="ident" id="4560745"><a href="/gostd/crypto/tls/key_agreement.go.html#4560439">encrypted</a></span><span class="op" id="4560754">)</span><span class="op" id="4560755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4560758">copy</span><span class="op" id="4560762">(</span><span class="ident" id="4560763"><a href="/gostd/crypto/tls/key_agreement.go.html#4560586">ckx</a></span><span class="op" id="4560766">.</span><span class="ident" id="4560767"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4560777">[</span><span class="num" id="4560778">2</span><span class="op" id="4560779">:</span><span class="op" id="4560780">]</span><span class="op" id="4560781">,</span>&nbsp;<span class="ident" id="4560783"><a href="/gostd/crypto/tls/key_agreement.go.html#4560439">encrypted</a></span><span class="op" id="4560792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560795">return</span>&nbsp;<span class="ident" id="4560802"><a href="/gostd/crypto/tls/key_agreement.go.html#4560204">preMasterSecret</a></span><span class="op" id="4560817">,</span>&nbsp;<span class="ident" id="4560819"><a href="/gostd/crypto/tls/key_agreement.go.html#4560586">ckx</a></span><span class="op" id="4560822">,</span>&nbsp;<span class="builtintype" id="4560824">nil</span><br>
<span class="lineno"></span><span class="op" id="4560828">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4560831">//&nbsp;sha1Hash&nbsp;calculates&nbsp;a&nbsp;SHA1&nbsp;hash&nbsp;over&nbsp;the&nbsp;given&nbsp;byte&nbsp;slices.</span><br>
<span class="lineno"></span><span class="keyword" id="4560894">func</span>&nbsp;<span class="ident" id="4560899">sha1Hash</span><span class="op" id="4560907">(</span><span class="ident" id="4560908">slices</span>&nbsp;<span class="op" id="4560915">[</span><span class="op" id="4560916">]</span><span class="op" id="4560917">[</span><span class="op" id="4560918">]</span><span class="builtintype" id="4560919">byte</span><span class="op" id="4560923">)</span>&nbsp;<span class="op" id="4560925">[</span><span class="op" id="4560926">]</span><span class="builtintype" id="4560927">byte</span>&nbsp;<span class="op" id="4560932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560935">hsha1</span>&nbsp;<span class="op" id="4560941">:=</span>&nbsp;<span class="ident" id="4560944"><a href="/gostd/crypto/tls/key_agreement.go.html#4558011">sha1</a></span><span class="op" id="4560948">.</span><span class="ident" id="4560949"><a href="/gostd/crypto/sha1/sha1.go.html#4609140">New</a></span><span class="op" id="4560952">(</span><span class="op" id="4560953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4560956">for</span>&nbsp;<span class="ident" id="4560960">_</span><span class="op" id="4560961">,</span>&nbsp;<span class="ident" id="4560963">slice</span>&nbsp;<span class="op" id="4560969">:=</span>&nbsp;<span class="keyword" id="4560972">range</span>&nbsp;<span class="ident" id="4560978"><a href="/gostd/crypto/tls/key_agreement.go.html#4560908">slices</a></span>&nbsp;<span class="op" id="4560985">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4560989"><a href="/gostd/crypto/tls/key_agreement.go.html#4560935">hsha1</a></span><span class="op" id="4560994">.</span><span class="ident" id="4560995"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="4561000">(</span><span class="ident" id="4561001"><a href="/gostd/crypto/tls/key_agreement.go.html#4560963">slice</a></span><span class="op" id="4561006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4561009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561012">return</span>&nbsp;<span class="ident" id="4561019"><a href="/gostd/crypto/tls/key_agreement.go.html#4560935">hsha1</a></span><span class="op" id="4561024">.</span><span class="ident" id="4561025"><a href="/gostd/hash/hash.go.html#3014372">Sum</a></span><span class="op" id="4561028">(</span><span class="builtintype" id="4561029">nil</span><span class="op" id="4561032">)</span><br>
<span class="lineno"></span><span class="op" id="4561034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="4561037">//&nbsp;md5SHA1Hash&nbsp;implements&nbsp;TLS&nbsp;1.0&#39;s&nbsp;hybrid&nbsp;hash&nbsp;function&nbsp;which&nbsp;consists&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4561116">//&nbsp;concatenation&nbsp;of&nbsp;an&nbsp;MD5&nbsp;and&nbsp;SHA1&nbsp;hash.</span><br>
<span class="lineno"></span><span class="keyword" id="4561158">func</span>&nbsp;<span class="ident" id="4561163">md5SHA1Hash</span><span class="op" id="4561174">(</span><span class="ident" id="4561175">slices</span>&nbsp;<span class="op" id="4561182">[</span><span class="op" id="4561183">]</span><span class="op" id="4561184">[</span><span class="op" id="4561185">]</span><span class="builtintype" id="4561186">byte</span><span class="op" id="4561190">)</span>&nbsp;<span class="op" id="4561192">[</span><span class="op" id="4561193">]</span><span class="builtintype" id="4561194">byte</span>&nbsp;<span class="op" id="4561199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4561202">md5sha1</span>&nbsp;<span class="op" id="4561210">:=</span>&nbsp;<span class="builtinfunc" id="4561213">make</span><span class="op" id="4561217">(</span><span class="op" id="4561218">[</span><span class="op" id="4561219">]</span><span class="builtintype" id="4561220">byte</span><span class="op" id="4561224">,</span>&nbsp;<span class="ident" id="4561226"><a href="/gostd/crypto/tls/key_agreement.go.html#4557983">md5</a></span><span class="op" id="4561229">.</span><span class="ident" id="4561230"><a href="/gostd/crypto/md5/md5.go.html#4710344">Size</a></span><span class="op" id="4561234">+</span><span class="ident" id="4561235"><a href="/gostd/crypto/tls/key_agreement.go.html#4558011">sha1</a></span><span class="op" id="4561239">.</span><span class="ident" id="4561240"><a href="/gostd/crypto/sha1/sha1.go.html#4608617">Size</a></span><span class="op" id="4561244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4561247">hmd5</span>&nbsp;<span class="op" id="4561252">:=</span>&nbsp;<span class="ident" id="4561255"><a href="/gostd/crypto/tls/key_agreement.go.html#4557983">md5</a></span><span class="op" id="4561258">.</span><span class="ident" id="4561259"><a href="/gostd/crypto/md5/md5.go.html#4710829">New</a></span><span class="op" id="4561262">(</span><span class="op" id="4561263">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561266">for</span>&nbsp;<span class="ident" id="4561270">_</span><span class="op" id="4561271">,</span>&nbsp;<span class="ident" id="4561273">slice</span>&nbsp;<span class="op" id="4561279">:=</span>&nbsp;<span class="keyword" id="4561282">range</span>&nbsp;<span class="ident" id="4561288"><a href="/gostd/crypto/tls/key_agreement.go.html#4561175">slices</a></span>&nbsp;<span class="op" id="4561295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4561299"><a href="/gostd/crypto/tls/key_agreement.go.html#4561247">hmd5</a></span><span class="op" id="4561303">.</span><span class="ident" id="4561304"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="4561309">(</span><span class="ident" id="4561310"><a href="/gostd/crypto/tls/key_agreement.go.html#4561273">slice</a></span><span class="op" id="4561315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4561318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4561321">copy</span><span class="op" id="4561325">(</span><span class="ident" id="4561326"><a href="/gostd/crypto/tls/key_agreement.go.html#4561202">md5sha1</a></span><span class="op" id="4561333">,</span>&nbsp;<span class="ident" id="4561335"><a href="/gostd/crypto/tls/key_agreement.go.html#4561247">hmd5</a></span><span class="op" id="4561339">.</span><span class="ident" id="4561340"><a href="/gostd/hash/hash.go.html#3014372">Sum</a></span><span class="op" id="4561343">(</span><span class="builtintype" id="4561344">nil</span><span class="op" id="4561347">)</span><span class="op" id="4561348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4561351">copy</span><span class="op" id="4561355">(</span><span class="ident" id="4561356"><a href="/gostd/crypto/tls/key_agreement.go.html#4561202">md5sha1</a></span><span class="op" id="4561363">[</span><span class="ident" id="4561364"><a href="/gostd/crypto/tls/key_agreement.go.html#4557983">md5</a></span><span class="op" id="4561367">.</span><span class="ident" id="4561368"><a href="/gostd/crypto/md5/md5.go.html#4710344">Size</a></span><span class="op" id="4561372">:</span><span class="op" id="4561373">]</span><span class="op" id="4561374">,</span>&nbsp;<span class="ident" id="4561376"><a href="/gostd/crypto/tls/key_agreement.go.html#4560899">sha1Hash</a></span><span class="op" id="4561384">(</span><span class="ident" id="4561385"><a href="/gostd/crypto/tls/key_agreement.go.html#4561175">slices</a></span><span class="op" id="4561391">)</span><span class="op" id="4561392">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561395">return</span>&nbsp;<span class="ident" id="4561402"><a href="/gostd/crypto/tls/key_agreement.go.html#4561202">md5sha1</a></span><br>
<span class="lineno"></span><span class="op" id="4561410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4561413">//&nbsp;sha256Hash&nbsp;implements&nbsp;TLS&nbsp;1.2&#39;s&nbsp;hash&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="4561463">func</span>&nbsp;<span class="ident" id="4561468">sha256Hash</span><span class="op" id="4561478">(</span><span class="ident" id="4561479">slices</span>&nbsp;<span class="op" id="4561486">[</span><span class="op" id="4561487">]</span><span class="op" id="4561488">[</span><span class="op" id="4561489">]</span><span class="builtintype" id="4561490">byte</span><span class="op" id="4561494">)</span>&nbsp;<span class="op" id="4561496">[</span><span class="op" id="4561497">]</span><span class="builtintype" id="4561498">byte</span>&nbsp;<span class="op" id="4561503">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4561506">h</span>&nbsp;<span class="op" id="4561508">:=</span>&nbsp;<span class="ident" id="4561511"><a href="/gostd/crypto/tls/key_agreement.go.html#4558026">sha256</a></span><span class="op" id="4561517">.</span><span class="ident" id="4561518"><a href="/gostd/crypto/sha256/sha256.go.html#4759893">New</a></span><span class="op" id="4561521">(</span><span class="op" id="4561522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561525">for</span>&nbsp;<span class="ident" id="4561529">_</span><span class="op" id="4561530">,</span>&nbsp;<span class="ident" id="4561532">slice</span>&nbsp;<span class="op" id="4561538">:=</span>&nbsp;<span class="keyword" id="4561541">range</span>&nbsp;<span class="ident" id="4561547"><a href="/gostd/crypto/tls/key_agreement.go.html#4561479">slices</a></span>&nbsp;<span class="op" id="4561554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4561558"><a href="/gostd/crypto/tls/key_agreement.go.html#4561506">h</a></span><span class="op" id="4561559">.</span><span class="ident" id="4561560"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="4561565">(</span><span class="ident" id="4561566"><a href="/gostd/crypto/tls/key_agreement.go.html#4561532">slice</a></span><span class="op" id="4561571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4561574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561577">return</span>&nbsp;<span class="ident" id="4561584"><a href="/gostd/crypto/tls/key_agreement.go.html#4561506">h</a></span><span class="op" id="4561585">.</span><span class="ident" id="4561586"><a href="/gostd/hash/hash.go.html#3014372">Sum</a></span><span class="op" id="4561589">(</span><span class="builtintype" id="4561590">nil</span><span class="op" id="4561593">)</span><br>
<span class="lineno">120</span><span class="op" id="4561595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4561598">//&nbsp;hashForServerKeyExchange&nbsp;hashes&nbsp;the&nbsp;given&nbsp;slices&nbsp;and&nbsp;returns&nbsp;their&nbsp;digest</span><br>
<span class="lineno"></span><span class="comment" id="4561675">//&nbsp;and&nbsp;the&nbsp;identifier&nbsp;of&nbsp;the&nbsp;hash&nbsp;function&nbsp;used.&nbsp;The&nbsp;hashFunc&nbsp;argument&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="4561754">//&nbsp;used&nbsp;for&nbsp;&gt;=&nbsp;TLS&nbsp;1.2&nbsp;and&nbsp;precisely&nbsp;identifies&nbsp;the&nbsp;hash&nbsp;function&nbsp;to&nbsp;use.</span><br>
<span class="lineno">125</span><span class="keyword" id="4561828">func</span>&nbsp;<span class="ident" id="4561833">hashForServerKeyExchange</span><span class="op" id="4561857">(</span><span class="ident" id="4561858">sigType</span><span class="op" id="4561865">,</span>&nbsp;<span class="ident" id="4561867">hashFunc</span>&nbsp;<span class="builtintype" id="4561876">uint8</span><span class="op" id="4561881">,</span>&nbsp;<span class="ident" id="4561883">version</span>&nbsp;<span class="builtintype" id="4561891">uint16</span><span class="op" id="4561897">,</span>&nbsp;<span class="ident" id="4561899">slices</span>&nbsp;<span class="op" id="4561906">...</span><span class="op" id="4561909">[</span><span class="op" id="4561910">]</span><span class="builtintype" id="4561911">byte</span><span class="op" id="4561915">)</span>&nbsp;<span class="op" id="4561917">(</span><span class="op" id="4561918">[</span><span class="op" id="4561919">]</span><span class="builtintype" id="4561920">byte</span><span class="op" id="4561924">,</span>&nbsp;<span class="ident" id="4561926"><a href="/gostd/crypto/tls/key_agreement.go.html#4557938">crypto</a></span><span class="op" id="4561932">.</span><span class="ident" id="4561933"><a href="/gostd/crypto/crypto.go.html#3010057">Hash</a></span><span class="op" id="4561937">,</span>&nbsp;<span class="builtintype" id="4561939">error</span><span class="op" id="4561944">)</span>&nbsp;<span class="op" id="4561946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561949">if</span>&nbsp;<span class="ident" id="4561952"><a href="/gostd/crypto/tls/key_agreement.go.html#4561883">version</a></span>&nbsp;<span class="op" id="4561960">&gt;=</span>&nbsp;<span class="ident" id="4561963"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4561976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4561980">switch</span>&nbsp;<span class="ident" id="4561987"><a href="/gostd/crypto/tls/key_agreement.go.html#4561867">hashFunc</a></span>&nbsp;<span class="op" id="4561996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562000">case</span>&nbsp;<span class="ident" id="4562005"><a href="/gostd/crypto/tls/common.go.html#4445493">hashSHA256</a></span><span class="op" id="4562015">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562020">return</span>&nbsp;<span class="ident" id="4562027"><a href="/gostd/crypto/tls/key_agreement.go.html#4561468">sha256Hash</a></span><span class="op" id="4562037">(</span><span class="ident" id="4562038"><a href="/gostd/crypto/tls/key_agreement.go.html#4561899">slices</a></span><span class="op" id="4562044">)</span><span class="op" id="4562045">,</span>&nbsp;<span class="ident" id="4562047"><a href="/gostd/crypto/tls/key_agreement.go.html#4557938">crypto</a></span><span class="op" id="4562053">.</span><span class="ident" id="4562054"><a href="/gostd/crypto/crypto.go.html#3010409">SHA256</a></span><span class="op" id="4562060">,</span>&nbsp;<span class="builtintype" id="4562062">nil</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562068">case</span>&nbsp;<span class="ident" id="4562073"><a href="/gostd/crypto/tls/common.go.html#4445471">hashSHA1</a></span><span class="op" id="4562081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562086">return</span>&nbsp;<span class="ident" id="4562093"><a href="/gostd/crypto/tls/key_agreement.go.html#4560899">sha1Hash</a></span><span class="op" id="4562101">(</span><span class="ident" id="4562102"><a href="/gostd/crypto/tls/key_agreement.go.html#4561899">slices</a></span><span class="op" id="4562108">)</span><span class="op" id="4562109">,</span>&nbsp;<span class="ident" id="4562111"><a href="/gostd/crypto/tls/key_agreement.go.html#4557938">crypto</a></span><span class="op" id="4562117">.</span><span class="ident" id="4562118"><a href="/gostd/crypto/crypto.go.html#3010309">SHA1</a></span><span class="op" id="4562122">,</span>&nbsp;<span class="builtintype" id="4562124">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562130">default</span><span class="op" id="4562137">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562142">return</span>&nbsp;<span class="builtintype" id="4562149">nil</span><span class="op" id="4562152">,</span>&nbsp;<span class="ident" id="4562154"><a href="/gostd/crypto/tls/key_agreement.go.html#4557938">crypto</a></span><span class="op" id="4562160">.</span><span class="ident" id="4562161"><a href="/gostd/crypto/crypto.go.html#3010057">Hash</a></span><span class="op" id="4562165">(</span><span class="num" id="4562166">0</span><span class="op" id="4562167">)</span><span class="op" id="4562168">,</span>&nbsp;<span class="ident" id="4562170"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4562176">.</span><span class="ident" id="4562177"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4562180">(</span><span class="string" id="4562181">&#34;tls:&nbsp;unknown&nbsp;hash&nbsp;function&nbsp;used&nbsp;by&nbsp;peer&#34;</span><span class="op" id="4562222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562226">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562232">if</span>&nbsp;<span class="ident" id="4562235"><a href="/gostd/crypto/tls/key_agreement.go.html#4561858">sigType</a></span>&nbsp;<span class="op" id="4562243">==</span>&nbsp;<span class="ident" id="4562246"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span>&nbsp;<span class="op" id="4562261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562265">return</span>&nbsp;<span class="ident" id="4562272"><a href="/gostd/crypto/tls/key_agreement.go.html#4560899">sha1Hash</a></span><span class="op" id="4562280">(</span><span class="ident" id="4562281"><a href="/gostd/crypto/tls/key_agreement.go.html#4561899">slices</a></span><span class="op" id="4562287">)</span><span class="op" id="4562288">,</span>&nbsp;<span class="ident" id="4562290"><a href="/gostd/crypto/tls/key_agreement.go.html#4557938">crypto</a></span><span class="op" id="4562296">.</span><span class="ident" id="4562297"><a href="/gostd/crypto/crypto.go.html#3010309">SHA1</a></span><span class="op" id="4562301">,</span>&nbsp;<span class="builtintype" id="4562303">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562311">return</span>&nbsp;<span class="ident" id="4562318"><a href="/gostd/crypto/tls/key_agreement.go.html#4561163">md5SHA1Hash</a></span><span class="op" id="4562329">(</span><span class="ident" id="4562330"><a href="/gostd/crypto/tls/key_agreement.go.html#4561899">slices</a></span><span class="op" id="4562336">)</span><span class="op" id="4562337">,</span>&nbsp;<span class="ident" id="4562339"><a href="/gostd/crypto/tls/key_agreement.go.html#4557938">crypto</a></span><span class="op" id="4562345">.</span><span class="ident" id="4562346"><a href="/gostd/crypto/crypto.go.html#3010562">MD5SHA1</a></span><span class="op" id="4562353">,</span>&nbsp;<span class="builtintype" id="4562355">nil</span><br>
<span class="lineno">140</span><span class="op" id="4562359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4562362">//&nbsp;pickTLS12HashForSignature&nbsp;returns&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;hash&nbsp;identifier&nbsp;for&nbsp;signing&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4562439">//&nbsp;ServerKeyExchange&nbsp;given&nbsp;the&nbsp;signature&nbsp;type&nbsp;being&nbsp;used&nbsp;and&nbsp;the&nbsp;client&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4562513">//&nbsp;advertised&nbsp;list&nbsp;of&nbsp;supported&nbsp;signature&nbsp;and&nbsp;hash&nbsp;combinations.</span><br>
<span class="lineno">145</span><span class="keyword" id="4562578">func</span>&nbsp;<span class="ident" id="4562583">pickTLS12HashForSignature</span><span class="op" id="4562608">(</span><span class="ident" id="4562609">sigType</span>&nbsp;<span class="builtintype" id="4562617">uint8</span><span class="op" id="4562622">,</span>&nbsp;<span class="ident" id="4562624">clientSignatureAndHashes</span>&nbsp;<span class="op" id="4562649">[</span><span class="op" id="4562650">]</span><span class="ident" id="4562651"><a href="/gostd/crypto/tls/common.go.html#4445758">signatureAndHash</a></span><span class="op" id="4562667">)</span>&nbsp;<span class="op" id="4562669">(</span><span class="builtintype" id="4562670">uint8</span><span class="op" id="4562675">,</span>&nbsp;<span class="builtintype" id="4562677">error</span><span class="op" id="4562682">)</span>&nbsp;<span class="op" id="4562684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562687">if</span>&nbsp;<span class="builtinfunc" id="4562690">len</span><span class="op" id="4562693">(</span><span class="ident" id="4562694"><a href="/gostd/crypto/tls/key_agreement.go.html#4562624">clientSignatureAndHashes</a></span><span class="op" id="4562718">)</span>&nbsp;<span class="op" id="4562720">==</span>&nbsp;<span class="num" id="4562723">0</span>&nbsp;<span class="op" id="4562725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4562729">//&nbsp;If&nbsp;the&nbsp;client&nbsp;didn&#39;t&nbsp;specify&nbsp;any&nbsp;signature_algorithms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4562788">//&nbsp;extension&nbsp;then&nbsp;we&nbsp;can&nbsp;assume&nbsp;that&nbsp;it&nbsp;supports&nbsp;SHA1.&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4562849">//&nbsp;http://tools.ietf.org/html/rfc5246#section-7.4.1.4.1</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562907">return</span>&nbsp;<span class="ident" id="4562914"><a href="/gostd/crypto/tls/common.go.html#4445471">hashSHA1</a></span><span class="op" id="4562922">,</span>&nbsp;<span class="builtintype" id="4562924">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4562929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562933">for</span>&nbsp;<span class="ident" id="4562937">_</span><span class="op" id="4562938">,</span>&nbsp;<span class="ident" id="4562940">sigAndHash</span>&nbsp;<span class="op" id="4562951">:=</span>&nbsp;<span class="keyword" id="4562954">range</span>&nbsp;<span class="ident" id="4562960"><a href="/gostd/crypto/tls/key_agreement.go.html#4562624">clientSignatureAndHashes</a></span>&nbsp;<span class="op" id="4562985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4562989">if</span>&nbsp;<span class="ident" id="4562992"><a href="/gostd/crypto/tls/key_agreement.go.html#4562940">sigAndHash</a></span><span class="op" id="4563002">.</span><span class="ident" id="4563003"><a href="/gostd/crypto/tls/common.go.html#4445791">signature</a></span>&nbsp;<span class="op" id="4563013">!=</span>&nbsp;<span class="ident" id="4563016"><a href="/gostd/crypto/tls/key_agreement.go.html#4562609">sigType</a></span>&nbsp;<span class="op" id="4563024">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563029">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563044">switch</span>&nbsp;<span class="ident" id="4563051"><a href="/gostd/crypto/tls/key_agreement.go.html#4562940">sigAndHash</a></span><span class="op" id="4563061">.</span><span class="ident" id="4563062"><a href="/gostd/crypto/tls/common.go.html#4445785">hash</a></span>&nbsp;<span class="op" id="4563067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563071">case</span>&nbsp;<span class="ident" id="4563076"><a href="/gostd/crypto/tls/common.go.html#4445471">hashSHA1</a></span><span class="op" id="4563084">,</span>&nbsp;<span class="ident" id="4563086"><a href="/gostd/crypto/tls/common.go.html#4445493">hashSHA256</a></span><span class="op" id="4563096">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563101">return</span>&nbsp;<span class="ident" id="4563108"><a href="/gostd/crypto/tls/key_agreement.go.html#4562940">sigAndHash</a></span><span class="op" id="4563118">.</span><span class="ident" id="4563119"><a href="/gostd/crypto/tls/common.go.html#4445785">hash</a></span><span class="op" id="4563123">,</span>&nbsp;<span class="builtintype" id="4563125">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563138">return</span>&nbsp;<span class="num" id="4563145">0</span><span class="op" id="4563146">,</span>&nbsp;<span class="ident" id="4563148"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4563154">.</span><span class="ident" id="4563155"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4563158">(</span><span class="string" id="4563159">&#34;tls:&nbsp;client&nbsp;doesn&#39;t&nbsp;support&nbsp;any&nbsp;common&nbsp;hash&nbsp;functions&#34;</span><span class="op" id="4563214">)</span><br>
<span class="lineno"></span><span class="op" id="4563216">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4563219">func</span>&nbsp;<span class="ident" id="4563224">curveForCurveID</span><span class="op" id="4563239">(</span><span class="ident" id="4563240">id</span>&nbsp;<span class="ident" id="4563243"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><span class="op" id="4563250">)</span>&nbsp;<span class="op" id="4563252">(</span><span class="ident" id="4563253"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4563261">.</span><span class="ident" id="4563262"><a href="/gostd/crypto/elliptic/elliptic.go.html#3015877">Curve</a></span><span class="op" id="4563267">,</span>&nbsp;<span class="builtintype" id="4563269">bool</span><span class="op" id="4563273">)</span>&nbsp;<span class="op" id="4563275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563278">switch</span>&nbsp;<span class="ident" id="4563285"><a href="/gostd/crypto/tls/key_agreement.go.html#4563240">id</a></span>&nbsp;<span class="op" id="4563288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563291">case</span>&nbsp;<span class="ident" id="4563296"><a href="/gostd/crypto/tls/common.go.html#4444366">CurveP256</a></span><span class="op" id="4563305">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563309">return</span>&nbsp;<span class="ident" id="4563316"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4563324">.</span><span class="ident" id="4563325"><a href="/gostd/crypto/elliptic/elliptic.go.html#3025819">P256</a></span><span class="op" id="4563329">(</span><span class="op" id="4563330">)</span><span class="op" id="4563331">,</span>&nbsp;<span class="builtintype" id="4563333">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563339">case</span>&nbsp;<span class="ident" id="4563344"><a href="/gostd/crypto/tls/common.go.html#4444390">CurveP384</a></span><span class="op" id="4563353">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563357">return</span>&nbsp;<span class="ident" id="4563364"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4563372">.</span><span class="ident" id="4563373"><a href="/gostd/crypto/elliptic/elliptic.go.html#3025956">P384</a></span><span class="op" id="4563377">(</span><span class="op" id="4563378">)</span><span class="op" id="4563379">,</span>&nbsp;<span class="builtintype" id="4563381">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563387">case</span>&nbsp;<span class="ident" id="4563392"><a href="/gostd/crypto/tls/common.go.html#4444414">CurveP521</a></span><span class="op" id="4563401">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563405">return</span>&nbsp;<span class="ident" id="4563412"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4563420">.</span><span class="ident" id="4563421"><a href="/gostd/crypto/elliptic/elliptic.go.html#3026093">P521</a></span><span class="op" id="4563425">(</span><span class="op" id="4563426">)</span><span class="op" id="4563427">,</span>&nbsp;<span class="builtintype" id="4563429">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563435">default</span><span class="op" id="4563442">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4563446">return</span>&nbsp;<span class="builtintype" id="4563453">nil</span><span class="op" id="4563456">,</span>&nbsp;<span class="builtintype" id="4563458">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4563468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="4563471">//&nbsp;ecdheRSAKeyAgreement&nbsp;implements&nbsp;a&nbsp;TLS&nbsp;key&nbsp;agreement&nbsp;where&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4563543">//&nbsp;generates&nbsp;a&nbsp;ephemeral&nbsp;EC&nbsp;public/private&nbsp;key&nbsp;pair&nbsp;and&nbsp;signs&nbsp;it.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="4563613">//&nbsp;pre-master&nbsp;secret&nbsp;is&nbsp;then&nbsp;calculated&nbsp;using&nbsp;ECDH.&nbsp;The&nbsp;signature&nbsp;may</span><br>
<span class="lineno"></span><span class="comment" id="4563683">//&nbsp;either&nbsp;be&nbsp;ECDSA&nbsp;or&nbsp;RSA.</span><br>
<span class="lineno"></span><span class="keyword" id="4563710">type</span>&nbsp;<span class="ident" id="4563715">ecdheKeyAgreement</span>&nbsp;<span class="keyword" id="4563733">struct</span>&nbsp;<span class="op" id="4563740">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563743">version</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4563754">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563762">sigType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4563773">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563780">privateKey</span>&nbsp;<span class="op" id="4563791">[</span><span class="op" id="4563792">]</span><span class="builtintype" id="4563793">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563799">curve</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563810"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4563818">.</span><span class="ident" id="4563819"><a href="/gostd/crypto/elliptic/elliptic.go.html#3015877">Curve</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4563826">x</span><span class="op" id="4563827">,</span>&nbsp;<span class="ident" id="4563829">y</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4563837">*</span><span class="ident" id="4563838"><a href="/gostd/crypto/tls/key_agreement.go.html#4558091">big</a></span><span class="op" id="4563841">.</span><span class="ident" id="4563842"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><br>
<span class="lineno">190</span><span class="op" id="4563846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4563849">func</span>&nbsp;<span class="op" id="4563854">(</span><span class="ident" id="4563855">ka</span>&nbsp;<span class="op" id="4563858">*</span><span class="ident" id="4563859"><a href="/gostd/crypto/tls/key_agreement.go.html#4563715">ecdheKeyAgreement</a></span><span class="op" id="4563876">)</span>&nbsp;<span class="ident" id="4563878">generateServerKeyExchange</span><span class="op" id="4563903">(</span><span class="ident" id="4563904">config</span>&nbsp;<span class="op" id="4563911">*</span><span class="ident" id="4563912"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4563918">,</span>&nbsp;<span class="ident" id="4563920">cert</span>&nbsp;<span class="op" id="4563925">*</span><span class="ident" id="4563926"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4563937">,</span>&nbsp;<span class="ident" id="4563939">clientHello</span>&nbsp;<span class="op" id="4563951">*</span><span class="ident" id="4563952"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4563966">,</span>&nbsp;<span class="ident" id="4563968">hello</span>&nbsp;<span class="op" id="4563974">*</span><span class="ident" id="4563975"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="4563989">)</span>&nbsp;<span class="op" id="4563991">(</span><span class="op" id="4563992">*</span><span class="ident" id="4563993"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526463">serverKeyExchangeMsg</a></span><span class="op" id="4564013">,</span>&nbsp;<span class="builtintype" id="4564015">error</span><span class="op" id="4564020">)</span>&nbsp;<span class="op" id="4564022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564025">var</span>&nbsp;<span class="ident" id="4564029">curveid</span>&nbsp;<span class="ident" id="4564037"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564046">preferredCurves</span>&nbsp;<span class="op" id="4564062">:=</span>&nbsp;<span class="ident" id="4564065"><a href="/gostd/crypto/tls/key_agreement.go.html#4563904">config</a></span><span class="op" id="4564071">.</span><span class="ident" id="4564072"><a href="/gostd/crypto/tls/common.go.html#4455735">curvePreferences</a></span><span class="op" id="4564088">(</span><span class="op" id="4564089">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="ident" id="4564092">NextCandidate</span><span class="op" id="4564105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564108">for</span>&nbsp;<span class="ident" id="4564112">_</span><span class="op" id="4564113">,</span>&nbsp;<span class="ident" id="4564115">candidate</span>&nbsp;<span class="op" id="4564125">:=</span>&nbsp;<span class="keyword" id="4564128">range</span>&nbsp;<span class="ident" id="4564134"><a href="/gostd/crypto/tls/key_agreement.go.html#4564046">preferredCurves</a></span>&nbsp;<span class="op" id="4564150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564154">for</span>&nbsp;<span class="ident" id="4564158">_</span><span class="op" id="4564159">,</span>&nbsp;<span class="ident" id="4564161">c</span>&nbsp;<span class="op" id="4564163">:=</span>&nbsp;<span class="keyword" id="4564166">range</span>&nbsp;<span class="ident" id="4564172"><a href="/gostd/crypto/tls/key_agreement.go.html#4563939">clientHello</a></span><span class="op" id="4564183">.</span><span class="ident" id="4564184"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508542">supportedCurves</a></span>&nbsp;<span class="op" id="4564200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564205">if</span>&nbsp;<span class="ident" id="4564208"><a href="/gostd/crypto/tls/key_agreement.go.html#4564115">candidate</a></span>&nbsp;<span class="op" id="4564218">==</span>&nbsp;<span class="ident" id="4564221"><a href="/gostd/crypto/tls/key_agreement.go.html#4564161">c</a></span>&nbsp;<span class="op" id="4564223">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564229"><a href="/gostd/crypto/tls/key_agreement.go.html#4564029">curveid</a></span>&nbsp;<span class="op" id="4564237">=</span>&nbsp;<span class="ident" id="4564239"><a href="/gostd/crypto/tls/key_agreement.go.html#4564161">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564245">break</span>&nbsp;<span class="ident" id="4564251"><a href="/gostd/crypto/tls/key_agreement.go.html#4564092">NextCandidate</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564275">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564279">if</span>&nbsp;<span class="ident" id="4564282"><a href="/gostd/crypto/tls/key_agreement.go.html#4564029">curveid</a></span>&nbsp;<span class="op" id="4564290">==</span>&nbsp;<span class="num" id="4564293">0</span>&nbsp;<span class="op" id="4564295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564299">return</span>&nbsp;<span class="builtintype" id="4564306">nil</span><span class="op" id="4564309">,</span>&nbsp;<span class="ident" id="4564311"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4564317">.</span><span class="ident" id="4564318"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4564321">(</span><span class="string" id="4564322">&#34;tls:&nbsp;no&nbsp;supported&nbsp;elliptic&nbsp;curves&nbsp;offered&#34;</span><span class="op" id="4564365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564372">var</span>&nbsp;<span class="ident" id="4564376">ok</span>&nbsp;<span class="builtintype" id="4564379">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564385">if</span>&nbsp;<span class="ident" id="4564388"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4564390">.</span><span class="ident" id="4564391"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4564396">,</span>&nbsp;<span class="ident" id="4564398"><a href="/gostd/crypto/tls/key_agreement.go.html#4564376">ok</a></span>&nbsp;<span class="op" id="4564401">=</span>&nbsp;<span class="ident" id="4564403"><a href="/gostd/crypto/tls/key_agreement.go.html#4563224">curveForCurveID</a></span><span class="op" id="4564418">(</span><span class="ident" id="4564419"><a href="/gostd/crypto/tls/key_agreement.go.html#4564029">curveid</a></span><span class="op" id="4564426">)</span><span class="op" id="4564427">;</span>&nbsp;<span class="op" id="4564429">!</span><span class="ident" id="4564430"><a href="/gostd/crypto/tls/key_agreement.go.html#4564376">ok</a></span>&nbsp;<span class="op" id="4564433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564437">return</span>&nbsp;<span class="builtintype" id="4564444">nil</span><span class="op" id="4564447">,</span>&nbsp;<span class="ident" id="4564449"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4564455">.</span><span class="ident" id="4564456"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4564459">(</span><span class="string" id="4564460">&#34;tls:&nbsp;preferredCurves&nbsp;includes&nbsp;unsupported&nbsp;curve&#34;</span><span class="op" id="4564509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564516">var</span>&nbsp;<span class="ident" id="4564520">x</span><span class="op" id="4564521">,</span>&nbsp;<span class="ident" id="4564523">y</span>&nbsp;<span class="op" id="4564525">*</span><span class="ident" id="4564526"><a href="/gostd/crypto/tls/key_agreement.go.html#4558091">big</a></span><span class="op" id="4564529">.</span><span class="ident" id="4564530"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564535">var</span>&nbsp;<span class="ident" id="4564539">err</span>&nbsp;<span class="builtintype" id="4564543">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564550"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4564552">.</span><span class="ident" id="4564553"><a href="/gostd/crypto/tls/key_agreement.go.html#4563780">privateKey</a></span><span class="op" id="4564563">,</span>&nbsp;<span class="ident" id="4564565"><a href="/gostd/crypto/tls/key_agreement.go.html#4564520">x</a></span><span class="op" id="4564566">,</span>&nbsp;<span class="ident" id="4564568"><a href="/gostd/crypto/tls/key_agreement.go.html#4564523">y</a></span><span class="op" id="4564569">,</span>&nbsp;<span class="ident" id="4564571"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4564575">=</span>&nbsp;<span class="ident" id="4564577"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4564585">.</span><span class="ident" id="4564586"><a href="/gostd/crypto/elliptic/elliptic.go.html#3022321">GenerateKey</a></span><span class="op" id="4564597">(</span><span class="ident" id="4564598"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4564600">.</span><span class="ident" id="4564601"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4564606">,</span>&nbsp;<span class="ident" id="4564608"><a href="/gostd/crypto/tls/key_agreement.go.html#4563904">config</a></span><span class="op" id="4564614">.</span><span class="ident" id="4564615"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4564619">(</span><span class="op" id="4564620">)</span><span class="op" id="4564621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564624">if</span>&nbsp;<span class="ident" id="4564627"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4564631">!=</span>&nbsp;<span class="builtintype" id="4564634">nil</span>&nbsp;<span class="op" id="4564638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4564642">return</span>&nbsp;<span class="builtintype" id="4564649">nil</span><span class="op" id="4564652">,</span>&nbsp;<span class="ident" id="4564654"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4564659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564662">ecdhePublic</span>&nbsp;<span class="op" id="4564674">:=</span>&nbsp;<span class="ident" id="4564677"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4564685">.</span><span class="ident" id="4564686"><a href="/gostd/crypto/elliptic/elliptic.go.html#3023027">Marshal</a></span><span class="op" id="4564693">(</span><span class="ident" id="4564694"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4564696">.</span><span class="ident" id="4564697"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4564702">,</span>&nbsp;<span class="ident" id="4564704"><a href="/gostd/crypto/tls/key_agreement.go.html#4564520">x</a></span><span class="op" id="4564705">,</span>&nbsp;<span class="ident" id="4564707"><a href="/gostd/crypto/tls/key_agreement.go.html#4564523">y</a></span><span class="op" id="4564708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4564712">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564763">serverECDHParams</span>&nbsp;<span class="op" id="4564780">:=</span>&nbsp;<span class="builtinfunc" id="4564783">make</span><span class="op" id="4564787">(</span><span class="op" id="4564788">[</span><span class="op" id="4564789">]</span><span class="builtintype" id="4564790">byte</span><span class="op" id="4564794">,</span>&nbsp;<span class="num" id="4564796">1</span><span class="op" id="4564797">+</span><span class="num" id="4564798">2</span><span class="op" id="4564799">+</span><span class="num" id="4564800">1</span><span class="op" id="4564801">+</span><span class="builtinfunc" id="4564802">len</span><span class="op" id="4564805">(</span><span class="ident" id="4564806"><a href="/gostd/crypto/tls/key_agreement.go.html#4564662">ecdhePublic</a></span><span class="op" id="4564817">)</span><span class="op" id="4564818">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564821"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4564837">[</span><span class="num" id="4564838">0</span><span class="op" id="4564839">]</span>&nbsp;<span class="op" id="4564841">=</span>&nbsp;<span class="num" id="4564843">3</span>&nbsp;<span class="comment" id="4564845">//&nbsp;named&nbsp;curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564861"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4564877">[</span><span class="num" id="4564878">1</span><span class="op" id="4564879">]</span>&nbsp;<span class="op" id="4564881">=</span>&nbsp;<span class="builtintype" id="4564883">byte</span><span class="op" id="4564887">(</span><span class="ident" id="4564888"><a href="/gostd/crypto/tls/key_agreement.go.html#4564029">curveid</a></span>&nbsp;<span class="op" id="4564896">&gt;&gt;</span>&nbsp;<span class="num" id="4564899">8</span><span class="op" id="4564900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564903"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4564919">[</span><span class="num" id="4564920">2</span><span class="op" id="4564921">]</span>&nbsp;<span class="op" id="4564923">=</span>&nbsp;<span class="builtintype" id="4564925">byte</span><span class="op" id="4564929">(</span><span class="ident" id="4564930"><a href="/gostd/crypto/tls/key_agreement.go.html#4564029">curveid</a></span><span class="op" id="4564937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4564940"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4564956">[</span><span class="num" id="4564957">3</span><span class="op" id="4564958">]</span>&nbsp;<span class="op" id="4564960">=</span>&nbsp;<span class="builtintype" id="4564962">byte</span><span class="op" id="4564966">(</span><span class="builtinfunc" id="4564967">len</span><span class="op" id="4564970">(</span><span class="ident" id="4564971"><a href="/gostd/crypto/tls/key_agreement.go.html#4564662">ecdhePublic</a></span><span class="op" id="4564982">)</span><span class="op" id="4564983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4564986">copy</span><span class="op" id="4564990">(</span><span class="ident" id="4564991"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4565007">[</span><span class="num" id="4565008">4</span><span class="op" id="4565009">:</span><span class="op" id="4565010">]</span><span class="op" id="4565011">,</span>&nbsp;<span class="ident" id="4565013"><a href="/gostd/crypto/tls/key_agreement.go.html#4564662">ecdhePublic</a></span><span class="op" id="4565024">)</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565028">var</span>&nbsp;<span class="ident" id="4565032">tls12HashId</span>&nbsp;<span class="builtintype" id="4565044">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565051">if</span>&nbsp;<span class="ident" id="4565054"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4565056">.</span><span class="ident" id="4565057"><a href="/gostd/crypto/tls/key_agreement.go.html#4563743">version</a></span>&nbsp;<span class="op" id="4565065">&gt;=</span>&nbsp;<span class="ident" id="4565068"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4565081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565085">if</span>&nbsp;<span class="ident" id="4565088"><a href="/gostd/crypto/tls/key_agreement.go.html#4565032">tls12HashId</a></span><span class="op" id="4565099">,</span>&nbsp;<span class="ident" id="4565101"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4565105">=</span>&nbsp;<span class="ident" id="4565107"><a href="/gostd/crypto/tls/key_agreement.go.html#4562583">pickTLS12HashForSignature</a></span><span class="op" id="4565132">(</span><span class="ident" id="4565133"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4565135">.</span><span class="ident" id="4565136"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span><span class="op" id="4565143">,</span>&nbsp;<span class="ident" id="4565145"><a href="/gostd/crypto/tls/key_agreement.go.html#4563939">clientHello</a></span><span class="op" id="4565156">.</span><span class="ident" id="4565157"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508657">signatureAndHashes</a></span><span class="op" id="4565175">)</span><span class="op" id="4565176">;</span>&nbsp;<span class="ident" id="4565178"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4565182">!=</span>&nbsp;<span class="builtintype" id="4565185">nil</span>&nbsp;<span class="op" id="4565189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565194">return</span>&nbsp;<span class="builtintype" id="4565201">nil</span><span class="op" id="4565204">,</span>&nbsp;<span class="ident" id="4565206"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565219">digest</span><span class="op" id="4565225">,</span>&nbsp;<span class="ident" id="4565227">hashFunc</span><span class="op" id="4565235">,</span>&nbsp;<span class="ident" id="4565237"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4565241">:=</span>&nbsp;<span class="ident" id="4565244"><a href="/gostd/crypto/tls/key_agreement.go.html#4561833">hashForServerKeyExchange</a></span><span class="op" id="4565268">(</span><span class="ident" id="4565269"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4565271">.</span><span class="ident" id="4565272"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span><span class="op" id="4565279">,</span>&nbsp;<span class="ident" id="4565281"><a href="/gostd/crypto/tls/key_agreement.go.html#4565032">tls12HashId</a></span><span class="op" id="4565292">,</span>&nbsp;<span class="ident" id="4565294"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4565296">.</span><span class="ident" id="4565297"><a href="/gostd/crypto/tls/key_agreement.go.html#4563743">version</a></span><span class="op" id="4565304">,</span>&nbsp;<span class="ident" id="4565306"><a href="/gostd/crypto/tls/key_agreement.go.html#4563939">clientHello</a></span><span class="op" id="4565317">.</span><span class="ident" id="4565318"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4565324">,</span>&nbsp;<span class="ident" id="4565326"><a href="/gostd/crypto/tls/key_agreement.go.html#4563968">hello</a></span><span class="op" id="4565331">.</span><span class="ident" id="4565332"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4565338">,</span>&nbsp;<span class="ident" id="4565340"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4565356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565359">if</span>&nbsp;<span class="ident" id="4565362"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4565366">!=</span>&nbsp;<span class="builtintype" id="4565369">nil</span>&nbsp;<span class="op" id="4565373">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565377">return</span>&nbsp;<span class="builtintype" id="4565384">nil</span><span class="op" id="4565387">,</span>&nbsp;<span class="ident" id="4565389"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565397">var</span>&nbsp;<span class="ident" id="4565401">sig</span>&nbsp;<span class="op" id="4565405">[</span><span class="op" id="4565406">]</span><span class="builtintype" id="4565407">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565413">switch</span>&nbsp;<span class="ident" id="4565420"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4565422">.</span><span class="ident" id="4565423"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span>&nbsp;<span class="op" id="4565431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565434">case</span>&nbsp;<span class="ident" id="4565439"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4565453">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565457">privKey</span><span class="op" id="4565464">,</span>&nbsp;<span class="ident" id="4565466">ok</span>&nbsp;<span class="op" id="4565469">:=</span>&nbsp;<span class="ident" id="4565472"><a href="/gostd/crypto/tls/key_agreement.go.html#4563920">cert</a></span><span class="op" id="4565476">.</span><span class="ident" id="4565477"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4565487">.</span><span class="op" id="4565488">(</span><span class="op" id="4565489">*</span><span class="ident" id="4565490"><a href="/gostd/crypto/tls/key_agreement.go.html#4557948">ecdsa</a></span><span class="op" id="4565495">.</span><span class="ident" id="4565496"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005513">PrivateKey</a></span><span class="op" id="4565506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565510">if</span>&nbsp;<span class="op" id="4565513">!</span><span class="ident" id="4565514"><a href="/gostd/crypto/tls/key_agreement.go.html#4565466">ok</a></span>&nbsp;<span class="op" id="4565517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565522">return</span>&nbsp;<span class="builtintype" id="4565529">nil</span><span class="op" id="4565532">,</span>&nbsp;<span class="ident" id="4565534"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4565540">.</span><span class="ident" id="4565541"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4565544">(</span><span class="string" id="4565545">&#34;ECDHE&nbsp;ECDSA&nbsp;requires&nbsp;an&nbsp;ECDSA&nbsp;server&nbsp;private&nbsp;key&#34;</span><span class="op" id="4565595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565603">r</span><span class="op" id="4565604">,</span>&nbsp;<span class="ident" id="4565606">s</span><span class="op" id="4565607">,</span>&nbsp;<span class="ident" id="4565609">err</span>&nbsp;<span class="op" id="4565613">:=</span>&nbsp;<span class="ident" id="4565616"><a href="/gostd/crypto/tls/key_agreement.go.html#4557948">ecdsa</a></span><span class="op" id="4565621">.</span><span class="ident" id="4565622"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3008419">Sign</a></span><span class="op" id="4565626">(</span><span class="ident" id="4565627"><a href="/gostd/crypto/tls/key_agreement.go.html#4563904">config</a></span><span class="op" id="4565633">.</span><span class="ident" id="4565634"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4565638">(</span><span class="op" id="4565639">)</span><span class="op" id="4565640">,</span>&nbsp;<span class="ident" id="4565642"><a href="/gostd/crypto/tls/key_agreement.go.html#4565457">privKey</a></span><span class="op" id="4565649">,</span>&nbsp;<span class="ident" id="4565651"><a href="/gostd/crypto/tls/key_agreement.go.html#4565219">digest</a></span><span class="op" id="4565657">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565661">if</span>&nbsp;<span class="ident" id="4565664"><a href="/gostd/crypto/tls/key_agreement.go.html#4565609">err</a></span>&nbsp;<span class="op" id="4565668">!=</span>&nbsp;<span class="builtintype" id="4565671">nil</span>&nbsp;<span class="op" id="4565675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565680">return</span>&nbsp;<span class="builtintype" id="4565687">nil</span><span class="op" id="4565690">,</span>&nbsp;<span class="ident" id="4565692"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4565698">.</span><span class="ident" id="4565699"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4565702">(</span><span class="string" id="4565703">&#34;failed&nbsp;to&nbsp;sign&nbsp;ECDHE&nbsp;parameters:&nbsp;&#34;</span>&nbsp;<span class="op" id="4565739">+</span>&nbsp;<span class="ident" id="4565741"><a href="/gostd/crypto/tls/key_agreement.go.html#4565609">err</a></span><span class="op" id="4565744">.</span><span class="ident" id="4565745">Error</span><span class="op" id="4565750">(</span><span class="op" id="4565751">)</span><span class="op" id="4565752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565760"><a href="/gostd/crypto/tls/key_agreement.go.html#4565401">sig</a></span><span class="op" id="4565763">,</span>&nbsp;<span class="ident" id="4565765"><a href="/gostd/crypto/tls/key_agreement.go.html#4565609">err</a></span>&nbsp;<span class="op" id="4565769">=</span>&nbsp;<span class="ident" id="4565771"><a href="/gostd/crypto/tls/key_agreement.go.html#4558058">asn1</a></span><span class="op" id="4565775">.</span><span class="ident" id="4565776"><a href="/gostd/encoding/asn1/marshal.go.html#3131676">Marshal</a></span><span class="op" id="4565783">(</span><span class="ident" id="4565784"><a href="/gostd/crypto/tls/common.go.html#4460840">ecdsaSignature</a></span><span class="op" id="4565798">{</span><span class="ident" id="4565799"><a href="/gostd/crypto/tls/key_agreement.go.html#4565603">r</a></span><span class="op" id="4565800">,</span>&nbsp;<span class="ident" id="4565802"><a href="/gostd/crypto/tls/key_agreement.go.html#4565606">s</a></span><span class="op" id="4565803">}</span><span class="op" id="4565804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565807">case</span>&nbsp;<span class="ident" id="4565812"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4565824">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565828">privKey</span><span class="op" id="4565835">,</span>&nbsp;<span class="ident" id="4565837">ok</span>&nbsp;<span class="op" id="4565840">:=</span>&nbsp;<span class="ident" id="4565843"><a href="/gostd/crypto/tls/key_agreement.go.html#4563920">cert</a></span><span class="op" id="4565847">.</span><span class="ident" id="4565848"><a href="/gostd/crypto/tls/common.go.html#4458333">PrivateKey</a></span><span class="op" id="4565858">.</span><span class="op" id="4565859">(</span><span class="op" id="4565860">*</span><span class="ident" id="4565861"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4565864">.</span><span class="ident" id="4565865"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4565875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565879">if</span>&nbsp;<span class="op" id="4565882">!</span><span class="ident" id="4565883"><a href="/gostd/crypto/tls/key_agreement.go.html#4565837">ok</a></span>&nbsp;<span class="op" id="4565886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4565891">return</span>&nbsp;<span class="builtintype" id="4565898">nil</span><span class="op" id="4565901">,</span>&nbsp;<span class="ident" id="4565903"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4565909">.</span><span class="ident" id="4565910"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4565913">(</span><span class="string" id="4565914">&#34;ECDHE&nbsp;RSA&nbsp;requires&nbsp;a&nbsp;RSA&nbsp;server&nbsp;private&nbsp;key&#34;</span><span class="op" id="4565959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4565963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4565967"><a href="/gostd/crypto/tls/key_agreement.go.html#4565401">sig</a></span><span class="op" id="4565970">,</span>&nbsp;<span class="ident" id="4565972"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4565976">=</span>&nbsp;<span class="ident" id="4565978"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4565981">.</span><span class="ident" id="4565982"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731399">SignPKCS1v15</a></span><span class="op" id="4565994">(</span><span class="ident" id="4565995"><a href="/gostd/crypto/tls/key_agreement.go.html#4563904">config</a></span><span class="op" id="4566001">.</span><span class="ident" id="4566002"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4566006">(</span><span class="op" id="4566007">)</span><span class="op" id="4566008">,</span>&nbsp;<span class="ident" id="4566010"><a href="/gostd/crypto/tls/key_agreement.go.html#4565828">privKey</a></span><span class="op" id="4566017">,</span>&nbsp;<span class="ident" id="4566019"><a href="/gostd/crypto/tls/key_agreement.go.html#4565227">hashFunc</a></span><span class="op" id="4566027">,</span>&nbsp;<span class="ident" id="4566029"><a href="/gostd/crypto/tls/key_agreement.go.html#4565219">digest</a></span><span class="op" id="4566035">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566039">if</span>&nbsp;<span class="ident" id="4566042"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span>&nbsp;<span class="op" id="4566046">!=</span>&nbsp;<span class="builtintype" id="4566049">nil</span>&nbsp;<span class="op" id="4566053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566058">return</span>&nbsp;<span class="builtintype" id="4566065">nil</span><span class="op" id="4566068">,</span>&nbsp;<span class="ident" id="4566070"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4566076">.</span><span class="ident" id="4566077"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4566080">(</span><span class="string" id="4566081">&#34;failed&nbsp;to&nbsp;sign&nbsp;ECDHE&nbsp;parameters:&nbsp;&#34;</span>&nbsp;<span class="op" id="4566117">+</span>&nbsp;<span class="ident" id="4566119"><a href="/gostd/crypto/tls/key_agreement.go.html#4564539">err</a></span><span class="op" id="4566122">.</span><span class="ident" id="4566123">Error</span><span class="op" id="4566128">(</span><span class="op" id="4566129">)</span><span class="op" id="4566130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566137">default</span><span class="op" id="4566144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566148">return</span>&nbsp;<span class="builtintype" id="4566155">nil</span><span class="op" id="4566158">,</span>&nbsp;<span class="ident" id="4566160"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4566166">.</span><span class="ident" id="4566167"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4566170">(</span><span class="string" id="4566171">&#34;unknown&nbsp;ECDHE&nbsp;signature&nbsp;algorithm&#34;</span><span class="op" id="4566206">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566213">skx</span>&nbsp;<span class="op" id="4566217">:=</span>&nbsp;<span class="builtinfunc" id="4566220">new</span><span class="op" id="4566223">(</span><span class="ident" id="4566224"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526463">serverKeyExchangeMsg</a></span><span class="op" id="4566244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566247">sigAndHashLen</span>&nbsp;<span class="op" id="4566261">:=</span>&nbsp;<span class="num" id="4566264">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566267">if</span>&nbsp;<span class="ident" id="4566270"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4566272">.</span><span class="ident" id="4566273"><a href="/gostd/crypto/tls/key_agreement.go.html#4563743">version</a></span>&nbsp;<span class="op" id="4566281">&gt;=</span>&nbsp;<span class="ident" id="4566284"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4566297">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566301"><a href="/gostd/crypto/tls/key_agreement.go.html#4566247">sigAndHashLen</a></span>&nbsp;<span class="op" id="4566315">=</span>&nbsp;<span class="num" id="4566317">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566323"><a href="/gostd/crypto/tls/key_agreement.go.html#4566213">skx</a></span><span class="op" id="4566326">.</span><span class="ident" id="4566327"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span>&nbsp;<span class="op" id="4566331">=</span>&nbsp;<span class="builtinfunc" id="4566333">make</span><span class="op" id="4566337">(</span><span class="op" id="4566338">[</span><span class="op" id="4566339">]</span><span class="builtintype" id="4566340">byte</span><span class="op" id="4566344">,</span>&nbsp;<span class="builtinfunc" id="4566346">len</span><span class="op" id="4566349">(</span><span class="ident" id="4566350"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4566366">)</span><span class="op" id="4566367">+</span><span class="ident" id="4566368"><a href="/gostd/crypto/tls/key_agreement.go.html#4566247">sigAndHashLen</a></span><span class="op" id="4566381">+</span><span class="num" id="4566382">2</span><span class="op" id="4566383">+</span><span class="builtinfunc" id="4566384">len</span><span class="op" id="4566387">(</span><span class="ident" id="4566388"><a href="/gostd/crypto/tls/key_agreement.go.html#4565401">sig</a></span><span class="op" id="4566391">)</span><span class="op" id="4566392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4566395">copy</span><span class="op" id="4566399">(</span><span class="ident" id="4566400"><a href="/gostd/crypto/tls/key_agreement.go.html#4566213">skx</a></span><span class="op" id="4566403">.</span><span class="ident" id="4566404"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4566407">,</span>&nbsp;<span class="ident" id="4566409"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4566425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566428">k</span>&nbsp;<span class="op" id="4566430">:=</span>&nbsp;<span class="ident" id="4566433"><a href="/gostd/crypto/tls/key_agreement.go.html#4566213">skx</a></span><span class="op" id="4566436">.</span><span class="ident" id="4566437"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4566440">[</span><span class="builtinfunc" id="4566441">len</span><span class="op" id="4566444">(</span><span class="ident" id="4566445"><a href="/gostd/crypto/tls/key_agreement.go.html#4564763">serverECDHParams</a></span><span class="op" id="4566461">)</span><span class="op" id="4566462">:</span><span class="op" id="4566463">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566466">if</span>&nbsp;<span class="ident" id="4566469"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4566471">.</span><span class="ident" id="4566472"><a href="/gostd/crypto/tls/key_agreement.go.html#4563743">version</a></span>&nbsp;<span class="op" id="4566480">&gt;=</span>&nbsp;<span class="ident" id="4566483"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4566496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566500"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span><span class="op" id="4566501">[</span><span class="num" id="4566502">0</span><span class="op" id="4566503">]</span>&nbsp;<span class="op" id="4566505">=</span>&nbsp;<span class="ident" id="4566507"><a href="/gostd/crypto/tls/key_agreement.go.html#4565032">tls12HashId</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566521"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span><span class="op" id="4566522">[</span><span class="num" id="4566523">1</span><span class="op" id="4566524">]</span>&nbsp;<span class="op" id="4566526">=</span>&nbsp;<span class="ident" id="4566528"><a href="/gostd/crypto/tls/key_agreement.go.html#4563855">ka</a></span><span class="op" id="4566530">.</span><span class="ident" id="4566531"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566541"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span>&nbsp;<span class="op" id="4566543">=</span>&nbsp;<span class="ident" id="4566545"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span><span class="op" id="4566546">[</span><span class="num" id="4566547">2</span><span class="op" id="4566548">:</span><span class="op" id="4566549">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566552">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566555"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span><span class="op" id="4566556">[</span><span class="num" id="4566557">0</span><span class="op" id="4566558">]</span>&nbsp;<span class="op" id="4566560">=</span>&nbsp;<span class="builtintype" id="4566562">byte</span><span class="op" id="4566566">(</span><span class="builtinfunc" id="4566567">len</span><span class="op" id="4566570">(</span><span class="ident" id="4566571"><a href="/gostd/crypto/tls/key_agreement.go.html#4565401">sig</a></span><span class="op" id="4566574">)</span>&nbsp;<span class="op" id="4566576">&gt;&gt;</span>&nbsp;<span class="num" id="4566579">8</span><span class="op" id="4566580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566583"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span><span class="op" id="4566584">[</span><span class="num" id="4566585">1</span><span class="op" id="4566586">]</span>&nbsp;<span class="op" id="4566588">=</span>&nbsp;<span class="builtintype" id="4566590">byte</span><span class="op" id="4566594">(</span><span class="builtinfunc" id="4566595">len</span><span class="op" id="4566598">(</span><span class="ident" id="4566599"><a href="/gostd/crypto/tls/key_agreement.go.html#4565401">sig</a></span><span class="op" id="4566602">)</span><span class="op" id="4566603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4566606">copy</span><span class="op" id="4566610">(</span><span class="ident" id="4566611"><a href="/gostd/crypto/tls/key_agreement.go.html#4566428">k</a></span><span class="op" id="4566612">[</span><span class="num" id="4566613">2</span><span class="op" id="4566614">:</span><span class="op" id="4566615">]</span><span class="op" id="4566616">,</span>&nbsp;<span class="ident" id="4566618"><a href="/gostd/crypto/tls/key_agreement.go.html#4565401">sig</a></span><span class="op" id="4566621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566625">return</span>&nbsp;<span class="ident" id="4566632"><a href="/gostd/crypto/tls/key_agreement.go.html#4566213">skx</a></span><span class="op" id="4566635">,</span>&nbsp;<span class="builtintype" id="4566637">nil</span><br>
<span class="lineno">285</span><span class="op" id="4566641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4566644">func</span>&nbsp;<span class="op" id="4566649">(</span><span class="ident" id="4566650">ka</span>&nbsp;<span class="op" id="4566653">*</span><span class="ident" id="4566654"><a href="/gostd/crypto/tls/key_agreement.go.html#4563715">ecdheKeyAgreement</a></span><span class="op" id="4566671">)</span>&nbsp;<span class="ident" id="4566673">processClientKeyExchange</span><span class="op" id="4566697">(</span><span class="ident" id="4566698">config</span>&nbsp;<span class="op" id="4566705">*</span><span class="ident" id="4566706"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4566712">,</span>&nbsp;<span class="ident" id="4566714">cert</span>&nbsp;<span class="op" id="4566719">*</span><span class="ident" id="4566720"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4566731">,</span>&nbsp;<span class="ident" id="4566733">ckx</span>&nbsp;<span class="op" id="4566737">*</span><span class="ident" id="4566738"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4566758">,</span>&nbsp;<span class="ident" id="4566760">version</span>&nbsp;<span class="builtintype" id="4566768">uint16</span><span class="op" id="4566774">)</span>&nbsp;<span class="op" id="4566776">(</span><span class="op" id="4566777">[</span><span class="op" id="4566778">]</span><span class="builtintype" id="4566779">byte</span><span class="op" id="4566783">,</span>&nbsp;<span class="builtintype" id="4566785">error</span><span class="op" id="4566790">)</span>&nbsp;<span class="op" id="4566792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566795">if</span>&nbsp;<span class="builtinfunc" id="4566798">len</span><span class="op" id="4566801">(</span><span class="ident" id="4566802"><a href="/gostd/crypto/tls/key_agreement.go.html#4566733">ckx</a></span><span class="op" id="4566805">.</span><span class="ident" id="4566806"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4566816">)</span>&nbsp;<span class="op" id="4566818">==</span>&nbsp;<span class="num" id="4566821">0</span>&nbsp;<span class="op" id="4566823">||</span>&nbsp;<span class="builtintype" id="4566826">int</span><span class="op" id="4566829">(</span><span class="ident" id="4566830"><a href="/gostd/crypto/tls/key_agreement.go.html#4566733">ckx</a></span><span class="op" id="4566833">.</span><span class="ident" id="4566834"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4566844">[</span><span class="num" id="4566845">0</span><span class="op" id="4566846">]</span><span class="op" id="4566847">)</span>&nbsp;<span class="op" id="4566849">!=</span>&nbsp;<span class="builtinfunc" id="4566852">len</span><span class="op" id="4566855">(</span><span class="ident" id="4566856"><a href="/gostd/crypto/tls/key_agreement.go.html#4566733">ckx</a></span><span class="op" id="4566859">.</span><span class="ident" id="4566860"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4566870">)</span><span class="op" id="4566871">-</span><span class="num" id="4566872">1</span>&nbsp;<span class="op" id="4566874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566878">return</span>&nbsp;<span class="builtintype" id="4566885">nil</span><span class="op" id="4566888">,</span>&nbsp;<span class="ident" id="4566890"><a href="/gostd/crypto/tls/key_agreement.go.html#4558109">errClientKeyExchange</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4566912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4566915">x</span><span class="op" id="4566916">,</span>&nbsp;<span class="ident" id="4566918">y</span>&nbsp;<span class="op" id="4566920">:=</span>&nbsp;<span class="ident" id="4566923"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4566931">.</span><span class="ident" id="4566932"><a href="/gostd/crypto/elliptic/elliptic.go.html#3023430">Unmarshal</a></span><span class="op" id="4566941">(</span><span class="ident" id="4566942"><a href="/gostd/crypto/tls/key_agreement.go.html#4566650">ka</a></span><span class="op" id="4566944">.</span><span class="ident" id="4566945"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4566950">,</span>&nbsp;<span class="ident" id="4566952"><a href="/gostd/crypto/tls/key_agreement.go.html#4566733">ckx</a></span><span class="op" id="4566955">.</span><span class="ident" id="4566956"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4566966">[</span><span class="num" id="4566967">1</span><span class="op" id="4566968">:</span><span class="op" id="4566969">]</span><span class="op" id="4566970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566973">if</span>&nbsp;<span class="ident" id="4566976"><a href="/gostd/crypto/tls/key_agreement.go.html#4566915">x</a></span>&nbsp;<span class="op" id="4566978">==</span>&nbsp;<span class="builtintype" id="4566981">nil</span>&nbsp;<span class="op" id="4566985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4566989">return</span>&nbsp;<span class="builtintype" id="4566996">nil</span><span class="op" id="4566999">,</span>&nbsp;<span class="ident" id="4567001"><a href="/gostd/crypto/tls/key_agreement.go.html#4558109">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567023">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567026">if</span>&nbsp;<span class="op" id="4567029">!</span><span class="ident" id="4567030"><a href="/gostd/crypto/tls/key_agreement.go.html#4566650">ka</a></span><span class="op" id="4567032">.</span><span class="ident" id="4567033"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4567038">.</span><span class="ident" id="4567039"><a href="/gostd/crypto/elliptic/elliptic.go.html#3016033">IsOnCurve</a></span><span class="op" id="4567048">(</span><span class="ident" id="4567049"><a href="/gostd/crypto/tls/key_agreement.go.html#4566915">x</a></span><span class="op" id="4567050">,</span>&nbsp;<span class="ident" id="4567052"><a href="/gostd/crypto/tls/key_agreement.go.html#4566918">y</a></span><span class="op" id="4567053">)</span>&nbsp;<span class="op" id="4567055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567059">return</span>&nbsp;<span class="builtintype" id="4567066">nil</span><span class="op" id="4567069">,</span>&nbsp;<span class="ident" id="4567071"><a href="/gostd/crypto/tls/key_agreement.go.html#4558109">errClientKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567096"><a href="/gostd/crypto/tls/key_agreement.go.html#4566915">x</a></span><span class="op" id="4567097">,</span>&nbsp;<span class="ident" id="4567099">_</span>&nbsp;<span class="op" id="4567101">=</span>&nbsp;<span class="ident" id="4567103"><a href="/gostd/crypto/tls/key_agreement.go.html#4566650">ka</a></span><span class="op" id="4567105">.</span><span class="ident" id="4567106"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4567111">.</span><span class="ident" id="4567112"><a href="/gostd/crypto/elliptic/elliptic.go.html#3016298">ScalarMult</a></span><span class="op" id="4567122">(</span><span class="ident" id="4567123"><a href="/gostd/crypto/tls/key_agreement.go.html#4566915">x</a></span><span class="op" id="4567124">,</span>&nbsp;<span class="ident" id="4567126"><a href="/gostd/crypto/tls/key_agreement.go.html#4566918">y</a></span><span class="op" id="4567127">,</span>&nbsp;<span class="ident" id="4567129"><a href="/gostd/crypto/tls/key_agreement.go.html#4566650">ka</a></span><span class="op" id="4567131">.</span><span class="ident" id="4567132"><a href="/gostd/crypto/tls/key_agreement.go.html#4563780">privateKey</a></span><span class="op" id="4567142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567145">preMasterSecret</span>&nbsp;<span class="op" id="4567161">:=</span>&nbsp;<span class="builtinfunc" id="4567164">make</span><span class="op" id="4567168">(</span><span class="op" id="4567169">[</span><span class="op" id="4567170">]</span><span class="builtintype" id="4567171">byte</span><span class="op" id="4567175">,</span>&nbsp;<span class="op" id="4567177">(</span><span class="ident" id="4567178"><a href="/gostd/crypto/tls/key_agreement.go.html#4566650">ka</a></span><span class="op" id="4567180">.</span><span class="ident" id="4567181"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4567186">.</span><span class="ident" id="4567187"><a href="/gostd/crypto/elliptic/elliptic.go.html#3015945">Params</a></span><span class="op" id="4567193">(</span><span class="op" id="4567194">)</span><span class="op" id="4567195">.</span><span class="ident" id="4567196"><a href="/gostd/crypto/elliptic/elliptic.go.html#3016879">BitSize</a></span><span class="op" id="4567203">+</span><span class="num" id="4567204">7</span><span class="op" id="4567205">)</span><span class="op" id="4567206">&gt;&gt;</span><span class="num" id="4567208">3</span><span class="op" id="4567209">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567212">xBytes</span>&nbsp;<span class="op" id="4567219">:=</span>&nbsp;<span class="ident" id="4567222"><a href="/gostd/crypto/tls/key_agreement.go.html#4566915">x</a></span><span class="op" id="4567223">.</span><span class="ident" id="4567224"><a href="/gostd/math/big/int.go.html#2050194">Bytes</a></span><span class="op" id="4567229">(</span><span class="op" id="4567230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4567233">copy</span><span class="op" id="4567237">(</span><span class="ident" id="4567238"><a href="/gostd/crypto/tls/key_agreement.go.html#4567145">preMasterSecret</a></span><span class="op" id="4567253">[</span><span class="builtinfunc" id="4567254">len</span><span class="op" id="4567257">(</span><span class="ident" id="4567258"><a href="/gostd/crypto/tls/key_agreement.go.html#4567145">preMasterSecret</a></span><span class="op" id="4567273">)</span><span class="op" id="4567274">-</span><span class="builtinfunc" id="4567275">len</span><span class="op" id="4567278">(</span><span class="ident" id="4567279"><a href="/gostd/crypto/tls/key_agreement.go.html#4567212">xBytes</a></span><span class="op" id="4567285">)</span><span class="op" id="4567286">:</span><span class="op" id="4567287">]</span><span class="op" id="4567288">,</span>&nbsp;<span class="ident" id="4567290"><a href="/gostd/crypto/tls/key_agreement.go.html#4567212">xBytes</a></span><span class="op" id="4567296">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567300">return</span>&nbsp;<span class="ident" id="4567307"><a href="/gostd/crypto/tls/key_agreement.go.html#4567145">preMasterSecret</a></span><span class="op" id="4567322">,</span>&nbsp;<span class="builtintype" id="4567324">nil</span><br>
<span class="lineno"></span><span class="op" id="4567328">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="4567331">func</span>&nbsp;<span class="op" id="4567336">(</span><span class="ident" id="4567337">ka</span>&nbsp;<span class="op" id="4567340">*</span><span class="ident" id="4567341"><a href="/gostd/crypto/tls/key_agreement.go.html#4563715">ecdheKeyAgreement</a></span><span class="op" id="4567358">)</span>&nbsp;<span class="ident" id="4567360">processServerKeyExchange</span><span class="op" id="4567384">(</span><span class="ident" id="4567385">config</span>&nbsp;<span class="op" id="4567392">*</span><span class="ident" id="4567393"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4567399">,</span>&nbsp;<span class="ident" id="4567401">clientHello</span>&nbsp;<span class="op" id="4567413">*</span><span class="ident" id="4567414"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4567428">,</span>&nbsp;<span class="ident" id="4567430">serverHello</span>&nbsp;<span class="op" id="4567442">*</span><span class="ident" id="4567443"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519382">serverHelloMsg</a></span><span class="op" id="4567457">,</span>&nbsp;<span class="ident" id="4567459">cert</span>&nbsp;<span class="op" id="4567464">*</span><span class="ident" id="4567465"><a href="/gostd/crypto/tls/key_agreement.go.html#4558043">x509</a></span><span class="op" id="4567469">.</span><span class="ident" id="4567470"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><span class="op" id="4567481">,</span>&nbsp;<span class="ident" id="4567483">skx</span>&nbsp;<span class="op" id="4567487">*</span><span class="ident" id="4567488"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526463">serverKeyExchangeMsg</a></span><span class="op" id="4567508">)</span>&nbsp;<span class="builtintype" id="4567510">error</span>&nbsp;<span class="op" id="4567516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567519">if</span>&nbsp;<span class="builtinfunc" id="4567522">len</span><span class="op" id="4567525">(</span><span class="ident" id="4567526"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4567529">.</span><span class="ident" id="4567530"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4567533">)</span>&nbsp;<span class="op" id="4567535">&lt;</span>&nbsp;<span class="num" id="4567537">4</span>&nbsp;<span class="op" id="4567539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567543">return</span>&nbsp;<span class="ident" id="4567550"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567572">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567575">if</span>&nbsp;<span class="ident" id="4567578"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4567581">.</span><span class="ident" id="4567582"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4567585">[</span><span class="num" id="4567586">0</span><span class="op" id="4567587">]</span>&nbsp;<span class="op" id="4567589">!=</span>&nbsp;<span class="num" id="4567592">3</span>&nbsp;<span class="op" id="4567594">{</span>&nbsp;<span class="comment" id="4567596">//&nbsp;named&nbsp;curve</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567613">return</span>&nbsp;<span class="ident" id="4567620"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4567626">.</span><span class="ident" id="4567627"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4567630">(</span><span class="string" id="4567631">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;curve&#34;</span><span class="op" id="4567671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567677">curveid</span>&nbsp;<span class="op" id="4567685">:=</span>&nbsp;<span class="ident" id="4567688"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><span class="op" id="4567695">(</span><span class="ident" id="4567696"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4567699">.</span><span class="ident" id="4567700"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4567703">[</span><span class="num" id="4567704">1</span><span class="op" id="4567705">]</span><span class="op" id="4567706">)</span><span class="op" id="4567707">&lt;&lt;</span><span class="num" id="4567709">8</span>&nbsp;<span class="op" id="4567711">|</span>&nbsp;<span class="ident" id="4567713"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><span class="op" id="4567720">(</span><span class="ident" id="4567721"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4567724">.</span><span class="ident" id="4567725"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4567728">[</span><span class="num" id="4567729">2</span><span class="op" id="4567730">]</span><span class="op" id="4567731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567735">var</span>&nbsp;<span class="ident" id="4567739">ok</span>&nbsp;<span class="builtintype" id="4567742">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567748">if</span>&nbsp;<span class="ident" id="4567751"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4567753">.</span><span class="ident" id="4567754"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4567759">,</span>&nbsp;<span class="ident" id="4567761"><a href="/gostd/crypto/tls/key_agreement.go.html#4567739">ok</a></span>&nbsp;<span class="op" id="4567764">=</span>&nbsp;<span class="ident" id="4567766"><a href="/gostd/crypto/tls/key_agreement.go.html#4563224">curveForCurveID</a></span><span class="op" id="4567781">(</span><span class="ident" id="4567782"><a href="/gostd/crypto/tls/key_agreement.go.html#4567677">curveid</a></span><span class="op" id="4567789">)</span><span class="op" id="4567790">;</span>&nbsp;<span class="op" id="4567792">!</span><span class="ident" id="4567793"><a href="/gostd/crypto/tls/key_agreement.go.html#4567739">ok</a></span>&nbsp;<span class="op" id="4567796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567800">return</span>&nbsp;<span class="ident" id="4567807"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4567813">.</span><span class="ident" id="4567814"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4567817">(</span><span class="string" id="4567818">&#34;tls:&nbsp;server&nbsp;selected&nbsp;unsupported&nbsp;curve&#34;</span><span class="op" id="4567858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567865">publicLen</span>&nbsp;<span class="op" id="4567875">:=</span>&nbsp;<span class="builtintype" id="4567878">int</span><span class="op" id="4567881">(</span><span class="ident" id="4567882"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4567885">.</span><span class="ident" id="4567886"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4567889">[</span><span class="num" id="4567890">3</span><span class="op" id="4567891">]</span><span class="op" id="4567892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567895">if</span>&nbsp;<span class="ident" id="4567898"><a href="/gostd/crypto/tls/key_agreement.go.html#4567865">publicLen</a></span><span class="op" id="4567907">+</span><span class="num" id="4567908">4</span>&nbsp;<span class="op" id="4567910">&gt;</span>&nbsp;<span class="builtinfunc" id="4567912">len</span><span class="op" id="4567915">(</span><span class="ident" id="4567916"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4567919">.</span><span class="ident" id="4567920"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4567923">)</span>&nbsp;<span class="op" id="4567925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4567929">return</span>&nbsp;<span class="ident" id="4567936"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4567958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4567961"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4567963">.</span><span class="ident" id="4567964"><a href="/gostd/crypto/tls/key_agreement.go.html#4563826">x</a></span><span class="op" id="4567965">,</span>&nbsp;<span class="ident" id="4567967"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4567969">.</span><span class="ident" id="4567970"><a href="/gostd/crypto/tls/key_agreement.go.html#4563829">y</a></span>&nbsp;<span class="op" id="4567972">=</span>&nbsp;<span class="ident" id="4567974"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4567982">.</span><span class="ident" id="4567983"><a href="/gostd/crypto/elliptic/elliptic.go.html#3023430">Unmarshal</a></span><span class="op" id="4567992">(</span><span class="ident" id="4567993"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4567995">.</span><span class="ident" id="4567996"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4568001">,</span>&nbsp;<span class="ident" id="4568003"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4568006">.</span><span class="ident" id="4568007"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4568010">[</span><span class="num" id="4568011">4</span><span class="op" id="4568012">:</span><span class="num" id="4568013">4</span><span class="op" id="4568014">+</span><span class="ident" id="4568015"><a href="/gostd/crypto/tls/key_agreement.go.html#4567865">publicLen</a></span><span class="op" id="4568024">]</span><span class="op" id="4568025">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568028">if</span>&nbsp;<span class="ident" id="4568031"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568033">.</span><span class="ident" id="4568034"><a href="/gostd/crypto/tls/key_agreement.go.html#4563826">x</a></span>&nbsp;<span class="op" id="4568036">==</span>&nbsp;<span class="builtintype" id="4568039">nil</span>&nbsp;<span class="op" id="4568043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568047">return</span>&nbsp;<span class="ident" id="4568054"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568079">if</span>&nbsp;<span class="op" id="4568082">!</span><span class="ident" id="4568083"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568085">.</span><span class="ident" id="4568086"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4568091">.</span><span class="ident" id="4568092"><a href="/gostd/crypto/elliptic/elliptic.go.html#3016033">IsOnCurve</a></span><span class="op" id="4568101">(</span><span class="ident" id="4568102"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568104">.</span><span class="ident" id="4568105"><a href="/gostd/crypto/tls/key_agreement.go.html#4563826">x</a></span><span class="op" id="4568106">,</span>&nbsp;<span class="ident" id="4568108"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568110">.</span><span class="ident" id="4568111"><a href="/gostd/crypto/tls/key_agreement.go.html#4563829">y</a></span><span class="op" id="4568112">)</span>&nbsp;<span class="op" id="4568114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568118">return</span>&nbsp;<span class="ident" id="4568125"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568150">serverECDHParams</span>&nbsp;<span class="op" id="4568167">:=</span>&nbsp;<span class="ident" id="4568170"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4568173">.</span><span class="ident" id="4568174"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4568177">[</span><span class="op" id="4568178">:</span><span class="num" id="4568179">4</span><span class="op" id="4568180">+</span><span class="ident" id="4568181"><a href="/gostd/crypto/tls/key_agreement.go.html#4567865">publicLen</a></span><span class="op" id="4568190">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568194">sig</span>&nbsp;<span class="op" id="4568198">:=</span>&nbsp;<span class="ident" id="4568201"><a href="/gostd/crypto/tls/key_agreement.go.html#4567483">skx</a></span><span class="op" id="4568204">.</span><span class="ident" id="4568205"><a href="/gostd/crypto/tls/handshake_messages.go.html#4526506">key</a></span><span class="op" id="4568208">[</span><span class="num" id="4568209">4</span><span class="op" id="4568210">+</span><span class="ident" id="4568211"><a href="/gostd/crypto/tls/key_agreement.go.html#4567865">publicLen</a></span><span class="op" id="4568220">:</span><span class="op" id="4568221">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568224">if</span>&nbsp;<span class="builtinfunc" id="4568227">len</span><span class="op" id="4568230">(</span><span class="ident" id="4568231"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568234">)</span>&nbsp;<span class="op" id="4568236">&lt;</span>&nbsp;<span class="num" id="4568238">2</span>&nbsp;<span class="op" id="4568240">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568244">return</span>&nbsp;<span class="ident" id="4568251"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568277">var</span>&nbsp;<span class="ident" id="4568281">tls12HashId</span>&nbsp;<span class="builtintype" id="4568293">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568300">if</span>&nbsp;<span class="ident" id="4568303"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568305">.</span><span class="ident" id="4568306"><a href="/gostd/crypto/tls/key_agreement.go.html#4563743">version</a></span>&nbsp;<span class="op" id="4568314">&gt;=</span>&nbsp;<span class="ident" id="4568317"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span>&nbsp;<span class="op" id="4568330">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4568334">//&nbsp;handle&nbsp;SignatureAndHashAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568372">var</span>&nbsp;<span class="ident" id="4568376">sigAndHash</span>&nbsp;<span class="op" id="4568387">[</span><span class="op" id="4568388">]</span><span class="builtintype" id="4568389">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568397"><a href="/gostd/crypto/tls/key_agreement.go.html#4568376">sigAndHash</a></span><span class="op" id="4568407">,</span>&nbsp;<span class="ident" id="4568409"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span>&nbsp;<span class="op" id="4568413">=</span>&nbsp;<span class="ident" id="4568415"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568418">[</span><span class="op" id="4568419">:</span><span class="num" id="4568420">2</span><span class="op" id="4568421">]</span><span class="op" id="4568422">,</span>&nbsp;<span class="ident" id="4568424"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568427">[</span><span class="num" id="4568428">2</span><span class="op" id="4568429">:</span><span class="op" id="4568430">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568434">if</span>&nbsp;<span class="ident" id="4568437"><a href="/gostd/crypto/tls/key_agreement.go.html#4568376">sigAndHash</a></span><span class="op" id="4568447">[</span><span class="num" id="4568448">1</span><span class="op" id="4568449">]</span>&nbsp;<span class="op" id="4568451">!=</span>&nbsp;<span class="ident" id="4568454"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568456">.</span><span class="ident" id="4568457"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span>&nbsp;<span class="op" id="4568465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568470">return</span>&nbsp;<span class="ident" id="4568477"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568504"><a href="/gostd/crypto/tls/key_agreement.go.html#4568281">tls12HashId</a></span>&nbsp;<span class="op" id="4568516">=</span>&nbsp;<span class="ident" id="4568518"><a href="/gostd/crypto/tls/key_agreement.go.html#4568376">sigAndHash</a></span><span class="op" id="4568528">[</span><span class="num" id="4568529">0</span><span class="op" id="4568530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568534">if</span>&nbsp;<span class="builtinfunc" id="4568537">len</span><span class="op" id="4568540">(</span><span class="ident" id="4568541"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568544">)</span>&nbsp;<span class="op" id="4568546">&lt;</span>&nbsp;<span class="num" id="4568548">2</span>&nbsp;<span class="op" id="4568550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568555">return</span>&nbsp;<span class="ident" id="4568562"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568585">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568591">sigLen</span>&nbsp;<span class="op" id="4568598">:=</span>&nbsp;<span class="builtintype" id="4568601">int</span><span class="op" id="4568604">(</span><span class="ident" id="4568605"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568608">[</span><span class="num" id="4568609">0</span><span class="op" id="4568610">]</span><span class="op" id="4568611">)</span><span class="op" id="4568612">&lt;&lt;</span><span class="num" id="4568614">8</span>&nbsp;<span class="op" id="4568616">|</span>&nbsp;<span class="builtintype" id="4568618">int</span><span class="op" id="4568621">(</span><span class="ident" id="4568622"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568625">[</span><span class="num" id="4568626">1</span><span class="op" id="4568627">]</span><span class="op" id="4568628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568631">if</span>&nbsp;<span class="ident" id="4568634"><a href="/gostd/crypto/tls/key_agreement.go.html#4568591">sigLen</a></span><span class="op" id="4568640">+</span><span class="num" id="4568641">2</span>&nbsp;<span class="op" id="4568643">!=</span>&nbsp;<span class="builtinfunc" id="4568646">len</span><span class="op" id="4568649">(</span><span class="ident" id="4568650"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568653">)</span>&nbsp;<span class="op" id="4568655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568659">return</span>&nbsp;<span class="ident" id="4568666"><a href="/gostd/crypto/tls/key_agreement.go.html#4558189">errServerKeyExchange</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568688">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568691"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span>&nbsp;<span class="op" id="4568695">=</span>&nbsp;<span class="ident" id="4568697"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4568700">[</span><span class="num" id="4568701">2</span><span class="op" id="4568702">:</span><span class="op" id="4568703">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568707">digest</span><span class="op" id="4568713">,</span>&nbsp;<span class="ident" id="4568715">hashFunc</span><span class="op" id="4568723">,</span>&nbsp;<span class="ident" id="4568725">err</span>&nbsp;<span class="op" id="4568729">:=</span>&nbsp;<span class="ident" id="4568732"><a href="/gostd/crypto/tls/key_agreement.go.html#4561833">hashForServerKeyExchange</a></span><span class="op" id="4568756">(</span><span class="ident" id="4568757"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568759">.</span><span class="ident" id="4568760"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span><span class="op" id="4568767">,</span>&nbsp;<span class="ident" id="4568769"><a href="/gostd/crypto/tls/key_agreement.go.html#4568281">tls12HashId</a></span><span class="op" id="4568780">,</span>&nbsp;<span class="ident" id="4568782"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568784">.</span><span class="ident" id="4568785"><a href="/gostd/crypto/tls/key_agreement.go.html#4563743">version</a></span><span class="op" id="4568792">,</span>&nbsp;<span class="ident" id="4568794"><a href="/gostd/crypto/tls/key_agreement.go.html#4567401">clientHello</a></span><span class="op" id="4568805">.</span><span class="ident" id="4568806"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508347">random</a></span><span class="op" id="4568812">,</span>&nbsp;<span class="ident" id="4568814"><a href="/gostd/crypto/tls/key_agreement.go.html#4567430">serverHello</a></span><span class="op" id="4568825">.</span><span class="ident" id="4568826"><a href="/gostd/crypto/tls/handshake_messages.go.html#4519463">random</a></span><span class="op" id="4568832">,</span>&nbsp;<span class="ident" id="4568834"><a href="/gostd/crypto/tls/key_agreement.go.html#4568150">serverECDHParams</a></span><span class="op" id="4568850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568853">if</span>&nbsp;<span class="ident" id="4568856"><a href="/gostd/crypto/tls/key_agreement.go.html#4568725">err</a></span>&nbsp;<span class="op" id="4568860">!=</span>&nbsp;<span class="builtintype" id="4568863">nil</span>&nbsp;<span class="op" id="4568867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568871">return</span>&nbsp;<span class="ident" id="4568878"><a href="/gostd/crypto/tls/key_agreement.go.html#4568725">err</a></span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4568883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568886">switch</span>&nbsp;<span class="ident" id="4568893"><a href="/gostd/crypto/tls/key_agreement.go.html#4567337">ka</a></span><span class="op" id="4568895">.</span><span class="ident" id="4568896"><a href="/gostd/crypto/tls/key_agreement.go.html#4563762">sigType</a></span>&nbsp;<span class="op" id="4568904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568907">case</span>&nbsp;<span class="ident" id="4568912"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4568926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4568930">pubKey</span><span class="op" id="4568936">,</span>&nbsp;<span class="ident" id="4568938">ok</span>&nbsp;<span class="op" id="4568941">:=</span>&nbsp;<span class="ident" id="4568944"><a href="/gostd/crypto/tls/key_agreement.go.html#4567459">cert</a></span><span class="op" id="4568948">.</span><span class="ident" id="4568949"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4568958">.</span><span class="op" id="4568959">(</span><span class="op" id="4568960">*</span><span class="ident" id="4568961"><a href="/gostd/crypto/tls/key_agreement.go.html#4557948">ecdsa</a></span><span class="op" id="4568966">.</span><span class="ident" id="4568967"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3005409">PublicKey</a></span><span class="op" id="4568976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568980">if</span>&nbsp;<span class="op" id="4568983">!</span><span class="ident" id="4568984"><a href="/gostd/crypto/tls/key_agreement.go.html#4568938">ok</a></span>&nbsp;<span class="op" id="4568987">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4568992">return</span>&nbsp;<span class="ident" id="4568999"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4569005">.</span><span class="ident" id="4569006"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4569009">(</span><span class="string" id="4569010">&#34;ECDHE&nbsp;ECDSA&nbsp;requires&nbsp;a&nbsp;ECDSA&nbsp;server&nbsp;public&nbsp;key&#34;</span><span class="op" id="4569058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569066">ecdsaSig</span>&nbsp;<span class="op" id="4569075">:=</span>&nbsp;<span class="builtinfunc" id="4569078">new</span><span class="op" id="4569081">(</span><span class="ident" id="4569082"><a href="/gostd/crypto/tls/common.go.html#4460840">ecdsaSignature</a></span><span class="op" id="4569096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569100">if</span>&nbsp;<span class="ident" id="4569103">_</span><span class="op" id="4569104">,</span>&nbsp;<span class="ident" id="4569106">err</span>&nbsp;<span class="op" id="4569110">:=</span>&nbsp;<span class="ident" id="4569113"><a href="/gostd/crypto/tls/key_agreement.go.html#4558058">asn1</a></span><span class="op" id="4569117">.</span><span class="ident" id="4569118"><a href="/gostd/encoding/asn1/asn1.go.html#3112967">Unmarshal</a></span><span class="op" id="4569127">(</span><span class="ident" id="4569128"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4569131">,</span>&nbsp;<span class="ident" id="4569133"><a href="/gostd/crypto/tls/key_agreement.go.html#4569066">ecdsaSig</a></span><span class="op" id="4569141">)</span><span class="op" id="4569142">;</span>&nbsp;<span class="ident" id="4569144"><a href="/gostd/crypto/tls/key_agreement.go.html#4569106">err</a></span>&nbsp;<span class="op" id="4569148">!=</span>&nbsp;<span class="builtintype" id="4569151">nil</span>&nbsp;<span class="op" id="4569155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569160">return</span>&nbsp;<span class="ident" id="4569167"><a href="/gostd/crypto/tls/key_agreement.go.html#4569106">err</a></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569177">if</span>&nbsp;<span class="ident" id="4569180"><a href="/gostd/crypto/tls/key_agreement.go.html#4569066">ecdsaSig</a></span><span class="op" id="4569188">.</span><span class="ident" id="4569189"><a href="/gostd/crypto/tls/common.go.html#4460818">R</a></span><span class="op" id="4569190">.</span><span class="ident" id="4569191"><a href="/gostd/math/big/int.go.html#2036181">Sign</a></span><span class="op" id="4569195">(</span><span class="op" id="4569196">)</span>&nbsp;<span class="op" id="4569198">&lt;=</span>&nbsp;<span class="num" id="4569201">0</span>&nbsp;<span class="op" id="4569203">||</span>&nbsp;<span class="ident" id="4569206"><a href="/gostd/crypto/tls/key_agreement.go.html#4569066">ecdsaSig</a></span><span class="op" id="4569214">.</span><span class="ident" id="4569215"><a href="/gostd/crypto/tls/common.go.html#4460821">S</a></span><span class="op" id="4569216">.</span><span class="ident" id="4569217"><a href="/gostd/math/big/int.go.html#2036181">Sign</a></span><span class="op" id="4569221">(</span><span class="op" id="4569222">)</span>&nbsp;<span class="op" id="4569224">&lt;=</span>&nbsp;<span class="num" id="4569227">0</span>&nbsp;<span class="op" id="4569229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569234">return</span>&nbsp;<span class="ident" id="4569241"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4569247">.</span><span class="ident" id="4569248"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4569251">(</span><span class="string" id="4569252">&#34;ECDSA&nbsp;signature&nbsp;contained&nbsp;zero&nbsp;or&nbsp;negative&nbsp;values&#34;</span><span class="op" id="4569303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569311">if</span>&nbsp;<span class="op" id="4569314">!</span><span class="ident" id="4569315"><a href="/gostd/crypto/tls/key_agreement.go.html#4557948">ecdsa</a></span><span class="op" id="4569320">.</span><span class="ident" id="4569321"><a href="/gostd/crypto/ecdsa/ecdsa.go.html#3009119">Verify</a></span><span class="op" id="4569327">(</span><span class="ident" id="4569328"><a href="/gostd/crypto/tls/key_agreement.go.html#4568930">pubKey</a></span><span class="op" id="4569334">,</span>&nbsp;<span class="ident" id="4569336"><a href="/gostd/crypto/tls/key_agreement.go.html#4568707">digest</a></span><span class="op" id="4569342">,</span>&nbsp;<span class="ident" id="4569344"><a href="/gostd/crypto/tls/key_agreement.go.html#4569066">ecdsaSig</a></span><span class="op" id="4569352">.</span><span class="ident" id="4569353"><a href="/gostd/crypto/tls/common.go.html#4460818">R</a></span><span class="op" id="4569354">,</span>&nbsp;<span class="ident" id="4569356"><a href="/gostd/crypto/tls/key_agreement.go.html#4569066">ecdsaSig</a></span><span class="op" id="4569364">.</span><span class="ident" id="4569365"><a href="/gostd/crypto/tls/common.go.html#4460821">S</a></span><span class="op" id="4569366">)</span>&nbsp;<span class="op" id="4569368">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569373">return</span>&nbsp;<span class="ident" id="4569380"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4569386">.</span><span class="ident" id="4569387"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4569390">(</span><span class="string" id="4569391">&#34;ECDSA&nbsp;verification&nbsp;failure&#34;</span><span class="op" id="4569419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569426">case</span>&nbsp;<span class="ident" id="4569431"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4569443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4569447">pubKey</span><span class="op" id="4569453">,</span>&nbsp;<span class="ident" id="4569455">ok</span>&nbsp;<span class="op" id="4569458">:=</span>&nbsp;<span class="ident" id="4569461"><a href="/gostd/crypto/tls/key_agreement.go.html#4567459">cert</a></span><span class="op" id="4569465">.</span><span class="ident" id="4569466"><a href="/gostd/crypto/x509/x509.go.html#4660263">PublicKey</a></span><span class="op" id="4569475">.</span><span class="op" id="4569476">(</span><span class="op" id="4569477">*</span><span class="ident" id="4569478"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4569481">.</span><span class="ident" id="4569482"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4569491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569495">if</span>&nbsp;<span class="op" id="4569498">!</span><span class="ident" id="4569499"><a href="/gostd/crypto/tls/key_agreement.go.html#4569455">ok</a></span>&nbsp;<span class="op" id="4569502">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569507">return</span>&nbsp;<span class="ident" id="4569514"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4569520">.</span><span class="ident" id="4569521"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4569524">(</span><span class="string" id="4569525">&#34;ECDHE&nbsp;RSA&nbsp;requires&nbsp;a&nbsp;RSA&nbsp;server&nbsp;public&nbsp;key&#34;</span><span class="op" id="4569569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569577">if</span>&nbsp;<span class="ident" id="4569580">err</span>&nbsp;<span class="op" id="4569584">:=</span>&nbsp;<span class="ident" id="4569587"><a href="/gostd/crypto/tls/key_agreement.go.html#4557997">rsa</a></span><span class="op" id="4569590">.</span><span class="ident" id="4569591"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732385">VerifyPKCS1v15</a></span><span class="op" id="4569605">(</span><span class="ident" id="4569606"><a href="/gostd/crypto/tls/key_agreement.go.html#4569447">pubKey</a></span><span class="op" id="4569612">,</span>&nbsp;<span class="ident" id="4569614"><a href="/gostd/crypto/tls/key_agreement.go.html#4568715">hashFunc</a></span><span class="op" id="4569622">,</span>&nbsp;<span class="ident" id="4569624"><a href="/gostd/crypto/tls/key_agreement.go.html#4568707">digest</a></span><span class="op" id="4569630">,</span>&nbsp;<span class="ident" id="4569632"><a href="/gostd/crypto/tls/key_agreement.go.html#4568194">sig</a></span><span class="op" id="4569635">)</span><span class="op" id="4569636">;</span>&nbsp;<span class="ident" id="4569638"><a href="/gostd/crypto/tls/key_agreement.go.html#4569580">err</a></span>&nbsp;<span class="op" id="4569642">!=</span>&nbsp;<span class="builtintype" id="4569645">nil</span>&nbsp;<span class="op" id="4569649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569654">return</span>&nbsp;<span class="ident" id="4569661"><a href="/gostd/crypto/tls/key_agreement.go.html#4569580">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569667">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569670">default</span><span class="op" id="4569677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569681">return</span>&nbsp;<span class="ident" id="4569688"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4569694">.</span><span class="ident" id="4569695"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4569698">(</span><span class="string" id="4569699">&#34;unknown&nbsp;ECDHE&nbsp;signature&nbsp;algorithm&#34;</span><span class="op" id="4569734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4569737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569741">return</span>&nbsp;<span class="builtintype" id="4569748">nil</span><br>
<span class="lineno">390</span><span class="op" id="4569752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4569755">func</span>&nbsp;<span class="op" id="4569760">(</span><span class="ident" id="4569761">ka</span>&nbsp;<span class="op" id="4569764">*</span><span class="ident" id="4569765"><a href="/gostd/crypto/tls/key_agreement.go.html#4563715">ecdheKeyAgreement</a></span><span class="op" id="4569782">)</span>&nbsp;<span class="ident" id="4569784">generateClientKeyExchange</span><span class="op" id="4569809">(</span><span class="ident" id="4569810">config</span>&nbsp;<span class="op" id="4569817">*</span><span class="ident" id="4569818"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4569824">,</span>&nbsp;<span class="ident" id="4569826">clientHello</span>&nbsp;<span class="op" id="4569838">*</span><span class="ident" id="4569839"><a href="/gostd/crypto/tls/handshake_messages.go.html#4508266">clientHelloMsg</a></span><span class="op" id="4569853">,</span>&nbsp;<span class="ident" id="4569855">cert</span>&nbsp;<span class="op" id="4569860">*</span><span class="ident" id="4569861"><a href="/gostd/crypto/tls/key_agreement.go.html#4558043">x509</a></span><span class="op" id="4569865">.</span><span class="ident" id="4569866"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><span class="op" id="4569877">)</span>&nbsp;<span class="op" id="4569879">(</span><span class="op" id="4569880">[</span><span class="op" id="4569881">]</span><span class="builtintype" id="4569882">byte</span><span class="op" id="4569886">,</span>&nbsp;<span class="op" id="4569888">*</span><span class="ident" id="4569889"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4569909">,</span>&nbsp;<span class="builtintype" id="4569911">error</span><span class="op" id="4569916">)</span>&nbsp;<span class="op" id="4569918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569921">if</span>&nbsp;<span class="ident" id="4569924"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4569926">.</span><span class="ident" id="4569927"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span>&nbsp;<span class="op" id="4569933">==</span>&nbsp;<span class="builtintype" id="4569936">nil</span>&nbsp;<span class="op" id="4569940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4569944">return</span>&nbsp;<span class="builtintype" id="4569951">nil</span><span class="op" id="4569954">,</span>&nbsp;<span class="builtintype" id="4569956">nil</span><span class="op" id="4569959">,</span>&nbsp;<span class="ident" id="4569961"><a href="/gostd/crypto/tls/key_agreement.go.html#4558075">errors</a></span><span class="op" id="4569967">.</span><span class="ident" id="4569968"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4569971">(</span><span class="string" id="4569972">&#34;missing&nbsp;ServerKeyExchange&nbsp;message&#34;</span><span class="op" id="4570007">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570013">priv</span><span class="op" id="4570017">,</span>&nbsp;<span class="ident" id="4570019">mx</span><span class="op" id="4570021">,</span>&nbsp;<span class="ident" id="4570023">my</span><span class="op" id="4570025">,</span>&nbsp;<span class="ident" id="4570027">err</span>&nbsp;<span class="op" id="4570031">:=</span>&nbsp;<span class="ident" id="4570034"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4570042">.</span><span class="ident" id="4570043"><a href="/gostd/crypto/elliptic/elliptic.go.html#3022321">GenerateKey</a></span><span class="op" id="4570054">(</span><span class="ident" id="4570055"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4570057">.</span><span class="ident" id="4570058"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4570063">,</span>&nbsp;<span class="ident" id="4570065"><a href="/gostd/crypto/tls/key_agreement.go.html#4569810">config</a></span><span class="op" id="4570071">.</span><span class="ident" id="4570072"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4570076">(</span><span class="op" id="4570077">)</span><span class="op" id="4570078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4570081">if</span>&nbsp;<span class="ident" id="4570084"><a href="/gostd/crypto/tls/key_agreement.go.html#4570027">err</a></span>&nbsp;<span class="op" id="4570088">!=</span>&nbsp;<span class="builtintype" id="4570091">nil</span>&nbsp;<span class="op" id="4570095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4570099">return</span>&nbsp;<span class="builtintype" id="4570106">nil</span><span class="op" id="4570109">,</span>&nbsp;<span class="builtintype" id="4570111">nil</span><span class="op" id="4570114">,</span>&nbsp;<span class="ident" id="4570116"><a href="/gostd/crypto/tls/key_agreement.go.html#4570027">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4570121">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570124">x</span><span class="op" id="4570125">,</span>&nbsp;<span class="ident" id="4570127">_</span>&nbsp;<span class="op" id="4570129">:=</span>&nbsp;<span class="ident" id="4570132"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4570134">.</span><span class="ident" id="4570135"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4570140">.</span><span class="ident" id="4570141"><a href="/gostd/crypto/elliptic/elliptic.go.html#3016298">ScalarMult</a></span><span class="op" id="4570151">(</span><span class="ident" id="4570152"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4570154">.</span><span class="ident" id="4570155"><a href="/gostd/crypto/tls/key_agreement.go.html#4563826">x</a></span><span class="op" id="4570156">,</span>&nbsp;<span class="ident" id="4570158"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4570160">.</span><span class="ident" id="4570161"><a href="/gostd/crypto/tls/key_agreement.go.html#4563829">y</a></span><span class="op" id="4570162">,</span>&nbsp;<span class="ident" id="4570164"><a href="/gostd/crypto/tls/key_agreement.go.html#4570013">priv</a></span><span class="op" id="4570168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570171">preMasterSecret</span>&nbsp;<span class="op" id="4570187">:=</span>&nbsp;<span class="builtinfunc" id="4570190">make</span><span class="op" id="4570194">(</span><span class="op" id="4570195">[</span><span class="op" id="4570196">]</span><span class="builtintype" id="4570197">byte</span><span class="op" id="4570201">,</span>&nbsp;<span class="op" id="4570203">(</span><span class="ident" id="4570204"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4570206">.</span><span class="ident" id="4570207"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4570212">.</span><span class="ident" id="4570213"><a href="/gostd/crypto/elliptic/elliptic.go.html#3015945">Params</a></span><span class="op" id="4570219">(</span><span class="op" id="4570220">)</span><span class="op" id="4570221">.</span><span class="ident" id="4570222"><a href="/gostd/crypto/elliptic/elliptic.go.html#3016879">BitSize</a></span><span class="op" id="4570229">+</span><span class="num" id="4570230">7</span><span class="op" id="4570231">)</span><span class="op" id="4570232">&gt;&gt;</span><span class="num" id="4570234">3</span><span class="op" id="4570235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570238">xBytes</span>&nbsp;<span class="op" id="4570245">:=</span>&nbsp;<span class="ident" id="4570248"><a href="/gostd/crypto/tls/key_agreement.go.html#4570124">x</a></span><span class="op" id="4570249">.</span><span class="ident" id="4570250"><a href="/gostd/math/big/int.go.html#2050194">Bytes</a></span><span class="op" id="4570255">(</span><span class="op" id="4570256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4570259">copy</span><span class="op" id="4570263">(</span><span class="ident" id="4570264"><a href="/gostd/crypto/tls/key_agreement.go.html#4570171">preMasterSecret</a></span><span class="op" id="4570279">[</span><span class="builtinfunc" id="4570280">len</span><span class="op" id="4570283">(</span><span class="ident" id="4570284"><a href="/gostd/crypto/tls/key_agreement.go.html#4570171">preMasterSecret</a></span><span class="op" id="4570299">)</span><span class="op" id="4570300">-</span><span class="builtinfunc" id="4570301">len</span><span class="op" id="4570304">(</span><span class="ident" id="4570305"><a href="/gostd/crypto/tls/key_agreement.go.html#4570238">xBytes</a></span><span class="op" id="4570311">)</span><span class="op" id="4570312">:</span><span class="op" id="4570313">]</span><span class="op" id="4570314">,</span>&nbsp;<span class="ident" id="4570316"><a href="/gostd/crypto/tls/key_agreement.go.html#4570238">xBytes</a></span><span class="op" id="4570322">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570326">serialized</span>&nbsp;<span class="op" id="4570337">:=</span>&nbsp;<span class="ident" id="4570340"><a href="/gostd/crypto/tls/key_agreement.go.html#4557964">elliptic</a></span><span class="op" id="4570348">.</span><span class="ident" id="4570349"><a href="/gostd/crypto/elliptic/elliptic.go.html#3023027">Marshal</a></span><span class="op" id="4570356">(</span><span class="ident" id="4570357"><a href="/gostd/crypto/tls/key_agreement.go.html#4569761">ka</a></span><span class="op" id="4570359">.</span><span class="ident" id="4570360"><a href="/gostd/crypto/tls/key_agreement.go.html#4563799">curve</a></span><span class="op" id="4570365">,</span>&nbsp;<span class="ident" id="4570367"><a href="/gostd/crypto/tls/key_agreement.go.html#4570019">mx</a></span><span class="op" id="4570369">,</span>&nbsp;<span class="ident" id="4570371"><a href="/gostd/crypto/tls/key_agreement.go.html#4570023">my</a></span><span class="op" id="4570373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570377">ckx</span>&nbsp;<span class="op" id="4570381">:=</span>&nbsp;<span class="builtinfunc" id="4570384">new</span><span class="op" id="4570387">(</span><span class="ident" id="4570388"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528753">clientKeyExchangeMsg</a></span><span class="op" id="4570408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570411"><a href="/gostd/crypto/tls/key_agreement.go.html#4570377">ckx</a></span><span class="op" id="4570414">.</span><span class="ident" id="4570415"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span>&nbsp;<span class="op" id="4570426">=</span>&nbsp;<span class="builtinfunc" id="4570428">make</span><span class="op" id="4570432">(</span><span class="op" id="4570433">[</span><span class="op" id="4570434">]</span><span class="builtintype" id="4570435">byte</span><span class="op" id="4570439">,</span>&nbsp;<span class="num" id="4570441">1</span><span class="op" id="4570442">+</span><span class="builtinfunc" id="4570443">len</span><span class="op" id="4570446">(</span><span class="ident" id="4570447"><a href="/gostd/crypto/tls/key_agreement.go.html#4570326">serialized</a></span><span class="op" id="4570457">)</span><span class="op" id="4570458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4570461"><a href="/gostd/crypto/tls/key_agreement.go.html#4570377">ckx</a></span><span class="op" id="4570464">.</span><span class="ident" id="4570465"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4570475">[</span><span class="num" id="4570476">0</span><span class="op" id="4570477">]</span>&nbsp;<span class="op" id="4570479">=</span>&nbsp;<span class="builtintype" id="4570481">byte</span><span class="op" id="4570485">(</span><span class="builtinfunc" id="4570486">len</span><span class="op" id="4570489">(</span><span class="ident" id="4570490"><a href="/gostd/crypto/tls/key_agreement.go.html#4570326">serialized</a></span><span class="op" id="4570500">)</span><span class="op" id="4570501">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4570504">copy</span><span class="op" id="4570508">(</span><span class="ident" id="4570509"><a href="/gostd/crypto/tls/key_agreement.go.html#4570377">ckx</a></span><span class="op" id="4570512">.</span><span class="ident" id="4570513"><a href="/gostd/crypto/tls/handshake_messages.go.html#4528803">ciphertext</a></span><span class="op" id="4570523">[</span><span class="num" id="4570524">1</span><span class="op" id="4570525">:</span><span class="op" id="4570526">]</span><span class="op" id="4570527">,</span>&nbsp;<span class="ident" id="4570529"><a href="/gostd/crypto/tls/key_agreement.go.html#4570326">serialized</a></span><span class="op" id="4570539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4570543">return</span>&nbsp;<span class="ident" id="4570550"><a href="/gostd/crypto/tls/key_agreement.go.html#4570171">preMasterSecret</a></span><span class="op" id="4570565">,</span>&nbsp;<span class="ident" id="4570567"><a href="/gostd/crypto/tls/key_agreement.go.html#4570377">ckx</a></span><span class="op" id="4570570">,</span>&nbsp;<span class="builtintype" id="4570572">nil</span><br>
<span class="lineno"></span><span class="op" id="4570576">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
