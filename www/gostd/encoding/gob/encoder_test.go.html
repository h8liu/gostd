<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6706067">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6706122">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6706176">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6706227">package</span>&nbsp;<span class="ident" id="6706235">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6706240">import</span>&nbsp;<span class="op" id="6706247">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706250">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706259">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706266">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706272">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706283">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6706294">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6706304">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6706307">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="6706350">func</span>&nbsp;<span class="ident" id="6706355">TestBasicEncoderDecoder</span><span class="op" id="6706378">(</span><span class="ident" id="6706379">t</span>&nbsp;<span class="op" id="6706381">*</span><span class="ident" id="6706382">testing</span><span class="op" id="6706389">.</span><span class="ident" id="6706390">T</span><span class="op" id="6706391">)</span>&nbsp;<span class="op" id="6706393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6706396">var</span>&nbsp;<span class="ident" id="6706400">values</span>&nbsp;<span class="op" id="6706407">=</span>&nbsp;<span class="op" id="6706409">[</span><span class="op" id="6706410">]</span><span class="keyword" id="6706411">interface</span><span class="op" id="6706420">{</span><span class="op" id="6706421">}</span><span class="op" id="6706422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706426">true</span><span class="op" id="6706430">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706434">int</span><span class="op" id="6706437">(</span><span class="num" id="6706438">123</span><span class="op" id="6706441">)</span><span class="op" id="6706442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706446">int8</span><span class="op" id="6706450">(</span><span class="num" id="6706451">123</span><span class="op" id="6706454">)</span><span class="op" id="6706455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706459">int16</span><span class="op" id="6706464">(</span><span class="op" id="6706465">-</span><span class="num" id="6706466">12345</span><span class="op" id="6706471">)</span><span class="op" id="6706472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706476">int32</span><span class="op" id="6706481">(</span><span class="num" id="6706482">123456</span><span class="op" id="6706488">)</span><span class="op" id="6706489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706493">int64</span><span class="op" id="6706498">(</span><span class="op" id="6706499">-</span><span class="num" id="6706500">1234567</span><span class="op" id="6706507">)</span><span class="op" id="6706508">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706512">uint</span><span class="op" id="6706516">(</span><span class="num" id="6706517">123</span><span class="op" id="6706520">)</span><span class="op" id="6706521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706525">uint8</span><span class="op" id="6706530">(</span><span class="num" id="6706531">123</span><span class="op" id="6706534">)</span><span class="op" id="6706535">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706539">uint16</span><span class="op" id="6706545">(</span><span class="num" id="6706546">12345</span><span class="op" id="6706551">)</span><span class="op" id="6706552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706556">uint32</span><span class="op" id="6706562">(</span><span class="num" id="6706563">123456</span><span class="op" id="6706569">)</span><span class="op" id="6706570">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706574">uint64</span><span class="op" id="6706580">(</span><span class="num" id="6706581">1234567</span><span class="op" id="6706588">)</span><span class="op" id="6706589">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706593">uintptr</span><span class="op" id="6706600">(</span><span class="num" id="6706601">12345678</span><span class="op" id="6706609">)</span><span class="op" id="6706610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706614">float32</span><span class="op" id="6706621">(</span><span class="num" id="6706622">1.2345</span><span class="op" id="6706628">)</span><span class="op" id="6706629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706633">float64</span><span class="op" id="6706640">(</span><span class="num" id="6706641">1.2345678</span><span class="op" id="6706650">)</span><span class="op" id="6706651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706655">complex64</span><span class="op" id="6706664">(</span><span class="num" id="6706665">1.2345</span>&nbsp;<span class="op" id="6706672">+</span>&nbsp;<span class="num" id="6706674">2.3456i</span><span class="op" id="6706681">)</span><span class="op" id="6706682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706686">complex128</span><span class="op" id="6706696">(</span><span class="num" id="6706697">1.2345678</span>&nbsp;<span class="op" id="6706707">+</span>&nbsp;<span class="num" id="6706709">2.3456789i</span><span class="op" id="6706719">)</span><span class="op" id="6706720">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706724">[</span><span class="op" id="6706725">]</span><span class="builtintype" id="6706726">byte</span><span class="op" id="6706730">(</span><span class="string" id="6706731">&#34;hello&#34;</span><span class="op" id="6706738">)</span><span class="op" id="6706739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6706743">string</span><span class="op" id="6706749">(</span><span class="string" id="6706750">&#34;hello&#34;</span><span class="op" id="6706757">)</span><span class="op" id="6706758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6706764">for</span>&nbsp;<span class="ident" id="6706768">_</span><span class="op" id="6706769">,</span>&nbsp;<span class="ident" id="6706771">value</span>&nbsp;<span class="op" id="6706777">:=</span>&nbsp;<span class="keyword" id="6706780">range</span>&nbsp;<span class="ident" id="6706786">values</span>&nbsp;<span class="op" id="6706793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706797">b</span>&nbsp;<span class="op" id="6706799">:=</span>&nbsp;<span class="builtinfunc" id="6706802">new</span><span class="op" id="6706805">(</span><span class="ident" id="6706806">bytes</span><span class="op" id="6706811">.</span><span class="ident" id="6706812">Buffer</span><span class="op" id="6706818">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706822">enc</span>&nbsp;<span class="op" id="6706826">:=</span>&nbsp;<span class="ident" id="6706829">NewEncoder</span><span class="op" id="6706839">(</span><span class="ident" id="6706840">b</span><span class="op" id="6706841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706845">err</span>&nbsp;<span class="op" id="6706849">:=</span>&nbsp;<span class="ident" id="6706852">enc</span><span class="op" id="6706855">.</span><span class="ident" id="6706856">Encode</span><span class="op" id="6706862">(</span><span class="ident" id="6706863">value</span><span class="op" id="6706868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6706872">if</span>&nbsp;<span class="ident" id="6706875">err</span>&nbsp;<span class="op" id="6706879">!=</span>&nbsp;<span class="ident" id="6706882">nil</span>&nbsp;<span class="op" id="6706886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706891">t</span><span class="op" id="6706892">.</span><span class="ident" id="6706893">Error</span><span class="op" id="6706898">(</span><span class="string" id="6706899">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="6706914">,</span>&nbsp;<span class="ident" id="6706916">err</span><span class="op" id="6706919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6706923">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706927">dec</span>&nbsp;<span class="op" id="6706931">:=</span>&nbsp;<span class="ident" id="6706934">NewDecoder</span><span class="op" id="6706944">(</span><span class="ident" id="6706945">b</span><span class="op" id="6706946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706950">result</span>&nbsp;<span class="op" id="6706957">:=</span>&nbsp;<span class="ident" id="6706960">reflect</span><span class="op" id="6706967">.</span><span class="ident" id="6706968">New</span><span class="op" id="6706971">(</span><span class="ident" id="6706972">reflect</span><span class="op" id="6706979">.</span><span class="ident" id="6706980">TypeOf</span><span class="op" id="6706986">(</span><span class="ident" id="6706987">value</span><span class="op" id="6706992">)</span><span class="op" id="6706993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6706997">err</span>&nbsp;<span class="op" id="6707001">=</span>&nbsp;<span class="ident" id="6707003">dec</span><span class="op" id="6707006">.</span><span class="ident" id="6707007">Decode</span><span class="op" id="6707013">(</span><span class="ident" id="6707014">result</span><span class="op" id="6707020">.</span><span class="ident" id="6707021">Interface</span><span class="op" id="6707030">(</span><span class="op" id="6707031">)</span><span class="op" id="6707032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707036">if</span>&nbsp;<span class="ident" id="6707039">err</span>&nbsp;<span class="op" id="6707043">!=</span>&nbsp;<span class="ident" id="6707046">nil</span>&nbsp;<span class="op" id="6707050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707055">t</span><span class="op" id="6707056">.</span><span class="ident" id="6707057">Fatalf</span><span class="op" id="6707063">(</span><span class="string" id="6707064">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="6707088">,</span>&nbsp;<span class="ident" id="6707090">reflect</span><span class="op" id="6707097">.</span><span class="ident" id="6707098">TypeOf</span><span class="op" id="6707104">(</span><span class="ident" id="6707105">value</span><span class="op" id="6707110">)</span><span class="op" id="6707111">,</span>&nbsp;<span class="ident" id="6707113">err</span><span class="op" id="6707116">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707124">if</span>&nbsp;<span class="op" id="6707127">!</span><span class="ident" id="6707128">reflect</span><span class="op" id="6707135">.</span><span class="ident" id="6707136">DeepEqual</span><span class="op" id="6707145">(</span><span class="ident" id="6707146">value</span><span class="op" id="6707151">,</span>&nbsp;<span class="ident" id="6707153">result</span><span class="op" id="6707159">.</span><span class="ident" id="6707160">Elem</span><span class="op" id="6707164">(</span><span class="op" id="6707165">)</span><span class="op" id="6707166">.</span><span class="ident" id="6707167">Interface</span><span class="op" id="6707176">(</span><span class="op" id="6707177">)</span><span class="op" id="6707178">)</span>&nbsp;<span class="op" id="6707180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707185">t</span><span class="op" id="6707186">.</span><span class="ident" id="6707187">Fatalf</span><span class="op" id="6707193">(</span><span class="string" id="6707194">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6707218">,</span>&nbsp;<span class="ident" id="6707220">value</span><span class="op" id="6707225">,</span>&nbsp;<span class="ident" id="6707227">value</span><span class="op" id="6707232">,</span>&nbsp;<span class="ident" id="6707234">result</span><span class="op" id="6707240">.</span><span class="ident" id="6707241">Elem</span><span class="op" id="6707245">(</span><span class="op" id="6707246">)</span><span class="op" id="6707247">.</span><span class="ident" id="6707248">Interface</span><span class="op" id="6707257">(</span><span class="op" id="6707258">)</span><span class="op" id="6707259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707266">}</span><br>
<span class="lineno">55</span><span class="op" id="6707268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707271">type</span>&nbsp;<span class="ident" id="6707276">ET0</span>&nbsp;<span class="keyword" id="6707280">struct</span>&nbsp;<span class="op" id="6707287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707290">A</span>&nbsp;<span class="builtintype" id="6707292">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707297">B</span>&nbsp;<span class="builtintype" id="6707299">string</span><br>
<span class="lineno">60</span><span class="op" id="6707306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6707309">type</span>&nbsp;<span class="ident" id="6707314">ET2</span>&nbsp;<span class="keyword" id="6707318">struct</span>&nbsp;<span class="op" id="6707325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707328">X</span>&nbsp;<span class="builtintype" id="6707330">string</span><br>
<span class="lineno"></span><span class="op" id="6707337">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="6707340">type</span>&nbsp;<span class="ident" id="6707345">ET1</span>&nbsp;<span class="keyword" id="6707349">struct</span>&nbsp;<span class="op" id="6707356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707359">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6707364">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707369">Et2</span>&nbsp;&nbsp;<span class="op" id="6707374">*</span><span class="ident" id="6707375">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707380">Next</span>&nbsp;<span class="op" id="6707385">*</span><span class="ident" id="6707386">ET1</span><br>
<span class="lineno">70</span><span class="op" id="6707390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6707393">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="6707443">type</span>&nbsp;<span class="ident" id="6707448">ET3</span>&nbsp;<span class="keyword" id="6707452">struct</span>&nbsp;<span class="op" id="6707459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707462">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6707476">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707481">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6707495">*</span><span class="ident" id="6707496">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707501">DifferentNext</span>&nbsp;<span class="op" id="6707515">*</span><span class="ident" id="6707516">ET1</span><br>
<span class="lineno"></span><span class="op" id="6707520">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6707523">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="6707573">type</span>&nbsp;<span class="ident" id="6707578">ET4</span>&nbsp;<span class="keyword" id="6707582">struct</span>&nbsp;<span class="op" id="6707589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707592">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6707597">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707602">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="6707607">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707616">Next</span>&nbsp;<span class="builtintype" id="6707621">int</span><br>
<span class="lineno"></span><span class="op" id="6707625">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="6707628">func</span>&nbsp;<span class="ident" id="6707633">TestEncoderDecoder</span><span class="op" id="6707651">(</span><span class="ident" id="6707652">t</span>&nbsp;<span class="op" id="6707654">*</span><span class="ident" id="6707655">testing</span><span class="op" id="6707662">.</span><span class="ident" id="6707663">T</span><span class="op" id="6707664">)</span>&nbsp;<span class="op" id="6707666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707669">b</span>&nbsp;<span class="op" id="6707671">:=</span>&nbsp;<span class="builtinfunc" id="6707674">new</span><span class="op" id="6707677">(</span><span class="ident" id="6707678">bytes</span><span class="op" id="6707683">.</span><span class="ident" id="6707684">Buffer</span><span class="op" id="6707690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707693">enc</span>&nbsp;<span class="op" id="6707697">:=</span>&nbsp;<span class="ident" id="6707700">NewEncoder</span><span class="op" id="6707710">(</span><span class="ident" id="6707711">b</span><span class="op" id="6707712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707715">et0</span>&nbsp;<span class="op" id="6707719">:=</span>&nbsp;<span class="builtinfunc" id="6707722">new</span><span class="op" id="6707725">(</span><span class="ident" id="6707726">ET0</span><span class="op" id="6707729">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707732">et0</span><span class="op" id="6707735">.</span><span class="ident" id="6707736">A</span>&nbsp;<span class="op" id="6707738">=</span>&nbsp;<span class="num" id="6707740">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707743">et0</span><span class="op" id="6707746">.</span><span class="ident" id="6707747">B</span>&nbsp;<span class="op" id="6707749">=</span>&nbsp;<span class="string" id="6707751">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707766">err</span>&nbsp;<span class="op" id="6707770">:=</span>&nbsp;<span class="ident" id="6707773">enc</span><span class="op" id="6707776">.</span><span class="ident" id="6707777">Encode</span><span class="op" id="6707783">(</span><span class="ident" id="6707784">et0</span><span class="op" id="6707787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707790">if</span>&nbsp;<span class="ident" id="6707793">err</span>&nbsp;<span class="op" id="6707797">!=</span>&nbsp;<span class="ident" id="6707800">nil</span>&nbsp;<span class="op" id="6707804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707808">t</span><span class="op" id="6707809">.</span><span class="ident" id="6707810">Error</span><span class="op" id="6707815">(</span><span class="string" id="6707816">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="6707831">,</span>&nbsp;<span class="ident" id="6707833">err</span><span class="op" id="6707836">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6707839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6707842">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6707874">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707886">dec</span>&nbsp;<span class="op" id="6707890">:=</span>&nbsp;<span class="ident" id="6707893">NewDecoder</span><span class="op" id="6707903">(</span><span class="ident" id="6707904">b</span><span class="op" id="6707905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707908">newEt0</span>&nbsp;<span class="op" id="6707915">:=</span>&nbsp;<span class="builtinfunc" id="6707918">new</span><span class="op" id="6707921">(</span><span class="ident" id="6707922">ET0</span><span class="op" id="6707925">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707928">err</span>&nbsp;<span class="op" id="6707932">=</span>&nbsp;<span class="ident" id="6707934">dec</span><span class="op" id="6707937">.</span><span class="ident" id="6707938">Decode</span><span class="op" id="6707944">(</span><span class="ident" id="6707945">newEt0</span><span class="op" id="6707951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6707954">if</span>&nbsp;<span class="ident" id="6707957">err</span>&nbsp;<span class="op" id="6707961">!=</span>&nbsp;<span class="ident" id="6707964">nil</span>&nbsp;<span class="op" id="6707968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6707972">t</span><span class="op" id="6707973">.</span><span class="ident" id="6707974">Fatal</span><span class="op" id="6707979">(</span><span class="string" id="6707980">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="6708001">,</span>&nbsp;<span class="ident" id="6708003">err</span><span class="op" id="6708006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708013">if</span>&nbsp;<span class="op" id="6708016">!</span><span class="ident" id="6708017">reflect</span><span class="op" id="6708024">.</span><span class="ident" id="6708025">DeepEqual</span><span class="op" id="6708034">(</span><span class="ident" id="6708035">et0</span><span class="op" id="6708038">,</span>&nbsp;<span class="ident" id="6708040">newEt0</span><span class="op" id="6708046">)</span>&nbsp;<span class="op" id="6708048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708052">t</span><span class="op" id="6708053">.</span><span class="ident" id="6708054">Fatalf</span><span class="op" id="6708060">(</span><span class="string" id="6708061">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="6708106">,</span>&nbsp;<span class="op" id="6708108">*</span><span class="ident" id="6708109">et0</span><span class="op" id="6708112">,</span>&nbsp;<span class="op" id="6708114">*</span><span class="ident" id="6708115">newEt0</span><span class="op" id="6708121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708127">if</span>&nbsp;<span class="ident" id="6708130">b</span><span class="op" id="6708131">.</span><span class="ident" id="6708132">Len</span><span class="op" id="6708135">(</span><span class="op" id="6708136">)</span>&nbsp;<span class="op" id="6708138">!=</span>&nbsp;<span class="num" id="6708141">0</span>&nbsp;<span class="op" id="6708143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708147">t</span><span class="op" id="6708148">.</span><span class="ident" id="6708149">Error</span><span class="op" id="6708154">(</span><span class="string" id="6708155">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="6708168">,</span>&nbsp;<span class="ident" id="6708170">b</span><span class="op" id="6708171">.</span><span class="ident" id="6708172">Len</span><span class="op" id="6708175">(</span><span class="op" id="6708176">)</span><span class="op" id="6708177">,</span>&nbsp;<span class="string" id="6708179">&#34;bytes&nbsp;left&#34;</span><span class="op" id="6708191">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6708197">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708214">b</span>&nbsp;<span class="op" id="6708216">=</span>&nbsp;<span class="builtinfunc" id="6708218">new</span><span class="op" id="6708221">(</span><span class="ident" id="6708222">bytes</span><span class="op" id="6708227">.</span><span class="ident" id="6708228">Buffer</span><span class="op" id="6708234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708237">enc</span>&nbsp;<span class="op" id="6708241">=</span>&nbsp;<span class="ident" id="6708243">NewEncoder</span><span class="op" id="6708253">(</span><span class="ident" id="6708254">b</span><span class="op" id="6708255">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708258">et1</span>&nbsp;<span class="op" id="6708262">:=</span>&nbsp;<span class="builtinfunc" id="6708265">new</span><span class="op" id="6708268">(</span><span class="ident" id="6708269">ET1</span><span class="op" id="6708272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708275">et1</span><span class="op" id="6708278">.</span><span class="ident" id="6708279">A</span>&nbsp;<span class="op" id="6708281">=</span>&nbsp;<span class="num" id="6708283">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708286">et1</span><span class="op" id="6708289">.</span><span class="ident" id="6708290">Et2</span>&nbsp;<span class="op" id="6708294">=</span>&nbsp;<span class="builtinfunc" id="6708296">new</span><span class="op" id="6708299">(</span><span class="ident" id="6708300">ET2</span><span class="op" id="6708303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708306">err</span>&nbsp;<span class="op" id="6708310">=</span>&nbsp;<span class="ident" id="6708312">enc</span><span class="op" id="6708315">.</span><span class="ident" id="6708316">Encode</span><span class="op" id="6708322">(</span><span class="ident" id="6708323">et1</span><span class="op" id="6708326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708329">if</span>&nbsp;<span class="ident" id="6708332">err</span>&nbsp;<span class="op" id="6708336">!=</span>&nbsp;<span class="ident" id="6708339">nil</span>&nbsp;<span class="op" id="6708343">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708347">t</span><span class="op" id="6708348">.</span><span class="ident" id="6708349">Error</span><span class="op" id="6708354">(</span><span class="string" id="6708355">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="6708370">,</span>&nbsp;<span class="ident" id="6708372">err</span><span class="op" id="6708375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708381">dec</span>&nbsp;<span class="op" id="6708385">=</span>&nbsp;<span class="ident" id="6708387">NewDecoder</span><span class="op" id="6708397">(</span><span class="ident" id="6708398">b</span><span class="op" id="6708399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708402">newEt1</span>&nbsp;<span class="op" id="6708409">:=</span>&nbsp;<span class="builtinfunc" id="6708412">new</span><span class="op" id="6708415">(</span><span class="ident" id="6708416">ET1</span><span class="op" id="6708419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708422">err</span>&nbsp;<span class="op" id="6708426">=</span>&nbsp;<span class="ident" id="6708428">dec</span><span class="op" id="6708431">.</span><span class="ident" id="6708432">Decode</span><span class="op" id="6708438">(</span><span class="ident" id="6708439">newEt1</span><span class="op" id="6708445">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708448">if</span>&nbsp;<span class="ident" id="6708451">err</span>&nbsp;<span class="op" id="6708455">!=</span>&nbsp;<span class="ident" id="6708458">nil</span>&nbsp;<span class="op" id="6708462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708466">t</span><span class="op" id="6708467">.</span><span class="ident" id="6708468">Fatal</span><span class="op" id="6708473">(</span><span class="string" id="6708474">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="6708495">,</span>&nbsp;<span class="ident" id="6708497">err</span><span class="op" id="6708500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708507">if</span>&nbsp;<span class="op" id="6708510">!</span><span class="ident" id="6708511">reflect</span><span class="op" id="6708518">.</span><span class="ident" id="6708519">DeepEqual</span><span class="op" id="6708528">(</span><span class="ident" id="6708529">et1</span><span class="op" id="6708532">,</span>&nbsp;<span class="ident" id="6708534">newEt1</span><span class="op" id="6708540">)</span>&nbsp;<span class="op" id="6708542">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708546">t</span><span class="op" id="6708547">.</span><span class="ident" id="6708548">Fatalf</span><span class="op" id="6708554">(</span><span class="string" id="6708555">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="6708600">,</span>&nbsp;<span class="op" id="6708602">*</span><span class="ident" id="6708603">et1</span><span class="op" id="6708606">,</span>&nbsp;<span class="op" id="6708608">*</span><span class="ident" id="6708609">newEt1</span><span class="op" id="6708615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708621">if</span>&nbsp;<span class="ident" id="6708624">b</span><span class="op" id="6708625">.</span><span class="ident" id="6708626">Len</span><span class="op" id="6708629">(</span><span class="op" id="6708630">)</span>&nbsp;<span class="op" id="6708632">!=</span>&nbsp;<span class="num" id="6708635">0</span>&nbsp;<span class="op" id="6708637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708641">t</span><span class="op" id="6708642">.</span><span class="ident" id="6708643">Error</span><span class="op" id="6708648">(</span><span class="string" id="6708649">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="6708662">,</span>&nbsp;<span class="ident" id="6708664">b</span><span class="op" id="6708665">.</span><span class="ident" id="6708666">Len</span><span class="op" id="6708669">(</span><span class="op" id="6708670">)</span><span class="op" id="6708671">,</span>&nbsp;<span class="string" id="6708673">&#34;bytes&nbsp;left&#34;</span><span class="op" id="6708685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708688">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708692">enc</span><span class="op" id="6708695">.</span><span class="ident" id="6708696">Encode</span><span class="op" id="6708702">(</span><span class="ident" id="6708703">et1</span><span class="op" id="6708706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708709">newEt1</span>&nbsp;<span class="op" id="6708716">=</span>&nbsp;<span class="builtinfunc" id="6708718">new</span><span class="op" id="6708721">(</span><span class="ident" id="6708722">ET1</span><span class="op" id="6708725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708728">err</span>&nbsp;<span class="op" id="6708732">=</span>&nbsp;<span class="ident" id="6708734">dec</span><span class="op" id="6708737">.</span><span class="ident" id="6708738">Decode</span><span class="op" id="6708744">(</span><span class="ident" id="6708745">newEt1</span><span class="op" id="6708751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708754">if</span>&nbsp;<span class="ident" id="6708757">err</span>&nbsp;<span class="op" id="6708761">!=</span>&nbsp;<span class="ident" id="6708764">nil</span>&nbsp;<span class="op" id="6708768">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708772">t</span><span class="op" id="6708773">.</span><span class="ident" id="6708774">Fatal</span><span class="op" id="6708779">(</span><span class="string" id="6708780">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="6708810">,</span>&nbsp;<span class="ident" id="6708812">err</span><span class="op" id="6708815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708821">if</span>&nbsp;<span class="op" id="6708824">!</span><span class="ident" id="6708825">reflect</span><span class="op" id="6708832">.</span><span class="ident" id="6708833">DeepEqual</span><span class="op" id="6708842">(</span><span class="ident" id="6708843">et1</span><span class="op" id="6708846">,</span>&nbsp;<span class="ident" id="6708848">newEt1</span><span class="op" id="6708854">)</span>&nbsp;<span class="op" id="6708856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708860">t</span><span class="op" id="6708861">.</span><span class="ident" id="6708862">Fatalf</span><span class="op" id="6708868">(</span><span class="string" id="6708869">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="6708923">,</span>&nbsp;<span class="op" id="6708925">*</span><span class="ident" id="6708926">et1</span><span class="op" id="6708929">,</span>&nbsp;<span class="op" id="6708931">*</span><span class="ident" id="6708932">newEt1</span><span class="op" id="6708938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6708941">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6708944">if</span>&nbsp;<span class="ident" id="6708947">b</span><span class="op" id="6708948">.</span><span class="ident" id="6708949">Len</span><span class="op" id="6708952">(</span><span class="op" id="6708953">)</span>&nbsp;<span class="op" id="6708955">!=</span>&nbsp;<span class="num" id="6708958">0</span>&nbsp;<span class="op" id="6708960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6708964">t</span><span class="op" id="6708965">.</span><span class="ident" id="6708966">Error</span><span class="op" id="6708971">(</span><span class="string" id="6708972">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="6708994">,</span>&nbsp;<span class="ident" id="6708996">b</span><span class="op" id="6708997">.</span><span class="ident" id="6708998">Len</span><span class="op" id="6709001">(</span><span class="op" id="6709002">)</span><span class="op" id="6709003">,</span>&nbsp;<span class="string" id="6709005">&#34;bytes&nbsp;left&#34;</span><span class="op" id="6709017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6709024">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709108">err</span>&nbsp;<span class="op" id="6709112">=</span>&nbsp;<span class="ident" id="6709114">enc</span><span class="op" id="6709117">.</span><span class="ident" id="6709118">Encode</span><span class="op" id="6709124">(</span><span class="ident" id="6709125">et1</span><span class="op" id="6709128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709131">if</span>&nbsp;<span class="ident" id="6709134">err</span>&nbsp;<span class="op" id="6709138">!=</span>&nbsp;<span class="ident" id="6709141">nil</span>&nbsp;<span class="op" id="6709145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709149">t</span><span class="op" id="6709150">.</span><span class="ident" id="6709151">Error</span><span class="op" id="6709156">(</span><span class="string" id="6709157">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="6709181">,</span>&nbsp;<span class="ident" id="6709183">err</span><span class="op" id="6709186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709192">newEt2</span>&nbsp;<span class="op" id="6709199">:=</span>&nbsp;<span class="builtinfunc" id="6709202">new</span><span class="op" id="6709205">(</span><span class="ident" id="6709206">ET2</span><span class="op" id="6709209">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709212">err</span>&nbsp;<span class="op" id="6709216">=</span>&nbsp;<span class="ident" id="6709218">dec</span><span class="op" id="6709221">.</span><span class="ident" id="6709222">Decode</span><span class="op" id="6709228">(</span><span class="ident" id="6709229">newEt2</span><span class="op" id="6709235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709238">if</span>&nbsp;<span class="ident" id="6709241">err</span>&nbsp;<span class="op" id="6709245">==</span>&nbsp;<span class="ident" id="6709248">nil</span>&nbsp;<span class="op" id="6709252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709256">t</span><span class="op" id="6709257">.</span><span class="ident" id="6709258">Fatal</span><span class="op" id="6709263">(</span><span class="string" id="6709264">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="6709313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709316">}</span><br>
<span class="lineno"></span><span class="op" id="6709318">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="6709321">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="6709391">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="6709458">func</span>&nbsp;<span class="ident" id="6709463">badTypeCheck</span><span class="op" id="6709475">(</span><span class="ident" id="6709476">e</span>&nbsp;<span class="keyword" id="6709478">interface</span><span class="op" id="6709487">{</span><span class="op" id="6709488">}</span><span class="op" id="6709489">,</span>&nbsp;<span class="ident" id="6709491">shouldFail</span>&nbsp;<span class="builtintype" id="6709502">bool</span><span class="op" id="6709506">,</span>&nbsp;<span class="ident" id="6709508">msg</span>&nbsp;<span class="builtintype" id="6709512">string</span><span class="op" id="6709518">,</span>&nbsp;<span class="ident" id="6709520">t</span>&nbsp;<span class="op" id="6709522">*</span><span class="ident" id="6709523">testing</span><span class="op" id="6709530">.</span><span class="ident" id="6709531">T</span><span class="op" id="6709532">)</span>&nbsp;<span class="op" id="6709534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709537">b</span>&nbsp;<span class="op" id="6709539">:=</span>&nbsp;<span class="builtinfunc" id="6709542">new</span><span class="op" id="6709545">(</span><span class="ident" id="6709546">bytes</span><span class="op" id="6709551">.</span><span class="ident" id="6709552">Buffer</span><span class="op" id="6709558">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709561">enc</span>&nbsp;<span class="op" id="6709565">:=</span>&nbsp;<span class="ident" id="6709568">NewEncoder</span><span class="op" id="6709578">(</span><span class="ident" id="6709579">b</span><span class="op" id="6709580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709583">et1</span>&nbsp;<span class="op" id="6709587">:=</span>&nbsp;<span class="builtinfunc" id="6709590">new</span><span class="op" id="6709593">(</span><span class="ident" id="6709594">ET1</span><span class="op" id="6709597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709600">et1</span><span class="op" id="6709603">.</span><span class="ident" id="6709604">A</span>&nbsp;<span class="op" id="6709606">=</span>&nbsp;<span class="num" id="6709608">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709611">et1</span><span class="op" id="6709614">.</span><span class="ident" id="6709615">Et2</span>&nbsp;<span class="op" id="6709619">=</span>&nbsp;<span class="builtinfunc" id="6709621">new</span><span class="op" id="6709624">(</span><span class="ident" id="6709625">ET2</span><span class="op" id="6709628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709631">err</span>&nbsp;<span class="op" id="6709635">:=</span>&nbsp;<span class="ident" id="6709638">enc</span><span class="op" id="6709641">.</span><span class="ident" id="6709642">Encode</span><span class="op" id="6709648">(</span><span class="ident" id="6709649">et1</span><span class="op" id="6709652">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709655">if</span>&nbsp;<span class="ident" id="6709658">err</span>&nbsp;<span class="op" id="6709662">!=</span>&nbsp;<span class="ident" id="6709665">nil</span>&nbsp;<span class="op" id="6709669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709673">t</span><span class="op" id="6709674">.</span><span class="ident" id="6709675">Error</span><span class="op" id="6709680">(</span><span class="string" id="6709681">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="6709696">,</span>&nbsp;<span class="ident" id="6709698">err</span><span class="op" id="6709701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709707">dec</span>&nbsp;<span class="op" id="6709711">:=</span>&nbsp;<span class="ident" id="6709714">NewDecoder</span><span class="op" id="6709724">(</span><span class="ident" id="6709725">b</span><span class="op" id="6709726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709729">err</span>&nbsp;<span class="op" id="6709733">=</span>&nbsp;<span class="ident" id="6709735">dec</span><span class="op" id="6709738">.</span><span class="ident" id="6709739">Decode</span><span class="op" id="6709745">(</span><span class="ident" id="6709746">e</span><span class="op" id="6709747">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709750">if</span>&nbsp;<span class="ident" id="6709753">shouldFail</span>&nbsp;<span class="op" id="6709764">&amp;&amp;</span>&nbsp;<span class="ident" id="6709767">err</span>&nbsp;<span class="op" id="6709771">==</span>&nbsp;<span class="ident" id="6709774">nil</span>&nbsp;<span class="op" id="6709778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709782">t</span><span class="op" id="6709783">.</span><span class="ident" id="6709784">Error</span><span class="op" id="6709789">(</span><span class="string" id="6709790">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="6709810">,</span>&nbsp;<span class="ident" id="6709812">msg</span><span class="op" id="6709815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6709821">if</span>&nbsp;<span class="op" id="6709824">!</span><span class="ident" id="6709825">shouldFail</span>&nbsp;<span class="op" id="6709836">&amp;&amp;</span>&nbsp;<span class="ident" id="6709839">err</span>&nbsp;<span class="op" id="6709843">!=</span>&nbsp;<span class="ident" id="6709846">nil</span>&nbsp;<span class="op" id="6709850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709854">t</span><span class="op" id="6709855">.</span><span class="ident" id="6709856">Error</span><span class="op" id="6709861">(</span><span class="string" id="6709862">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="6709884">,</span>&nbsp;<span class="ident" id="6709886">msg</span><span class="op" id="6709889">,</span>&nbsp;<span class="ident" id="6709891">err</span><span class="op" id="6709894">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6709897">}</span><br>
<span class="lineno"></span><span class="op" id="6709899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6709902">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6709955">func</span>&nbsp;<span class="ident" id="6709960">TestWrongTypeDecoder</span><span class="op" id="6709980">(</span><span class="ident" id="6709981">t</span>&nbsp;<span class="op" id="6709983">*</span><span class="ident" id="6709984">testing</span><span class="op" id="6709991">.</span><span class="ident" id="6709992">T</span><span class="op" id="6709993">)</span>&nbsp;<span class="op" id="6709995">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6709998">badTypeCheck</span><span class="op" id="6710010">(</span><span class="builtinfunc" id="6710011">new</span><span class="op" id="6710014">(</span><span class="ident" id="6710015">ET2</span><span class="op" id="6710018">)</span><span class="op" id="6710019">,</span>&nbsp;<span class="builtintype" id="6710021">true</span><span class="op" id="6710025">,</span>&nbsp;<span class="string" id="6710027">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="6710048">,</span>&nbsp;<span class="ident" id="6710050">t</span><span class="op" id="6710051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710054">badTypeCheck</span><span class="op" id="6710066">(</span><span class="builtinfunc" id="6710067">new</span><span class="op" id="6710070">(</span><span class="ident" id="6710071">ET3</span><span class="op" id="6710074">)</span><span class="op" id="6710075">,</span>&nbsp;<span class="builtintype" id="6710077">false</span><span class="op" id="6710082">,</span>&nbsp;<span class="string" id="6710084">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="6710109">,</span>&nbsp;<span class="ident" id="6710111">t</span><span class="op" id="6710112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710115">badTypeCheck</span><span class="op" id="6710127">(</span><span class="builtinfunc" id="6710128">new</span><span class="op" id="6710131">(</span><span class="ident" id="6710132">ET4</span><span class="op" id="6710135">)</span><span class="op" id="6710136">,</span>&nbsp;<span class="builtintype" id="6710138">true</span><span class="op" id="6710142">,</span>&nbsp;<span class="string" id="6710144">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="6710169">,</span>&nbsp;<span class="ident" id="6710171">t</span><span class="op" id="6710172">)</span><br>
<span class="lineno"></span><span class="op" id="6710174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6710177">func</span>&nbsp;<span class="ident" id="6710182">corruptDataCheck</span><span class="op" id="6710198">(</span><span class="ident" id="6710199">s</span>&nbsp;<span class="builtintype" id="6710201">string</span><span class="op" id="6710207">,</span>&nbsp;<span class="ident" id="6710209">err</span>&nbsp;<span class="builtintype" id="6710213">error</span><span class="op" id="6710218">,</span>&nbsp;<span class="ident" id="6710220">t</span>&nbsp;<span class="op" id="6710222">*</span><span class="ident" id="6710223">testing</span><span class="op" id="6710230">.</span><span class="ident" id="6710231">T</span><span class="op" id="6710232">)</span>&nbsp;<span class="op" id="6710234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710237">b</span>&nbsp;<span class="op" id="6710239">:=</span>&nbsp;<span class="ident" id="6710242">bytes</span><span class="op" id="6710247">.</span><span class="ident" id="6710248">NewBufferString</span><span class="op" id="6710263">(</span><span class="ident" id="6710264">s</span><span class="op" id="6710265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710268">dec</span>&nbsp;<span class="op" id="6710272">:=</span>&nbsp;<span class="ident" id="6710275">NewDecoder</span><span class="op" id="6710285">(</span><span class="ident" id="6710286">b</span><span class="op" id="6710287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710290">err1</span>&nbsp;<span class="op" id="6710295">:=</span>&nbsp;<span class="ident" id="6710298">dec</span><span class="op" id="6710301">.</span><span class="ident" id="6710302">Decode</span><span class="op" id="6710308">(</span><span class="builtinfunc" id="6710309">new</span><span class="op" id="6710312">(</span><span class="ident" id="6710313">ET2</span><span class="op" id="6710316">)</span><span class="op" id="6710317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710320">if</span>&nbsp;<span class="ident" id="6710323">err1</span>&nbsp;<span class="op" id="6710328">!=</span>&nbsp;<span class="ident" id="6710331">err</span>&nbsp;<span class="op" id="6710335">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710339">t</span><span class="op" id="6710340">.</span><span class="ident" id="6710341">Errorf</span><span class="op" id="6710347">(</span><span class="string" id="6710348">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6710383">,</span>&nbsp;<span class="ident" id="6710385">s</span><span class="op" id="6710386">,</span>&nbsp;<span class="ident" id="6710388">err</span><span class="op" id="6710391">,</span>&nbsp;<span class="ident" id="6710393">err1</span><span class="op" id="6710397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6710400">}</span><br>
<span class="lineno"></span><span class="op" id="6710402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6710405">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="6710440">func</span>&nbsp;<span class="ident" id="6710445">TestBadData</span><span class="op" id="6710456">(</span><span class="ident" id="6710457">t</span>&nbsp;<span class="op" id="6710459">*</span><span class="ident" id="6710460">testing</span><span class="op" id="6710467">.</span><span class="ident" id="6710468">T</span><span class="op" id="6710469">)</span>&nbsp;<span class="op" id="6710471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710474">corruptDataCheck</span><span class="op" id="6710490">(</span><span class="string" id="6710491">&#34;&#34;</span><span class="op" id="6710493">,</span>&nbsp;<span class="ident" id="6710495">io</span><span class="op" id="6710497">.</span><span class="ident" id="6710498">EOF</span><span class="op" id="6710501">,</span>&nbsp;<span class="ident" id="6710503">t</span><span class="op" id="6710504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710507">corruptDataCheck</span><span class="op" id="6710523">(</span><span class="string" id="6710524">&#34;\x7Fhi&#34;</span><span class="op" id="6710532">,</span>&nbsp;<span class="ident" id="6710534">io</span><span class="op" id="6710536">.</span><span class="ident" id="6710537">ErrUnexpectedEOF</span><span class="op" id="6710553">,</span>&nbsp;<span class="ident" id="6710555">t</span><span class="op" id="6710556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710559">corruptDataCheck</span><span class="op" id="6710575">(</span><span class="string" id="6710576">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="6710614">,</span>&nbsp;<span class="ident" id="6710616">errBadType</span><span class="op" id="6710626">,</span>&nbsp;<span class="ident" id="6710628">t</span><span class="op" id="6710629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6710632">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710648">corruptDataCheck</span><span class="op" id="6710664">(</span><span class="string" id="6710665">&#34;\x04\x24foo&#34;</span><span class="op" id="6710678">,</span>&nbsp;<span class="ident" id="6710680">errRange</span><span class="op" id="6710688">,</span>&nbsp;<span class="ident" id="6710690">t</span><span class="op" id="6710691">)</span><br>
<span class="lineno"></span><span class="op" id="6710693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6710696">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6710748">var</span>&nbsp;<span class="ident" id="6710752">unsupportedValues</span>&nbsp;<span class="op" id="6710770">=</span>&nbsp;<span class="op" id="6710772">[</span><span class="op" id="6710773">]</span><span class="keyword" id="6710774">interface</span><span class="op" id="6710783">{</span><span class="op" id="6710784">}</span><span class="op" id="6710785">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6710788">make</span><span class="op" id="6710792">(</span><span class="keyword" id="6710793">chan</span>&nbsp;<span class="builtintype" id="6710798">int</span><span class="op" id="6710801">)</span><span class="op" id="6710802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710805">func</span><span class="op" id="6710809">(</span><span class="ident" id="6710810">a</span>&nbsp;<span class="builtintype" id="6710812">int</span><span class="op" id="6710815">)</span>&nbsp;<span class="builtintype" id="6710817">bool</span>&nbsp;<span class="op" id="6710822">{</span>&nbsp;<span class="keyword" id="6710824">return</span>&nbsp;<span class="builtintype" id="6710831">true</span>&nbsp;<span class="op" id="6710836">}</span><span class="op" id="6710837">,</span><br>
<span class="lineno"></span><span class="op" id="6710839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6710842">func</span>&nbsp;<span class="ident" id="6710847">TestUnsupported</span><span class="op" id="6710862">(</span><span class="ident" id="6710863">t</span>&nbsp;<span class="op" id="6710865">*</span><span class="ident" id="6710866">testing</span><span class="op" id="6710873">.</span><span class="ident" id="6710874">T</span><span class="op" id="6710875">)</span>&nbsp;<span class="op" id="6710877">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710880">var</span>&nbsp;<span class="ident" id="6710884">b</span>&nbsp;<span class="ident" id="6710886">bytes</span><span class="op" id="6710891">.</span><span class="ident" id="6710892">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710900">enc</span>&nbsp;<span class="op" id="6710904">:=</span>&nbsp;<span class="ident" id="6710907">NewEncoder</span><span class="op" id="6710917">(</span><span class="op" id="6710918">&amp;</span><span class="ident" id="6710919">b</span><span class="op" id="6710920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710923">for</span>&nbsp;<span class="ident" id="6710927">_</span><span class="op" id="6710928">,</span>&nbsp;<span class="ident" id="6710930">v</span>&nbsp;<span class="op" id="6710932">:=</span>&nbsp;<span class="keyword" id="6710935">range</span>&nbsp;<span class="ident" id="6710941">unsupportedValues</span>&nbsp;<span class="op" id="6710959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6710963">err</span>&nbsp;<span class="op" id="6710967">:=</span>&nbsp;<span class="ident" id="6710970">enc</span><span class="op" id="6710973">.</span><span class="ident" id="6710974">Encode</span><span class="op" id="6710980">(</span><span class="ident" id="6710981">v</span><span class="op" id="6710982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6710986">if</span>&nbsp;<span class="ident" id="6710989">err</span>&nbsp;<span class="op" id="6710993">==</span>&nbsp;<span class="ident" id="6710996">nil</span>&nbsp;<span class="op" id="6711000">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711005">t</span><span class="op" id="6711006">.</span><span class="ident" id="6711007">Errorf</span><span class="op" id="6711013">(</span><span class="string" id="6711014">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="6711047">,</span>&nbsp;<span class="ident" id="6711049">v</span><span class="op" id="6711050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711057">}</span><br>
<span class="lineno"></span><span class="op" id="6711059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="6711062">func</span>&nbsp;<span class="ident" id="6711067">encAndDec</span><span class="op" id="6711076">(</span><span class="ident" id="6711077">in</span><span class="op" id="6711079">,</span>&nbsp;<span class="ident" id="6711081">out</span>&nbsp;<span class="keyword" id="6711085">interface</span><span class="op" id="6711094">{</span><span class="op" id="6711095">}</span><span class="op" id="6711096">)</span>&nbsp;<span class="builtintype" id="6711098">error</span>&nbsp;<span class="op" id="6711104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711107">b</span>&nbsp;<span class="op" id="6711109">:=</span>&nbsp;<span class="builtinfunc" id="6711112">new</span><span class="op" id="6711115">(</span><span class="ident" id="6711116">bytes</span><span class="op" id="6711121">.</span><span class="ident" id="6711122">Buffer</span><span class="op" id="6711128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711131">enc</span>&nbsp;<span class="op" id="6711135">:=</span>&nbsp;<span class="ident" id="6711138">NewEncoder</span><span class="op" id="6711148">(</span><span class="ident" id="6711149">b</span><span class="op" id="6711150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711153">err</span>&nbsp;<span class="op" id="6711157">:=</span>&nbsp;<span class="ident" id="6711160">enc</span><span class="op" id="6711163">.</span><span class="ident" id="6711164">Encode</span><span class="op" id="6711170">(</span><span class="ident" id="6711171">in</span><span class="op" id="6711173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711176">if</span>&nbsp;<span class="ident" id="6711179">err</span>&nbsp;<span class="op" id="6711183">!=</span>&nbsp;<span class="ident" id="6711186">nil</span>&nbsp;<span class="op" id="6711190">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711194">return</span>&nbsp;<span class="ident" id="6711201">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711209">dec</span>&nbsp;<span class="op" id="6711213">:=</span>&nbsp;<span class="ident" id="6711216">NewDecoder</span><span class="op" id="6711226">(</span><span class="ident" id="6711227">b</span><span class="op" id="6711228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711231">err</span>&nbsp;<span class="op" id="6711235">=</span>&nbsp;<span class="ident" id="6711237">dec</span><span class="op" id="6711240">.</span><span class="ident" id="6711241">Decode</span><span class="op" id="6711247">(</span><span class="ident" id="6711248">out</span><span class="op" id="6711251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711254">if</span>&nbsp;<span class="ident" id="6711257">err</span>&nbsp;<span class="op" id="6711261">!=</span>&nbsp;<span class="ident" id="6711264">nil</span>&nbsp;<span class="op" id="6711268">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711272">return</span>&nbsp;<span class="ident" id="6711279">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711287">return</span>&nbsp;<span class="ident" id="6711294">nil</span><br>
<span class="lineno"></span><span class="op" id="6711298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="6711301">func</span>&nbsp;<span class="ident" id="6711306">TestTypeToPtrType</span><span class="op" id="6711323">(</span><span class="ident" id="6711324">t</span>&nbsp;<span class="op" id="6711326">*</span><span class="ident" id="6711327">testing</span><span class="op" id="6711334">.</span><span class="ident" id="6711335">T</span><span class="op" id="6711336">)</span>&nbsp;<span class="op" id="6711338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6711341">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711369">type</span>&nbsp;<span class="ident" id="6711374">Type0</span>&nbsp;<span class="keyword" id="6711380">struct</span>&nbsp;<span class="op" id="6711387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711391">A</span>&nbsp;<span class="builtintype" id="6711393">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711398">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711401">t0</span>&nbsp;<span class="op" id="6711404">:=</span>&nbsp;<span class="ident" id="6711407">Type0</span><span class="op" id="6711412">{</span><span class="num" id="6711413">7</span><span class="op" id="6711414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711417">t0p</span>&nbsp;<span class="op" id="6711421">:=</span>&nbsp;<span class="builtinfunc" id="6711424">new</span><span class="op" id="6711427">(</span><span class="ident" id="6711428">Type0</span><span class="op" id="6711433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711436">if</span>&nbsp;<span class="ident" id="6711439">err</span>&nbsp;<span class="op" id="6711443">:=</span>&nbsp;<span class="ident" id="6711446">encAndDec</span><span class="op" id="6711455">(</span><span class="ident" id="6711456">t0</span><span class="op" id="6711458">,</span>&nbsp;<span class="ident" id="6711460">t0p</span><span class="op" id="6711463">)</span><span class="op" id="6711464">;</span>&nbsp;<span class="ident" id="6711466">err</span>&nbsp;<span class="op" id="6711470">!=</span>&nbsp;<span class="ident" id="6711473">nil</span>&nbsp;<span class="op" id="6711477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711481">t</span><span class="op" id="6711482">.</span><span class="ident" id="6711483">Error</span><span class="op" id="6711488">(</span><span class="ident" id="6711489">err</span><span class="op" id="6711492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711495">}</span><br>
<span class="lineno">250</span><span class="op" id="6711497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6711500">func</span>&nbsp;<span class="ident" id="6711505">TestPtrTypeToType</span><span class="op" id="6711522">(</span><span class="ident" id="6711523">t</span>&nbsp;<span class="op" id="6711525">*</span><span class="ident" id="6711526">testing</span><span class="op" id="6711533">.</span><span class="ident" id="6711534">T</span><span class="op" id="6711535">)</span>&nbsp;<span class="op" id="6711537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6711540">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711568">type</span>&nbsp;<span class="ident" id="6711573">Type1</span>&nbsp;<span class="keyword" id="6711579">struct</span>&nbsp;<span class="op" id="6711586">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711590">A</span>&nbsp;<span class="builtintype" id="6711592">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711601">t1p</span>&nbsp;<span class="op" id="6711605">:=</span>&nbsp;<span class="op" id="6711608">&amp;</span><span class="ident" id="6711609">Type1</span><span class="op" id="6711614">{</span><span class="num" id="6711615">17</span><span class="op" id="6711617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711620">var</span>&nbsp;<span class="ident" id="6711624">t1</span>&nbsp;<span class="ident" id="6711627">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711634">if</span>&nbsp;<span class="ident" id="6711637">err</span>&nbsp;<span class="op" id="6711641">:=</span>&nbsp;<span class="ident" id="6711644">encAndDec</span><span class="op" id="6711653">(</span><span class="ident" id="6711654">t1</span><span class="op" id="6711656">,</span>&nbsp;<span class="ident" id="6711658">t1p</span><span class="op" id="6711661">)</span><span class="op" id="6711662">;</span>&nbsp;<span class="ident" id="6711664">err</span>&nbsp;<span class="op" id="6711668">!=</span>&nbsp;<span class="ident" id="6711671">nil</span>&nbsp;<span class="op" id="6711675">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711679">t</span><span class="op" id="6711680">.</span><span class="ident" id="6711681">Error</span><span class="op" id="6711686">(</span><span class="ident" id="6711687">err</span><span class="op" id="6711690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711693">}</span><br>
<span class="lineno"></span><span class="op" id="6711695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6711698">func</span>&nbsp;<span class="ident" id="6711703">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="6711729">(</span><span class="ident" id="6711730">t</span>&nbsp;<span class="op" id="6711732">*</span><span class="ident" id="6711733">testing</span><span class="op" id="6711740">.</span><span class="ident" id="6711741">T</span><span class="op" id="6711742">)</span>&nbsp;<span class="op" id="6711744">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711747">type</span>&nbsp;<span class="ident" id="6711752">Type2</span>&nbsp;<span class="keyword" id="6711758">struct</span>&nbsp;<span class="op" id="6711765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711769">A</span>&nbsp;<span class="op" id="6711771">*</span><span class="op" id="6711772">*</span><span class="op" id="6711773">*</span><span class="op" id="6711774">*</span><span class="builtintype" id="6711775">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711787">t2</span>&nbsp;<span class="op" id="6711790">:=</span>&nbsp;<span class="ident" id="6711793">Type2</span><span class="op" id="6711798">{</span><span class="op" id="6711799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711802">t2</span><span class="op" id="6711804">.</span><span class="ident" id="6711805">A</span>&nbsp;<span class="op" id="6711807">=</span>&nbsp;<span class="builtinfunc" id="6711809">new</span><span class="op" id="6711812">(</span><span class="op" id="6711813">*</span><span class="op" id="6711814">*</span><span class="op" id="6711815">*</span><span class="builtintype" id="6711816">float64</span><span class="op" id="6711823">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711826">*</span><span class="ident" id="6711827">t2</span><span class="op" id="6711829">.</span><span class="ident" id="6711830">A</span>&nbsp;<span class="op" id="6711832">=</span>&nbsp;<span class="builtinfunc" id="6711834">new</span><span class="op" id="6711837">(</span><span class="op" id="6711838">*</span><span class="op" id="6711839">*</span><span class="builtintype" id="6711840">float64</span><span class="op" id="6711847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711850">*</span><span class="op" id="6711851">*</span><span class="ident" id="6711852">t2</span><span class="op" id="6711854">.</span><span class="ident" id="6711855">A</span>&nbsp;<span class="op" id="6711857">=</span>&nbsp;<span class="builtinfunc" id="6711859">new</span><span class="op" id="6711862">(</span><span class="op" id="6711863">*</span><span class="builtintype" id="6711864">float64</span><span class="op" id="6711871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711874">*</span><span class="op" id="6711875">*</span><span class="op" id="6711876">*</span><span class="ident" id="6711877">t2</span><span class="op" id="6711879">.</span><span class="ident" id="6711880">A</span>&nbsp;<span class="op" id="6711882">=</span>&nbsp;<span class="builtinfunc" id="6711884">new</span><span class="op" id="6711887">(</span><span class="builtintype" id="6711888">float64</span><span class="op" id="6711895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6711898">*</span><span class="op" id="6711899">*</span><span class="op" id="6711900">*</span><span class="op" id="6711901">*</span><span class="ident" id="6711902">t2</span><span class="op" id="6711904">.</span><span class="ident" id="6711905">A</span>&nbsp;<span class="op" id="6711907">=</span>&nbsp;<span class="num" id="6711909">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711915">t2pppp</span>&nbsp;<span class="op" id="6711922">:=</span>&nbsp;<span class="builtinfunc" id="6711925">new</span><span class="op" id="6711928">(</span><span class="op" id="6711929">*</span><span class="op" id="6711930">*</span><span class="op" id="6711931">*</span><span class="ident" id="6711932">Type2</span><span class="op" id="6711937">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6711940">if</span>&nbsp;<span class="ident" id="6711943">err</span>&nbsp;<span class="op" id="6711947">:=</span>&nbsp;<span class="ident" id="6711950">encAndDec</span><span class="op" id="6711959">(</span><span class="ident" id="6711960">t2</span><span class="op" id="6711962">,</span>&nbsp;<span class="ident" id="6711964">t2pppp</span><span class="op" id="6711970">)</span><span class="op" id="6711971">;</span>&nbsp;<span class="ident" id="6711973">err</span>&nbsp;<span class="op" id="6711977">!=</span>&nbsp;<span class="ident" id="6711980">nil</span>&nbsp;<span class="op" id="6711984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6711988">t</span><span class="op" id="6711989">.</span><span class="ident" id="6711990">Fatal</span><span class="op" id="6711995">(</span><span class="ident" id="6711996">err</span><span class="op" id="6711999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712005">if</span>&nbsp;<span class="op" id="6712008">*</span><span class="op" id="6712009">*</span><span class="op" id="6712010">*</span><span class="op" id="6712011">*</span><span class="op" id="6712012">(</span><span class="op" id="6712013">*</span><span class="op" id="6712014">*</span><span class="op" id="6712015">*</span><span class="op" id="6712016">*</span><span class="ident" id="6712017">t2pppp</span><span class="op" id="6712023">)</span><span class="op" id="6712024">.</span><span class="ident" id="6712025">A</span>&nbsp;<span class="op" id="6712027">!=</span>&nbsp;<span class="op" id="6712030">*</span><span class="op" id="6712031">*</span><span class="op" id="6712032">*</span><span class="op" id="6712033">*</span><span class="ident" id="6712034">t2</span><span class="op" id="6712036">.</span><span class="ident" id="6712037">A</span>&nbsp;<span class="op" id="6712039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712043">t</span><span class="op" id="6712044">.</span><span class="ident" id="6712045">Errorf</span><span class="op" id="6712051">(</span><span class="string" id="6712052">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="6712089">,</span>&nbsp;<span class="op" id="6712091">*</span><span class="op" id="6712092">*</span><span class="op" id="6712093">*</span><span class="op" id="6712094">*</span><span class="op" id="6712095">(</span><span class="op" id="6712096">*</span><span class="op" id="6712097">*</span><span class="op" id="6712098">*</span><span class="op" id="6712099">*</span><span class="ident" id="6712100">t2pppp</span><span class="op" id="6712106">)</span><span class="op" id="6712107">.</span><span class="ident" id="6712108">A</span><span class="op" id="6712109">,</span>&nbsp;<span class="op" id="6712111">*</span><span class="op" id="6712112">*</span><span class="op" id="6712113">*</span><span class="op" id="6712114">*</span><span class="ident" id="6712115">t2</span><span class="op" id="6712117">.</span><span class="ident" id="6712118">A</span><span class="op" id="6712119">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712122">}</span><br>
<span class="lineno"></span><span class="op" id="6712124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6712127">func</span>&nbsp;<span class="ident" id="6712132">TestSlice</span><span class="op" id="6712141">(</span><span class="ident" id="6712142">t</span>&nbsp;<span class="op" id="6712144">*</span><span class="ident" id="6712145">testing</span><span class="op" id="6712152">.</span><span class="ident" id="6712153">T</span><span class="op" id="6712154">)</span>&nbsp;<span class="op" id="6712156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712159">type</span>&nbsp;<span class="ident" id="6712164">Type3</span>&nbsp;<span class="keyword" id="6712170">struct</span>&nbsp;<span class="op" id="6712177">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712181">A</span>&nbsp;<span class="op" id="6712183">[</span><span class="op" id="6712184">]</span><span class="builtintype" id="6712185">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712196">t3p</span>&nbsp;<span class="op" id="6712200">:=</span>&nbsp;<span class="op" id="6712203">&amp;</span><span class="ident" id="6712204">Type3</span><span class="op" id="6712209">{</span><span class="op" id="6712210">[</span><span class="op" id="6712211">]</span><span class="builtintype" id="6712212">string</span><span class="op" id="6712218">{</span><span class="string" id="6712219">&#34;hello&#34;</span><span class="op" id="6712226">,</span>&nbsp;<span class="string" id="6712228">&#34;world&#34;</span><span class="op" id="6712235">}</span><span class="op" id="6712236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712239">var</span>&nbsp;<span class="ident" id="6712243">t3</span>&nbsp;<span class="ident" id="6712246">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712253">if</span>&nbsp;<span class="ident" id="6712256">err</span>&nbsp;<span class="op" id="6712260">:=</span>&nbsp;<span class="ident" id="6712263">encAndDec</span><span class="op" id="6712272">(</span><span class="ident" id="6712273">t3</span><span class="op" id="6712275">,</span>&nbsp;<span class="ident" id="6712277">t3p</span><span class="op" id="6712280">)</span><span class="op" id="6712281">;</span>&nbsp;<span class="ident" id="6712283">err</span>&nbsp;<span class="op" id="6712287">!=</span>&nbsp;<span class="ident" id="6712290">nil</span>&nbsp;<span class="op" id="6712294">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712298">t</span><span class="op" id="6712299">.</span><span class="ident" id="6712300">Error</span><span class="op" id="6712305">(</span><span class="ident" id="6712306">err</span><span class="op" id="6712309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712312">}</span><br>
<span class="lineno"></span><span class="op" id="6712314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6712317">func</span>&nbsp;<span class="ident" id="6712322">TestValueError</span><span class="op" id="6712336">(</span><span class="ident" id="6712337">t</span>&nbsp;<span class="op" id="6712339">*</span><span class="ident" id="6712340">testing</span><span class="op" id="6712347">.</span><span class="ident" id="6712348">T</span><span class="op" id="6712349">)</span>&nbsp;<span class="op" id="6712351">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6712354">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712382">type</span>&nbsp;<span class="ident" id="6712387">Type4</span>&nbsp;<span class="keyword" id="6712393">struct</span>&nbsp;<span class="op" id="6712400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712404">A</span>&nbsp;<span class="builtintype" id="6712406">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712414">t4p</span>&nbsp;<span class="op" id="6712418">:=</span>&nbsp;<span class="op" id="6712421">&amp;</span><span class="ident" id="6712422">Type4</span><span class="op" id="6712427">{</span><span class="num" id="6712428">3</span><span class="op" id="6712429">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712432">var</span>&nbsp;<span class="ident" id="6712436">t4</span>&nbsp;<span class="ident" id="6712439">Type4</span>&nbsp;<span class="comment" id="6712445">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712470">if</span>&nbsp;<span class="ident" id="6712473">err</span>&nbsp;<span class="op" id="6712477">:=</span>&nbsp;<span class="ident" id="6712480">encAndDec</span><span class="op" id="6712489">(</span><span class="ident" id="6712490">t4p</span><span class="op" id="6712493">,</span>&nbsp;<span class="ident" id="6712495">t4</span><span class="op" id="6712497">)</span><span class="op" id="6712498">;</span>&nbsp;<span class="ident" id="6712500">err</span>&nbsp;<span class="op" id="6712504">==</span>&nbsp;<span class="ident" id="6712507">nil</span>&nbsp;<span class="op" id="6712511">||</span>&nbsp;<span class="ident" id="6712514">strings</span><span class="op" id="6712521">.</span><span class="ident" id="6712522">Index</span><span class="op" id="6712527">(</span><span class="ident" id="6712528">err</span><span class="op" id="6712531">.</span><span class="ident" id="6712532">Error</span><span class="op" id="6712537">(</span><span class="op" id="6712538">)</span><span class="op" id="6712539">,</span>&nbsp;<span class="string" id="6712541">&#34;pointer&#34;</span><span class="op" id="6712550">)</span>&nbsp;<span class="op" id="6712552">&lt;</span>&nbsp;<span class="num" id="6712554">0</span>&nbsp;<span class="op" id="6712556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712560">t</span><span class="op" id="6712561">.</span><span class="ident" id="6712562">Error</span><span class="op" id="6712567">(</span><span class="string" id="6712568">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="6712603">,</span>&nbsp;<span class="ident" id="6712605">err</span><span class="op" id="6712608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712611">}</span><br>
<span class="lineno"></span><span class="op" id="6712613">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="6712616">func</span>&nbsp;<span class="ident" id="6712621">TestArray</span><span class="op" id="6712630">(</span><span class="ident" id="6712631">t</span>&nbsp;<span class="op" id="6712633">*</span><span class="ident" id="6712634">testing</span><span class="op" id="6712641">.</span><span class="ident" id="6712642">T</span><span class="op" id="6712643">)</span>&nbsp;<span class="op" id="6712645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712648">type</span>&nbsp;<span class="ident" id="6712653">Type5</span>&nbsp;<span class="keyword" id="6712659">struct</span>&nbsp;<span class="op" id="6712666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712670">A</span>&nbsp;<span class="op" id="6712672">[</span><span class="num" id="6712673">3</span><span class="op" id="6712674">]</span><span class="builtintype" id="6712675">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712684">B</span>&nbsp;<span class="op" id="6712686">[</span><span class="num" id="6712687">3</span><span class="op" id="6712688">]</span><span class="builtintype" id="6712689">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712698">type</span>&nbsp;<span class="ident" id="6712703">Type6</span>&nbsp;<span class="keyword" id="6712709">struct</span>&nbsp;<span class="op" id="6712716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712720">A</span>&nbsp;<span class="op" id="6712722">[</span><span class="num" id="6712723">2</span><span class="op" id="6712724">]</span><span class="builtintype" id="6712725">string</span>&nbsp;<span class="comment" id="6712732">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712755">t5</span>&nbsp;<span class="op" id="6712758">:=</span>&nbsp;<span class="ident" id="6712761">Type5</span><span class="op" id="6712766">{</span><span class="op" id="6712767">[</span><span class="num" id="6712768">3</span><span class="op" id="6712769">]</span><span class="builtintype" id="6712770">string</span><span class="op" id="6712776">{</span><span class="string" id="6712777">&#34;hello&#34;</span><span class="op" id="6712784">,</span>&nbsp;<span class="string" id="6712786">&#34;,&#34;</span><span class="op" id="6712789">,</span>&nbsp;<span class="string" id="6712791">&#34;world&#34;</span><span class="op" id="6712798">}</span><span class="op" id="6712799">,</span>&nbsp;<span class="op" id="6712801">[</span><span class="num" id="6712802">3</span><span class="op" id="6712803">]</span><span class="builtintype" id="6712804">byte</span><span class="op" id="6712808">{</span><span class="num" id="6712809">1</span><span class="op" id="6712810">,</span>&nbsp;<span class="num" id="6712812">2</span><span class="op" id="6712813">,</span>&nbsp;<span class="num" id="6712815">3</span><span class="op" id="6712816">}</span><span class="op" id="6712817">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712820">var</span>&nbsp;<span class="ident" id="6712824">t5p</span>&nbsp;<span class="ident" id="6712828">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712835">if</span>&nbsp;<span class="ident" id="6712838">err</span>&nbsp;<span class="op" id="6712842">:=</span>&nbsp;<span class="ident" id="6712845">encAndDec</span><span class="op" id="6712854">(</span><span class="ident" id="6712855">t5</span><span class="op" id="6712857">,</span>&nbsp;<span class="op" id="6712859">&amp;</span><span class="ident" id="6712860">t5p</span><span class="op" id="6712863">)</span><span class="op" id="6712864">;</span>&nbsp;<span class="ident" id="6712866">err</span>&nbsp;<span class="op" id="6712870">!=</span>&nbsp;<span class="ident" id="6712873">nil</span>&nbsp;<span class="op" id="6712877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712881">t</span><span class="op" id="6712882">.</span><span class="ident" id="6712883">Error</span><span class="op" id="6712888">(</span><span class="ident" id="6712889">err</span><span class="op" id="6712892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6712895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712898">var</span>&nbsp;<span class="ident" id="6712902">t6</span>&nbsp;<span class="ident" id="6712905">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6712912">if</span>&nbsp;<span class="ident" id="6712915">err</span>&nbsp;<span class="op" id="6712919">:=</span>&nbsp;<span class="ident" id="6712922">encAndDec</span><span class="op" id="6712931">(</span><span class="ident" id="6712932">t5</span><span class="op" id="6712934">,</span>&nbsp;<span class="op" id="6712936">&amp;</span><span class="ident" id="6712937">t6</span><span class="op" id="6712939">)</span><span class="op" id="6712940">;</span>&nbsp;<span class="ident" id="6712942">err</span>&nbsp;<span class="op" id="6712946">==</span>&nbsp;<span class="ident" id="6712949">nil</span>&nbsp;<span class="op" id="6712953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6712957">t</span><span class="op" id="6712958">.</span><span class="ident" id="6712959">Error</span><span class="op" id="6712964">(</span><span class="string" id="6712965">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="6713006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713009">}</span><br>
<span class="lineno"></span><span class="op" id="6713011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="6713014">func</span>&nbsp;<span class="ident" id="6713019">TestRecursiveMapType</span><span class="op" id="6713039">(</span><span class="ident" id="6713040">t</span>&nbsp;<span class="op" id="6713042">*</span><span class="ident" id="6713043">testing</span><span class="op" id="6713050">.</span><span class="ident" id="6713051">T</span><span class="op" id="6713052">)</span>&nbsp;<span class="op" id="6713054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713057">type</span>&nbsp;<span class="ident" id="6713062">recursiveMap</span>&nbsp;<span class="keyword" id="6713075">map</span><span class="op" id="6713078">[</span><span class="builtintype" id="6713079">string</span><span class="op" id="6713085">]</span><span class="ident" id="6713086">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713100">r1</span>&nbsp;<span class="op" id="6713103">:=</span>&nbsp;<span class="ident" id="6713106">recursiveMap</span><span class="op" id="6713118">{</span><span class="string" id="6713119">&#34;A&#34;</span><span class="op" id="6713122">:</span>&nbsp;<span class="ident" id="6713124">recursiveMap</span><span class="op" id="6713136">{</span><span class="string" id="6713137">&#34;B&#34;</span><span class="op" id="6713140">:</span>&nbsp;<span class="ident" id="6713142">nil</span><span class="op" id="6713145">,</span>&nbsp;<span class="string" id="6713147">&#34;C&#34;</span><span class="op" id="6713150">:</span>&nbsp;<span class="ident" id="6713152">nil</span><span class="op" id="6713155">}</span><span class="op" id="6713156">,</span>&nbsp;<span class="string" id="6713158">&#34;D&#34;</span><span class="op" id="6713161">:</span>&nbsp;<span class="ident" id="6713163">nil</span><span class="op" id="6713166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713169">r2</span>&nbsp;<span class="op" id="6713172">:=</span>&nbsp;<span class="builtinfunc" id="6713175">make</span><span class="op" id="6713179">(</span><span class="ident" id="6713180">recursiveMap</span><span class="op" id="6713192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713195">if</span>&nbsp;<span class="ident" id="6713198">err</span>&nbsp;<span class="op" id="6713202">:=</span>&nbsp;<span class="ident" id="6713205">encAndDec</span><span class="op" id="6713214">(</span><span class="ident" id="6713215">r1</span><span class="op" id="6713217">,</span>&nbsp;<span class="op" id="6713219">&amp;</span><span class="ident" id="6713220">r2</span><span class="op" id="6713222">)</span><span class="op" id="6713223">;</span>&nbsp;<span class="ident" id="6713225">err</span>&nbsp;<span class="op" id="6713229">!=</span>&nbsp;<span class="ident" id="6713232">nil</span>&nbsp;<span class="op" id="6713236">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713240">t</span><span class="op" id="6713241">.</span><span class="ident" id="6713242">Error</span><span class="op" id="6713247">(</span><span class="ident" id="6713248">err</span><span class="op" id="6713251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713254">}</span><br>
<span class="lineno"></span><span class="op" id="6713256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6713259">func</span>&nbsp;<span class="ident" id="6713264">TestRecursiveSliceType</span><span class="op" id="6713286">(</span><span class="ident" id="6713287">t</span>&nbsp;<span class="op" id="6713289">*</span><span class="ident" id="6713290">testing</span><span class="op" id="6713297">.</span><span class="ident" id="6713298">T</span><span class="op" id="6713299">)</span>&nbsp;<span class="op" id="6713301">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713304">type</span>&nbsp;<span class="ident" id="6713309">recursiveSlice</span>&nbsp;<span class="op" id="6713324">[</span><span class="op" id="6713325">]</span><span class="ident" id="6713326">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713342">r1</span>&nbsp;<span class="op" id="6713345">:=</span>&nbsp;<span class="ident" id="6713348">recursiveSlice</span><span class="op" id="6713362">{</span><span class="num" id="6713363">0</span><span class="op" id="6713364">:</span>&nbsp;<span class="ident" id="6713366">recursiveSlice</span><span class="op" id="6713380">{</span><span class="num" id="6713381">0</span><span class="op" id="6713382">:</span>&nbsp;<span class="ident" id="6713384">nil</span><span class="op" id="6713387">}</span><span class="op" id="6713388">,</span>&nbsp;<span class="num" id="6713390">1</span><span class="op" id="6713391">:</span>&nbsp;<span class="ident" id="6713393">nil</span><span class="op" id="6713396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713399">r2</span>&nbsp;<span class="op" id="6713402">:=</span>&nbsp;<span class="builtinfunc" id="6713405">make</span><span class="op" id="6713409">(</span><span class="ident" id="6713410">recursiveSlice</span><span class="op" id="6713424">,</span>&nbsp;<span class="num" id="6713426">0</span><span class="op" id="6713427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713430">if</span>&nbsp;<span class="ident" id="6713433">err</span>&nbsp;<span class="op" id="6713437">:=</span>&nbsp;<span class="ident" id="6713440">encAndDec</span><span class="op" id="6713449">(</span><span class="ident" id="6713450">r1</span><span class="op" id="6713452">,</span>&nbsp;<span class="op" id="6713454">&amp;</span><span class="ident" id="6713455">r2</span><span class="op" id="6713457">)</span><span class="op" id="6713458">;</span>&nbsp;<span class="ident" id="6713460">err</span>&nbsp;<span class="op" id="6713464">!=</span>&nbsp;<span class="ident" id="6713467">nil</span>&nbsp;<span class="op" id="6713471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713475">t</span><span class="op" id="6713476">.</span><span class="ident" id="6713477">Error</span><span class="op" id="6713482">(</span><span class="ident" id="6713483">err</span><span class="op" id="6713486">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713489">}</span><br>
<span class="lineno"></span><span class="op" id="6713491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6713494">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="6713558">func</span>&nbsp;<span class="ident" id="6713563">TestDefaultsInArray</span><span class="op" id="6713582">(</span><span class="ident" id="6713583">t</span>&nbsp;<span class="op" id="6713585">*</span><span class="ident" id="6713586">testing</span><span class="op" id="6713593">.</span><span class="ident" id="6713594">T</span><span class="op" id="6713595">)</span>&nbsp;<span class="op" id="6713597">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713600">type</span>&nbsp;<span class="ident" id="6713605">Type7</span>&nbsp;<span class="keyword" id="6713611">struct</span>&nbsp;<span class="op" id="6713618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713622">B</span>&nbsp;<span class="op" id="6713624">[</span><span class="op" id="6713625">]</span><span class="builtintype" id="6713626">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713633">I</span>&nbsp;<span class="op" id="6713635">[</span><span class="op" id="6713636">]</span><span class="builtintype" id="6713637">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713643">S</span>&nbsp;<span class="op" id="6713645">[</span><span class="op" id="6713646">]</span><span class="builtintype" id="6713647">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713656">F</span>&nbsp;<span class="op" id="6713658">[</span><span class="op" id="6713659">]</span><span class="builtintype" id="6713660">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713672">t7</span>&nbsp;<span class="op" id="6713675">:=</span>&nbsp;<span class="ident" id="6713678">Type7</span><span class="op" id="6713683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713687">[</span><span class="op" id="6713688">]</span><span class="builtintype" id="6713689">bool</span><span class="op" id="6713693">{</span><span class="builtintype" id="6713694">false</span><span class="op" id="6713699">,</span>&nbsp;<span class="builtintype" id="6713701">false</span><span class="op" id="6713706">,</span>&nbsp;<span class="builtintype" id="6713708">true</span><span class="op" id="6713712">}</span><span class="op" id="6713713">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713717">[</span><span class="op" id="6713718">]</span><span class="builtintype" id="6713719">int</span><span class="op" id="6713722">{</span><span class="num" id="6713723">0</span><span class="op" id="6713724">,</span>&nbsp;<span class="num" id="6713726">0</span><span class="op" id="6713727">,</span>&nbsp;<span class="num" id="6713729">1</span><span class="op" id="6713730">}</span><span class="op" id="6713731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713735">[</span><span class="op" id="6713736">]</span><span class="builtintype" id="6713737">string</span><span class="op" id="6713743">{</span><span class="string" id="6713744">&#34;hi&#34;</span><span class="op" id="6713748">,</span>&nbsp;<span class="string" id="6713750">&#34;&#34;</span><span class="op" id="6713752">,</span>&nbsp;<span class="string" id="6713754">&#34;there&#34;</span><span class="op" id="6713761">}</span><span class="op" id="6713762">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713766">[</span><span class="op" id="6713767">]</span><span class="builtintype" id="6713768">float64</span><span class="op" id="6713775">{</span><span class="num" id="6713776">0</span><span class="op" id="6713777">,</span>&nbsp;<span class="num" id="6713779">0</span><span class="op" id="6713780">,</span>&nbsp;<span class="num" id="6713782">1</span><span class="op" id="6713783">}</span><span class="op" id="6713784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713790">var</span>&nbsp;<span class="ident" id="6713794">t7p</span>&nbsp;<span class="ident" id="6713798">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6713805">if</span>&nbsp;<span class="ident" id="6713808">err</span>&nbsp;<span class="op" id="6713812">:=</span>&nbsp;<span class="ident" id="6713815">encAndDec</span><span class="op" id="6713824">(</span><span class="ident" id="6713825">t7</span><span class="op" id="6713827">,</span>&nbsp;<span class="op" id="6713829">&amp;</span><span class="ident" id="6713830">t7p</span><span class="op" id="6713833">)</span><span class="op" id="6713834">;</span>&nbsp;<span class="ident" id="6713836">err</span>&nbsp;<span class="op" id="6713840">!=</span>&nbsp;<span class="ident" id="6713843">nil</span>&nbsp;<span class="op" id="6713847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6713851">t</span><span class="op" id="6713852">.</span><span class="ident" id="6713853">Error</span><span class="op" id="6713858">(</span><span class="ident" id="6713859">err</span><span class="op" id="6713862">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6713865">}</span><br>
<span class="lineno"></span><span class="op" id="6713867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6713870">var</span>&nbsp;<span class="ident" id="6713874">testInt</span>&nbsp;<span class="builtintype" id="6713882">int</span><br>
<span class="lineno"></span><span class="keyword" id="6713886">var</span>&nbsp;<span class="ident" id="6713890">testFloat32</span>&nbsp;<span class="builtintype" id="6713902">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="6713910">var</span>&nbsp;<span class="ident" id="6713914">testString</span>&nbsp;<span class="builtintype" id="6713925">string</span><br>
<span class="lineno"></span><span class="keyword" id="6713932">var</span>&nbsp;<span class="ident" id="6713936">testSlice</span>&nbsp;<span class="op" id="6713946">[</span><span class="op" id="6713947">]</span><span class="builtintype" id="6713948">string</span><br>
<span class="lineno"></span><span class="keyword" id="6713955">var</span>&nbsp;<span class="ident" id="6713959">testMap</span>&nbsp;<span class="keyword" id="6713967">map</span><span class="op" id="6713970">[</span><span class="builtintype" id="6713971">string</span><span class="op" id="6713977">]</span><span class="builtintype" id="6713978">int</span><br>
<span class="lineno"></span><span class="keyword" id="6713982">var</span>&nbsp;<span class="ident" id="6713986">testArray</span>&nbsp;<span class="op" id="6713996">[</span><span class="num" id="6713997">7</span><span class="op" id="6713998">]</span><span class="builtintype" id="6713999">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="6714004">type</span>&nbsp;<span class="ident" id="6714009">SingleTest</span>&nbsp;<span class="keyword" id="6714020">struct</span>&nbsp;<span class="op" id="6714027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714030">in</span>&nbsp;&nbsp;<span class="keyword" id="6714034">interface</span><span class="op" id="6714043">{</span><span class="op" id="6714044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714047">out</span>&nbsp;<span class="keyword" id="6714051">interface</span><span class="op" id="6714060">{</span><span class="op" id="6714061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714064">err</span>&nbsp;<span class="builtintype" id="6714068">string</span><br>
<span class="lineno"></span><span class="op" id="6714075">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="6714078">var</span>&nbsp;<span class="ident" id="6714082">singleTests</span>&nbsp;<span class="op" id="6714094">=</span>&nbsp;<span class="op" id="6714096">[</span><span class="op" id="6714097">]</span><span class="ident" id="6714098">SingleTest</span><span class="op" id="6714108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714111">{</span><span class="num" id="6714112">17</span><span class="op" id="6714114">,</span>&nbsp;<span class="op" id="6714116">&amp;</span><span class="ident" id="6714117">testInt</span><span class="op" id="6714124">,</span>&nbsp;<span class="string" id="6714126">&#34;&#34;</span><span class="op" id="6714128">}</span><span class="op" id="6714129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714132">{</span><span class="builtintype" id="6714133">float32</span><span class="op" id="6714140">(</span><span class="num" id="6714141">17.5</span><span class="op" id="6714145">)</span><span class="op" id="6714146">,</span>&nbsp;<span class="op" id="6714148">&amp;</span><span class="ident" id="6714149">testFloat32</span><span class="op" id="6714160">,</span>&nbsp;<span class="string" id="6714162">&#34;&#34;</span><span class="op" id="6714164">}</span><span class="op" id="6714165">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714168">{</span><span class="string" id="6714169">&#34;bike&nbsp;shed&#34;</span><span class="op" id="6714180">,</span>&nbsp;<span class="op" id="6714182">&amp;</span><span class="ident" id="6714183">testString</span><span class="op" id="6714193">,</span>&nbsp;<span class="string" id="6714195">&#34;&#34;</span><span class="op" id="6714197">}</span><span class="op" id="6714198">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714201">{</span><span class="op" id="6714202">[</span><span class="op" id="6714203">]</span><span class="builtintype" id="6714204">string</span><span class="op" id="6714210">{</span><span class="string" id="6714211">&#34;bike&#34;</span><span class="op" id="6714217">,</span>&nbsp;<span class="string" id="6714219">&#34;shed&#34;</span><span class="op" id="6714225">,</span>&nbsp;<span class="string" id="6714227">&#34;paint&#34;</span><span class="op" id="6714234">,</span>&nbsp;<span class="string" id="6714236">&#34;color&#34;</span><span class="op" id="6714243">}</span><span class="op" id="6714244">,</span>&nbsp;<span class="op" id="6714246">&amp;</span><span class="ident" id="6714247">testSlice</span><span class="op" id="6714256">,</span>&nbsp;<span class="string" id="6714258">&#34;&#34;</span><span class="op" id="6714260">}</span><span class="op" id="6714261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714264">{</span><span class="keyword" id="6714265">map</span><span class="op" id="6714268">[</span><span class="builtintype" id="6714269">string</span><span class="op" id="6714275">]</span><span class="builtintype" id="6714276">int</span><span class="op" id="6714279">{</span><span class="string" id="6714280">&#34;seven&#34;</span><span class="op" id="6714287">:</span>&nbsp;<span class="num" id="6714289">7</span><span class="op" id="6714290">,</span>&nbsp;<span class="string" id="6714292">&#34;twelve&#34;</span><span class="op" id="6714300">:</span>&nbsp;<span class="num" id="6714302">12</span><span class="op" id="6714304">}</span><span class="op" id="6714305">,</span>&nbsp;<span class="op" id="6714307">&amp;</span><span class="ident" id="6714308">testMap</span><span class="op" id="6714315">,</span>&nbsp;<span class="string" id="6714317">&#34;&#34;</span><span class="op" id="6714319">}</span><span class="op" id="6714320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714323">{</span><span class="op" id="6714324">[</span><span class="num" id="6714325">7</span><span class="op" id="6714326">]</span><span class="builtintype" id="6714327">int</span><span class="op" id="6714330">{</span><span class="num" id="6714331">4</span><span class="op" id="6714332">,</span>&nbsp;<span class="num" id="6714334">55</span><span class="op" id="6714336">,</span>&nbsp;<span class="num" id="6714338">0</span><span class="op" id="6714339">,</span>&nbsp;<span class="num" id="6714341">0</span><span class="op" id="6714342">,</span>&nbsp;<span class="num" id="6714344">0</span><span class="op" id="6714345">,</span>&nbsp;<span class="num" id="6714347">0</span><span class="op" id="6714348">,</span>&nbsp;<span class="num" id="6714350">0</span><span class="op" id="6714351">}</span><span class="op" id="6714352">,</span>&nbsp;<span class="op" id="6714354">&amp;</span><span class="ident" id="6714355">testArray</span><span class="op" id="6714364">,</span>&nbsp;<span class="string" id="6714366">&#34;&#34;</span><span class="op" id="6714368">}</span><span class="op" id="6714369">,</span>&nbsp;<span class="comment" id="6714371">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714406">{</span><span class="op" id="6714407">[</span><span class="num" id="6714408">7</span><span class="op" id="6714409">]</span><span class="builtintype" id="6714410">int</span><span class="op" id="6714413">{</span><span class="num" id="6714414">4</span><span class="op" id="6714415">,</span>&nbsp;<span class="num" id="6714417">55</span><span class="op" id="6714419">,</span>&nbsp;<span class="num" id="6714421">1</span><span class="op" id="6714422">,</span>&nbsp;<span class="num" id="6714424">44</span><span class="op" id="6714426">,</span>&nbsp;<span class="num" id="6714428">22</span><span class="op" id="6714430">,</span>&nbsp;<span class="num" id="6714432">66</span><span class="op" id="6714434">,</span>&nbsp;<span class="num" id="6714436">1234</span><span class="op" id="6714440">}</span><span class="op" id="6714441">,</span>&nbsp;<span class="op" id="6714443">&amp;</span><span class="ident" id="6714444">testArray</span><span class="op" id="6714453">,</span>&nbsp;<span class="string" id="6714455">&#34;&#34;</span><span class="op" id="6714457">}</span><span class="op" id="6714458">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6714462">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714480">{</span><span class="num" id="6714481">172</span><span class="op" id="6714484">,</span>&nbsp;<span class="op" id="6714486">&amp;</span><span class="ident" id="6714487">testFloat32</span><span class="op" id="6714498">,</span>&nbsp;<span class="string" id="6714500">&#34;type&#34;</span><span class="op" id="6714506">}</span><span class="op" id="6714507">,</span><br>
<span class="lineno"></span><span class="op" id="6714509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6714512">func</span>&nbsp;<span class="ident" id="6714517">TestSingletons</span><span class="op" id="6714531">(</span><span class="ident" id="6714532">t</span>&nbsp;<span class="op" id="6714534">*</span><span class="ident" id="6714535">testing</span><span class="op" id="6714542">.</span><span class="ident" id="6714543">T</span><span class="op" id="6714544">)</span>&nbsp;<span class="op" id="6714546">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714549">b</span>&nbsp;<span class="op" id="6714551">:=</span>&nbsp;<span class="builtinfunc" id="6714554">new</span><span class="op" id="6714557">(</span><span class="ident" id="6714558">bytes</span><span class="op" id="6714563">.</span><span class="ident" id="6714564">Buffer</span><span class="op" id="6714570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714573">enc</span>&nbsp;<span class="op" id="6714577">:=</span>&nbsp;<span class="ident" id="6714580">NewEncoder</span><span class="op" id="6714590">(</span><span class="ident" id="6714591">b</span><span class="op" id="6714592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714595">dec</span>&nbsp;<span class="op" id="6714599">:=</span>&nbsp;<span class="ident" id="6714602">NewDecoder</span><span class="op" id="6714612">(</span><span class="ident" id="6714613">b</span><span class="op" id="6714614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714617">for</span>&nbsp;<span class="ident" id="6714621">_</span><span class="op" id="6714622">,</span>&nbsp;<span class="ident" id="6714624">test</span>&nbsp;<span class="op" id="6714629">:=</span>&nbsp;<span class="keyword" id="6714632">range</span>&nbsp;<span class="ident" id="6714638">singleTests</span>&nbsp;<span class="op" id="6714650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714654">b</span><span class="op" id="6714655">.</span><span class="ident" id="6714656">Reset</span><span class="op" id="6714661">(</span><span class="op" id="6714662">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714666">err</span>&nbsp;<span class="op" id="6714670">:=</span>&nbsp;<span class="ident" id="6714673">enc</span><span class="op" id="6714676">.</span><span class="ident" id="6714677">Encode</span><span class="op" id="6714683">(</span><span class="ident" id="6714684">test</span><span class="op" id="6714688">.</span><span class="ident" id="6714689">in</span><span class="op" id="6714691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714695">if</span>&nbsp;<span class="ident" id="6714698">err</span>&nbsp;<span class="op" id="6714702">!=</span>&nbsp;<span class="ident" id="6714705">nil</span>&nbsp;<span class="op" id="6714709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714714">t</span><span class="op" id="6714715">.</span><span class="ident" id="6714716">Errorf</span><span class="op" id="6714722">(</span><span class="string" id="6714723">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="6714746">,</span>&nbsp;<span class="ident" id="6714748">test</span><span class="op" id="6714752">.</span><span class="ident" id="6714753">in</span><span class="op" id="6714755">,</span>&nbsp;<span class="ident" id="6714757">err</span><span class="op" id="6714760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714765">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6714776">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714780">err</span>&nbsp;<span class="op" id="6714784">=</span>&nbsp;<span class="ident" id="6714786">dec</span><span class="op" id="6714789">.</span><span class="ident" id="6714790">Decode</span><span class="op" id="6714796">(</span><span class="ident" id="6714797">test</span><span class="op" id="6714801">.</span><span class="ident" id="6714802">out</span><span class="op" id="6714805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714809">switch</span>&nbsp;<span class="op" id="6714816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714820">case</span>&nbsp;<span class="ident" id="6714825">err</span>&nbsp;<span class="op" id="6714829">!=</span>&nbsp;<span class="ident" id="6714832">nil</span>&nbsp;<span class="op" id="6714836">&amp;&amp;</span>&nbsp;<span class="ident" id="6714839">test</span><span class="op" id="6714843">.</span><span class="ident" id="6714844">err</span>&nbsp;<span class="op" id="6714848">==</span>&nbsp;<span class="string" id="6714851">&#34;&#34;</span><span class="op" id="6714853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714858">t</span><span class="op" id="6714859">.</span><span class="ident" id="6714860">Errorf</span><span class="op" id="6714866">(</span><span class="string" id="6714867">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="6714890">,</span>&nbsp;<span class="ident" id="6714892">test</span><span class="op" id="6714896">.</span><span class="ident" id="6714897">in</span><span class="op" id="6714899">,</span>&nbsp;<span class="ident" id="6714901">err</span><span class="op" id="6714904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714909">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6714920">case</span>&nbsp;<span class="ident" id="6714925">err</span>&nbsp;<span class="op" id="6714929">==</span>&nbsp;<span class="ident" id="6714932">nil</span>&nbsp;<span class="op" id="6714936">&amp;&amp;</span>&nbsp;<span class="ident" id="6714939">test</span><span class="op" id="6714943">.</span><span class="ident" id="6714944">err</span>&nbsp;<span class="op" id="6714948">!=</span>&nbsp;<span class="string" id="6714951">&#34;&#34;</span><span class="op" id="6714953">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6714958">t</span><span class="op" id="6714959">.</span><span class="ident" id="6714960">Errorf</span><span class="op" id="6714966">(</span><span class="string" id="6714967">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="6714999">,</span>&nbsp;<span class="ident" id="6715001">test</span><span class="op" id="6715005">.</span><span class="ident" id="6715006">in</span><span class="op" id="6715008">,</span>&nbsp;<span class="ident" id="6715010">test</span><span class="op" id="6715014">.</span><span class="ident" id="6715015">err</span><span class="op" id="6715018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715023">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715034">case</span>&nbsp;<span class="ident" id="6715039">err</span>&nbsp;<span class="op" id="6715043">!=</span>&nbsp;<span class="ident" id="6715046">nil</span>&nbsp;<span class="op" id="6715050">&amp;&amp;</span>&nbsp;<span class="ident" id="6715053">test</span><span class="op" id="6715057">.</span><span class="ident" id="6715058">err</span>&nbsp;<span class="op" id="6715062">!=</span>&nbsp;<span class="string" id="6715065">&#34;&#34;</span><span class="op" id="6715067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715072">if</span>&nbsp;<span class="ident" id="6715075">strings</span><span class="op" id="6715082">.</span><span class="ident" id="6715083">Index</span><span class="op" id="6715088">(</span><span class="ident" id="6715089">err</span><span class="op" id="6715092">.</span><span class="ident" id="6715093">Error</span><span class="op" id="6715098">(</span><span class="op" id="6715099">)</span><span class="op" id="6715100">,</span>&nbsp;<span class="ident" id="6715102">test</span><span class="op" id="6715106">.</span><span class="ident" id="6715107">err</span><span class="op" id="6715110">)</span>&nbsp;<span class="op" id="6715112">&lt;</span>&nbsp;<span class="num" id="6715114">0</span>&nbsp;<span class="op" id="6715116">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715122">t</span><span class="op" id="6715123">.</span><span class="ident" id="6715124">Errorf</span><span class="op" id="6715130">(</span><span class="string" id="6715131">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6715175">,</span>&nbsp;<span class="ident" id="6715177">test</span><span class="op" id="6715181">.</span><span class="ident" id="6715182">in</span><span class="op" id="6715184">,</span>&nbsp;<span class="ident" id="6715186">test</span><span class="op" id="6715190">.</span><span class="ident" id="6715191">err</span><span class="op" id="6715194">,</span>&nbsp;<span class="ident" id="6715196">err</span><span class="op" id="6715199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715209">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6715224">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715263">val</span>&nbsp;<span class="op" id="6715267">:=</span>&nbsp;<span class="ident" id="6715270">reflect</span><span class="op" id="6715277">.</span><span class="ident" id="6715278">ValueOf</span><span class="op" id="6715285">(</span><span class="ident" id="6715286">test</span><span class="op" id="6715290">.</span><span class="ident" id="6715291">out</span><span class="op" id="6715294">)</span><span class="op" id="6715295">.</span><span class="ident" id="6715296">Elem</span><span class="op" id="6715300">(</span><span class="op" id="6715301">)</span><span class="op" id="6715302">.</span><span class="ident" id="6715303">Interface</span><span class="op" id="6715312">(</span><span class="op" id="6715313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715317">if</span>&nbsp;<span class="op" id="6715320">!</span><span class="ident" id="6715321">reflect</span><span class="op" id="6715328">.</span><span class="ident" id="6715329">DeepEqual</span><span class="op" id="6715338">(</span><span class="ident" id="6715339">test</span><span class="op" id="6715343">.</span><span class="ident" id="6715344">in</span><span class="op" id="6715346">,</span>&nbsp;<span class="ident" id="6715348">val</span><span class="op" id="6715351">)</span>&nbsp;<span class="op" id="6715353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715358">t</span><span class="op" id="6715359">.</span><span class="ident" id="6715360">Errorf</span><span class="op" id="6715366">(</span><span class="string" id="6715367">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6715407">,</span>&nbsp;<span class="ident" id="6715409">test</span><span class="op" id="6715413">.</span><span class="ident" id="6715414">in</span><span class="op" id="6715416">,</span>&nbsp;<span class="ident" id="6715418">val</span><span class="op" id="6715421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715428">}</span><br>
<span class="lineno">420</span><span class="op" id="6715430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6715433">func</span>&nbsp;<span class="ident" id="6715438">TestStructNonStruct</span><span class="op" id="6715457">(</span><span class="ident" id="6715458">t</span>&nbsp;<span class="op" id="6715460">*</span><span class="ident" id="6715461">testing</span><span class="op" id="6715468">.</span><span class="ident" id="6715469">T</span><span class="op" id="6715470">)</span>&nbsp;<span class="op" id="6715472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715475">type</span>&nbsp;<span class="ident" id="6715480">Struct</span>&nbsp;<span class="keyword" id="6715487">struct</span>&nbsp;<span class="op" id="6715494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715498">A</span>&nbsp;<span class="builtintype" id="6715500">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715511">type</span>&nbsp;<span class="ident" id="6715516">NonStruct</span>&nbsp;<span class="builtintype" id="6715526">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715534">s</span>&nbsp;<span class="op" id="6715536">:=</span>&nbsp;<span class="ident" id="6715539">Struct</span><span class="op" id="6715545">{</span><span class="string" id="6715546">&#34;hello&#34;</span><span class="op" id="6715553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715556">var</span>&nbsp;<span class="ident" id="6715560">sp</span>&nbsp;<span class="ident" id="6715563">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715571">if</span>&nbsp;<span class="ident" id="6715574">err</span>&nbsp;<span class="op" id="6715578">:=</span>&nbsp;<span class="ident" id="6715581">encAndDec</span><span class="op" id="6715590">(</span><span class="ident" id="6715591">s</span><span class="op" id="6715592">,</span>&nbsp;<span class="op" id="6715594">&amp;</span><span class="ident" id="6715595">sp</span><span class="op" id="6715597">)</span><span class="op" id="6715598">;</span>&nbsp;<span class="ident" id="6715600">err</span>&nbsp;<span class="op" id="6715604">!=</span>&nbsp;<span class="ident" id="6715607">nil</span>&nbsp;<span class="op" id="6715611">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715615">t</span><span class="op" id="6715616">.</span><span class="ident" id="6715617">Error</span><span class="op" id="6715622">(</span><span class="ident" id="6715623">err</span><span class="op" id="6715626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715632">var</span>&nbsp;<span class="ident" id="6715636">ns</span>&nbsp;<span class="ident" id="6715639">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715650">if</span>&nbsp;<span class="ident" id="6715653">err</span>&nbsp;<span class="op" id="6715657">:=</span>&nbsp;<span class="ident" id="6715660">encAndDec</span><span class="op" id="6715669">(</span><span class="ident" id="6715670">s</span><span class="op" id="6715671">,</span>&nbsp;<span class="op" id="6715673">&amp;</span><span class="ident" id="6715674">ns</span><span class="op" id="6715676">)</span><span class="op" id="6715677">;</span>&nbsp;<span class="ident" id="6715679">err</span>&nbsp;<span class="op" id="6715683">==</span>&nbsp;<span class="ident" id="6715686">nil</span>&nbsp;<span class="op" id="6715690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715694">t</span><span class="op" id="6715695">.</span><span class="ident" id="6715696">Error</span><span class="op" id="6715701">(</span><span class="string" id="6715702">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="6715742">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715745">}</span>&nbsp;<span class="keyword" id="6715747">else</span>&nbsp;<span class="keyword" id="6715752">if</span>&nbsp;<span class="ident" id="6715755">strings</span><span class="op" id="6715762">.</span><span class="ident" id="6715763">Index</span><span class="op" id="6715768">(</span><span class="ident" id="6715769">err</span><span class="op" id="6715772">.</span><span class="ident" id="6715773">Error</span><span class="op" id="6715778">(</span><span class="op" id="6715779">)</span><span class="op" id="6715780">,</span>&nbsp;<span class="string" id="6715782">&#34;type&#34;</span><span class="op" id="6715788">)</span>&nbsp;<span class="op" id="6715790">&lt;</span>&nbsp;<span class="num" id="6715792">0</span>&nbsp;<span class="op" id="6715794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715798">t</span><span class="op" id="6715799">.</span><span class="ident" id="6715800">Error</span><span class="op" id="6715805">(</span><span class="string" id="6715806">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6715854">,</span>&nbsp;<span class="ident" id="6715856">err</span><span class="op" id="6715859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6715865">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715891">var</span>&nbsp;<span class="ident" id="6715895">nsp</span>&nbsp;<span class="ident" id="6715899">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715910">if</span>&nbsp;<span class="ident" id="6715913">err</span>&nbsp;<span class="op" id="6715917">:=</span>&nbsp;<span class="ident" id="6715920">encAndDec</span><span class="op" id="6715929">(</span><span class="ident" id="6715930">ns</span><span class="op" id="6715932">,</span>&nbsp;<span class="op" id="6715934">&amp;</span><span class="ident" id="6715935">nsp</span><span class="op" id="6715938">)</span><span class="op" id="6715939">;</span>&nbsp;<span class="ident" id="6715941">err</span>&nbsp;<span class="op" id="6715945">!=</span>&nbsp;<span class="ident" id="6715948">nil</span>&nbsp;<span class="op" id="6715952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6715956">t</span><span class="op" id="6715957">.</span><span class="ident" id="6715958">Error</span><span class="op" id="6715963">(</span><span class="ident" id="6715964">err</span><span class="op" id="6715967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6715970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6715973">if</span>&nbsp;<span class="ident" id="6715976">err</span>&nbsp;<span class="op" id="6715980">:=</span>&nbsp;<span class="ident" id="6715983">encAndDec</span><span class="op" id="6715992">(</span><span class="ident" id="6715993">ns</span><span class="op" id="6715995">,</span>&nbsp;<span class="op" id="6715997">&amp;</span><span class="ident" id="6715998">s</span><span class="op" id="6715999">)</span><span class="op" id="6716000">;</span>&nbsp;<span class="ident" id="6716002">err</span>&nbsp;<span class="op" id="6716006">==</span>&nbsp;<span class="ident" id="6716009">nil</span>&nbsp;<span class="op" id="6716013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716017">t</span><span class="op" id="6716018">.</span><span class="ident" id="6716019">Error</span><span class="op" id="6716024">(</span><span class="string" id="6716025">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="6716065">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716068">}</span>&nbsp;<span class="keyword" id="6716070">else</span>&nbsp;<span class="keyword" id="6716075">if</span>&nbsp;<span class="ident" id="6716078">strings</span><span class="op" id="6716085">.</span><span class="ident" id="6716086">Index</span><span class="op" id="6716091">(</span><span class="ident" id="6716092">err</span><span class="op" id="6716095">.</span><span class="ident" id="6716096">Error</span><span class="op" id="6716101">(</span><span class="op" id="6716102">)</span><span class="op" id="6716103">,</span>&nbsp;<span class="string" id="6716105">&#34;type&#34;</span><span class="op" id="6716111">)</span>&nbsp;<span class="op" id="6716113">&lt;</span>&nbsp;<span class="num" id="6716115">0</span>&nbsp;<span class="op" id="6716117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716121">t</span><span class="op" id="6716122">.</span><span class="ident" id="6716123">Error</span><span class="op" id="6716128">(</span><span class="string" id="6716129">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6716177">,</span>&nbsp;<span class="ident" id="6716179">err</span><span class="op" id="6716182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716185">}</span><br>
<span class="lineno"></span><span class="op" id="6716187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="6716190">type</span>&nbsp;<span class="ident" id="6716195">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="6716218">interface</span>&nbsp;<span class="op" id="6716228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716231">F</span><span class="op" id="6716232">(</span><span class="op" id="6716233">)</span>&nbsp;<span class="builtintype" id="6716235">bool</span><br>
<span class="lineno"></span><span class="op" id="6716240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6716243">type</span>&nbsp;<span class="ident" id="6716248">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="6716271">struct</span><span class="op" id="6716277">{</span><span class="op" id="6716278">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="6716281">func</span>&nbsp;<span class="op" id="6716286">(</span><span class="ident" id="6716287">this</span>&nbsp;<span class="op" id="6716292">*</span><span class="ident" id="6716293">interfaceIndirectTestT</span><span class="op" id="6716315">)</span>&nbsp;<span class="ident" id="6716317">F</span><span class="op" id="6716318">(</span><span class="op" id="6716319">)</span>&nbsp;<span class="builtintype" id="6716321">bool</span>&nbsp;<span class="op" id="6716326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716329">return</span>&nbsp;<span class="builtintype" id="6716336">true</span><br>
<span class="lineno"></span><span class="op" id="6716341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="6716344">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="6716413">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6716482">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="6716514">func</span>&nbsp;<span class="ident" id="6716519">TestInterfaceIndirect</span><span class="op" id="6716540">(</span><span class="ident" id="6716541">t</span>&nbsp;<span class="op" id="6716543">*</span><span class="ident" id="6716544">testing</span><span class="op" id="6716551">.</span><span class="ident" id="6716552">T</span><span class="op" id="6716553">)</span>&nbsp;<span class="op" id="6716555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716558">Register</span><span class="op" id="6716566">(</span><span class="op" id="6716567">&amp;</span><span class="ident" id="6716568">interfaceIndirectTestT</span><span class="op" id="6716590">{</span><span class="op" id="6716591">}</span><span class="op" id="6716592">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716595">b</span>&nbsp;<span class="op" id="6716597">:=</span>&nbsp;<span class="builtinfunc" id="6716600">new</span><span class="op" id="6716603">(</span><span class="ident" id="6716604">bytes</span><span class="op" id="6716609">.</span><span class="ident" id="6716610">Buffer</span><span class="op" id="6716616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716619">w</span>&nbsp;<span class="op" id="6716621">:=</span>&nbsp;<span class="op" id="6716624">[</span><span class="op" id="6716625">]</span><span class="ident" id="6716626">interfaceIndirectTestI</span><span class="op" id="6716648">{</span><span class="op" id="6716649">&amp;</span><span class="ident" id="6716650">interfaceIndirectTestT</span><span class="op" id="6716672">{</span><span class="op" id="6716673">}</span><span class="op" id="6716674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716677">err</span>&nbsp;<span class="op" id="6716681">:=</span>&nbsp;<span class="ident" id="6716684">NewEncoder</span><span class="op" id="6716694">(</span><span class="ident" id="6716695">b</span><span class="op" id="6716696">)</span><span class="op" id="6716697">.</span><span class="ident" id="6716698">Encode</span><span class="op" id="6716704">(</span><span class="ident" id="6716705">w</span><span class="op" id="6716706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716709">if</span>&nbsp;<span class="ident" id="6716712">err</span>&nbsp;<span class="op" id="6716716">!=</span>&nbsp;<span class="ident" id="6716719">nil</span>&nbsp;<span class="op" id="6716723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716727">t</span><span class="op" id="6716728">.</span><span class="ident" id="6716729">Fatal</span><span class="op" id="6716734">(</span><span class="string" id="6716735">&#34;encode&nbsp;error:&#34;</span><span class="op" id="6716750">,</span>&nbsp;<span class="ident" id="6716752">err</span><span class="op" id="6716755">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716762">var</span>&nbsp;<span class="ident" id="6716766">r</span>&nbsp;<span class="op" id="6716768">[</span><span class="op" id="6716769">]</span><span class="ident" id="6716770">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716794">err</span>&nbsp;<span class="op" id="6716798">=</span>&nbsp;<span class="ident" id="6716800">NewDecoder</span><span class="op" id="6716810">(</span><span class="ident" id="6716811">b</span><span class="op" id="6716812">)</span><span class="op" id="6716813">.</span><span class="ident" id="6716814">Decode</span><span class="op" id="6716820">(</span><span class="op" id="6716821">&amp;</span><span class="ident" id="6716822">r</span><span class="op" id="6716823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6716826">if</span>&nbsp;<span class="ident" id="6716829">err</span>&nbsp;<span class="op" id="6716833">!=</span>&nbsp;<span class="ident" id="6716836">nil</span>&nbsp;<span class="op" id="6716840">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6716844">t</span><span class="op" id="6716845">.</span><span class="ident" id="6716846">Fatal</span><span class="op" id="6716851">(</span><span class="string" id="6716852">&#34;decode&nbsp;error:&#34;</span><span class="op" id="6716867">,</span>&nbsp;<span class="ident" id="6716869">err</span><span class="op" id="6716872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6716875">}</span><br>
<span class="lineno"></span><span class="op" id="6716877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6716880">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="6716957">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6717006">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="6717082">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="6717159">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="6717232">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6717309">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6717378">type</span>&nbsp;<span class="ident" id="6717383">Struct0</span>&nbsp;<span class="keyword" id="6717391">struct</span>&nbsp;<span class="op" id="6717398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717401">I</span>&nbsp;<span class="keyword" id="6717403">interface</span><span class="op" id="6717412">{</span><span class="op" id="6717413">}</span><br>
<span class="lineno">490</span><span class="op" id="6717415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6717418">type</span>&nbsp;<span class="ident" id="6717423">NewType0</span>&nbsp;<span class="keyword" id="6717432">struct</span>&nbsp;<span class="op" id="6717439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717442">S</span>&nbsp;<span class="builtintype" id="6717444">string</span><br>
<span class="lineno"></span><span class="op" id="6717451">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="6717454">type</span>&nbsp;<span class="ident" id="6717459">ignoreTest</span>&nbsp;<span class="keyword" id="6717470">struct</span>&nbsp;<span class="op" id="6717477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6717480">in</span><span class="op" id="6717482">,</span>&nbsp;<span class="ident" id="6717484">out</span>&nbsp;<span class="keyword" id="6717488">interface</span><span class="op" id="6717497">{</span><span class="op" id="6717498">}</span><br>
<span class="lineno"></span><span class="op" id="6717500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="6717503">var</span>&nbsp;<span class="ident" id="6717507">ignoreTests</span>&nbsp;<span class="op" id="6717519">=</span>&nbsp;<span class="op" id="6717521">[</span><span class="op" id="6717522">]</span><span class="ident" id="6717523">ignoreTest</span><span class="op" id="6717533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717536">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717582">{</span><span class="op" id="6717583">&amp;</span><span class="keyword" id="6717584">struct</span><span class="op" id="6717590">{</span>&nbsp;<span class="ident" id="6717592">A</span>&nbsp;<span class="builtintype" id="6717594">int</span>&nbsp;<span class="op" id="6717598">}</span><span class="op" id="6717599">{</span><span class="num" id="6717600">23</span><span class="op" id="6717602">}</span><span class="op" id="6717603">,</span>&nbsp;<span class="op" id="6717605">&amp;</span><span class="keyword" id="6717606">struct</span><span class="op" id="6717612">{</span><span class="op" id="6717613">}</span><span class="op" id="6717614">{</span><span class="op" id="6717615">}</span><span class="op" id="6717616">}</span><span class="op" id="6717617">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717620">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717657">{</span><span class="op" id="6717658">&amp;</span><span class="keyword" id="6717659">struct</span><span class="op" id="6717665">{</span>&nbsp;<span class="ident" id="6717667">A</span>&nbsp;<span class="builtintype" id="6717669">int</span>&nbsp;<span class="op" id="6717673">}</span><span class="op" id="6717674">{</span><span class="num" id="6717675">23</span><span class="op" id="6717677">}</span><span class="op" id="6717678">,</span>&nbsp;<span class="ident" id="6717680">nil</span><span class="op" id="6717683">}</span><span class="op" id="6717684">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717687">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717727">{</span><span class="string" id="6717728">&#34;hello,&nbsp;world&#34;</span><span class="op" id="6717742">,</span>&nbsp;<span class="ident" id="6717744">nil</span><span class="op" id="6717747">}</span><span class="op" id="6717748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717751">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717790">{</span><span class="op" id="6717791">[</span><span class="op" id="6717792">]</span><span class="builtintype" id="6717793">int</span><span class="op" id="6717796">{</span><span class="num" id="6717797">1</span><span class="op" id="6717798">,</span>&nbsp;<span class="num" id="6717800">2</span><span class="op" id="6717801">,</span>&nbsp;<span class="num" id="6717803">3</span><span class="op" id="6717804">,</span>&nbsp;<span class="num" id="6717806">4</span><span class="op" id="6717807">}</span><span class="op" id="6717808">,</span>&nbsp;<span class="ident" id="6717810">nil</span><span class="op" id="6717813">}</span><span class="op" id="6717814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717817">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717871">{</span><span class="op" id="6717872">&amp;</span><span class="ident" id="6717873">Struct0</span><span class="op" id="6717880">{</span><span class="op" id="6717881">&amp;</span><span class="ident" id="6717882">NewType0</span><span class="op" id="6717890">{</span><span class="string" id="6717891">&#34;value0&#34;</span><span class="op" id="6717899">}</span><span class="op" id="6717900">}</span><span class="op" id="6717901">,</span>&nbsp;<span class="ident" id="6717903">nil</span><span class="op" id="6717906">}</span><span class="op" id="6717907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6717910">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6717963">{</span><span class="op" id="6717964">[</span><span class="op" id="6717965">]</span><span class="keyword" id="6717966">interface</span><span class="op" id="6717975">{</span><span class="op" id="6717976">}</span><span class="op" id="6717977">{</span><span class="string" id="6717978">&#34;hi&#34;</span><span class="op" id="6717982">,</span>&nbsp;<span class="op" id="6717984">&amp;</span><span class="ident" id="6717985">NewType0</span><span class="op" id="6717993">{</span><span class="string" id="6717994">&#34;value1&#34;</span><span class="op" id="6718002">}</span><span class="op" id="6718003">,</span>&nbsp;<span class="num" id="6718005">23</span><span class="op" id="6718007">}</span><span class="op" id="6718008">,</span>&nbsp;<span class="ident" id="6718010">nil</span><span class="op" id="6718013">}</span><span class="op" id="6718014">,</span><br>
<span class="lineno"></span><span class="op" id="6718016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="6718019">func</span>&nbsp;<span class="ident" id="6718024">TestDecodeIntoNothing</span><span class="op" id="6718045">(</span><span class="ident" id="6718046">t</span>&nbsp;<span class="op" id="6718048">*</span><span class="ident" id="6718049">testing</span><span class="op" id="6718056">.</span><span class="ident" id="6718057">T</span><span class="op" id="6718058">)</span>&nbsp;<span class="op" id="6718060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718063">Register</span><span class="op" id="6718071">(</span><span class="builtinfunc" id="6718072">new</span><span class="op" id="6718075">(</span><span class="ident" id="6718076">NewType0</span><span class="op" id="6718084">)</span><span class="op" id="6718085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718088">for</span>&nbsp;<span class="ident" id="6718092">i</span><span class="op" id="6718093">,</span>&nbsp;<span class="ident" id="6718095">test</span>&nbsp;<span class="op" id="6718100">:=</span>&nbsp;<span class="keyword" id="6718103">range</span>&nbsp;<span class="ident" id="6718109">ignoreTests</span>&nbsp;<span class="op" id="6718121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718125">b</span>&nbsp;<span class="op" id="6718127">:=</span>&nbsp;<span class="builtinfunc" id="6718130">new</span><span class="op" id="6718133">(</span><span class="ident" id="6718134">bytes</span><span class="op" id="6718139">.</span><span class="ident" id="6718140">Buffer</span><span class="op" id="6718146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718150">enc</span>&nbsp;<span class="op" id="6718154">:=</span>&nbsp;<span class="ident" id="6718157">NewEncoder</span><span class="op" id="6718167">(</span><span class="ident" id="6718168">b</span><span class="op" id="6718169">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718173">err</span>&nbsp;<span class="op" id="6718177">:=</span>&nbsp;<span class="ident" id="6718180">enc</span><span class="op" id="6718183">.</span><span class="ident" id="6718184">Encode</span><span class="op" id="6718190">(</span><span class="ident" id="6718191">test</span><span class="op" id="6718195">.</span><span class="ident" id="6718196">in</span><span class="op" id="6718198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718202">if</span>&nbsp;<span class="ident" id="6718205">err</span>&nbsp;<span class="op" id="6718209">!=</span>&nbsp;<span class="ident" id="6718212">nil</span>&nbsp;<span class="op" id="6718216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718221">t</span><span class="op" id="6718222">.</span><span class="ident" id="6718223">Errorf</span><span class="op" id="6718229">(</span><span class="string" id="6718230">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="6718252">,</span>&nbsp;<span class="ident" id="6718254">i</span><span class="op" id="6718255">,</span>&nbsp;<span class="ident" id="6718257">err</span><span class="op" id="6718260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718265">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718276">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718280">dec</span>&nbsp;<span class="op" id="6718284">:=</span>&nbsp;<span class="ident" id="6718287">NewDecoder</span><span class="op" id="6718297">(</span><span class="ident" id="6718298">b</span><span class="op" id="6718299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718303">err</span>&nbsp;<span class="op" id="6718307">=</span>&nbsp;<span class="ident" id="6718309">dec</span><span class="op" id="6718312">.</span><span class="ident" id="6718313">Decode</span><span class="op" id="6718319">(</span><span class="ident" id="6718320">test</span><span class="op" id="6718324">.</span><span class="ident" id="6718325">out</span><span class="op" id="6718328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718332">if</span>&nbsp;<span class="ident" id="6718335">err</span>&nbsp;<span class="op" id="6718339">!=</span>&nbsp;<span class="ident" id="6718342">nil</span>&nbsp;<span class="op" id="6718346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718351">t</span><span class="op" id="6718352">.</span><span class="ident" id="6718353">Errorf</span><span class="op" id="6718359">(</span><span class="string" id="6718360">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6718382">,</span>&nbsp;<span class="ident" id="6718384">i</span><span class="op" id="6718385">,</span>&nbsp;<span class="ident" id="6718387">err</span><span class="op" id="6718390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718395">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6718410">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718477">str</span>&nbsp;<span class="op" id="6718481">:=</span>&nbsp;<span class="ident" id="6718484">fmt</span><span class="op" id="6718487">.</span><span class="ident" id="6718488">Sprintf</span><span class="op" id="6718495">(</span><span class="string" id="6718496">&#34;Value&nbsp;%d&#34;</span><span class="op" id="6718506">,</span>&nbsp;<span class="ident" id="6718508">i</span><span class="op" id="6718509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718513">err</span>&nbsp;<span class="op" id="6718517">=</span>&nbsp;<span class="ident" id="6718519">enc</span><span class="op" id="6718522">.</span><span class="ident" id="6718523">Encode</span><span class="op" id="6718529">(</span><span class="op" id="6718530">&amp;</span><span class="ident" id="6718531">NewType0</span><span class="op" id="6718539">{</span><span class="ident" id="6718540">str</span><span class="op" id="6718543">}</span><span class="op" id="6718544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718548">if</span>&nbsp;<span class="ident" id="6718551">err</span>&nbsp;<span class="op" id="6718555">!=</span>&nbsp;<span class="ident" id="6718558">nil</span>&nbsp;<span class="op" id="6718562">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718567">t</span><span class="op" id="6718568">.</span><span class="ident" id="6718569">Fatalf</span><span class="op" id="6718575">(</span><span class="string" id="6718576">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6718607">,</span>&nbsp;<span class="ident" id="6718609">i</span><span class="op" id="6718610">,</span>&nbsp;<span class="ident" id="6718612">err</span><span class="op" id="6718615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718623">ns</span>&nbsp;<span class="op" id="6718626">:=</span>&nbsp;<span class="builtinfunc" id="6718629">new</span><span class="op" id="6718632">(</span><span class="ident" id="6718633">NewType0</span><span class="op" id="6718641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718645">err</span>&nbsp;<span class="op" id="6718649">=</span>&nbsp;<span class="ident" id="6718651">dec</span><span class="op" id="6718654">.</span><span class="ident" id="6718655">Decode</span><span class="op" id="6718661">(</span><span class="ident" id="6718662">ns</span><span class="op" id="6718664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718668">if</span>&nbsp;<span class="ident" id="6718671">err</span>&nbsp;<span class="op" id="6718675">!=</span>&nbsp;<span class="ident" id="6718678">nil</span>&nbsp;<span class="op" id="6718682">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718687">t</span><span class="op" id="6718688">.</span><span class="ident" id="6718689">Fatalf</span><span class="op" id="6718695">(</span><span class="string" id="6718696">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="6718727">,</span>&nbsp;<span class="ident" id="6718729">i</span><span class="op" id="6718730">,</span>&nbsp;<span class="ident" id="6718732">err</span><span class="op" id="6718735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6718743">if</span>&nbsp;<span class="ident" id="6718746">ns</span><span class="op" id="6718748">.</span><span class="ident" id="6718749">S</span>&nbsp;<span class="op" id="6718751">!=</span>&nbsp;<span class="ident" id="6718754">str</span>&nbsp;<span class="op" id="6718758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718763">t</span><span class="op" id="6718764">.</span><span class="ident" id="6718765">Fatalf</span><span class="op" id="6718771">(</span><span class="string" id="6718772">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6718796">,</span>&nbsp;<span class="ident" id="6718798">i</span><span class="op" id="6718799">,</span>&nbsp;<span class="ident" id="6718801">str</span><span class="op" id="6718804">,</span>&nbsp;<span class="ident" id="6718806">ns</span><span class="op" id="6718808">.</span><span class="ident" id="6718809">S</span><span class="op" id="6718810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718814">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6718817">}</span><br>
<span class="lineno"></span><span class="op" id="6718819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6718822">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="6718884">type</span>&nbsp;<span class="ident" id="6718889">Bug0Outer</span>&nbsp;<span class="keyword" id="6718899">struct</span>&nbsp;<span class="op" id="6718906">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718909">Bug0Field</span>&nbsp;<span class="keyword" id="6718919">interface</span><span class="op" id="6718928">{</span><span class="op" id="6718929">}</span><br>
<span class="lineno"></span><span class="op" id="6718931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6718934">type</span>&nbsp;<span class="ident" id="6718939">Bug0Inner</span>&nbsp;<span class="keyword" id="6718949">struct</span>&nbsp;<span class="op" id="6718956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6718959">A</span>&nbsp;<span class="builtintype" id="6718961">int</span><br>
<span class="lineno">555</span><span class="op" id="6718965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6718968">func</span>&nbsp;<span class="ident" id="6718973">TestNestedInterfaces</span><span class="op" id="6718993">(</span><span class="ident" id="6718994">t</span>&nbsp;<span class="op" id="6718996">*</span><span class="ident" id="6718997">testing</span><span class="op" id="6719004">.</span><span class="ident" id="6719005">T</span><span class="op" id="6719006">)</span>&nbsp;<span class="op" id="6719008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719011">var</span>&nbsp;<span class="ident" id="6719015">buf</span>&nbsp;<span class="ident" id="6719019">bytes</span><span class="op" id="6719024">.</span><span class="ident" id="6719025">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719033">e</span>&nbsp;<span class="op" id="6719035">:=</span>&nbsp;<span class="ident" id="6719038">NewEncoder</span><span class="op" id="6719048">(</span><span class="op" id="6719049">&amp;</span><span class="ident" id="6719050">buf</span><span class="op" id="6719053">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719056">d</span>&nbsp;<span class="op" id="6719058">:=</span>&nbsp;<span class="ident" id="6719061">NewDecoder</span><span class="op" id="6719071">(</span><span class="op" id="6719072">&amp;</span><span class="ident" id="6719073">buf</span><span class="op" id="6719076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719079">Register</span><span class="op" id="6719087">(</span><span class="builtinfunc" id="6719088">new</span><span class="op" id="6719091">(</span><span class="ident" id="6719092">Bug0Outer</span><span class="op" id="6719101">)</span><span class="op" id="6719102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719105">Register</span><span class="op" id="6719113">(</span><span class="builtinfunc" id="6719114">new</span><span class="op" id="6719117">(</span><span class="ident" id="6719118">Bug0Inner</span><span class="op" id="6719127">)</span><span class="op" id="6719128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719131">f</span>&nbsp;<span class="op" id="6719133">:=</span>&nbsp;<span class="op" id="6719136">&amp;</span><span class="ident" id="6719137">Bug0Outer</span><span class="op" id="6719146">{</span><span class="op" id="6719147">&amp;</span><span class="ident" id="6719148">Bug0Outer</span><span class="op" id="6719157">{</span><span class="op" id="6719158">&amp;</span><span class="ident" id="6719159">Bug0Inner</span><span class="op" id="6719168">{</span><span class="num" id="6719169">7</span><span class="op" id="6719170">}</span><span class="op" id="6719171">}</span><span class="op" id="6719172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719175">var</span>&nbsp;<span class="ident" id="6719179">v</span>&nbsp;<span class="keyword" id="6719181">interface</span><span class="op" id="6719190">{</span><span class="op" id="6719191">}</span>&nbsp;<span class="op" id="6719193">=</span>&nbsp;<span class="ident" id="6719195">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719198">err</span>&nbsp;<span class="op" id="6719202">:=</span>&nbsp;<span class="ident" id="6719205">e</span><span class="op" id="6719206">.</span><span class="ident" id="6719207">Encode</span><span class="op" id="6719213">(</span><span class="op" id="6719214">&amp;</span><span class="ident" id="6719215">v</span><span class="op" id="6719216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719219">if</span>&nbsp;<span class="ident" id="6719222">err</span>&nbsp;<span class="op" id="6719226">!=</span>&nbsp;<span class="ident" id="6719229">nil</span>&nbsp;<span class="op" id="6719233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719237">t</span><span class="op" id="6719238">.</span><span class="ident" id="6719239">Fatal</span><span class="op" id="6719244">(</span><span class="string" id="6719245">&#34;Encode:&#34;</span><span class="op" id="6719254">,</span>&nbsp;<span class="ident" id="6719256">err</span><span class="op" id="6719259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719265">err</span>&nbsp;<span class="op" id="6719269">=</span>&nbsp;<span class="ident" id="6719271">d</span><span class="op" id="6719272">.</span><span class="ident" id="6719273">Decode</span><span class="op" id="6719279">(</span><span class="op" id="6719280">&amp;</span><span class="ident" id="6719281">v</span><span class="op" id="6719282">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719285">if</span>&nbsp;<span class="ident" id="6719288">err</span>&nbsp;<span class="op" id="6719292">!=</span>&nbsp;<span class="ident" id="6719295">nil</span>&nbsp;<span class="op" id="6719299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719303">t</span><span class="op" id="6719304">.</span><span class="ident" id="6719305">Fatal</span><span class="op" id="6719310">(</span><span class="string" id="6719311">&#34;Decode:&#34;</span><span class="op" id="6719320">,</span>&nbsp;<span class="ident" id="6719322">err</span><span class="op" id="6719325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6719331">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719367">outer1</span><span class="op" id="6719373">,</span>&nbsp;<span class="ident" id="6719375">ok</span>&nbsp;<span class="op" id="6719378">:=</span>&nbsp;<span class="ident" id="6719381">v</span><span class="op" id="6719382">.</span><span class="op" id="6719383">(</span><span class="op" id="6719384">*</span><span class="ident" id="6719385">Bug0Outer</span><span class="op" id="6719394">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719397">if</span>&nbsp;<span class="op" id="6719400">!</span><span class="ident" id="6719401">ok</span>&nbsp;<span class="op" id="6719404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719408">t</span><span class="op" id="6719409">.</span><span class="ident" id="6719410">Fatalf</span><span class="op" id="6719416">(</span><span class="string" id="6719417">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="6719438">,</span>&nbsp;<span class="ident" id="6719440">v</span><span class="op" id="6719441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719447">outer2</span><span class="op" id="6719453">,</span>&nbsp;<span class="ident" id="6719455">ok</span>&nbsp;<span class="op" id="6719458">:=</span>&nbsp;<span class="ident" id="6719461">outer1</span><span class="op" id="6719467">.</span><span class="ident" id="6719468">Bug0Field</span><span class="op" id="6719477">.</span><span class="op" id="6719478">(</span><span class="op" id="6719479">*</span><span class="ident" id="6719480">Bug0Outer</span><span class="op" id="6719489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719492">if</span>&nbsp;<span class="op" id="6719495">!</span><span class="ident" id="6719496">ok</span>&nbsp;<span class="op" id="6719499">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719503">t</span><span class="op" id="6719504">.</span><span class="ident" id="6719505">Fatalf</span><span class="op" id="6719511">(</span><span class="string" id="6719512">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="6719543">,</span>&nbsp;<span class="ident" id="6719545">outer1</span><span class="op" id="6719551">.</span><span class="ident" id="6719552">Bug0Field</span><span class="op" id="6719561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719567">inner</span><span class="op" id="6719572">,</span>&nbsp;<span class="ident" id="6719574">ok</span>&nbsp;<span class="op" id="6719577">:=</span>&nbsp;<span class="ident" id="6719580">outer2</span><span class="op" id="6719586">.</span><span class="ident" id="6719587">Bug0Field</span><span class="op" id="6719596">.</span><span class="op" id="6719597">(</span><span class="op" id="6719598">*</span><span class="ident" id="6719599">Bug0Inner</span><span class="op" id="6719608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719611">if</span>&nbsp;<span class="op" id="6719614">!</span><span class="ident" id="6719615">ok</span>&nbsp;<span class="op" id="6719618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719622">t</span><span class="op" id="6719623">.</span><span class="ident" id="6719624">Fatalf</span><span class="op" id="6719630">(</span><span class="string" id="6719631">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="6719672">,</span>&nbsp;<span class="ident" id="6719674">outer2</span><span class="op" id="6719680">.</span><span class="ident" id="6719681">Bug0Field</span><span class="op" id="6719690">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719696">if</span>&nbsp;<span class="ident" id="6719699">inner</span><span class="op" id="6719704">.</span><span class="ident" id="6719705">A</span>&nbsp;<span class="op" id="6719707">!=</span>&nbsp;<span class="num" id="6719710">7</span>&nbsp;<span class="op" id="6719712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719716">t</span><span class="op" id="6719717">.</span><span class="ident" id="6719718">Fatalf</span><span class="op" id="6719724">(</span><span class="string" id="6719725">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="6719754">,</span>&nbsp;<span class="ident" id="6719756">inner</span><span class="op" id="6719761">.</span><span class="ident" id="6719762">A</span><span class="op" id="6719763">,</span>&nbsp;<span class="num" id="6719765">7</span><span class="op" id="6719766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6719769">}</span><br>
<span class="lineno"></span><span class="op" id="6719771">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="6719774">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6719847">type</span>&nbsp;<span class="ident" id="6719852">Bug1Elem</span>&nbsp;<span class="keyword" id="6719861">struct</span>&nbsp;<span class="op" id="6719868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719871">Name</span>&nbsp;<span class="builtintype" id="6719876">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6719884">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6719889">int</span><br>
<span class="lineno"></span><span class="op" id="6719893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6719896">type</span>&nbsp;<span class="ident" id="6719901">Bug1StructMap</span>&nbsp;<span class="keyword" id="6719915">map</span><span class="op" id="6719918">[</span><span class="builtintype" id="6719919">string</span><span class="op" id="6719925">]</span><span class="ident" id="6719926">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="6719936">func</span>&nbsp;<span class="ident" id="6719941">bug1EncDec</span><span class="op" id="6719951">(</span><span class="ident" id="6719952">in</span>&nbsp;<span class="ident" id="6719955">Bug1StructMap</span><span class="op" id="6719968">,</span>&nbsp;<span class="ident" id="6719970">out</span>&nbsp;<span class="op" id="6719974">*</span><span class="ident" id="6719975">Bug1StructMap</span><span class="op" id="6719988">)</span>&nbsp;<span class="builtintype" id="6719990">error</span>&nbsp;<span class="op" id="6719996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6719999">return</span>&nbsp;<span class="ident" id="6720006">nil</span><br>
<span class="lineno"></span><span class="op" id="6720010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6720013">func</span>&nbsp;<span class="ident" id="6720018">TestMapBug1</span><span class="op" id="6720029">(</span><span class="ident" id="6720030">t</span>&nbsp;<span class="op" id="6720032">*</span><span class="ident" id="6720033">testing</span><span class="op" id="6720040">.</span><span class="ident" id="6720041">T</span><span class="op" id="6720042">)</span>&nbsp;<span class="op" id="6720044">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720047">in</span>&nbsp;<span class="op" id="6720050">:=</span>&nbsp;<span class="builtinfunc" id="6720053">make</span><span class="op" id="6720057">(</span><span class="ident" id="6720058">Bug1StructMap</span><span class="op" id="6720071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720074">in</span><span class="op" id="6720076">[</span><span class="string" id="6720077">&#34;val1&#34;</span><span class="op" id="6720083">]</span>&nbsp;<span class="op" id="6720085">=</span>&nbsp;<span class="ident" id="6720087">Bug1Elem</span><span class="op" id="6720095">{</span><span class="string" id="6720096">&#34;elem1&#34;</span><span class="op" id="6720103">,</span>&nbsp;<span class="num" id="6720105">1</span><span class="op" id="6720106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720109">in</span><span class="op" id="6720111">[</span><span class="string" id="6720112">&#34;val2&#34;</span><span class="op" id="6720118">]</span>&nbsp;<span class="op" id="6720120">=</span>&nbsp;<span class="ident" id="6720122">Bug1Elem</span><span class="op" id="6720130">{</span><span class="string" id="6720131">&#34;elem2&#34;</span><span class="op" id="6720138">,</span>&nbsp;<span class="num" id="6720140">2</span><span class="op" id="6720141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720145">b</span>&nbsp;<span class="op" id="6720147">:=</span>&nbsp;<span class="builtinfunc" id="6720150">new</span><span class="op" id="6720153">(</span><span class="ident" id="6720154">bytes</span><span class="op" id="6720159">.</span><span class="ident" id="6720160">Buffer</span><span class="op" id="6720166">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720169">enc</span>&nbsp;<span class="op" id="6720173">:=</span>&nbsp;<span class="ident" id="6720176">NewEncoder</span><span class="op" id="6720186">(</span><span class="ident" id="6720187">b</span><span class="op" id="6720188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720191">err</span>&nbsp;<span class="op" id="6720195">:=</span>&nbsp;<span class="ident" id="6720198">enc</span><span class="op" id="6720201">.</span><span class="ident" id="6720202">Encode</span><span class="op" id="6720208">(</span><span class="ident" id="6720209">in</span><span class="op" id="6720211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720214">if</span>&nbsp;<span class="ident" id="6720217">err</span>&nbsp;<span class="op" id="6720221">!=</span>&nbsp;<span class="ident" id="6720224">nil</span>&nbsp;<span class="op" id="6720228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720232">t</span><span class="op" id="6720233">.</span><span class="ident" id="6720234">Fatal</span><span class="op" id="6720239">(</span><span class="string" id="6720240">&#34;encode:&#34;</span><span class="op" id="6720249">,</span>&nbsp;<span class="ident" id="6720251">err</span><span class="op" id="6720254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720257">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720260">dec</span>&nbsp;<span class="op" id="6720264">:=</span>&nbsp;<span class="ident" id="6720267">NewDecoder</span><span class="op" id="6720277">(</span><span class="ident" id="6720278">b</span><span class="op" id="6720279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720282">out</span>&nbsp;<span class="op" id="6720286">:=</span>&nbsp;<span class="builtinfunc" id="6720289">make</span><span class="op" id="6720293">(</span><span class="ident" id="6720294">Bug1StructMap</span><span class="op" id="6720307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720310">err</span>&nbsp;<span class="op" id="6720314">=</span>&nbsp;<span class="ident" id="6720316">dec</span><span class="op" id="6720319">.</span><span class="ident" id="6720320">Decode</span><span class="op" id="6720326">(</span><span class="op" id="6720327">&amp;</span><span class="ident" id="6720328">out</span><span class="op" id="6720331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720334">if</span>&nbsp;<span class="ident" id="6720337">err</span>&nbsp;<span class="op" id="6720341">!=</span>&nbsp;<span class="ident" id="6720344">nil</span>&nbsp;<span class="op" id="6720348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720352">t</span><span class="op" id="6720353">.</span><span class="ident" id="6720354">Fatal</span><span class="op" id="6720359">(</span><span class="string" id="6720360">&#34;decode:&#34;</span><span class="op" id="6720369">,</span>&nbsp;<span class="ident" id="6720371">err</span><span class="op" id="6720374">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6720380">if</span>&nbsp;<span class="op" id="6720383">!</span><span class="ident" id="6720384">reflect</span><span class="op" id="6720391">.</span><span class="ident" id="6720392">DeepEqual</span><span class="op" id="6720401">(</span><span class="ident" id="6720402">in</span><span class="op" id="6720404">,</span>&nbsp;<span class="ident" id="6720406">out</span><span class="op" id="6720409">)</span>&nbsp;<span class="op" id="6720411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720415">t</span><span class="op" id="6720416">.</span><span class="ident" id="6720417">Errorf</span><span class="op" id="6720423">(</span><span class="string" id="6720424">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="6720441">,</span>&nbsp;<span class="ident" id="6720443">in</span><span class="op" id="6720445">,</span>&nbsp;<span class="ident" id="6720447">out</span><span class="op" id="6720450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720453">}</span><br>
<span class="lineno"></span><span class="op" id="6720455">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="6720458">func</span>&nbsp;<span class="ident" id="6720463">TestGobMapInterfaceEncode</span><span class="op" id="6720488">(</span><span class="ident" id="6720489">t</span>&nbsp;<span class="op" id="6720491">*</span><span class="ident" id="6720492">testing</span><span class="op" id="6720499">.</span><span class="ident" id="6720500">T</span><span class="op" id="6720501">)</span>&nbsp;<span class="op" id="6720503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720506">m</span>&nbsp;<span class="op" id="6720508">:=</span>&nbsp;<span class="keyword" id="6720511">map</span><span class="op" id="6720514">[</span><span class="builtintype" id="6720515">string</span><span class="op" id="6720521">]</span><span class="keyword" id="6720522">interface</span><span class="op" id="6720531">{</span><span class="op" id="6720532">}</span><span class="op" id="6720533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720537">&#34;up&#34;</span><span class="op" id="6720541">:</span>&nbsp;<span class="builtintype" id="6720543">uintptr</span><span class="op" id="6720550">(</span><span class="num" id="6720551">0</span><span class="op" id="6720552">)</span><span class="op" id="6720553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720557">&#34;i0&#34;</span><span class="op" id="6720561">:</span>&nbsp;<span class="op" id="6720563">[</span><span class="op" id="6720564">]</span><span class="builtintype" id="6720565">int</span><span class="op" id="6720568">{</span><span class="op" id="6720569">-</span><span class="num" id="6720570">1</span><span class="op" id="6720571">}</span><span class="op" id="6720572">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720576">&#34;i1&#34;</span><span class="op" id="6720580">:</span>&nbsp;<span class="op" id="6720582">[</span><span class="op" id="6720583">]</span><span class="builtintype" id="6720584">int8</span><span class="op" id="6720588">{</span><span class="op" id="6720589">-</span><span class="num" id="6720590">1</span><span class="op" id="6720591">}</span><span class="op" id="6720592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720596">&#34;i2&#34;</span><span class="op" id="6720600">:</span>&nbsp;<span class="op" id="6720602">[</span><span class="op" id="6720603">]</span><span class="builtintype" id="6720604">int16</span><span class="op" id="6720609">{</span><span class="op" id="6720610">-</span><span class="num" id="6720611">1</span><span class="op" id="6720612">}</span><span class="op" id="6720613">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720617">&#34;i3&#34;</span><span class="op" id="6720621">:</span>&nbsp;<span class="op" id="6720623">[</span><span class="op" id="6720624">]</span><span class="builtintype" id="6720625">int32</span><span class="op" id="6720630">{</span><span class="op" id="6720631">-</span><span class="num" id="6720632">1</span><span class="op" id="6720633">}</span><span class="op" id="6720634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720638">&#34;i4&#34;</span><span class="op" id="6720642">:</span>&nbsp;<span class="op" id="6720644">[</span><span class="op" id="6720645">]</span><span class="ident" id="6720646">int64</span><span class="op" id="6720651">{</span><span class="op" id="6720652">-</span><span class="num" id="6720653">1</span><span class="op" id="6720654">}</span><span class="op" id="6720655">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720659">&#34;u0&#34;</span><span class="op" id="6720663">:</span>&nbsp;<span class="op" id="6720665">[</span><span class="op" id="6720666">]</span><span class="builtintype" id="6720667">uint</span><span class="op" id="6720671">{</span><span class="num" id="6720672">1</span><span class="op" id="6720673">}</span><span class="op" id="6720674">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720678">&#34;u1&#34;</span><span class="op" id="6720682">:</span>&nbsp;<span class="op" id="6720684">[</span><span class="op" id="6720685">]</span><span class="builtintype" id="6720686">uint8</span><span class="op" id="6720691">{</span><span class="num" id="6720692">1</span><span class="op" id="6720693">}</span><span class="op" id="6720694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720698">&#34;u2&#34;</span><span class="op" id="6720702">:</span>&nbsp;<span class="op" id="6720704">[</span><span class="op" id="6720705">]</span><span class="builtintype" id="6720706">uint16</span><span class="op" id="6720712">{</span><span class="num" id="6720713">1</span><span class="op" id="6720714">}</span><span class="op" id="6720715">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720719">&#34;u3&#34;</span><span class="op" id="6720723">:</span>&nbsp;<span class="op" id="6720725">[</span><span class="op" id="6720726">]</span><span class="builtintype" id="6720727">uint32</span><span class="op" id="6720733">{</span><span class="num" id="6720734">1</span><span class="op" id="6720735">}</span><span class="op" id="6720736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720740">&#34;u4&#34;</span><span class="op" id="6720744">:</span>&nbsp;<span class="op" id="6720746">[</span><span class="op" id="6720747">]</span><span class="ident" id="6720748">uint64</span><span class="op" id="6720754">{</span><span class="num" id="6720755">1</span><span class="op" id="6720756">}</span><span class="op" id="6720757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720761">&#34;f0&#34;</span><span class="op" id="6720765">:</span>&nbsp;<span class="op" id="6720767">[</span><span class="op" id="6720768">]</span><span class="builtintype" id="6720769">float32</span><span class="op" id="6720776">{</span><span class="num" id="6720777">1</span><span class="op" id="6720778">}</span><span class="op" id="6720779">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720783">&#34;f1&#34;</span><span class="op" id="6720787">:</span>&nbsp;<span class="op" id="6720789">[</span><span class="op" id="6720790">]</span><span class="builtintype" id="6720791">float64</span><span class="op" id="6720798">{</span><span class="num" id="6720799">1</span><span class="op" id="6720800">}</span><span class="op" id="6720801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720805">&#34;c0&#34;</span><span class="op" id="6720809">:</span>&nbsp;<span class="op" id="6720811">[</span><span class="op" id="6720812">]</span><span class="builtintype" id="6720813">complex64</span><span class="op" id="6720822">{</span><span class="builtinfunc" id="6720823">complex</span><span class="op" id="6720830">(</span><span class="num" id="6720831">2</span><span class="op" id="6720832">,</span>&nbsp;<span class="op" id="6720834">-</span><span class="num" id="6720835">2</span><span class="op" id="6720836">)</span><span class="op" id="6720837">}</span><span class="op" id="6720838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720842">&#34;c1&#34;</span><span class="op" id="6720846">:</span>&nbsp;<span class="op" id="6720848">[</span><span class="op" id="6720849">]</span><span class="builtintype" id="6720850">complex128</span><span class="op" id="6720860">{</span><span class="builtinfunc" id="6720861">complex</span><span class="op" id="6720868">(</span><span class="num" id="6720869">2</span><span class="op" id="6720870">,</span>&nbsp;<span class="builtintype" id="6720872">float64</span><span class="op" id="6720879">(</span><span class="op" id="6720880">-</span><span class="num" id="6720881">2</span><span class="op" id="6720882">)</span><span class="op" id="6720883">)</span><span class="op" id="6720884">}</span><span class="op" id="6720885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720889">&#34;us&#34;</span><span class="op" id="6720893">:</span>&nbsp;<span class="op" id="6720895">[</span><span class="op" id="6720896">]</span><span class="builtintype" id="6720897">uintptr</span><span class="op" id="6720904">{</span><span class="num" id="6720905">0</span><span class="op" id="6720906">}</span><span class="op" id="6720907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720911">&#34;bo&#34;</span><span class="op" id="6720915">:</span>&nbsp;<span class="op" id="6720917">[</span><span class="op" id="6720918">]</span><span class="builtintype" id="6720919">bool</span><span class="op" id="6720923">{</span><span class="builtintype" id="6720924">false</span><span class="op" id="6720929">}</span><span class="op" id="6720930">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6720934">&#34;st&#34;</span><span class="op" id="6720938">:</span>&nbsp;<span class="op" id="6720940">[</span><span class="op" id="6720941">]</span><span class="builtintype" id="6720942">string</span><span class="op" id="6720948">{</span><span class="string" id="6720949">&#34;s&#34;</span><span class="op" id="6720952">}</span><span class="op" id="6720953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6720956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720959">enc</span>&nbsp;<span class="op" id="6720963">:=</span>&nbsp;<span class="ident" id="6720966">NewEncoder</span><span class="op" id="6720976">(</span><span class="builtinfunc" id="6720977">new</span><span class="op" id="6720980">(</span><span class="ident" id="6720981">bytes</span><span class="op" id="6720986">.</span><span class="ident" id="6720987">Buffer</span><span class="op" id="6720993">)</span><span class="op" id="6720994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6720997">err</span>&nbsp;<span class="op" id="6721001">:=</span>&nbsp;<span class="ident" id="6721004">enc</span><span class="op" id="6721007">.</span><span class="ident" id="6721008">Encode</span><span class="op" id="6721014">(</span><span class="ident" id="6721015">m</span><span class="op" id="6721016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721019">if</span>&nbsp;<span class="ident" id="6721022">err</span>&nbsp;<span class="op" id="6721026">!=</span>&nbsp;<span class="ident" id="6721029">nil</span>&nbsp;<span class="op" id="6721033">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721037">t</span><span class="op" id="6721038">.</span><span class="ident" id="6721039">Errorf</span><span class="op" id="6721045">(</span><span class="string" id="6721046">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6721062">,</span>&nbsp;<span class="ident" id="6721064">err</span><span class="op" id="6721067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721070">}</span><br>
<span class="lineno"></span><span class="op" id="6721072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6721075">func</span>&nbsp;<span class="ident" id="6721080">TestSliceReusesMemory</span><span class="op" id="6721101">(</span><span class="ident" id="6721102">t</span>&nbsp;<span class="op" id="6721104">*</span><span class="ident" id="6721105">testing</span><span class="op" id="6721112">.</span><span class="ident" id="6721113">T</span><span class="op" id="6721114">)</span>&nbsp;<span class="op" id="6721116">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721119">buf</span>&nbsp;<span class="op" id="6721123">:=</span>&nbsp;<span class="builtinfunc" id="6721126">new</span><span class="op" id="6721129">(</span><span class="ident" id="6721130">bytes</span><span class="op" id="6721135">.</span><span class="ident" id="6721136">Buffer</span><span class="op" id="6721142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6721145">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721159">x</span>&nbsp;<span class="op" id="6721161">:=</span>&nbsp;<span class="op" id="6721164">[</span><span class="op" id="6721165">]</span><span class="builtintype" id="6721166">byte</span><span class="op" id="6721170">(</span><span class="string" id="6721171">&#34;abcd&#34;</span><span class="op" id="6721177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721181">enc</span>&nbsp;<span class="op" id="6721185">:=</span>&nbsp;<span class="ident" id="6721188">NewEncoder</span><span class="op" id="6721198">(</span><span class="ident" id="6721199">buf</span><span class="op" id="6721202">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721206">err</span>&nbsp;<span class="op" id="6721210">:=</span>&nbsp;<span class="ident" id="6721213">enc</span><span class="op" id="6721216">.</span><span class="ident" id="6721217">Encode</span><span class="op" id="6721223">(</span><span class="ident" id="6721224">x</span><span class="op" id="6721225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721229">if</span>&nbsp;<span class="ident" id="6721232">err</span>&nbsp;<span class="op" id="6721236">!=</span>&nbsp;<span class="ident" id="6721239">nil</span>&nbsp;<span class="op" id="6721243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721248">t</span><span class="op" id="6721249">.</span><span class="ident" id="6721250">Errorf</span><span class="op" id="6721256">(</span><span class="string" id="6721257">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="6721276">,</span>&nbsp;<span class="ident" id="6721278">err</span><span class="op" id="6721281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6721289">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721330">y</span>&nbsp;<span class="op" id="6721332">:=</span>&nbsp;<span class="op" id="6721335">[</span><span class="op" id="6721336">]</span><span class="builtintype" id="6721337">byte</span><span class="op" id="6721341">(</span><span class="string" id="6721342">&#34;ABCDE&#34;</span><span class="op" id="6721349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721353">addr</span>&nbsp;<span class="op" id="6721358">:=</span>&nbsp;<span class="op" id="6721361">&amp;</span><span class="ident" id="6721362">y</span><span class="op" id="6721363">[</span><span class="num" id="6721364">0</span><span class="op" id="6721365">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721369">dec</span>&nbsp;<span class="op" id="6721373">:=</span>&nbsp;<span class="ident" id="6721376">NewDecoder</span><span class="op" id="6721386">(</span><span class="ident" id="6721387">buf</span><span class="op" id="6721390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721394">err</span>&nbsp;<span class="op" id="6721398">=</span>&nbsp;<span class="ident" id="6721400">dec</span><span class="op" id="6721403">.</span><span class="ident" id="6721404">Decode</span><span class="op" id="6721410">(</span><span class="op" id="6721411">&amp;</span><span class="ident" id="6721412">y</span><span class="op" id="6721413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721417">if</span>&nbsp;<span class="ident" id="6721420">err</span>&nbsp;<span class="op" id="6721424">!=</span>&nbsp;<span class="ident" id="6721427">nil</span>&nbsp;<span class="op" id="6721431">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721436">t</span><span class="op" id="6721437">.</span><span class="ident" id="6721438">Fatal</span><span class="op" id="6721443">(</span><span class="string" id="6721444">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="6721460">,</span>&nbsp;<span class="ident" id="6721462">err</span><span class="op" id="6721465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721473">if</span>&nbsp;<span class="op" id="6721476">!</span><span class="ident" id="6721477">bytes</span><span class="op" id="6721482">.</span><span class="ident" id="6721483">Equal</span><span class="op" id="6721488">(</span><span class="ident" id="6721489">x</span><span class="op" id="6721490">,</span>&nbsp;<span class="ident" id="6721492">y</span><span class="op" id="6721493">)</span>&nbsp;<span class="op" id="6721495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721500">t</span><span class="op" id="6721501">.</span><span class="ident" id="6721502">Errorf</span><span class="op" id="6721508">(</span><span class="string" id="6721509">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="6721538">,</span>&nbsp;<span class="ident" id="6721540">x</span><span class="op" id="6721541">,</span>&nbsp;<span class="ident" id="6721543">y</span><span class="op" id="6721544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721548">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721552">if</span>&nbsp;<span class="ident" id="6721555">addr</span>&nbsp;<span class="op" id="6721560">!=</span>&nbsp;<span class="op" id="6721563">&amp;</span><span class="ident" id="6721564">y</span><span class="op" id="6721565">[</span><span class="num" id="6721566">0</span><span class="op" id="6721567">]</span>&nbsp;<span class="op" id="6721569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721574">t</span><span class="op" id="6721575">.</span><span class="ident" id="6721576">Errorf</span><span class="op" id="6721582">(</span><span class="string" id="6721583">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="6721616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6721626">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721648">x</span>&nbsp;<span class="op" id="6721650">:=</span>&nbsp;<span class="op" id="6721653">[</span><span class="op" id="6721654">]</span><span class="builtintype" id="6721655">rune</span><span class="op" id="6721659">(</span><span class="string" id="6721660">&#34;abcd&#34;</span><span class="op" id="6721666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721670">enc</span>&nbsp;<span class="op" id="6721674">:=</span>&nbsp;<span class="ident" id="6721677">NewEncoder</span><span class="op" id="6721687">(</span><span class="ident" id="6721688">buf</span><span class="op" id="6721691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721695">err</span>&nbsp;<span class="op" id="6721699">:=</span>&nbsp;<span class="ident" id="6721702">enc</span><span class="op" id="6721705">.</span><span class="ident" id="6721706">Encode</span><span class="op" id="6721712">(</span><span class="ident" id="6721713">x</span><span class="op" id="6721714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721718">if</span>&nbsp;<span class="ident" id="6721721">err</span>&nbsp;<span class="op" id="6721725">!=</span>&nbsp;<span class="ident" id="6721728">nil</span>&nbsp;<span class="op" id="6721732">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721737">t</span><span class="op" id="6721738">.</span><span class="ident" id="6721739">Errorf</span><span class="op" id="6721745">(</span><span class="string" id="6721746">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="6721764">,</span>&nbsp;<span class="ident" id="6721766">err</span><span class="op" id="6721769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6721777">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721818">y</span>&nbsp;<span class="op" id="6721820">:=</span>&nbsp;<span class="op" id="6721823">[</span><span class="op" id="6721824">]</span><span class="builtintype" id="6721825">rune</span><span class="op" id="6721829">(</span><span class="string" id="6721830">&#34;ABCDE&#34;</span><span class="op" id="6721837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721841">addr</span>&nbsp;<span class="op" id="6721846">:=</span>&nbsp;<span class="op" id="6721849">&amp;</span><span class="ident" id="6721850">y</span><span class="op" id="6721851">[</span><span class="num" id="6721852">0</span><span class="op" id="6721853">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721857">dec</span>&nbsp;<span class="op" id="6721861">:=</span>&nbsp;<span class="ident" id="6721864">NewDecoder</span><span class="op" id="6721874">(</span><span class="ident" id="6721875">buf</span><span class="op" id="6721878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721882">err</span>&nbsp;<span class="op" id="6721886">=</span>&nbsp;<span class="ident" id="6721888">dec</span><span class="op" id="6721891">.</span><span class="ident" id="6721892">Decode</span><span class="op" id="6721898">(</span><span class="op" id="6721899">&amp;</span><span class="ident" id="6721900">y</span><span class="op" id="6721901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721905">if</span>&nbsp;<span class="ident" id="6721908">err</span>&nbsp;<span class="op" id="6721912">!=</span>&nbsp;<span class="ident" id="6721915">nil</span>&nbsp;<span class="op" id="6721919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721924">t</span><span class="op" id="6721925">.</span><span class="ident" id="6721926">Fatal</span><span class="op" id="6721931">(</span><span class="string" id="6721932">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="6721947">,</span>&nbsp;<span class="ident" id="6721949">err</span><span class="op" id="6721952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6721956">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6721960">if</span>&nbsp;<span class="op" id="6721963">!</span><span class="ident" id="6721964">reflect</span><span class="op" id="6721971">.</span><span class="ident" id="6721972">DeepEqual</span><span class="op" id="6721981">(</span><span class="ident" id="6721982">x</span><span class="op" id="6721983">,</span>&nbsp;<span class="ident" id="6721985">y</span><span class="op" id="6721986">)</span>&nbsp;<span class="op" id="6721988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6721993">t</span><span class="op" id="6721994">.</span><span class="ident" id="6721995">Errorf</span><span class="op" id="6722001">(</span><span class="string" id="6722002">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="6722030">,</span>&nbsp;<span class="ident" id="6722032">x</span><span class="op" id="6722033">,</span>&nbsp;<span class="ident" id="6722035">y</span><span class="op" id="6722036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722044">if</span>&nbsp;<span class="ident" id="6722047">addr</span>&nbsp;<span class="op" id="6722052">!=</span>&nbsp;<span class="op" id="6722055">&amp;</span><span class="ident" id="6722056">y</span><span class="op" id="6722057">[</span><span class="num" id="6722058">0</span><span class="op" id="6722059">]</span>&nbsp;<span class="op" id="6722061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722066">t</span><span class="op" id="6722067">.</span><span class="ident" id="6722068">Errorf</span><span class="op" id="6722074">(</span><span class="string" id="6722075">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="6722107">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722114">}</span><br>
<span class="lineno"></span><span class="op" id="6722116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6722119">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="6722168">func</span>&nbsp;<span class="ident" id="6722173">TestBadCount</span><span class="op" id="6722185">(</span><span class="ident" id="6722186">t</span>&nbsp;<span class="op" id="6722188">*</span><span class="ident" id="6722189">testing</span><span class="op" id="6722196">.</span><span class="ident" id="6722197">T</span><span class="op" id="6722198">)</span>&nbsp;<span class="op" id="6722200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722203">b</span>&nbsp;<span class="op" id="6722205">:=</span>&nbsp;<span class="op" id="6722208">[</span><span class="op" id="6722209">]</span><span class="builtintype" id="6722210">byte</span><span class="op" id="6722214">{</span><span class="num" id="6722215">0xfb</span><span class="op" id="6722219">,</span>&nbsp;<span class="num" id="6722221">0xa5</span><span class="op" id="6722225">,</span>&nbsp;<span class="num" id="6722227">0x82</span><span class="op" id="6722231">,</span>&nbsp;<span class="num" id="6722233">0x2f</span><span class="op" id="6722237">,</span>&nbsp;<span class="num" id="6722239">0xca</span><span class="op" id="6722243">,</span>&nbsp;<span class="num" id="6722245">0x1</span><span class="op" id="6722248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722251">if</span>&nbsp;<span class="ident" id="6722254">err</span>&nbsp;<span class="op" id="6722258">:=</span>&nbsp;<span class="ident" id="6722261">NewDecoder</span><span class="op" id="6722271">(</span><span class="ident" id="6722272">bytes</span><span class="op" id="6722277">.</span><span class="ident" id="6722278">NewReader</span><span class="op" id="6722287">(</span><span class="ident" id="6722288">b</span><span class="op" id="6722289">)</span><span class="op" id="6722290">)</span><span class="op" id="6722291">.</span><span class="ident" id="6722292">Decode</span><span class="op" id="6722298">(</span><span class="ident" id="6722299">nil</span><span class="op" id="6722302">)</span><span class="op" id="6722303">;</span>&nbsp;<span class="ident" id="6722305">err</span>&nbsp;<span class="op" id="6722309">==</span>&nbsp;<span class="ident" id="6722312">nil</span>&nbsp;<span class="op" id="6722316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722320">t</span><span class="op" id="6722321">.</span><span class="ident" id="6722322">Error</span><span class="op" id="6722327">(</span><span class="string" id="6722328">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="6722359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722362">}</span>&nbsp;<span class="keyword" id="6722364">else</span>&nbsp;<span class="keyword" id="6722369">if</span>&nbsp;<span class="ident" id="6722372">err</span><span class="op" id="6722375">.</span><span class="ident" id="6722376">Error</span><span class="op" id="6722381">(</span><span class="op" id="6722382">)</span>&nbsp;<span class="op" id="6722384">!=</span>&nbsp;<span class="ident" id="6722387">errBadCount</span><span class="op" id="6722398">.</span><span class="ident" id="6722399">Error</span><span class="op" id="6722404">(</span><span class="op" id="6722405">)</span>&nbsp;<span class="op" id="6722407">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722411">t</span><span class="op" id="6722412">.</span><span class="ident" id="6722413">Error</span><span class="op" id="6722418">(</span><span class="string" id="6722419">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="6722450">,</span>&nbsp;<span class="ident" id="6722452">err</span><span class="op" id="6722455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722458">}</span><br>
<span class="lineno"></span><span class="op" id="6722460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6722463">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="6722527">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6722587">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6722622">func</span>&nbsp;<span class="ident" id="6722627">TestSequentialDecoder</span><span class="op" id="6722648">(</span><span class="ident" id="6722649">t</span>&nbsp;<span class="op" id="6722651">*</span><span class="ident" id="6722652">testing</span><span class="op" id="6722659">.</span><span class="ident" id="6722660">T</span><span class="op" id="6722661">)</span>&nbsp;<span class="op" id="6722663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722666">b</span>&nbsp;<span class="op" id="6722668">:=</span>&nbsp;<span class="builtinfunc" id="6722671">new</span><span class="op" id="6722674">(</span><span class="ident" id="6722675">bytes</span><span class="op" id="6722680">.</span><span class="ident" id="6722681">Buffer</span><span class="op" id="6722687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722690">enc</span>&nbsp;<span class="op" id="6722694">:=</span>&nbsp;<span class="ident" id="6722697">NewEncoder</span><span class="op" id="6722707">(</span><span class="ident" id="6722708">b</span><span class="op" id="6722709">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722712">const</span>&nbsp;<span class="ident" id="6722718">count</span>&nbsp;<span class="op" id="6722724">=</span>&nbsp;<span class="num" id="6722726">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722730">for</span>&nbsp;<span class="ident" id="6722734">i</span>&nbsp;<span class="op" id="6722736">:=</span>&nbsp;<span class="num" id="6722739">0</span><span class="op" id="6722740">;</span>&nbsp;<span class="ident" id="6722742">i</span>&nbsp;<span class="op" id="6722744">&lt;</span>&nbsp;<span class="ident" id="6722746">count</span><span class="op" id="6722751">;</span>&nbsp;<span class="ident" id="6722753">i</span><span class="op" id="6722754">++</span>&nbsp;<span class="op" id="6722757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722761">s</span>&nbsp;<span class="op" id="6722763">:=</span>&nbsp;<span class="ident" id="6722766">fmt</span><span class="op" id="6722769">.</span><span class="ident" id="6722770">Sprintf</span><span class="op" id="6722777">(</span><span class="string" id="6722778">&#34;%d&#34;</span><span class="op" id="6722782">,</span>&nbsp;<span class="ident" id="6722784">i</span><span class="op" id="6722785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722789">if</span>&nbsp;<span class="ident" id="6722792">err</span>&nbsp;<span class="op" id="6722796">:=</span>&nbsp;<span class="ident" id="6722799">enc</span><span class="op" id="6722802">.</span><span class="ident" id="6722803">Encode</span><span class="op" id="6722809">(</span><span class="ident" id="6722810">s</span><span class="op" id="6722811">)</span><span class="op" id="6722812">;</span>&nbsp;<span class="ident" id="6722814">err</span>&nbsp;<span class="op" id="6722818">!=</span>&nbsp;<span class="ident" id="6722821">nil</span>&nbsp;<span class="op" id="6722825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722830">t</span><span class="op" id="6722831">.</span><span class="ident" id="6722832">Error</span><span class="op" id="6722837">(</span><span class="string" id="6722838">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="6722853">,</span>&nbsp;<span class="ident" id="6722855">err</span><span class="op" id="6722858">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6722865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722868">for</span>&nbsp;<span class="ident" id="6722872">i</span>&nbsp;<span class="op" id="6722874">:=</span>&nbsp;<span class="num" id="6722877">0</span><span class="op" id="6722878">;</span>&nbsp;<span class="ident" id="6722880">i</span>&nbsp;<span class="op" id="6722882">&lt;</span>&nbsp;<span class="ident" id="6722884">count</span><span class="op" id="6722889">;</span>&nbsp;<span class="ident" id="6722891">i</span><span class="op" id="6722892">++</span>&nbsp;<span class="op" id="6722895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722899">dec</span>&nbsp;<span class="op" id="6722903">:=</span>&nbsp;<span class="ident" id="6722906">NewDecoder</span><span class="op" id="6722916">(</span><span class="ident" id="6722917">b</span><span class="op" id="6722918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722922">var</span>&nbsp;<span class="ident" id="6722926">s</span>&nbsp;<span class="builtintype" id="6722928">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6722937">if</span>&nbsp;<span class="ident" id="6722940">err</span>&nbsp;<span class="op" id="6722944">:=</span>&nbsp;<span class="ident" id="6722947">dec</span><span class="op" id="6722950">.</span><span class="ident" id="6722951">Decode</span><span class="op" id="6722957">(</span><span class="op" id="6722958">&amp;</span><span class="ident" id="6722959">s</span><span class="op" id="6722960">)</span><span class="op" id="6722961">;</span>&nbsp;<span class="ident" id="6722963">err</span>&nbsp;<span class="op" id="6722967">!=</span>&nbsp;<span class="ident" id="6722970">nil</span>&nbsp;<span class="op" id="6722974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6722979">t</span><span class="op" id="6722980">.</span><span class="ident" id="6722981">Fatal</span><span class="op" id="6722986">(</span><span class="string" id="6722987">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="6723002">,</span>&nbsp;<span class="ident" id="6723004">err</span><span class="op" id="6723007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723015">if</span>&nbsp;<span class="ident" id="6723018">s</span>&nbsp;<span class="op" id="6723020">!=</span>&nbsp;<span class="ident" id="6723023">fmt</span><span class="op" id="6723026">.</span><span class="ident" id="6723027">Sprintf</span><span class="op" id="6723034">(</span><span class="string" id="6723035">&#34;%d&#34;</span><span class="op" id="6723039">,</span>&nbsp;<span class="ident" id="6723041">i</span><span class="op" id="6723042">)</span>&nbsp;<span class="op" id="6723044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723049">t</span><span class="op" id="6723050">.</span><span class="ident" id="6723051">Fatalf</span><span class="op" id="6723057">(</span><span class="string" id="6723058">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6723085">,</span>&nbsp;<span class="ident" id="6723087">i</span><span class="op" id="6723088">,</span>&nbsp;<span class="ident" id="6723090">s</span><span class="op" id="6723091">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723098">}</span><br>
<span class="lineno"></span><span class="op" id="6723100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6723103">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="6723199">type</span>&nbsp;<span class="ident" id="6723204">Bug2</span>&nbsp;<span class="keyword" id="6723209">struct</span>&nbsp;<span class="op" id="6723216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723219">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6723223">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723228">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6723232">chan</span>&nbsp;<span class="builtintype" id="6723237">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723242">CP</span>&nbsp;&nbsp;<span class="op" id="6723246">*</span><span class="keyword" id="6723247">chan</span>&nbsp;<span class="builtintype" id="6723252">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723257">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6723261">func</span><span class="op" id="6723265">(</span><span class="op" id="6723266">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723269">FPP</span>&nbsp;<span class="op" id="6723273">*</span><span class="op" id="6723274">*</span><span class="keyword" id="6723275">func</span><span class="op" id="6723279">(</span><span class="op" id="6723280">)</span><br>
<span class="lineno"></span><span class="op" id="6723282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6723285">func</span>&nbsp;<span class="ident" id="6723290">TestChanFuncIgnored</span><span class="op" id="6723309">(</span><span class="ident" id="6723310">t</span>&nbsp;<span class="op" id="6723312">*</span><span class="ident" id="6723313">testing</span><span class="op" id="6723320">.</span><span class="ident" id="6723321">T</span><span class="op" id="6723322">)</span>&nbsp;<span class="op" id="6723324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723327">c</span>&nbsp;<span class="op" id="6723329">:=</span>&nbsp;<span class="builtinfunc" id="6723332">make</span><span class="op" id="6723336">(</span><span class="keyword" id="6723337">chan</span>&nbsp;<span class="builtintype" id="6723342">int</span><span class="op" id="6723345">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723348">f</span>&nbsp;<span class="op" id="6723350">:=</span>&nbsp;<span class="keyword" id="6723353">func</span><span class="op" id="6723357">(</span><span class="op" id="6723358">)</span>&nbsp;<span class="op" id="6723360">{</span><span class="op" id="6723361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723364">fp</span>&nbsp;<span class="op" id="6723367">:=</span>&nbsp;<span class="op" id="6723370">&amp;</span><span class="ident" id="6723371">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723374">b0</span>&nbsp;<span class="op" id="6723377">:=</span>&nbsp;<span class="ident" id="6723380">Bug2</span><span class="op" id="6723384">{</span><span class="num" id="6723385">23</span><span class="op" id="6723387">,</span>&nbsp;<span class="ident" id="6723389">c</span><span class="op" id="6723390">,</span>&nbsp;<span class="op" id="6723392">&amp;</span><span class="ident" id="6723393">c</span><span class="op" id="6723394">,</span>&nbsp;<span class="ident" id="6723396">f</span><span class="op" id="6723397">,</span>&nbsp;<span class="op" id="6723399">&amp;</span><span class="ident" id="6723400">fp</span><span class="op" id="6723402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723405">var</span>&nbsp;<span class="ident" id="6723409">buf</span>&nbsp;<span class="ident" id="6723413">bytes</span><span class="op" id="6723418">.</span><span class="ident" id="6723419">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723427">enc</span>&nbsp;<span class="op" id="6723431">:=</span>&nbsp;<span class="ident" id="6723434">NewEncoder</span><span class="op" id="6723444">(</span><span class="op" id="6723445">&amp;</span><span class="ident" id="6723446">buf</span><span class="op" id="6723449">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723452">if</span>&nbsp;<span class="ident" id="6723455">err</span>&nbsp;<span class="op" id="6723459">:=</span>&nbsp;<span class="ident" id="6723462">enc</span><span class="op" id="6723465">.</span><span class="ident" id="6723466">Encode</span><span class="op" id="6723472">(</span><span class="ident" id="6723473">b0</span><span class="op" id="6723475">)</span><span class="op" id="6723476">;</span>&nbsp;<span class="ident" id="6723478">err</span>&nbsp;<span class="op" id="6723482">!=</span>&nbsp;<span class="ident" id="6723485">nil</span>&nbsp;<span class="op" id="6723489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723493">t</span><span class="op" id="6723494">.</span><span class="ident" id="6723495">Fatal</span><span class="op" id="6723500">(</span><span class="string" id="6723501">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="6723518">,</span>&nbsp;<span class="ident" id="6723520">err</span><span class="op" id="6723523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723529">var</span>&nbsp;<span class="ident" id="6723533">b1</span>&nbsp;<span class="ident" id="6723536">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723542">err</span>&nbsp;<span class="op" id="6723546">:=</span>&nbsp;<span class="ident" id="6723549">NewDecoder</span><span class="op" id="6723559">(</span><span class="op" id="6723560">&amp;</span><span class="ident" id="6723561">buf</span><span class="op" id="6723564">)</span><span class="op" id="6723565">.</span><span class="ident" id="6723566">Decode</span><span class="op" id="6723572">(</span><span class="op" id="6723573">&amp;</span><span class="ident" id="6723574">b1</span><span class="op" id="6723576">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723579">if</span>&nbsp;<span class="ident" id="6723582">err</span>&nbsp;<span class="op" id="6723586">!=</span>&nbsp;<span class="ident" id="6723589">nil</span>&nbsp;<span class="op" id="6723593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723597">t</span><span class="op" id="6723598">.</span><span class="ident" id="6723599">Fatal</span><span class="op" id="6723604">(</span><span class="string" id="6723605">&#34;decode:&#34;</span><span class="op" id="6723614">,</span>&nbsp;<span class="ident" id="6723616">err</span><span class="op" id="6723619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723625">if</span>&nbsp;<span class="ident" id="6723628">b1</span><span class="op" id="6723630">.</span><span class="ident" id="6723631">A</span>&nbsp;<span class="op" id="6723633">!=</span>&nbsp;<span class="ident" id="6723636">b0</span><span class="op" id="6723638">.</span><span class="ident" id="6723639">A</span>&nbsp;<span class="op" id="6723641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723645">t</span><span class="op" id="6723646">.</span><span class="ident" id="6723647">Fatalf</span><span class="op" id="6723653">(</span><span class="string" id="6723654">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6723670">,</span>&nbsp;<span class="ident" id="6723672">b1</span><span class="op" id="6723674">.</span><span class="ident" id="6723675">A</span><span class="op" id="6723676">,</span>&nbsp;<span class="ident" id="6723678">b0</span><span class="op" id="6723680">.</span><span class="ident" id="6723681">A</span><span class="op" id="6723682">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723688">if</span>&nbsp;<span class="ident" id="6723691">b1</span><span class="op" id="6723693">.</span><span class="ident" id="6723694">C</span>&nbsp;<span class="op" id="6723696">!=</span>&nbsp;<span class="ident" id="6723699">nil</span>&nbsp;<span class="op" id="6723703">||</span>&nbsp;<span class="ident" id="6723706">b1</span><span class="op" id="6723708">.</span><span class="ident" id="6723709">CP</span>&nbsp;<span class="op" id="6723712">!=</span>&nbsp;<span class="ident" id="6723715">nil</span>&nbsp;<span class="op" id="6723719">||</span>&nbsp;<span class="ident" id="6723722">b1</span><span class="op" id="6723724">.</span><span class="ident" id="6723725">F</span>&nbsp;<span class="op" id="6723727">!=</span>&nbsp;<span class="ident" id="6723730">nil</span>&nbsp;<span class="op" id="6723734">||</span>&nbsp;<span class="ident" id="6723737">b1</span><span class="op" id="6723739">.</span><span class="ident" id="6723740">FPP</span>&nbsp;<span class="op" id="6723744">!=</span>&nbsp;<span class="ident" id="6723747">nil</span>&nbsp;<span class="op" id="6723751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723755">t</span><span class="op" id="6723756">.</span><span class="ident" id="6723757">Fatal</span><span class="op" id="6723762">(</span><span class="string" id="6723763">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="6723798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723801">}</span><br>
<span class="lineno"></span><span class="op" id="6723803">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="6723806">func</span>&nbsp;<span class="ident" id="6723811">TestSliceIncompatibility</span><span class="op" id="6723835">(</span><span class="ident" id="6723836">t</span>&nbsp;<span class="op" id="6723838">*</span><span class="ident" id="6723839">testing</span><span class="op" id="6723846">.</span><span class="ident" id="6723847">T</span><span class="op" id="6723848">)</span>&nbsp;<span class="op" id="6723850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723853">var</span>&nbsp;<span class="ident" id="6723857">in</span>&nbsp;<span class="op" id="6723860">=</span>&nbsp;<span class="op" id="6723862">[</span><span class="op" id="6723863">]</span><span class="builtintype" id="6723864">byte</span><span class="op" id="6723868">{</span><span class="num" id="6723869">1</span><span class="op" id="6723870">,</span>&nbsp;<span class="num" id="6723872">2</span><span class="op" id="6723873">,</span>&nbsp;<span class="num" id="6723875">3</span><span class="op" id="6723876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723879">var</span>&nbsp;<span class="ident" id="6723883">out</span>&nbsp;<span class="op" id="6723887">[</span><span class="op" id="6723888">]</span><span class="builtintype" id="6723889">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6723894">if</span>&nbsp;<span class="ident" id="6723897">err</span>&nbsp;<span class="op" id="6723901">:=</span>&nbsp;<span class="ident" id="6723904">encAndDec</span><span class="op" id="6723913">(</span><span class="ident" id="6723914">in</span><span class="op" id="6723916">,</span>&nbsp;<span class="op" id="6723918">&amp;</span><span class="ident" id="6723919">out</span><span class="op" id="6723922">)</span><span class="op" id="6723923">;</span>&nbsp;<span class="ident" id="6723925">err</span>&nbsp;<span class="op" id="6723929">==</span>&nbsp;<span class="ident" id="6723932">nil</span>&nbsp;<span class="op" id="6723936">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6723940">t</span><span class="op" id="6723941">.</span><span class="ident" id="6723942">Error</span><span class="op" id="6723947">(</span><span class="string" id="6723948">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="6723978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6723981">}</span><br>
<span class="lineno"></span><span class="op" id="6723983">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6723986">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="6724043">type</span>&nbsp;<span class="ident" id="6724048">Bug3</span>&nbsp;<span class="keyword" id="6724053">struct</span>&nbsp;<span class="op" id="6724060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724063">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6724072">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724077">Children</span>&nbsp;<span class="op" id="6724086">[</span><span class="op" id="6724087">]</span><span class="op" id="6724088">*</span><span class="ident" id="6724089">Bug3</span><br>
<span class="lineno"></span><span class="op" id="6724094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="6724097">func</span>&nbsp;<span class="ident" id="6724102">TestGobPtrSlices</span><span class="op" id="6724118">(</span><span class="ident" id="6724119">t</span>&nbsp;<span class="op" id="6724121">*</span><span class="ident" id="6724122">testing</span><span class="op" id="6724129">.</span><span class="ident" id="6724130">T</span><span class="op" id="6724131">)</span>&nbsp;<span class="op" id="6724133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724136">in</span>&nbsp;<span class="op" id="6724139">:=</span>&nbsp;<span class="op" id="6724142">[</span><span class="op" id="6724143">]</span><span class="op" id="6724144">*</span><span class="ident" id="6724145">Bug3</span><span class="op" id="6724149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724153">{</span><span class="num" id="6724154">1</span><span class="op" id="6724155">,</span>&nbsp;<span class="ident" id="6724157">nil</span><span class="op" id="6724160">}</span><span class="op" id="6724161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724165">{</span><span class="num" id="6724166">2</span><span class="op" id="6724167">,</span>&nbsp;<span class="ident" id="6724169">nil</span><span class="op" id="6724172">}</span><span class="op" id="6724173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724176">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724179">b</span>&nbsp;<span class="op" id="6724181">:=</span>&nbsp;<span class="builtinfunc" id="6724184">new</span><span class="op" id="6724187">(</span><span class="ident" id="6724188">bytes</span><span class="op" id="6724193">.</span><span class="ident" id="6724194">Buffer</span><span class="op" id="6724200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724203">err</span>&nbsp;<span class="op" id="6724207">:=</span>&nbsp;<span class="ident" id="6724210">NewEncoder</span><span class="op" id="6724220">(</span><span class="ident" id="6724221">b</span><span class="op" id="6724222">)</span><span class="op" id="6724223">.</span><span class="ident" id="6724224">Encode</span><span class="op" id="6724230">(</span><span class="op" id="6724231">&amp;</span><span class="ident" id="6724232">in</span><span class="op" id="6724234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724237">if</span>&nbsp;<span class="ident" id="6724240">err</span>&nbsp;<span class="op" id="6724244">!=</span>&nbsp;<span class="ident" id="6724247">nil</span>&nbsp;<span class="op" id="6724251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724255">t</span><span class="op" id="6724256">.</span><span class="ident" id="6724257">Fatal</span><span class="op" id="6724262">(</span><span class="string" id="6724263">&#34;encode:&#34;</span><span class="op" id="6724272">,</span>&nbsp;<span class="ident" id="6724274">err</span><span class="op" id="6724277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724280">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724284">var</span>&nbsp;<span class="ident" id="6724288">out</span>&nbsp;<span class="op" id="6724292">[</span><span class="op" id="6724293">]</span><span class="op" id="6724294">*</span><span class="ident" id="6724295">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724301">err</span>&nbsp;<span class="op" id="6724305">=</span>&nbsp;<span class="ident" id="6724307">NewDecoder</span><span class="op" id="6724317">(</span><span class="ident" id="6724318">b</span><span class="op" id="6724319">)</span><span class="op" id="6724320">.</span><span class="ident" id="6724321">Decode</span><span class="op" id="6724327">(</span><span class="op" id="6724328">&amp;</span><span class="ident" id="6724329">out</span><span class="op" id="6724332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724335">if</span>&nbsp;<span class="ident" id="6724338">err</span>&nbsp;<span class="op" id="6724342">!=</span>&nbsp;<span class="ident" id="6724345">nil</span>&nbsp;<span class="op" id="6724349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724353">t</span><span class="op" id="6724354">.</span><span class="ident" id="6724355">Fatal</span><span class="op" id="6724360">(</span><span class="string" id="6724361">&#34;decode:&#34;</span><span class="op" id="6724370">,</span>&nbsp;<span class="ident" id="6724372">err</span><span class="op" id="6724375">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724381">if</span>&nbsp;<span class="op" id="6724384">!</span><span class="ident" id="6724385">reflect</span><span class="op" id="6724392">.</span><span class="ident" id="6724393">DeepEqual</span><span class="op" id="6724402">(</span><span class="ident" id="6724403">in</span><span class="op" id="6724405">,</span>&nbsp;<span class="ident" id="6724407">out</span><span class="op" id="6724410">)</span>&nbsp;<span class="op" id="6724412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724416">t</span><span class="op" id="6724417">.</span><span class="ident" id="6724418">Fatalf</span><span class="op" id="6724424">(</span><span class="string" id="6724425">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="6724444">,</span>&nbsp;<span class="ident" id="6724446">out</span><span class="op" id="6724449">,</span>&nbsp;<span class="ident" id="6724451">in</span><span class="op" id="6724453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724456">}</span><br>
<span class="lineno"></span><span class="op" id="6724458">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="6724461">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="6724538">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="6724608">func</span>&nbsp;<span class="ident" id="6724613">TestPtrToMapOfMap</span><span class="op" id="6724630">(</span><span class="ident" id="6724631">t</span>&nbsp;<span class="op" id="6724633">*</span><span class="ident" id="6724634">testing</span><span class="op" id="6724641">.</span><span class="ident" id="6724642">T</span><span class="op" id="6724643">)</span>&nbsp;<span class="op" id="6724645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724648">Register</span><span class="op" id="6724656">(</span><span class="builtinfunc" id="6724657">make</span><span class="op" id="6724661">(</span><span class="keyword" id="6724662">map</span><span class="op" id="6724665">[</span><span class="builtintype" id="6724666">string</span><span class="op" id="6724672">]</span><span class="keyword" id="6724673">interface</span><span class="op" id="6724682">{</span><span class="op" id="6724683">}</span><span class="op" id="6724684">)</span><span class="op" id="6724685">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724688">subdata</span>&nbsp;<span class="op" id="6724696">:=</span>&nbsp;<span class="builtinfunc" id="6724699">make</span><span class="op" id="6724703">(</span><span class="keyword" id="6724704">map</span><span class="op" id="6724707">[</span><span class="builtintype" id="6724708">string</span><span class="op" id="6724714">]</span><span class="keyword" id="6724715">interface</span><span class="op" id="6724724">{</span><span class="op" id="6724725">}</span><span class="op" id="6724726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724729">subdata</span><span class="op" id="6724736">[</span><span class="string" id="6724737">&#34;bar&#34;</span><span class="op" id="6724742">]</span>&nbsp;<span class="op" id="6724744">=</span>&nbsp;<span class="string" id="6724746">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724753">data</span>&nbsp;<span class="op" id="6724758">:=</span>&nbsp;<span class="builtinfunc" id="6724761">make</span><span class="op" id="6724765">(</span><span class="keyword" id="6724766">map</span><span class="op" id="6724769">[</span><span class="builtintype" id="6724770">string</span><span class="op" id="6724776">]</span><span class="keyword" id="6724777">interface</span><span class="op" id="6724786">{</span><span class="op" id="6724787">}</span><span class="op" id="6724788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724791">data</span><span class="op" id="6724795">[</span><span class="string" id="6724796">&#34;foo&#34;</span><span class="op" id="6724801">]</span>&nbsp;<span class="op" id="6724803">=</span>&nbsp;<span class="ident" id="6724805">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724815">b</span>&nbsp;<span class="op" id="6724817">:=</span>&nbsp;<span class="builtinfunc" id="6724820">new</span><span class="op" id="6724823">(</span><span class="ident" id="6724824">bytes</span><span class="op" id="6724829">.</span><span class="ident" id="6724830">Buffer</span><span class="op" id="6724836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724839">err</span>&nbsp;<span class="op" id="6724843">:=</span>&nbsp;<span class="ident" id="6724846">NewEncoder</span><span class="op" id="6724856">(</span><span class="ident" id="6724857">b</span><span class="op" id="6724858">)</span><span class="op" id="6724859">.</span><span class="ident" id="6724860">Encode</span><span class="op" id="6724866">(</span><span class="ident" id="6724867">data</span><span class="op" id="6724871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724874">if</span>&nbsp;<span class="ident" id="6724877">err</span>&nbsp;<span class="op" id="6724881">!=</span>&nbsp;<span class="ident" id="6724884">nil</span>&nbsp;<span class="op" id="6724888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724892">t</span><span class="op" id="6724893">.</span><span class="ident" id="6724894">Fatal</span><span class="op" id="6724899">(</span><span class="string" id="6724900">&#34;encode:&#34;</span><span class="op" id="6724909">,</span>&nbsp;<span class="ident" id="6724911">err</span><span class="op" id="6724914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6724917">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724920">var</span>&nbsp;<span class="ident" id="6724924">newData</span>&nbsp;<span class="keyword" id="6724932">map</span><span class="op" id="6724935">[</span><span class="builtintype" id="6724936">string</span><span class="op" id="6724942">]</span><span class="keyword" id="6724943">interface</span><span class="op" id="6724952">{</span><span class="op" id="6724953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6724956">err</span>&nbsp;<span class="op" id="6724960">=</span>&nbsp;<span class="ident" id="6724962">NewDecoder</span><span class="op" id="6724972">(</span><span class="ident" id="6724973">b</span><span class="op" id="6724974">)</span><span class="op" id="6724975">.</span><span class="ident" id="6724976">Decode</span><span class="op" id="6724982">(</span><span class="op" id="6724983">&amp;</span><span class="ident" id="6724984">newData</span><span class="op" id="6724991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6724994">if</span>&nbsp;<span class="ident" id="6724997">err</span>&nbsp;<span class="op" id="6725001">!=</span>&nbsp;<span class="ident" id="6725004">nil</span>&nbsp;<span class="op" id="6725008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725012">t</span><span class="op" id="6725013">.</span><span class="ident" id="6725014">Fatal</span><span class="op" id="6725019">(</span><span class="string" id="6725020">&#34;decode:&#34;</span><span class="op" id="6725029">,</span>&nbsp;<span class="ident" id="6725031">err</span><span class="op" id="6725034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725037">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725040">if</span>&nbsp;<span class="op" id="6725043">!</span><span class="ident" id="6725044">reflect</span><span class="op" id="6725051">.</span><span class="ident" id="6725052">DeepEqual</span><span class="op" id="6725061">(</span><span class="ident" id="6725062">data</span><span class="op" id="6725066">,</span>&nbsp;<span class="ident" id="6725068">newData</span><span class="op" id="6725075">)</span>&nbsp;<span class="op" id="6725077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725081">t</span><span class="op" id="6725082">.</span><span class="ident" id="6725083">Fatalf</span><span class="op" id="6725089">(</span><span class="string" id="6725090">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6725110">,</span>&nbsp;<span class="ident" id="6725112">data</span><span class="op" id="6725116">,</span>&nbsp;<span class="ident" id="6725118">newData</span><span class="op" id="6725125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725128">}</span><br>
<span class="lineno"></span><span class="op" id="6725130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="6725133">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="6725216">func</span>&nbsp;<span class="ident" id="6725221">TestTopLevelNilPointer</span><span class="op" id="6725243">(</span><span class="ident" id="6725244">t</span>&nbsp;<span class="op" id="6725246">*</span><span class="ident" id="6725247">testing</span><span class="op" id="6725254">.</span><span class="ident" id="6725255">T</span><span class="op" id="6725256">)</span>&nbsp;<span class="op" id="6725258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725261">errMsg</span>&nbsp;<span class="op" id="6725268">:=</span>&nbsp;<span class="ident" id="6725271">topLevelNilPanic</span><span class="op" id="6725287">(</span><span class="ident" id="6725288">t</span><span class="op" id="6725289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725292">if</span>&nbsp;<span class="ident" id="6725295">errMsg</span>&nbsp;<span class="op" id="6725302">==</span>&nbsp;<span class="string" id="6725305">&#34;&#34;</span>&nbsp;<span class="op" id="6725308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725312">t</span><span class="op" id="6725313">.</span><span class="ident" id="6725314">Fatal</span><span class="op" id="6725319">(</span><span class="string" id="6725320">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="6725357">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725363">if</span>&nbsp;<span class="op" id="6725366">!</span><span class="ident" id="6725367">strings</span><span class="op" id="6725374">.</span><span class="ident" id="6725375">Contains</span><span class="op" id="6725383">(</span><span class="ident" id="6725384">errMsg</span><span class="op" id="6725390">,</span>&nbsp;<span class="string" id="6725392">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="6725405">)</span>&nbsp;<span class="op" id="6725407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725411">t</span><span class="op" id="6725412">.</span><span class="ident" id="6725413">Fatal</span><span class="op" id="6725418">(</span><span class="string" id="6725419">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="6725453">,</span>&nbsp;<span class="ident" id="6725455">errMsg</span><span class="op" id="6725461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725464">}</span><br>
<span class="lineno"></span><span class="op" id="6725466">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="6725469">func</span>&nbsp;<span class="ident" id="6725474">topLevelNilPanic</span><span class="op" id="6725490">(</span><span class="ident" id="6725491">t</span>&nbsp;<span class="op" id="6725493">*</span><span class="ident" id="6725494">testing</span><span class="op" id="6725501">.</span><span class="ident" id="6725502">T</span><span class="op" id="6725503">)</span>&nbsp;<span class="op" id="6725505">(</span><span class="ident" id="6725506">panicErr</span>&nbsp;<span class="builtintype" id="6725515">string</span><span class="op" id="6725521">)</span>&nbsp;<span class="op" id="6725523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725526">defer</span>&nbsp;<span class="keyword" id="6725532">func</span><span class="op" id="6725536">(</span><span class="op" id="6725537">)</span>&nbsp;<span class="op" id="6725539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725543">e</span>&nbsp;<span class="op" id="6725545">:=</span>&nbsp;<span class="builtinfunc" id="6725548">recover</span><span class="op" id="6725555">(</span><span class="op" id="6725556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725560">if</span>&nbsp;<span class="ident" id="6725563">err</span><span class="op" id="6725566">,</span>&nbsp;<span class="ident" id="6725568">ok</span>&nbsp;<span class="op" id="6725571">:=</span>&nbsp;<span class="ident" id="6725574">e</span><span class="op" id="6725575">.</span><span class="op" id="6725576">(</span><span class="builtintype" id="6725577">string</span><span class="op" id="6725583">)</span><span class="op" id="6725584">;</span>&nbsp;<span class="ident" id="6725586">ok</span>&nbsp;<span class="op" id="6725589">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725594">panicErr</span>&nbsp;<span class="op" id="6725603">=</span>&nbsp;<span class="ident" id="6725605">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725614">}</span><span class="op" id="6725615">(</span><span class="op" id="6725616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725619">var</span>&nbsp;<span class="ident" id="6725623">ip</span>&nbsp;<span class="op" id="6725626">*</span><span class="builtintype" id="6725627">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725632">buf</span>&nbsp;<span class="op" id="6725636">:=</span>&nbsp;<span class="builtinfunc" id="6725639">new</span><span class="op" id="6725642">(</span><span class="ident" id="6725643">bytes</span><span class="op" id="6725648">.</span><span class="ident" id="6725649">Buffer</span><span class="op" id="6725655">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725658">if</span>&nbsp;<span class="ident" id="6725661">err</span>&nbsp;<span class="op" id="6725665">:=</span>&nbsp;<span class="ident" id="6725668">NewEncoder</span><span class="op" id="6725678">(</span><span class="ident" id="6725679">buf</span><span class="op" id="6725682">)</span><span class="op" id="6725683">.</span><span class="ident" id="6725684">Encode</span><span class="op" id="6725690">(</span><span class="ident" id="6725691">ip</span><span class="op" id="6725693">)</span><span class="op" id="6725694">;</span>&nbsp;<span class="ident" id="6725696">err</span>&nbsp;<span class="op" id="6725700">!=</span>&nbsp;<span class="ident" id="6725703">nil</span>&nbsp;<span class="op" id="6725707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725711">t</span><span class="op" id="6725712">.</span><span class="ident" id="6725713">Fatal</span><span class="op" id="6725718">(</span><span class="string" id="6725719">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="6725737">,</span>&nbsp;<span class="ident" id="6725739">err</span><span class="op" id="6725742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725748">return</span><br>
<span class="lineno"></span><span class="op" id="6725755">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="6725758">func</span>&nbsp;<span class="ident" id="6725763">TestNilPointerInsideInterface</span><span class="op" id="6725792">(</span><span class="ident" id="6725793">t</span>&nbsp;<span class="op" id="6725795">*</span><span class="ident" id="6725796">testing</span><span class="op" id="6725803">.</span><span class="ident" id="6725804">T</span><span class="op" id="6725805">)</span>&nbsp;<span class="op" id="6725807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725810">var</span>&nbsp;<span class="ident" id="6725814">ip</span>&nbsp;<span class="op" id="6725817">*</span><span class="builtintype" id="6725818">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725823">si</span>&nbsp;<span class="op" id="6725826">:=</span>&nbsp;<span class="keyword" id="6725829">struct</span>&nbsp;<span class="op" id="6725836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725840">I</span>&nbsp;<span class="keyword" id="6725842">interface</span><span class="op" id="6725851">{</span><span class="op" id="6725852">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725855">}</span><span class="op" id="6725856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725860">I</span><span class="op" id="6725861">:</span>&nbsp;<span class="ident" id="6725863">ip</span><span class="op" id="6725865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725871">buf</span>&nbsp;<span class="op" id="6725875">:=</span>&nbsp;<span class="builtinfunc" id="6725878">new</span><span class="op" id="6725881">(</span><span class="ident" id="6725882">bytes</span><span class="op" id="6725887">.</span><span class="ident" id="6725888">Buffer</span><span class="op" id="6725894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725897">err</span>&nbsp;<span class="op" id="6725901">:=</span>&nbsp;<span class="ident" id="6725904">NewEncoder</span><span class="op" id="6725914">(</span><span class="ident" id="6725915">buf</span><span class="op" id="6725918">)</span><span class="op" id="6725919">.</span><span class="ident" id="6725920">Encode</span><span class="op" id="6725926">(</span><span class="ident" id="6725927">si</span><span class="op" id="6725929">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6725932">if</span>&nbsp;<span class="ident" id="6725935">err</span>&nbsp;<span class="op" id="6725939">==</span>&nbsp;<span class="ident" id="6725942">nil</span>&nbsp;<span class="op" id="6725946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725950">t</span><span class="op" id="6725951">.</span><span class="ident" id="6725952">Fatal</span><span class="op" id="6725957">(</span><span class="string" id="6725958">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="6725984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6725987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6725990">errMsg</span>&nbsp;<span class="op" id="6725997">:=</span>&nbsp;<span class="ident" id="6726000">err</span><span class="op" id="6726003">.</span><span class="ident" id="6726004">Error</span><span class="op" id="6726009">(</span><span class="op" id="6726010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726013">if</span>&nbsp;<span class="op" id="6726016">!</span><span class="ident" id="6726017">strings</span><span class="op" id="6726024">.</span><span class="ident" id="6726025">Contains</span><span class="op" id="6726033">(</span><span class="ident" id="6726034">errMsg</span><span class="op" id="6726040">,</span>&nbsp;<span class="string" id="6726042">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="6726055">)</span>&nbsp;<span class="op" id="6726057">||</span>&nbsp;<span class="op" id="6726060">!</span><span class="ident" id="6726061">strings</span><span class="op" id="6726068">.</span><span class="ident" id="6726069">Contains</span><span class="op" id="6726077">(</span><span class="ident" id="6726078">errMsg</span><span class="op" id="6726084">,</span>&nbsp;<span class="string" id="6726086">&#34;interface&#34;</span><span class="op" id="6726097">)</span>&nbsp;<span class="op" id="6726099">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726103">t</span><span class="op" id="6726104">.</span><span class="ident" id="6726105">Fatal</span><span class="op" id="6726110">(</span><span class="string" id="6726111">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="6726165">,</span>&nbsp;<span class="ident" id="6726167">errMsg</span><span class="op" id="6726173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726176">}</span><br>
<span class="lineno"></span><span class="op" id="6726178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6726181">type</span>&nbsp;<span class="ident" id="6726186">Bug4Public</span>&nbsp;<span class="keyword" id="6726197">struct</span>&nbsp;<span class="op" id="6726204">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726207">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6726214">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726222">Secret</span>&nbsp;<span class="ident" id="6726229">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="6726240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6726243">type</span>&nbsp;<span class="ident" id="6726248">Bug4Secret</span>&nbsp;<span class="keyword" id="6726259">struct</span>&nbsp;<span class="op" id="6726266">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726269">a</span>&nbsp;<span class="builtintype" id="6726271">int</span>&nbsp;<span class="comment" id="6726275">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="6726305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6726308">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6726386">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="6726401">func</span>&nbsp;<span class="ident" id="6726406">TestMutipleEncodingsOfBadType</span><span class="op" id="6726435">(</span><span class="ident" id="6726436">t</span>&nbsp;<span class="op" id="6726438">*</span><span class="ident" id="6726439">testing</span><span class="op" id="6726446">.</span><span class="ident" id="6726447">T</span><span class="op" id="6726448">)</span>&nbsp;<span class="op" id="6726450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726453">x</span>&nbsp;<span class="op" id="6726455">:=</span>&nbsp;<span class="ident" id="6726458">Bug4Public</span><span class="op" id="6726468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726472">Name</span><span class="op" id="6726476">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6726480">&#34;name&#34;</span><span class="op" id="6726486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726490">Secret</span><span class="op" id="6726496">:</span>&nbsp;<span class="ident" id="6726498">Bug4Secret</span><span class="op" id="6726508">{</span><span class="num" id="6726509">1</span><span class="op" id="6726510">}</span><span class="op" id="6726511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726514">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726517">buf</span>&nbsp;<span class="op" id="6726521">:=</span>&nbsp;<span class="builtinfunc" id="6726524">new</span><span class="op" id="6726527">(</span><span class="ident" id="6726528">bytes</span><span class="op" id="6726533">.</span><span class="ident" id="6726534">Buffer</span><span class="op" id="6726540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726543">enc</span>&nbsp;<span class="op" id="6726547">:=</span>&nbsp;<span class="ident" id="6726550">NewEncoder</span><span class="op" id="6726560">(</span><span class="ident" id="6726561">buf</span><span class="op" id="6726564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726567">err</span>&nbsp;<span class="op" id="6726571">:=</span>&nbsp;<span class="ident" id="6726574">enc</span><span class="op" id="6726577">.</span><span class="ident" id="6726578">Encode</span><span class="op" id="6726584">(</span><span class="ident" id="6726585">x</span><span class="op" id="6726586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726589">if</span>&nbsp;<span class="ident" id="6726592">err</span>&nbsp;<span class="op" id="6726596">==</span>&nbsp;<span class="ident" id="6726599">nil</span>&nbsp;<span class="op" id="6726603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726607">t</span><span class="op" id="6726608">.</span><span class="ident" id="6726609">Fatal</span><span class="op" id="6726614">(</span><span class="string" id="6726615">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6726647">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726653">buf</span><span class="op" id="6726656">.</span><span class="ident" id="6726657">Reset</span><span class="op" id="6726662">(</span><span class="op" id="6726663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726666">enc</span>&nbsp;<span class="op" id="6726670">=</span>&nbsp;<span class="ident" id="6726672">NewEncoder</span><span class="op" id="6726682">(</span><span class="ident" id="6726683">buf</span><span class="op" id="6726686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726689">err</span>&nbsp;<span class="op" id="6726693">=</span>&nbsp;<span class="ident" id="6726695">enc</span><span class="op" id="6726698">.</span><span class="ident" id="6726699">Encode</span><span class="op" id="6726705">(</span><span class="ident" id="6726706">x</span><span class="op" id="6726707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726710">if</span>&nbsp;<span class="ident" id="6726713">err</span>&nbsp;<span class="op" id="6726717">==</span>&nbsp;<span class="ident" id="6726720">nil</span>&nbsp;<span class="op" id="6726724">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726728">t</span><span class="op" id="6726729">.</span><span class="ident" id="6726730">Fatal</span><span class="op" id="6726735">(</span><span class="string" id="6726736">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="6726769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6726775">if</span>&nbsp;<span class="op" id="6726778">!</span><span class="ident" id="6726779">strings</span><span class="op" id="6726786">.</span><span class="ident" id="6726787">Contains</span><span class="op" id="6726795">(</span><span class="ident" id="6726796">err</span><span class="op" id="6726799">.</span><span class="ident" id="6726800">Error</span><span class="op" id="6726805">(</span><span class="op" id="6726806">)</span><span class="op" id="6726807">,</span>&nbsp;<span class="string" id="6726809">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="6726829">)</span>&nbsp;<span class="op" id="6726831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6726835">t</span><span class="op" id="6726836">.</span><span class="ident" id="6726837">Errorf</span><span class="op" id="6726843">(</span><span class="string" id="6726844">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6726893">,</span>&nbsp;<span class="ident" id="6726895">err</span><span class="op" id="6726898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6726901">}</span><br>
<span class="lineno">905</span><span class="op" id="6726903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6726906">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6726977">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="6727045">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="6727115">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6727185">type</span>&nbsp;<span class="ident" id="6727190">Z</span>&nbsp;<span class="keyword" id="6727192">struct</span>&nbsp;<span class="op" id="6727199">{</span><br>
<span class="lineno"></span><span class="op" id="6727201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="6727204">func</span>&nbsp;<span class="ident" id="6727209">Test29ElementSlice</span><span class="op" id="6727227">(</span><span class="ident" id="6727228">t</span>&nbsp;<span class="op" id="6727230">*</span><span class="ident" id="6727231">testing</span><span class="op" id="6727238">.</span><span class="ident" id="6727239">T</span><span class="op" id="6727240">)</span>&nbsp;<span class="op" id="6727242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727245">Register</span><span class="op" id="6727253">(</span><span class="ident" id="6727254">Z</span><span class="op" id="6727255">{</span><span class="op" id="6727256">}</span><span class="op" id="6727257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727260">src</span>&nbsp;<span class="op" id="6727264">:=</span>&nbsp;<span class="builtinfunc" id="6727267">make</span><span class="op" id="6727271">(</span><span class="op" id="6727272">[</span><span class="op" id="6727273">]</span><span class="keyword" id="6727274">interface</span><span class="op" id="6727283">{</span><span class="op" id="6727284">}</span><span class="op" id="6727285">,</span>&nbsp;<span class="num" id="6727287">100</span><span class="op" id="6727290">)</span>&nbsp;<span class="comment" id="6727292">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727350">for</span>&nbsp;<span class="ident" id="6727354">i</span>&nbsp;<span class="op" id="6727356">:=</span>&nbsp;<span class="keyword" id="6727359">range</span>&nbsp;<span class="ident" id="6727365">src</span>&nbsp;<span class="op" id="6727369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727373">src</span><span class="op" id="6727376">[</span><span class="ident" id="6727377">i</span><span class="op" id="6727378">]</span>&nbsp;<span class="op" id="6727380">=</span>&nbsp;<span class="ident" id="6727382">Z</span><span class="op" id="6727383">{</span><span class="op" id="6727384">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727390">buf</span>&nbsp;<span class="op" id="6727394">:=</span>&nbsp;<span class="builtinfunc" id="6727397">new</span><span class="op" id="6727400">(</span><span class="ident" id="6727401">bytes</span><span class="op" id="6727406">.</span><span class="ident" id="6727407">Buffer</span><span class="op" id="6727413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727416">err</span>&nbsp;<span class="op" id="6727420">:=</span>&nbsp;<span class="ident" id="6727423">NewEncoder</span><span class="op" id="6727433">(</span><span class="ident" id="6727434">buf</span><span class="op" id="6727437">)</span><span class="op" id="6727438">.</span><span class="ident" id="6727439">Encode</span><span class="op" id="6727445">(</span><span class="ident" id="6727446">src</span><span class="op" id="6727449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727452">if</span>&nbsp;<span class="ident" id="6727455">err</span>&nbsp;<span class="op" id="6727459">!=</span>&nbsp;<span class="ident" id="6727462">nil</span>&nbsp;<span class="op" id="6727466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727470">t</span><span class="op" id="6727471">.</span><span class="ident" id="6727472">Fatalf</span><span class="op" id="6727478">(</span><span class="string" id="6727479">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="6727491">,</span>&nbsp;<span class="ident" id="6727493">err</span><span class="op" id="6727496">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727500">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727512">var</span>&nbsp;<span class="ident" id="6727516">dst</span>&nbsp;<span class="op" id="6727520">[</span><span class="op" id="6727521">]</span><span class="keyword" id="6727522">interface</span><span class="op" id="6727531">{</span><span class="op" id="6727532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727535">err</span>&nbsp;<span class="op" id="6727539">=</span>&nbsp;<span class="ident" id="6727541">NewDecoder</span><span class="op" id="6727551">(</span><span class="ident" id="6727552">buf</span><span class="op" id="6727555">)</span><span class="op" id="6727556">.</span><span class="ident" id="6727557">Decode</span><span class="op" id="6727563">(</span><span class="op" id="6727564">&amp;</span><span class="ident" id="6727565">dst</span><span class="op" id="6727568">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727571">if</span>&nbsp;<span class="ident" id="6727574">err</span>&nbsp;<span class="op" id="6727578">!=</span>&nbsp;<span class="ident" id="6727581">nil</span>&nbsp;<span class="op" id="6727585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727589">t</span><span class="op" id="6727590">.</span><span class="ident" id="6727591">Errorf</span><span class="op" id="6727597">(</span><span class="string" id="6727598">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="6727610">,</span>&nbsp;<span class="ident" id="6727612">err</span><span class="op" id="6727615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727619">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727627">}</span><br>
<span class="lineno"></span><span class="op" id="6727629">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="6727632">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="6727694">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="6727709">func</span>&nbsp;<span class="ident" id="6727714">TestErrorForHugeSlice</span><span class="op" id="6727735">(</span><span class="ident" id="6727736">t</span>&nbsp;<span class="op" id="6727738">*</span><span class="ident" id="6727739">testing</span><span class="op" id="6727746">.</span><span class="ident" id="6727747">T</span><span class="op" id="6727748">)</span>&nbsp;<span class="op" id="6727750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6727753">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727778">buf</span>&nbsp;<span class="op" id="6727782">:=</span>&nbsp;<span class="builtinfunc" id="6727785">new</span><span class="op" id="6727788">(</span><span class="ident" id="6727789">bytes</span><span class="op" id="6727794">.</span><span class="ident" id="6727795">Buffer</span><span class="op" id="6727801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727804">slice</span>&nbsp;<span class="op" id="6727810">:=</span>&nbsp;<span class="op" id="6727813">[</span><span class="op" id="6727814">]</span><span class="builtintype" id="6727815">int</span><span class="op" id="6727818">{</span><span class="num" id="6727819">1</span><span class="op" id="6727820">,</span>&nbsp;<span class="num" id="6727822">1</span><span class="op" id="6727823">,</span>&nbsp;<span class="num" id="6727825">1</span><span class="op" id="6727826">,</span>&nbsp;<span class="num" id="6727828">1</span><span class="op" id="6727829">,</span>&nbsp;<span class="num" id="6727831">1</span><span class="op" id="6727832">,</span>&nbsp;<span class="num" id="6727834">1</span><span class="op" id="6727835">,</span>&nbsp;<span class="num" id="6727837">1</span><span class="op" id="6727838">,</span>&nbsp;<span class="num" id="6727840">1</span><span class="op" id="6727841">,</span>&nbsp;<span class="num" id="6727843">1</span><span class="op" id="6727844">,</span>&nbsp;<span class="num" id="6727846">1</span><span class="op" id="6727847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727850">err</span>&nbsp;<span class="op" id="6727854">:=</span>&nbsp;<span class="ident" id="6727857">NewEncoder</span><span class="op" id="6727867">(</span><span class="ident" id="6727868">buf</span><span class="op" id="6727871">)</span><span class="op" id="6727872">.</span><span class="ident" id="6727873">Encode</span><span class="op" id="6727879">(</span><span class="ident" id="6727880">slice</span><span class="op" id="6727885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6727888">if</span>&nbsp;<span class="ident" id="6727891">err</span>&nbsp;<span class="op" id="6727895">!=</span>&nbsp;<span class="ident" id="6727898">nil</span>&nbsp;<span class="op" id="6727902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6727906">t</span><span class="op" id="6727907">.</span><span class="ident" id="6727908">Fatal</span><span class="op" id="6727913">(</span><span class="string" id="6727914">&#34;encode:&#34;</span><span class="op" id="6727923">,</span>&nbsp;<span class="ident" id="6727925">err</span><span class="op" id="6727928">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6727931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6727934">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728017">buf</span><span class="op" id="6728020">.</span><span class="ident" id="6728021">Bytes</span><span class="op" id="6728026">(</span><span class="op" id="6728027">)</span><span class="op" id="6728028">[</span><span class="ident" id="6728029">buf</span><span class="op" id="6728032">.</span><span class="ident" id="6728033">Len</span><span class="op" id="6728036">(</span><span class="op" id="6728037">)</span><span class="op" id="6728038">-</span><span class="builtinfunc" id="6728039">len</span><span class="op" id="6728042">(</span><span class="ident" id="6728043">slice</span><span class="op" id="6728048">)</span><span class="op" id="6728049">-</span><span class="num" id="6728050">1</span><span class="op" id="6728051">]</span>&nbsp;<span class="op" id="6728053">=</span>&nbsp;<span class="num" id="6728055">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6728061">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728087">err</span>&nbsp;<span class="op" id="6728091">=</span>&nbsp;<span class="ident" id="6728093">NewDecoder</span><span class="op" id="6728103">(</span><span class="ident" id="6728104">buf</span><span class="op" id="6728107">)</span><span class="op" id="6728108">.</span><span class="ident" id="6728109">Decode</span><span class="op" id="6728115">(</span><span class="op" id="6728116">&amp;</span><span class="ident" id="6728117">slice</span><span class="op" id="6728122">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728125">if</span>&nbsp;<span class="ident" id="6728128">err</span>&nbsp;<span class="op" id="6728132">==</span>&nbsp;<span class="ident" id="6728135">nil</span>&nbsp;<span class="op" id="6728139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728143">t</span><span class="op" id="6728144">.</span><span class="ident" id="6728145">Fatal</span><span class="op" id="6728150">(</span><span class="string" id="6728151">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="6728169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6728175">if</span>&nbsp;<span class="op" id="6728178">!</span><span class="ident" id="6728179">strings</span><span class="op" id="6728186">.</span><span class="ident" id="6728187">Contains</span><span class="op" id="6728195">(</span><span class="ident" id="6728196">err</span><span class="op" id="6728199">.</span><span class="ident" id="6728200">Error</span><span class="op" id="6728205">(</span><span class="op" id="6728206">)</span><span class="op" id="6728207">,</span>&nbsp;<span class="string" id="6728209">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="6728224">)</span>&nbsp;<span class="op" id="6728226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6728230">t</span><span class="op" id="6728231">.</span><span class="ident" id="6728232">Fatal</span><span class="op" id="6728237">(</span><span class="string" id="6728238">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="6728284">,</span>&nbsp;<span class="ident" id="6728286">err</span><span class="op" id="6728289">.</span><span class="ident" id="6728290">Error</span><span class="op" id="6728295">(</span><span class="op" id="6728296">)</span><span class="op" id="6728297">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6728300">}</span><br>
<span class="lineno"></span><span class="op" id="6728302">}</span>
</div>
</body>
</html>
