<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8323007">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8323062">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8323116">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8323167">package</span>&nbsp;<span class="ident" id="8323175">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323180">import</span>&nbsp;<span class="op" id="8323187">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323190">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323199">&#34;flag&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323207">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323214">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323227">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323241">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323253">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323266">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323272">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323289">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323299">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323310">&#34;testing&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323321">&#34;text/template&#34;</span><br>
<span class="lineno"></span><span class="op" id="8323337">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323340">var</span>&nbsp;<span class="ident" id="8323344">update</span>&nbsp;<span class="op" id="8323351">=</span>&nbsp;<span class="ident" id="8323353">flag</span><span class="op" id="8323357">.</span><span class="ident" id="8323358">Bool</span><span class="op" id="8323362">(</span><span class="string" id="8323363">&#34;update&#34;</span><span class="op" id="8323371">,</span>&nbsp;<span class="ident" id="8323373">false</span><span class="op" id="8323378">,</span>&nbsp;<span class="string" id="8323380">&#34;update&nbsp;golden&nbsp;(.out)&nbsp;files&#34;</span><span class="op" id="8323408">)</span><br>
<span class="lineno"></span><span class="keyword" id="8323410">var</span>&nbsp;<span class="ident" id="8323414">files</span>&nbsp;<span class="op" id="8323420">=</span>&nbsp;<span class="ident" id="8323422">flag</span><span class="op" id="8323426">.</span><span class="ident" id="8323427">String</span><span class="op" id="8323433">(</span><span class="string" id="8323434">&#34;files&#34;</span><span class="op" id="8323441">,</span>&nbsp;<span class="string" id="8323443">&#34;&#34;</span><span class="op" id="8323445">,</span>&nbsp;<span class="string" id="8323447">&#34;consider&nbsp;only&nbsp;Go&nbsp;test&nbsp;files&nbsp;matching&nbsp;this&nbsp;regular&nbsp;expression&#34;</span><span class="op" id="8323509">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="8323512">const</span>&nbsp;<span class="ident" id="8323518">dataDir</span>&nbsp;<span class="op" id="8323526">=</span>&nbsp;<span class="string" id="8323528">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8323540">var</span>&nbsp;<span class="ident" id="8323544">templateTxt</span>&nbsp;<span class="op" id="8323556">=</span>&nbsp;<span class="ident" id="8323558">readTemplate</span><span class="op" id="8323570">(</span><span class="string" id="8323571">&#34;template.txt&#34;</span><span class="op" id="8323585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8323588">func</span>&nbsp;<span class="ident" id="8323593">readTemplate</span><span class="op" id="8323605">(</span><span class="ident" id="8323606">filename</span>&nbsp;<span class="builtintype" id="8323615">string</span><span class="op" id="8323621">)</span>&nbsp;<span class="op" id="8323623">*</span><span class="ident" id="8323624">template</span><span class="op" id="8323632">.</span><span class="ident" id="8323633">Template</span>&nbsp;<span class="op" id="8323642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323645">t</span>&nbsp;<span class="op" id="8323647">:=</span>&nbsp;<span class="ident" id="8323650">template</span><span class="op" id="8323658">.</span><span class="ident" id="8323659">New</span><span class="op" id="8323662">(</span><span class="ident" id="8323663">filename</span><span class="op" id="8323671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323674">t</span><span class="op" id="8323675">.</span><span class="ident" id="8323676">Funcs</span><span class="op" id="8323681">(</span><span class="ident" id="8323682">template</span><span class="op" id="8323690">.</span><span class="ident" id="8323691">FuncMap</span><span class="op" id="8323698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323702">&#34;node&#34;</span><span class="op" id="8323708">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8323714">nodeFmt</span><span class="op" id="8323721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323725">&#34;synopsis&#34;</span><span class="op" id="8323735">:</span>&nbsp;<span class="ident" id="8323737">synopsisFmt</span><span class="op" id="8323748">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8323752">&#34;indent&#34;</span><span class="op" id="8323760">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8323764">indentFmt</span><span class="op" id="8323773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8323776">}</span><span class="op" id="8323777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323780">return</span>&nbsp;<span class="ident" id="8323787">template</span><span class="op" id="8323795">.</span><span class="ident" id="8323796">Must</span><span class="op" id="8323800">(</span><span class="ident" id="8323801">t</span><span class="op" id="8323802">.</span><span class="ident" id="8323803">ParseFiles</span><span class="op" id="8323813">(</span><span class="ident" id="8323814">filepath</span><span class="op" id="8323822">.</span><span class="ident" id="8323823">Join</span><span class="op" id="8323827">(</span><span class="ident" id="8323828">dataDir</span><span class="op" id="8323835">,</span>&nbsp;<span class="ident" id="8323837">filename</span><span class="op" id="8323845">)</span><span class="op" id="8323846">)</span><span class="op" id="8323847">)</span><br>
<span class="lineno"></span><span class="op" id="8323849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8323852">func</span>&nbsp;<span class="ident" id="8323857">nodeFmt</span><span class="op" id="8323864">(</span><span class="ident" id="8323865">node</span>&nbsp;<span class="keyword" id="8323870">interface</span><span class="op" id="8323879">{</span><span class="op" id="8323880">}</span><span class="op" id="8323881">,</span>&nbsp;<span class="ident" id="8323883">fset</span>&nbsp;<span class="op" id="8323888">*</span><span class="ident" id="8323889">token</span><span class="op" id="8323894">.</span><span class="ident" id="8323895">FileSet</span><span class="op" id="8323902">)</span>&nbsp;<span class="builtintype" id="8323904">string</span>&nbsp;<span class="op" id="8323911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323914">var</span>&nbsp;<span class="ident" id="8323918">buf</span>&nbsp;<span class="ident" id="8323922">bytes</span><span class="op" id="8323927">.</span><span class="ident" id="8323928">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8323936">printer</span><span class="op" id="8323943">.</span><span class="ident" id="8323944">Fprint</span><span class="op" id="8323950">(</span><span class="op" id="8323951">&amp;</span><span class="ident" id="8323952">buf</span><span class="op" id="8323955">,</span>&nbsp;<span class="ident" id="8323957">fset</span><span class="op" id="8323961">,</span>&nbsp;<span class="ident" id="8323963">node</span><span class="op" id="8323967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8323970">return</span>&nbsp;<span class="ident" id="8323977">strings</span><span class="op" id="8323984">.</span><span class="ident" id="8323985">Replace</span><span class="op" id="8323992">(</span><span class="ident" id="8323993">strings</span><span class="op" id="8324000">.</span><span class="ident" id="8324001">TrimSpace</span><span class="op" id="8324010">(</span><span class="ident" id="8324011">buf</span><span class="op" id="8324014">.</span><span class="ident" id="8324015">String</span><span class="op" id="8324021">(</span><span class="op" id="8324022">)</span><span class="op" id="8324023">)</span><span class="op" id="8324024">,</span>&nbsp;<span class="string" id="8324026">&#34;\n&#34;</span><span class="op" id="8324030">,</span>&nbsp;<span class="string" id="8324032">&#34;\n\t&#34;</span><span class="op" id="8324038">,</span>&nbsp;<span class="op" id="8324040">-</span><span class="num" id="8324041">1</span><span class="op" id="8324042">)</span><br>
<span class="lineno"></span><span class="op" id="8324044">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8324047">func</span>&nbsp;<span class="ident" id="8324052">synopsisFmt</span><span class="op" id="8324063">(</span><span class="ident" id="8324064">s</span>&nbsp;<span class="builtintype" id="8324066">string</span><span class="op" id="8324072">)</span>&nbsp;<span class="builtintype" id="8324074">string</span>&nbsp;<span class="op" id="8324081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324084">const</span>&nbsp;<span class="ident" id="8324090">n</span>&nbsp;<span class="op" id="8324092">=</span>&nbsp;<span class="num" id="8324094">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324098">if</span>&nbsp;<span class="builtinfunc" id="8324101">len</span><span class="op" id="8324104">(</span><span class="ident" id="8324105">s</span><span class="op" id="8324106">)</span>&nbsp;<span class="op" id="8324108">&gt;</span>&nbsp;<span class="ident" id="8324110">n</span>&nbsp;<span class="op" id="8324112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324116">//&nbsp;cut&nbsp;off&nbsp;excess&nbsp;text&nbsp;and&nbsp;go&nbsp;back&nbsp;to&nbsp;a&nbsp;word&nbsp;boundary</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324172">s</span>&nbsp;<span class="op" id="8324174">=</span>&nbsp;<span class="ident" id="8324176">s</span><span class="op" id="8324177">[</span><span class="num" id="8324178">0</span><span class="op" id="8324179">:</span><span class="ident" id="8324180">n</span><span class="op" id="8324181">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324185">if</span>&nbsp;<span class="ident" id="8324188">i</span>&nbsp;<span class="op" id="8324190">:=</span>&nbsp;<span class="ident" id="8324193">strings</span><span class="op" id="8324200">.</span><span class="ident" id="8324201">LastIndexAny</span><span class="op" id="8324213">(</span><span class="ident" id="8324214">s</span><span class="op" id="8324215">,</span>&nbsp;<span class="string" id="8324217">&#34;\t\n&nbsp;&#34;</span><span class="op" id="8324224">)</span><span class="op" id="8324225">;</span>&nbsp;<span class="ident" id="8324227">i</span>&nbsp;<span class="op" id="8324229">&gt;=</span>&nbsp;<span class="num" id="8324232">0</span>&nbsp;<span class="op" id="8324234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324239">s</span>&nbsp;<span class="op" id="8324241">=</span>&nbsp;<span class="ident" id="8324243">s</span><span class="op" id="8324244">[</span><span class="num" id="8324245">0</span><span class="op" id="8324246">:</span><span class="ident" id="8324247">i</span><span class="op" id="8324248">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324256">s</span>&nbsp;<span class="op" id="8324258">=</span>&nbsp;<span class="ident" id="8324260">strings</span><span class="op" id="8324267">.</span><span class="ident" id="8324268">TrimSpace</span><span class="op" id="8324277">(</span><span class="ident" id="8324278">s</span><span class="op" id="8324279">)</span>&nbsp;<span class="op" id="8324281">+</span>&nbsp;<span class="string" id="8324283">&#34;&nbsp;...&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324294">return</span>&nbsp;<span class="string" id="8324301">&#34;//&nbsp;&#34;</span>&nbsp;<span class="op" id="8324307">+</span>&nbsp;<span class="ident" id="8324309">strings</span><span class="op" id="8324316">.</span><span class="ident" id="8324317">Replace</span><span class="op" id="8324324">(</span><span class="ident" id="8324325">s</span><span class="op" id="8324326">,</span>&nbsp;<span class="string" id="8324328">&#34;\n&#34;</span><span class="op" id="8324332">,</span>&nbsp;<span class="string" id="8324334">&#34;&nbsp;&#34;</span><span class="op" id="8324337">,</span>&nbsp;<span class="op" id="8324339">-</span><span class="num" id="8324340">1</span><span class="op" id="8324341">)</span><br>
<span class="lineno"></span><span class="op" id="8324343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8324346">func</span>&nbsp;<span class="ident" id="8324351">indentFmt</span><span class="op" id="8324360">(</span><span class="ident" id="8324361">indent</span><span class="op" id="8324367">,</span>&nbsp;<span class="ident" id="8324369">s</span>&nbsp;<span class="builtintype" id="8324371">string</span><span class="op" id="8324377">)</span>&nbsp;<span class="builtintype" id="8324379">string</span>&nbsp;<span class="op" id="8324386">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324389">end</span>&nbsp;<span class="op" id="8324393">:=</span>&nbsp;<span class="string" id="8324396">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324400">if</span>&nbsp;<span class="ident" id="8324403">strings</span><span class="op" id="8324410">.</span><span class="ident" id="8324411">HasSuffix</span><span class="op" id="8324420">(</span><span class="ident" id="8324421">s</span><span class="op" id="8324422">,</span>&nbsp;<span class="string" id="8324424">&#34;\n&#34;</span><span class="op" id="8324428">)</span>&nbsp;<span class="op" id="8324430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324434">end</span>&nbsp;<span class="op" id="8324438">=</span>&nbsp;<span class="string" id="8324440">&#34;\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324447">s</span>&nbsp;<span class="op" id="8324449">=</span>&nbsp;<span class="ident" id="8324451">s</span><span class="op" id="8324452">[</span><span class="op" id="8324453">:</span><span class="builtinfunc" id="8324454">len</span><span class="op" id="8324457">(</span><span class="ident" id="8324458">s</span><span class="op" id="8324459">)</span><span class="op" id="8324460">-</span><span class="num" id="8324461">1</span><span class="op" id="8324462">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324465">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324468">return</span>&nbsp;<span class="ident" id="8324475">indent</span>&nbsp;<span class="op" id="8324482">+</span>&nbsp;<span class="ident" id="8324484">strings</span><span class="op" id="8324491">.</span><span class="ident" id="8324492">Replace</span><span class="op" id="8324499">(</span><span class="ident" id="8324500">s</span><span class="op" id="8324501">,</span>&nbsp;<span class="string" id="8324503">&#34;\n&#34;</span><span class="op" id="8324507">,</span>&nbsp;<span class="string" id="8324509">&#34;\n&#34;</span><span class="op" id="8324513">+</span><span class="ident" id="8324514">indent</span><span class="op" id="8324520">,</span>&nbsp;<span class="op" id="8324522">-</span><span class="num" id="8324523">1</span><span class="op" id="8324524">)</span>&nbsp;<span class="op" id="8324526">+</span>&nbsp;<span class="ident" id="8324528">end</span><br>
<span class="lineno"></span><span class="op" id="8324532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8324535">func</span>&nbsp;<span class="ident" id="8324540">isGoFile</span><span class="op" id="8324548">(</span><span class="ident" id="8324549">fi</span>&nbsp;<span class="ident" id="8324552">os</span><span class="op" id="8324554">.</span><span class="ident" id="8324555">FileInfo</span><span class="op" id="8324563">)</span>&nbsp;<span class="builtintype" id="8324565">bool</span>&nbsp;<span class="op" id="8324570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324573">name</span>&nbsp;<span class="op" id="8324578">:=</span>&nbsp;<span class="ident" id="8324581">fi</span><span class="op" id="8324583">.</span><span class="ident" id="8324584">Name</span><span class="op" id="8324588">(</span><span class="op" id="8324589">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324592">return</span>&nbsp;<span class="op" id="8324599">!</span><span class="ident" id="8324600">fi</span><span class="op" id="8324602">.</span><span class="ident" id="8324603">IsDir</span><span class="op" id="8324608">(</span><span class="op" id="8324609">)</span>&nbsp;<span class="op" id="8324611">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8324616">len</span><span class="op" id="8324619">(</span><span class="ident" id="8324620">name</span><span class="op" id="8324624">)</span>&nbsp;<span class="op" id="8324626">&gt;</span>&nbsp;<span class="num" id="8324628">0</span>&nbsp;<span class="op" id="8324630">&amp;&amp;</span>&nbsp;<span class="ident" id="8324633">name</span><span class="op" id="8324637">[</span><span class="num" id="8324638">0</span><span class="op" id="8324639">]</span>&nbsp;<span class="op" id="8324641">!=</span>&nbsp;<span class="string" id="8324644">&#39;.&#39;</span>&nbsp;<span class="op" id="8324648">&amp;&amp;</span>&nbsp;<span class="comment" id="8324651">//&nbsp;ignore&nbsp;.files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324670">filepath</span><span class="op" id="8324678">.</span><span class="ident" id="8324679">Ext</span><span class="op" id="8324682">(</span><span class="ident" id="8324683">name</span><span class="op" id="8324687">)</span>&nbsp;<span class="op" id="8324689">==</span>&nbsp;<span class="string" id="8324692">&#34;.go&#34;</span><br>
<span class="lineno"></span><span class="op" id="8324698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="8324701">type</span>&nbsp;<span class="ident" id="8324706">bundle</span>&nbsp;<span class="keyword" id="8324713">struct</span>&nbsp;<span class="op" id="8324720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324723">*</span><span class="ident" id="8324724">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324733">FSet</span>&nbsp;<span class="op" id="8324738">*</span><span class="ident" id="8324739">token</span><span class="op" id="8324744">.</span><span class="ident" id="8324745">FileSet</span><br>
<span class="lineno"></span><span class="op" id="8324753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="8324756">func</span>&nbsp;<span class="ident" id="8324761">test</span><span class="op" id="8324765">(</span><span class="ident" id="8324766">t</span>&nbsp;<span class="op" id="8324768">*</span><span class="ident" id="8324769">testing</span><span class="op" id="8324776">.</span><span class="ident" id="8324777">T</span><span class="op" id="8324778">,</span>&nbsp;<span class="ident" id="8324780">mode</span>&nbsp;<span class="ident" id="8324785">Mode</span><span class="op" id="8324789">)</span>&nbsp;<span class="op" id="8324791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8324794">//&nbsp;determine&nbsp;file&nbsp;filter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324820">filter</span>&nbsp;<span class="op" id="8324827">:=</span>&nbsp;<span class="ident" id="8324830">isGoFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324840">if</span>&nbsp;<span class="op" id="8324843">*</span><span class="ident" id="8324844">files</span>&nbsp;<span class="op" id="8324850">!=</span>&nbsp;<span class="string" id="8324853">&#34;&#34;</span>&nbsp;<span class="op" id="8324856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324860">rx</span><span class="op" id="8324862">,</span>&nbsp;<span class="ident" id="8324864">err</span>&nbsp;<span class="op" id="8324868">:=</span>&nbsp;<span class="ident" id="8324871">regexp</span><span class="op" id="8324877">.</span><span class="ident" id="8324878">Compile</span><span class="op" id="8324885">(</span><span class="op" id="8324886">*</span><span class="ident" id="8324887">files</span><span class="op" id="8324892">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324896">if</span>&nbsp;<span class="ident" id="8324899">err</span>&nbsp;<span class="op" id="8324903">!=</span>&nbsp;<span class="ident" id="8324906">nil</span>&nbsp;<span class="op" id="8324910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324915">t</span><span class="op" id="8324916">.</span><span class="ident" id="8324917">Fatal</span><span class="op" id="8324922">(</span><span class="ident" id="8324923">err</span><span class="op" id="8324926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8324930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8324934">filter</span>&nbsp;<span class="op" id="8324941">=</span>&nbsp;<span class="keyword" id="8324943">func</span><span class="op" id="8324947">(</span><span class="ident" id="8324948">fi</span>&nbsp;<span class="ident" id="8324951">os</span><span class="op" id="8324953">.</span><span class="ident" id="8324954">FileInfo</span><span class="op" id="8324962">)</span>&nbsp;<span class="builtintype" id="8324964">bool</span>&nbsp;<span class="op" id="8324969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8324974">return</span>&nbsp;<span class="ident" id="8324981">isGoFile</span><span class="op" id="8324989">(</span><span class="ident" id="8324990">fi</span><span class="op" id="8324992">)</span>&nbsp;<span class="op" id="8324994">&amp;&amp;</span>&nbsp;<span class="ident" id="8324997">rx</span><span class="op" id="8324999">.</span><span class="ident" id="8325000">MatchString</span><span class="op" id="8325011">(</span><span class="ident" id="8325012">fi</span><span class="op" id="8325014">.</span><span class="ident" id="8325015">Name</span><span class="op" id="8325019">(</span><span class="op" id="8325020">)</span><span class="op" id="8325021">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325032">//&nbsp;get&nbsp;packages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325049">fset</span>&nbsp;<span class="op" id="8325054">:=</span>&nbsp;<span class="ident" id="8325057">token</span><span class="op" id="8325062">.</span><span class="ident" id="8325063">NewFileSet</span><span class="op" id="8325073">(</span><span class="op" id="8325074">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325077">pkgs</span><span class="op" id="8325081">,</span>&nbsp;<span class="ident" id="8325083">err</span>&nbsp;<span class="op" id="8325087">:=</span>&nbsp;<span class="ident" id="8325090">parser</span><span class="op" id="8325096">.</span><span class="ident" id="8325097">ParseDir</span><span class="op" id="8325105">(</span><span class="ident" id="8325106">fset</span><span class="op" id="8325110">,</span>&nbsp;<span class="ident" id="8325112">dataDir</span><span class="op" id="8325119">,</span>&nbsp;<span class="ident" id="8325121">filter</span><span class="op" id="8325127">,</span>&nbsp;<span class="ident" id="8325129">parser</span><span class="op" id="8325135">.</span><span class="ident" id="8325136">ParseComments</span><span class="op" id="8325149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325152">if</span>&nbsp;<span class="ident" id="8325155">err</span>&nbsp;<span class="op" id="8325159">!=</span>&nbsp;<span class="ident" id="8325162">nil</span>&nbsp;<span class="op" id="8325166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325170">t</span><span class="op" id="8325171">.</span><span class="ident" id="8325172">Fatal</span><span class="op" id="8325177">(</span><span class="ident" id="8325178">err</span><span class="op" id="8325181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325188">//&nbsp;test&nbsp;packages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325206">for</span>&nbsp;<span class="ident" id="8325210">_</span><span class="op" id="8325211">,</span>&nbsp;<span class="ident" id="8325213">pkg</span>&nbsp;<span class="op" id="8325217">:=</span>&nbsp;<span class="keyword" id="8325220">range</span>&nbsp;<span class="ident" id="8325226">pkgs</span>&nbsp;<span class="op" id="8325231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325235">importpath</span>&nbsp;<span class="op" id="8325246">:=</span>&nbsp;<span class="ident" id="8325249">dataDir</span>&nbsp;<span class="op" id="8325257">+</span>&nbsp;<span class="string" id="8325259">&#34;/&#34;</span>&nbsp;<span class="op" id="8325263">+</span>&nbsp;<span class="ident" id="8325265">pkg</span><span class="op" id="8325268">.</span><span class="ident" id="8325269">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325276">doc</span>&nbsp;<span class="op" id="8325280">:=</span>&nbsp;<span class="ident" id="8325283">New</span><span class="op" id="8325286">(</span><span class="ident" id="8325287">pkg</span><span class="op" id="8325290">,</span>&nbsp;<span class="ident" id="8325292">importpath</span><span class="op" id="8325302">,</span>&nbsp;<span class="ident" id="8325304">mode</span><span class="op" id="8325308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325313">//&nbsp;golden&nbsp;files&nbsp;always&nbsp;use&nbsp;/&nbsp;in&nbsp;filenames&nbsp;-&nbsp;canonicalize&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325377">for</span>&nbsp;<span class="ident" id="8325381">i</span><span class="op" id="8325382">,</span>&nbsp;<span class="ident" id="8325384">filename</span>&nbsp;<span class="op" id="8325393">:=</span>&nbsp;<span class="keyword" id="8325396">range</span>&nbsp;<span class="ident" id="8325402">doc</span><span class="op" id="8325405">.</span><span class="ident" id="8325406">Filenames</span>&nbsp;<span class="op" id="8325416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325421">doc</span><span class="op" id="8325424">.</span><span class="ident" id="8325425">Filenames</span><span class="op" id="8325434">[</span><span class="ident" id="8325435">i</span><span class="op" id="8325436">]</span>&nbsp;<span class="op" id="8325438">=</span>&nbsp;<span class="ident" id="8325440">filepath</span><span class="op" id="8325448">.</span><span class="ident" id="8325449">ToSlash</span><span class="op" id="8325456">(</span><span class="ident" id="8325457">filename</span><span class="op" id="8325465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325474">//&nbsp;print&nbsp;documentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325499">var</span>&nbsp;<span class="ident" id="8325503">buf</span>&nbsp;<span class="ident" id="8325507">bytes</span><span class="op" id="8325512">.</span><span class="ident" id="8325513">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325522">if</span>&nbsp;<span class="ident" id="8325525">err</span>&nbsp;<span class="op" id="8325529">:=</span>&nbsp;<span class="ident" id="8325532">templateTxt</span><span class="op" id="8325543">.</span><span class="ident" id="8325544">Execute</span><span class="op" id="8325551">(</span><span class="op" id="8325552">&amp;</span><span class="ident" id="8325553">buf</span><span class="op" id="8325556">,</span>&nbsp;<span class="ident" id="8325558">bundle</span><span class="op" id="8325564">{</span><span class="ident" id="8325565">doc</span><span class="op" id="8325568">,</span>&nbsp;<span class="ident" id="8325570">fset</span><span class="op" id="8325574">}</span><span class="op" id="8325575">)</span><span class="op" id="8325576">;</span>&nbsp;<span class="ident" id="8325578">err</span>&nbsp;<span class="op" id="8325582">!=</span>&nbsp;<span class="ident" id="8325585">nil</span>&nbsp;<span class="op" id="8325589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325594">t</span><span class="op" id="8325595">.</span><span class="ident" id="8325596">Error</span><span class="op" id="8325601">(</span><span class="ident" id="8325602">err</span><span class="op" id="8325605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325610">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325625">got</span>&nbsp;<span class="op" id="8325629">:=</span>&nbsp;<span class="ident" id="8325632">buf</span><span class="op" id="8325635">.</span><span class="ident" id="8325636">Bytes</span><span class="op" id="8325641">(</span><span class="op" id="8325642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325647">//&nbsp;update&nbsp;golden&nbsp;file&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325684">golden</span>&nbsp;<span class="op" id="8325691">:=</span>&nbsp;<span class="ident" id="8325694">filepath</span><span class="op" id="8325702">.</span><span class="ident" id="8325703">Join</span><span class="op" id="8325707">(</span><span class="ident" id="8325708">dataDir</span><span class="op" id="8325715">,</span>&nbsp;<span class="ident" id="8325717">fmt</span><span class="op" id="8325720">.</span><span class="ident" id="8325721">Sprintf</span><span class="op" id="8325728">(</span><span class="string" id="8325729">&#34;%s.%d.golden&#34;</span><span class="op" id="8325743">,</span>&nbsp;<span class="ident" id="8325745">pkg</span><span class="op" id="8325748">.</span><span class="ident" id="8325749">Name</span><span class="op" id="8325753">,</span>&nbsp;<span class="ident" id="8325755">mode</span><span class="op" id="8325759">)</span><span class="op" id="8325760">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325764">if</span>&nbsp;<span class="op" id="8325767">*</span><span class="ident" id="8325768">update</span>&nbsp;<span class="op" id="8325775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325780">err</span>&nbsp;<span class="op" id="8325784">:=</span>&nbsp;<span class="ident" id="8325787">ioutil</span><span class="op" id="8325793">.</span><span class="ident" id="8325794">WriteFile</span><span class="op" id="8325803">(</span><span class="ident" id="8325804">golden</span><span class="op" id="8325810">,</span>&nbsp;<span class="ident" id="8325812">got</span><span class="op" id="8325815">,</span>&nbsp;<span class="num" id="8325817">0644</span><span class="op" id="8325821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325826">if</span>&nbsp;<span class="ident" id="8325829">err</span>&nbsp;<span class="op" id="8325833">!=</span>&nbsp;<span class="ident" id="8325836">nil</span>&nbsp;<span class="op" id="8325840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325846">t</span><span class="op" id="8325847">.</span><span class="ident" id="8325848">Error</span><span class="op" id="8325853">(</span><span class="ident" id="8325854">err</span><span class="op" id="8325857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325862">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325867">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325883">//&nbsp;get&nbsp;golden&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325904">want</span><span class="op" id="8325908">,</span>&nbsp;<span class="ident" id="8325910">err</span>&nbsp;<span class="op" id="8325914">:=</span>&nbsp;<span class="ident" id="8325917">ioutil</span><span class="op" id="8325923">.</span><span class="ident" id="8325924">ReadFile</span><span class="op" id="8325932">(</span><span class="ident" id="8325933">golden</span><span class="op" id="8325939">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325943">if</span>&nbsp;<span class="ident" id="8325946">err</span>&nbsp;<span class="op" id="8325950">!=</span>&nbsp;<span class="ident" id="8325953">nil</span>&nbsp;<span class="op" id="8325957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325962">t</span><span class="op" id="8325963">.</span><span class="ident" id="8325964">Error</span><span class="op" id="8325969">(</span><span class="ident" id="8325970">err</span><span class="op" id="8325973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325978">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8325994">//&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326007">if</span>&nbsp;<span class="op" id="8326010">!</span><span class="ident" id="8326011">bytes</span><span class="op" id="8326016">.</span><span class="ident" id="8326017">Equal</span><span class="op" id="8326022">(</span><span class="ident" id="8326023">got</span><span class="op" id="8326026">,</span>&nbsp;<span class="ident" id="8326028">want</span><span class="op" id="8326032">)</span>&nbsp;<span class="op" id="8326034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326039">t</span><span class="op" id="8326040">.</span><span class="ident" id="8326041">Errorf</span><span class="op" id="8326047">(</span><span class="string" id="8326048">&#34;package&nbsp;%s\n\tgot:\n%s\n\twant:\n%s&#34;</span><span class="op" id="8326085">,</span>&nbsp;<span class="ident" id="8326087">pkg</span><span class="op" id="8326090">.</span><span class="ident" id="8326091">Name</span><span class="op" id="8326095">,</span>&nbsp;<span class="ident" id="8326097">got</span><span class="op" id="8326100">,</span>&nbsp;<span class="ident" id="8326102">want</span><span class="op" id="8326106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326113">}</span><br>
<span class="lineno">140</span><span class="op" id="8326115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8326118">func</span>&nbsp;<span class="ident" id="8326123">Test</span><span class="op" id="8326127">(</span><span class="ident" id="8326128">t</span>&nbsp;<span class="op" id="8326130">*</span><span class="ident" id="8326131">testing</span><span class="op" id="8326138">.</span><span class="ident" id="8326139">T</span><span class="op" id="8326140">)</span>&nbsp;<span class="op" id="8326142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326145">test</span><span class="op" id="8326149">(</span><span class="ident" id="8326150">t</span><span class="op" id="8326151">,</span>&nbsp;<span class="num" id="8326153">0</span><span class="op" id="8326154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326157">test</span><span class="op" id="8326161">(</span><span class="ident" id="8326162">t</span><span class="op" id="8326163">,</span>&nbsp;<span class="ident" id="8326165">AllDecls</span><span class="op" id="8326173">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326176">test</span><span class="op" id="8326180">(</span><span class="ident" id="8326181">t</span><span class="op" id="8326182">,</span>&nbsp;<span class="ident" id="8326184">AllMethods</span><span class="op" id="8326194">)</span><br>
<span class="lineno"></span><span class="op" id="8326196">}</span>
</div>
</body>
</html>
