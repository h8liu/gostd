<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html" class="current">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3383583">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3383639">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3383693">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3383744">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3383822">package</span>&nbsp;<span class="ident" id="3383830">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3383835">import</span>&nbsp;<span class="op" id="3383842">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3383845">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3383855">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3383861">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3383872">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3383879">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3383882">func</span>&nbsp;<span class="ident" id="3383887">unixSocket</span><span class="op" id="3383897">(</span><span class="ident" id="3383898">net</span>&nbsp;<span class="builtintype" id="3383902">string</span><span class="op" id="3383908">,</span>&nbsp;<span class="ident" id="3383910">laddr</span><span class="op" id="3383915">,</span>&nbsp;<span class="ident" id="3383917">raddr</span>&nbsp;<span class="ident" id="3383923">sockaddr</span><span class="op" id="3383931">,</span>&nbsp;<span class="ident" id="3383933">mode</span>&nbsp;<span class="builtintype" id="3383938">string</span><span class="op" id="3383944">,</span>&nbsp;<span class="ident" id="3383946">deadline</span>&nbsp;<span class="ident" id="3383955">time</span><span class="op" id="3383959">.</span><span class="ident" id="3383960">Time</span><span class="op" id="3383964">)</span>&nbsp;<span class="op" id="3383966">(</span><span class="op" id="3383967">*</span><span class="ident" id="3383968">netFD</span><span class="op" id="3383973">,</span>&nbsp;<span class="builtintype" id="3383975">error</span><span class="op" id="3383980">)</span>&nbsp;<span class="op" id="3383982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3383985">var</span>&nbsp;<span class="ident" id="3383989">sotype</span>&nbsp;<span class="builtintype" id="3383996">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384001">switch</span>&nbsp;<span class="ident" id="3384008">net</span>&nbsp;<span class="op" id="3384012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384015">case</span>&nbsp;<span class="string" id="3384020">&#34;unix&#34;</span><span class="op" id="3384026">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384030">sotype</span>&nbsp;<span class="op" id="3384037">=</span>&nbsp;<span class="ident" id="3384039">syscall</span><span class="op" id="3384046">.</span><span class="ident" id="3384047">SOCK_STREAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384060">case</span>&nbsp;<span class="string" id="3384065">&#34;unixgram&#34;</span><span class="op" id="3384075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384079">sotype</span>&nbsp;<span class="op" id="3384086">=</span>&nbsp;<span class="ident" id="3384088">syscall</span><span class="op" id="3384095">.</span><span class="ident" id="3384096">SOCK_DGRAM</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384108">case</span>&nbsp;<span class="string" id="3384113">&#34;unixpacket&#34;</span><span class="op" id="3384125">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384129">sotype</span>&nbsp;<span class="op" id="3384136">=</span>&nbsp;<span class="ident" id="3384138">syscall</span><span class="op" id="3384145">.</span><span class="ident" id="3384146">SOCK_SEQPACKET</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384162">default</span><span class="op" id="3384169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384173">return</span>&nbsp;<span class="builtintype" id="3384180">nil</span><span class="op" id="3384183">,</span>&nbsp;<span class="ident" id="3384185">UnknownNetworkError</span><span class="op" id="3384204">(</span><span class="ident" id="3384205">net</span><span class="op" id="3384208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384215">switch</span>&nbsp;<span class="ident" id="3384222">mode</span>&nbsp;<span class="op" id="3384227">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384230">case</span>&nbsp;<span class="string" id="3384235">&#34;dial&#34;</span><span class="op" id="3384241">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384245">if</span>&nbsp;<span class="ident" id="3384248">laddr</span>&nbsp;<span class="op" id="3384254">!=</span>&nbsp;<span class="builtintype" id="3384257">nil</span>&nbsp;<span class="op" id="3384261">&amp;&amp;</span>&nbsp;<span class="ident" id="3384264">laddr</span><span class="op" id="3384269">.</span><span class="ident" id="3384270">isWildcard</span><span class="op" id="3384280">(</span><span class="op" id="3384281">)</span>&nbsp;<span class="op" id="3384283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384288">laddr</span>&nbsp;<span class="op" id="3384294">=</span>&nbsp;<span class="builtintype" id="3384296">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384306">if</span>&nbsp;<span class="ident" id="3384309">raddr</span>&nbsp;<span class="op" id="3384315">!=</span>&nbsp;<span class="builtintype" id="3384318">nil</span>&nbsp;<span class="op" id="3384322">&amp;&amp;</span>&nbsp;<span class="ident" id="3384325">raddr</span><span class="op" id="3384330">.</span><span class="ident" id="3384331">isWildcard</span><span class="op" id="3384341">(</span><span class="op" id="3384342">)</span>&nbsp;<span class="op" id="3384344">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384349">raddr</span>&nbsp;<span class="op" id="3384355">=</span>&nbsp;<span class="builtintype" id="3384357">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384367">if</span>&nbsp;<span class="ident" id="3384370">raddr</span>&nbsp;<span class="op" id="3384376">==</span>&nbsp;<span class="builtintype" id="3384379">nil</span>&nbsp;<span class="op" id="3384383">&amp;&amp;</span>&nbsp;<span class="op" id="3384386">(</span><span class="ident" id="3384387">sotype</span>&nbsp;<span class="op" id="3384394">!=</span>&nbsp;<span class="ident" id="3384397">syscall</span><span class="op" id="3384404">.</span><span class="ident" id="3384405">SOCK_DGRAM</span>&nbsp;<span class="op" id="3384416">||</span>&nbsp;<span class="ident" id="3384419">laddr</span>&nbsp;<span class="op" id="3384425">==</span>&nbsp;<span class="builtintype" id="3384428">nil</span><span class="op" id="3384431">)</span>&nbsp;<span class="op" id="3384433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384438">return</span>&nbsp;<span class="builtintype" id="3384445">nil</span><span class="op" id="3384448">,</span>&nbsp;<span class="ident" id="3384450">errMissingAddress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384470">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384473">case</span>&nbsp;<span class="string" id="3384478">&#34;listen&#34;</span><span class="op" id="3384486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384489">default</span><span class="op" id="3384496">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384500">return</span>&nbsp;<span class="builtintype" id="3384507">nil</span><span class="op" id="3384510">,</span>&nbsp;<span class="ident" id="3384512">errors</span><span class="op" id="3384518">.</span><span class="ident" id="3384519">New</span><span class="op" id="3384522">(</span><span class="string" id="3384523">&#34;unknown&nbsp;mode:&nbsp;&#34;</span>&nbsp;<span class="op" id="3384540">+</span>&nbsp;<span class="ident" id="3384542">mode</span><span class="op" id="3384546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3384553">fd</span><span class="op" id="3384555">,</span>&nbsp;<span class="ident" id="3384557">err</span>&nbsp;<span class="op" id="3384561">:=</span>&nbsp;<span class="ident" id="3384564">socket</span><span class="op" id="3384570">(</span><span class="ident" id="3384571">net</span><span class="op" id="3384574">,</span>&nbsp;<span class="ident" id="3384576">syscall</span><span class="op" id="3384583">.</span><span class="ident" id="3384584">AF_UNIX</span><span class="op" id="3384591">,</span>&nbsp;<span class="ident" id="3384593">sotype</span><span class="op" id="3384599">,</span>&nbsp;<span class="num" id="3384601">0</span><span class="op" id="3384602">,</span>&nbsp;<span class="builtintype" id="3384604">false</span><span class="op" id="3384609">,</span>&nbsp;<span class="ident" id="3384611">laddr</span><span class="op" id="3384616">,</span>&nbsp;<span class="ident" id="3384618">raddr</span><span class="op" id="3384623">,</span>&nbsp;<span class="ident" id="3384625">deadline</span><span class="op" id="3384633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384636">if</span>&nbsp;<span class="ident" id="3384639">err</span>&nbsp;<span class="op" id="3384643">!=</span>&nbsp;<span class="builtintype" id="3384646">nil</span>&nbsp;<span class="op" id="3384650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384654">return</span>&nbsp;<span class="builtintype" id="3384661">nil</span><span class="op" id="3384664">,</span>&nbsp;<span class="ident" id="3384666">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384674">return</span>&nbsp;<span class="ident" id="3384681">fd</span><span class="op" id="3384683">,</span>&nbsp;<span class="builtintype" id="3384685">nil</span><br>
<span class="lineno">50</span><span class="op" id="3384689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384692">func</span>&nbsp;<span class="ident" id="3384697">sockaddrToUnix</span><span class="op" id="3384711">(</span><span class="ident" id="3384712">sa</span>&nbsp;<span class="ident" id="3384715">syscall</span><span class="op" id="3384722">.</span><span class="ident" id="3384723">Sockaddr</span><span class="op" id="3384731">)</span>&nbsp;<span class="ident" id="3384733">Addr</span>&nbsp;<span class="op" id="3384738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384741">if</span>&nbsp;<span class="ident" id="3384744">s</span><span class="op" id="3384745">,</span>&nbsp;<span class="ident" id="3384747">ok</span>&nbsp;<span class="op" id="3384750">:=</span>&nbsp;<span class="ident" id="3384753">sa</span><span class="op" id="3384755">.</span><span class="op" id="3384756">(</span><span class="op" id="3384757">*</span><span class="ident" id="3384758">syscall</span><span class="op" id="3384765">.</span><span class="ident" id="3384766">SockaddrUnix</span><span class="op" id="3384778">)</span><span class="op" id="3384779">;</span>&nbsp;<span class="ident" id="3384781">ok</span>&nbsp;<span class="op" id="3384784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384788">return</span>&nbsp;<span class="op" id="3384795">&amp;</span><span class="ident" id="3384796">UnixAddr</span><span class="op" id="3384804">{</span><span class="ident" id="3384805">Name</span><span class="op" id="3384809">:</span>&nbsp;<span class="ident" id="3384811">s</span><span class="op" id="3384812">.</span><span class="ident" id="3384813">Name</span><span class="op" id="3384817">,</span>&nbsp;<span class="ident" id="3384819">Net</span><span class="op" id="3384822">:</span>&nbsp;<span class="string" id="3384824">&#34;unix&#34;</span><span class="op" id="3384830">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384836">return</span>&nbsp;<span class="builtintype" id="3384843">nil</span><br>
<span class="lineno"></span><span class="op" id="3384847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3384850">func</span>&nbsp;<span class="ident" id="3384855">sockaddrToUnixgram</span><span class="op" id="3384873">(</span><span class="ident" id="3384874">sa</span>&nbsp;<span class="ident" id="3384877">syscall</span><span class="op" id="3384884">.</span><span class="ident" id="3384885">Sockaddr</span><span class="op" id="3384893">)</span>&nbsp;<span class="ident" id="3384895">Addr</span>&nbsp;<span class="op" id="3384900">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384903">if</span>&nbsp;<span class="ident" id="3384906">s</span><span class="op" id="3384907">,</span>&nbsp;<span class="ident" id="3384909">ok</span>&nbsp;<span class="op" id="3384912">:=</span>&nbsp;<span class="ident" id="3384915">sa</span><span class="op" id="3384917">.</span><span class="op" id="3384918">(</span><span class="op" id="3384919">*</span><span class="ident" id="3384920">syscall</span><span class="op" id="3384927">.</span><span class="ident" id="3384928">SockaddrUnix</span><span class="op" id="3384940">)</span><span class="op" id="3384941">;</span>&nbsp;<span class="ident" id="3384943">ok</span>&nbsp;<span class="op" id="3384946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3384950">return</span>&nbsp;<span class="op" id="3384957">&amp;</span><span class="ident" id="3384958">UnixAddr</span><span class="op" id="3384966">{</span><span class="ident" id="3384967">Name</span><span class="op" id="3384971">:</span>&nbsp;<span class="ident" id="3384973">s</span><span class="op" id="3384974">.</span><span class="ident" id="3384975">Name</span><span class="op" id="3384979">,</span>&nbsp;<span class="ident" id="3384981">Net</span><span class="op" id="3384984">:</span>&nbsp;<span class="string" id="3384986">&#34;unixgram&#34;</span><span class="op" id="3384996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3384999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385002">return</span>&nbsp;<span class="builtintype" id="3385009">nil</span><br>
<span class="lineno"></span><span class="op" id="3385013">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="3385016">func</span>&nbsp;<span class="ident" id="3385021">sockaddrToUnixpacket</span><span class="op" id="3385041">(</span><span class="ident" id="3385042">sa</span>&nbsp;<span class="ident" id="3385045">syscall</span><span class="op" id="3385052">.</span><span class="ident" id="3385053">Sockaddr</span><span class="op" id="3385061">)</span>&nbsp;<span class="ident" id="3385063">Addr</span>&nbsp;<span class="op" id="3385068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385071">if</span>&nbsp;<span class="ident" id="3385074">s</span><span class="op" id="3385075">,</span>&nbsp;<span class="ident" id="3385077">ok</span>&nbsp;<span class="op" id="3385080">:=</span>&nbsp;<span class="ident" id="3385083">sa</span><span class="op" id="3385085">.</span><span class="op" id="3385086">(</span><span class="op" id="3385087">*</span><span class="ident" id="3385088">syscall</span><span class="op" id="3385095">.</span><span class="ident" id="3385096">SockaddrUnix</span><span class="op" id="3385108">)</span><span class="op" id="3385109">;</span>&nbsp;<span class="ident" id="3385111">ok</span>&nbsp;<span class="op" id="3385114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385118">return</span>&nbsp;<span class="op" id="3385125">&amp;</span><span class="ident" id="3385126">UnixAddr</span><span class="op" id="3385134">{</span><span class="ident" id="3385135">Name</span><span class="op" id="3385139">:</span>&nbsp;<span class="ident" id="3385141">s</span><span class="op" id="3385142">.</span><span class="ident" id="3385143">Name</span><span class="op" id="3385147">,</span>&nbsp;<span class="ident" id="3385149">Net</span><span class="op" id="3385152">:</span>&nbsp;<span class="string" id="3385154">&#34;unixpacket&#34;</span><span class="op" id="3385166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3385169">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385172">return</span>&nbsp;<span class="builtintype" id="3385179">nil</span><br>
<span class="lineno"></span><span class="op" id="3385183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385186">func</span>&nbsp;<span class="ident" id="3385191">sotypeToNet</span><span class="op" id="3385202">(</span><span class="ident" id="3385203">sotype</span>&nbsp;<span class="builtintype" id="3385210">int</span><span class="op" id="3385213">)</span>&nbsp;<span class="builtintype" id="3385215">string</span>&nbsp;<span class="op" id="3385222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385225">switch</span>&nbsp;<span class="ident" id="3385232">sotype</span>&nbsp;<span class="op" id="3385239">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385242">case</span>&nbsp;<span class="ident" id="3385247">syscall</span><span class="op" id="3385254">.</span><span class="ident" id="3385255">SOCK_STREAM</span><span class="op" id="3385266">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385270">return</span>&nbsp;<span class="string" id="3385277">&#34;unix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385285">case</span>&nbsp;<span class="ident" id="3385290">syscall</span><span class="op" id="3385297">.</span><span class="ident" id="3385298">SOCK_DGRAM</span><span class="op" id="3385308">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385312">return</span>&nbsp;<span class="string" id="3385319">&#34;unixgram&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385331">case</span>&nbsp;<span class="ident" id="3385336">syscall</span><span class="op" id="3385343">.</span><span class="ident" id="3385344">SOCK_SEQPACKET</span><span class="op" id="3385358">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385362">return</span>&nbsp;<span class="string" id="3385369">&#34;unixpacket&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385383">default</span><span class="op" id="3385390">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3385394">panic</span><span class="op" id="3385399">(</span><span class="string" id="3385400">&#34;sotypeToNet&nbsp;unknown&nbsp;socket&nbsp;type&#34;</span><span class="op" id="3385433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3385436">}</span><br>
<span class="lineno"></span><span class="op" id="3385438">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="3385441">func</span>&nbsp;<span class="op" id="3385446">(</span><span class="ident" id="3385447">a</span>&nbsp;<span class="op" id="3385449">*</span><span class="ident" id="3385450">UnixAddr</span><span class="op" id="3385458">)</span>&nbsp;<span class="ident" id="3385460">family</span><span class="op" id="3385466">(</span><span class="op" id="3385467">)</span>&nbsp;<span class="builtintype" id="3385469">int</span>&nbsp;<span class="op" id="3385473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385476">return</span>&nbsp;<span class="ident" id="3385483">syscall</span><span class="op" id="3385490">.</span><span class="ident" id="3385491">AF_UNIX</span><br>
<span class="lineno"></span><span class="op" id="3385499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3385502">func</span>&nbsp;<span class="op" id="3385507">(</span><span class="ident" id="3385508">a</span>&nbsp;<span class="op" id="3385510">*</span><span class="ident" id="3385511">UnixAddr</span><span class="op" id="3385519">)</span>&nbsp;<span class="ident" id="3385521">isWildcard</span><span class="op" id="3385531">(</span><span class="op" id="3385532">)</span>&nbsp;<span class="builtintype" id="3385534">bool</span>&nbsp;<span class="op" id="3385539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385542">return</span>&nbsp;<span class="ident" id="3385549">a</span>&nbsp;<span class="op" id="3385551">==</span>&nbsp;<span class="builtintype" id="3385554">nil</span>&nbsp;<span class="op" id="3385558">||</span>&nbsp;<span class="ident" id="3385561">a</span><span class="op" id="3385562">.</span><span class="ident" id="3385563">Name</span>&nbsp;<span class="op" id="3385568">==</span>&nbsp;<span class="string" id="3385571">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3385574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385577">func</span>&nbsp;<span class="op" id="3385582">(</span><span class="ident" id="3385583">a</span>&nbsp;<span class="op" id="3385585">*</span><span class="ident" id="3385586">UnixAddr</span><span class="op" id="3385594">)</span>&nbsp;<span class="ident" id="3385596">sockaddr</span><span class="op" id="3385604">(</span><span class="ident" id="3385605">family</span>&nbsp;<span class="builtintype" id="3385612">int</span><span class="op" id="3385615">)</span>&nbsp;<span class="op" id="3385617">(</span><span class="ident" id="3385618">syscall</span><span class="op" id="3385625">.</span><span class="ident" id="3385626">Sockaddr</span><span class="op" id="3385634">,</span>&nbsp;<span class="builtintype" id="3385636">error</span><span class="op" id="3385641">)</span>&nbsp;<span class="op" id="3385643">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385646">if</span>&nbsp;<span class="ident" id="3385649">a</span>&nbsp;<span class="op" id="3385651">==</span>&nbsp;<span class="builtintype" id="3385654">nil</span>&nbsp;<span class="op" id="3385658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385662">return</span>&nbsp;<span class="builtintype" id="3385669">nil</span><span class="op" id="3385672">,</span>&nbsp;<span class="builtintype" id="3385674">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3385679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3385682">return</span>&nbsp;<span class="op" id="3385689">&amp;</span><span class="ident" id="3385690">syscall</span><span class="op" id="3385697">.</span><span class="ident" id="3385698">SockaddrUnix</span><span class="op" id="3385710">{</span><span class="ident" id="3385711">Name</span><span class="op" id="3385715">:</span>&nbsp;<span class="ident" id="3385717">a</span><span class="op" id="3385718">.</span><span class="ident" id="3385719">Name</span><span class="op" id="3385723">}</span><span class="op" id="3385724">,</span>&nbsp;<span class="builtintype" id="3385726">nil</span><br>
<span class="lineno"></span><span class="op" id="3385730">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="3385733">//&nbsp;UnixConn&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;the&nbsp;Conn&nbsp;interface&nbsp;for&nbsp;connections</span><br>
<span class="lineno"></span><span class="comment" id="3385804">//&nbsp;to&nbsp;Unix&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3385831">type</span>&nbsp;<span class="ident" id="3385836">UnixConn</span>&nbsp;<span class="keyword" id="3385845">struct</span>&nbsp;<span class="op" id="3385852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3385855">conn</span><br>
<span class="lineno">105</span><span class="op" id="3385860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3385863">func</span>&nbsp;<span class="ident" id="3385868">newUnixConn</span><span class="op" id="3385879">(</span><span class="ident" id="3385880">fd</span>&nbsp;<span class="op" id="3385883">*</span><span class="ident" id="3385884">netFD</span><span class="op" id="3385889">)</span>&nbsp;<span class="op" id="3385891">*</span><span class="ident" id="3385892">UnixConn</span>&nbsp;<span class="op" id="3385901">{</span>&nbsp;<span class="keyword" id="3385903">return</span>&nbsp;<span class="op" id="3385910">&amp;</span><span class="ident" id="3385911">UnixConn</span><span class="op" id="3385919">{</span><span class="ident" id="3385920">conn</span><span class="op" id="3385924">{</span><span class="ident" id="3385925">fd</span><span class="op" id="3385927">}</span><span class="op" id="3385928">}</span>&nbsp;<span class="op" id="3385930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3385933">//&nbsp;ReadFromUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b.&nbsp;&nbsp;It</span><br>
<span class="lineno">110</span><span class="comment" id="3386004">//&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3386075">//&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="comment" id="3386090">//</span><br>
<span class="lineno"></span><span class="comment" id="3386093">//&nbsp;ReadFromUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="3386158">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="3386225">//&nbsp;SetReadDeadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3386245">func</span>&nbsp;<span class="op" id="3386250">(</span><span class="ident" id="3386251">c</span>&nbsp;<span class="op" id="3386253">*</span><span class="ident" id="3386254">UnixConn</span><span class="op" id="3386262">)</span>&nbsp;<span class="ident" id="3386264">ReadFromUnix</span><span class="op" id="3386276">(</span><span class="ident" id="3386277">b</span>&nbsp;<span class="op" id="3386279">[</span><span class="op" id="3386280">]</span><span class="builtintype" id="3386281">byte</span><span class="op" id="3386285">)</span>&nbsp;<span class="op" id="3386287">(</span><span class="ident" id="3386288">n</span>&nbsp;<span class="builtintype" id="3386290">int</span><span class="op" id="3386293">,</span>&nbsp;<span class="ident" id="3386295">addr</span>&nbsp;<span class="op" id="3386300">*</span><span class="ident" id="3386301">UnixAddr</span><span class="op" id="3386309">,</span>&nbsp;<span class="ident" id="3386311">err</span>&nbsp;<span class="builtintype" id="3386315">error</span><span class="op" id="3386320">)</span>&nbsp;<span class="op" id="3386322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386325">if</span>&nbsp;<span class="op" id="3386328">!</span><span class="ident" id="3386329">c</span><span class="op" id="3386330">.</span><span class="ident" id="3386331">ok</span><span class="op" id="3386333">(</span><span class="op" id="3386334">)</span>&nbsp;<span class="op" id="3386336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386340">return</span>&nbsp;<span class="num" id="3386347">0</span><span class="op" id="3386348">,</span>&nbsp;<span class="builtintype" id="3386350">nil</span><span class="op" id="3386353">,</span>&nbsp;<span class="ident" id="3386355">syscall</span><span class="op" id="3386362">.</span><span class="ident" id="3386363">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386371">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386374">n</span><span class="op" id="3386375">,</span>&nbsp;<span class="ident" id="3386377">sa</span><span class="op" id="3386379">,</span>&nbsp;<span class="ident" id="3386381">err</span>&nbsp;<span class="op" id="3386385">:=</span>&nbsp;<span class="ident" id="3386388">c</span><span class="op" id="3386389">.</span><span class="ident" id="3386390">fd</span><span class="op" id="3386392">.</span><span class="ident" id="3386393">readFrom</span><span class="op" id="3386401">(</span><span class="ident" id="3386402">b</span><span class="op" id="3386403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386406">switch</span>&nbsp;<span class="ident" id="3386413">sa</span>&nbsp;<span class="op" id="3386416">:=</span>&nbsp;<span class="ident" id="3386419">sa</span><span class="op" id="3386421">.</span><span class="op" id="3386422">(</span><span class="keyword" id="3386423">type</span><span class="op" id="3386427">)</span>&nbsp;<span class="op" id="3386429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386432">case</span>&nbsp;<span class="op" id="3386437">*</span><span class="ident" id="3386438">syscall</span><span class="op" id="3386445">.</span><span class="ident" id="3386446">SockaddrUnix</span><span class="op" id="3386458">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386462">if</span>&nbsp;<span class="ident" id="3386465">sa</span><span class="op" id="3386467">.</span><span class="ident" id="3386468">Name</span>&nbsp;<span class="op" id="3386473">!=</span>&nbsp;<span class="string" id="3386476">&#34;&#34;</span>&nbsp;<span class="op" id="3386479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386484">addr</span>&nbsp;<span class="op" id="3386489">=</span>&nbsp;<span class="op" id="3386491">&amp;</span><span class="ident" id="3386492">UnixAddr</span><span class="op" id="3386500">{</span><span class="ident" id="3386501">Name</span><span class="op" id="3386505">:</span>&nbsp;<span class="ident" id="3386507">sa</span><span class="op" id="3386509">.</span><span class="ident" id="3386510">Name</span><span class="op" id="3386514">,</span>&nbsp;<span class="ident" id="3386516">Net</span><span class="op" id="3386519">:</span>&nbsp;<span class="ident" id="3386521">sotypeToNet</span><span class="op" id="3386532">(</span><span class="ident" id="3386533">c</span><span class="op" id="3386534">.</span><span class="ident" id="3386535">fd</span><span class="op" id="3386537">.</span><span class="ident" id="3386538">sotype</span><span class="op" id="3386544">)</span><span class="op" id="3386545">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386555">return</span><br>
<span class="lineno"></span><span class="op" id="3386562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="3386565">//&nbsp;ReadFrom&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;ReadFrom&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3386620">func</span>&nbsp;<span class="op" id="3386625">(</span><span class="ident" id="3386626">c</span>&nbsp;<span class="op" id="3386628">*</span><span class="ident" id="3386629">UnixConn</span><span class="op" id="3386637">)</span>&nbsp;<span class="ident" id="3386639">ReadFrom</span><span class="op" id="3386647">(</span><span class="ident" id="3386648">b</span>&nbsp;<span class="op" id="3386650">[</span><span class="op" id="3386651">]</span><span class="builtintype" id="3386652">byte</span><span class="op" id="3386656">)</span>&nbsp;<span class="op" id="3386658">(</span><span class="builtintype" id="3386659">int</span><span class="op" id="3386662">,</span>&nbsp;<span class="ident" id="3386664">Addr</span><span class="op" id="3386668">,</span>&nbsp;<span class="builtintype" id="3386670">error</span><span class="op" id="3386675">)</span>&nbsp;<span class="op" id="3386677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386680">if</span>&nbsp;<span class="op" id="3386683">!</span><span class="ident" id="3386684">c</span><span class="op" id="3386685">.</span><span class="ident" id="3386686">ok</span><span class="op" id="3386688">(</span><span class="op" id="3386689">)</span>&nbsp;<span class="op" id="3386691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386695">return</span>&nbsp;<span class="num" id="3386702">0</span><span class="op" id="3386703">,</span>&nbsp;<span class="builtintype" id="3386705">nil</span><span class="op" id="3386708">,</span>&nbsp;<span class="ident" id="3386710">syscall</span><span class="op" id="3386717">.</span><span class="ident" id="3386718">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3386726">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3386729">n</span><span class="op" id="3386730">,</span>&nbsp;<span class="ident" id="3386732">addr</span><span class="op" id="3386736">,</span>&nbsp;<span class="ident" id="3386738">err</span>&nbsp;<span class="op" id="3386742">:=</span>&nbsp;<span class="ident" id="3386745">c</span><span class="op" id="3386746">.</span><span class="ident" id="3386747">ReadFromUnix</span><span class="op" id="3386759">(</span><span class="ident" id="3386760">b</span><span class="op" id="3386761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3386764">return</span>&nbsp;<span class="ident" id="3386771">n</span><span class="op" id="3386772">,</span>&nbsp;<span class="ident" id="3386774">addr</span><span class="op" id="3386778">.</span><span class="ident" id="3386779">toAddr</span><span class="op" id="3386785">(</span><span class="op" id="3386786">)</span><span class="op" id="3386787">,</span>&nbsp;<span class="ident" id="3386789">err</span><br>
<span class="lineno"></span><span class="op" id="3386793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3386796">//&nbsp;ReadMsgUnix&nbsp;reads&nbsp;a&nbsp;packet&nbsp;from&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;into&nbsp;b&nbsp;and</span><br>
<span class="lineno">140</span><span class="comment" id="3386865">//&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;into&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3386936">//&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;b,&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;copied&nbsp;into&nbsp;oob,&nbsp;the&nbsp;flags</span><br>
<span class="lineno"></span><span class="comment" id="3387007">//&nbsp;that&nbsp;were&nbsp;set&nbsp;on&nbsp;the&nbsp;packet,&nbsp;and&nbsp;the&nbsp;source&nbsp;address&nbsp;of&nbsp;the&nbsp;packet.</span><br>
<span class="lineno"></span><span class="keyword" id="3387077">func</span>&nbsp;<span class="op" id="3387082">(</span><span class="ident" id="3387083">c</span>&nbsp;<span class="op" id="3387085">*</span><span class="ident" id="3387086">UnixConn</span><span class="op" id="3387094">)</span>&nbsp;<span class="ident" id="3387096">ReadMsgUnix</span><span class="op" id="3387107">(</span><span class="ident" id="3387108">b</span><span class="op" id="3387109">,</span>&nbsp;<span class="ident" id="3387111">oob</span>&nbsp;<span class="op" id="3387115">[</span><span class="op" id="3387116">]</span><span class="builtintype" id="3387117">byte</span><span class="op" id="3387121">)</span>&nbsp;<span class="op" id="3387123">(</span><span class="ident" id="3387124">n</span><span class="op" id="3387125">,</span>&nbsp;<span class="ident" id="3387127">oobn</span><span class="op" id="3387131">,</span>&nbsp;<span class="ident" id="3387133">flags</span>&nbsp;<span class="builtintype" id="3387139">int</span><span class="op" id="3387142">,</span>&nbsp;<span class="ident" id="3387144">addr</span>&nbsp;<span class="op" id="3387149">*</span><span class="ident" id="3387150">UnixAddr</span><span class="op" id="3387158">,</span>&nbsp;<span class="ident" id="3387160">err</span>&nbsp;<span class="builtintype" id="3387164">error</span><span class="op" id="3387169">)</span>&nbsp;<span class="op" id="3387171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387174">if</span>&nbsp;<span class="op" id="3387177">!</span><span class="ident" id="3387178">c</span><span class="op" id="3387179">.</span><span class="ident" id="3387180">ok</span><span class="op" id="3387182">(</span><span class="op" id="3387183">)</span>&nbsp;<span class="op" id="3387185">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387189">return</span>&nbsp;<span class="num" id="3387196">0</span><span class="op" id="3387197">,</span>&nbsp;<span class="num" id="3387199">0</span><span class="op" id="3387200">,</span>&nbsp;<span class="num" id="3387202">0</span><span class="op" id="3387203">,</span>&nbsp;<span class="builtintype" id="3387205">nil</span><span class="op" id="3387208">,</span>&nbsp;<span class="ident" id="3387210">syscall</span><span class="op" id="3387217">.</span><span class="ident" id="3387218">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387229">n</span><span class="op" id="3387230">,</span>&nbsp;<span class="ident" id="3387232">oobn</span><span class="op" id="3387236">,</span>&nbsp;<span class="ident" id="3387238">flags</span><span class="op" id="3387243">,</span>&nbsp;<span class="ident" id="3387245">sa</span><span class="op" id="3387247">,</span>&nbsp;<span class="ident" id="3387249">err</span>&nbsp;<span class="op" id="3387253">:=</span>&nbsp;<span class="ident" id="3387256">c</span><span class="op" id="3387257">.</span><span class="ident" id="3387258">fd</span><span class="op" id="3387260">.</span><span class="ident" id="3387261">readMsg</span><span class="op" id="3387268">(</span><span class="ident" id="3387269">b</span><span class="op" id="3387270">,</span>&nbsp;<span class="ident" id="3387272">oob</span><span class="op" id="3387275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387278">switch</span>&nbsp;<span class="ident" id="3387285">sa</span>&nbsp;<span class="op" id="3387288">:=</span>&nbsp;<span class="ident" id="3387291">sa</span><span class="op" id="3387293">.</span><span class="op" id="3387294">(</span><span class="keyword" id="3387295">type</span><span class="op" id="3387299">)</span>&nbsp;<span class="op" id="3387301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387304">case</span>&nbsp;<span class="op" id="3387309">*</span><span class="ident" id="3387310">syscall</span><span class="op" id="3387317">.</span><span class="ident" id="3387318">SockaddrUnix</span><span class="op" id="3387330">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387334">if</span>&nbsp;<span class="ident" id="3387337">sa</span><span class="op" id="3387339">.</span><span class="ident" id="3387340">Name</span>&nbsp;<span class="op" id="3387345">!=</span>&nbsp;<span class="string" id="3387348">&#34;&#34;</span>&nbsp;<span class="op" id="3387351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3387356">addr</span>&nbsp;<span class="op" id="3387361">=</span>&nbsp;<span class="op" id="3387363">&amp;</span><span class="ident" id="3387364">UnixAddr</span><span class="op" id="3387372">{</span><span class="ident" id="3387373">Name</span><span class="op" id="3387377">:</span>&nbsp;<span class="ident" id="3387379">sa</span><span class="op" id="3387381">.</span><span class="ident" id="3387382">Name</span><span class="op" id="3387386">,</span>&nbsp;<span class="ident" id="3387388">Net</span><span class="op" id="3387391">:</span>&nbsp;<span class="ident" id="3387393">sotypeToNet</span><span class="op" id="3387404">(</span><span class="ident" id="3387405">c</span><span class="op" id="3387406">.</span><span class="ident" id="3387407">fd</span><span class="op" id="3387409">.</span><span class="ident" id="3387410">sotype</span><span class="op" id="3387416">)</span><span class="op" id="3387417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387427">return</span><br>
<span class="lineno">155</span><span class="op" id="3387434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3387437">//&nbsp;WriteToUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="comment" id="3387511">//</span><br>
<span class="lineno"></span><span class="comment" id="3387514">//&nbsp;WriteToUnix&nbsp;can&nbsp;be&nbsp;made&nbsp;to&nbsp;time&nbsp;out&nbsp;and&nbsp;return&nbsp;an&nbsp;error&nbsp;with</span><br>
<span class="lineno">160</span><span class="comment" id="3387578">//&nbsp;Timeout()&nbsp;==&nbsp;true&nbsp;after&nbsp;a&nbsp;fixed&nbsp;time&nbsp;limit;&nbsp;see&nbsp;SetDeadline&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3387645">//&nbsp;SetWriteDeadline.&nbsp;&nbsp;On&nbsp;packet-oriented&nbsp;connections,&nbsp;write&nbsp;timeouts</span><br>
<span class="lineno"></span><span class="comment" id="3387714">//&nbsp;are&nbsp;rare.</span><br>
<span class="lineno"></span><span class="keyword" id="3387727">func</span>&nbsp;<span class="op" id="3387732">(</span><span class="ident" id="3387733">c</span>&nbsp;<span class="op" id="3387735">*</span><span class="ident" id="3387736">UnixConn</span><span class="op" id="3387744">)</span>&nbsp;<span class="ident" id="3387746">WriteToUnix</span><span class="op" id="3387757">(</span><span class="ident" id="3387758">b</span>&nbsp;<span class="op" id="3387760">[</span><span class="op" id="3387761">]</span><span class="builtintype" id="3387762">byte</span><span class="op" id="3387766">,</span>&nbsp;<span class="ident" id="3387768">addr</span>&nbsp;<span class="op" id="3387773">*</span><span class="ident" id="3387774">UnixAddr</span><span class="op" id="3387782">)</span>&nbsp;<span class="op" id="3387784">(</span><span class="ident" id="3387785">n</span>&nbsp;<span class="builtintype" id="3387787">int</span><span class="op" id="3387790">,</span>&nbsp;<span class="ident" id="3387792">err</span>&nbsp;<span class="builtintype" id="3387796">error</span><span class="op" id="3387801">)</span>&nbsp;<span class="op" id="3387803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387806">if</span>&nbsp;<span class="op" id="3387809">!</span><span class="ident" id="3387810">c</span><span class="op" id="3387811">.</span><span class="ident" id="3387812">ok</span><span class="op" id="3387814">(</span><span class="op" id="3387815">)</span>&nbsp;<span class="op" id="3387817">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387821">return</span>&nbsp;<span class="num" id="3387828">0</span><span class="op" id="3387829">,</span>&nbsp;<span class="ident" id="3387831">syscall</span><span class="op" id="3387838">.</span><span class="ident" id="3387839">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387850">if</span>&nbsp;<span class="ident" id="3387853">c</span><span class="op" id="3387854">.</span><span class="ident" id="3387855">fd</span><span class="op" id="3387857">.</span><span class="ident" id="3387858">isConnected</span>&nbsp;<span class="op" id="3387870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387874">return</span>&nbsp;<span class="num" id="3387881">0</span><span class="op" id="3387882">,</span>&nbsp;<span class="op" id="3387884">&amp;</span><span class="ident" id="3387885">OpError</span><span class="op" id="3387892">{</span><span class="ident" id="3387893">Op</span><span class="op" id="3387895">:</span>&nbsp;<span class="string" id="3387897">&#34;write&#34;</span><span class="op" id="3387904">,</span>&nbsp;<span class="ident" id="3387906">Net</span><span class="op" id="3387909">:</span>&nbsp;<span class="ident" id="3387911">c</span><span class="op" id="3387912">.</span><span class="ident" id="3387913">fd</span><span class="op" id="3387915">.</span><span class="ident" id="3387916">net</span><span class="op" id="3387919">,</span>&nbsp;<span class="ident" id="3387921">Addr</span><span class="op" id="3387925">:</span>&nbsp;<span class="ident" id="3387927">addr</span><span class="op" id="3387931">,</span>&nbsp;<span class="ident" id="3387933">Err</span><span class="op" id="3387936">:</span>&nbsp;<span class="ident" id="3387938">ErrWriteToConnected</span><span class="op" id="3387957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3387960">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387963">if</span>&nbsp;<span class="ident" id="3387966">addr</span>&nbsp;<span class="op" id="3387971">==</span>&nbsp;<span class="builtintype" id="3387974">nil</span>&nbsp;<span class="op" id="3387978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3387982">return</span>&nbsp;<span class="num" id="3387989">0</span><span class="op" id="3387990">,</span>&nbsp;<span class="op" id="3387992">&amp;</span><span class="ident" id="3387993">OpError</span><span class="op" id="3388000">{</span><span class="ident" id="3388001">Op</span><span class="op" id="3388003">:</span>&nbsp;<span class="string" id="3388005">&#34;write&#34;</span><span class="op" id="3388012">,</span>&nbsp;<span class="ident" id="3388014">Net</span><span class="op" id="3388017">:</span>&nbsp;<span class="ident" id="3388019">c</span><span class="op" id="3388020">.</span><span class="ident" id="3388021">fd</span><span class="op" id="3388023">.</span><span class="ident" id="3388024">net</span><span class="op" id="3388027">,</span>&nbsp;<span class="ident" id="3388029">Addr</span><span class="op" id="3388033">:</span>&nbsp;<span class="builtintype" id="3388035">nil</span><span class="op" id="3388038">,</span>&nbsp;<span class="ident" id="3388040">Err</span><span class="op" id="3388043">:</span>&nbsp;<span class="ident" id="3388045">errMissingAddress</span><span class="op" id="3388062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388068">if</span>&nbsp;<span class="ident" id="3388071">addr</span><span class="op" id="3388075">.</span><span class="ident" id="3388076">Net</span>&nbsp;<span class="op" id="3388080">!=</span>&nbsp;<span class="ident" id="3388083">sotypeToNet</span><span class="op" id="3388094">(</span><span class="ident" id="3388095">c</span><span class="op" id="3388096">.</span><span class="ident" id="3388097">fd</span><span class="op" id="3388099">.</span><span class="ident" id="3388100">sotype</span><span class="op" id="3388106">)</span>&nbsp;<span class="op" id="3388108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388112">return</span>&nbsp;<span class="num" id="3388119">0</span><span class="op" id="3388120">,</span>&nbsp;<span class="ident" id="3388122">syscall</span><span class="op" id="3388129">.</span><span class="ident" id="3388130">EAFNOSUPPORT</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388147">sa</span>&nbsp;<span class="op" id="3388150">:=</span>&nbsp;<span class="op" id="3388153">&amp;</span><span class="ident" id="3388154">syscall</span><span class="op" id="3388161">.</span><span class="ident" id="3388162">SockaddrUnix</span><span class="op" id="3388174">{</span><span class="ident" id="3388175">Name</span><span class="op" id="3388179">:</span>&nbsp;<span class="ident" id="3388181">addr</span><span class="op" id="3388185">.</span><span class="ident" id="3388186">Name</span><span class="op" id="3388190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388193">return</span>&nbsp;<span class="ident" id="3388200">c</span><span class="op" id="3388201">.</span><span class="ident" id="3388202">fd</span><span class="op" id="3388204">.</span><span class="ident" id="3388205">writeTo</span><span class="op" id="3388212">(</span><span class="ident" id="3388213">b</span><span class="op" id="3388214">,</span>&nbsp;<span class="ident" id="3388216">sa</span><span class="op" id="3388218">)</span><br>
<span class="lineno"></span><span class="op" id="3388220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="3388223">//&nbsp;WriteTo&nbsp;implements&nbsp;the&nbsp;PacketConn&nbsp;WriteTo&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="3388276">func</span>&nbsp;<span class="op" id="3388281">(</span><span class="ident" id="3388282">c</span>&nbsp;<span class="op" id="3388284">*</span><span class="ident" id="3388285">UnixConn</span><span class="op" id="3388293">)</span>&nbsp;<span class="ident" id="3388295">WriteTo</span><span class="op" id="3388302">(</span><span class="ident" id="3388303">b</span>&nbsp;<span class="op" id="3388305">[</span><span class="op" id="3388306">]</span><span class="builtintype" id="3388307">byte</span><span class="op" id="3388311">,</span>&nbsp;<span class="ident" id="3388313">addr</span>&nbsp;<span class="ident" id="3388318">Addr</span><span class="op" id="3388322">)</span>&nbsp;<span class="op" id="3388324">(</span><span class="ident" id="3388325">n</span>&nbsp;<span class="builtintype" id="3388327">int</span><span class="op" id="3388330">,</span>&nbsp;<span class="ident" id="3388332">err</span>&nbsp;<span class="builtintype" id="3388336">error</span><span class="op" id="3388341">)</span>&nbsp;<span class="op" id="3388343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388346">if</span>&nbsp;<span class="op" id="3388349">!</span><span class="ident" id="3388350">c</span><span class="op" id="3388351">.</span><span class="ident" id="3388352">ok</span><span class="op" id="3388354">(</span><span class="op" id="3388355">)</span>&nbsp;<span class="op" id="3388357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388361">return</span>&nbsp;<span class="num" id="3388368">0</span><span class="op" id="3388369">,</span>&nbsp;<span class="ident" id="3388371">syscall</span><span class="op" id="3388378">.</span><span class="ident" id="3388379">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388387">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3388390">a</span><span class="op" id="3388391">,</span>&nbsp;<span class="ident" id="3388393">ok</span>&nbsp;<span class="op" id="3388396">:=</span>&nbsp;<span class="ident" id="3388399">addr</span><span class="op" id="3388403">.</span><span class="op" id="3388404">(</span><span class="op" id="3388405">*</span><span class="ident" id="3388406">UnixAddr</span><span class="op" id="3388414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388417">if</span>&nbsp;<span class="op" id="3388420">!</span><span class="ident" id="3388421">ok</span>&nbsp;<span class="op" id="3388424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388428">return</span>&nbsp;<span class="num" id="3388435">0</span><span class="op" id="3388436">,</span>&nbsp;<span class="op" id="3388438">&amp;</span><span class="ident" id="3388439">OpError</span><span class="op" id="3388446">{</span><span class="string" id="3388447">&#34;write&#34;</span><span class="op" id="3388454">,</span>&nbsp;<span class="ident" id="3388456">c</span><span class="op" id="3388457">.</span><span class="ident" id="3388458">fd</span><span class="op" id="3388460">.</span><span class="ident" id="3388461">net</span><span class="op" id="3388464">,</span>&nbsp;<span class="ident" id="3388466">addr</span><span class="op" id="3388470">,</span>&nbsp;<span class="ident" id="3388472">syscall</span><span class="op" id="3388479">.</span><span class="ident" id="3388480">EINVAL</span><span class="op" id="3388486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388492">return</span>&nbsp;<span class="ident" id="3388499">c</span><span class="op" id="3388500">.</span><span class="ident" id="3388501">WriteToUnix</span><span class="op" id="3388512">(</span><span class="ident" id="3388513">b</span><span class="op" id="3388514">,</span>&nbsp;<span class="ident" id="3388516">a</span><span class="op" id="3388517">)</span><br>
<span class="lineno">190</span><span class="op" id="3388519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3388522">//&nbsp;WriteMsgUnix&nbsp;writes&nbsp;a&nbsp;packet&nbsp;to&nbsp;addr&nbsp;via&nbsp;c,&nbsp;copying&nbsp;the&nbsp;payload</span><br>
<span class="lineno"></span><span class="comment" id="3388589">//&nbsp;from&nbsp;b&nbsp;and&nbsp;the&nbsp;associated&nbsp;out-of-band&nbsp;data&nbsp;from&nbsp;oob.&nbsp;&nbsp;It&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3388657">//&nbsp;the&nbsp;number&nbsp;of&nbsp;payload&nbsp;and&nbsp;out-of-band&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">195</span><span class="keyword" id="3388713">func</span>&nbsp;<span class="op" id="3388718">(</span><span class="ident" id="3388719">c</span>&nbsp;<span class="op" id="3388721">*</span><span class="ident" id="3388722">UnixConn</span><span class="op" id="3388730">)</span>&nbsp;<span class="ident" id="3388732">WriteMsgUnix</span><span class="op" id="3388744">(</span><span class="ident" id="3388745">b</span><span class="op" id="3388746">,</span>&nbsp;<span class="ident" id="3388748">oob</span>&nbsp;<span class="op" id="3388752">[</span><span class="op" id="3388753">]</span><span class="builtintype" id="3388754">byte</span><span class="op" id="3388758">,</span>&nbsp;<span class="ident" id="3388760">addr</span>&nbsp;<span class="op" id="3388765">*</span><span class="ident" id="3388766">UnixAddr</span><span class="op" id="3388774">)</span>&nbsp;<span class="op" id="3388776">(</span><span class="ident" id="3388777">n</span><span class="op" id="3388778">,</span>&nbsp;<span class="ident" id="3388780">oobn</span>&nbsp;<span class="builtintype" id="3388785">int</span><span class="op" id="3388788">,</span>&nbsp;<span class="ident" id="3388790">err</span>&nbsp;<span class="builtintype" id="3388794">error</span><span class="op" id="3388799">)</span>&nbsp;<span class="op" id="3388801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388804">if</span>&nbsp;<span class="op" id="3388807">!</span><span class="ident" id="3388808">c</span><span class="op" id="3388809">.</span><span class="ident" id="3388810">ok</span><span class="op" id="3388812">(</span><span class="op" id="3388813">)</span>&nbsp;<span class="op" id="3388815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388819">return</span>&nbsp;<span class="num" id="3388826">0</span><span class="op" id="3388827">,</span>&nbsp;<span class="num" id="3388829">0</span><span class="op" id="3388830">,</span>&nbsp;<span class="ident" id="3388832">syscall</span><span class="op" id="3388839">.</span><span class="ident" id="3388840">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3388848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388851">if</span>&nbsp;<span class="ident" id="3388854">c</span><span class="op" id="3388855">.</span><span class="ident" id="3388856">fd</span><span class="op" id="3388858">.</span><span class="ident" id="3388859">sotype</span>&nbsp;<span class="op" id="3388866">==</span>&nbsp;<span class="ident" id="3388869">syscall</span><span class="op" id="3388876">.</span><span class="ident" id="3388877">SOCK_DGRAM</span>&nbsp;<span class="op" id="3388888">&amp;&amp;</span>&nbsp;<span class="ident" id="3388891">c</span><span class="op" id="3388892">.</span><span class="ident" id="3388893">fd</span><span class="op" id="3388895">.</span><span class="ident" id="3388896">isConnected</span>&nbsp;<span class="op" id="3388908">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3388912">return</span>&nbsp;<span class="num" id="3388919">0</span><span class="op" id="3388920">,</span>&nbsp;<span class="num" id="3388922">0</span><span class="op" id="3388923">,</span>&nbsp;<span class="op" id="3388925">&amp;</span><span class="ident" id="3388926">OpError</span><span class="op" id="3388933">{</span><span class="ident" id="3388934">Op</span><span class="op" id="3388936">:</span>&nbsp;<span class="string" id="3388938">&#34;write&#34;</span><span class="op" id="3388945">,</span>&nbsp;<span class="ident" id="3388947">Net</span><span class="op" id="3388950">:</span>&nbsp;<span class="ident" id="3388952">c</span><span class="op" id="3388953">.</span><span class="ident" id="3388954">fd</span><span class="op" id="3388956">.</span><span class="ident" id="3388957">net</span><span class="op" id="3388960">,</span>&nbsp;<span class="ident" id="3388962">Addr</span><span class="op" id="3388966">:</span>&nbsp;<span class="ident" id="3388968">addr</span><span class="op" id="3388972">,</span>&nbsp;<span class="ident" id="3388974">Err</span><span class="op" id="3388977">:</span>&nbsp;<span class="ident" id="3388979">ErrWriteToConnected</span><span class="op" id="3388998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389004">if</span>&nbsp;<span class="ident" id="3389007">addr</span>&nbsp;<span class="op" id="3389012">!=</span>&nbsp;<span class="builtintype" id="3389015">nil</span>&nbsp;<span class="op" id="3389019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389023">if</span>&nbsp;<span class="ident" id="3389026">addr</span><span class="op" id="3389030">.</span><span class="ident" id="3389031">Net</span>&nbsp;<span class="op" id="3389035">!=</span>&nbsp;<span class="ident" id="3389038">sotypeToNet</span><span class="op" id="3389049">(</span><span class="ident" id="3389050">c</span><span class="op" id="3389051">.</span><span class="ident" id="3389052">fd</span><span class="op" id="3389054">.</span><span class="ident" id="3389055">sotype</span><span class="op" id="3389061">)</span>&nbsp;<span class="op" id="3389063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389068">return</span>&nbsp;<span class="num" id="3389075">0</span><span class="op" id="3389076">,</span>&nbsp;<span class="num" id="3389078">0</span><span class="op" id="3389079">,</span>&nbsp;<span class="ident" id="3389081">syscall</span><span class="op" id="3389088">.</span><span class="ident" id="3389089">EAFNOSUPPORT</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3389108">sa</span>&nbsp;<span class="op" id="3389111">:=</span>&nbsp;<span class="op" id="3389114">&amp;</span><span class="ident" id="3389115">syscall</span><span class="op" id="3389122">.</span><span class="ident" id="3389123">SockaddrUnix</span><span class="op" id="3389135">{</span><span class="ident" id="3389136">Name</span><span class="op" id="3389140">:</span>&nbsp;<span class="ident" id="3389142">addr</span><span class="op" id="3389146">.</span><span class="ident" id="3389147">Name</span><span class="op" id="3389151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389155">return</span>&nbsp;<span class="ident" id="3389162">c</span><span class="op" id="3389163">.</span><span class="ident" id="3389164">fd</span><span class="op" id="3389166">.</span><span class="ident" id="3389167">writeMsg</span><span class="op" id="3389175">(</span><span class="ident" id="3389176">b</span><span class="op" id="3389177">,</span>&nbsp;<span class="ident" id="3389179">oob</span><span class="op" id="3389182">,</span>&nbsp;<span class="ident" id="3389184">sa</span><span class="op" id="3389186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389192">return</span>&nbsp;<span class="ident" id="3389199">c</span><span class="op" id="3389200">.</span><span class="ident" id="3389201">fd</span><span class="op" id="3389203">.</span><span class="ident" id="3389204">writeMsg</span><span class="op" id="3389212">(</span><span class="ident" id="3389213">b</span><span class="op" id="3389214">,</span>&nbsp;<span class="ident" id="3389216">oob</span><span class="op" id="3389219">,</span>&nbsp;<span class="builtintype" id="3389221">nil</span><span class="op" id="3389224">)</span><br>
<span class="lineno">210</span><span class="op" id="3389226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3389229">//&nbsp;CloseRead&nbsp;shuts&nbsp;down&nbsp;the&nbsp;reading&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3389301">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3389340">func</span>&nbsp;<span class="op" id="3389345">(</span><span class="ident" id="3389346">c</span>&nbsp;<span class="op" id="3389348">*</span><span class="ident" id="3389349">UnixConn</span><span class="op" id="3389357">)</span>&nbsp;<span class="ident" id="3389359">CloseRead</span><span class="op" id="3389368">(</span><span class="op" id="3389369">)</span>&nbsp;<span class="builtintype" id="3389371">error</span>&nbsp;<span class="op" id="3389377">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389380">if</span>&nbsp;<span class="op" id="3389383">!</span><span class="ident" id="3389384">c</span><span class="op" id="3389385">.</span><span class="ident" id="3389386">ok</span><span class="op" id="3389388">(</span><span class="op" id="3389389">)</span>&nbsp;<span class="op" id="3389391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389395">return</span>&nbsp;<span class="ident" id="3389402">syscall</span><span class="op" id="3389409">.</span><span class="ident" id="3389410">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389421">return</span>&nbsp;<span class="ident" id="3389428">c</span><span class="op" id="3389429">.</span><span class="ident" id="3389430">fd</span><span class="op" id="3389432">.</span><span class="ident" id="3389433">closeRead</span><span class="op" id="3389442">(</span><span class="op" id="3389443">)</span><br>
<span class="lineno"></span><span class="op" id="3389445">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3389448">//&nbsp;CloseWrite&nbsp;shuts&nbsp;down&nbsp;the&nbsp;writing&nbsp;side&nbsp;of&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="3389521">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;just&nbsp;use&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3389560">func</span>&nbsp;<span class="op" id="3389565">(</span><span class="ident" id="3389566">c</span>&nbsp;<span class="op" id="3389568">*</span><span class="ident" id="3389569">UnixConn</span><span class="op" id="3389577">)</span>&nbsp;<span class="ident" id="3389579">CloseWrite</span><span class="op" id="3389589">(</span><span class="op" id="3389590">)</span>&nbsp;<span class="builtintype" id="3389592">error</span>&nbsp;<span class="op" id="3389598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389601">if</span>&nbsp;<span class="op" id="3389604">!</span><span class="ident" id="3389605">c</span><span class="op" id="3389606">.</span><span class="ident" id="3389607">ok</span><span class="op" id="3389609">(</span><span class="op" id="3389610">)</span>&nbsp;<span class="op" id="3389612">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389616">return</span>&nbsp;<span class="ident" id="3389623">syscall</span><span class="op" id="3389630">.</span><span class="ident" id="3389631">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3389639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389642">return</span>&nbsp;<span class="ident" id="3389649">c</span><span class="op" id="3389650">.</span><span class="ident" id="3389651">fd</span><span class="op" id="3389653">.</span><span class="ident" id="3389654">closeWrite</span><span class="op" id="3389664">(</span><span class="op" id="3389665">)</span><br>
<span class="lineno"></span><span class="op" id="3389667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="comment" id="3389670">//&nbsp;DialUnix&nbsp;connects&nbsp;to&nbsp;the&nbsp;remote&nbsp;address&nbsp;raddr&nbsp;on&nbsp;the&nbsp;network&nbsp;net,</span><br>
<span class="lineno"></span><span class="comment" id="3389739">//&nbsp;which&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.&nbsp;&nbsp;If&nbsp;laddr&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3389809">//&nbsp;nil,&nbsp;it&nbsp;is&nbsp;used&nbsp;as&nbsp;the&nbsp;local&nbsp;address&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3389869">func</span>&nbsp;<span class="ident" id="3389874">DialUnix</span><span class="op" id="3389882">(</span><span class="ident" id="3389883">net</span>&nbsp;<span class="builtintype" id="3389887">string</span><span class="op" id="3389893">,</span>&nbsp;<span class="ident" id="3389895">laddr</span><span class="op" id="3389900">,</span>&nbsp;<span class="ident" id="3389902">raddr</span>&nbsp;<span class="op" id="3389908">*</span><span class="ident" id="3389909">UnixAddr</span><span class="op" id="3389917">)</span>&nbsp;<span class="op" id="3389919">(</span><span class="op" id="3389920">*</span><span class="ident" id="3389921">UnixConn</span><span class="op" id="3389929">,</span>&nbsp;<span class="builtintype" id="3389931">error</span><span class="op" id="3389936">)</span>&nbsp;<span class="op" id="3389938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389941">switch</span>&nbsp;<span class="ident" id="3389948">net</span>&nbsp;<span class="op" id="3389952">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389955">case</span>&nbsp;<span class="string" id="3389960">&#34;unix&#34;</span><span class="op" id="3389966">,</span>&nbsp;<span class="string" id="3389968">&#34;unixgram&#34;</span><span class="op" id="3389978">,</span>&nbsp;<span class="string" id="3389980">&#34;unixpacket&#34;</span><span class="op" id="3389992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3389995">default</span><span class="op" id="3390002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390006">return</span>&nbsp;<span class="builtintype" id="3390013">nil</span><span class="op" id="3390016">,</span>&nbsp;<span class="op" id="3390018">&amp;</span><span class="ident" id="3390019">OpError</span><span class="op" id="3390026">{</span><span class="ident" id="3390027">Op</span><span class="op" id="3390029">:</span>&nbsp;<span class="string" id="3390031">&#34;dial&#34;</span><span class="op" id="3390037">,</span>&nbsp;<span class="ident" id="3390039">Net</span><span class="op" id="3390042">:</span>&nbsp;<span class="ident" id="3390044">net</span><span class="op" id="3390047">,</span>&nbsp;<span class="ident" id="3390049">Addr</span><span class="op" id="3390053">:</span>&nbsp;<span class="ident" id="3390055">raddr</span><span class="op" id="3390060">,</span>&nbsp;<span class="ident" id="3390062">Err</span><span class="op" id="3390065">:</span>&nbsp;<span class="ident" id="3390067">UnknownNetworkError</span><span class="op" id="3390086">(</span><span class="ident" id="3390087">net</span><span class="op" id="3390090">)</span><span class="op" id="3390091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390097">return</span>&nbsp;<span class="ident" id="3390104">dialUnix</span><span class="op" id="3390112">(</span><span class="ident" id="3390113">net</span><span class="op" id="3390116">,</span>&nbsp;<span class="ident" id="3390118">laddr</span><span class="op" id="3390123">,</span>&nbsp;<span class="ident" id="3390125">raddr</span><span class="op" id="3390130">,</span>&nbsp;<span class="ident" id="3390132">noDeadline</span><span class="op" id="3390142">)</span><br>
<span class="lineno">240</span><span class="op" id="3390144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3390147">func</span>&nbsp;<span class="ident" id="3390152">dialUnix</span><span class="op" id="3390160">(</span><span class="ident" id="3390161">net</span>&nbsp;<span class="builtintype" id="3390165">string</span><span class="op" id="3390171">,</span>&nbsp;<span class="ident" id="3390173">laddr</span><span class="op" id="3390178">,</span>&nbsp;<span class="ident" id="3390180">raddr</span>&nbsp;<span class="op" id="3390186">*</span><span class="ident" id="3390187">UnixAddr</span><span class="op" id="3390195">,</span>&nbsp;<span class="ident" id="3390197">deadline</span>&nbsp;<span class="ident" id="3390206">time</span><span class="op" id="3390210">.</span><span class="ident" id="3390211">Time</span><span class="op" id="3390215">)</span>&nbsp;<span class="op" id="3390217">(</span><span class="op" id="3390218">*</span><span class="ident" id="3390219">UnixConn</span><span class="op" id="3390227">,</span>&nbsp;<span class="builtintype" id="3390229">error</span><span class="op" id="3390234">)</span>&nbsp;<span class="op" id="3390236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390239">fd</span><span class="op" id="3390241">,</span>&nbsp;<span class="ident" id="3390243">err</span>&nbsp;<span class="op" id="3390247">:=</span>&nbsp;<span class="ident" id="3390250">unixSocket</span><span class="op" id="3390260">(</span><span class="ident" id="3390261">net</span><span class="op" id="3390264">,</span>&nbsp;<span class="ident" id="3390266">laddr</span><span class="op" id="3390271">,</span>&nbsp;<span class="ident" id="3390273">raddr</span><span class="op" id="3390278">,</span>&nbsp;<span class="string" id="3390280">&#34;dial&#34;</span><span class="op" id="3390286">,</span>&nbsp;<span class="ident" id="3390288">deadline</span><span class="op" id="3390296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390299">if</span>&nbsp;<span class="ident" id="3390302">err</span>&nbsp;<span class="op" id="3390306">!=</span>&nbsp;<span class="builtintype" id="3390309">nil</span>&nbsp;<span class="op" id="3390313">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390317">return</span>&nbsp;<span class="builtintype" id="3390324">nil</span><span class="op" id="3390327">,</span>&nbsp;<span class="op" id="3390329">&amp;</span><span class="ident" id="3390330">OpError</span><span class="op" id="3390337">{</span><span class="ident" id="3390338">Op</span><span class="op" id="3390340">:</span>&nbsp;<span class="string" id="3390342">&#34;dial&#34;</span><span class="op" id="3390348">,</span>&nbsp;<span class="ident" id="3390350">Net</span><span class="op" id="3390353">:</span>&nbsp;<span class="ident" id="3390355">net</span><span class="op" id="3390358">,</span>&nbsp;<span class="ident" id="3390360">Addr</span><span class="op" id="3390364">:</span>&nbsp;<span class="ident" id="3390366">raddr</span><span class="op" id="3390371">,</span>&nbsp;<span class="ident" id="3390373">Err</span><span class="op" id="3390376">:</span>&nbsp;<span class="ident" id="3390378">err</span><span class="op" id="3390381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390387">return</span>&nbsp;<span class="ident" id="3390394">newUnixConn</span><span class="op" id="3390405">(</span><span class="ident" id="3390406">fd</span><span class="op" id="3390408">)</span><span class="op" id="3390409">,</span>&nbsp;<span class="builtintype" id="3390411">nil</span><br>
<span class="lineno"></span><span class="op" id="3390415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="3390418">//&nbsp;UnixListener&nbsp;is&nbsp;a&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;listener.&nbsp;&nbsp;Clients&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="3390484">//&nbsp;typically&nbsp;use&nbsp;variables&nbsp;of&nbsp;type&nbsp;Listener&nbsp;instead&nbsp;of&nbsp;assuming&nbsp;Unix</span><br>
<span class="lineno"></span><span class="comment" id="3390553">//&nbsp;domain&nbsp;sockets.</span><br>
<span class="lineno"></span><span class="keyword" id="3390572">type</span>&nbsp;<span class="ident" id="3390577">UnixListener</span>&nbsp;<span class="keyword" id="3390590">struct</span>&nbsp;<span class="op" id="3390597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390600">fd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3390605">*</span><span class="ident" id="3390606">netFD</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3390613">path</span>&nbsp;<span class="builtintype" id="3390618">string</span><br>
<span class="lineno"></span><span class="op" id="3390625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3390628">//&nbsp;ListenUnix&nbsp;announces&nbsp;on&nbsp;the&nbsp;Unix&nbsp;domain&nbsp;socket&nbsp;laddr&nbsp;and&nbsp;returns&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3390698">//&nbsp;Unix&nbsp;listener.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno">260</span><span class="keyword" id="3390765">func</span>&nbsp;<span class="ident" id="3390770">ListenUnix</span><span class="op" id="3390780">(</span><span class="ident" id="3390781">net</span>&nbsp;<span class="builtintype" id="3390785">string</span><span class="op" id="3390791">,</span>&nbsp;<span class="ident" id="3390793">laddr</span>&nbsp;<span class="op" id="3390799">*</span><span class="ident" id="3390800">UnixAddr</span><span class="op" id="3390808">)</span>&nbsp;<span class="op" id="3390810">(</span><span class="op" id="3390811">*</span><span class="ident" id="3390812">UnixListener</span><span class="op" id="3390824">,</span>&nbsp;<span class="builtintype" id="3390826">error</span><span class="op" id="3390831">)</span>&nbsp;<span class="op" id="3390833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390836">switch</span>&nbsp;<span class="ident" id="3390843">net</span>&nbsp;<span class="op" id="3390847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390850">case</span>&nbsp;<span class="string" id="3390855">&#34;unix&#34;</span><span class="op" id="3390861">,</span>&nbsp;<span class="string" id="3390863">&#34;unixpacket&#34;</span><span class="op" id="3390875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390878">default</span><span class="op" id="3390885">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390889">return</span>&nbsp;<span class="builtintype" id="3390896">nil</span><span class="op" id="3390899">,</span>&nbsp;<span class="op" id="3390901">&amp;</span><span class="ident" id="3390902">OpError</span><span class="op" id="3390909">{</span><span class="ident" id="3390910">Op</span><span class="op" id="3390912">:</span>&nbsp;<span class="string" id="3390914">&#34;listen&#34;</span><span class="op" id="3390922">,</span>&nbsp;<span class="ident" id="3390924">Net</span><span class="op" id="3390927">:</span>&nbsp;<span class="ident" id="3390929">net</span><span class="op" id="3390932">,</span>&nbsp;<span class="ident" id="3390934">Addr</span><span class="op" id="3390938">:</span>&nbsp;<span class="ident" id="3390940">laddr</span><span class="op" id="3390945">,</span>&nbsp;<span class="ident" id="3390947">Err</span><span class="op" id="3390950">:</span>&nbsp;<span class="ident" id="3390952">UnknownNetworkError</span><span class="op" id="3390971">(</span><span class="ident" id="3390972">net</span><span class="op" id="3390975">)</span><span class="op" id="3390976">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3390979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3390982">if</span>&nbsp;<span class="ident" id="3390985">laddr</span>&nbsp;<span class="op" id="3390991">==</span>&nbsp;<span class="builtintype" id="3390994">nil</span>&nbsp;<span class="op" id="3390998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391002">return</span>&nbsp;<span class="builtintype" id="3391009">nil</span><span class="op" id="3391012">,</span>&nbsp;<span class="op" id="3391014">&amp;</span><span class="ident" id="3391015">OpError</span><span class="op" id="3391022">{</span><span class="ident" id="3391023">Op</span><span class="op" id="3391025">:</span>&nbsp;<span class="string" id="3391027">&#34;listen&#34;</span><span class="op" id="3391035">,</span>&nbsp;<span class="ident" id="3391037">Net</span><span class="op" id="3391040">:</span>&nbsp;<span class="ident" id="3391042">net</span><span class="op" id="3391045">,</span>&nbsp;<span class="ident" id="3391047">Addr</span><span class="op" id="3391051">:</span>&nbsp;<span class="builtintype" id="3391053">nil</span><span class="op" id="3391056">,</span>&nbsp;<span class="ident" id="3391058">Err</span><span class="op" id="3391061">:</span>&nbsp;<span class="ident" id="3391063">errMissingAddress</span><span class="op" id="3391080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391086">fd</span><span class="op" id="3391088">,</span>&nbsp;<span class="ident" id="3391090">err</span>&nbsp;<span class="op" id="3391094">:=</span>&nbsp;<span class="ident" id="3391097">unixSocket</span><span class="op" id="3391107">(</span><span class="ident" id="3391108">net</span><span class="op" id="3391111">,</span>&nbsp;<span class="ident" id="3391113">laddr</span><span class="op" id="3391118">,</span>&nbsp;<span class="builtintype" id="3391120">nil</span><span class="op" id="3391123">,</span>&nbsp;<span class="string" id="3391125">&#34;listen&#34;</span><span class="op" id="3391133">,</span>&nbsp;<span class="ident" id="3391135">noDeadline</span><span class="op" id="3391145">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391148">if</span>&nbsp;<span class="ident" id="3391151">err</span>&nbsp;<span class="op" id="3391155">!=</span>&nbsp;<span class="builtintype" id="3391158">nil</span>&nbsp;<span class="op" id="3391162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391166">return</span>&nbsp;<span class="builtintype" id="3391173">nil</span><span class="op" id="3391176">,</span>&nbsp;<span class="op" id="3391178">&amp;</span><span class="ident" id="3391179">OpError</span><span class="op" id="3391186">{</span><span class="ident" id="3391187">Op</span><span class="op" id="3391189">:</span>&nbsp;<span class="string" id="3391191">&#34;listen&#34;</span><span class="op" id="3391199">,</span>&nbsp;<span class="ident" id="3391201">Net</span><span class="op" id="3391204">:</span>&nbsp;<span class="ident" id="3391206">net</span><span class="op" id="3391209">,</span>&nbsp;<span class="ident" id="3391211">Addr</span><span class="op" id="3391215">:</span>&nbsp;<span class="ident" id="3391217">laddr</span><span class="op" id="3391222">,</span>&nbsp;<span class="ident" id="3391224">Err</span><span class="op" id="3391227">:</span>&nbsp;<span class="ident" id="3391229">err</span><span class="op" id="3391232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391238">return</span>&nbsp;<span class="op" id="3391245">&amp;</span><span class="ident" id="3391246">UnixListener</span><span class="op" id="3391258">{</span><span class="ident" id="3391259">fd</span><span class="op" id="3391261">,</span>&nbsp;<span class="ident" id="3391263">fd</span><span class="op" id="3391265">.</span><span class="ident" id="3391266">laddr</span><span class="op" id="3391271">.</span><span class="ident" id="3391272">String</span><span class="op" id="3391278">(</span><span class="op" id="3391279">)</span><span class="op" id="3391280">}</span><span class="op" id="3391281">,</span>&nbsp;<span class="builtintype" id="3391283">nil</span><br>
<span class="lineno"></span><span class="op" id="3391287">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="3391290">//&nbsp;AcceptUnix&nbsp;accepts&nbsp;the&nbsp;next&nbsp;incoming&nbsp;call&nbsp;and&nbsp;returns&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3391355">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3391370">func</span>&nbsp;<span class="op" id="3391375">(</span><span class="ident" id="3391376">l</span>&nbsp;<span class="op" id="3391378">*</span><span class="ident" id="3391379">UnixListener</span><span class="op" id="3391391">)</span>&nbsp;<span class="ident" id="3391393">AcceptUnix</span><span class="op" id="3391403">(</span><span class="op" id="3391404">)</span>&nbsp;<span class="op" id="3391406">(</span><span class="op" id="3391407">*</span><span class="ident" id="3391408">UnixConn</span><span class="op" id="3391416">,</span>&nbsp;<span class="builtintype" id="3391418">error</span><span class="op" id="3391423">)</span>&nbsp;<span class="op" id="3391425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391428">if</span>&nbsp;<span class="ident" id="3391431">l</span>&nbsp;<span class="op" id="3391433">==</span>&nbsp;<span class="builtintype" id="3391436">nil</span>&nbsp;<span class="op" id="3391440">||</span>&nbsp;<span class="ident" id="3391443">l</span><span class="op" id="3391444">.</span><span class="ident" id="3391445">fd</span>&nbsp;<span class="op" id="3391448">==</span>&nbsp;<span class="builtintype" id="3391451">nil</span>&nbsp;<span class="op" id="3391455">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391459">return</span>&nbsp;<span class="builtintype" id="3391466">nil</span><span class="op" id="3391469">,</span>&nbsp;<span class="ident" id="3391471">syscall</span><span class="op" id="3391478">.</span><span class="ident" id="3391479">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391490">fd</span><span class="op" id="3391492">,</span>&nbsp;<span class="ident" id="3391494">err</span>&nbsp;<span class="op" id="3391498">:=</span>&nbsp;<span class="ident" id="3391501">l</span><span class="op" id="3391502">.</span><span class="ident" id="3391503">fd</span><span class="op" id="3391505">.</span><span class="ident" id="3391506">accept</span><span class="op" id="3391512">(</span><span class="op" id="3391513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391516">if</span>&nbsp;<span class="ident" id="3391519">err</span>&nbsp;<span class="op" id="3391523">!=</span>&nbsp;<span class="builtintype" id="3391526">nil</span>&nbsp;<span class="op" id="3391530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391534">return</span>&nbsp;<span class="builtintype" id="3391541">nil</span><span class="op" id="3391544">,</span>&nbsp;<span class="ident" id="3391546">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391554">c</span>&nbsp;<span class="op" id="3391556">:=</span>&nbsp;<span class="ident" id="3391559">newUnixConn</span><span class="op" id="3391570">(</span><span class="ident" id="3391571">fd</span><span class="op" id="3391573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391576">return</span>&nbsp;<span class="ident" id="3391583">c</span><span class="op" id="3391584">,</span>&nbsp;<span class="builtintype" id="3391586">nil</span><br>
<span class="lineno"></span><span class="op" id="3391590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="comment" id="3391593">//&nbsp;Accept&nbsp;implements&nbsp;the&nbsp;Accept&nbsp;method&nbsp;in&nbsp;the&nbsp;Listener&nbsp;interface;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3391662">//&nbsp;waits&nbsp;for&nbsp;the&nbsp;next&nbsp;call&nbsp;and&nbsp;returns&nbsp;a&nbsp;generic&nbsp;Conn.</span><br>
<span class="lineno"></span><span class="keyword" id="3391717">func</span>&nbsp;<span class="op" id="3391722">(</span><span class="ident" id="3391723">l</span>&nbsp;<span class="op" id="3391725">*</span><span class="ident" id="3391726">UnixListener</span><span class="op" id="3391738">)</span>&nbsp;<span class="ident" id="3391740">Accept</span><span class="op" id="3391746">(</span><span class="op" id="3391747">)</span>&nbsp;<span class="op" id="3391749">(</span><span class="ident" id="3391750">c</span>&nbsp;<span class="ident" id="3391752">Conn</span><span class="op" id="3391756">,</span>&nbsp;<span class="ident" id="3391758">err</span>&nbsp;<span class="builtintype" id="3391762">error</span><span class="op" id="3391767">)</span>&nbsp;<span class="op" id="3391769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3391772">c1</span><span class="op" id="3391774">,</span>&nbsp;<span class="ident" id="3391776">err</span>&nbsp;<span class="op" id="3391780">:=</span>&nbsp;<span class="ident" id="3391783">l</span><span class="op" id="3391784">.</span><span class="ident" id="3391785">AcceptUnix</span><span class="op" id="3391795">(</span><span class="op" id="3391796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391799">if</span>&nbsp;<span class="ident" id="3391802">err</span>&nbsp;<span class="op" id="3391806">!=</span>&nbsp;<span class="builtintype" id="3391809">nil</span>&nbsp;<span class="op" id="3391813">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391817">return</span>&nbsp;<span class="builtintype" id="3391824">nil</span><span class="op" id="3391827">,</span>&nbsp;<span class="ident" id="3391829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3391834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391837">return</span>&nbsp;<span class="ident" id="3391844">c1</span><span class="op" id="3391846">,</span>&nbsp;<span class="builtintype" id="3391848">nil</span><br>
<span class="lineno"></span><span class="op" id="3391852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="comment" id="3391855">//&nbsp;Close&nbsp;stops&nbsp;listening&nbsp;on&nbsp;the&nbsp;Unix&nbsp;address.&nbsp;&nbsp;Already&nbsp;accepted</span><br>
<span class="lineno"></span><span class="comment" id="3391919">//&nbsp;connections&nbsp;are&nbsp;not&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="3391950">func</span>&nbsp;<span class="op" id="3391955">(</span><span class="ident" id="3391956">l</span>&nbsp;<span class="op" id="3391958">*</span><span class="ident" id="3391959">UnixListener</span><span class="op" id="3391971">)</span>&nbsp;<span class="ident" id="3391973">Close</span><span class="op" id="3391978">(</span><span class="op" id="3391979">)</span>&nbsp;<span class="builtintype" id="3391981">error</span>&nbsp;<span class="op" id="3391987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3391990">if</span>&nbsp;<span class="ident" id="3391993">l</span>&nbsp;<span class="op" id="3391995">==</span>&nbsp;<span class="builtintype" id="3391998">nil</span>&nbsp;<span class="op" id="3392002">||</span>&nbsp;<span class="ident" id="3392005">l</span><span class="op" id="3392006">.</span><span class="ident" id="3392007">fd</span>&nbsp;<span class="op" id="3392010">==</span>&nbsp;<span class="builtintype" id="3392013">nil</span>&nbsp;<span class="op" id="3392017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392021">return</span>&nbsp;<span class="ident" id="3392028">syscall</span><span class="op" id="3392035">.</span><span class="ident" id="3392036">EINVAL</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392048">//&nbsp;The&nbsp;operating&nbsp;system&nbsp;doesn&#39;t&nbsp;clean&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392090">//&nbsp;the&nbsp;file&nbsp;that&nbsp;announcing&nbsp;created,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392131">//&nbsp;we&nbsp;have&nbsp;to&nbsp;clean&nbsp;it&nbsp;up&nbsp;ourselves.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392169">//&nbsp;There&#39;s&nbsp;a&nbsp;race&nbsp;here--we&nbsp;can&#39;t&nbsp;know&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392212">//&nbsp;sure&nbsp;whether&nbsp;someone&nbsp;else&nbsp;has&nbsp;come&nbsp;along</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392257">//&nbsp;and&nbsp;replaced&nbsp;our&nbsp;socket&nbsp;name&nbsp;already--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392300">//&nbsp;but&nbsp;this&nbsp;sequence&nbsp;(remove&nbsp;then&nbsp;close)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392342">//&nbsp;is&nbsp;at&nbsp;least&nbsp;compatible&nbsp;with&nbsp;the&nbsp;auto-remove</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392390">//&nbsp;sequence&nbsp;in&nbsp;ListenUnix.&nbsp;&nbsp;It&#39;s&nbsp;only&nbsp;non-Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392436">//&nbsp;programs&nbsp;that&nbsp;can&nbsp;mess&nbsp;us&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392470">if</span>&nbsp;<span class="ident" id="3392473">l</span><span class="op" id="3392474">.</span><span class="ident" id="3392475">path</span><span class="op" id="3392479">[</span><span class="num" id="3392480">0</span><span class="op" id="3392481">]</span>&nbsp;<span class="op" id="3392483">!=</span>&nbsp;<span class="string" id="3392486">&#39;@&#39;</span>&nbsp;<span class="op" id="3392490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3392494">syscall</span><span class="op" id="3392501">.</span><span class="ident" id="3392502">Unlink</span><span class="op" id="3392508">(</span><span class="ident" id="3392509">l</span><span class="op" id="3392510">.</span><span class="ident" id="3392511">path</span><span class="op" id="3392515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392518">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392521">return</span>&nbsp;<span class="ident" id="3392528">l</span><span class="op" id="3392529">.</span><span class="ident" id="3392530">fd</span><span class="op" id="3392532">.</span><span class="ident" id="3392533">Close</span><span class="op" id="3392538">(</span><span class="op" id="3392539">)</span><br>
<span class="lineno"></span><span class="op" id="3392541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3392544">//&nbsp;Addr&nbsp;returns&nbsp;the&nbsp;listener&#39;s&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="3392592">func</span>&nbsp;<span class="op" id="3392597">(</span><span class="ident" id="3392598">l</span>&nbsp;<span class="op" id="3392600">*</span><span class="ident" id="3392601">UnixListener</span><span class="op" id="3392613">)</span>&nbsp;<span class="ident" id="3392615">Addr</span><span class="op" id="3392619">(</span><span class="op" id="3392620">)</span>&nbsp;<span class="ident" id="3392622">Addr</span>&nbsp;<span class="op" id="3392627">{</span>&nbsp;<span class="keyword" id="3392629">return</span>&nbsp;<span class="ident" id="3392636">l</span><span class="op" id="3392637">.</span><span class="ident" id="3392638">fd</span><span class="op" id="3392640">.</span><span class="ident" id="3392641">laddr</span>&nbsp;<span class="op" id="3392647">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="3392650">//&nbsp;SetDeadline&nbsp;sets&nbsp;the&nbsp;deadline&nbsp;associated&nbsp;with&nbsp;the&nbsp;listener.</span><br>
<span class="lineno"></span><span class="comment" id="3392713">//&nbsp;A&nbsp;zero&nbsp;time&nbsp;value&nbsp;disables&nbsp;the&nbsp;deadline.</span><br>
<span class="lineno"></span><span class="keyword" id="3392757">func</span>&nbsp;<span class="op" id="3392762">(</span><span class="ident" id="3392763">l</span>&nbsp;<span class="op" id="3392765">*</span><span class="ident" id="3392766">UnixListener</span><span class="op" id="3392778">)</span>&nbsp;<span class="ident" id="3392780">SetDeadline</span><span class="op" id="3392791">(</span><span class="ident" id="3392792">t</span>&nbsp;<span class="ident" id="3392794">time</span><span class="op" id="3392798">.</span><span class="ident" id="3392799">Time</span><span class="op" id="3392803">)</span>&nbsp;<span class="op" id="3392805">(</span><span class="ident" id="3392806">err</span>&nbsp;<span class="builtintype" id="3392810">error</span><span class="op" id="3392815">)</span>&nbsp;<span class="op" id="3392817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392820">if</span>&nbsp;<span class="ident" id="3392823">l</span>&nbsp;<span class="op" id="3392825">==</span>&nbsp;<span class="builtintype" id="3392828">nil</span>&nbsp;<span class="op" id="3392832">||</span>&nbsp;<span class="ident" id="3392835">l</span><span class="op" id="3392836">.</span><span class="ident" id="3392837">fd</span>&nbsp;<span class="op" id="3392840">==</span>&nbsp;<span class="builtintype" id="3392843">nil</span>&nbsp;<span class="op" id="3392847">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392851">return</span>&nbsp;<span class="ident" id="3392858">syscall</span><span class="op" id="3392865">.</span><span class="ident" id="3392866">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3392874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3392877">return</span>&nbsp;<span class="ident" id="3392884">l</span><span class="op" id="3392885">.</span><span class="ident" id="3392886">fd</span><span class="op" id="3392888">.</span><span class="ident" id="3392889">setDeadline</span><span class="op" id="3392900">(</span><span class="ident" id="3392901">t</span><span class="op" id="3392902">)</span><br>
<span class="lineno"></span><span class="op" id="3392904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="3392907">//&nbsp;File&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;underlying&nbsp;os.File,&nbsp;set&nbsp;to&nbsp;blocking</span><br>
<span class="lineno"></span><span class="comment" id="3392973">//&nbsp;mode.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;close&nbsp;f&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="3393043">//&nbsp;Closing&nbsp;l&nbsp;does&nbsp;not&nbsp;affect&nbsp;f,&nbsp;and&nbsp;closing&nbsp;f&nbsp;does&nbsp;not&nbsp;affect&nbsp;l.</span><br>
<span class="lineno"></span><span class="comment" id="3393108">//</span><br>
<span class="lineno"></span><span class="comment" id="3393111">//&nbsp;The&nbsp;returned&nbsp;os.File&#39;s&nbsp;file&nbsp;descriptor&nbsp;is&nbsp;different&nbsp;from&nbsp;the</span><br>
<span class="lineno">340</span><span class="comment" id="3393175">//&nbsp;connection&#39;s.&nbsp;&nbsp;Attempting&nbsp;to&nbsp;change&nbsp;properties&nbsp;of&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span><span class="comment" id="3393241">//&nbsp;using&nbsp;this&nbsp;duplicate&nbsp;may&nbsp;or&nbsp;may&nbsp;not&nbsp;have&nbsp;the&nbsp;desired&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="3393305">func</span>&nbsp;<span class="op" id="3393310">(</span><span class="ident" id="3393311">l</span>&nbsp;<span class="op" id="3393313">*</span><span class="ident" id="3393314">UnixListener</span><span class="op" id="3393326">)</span>&nbsp;<span class="ident" id="3393328">File</span><span class="op" id="3393332">(</span><span class="op" id="3393333">)</span>&nbsp;<span class="op" id="3393335">(</span><span class="ident" id="3393336">f</span>&nbsp;<span class="op" id="3393338">*</span><span class="ident" id="3393339">os</span><span class="op" id="3393341">.</span><span class="ident" id="3393342">File</span><span class="op" id="3393346">,</span>&nbsp;<span class="ident" id="3393348">err</span>&nbsp;<span class="builtintype" id="3393352">error</span><span class="op" id="3393357">)</span>&nbsp;<span class="op" id="3393359">{</span>&nbsp;<span class="keyword" id="3393361">return</span>&nbsp;<span class="ident" id="3393368">l</span><span class="op" id="3393369">.</span><span class="ident" id="3393370">fd</span><span class="op" id="3393372">.</span><span class="ident" id="3393373">dup</span><span class="op" id="3393376">(</span><span class="op" id="3393377">)</span>&nbsp;<span class="op" id="3393379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3393382">//&nbsp;ListenUnixgram&nbsp;listens&nbsp;for&nbsp;incoming&nbsp;Unix&nbsp;datagram&nbsp;packets&nbsp;addressed</span><br>
<span class="lineno">345</span><span class="comment" id="3393453">//&nbsp;to&nbsp;the&nbsp;local&nbsp;address&nbsp;laddr.&nbsp;&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3393521">//&nbsp;The&nbsp;returned&nbsp;connection&#39;s&nbsp;ReadFrom&nbsp;and&nbsp;WriteTo&nbsp;methods&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3393591">//&nbsp;to&nbsp;receive&nbsp;and&nbsp;send&nbsp;packets&nbsp;with&nbsp;per-packet&nbsp;addressing.</span><br>
<span class="lineno"></span><span class="keyword" id="3393650">func</span>&nbsp;<span class="ident" id="3393655">ListenUnixgram</span><span class="op" id="3393669">(</span><span class="ident" id="3393670">net</span>&nbsp;<span class="builtintype" id="3393674">string</span><span class="op" id="3393680">,</span>&nbsp;<span class="ident" id="3393682">laddr</span>&nbsp;<span class="op" id="3393688">*</span><span class="ident" id="3393689">UnixAddr</span><span class="op" id="3393697">)</span>&nbsp;<span class="op" id="3393699">(</span><span class="op" id="3393700">*</span><span class="ident" id="3393701">UnixConn</span><span class="op" id="3393709">,</span>&nbsp;<span class="builtintype" id="3393711">error</span><span class="op" id="3393716">)</span>&nbsp;<span class="op" id="3393718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393721">switch</span>&nbsp;<span class="ident" id="3393728">net</span>&nbsp;<span class="op" id="3393732">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393735">case</span>&nbsp;<span class="string" id="3393740">&#34;unixgram&#34;</span><span class="op" id="3393750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393753">default</span><span class="op" id="3393760">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393764">return</span>&nbsp;<span class="builtintype" id="3393771">nil</span><span class="op" id="3393774">,</span>&nbsp;<span class="op" id="3393776">&amp;</span><span class="ident" id="3393777">OpError</span><span class="op" id="3393784">{</span><span class="ident" id="3393785">Op</span><span class="op" id="3393787">:</span>&nbsp;<span class="string" id="3393789">&#34;listen&#34;</span><span class="op" id="3393797">,</span>&nbsp;<span class="ident" id="3393799">Net</span><span class="op" id="3393802">:</span>&nbsp;<span class="ident" id="3393804">net</span><span class="op" id="3393807">,</span>&nbsp;<span class="ident" id="3393809">Addr</span><span class="op" id="3393813">:</span>&nbsp;<span class="ident" id="3393815">laddr</span><span class="op" id="3393820">,</span>&nbsp;<span class="ident" id="3393822">Err</span><span class="op" id="3393825">:</span>&nbsp;<span class="ident" id="3393827">UnknownNetworkError</span><span class="op" id="3393846">(</span><span class="ident" id="3393847">net</span><span class="op" id="3393850">)</span><span class="op" id="3393851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393857">if</span>&nbsp;<span class="ident" id="3393860">laddr</span>&nbsp;<span class="op" id="3393866">==</span>&nbsp;<span class="builtintype" id="3393869">nil</span>&nbsp;<span class="op" id="3393873">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3393877">return</span>&nbsp;<span class="builtintype" id="3393884">nil</span><span class="op" id="3393887">,</span>&nbsp;<span class="op" id="3393889">&amp;</span><span class="ident" id="3393890">OpError</span><span class="op" id="3393897">{</span><span class="ident" id="3393898">Op</span><span class="op" id="3393900">:</span>&nbsp;<span class="string" id="3393902">&#34;listen&#34;</span><span class="op" id="3393910">,</span>&nbsp;<span class="ident" id="3393912">Net</span><span class="op" id="3393915">:</span>&nbsp;<span class="ident" id="3393917">net</span><span class="op" id="3393920">,</span>&nbsp;<span class="ident" id="3393922">Addr</span><span class="op" id="3393926">:</span>&nbsp;<span class="builtintype" id="3393928">nil</span><span class="op" id="3393931">,</span>&nbsp;<span class="ident" id="3393933">Err</span><span class="op" id="3393936">:</span>&nbsp;<span class="ident" id="3393938">errMissingAddress</span><span class="op" id="3393955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3393958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3393961">fd</span><span class="op" id="3393963">,</span>&nbsp;<span class="ident" id="3393965">err</span>&nbsp;<span class="op" id="3393969">:=</span>&nbsp;<span class="ident" id="3393972">unixSocket</span><span class="op" id="3393982">(</span><span class="ident" id="3393983">net</span><span class="op" id="3393986">,</span>&nbsp;<span class="ident" id="3393988">laddr</span><span class="op" id="3393993">,</span>&nbsp;<span class="builtintype" id="3393995">nil</span><span class="op" id="3393998">,</span>&nbsp;<span class="string" id="3394000">&#34;listen&#34;</span><span class="op" id="3394008">,</span>&nbsp;<span class="ident" id="3394010">noDeadline</span><span class="op" id="3394020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394023">if</span>&nbsp;<span class="ident" id="3394026">err</span>&nbsp;<span class="op" id="3394030">!=</span>&nbsp;<span class="builtintype" id="3394033">nil</span>&nbsp;<span class="op" id="3394037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394041">return</span>&nbsp;<span class="builtintype" id="3394048">nil</span><span class="op" id="3394051">,</span>&nbsp;<span class="op" id="3394053">&amp;</span><span class="ident" id="3394054">OpError</span><span class="op" id="3394061">{</span><span class="ident" id="3394062">Op</span><span class="op" id="3394064">:</span>&nbsp;<span class="string" id="3394066">&#34;listen&#34;</span><span class="op" id="3394074">,</span>&nbsp;<span class="ident" id="3394076">Net</span><span class="op" id="3394079">:</span>&nbsp;<span class="ident" id="3394081">net</span><span class="op" id="3394084">,</span>&nbsp;<span class="ident" id="3394086">Addr</span><span class="op" id="3394090">:</span>&nbsp;<span class="ident" id="3394092">laddr</span><span class="op" id="3394097">,</span>&nbsp;<span class="ident" id="3394099">Err</span><span class="op" id="3394102">:</span>&nbsp;<span class="ident" id="3394104">err</span><span class="op" id="3394107">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3394110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3394113">return</span>&nbsp;<span class="ident" id="3394120">newUnixConn</span><span class="op" id="3394131">(</span><span class="ident" id="3394132">fd</span><span class="op" id="3394134">)</span><span class="op" id="3394135">,</span>&nbsp;<span class="builtintype" id="3394137">nil</span><br>
<span class="lineno"></span><span class="op" id="3394141">}</span>
</div>
</body>
</html>
