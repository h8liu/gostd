<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html" class="current">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3257016">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3257071">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3257125">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3257176">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257246">package</span>&nbsp;<span class="ident" id="3257254">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257259">import</span>&nbsp;<span class="op" id="3257266">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257269">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257275">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257281">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257292">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257307">&#34;syscall&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3257318">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3257325">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3257328">//&nbsp;Network&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="keyword" id="3257356">type</span>&nbsp;<span class="ident" id="3257361">netFD</span>&nbsp;<span class="keyword" id="3257367">struct</span>&nbsp;<span class="op" id="3257374">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257377">//&nbsp;locking/lifetime&nbsp;of&nbsp;sysfd&nbsp;+&nbsp;serialize&nbsp;access&nbsp;to&nbsp;Read&nbsp;and&nbsp;Write&nbsp;methods</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257452">fdmu</span>&nbsp;<span class="ident" id="3257457"><a href="/gostd/net/fd_mutex.go.html#3249583">fdMutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257467">//&nbsp;immutable&nbsp;until&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257493">sysfd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3257505">int</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257510">family</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3257522">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257527">sotype</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3257539">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257544">isConnected</span>&nbsp;<span class="builtintype" id="3257556">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257562">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3257574">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257582">laddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257594"><a href="/gostd/net/net.go.html#3334179">Addr</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257600">raddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257612"><a href="/gostd/net/net.go.html#3334179">Addr</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3257619">//&nbsp;wait&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3257635">pd</span>&nbsp;<span class="ident" id="3257638"><a href="/gostd/net/fd_poll_runtime.go.html#3254770">pollDesc</a></span><br>
<span class="lineno"></span><span class="op" id="3257647">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="3257650">func</span>&nbsp;<span class="ident" id="3257655">sysInit</span><span class="op" id="3257662">(</span><span class="op" id="3257663">)</span>&nbsp;<span class="op" id="3257665">{</span><br>
<span class="lineno"></span><span class="op" id="3257667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257670">func</span>&nbsp;<span class="ident" id="3257675">dial</span><span class="op" id="3257679">(</span><span class="ident" id="3257680">network</span>&nbsp;<span class="builtintype" id="3257688">string</span><span class="op" id="3257694">,</span>&nbsp;<span class="ident" id="3257696">ra</span>&nbsp;<span class="ident" id="3257699"><a href="/gostd/net/net.go.html#3334179">Addr</a></span><span class="op" id="3257703">,</span>&nbsp;<span class="ident" id="3257705">dialer</span>&nbsp;<span class="keyword" id="3257712">func</span><span class="op" id="3257716">(</span><span class="ident" id="3257717"><a href="/gostd/net/fd_unix.go.html#3257318">time</a></span><span class="op" id="3257721">.</span><span class="ident" id="3257722"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="3257726">)</span>&nbsp;<span class="op" id="3257728">(</span><span class="ident" id="3257729"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="3257733">,</span>&nbsp;<span class="builtintype" id="3257735">error</span><span class="op" id="3257740">)</span><span class="op" id="3257741">,</span>&nbsp;<span class="ident" id="3257743">deadline</span>&nbsp;<span class="ident" id="3257752"><a href="/gostd/net/fd_unix.go.html#3257318">time</a></span><span class="op" id="3257756">.</span><span class="ident" id="3257757"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="3257761">)</span>&nbsp;<span class="op" id="3257763">(</span><span class="ident" id="3257764"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="3257768">,</span>&nbsp;<span class="builtintype" id="3257770">error</span><span class="op" id="3257775">)</span>&nbsp;<span class="op" id="3257777">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257780">return</span>&nbsp;<span class="ident" id="3257787"><a href="/gostd/net/fd_unix.go.html#3257705">dialer</a></span><span class="op" id="3257793">(</span><span class="ident" id="3257794"><a href="/gostd/net/fd_unix.go.html#3257743">deadline</a></span><span class="op" id="3257802">)</span><br>
<span class="lineno"></span><span class="op" id="3257804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257807">func</span>&nbsp;<span class="ident" id="3257812">newFD</span><span class="op" id="3257817">(</span><span class="ident" id="3257818">sysfd</span><span class="op" id="3257823">,</span>&nbsp;<span class="ident" id="3257825">family</span><span class="op" id="3257831">,</span>&nbsp;<span class="ident" id="3257833">sotype</span>&nbsp;<span class="builtintype" id="3257840">int</span><span class="op" id="3257843">,</span>&nbsp;<span class="ident" id="3257845">net</span>&nbsp;<span class="builtintype" id="3257849">string</span><span class="op" id="3257855">)</span>&nbsp;<span class="op" id="3257857">(</span><span class="op" id="3257858">*</span><span class="ident" id="3257859"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3257864">,</span>&nbsp;<span class="builtintype" id="3257866">error</span><span class="op" id="3257871">)</span>&nbsp;<span class="op" id="3257873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257876">return</span>&nbsp;<span class="op" id="3257883">&amp;</span><span class="ident" id="3257884"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3257889">{</span><span class="ident" id="3257890"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3257895">:</span>&nbsp;<span class="ident" id="3257897"><a href="/gostd/net/fd_unix.go.html#3257818">sysfd</a></span><span class="op" id="3257902">,</span>&nbsp;<span class="ident" id="3257904"><a href="/gostd/net/fd_unix.go.html#3257510">family</a></span><span class="op" id="3257910">:</span>&nbsp;<span class="ident" id="3257912"><a href="/gostd/net/fd_unix.go.html#3257825">family</a></span><span class="op" id="3257918">,</span>&nbsp;<span class="ident" id="3257920"><a href="/gostd/net/fd_unix.go.html#3257527">sotype</a></span><span class="op" id="3257926">:</span>&nbsp;<span class="ident" id="3257928"><a href="/gostd/net/fd_unix.go.html#3257833">sotype</a></span><span class="op" id="3257934">,</span>&nbsp;<span class="ident" id="3257936"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3257939">:</span>&nbsp;<span class="ident" id="3257941"><a href="/gostd/net/fd_unix.go.html#3257845">net</a></span><span class="op" id="3257944">}</span><span class="op" id="3257945">,</span>&nbsp;<span class="builtintype" id="3257947">nil</span><br>
<span class="lineno">45</span><span class="op" id="3257951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3257954">func</span>&nbsp;<span class="op" id="3257959">(</span><span class="ident" id="3257960">fd</span>&nbsp;<span class="op" id="3257963">*</span><span class="ident" id="3257964"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3257969">)</span>&nbsp;<span class="ident" id="3257971">init</span><span class="op" id="3257975">(</span><span class="op" id="3257976">)</span>&nbsp;<span class="builtintype" id="3257978">error</span>&nbsp;<span class="op" id="3257984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3257987">if</span>&nbsp;<span class="ident" id="3257990">err</span>&nbsp;<span class="op" id="3257994">:=</span>&nbsp;<span class="ident" id="3257997"><a href="/gostd/net/fd_unix.go.html#3257960">fd</a></span><span class="op" id="3257999">.</span><span class="ident" id="3258000"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3258002">.</span><span class="ident" id="3258003"><a href="/gostd/net/fd_poll_runtime.go.html#3254857">Init</a></span><span class="op" id="3258007">(</span><span class="ident" id="3258008"><a href="/gostd/net/fd_unix.go.html#3257960">fd</a></span><span class="op" id="3258010">)</span><span class="op" id="3258011">;</span>&nbsp;<span class="ident" id="3258013"><a href="/gostd/net/fd_unix.go.html#3257990">err</a></span>&nbsp;<span class="op" id="3258017">!=</span>&nbsp;<span class="builtintype" id="3258020">nil</span>&nbsp;<span class="op" id="3258024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258028">return</span>&nbsp;<span class="ident" id="3258035"><a href="/gostd/net/fd_unix.go.html#3257990">err</a></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258043">return</span>&nbsp;<span class="builtintype" id="3258050">nil</span><br>
<span class="lineno"></span><span class="op" id="3258054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3258057">func</span>&nbsp;<span class="op" id="3258062">(</span><span class="ident" id="3258063">fd</span>&nbsp;<span class="op" id="3258066">*</span><span class="ident" id="3258067"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3258072">)</span>&nbsp;<span class="ident" id="3258074">setAddr</span><span class="op" id="3258081">(</span><span class="ident" id="3258082">laddr</span><span class="op" id="3258087">,</span>&nbsp;<span class="ident" id="3258089">raddr</span>&nbsp;<span class="ident" id="3258095"><a href="/gostd/net/net.go.html#3334179">Addr</a></span><span class="op" id="3258099">)</span>&nbsp;<span class="op" id="3258101">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258104"><a href="/gostd/net/fd_unix.go.html#3258063">fd</a></span><span class="op" id="3258106">.</span><span class="ident" id="3258107"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span>&nbsp;<span class="op" id="3258113">=</span>&nbsp;<span class="ident" id="3258115"><a href="/gostd/net/fd_unix.go.html#3258082">laddr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258122"><a href="/gostd/net/fd_unix.go.html#3258063">fd</a></span><span class="op" id="3258124">.</span><span class="ident" id="3258125"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span>&nbsp;<span class="op" id="3258131">=</span>&nbsp;<span class="ident" id="3258133"><a href="/gostd/net/fd_unix.go.html#3258089">raddr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258140"><a href="/gostd/net/fd_unix.go.html#3257281">runtime</a></span><span class="op" id="3258147">.</span><span class="ident" id="3258148"><a href="/gostd/runtime/malloc.go.html#1604775">SetFinalizer</a></span><span class="op" id="3258160">(</span><span class="ident" id="3258161"><a href="/gostd/net/fd_unix.go.html#3258063">fd</a></span><span class="op" id="3258163">,</span>&nbsp;<span class="op" id="3258165">(</span><span class="op" id="3258166">*</span><span class="ident" id="3258167"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3258172">)</span><span class="op" id="3258173">.</span><span class="ident" id="3258174"><a href="/gostd/net/fd_unix.go.html#3261468">Close</a></span><span class="op" id="3258179">)</span><br>
<span class="lineno"></span><span class="op" id="3258181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="3258184">func</span>&nbsp;<span class="op" id="3258189">(</span><span class="ident" id="3258190">fd</span>&nbsp;<span class="op" id="3258193">*</span><span class="ident" id="3258194"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3258199">)</span>&nbsp;<span class="ident" id="3258201">name</span><span class="op" id="3258205">(</span><span class="op" id="3258206">)</span>&nbsp;<span class="builtintype" id="3258208">string</span>&nbsp;<span class="op" id="3258215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258218">var</span>&nbsp;<span class="ident" id="3258222">ls</span><span class="op" id="3258224">,</span>&nbsp;<span class="ident" id="3258226">rs</span>&nbsp;<span class="builtintype" id="3258229">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258237">if</span>&nbsp;<span class="ident" id="3258240"><a href="/gostd/net/fd_unix.go.html#3258190">fd</a></span><span class="op" id="3258242">.</span><span class="ident" id="3258243"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span>&nbsp;<span class="op" id="3258249">!=</span>&nbsp;<span class="builtintype" id="3258252">nil</span>&nbsp;<span class="op" id="3258256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258260"><a href="/gostd/net/fd_unix.go.html#3258222">ls</a></span>&nbsp;<span class="op" id="3258263">=</span>&nbsp;<span class="ident" id="3258265"><a href="/gostd/net/fd_unix.go.html#3258190">fd</a></span><span class="op" id="3258267">.</span><span class="ident" id="3258268"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3258273">.</span><span class="ident" id="3258274"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="3258280">(</span><span class="op" id="3258281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258284">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258287">if</span>&nbsp;<span class="ident" id="3258290"><a href="/gostd/net/fd_unix.go.html#3258190">fd</a></span><span class="op" id="3258292">.</span><span class="ident" id="3258293"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span>&nbsp;<span class="op" id="3258299">!=</span>&nbsp;<span class="builtintype" id="3258302">nil</span>&nbsp;<span class="op" id="3258306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3258310"><a href="/gostd/net/fd_unix.go.html#3258226">rs</a></span>&nbsp;<span class="op" id="3258313">=</span>&nbsp;<span class="ident" id="3258315"><a href="/gostd/net/fd_unix.go.html#3258190">fd</a></span><span class="op" id="3258317">.</span><span class="ident" id="3258318"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3258323">.</span><span class="ident" id="3258324"><a href="/gostd/net/net.go.html#3334238">String</a></span><span class="op" id="3258330">(</span><span class="op" id="3258331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258334">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258337">return</span>&nbsp;<span class="ident" id="3258344"><a href="/gostd/net/fd_unix.go.html#3258190">fd</a></span><span class="op" id="3258346">.</span><span class="ident" id="3258347"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span>&nbsp;<span class="op" id="3258351">+</span>&nbsp;<span class="string" id="3258353">&#34;:&#34;</span>&nbsp;<span class="op" id="3258357">+</span>&nbsp;<span class="ident" id="3258359"><a href="/gostd/net/fd_unix.go.html#3258222">ls</a></span>&nbsp;<span class="op" id="3258362">+</span>&nbsp;<span class="string" id="3258364">&#34;-&gt;&#34;</span>&nbsp;<span class="op" id="3258369">+</span>&nbsp;<span class="ident" id="3258371"><a href="/gostd/net/fd_unix.go.html#3258226">rs</a></span><br>
<span class="lineno"></span><span class="op" id="3258374">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3258377">func</span>&nbsp;<span class="op" id="3258382">(</span><span class="ident" id="3258383">fd</span>&nbsp;<span class="op" id="3258386">*</span><span class="ident" id="3258387"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3258392">)</span>&nbsp;<span class="ident" id="3258394">connect</span><span class="op" id="3258401">(</span><span class="ident" id="3258402">la</span><span class="op" id="3258404">,</span>&nbsp;<span class="ident" id="3258406">ra</span>&nbsp;<span class="ident" id="3258409"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258416">.</span><span class="ident" id="3258417"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><span class="op" id="3258425">,</span>&nbsp;<span class="ident" id="3258427">deadline</span>&nbsp;<span class="ident" id="3258436"><a href="/gostd/net/fd_unix.go.html#3257318">time</a></span><span class="op" id="3258440">.</span><span class="ident" id="3258441"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="3258445">)</span>&nbsp;<span class="builtintype" id="3258447">error</span>&nbsp;<span class="op" id="3258453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258456">//&nbsp;Do&nbsp;not&nbsp;need&nbsp;to&nbsp;call&nbsp;fd.writeLock&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258499">//&nbsp;because&nbsp;fd&nbsp;is&nbsp;not&nbsp;yet&nbsp;accessible&nbsp;to&nbsp;user,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258545">//&nbsp;so&nbsp;no&nbsp;concurrent&nbsp;operations&nbsp;are&nbsp;possible.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258591">switch</span>&nbsp;<span class="ident" id="3258598">err</span>&nbsp;<span class="op" id="3258602">:=</span>&nbsp;<span class="ident" id="3258605"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258612">.</span><span class="ident" id="3258613"><a href="/gostd/syscall/syscall_unix.go.html#2547584">Connect</a></span><span class="op" id="3258620">(</span><span class="ident" id="3258621"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3258623">.</span><span class="ident" id="3258624"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3258629">,</span>&nbsp;<span class="ident" id="3258631"><a href="/gostd/net/fd_unix.go.html#3258406">ra</a></span><span class="op" id="3258633">)</span><span class="op" id="3258634">;</span>&nbsp;<span class="ident" id="3258636"><a href="/gostd/net/fd_unix.go.html#3258598">err</a></span>&nbsp;<span class="op" id="3258640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258643">case</span>&nbsp;<span class="ident" id="3258648"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258655">.</span><span class="ident" id="3258656"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601270">EINPROGRESS</a></span><span class="op" id="3258667">,</span>&nbsp;<span class="ident" id="3258669"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258676">.</span><span class="ident" id="3258677"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600343">EALREADY</a></span><span class="op" id="3258685">,</span>&nbsp;<span class="ident" id="3258687"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258694">.</span><span class="ident" id="3258695"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601301">EINTR</a></span><span class="op" id="3258700">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258703">case</span>&nbsp;<span class="builtintype" id="3258708">nil</span><span class="op" id="3258711">,</span>&nbsp;<span class="ident" id="3258713"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258720">.</span><span class="ident" id="3258721"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601392">EISCONN</a></span><span class="op" id="3258728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258732">if</span>&nbsp;<span class="op" id="3258735">!</span><span class="ident" id="3258736"><a href="/gostd/net/fd_unix.go.html#3258427">deadline</a></span><span class="op" id="3258744">.</span><span class="ident" id="3258745"><a href="/gostd/time/time.go.html#2728744">IsZero</a></span><span class="op" id="3258751">(</span><span class="op" id="3258752">)</span>&nbsp;<span class="op" id="3258754">&amp;&amp;</span>&nbsp;<span class="ident" id="3258757"><a href="/gostd/net/fd_unix.go.html#3258427">deadline</a></span><span class="op" id="3258765">.</span><span class="ident" id="3258766"><a href="/gostd/time/time.go.html#2722823">Before</a></span><span class="op" id="3258772">(</span><span class="ident" id="3258773"><a href="/gostd/net/fd_unix.go.html#3257318">time</a></span><span class="op" id="3258777">.</span><span class="ident" id="3258778"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="3258781">(</span><span class="op" id="3258782">)</span><span class="op" id="3258783">)</span>&nbsp;<span class="op" id="3258785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258790">return</span>&nbsp;<span class="ident" id="3258797"><a href="/gostd/net/net.go.html#3341194">errTimeout</a></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258814">if</span>&nbsp;<span class="ident" id="3258817">err</span>&nbsp;<span class="op" id="3258821">:=</span>&nbsp;<span class="ident" id="3258824"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3258826">.</span><span class="ident" id="3258827"><a href="/gostd/net/fd_unix.go.html#3257971">init</a></span><span class="op" id="3258831">(</span><span class="op" id="3258832">)</span><span class="op" id="3258833">;</span>&nbsp;<span class="ident" id="3258835"><a href="/gostd/net/fd_unix.go.html#3258817">err</a></span>&nbsp;<span class="op" id="3258839">!=</span>&nbsp;<span class="builtintype" id="3258842">nil</span>&nbsp;<span class="op" id="3258846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258851">return</span>&nbsp;<span class="ident" id="3258858"><a href="/gostd/net/fd_unix.go.html#3258817">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3258864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258868">return</span>&nbsp;<span class="builtintype" id="3258875">nil</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3258880">case</span>&nbsp;<span class="ident" id="3258885"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3258892">.</span><span class="ident" id="3258893"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601331">EINVAL</a></span><span class="op" id="3258899">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258903">//&nbsp;On&nbsp;Solaris&nbsp;we&nbsp;can&nbsp;see&nbsp;EINVAL&nbsp;if&nbsp;the&nbsp;socket&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3258955">//&nbsp;already&nbsp;been&nbsp;accepted&nbsp;and&nbsp;closed&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259008">//&nbsp;Treat&nbsp;this&nbsp;as&nbsp;a&nbsp;successful&nbsp;connection--writes&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259062">//&nbsp;the&nbsp;socket&nbsp;will&nbsp;see&nbsp;EOF.&nbsp;&nbsp;For&nbsp;details&nbsp;and&nbsp;a&nbsp;test</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259116">//&nbsp;case&nbsp;in&nbsp;C&nbsp;see&nbsp;http://golang.org/issue/6828.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259165">if</span>&nbsp;<span class="ident" id="3259168"><a href="/gostd/net/fd_unix.go.html#3257281">runtime</a></span><span class="op" id="3259175">.</span><span class="ident" id="3259176"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="3259181">==</span>&nbsp;<span class="string" id="3259184">&#34;solaris&#34;</span>&nbsp;<span class="op" id="3259194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259199">return</span>&nbsp;<span class="builtintype" id="3259206">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259216">fallthrough</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259229">default</span><span class="op" id="3259236">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259240">return</span>&nbsp;<span class="ident" id="3259247"><a href="/gostd/net/fd_unix.go.html#3258598">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259255">if</span>&nbsp;<span class="ident" id="3259258">err</span>&nbsp;<span class="op" id="3259262">:=</span>&nbsp;<span class="ident" id="3259265"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3259267">.</span><span class="ident" id="3259268"><a href="/gostd/net/fd_unix.go.html#3257971">init</a></span><span class="op" id="3259272">(</span><span class="op" id="3259273">)</span><span class="op" id="3259274">;</span>&nbsp;<span class="ident" id="3259276"><a href="/gostd/net/fd_unix.go.html#3259258">err</a></span>&nbsp;<span class="op" id="3259280">!=</span>&nbsp;<span class="builtintype" id="3259283">nil</span>&nbsp;<span class="op" id="3259287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259291">return</span>&nbsp;<span class="ident" id="3259298"><a href="/gostd/net/fd_unix.go.html#3259258">err</a></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259306">if</span>&nbsp;<span class="op" id="3259309">!</span><span class="ident" id="3259310"><a href="/gostd/net/fd_unix.go.html#3258427">deadline</a></span><span class="op" id="3259318">.</span><span class="ident" id="3259319"><a href="/gostd/time/time.go.html#2728744">IsZero</a></span><span class="op" id="3259325">(</span><span class="op" id="3259326">)</span>&nbsp;<span class="op" id="3259328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259332"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3259334">.</span><span class="ident" id="3259335"><a href="/gostd/net/fd_poll_runtime.go.html#3256668">setWriteDeadline</a></span><span class="op" id="3259351">(</span><span class="ident" id="3259352"><a href="/gostd/net/fd_unix.go.html#3258427">deadline</a></span><span class="op" id="3259360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259364">defer</span>&nbsp;<span class="ident" id="3259370"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3259372">.</span><span class="ident" id="3259373"><a href="/gostd/net/fd_poll_runtime.go.html#3256668">setWriteDeadline</a></span><span class="op" id="3259389">(</span><span class="ident" id="3259390"><a href="/gostd/net/net.go.html#3342276">noDeadline</a></span><span class="op" id="3259400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259403">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259406">for</span>&nbsp;<span class="op" id="3259410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259414">//&nbsp;Performing&nbsp;multiple&nbsp;connect&nbsp;system&nbsp;calls&nbsp;on&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259465">//&nbsp;non-blocking&nbsp;socket&nbsp;under&nbsp;Unix&nbsp;variants&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259519">//&nbsp;necessarily&nbsp;result&nbsp;in&nbsp;earlier&nbsp;errors&nbsp;being</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259567">//&nbsp;returned.&nbsp;Instead,&nbsp;once&nbsp;runtime-integrated&nbsp;network</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259623">//&nbsp;poller&nbsp;tells&nbsp;us&nbsp;that&nbsp;the&nbsp;socket&nbsp;is&nbsp;ready,&nbsp;get&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259678">//&nbsp;SO_ERROR&nbsp;socket&nbsp;option&nbsp;to&nbsp;see&nbsp;if&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259731">//&nbsp;succeeded&nbsp;or&nbsp;failed.&nbsp;See&nbsp;issue&nbsp;7474&nbsp;for&nbsp;further</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3259784">//&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259798">if</span>&nbsp;<span class="ident" id="3259801">err</span>&nbsp;<span class="op" id="3259805">:=</span>&nbsp;<span class="ident" id="3259808"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3259810">.</span><span class="ident" id="3259811"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3259813">.</span><span class="ident" id="3259814"><a href="/gostd/net/fd_poll_runtime.go.html#3256007">WaitWrite</a></span><span class="op" id="3259823">(</span><span class="op" id="3259824">)</span><span class="op" id="3259825">;</span>&nbsp;<span class="ident" id="3259827"><a href="/gostd/net/fd_unix.go.html#3259801">err</a></span>&nbsp;<span class="op" id="3259831">!=</span>&nbsp;<span class="builtintype" id="3259834">nil</span>&nbsp;<span class="op" id="3259838">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259843">return</span>&nbsp;<span class="ident" id="3259850"><a href="/gostd/net/fd_unix.go.html#3259801">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3259860">nerr</span><span class="op" id="3259864">,</span>&nbsp;<span class="ident" id="3259866">err</span>&nbsp;<span class="op" id="3259870">:=</span>&nbsp;<span class="ident" id="3259873"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3259880">.</span><span class="ident" id="3259881"><a href="/gostd/syscall/syscall_unix.go.html#2547935">GetsockoptInt</a></span><span class="op" id="3259894">(</span><span class="ident" id="3259895"><a href="/gostd/net/fd_unix.go.html#3258383">fd</a></span><span class="op" id="3259897">.</span><span class="ident" id="3259898"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3259903">,</span>&nbsp;<span class="ident" id="3259905"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3259912">.</span><span class="ident" id="3259913"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2592443">SOL_SOCKET</a></span><span class="op" id="3259923">,</span>&nbsp;<span class="ident" id="3259925"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3259932">.</span><span class="ident" id="3259933"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2592971">SO_ERROR</a></span><span class="op" id="3259941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259945">if</span>&nbsp;<span class="ident" id="3259948"><a href="/gostd/net/fd_unix.go.html#3259866">err</a></span>&nbsp;<span class="op" id="3259952">!=</span>&nbsp;<span class="builtintype" id="3259955">nil</span>&nbsp;<span class="op" id="3259959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259964">return</span>&nbsp;<span class="ident" id="3259971"><a href="/gostd/net/fd_unix.go.html#3259866">err</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3259977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3259981">switch</span>&nbsp;<span class="ident" id="3259988">err</span>&nbsp;<span class="op" id="3259992">:=</span>&nbsp;<span class="ident" id="3259995"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3260002">.</span><span class="ident" id="3260003"><a href="/gostd/syscall/syscall_unix.go.html#2545791">Errno</a></span><span class="op" id="3260008">(</span><span class="ident" id="3260009"><a href="/gostd/net/fd_unix.go.html#3259860">nerr</a></span><span class="op" id="3260013">)</span><span class="op" id="3260014">;</span>&nbsp;<span class="ident" id="3260016"><a href="/gostd/net/fd_unix.go.html#3259988">err</a></span>&nbsp;<span class="op" id="3260020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260024">case</span>&nbsp;<span class="ident" id="3260029"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3260036">.</span><span class="ident" id="3260037"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601270">EINPROGRESS</a></span><span class="op" id="3260048">,</span>&nbsp;<span class="ident" id="3260050"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3260057">.</span><span class="ident" id="3260058"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600343">EALREADY</a></span><span class="op" id="3260066">,</span>&nbsp;<span class="ident" id="3260068"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3260075">.</span><span class="ident" id="3260076"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601301">EINTR</a></span><span class="op" id="3260081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260085">case</span>&nbsp;<span class="ident" id="3260090"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3260097">.</span><span class="ident" id="3260098"><a href="/gostd/syscall/syscall_unix.go.html#2545791">Errno</a></span><span class="op" id="3260103">(</span><span class="num" id="3260104">0</span><span class="op" id="3260105">)</span><span class="op" id="3260106">,</span>&nbsp;<span class="ident" id="3260108"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3260115">.</span><span class="ident" id="3260116"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601392">EISCONN</a></span><span class="op" id="3260123">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260128">return</span>&nbsp;<span class="builtintype" id="3260135">nil</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260141">default</span><span class="op" id="3260148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260153">return</span>&nbsp;<span class="ident" id="3260160"><a href="/gostd/net/fd_unix.go.html#3259988">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260169">}</span><br>
<span class="lineno"></span><span class="op" id="3260171">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3260174">func</span>&nbsp;<span class="op" id="3260179">(</span><span class="ident" id="3260180">fd</span>&nbsp;<span class="op" id="3260183">*</span><span class="ident" id="3260184"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3260189">)</span>&nbsp;<span class="ident" id="3260191">destroy</span><span class="op" id="3260198">(</span><span class="op" id="3260199">)</span>&nbsp;<span class="op" id="3260201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3260204">//&nbsp;Poller&nbsp;may&nbsp;want&nbsp;to&nbsp;unregister&nbsp;fd&nbsp;in&nbsp;readiness&nbsp;notification&nbsp;mechanism,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3260278">//&nbsp;so&nbsp;this&nbsp;must&nbsp;be&nbsp;executed&nbsp;before&nbsp;closesocket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260327"><a href="/gostd/net/fd_unix.go.html#3260180">fd</a></span><span class="op" id="3260329">.</span><span class="ident" id="3260330"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3260332">.</span><span class="ident" id="3260333"><a href="/gostd/net/fd_poll_runtime.go.html#3255077">Close</a></span><span class="op" id="3260338">(</span><span class="op" id="3260339">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260342"><a href="/gostd/net/fd_unix.go.html#3269191">closesocket</a></span><span class="op" id="3260353">(</span><span class="ident" id="3260354"><a href="/gostd/net/fd_unix.go.html#3260180">fd</a></span><span class="op" id="3260356">.</span><span class="ident" id="3260357"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3260362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260365"><a href="/gostd/net/fd_unix.go.html#3260180">fd</a></span><span class="op" id="3260367">.</span><span class="ident" id="3260368"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span>&nbsp;<span class="op" id="3260374">=</span>&nbsp;<span class="op" id="3260376">-</span><span class="num" id="3260377">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260380"><a href="/gostd/net/fd_unix.go.html#3257281">runtime</a></span><span class="op" id="3260387">.</span><span class="ident" id="3260388"><a href="/gostd/runtime/malloc.go.html#1604775">SetFinalizer</a></span><span class="op" id="3260400">(</span><span class="ident" id="3260401"><a href="/gostd/net/fd_unix.go.html#3260180">fd</a></span><span class="op" id="3260403">,</span>&nbsp;<span class="builtintype" id="3260405">nil</span><span class="op" id="3260408">)</span><br>
<span class="lineno"></span><span class="op" id="3260410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3260413">//&nbsp;Add&nbsp;a&nbsp;reference&nbsp;to&nbsp;this&nbsp;fd.</span><br>
<span class="lineno"></span><span class="comment" id="3260444">//&nbsp;Returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;fd&nbsp;cannot&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3260490">func</span>&nbsp;<span class="op" id="3260495">(</span><span class="ident" id="3260496">fd</span>&nbsp;<span class="op" id="3260499">*</span><span class="ident" id="3260500"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3260505">)</span>&nbsp;<span class="ident" id="3260507">incref</span><span class="op" id="3260513">(</span><span class="op" id="3260514">)</span>&nbsp;<span class="builtintype" id="3260516">error</span>&nbsp;<span class="op" id="3260522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260525">if</span>&nbsp;<span class="op" id="3260528">!</span><span class="ident" id="3260529"><a href="/gostd/net/fd_unix.go.html#3260496">fd</a></span><span class="op" id="3260531">.</span><span class="ident" id="3260532"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3260536">.</span><span class="ident" id="3260537"><a href="/gostd/net/fd_mutex.go.html#3250854">Incref</a></span><span class="op" id="3260543">(</span><span class="op" id="3260544">)</span>&nbsp;<span class="op" id="3260546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260550">return</span>&nbsp;<span class="ident" id="3260557"><a href="/gostd/net/net.go.html#3341239">errClosing</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260572">return</span>&nbsp;<span class="builtintype" id="3260579">nil</span><br>
<span class="lineno"></span><span class="op" id="3260583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3260586">//&nbsp;Remove&nbsp;a&nbsp;reference&nbsp;to&nbsp;this&nbsp;FD&nbsp;and&nbsp;close&nbsp;if&nbsp;we&#39;ve&nbsp;been&nbsp;asked&nbsp;to&nbsp;do&nbsp;so</span><br>
<span class="lineno">150</span><span class="comment" id="3260658">//&nbsp;(and&nbsp;there&nbsp;are&nbsp;no&nbsp;references&nbsp;left).</span><br>
<span class="lineno"></span><span class="keyword" id="3260697">func</span>&nbsp;<span class="op" id="3260702">(</span><span class="ident" id="3260703">fd</span>&nbsp;<span class="op" id="3260706">*</span><span class="ident" id="3260707"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3260712">)</span>&nbsp;<span class="ident" id="3260714">decref</span><span class="op" id="3260720">(</span><span class="op" id="3260721">)</span>&nbsp;<span class="op" id="3260723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260726">if</span>&nbsp;<span class="ident" id="3260729"><a href="/gostd/net/fd_unix.go.html#3260703">fd</a></span><span class="op" id="3260731">.</span><span class="ident" id="3260732"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3260736">.</span><span class="ident" id="3260737"><a href="/gostd/net/fd_mutex.go.html#3251874">Decref</a></span><span class="op" id="3260743">(</span><span class="op" id="3260744">)</span>&nbsp;<span class="op" id="3260746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3260750"><a href="/gostd/net/fd_unix.go.html#3260703">fd</a></span><span class="op" id="3260752">.</span><span class="ident" id="3260753"><a href="/gostd/net/fd_unix.go.html#3260191">destroy</a></span><span class="op" id="3260760">(</span><span class="op" id="3260761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260764">}</span><br>
<span class="lineno">155</span><span class="op" id="3260766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3260769">//&nbsp;Add&nbsp;a&nbsp;reference&nbsp;to&nbsp;this&nbsp;fd&nbsp;and&nbsp;lock&nbsp;for&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="3260821">//&nbsp;Returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;fd&nbsp;cannot&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3260867">func</span>&nbsp;<span class="op" id="3260872">(</span><span class="ident" id="3260873">fd</span>&nbsp;<span class="op" id="3260876">*</span><span class="ident" id="3260877"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3260882">)</span>&nbsp;<span class="ident" id="3260884">readLock</span><span class="op" id="3260892">(</span><span class="op" id="3260893">)</span>&nbsp;<span class="builtintype" id="3260895">error</span>&nbsp;<span class="op" id="3260901">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260904">if</span>&nbsp;<span class="op" id="3260907">!</span><span class="ident" id="3260908"><a href="/gostd/net/fd_unix.go.html#3260873">fd</a></span><span class="op" id="3260910">.</span><span class="ident" id="3260911"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3260915">.</span><span class="ident" id="3260916"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="3260922">(</span><span class="builtintype" id="3260923">true</span><span class="op" id="3260927">)</span>&nbsp;<span class="op" id="3260929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260933">return</span>&nbsp;<span class="ident" id="3260940"><a href="/gostd/net/net.go.html#3341239">errClosing</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3260952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3260955">return</span>&nbsp;<span class="builtintype" id="3260962">nil</span><br>
<span class="lineno"></span><span class="op" id="3260966">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="3260969">//&nbsp;Unlock&nbsp;for&nbsp;reading&nbsp;and&nbsp;remove&nbsp;a&nbsp;reference&nbsp;to&nbsp;this&nbsp;FD.</span><br>
<span class="lineno"></span><span class="keyword" id="3261026">func</span>&nbsp;<span class="op" id="3261031">(</span><span class="ident" id="3261032">fd</span>&nbsp;<span class="op" id="3261035">*</span><span class="ident" id="3261036"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3261041">)</span>&nbsp;<span class="ident" id="3261043">readUnlock</span><span class="op" id="3261053">(</span><span class="op" id="3261054">)</span>&nbsp;<span class="op" id="3261056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261059">if</span>&nbsp;<span class="ident" id="3261062"><a href="/gostd/net/fd_unix.go.html#3261032">fd</a></span><span class="op" id="3261064">.</span><span class="ident" id="3261065"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3261069">.</span><span class="ident" id="3261070"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="3261078">(</span><span class="builtintype" id="3261079">true</span><span class="op" id="3261083">)</span>&nbsp;<span class="op" id="3261085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261089"><a href="/gostd/net/fd_unix.go.html#3261032">fd</a></span><span class="op" id="3261091">.</span><span class="ident" id="3261092"><a href="/gostd/net/fd_unix.go.html#3260191">destroy</a></span><span class="op" id="3261099">(</span><span class="op" id="3261100">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261103">}</span><br>
<span class="lineno"></span><span class="op" id="3261105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3261108">//&nbsp;Add&nbsp;a&nbsp;reference&nbsp;to&nbsp;this&nbsp;fd&nbsp;and&nbsp;lock&nbsp;for&nbsp;writing.</span><br>
<span class="lineno"></span><span class="comment" id="3261160">//&nbsp;Returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;fd&nbsp;cannot&nbsp;be&nbsp;used.</span><br>
<span class="lineno">175</span><span class="keyword" id="3261206">func</span>&nbsp;<span class="op" id="3261211">(</span><span class="ident" id="3261212">fd</span>&nbsp;<span class="op" id="3261215">*</span><span class="ident" id="3261216"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3261221">)</span>&nbsp;<span class="ident" id="3261223">writeLock</span><span class="op" id="3261232">(</span><span class="op" id="3261233">)</span>&nbsp;<span class="builtintype" id="3261235">error</span>&nbsp;<span class="op" id="3261241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261244">if</span>&nbsp;<span class="op" id="3261247">!</span><span class="ident" id="3261248"><a href="/gostd/net/fd_unix.go.html#3261212">fd</a></span><span class="op" id="3261250">.</span><span class="ident" id="3261251"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3261255">.</span><span class="ident" id="3261256"><a href="/gostd/net/fd_mutex.go.html#3252171">RWLock</a></span><span class="op" id="3261262">(</span><span class="builtintype" id="3261263">false</span><span class="op" id="3261268">)</span>&nbsp;<span class="op" id="3261270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261274">return</span>&nbsp;<span class="ident" id="3261281"><a href="/gostd/net/net.go.html#3341239">errClosing</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261296">return</span>&nbsp;<span class="builtintype" id="3261303">nil</span><br>
<span class="lineno">180</span><span class="op" id="3261307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3261310">//&nbsp;Unlock&nbsp;for&nbsp;writing&nbsp;and&nbsp;remove&nbsp;a&nbsp;reference&nbsp;to&nbsp;this&nbsp;FD.</span><br>
<span class="lineno"></span><span class="keyword" id="3261367">func</span>&nbsp;<span class="op" id="3261372">(</span><span class="ident" id="3261373">fd</span>&nbsp;<span class="op" id="3261376">*</span><span class="ident" id="3261377"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3261382">)</span>&nbsp;<span class="ident" id="3261384">writeUnlock</span><span class="op" id="3261395">(</span><span class="op" id="3261396">)</span>&nbsp;<span class="op" id="3261398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261401">if</span>&nbsp;<span class="ident" id="3261404"><a href="/gostd/net/fd_unix.go.html#3261373">fd</a></span><span class="op" id="3261406">.</span><span class="ident" id="3261407"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3261411">.</span><span class="ident" id="3261412"><a href="/gostd/net/fd_mutex.go.html#3253103">RWUnlock</a></span><span class="op" id="3261420">(</span><span class="builtintype" id="3261421">false</span><span class="op" id="3261426">)</span>&nbsp;<span class="op" id="3261428">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261432"><a href="/gostd/net/fd_unix.go.html#3261373">fd</a></span><span class="op" id="3261434">.</span><span class="ident" id="3261435"><a href="/gostd/net/fd_unix.go.html#3260191">destroy</a></span><span class="op" id="3261442">(</span><span class="op" id="3261443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261446">}</span><br>
<span class="lineno"></span><span class="op" id="3261448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3261451">func</span>&nbsp;<span class="op" id="3261456">(</span><span class="ident" id="3261457">fd</span>&nbsp;<span class="op" id="3261460">*</span><span class="ident" id="3261461"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3261466">)</span>&nbsp;<span class="ident" id="3261468">Close</span><span class="op" id="3261473">(</span><span class="op" id="3261474">)</span>&nbsp;<span class="builtintype" id="3261476">error</span>&nbsp;<span class="op" id="3261482">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261485"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261487">.</span><span class="ident" id="3261488"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3261490">.</span><span class="ident" id="3261491"><a href="/gostd/net/fd_poll_runtime.go.html#3255200">Lock</a></span><span class="op" id="3261495">(</span><span class="op" id="3261496">)</span>&nbsp;<span class="comment" id="3261498">//&nbsp;needed&nbsp;for&nbsp;both&nbsp;fd.incref(true)&nbsp;and&nbsp;pollDesc.Evict</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261553">if</span>&nbsp;<span class="op" id="3261556">!</span><span class="ident" id="3261557"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261559">.</span><span class="ident" id="3261560"><a href="/gostd/net/fd_unix.go.html#3257452">fdmu</a></span><span class="op" id="3261564">.</span><span class="ident" id="3261565"><a href="/gostd/net/fd_mutex.go.html#3251158">IncrefAndClose</a></span><span class="op" id="3261579">(</span><span class="op" id="3261580">)</span>&nbsp;<span class="op" id="3261582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261586"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261588">.</span><span class="ident" id="3261589"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3261591">.</span><span class="ident" id="3261592"><a href="/gostd/net/fd_poll_runtime.go.html#3255232">Unlock</a></span><span class="op" id="3261598">(</span><span class="op" id="3261599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261603">return</span>&nbsp;<span class="ident" id="3261610"><a href="/gostd/net/net.go.html#3341239">errClosing</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3261622">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261625">//&nbsp;Unblock&nbsp;any&nbsp;I/O.&nbsp;&nbsp;Once&nbsp;it&nbsp;all&nbsp;unblocks&nbsp;and&nbsp;returns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261681">//&nbsp;so&nbsp;that&nbsp;it&nbsp;cannot&nbsp;be&nbsp;referring&nbsp;to&nbsp;fd.sysfd&nbsp;anymore,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261737">//&nbsp;the&nbsp;final&nbsp;decref&nbsp;will&nbsp;close&nbsp;fd.sysfd.&nbsp;&nbsp;This&nbsp;should&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261799">//&nbsp;fairly&nbsp;quickly,&nbsp;since&nbsp;all&nbsp;the&nbsp;I/O&nbsp;is&nbsp;non-blocking,&nbsp;and&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3261862">//&nbsp;attempts&nbsp;to&nbsp;block&nbsp;in&nbsp;the&nbsp;pollDesc&nbsp;will&nbsp;return&nbsp;errClosing.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261924">doWakeup</span>&nbsp;<span class="op" id="3261933">:=</span>&nbsp;<span class="ident" id="3261936"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261938">.</span><span class="ident" id="3261939"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3261941">.</span><span class="ident" id="3261942"><a href="/gostd/net/fd_poll_runtime.go.html#3255438">Evict</a></span><span class="op" id="3261947">(</span><span class="op" id="3261948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261951"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261953">.</span><span class="ident" id="3261954"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3261956">.</span><span class="ident" id="3261957"><a href="/gostd/net/fd_poll_runtime.go.html#3255232">Unlock</a></span><span class="op" id="3261963">(</span><span class="op" id="3261964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261967"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261969">.</span><span class="ident" id="3261970"><a href="/gostd/net/fd_unix.go.html#3260714">decref</a></span><span class="op" id="3261976">(</span><span class="op" id="3261977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3261980">if</span>&nbsp;<span class="ident" id="3261983"><a href="/gostd/net/fd_unix.go.html#3261924">doWakeup</a></span>&nbsp;<span class="op" id="3261992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3261996"><a href="/gostd/net/fd_unix.go.html#3261457">fd</a></span><span class="op" id="3261998">.</span><span class="ident" id="3261999"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3262001">.</span><span class="ident" id="3262002"><a href="/gostd/net/fd_poll_runtime.go.html#3255266">Wakeup</a></span><span class="op" id="3262008">(</span><span class="op" id="3262009">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262015">return</span>&nbsp;<span class="builtintype" id="3262022">nil</span><br>
<span class="lineno"></span><span class="op" id="3262026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3262029">func</span>&nbsp;<span class="op" id="3262034">(</span><span class="ident" id="3262035">fd</span>&nbsp;<span class="op" id="3262038">*</span><span class="ident" id="3262039"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3262044">)</span>&nbsp;<span class="ident" id="3262046">shutdown</span><span class="op" id="3262054">(</span><span class="ident" id="3262055">how</span>&nbsp;<span class="builtintype" id="3262059">int</span><span class="op" id="3262062">)</span>&nbsp;<span class="builtintype" id="3262064">error</span>&nbsp;<span class="op" id="3262070">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262073">if</span>&nbsp;<span class="ident" id="3262076">err</span>&nbsp;<span class="op" id="3262080">:=</span>&nbsp;<span class="ident" id="3262083"><a href="/gostd/net/fd_unix.go.html#3262035">fd</a></span><span class="op" id="3262085">.</span><span class="ident" id="3262086"><a href="/gostd/net/fd_unix.go.html#3260507">incref</a></span><span class="op" id="3262092">(</span><span class="op" id="3262093">)</span><span class="op" id="3262094">;</span>&nbsp;<span class="ident" id="3262096"><a href="/gostd/net/fd_unix.go.html#3262076">err</a></span>&nbsp;<span class="op" id="3262100">!=</span>&nbsp;<span class="builtintype" id="3262103">nil</span>&nbsp;<span class="op" id="3262107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262111">return</span>&nbsp;<span class="ident" id="3262118"><a href="/gostd/net/fd_unix.go.html#3262076">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262126">defer</span>&nbsp;<span class="ident" id="3262132"><a href="/gostd/net/fd_unix.go.html#3262035">fd</a></span><span class="op" id="3262134">.</span><span class="ident" id="3262135"><a href="/gostd/net/fd_unix.go.html#3260714">decref</a></span><span class="op" id="3262141">(</span><span class="op" id="3262142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3262145">err</span>&nbsp;<span class="op" id="3262149">:=</span>&nbsp;<span class="ident" id="3262152"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3262159">.</span><span class="ident" id="3262160"><a href="/gostd/syscall/zsyscall_linux_amd64.go.html#2648635">Shutdown</a></span><span class="op" id="3262168">(</span><span class="ident" id="3262169"><a href="/gostd/net/fd_unix.go.html#3262035">fd</a></span><span class="op" id="3262171">.</span><span class="ident" id="3262172"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3262177">,</span>&nbsp;<span class="ident" id="3262179"><a href="/gostd/net/fd_unix.go.html#3262055">how</a></span><span class="op" id="3262182">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262185">if</span>&nbsp;<span class="ident" id="3262188"><a href="/gostd/net/fd_unix.go.html#3262145">err</a></span>&nbsp;<span class="op" id="3262192">!=</span>&nbsp;<span class="builtintype" id="3262195">nil</span>&nbsp;<span class="op" id="3262199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262203">return</span>&nbsp;<span class="op" id="3262210">&amp;</span><span class="ident" id="3262211"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3262218">{</span><span class="string" id="3262219">&#34;shutdown&#34;</span><span class="op" id="3262229">,</span>&nbsp;<span class="ident" id="3262231"><a href="/gostd/net/fd_unix.go.html#3262035">fd</a></span><span class="op" id="3262233">.</span><span class="ident" id="3262234"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3262237">,</span>&nbsp;<span class="ident" id="3262239"><a href="/gostd/net/fd_unix.go.html#3262035">fd</a></span><span class="op" id="3262241">.</span><span class="ident" id="3262242"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3262247">,</span>&nbsp;<span class="ident" id="3262249"><a href="/gostd/net/fd_unix.go.html#3262145">err</a></span><span class="op" id="3262252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262258">return</span>&nbsp;<span class="builtintype" id="3262265">nil</span><br>
<span class="lineno"></span><span class="op" id="3262269">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="3262272">func</span>&nbsp;<span class="op" id="3262277">(</span><span class="ident" id="3262278">fd</span>&nbsp;<span class="op" id="3262281">*</span><span class="ident" id="3262282"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3262287">)</span>&nbsp;<span class="ident" id="3262289">closeRead</span><span class="op" id="3262298">(</span><span class="op" id="3262299">)</span>&nbsp;<span class="builtintype" id="3262301">error</span>&nbsp;<span class="op" id="3262307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262310">return</span>&nbsp;<span class="ident" id="3262317"><a href="/gostd/net/fd_unix.go.html#3262278">fd</a></span><span class="op" id="3262319">.</span><span class="ident" id="3262320"><a href="/gostd/net/fd_unix.go.html#3262046">shutdown</a></span><span class="op" id="3262328">(</span><span class="ident" id="3262329"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3262336">.</span><span class="ident" id="3262337"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2589090">SHUT_RD</a></span><span class="op" id="3262344">)</span><br>
<span class="lineno"></span><span class="op" id="3262346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="3262349">func</span>&nbsp;<span class="op" id="3262354">(</span><span class="ident" id="3262355">fd</span>&nbsp;<span class="op" id="3262358">*</span><span class="ident" id="3262359"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3262364">)</span>&nbsp;<span class="ident" id="3262366">closeWrite</span><span class="op" id="3262376">(</span><span class="op" id="3262377">)</span>&nbsp;<span class="builtintype" id="3262379">error</span>&nbsp;<span class="op" id="3262385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262388">return</span>&nbsp;<span class="ident" id="3262395"><a href="/gostd/net/fd_unix.go.html#3262355">fd</a></span><span class="op" id="3262397">.</span><span class="ident" id="3262398"><a href="/gostd/net/fd_unix.go.html#3262046">shutdown</a></span><span class="op" id="3262406">(</span><span class="ident" id="3262407"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3262414">.</span><span class="ident" id="3262415"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2589170">SHUT_WR</a></span><span class="op" id="3262422">)</span><br>
<span class="lineno"></span><span class="op" id="3262424">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3262427">func</span>&nbsp;<span class="op" id="3262432">(</span><span class="ident" id="3262433">fd</span>&nbsp;<span class="op" id="3262436">*</span><span class="ident" id="3262437"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3262442">)</span>&nbsp;<span class="ident" id="3262444">Read</span><span class="op" id="3262448">(</span><span class="ident" id="3262449">p</span>&nbsp;<span class="op" id="3262451">[</span><span class="op" id="3262452">]</span><span class="builtintype" id="3262453">byte</span><span class="op" id="3262457">)</span>&nbsp;<span class="op" id="3262459">(</span><span class="ident" id="3262460">n</span>&nbsp;<span class="builtintype" id="3262462">int</span><span class="op" id="3262465">,</span>&nbsp;<span class="ident" id="3262467">err</span>&nbsp;<span class="builtintype" id="3262471">error</span><span class="op" id="3262476">)</span>&nbsp;<span class="op" id="3262478">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262481">if</span>&nbsp;<span class="ident" id="3262484">err</span>&nbsp;<span class="op" id="3262488">:=</span>&nbsp;<span class="ident" id="3262491"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262493">.</span><span class="ident" id="3262494"><a href="/gostd/net/fd_unix.go.html#3260884">readLock</a></span><span class="op" id="3262502">(</span><span class="op" id="3262503">)</span><span class="op" id="3262504">;</span>&nbsp;<span class="ident" id="3262506"><a href="/gostd/net/fd_unix.go.html#3262484">err</a></span>&nbsp;<span class="op" id="3262510">!=</span>&nbsp;<span class="builtintype" id="3262513">nil</span>&nbsp;<span class="op" id="3262517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262521">return</span>&nbsp;<span class="num" id="3262528">0</span><span class="op" id="3262529">,</span>&nbsp;<span class="ident" id="3262531"><a href="/gostd/net/fd_unix.go.html#3262484">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262539">defer</span>&nbsp;<span class="ident" id="3262545"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262547">.</span><span class="ident" id="3262548"><a href="/gostd/net/fd_unix.go.html#3261043">readUnlock</a></span><span class="op" id="3262558">(</span><span class="op" id="3262559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262562">if</span>&nbsp;<span class="ident" id="3262565">err</span>&nbsp;<span class="op" id="3262569">:=</span>&nbsp;<span class="ident" id="3262572"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262574">.</span><span class="ident" id="3262575"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3262577">.</span><span class="ident" id="3262578"><a href="/gostd/net/fd_poll_runtime.go.html#3255689">PrepareRead</a></span><span class="op" id="3262589">(</span><span class="op" id="3262590">)</span><span class="op" id="3262591">;</span>&nbsp;<span class="ident" id="3262593"><a href="/gostd/net/fd_unix.go.html#3262565">err</a></span>&nbsp;<span class="op" id="3262597">!=</span>&nbsp;<span class="builtintype" id="3262600">nil</span>&nbsp;<span class="op" id="3262604">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262608">return</span>&nbsp;<span class="num" id="3262615">0</span><span class="op" id="3262616">,</span>&nbsp;<span class="op" id="3262618">&amp;</span><span class="ident" id="3262619"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3262626">{</span><span class="string" id="3262627">&#34;read&#34;</span><span class="op" id="3262633">,</span>&nbsp;<span class="ident" id="3262635"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262637">.</span><span class="ident" id="3262638"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3262641">,</span>&nbsp;<span class="ident" id="3262643"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262645">.</span><span class="ident" id="3262646"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3262651">,</span>&nbsp;<span class="ident" id="3262653"><a href="/gostd/net/fd_unix.go.html#3262565">err</a></span><span class="op" id="3262656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262662">for</span>&nbsp;<span class="op" id="3262666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3262670"><a href="/gostd/net/fd_unix.go.html#3262460">n</a></span><span class="op" id="3262671">,</span>&nbsp;<span class="ident" id="3262673"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262677">=</span>&nbsp;<span class="ident" id="3262679"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3262686">.</span><span class="ident" id="3262687"><a href="/gostd/syscall/syscall_unix.go.html#2546497">Read</a></span><span class="op" id="3262691">(</span><span class="builtintype" id="3262692">int</span><span class="op" id="3262695">(</span><span class="ident" id="3262696"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262698">.</span><span class="ident" id="3262699"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3262704">)</span><span class="op" id="3262705">,</span>&nbsp;<span class="ident" id="3262707"><a href="/gostd/net/fd_unix.go.html#3262449">p</a></span><span class="op" id="3262708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262712">if</span>&nbsp;<span class="ident" id="3262715"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262719">!=</span>&nbsp;<span class="builtintype" id="3262722">nil</span>&nbsp;<span class="op" id="3262726">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3262731"><a href="/gostd/net/fd_unix.go.html#3262460">n</a></span>&nbsp;<span class="op" id="3262733">=</span>&nbsp;<span class="num" id="3262735">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262740">if</span>&nbsp;<span class="ident" id="3262743"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262747">==</span>&nbsp;<span class="ident" id="3262750"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3262757">.</span><span class="ident" id="3262758"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3262765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262771">if</span>&nbsp;<span class="ident" id="3262774"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262778">=</span>&nbsp;<span class="ident" id="3262780"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262782">.</span><span class="ident" id="3262783"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3262785">.</span><span class="ident" id="3262786"><a href="/gostd/net/fd_poll_runtime.go.html#3255944">WaitRead</a></span><span class="op" id="3262794">(</span><span class="op" id="3262795">)</span><span class="op" id="3262796">;</span>&nbsp;<span class="ident" id="3262798"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262802">==</span>&nbsp;<span class="builtintype" id="3262805">nil</span>&nbsp;<span class="op" id="3262809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262816">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262829">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3262842"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262846">=</span>&nbsp;<span class="ident" id="3262848"><a href="/gostd/net/fd_unix.go.html#3264257">chkReadErr</a></span><span class="op" id="3262858">(</span><span class="ident" id="3262859"><a href="/gostd/net/fd_unix.go.html#3262460">n</a></span><span class="op" id="3262860">,</span>&nbsp;<span class="ident" id="3262862"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span><span class="op" id="3262865">,</span>&nbsp;<span class="ident" id="3262867"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262873">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262880">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262883">if</span>&nbsp;<span class="ident" id="3262886"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262890">!=</span>&nbsp;<span class="builtintype" id="3262893">nil</span>&nbsp;<span class="op" id="3262897">&amp;&amp;</span>&nbsp;<span class="ident" id="3262900"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262904">!=</span>&nbsp;<span class="ident" id="3262907"><a href="/gostd/net/fd_unix.go.html#3257269">io</a></span><span class="op" id="3262909">.</span><span class="ident" id="3262910"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="3262914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3262918"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span>&nbsp;<span class="op" id="3262922">=</span>&nbsp;<span class="op" id="3262924">&amp;</span><span class="ident" id="3262925"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3262932">{</span><span class="string" id="3262933">&#34;read&#34;</span><span class="op" id="3262939">,</span>&nbsp;<span class="ident" id="3262941"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262943">.</span><span class="ident" id="3262944"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3262947">,</span>&nbsp;<span class="ident" id="3262949"><a href="/gostd/net/fd_unix.go.html#3262433">fd</a></span><span class="op" id="3262951">.</span><span class="ident" id="3262952"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3262957">,</span>&nbsp;<span class="ident" id="3262959"><a href="/gostd/net/fd_unix.go.html#3262467">err</a></span><span class="op" id="3262962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3262965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3262968">return</span><br>
<span class="lineno"></span><span class="op" id="3262975">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="3262978">func</span>&nbsp;<span class="op" id="3262983">(</span><span class="ident" id="3262984">fd</span>&nbsp;<span class="op" id="3262987">*</span><span class="ident" id="3262988"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3262993">)</span>&nbsp;<span class="ident" id="3262995">readFrom</span><span class="op" id="3263003">(</span><span class="ident" id="3263004">p</span>&nbsp;<span class="op" id="3263006">[</span><span class="op" id="3263007">]</span><span class="builtintype" id="3263008">byte</span><span class="op" id="3263012">)</span>&nbsp;<span class="op" id="3263014">(</span><span class="ident" id="3263015">n</span>&nbsp;<span class="builtintype" id="3263017">int</span><span class="op" id="3263020">,</span>&nbsp;<span class="ident" id="3263022">sa</span>&nbsp;<span class="ident" id="3263025"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3263032">.</span><span class="ident" id="3263033"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><span class="op" id="3263041">,</span>&nbsp;<span class="ident" id="3263043">err</span>&nbsp;<span class="builtintype" id="3263047">error</span><span class="op" id="3263052">)</span>&nbsp;<span class="op" id="3263054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263057">if</span>&nbsp;<span class="ident" id="3263060">err</span>&nbsp;<span class="op" id="3263064">:=</span>&nbsp;<span class="ident" id="3263067"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263069">.</span><span class="ident" id="3263070"><a href="/gostd/net/fd_unix.go.html#3260884">readLock</a></span><span class="op" id="3263078">(</span><span class="op" id="3263079">)</span><span class="op" id="3263080">;</span>&nbsp;<span class="ident" id="3263082"><a href="/gostd/net/fd_unix.go.html#3263060">err</a></span>&nbsp;<span class="op" id="3263086">!=</span>&nbsp;<span class="builtintype" id="3263089">nil</span>&nbsp;<span class="op" id="3263093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263097">return</span>&nbsp;<span class="num" id="3263104">0</span><span class="op" id="3263105">,</span>&nbsp;<span class="builtintype" id="3263107">nil</span><span class="op" id="3263110">,</span>&nbsp;<span class="ident" id="3263112"><a href="/gostd/net/fd_unix.go.html#3263060">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263117">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263120">defer</span>&nbsp;<span class="ident" id="3263126"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263128">.</span><span class="ident" id="3263129"><a href="/gostd/net/fd_unix.go.html#3261043">readUnlock</a></span><span class="op" id="3263139">(</span><span class="op" id="3263140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263143">if</span>&nbsp;<span class="ident" id="3263146">err</span>&nbsp;<span class="op" id="3263150">:=</span>&nbsp;<span class="ident" id="3263153"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263155">.</span><span class="ident" id="3263156"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3263158">.</span><span class="ident" id="3263159"><a href="/gostd/net/fd_poll_runtime.go.html#3255689">PrepareRead</a></span><span class="op" id="3263170">(</span><span class="op" id="3263171">)</span><span class="op" id="3263172">;</span>&nbsp;<span class="ident" id="3263174"><a href="/gostd/net/fd_unix.go.html#3263146">err</a></span>&nbsp;<span class="op" id="3263178">!=</span>&nbsp;<span class="builtintype" id="3263181">nil</span>&nbsp;<span class="op" id="3263185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263189">return</span>&nbsp;<span class="num" id="3263196">0</span><span class="op" id="3263197">,</span>&nbsp;<span class="builtintype" id="3263199">nil</span><span class="op" id="3263202">,</span>&nbsp;<span class="op" id="3263204">&amp;</span><span class="ident" id="3263205"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3263212">{</span><span class="string" id="3263213">&#34;read&#34;</span><span class="op" id="3263219">,</span>&nbsp;<span class="ident" id="3263221"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263223">.</span><span class="ident" id="3263224"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3263227">,</span>&nbsp;<span class="ident" id="3263229"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263231">.</span><span class="ident" id="3263232"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3263237">,</span>&nbsp;<span class="ident" id="3263239"><a href="/gostd/net/fd_unix.go.html#3263146">err</a></span><span class="op" id="3263242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263248">for</span>&nbsp;<span class="op" id="3263252">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3263256"><a href="/gostd/net/fd_unix.go.html#3263015">n</a></span><span class="op" id="3263257">,</span>&nbsp;<span class="ident" id="3263259"><a href="/gostd/net/fd_unix.go.html#3263022">sa</a></span><span class="op" id="3263261">,</span>&nbsp;<span class="ident" id="3263263"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263267">=</span>&nbsp;<span class="ident" id="3263269"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3263276">.</span><span class="ident" id="3263277"><a href="/gostd/syscall/syscall_unix.go.html#2548121">Recvfrom</a></span><span class="op" id="3263285">(</span><span class="ident" id="3263286"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263288">.</span><span class="ident" id="3263289"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3263294">,</span>&nbsp;<span class="ident" id="3263296"><a href="/gostd/net/fd_unix.go.html#3263004">p</a></span><span class="op" id="3263297">,</span>&nbsp;<span class="num" id="3263299">0</span><span class="op" id="3263300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263304">if</span>&nbsp;<span class="ident" id="3263307"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263311">!=</span>&nbsp;<span class="builtintype" id="3263314">nil</span>&nbsp;<span class="op" id="3263318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3263323"><a href="/gostd/net/fd_unix.go.html#3263015">n</a></span>&nbsp;<span class="op" id="3263325">=</span>&nbsp;<span class="num" id="3263327">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263332">if</span>&nbsp;<span class="ident" id="3263335"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263339">==</span>&nbsp;<span class="ident" id="3263342"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3263349">.</span><span class="ident" id="3263350"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3263357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263363">if</span>&nbsp;<span class="ident" id="3263366"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263370">=</span>&nbsp;<span class="ident" id="3263372"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263374">.</span><span class="ident" id="3263375"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3263377">.</span><span class="ident" id="3263378"><a href="/gostd/net/fd_poll_runtime.go.html#3255944">WaitRead</a></span><span class="op" id="3263386">(</span><span class="op" id="3263387">)</span><span class="op" id="3263388">;</span>&nbsp;<span class="ident" id="3263390"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263394">==</span>&nbsp;<span class="builtintype" id="3263397">nil</span>&nbsp;<span class="op" id="3263401">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263408">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3263434"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263438">=</span>&nbsp;<span class="ident" id="3263440"><a href="/gostd/net/fd_unix.go.html#3264257">chkReadErr</a></span><span class="op" id="3263450">(</span><span class="ident" id="3263451"><a href="/gostd/net/fd_unix.go.html#3263015">n</a></span><span class="op" id="3263452">,</span>&nbsp;<span class="ident" id="3263454"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span><span class="op" id="3263457">,</span>&nbsp;<span class="ident" id="3263459"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263461">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263465">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263475">if</span>&nbsp;<span class="ident" id="3263478"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263482">!=</span>&nbsp;<span class="builtintype" id="3263485">nil</span>&nbsp;<span class="op" id="3263489">&amp;&amp;</span>&nbsp;<span class="ident" id="3263492"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263496">!=</span>&nbsp;<span class="ident" id="3263499"><a href="/gostd/net/fd_unix.go.html#3257269">io</a></span><span class="op" id="3263501">.</span><span class="ident" id="3263502"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="3263506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3263510"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span>&nbsp;<span class="op" id="3263514">=</span>&nbsp;<span class="op" id="3263516">&amp;</span><span class="ident" id="3263517"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3263524">{</span><span class="string" id="3263525">&#34;read&#34;</span><span class="op" id="3263531">,</span>&nbsp;<span class="ident" id="3263533"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263535">.</span><span class="ident" id="3263536"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3263539">,</span>&nbsp;<span class="ident" id="3263541"><a href="/gostd/net/fd_unix.go.html#3262984">fd</a></span><span class="op" id="3263543">.</span><span class="ident" id="3263544"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3263549">,</span>&nbsp;<span class="ident" id="3263551"><a href="/gostd/net/fd_unix.go.html#3263043">err</a></span><span class="op" id="3263554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263557">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263560">return</span><br>
<span class="lineno"></span><span class="op" id="3263567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3263570">func</span>&nbsp;<span class="op" id="3263575">(</span><span class="ident" id="3263576">fd</span>&nbsp;<span class="op" id="3263579">*</span><span class="ident" id="3263580"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3263585">)</span>&nbsp;<span class="ident" id="3263587">readMsg</span><span class="op" id="3263594">(</span><span class="ident" id="3263595">p</span>&nbsp;<span class="op" id="3263597">[</span><span class="op" id="3263598">]</span><span class="builtintype" id="3263599">byte</span><span class="op" id="3263603">,</span>&nbsp;<span class="ident" id="3263605">oob</span>&nbsp;<span class="op" id="3263609">[</span><span class="op" id="3263610">]</span><span class="builtintype" id="3263611">byte</span><span class="op" id="3263615">)</span>&nbsp;<span class="op" id="3263617">(</span><span class="ident" id="3263618">n</span><span class="op" id="3263619">,</span>&nbsp;<span class="ident" id="3263621">oobn</span><span class="op" id="3263625">,</span>&nbsp;<span class="ident" id="3263627">flags</span>&nbsp;<span class="builtintype" id="3263633">int</span><span class="op" id="3263636">,</span>&nbsp;<span class="ident" id="3263638">sa</span>&nbsp;<span class="ident" id="3263641"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3263648">.</span><span class="ident" id="3263649"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><span class="op" id="3263657">,</span>&nbsp;<span class="ident" id="3263659">err</span>&nbsp;<span class="builtintype" id="3263663">error</span><span class="op" id="3263668">)</span>&nbsp;<span class="op" id="3263670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263673">if</span>&nbsp;<span class="ident" id="3263676">err</span>&nbsp;<span class="op" id="3263680">:=</span>&nbsp;<span class="ident" id="3263683"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3263685">.</span><span class="ident" id="3263686"><a href="/gostd/net/fd_unix.go.html#3260884">readLock</a></span><span class="op" id="3263694">(</span><span class="op" id="3263695">)</span><span class="op" id="3263696">;</span>&nbsp;<span class="ident" id="3263698"><a href="/gostd/net/fd_unix.go.html#3263676">err</a></span>&nbsp;<span class="op" id="3263702">!=</span>&nbsp;<span class="builtintype" id="3263705">nil</span>&nbsp;<span class="op" id="3263709">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263713">return</span>&nbsp;<span class="num" id="3263720">0</span><span class="op" id="3263721">,</span>&nbsp;<span class="num" id="3263723">0</span><span class="op" id="3263724">,</span>&nbsp;<span class="num" id="3263726">0</span><span class="op" id="3263727">,</span>&nbsp;<span class="builtintype" id="3263729">nil</span><span class="op" id="3263732">,</span>&nbsp;<span class="ident" id="3263734"><a href="/gostd/net/fd_unix.go.html#3263676">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263742">defer</span>&nbsp;<span class="ident" id="3263748"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3263750">.</span><span class="ident" id="3263751"><a href="/gostd/net/fd_unix.go.html#3261043">readUnlock</a></span><span class="op" id="3263761">(</span><span class="op" id="3263762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263765">if</span>&nbsp;<span class="ident" id="3263768">err</span>&nbsp;<span class="op" id="3263772">:=</span>&nbsp;<span class="ident" id="3263775"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3263777">.</span><span class="ident" id="3263778"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3263780">.</span><span class="ident" id="3263781"><a href="/gostd/net/fd_poll_runtime.go.html#3255689">PrepareRead</a></span><span class="op" id="3263792">(</span><span class="op" id="3263793">)</span><span class="op" id="3263794">;</span>&nbsp;<span class="ident" id="3263796"><a href="/gostd/net/fd_unix.go.html#3263768">err</a></span>&nbsp;<span class="op" id="3263800">!=</span>&nbsp;<span class="builtintype" id="3263803">nil</span>&nbsp;<span class="op" id="3263807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263811">return</span>&nbsp;<span class="num" id="3263818">0</span><span class="op" id="3263819">,</span>&nbsp;<span class="num" id="3263821">0</span><span class="op" id="3263822">,</span>&nbsp;<span class="num" id="3263824">0</span><span class="op" id="3263825">,</span>&nbsp;<span class="builtintype" id="3263827">nil</span><span class="op" id="3263830">,</span>&nbsp;<span class="op" id="3263832">&amp;</span><span class="ident" id="3263833"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3263840">{</span><span class="string" id="3263841">&#34;read&#34;</span><span class="op" id="3263847">,</span>&nbsp;<span class="ident" id="3263849"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3263851">.</span><span class="ident" id="3263852"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3263855">,</span>&nbsp;<span class="ident" id="3263857"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3263859">.</span><span class="ident" id="3263860"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3263865">,</span>&nbsp;<span class="ident" id="3263867"><a href="/gostd/net/fd_unix.go.html#3263768">err</a></span><span class="op" id="3263870">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3263873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263876">for</span>&nbsp;<span class="op" id="3263880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3263884"><a href="/gostd/net/fd_unix.go.html#3263618">n</a></span><span class="op" id="3263885">,</span>&nbsp;<span class="ident" id="3263887"><a href="/gostd/net/fd_unix.go.html#3263621">oobn</a></span><span class="op" id="3263891">,</span>&nbsp;<span class="ident" id="3263893"><a href="/gostd/net/fd_unix.go.html#3263627">flags</a></span><span class="op" id="3263898">,</span>&nbsp;<span class="ident" id="3263900"><a href="/gostd/net/fd_unix.go.html#3263638">sa</a></span><span class="op" id="3263902">,</span>&nbsp;<span class="ident" id="3263904"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3263908">=</span>&nbsp;<span class="ident" id="3263910"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3263917">.</span><span class="ident" id="3263918"><a href="/gostd/syscall/syscall_linux.go.html#2524091">Recvmsg</a></span><span class="op" id="3263925">(</span><span class="ident" id="3263926"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3263928">.</span><span class="ident" id="3263929"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3263934">,</span>&nbsp;<span class="ident" id="3263936"><a href="/gostd/net/fd_unix.go.html#3263595">p</a></span><span class="op" id="3263937">,</span>&nbsp;<span class="ident" id="3263939"><a href="/gostd/net/fd_unix.go.html#3263605">oob</a></span><span class="op" id="3263942">,</span>&nbsp;<span class="num" id="3263944">0</span><span class="op" id="3263945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3263949">if</span>&nbsp;<span class="ident" id="3263952"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3263956">!=</span>&nbsp;<span class="builtintype" id="3263959">nil</span>&nbsp;<span class="op" id="3263963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3263968">//&nbsp;TODO(dfc)&nbsp;should&nbsp;n&nbsp;and&nbsp;oobn&nbsp;be&nbsp;set&nbsp;to&nbsp;0</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264014">if</span>&nbsp;<span class="ident" id="3264017"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264021">==</span>&nbsp;<span class="ident" id="3264024"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3264031">.</span><span class="ident" id="3264032"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3264039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264045">if</span>&nbsp;<span class="ident" id="3264048"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264052">=</span>&nbsp;<span class="ident" id="3264054"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3264056">.</span><span class="ident" id="3264057"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3264059">.</span><span class="ident" id="3264060"><a href="/gostd/net/fd_poll_runtime.go.html#3255944">WaitRead</a></span><span class="op" id="3264068">(</span><span class="op" id="3264069">)</span><span class="op" id="3264070">;</span>&nbsp;<span class="ident" id="3264072"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264076">==</span>&nbsp;<span class="builtintype" id="3264079">nil</span>&nbsp;<span class="op" id="3264083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264090">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264108">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3264116"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264120">=</span>&nbsp;<span class="ident" id="3264122"><a href="/gostd/net/fd_unix.go.html#3264257">chkReadErr</a></span><span class="op" id="3264132">(</span><span class="ident" id="3264133"><a href="/gostd/net/fd_unix.go.html#3263618">n</a></span><span class="op" id="3264134">,</span>&nbsp;<span class="ident" id="3264136"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span><span class="op" id="3264139">,</span>&nbsp;<span class="ident" id="3264141"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3264143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264147">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264157">if</span>&nbsp;<span class="ident" id="3264160"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264164">!=</span>&nbsp;<span class="builtintype" id="3264167">nil</span>&nbsp;<span class="op" id="3264171">&amp;&amp;</span>&nbsp;<span class="ident" id="3264174"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264178">!=</span>&nbsp;<span class="ident" id="3264181"><a href="/gostd/net/fd_unix.go.html#3257269">io</a></span><span class="op" id="3264183">.</span><span class="ident" id="3264184"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="3264188">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3264192"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span>&nbsp;<span class="op" id="3264196">=</span>&nbsp;<span class="op" id="3264198">&amp;</span><span class="ident" id="3264199"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3264206">{</span><span class="string" id="3264207">&#34;read&#34;</span><span class="op" id="3264213">,</span>&nbsp;<span class="ident" id="3264215"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3264217">.</span><span class="ident" id="3264218"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3264221">,</span>&nbsp;<span class="ident" id="3264223"><a href="/gostd/net/fd_unix.go.html#3263576">fd</a></span><span class="op" id="3264225">.</span><span class="ident" id="3264226"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3264231">,</span>&nbsp;<span class="ident" id="3264233"><a href="/gostd/net/fd_unix.go.html#3263659">err</a></span><span class="op" id="3264236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264242">return</span><br>
<span class="lineno"></span><span class="op" id="3264249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span><span class="keyword" id="3264252">func</span>&nbsp;<span class="ident" id="3264257">chkReadErr</span><span class="op" id="3264267">(</span><span class="ident" id="3264268">n</span>&nbsp;<span class="builtintype" id="3264270">int</span><span class="op" id="3264273">,</span>&nbsp;<span class="ident" id="3264275">err</span>&nbsp;<span class="builtintype" id="3264279">error</span><span class="op" id="3264284">,</span>&nbsp;<span class="ident" id="3264286">fd</span>&nbsp;<span class="op" id="3264289">*</span><span class="ident" id="3264290"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3264295">)</span>&nbsp;<span class="builtintype" id="3264297">error</span>&nbsp;<span class="op" id="3264303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264306">if</span>&nbsp;<span class="ident" id="3264309"><a href="/gostd/net/fd_unix.go.html#3264268">n</a></span>&nbsp;<span class="op" id="3264311">==</span>&nbsp;<span class="num" id="3264314">0</span>&nbsp;<span class="op" id="3264316">&amp;&amp;</span>&nbsp;<span class="ident" id="3264319"><a href="/gostd/net/fd_unix.go.html#3264275">err</a></span>&nbsp;<span class="op" id="3264323">==</span>&nbsp;<span class="builtintype" id="3264326">nil</span>&nbsp;<span class="op" id="3264330">&amp;&amp;</span>&nbsp;<span class="ident" id="3264333"><a href="/gostd/net/fd_unix.go.html#3264286">fd</a></span><span class="op" id="3264335">.</span><span class="ident" id="3264336"><a href="/gostd/net/fd_unix.go.html#3257527">sotype</a></span>&nbsp;<span class="op" id="3264343">!=</span>&nbsp;<span class="ident" id="3264346"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3264353">.</span><span class="ident" id="3264354"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2591788">SOCK_DGRAM</a></span>&nbsp;<span class="op" id="3264365">&amp;&amp;</span>&nbsp;<span class="ident" id="3264368"><a href="/gostd/net/fd_unix.go.html#3264286">fd</a></span><span class="op" id="3264370">.</span><span class="ident" id="3264371"><a href="/gostd/net/fd_unix.go.html#3257527">sotype</a></span>&nbsp;<span class="op" id="3264378">!=</span>&nbsp;<span class="ident" id="3264381"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3264388">.</span><span class="ident" id="3264389"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2591910">SOCK_RAW</a></span>&nbsp;<span class="op" id="3264398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264402">return</span>&nbsp;<span class="ident" id="3264409"><a href="/gostd/net/fd_unix.go.html#3257269">io</a></span><span class="op" id="3264411">.</span><span class="ident" id="3264412"><a href="/gostd/io/io.go.html#1419950">EOF</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264420">return</span>&nbsp;<span class="ident" id="3264427"><a href="/gostd/net/fd_unix.go.html#3264275">err</a></span><br>
<span class="lineno">315</span><span class="op" id="3264431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3264434">func</span>&nbsp;<span class="op" id="3264439">(</span><span class="ident" id="3264440">fd</span>&nbsp;<span class="op" id="3264443">*</span><span class="ident" id="3264444"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3264449">)</span>&nbsp;<span class="ident" id="3264451">Write</span><span class="op" id="3264456">(</span><span class="ident" id="3264457">p</span>&nbsp;<span class="op" id="3264459">[</span><span class="op" id="3264460">]</span><span class="builtintype" id="3264461">byte</span><span class="op" id="3264465">)</span>&nbsp;<span class="op" id="3264467">(</span><span class="ident" id="3264468">nn</span>&nbsp;<span class="builtintype" id="3264471">int</span><span class="op" id="3264474">,</span>&nbsp;<span class="ident" id="3264476">err</span>&nbsp;<span class="builtintype" id="3264480">error</span><span class="op" id="3264485">)</span>&nbsp;<span class="op" id="3264487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264490">if</span>&nbsp;<span class="ident" id="3264493">err</span>&nbsp;<span class="op" id="3264497">:=</span>&nbsp;<span class="ident" id="3264500"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264502">.</span><span class="ident" id="3264503"><a href="/gostd/net/fd_unix.go.html#3261223">writeLock</a></span><span class="op" id="3264512">(</span><span class="op" id="3264513">)</span><span class="op" id="3264514">;</span>&nbsp;<span class="ident" id="3264516"><a href="/gostd/net/fd_unix.go.html#3264493">err</a></span>&nbsp;<span class="op" id="3264520">!=</span>&nbsp;<span class="builtintype" id="3264523">nil</span>&nbsp;<span class="op" id="3264527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264531">return</span>&nbsp;<span class="num" id="3264538">0</span><span class="op" id="3264539">,</span>&nbsp;<span class="ident" id="3264541"><a href="/gostd/net/fd_unix.go.html#3264493">err</a></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264549">defer</span>&nbsp;<span class="ident" id="3264555"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264557">.</span><span class="ident" id="3264558"><a href="/gostd/net/fd_unix.go.html#3261384">writeUnlock</a></span><span class="op" id="3264569">(</span><span class="op" id="3264570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264573">if</span>&nbsp;<span class="ident" id="3264576">err</span>&nbsp;<span class="op" id="3264580">:=</span>&nbsp;<span class="ident" id="3264583"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264585">.</span><span class="ident" id="3264586"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3264588">.</span><span class="ident" id="3264589"><a href="/gostd/net/fd_poll_runtime.go.html#3255758">PrepareWrite</a></span><span class="op" id="3264601">(</span><span class="op" id="3264602">)</span><span class="op" id="3264603">;</span>&nbsp;<span class="ident" id="3264605"><a href="/gostd/net/fd_unix.go.html#3264576">err</a></span>&nbsp;<span class="op" id="3264609">!=</span>&nbsp;<span class="builtintype" id="3264612">nil</span>&nbsp;<span class="op" id="3264616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264620">return</span>&nbsp;<span class="num" id="3264627">0</span><span class="op" id="3264628">,</span>&nbsp;<span class="op" id="3264630">&amp;</span><span class="ident" id="3264631"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3264638">{</span><span class="string" id="3264639">&#34;write&#34;</span><span class="op" id="3264646">,</span>&nbsp;<span class="ident" id="3264648"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264650">.</span><span class="ident" id="3264651"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3264654">,</span>&nbsp;<span class="ident" id="3264656"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264658">.</span><span class="ident" id="3264659"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3264664">,</span>&nbsp;<span class="ident" id="3264666"><a href="/gostd/net/fd_unix.go.html#3264576">err</a></span><span class="op" id="3264669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264672">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264675">for</span>&nbsp;<span class="op" id="3264679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264683">var</span>&nbsp;<span class="ident" id="3264687">n</span>&nbsp;<span class="builtintype" id="3264689">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3264695"><a href="/gostd/net/fd_unix.go.html#3264687">n</a></span><span class="op" id="3264696">,</span>&nbsp;<span class="ident" id="3264698"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3264702">=</span>&nbsp;<span class="ident" id="3264704"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3264711">.</span><span class="ident" id="3264712"><a href="/gostd/syscall/syscall_unix.go.html#2546723">Write</a></span><span class="op" id="3264717">(</span><span class="builtintype" id="3264718">int</span><span class="op" id="3264721">(</span><span class="ident" id="3264722"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264724">.</span><span class="ident" id="3264725"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3264730">)</span><span class="op" id="3264731">,</span>&nbsp;<span class="ident" id="3264733"><a href="/gostd/net/fd_unix.go.html#3264457">p</a></span><span class="op" id="3264734">[</span><span class="ident" id="3264735"><a href="/gostd/net/fd_unix.go.html#3264468">nn</a></span><span class="op" id="3264737">:</span><span class="op" id="3264738">]</span><span class="op" id="3264739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264743">if</span>&nbsp;<span class="ident" id="3264746"><a href="/gostd/net/fd_unix.go.html#3264687">n</a></span>&nbsp;<span class="op" id="3264748">&gt;</span>&nbsp;<span class="num" id="3264750">0</span>&nbsp;<span class="op" id="3264752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3264757"><a href="/gostd/net/fd_unix.go.html#3264468">nn</a></span>&nbsp;<span class="op" id="3264760">+=</span>&nbsp;<span class="ident" id="3264763"><a href="/gostd/net/fd_unix.go.html#3264687">n</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264771">if</span>&nbsp;<span class="ident" id="3264774"><a href="/gostd/net/fd_unix.go.html#3264468">nn</a></span>&nbsp;<span class="op" id="3264777">==</span>&nbsp;<span class="builtinfunc" id="3264780">len</span><span class="op" id="3264783">(</span><span class="ident" id="3264784"><a href="/gostd/net/fd_unix.go.html#3264457">p</a></span><span class="op" id="3264785">)</span>&nbsp;<span class="op" id="3264787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264792">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264804">if</span>&nbsp;<span class="ident" id="3264807"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3264811">==</span>&nbsp;<span class="ident" id="3264814"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3264821">.</span><span class="ident" id="3264822"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3264829">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264834">if</span>&nbsp;<span class="ident" id="3264837"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3264841">=</span>&nbsp;<span class="ident" id="3264843"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3264845">.</span><span class="ident" id="3264846"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3264848">.</span><span class="ident" id="3264849"><a href="/gostd/net/fd_poll_runtime.go.html#3256007">WaitWrite</a></span><span class="op" id="3264858">(</span><span class="op" id="3264859">)</span><span class="op" id="3264860">;</span>&nbsp;<span class="ident" id="3264862"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3264866">==</span>&nbsp;<span class="builtintype" id="3264869">nil</span>&nbsp;<span class="op" id="3264873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264879">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264899">if</span>&nbsp;<span class="ident" id="3264902"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3264906">!=</span>&nbsp;<span class="builtintype" id="3264909">nil</span>&nbsp;<span class="op" id="3264913">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3264918"><a href="/gostd/net/fd_unix.go.html#3264687">n</a></span>&nbsp;<span class="op" id="3264920">=</span>&nbsp;<span class="num" id="3264922">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264927">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264939">if</span>&nbsp;<span class="ident" id="3264942"><a href="/gostd/net/fd_unix.go.html#3264687">n</a></span>&nbsp;<span class="op" id="3264944">==</span>&nbsp;<span class="num" id="3264947">0</span>&nbsp;<span class="op" id="3264949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3264954"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3264958">=</span>&nbsp;<span class="ident" id="3264960"><a href="/gostd/net/fd_unix.go.html#3257269">io</a></span><span class="op" id="3264962">.</span><span class="ident" id="3264963"><a href="/gostd/io/io.go.html#1420096">ErrUnexpectedEOF</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264983">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3264994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3264997">if</span>&nbsp;<span class="ident" id="3265000"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3265004">!=</span>&nbsp;<span class="builtintype" id="3265007">nil</span>&nbsp;<span class="op" id="3265011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3265015"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span>&nbsp;<span class="op" id="3265019">=</span>&nbsp;<span class="op" id="3265021">&amp;</span><span class="ident" id="3265022"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3265029">{</span><span class="string" id="3265030">&#34;write&#34;</span><span class="op" id="3265037">,</span>&nbsp;<span class="ident" id="3265039"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3265041">.</span><span class="ident" id="3265042"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3265045">,</span>&nbsp;<span class="ident" id="3265047"><a href="/gostd/net/fd_unix.go.html#3264440">fd</a></span><span class="op" id="3265049">.</span><span class="ident" id="3265050"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3265055">,</span>&nbsp;<span class="ident" id="3265057"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span><span class="op" id="3265060">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265066">return</span>&nbsp;<span class="ident" id="3265073"><a href="/gostd/net/fd_unix.go.html#3264468">nn</a></span><span class="op" id="3265075">,</span>&nbsp;<span class="ident" id="3265077"><a href="/gostd/net/fd_unix.go.html#3264476">err</a></span><br>
<span class="lineno"></span><span class="op" id="3265081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3265084">func</span>&nbsp;<span class="op" id="3265089">(</span><span class="ident" id="3265090">fd</span>&nbsp;<span class="op" id="3265093">*</span><span class="ident" id="3265094"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3265099">)</span>&nbsp;<span class="ident" id="3265101">writeTo</span><span class="op" id="3265108">(</span><span class="ident" id="3265109">p</span>&nbsp;<span class="op" id="3265111">[</span><span class="op" id="3265112">]</span><span class="builtintype" id="3265113">byte</span><span class="op" id="3265117">,</span>&nbsp;<span class="ident" id="3265119">sa</span>&nbsp;<span class="ident" id="3265122"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3265129">.</span><span class="ident" id="3265130"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><span class="op" id="3265138">)</span>&nbsp;<span class="op" id="3265140">(</span><span class="ident" id="3265141">n</span>&nbsp;<span class="builtintype" id="3265143">int</span><span class="op" id="3265146">,</span>&nbsp;<span class="ident" id="3265148">err</span>&nbsp;<span class="builtintype" id="3265152">error</span><span class="op" id="3265157">)</span>&nbsp;<span class="op" id="3265159">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265162">if</span>&nbsp;<span class="ident" id="3265165">err</span>&nbsp;<span class="op" id="3265169">:=</span>&nbsp;<span class="ident" id="3265172"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265174">.</span><span class="ident" id="3265175"><a href="/gostd/net/fd_unix.go.html#3261223">writeLock</a></span><span class="op" id="3265184">(</span><span class="op" id="3265185">)</span><span class="op" id="3265186">;</span>&nbsp;<span class="ident" id="3265188"><a href="/gostd/net/fd_unix.go.html#3265165">err</a></span>&nbsp;<span class="op" id="3265192">!=</span>&nbsp;<span class="builtintype" id="3265195">nil</span>&nbsp;<span class="op" id="3265199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265203">return</span>&nbsp;<span class="num" id="3265210">0</span><span class="op" id="3265211">,</span>&nbsp;<span class="ident" id="3265213"><a href="/gostd/net/fd_unix.go.html#3265165">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265221">defer</span>&nbsp;<span class="ident" id="3265227"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265229">.</span><span class="ident" id="3265230"><a href="/gostd/net/fd_unix.go.html#3261384">writeUnlock</a></span><span class="op" id="3265241">(</span><span class="op" id="3265242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265245">if</span>&nbsp;<span class="ident" id="3265248">err</span>&nbsp;<span class="op" id="3265252">:=</span>&nbsp;<span class="ident" id="3265255"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265257">.</span><span class="ident" id="3265258"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3265260">.</span><span class="ident" id="3265261"><a href="/gostd/net/fd_poll_runtime.go.html#3255758">PrepareWrite</a></span><span class="op" id="3265273">(</span><span class="op" id="3265274">)</span><span class="op" id="3265275">;</span>&nbsp;<span class="ident" id="3265277"><a href="/gostd/net/fd_unix.go.html#3265248">err</a></span>&nbsp;<span class="op" id="3265281">!=</span>&nbsp;<span class="builtintype" id="3265284">nil</span>&nbsp;<span class="op" id="3265288">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265292">return</span>&nbsp;<span class="num" id="3265299">0</span><span class="op" id="3265300">,</span>&nbsp;<span class="op" id="3265302">&amp;</span><span class="ident" id="3265303"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3265310">{</span><span class="string" id="3265311">&#34;write&#34;</span><span class="op" id="3265318">,</span>&nbsp;<span class="ident" id="3265320"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265322">.</span><span class="ident" id="3265323"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3265326">,</span>&nbsp;<span class="ident" id="3265328"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265330">.</span><span class="ident" id="3265331"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3265336">,</span>&nbsp;<span class="ident" id="3265338"><a href="/gostd/net/fd_unix.go.html#3265248">err</a></span><span class="op" id="3265341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265347">for</span>&nbsp;<span class="op" id="3265351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3265355"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span>&nbsp;<span class="op" id="3265359">=</span>&nbsp;<span class="ident" id="3265361"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3265368">.</span><span class="ident" id="3265369"><a href="/gostd/syscall/syscall_unix.go.html#2548419">Sendto</a></span><span class="op" id="3265375">(</span><span class="ident" id="3265376"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265378">.</span><span class="ident" id="3265379"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3265384">,</span>&nbsp;<span class="ident" id="3265386"><a href="/gostd/net/fd_unix.go.html#3265109">p</a></span><span class="op" id="3265387">,</span>&nbsp;<span class="num" id="3265389">0</span><span class="op" id="3265390">,</span>&nbsp;<span class="ident" id="3265392"><a href="/gostd/net/fd_unix.go.html#3265119">sa</a></span><span class="op" id="3265394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265398">if</span>&nbsp;<span class="ident" id="3265401"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span>&nbsp;<span class="op" id="3265405">==</span>&nbsp;<span class="ident" id="3265408"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3265415">.</span><span class="ident" id="3265416"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3265423">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265428">if</span>&nbsp;<span class="ident" id="3265431"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span>&nbsp;<span class="op" id="3265435">=</span>&nbsp;<span class="ident" id="3265437"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265439">.</span><span class="ident" id="3265440"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3265442">.</span><span class="ident" id="3265443"><a href="/gostd/net/fd_poll_runtime.go.html#3256007">WaitWrite</a></span><span class="op" id="3265452">(</span><span class="op" id="3265453">)</span><span class="op" id="3265454">;</span>&nbsp;<span class="ident" id="3265456"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span>&nbsp;<span class="op" id="3265460">==</span>&nbsp;<span class="builtintype" id="3265463">nil</span>&nbsp;<span class="op" id="3265467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265473">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265493">break</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265503">if</span>&nbsp;<span class="ident" id="3265506"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span>&nbsp;<span class="op" id="3265510">==</span>&nbsp;<span class="builtintype" id="3265513">nil</span>&nbsp;<span class="op" id="3265517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3265521"><a href="/gostd/net/fd_unix.go.html#3265141">n</a></span>&nbsp;<span class="op" id="3265523">=</span>&nbsp;<span class="builtinfunc" id="3265525">len</span><span class="op" id="3265528">(</span><span class="ident" id="3265529"><a href="/gostd/net/fd_unix.go.html#3265109">p</a></span><span class="op" id="3265530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265533">}</span>&nbsp;<span class="keyword" id="3265535">else</span>&nbsp;<span class="op" id="3265540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3265544"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span>&nbsp;<span class="op" id="3265548">=</span>&nbsp;<span class="op" id="3265550">&amp;</span><span class="ident" id="3265551"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3265558">{</span><span class="string" id="3265559">&#34;write&#34;</span><span class="op" id="3265566">,</span>&nbsp;<span class="ident" id="3265568"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265570">.</span><span class="ident" id="3265571"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3265574">,</span>&nbsp;<span class="ident" id="3265576"><a href="/gostd/net/fd_unix.go.html#3265090">fd</a></span><span class="op" id="3265578">.</span><span class="ident" id="3265579"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3265584">,</span>&nbsp;<span class="ident" id="3265586"><a href="/gostd/net/fd_unix.go.html#3265148">err</a></span><span class="op" id="3265589">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265595">return</span><br>
<span class="lineno"></span><span class="op" id="3265602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3265605">func</span>&nbsp;<span class="op" id="3265610">(</span><span class="ident" id="3265611">fd</span>&nbsp;<span class="op" id="3265614">*</span><span class="ident" id="3265615"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3265620">)</span>&nbsp;<span class="ident" id="3265622">writeMsg</span><span class="op" id="3265630">(</span><span class="ident" id="3265631">p</span>&nbsp;<span class="op" id="3265633">[</span><span class="op" id="3265634">]</span><span class="builtintype" id="3265635">byte</span><span class="op" id="3265639">,</span>&nbsp;<span class="ident" id="3265641">oob</span>&nbsp;<span class="op" id="3265645">[</span><span class="op" id="3265646">]</span><span class="builtintype" id="3265647">byte</span><span class="op" id="3265651">,</span>&nbsp;<span class="ident" id="3265653">sa</span>&nbsp;<span class="ident" id="3265656"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3265663">.</span><span class="ident" id="3265664"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><span class="op" id="3265672">)</span>&nbsp;<span class="op" id="3265674">(</span><span class="ident" id="3265675">n</span>&nbsp;<span class="builtintype" id="3265677">int</span><span class="op" id="3265680">,</span>&nbsp;<span class="ident" id="3265682">oobn</span>&nbsp;<span class="builtintype" id="3265687">int</span><span class="op" id="3265690">,</span>&nbsp;<span class="ident" id="3265692">err</span>&nbsp;<span class="builtintype" id="3265696">error</span><span class="op" id="3265701">)</span>&nbsp;<span class="op" id="3265703">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265706">if</span>&nbsp;<span class="ident" id="3265709">err</span>&nbsp;<span class="op" id="3265713">:=</span>&nbsp;<span class="ident" id="3265716"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265718">.</span><span class="ident" id="3265719"><a href="/gostd/net/fd_unix.go.html#3261223">writeLock</a></span><span class="op" id="3265728">(</span><span class="op" id="3265729">)</span><span class="op" id="3265730">;</span>&nbsp;<span class="ident" id="3265732"><a href="/gostd/net/fd_unix.go.html#3265709">err</a></span>&nbsp;<span class="op" id="3265736">!=</span>&nbsp;<span class="builtintype" id="3265739">nil</span>&nbsp;<span class="op" id="3265743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265747">return</span>&nbsp;<span class="num" id="3265754">0</span><span class="op" id="3265755">,</span>&nbsp;<span class="num" id="3265757">0</span><span class="op" id="3265758">,</span>&nbsp;<span class="ident" id="3265760"><a href="/gostd/net/fd_unix.go.html#3265709">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265768">defer</span>&nbsp;<span class="ident" id="3265774"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265776">.</span><span class="ident" id="3265777"><a href="/gostd/net/fd_unix.go.html#3261384">writeUnlock</a></span><span class="op" id="3265788">(</span><span class="op" id="3265789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265792">if</span>&nbsp;<span class="ident" id="3265795">err</span>&nbsp;<span class="op" id="3265799">:=</span>&nbsp;<span class="ident" id="3265802"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265804">.</span><span class="ident" id="3265805"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3265807">.</span><span class="ident" id="3265808"><a href="/gostd/net/fd_poll_runtime.go.html#3255758">PrepareWrite</a></span><span class="op" id="3265820">(</span><span class="op" id="3265821">)</span><span class="op" id="3265822">;</span>&nbsp;<span class="ident" id="3265824"><a href="/gostd/net/fd_unix.go.html#3265795">err</a></span>&nbsp;<span class="op" id="3265828">!=</span>&nbsp;<span class="builtintype" id="3265831">nil</span>&nbsp;<span class="op" id="3265835">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265839">return</span>&nbsp;<span class="num" id="3265846">0</span><span class="op" id="3265847">,</span>&nbsp;<span class="num" id="3265849">0</span><span class="op" id="3265850">,</span>&nbsp;<span class="op" id="3265852">&amp;</span><span class="ident" id="3265853"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3265860">{</span><span class="string" id="3265861">&#34;write&#34;</span><span class="op" id="3265868">,</span>&nbsp;<span class="ident" id="3265870"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265872">.</span><span class="ident" id="3265873"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3265876">,</span>&nbsp;<span class="ident" id="3265878"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265880">.</span><span class="ident" id="3265881"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3265886">,</span>&nbsp;<span class="ident" id="3265888"><a href="/gostd/net/fd_unix.go.html#3265795">err</a></span><span class="op" id="3265891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3265894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265897">for</span>&nbsp;<span class="op" id="3265901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3265905"><a href="/gostd/net/fd_unix.go.html#3265675">n</a></span><span class="op" id="3265906">,</span>&nbsp;<span class="ident" id="3265908"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span>&nbsp;<span class="op" id="3265912">=</span>&nbsp;<span class="ident" id="3265914"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3265921">.</span><span class="ident" id="3265922"><a href="/gostd/syscall/syscall_linux.go.html#2525062">SendmsgN</a></span><span class="op" id="3265930">(</span><span class="ident" id="3265931"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265933">.</span><span class="ident" id="3265934"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3265939">,</span>&nbsp;<span class="ident" id="3265941"><a href="/gostd/net/fd_unix.go.html#3265631">p</a></span><span class="op" id="3265942">,</span>&nbsp;<span class="ident" id="3265944"><a href="/gostd/net/fd_unix.go.html#3265641">oob</a></span><span class="op" id="3265947">,</span>&nbsp;<span class="ident" id="3265949"><a href="/gostd/net/fd_unix.go.html#3265653">sa</a></span><span class="op" id="3265951">,</span>&nbsp;<span class="num" id="3265953">0</span><span class="op" id="3265954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265958">if</span>&nbsp;<span class="ident" id="3265961"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span>&nbsp;<span class="op" id="3265965">==</span>&nbsp;<span class="ident" id="3265968"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3265975">.</span><span class="ident" id="3265976"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3265983">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3265988">if</span>&nbsp;<span class="ident" id="3265991"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span>&nbsp;<span class="op" id="3265995">=</span>&nbsp;<span class="ident" id="3265997"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3265999">.</span><span class="ident" id="3266000"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3266002">.</span><span class="ident" id="3266003"><a href="/gostd/net/fd_poll_runtime.go.html#3256007">WaitWrite</a></span><span class="op" id="3266012">(</span><span class="op" id="3266013">)</span><span class="op" id="3266014">;</span>&nbsp;<span class="ident" id="3266016"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span>&nbsp;<span class="op" id="3266020">==</span>&nbsp;<span class="builtintype" id="3266023">nil</span>&nbsp;<span class="op" id="3266027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266033">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266053">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266063">if</span>&nbsp;<span class="ident" id="3266066"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span>&nbsp;<span class="op" id="3266070">==</span>&nbsp;<span class="builtintype" id="3266073">nil</span>&nbsp;<span class="op" id="3266077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3266081"><a href="/gostd/net/fd_unix.go.html#3265682">oobn</a></span>&nbsp;<span class="op" id="3266086">=</span>&nbsp;<span class="builtinfunc" id="3266088">len</span><span class="op" id="3266091">(</span><span class="ident" id="3266092"><a href="/gostd/net/fd_unix.go.html#3265641">oob</a></span><span class="op" id="3266095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266098">}</span>&nbsp;<span class="keyword" id="3266100">else</span>&nbsp;<span class="op" id="3266105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3266109"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span>&nbsp;<span class="op" id="3266113">=</span>&nbsp;<span class="op" id="3266115">&amp;</span><span class="ident" id="3266116"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3266123">{</span><span class="string" id="3266124">&#34;write&#34;</span><span class="op" id="3266131">,</span>&nbsp;<span class="ident" id="3266133"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3266135">.</span><span class="ident" id="3266136"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3266139">,</span>&nbsp;<span class="ident" id="3266141"><a href="/gostd/net/fd_unix.go.html#3265611">fd</a></span><span class="op" id="3266143">.</span><span class="ident" id="3266144"><a href="/gostd/net/fd_unix.go.html#3257600">raddr</a></span><span class="op" id="3266149">,</span>&nbsp;<span class="ident" id="3266151"><a href="/gostd/net/fd_unix.go.html#3265692">err</a></span><span class="op" id="3266154">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266160">return</span><br>
<span class="lineno"></span><span class="op" id="3266167">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3266170">func</span>&nbsp;<span class="op" id="3266175">(</span><span class="ident" id="3266176">fd</span>&nbsp;<span class="op" id="3266179">*</span><span class="ident" id="3266180"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3266185">)</span>&nbsp;<span class="ident" id="3266187">accept</span><span class="op" id="3266193">(</span><span class="op" id="3266194">)</span>&nbsp;<span class="op" id="3266196">(</span><span class="ident" id="3266197">netfd</span>&nbsp;<span class="op" id="3266203">*</span><span class="ident" id="3266204"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3266209">,</span>&nbsp;<span class="ident" id="3266211">err</span>&nbsp;<span class="builtintype" id="3266215">error</span><span class="op" id="3266220">)</span>&nbsp;<span class="op" id="3266222">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266225">if</span>&nbsp;<span class="ident" id="3266228">err</span>&nbsp;<span class="op" id="3266232">:=</span>&nbsp;<span class="ident" id="3266235"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266237">.</span><span class="ident" id="3266238"><a href="/gostd/net/fd_unix.go.html#3260884">readLock</a></span><span class="op" id="3266246">(</span><span class="op" id="3266247">)</span><span class="op" id="3266248">;</span>&nbsp;<span class="ident" id="3266250"><a href="/gostd/net/fd_unix.go.html#3266228">err</a></span>&nbsp;<span class="op" id="3266254">!=</span>&nbsp;<span class="builtintype" id="3266257">nil</span>&nbsp;<span class="op" id="3266261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266265">return</span>&nbsp;<span class="builtintype" id="3266272">nil</span><span class="op" id="3266275">,</span>&nbsp;<span class="ident" id="3266277"><a href="/gostd/net/fd_unix.go.html#3266228">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266285">defer</span>&nbsp;<span class="ident" id="3266291"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266293">.</span><span class="ident" id="3266294"><a href="/gostd/net/fd_unix.go.html#3261043">readUnlock</a></span><span class="op" id="3266304">(</span><span class="op" id="3266305">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266309">var</span>&nbsp;<span class="ident" id="3266313">s</span>&nbsp;<span class="builtintype" id="3266315">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266320">var</span>&nbsp;<span class="ident" id="3266324">rsa</span>&nbsp;<span class="ident" id="3266328"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3266335">.</span><span class="ident" id="3266336"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266346">if</span>&nbsp;<span class="ident" id="3266349"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266353">=</span>&nbsp;<span class="ident" id="3266355"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266357">.</span><span class="ident" id="3266358"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3266360">.</span><span class="ident" id="3266361"><a href="/gostd/net/fd_poll_runtime.go.html#3255689">PrepareRead</a></span><span class="op" id="3266372">(</span><span class="op" id="3266373">)</span><span class="op" id="3266374">;</span>&nbsp;<span class="ident" id="3266376"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266380">!=</span>&nbsp;<span class="builtintype" id="3266383">nil</span>&nbsp;<span class="op" id="3266387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266391">return</span>&nbsp;<span class="builtintype" id="3266398">nil</span><span class="op" id="3266401">,</span>&nbsp;<span class="op" id="3266403">&amp;</span><span class="ident" id="3266404"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3266411">{</span><span class="string" id="3266412">&#34;accept&#34;</span><span class="op" id="3266420">,</span>&nbsp;<span class="ident" id="3266422"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266424">.</span><span class="ident" id="3266425"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3266428">,</span>&nbsp;<span class="ident" id="3266430"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266432">.</span><span class="ident" id="3266433"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3266438">,</span>&nbsp;<span class="ident" id="3266440"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span><span class="op" id="3266443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266446">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266449">for</span>&nbsp;<span class="op" id="3266453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3266457"><a href="/gostd/net/fd_unix.go.html#3266313">s</a></span><span class="op" id="3266458">,</span>&nbsp;<span class="ident" id="3266460"><a href="/gostd/net/fd_unix.go.html#3266324">rsa</a></span><span class="op" id="3266463">,</span>&nbsp;<span class="ident" id="3266465"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266469">=</span>&nbsp;<span class="ident" id="3266471"><a href="/gostd/net/sock_cloexec.go.html#3358942">accept</a></span><span class="op" id="3266477">(</span><span class="ident" id="3266478"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266480">.</span><span class="ident" id="3266481"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3266486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266490">if</span>&nbsp;<span class="ident" id="3266493"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266497">!=</span>&nbsp;<span class="builtintype" id="3266500">nil</span>&nbsp;<span class="op" id="3266504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266509">if</span>&nbsp;<span class="ident" id="3266512"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266516">==</span>&nbsp;<span class="ident" id="3266519"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3266526">.</span><span class="ident" id="3266527"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600313">EAGAIN</a></span>&nbsp;<span class="op" id="3266534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266540">if</span>&nbsp;<span class="ident" id="3266543"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266547">=</span>&nbsp;<span class="ident" id="3266549"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266551">.</span><span class="ident" id="3266552"><a href="/gostd/net/fd_unix.go.html#3257635">pd</a></span><span class="op" id="3266554">.</span><span class="ident" id="3266555"><a href="/gostd/net/fd_poll_runtime.go.html#3255944">WaitRead</a></span><span class="op" id="3266563">(</span><span class="op" id="3266564">)</span><span class="op" id="3266565">;</span>&nbsp;<span class="ident" id="3266567"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266571">==</span>&nbsp;<span class="builtintype" id="3266574">nil</span>&nbsp;<span class="op" id="3266578">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266585">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266603">}</span>&nbsp;<span class="keyword" id="3266605">else</span>&nbsp;<span class="keyword" id="3266610">if</span>&nbsp;<span class="ident" id="3266613"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266617">==</span>&nbsp;<span class="ident" id="3266620"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3266627">.</span><span class="ident" id="3266628"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600775">ECONNABORTED</a></span>&nbsp;<span class="op" id="3266641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3266647">//&nbsp;This&nbsp;means&nbsp;that&nbsp;a&nbsp;socket&nbsp;on&nbsp;the&nbsp;listen&nbsp;queue&nbsp;was&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3266710">//&nbsp;before&nbsp;we&nbsp;Accept()ed&nbsp;it;&nbsp;it&#39;s&nbsp;a&nbsp;silly&nbsp;error,&nbsp;so&nbsp;try&nbsp;again.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266776">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266793">return</span>&nbsp;<span class="builtintype" id="3266800">nil</span><span class="op" id="3266803">,</span>&nbsp;<span class="op" id="3266805">&amp;</span><span class="ident" id="3266806"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3266813">{</span><span class="string" id="3266814">&#34;accept&#34;</span><span class="op" id="3266822">,</span>&nbsp;<span class="ident" id="3266824"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266826">.</span><span class="ident" id="3266827"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3266830">,</span>&nbsp;<span class="ident" id="3266832"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266834">.</span><span class="ident" id="3266835"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3266840">,</span>&nbsp;<span class="ident" id="3266842"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span><span class="op" id="3266845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266853">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266864">if</span>&nbsp;<span class="ident" id="3266867"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3266872">,</span>&nbsp;<span class="ident" id="3266874"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266878">=</span>&nbsp;<span class="ident" id="3266880"><a href="/gostd/net/fd_unix.go.html#3257812">newFD</a></span><span class="op" id="3266885">(</span><span class="ident" id="3266886"><a href="/gostd/net/fd_unix.go.html#3266313">s</a></span><span class="op" id="3266887">,</span>&nbsp;<span class="ident" id="3266889"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266891">.</span><span class="ident" id="3266892"><a href="/gostd/net/fd_unix.go.html#3257510">family</a></span><span class="op" id="3266898">,</span>&nbsp;<span class="ident" id="3266900"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266902">.</span><span class="ident" id="3266903"><a href="/gostd/net/fd_unix.go.html#3257527">sotype</a></span><span class="op" id="3266909">,</span>&nbsp;<span class="ident" id="3266911"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3266913">.</span><span class="ident" id="3266914"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3266917">)</span><span class="op" id="3266918">;</span>&nbsp;<span class="ident" id="3266920"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266924">!=</span>&nbsp;<span class="builtintype" id="3266927">nil</span>&nbsp;<span class="op" id="3266931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3266935"><a href="/gostd/net/fd_unix.go.html#3269191">closesocket</a></span><span class="op" id="3266946">(</span><span class="ident" id="3266947"><a href="/gostd/net/fd_unix.go.html#3266313">s</a></span><span class="op" id="3266948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266952">return</span>&nbsp;<span class="builtintype" id="3266959">nil</span><span class="op" id="3266962">,</span>&nbsp;<span class="ident" id="3266964"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3266969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3266972">if</span>&nbsp;<span class="ident" id="3266975"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266979">=</span>&nbsp;<span class="ident" id="3266981"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3266986">.</span><span class="ident" id="3266987"><a href="/gostd/net/fd_unix.go.html#3257971">init</a></span><span class="op" id="3266991">(</span><span class="op" id="3266992">)</span><span class="op" id="3266993">;</span>&nbsp;<span class="ident" id="3266995"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span>&nbsp;<span class="op" id="3266999">!=</span>&nbsp;<span class="builtintype" id="3267002">nil</span>&nbsp;<span class="op" id="3267006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3267010"><a href="/gostd/net/fd_unix.go.html#3266176">fd</a></span><span class="op" id="3267012">.</span><span class="ident" id="3267013"><a href="/gostd/net/fd_unix.go.html#3261468">Close</a></span><span class="op" id="3267018">(</span><span class="op" id="3267019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3267023">return</span>&nbsp;<span class="builtintype" id="3267030">nil</span><span class="op" id="3267033">,</span>&nbsp;<span class="ident" id="3267035"><a href="/gostd/net/fd_unix.go.html#3266211">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3267040">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3267043">lsa</span><span class="op" id="3267046">,</span>&nbsp;<span class="ident" id="3267048">_</span>&nbsp;<span class="op" id="3267050">:=</span>&nbsp;<span class="ident" id="3267053"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3267060">.</span><span class="ident" id="3267061"><a href="/gostd/syscall/syscall_linux.go.html#2522263">Getsockname</a></span><span class="op" id="3267072">(</span><span class="ident" id="3267073"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3267078">.</span><span class="ident" id="3267079"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3267084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3267087"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3267092">.</span><span class="ident" id="3267093"><a href="/gostd/net/fd_unix.go.html#3258074">setAddr</a></span><span class="op" id="3267100">(</span><span class="ident" id="3267101"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3267106">.</span><span class="ident" id="3267107"><a href="/gostd/net/sock_posix.go.html#3363585">addrFunc</a></span><span class="op" id="3267115">(</span><span class="op" id="3267116">)</span><span class="op" id="3267117">(</span><span class="ident" id="3267118"><a href="/gostd/net/fd_unix.go.html#3267043">lsa</a></span><span class="op" id="3267121">)</span><span class="op" id="3267122">,</span>&nbsp;<span class="ident" id="3267124"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3267129">.</span><span class="ident" id="3267130"><a href="/gostd/net/sock_posix.go.html#3363585">addrFunc</a></span><span class="op" id="3267138">(</span><span class="op" id="3267139">)</span><span class="op" id="3267140">(</span><span class="ident" id="3267141"><a href="/gostd/net/fd_unix.go.html#3266324">rsa</a></span><span class="op" id="3267144">)</span><span class="op" id="3267145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3267148">return</span>&nbsp;<span class="ident" id="3267155"><a href="/gostd/net/fd_unix.go.html#3266197">netfd</a></span><span class="op" id="3267160">,</span>&nbsp;<span class="builtintype" id="3267162">nil</span><br>
<span class="lineno"></span><span class="op" id="3267166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="comment" id="3267169">//&nbsp;tryDupCloexec&nbsp;indicates&nbsp;whether&nbsp;F_DUPFD_CLOEXEC&nbsp;should&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="3267236">//&nbsp;If&nbsp;the&nbsp;kernel&nbsp;doesn&#39;t&nbsp;support&nbsp;it,&nbsp;this&nbsp;is&nbsp;set&nbsp;to&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3267291">var</span>&nbsp;<span class="ident" id="3267295">tryDupCloexec</span>&nbsp;<span class="op" id="3267309">=</span>&nbsp;<span class="builtintype" id="3267311">int32</span><span class="op" id="3267316">(</span><span class="num" id="3267317">1</span><span class="op" id="3267318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3267321">func</span>&nbsp;<span class="ident" id="3267326">dupCloseOnExec</span><span class="op" id="3267340">(</span><span class="ident" id="3267341">fd</span>&nbsp;<span class="builtintype" id="3267344">int</span><span class="op" id="3267347">)</span>&nbsp;<span class="op" id="3267349">(</span><span class="ident" id="3267350">newfd</span>&nbsp;<span class="builtintype" id="3267356">int</span><span class="op" id="3267359">,</span>&nbsp;<span class="ident" id="3267361">err</span>&nbsp;<span class="builtintype" id="3267365">error</span><span class="op" id="3267370">)</span>&nbsp;<span class="op" id="3267372">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3267375">if</span>&nbsp;<span class="ident" id="3267378"><a href="/gostd/net/fd_unix.go.html#3257292">atomic</a></span><span class="op" id="3267384">.</span><span class="ident" id="3267385"><a href="/gostd/sync/atomic/doc.go.html#1467846">LoadInt32</a></span><span class="op" id="3267394">(</span><span class="op" id="3267395">&amp;</span><span class="ident" id="3267396"><a href="/gostd/net/fd_unix.go.html#3267295">tryDupCloexec</a></span><span class="op" id="3267409">)</span>&nbsp;<span class="op" id="3267411">==</span>&nbsp;<span class="num" id="3267414">1</span>&nbsp;<span class="op" id="3267416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3267420">r0</span><span class="op" id="3267422">,</span>&nbsp;<span class="ident" id="3267424">_</span><span class="op" id="3267425">,</span>&nbsp;<span class="ident" id="3267427">e1</span>&nbsp;<span class="op" id="3267430">:=</span>&nbsp;<span class="ident" id="3267433"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3267440">.</span><span class="ident" id="3267441"><a href="/gostd/syscall/syscall_unix.go.html#2543862">Syscall</a></span><span class="op" id="3267448">(</span><span class="ident" id="3267449"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3267456">.</span><span class="ident" id="3267457"><a href="/gostd/syscall/zsysnum_linux_amd64.go.html#2658350">SYS_FCNTL</a></span><span class="op" id="3267466">,</span>&nbsp;<span class="builtintype" id="3267468">uintptr</span><span class="op" id="3267475">(</span><span class="ident" id="3267476"><a href="/gostd/net/fd_unix.go.html#3267341">fd</a></span><span class="op" id="3267478">)</span><span class="op" id="3267479">,</span>&nbsp;<span class="ident" id="3267481"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3267488">.</span><span class="ident" id="3267489"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2561276">F_DUPFD_CLOEXEC</a></span><span class="op" id="3267504">,</span>&nbsp;<span class="num" id="3267506">0</span><span class="op" id="3267507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3267511">if</span>&nbsp;<span class="ident" id="3267514"><a href="/gostd/net/fd_unix.go.html#3257281">runtime</a></span><span class="op" id="3267521">.</span><span class="ident" id="3267522"><a href="/gostd/runtime/extern.go.html#1533673">GOOS</a></span>&nbsp;<span class="op" id="3267527">==</span>&nbsp;<span class="string" id="3267530">&#34;darwin&#34;</span>&nbsp;<span class="op" id="3267539">&amp;&amp;</span>&nbsp;<span class="ident" id="3267542"><a href="/gostd/net/fd_unix.go.html#3267427">e1</a></span>&nbsp;<span class="op" id="3267545">==</span>&nbsp;<span class="ident" id="3267548"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3267555">.</span><span class="ident" id="3267556"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600405">EBADF</a></span>&nbsp;<span class="op" id="3267562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267567">//&nbsp;On&nbsp;OS&nbsp;X&nbsp;10.6&nbsp;and&nbsp;below&nbsp;(but&nbsp;we&nbsp;only&nbsp;support</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267617">//&nbsp;&gt;=&nbsp;10.6),&nbsp;F_DUPFD_CLOEXEC&nbsp;is&nbsp;unsupported</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267664">//&nbsp;and&nbsp;fcntl&nbsp;there&nbsp;falls&nbsp;back&nbsp;(undocumented)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267712">//&nbsp;to&nbsp;doing&nbsp;an&nbsp;ioctl&nbsp;instead,&nbsp;returning&nbsp;EBADF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267761">//&nbsp;in&nbsp;this&nbsp;case&nbsp;because&nbsp;fd&nbsp;is&nbsp;not&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267805">//&nbsp;expected&nbsp;device&nbsp;fd&nbsp;type.&nbsp;&nbsp;Treat&nbsp;it&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267849">//&nbsp;EINVAL&nbsp;instead,&nbsp;so&nbsp;we&nbsp;fall&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267894">//&nbsp;normal&nbsp;dup&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267917">//&nbsp;TODO:&nbsp;only&nbsp;do&nbsp;this&nbsp;on&nbsp;10.6&nbsp;if&nbsp;we&nbsp;can&nbsp;detect&nbsp;10.6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3267972">//&nbsp;cheaply.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3267987"><a href="/gostd/net/fd_unix.go.html#3267427">e1</a></span>&nbsp;<span class="op" id="3267990">=</span>&nbsp;<span class="ident" id="3267992"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3267999">.</span><span class="ident" id="3268000"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601331">EINVAL</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3268009">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268013">switch</span>&nbsp;<span class="ident" id="3268020"><a href="/gostd/net/fd_unix.go.html#3267427">e1</a></span>&nbsp;<span class="op" id="3268023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268027">case</span>&nbsp;<span class="num" id="3268032">0</span><span class="op" id="3268033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268038">return</span>&nbsp;<span class="builtintype" id="3268045">int</span><span class="op" id="3268048">(</span><span class="ident" id="3268049"><a href="/gostd/net/fd_unix.go.html#3267420">r0</a></span><span class="op" id="3268051">)</span><span class="op" id="3268052">,</span>&nbsp;<span class="builtintype" id="3268054">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268060">case</span>&nbsp;<span class="ident" id="3268065"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3268072">.</span><span class="ident" id="3268073"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2601331">EINVAL</a></span><span class="op" id="3268079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3268084">//&nbsp;Old&nbsp;kernel.&nbsp;Fall&nbsp;back&nbsp;to&nbsp;the&nbsp;portable&nbsp;way</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3268132">//&nbsp;from&nbsp;now&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3268151"><a href="/gostd/net/fd_unix.go.html#3257292">atomic</a></span><span class="op" id="3268157">.</span><span class="ident" id="3268158"><a href="/gostd/sync/atomic/doc.go.html#1468363">StoreInt32</a></span><span class="op" id="3268168">(</span><span class="op" id="3268169">&amp;</span><span class="ident" id="3268170"><a href="/gostd/net/fd_unix.go.html#3267295">tryDupCloexec</a></span><span class="op" id="3268183">,</span>&nbsp;<span class="num" id="3268185">0</span><span class="op" id="3268186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268190">default</span><span class="op" id="3268197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268202">return</span>&nbsp;<span class="op" id="3268209">-</span><span class="num" id="3268210">1</span><span class="op" id="3268211">,</span>&nbsp;<span class="ident" id="3268213"><a href="/gostd/net/fd_unix.go.html#3267427">e1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3268218">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3268221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268224">return</span>&nbsp;<span class="ident" id="3268231"><a href="/gostd/net/fd_unix.go.html#3268376">dupCloseOnExecOld</a></span><span class="op" id="3268248">(</span><span class="ident" id="3268249"><a href="/gostd/net/fd_unix.go.html#3267341">fd</a></span><span class="op" id="3268251">)</span><br>
<span class="lineno"></span><span class="op" id="3268253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3268256">//&nbsp;dupCloseOnExecUnixOld&nbsp;is&nbsp;the&nbsp;traditional&nbsp;way&nbsp;to&nbsp;dup&nbsp;an&nbsp;fd&nbsp;and</span><br>
<span class="lineno">480</span><span class="comment" id="3268321">//&nbsp;set&nbsp;its&nbsp;O_CLOEXEC&nbsp;bit,&nbsp;using&nbsp;two&nbsp;system&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="3268371">func</span>&nbsp;<span class="ident" id="3268376">dupCloseOnExecOld</span><span class="op" id="3268393">(</span><span class="ident" id="3268394">fd</span>&nbsp;<span class="builtintype" id="3268397">int</span><span class="op" id="3268400">)</span>&nbsp;<span class="op" id="3268402">(</span><span class="ident" id="3268403">newfd</span>&nbsp;<span class="builtintype" id="3268409">int</span><span class="op" id="3268412">,</span>&nbsp;<span class="ident" id="3268414">err</span>&nbsp;<span class="builtintype" id="3268418">error</span><span class="op" id="3268423">)</span>&nbsp;<span class="op" id="3268425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3268428"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3268435">.</span><span class="ident" id="3268436"><a href="/gostd/syscall/exec_unix.go.html#2491879">ForkLock</a></span><span class="op" id="3268444">.</span><span class="ident" id="3268445"><a href="/gostd/sync/rwmutex.go.html#1456490">RLock</a></span><span class="op" id="3268450">(</span><span class="op" id="3268451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268454">defer</span>&nbsp;<span class="ident" id="3268460"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3268467">.</span><span class="ident" id="3268468"><a href="/gostd/syscall/exec_unix.go.html#2491879">ForkLock</a></span><span class="op" id="3268476">.</span><span class="ident" id="3268477"><a href="/gostd/sync/rwmutex.go.html#1456952">RUnlock</a></span><span class="op" id="3268484">(</span><span class="op" id="3268485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3268488"><a href="/gostd/net/fd_unix.go.html#3268403">newfd</a></span><span class="op" id="3268493">,</span>&nbsp;<span class="ident" id="3268495"><a href="/gostd/net/fd_unix.go.html#3268414">err</a></span>&nbsp;<span class="op" id="3268499">=</span>&nbsp;<span class="ident" id="3268501"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3268508">.</span><span class="ident" id="3268509"><a href="/gostd/syscall/zsyscall_linux_amd64.go.html#2617279">Dup</a></span><span class="op" id="3268512">(</span><span class="ident" id="3268513"><a href="/gostd/net/fd_unix.go.html#3268394">fd</a></span><span class="op" id="3268515">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268518">if</span>&nbsp;<span class="ident" id="3268521"><a href="/gostd/net/fd_unix.go.html#3268414">err</a></span>&nbsp;<span class="op" id="3268525">!=</span>&nbsp;<span class="builtintype" id="3268528">nil</span>&nbsp;<span class="op" id="3268532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268536">return</span>&nbsp;<span class="op" id="3268543">-</span><span class="num" id="3268544">1</span><span class="op" id="3268545">,</span>&nbsp;<span class="ident" id="3268547"><a href="/gostd/net/fd_unix.go.html#3268414">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3268552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3268555"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3268562">.</span><span class="ident" id="3268563"><a href="/gostd/syscall/exec_unix.go.html#2492669">CloseOnExec</a></span><span class="op" id="3268574">(</span><span class="ident" id="3268575"><a href="/gostd/net/fd_unix.go.html#3268403">newfd</a></span><span class="op" id="3268580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268583">return</span><br>
<span class="lineno">490</span><span class="op" id="3268590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3268593">func</span>&nbsp;<span class="op" id="3268598">(</span><span class="ident" id="3268599">fd</span>&nbsp;<span class="op" id="3268602">*</span><span class="ident" id="3268603"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3268608">)</span>&nbsp;<span class="ident" id="3268610">dup</span><span class="op" id="3268613">(</span><span class="op" id="3268614">)</span>&nbsp;<span class="op" id="3268616">(</span><span class="ident" id="3268617">f</span>&nbsp;<span class="op" id="3268619">*</span><span class="ident" id="3268620"><a href="/gostd/net/fd_unix.go.html#3257275">os</a></span><span class="op" id="3268622">.</span><span class="ident" id="3268623"><a href="/gostd/os/file_unix.go.html#2452288">File</a></span><span class="op" id="3268627">,</span>&nbsp;<span class="ident" id="3268629">err</span>&nbsp;<span class="builtintype" id="3268633">error</span><span class="op" id="3268638">)</span>&nbsp;<span class="op" id="3268640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3268643">ns</span><span class="op" id="3268645">,</span>&nbsp;<span class="ident" id="3268647"><a href="/gostd/net/fd_unix.go.html#3268629">err</a></span>&nbsp;<span class="op" id="3268651">:=</span>&nbsp;<span class="ident" id="3268654"><a href="/gostd/net/fd_unix.go.html#3267326">dupCloseOnExec</a></span><span class="op" id="3268668">(</span><span class="ident" id="3268669"><a href="/gostd/net/fd_unix.go.html#3268599">fd</a></span><span class="op" id="3268671">.</span><span class="ident" id="3268672"><a href="/gostd/net/fd_unix.go.html#3257493">sysfd</a></span><span class="op" id="3268677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268680">if</span>&nbsp;<span class="ident" id="3268683"><a href="/gostd/net/fd_unix.go.html#3268629">err</a></span>&nbsp;<span class="op" id="3268687">!=</span>&nbsp;<span class="builtintype" id="3268690">nil</span>&nbsp;<span class="op" id="3268694">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3268698">return</span>&nbsp;<span class="builtintype" id="3268705">nil</span><span class="op" id="3268708">,</span>&nbsp;<span class="op" id="3268710">&amp;</span><span class="ident" id="3268711"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3268718">{</span><span class="string" id="3268719">&#34;dup&#34;</span><span class="op" id="3268724">,</span>&nbsp;<span class="ident" id="3268726"><a href="/gostd/net/fd_unix.go.html#3268599">fd</a></span><span class="op" id="3268728">.</span><span class="ident" id="3268729"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3268732">,</span>&nbsp;<span class="ident" id="3268734"><a href="/gostd/net/fd_unix.go.html#3268599">fd</a></span><span class="op" id="3268736">.</span><span class="ident" id="3268737"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3268742">,</span>&nbsp;<span class="ident" id="3268744"><a href="/gostd/net/fd_unix.go.html#3268629">err</a></span><span class="op" id="3268747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3268750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3268754">//&nbsp;We&nbsp;want&nbsp;blocking&nbsp;mode&nbsp;for&nbsp;the&nbsp;new&nbsp;fd,&nbsp;hence&nbsp;the&nbsp;double&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3268823">//&nbsp;This&nbsp;also&nbsp;puts&nbsp;the&nbsp;old&nbsp;fd&nbsp;into&nbsp;blocking&nbsp;mode,&nbsp;meaning&nbsp;that</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3268886">//&nbsp;I/O&nbsp;will&nbsp;block&nbsp;the&nbsp;thread&nbsp;instead&nbsp;of&nbsp;letting&nbsp;us&nbsp;use&nbsp;the&nbsp;epoll&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3268960">//&nbsp;Everything&nbsp;will&nbsp;still&nbsp;work,&nbsp;just&nbsp;with&nbsp;more&nbsp;threads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269016">if</span>&nbsp;<span class="ident" id="3269019"><a href="/gostd/net/fd_unix.go.html#3268629">err</a></span>&nbsp;<span class="op" id="3269023">=</span>&nbsp;<span class="ident" id="3269025"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3269032">.</span><span class="ident" id="3269033"><a href="/gostd/syscall/exec_unix.go.html#2492730">SetNonblock</a></span><span class="op" id="3269044">(</span><span class="ident" id="3269045"><a href="/gostd/net/fd_unix.go.html#3268643">ns</a></span><span class="op" id="3269047">,</span>&nbsp;<span class="builtintype" id="3269049">false</span><span class="op" id="3269054">)</span><span class="op" id="3269055">;</span>&nbsp;<span class="ident" id="3269057"><a href="/gostd/net/fd_unix.go.html#3268629">err</a></span>&nbsp;<span class="op" id="3269061">!=</span>&nbsp;<span class="builtintype" id="3269064">nil</span>&nbsp;<span class="op" id="3269068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269072">return</span>&nbsp;<span class="builtintype" id="3269079">nil</span><span class="op" id="3269082">,</span>&nbsp;<span class="op" id="3269084">&amp;</span><span class="ident" id="3269085"><a href="/gostd/net/net.go.html#3341562">OpError</a></span><span class="op" id="3269092">{</span><span class="string" id="3269093">&#34;setnonblock&#34;</span><span class="op" id="3269106">,</span>&nbsp;<span class="ident" id="3269108"><a href="/gostd/net/fd_unix.go.html#3268599">fd</a></span><span class="op" id="3269110">.</span><span class="ident" id="3269111"><a href="/gostd/net/fd_unix.go.html#3257562">net</a></span><span class="op" id="3269114">,</span>&nbsp;<span class="ident" id="3269116"><a href="/gostd/net/fd_unix.go.html#3268599">fd</a></span><span class="op" id="3269118">.</span><span class="ident" id="3269119"><a href="/gostd/net/fd_unix.go.html#3257582">laddr</a></span><span class="op" id="3269124">,</span>&nbsp;<span class="ident" id="3269126"><a href="/gostd/net/fd_unix.go.html#3268629">err</a></span><span class="op" id="3269129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3269132">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269136">return</span>&nbsp;<span class="ident" id="3269143"><a href="/gostd/net/fd_unix.go.html#3257275">os</a></span><span class="op" id="3269145">.</span><span class="ident" id="3269146"><a href="/gostd/os/file_unix.go.html#2453016">NewFile</a></span><span class="op" id="3269153">(</span><span class="builtintype" id="3269154">uintptr</span><span class="op" id="3269161">(</span><span class="ident" id="3269162"><a href="/gostd/net/fd_unix.go.html#3268643">ns</a></span><span class="op" id="3269164">)</span><span class="op" id="3269165">,</span>&nbsp;<span class="ident" id="3269167"><a href="/gostd/net/fd_unix.go.html#3268599">fd</a></span><span class="op" id="3269169">.</span><span class="ident" id="3269170"><a href="/gostd/net/fd_unix.go.html#3258201">name</a></span><span class="op" id="3269174">(</span><span class="op" id="3269175">)</span><span class="op" id="3269176">)</span><span class="op" id="3269177">,</span>&nbsp;<span class="builtintype" id="3269179">nil</span><br>
<span class="lineno"></span><span class="op" id="3269183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3269186">func</span>&nbsp;<span class="ident" id="3269191">closesocket</span><span class="op" id="3269202">(</span><span class="ident" id="3269203">s</span>&nbsp;<span class="builtintype" id="3269205">int</span><span class="op" id="3269208">)</span>&nbsp;<span class="builtintype" id="3269210">error</span>&nbsp;<span class="op" id="3269216">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269219">return</span>&nbsp;<span class="ident" id="3269226"><a href="/gostd/net/fd_unix.go.html#3257307">syscall</a></span><span class="op" id="3269233">.</span><span class="ident" id="3269234"><a href="/gostd/syscall/zsyscall_linux_amd64.go.html#2616725">Close</a></span><span class="op" id="3269239">(</span><span class="ident" id="3269240"><a href="/gostd/net/fd_unix.go.html#3269203">s</a></span><span class="op" id="3269241">)</span><br>
<span class="lineno"></span><span class="op" id="3269243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3269246">func</span>&nbsp;<span class="ident" id="3269251">skipRawSocketTests</span><span class="op" id="3269269">(</span><span class="op" id="3269270">)</span>&nbsp;<span class="op" id="3269272">(</span><span class="ident" id="3269273">skip</span>&nbsp;<span class="builtintype" id="3269278">bool</span><span class="op" id="3269282">,</span>&nbsp;<span class="ident" id="3269284">skipmsg</span>&nbsp;<span class="builtintype" id="3269292">string</span><span class="op" id="3269298">,</span>&nbsp;<span class="ident" id="3269300">err</span>&nbsp;<span class="builtintype" id="3269304">error</span><span class="op" id="3269309">)</span>&nbsp;<span class="op" id="3269311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269314">if</span>&nbsp;<span class="ident" id="3269317"><a href="/gostd/net/fd_unix.go.html#3257275">os</a></span><span class="op" id="3269319">.</span><span class="ident" id="3269320"><a href="/gostd/os/proc.go.html#2468979">Getuid</a></span><span class="op" id="3269326">(</span><span class="op" id="3269327">)</span>&nbsp;<span class="op" id="3269329">!=</span>&nbsp;<span class="num" id="3269332">0</span>&nbsp;<span class="op" id="3269334">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269338">return</span>&nbsp;<span class="builtintype" id="3269345">true</span><span class="op" id="3269349">,</span>&nbsp;<span class="string" id="3269351">&#34;skipping&nbsp;test;&nbsp;must&nbsp;be&nbsp;root&#34;</span><span class="op" id="3269380">,</span>&nbsp;<span class="builtintype" id="3269382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3269387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3269390">return</span>&nbsp;<span class="builtintype" id="3269397">false</span><span class="op" id="3269402">,</span>&nbsp;<span class="string" id="3269404">&#34;&#34;</span><span class="op" id="3269406">,</span>&nbsp;<span class="builtintype" id="3269408">nil</span><br>
<span class="lineno"></span><span class="op" id="3269412">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
