<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html" class="current">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6388743">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6388798">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6388852">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6388903">package</span>&nbsp;<span class="ident" id="6388911">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388918">import</span>&nbsp;<span class="string" id="6388925">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388933">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="6389009">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="6389020">type</span>&nbsp;<span class="ident" id="6389025">huffmanTree</span>&nbsp;<span class="keyword" id="6389037">struct</span>&nbsp;<span class="op" id="6389044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389047">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389118">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389191">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389247">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6389256">[</span><span class="op" id="6389257">]</span><span class="ident" id="6389258">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389271">nextNode</span>&nbsp;<span class="builtintype" id="6389280">int</span><br>
<span class="lineno"></span><span class="op" id="6389284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389287">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="6389367">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="6389447">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="6389507">//</span><br>
<span class="lineno"></span><span class="comment" id="6389510">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6389587">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="6389665">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="6389715">type</span>&nbsp;<span class="ident" id="6389720">huffmanNode</span>&nbsp;<span class="keyword" id="6389732">struct</span>&nbsp;<span class="op" id="6389739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389742">left</span><span class="op" id="6389746">,</span>&nbsp;<span class="ident" id="6389748">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6389764">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389772">leftValue</span><span class="op" id="6389781">,</span>&nbsp;<span class="ident" id="6389783">rightValue</span>&nbsp;<span class="builtintype" id="6389794">uint16</span><br>
<span class="lineno"></span><span class="op" id="6389801">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6389804">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="6389881">const</span>&nbsp;<span class="ident" id="6389887">invalidNodeValue</span>&nbsp;<span class="op" id="6389904">=</span>&nbsp;<span class="num" id="6389906">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389914">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="6389991">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6390011">func</span>&nbsp;<span class="op" id="6390016">(</span><span class="ident" id="6390017">t</span>&nbsp;<span class="op" id="6390019">*</span><span class="ident" id="6390020">huffmanTree</span><span class="op" id="6390031">)</span>&nbsp;<span class="ident" id="6390033">Decode</span><span class="op" id="6390039">(</span><span class="ident" id="6390040">br</span>&nbsp;<span class="op" id="6390043">*</span><span class="ident" id="6390044">bitReader</span><span class="op" id="6390053">)</span>&nbsp;<span class="op" id="6390055">(</span><span class="ident" id="6390056">v</span>&nbsp;<span class="builtintype" id="6390058">uint16</span><span class="op" id="6390064">)</span>&nbsp;<span class="op" id="6390066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390069">nodeIndex</span>&nbsp;<span class="op" id="6390079">:=</span>&nbsp;<span class="builtintype" id="6390082">uint16</span><span class="op" id="6390088">(</span><span class="num" id="6390089">0</span><span class="op" id="6390090">)</span>&nbsp;<span class="comment" id="6390092">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390129">for</span>&nbsp;<span class="op" id="6390133">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390137">node</span>&nbsp;<span class="op" id="6390142">:=</span>&nbsp;<span class="op" id="6390145">&amp;</span><span class="ident" id="6390146">t</span><span class="op" id="6390147">.</span><span class="ident" id="6390148">nodes</span><span class="op" id="6390153">[</span><span class="ident" id="6390154">nodeIndex</span><span class="op" id="6390163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390167">bit</span><span class="op" id="6390170">,</span>&nbsp;<span class="ident" id="6390172">ok</span>&nbsp;<span class="op" id="6390175">:=</span>&nbsp;<span class="ident" id="6390178">br</span><span class="op" id="6390180">.</span><span class="ident" id="6390181">TryReadBit</span><span class="op" id="6390191">(</span><span class="op" id="6390192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390196">if</span>&nbsp;<span class="op" id="6390199">!</span><span class="ident" id="6390200">ok</span>&nbsp;<span class="op" id="6390203">&amp;&amp;</span>&nbsp;<span class="ident" id="6390206">br</span><span class="op" id="6390208">.</span><span class="ident" id="6390209">ReadBit</span><span class="op" id="6390216">(</span><span class="op" id="6390217">)</span>&nbsp;<span class="op" id="6390219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390224">bit</span>&nbsp;<span class="op" id="6390228">=</span>&nbsp;<span class="num" id="6390230">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390234">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390238">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390277">if</span>&nbsp;<span class="ident" id="6390280">bit</span>&nbsp;<span class="op" id="6390284">!=</span>&nbsp;<span class="num" id="6390287">0</span>&nbsp;<span class="op" id="6390289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390294">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390305">if</span>&nbsp;<span class="ident" id="6390308">node</span><span class="op" id="6390312">.</span><span class="ident" id="6390313">left</span>&nbsp;<span class="op" id="6390318">==</span>&nbsp;<span class="ident" id="6390321">invalidNodeValue</span>&nbsp;<span class="op" id="6390338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390344">return</span>&nbsp;<span class="ident" id="6390351">node</span><span class="op" id="6390355">.</span><span class="ident" id="6390356">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390374">nodeIndex</span>&nbsp;<span class="op" id="6390384">=</span>&nbsp;<span class="ident" id="6390386">node</span><span class="op" id="6390390">.</span><span class="ident" id="6390391">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390398">}</span>&nbsp;<span class="keyword" id="6390400">else</span>&nbsp;<span class="op" id="6390405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390410">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390422">if</span>&nbsp;<span class="ident" id="6390425">node</span><span class="op" id="6390429">.</span><span class="ident" id="6390430">right</span>&nbsp;<span class="op" id="6390436">==</span>&nbsp;<span class="ident" id="6390439">invalidNodeValue</span>&nbsp;<span class="op" id="6390456">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390462">return</span>&nbsp;<span class="ident" id="6390469">node</span><span class="op" id="6390473">.</span><span class="ident" id="6390474">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390493">nodeIndex</span>&nbsp;<span class="op" id="6390503">=</span>&nbsp;<span class="ident" id="6390505">node</span><span class="op" id="6390509">.</span><span class="ident" id="6390510">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390521">}</span><br>
<span class="lineno">60</span><span class="op" id="6390523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390526">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="6390599">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6390662">func</span>&nbsp;<span class="ident" id="6390667">newHuffmanTree</span><span class="op" id="6390681">(</span><span class="ident" id="6390682">lengths</span>&nbsp;<span class="op" id="6390690">[</span><span class="op" id="6390691">]</span><span class="builtintype" id="6390692">uint8</span><span class="op" id="6390697">)</span>&nbsp;<span class="op" id="6390699">(</span><span class="ident" id="6390700">huffmanTree</span><span class="op" id="6390711">,</span>&nbsp;<span class="builtintype" id="6390713">error</span><span class="op" id="6390718">)</span>&nbsp;<span class="op" id="6390720">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390723">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390793">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390858">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390920">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390988">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391059">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391129">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391168">if</span>&nbsp;<span class="builtinfunc" id="6391171">len</span><span class="op" id="6391174">(</span><span class="ident" id="6391175">lengths</span><span class="op" id="6391182">)</span>&nbsp;<span class="op" id="6391184">&lt;</span>&nbsp;<span class="num" id="6391186">2</span>&nbsp;<span class="op" id="6391188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6391192">panic</span><span class="op" id="6391197">(</span><span class="string" id="6391198">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="6391231">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391238">var</span>&nbsp;<span class="ident" id="6391242">t</span>&nbsp;<span class="ident" id="6391244">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391258">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391330">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391372">pairs</span>&nbsp;<span class="op" id="6391378">:=</span>&nbsp;<span class="ident" id="6391381">huffmanSymbolLengthPairs</span><span class="op" id="6391405">(</span><span class="builtinfunc" id="6391406">make</span><span class="op" id="6391410">(</span><span class="op" id="6391411">[</span><span class="op" id="6391412">]</span><span class="ident" id="6391413">huffmanSymbolLengthPair</span><span class="op" id="6391436">,</span>&nbsp;<span class="builtinfunc" id="6391438">len</span><span class="op" id="6391441">(</span><span class="ident" id="6391442">lengths</span><span class="op" id="6391449">)</span><span class="op" id="6391450">)</span><span class="op" id="6391451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391454">for</span>&nbsp;<span class="ident" id="6391458">i</span><span class="op" id="6391459">,</span>&nbsp;<span class="ident" id="6391461">length</span>&nbsp;<span class="op" id="6391468">:=</span>&nbsp;<span class="keyword" id="6391471">range</span>&nbsp;<span class="ident" id="6391477">lengths</span>&nbsp;<span class="op" id="6391485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391489">pairs</span><span class="op" id="6391494">[</span><span class="ident" id="6391495">i</span><span class="op" id="6391496">]</span><span class="op" id="6391497">.</span><span class="ident" id="6391498">value</span>&nbsp;<span class="op" id="6391504">=</span>&nbsp;<span class="builtintype" id="6391506">uint16</span><span class="op" id="6391512">(</span><span class="ident" id="6391513">i</span><span class="op" id="6391514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391518">pairs</span><span class="op" id="6391523">[</span><span class="ident" id="6391524">i</span><span class="op" id="6391525">]</span><span class="op" id="6391526">.</span><span class="ident" id="6391527">length</span>&nbsp;<span class="op" id="6391534">=</span>&nbsp;<span class="ident" id="6391536">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391548">sort</span><span class="op" id="6391552">.</span><span class="ident" id="6391553">Sort</span><span class="op" id="6391557">(</span><span class="ident" id="6391558">pairs</span><span class="op" id="6391563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391567">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391639">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391712">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391784">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391805">code</span>&nbsp;<span class="op" id="6391810">:=</span>&nbsp;<span class="builtintype" id="6391813">uint32</span><span class="op" id="6391819">(</span><span class="num" id="6391820">0</span><span class="op" id="6391821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391824">length</span>&nbsp;<span class="op" id="6391831">:=</span>&nbsp;<span class="builtintype" id="6391834">uint8</span><span class="op" id="6391839">(</span><span class="num" id="6391840">32</span><span class="op" id="6391842">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391846">codes</span>&nbsp;<span class="op" id="6391852">:=</span>&nbsp;<span class="ident" id="6391855">huffmanCodes</span><span class="op" id="6391867">(</span><span class="builtinfunc" id="6391868">make</span><span class="op" id="6391872">(</span><span class="op" id="6391873">[</span><span class="op" id="6391874">]</span><span class="ident" id="6391875">huffmanCode</span><span class="op" id="6391886">,</span>&nbsp;<span class="builtinfunc" id="6391888">len</span><span class="op" id="6391891">(</span><span class="ident" id="6391892">lengths</span><span class="op" id="6391899">)</span><span class="op" id="6391900">)</span><span class="op" id="6391901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391904">for</span>&nbsp;<span class="ident" id="6391908">i</span>&nbsp;<span class="op" id="6391910">:=</span>&nbsp;<span class="builtinfunc" id="6391913">len</span><span class="op" id="6391916">(</span><span class="ident" id="6391917">pairs</span><span class="op" id="6391922">)</span>&nbsp;<span class="op" id="6391924">-</span>&nbsp;<span class="num" id="6391926">1</span><span class="op" id="6391927">;</span>&nbsp;<span class="ident" id="6391929">i</span>&nbsp;<span class="op" id="6391931">&gt;=</span>&nbsp;<span class="num" id="6391934">0</span><span class="op" id="6391935">;</span>&nbsp;<span class="ident" id="6391937">i</span><span class="op" id="6391938">--</span>&nbsp;<span class="op" id="6391941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391945">if</span>&nbsp;<span class="ident" id="6391948">length</span>&nbsp;<span class="op" id="6391955">&gt;</span>&nbsp;<span class="ident" id="6391957">pairs</span><span class="op" id="6391962">[</span><span class="ident" id="6391963">i</span><span class="op" id="6391964">]</span><span class="op" id="6391965">.</span><span class="ident" id="6391966">length</span>&nbsp;<span class="op" id="6391973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391978">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392034">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392082">length</span>&nbsp;<span class="op" id="6392089">&gt;&gt;=</span>&nbsp;<span class="num" id="6392093">32</span>&nbsp;<span class="op" id="6392096">-</span>&nbsp;<span class="ident" id="6392098">pairs</span><span class="op" id="6392103">[</span><span class="ident" id="6392104">i</span><span class="op" id="6392105">]</span><span class="op" id="6392106">.</span><span class="ident" id="6392107">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392117">length</span>&nbsp;<span class="op" id="6392124">&lt;&lt;=</span>&nbsp;<span class="num" id="6392128">32</span>&nbsp;<span class="op" id="6392131">-</span>&nbsp;<span class="ident" id="6392133">pairs</span><span class="op" id="6392138">[</span><span class="ident" id="6392139">i</span><span class="op" id="6392140">]</span><span class="op" id="6392141">.</span><span class="ident" id="6392142">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392152">length</span>&nbsp;<span class="op" id="6392159">=</span>&nbsp;<span class="ident" id="6392161">pairs</span><span class="op" id="6392166">[</span><span class="ident" id="6392167">i</span><span class="op" id="6392168">]</span><span class="op" id="6392169">.</span><span class="ident" id="6392170">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392179">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392183">codes</span><span class="op" id="6392188">[</span><span class="ident" id="6392189">i</span><span class="op" id="6392190">]</span><span class="op" id="6392191">.</span><span class="ident" id="6392192">code</span>&nbsp;<span class="op" id="6392197">=</span>&nbsp;<span class="ident" id="6392199">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392206">codes</span><span class="op" id="6392211">[</span><span class="ident" id="6392212">i</span><span class="op" id="6392213">]</span><span class="op" id="6392214">.</span><span class="ident" id="6392215">codeLen</span>&nbsp;<span class="op" id="6392223">=</span>&nbsp;<span class="ident" id="6392225">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392234">codes</span><span class="op" id="6392239">[</span><span class="ident" id="6392240">i</span><span class="op" id="6392241">]</span><span class="op" id="6392242">.</span><span class="ident" id="6392243">value</span>&nbsp;<span class="op" id="6392249">=</span>&nbsp;<span class="ident" id="6392251">pairs</span><span class="op" id="6392256">[</span><span class="ident" id="6392257">i</span><span class="op" id="6392258">]</span><span class="op" id="6392259">.</span><span class="ident" id="6392260">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392268">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392334">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392367">code</span>&nbsp;<span class="op" id="6392372">+=</span>&nbsp;<span class="num" id="6392375">1</span>&nbsp;<span class="op" id="6392377">&lt;&lt;</span>&nbsp;<span class="op" id="6392380">(</span><span class="num" id="6392381">32</span>&nbsp;<span class="op" id="6392384">-</span>&nbsp;<span class="ident" id="6392386">length</span><span class="op" id="6392392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392399">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392472">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392507">sort</span><span class="op" id="6392511">.</span><span class="ident" id="6392512">Sort</span><span class="op" id="6392516">(</span><span class="ident" id="6392517">codes</span><span class="op" id="6392522">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392526">t</span><span class="op" id="6392527">.</span><span class="ident" id="6392528">nodes</span>&nbsp;<span class="op" id="6392534">=</span>&nbsp;<span class="builtinfunc" id="6392536">make</span><span class="op" id="6392540">(</span><span class="op" id="6392541">[</span><span class="op" id="6392542">]</span><span class="ident" id="6392543">huffmanNode</span><span class="op" id="6392554">,</span>&nbsp;<span class="builtinfunc" id="6392556">len</span><span class="op" id="6392559">(</span><span class="ident" id="6392560">codes</span><span class="op" id="6392565">)</span><span class="op" id="6392566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392569">_</span><span class="op" id="6392570">,</span>&nbsp;<span class="ident" id="6392572">err</span>&nbsp;<span class="op" id="6392576">:=</span>&nbsp;<span class="ident" id="6392579">buildHuffmanNode</span><span class="op" id="6392595">(</span><span class="op" id="6392596">&amp;</span><span class="ident" id="6392597">t</span><span class="op" id="6392598">,</span>&nbsp;<span class="ident" id="6392600">codes</span><span class="op" id="6392605">,</span>&nbsp;<span class="num" id="6392607">0</span><span class="op" id="6392608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392611">return</span>&nbsp;<span class="ident" id="6392618">t</span><span class="op" id="6392619">,</span>&nbsp;<span class="ident" id="6392621">err</span><br>
<span class="lineno">120</span><span class="op" id="6392625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392628">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6392694">type</span>&nbsp;<span class="ident" id="6392699">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="6392723">struct</span>&nbsp;<span class="op" id="6392730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392733">value</span>&nbsp;&nbsp;<span class="builtintype" id="6392740">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6392748">length</span>&nbsp;<span class="builtintype" id="6392755">uint8</span><br>
<span class="lineno"></span><span class="op" id="6392761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6392764">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="6392836">type</span>&nbsp;<span class="ident" id="6392841">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="6392866">[</span><span class="op" id="6392867">]</span><span class="ident" id="6392868">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="6392893">func</span>&nbsp;<span class="op" id="6392898">(</span><span class="ident" id="6392899">h</span>&nbsp;<span class="ident" id="6392901">huffmanSymbolLengthPairs</span><span class="op" id="6392925">)</span>&nbsp;<span class="ident" id="6392927">Len</span><span class="op" id="6392930">(</span><span class="op" id="6392931">)</span>&nbsp;<span class="builtintype" id="6392933">int</span>&nbsp;<span class="op" id="6392937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392940">return</span>&nbsp;<span class="builtinfunc" id="6392947">len</span><span class="op" id="6392950">(</span><span class="ident" id="6392951">h</span><span class="op" id="6392952">)</span><br>
<span class="lineno"></span><span class="op" id="6392954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="6392957">func</span>&nbsp;<span class="op" id="6392962">(</span><span class="ident" id="6392963">h</span>&nbsp;<span class="ident" id="6392965">huffmanSymbolLengthPairs</span><span class="op" id="6392989">)</span>&nbsp;<span class="ident" id="6392991">Less</span><span class="op" id="6392995">(</span><span class="ident" id="6392996">i</span><span class="op" id="6392997">,</span>&nbsp;<span class="ident" id="6392999">j</span>&nbsp;<span class="builtintype" id="6393001">int</span><span class="op" id="6393004">)</span>&nbsp;<span class="builtintype" id="6393006">bool</span>&nbsp;<span class="op" id="6393011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393014">if</span>&nbsp;<span class="ident" id="6393017">h</span><span class="op" id="6393018">[</span><span class="ident" id="6393019">i</span><span class="op" id="6393020">]</span><span class="op" id="6393021">.</span><span class="ident" id="6393022">length</span>&nbsp;<span class="op" id="6393029">&lt;</span>&nbsp;<span class="ident" id="6393031">h</span><span class="op" id="6393032">[</span><span class="ident" id="6393033">j</span><span class="op" id="6393034">]</span><span class="op" id="6393035">.</span><span class="ident" id="6393036">length</span>&nbsp;<span class="op" id="6393043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393047">return</span>&nbsp;<span class="builtintype" id="6393054">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393063">if</span>&nbsp;<span class="ident" id="6393066">h</span><span class="op" id="6393067">[</span><span class="ident" id="6393068">i</span><span class="op" id="6393069">]</span><span class="op" id="6393070">.</span><span class="ident" id="6393071">length</span>&nbsp;<span class="op" id="6393078">&gt;</span>&nbsp;<span class="ident" id="6393080">h</span><span class="op" id="6393081">[</span><span class="ident" id="6393082">j</span><span class="op" id="6393083">]</span><span class="op" id="6393084">.</span><span class="ident" id="6393085">length</span>&nbsp;<span class="op" id="6393092">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393096">return</span>&nbsp;<span class="builtintype" id="6393103">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393113">if</span>&nbsp;<span class="ident" id="6393116">h</span><span class="op" id="6393117">[</span><span class="ident" id="6393118">i</span><span class="op" id="6393119">]</span><span class="op" id="6393120">.</span><span class="ident" id="6393121">value</span>&nbsp;<span class="op" id="6393127">&lt;</span>&nbsp;<span class="ident" id="6393129">h</span><span class="op" id="6393130">[</span><span class="ident" id="6393131">j</span><span class="op" id="6393132">]</span><span class="op" id="6393133">.</span><span class="ident" id="6393134">value</span>&nbsp;<span class="op" id="6393140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393144">return</span>&nbsp;<span class="builtintype" id="6393151">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393157">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393160">return</span>&nbsp;<span class="builtintype" id="6393167">false</span><br>
<span class="lineno"></span><span class="op" id="6393173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6393176">func</span>&nbsp;<span class="op" id="6393181">(</span><span class="ident" id="6393182">h</span>&nbsp;<span class="ident" id="6393184">huffmanSymbolLengthPairs</span><span class="op" id="6393208">)</span>&nbsp;<span class="ident" id="6393210">Swap</span><span class="op" id="6393214">(</span><span class="ident" id="6393215">i</span><span class="op" id="6393216">,</span>&nbsp;<span class="ident" id="6393218">j</span>&nbsp;<span class="builtintype" id="6393220">int</span><span class="op" id="6393223">)</span>&nbsp;<span class="op" id="6393225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393228">h</span><span class="op" id="6393229">[</span><span class="ident" id="6393230">i</span><span class="op" id="6393231">]</span><span class="op" id="6393232">,</span>&nbsp;<span class="ident" id="6393234">h</span><span class="op" id="6393235">[</span><span class="ident" id="6393236">j</span><span class="op" id="6393237">]</span>&nbsp;<span class="op" id="6393239">=</span>&nbsp;<span class="ident" id="6393241">h</span><span class="op" id="6393242">[</span><span class="ident" id="6393243">j</span><span class="op" id="6393244">]</span><span class="op" id="6393245">,</span>&nbsp;<span class="ident" id="6393247">h</span><span class="op" id="6393248">[</span><span class="ident" id="6393249">i</span><span class="op" id="6393250">]</span><br>
<span class="lineno">150</span><span class="op" id="6393252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393255">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6393315">type</span>&nbsp;<span class="ident" id="6393320">huffmanCode</span>&nbsp;<span class="keyword" id="6393332">struct</span>&nbsp;<span class="op" id="6393339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393342">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6393350">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393358">codeLen</span>&nbsp;<span class="builtintype" id="6393366">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393373">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6393381">uint16</span><br>
<span class="lineno"></span><span class="op" id="6393388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393391">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="6393452">type</span>&nbsp;<span class="ident" id="6393457">huffmanCodes</span>&nbsp;<span class="op" id="6393470">[</span><span class="op" id="6393471">]</span><span class="ident" id="6393472">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6393485">func</span>&nbsp;<span class="op" id="6393490">(</span><span class="ident" id="6393491">n</span>&nbsp;<span class="ident" id="6393493">huffmanCodes</span><span class="op" id="6393505">)</span>&nbsp;<span class="ident" id="6393507">Len</span><span class="op" id="6393510">(</span><span class="op" id="6393511">)</span>&nbsp;<span class="builtintype" id="6393513">int</span>&nbsp;<span class="op" id="6393517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393520">return</span>&nbsp;<span class="builtinfunc" id="6393527">len</span><span class="op" id="6393530">(</span><span class="ident" id="6393531">n</span><span class="op" id="6393532">)</span><br>
<span class="lineno"></span><span class="op" id="6393534">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6393537">func</span>&nbsp;<span class="op" id="6393542">(</span><span class="ident" id="6393543">n</span>&nbsp;<span class="ident" id="6393545">huffmanCodes</span><span class="op" id="6393557">)</span>&nbsp;<span class="ident" id="6393559">Less</span><span class="op" id="6393563">(</span><span class="ident" id="6393564">i</span><span class="op" id="6393565">,</span>&nbsp;<span class="ident" id="6393567">j</span>&nbsp;<span class="builtintype" id="6393569">int</span><span class="op" id="6393572">)</span>&nbsp;<span class="builtintype" id="6393574">bool</span>&nbsp;<span class="op" id="6393579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393582">return</span>&nbsp;<span class="ident" id="6393589">n</span><span class="op" id="6393590">[</span><span class="ident" id="6393591">i</span><span class="op" id="6393592">]</span><span class="op" id="6393593">.</span><span class="ident" id="6393594">code</span>&nbsp;<span class="op" id="6393599">&lt;</span>&nbsp;<span class="ident" id="6393601">n</span><span class="op" id="6393602">[</span><span class="ident" id="6393603">j</span><span class="op" id="6393604">]</span><span class="op" id="6393605">.</span><span class="ident" id="6393606">code</span><br>
<span class="lineno"></span><span class="op" id="6393611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="6393614">func</span>&nbsp;<span class="op" id="6393619">(</span><span class="ident" id="6393620">n</span>&nbsp;<span class="ident" id="6393622">huffmanCodes</span><span class="op" id="6393634">)</span>&nbsp;<span class="ident" id="6393636">Swap</span><span class="op" id="6393640">(</span><span class="ident" id="6393641">i</span><span class="op" id="6393642">,</span>&nbsp;<span class="ident" id="6393644">j</span>&nbsp;<span class="builtintype" id="6393646">int</span><span class="op" id="6393649">)</span>&nbsp;<span class="op" id="6393651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393654">n</span><span class="op" id="6393655">[</span><span class="ident" id="6393656">i</span><span class="op" id="6393657">]</span><span class="op" id="6393658">,</span>&nbsp;<span class="ident" id="6393660">n</span><span class="op" id="6393661">[</span><span class="ident" id="6393662">j</span><span class="op" id="6393663">]</span>&nbsp;<span class="op" id="6393665">=</span>&nbsp;<span class="ident" id="6393667">n</span><span class="op" id="6393668">[</span><span class="ident" id="6393669">j</span><span class="op" id="6393670">]</span><span class="op" id="6393671">,</span>&nbsp;<span class="ident" id="6393673">n</span><span class="op" id="6393674">[</span><span class="ident" id="6393675">i</span><span class="op" id="6393676">]</span><br>
<span class="lineno"></span><span class="op" id="6393678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393681">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="6393759">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="6393833">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="6393854">func</span>&nbsp;<span class="ident" id="6393859">buildHuffmanNode</span><span class="op" id="6393875">(</span><span class="ident" id="6393876">t</span>&nbsp;<span class="op" id="6393878">*</span><span class="ident" id="6393879">huffmanTree</span><span class="op" id="6393890">,</span>&nbsp;<span class="ident" id="6393892">codes</span>&nbsp;<span class="op" id="6393898">[</span><span class="op" id="6393899">]</span><span class="ident" id="6393900">huffmanCode</span><span class="op" id="6393911">,</span>&nbsp;<span class="ident" id="6393913">level</span>&nbsp;<span class="builtintype" id="6393919">uint32</span><span class="op" id="6393925">)</span>&nbsp;<span class="op" id="6393927">(</span><span class="ident" id="6393928">nodeIndex</span>&nbsp;<span class="builtintype" id="6393938">uint16</span><span class="op" id="6393944">,</span>&nbsp;<span class="ident" id="6393946">err</span>&nbsp;<span class="builtintype" id="6393950">error</span><span class="op" id="6393955">)</span>&nbsp;<span class="op" id="6393957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393960">test</span>&nbsp;<span class="op" id="6393965">:=</span>&nbsp;<span class="builtintype" id="6393968">uint32</span><span class="op" id="6393974">(</span><span class="num" id="6393975">1</span><span class="op" id="6393976">)</span>&nbsp;<span class="op" id="6393978">&lt;&lt;</span>&nbsp;<span class="op" id="6393981">(</span><span class="num" id="6393982">31</span>&nbsp;<span class="op" id="6393985">-</span>&nbsp;<span class="ident" id="6393987">level</span><span class="op" id="6393992">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393996">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394089">firstRightIndex</span>&nbsp;<span class="op" id="6394105">:=</span>&nbsp;<span class="builtinfunc" id="6394108">len</span><span class="op" id="6394111">(</span><span class="ident" id="6394112">codes</span><span class="op" id="6394117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394120">for</span>&nbsp;<span class="ident" id="6394124">i</span><span class="op" id="6394125">,</span>&nbsp;<span class="ident" id="6394127">code</span>&nbsp;<span class="op" id="6394132">:=</span>&nbsp;<span class="keyword" id="6394135">range</span>&nbsp;<span class="ident" id="6394141">codes</span>&nbsp;<span class="op" id="6394147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394151">if</span>&nbsp;<span class="ident" id="6394154">code</span><span class="op" id="6394158">.</span><span class="ident" id="6394159">code</span><span class="op" id="6394163">&amp;</span><span class="ident" id="6394164">test</span>&nbsp;<span class="op" id="6394169">!=</span>&nbsp;<span class="num" id="6394172">0</span>&nbsp;<span class="op" id="6394174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394179">firstRightIndex</span>&nbsp;<span class="op" id="6394195">=</span>&nbsp;<span class="ident" id="6394197">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394202">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394217">left</span>&nbsp;<span class="op" id="6394222">:=</span>&nbsp;<span class="ident" id="6394225">codes</span><span class="op" id="6394230">[</span><span class="op" id="6394231">:</span><span class="ident" id="6394232">firstRightIndex</span><span class="op" id="6394247">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394250">right</span>&nbsp;<span class="op" id="6394256">:=</span>&nbsp;<span class="ident" id="6394259">codes</span><span class="op" id="6394264">[</span><span class="ident" id="6394265">firstRightIndex</span><span class="op" id="6394280">:</span><span class="op" id="6394281">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394285">if</span>&nbsp;<span class="builtinfunc" id="6394288">len</span><span class="op" id="6394291">(</span><span class="ident" id="6394292">left</span><span class="op" id="6394296">)</span>&nbsp;<span class="op" id="6394298">==</span>&nbsp;<span class="num" id="6394301">0</span>&nbsp;<span class="op" id="6394303">||</span>&nbsp;<span class="builtinfunc" id="6394306">len</span><span class="op" id="6394309">(</span><span class="ident" id="6394310">right</span><span class="op" id="6394315">)</span>&nbsp;<span class="op" id="6394317">==</span>&nbsp;<span class="num" id="6394320">0</span>&nbsp;<span class="op" id="6394322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394326">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394391">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394457">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394489">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394552">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394615">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394663">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394668">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394733">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394799">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394861">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394916">if</span>&nbsp;<span class="builtinfunc" id="6394919">len</span><span class="op" id="6394922">(</span><span class="ident" id="6394923">codes</span><span class="op" id="6394928">)</span>&nbsp;<span class="op" id="6394930">&lt;</span>&nbsp;<span class="num" id="6394932">2</span>&nbsp;<span class="op" id="6394934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394939">return</span>&nbsp;<span class="num" id="6394946">0</span><span class="op" id="6394947">,</span>&nbsp;<span class="ident" id="6394949">StructuralError</span><span class="op" id="6394964">(</span><span class="string" id="6394965">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6394985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394994">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395059">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395118">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395134">if</span>&nbsp;<span class="ident" id="6395137">level</span>&nbsp;<span class="op" id="6395143">==</span>&nbsp;<span class="num" id="6395146">31</span>&nbsp;<span class="op" id="6395149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395154">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395211">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395270">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395321">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395347">return</span>&nbsp;<span class="num" id="6395354">0</span><span class="op" id="6395355">,</span>&nbsp;<span class="ident" id="6395357">StructuralError</span><span class="op" id="6395372">(</span><span class="string" id="6395373">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="6395404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395413">if</span>&nbsp;<span class="builtinfunc" id="6395416">len</span><span class="op" id="6395419">(</span><span class="ident" id="6395420">left</span><span class="op" id="6395424">)</span>&nbsp;<span class="op" id="6395426">==</span>&nbsp;<span class="num" id="6395429">0</span>&nbsp;<span class="op" id="6395431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395436">return</span>&nbsp;<span class="ident" id="6395443">buildHuffmanNode</span><span class="op" id="6395459">(</span><span class="ident" id="6395460">t</span><span class="op" id="6395461">,</span>&nbsp;<span class="ident" id="6395463">right</span><span class="op" id="6395468">,</span>&nbsp;<span class="ident" id="6395470">level</span><span class="op" id="6395475">+</span><span class="num" id="6395476">1</span><span class="op" id="6395477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395485">return</span>&nbsp;<span class="ident" id="6395492">buildHuffmanNode</span><span class="op" id="6395508">(</span><span class="ident" id="6395509">t</span><span class="op" id="6395510">,</span>&nbsp;<span class="ident" id="6395512">left</span><span class="op" id="6395516">,</span>&nbsp;<span class="ident" id="6395518">level</span><span class="op" id="6395523">+</span><span class="num" id="6395524">1</span><span class="op" id="6395525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395528">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395532">nodeIndex</span>&nbsp;<span class="op" id="6395542">=</span>&nbsp;<span class="builtintype" id="6395544">uint16</span><span class="op" id="6395550">(</span><span class="ident" id="6395551">t</span><span class="op" id="6395552">.</span><span class="ident" id="6395553">nextNode</span><span class="op" id="6395561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395564">node</span>&nbsp;<span class="op" id="6395569">:=</span>&nbsp;<span class="op" id="6395572">&amp;</span><span class="ident" id="6395573">t</span><span class="op" id="6395574">.</span><span class="ident" id="6395575">nodes</span><span class="op" id="6395580">[</span><span class="ident" id="6395581">t</span><span class="op" id="6395582">.</span><span class="ident" id="6395583">nextNode</span><span class="op" id="6395591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395594">t</span><span class="op" id="6395595">.</span><span class="ident" id="6395596">nextNode</span><span class="op" id="6395604">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395609">if</span>&nbsp;<span class="builtinfunc" id="6395612">len</span><span class="op" id="6395615">(</span><span class="ident" id="6395616">left</span><span class="op" id="6395620">)</span>&nbsp;<span class="op" id="6395622">==</span>&nbsp;<span class="num" id="6395625">1</span>&nbsp;<span class="op" id="6395627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395631">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395646">node</span><span class="op" id="6395650">.</span><span class="ident" id="6395651">left</span>&nbsp;<span class="op" id="6395656">=</span>&nbsp;<span class="ident" id="6395658">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395677">node</span><span class="op" id="6395681">.</span><span class="ident" id="6395682">leftValue</span>&nbsp;<span class="op" id="6395692">=</span>&nbsp;<span class="ident" id="6395694">left</span><span class="op" id="6395698">[</span><span class="num" id="6395699">0</span><span class="op" id="6395700">]</span><span class="op" id="6395701">.</span><span class="ident" id="6395702">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395709">}</span>&nbsp;<span class="keyword" id="6395711">else</span>&nbsp;<span class="op" id="6395716">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395720">node</span><span class="op" id="6395724">.</span><span class="ident" id="6395725">left</span><span class="op" id="6395729">,</span>&nbsp;<span class="ident" id="6395731">err</span>&nbsp;<span class="op" id="6395735">=</span>&nbsp;<span class="ident" id="6395737">buildHuffmanNode</span><span class="op" id="6395753">(</span><span class="ident" id="6395754">t</span><span class="op" id="6395755">,</span>&nbsp;<span class="ident" id="6395757">left</span><span class="op" id="6395761">,</span>&nbsp;<span class="ident" id="6395763">level</span><span class="op" id="6395768">+</span><span class="num" id="6395769">1</span><span class="op" id="6395770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395777">if</span>&nbsp;<span class="ident" id="6395780">err</span>&nbsp;<span class="op" id="6395784">!=</span>&nbsp;<span class="ident" id="6395787">nil</span>&nbsp;<span class="op" id="6395791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395795">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395807">if</span>&nbsp;<span class="builtinfunc" id="6395810">len</span><span class="op" id="6395813">(</span><span class="ident" id="6395814">right</span><span class="op" id="6395819">)</span>&nbsp;<span class="op" id="6395821">==</span>&nbsp;<span class="num" id="6395824">1</span>&nbsp;<span class="op" id="6395826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6395830">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395845">node</span><span class="op" id="6395849">.</span><span class="ident" id="6395850">right</span>&nbsp;<span class="op" id="6395856">=</span>&nbsp;<span class="ident" id="6395858">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395877">node</span><span class="op" id="6395881">.</span><span class="ident" id="6395882">rightValue</span>&nbsp;<span class="op" id="6395893">=</span>&nbsp;<span class="ident" id="6395895">right</span><span class="op" id="6395900">[</span><span class="num" id="6395901">0</span><span class="op" id="6395902">]</span><span class="op" id="6395903">.</span><span class="ident" id="6395904">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395911">}</span>&nbsp;<span class="keyword" id="6395913">else</span>&nbsp;<span class="op" id="6395918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395922">node</span><span class="op" id="6395926">.</span><span class="ident" id="6395927">right</span><span class="op" id="6395932">,</span>&nbsp;<span class="ident" id="6395934">err</span>&nbsp;<span class="op" id="6395938">=</span>&nbsp;<span class="ident" id="6395940">buildHuffmanNode</span><span class="op" id="6395956">(</span><span class="ident" id="6395957">t</span><span class="op" id="6395958">,</span>&nbsp;<span class="ident" id="6395960">right</span><span class="op" id="6395965">,</span>&nbsp;<span class="ident" id="6395967">level</span><span class="op" id="6395972">+</span><span class="num" id="6395973">1</span><span class="op" id="6395974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395981">return</span><br>
<span class="lineno"></span><span class="op" id="6395988">}</span>
</div>
</body>
</html>
