<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6216916">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6216971">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6217025">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6217076">package</span>&nbsp;<span class="ident" id="6217084">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6217089">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="6217108">//&nbsp;-&nbsp;catch&nbsp;more&nbsp;errors&nbsp;(no&nbsp;first&nbsp;header,&nbsp;etc.)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6217156">import</span>&nbsp;<span class="op" id="6217163">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217166">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217175">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217185">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217192">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217198">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217204">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217212">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217223">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6217234">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="6217241">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6217244">var</span>&nbsp;<span class="op" id="6217248">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217251">ErrWriteTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6217270">=</span>&nbsp;<span class="ident" id="6217272"><a href="/archive/tar/writer.go.html#6217175">errors</a></span><span class="op" id="6217278">.</span><span class="ident" id="6217279">New</span><span class="op" id="6217282">(</span><span class="string" id="6217283">&#34;archive/tar:&nbsp;write&nbsp;too&nbsp;long&#34;</span><span class="op" id="6217312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217315">ErrFieldTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6217334">=</span>&nbsp;<span class="ident" id="6217336"><a href="/archive/tar/writer.go.html#6217175">errors</a></span><span class="op" id="6217342">.</span><span class="ident" id="6217343">New</span><span class="op" id="6217346">(</span><span class="string" id="6217347">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&#34;</span><span class="op" id="6217383">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217386">ErrWriteAfterClose</span>&nbsp;<span class="op" id="6217405">=</span>&nbsp;<span class="ident" id="6217407"><a href="/archive/tar/writer.go.html#6217175">errors</a></span><span class="op" id="6217413">.</span><span class="ident" id="6217414">New</span><span class="op" id="6217417">(</span><span class="string" id="6217418">&#34;archive/tar:&nbsp;write&nbsp;after&nbsp;close&#34;</span><span class="op" id="6217450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217453">errNameTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6217472">=</span>&nbsp;<span class="ident" id="6217474"><a href="/archive/tar/writer.go.html#6217175">errors</a></span><span class="op" id="6217480">.</span><span class="ident" id="6217481">New</span><span class="op" id="6217484">(</span><span class="string" id="6217485">&#34;archive/tar:&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="6217513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217516">errInvalidHeader</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6217535">=</span>&nbsp;<span class="ident" id="6217537"><a href="/archive/tar/writer.go.html#6217175">errors</a></span><span class="op" id="6217543">.</span><span class="ident" id="6217544">New</span><span class="op" id="6217547">(</span><span class="string" id="6217548">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&nbsp;or&nbsp;contains&nbsp;invalid&nbsp;values&#34;</span><span class="op" id="6217611">)</span><br>
<span class="lineno"></span><span class="op" id="6217613">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="6217616">//&nbsp;A&nbsp;Writer&nbsp;provides&nbsp;sequential&nbsp;writing&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive&nbsp;in&nbsp;POSIX.1&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="6217692">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6217742">//&nbsp;Call&nbsp;WriteHeader&nbsp;to&nbsp;begin&nbsp;a&nbsp;new&nbsp;file,&nbsp;and&nbsp;then&nbsp;call&nbsp;Write&nbsp;to&nbsp;supply&nbsp;that&nbsp;file&#39;s&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="6217831">//&nbsp;writing&nbsp;at&nbsp;most&nbsp;hdr.Size&nbsp;bytes&nbsp;in&nbsp;total.</span><br>
<span class="lineno"></span><span class="keyword" id="6217875">type</span>&nbsp;<span class="ident" id="6217880">Writer</span>&nbsp;<span class="keyword" id="6217887">struct</span>&nbsp;<span class="op" id="6217894">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217897">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6217908"><a href="/archive/tar/writer.go.html#6217192">io</a></span><span class="op" id="6217910">.</span><span class="ident" id="6217911">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217919">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6217930">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6217937">nb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6217948">int64</span>&nbsp;<span class="comment" id="6217954">//&nbsp;number&nbsp;of&nbsp;unwritten&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218007">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6218018">int64</span>&nbsp;<span class="comment" id="6218024">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;to&nbsp;write&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218080">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6218091">bool</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218097">usedBinary</span>&nbsp;<span class="builtintype" id="6218108">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6218124">//&nbsp;whether&nbsp;the&nbsp;binary&nbsp;numeric&nbsp;field&nbsp;extension&nbsp;was&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218180">preferPax</span>&nbsp;&nbsp;<span class="builtintype" id="6218191">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6218207">//&nbsp;use&nbsp;pax&nbsp;header&nbsp;instead&nbsp;of&nbsp;binary&nbsp;numeric&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218259">hdrBuff</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6218270">[</span><span class="ident" id="6218271"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span><span class="op" id="6218280">]</span><span class="builtintype" id="6218281">byte</span>&nbsp;<span class="comment" id="6218286">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;regular&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218349">paxHdrBuff</span>&nbsp;<span class="op" id="6218360">[</span><span class="ident" id="6218361"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span><span class="op" id="6218370">]</span><span class="builtintype" id="6218371">byte</span>&nbsp;<span class="comment" id="6218376">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span><span class="op" id="6218434">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6218437">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6218485">func</span>&nbsp;<span class="ident" id="6218490">NewWriter</span><span class="op" id="6218499">(</span><span class="ident" id="6218500">w</span>&nbsp;<span class="ident" id="6218502"><a href="/archive/tar/writer.go.html#6217192">io</a></span><span class="op" id="6218504">.</span><span class="ident" id="6218505">Writer</span><span class="op" id="6218511">)</span>&nbsp;<span class="op" id="6218513">*</span><span class="ident" id="6218514"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span>&nbsp;<span class="op" id="6218521">{</span>&nbsp;<span class="keyword" id="6218523">return</span>&nbsp;<span class="op" id="6218530">&amp;</span><span class="ident" id="6218531"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6218537">{</span><span class="ident" id="6218538">w</span><span class="op" id="6218539">:</span>&nbsp;<span class="ident" id="6218541"><a href="/archive/tar/writer.go.html#6218500">w</a></span><span class="op" id="6218542">}</span>&nbsp;<span class="op" id="6218544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6218547">//&nbsp;Flush&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;current&nbsp;file&nbsp;(optional).</span><br>
<span class="lineno">50</span><span class="keyword" id="6218602">func</span>&nbsp;<span class="op" id="6218607">(</span><span class="ident" id="6218608">tw</span>&nbsp;<span class="op" id="6218611">*</span><span class="ident" id="6218612"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6218618">)</span>&nbsp;<span class="ident" id="6218620">Flush</span><span class="op" id="6218625">(</span><span class="op" id="6218626">)</span>&nbsp;<span class="builtintype" id="6218628">error</span>&nbsp;<span class="op" id="6218634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218637">if</span>&nbsp;<span class="ident" id="6218640"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218642">.</span><span class="ident" id="6218643">nb</span>&nbsp;<span class="op" id="6218646">&gt;</span>&nbsp;<span class="num" id="6218648">0</span>&nbsp;<span class="op" id="6218650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218654"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218656">.</span><span class="ident" id="6218657">err</span>&nbsp;<span class="op" id="6218661">=</span>&nbsp;<span class="ident" id="6218663"><a href="/archive/tar/writer.go.html#6217185">fmt</a></span><span class="op" id="6218666">.</span><span class="ident" id="6218667">Errorf</span><span class="op" id="6218673">(</span><span class="string" id="6218674">&#34;archive/tar:&nbsp;missed&nbsp;writing&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6218712">,</span>&nbsp;<span class="ident" id="6218714"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218716">.</span><span class="ident" id="6218717">nb</span><span class="op" id="6218719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218723">return</span>&nbsp;<span class="ident" id="6218730"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218732">.</span><span class="ident" id="6218733">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218738">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218742">n</span>&nbsp;<span class="op" id="6218744">:=</span>&nbsp;<span class="ident" id="6218747"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218749">.</span><span class="ident" id="6218750">nb</span>&nbsp;<span class="op" id="6218753">+</span>&nbsp;<span class="ident" id="6218755"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218757">.</span><span class="ident" id="6218758">pad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218763">for</span>&nbsp;<span class="ident" id="6218767"><a href="/archive/tar/writer.go.html#6218742">n</a></span>&nbsp;<span class="op" id="6218769">&gt;</span>&nbsp;<span class="num" id="6218771">0</span>&nbsp;<span class="op" id="6218773">&amp;&amp;</span>&nbsp;<span class="ident" id="6218776"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218778">.</span><span class="ident" id="6218779">err</span>&nbsp;<span class="op" id="6218783">==</span>&nbsp;<span class="ident" id="6218786">nil</span>&nbsp;<span class="op" id="6218790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218794">nr</span>&nbsp;<span class="op" id="6218797">:=</span>&nbsp;<span class="ident" id="6218800"><a href="/archive/tar/writer.go.html#6218742">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218804">if</span>&nbsp;<span class="ident" id="6218807"><a href="/archive/tar/writer.go.html#6218794">nr</a></span>&nbsp;<span class="op" id="6218810">&gt;</span>&nbsp;<span class="ident" id="6218812"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span>&nbsp;<span class="op" id="6218822">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218827"><a href="/archive/tar/writer.go.html#6218794">nr</a></span>&nbsp;<span class="op" id="6218830">=</span>&nbsp;<span class="ident" id="6218832"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218848">var</span>&nbsp;<span class="ident" id="6218852">nw</span>&nbsp;<span class="builtintype" id="6218855">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218861"><a href="/archive/tar/writer.go.html#6218852">nw</a></span><span class="op" id="6218863">,</span>&nbsp;<span class="ident" id="6218865"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218867">.</span><span class="ident" id="6218868">err</span>&nbsp;<span class="op" id="6218872">=</span>&nbsp;<span class="ident" id="6218874"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218876">.</span><span class="ident" id="6218877">w</span><span class="op" id="6218878">.</span><span class="ident" id="6218879">Write</span><span class="op" id="6218884">(</span><span class="ident" id="6218885"><a href="/archive/tar/common.go.html#6192523">zeroBlock</a></span><span class="op" id="6218894">[</span><span class="num" id="6218895">0</span><span class="op" id="6218896">:</span><span class="ident" id="6218897"><a href="/archive/tar/writer.go.html#6218794">nr</a></span><span class="op" id="6218899">]</span><span class="op" id="6218900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218904"><a href="/archive/tar/writer.go.html#6218742">n</a></span>&nbsp;<span class="op" id="6218906">-=</span>&nbsp;<span class="ident" id="6218909">int64</span><span class="op" id="6218914">(</span><span class="ident" id="6218915"><a href="/archive/tar/writer.go.html#6218852">nw</a></span><span class="op" id="6218917">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6218920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218923"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218925">.</span><span class="ident" id="6218926">nb</span>&nbsp;<span class="op" id="6218929">=</span>&nbsp;<span class="num" id="6218931">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6218934"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218936">.</span><span class="ident" id="6218937">pad</span>&nbsp;<span class="op" id="6218941">=</span>&nbsp;<span class="num" id="6218943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6218946">return</span>&nbsp;<span class="ident" id="6218953"><a href="/archive/tar/writer.go.html#6218608">tw</a></span><span class="op" id="6218955">.</span><span class="ident" id="6218956">err</span><br>
<span class="lineno"></span><span class="op" id="6218960">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="6218963">//&nbsp;Write&nbsp;s&nbsp;into&nbsp;b,&nbsp;terminating&nbsp;it&nbsp;with&nbsp;a&nbsp;NUL&nbsp;if&nbsp;there&nbsp;is&nbsp;room.</span><br>
<span class="lineno"></span><span class="comment" id="6219026">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;allowPax&nbsp;is&nbsp;true&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="6219120">func</span>&nbsp;<span class="op" id="6219125">(</span><span class="ident" id="6219126">tw</span>&nbsp;<span class="op" id="6219129">*</span><span class="ident" id="6219130"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6219136">)</span>&nbsp;<span class="ident" id="6219138">cString</span><span class="op" id="6219145">(</span><span class="ident" id="6219146">b</span>&nbsp;<span class="op" id="6219148">[</span><span class="op" id="6219149">]</span><span class="builtintype" id="6219150">byte</span><span class="op" id="6219154">,</span>&nbsp;<span class="ident" id="6219156">s</span>&nbsp;<span class="builtintype" id="6219158">string</span><span class="op" id="6219164">,</span>&nbsp;<span class="ident" id="6219166">allowPax</span>&nbsp;<span class="builtintype" id="6219175">bool</span><span class="op" id="6219179">,</span>&nbsp;<span class="ident" id="6219181">paxKeyword</span>&nbsp;<span class="builtintype" id="6219192">string</span><span class="op" id="6219198">,</span>&nbsp;<span class="ident" id="6219200">paxHeaders</span>&nbsp;<span class="keyword" id="6219211">map</span><span class="op" id="6219214">[</span><span class="builtintype" id="6219215">string</span><span class="op" id="6219221">]</span><span class="builtintype" id="6219222">string</span><span class="op" id="6219228">)</span>&nbsp;<span class="op" id="6219230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219233">needsPaxHeader</span>&nbsp;<span class="op" id="6219248">:=</span>&nbsp;<span class="ident" id="6219251"><a href="/archive/tar/writer.go.html#6219166">allowPax</a></span>&nbsp;<span class="op" id="6219260">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6219263">len</span><span class="op" id="6219266">(</span><span class="ident" id="6219267"><a href="/archive/tar/writer.go.html#6219156">s</a></span><span class="op" id="6219268">)</span>&nbsp;<span class="op" id="6219270">&gt;</span>&nbsp;<span class="builtinfunc" id="6219272">len</span><span class="op" id="6219275">(</span><span class="ident" id="6219276"><a href="/archive/tar/writer.go.html#6219146">b</a></span><span class="op" id="6219277">)</span>&nbsp;<span class="op" id="6219279">||</span>&nbsp;<span class="op" id="6219282">!</span><span class="ident" id="6219283"><a href="/archive/tar/common.go.html#6193153">isASCII</a></span><span class="op" id="6219290">(</span><span class="ident" id="6219291"><a href="/archive/tar/writer.go.html#6219156">s</a></span><span class="op" id="6219292">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219295">if</span>&nbsp;<span class="ident" id="6219298"><a href="/archive/tar/writer.go.html#6219233">needsPaxHeader</a></span>&nbsp;<span class="op" id="6219313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219317"><a href="/archive/tar/writer.go.html#6219200">paxHeaders</a></span><span class="op" id="6219327">[</span><span class="ident" id="6219328"><a href="/archive/tar/writer.go.html#6219181">paxKeyword</a></span><span class="op" id="6219338">]</span>&nbsp;<span class="op" id="6219340">=</span>&nbsp;<span class="ident" id="6219342"><a href="/archive/tar/writer.go.html#6219156">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219346">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219357">if</span>&nbsp;<span class="builtinfunc" id="6219360">len</span><span class="op" id="6219363">(</span><span class="ident" id="6219364"><a href="/archive/tar/writer.go.html#6219156">s</a></span><span class="op" id="6219365">)</span>&nbsp;<span class="op" id="6219367">&gt;</span>&nbsp;<span class="builtinfunc" id="6219369">len</span><span class="op" id="6219372">(</span><span class="ident" id="6219373"><a href="/archive/tar/writer.go.html#6219146">b</a></span><span class="op" id="6219374">)</span>&nbsp;<span class="op" id="6219376">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219380">if</span>&nbsp;<span class="ident" id="6219383"><a href="/archive/tar/writer.go.html#6219126">tw</a></span><span class="op" id="6219385">.</span><span class="ident" id="6219386">err</span>&nbsp;<span class="op" id="6219390">==</span>&nbsp;<span class="ident" id="6219393">nil</span>&nbsp;<span class="op" id="6219397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219402"><a href="/archive/tar/writer.go.html#6219126">tw</a></span><span class="op" id="6219404">.</span><span class="ident" id="6219405">err</span>&nbsp;<span class="op" id="6219409">=</span>&nbsp;<span class="ident" id="6219411"><a href="/archive/tar/writer.go.html#6217315">ErrFieldTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219433">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219441">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219444">ascii</span>&nbsp;<span class="op" id="6219450">:=</span>&nbsp;<span class="ident" id="6219453"><a href="/archive/tar/common.go.html#6193262">toASCII</a></span><span class="op" id="6219460">(</span><span class="ident" id="6219461"><a href="/archive/tar/writer.go.html#6219156">s</a></span><span class="op" id="6219462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6219465">copy</span><span class="op" id="6219469">(</span><span class="ident" id="6219470"><a href="/archive/tar/writer.go.html#6219146">b</a></span><span class="op" id="6219471">,</span>&nbsp;<span class="ident" id="6219473"><a href="/archive/tar/writer.go.html#6219444">ascii</a></span><span class="op" id="6219478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219481">if</span>&nbsp;<span class="builtinfunc" id="6219484">len</span><span class="op" id="6219487">(</span><span class="ident" id="6219488"><a href="/archive/tar/writer.go.html#6219444">ascii</a></span><span class="op" id="6219493">)</span>&nbsp;<span class="op" id="6219495">&lt;</span>&nbsp;<span class="builtinfunc" id="6219497">len</span><span class="op" id="6219500">(</span><span class="ident" id="6219501"><a href="/archive/tar/writer.go.html#6219146">b</a></span><span class="op" id="6219502">)</span>&nbsp;<span class="op" id="6219504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219508"><a href="/archive/tar/writer.go.html#6219146">b</a></span><span class="op" id="6219509">[</span><span class="builtinfunc" id="6219510">len</span><span class="op" id="6219513">(</span><span class="ident" id="6219514"><a href="/archive/tar/writer.go.html#6219444">ascii</a></span><span class="op" id="6219519">)</span><span class="op" id="6219520">]</span>&nbsp;<span class="op" id="6219522">=</span>&nbsp;<span class="num" id="6219524">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219527">}</span><br>
<span class="lineno">90</span><span class="op" id="6219529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6219532">//&nbsp;Encode&nbsp;x&nbsp;as&nbsp;an&nbsp;octal&nbsp;ASCII&nbsp;string&nbsp;and&nbsp;write&nbsp;it&nbsp;into&nbsp;b&nbsp;with&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span><span class="keyword" id="6219609">func</span>&nbsp;<span class="op" id="6219614">(</span><span class="ident" id="6219615">tw</span>&nbsp;<span class="op" id="6219618">*</span><span class="ident" id="6219619"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6219625">)</span>&nbsp;<span class="ident" id="6219627">octal</span><span class="op" id="6219632">(</span><span class="ident" id="6219633">b</span>&nbsp;<span class="op" id="6219635">[</span><span class="op" id="6219636">]</span><span class="builtintype" id="6219637">byte</span><span class="op" id="6219641">,</span>&nbsp;<span class="ident" id="6219643">x</span>&nbsp;<span class="ident" id="6219645">int64</span><span class="op" id="6219650">)</span>&nbsp;<span class="op" id="6219652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219655">s</span>&nbsp;<span class="op" id="6219657">:=</span>&nbsp;<span class="ident" id="6219660"><a href="/archive/tar/writer.go.html#6217212">strconv</a></span><span class="op" id="6219667">.</span><span class="ident" id="6219668">FormatInt</span><span class="op" id="6219677">(</span><span class="ident" id="6219678"><a href="/archive/tar/writer.go.html#6219643">x</a></span><span class="op" id="6219679">,</span>&nbsp;<span class="num" id="6219681">8</span><span class="op" id="6219682">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6219685">//&nbsp;leading&nbsp;zeros,&nbsp;but&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;NUL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6219730">for</span>&nbsp;<span class="builtinfunc" id="6219734">len</span><span class="op" id="6219737">(</span><span class="ident" id="6219738"><a href="/archive/tar/writer.go.html#6219655">s</a></span><span class="op" id="6219739">)</span><span class="op" id="6219740">+</span><span class="num" id="6219741">1</span>&nbsp;<span class="op" id="6219743">&lt;</span>&nbsp;<span class="builtinfunc" id="6219745">len</span><span class="op" id="6219748">(</span><span class="ident" id="6219749"><a href="/archive/tar/writer.go.html#6219633">b</a></span><span class="op" id="6219750">)</span>&nbsp;<span class="op" id="6219752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219756"><a href="/archive/tar/writer.go.html#6219655">s</a></span>&nbsp;<span class="op" id="6219758">=</span>&nbsp;<span class="string" id="6219760">&#34;0&#34;</span>&nbsp;<span class="op" id="6219764">+</span>&nbsp;<span class="ident" id="6219766"><a href="/archive/tar/writer.go.html#6219655">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6219769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6219772"><a href="/archive/tar/writer.go.html#6219615">tw</a></span><span class="op" id="6219774">.</span><span class="ident" id="6219775">cString</span><span class="op" id="6219782">(</span><span class="ident" id="6219783"><a href="/archive/tar/writer.go.html#6219633">b</a></span><span class="op" id="6219784">,</span>&nbsp;<span class="ident" id="6219786"><a href="/archive/tar/writer.go.html#6219655">s</a></span><span class="op" id="6219787">,</span>&nbsp;<span class="builtintype" id="6219789">false</span><span class="op" id="6219794">,</span>&nbsp;<span class="ident" id="6219796"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6219803">,</span>&nbsp;<span class="ident" id="6219805">nil</span><span class="op" id="6219808">)</span><br>
<span class="lineno">100</span><span class="op" id="6219810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6219813">//&nbsp;Write&nbsp;x&nbsp;into&nbsp;b,&nbsp;either&nbsp;as&nbsp;octal&nbsp;or&nbsp;as&nbsp;binary&nbsp;(GNUtar/star&nbsp;extension).</span><br>
<span class="lineno"></span><span class="comment" id="6219886">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;writingPax&nbsp;is&nbsp;enabled&nbsp;both&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;the&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="6220012">func</span>&nbsp;<span class="op" id="6220017">(</span><span class="ident" id="6220018">tw</span>&nbsp;<span class="op" id="6220021">*</span><span class="ident" id="6220022"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6220028">)</span>&nbsp;<span class="ident" id="6220030">numeric</span><span class="op" id="6220037">(</span><span class="ident" id="6220038">b</span>&nbsp;<span class="op" id="6220040">[</span><span class="op" id="6220041">]</span><span class="builtintype" id="6220042">byte</span><span class="op" id="6220046">,</span>&nbsp;<span class="ident" id="6220048">x</span>&nbsp;<span class="ident" id="6220050">int64</span><span class="op" id="6220055">,</span>&nbsp;<span class="ident" id="6220057">allowPax</span>&nbsp;<span class="builtintype" id="6220066">bool</span><span class="op" id="6220070">,</span>&nbsp;<span class="ident" id="6220072">paxKeyword</span>&nbsp;<span class="builtintype" id="6220083">string</span><span class="op" id="6220089">,</span>&nbsp;<span class="ident" id="6220091">paxHeaders</span>&nbsp;<span class="keyword" id="6220102">map</span><span class="op" id="6220105">[</span><span class="builtintype" id="6220106">string</span><span class="op" id="6220112">]</span><span class="builtintype" id="6220113">string</span><span class="op" id="6220119">)</span>&nbsp;<span class="op" id="6220121">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220124">//&nbsp;Try&nbsp;octal&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220145">s</span>&nbsp;<span class="op" id="6220147">:=</span>&nbsp;<span class="ident" id="6220150"><a href="/archive/tar/writer.go.html#6217212">strconv</a></span><span class="op" id="6220157">.</span><span class="ident" id="6220158">FormatInt</span><span class="op" id="6220167">(</span><span class="ident" id="6220168"><a href="/archive/tar/writer.go.html#6220048">x</a></span><span class="op" id="6220169">,</span>&nbsp;<span class="num" id="6220171">8</span><span class="op" id="6220172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220175">if</span>&nbsp;<span class="builtinfunc" id="6220178">len</span><span class="op" id="6220181">(</span><span class="ident" id="6220182"><a href="/archive/tar/writer.go.html#6220145">s</a></span><span class="op" id="6220183">)</span>&nbsp;<span class="op" id="6220185">&lt;</span>&nbsp;<span class="builtinfunc" id="6220187">len</span><span class="op" id="6220190">(</span><span class="ident" id="6220191"><a href="/archive/tar/writer.go.html#6220038">b</a></span><span class="op" id="6220192">)</span>&nbsp;<span class="op" id="6220194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220198"><a href="/archive/tar/writer.go.html#6220018">tw</a></span><span class="op" id="6220200">.</span><span class="ident" id="6220201">octal</span><span class="op" id="6220206">(</span><span class="ident" id="6220207"><a href="/archive/tar/writer.go.html#6220038">b</a></span><span class="op" id="6220208">,</span>&nbsp;<span class="ident" id="6220210"><a href="/archive/tar/writer.go.html#6220048">x</a></span><span class="op" id="6220211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220215">return</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220227">//&nbsp;If&nbsp;it&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;octal,&nbsp;and&nbsp;pax&nbsp;is&nbsp;preferred,&nbsp;use&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220299">if</span>&nbsp;<span class="ident" id="6220302"><a href="/archive/tar/writer.go.html#6220057">allowPax</a></span>&nbsp;<span class="op" id="6220311">&amp;&amp;</span>&nbsp;<span class="ident" id="6220314"><a href="/archive/tar/writer.go.html#6220018">tw</a></span><span class="op" id="6220316">.</span><span class="ident" id="6220317">preferPax</span>&nbsp;<span class="op" id="6220327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220331"><a href="/archive/tar/writer.go.html#6220018">tw</a></span><span class="op" id="6220333">.</span><span class="ident" id="6220334">octal</span><span class="op" id="6220339">(</span><span class="ident" id="6220340"><a href="/archive/tar/writer.go.html#6220038">b</a></span><span class="op" id="6220341">,</span>&nbsp;<span class="num" id="6220343">0</span><span class="op" id="6220344">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220348">s</span>&nbsp;<span class="op" id="6220350">:=</span>&nbsp;<span class="ident" id="6220353"><a href="/archive/tar/writer.go.html#6217212">strconv</a></span><span class="op" id="6220360">.</span><span class="ident" id="6220361">FormatInt</span><span class="op" id="6220370">(</span><span class="ident" id="6220371"><a href="/archive/tar/writer.go.html#6220048">x</a></span><span class="op" id="6220372">,</span>&nbsp;<span class="num" id="6220374">10</span><span class="op" id="6220376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220380"><a href="/archive/tar/writer.go.html#6220091">paxHeaders</a></span><span class="op" id="6220390">[</span><span class="ident" id="6220391"><a href="/archive/tar/writer.go.html#6220072">paxKeyword</a></span><span class="op" id="6220401">]</span>&nbsp;<span class="op" id="6220403">=</span>&nbsp;<span class="ident" id="6220405"><a href="/archive/tar/writer.go.html#6220348">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220409">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220421">//&nbsp;Too&nbsp;big:&nbsp;use&nbsp;binary&nbsp;(big-endian).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220459"><a href="/archive/tar/writer.go.html#6220018">tw</a></span><span class="op" id="6220461">.</span><span class="ident" id="6220462">usedBinary</span>&nbsp;<span class="op" id="6220473">=</span>&nbsp;<span class="builtintype" id="6220475">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220481">for</span>&nbsp;<span class="ident" id="6220485">i</span>&nbsp;<span class="op" id="6220487">:=</span>&nbsp;<span class="builtinfunc" id="6220490">len</span><span class="op" id="6220493">(</span><span class="ident" id="6220494"><a href="/archive/tar/writer.go.html#6220038">b</a></span><span class="op" id="6220495">)</span>&nbsp;<span class="op" id="6220497">-</span>&nbsp;<span class="num" id="6220499">1</span><span class="op" id="6220500">;</span>&nbsp;<span class="ident" id="6220502"><a href="/archive/tar/writer.go.html#6220048">x</a></span>&nbsp;<span class="op" id="6220504">&gt;</span>&nbsp;<span class="num" id="6220506">0</span>&nbsp;<span class="op" id="6220508">&amp;&amp;</span>&nbsp;<span class="ident" id="6220511"><a href="/archive/tar/writer.go.html#6220485">i</a></span>&nbsp;<span class="op" id="6220513">&gt;=</span>&nbsp;<span class="num" id="6220516">0</span><span class="op" id="6220517">;</span>&nbsp;<span class="ident" id="6220519"><a href="/archive/tar/writer.go.html#6220485">i</a></span><span class="op" id="6220520">--</span>&nbsp;<span class="op" id="6220523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220527"><a href="/archive/tar/writer.go.html#6220038">b</a></span><span class="op" id="6220528">[</span><span class="ident" id="6220529"><a href="/archive/tar/writer.go.html#6220485">i</a></span><span class="op" id="6220530">]</span>&nbsp;<span class="op" id="6220532">=</span>&nbsp;<span class="builtintype" id="6220534">byte</span><span class="op" id="6220538">(</span><span class="ident" id="6220539"><a href="/archive/tar/writer.go.html#6220048">x</a></span><span class="op" id="6220540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220544"><a href="/archive/tar/writer.go.html#6220048">x</a></span>&nbsp;<span class="op" id="6220546">&gt;&gt;=</span>&nbsp;<span class="num" id="6220550">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6220553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220556"><a href="/archive/tar/writer.go.html#6220038">b</a></span><span class="op" id="6220557">[</span><span class="num" id="6220558">0</span><span class="op" id="6220559">]</span>&nbsp;<span class="op" id="6220561">|=</span>&nbsp;<span class="num" id="6220564">0x80</span>&nbsp;<span class="comment" id="6220569">//&nbsp;highest&nbsp;bit&nbsp;indicates&nbsp;binary&nbsp;format</span><br>
<span class="lineno"></span><span class="op" id="6220608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6220611">var</span>&nbsp;<span class="op" id="6220615">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220618">minTime</span>&nbsp;<span class="op" id="6220626">=</span>&nbsp;<span class="ident" id="6220628"><a href="/archive/tar/writer.go.html#6217234">time</a></span><span class="op" id="6220632">.</span><span class="ident" id="6220633">Unix</span><span class="op" id="6220637">(</span><span class="num" id="6220638">0</span><span class="op" id="6220639">,</span>&nbsp;<span class="num" id="6220641">0</span><span class="op" id="6220642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6220645">//&nbsp;There&nbsp;is&nbsp;room&nbsp;for&nbsp;11&nbsp;octal&nbsp;digits&nbsp;(33&nbsp;bits)&nbsp;of&nbsp;mtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6220703">maxTime</span>&nbsp;<span class="op" id="6220711">=</span>&nbsp;<span class="ident" id="6220713"><a href="/archive/tar/writer.go.html#6220618">minTime</a></span><span class="op" id="6220720">.</span><span class="ident" id="6220721">Add</span><span class="op" id="6220724">(</span><span class="op" id="6220725">(</span><span class="num" id="6220726">1</span><span class="op" id="6220727">&lt;&lt;</span><span class="num" id="6220729">33</span>&nbsp;<span class="op" id="6220732">-</span>&nbsp;<span class="num" id="6220734">1</span><span class="op" id="6220735">)</span>&nbsp;<span class="op" id="6220737">*</span>&nbsp;<span class="ident" id="6220739"><a href="/archive/tar/writer.go.html#6217234">time</a></span><span class="op" id="6220743">.</span><span class="ident" id="6220744">Second</span><span class="op" id="6220750">)</span><br>
<span class="lineno"></span><span class="op" id="6220752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6220755">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6220825">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="6220883">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno"></span><span class="keyword" id="6220940">func</span>&nbsp;<span class="op" id="6220945">(</span><span class="ident" id="6220946">tw</span>&nbsp;<span class="op" id="6220949">*</span><span class="ident" id="6220950"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6220956">)</span>&nbsp;<span class="ident" id="6220958">WriteHeader</span><span class="op" id="6220969">(</span><span class="ident" id="6220970">hdr</span>&nbsp;<span class="op" id="6220974">*</span><span class="ident" id="6220975"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6220981">)</span>&nbsp;<span class="builtintype" id="6220983">error</span>&nbsp;<span class="op" id="6220989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6220992">return</span>&nbsp;<span class="ident" id="6220999"><a href="/archive/tar/writer.go.html#6220946">tw</a></span><span class="op" id="6221001">.</span><span class="ident" id="6221002">writeHeader</span><span class="op" id="6221013">(</span><span class="ident" id="6221014"><a href="/archive/tar/writer.go.html#6220970">hdr</a></span><span class="op" id="6221017">,</span>&nbsp;<span class="builtintype" id="6221019">true</span><span class="op" id="6221023">)</span><br>
<span class="lineno">140</span><span class="op" id="6221025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6221028">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6221098">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="6221156">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno">145</span><span class="comment" id="6221213">//&nbsp;As&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;internally&nbsp;by&nbsp;writePax&nbsp;header&nbsp;to&nbsp;allow&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6221286">//&nbsp;suppress&nbsp;writing&nbsp;the&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6221322">func</span>&nbsp;<span class="op" id="6221327">(</span><span class="ident" id="6221328">tw</span>&nbsp;<span class="op" id="6221331">*</span><span class="ident" id="6221332"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6221338">)</span>&nbsp;<span class="ident" id="6221340">writeHeader</span><span class="op" id="6221351">(</span><span class="ident" id="6221352">hdr</span>&nbsp;<span class="op" id="6221356">*</span><span class="ident" id="6221357"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6221363">,</span>&nbsp;<span class="ident" id="6221365">allowPax</span>&nbsp;<span class="builtintype" id="6221374">bool</span><span class="op" id="6221378">)</span>&nbsp;<span class="builtintype" id="6221380">error</span>&nbsp;<span class="op" id="6221386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221389">if</span>&nbsp;<span class="ident" id="6221392"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6221394">.</span><span class="ident" id="6221395">closed</span>&nbsp;<span class="op" id="6221402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221406">return</span>&nbsp;<span class="ident" id="6221413"><a href="/archive/tar/writer.go.html#6217386">ErrWriteAfterClose</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221436">if</span>&nbsp;<span class="ident" id="6221439"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6221441">.</span><span class="ident" id="6221442">err</span>&nbsp;<span class="op" id="6221446">==</span>&nbsp;<span class="ident" id="6221449">nil</span>&nbsp;<span class="op" id="6221453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221457"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6221459">.</span><span class="ident" id="6221460">Flush</span><span class="op" id="6221465">(</span><span class="op" id="6221466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221472">if</span>&nbsp;<span class="ident" id="6221475"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6221477">.</span><span class="ident" id="6221478">err</span>&nbsp;<span class="op" id="6221482">!=</span>&nbsp;<span class="ident" id="6221485">nil</span>&nbsp;<span class="op" id="6221489">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221493">return</span>&nbsp;<span class="ident" id="6221500"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6221502">.</span><span class="ident" id="6221503">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6221508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221512">//&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;pax&nbsp;header&nbsp;records,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6221568">paxHeaders</span>&nbsp;<span class="op" id="6221579">:=</span>&nbsp;<span class="builtinfunc" id="6221582">make</span><span class="op" id="6221586">(</span><span class="keyword" id="6221587">map</span><span class="op" id="6221590">[</span><span class="builtintype" id="6221591">string</span><span class="op" id="6221597">]</span><span class="builtintype" id="6221598">string</span><span class="op" id="6221604">)</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221608">//&nbsp;TODO(shanemhansen):&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;use&nbsp;PAX&nbsp;headers&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221669">//&nbsp;subsecond&nbsp;time&nbsp;resolution,&nbsp;but&nbsp;for&nbsp;now&nbsp;let&#39;s&nbsp;just&nbsp;capture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221731">//&nbsp;too&nbsp;long&nbsp;fields&nbsp;or&nbsp;non&nbsp;ascii&nbsp;characters</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6221776">var</span>&nbsp;<span class="ident" id="6221780">header</span>&nbsp;<span class="op" id="6221787">[</span><span class="op" id="6221788">]</span><span class="builtintype" id="6221789">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221796">//&nbsp;We&nbsp;need&nbsp;to&nbsp;select&nbsp;which&nbsp;scratch&nbsp;buffer&nbsp;to&nbsp;use&nbsp;carefully,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221857">//&nbsp;since&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;recursively&nbsp;to&nbsp;write&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6221923">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;true,&nbsp;this&nbsp;is&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;and&nbsp;we&nbsp;will&nbsp;use&nbsp;hdrBuff.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6222005">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;false,&nbsp;we&nbsp;are&nbsp;being&nbsp;called&nbsp;by&nbsp;writePAXHeader,&nbsp;and&nbsp;hdrBuff&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6222085">//&nbsp;already&nbsp;being&nbsp;used&nbsp;by&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;so&nbsp;we&nbsp;must&nbsp;use&nbsp;paxHdrBuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222162"><a href="/archive/tar/writer.go.html#6221780">header</a></span>&nbsp;<span class="op" id="6222169">=</span>&nbsp;<span class="ident" id="6222171"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222173">.</span><span class="ident" id="6222174">hdrBuff</span><span class="op" id="6222181">[</span><span class="op" id="6222182">:</span><span class="op" id="6222183">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222186">if</span>&nbsp;<span class="op" id="6222189">!</span><span class="ident" id="6222190"><a href="/archive/tar/writer.go.html#6221365">allowPax</a></span>&nbsp;<span class="op" id="6222199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222203"><a href="/archive/tar/writer.go.html#6221780">header</a></span>&nbsp;<span class="op" id="6222210">=</span>&nbsp;<span class="ident" id="6222212"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222214">.</span><span class="ident" id="6222215">paxHdrBuff</span><span class="op" id="6222225">[</span><span class="op" id="6222226">:</span><span class="op" id="6222227">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6222230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6222233">copy</span><span class="op" id="6222237">(</span><span class="ident" id="6222238"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6222244">,</span>&nbsp;<span class="ident" id="6222246"><a href="/archive/tar/common.go.html#6192523">zeroBlock</a></span><span class="op" id="6222255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222258">s</span>&nbsp;<span class="op" id="6222260">:=</span>&nbsp;<span class="ident" id="6222263"><a href="/archive/tar/common.go.html#6193045">slicer</a></span><span class="op" id="6222269">(</span><span class="ident" id="6222270"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6222276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6222280">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;filename&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222408">pathHeaderBytes</span>&nbsp;<span class="op" id="6222424">:=</span>&nbsp;<span class="ident" id="6222427"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6222428">.</span><span class="ident" id="6222429">next</span><span class="op" id="6222433">(</span><span class="ident" id="6222434"><a href="/archive/tar/common.go.html#6187814">fileNameSize</a></span><span class="op" id="6222446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222450"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222452">.</span><span class="ident" id="6222453">cString</span><span class="op" id="6222460">(</span><span class="ident" id="6222461"><a href="/archive/tar/writer.go.html#6222408">pathHeaderBytes</a></span><span class="op" id="6222476">,</span>&nbsp;<span class="ident" id="6222478"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222481">.</span><span class="ident" id="6222482">Name</span><span class="op" id="6222486">,</span>&nbsp;<span class="builtintype" id="6222488">true</span><span class="op" id="6222492">,</span>&nbsp;<span class="ident" id="6222494"><a href="/archive/tar/common.go.html#6190816">paxPath</a></span><span class="op" id="6222501">,</span>&nbsp;<span class="ident" id="6222503"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6222513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6222517">//&nbsp;Handle&nbsp;out&nbsp;of&nbsp;range&nbsp;ModTime&nbsp;carefully.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222560">var</span>&nbsp;<span class="ident" id="6222564">modTime</span>&nbsp;<span class="ident" id="6222572">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6222579">if</span>&nbsp;<span class="op" id="6222582">!</span><span class="ident" id="6222583"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222586">.</span><span class="ident" id="6222587">ModTime</span><span class="op" id="6222594">.</span><span class="ident" id="6222595">Before</span><span class="op" id="6222601">(</span><span class="ident" id="6222602"><a href="/archive/tar/writer.go.html#6220618">minTime</a></span><span class="op" id="6222609">)</span>&nbsp;<span class="op" id="6222611">&amp;&amp;</span>&nbsp;<span class="op" id="6222614">!</span><span class="ident" id="6222615"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222618">.</span><span class="ident" id="6222619">ModTime</span><span class="op" id="6222626">.</span><span class="ident" id="6222627">After</span><span class="op" id="6222632">(</span><span class="ident" id="6222633"><a href="/archive/tar/writer.go.html#6220703">maxTime</a></span><span class="op" id="6222640">)</span>&nbsp;<span class="op" id="6222642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222646"><a href="/archive/tar/writer.go.html#6222564">modTime</a></span>&nbsp;<span class="op" id="6222654">=</span>&nbsp;<span class="ident" id="6222656"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222659">.</span><span class="ident" id="6222660">ModTime</span><span class="op" id="6222667">.</span><span class="ident" id="6222668">Unix</span><span class="op" id="6222672">(</span><span class="op" id="6222673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6222676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222680"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222682">.</span><span class="ident" id="6222683">octal</span><span class="op" id="6222688">(</span><span class="ident" id="6222689"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6222690">.</span><span class="ident" id="6222691">next</span><span class="op" id="6222695">(</span><span class="num" id="6222696">8</span><span class="op" id="6222697">)</span><span class="op" id="6222698">,</span>&nbsp;<span class="ident" id="6222700"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222703">.</span><span class="ident" id="6222704">Mode</span><span class="op" id="6222708">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6222744">//&nbsp;100:108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222756"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222758">.</span><span class="ident" id="6222759">numeric</span><span class="op" id="6222766">(</span><span class="ident" id="6222767"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6222768">.</span><span class="ident" id="6222769">next</span><span class="op" id="6222773">(</span><span class="num" id="6222774">8</span><span class="op" id="6222775">)</span><span class="op" id="6222776">,</span>&nbsp;<span class="ident" id="6222778">int64</span><span class="op" id="6222783">(</span><span class="ident" id="6222784"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222787">.</span><span class="ident" id="6222788">Uid</span><span class="op" id="6222791">)</span><span class="op" id="6222792">,</span>&nbsp;<span class="builtintype" id="6222794">true</span><span class="op" id="6222798">,</span>&nbsp;<span class="ident" id="6222800"><a href="/archive/tar/common.go.html#6190860">paxUid</a></span><span class="op" id="6222806">,</span>&nbsp;<span class="ident" id="6222808"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6222818">)</span>&nbsp;<span class="comment" id="6222820">//&nbsp;108:116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222832"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222834">.</span><span class="ident" id="6222835">numeric</span><span class="op" id="6222842">(</span><span class="ident" id="6222843"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6222844">.</span><span class="ident" id="6222845">next</span><span class="op" id="6222849">(</span><span class="num" id="6222850">8</span><span class="op" id="6222851">)</span><span class="op" id="6222852">,</span>&nbsp;<span class="ident" id="6222854">int64</span><span class="op" id="6222859">(</span><span class="ident" id="6222860"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222863">.</span><span class="ident" id="6222864">Gid</span><span class="op" id="6222867">)</span><span class="op" id="6222868">,</span>&nbsp;<span class="builtintype" id="6222870">true</span><span class="op" id="6222874">,</span>&nbsp;<span class="ident" id="6222876"><a href="/archive/tar/common.go.html#6190723">paxGid</a></span><span class="op" id="6222882">,</span>&nbsp;<span class="ident" id="6222884"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6222894">)</span>&nbsp;<span class="comment" id="6222896">//&nbsp;116:124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222908"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222910">.</span><span class="ident" id="6222911">numeric</span><span class="op" id="6222918">(</span><span class="ident" id="6222919"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6222920">.</span><span class="ident" id="6222921">next</span><span class="op" id="6222925">(</span><span class="num" id="6222926">12</span><span class="op" id="6222928">)</span><span class="op" id="6222929">,</span>&nbsp;<span class="ident" id="6222931"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6222934">.</span><span class="ident" id="6222935">Size</span><span class="op" id="6222939">,</span>&nbsp;<span class="builtintype" id="6222941">true</span><span class="op" id="6222945">,</span>&nbsp;<span class="ident" id="6222947"><a href="/archive/tar/common.go.html#6190838">paxSize</a></span><span class="op" id="6222954">,</span>&nbsp;<span class="ident" id="6222956"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6222966">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6222972">//&nbsp;124:136</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6222984"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6222986">.</span><span class="ident" id="6222987">numeric</span><span class="op" id="6222994">(</span><span class="ident" id="6222995"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6222996">.</span><span class="ident" id="6222997">next</span><span class="op" id="6223001">(</span><span class="num" id="6223002">12</span><span class="op" id="6223004">)</span><span class="op" id="6223005">,</span>&nbsp;<span class="ident" id="6223007"><a href="/archive/tar/writer.go.html#6222564">modTime</a></span><span class="op" id="6223014">,</span>&nbsp;<span class="builtintype" id="6223016">false</span><span class="op" id="6223021">,</span>&nbsp;<span class="ident" id="6223023"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6223030">,</span>&nbsp;<span class="ident" id="6223032">nil</span><span class="op" id="6223035">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6223048">//&nbsp;136:148&nbsp;---&nbsp;consider&nbsp;using&nbsp;pax&nbsp;for&nbsp;finer&nbsp;granularity</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223105"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223106">.</span><span class="ident" id="6223107">next</span><span class="op" id="6223111">(</span><span class="num" id="6223112">8</span><span class="op" id="6223113">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6223169">//&nbsp;chksum&nbsp;(148:156)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223190"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223191">.</span><span class="ident" id="6223192">next</span><span class="op" id="6223196">(</span><span class="num" id="6223197">1</span><span class="op" id="6223198">)</span><span class="op" id="6223199">[</span><span class="num" id="6223200">0</span><span class="op" id="6223201">]</span>&nbsp;<span class="op" id="6223203">=</span>&nbsp;<span class="ident" id="6223205"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6223208">.</span><span class="ident" id="6223209">Typeflag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6223254">//&nbsp;156:157</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223267"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6223269">.</span><span class="ident" id="6223270">cString</span><span class="op" id="6223277">(</span><span class="ident" id="6223278"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223279">.</span><span class="ident" id="6223280">next</span><span class="op" id="6223284">(</span><span class="num" id="6223285">100</span><span class="op" id="6223288">)</span><span class="op" id="6223289">,</span>&nbsp;<span class="ident" id="6223291"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6223294">.</span><span class="ident" id="6223295">Linkname</span><span class="op" id="6223303">,</span>&nbsp;<span class="builtintype" id="6223305">true</span><span class="op" id="6223309">,</span>&nbsp;<span class="ident" id="6223311"><a href="/archive/tar/common.go.html#6190767">paxLinkpath</a></span><span class="op" id="6223322">,</span>&nbsp;<span class="ident" id="6223324"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6223334">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6223338">copy</span><span class="op" id="6223342">(</span><span class="ident" id="6223343"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223344">.</span><span class="ident" id="6223345">next</span><span class="op" id="6223349">(</span><span class="num" id="6223350">8</span><span class="op" id="6223351">)</span><span class="op" id="6223352">,</span>&nbsp;<span class="op" id="6223354">[</span><span class="op" id="6223355">]</span><span class="builtintype" id="6223356">byte</span><span class="op" id="6223360">(</span><span class="string" id="6223361">&#34;ustar\x0000&#34;</span><span class="op" id="6223374">)</span><span class="op" id="6223375">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6223400">//&nbsp;257:265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223412"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6223414">.</span><span class="ident" id="6223415">cString</span><span class="op" id="6223422">(</span><span class="ident" id="6223423"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223424">.</span><span class="ident" id="6223425">next</span><span class="op" id="6223429">(</span><span class="num" id="6223430">32</span><span class="op" id="6223432">)</span><span class="op" id="6223433">,</span>&nbsp;<span class="ident" id="6223435"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6223438">.</span><span class="ident" id="6223439">Uname</span><span class="op" id="6223444">,</span>&nbsp;<span class="builtintype" id="6223446">true</span><span class="op" id="6223450">,</span>&nbsp;<span class="ident" id="6223452"><a href="/archive/tar/common.go.html#6190881">paxUname</a></span><span class="op" id="6223460">,</span>&nbsp;<span class="ident" id="6223462"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6223472">)</span>&nbsp;<span class="comment" id="6223474">//&nbsp;265:297</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223486"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6223488">.</span><span class="ident" id="6223489">cString</span><span class="op" id="6223496">(</span><span class="ident" id="6223497"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223498">.</span><span class="ident" id="6223499">next</span><span class="op" id="6223503">(</span><span class="num" id="6223504">32</span><span class="op" id="6223506">)</span><span class="op" id="6223507">,</span>&nbsp;<span class="ident" id="6223509"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6223512">.</span><span class="ident" id="6223513">Gname</span><span class="op" id="6223518">,</span>&nbsp;<span class="builtintype" id="6223520">true</span><span class="op" id="6223524">,</span>&nbsp;<span class="ident" id="6223526"><a href="/archive/tar/common.go.html#6190744">paxGname</a></span><span class="op" id="6223534">,</span>&nbsp;<span class="ident" id="6223536"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6223546">)</span>&nbsp;<span class="comment" id="6223548">//&nbsp;297:329</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223560"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6223562">.</span><span class="ident" id="6223563">numeric</span><span class="op" id="6223570">(</span><span class="ident" id="6223571"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223572">.</span><span class="ident" id="6223573">next</span><span class="op" id="6223577">(</span><span class="num" id="6223578">8</span><span class="op" id="6223579">)</span><span class="op" id="6223580">,</span>&nbsp;<span class="ident" id="6223582"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6223585">.</span><span class="ident" id="6223586">Devmajor</span><span class="op" id="6223594">,</span>&nbsp;<span class="builtintype" id="6223596">false</span><span class="op" id="6223601">,</span>&nbsp;<span class="ident" id="6223603"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6223610">,</span>&nbsp;<span class="ident" id="6223612">nil</span><span class="op" id="6223615">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6223622">//&nbsp;329:337</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223634"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6223636">.</span><span class="ident" id="6223637">numeric</span><span class="op" id="6223644">(</span><span class="ident" id="6223645"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223646">.</span><span class="ident" id="6223647">next</span><span class="op" id="6223651">(</span><span class="num" id="6223652">8</span><span class="op" id="6223653">)</span><span class="op" id="6223654">,</span>&nbsp;<span class="ident" id="6223656"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6223659">.</span><span class="ident" id="6223660">Devminor</span><span class="op" id="6223668">,</span>&nbsp;<span class="builtintype" id="6223670">false</span><span class="op" id="6223675">,</span>&nbsp;<span class="ident" id="6223677"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6223684">,</span>&nbsp;<span class="ident" id="6223686">nil</span><span class="op" id="6223689">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6223696">//&nbsp;337:345</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6223709">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;prefix&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223835">prefixHeaderBytes</span>&nbsp;<span class="op" id="6223853">:=</span>&nbsp;<span class="ident" id="6223856"><a href="/archive/tar/writer.go.html#6222258">s</a></span><span class="op" id="6223857">.</span><span class="ident" id="6223858">next</span><span class="op" id="6223862">(</span><span class="num" id="6223863">155</span><span class="op" id="6223866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6223869"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6223871">.</span><span class="ident" id="6223872">cString</span><span class="op" id="6223879">(</span><span class="ident" id="6223880"><a href="/archive/tar/writer.go.html#6223835">prefixHeaderBytes</a></span><span class="op" id="6223897">,</span>&nbsp;<span class="string" id="6223899">&#34;&#34;</span><span class="op" id="6223901">,</span>&nbsp;<span class="builtintype" id="6223903">false</span><span class="op" id="6223908">,</span>&nbsp;<span class="ident" id="6223910"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6223917">,</span>&nbsp;<span class="ident" id="6223919">nil</span><span class="op" id="6223922">)</span>&nbsp;<span class="comment" id="6223924">//&nbsp;345:500&nbsp;&nbsp;prefix</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6223945">//&nbsp;Use&nbsp;the&nbsp;GNU&nbsp;magic&nbsp;instead&nbsp;of&nbsp;POSIX&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;any&nbsp;GNU&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6224021">if</span>&nbsp;<span class="ident" id="6224024"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6224026">.</span><span class="ident" id="6224027">usedBinary</span>&nbsp;<span class="op" id="6224038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6224042">copy</span><span class="op" id="6224046">(</span><span class="ident" id="6224047"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6224053">[</span><span class="num" id="6224054">257</span><span class="op" id="6224057">:</span><span class="num" id="6224058">265</span><span class="op" id="6224061">]</span><span class="op" id="6224062">,</span>&nbsp;<span class="op" id="6224064">[</span><span class="op" id="6224065">]</span><span class="builtintype" id="6224066">byte</span><span class="op" id="6224070">(</span><span class="string" id="6224071">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="6224084">)</span><span class="op" id="6224085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6224088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6224092">_</span><span class="op" id="6224093">,</span>&nbsp;<span class="ident" id="6224095">paxPathUsed</span>&nbsp;<span class="op" id="6224107">:=</span>&nbsp;<span class="ident" id="6224110"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6224120">[</span><span class="ident" id="6224121"><a href="/archive/tar/common.go.html#6190816">paxPath</a></span><span class="op" id="6224128">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6224131">//&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;ustar&nbsp;header&nbsp;when&nbsp;only&nbsp;the&nbsp;name&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6224192">if</span>&nbsp;<span class="op" id="6224195">!</span><span class="ident" id="6224196"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6224198">.</span><span class="ident" id="6224199">preferPax</span>&nbsp;<span class="op" id="6224209">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6224212">len</span><span class="op" id="6224215">(</span><span class="ident" id="6224216"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6224226">)</span>&nbsp;<span class="op" id="6224228">==</span>&nbsp;<span class="num" id="6224231">1</span>&nbsp;<span class="op" id="6224233">&amp;&amp;</span>&nbsp;<span class="ident" id="6224236"><a href="/archive/tar/writer.go.html#6224095">paxPathUsed</a></span>&nbsp;<span class="op" id="6224248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6224252">suffix</span>&nbsp;<span class="op" id="6224259">:=</span>&nbsp;<span class="ident" id="6224262"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6224265">.</span><span class="ident" id="6224266">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6224273">prefix</span>&nbsp;<span class="op" id="6224280">:=</span>&nbsp;<span class="string" id="6224283">&#34;&#34;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6224288">if</span>&nbsp;<span class="builtinfunc" id="6224291">len</span><span class="op" id="6224294">(</span><span class="ident" id="6224295"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6224298">.</span><span class="ident" id="6224299">Name</span><span class="op" id="6224303">)</span>&nbsp;<span class="op" id="6224305">&gt;</span>&nbsp;<span class="ident" id="6224307"><a href="/archive/tar/common.go.html#6187814">fileNameSize</a></span>&nbsp;<span class="op" id="6224320">&amp;&amp;</span>&nbsp;<span class="ident" id="6224323"><a href="/archive/tar/common.go.html#6193153">isASCII</a></span><span class="op" id="6224330">(</span><span class="ident" id="6224331"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6224334">.</span><span class="ident" id="6224335">Name</span><span class="op" id="6224339">)</span>&nbsp;<span class="op" id="6224341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6224346">var</span>&nbsp;<span class="ident" id="6224350">err</span>&nbsp;<span class="builtintype" id="6224354">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6224363"><a href="/archive/tar/writer.go.html#6224273">prefix</a></span><span class="op" id="6224369">,</span>&nbsp;<span class="ident" id="6224371"><a href="/archive/tar/writer.go.html#6224252">suffix</a></span><span class="op" id="6224377">,</span>&nbsp;<span class="ident" id="6224379"><a href="/archive/tar/writer.go.html#6224350">err</a></span>&nbsp;<span class="op" id="6224383">=</span>&nbsp;<span class="ident" id="6224385"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6224387">.</span><span class="ident" id="6224388">splitUSTARLongName</span><span class="op" id="6224406">(</span><span class="ident" id="6224407"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6224410">.</span><span class="ident" id="6224411">Name</span><span class="op" id="6224415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6224420">if</span>&nbsp;<span class="ident" id="6224423"><a href="/archive/tar/writer.go.html#6224350">err</a></span>&nbsp;<span class="op" id="6224427">==</span>&nbsp;<span class="ident" id="6224430">nil</span>&nbsp;<span class="op" id="6224434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6224440">//&nbsp;ok&nbsp;we&nbsp;can&nbsp;use&nbsp;a&nbsp;ustar&nbsp;long&nbsp;name&nbsp;instead&nbsp;of&nbsp;pax,&nbsp;now&nbsp;correct&nbsp;the&nbsp;fields</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6224519">//&nbsp;remove&nbsp;the&nbsp;path&nbsp;field&nbsp;from&nbsp;the&nbsp;pax&nbsp;header.&nbsp;this&nbsp;will&nbsp;suppress&nbsp;the&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6224603">delete</span><span class="op" id="6224609">(</span><span class="ident" id="6224610"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6224620">,</span>&nbsp;<span class="ident" id="6224622"><a href="/archive/tar/common.go.html#6190816">paxPath</a></span><span class="op" id="6224629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6224636">//&nbsp;update&nbsp;the&nbsp;path&nbsp;fields</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6224666"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6224668">.</span><span class="ident" id="6224669">cString</span><span class="op" id="6224676">(</span><span class="ident" id="6224677"><a href="/archive/tar/writer.go.html#6222408">pathHeaderBytes</a></span><span class="op" id="6224692">,</span>&nbsp;<span class="ident" id="6224694"><a href="/archive/tar/writer.go.html#6224252">suffix</a></span><span class="op" id="6224700">,</span>&nbsp;<span class="builtintype" id="6224702">false</span><span class="op" id="6224707">,</span>&nbsp;<span class="ident" id="6224709"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6224716">,</span>&nbsp;<span class="ident" id="6224718">nil</span><span class="op" id="6224721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6224727"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6224729">.</span><span class="ident" id="6224730">cString</span><span class="op" id="6224737">(</span><span class="ident" id="6224738"><a href="/archive/tar/writer.go.html#6223835">prefixHeaderBytes</a></span><span class="op" id="6224755">,</span>&nbsp;<span class="ident" id="6224757"><a href="/archive/tar/writer.go.html#6224273">prefix</a></span><span class="op" id="6224763">,</span>&nbsp;<span class="builtintype" id="6224765">false</span><span class="op" id="6224770">,</span>&nbsp;<span class="ident" id="6224772"><a href="/archive/tar/common.go.html#6190935">paxNone</a></span><span class="op" id="6224779">,</span>&nbsp;<span class="ident" id="6224781">nil</span><span class="op" id="6224784">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6224791">//&nbsp;Use&nbsp;the&nbsp;ustar&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;ustar&nbsp;long&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6224847">if</span>&nbsp;<span class="builtinfunc" id="6224850">len</span><span class="op" id="6224853">(</span><span class="ident" id="6224854"><a href="/archive/tar/writer.go.html#6224273">prefix</a></span><span class="op" id="6224860">)</span>&nbsp;<span class="op" id="6224862">&gt;</span>&nbsp;<span class="num" id="6224864">0</span>&nbsp;<span class="op" id="6224866">&amp;&amp;</span>&nbsp;<span class="op" id="6224869">!</span><span class="ident" id="6224870"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6224872">.</span><span class="ident" id="6224873">usedBinary</span>&nbsp;<span class="op" id="6224884">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6224891">copy</span><span class="op" id="6224895">(</span><span class="ident" id="6224896"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6224902">[</span><span class="num" id="6224903">257</span><span class="op" id="6224906">:</span><span class="num" id="6224907">265</span><span class="op" id="6224910">]</span><span class="op" id="6224911">,</span>&nbsp;<span class="op" id="6224913">[</span><span class="op" id="6224914">]</span><span class="builtintype" id="6224915">byte</span><span class="op" id="6224919">(</span><span class="string" id="6224920">&#34;ustar\x00&#34;</span><span class="op" id="6224931">)</span><span class="op" id="6224932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6224938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6224943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6224947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6224950">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6224954">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;NUL&nbsp;and&nbsp;a&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6225011">//&nbsp;This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;other&nbsp;octal&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225062">chksum</span><span class="op" id="6225068">,</span>&nbsp;<span class="ident" id="6225070">_</span>&nbsp;<span class="op" id="6225072">:=</span>&nbsp;<span class="ident" id="6225075"><a href="/archive/tar/common.go.html#6192691">checksum</a></span><span class="op" id="6225083">(</span><span class="ident" id="6225084"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6225090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225093"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225095">.</span><span class="ident" id="6225096">octal</span><span class="op" id="6225101">(</span><span class="ident" id="6225102"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6225108">[</span><span class="num" id="6225109">148</span><span class="op" id="6225112">:</span><span class="num" id="6225113">155</span><span class="op" id="6225116">]</span><span class="op" id="6225117">,</span>&nbsp;<span class="ident" id="6225119"><a href="/archive/tar/writer.go.html#6225062">chksum</a></span><span class="op" id="6225125">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225128"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6225134">[</span><span class="num" id="6225135">155</span><span class="op" id="6225138">]</span>&nbsp;<span class="op" id="6225140">=</span>&nbsp;<span class="string" id="6225142">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225148">if</span>&nbsp;<span class="ident" id="6225151"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225153">.</span><span class="ident" id="6225154">err</span>&nbsp;<span class="op" id="6225158">!=</span>&nbsp;<span class="ident" id="6225161">nil</span>&nbsp;<span class="op" id="6225165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6225169">//&nbsp;problem&nbsp;with&nbsp;header;&nbsp;probably&nbsp;integer&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225233">return</span>&nbsp;<span class="ident" id="6225240"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225242">.</span><span class="ident" id="6225243">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225252">if</span>&nbsp;<span class="ident" id="6225255"><a href="/archive/tar/writer.go.html#6221365">allowPax</a></span>&nbsp;<span class="op" id="6225264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225268">for</span>&nbsp;<span class="ident" id="6225272">k</span><span class="op" id="6225273">,</span>&nbsp;<span class="ident" id="6225275">v</span>&nbsp;<span class="op" id="6225277">:=</span>&nbsp;<span class="keyword" id="6225280">range</span>&nbsp;<span class="ident" id="6225286"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6225289">.</span><span class="ident" id="6225290">Xattrs</span>&nbsp;<span class="op" id="6225297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225302"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6225312">[</span><span class="ident" id="6225313"><a href="/archive/tar/common.go.html#6190904">paxXattr</a></span><span class="op" id="6225321">+</span><span class="ident" id="6225322"><a href="/archive/tar/writer.go.html#6225272">k</a></span><span class="op" id="6225323">]</span>&nbsp;<span class="op" id="6225325">=</span>&nbsp;<span class="ident" id="6225327"><a href="/archive/tar/writer.go.html#6225275">v</a></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225338">if</span>&nbsp;<span class="builtinfunc" id="6225341">len</span><span class="op" id="6225344">(</span><span class="ident" id="6225345"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6225355">)</span>&nbsp;<span class="op" id="6225357">&gt;</span>&nbsp;<span class="num" id="6225359">0</span>&nbsp;<span class="op" id="6225361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225365">if</span>&nbsp;<span class="op" id="6225368">!</span><span class="ident" id="6225369"><a href="/archive/tar/writer.go.html#6221365">allowPax</a></span>&nbsp;<span class="op" id="6225378">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225383">return</span>&nbsp;<span class="ident" id="6225390"><a href="/archive/tar/writer.go.html#6217516">errInvalidHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225413">if</span>&nbsp;<span class="ident" id="6225416">err</span>&nbsp;<span class="op" id="6225420">:=</span>&nbsp;<span class="ident" id="6225423"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225425">.</span><span class="ident" id="6225426">writePAXHeader</span><span class="op" id="6225440">(</span><span class="ident" id="6225441"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6225444">,</span>&nbsp;<span class="ident" id="6225446"><a href="/archive/tar/writer.go.html#6221568">paxHeaders</a></span><span class="op" id="6225456">)</span><span class="op" id="6225457">;</span>&nbsp;<span class="ident" id="6225459"><a href="/archive/tar/writer.go.html#6225416">err</a></span>&nbsp;<span class="op" id="6225463">!=</span>&nbsp;<span class="ident" id="6225466">nil</span>&nbsp;<span class="op" id="6225470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225475">return</span>&nbsp;<span class="ident" id="6225482"><a href="/archive/tar/writer.go.html#6225416">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225488">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6225491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225494"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225496">.</span><span class="ident" id="6225497">nb</span>&nbsp;<span class="op" id="6225500">=</span>&nbsp;<span class="ident" id="6225502">int64</span><span class="op" id="6225507">(</span><span class="ident" id="6225508"><a href="/archive/tar/writer.go.html#6221352">hdr</a></span><span class="op" id="6225511">.</span><span class="ident" id="6225512">Size</span><span class="op" id="6225516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225519"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225521">.</span><span class="ident" id="6225522">pad</span>&nbsp;<span class="op" id="6225526">=</span>&nbsp;<span class="op" id="6225528">(</span><span class="ident" id="6225529"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span>&nbsp;<span class="op" id="6225539">-</span>&nbsp;<span class="op" id="6225541">(</span><span class="ident" id="6225542"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225544">.</span><span class="ident" id="6225545">nb</span>&nbsp;<span class="op" id="6225548">%</span>&nbsp;<span class="ident" id="6225550"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span><span class="op" id="6225559">)</span><span class="op" id="6225560">)</span>&nbsp;<span class="op" id="6225562">%</span>&nbsp;<span class="ident" id="6225564"><a href="/archive/tar/common.go.html#6186250">blockSize</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225576">_</span><span class="op" id="6225577">,</span>&nbsp;<span class="ident" id="6225579"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225581">.</span><span class="ident" id="6225582">err</span>&nbsp;<span class="op" id="6225586">=</span>&nbsp;<span class="ident" id="6225588"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225590">.</span><span class="ident" id="6225591">w</span><span class="op" id="6225592">.</span><span class="ident" id="6225593">Write</span><span class="op" id="6225598">(</span><span class="ident" id="6225599"><a href="/archive/tar/writer.go.html#6221780">header</a></span><span class="op" id="6225605">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225608">return</span>&nbsp;<span class="ident" id="6225615"><a href="/archive/tar/writer.go.html#6221328">tw</a></span><span class="op" id="6225617">.</span><span class="ident" id="6225618">err</span><br>
<span class="lineno"></span><span class="op" id="6225622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6225625">//&nbsp;writeUSTARLongName&nbsp;splits&nbsp;a&nbsp;USTAR&nbsp;long&nbsp;name&nbsp;hdr.Name.</span><br>
<span class="lineno"></span><span class="comment" id="6225682">//&nbsp;name&nbsp;must&nbsp;be&nbsp;&lt;&nbsp;256&nbsp;characters.&nbsp;errNameTooLong&nbsp;is&nbsp;returned</span><br>
<span class="lineno">275</span><span class="comment" id="6225743">//&nbsp;if&nbsp;hdr.Name&nbsp;can&#39;t&nbsp;be&nbsp;split.&nbsp;The&nbsp;splitting&nbsp;heuristic</span><br>
<span class="lineno"></span><span class="comment" id="6225798">//&nbsp;is&nbsp;compatible&nbsp;with&nbsp;gnu&nbsp;tar.</span><br>
<span class="lineno"></span><span class="keyword" id="6225829">func</span>&nbsp;<span class="op" id="6225834">(</span><span class="ident" id="6225835">tw</span>&nbsp;<span class="op" id="6225838">*</span><span class="ident" id="6225839"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6225845">)</span>&nbsp;<span class="ident" id="6225847">splitUSTARLongName</span><span class="op" id="6225865">(</span><span class="ident" id="6225866">name</span>&nbsp;<span class="builtintype" id="6225871">string</span><span class="op" id="6225877">)</span>&nbsp;<span class="op" id="6225879">(</span><span class="ident" id="6225880">prefix</span><span class="op" id="6225886">,</span>&nbsp;<span class="ident" id="6225888">suffix</span>&nbsp;<span class="builtintype" id="6225895">string</span><span class="op" id="6225901">,</span>&nbsp;<span class="ident" id="6225903">err</span>&nbsp;<span class="builtintype" id="6225907">error</span><span class="op" id="6225912">)</span>&nbsp;<span class="op" id="6225914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225917">length</span>&nbsp;<span class="op" id="6225924">:=</span>&nbsp;<span class="builtinfunc" id="6225927">len</span><span class="op" id="6225930">(</span><span class="ident" id="6225931"><a href="/archive/tar/writer.go.html#6225866">name</a></span><span class="op" id="6225935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6225938">if</span>&nbsp;<span class="ident" id="6225941"><a href="/archive/tar/writer.go.html#6225917">length</a></span>&nbsp;<span class="op" id="6225948">&gt;</span>&nbsp;<span class="ident" id="6225950"><a href="/archive/tar/common.go.html#6187891">fileNamePrefixSize</a></span><span class="op" id="6225968">+</span><span class="num" id="6225969">1</span>&nbsp;<span class="op" id="6225971">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6225975"><a href="/archive/tar/writer.go.html#6225917">length</a></span>&nbsp;<span class="op" id="6225982">=</span>&nbsp;<span class="ident" id="6225984"><a href="/archive/tar/common.go.html#6187891">fileNamePrefixSize</a></span>&nbsp;<span class="op" id="6226003">+</span>&nbsp;<span class="num" id="6226005">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6226008">}</span>&nbsp;<span class="keyword" id="6226010">else</span>&nbsp;<span class="keyword" id="6226015">if</span>&nbsp;<span class="ident" id="6226018"><a href="/archive/tar/writer.go.html#6225866">name</a></span><span class="op" id="6226022">[</span><span class="ident" id="6226023"><a href="/archive/tar/writer.go.html#6225917">length</a></span><span class="op" id="6226029">-</span><span class="num" id="6226030">1</span><span class="op" id="6226031">]</span>&nbsp;<span class="op" id="6226033">==</span>&nbsp;<span class="string" id="6226036">&#39;/&#39;</span>&nbsp;<span class="op" id="6226040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226044"><a href="/archive/tar/writer.go.html#6225917">length</a></span><span class="op" id="6226050">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6226054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226057">i</span>&nbsp;<span class="op" id="6226059">:=</span>&nbsp;<span class="ident" id="6226062"><a href="/archive/tar/writer.go.html#6217223">strings</a></span><span class="op" id="6226069">.</span><span class="ident" id="6226070">LastIndex</span><span class="op" id="6226079">(</span><span class="ident" id="6226080"><a href="/archive/tar/writer.go.html#6225866">name</a></span><span class="op" id="6226084">[</span><span class="op" id="6226085">:</span><span class="ident" id="6226086"><a href="/archive/tar/writer.go.html#6225917">length</a></span><span class="op" id="6226092">]</span><span class="op" id="6226093">,</span>&nbsp;<span class="string" id="6226095">&#34;/&#34;</span><span class="op" id="6226098">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226101">//&nbsp;nlen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;name&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226159">//&nbsp;plen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;prefix&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226219">nlen</span>&nbsp;<span class="op" id="6226224">:=</span>&nbsp;<span class="builtinfunc" id="6226227">len</span><span class="op" id="6226230">(</span><span class="ident" id="6226231"><a href="/archive/tar/writer.go.html#6225866">name</a></span><span class="op" id="6226235">)</span>&nbsp;<span class="op" id="6226237">-</span>&nbsp;<span class="ident" id="6226239"><a href="/archive/tar/writer.go.html#6226057">i</a></span>&nbsp;<span class="op" id="6226241">-</span>&nbsp;<span class="num" id="6226243">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226246">plen</span>&nbsp;<span class="op" id="6226251">:=</span>&nbsp;<span class="ident" id="6226254"><a href="/archive/tar/writer.go.html#6226057">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6226257">if</span>&nbsp;<span class="ident" id="6226260"><a href="/archive/tar/writer.go.html#6226057">i</a></span>&nbsp;<span class="op" id="6226262">&lt;=</span>&nbsp;<span class="num" id="6226265">0</span>&nbsp;<span class="op" id="6226267">||</span>&nbsp;<span class="ident" id="6226270"><a href="/archive/tar/writer.go.html#6226219">nlen</a></span>&nbsp;<span class="op" id="6226275">&gt;</span>&nbsp;<span class="ident" id="6226277"><a href="/archive/tar/common.go.html#6187814">fileNameSize</a></span>&nbsp;<span class="op" id="6226290">||</span>&nbsp;<span class="ident" id="6226293"><a href="/archive/tar/writer.go.html#6226219">nlen</a></span>&nbsp;<span class="op" id="6226298">==</span>&nbsp;<span class="num" id="6226301">0</span>&nbsp;<span class="op" id="6226303">||</span>&nbsp;<span class="ident" id="6226306"><a href="/archive/tar/writer.go.html#6226246">plen</a></span>&nbsp;<span class="op" id="6226311">&gt;</span>&nbsp;<span class="ident" id="6226313"><a href="/archive/tar/common.go.html#6187891">fileNamePrefixSize</a></span>&nbsp;<span class="op" id="6226332">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226336"><a href="/archive/tar/writer.go.html#6225903">err</a></span>&nbsp;<span class="op" id="6226340">=</span>&nbsp;<span class="ident" id="6226342"><a href="/archive/tar/writer.go.html#6217453">errNameTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6226359">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6226367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226370"><a href="/archive/tar/writer.go.html#6225880">prefix</a></span><span class="op" id="6226376">,</span>&nbsp;<span class="ident" id="6226378"><a href="/archive/tar/writer.go.html#6225888">suffix</a></span>&nbsp;<span class="op" id="6226385">=</span>&nbsp;<span class="ident" id="6226387"><a href="/archive/tar/writer.go.html#6225866">name</a></span><span class="op" id="6226391">[</span><span class="op" id="6226392">:</span><span class="ident" id="6226393"><a href="/archive/tar/writer.go.html#6226057">i</a></span><span class="op" id="6226394">]</span><span class="op" id="6226395">,</span>&nbsp;<span class="ident" id="6226397"><a href="/archive/tar/writer.go.html#6225866">name</a></span><span class="op" id="6226401">[</span><span class="ident" id="6226402"><a href="/archive/tar/writer.go.html#6226057">i</a></span><span class="op" id="6226403">+</span><span class="num" id="6226404">1</span><span class="op" id="6226405">:</span><span class="op" id="6226406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6226409">return</span><br>
<span class="lineno">295</span><span class="op" id="6226416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6226419">//&nbsp;writePaxHeader&nbsp;writes&nbsp;an&nbsp;extended&nbsp;pax&nbsp;header&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6226474">//&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="6226486">func</span>&nbsp;<span class="op" id="6226491">(</span><span class="ident" id="6226492">tw</span>&nbsp;<span class="op" id="6226495">*</span><span class="ident" id="6226496"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6226502">)</span>&nbsp;<span class="ident" id="6226504">writePAXHeader</span><span class="op" id="6226518">(</span><span class="ident" id="6226519">hdr</span>&nbsp;<span class="op" id="6226523">*</span><span class="ident" id="6226524"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6226530">,</span>&nbsp;<span class="ident" id="6226532">paxHeaders</span>&nbsp;<span class="keyword" id="6226543">map</span><span class="op" id="6226546">[</span><span class="builtintype" id="6226547">string</span><span class="op" id="6226553">]</span><span class="builtintype" id="6226554">string</span><span class="op" id="6226560">)</span>&nbsp;<span class="builtintype" id="6226562">error</span>&nbsp;<span class="op" id="6226568">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226571">//&nbsp;Prepare&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226599">ext</span>&nbsp;<span class="op" id="6226603">:=</span>&nbsp;<span class="builtinfunc" id="6226606">new</span><span class="op" id="6226609">(</span><span class="ident" id="6226610"><a href="/archive/tar/common.go.html#6187053">Header</a></span><span class="op" id="6226616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226619"><a href="/archive/tar/writer.go.html#6226599">ext</a></span><span class="op" id="6226622">.</span><span class="ident" id="6226623">Typeflag</span>&nbsp;<span class="op" id="6226632">=</span>&nbsp;<span class="ident" id="6226634"><a href="/archive/tar/common.go.html#6186676">TypeXHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226647">//&nbsp;Setting&nbsp;ModTime&nbsp;is&nbsp;required&nbsp;for&nbsp;reader&nbsp;parsing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226701">//&nbsp;succeed,&nbsp;and&nbsp;seems&nbsp;harmless&nbsp;enough.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226741"><a href="/archive/tar/writer.go.html#6226599">ext</a></span><span class="op" id="6226744">.</span><span class="ident" id="6226745">ModTime</span>&nbsp;<span class="op" id="6226753">=</span>&nbsp;<span class="ident" id="6226755"><a href="/archive/tar/writer.go.html#6226519">hdr</a></span><span class="op" id="6226758">.</span><span class="ident" id="6226759">ModTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226768">//&nbsp;The&nbsp;spec&nbsp;asks&nbsp;that&nbsp;we&nbsp;namespace&nbsp;our&nbsp;pseudo&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6226821">//&nbsp;with&nbsp;the&nbsp;current&nbsp;pid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226847">pid</span>&nbsp;<span class="op" id="6226851">:=</span>&nbsp;<span class="ident" id="6226854"><a href="/archive/tar/writer.go.html#6217198">os</a></span><span class="op" id="6226856">.</span><span class="ident" id="6226857">Getpid</span><span class="op" id="6226863">(</span><span class="op" id="6226864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226867">dir</span><span class="op" id="6226870">,</span>&nbsp;<span class="ident" id="6226872">file</span>&nbsp;<span class="op" id="6226877">:=</span>&nbsp;<span class="ident" id="6226880"><a href="/archive/tar/writer.go.html#6217204">path</a></span><span class="op" id="6226884">.</span><span class="ident" id="6226885">Split</span><span class="op" id="6226890">(</span><span class="ident" id="6226891"><a href="/archive/tar/writer.go.html#6226519">hdr</a></span><span class="op" id="6226894">.</span><span class="ident" id="6226895">Name</span><span class="op" id="6226899">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226902">fullName</span>&nbsp;<span class="op" id="6226911">:=</span>&nbsp;<span class="ident" id="6226914"><a href="/archive/tar/writer.go.html#6217204">path</a></span><span class="op" id="6226918">.</span><span class="ident" id="6226919">Join</span><span class="op" id="6226923">(</span><span class="ident" id="6226924"><a href="/archive/tar/writer.go.html#6226867">dir</a></span><span class="op" id="6226927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226931"><a href="/archive/tar/writer.go.html#6217185">fmt</a></span><span class="op" id="6226934">.</span><span class="ident" id="6226935">Sprintf</span><span class="op" id="6226942">(</span><span class="string" id="6226943">&#34;PaxHeaders.%d&#34;</span><span class="op" id="6226958">,</span>&nbsp;<span class="ident" id="6226960"><a href="/archive/tar/writer.go.html#6226847">pid</a></span><span class="op" id="6226963">)</span><span class="op" id="6226964">,</span>&nbsp;<span class="ident" id="6226966"><a href="/archive/tar/writer.go.html#6226872">file</a></span><span class="op" id="6226970">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6226974">ascii</span>&nbsp;<span class="op" id="6226980">:=</span>&nbsp;<span class="ident" id="6226983"><a href="/archive/tar/common.go.html#6193262">toASCII</a></span><span class="op" id="6226990">(</span><span class="ident" id="6226991"><a href="/archive/tar/writer.go.html#6226902">fullName</a></span><span class="op" id="6226999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227002">if</span>&nbsp;<span class="builtinfunc" id="6227005">len</span><span class="op" id="6227008">(</span><span class="ident" id="6227009"><a href="/archive/tar/writer.go.html#6226974">ascii</a></span><span class="op" id="6227014">)</span>&nbsp;<span class="op" id="6227016">&gt;</span>&nbsp;<span class="num" id="6227018">100</span>&nbsp;<span class="op" id="6227022">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227026"><a href="/archive/tar/writer.go.html#6226974">ascii</a></span>&nbsp;<span class="op" id="6227032">=</span>&nbsp;<span class="ident" id="6227034"><a href="/archive/tar/writer.go.html#6226974">ascii</a></span><span class="op" id="6227039">[</span><span class="op" id="6227040">:</span><span class="num" id="6227041">100</span><span class="op" id="6227044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6227047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227050"><a href="/archive/tar/writer.go.html#6226599">ext</a></span><span class="op" id="6227053">.</span><span class="ident" id="6227054">Name</span>&nbsp;<span class="op" id="6227059">=</span>&nbsp;<span class="ident" id="6227061"><a href="/archive/tar/writer.go.html#6226974">ascii</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6227068">//&nbsp;Construct&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227091">var</span>&nbsp;<span class="ident" id="6227095">buf</span>&nbsp;<span class="ident" id="6227099"><a href="/archive/tar/writer.go.html#6217166">bytes</a></span><span class="op" id="6227104">.</span><span class="ident" id="6227105">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227114">for</span>&nbsp;<span class="ident" id="6227118">k</span><span class="op" id="6227119">,</span>&nbsp;<span class="ident" id="6227121">v</span>&nbsp;<span class="op" id="6227123">:=</span>&nbsp;<span class="keyword" id="6227126">range</span>&nbsp;<span class="ident" id="6227132"><a href="/archive/tar/writer.go.html#6226532">paxHeaders</a></span>&nbsp;<span class="op" id="6227143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227147"><a href="/archive/tar/writer.go.html#6217185">fmt</a></span><span class="op" id="6227150">.</span><span class="ident" id="6227151">Fprint</span><span class="op" id="6227157">(</span><span class="op" id="6227158">&amp;</span><span class="ident" id="6227159"><a href="/archive/tar/writer.go.html#6227095">buf</a></span><span class="op" id="6227162">,</span>&nbsp;<span class="ident" id="6227164"><a href="/archive/tar/writer.go.html#6227513">paxHeader</a></span><span class="op" id="6227173">(</span><span class="ident" id="6227174"><a href="/archive/tar/writer.go.html#6227118">k</a></span><span class="op" id="6227175">+</span><span class="string" id="6227176">&#34;=&#34;</span><span class="op" id="6227179">+</span><span class="ident" id="6227180"><a href="/archive/tar/writer.go.html#6227121">v</a></span><span class="op" id="6227181">)</span><span class="op" id="6227182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6227185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227189"><a href="/archive/tar/writer.go.html#6226599">ext</a></span><span class="op" id="6227192">.</span><span class="ident" id="6227193">Size</span>&nbsp;<span class="op" id="6227198">=</span>&nbsp;<span class="ident" id="6227200">int64</span><span class="op" id="6227205">(</span><span class="builtinfunc" id="6227206">len</span><span class="op" id="6227209">(</span><span class="ident" id="6227210"><a href="/archive/tar/writer.go.html#6227095">buf</a></span><span class="op" id="6227213">.</span><span class="ident" id="6227214">Bytes</span><span class="op" id="6227219">(</span><span class="op" id="6227220">)</span><span class="op" id="6227221">)</span><span class="op" id="6227222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227225">if</span>&nbsp;<span class="ident" id="6227228">err</span>&nbsp;<span class="op" id="6227232">:=</span>&nbsp;<span class="ident" id="6227235"><a href="/archive/tar/writer.go.html#6226492">tw</a></span><span class="op" id="6227237">.</span><span class="ident" id="6227238">writeHeader</span><span class="op" id="6227249">(</span><span class="ident" id="6227250"><a href="/archive/tar/writer.go.html#6226599">ext</a></span><span class="op" id="6227253">,</span>&nbsp;<span class="builtintype" id="6227255">false</span><span class="op" id="6227260">)</span><span class="op" id="6227261">;</span>&nbsp;<span class="ident" id="6227263"><a href="/archive/tar/writer.go.html#6227228">err</a></span>&nbsp;<span class="op" id="6227267">!=</span>&nbsp;<span class="ident" id="6227270">nil</span>&nbsp;<span class="op" id="6227274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227278">return</span>&nbsp;<span class="ident" id="6227285"><a href="/archive/tar/writer.go.html#6227228">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6227290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227293">if</span>&nbsp;<span class="ident" id="6227296">_</span><span class="op" id="6227297">,</span>&nbsp;<span class="ident" id="6227299">err</span>&nbsp;<span class="op" id="6227303">:=</span>&nbsp;<span class="ident" id="6227306"><a href="/archive/tar/writer.go.html#6226492">tw</a></span><span class="op" id="6227308">.</span><span class="ident" id="6227309">Write</span><span class="op" id="6227314">(</span><span class="ident" id="6227315"><a href="/archive/tar/writer.go.html#6227095">buf</a></span><span class="op" id="6227318">.</span><span class="ident" id="6227319">Bytes</span><span class="op" id="6227324">(</span><span class="op" id="6227325">)</span><span class="op" id="6227326">)</span><span class="op" id="6227327">;</span>&nbsp;<span class="ident" id="6227329"><a href="/archive/tar/writer.go.html#6227299">err</a></span>&nbsp;<span class="op" id="6227333">!=</span>&nbsp;<span class="ident" id="6227336">nil</span>&nbsp;<span class="op" id="6227340">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227344">return</span>&nbsp;<span class="ident" id="6227351"><a href="/archive/tar/writer.go.html#6227299">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6227356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227359">if</span>&nbsp;<span class="ident" id="6227362">err</span>&nbsp;<span class="op" id="6227366">:=</span>&nbsp;<span class="ident" id="6227369"><a href="/archive/tar/writer.go.html#6226492">tw</a></span><span class="op" id="6227371">.</span><span class="ident" id="6227372">Flush</span><span class="op" id="6227377">(</span><span class="op" id="6227378">)</span><span class="op" id="6227379">;</span>&nbsp;<span class="ident" id="6227381"><a href="/archive/tar/writer.go.html#6227362">err</a></span>&nbsp;<span class="op" id="6227385">!=</span>&nbsp;<span class="ident" id="6227388">nil</span>&nbsp;<span class="op" id="6227392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227396">return</span>&nbsp;<span class="ident" id="6227403"><a href="/archive/tar/writer.go.html#6227362">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6227408">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227411">return</span>&nbsp;<span class="ident" id="6227418">nil</span><br>
<span class="lineno"></span><span class="op" id="6227422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6227425">//&nbsp;paxHeader&nbsp;formats&nbsp;a&nbsp;single&nbsp;pax&nbsp;record,&nbsp;prefixing&nbsp;it&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="6227508">func</span>&nbsp;<span class="ident" id="6227513">paxHeader</span><span class="op" id="6227522">(</span><span class="ident" id="6227523">msg</span>&nbsp;<span class="builtintype" id="6227527">string</span><span class="op" id="6227533">)</span>&nbsp;<span class="builtintype" id="6227535">string</span>&nbsp;<span class="op" id="6227542">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227545">const</span>&nbsp;<span class="ident" id="6227551">padding</span>&nbsp;<span class="op" id="6227559">=</span>&nbsp;<span class="num" id="6227561">2</span>&nbsp;<span class="comment" id="6227563">//&nbsp;Extra&nbsp;padding&nbsp;for&nbsp;space&nbsp;and&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227603">size</span>&nbsp;<span class="op" id="6227608">:=</span>&nbsp;<span class="builtinfunc" id="6227611">len</span><span class="op" id="6227614">(</span><span class="ident" id="6227615"><a href="/archive/tar/writer.go.html#6227523">msg</a></span><span class="op" id="6227618">)</span>&nbsp;<span class="op" id="6227620">+</span>&nbsp;<span class="ident" id="6227622"><a href="/archive/tar/writer.go.html#6227551">padding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227631"><a href="/archive/tar/writer.go.html#6227603">size</a></span>&nbsp;<span class="op" id="6227636">+=</span>&nbsp;<span class="builtinfunc" id="6227639">len</span><span class="op" id="6227642">(</span><span class="ident" id="6227643"><a href="/archive/tar/writer.go.html#6217212">strconv</a></span><span class="op" id="6227650">.</span><span class="ident" id="6227651">Itoa</span><span class="op" id="6227655">(</span><span class="ident" id="6227656"><a href="/archive/tar/writer.go.html#6227603">size</a></span><span class="op" id="6227660">)</span><span class="op" id="6227661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227664">record</span>&nbsp;<span class="op" id="6227671">:=</span>&nbsp;<span class="ident" id="6227674"><a href="/archive/tar/writer.go.html#6217185">fmt</a></span><span class="op" id="6227677">.</span><span class="ident" id="6227678">Sprintf</span><span class="op" id="6227685">(</span><span class="string" id="6227686">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6227695">,</span>&nbsp;<span class="ident" id="6227697"><a href="/archive/tar/writer.go.html#6227603">size</a></span><span class="op" id="6227701">,</span>&nbsp;<span class="ident" id="6227703"><a href="/archive/tar/writer.go.html#6227523">msg</a></span><span class="op" id="6227706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227709">if</span>&nbsp;<span class="builtinfunc" id="6227712">len</span><span class="op" id="6227715">(</span><span class="ident" id="6227716"><a href="/archive/tar/writer.go.html#6227664">record</a></span><span class="op" id="6227722">)</span>&nbsp;<span class="op" id="6227724">!=</span>&nbsp;<span class="ident" id="6227727"><a href="/archive/tar/writer.go.html#6227603">size</a></span>&nbsp;<span class="op" id="6227732">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6227736">//&nbsp;Final&nbsp;adjustment&nbsp;if&nbsp;adding&nbsp;size&nbsp;increased</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6227783">//&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227817"><a href="/archive/tar/writer.go.html#6227603">size</a></span>&nbsp;<span class="op" id="6227822">=</span>&nbsp;<span class="builtinfunc" id="6227824">len</span><span class="op" id="6227827">(</span><span class="ident" id="6227828"><a href="/archive/tar/writer.go.html#6227664">record</a></span><span class="op" id="6227834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6227838"><a href="/archive/tar/writer.go.html#6227664">record</a></span>&nbsp;<span class="op" id="6227845">=</span>&nbsp;<span class="ident" id="6227847"><a href="/archive/tar/writer.go.html#6217185">fmt</a></span><span class="op" id="6227850">.</span><span class="ident" id="6227851">Sprintf</span><span class="op" id="6227858">(</span><span class="string" id="6227859">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="6227868">,</span>&nbsp;<span class="ident" id="6227870"><a href="/archive/tar/writer.go.html#6227603">size</a></span><span class="op" id="6227874">,</span>&nbsp;<span class="ident" id="6227876"><a href="/archive/tar/writer.go.html#6227523">msg</a></span><span class="op" id="6227879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6227882">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6227885">return</span>&nbsp;<span class="ident" id="6227892"><a href="/archive/tar/writer.go.html#6227664">record</a></span><br>
<span class="lineno"></span><span class="op" id="6227899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6227902">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="6227959">//&nbsp;Write&nbsp;returns&nbsp;the&nbsp;error&nbsp;ErrWriteTooLong&nbsp;if&nbsp;more&nbsp;than</span><br>
<span class="lineno">355</span><span class="comment" id="6228015">//&nbsp;hdr.Size&nbsp;bytes&nbsp;are&nbsp;written&nbsp;after&nbsp;WriteHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="6228064">func</span>&nbsp;<span class="op" id="6228069">(</span><span class="ident" id="6228070">tw</span>&nbsp;<span class="op" id="6228073">*</span><span class="ident" id="6228074"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6228080">)</span>&nbsp;<span class="ident" id="6228082">Write</span><span class="op" id="6228087">(</span><span class="ident" id="6228088">b</span>&nbsp;<span class="op" id="6228090">[</span><span class="op" id="6228091">]</span><span class="builtintype" id="6228092">byte</span><span class="op" id="6228096">)</span>&nbsp;<span class="op" id="6228098">(</span><span class="ident" id="6228099">n</span>&nbsp;<span class="builtintype" id="6228101">int</span><span class="op" id="6228104">,</span>&nbsp;<span class="ident" id="6228106">err</span>&nbsp;<span class="builtintype" id="6228110">error</span><span class="op" id="6228115">)</span>&nbsp;<span class="op" id="6228117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228120">if</span>&nbsp;<span class="ident" id="6228123"><a href="/archive/tar/writer.go.html#6228070">tw</a></span><span class="op" id="6228125">.</span><span class="ident" id="6228126">closed</span>&nbsp;<span class="op" id="6228133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228137"><a href="/archive/tar/writer.go.html#6228106">err</a></span>&nbsp;<span class="op" id="6228141">=</span>&nbsp;<span class="ident" id="6228143"><a href="/archive/tar/writer.go.html#6217251">ErrWriteTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228161">return</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228172">overwrite</span>&nbsp;<span class="op" id="6228182">:=</span>&nbsp;<span class="builtintype" id="6228185">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228192">if</span>&nbsp;<span class="ident" id="6228195">int64</span><span class="op" id="6228200">(</span><span class="builtinfunc" id="6228201">len</span><span class="op" id="6228204">(</span><span class="ident" id="6228205"><a href="/archive/tar/writer.go.html#6228088">b</a></span><span class="op" id="6228206">)</span><span class="op" id="6228207">)</span>&nbsp;<span class="op" id="6228209">&gt;</span>&nbsp;<span class="ident" id="6228211"><a href="/archive/tar/writer.go.html#6228070">tw</a></span><span class="op" id="6228213">.</span><span class="ident" id="6228214">nb</span>&nbsp;<span class="op" id="6228217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228221"><a href="/archive/tar/writer.go.html#6228088">b</a></span>&nbsp;<span class="op" id="6228223">=</span>&nbsp;<span class="ident" id="6228225"><a href="/archive/tar/writer.go.html#6228088">b</a></span><span class="op" id="6228226">[</span><span class="num" id="6228227">0</span><span class="op" id="6228228">:</span><span class="ident" id="6228229"><a href="/archive/tar/writer.go.html#6228070">tw</a></span><span class="op" id="6228231">.</span><span class="ident" id="6228232">nb</span><span class="op" id="6228234">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228238"><a href="/archive/tar/writer.go.html#6228172">overwrite</a></span>&nbsp;<span class="op" id="6228248">=</span>&nbsp;<span class="builtintype" id="6228250">true</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228259"><a href="/archive/tar/writer.go.html#6228099">n</a></span><span class="op" id="6228260">,</span>&nbsp;<span class="ident" id="6228262"><a href="/archive/tar/writer.go.html#6228106">err</a></span>&nbsp;<span class="op" id="6228266">=</span>&nbsp;<span class="ident" id="6228268"><a href="/archive/tar/writer.go.html#6228070">tw</a></span><span class="op" id="6228270">.</span><span class="ident" id="6228271">w</span><span class="op" id="6228272">.</span><span class="ident" id="6228273">Write</span><span class="op" id="6228278">(</span><span class="ident" id="6228279"><a href="/archive/tar/writer.go.html#6228088">b</a></span><span class="op" id="6228280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228283"><a href="/archive/tar/writer.go.html#6228070">tw</a></span><span class="op" id="6228285">.</span><span class="ident" id="6228286">nb</span>&nbsp;<span class="op" id="6228289">-=</span>&nbsp;<span class="ident" id="6228292">int64</span><span class="op" id="6228297">(</span><span class="ident" id="6228298"><a href="/archive/tar/writer.go.html#6228099">n</a></span><span class="op" id="6228299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228302">if</span>&nbsp;<span class="ident" id="6228305"><a href="/archive/tar/writer.go.html#6228106">err</a></span>&nbsp;<span class="op" id="6228309">==</span>&nbsp;<span class="ident" id="6228312">nil</span>&nbsp;<span class="op" id="6228316">&amp;&amp;</span>&nbsp;<span class="ident" id="6228319"><a href="/archive/tar/writer.go.html#6228172">overwrite</a></span>&nbsp;<span class="op" id="6228329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228333"><a href="/archive/tar/writer.go.html#6228106">err</a></span>&nbsp;<span class="op" id="6228337">=</span>&nbsp;<span class="ident" id="6228339"><a href="/archive/tar/writer.go.html#6217251">ErrWriteTooLong</a></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228357">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228368"><a href="/archive/tar/writer.go.html#6228070">tw</a></span><span class="op" id="6228370">.</span><span class="ident" id="6228371">err</span>&nbsp;<span class="op" id="6228375">=</span>&nbsp;<span class="ident" id="6228377"><a href="/archive/tar/writer.go.html#6228106">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228382">return</span><br>
<span class="lineno"></span><span class="op" id="6228389">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6228392">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;flushing&nbsp;any&nbsp;unwritten</span><br>
<span class="lineno"></span><span class="comment" id="6228448">//&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6228482">func</span>&nbsp;<span class="op" id="6228487">(</span><span class="ident" id="6228488">tw</span>&nbsp;<span class="op" id="6228491">*</span><span class="ident" id="6228492"><a href="/archive/tar/writer.go.html#6217880">Writer</a></span><span class="op" id="6228498">)</span>&nbsp;<span class="ident" id="6228500">Close</span><span class="op" id="6228505">(</span><span class="op" id="6228506">)</span>&nbsp;<span class="builtintype" id="6228508">error</span>&nbsp;<span class="op" id="6228514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228517">if</span>&nbsp;<span class="ident" id="6228520"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228522">.</span><span class="ident" id="6228523">err</span>&nbsp;<span class="op" id="6228527">!=</span>&nbsp;<span class="ident" id="6228530">nil</span>&nbsp;<span class="op" id="6228534">||</span>&nbsp;<span class="ident" id="6228537"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228539">.</span><span class="ident" id="6228540">closed</span>&nbsp;<span class="op" id="6228547">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228551">return</span>&nbsp;<span class="ident" id="6228558"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228560">.</span><span class="ident" id="6228561">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228569"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228571">.</span><span class="ident" id="6228572">Flush</span><span class="op" id="6228577">(</span><span class="op" id="6228578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228581"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228583">.</span><span class="ident" id="6228584">closed</span>&nbsp;<span class="op" id="6228591">=</span>&nbsp;<span class="builtintype" id="6228593">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228599">if</span>&nbsp;<span class="ident" id="6228602"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228604">.</span><span class="ident" id="6228605">err</span>&nbsp;<span class="op" id="6228609">!=</span>&nbsp;<span class="ident" id="6228612">nil</span>&nbsp;<span class="op" id="6228616">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228620">return</span>&nbsp;<span class="ident" id="6228627"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228629">.</span><span class="ident" id="6228630">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6228639">//&nbsp;trailer:&nbsp;two&nbsp;zero&nbsp;blocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228668">for</span>&nbsp;<span class="ident" id="6228672">i</span>&nbsp;<span class="op" id="6228674">:=</span>&nbsp;<span class="num" id="6228677">0</span><span class="op" id="6228678">;</span>&nbsp;<span class="ident" id="6228680"><a href="/archive/tar/writer.go.html#6228672">i</a></span>&nbsp;<span class="op" id="6228682">&lt;</span>&nbsp;<span class="num" id="6228684">2</span><span class="op" id="6228685">;</span>&nbsp;<span class="ident" id="6228687"><a href="/archive/tar/writer.go.html#6228672">i</a></span><span class="op" id="6228688">++</span>&nbsp;<span class="op" id="6228691">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6228695">_</span><span class="op" id="6228696">,</span>&nbsp;<span class="ident" id="6228698"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228700">.</span><span class="ident" id="6228701">err</span>&nbsp;<span class="op" id="6228705">=</span>&nbsp;<span class="ident" id="6228707"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228709">.</span><span class="ident" id="6228710">w</span><span class="op" id="6228711">.</span><span class="ident" id="6228712">Write</span><span class="op" id="6228717">(</span><span class="ident" id="6228718"><a href="/archive/tar/common.go.html#6192523">zeroBlock</a></span><span class="op" id="6228727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228731">if</span>&nbsp;<span class="ident" id="6228734"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228736">.</span><span class="ident" id="6228737">err</span>&nbsp;<span class="op" id="6228741">!=</span>&nbsp;<span class="ident" id="6228744">nil</span>&nbsp;<span class="op" id="6228748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228753">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6228764">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6228767">return</span>&nbsp;<span class="ident" id="6228774"><a href="/archive/tar/writer.go.html#6228488">tw</a></span><span class="op" id="6228776">.</span><span class="ident" id="6228777">err</span><br>
<span class="lineno"></span><span class="op" id="6228781">}</span>
</div>
</body>
</html>
