<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html" class="current">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1801558">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1801613">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1801667">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1801718">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1801796">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1801881">package</span>&nbsp;<span class="ident" id="1801889">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1801895">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1801952">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1802007">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1802083">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1802123">const</span>&nbsp;<span class="op" id="1802129">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802132">RuneError</span>&nbsp;<span class="op" id="1802142">=</span>&nbsp;<span class="string" id="1802144">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1802157">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802213">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1802223">=</span>&nbsp;<span class="num" id="1802225">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1802238">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802316">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1802326">=</span>&nbsp;<span class="string" id="1802328">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1802341">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802379">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1802389">=</span>&nbsp;<span class="num" id="1802391">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1802404">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1802469">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1802472">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1802535">const</span>&nbsp;<span class="op" id="1802541">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802544">surrogateMin</span>&nbsp;<span class="op" id="1802557">=</span>&nbsp;<span class="num" id="1802559">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802567">surrogateMax</span>&nbsp;<span class="op" id="1802580">=</span>&nbsp;<span class="num" id="1802582">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1802589">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1802592">const</span>&nbsp;<span class="op" id="1802598">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802601">t1</span>&nbsp;<span class="op" id="1802604">=</span>&nbsp;<span class="num" id="1802606">0x00</span>&nbsp;<span class="comment" id="1802611">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802625">tx</span>&nbsp;<span class="op" id="1802628">=</span>&nbsp;<span class="num" id="1802630">0x80</span>&nbsp;<span class="comment" id="1802635">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802649">t2</span>&nbsp;<span class="op" id="1802652">=</span>&nbsp;<span class="num" id="1802654">0xC0</span>&nbsp;<span class="comment" id="1802659">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802673">t3</span>&nbsp;<span class="op" id="1802676">=</span>&nbsp;<span class="num" id="1802678">0xE0</span>&nbsp;<span class="comment" id="1802683">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802697">t4</span>&nbsp;<span class="op" id="1802700">=</span>&nbsp;<span class="num" id="1802702">0xF0</span>&nbsp;<span class="comment" id="1802707">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802721">t5</span>&nbsp;<span class="op" id="1802724">=</span>&nbsp;<span class="num" id="1802726">0xF8</span>&nbsp;<span class="comment" id="1802731">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802746">maskx</span>&nbsp;<span class="op" id="1802752">=</span>&nbsp;<span class="num" id="1802754">0x3F</span>&nbsp;<span class="comment" id="1802759">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802773">mask2</span>&nbsp;<span class="op" id="1802779">=</span>&nbsp;<span class="num" id="1802781">0x1F</span>&nbsp;<span class="comment" id="1802786">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802800">mask3</span>&nbsp;<span class="op" id="1802806">=</span>&nbsp;<span class="num" id="1802808">0x0F</span>&nbsp;<span class="comment" id="1802813">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802827">mask4</span>&nbsp;<span class="op" id="1802833">=</span>&nbsp;<span class="num" id="1802835">0x07</span>&nbsp;<span class="comment" id="1802840">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802855">rune1Max</span>&nbsp;<span class="op" id="1802864">=</span>&nbsp;<span class="num" id="1802866">1</span><span class="op" id="1802867">&lt;&lt;</span><span class="num" id="1802869">7</span>&nbsp;<span class="op" id="1802871">-</span>&nbsp;<span class="num" id="1802873">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802876">rune2Max</span>&nbsp;<span class="op" id="1802885">=</span>&nbsp;<span class="num" id="1802887">1</span><span class="op" id="1802888">&lt;&lt;</span><span class="num" id="1802890">11</span>&nbsp;<span class="op" id="1802893">-</span>&nbsp;<span class="num" id="1802895">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802898">rune3Max</span>&nbsp;<span class="op" id="1802907">=</span>&nbsp;<span class="num" id="1802909">1</span><span class="op" id="1802910">&lt;&lt;</span><span class="num" id="1802912">16</span>&nbsp;<span class="op" id="1802915">-</span>&nbsp;<span class="num" id="1802917">1</span><br>
<span class="lineno"></span><span class="op" id="1802919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1802922">func</span>&nbsp;<span class="ident" id="1802927">decodeRuneInternal</span><span class="op" id="1802945">(</span><span class="ident" id="1802946">p</span>&nbsp;<span class="op" id="1802948">[</span><span class="op" id="1802949">]</span><span class="builtintype" id="1802950">byte</span><span class="op" id="1802954">)</span>&nbsp;<span class="op" id="1802956">(</span><span class="ident" id="1802957">r</span>&nbsp;<span class="builtintype" id="1802959">rune</span><span class="op" id="1802963">,</span>&nbsp;<span class="ident" id="1802965">size</span>&nbsp;<span class="builtintype" id="1802970">int</span><span class="op" id="1802973">,</span>&nbsp;<span class="ident" id="1802975">short</span>&nbsp;<span class="builtintype" id="1802981">bool</span><span class="op" id="1802985">)</span>&nbsp;<span class="op" id="1802987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1802990">n</span>&nbsp;<span class="op" id="1802992">:=</span>&nbsp;<span class="builtinfunc" id="1802995">len</span><span class="op" id="1802998">(</span><span class="ident" id="1802999">p</span><span class="op" id="1803000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803003">if</span>&nbsp;<span class="ident" id="1803006">n</span>&nbsp;<span class="op" id="1803008">&lt;</span>&nbsp;<span class="num" id="1803010">1</span>&nbsp;<span class="op" id="1803012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803016">return</span>&nbsp;<span class="ident" id="1803023">RuneError</span><span class="op" id="1803032">,</span>&nbsp;<span class="num" id="1803034">0</span><span class="op" id="1803035">,</span>&nbsp;<span class="builtintype" id="1803037">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803043">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803046">c0</span>&nbsp;<span class="op" id="1803049">:=</span>&nbsp;<span class="ident" id="1803052">p</span><span class="op" id="1803053">[</span><span class="num" id="1803054">0</span><span class="op" id="1803055">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803059">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803087">if</span>&nbsp;<span class="ident" id="1803090">c0</span>&nbsp;<span class="op" id="1803093">&lt;</span>&nbsp;<span class="ident" id="1803095">tx</span>&nbsp;<span class="op" id="1803098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803102">return</span>&nbsp;<span class="builtintype" id="1803109">rune</span><span class="op" id="1803113">(</span><span class="ident" id="1803114">c0</span><span class="op" id="1803116">)</span><span class="op" id="1803117">,</span>&nbsp;<span class="num" id="1803119">1</span><span class="op" id="1803120">,</span>&nbsp;<span class="builtintype" id="1803122">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803133">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803167">if</span>&nbsp;<span class="ident" id="1803170">c0</span>&nbsp;<span class="op" id="1803173">&lt;</span>&nbsp;<span class="ident" id="1803175">t2</span>&nbsp;<span class="op" id="1803178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803182">return</span>&nbsp;<span class="ident" id="1803189">RuneError</span><span class="op" id="1803198">,</span>&nbsp;<span class="num" id="1803200">1</span><span class="op" id="1803201">,</span>&nbsp;<span class="builtintype" id="1803203">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803214">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803247">if</span>&nbsp;<span class="ident" id="1803250">n</span>&nbsp;<span class="op" id="1803252">&lt;</span>&nbsp;<span class="num" id="1803254">2</span>&nbsp;<span class="op" id="1803256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803260">return</span>&nbsp;<span class="ident" id="1803267">RuneError</span><span class="op" id="1803276">,</span>&nbsp;<span class="num" id="1803278">1</span><span class="op" id="1803279">,</span>&nbsp;<span class="builtintype" id="1803281">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803290">c1</span>&nbsp;<span class="op" id="1803293">:=</span>&nbsp;<span class="ident" id="1803296">p</span><span class="op" id="1803297">[</span><span class="num" id="1803298">1</span><span class="op" id="1803299">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803302">if</span>&nbsp;<span class="ident" id="1803305">c1</span>&nbsp;<span class="op" id="1803308">&lt;</span>&nbsp;<span class="ident" id="1803310">tx</span>&nbsp;<span class="op" id="1803313">||</span>&nbsp;<span class="ident" id="1803316">t2</span>&nbsp;<span class="op" id="1803319">&lt;=</span>&nbsp;<span class="ident" id="1803322">c1</span>&nbsp;<span class="op" id="1803325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803329">return</span>&nbsp;<span class="ident" id="1803336">RuneError</span><span class="op" id="1803345">,</span>&nbsp;<span class="num" id="1803347">1</span><span class="op" id="1803348">,</span>&nbsp;<span class="builtintype" id="1803350">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803357">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803361">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803390">if</span>&nbsp;<span class="ident" id="1803393">c0</span>&nbsp;<span class="op" id="1803396">&lt;</span>&nbsp;<span class="ident" id="1803398">t3</span>&nbsp;<span class="op" id="1803401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803405">r</span>&nbsp;<span class="op" id="1803407">=</span>&nbsp;<span class="builtintype" id="1803409">rune</span><span class="op" id="1803413">(</span><span class="ident" id="1803414">c0</span><span class="op" id="1803416">&amp;</span><span class="ident" id="1803417">mask2</span><span class="op" id="1803422">)</span><span class="op" id="1803423">&lt;&lt;</span><span class="num" id="1803425">6</span>&nbsp;<span class="op" id="1803427">|</span>&nbsp;<span class="builtintype" id="1803429">rune</span><span class="op" id="1803433">(</span><span class="ident" id="1803434">c1</span><span class="op" id="1803436">&amp;</span><span class="ident" id="1803437">maskx</span><span class="op" id="1803442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803446">if</span>&nbsp;<span class="ident" id="1803449">r</span>&nbsp;<span class="op" id="1803451">&lt;=</span>&nbsp;<span class="ident" id="1803454">rune1Max</span>&nbsp;<span class="op" id="1803463">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803468">return</span>&nbsp;<span class="ident" id="1803475">RuneError</span><span class="op" id="1803484">,</span>&nbsp;<span class="num" id="1803486">1</span><span class="op" id="1803487">,</span>&nbsp;<span class="builtintype" id="1803489">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803501">return</span>&nbsp;<span class="ident" id="1803508">r</span><span class="op" id="1803509">,</span>&nbsp;<span class="num" id="1803511">2</span><span class="op" id="1803512">,</span>&nbsp;<span class="builtintype" id="1803514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803521">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803525">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803559">if</span>&nbsp;<span class="ident" id="1803562">n</span>&nbsp;<span class="op" id="1803564">&lt;</span>&nbsp;<span class="num" id="1803566">3</span>&nbsp;<span class="op" id="1803568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803572">return</span>&nbsp;<span class="ident" id="1803579">RuneError</span><span class="op" id="1803588">,</span>&nbsp;<span class="num" id="1803590">1</span><span class="op" id="1803591">,</span>&nbsp;<span class="builtintype" id="1803593">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803602">c2</span>&nbsp;<span class="op" id="1803605">:=</span>&nbsp;<span class="ident" id="1803608">p</span><span class="op" id="1803609">[</span><span class="num" id="1803610">2</span><span class="op" id="1803611">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803614">if</span>&nbsp;<span class="ident" id="1803617">c2</span>&nbsp;<span class="op" id="1803620">&lt;</span>&nbsp;<span class="ident" id="1803622">tx</span>&nbsp;<span class="op" id="1803625">||</span>&nbsp;<span class="ident" id="1803628">t2</span>&nbsp;<span class="op" id="1803631">&lt;=</span>&nbsp;<span class="ident" id="1803634">c2</span>&nbsp;<span class="op" id="1803637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803641">return</span>&nbsp;<span class="ident" id="1803648">RuneError</span><span class="op" id="1803657">,</span>&nbsp;<span class="num" id="1803659">1</span><span class="op" id="1803660">,</span>&nbsp;<span class="builtintype" id="1803662">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803673">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803702">if</span>&nbsp;<span class="ident" id="1803705">c0</span>&nbsp;<span class="op" id="1803708">&lt;</span>&nbsp;<span class="ident" id="1803710">t4</span>&nbsp;<span class="op" id="1803713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1803717">r</span>&nbsp;<span class="op" id="1803719">=</span>&nbsp;<span class="builtintype" id="1803721">rune</span><span class="op" id="1803725">(</span><span class="ident" id="1803726">c0</span><span class="op" id="1803728">&amp;</span><span class="ident" id="1803729">mask3</span><span class="op" id="1803734">)</span><span class="op" id="1803735">&lt;&lt;</span><span class="num" id="1803737">12</span>&nbsp;<span class="op" id="1803740">|</span>&nbsp;<span class="builtintype" id="1803742">rune</span><span class="op" id="1803746">(</span><span class="ident" id="1803747">c1</span><span class="op" id="1803749">&amp;</span><span class="ident" id="1803750">maskx</span><span class="op" id="1803755">)</span><span class="op" id="1803756">&lt;&lt;</span><span class="num" id="1803758">6</span>&nbsp;<span class="op" id="1803760">|</span>&nbsp;<span class="builtintype" id="1803762">rune</span><span class="op" id="1803766">(</span><span class="ident" id="1803767">c2</span><span class="op" id="1803769">&amp;</span><span class="ident" id="1803770">maskx</span><span class="op" id="1803775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803779">if</span>&nbsp;<span class="ident" id="1803782">r</span>&nbsp;<span class="op" id="1803784">&lt;=</span>&nbsp;<span class="ident" id="1803787">rune2Max</span>&nbsp;<span class="op" id="1803796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803801">return</span>&nbsp;<span class="ident" id="1803808">RuneError</span><span class="op" id="1803817">,</span>&nbsp;<span class="num" id="1803819">1</span><span class="op" id="1803820">,</span>&nbsp;<span class="builtintype" id="1803822">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803830">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803834">if</span>&nbsp;<span class="ident" id="1803837">surrogateMin</span>&nbsp;<span class="op" id="1803850">&lt;=</span>&nbsp;<span class="ident" id="1803853">r</span>&nbsp;<span class="op" id="1803855">&amp;&amp;</span>&nbsp;<span class="ident" id="1803858">r</span>&nbsp;<span class="op" id="1803860">&lt;=</span>&nbsp;<span class="ident" id="1803863">surrogateMax</span>&nbsp;<span class="op" id="1803876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803881">return</span>&nbsp;<span class="ident" id="1803888">RuneError</span><span class="op" id="1803897">,</span>&nbsp;<span class="num" id="1803899">1</span><span class="op" id="1803900">,</span>&nbsp;<span class="builtintype" id="1803902">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803914">return</span>&nbsp;<span class="ident" id="1803921">r</span><span class="op" id="1803922">,</span>&nbsp;<span class="num" id="1803924">3</span><span class="op" id="1803925">,</span>&nbsp;<span class="builtintype" id="1803927">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1803934">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1803938">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803971">if</span>&nbsp;<span class="ident" id="1803974">n</span>&nbsp;<span class="op" id="1803976">&lt;</span>&nbsp;<span class="num" id="1803978">4</span>&nbsp;<span class="op" id="1803980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1803984">return</span>&nbsp;<span class="ident" id="1803991">RuneError</span><span class="op" id="1804000">,</span>&nbsp;<span class="num" id="1804002">1</span><span class="op" id="1804003">,</span>&nbsp;<span class="builtintype" id="1804005">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804011">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804014">c3</span>&nbsp;<span class="op" id="1804017">:=</span>&nbsp;<span class="ident" id="1804020">p</span><span class="op" id="1804021">[</span><span class="num" id="1804022">3</span><span class="op" id="1804023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804026">if</span>&nbsp;<span class="ident" id="1804029">c3</span>&nbsp;<span class="op" id="1804032">&lt;</span>&nbsp;<span class="ident" id="1804034">tx</span>&nbsp;<span class="op" id="1804037">||</span>&nbsp;<span class="ident" id="1804040">t2</span>&nbsp;<span class="op" id="1804043">&lt;=</span>&nbsp;<span class="ident" id="1804046">c3</span>&nbsp;<span class="op" id="1804049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804053">return</span>&nbsp;<span class="ident" id="1804060">RuneError</span><span class="op" id="1804069">,</span>&nbsp;<span class="num" id="1804071">1</span><span class="op" id="1804072">,</span>&nbsp;<span class="builtintype" id="1804074">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804085">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804114">if</span>&nbsp;<span class="ident" id="1804117">c0</span>&nbsp;<span class="op" id="1804120">&lt;</span>&nbsp;<span class="ident" id="1804122">t5</span>&nbsp;<span class="op" id="1804125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804129">r</span>&nbsp;<span class="op" id="1804131">=</span>&nbsp;<span class="builtintype" id="1804133">rune</span><span class="op" id="1804137">(</span><span class="ident" id="1804138">c0</span><span class="op" id="1804140">&amp;</span><span class="ident" id="1804141">mask4</span><span class="op" id="1804146">)</span><span class="op" id="1804147">&lt;&lt;</span><span class="num" id="1804149">18</span>&nbsp;<span class="op" id="1804152">|</span>&nbsp;<span class="builtintype" id="1804154">rune</span><span class="op" id="1804158">(</span><span class="ident" id="1804159">c1</span><span class="op" id="1804161">&amp;</span><span class="ident" id="1804162">maskx</span><span class="op" id="1804167">)</span><span class="op" id="1804168">&lt;&lt;</span><span class="num" id="1804170">12</span>&nbsp;<span class="op" id="1804173">|</span>&nbsp;<span class="builtintype" id="1804175">rune</span><span class="op" id="1804179">(</span><span class="ident" id="1804180">c2</span><span class="op" id="1804182">&amp;</span><span class="ident" id="1804183">maskx</span><span class="op" id="1804188">)</span><span class="op" id="1804189">&lt;&lt;</span><span class="num" id="1804191">6</span>&nbsp;<span class="op" id="1804193">|</span>&nbsp;<span class="builtintype" id="1804195">rune</span><span class="op" id="1804199">(</span><span class="ident" id="1804200">c3</span><span class="op" id="1804202">&amp;</span><span class="ident" id="1804203">maskx</span><span class="op" id="1804208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804212">if</span>&nbsp;<span class="ident" id="1804215">r</span>&nbsp;<span class="op" id="1804217">&lt;=</span>&nbsp;<span class="ident" id="1804220">rune3Max</span>&nbsp;<span class="op" id="1804229">||</span>&nbsp;<span class="ident" id="1804232">MaxRune</span>&nbsp;<span class="op" id="1804240">&lt;</span>&nbsp;<span class="ident" id="1804242">r</span>&nbsp;<span class="op" id="1804244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804249">return</span>&nbsp;<span class="ident" id="1804256">RuneError</span><span class="op" id="1804265">,</span>&nbsp;<span class="num" id="1804267">1</span><span class="op" id="1804268">,</span>&nbsp;<span class="builtintype" id="1804270">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804282">return</span>&nbsp;<span class="ident" id="1804289">r</span><span class="op" id="1804290">,</span>&nbsp;<span class="num" id="1804292">4</span><span class="op" id="1804293">,</span>&nbsp;<span class="builtintype" id="1804295">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804306">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804316">return</span>&nbsp;<span class="ident" id="1804323">RuneError</span><span class="op" id="1804332">,</span>&nbsp;<span class="num" id="1804334">1</span><span class="op" id="1804335">,</span>&nbsp;<span class="builtintype" id="1804337">false</span><br>
<span class="lineno"></span><span class="op" id="1804343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1804346">func</span>&nbsp;<span class="ident" id="1804351">decodeRuneInStringInternal</span><span class="op" id="1804377">(</span><span class="ident" id="1804378">s</span>&nbsp;<span class="builtintype" id="1804380">string</span><span class="op" id="1804386">)</span>&nbsp;<span class="op" id="1804388">(</span><span class="ident" id="1804389">r</span>&nbsp;<span class="builtintype" id="1804391">rune</span><span class="op" id="1804395">,</span>&nbsp;<span class="ident" id="1804397">size</span>&nbsp;<span class="builtintype" id="1804402">int</span><span class="op" id="1804405">,</span>&nbsp;<span class="ident" id="1804407">short</span>&nbsp;<span class="builtintype" id="1804413">bool</span><span class="op" id="1804417">)</span>&nbsp;<span class="op" id="1804419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804422">n</span>&nbsp;<span class="op" id="1804424">:=</span>&nbsp;<span class="builtinfunc" id="1804427">len</span><span class="op" id="1804430">(</span><span class="ident" id="1804431">s</span><span class="op" id="1804432">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804435">if</span>&nbsp;<span class="ident" id="1804438">n</span>&nbsp;<span class="op" id="1804440">&lt;</span>&nbsp;<span class="num" id="1804442">1</span>&nbsp;<span class="op" id="1804444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804448">return</span>&nbsp;<span class="ident" id="1804455">RuneError</span><span class="op" id="1804464">,</span>&nbsp;<span class="num" id="1804466">0</span><span class="op" id="1804467">,</span>&nbsp;<span class="builtintype" id="1804469">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804478">c0</span>&nbsp;<span class="op" id="1804481">:=</span>&nbsp;<span class="ident" id="1804484">s</span><span class="op" id="1804485">[</span><span class="num" id="1804486">0</span><span class="op" id="1804487">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804491">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804519">if</span>&nbsp;<span class="ident" id="1804522">c0</span>&nbsp;<span class="op" id="1804525">&lt;</span>&nbsp;<span class="ident" id="1804527">tx</span>&nbsp;<span class="op" id="1804530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804534">return</span>&nbsp;<span class="builtintype" id="1804541">rune</span><span class="op" id="1804545">(</span><span class="ident" id="1804546">c0</span><span class="op" id="1804548">)</span><span class="op" id="1804549">,</span>&nbsp;<span class="num" id="1804551">1</span><span class="op" id="1804552">,</span>&nbsp;<span class="builtintype" id="1804554">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804565">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804599">if</span>&nbsp;<span class="ident" id="1804602">c0</span>&nbsp;<span class="op" id="1804605">&lt;</span>&nbsp;<span class="ident" id="1804607">t2</span>&nbsp;<span class="op" id="1804610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804614">return</span>&nbsp;<span class="ident" id="1804621">RuneError</span><span class="op" id="1804630">,</span>&nbsp;<span class="num" id="1804632">1</span><span class="op" id="1804633">,</span>&nbsp;<span class="builtintype" id="1804635">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804646">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804679">if</span>&nbsp;<span class="ident" id="1804682">n</span>&nbsp;<span class="op" id="1804684">&lt;</span>&nbsp;<span class="num" id="1804686">2</span>&nbsp;<span class="op" id="1804688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804692">return</span>&nbsp;<span class="ident" id="1804699">RuneError</span><span class="op" id="1804708">,</span>&nbsp;<span class="num" id="1804710">1</span><span class="op" id="1804711">,</span>&nbsp;<span class="builtintype" id="1804713">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804722">c1</span>&nbsp;<span class="op" id="1804725">:=</span>&nbsp;<span class="ident" id="1804728">s</span><span class="op" id="1804729">[</span><span class="num" id="1804730">1</span><span class="op" id="1804731">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804734">if</span>&nbsp;<span class="ident" id="1804737">c1</span>&nbsp;<span class="op" id="1804740">&lt;</span>&nbsp;<span class="ident" id="1804742">tx</span>&nbsp;<span class="op" id="1804745">||</span>&nbsp;<span class="ident" id="1804748">t2</span>&nbsp;<span class="op" id="1804751">&lt;=</span>&nbsp;<span class="ident" id="1804754">c1</span>&nbsp;<span class="op" id="1804757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804761">return</span>&nbsp;<span class="ident" id="1804768">RuneError</span><span class="op" id="1804777">,</span>&nbsp;<span class="num" id="1804779">1</span><span class="op" id="1804780">,</span>&nbsp;<span class="builtintype" id="1804782">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804793">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804822">if</span>&nbsp;<span class="ident" id="1804825">c0</span>&nbsp;<span class="op" id="1804828">&lt;</span>&nbsp;<span class="ident" id="1804830">t3</span>&nbsp;<span class="op" id="1804833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1804837">r</span>&nbsp;<span class="op" id="1804839">=</span>&nbsp;<span class="builtintype" id="1804841">rune</span><span class="op" id="1804845">(</span><span class="ident" id="1804846">c0</span><span class="op" id="1804848">&amp;</span><span class="ident" id="1804849">mask2</span><span class="op" id="1804854">)</span><span class="op" id="1804855">&lt;&lt;</span><span class="num" id="1804857">6</span>&nbsp;<span class="op" id="1804859">|</span>&nbsp;<span class="builtintype" id="1804861">rune</span><span class="op" id="1804865">(</span><span class="ident" id="1804866">c1</span><span class="op" id="1804868">&amp;</span><span class="ident" id="1804869">maskx</span><span class="op" id="1804874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804878">if</span>&nbsp;<span class="ident" id="1804881">r</span>&nbsp;<span class="op" id="1804883">&lt;=</span>&nbsp;<span class="ident" id="1804886">rune1Max</span>&nbsp;<span class="op" id="1804895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804900">return</span>&nbsp;<span class="ident" id="1804907">RuneError</span><span class="op" id="1804916">,</span>&nbsp;<span class="num" id="1804918">1</span><span class="op" id="1804919">,</span>&nbsp;<span class="builtintype" id="1804921">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804929">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804933">return</span>&nbsp;<span class="ident" id="1804940">r</span><span class="op" id="1804941">,</span>&nbsp;<span class="num" id="1804943">2</span><span class="op" id="1804944">,</span>&nbsp;<span class="builtintype" id="1804946">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1804953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1804957">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1804991">if</span>&nbsp;<span class="ident" id="1804994">n</span>&nbsp;<span class="op" id="1804996">&lt;</span>&nbsp;<span class="num" id="1804998">3</span>&nbsp;<span class="op" id="1805000">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805004">return</span>&nbsp;<span class="ident" id="1805011">RuneError</span><span class="op" id="1805020">,</span>&nbsp;<span class="num" id="1805022">1</span><span class="op" id="1805023">,</span>&nbsp;<span class="builtintype" id="1805025">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1805034">c2</span>&nbsp;<span class="op" id="1805037">:=</span>&nbsp;<span class="ident" id="1805040">s</span><span class="op" id="1805041">[</span><span class="num" id="1805042">2</span><span class="op" id="1805043">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805046">if</span>&nbsp;<span class="ident" id="1805049">c2</span>&nbsp;<span class="op" id="1805052">&lt;</span>&nbsp;<span class="ident" id="1805054">tx</span>&nbsp;<span class="op" id="1805057">||</span>&nbsp;<span class="ident" id="1805060">t2</span>&nbsp;<span class="op" id="1805063">&lt;=</span>&nbsp;<span class="ident" id="1805066">c2</span>&nbsp;<span class="op" id="1805069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805073">return</span>&nbsp;<span class="ident" id="1805080">RuneError</span><span class="op" id="1805089">,</span>&nbsp;<span class="num" id="1805091">1</span><span class="op" id="1805092">,</span>&nbsp;<span class="builtintype" id="1805094">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1805105">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805134">if</span>&nbsp;<span class="ident" id="1805137">c0</span>&nbsp;<span class="op" id="1805140">&lt;</span>&nbsp;<span class="ident" id="1805142">t4</span>&nbsp;<span class="op" id="1805145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1805149">r</span>&nbsp;<span class="op" id="1805151">=</span>&nbsp;<span class="builtintype" id="1805153">rune</span><span class="op" id="1805157">(</span><span class="ident" id="1805158">c0</span><span class="op" id="1805160">&amp;</span><span class="ident" id="1805161">mask3</span><span class="op" id="1805166">)</span><span class="op" id="1805167">&lt;&lt;</span><span class="num" id="1805169">12</span>&nbsp;<span class="op" id="1805172">|</span>&nbsp;<span class="builtintype" id="1805174">rune</span><span class="op" id="1805178">(</span><span class="ident" id="1805179">c1</span><span class="op" id="1805181">&amp;</span><span class="ident" id="1805182">maskx</span><span class="op" id="1805187">)</span><span class="op" id="1805188">&lt;&lt;</span><span class="num" id="1805190">6</span>&nbsp;<span class="op" id="1805192">|</span>&nbsp;<span class="builtintype" id="1805194">rune</span><span class="op" id="1805198">(</span><span class="ident" id="1805199">c2</span><span class="op" id="1805201">&amp;</span><span class="ident" id="1805202">maskx</span><span class="op" id="1805207">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805211">if</span>&nbsp;<span class="ident" id="1805214">r</span>&nbsp;<span class="op" id="1805216">&lt;=</span>&nbsp;<span class="ident" id="1805219">rune2Max</span>&nbsp;<span class="op" id="1805228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805233">return</span>&nbsp;<span class="ident" id="1805240">RuneError</span><span class="op" id="1805249">,</span>&nbsp;<span class="num" id="1805251">1</span><span class="op" id="1805252">,</span>&nbsp;<span class="builtintype" id="1805254">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805266">if</span>&nbsp;<span class="ident" id="1805269">surrogateMin</span>&nbsp;<span class="op" id="1805282">&lt;=</span>&nbsp;<span class="ident" id="1805285">r</span>&nbsp;<span class="op" id="1805287">&amp;&amp;</span>&nbsp;<span class="ident" id="1805290">r</span>&nbsp;<span class="op" id="1805292">&lt;=</span>&nbsp;<span class="ident" id="1805295">surrogateMax</span>&nbsp;<span class="op" id="1805308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805313">return</span>&nbsp;<span class="ident" id="1805320">RuneError</span><span class="op" id="1805329">,</span>&nbsp;<span class="num" id="1805331">1</span><span class="op" id="1805332">,</span>&nbsp;<span class="builtintype" id="1805334">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805346">return</span>&nbsp;<span class="ident" id="1805353">r</span><span class="op" id="1805354">,</span>&nbsp;<span class="num" id="1805356">3</span><span class="op" id="1805357">,</span>&nbsp;<span class="builtintype" id="1805359">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1805370">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805403">if</span>&nbsp;<span class="ident" id="1805406">n</span>&nbsp;<span class="op" id="1805408">&lt;</span>&nbsp;<span class="num" id="1805410">4</span>&nbsp;<span class="op" id="1805412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805416">return</span>&nbsp;<span class="ident" id="1805423">RuneError</span><span class="op" id="1805432">,</span>&nbsp;<span class="num" id="1805434">1</span><span class="op" id="1805435">,</span>&nbsp;<span class="builtintype" id="1805437">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1805446">c3</span>&nbsp;<span class="op" id="1805449">:=</span>&nbsp;<span class="ident" id="1805452">s</span><span class="op" id="1805453">[</span><span class="num" id="1805454">3</span><span class="op" id="1805455">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805458">if</span>&nbsp;<span class="ident" id="1805461">c3</span>&nbsp;<span class="op" id="1805464">&lt;</span>&nbsp;<span class="ident" id="1805466">tx</span>&nbsp;<span class="op" id="1805469">||</span>&nbsp;<span class="ident" id="1805472">t2</span>&nbsp;<span class="op" id="1805475">&lt;=</span>&nbsp;<span class="ident" id="1805478">c3</span>&nbsp;<span class="op" id="1805481">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805485">return</span>&nbsp;<span class="ident" id="1805492">RuneError</span><span class="op" id="1805501">,</span>&nbsp;<span class="num" id="1805503">1</span><span class="op" id="1805504">,</span>&nbsp;<span class="builtintype" id="1805506">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1805517">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805546">if</span>&nbsp;<span class="ident" id="1805549">c0</span>&nbsp;<span class="op" id="1805552">&lt;</span>&nbsp;<span class="ident" id="1805554">t5</span>&nbsp;<span class="op" id="1805557">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1805561">r</span>&nbsp;<span class="op" id="1805563">=</span>&nbsp;<span class="builtintype" id="1805565">rune</span><span class="op" id="1805569">(</span><span class="ident" id="1805570">c0</span><span class="op" id="1805572">&amp;</span><span class="ident" id="1805573">mask4</span><span class="op" id="1805578">)</span><span class="op" id="1805579">&lt;&lt;</span><span class="num" id="1805581">18</span>&nbsp;<span class="op" id="1805584">|</span>&nbsp;<span class="builtintype" id="1805586">rune</span><span class="op" id="1805590">(</span><span class="ident" id="1805591">c1</span><span class="op" id="1805593">&amp;</span><span class="ident" id="1805594">maskx</span><span class="op" id="1805599">)</span><span class="op" id="1805600">&lt;&lt;</span><span class="num" id="1805602">12</span>&nbsp;<span class="op" id="1805605">|</span>&nbsp;<span class="builtintype" id="1805607">rune</span><span class="op" id="1805611">(</span><span class="ident" id="1805612">c2</span><span class="op" id="1805614">&amp;</span><span class="ident" id="1805615">maskx</span><span class="op" id="1805620">)</span><span class="op" id="1805621">&lt;&lt;</span><span class="num" id="1805623">6</span>&nbsp;<span class="op" id="1805625">|</span>&nbsp;<span class="builtintype" id="1805627">rune</span><span class="op" id="1805631">(</span><span class="ident" id="1805632">c3</span><span class="op" id="1805634">&amp;</span><span class="ident" id="1805635">maskx</span><span class="op" id="1805640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805644">if</span>&nbsp;<span class="ident" id="1805647">r</span>&nbsp;<span class="op" id="1805649">&lt;=</span>&nbsp;<span class="ident" id="1805652">rune3Max</span>&nbsp;<span class="op" id="1805661">||</span>&nbsp;<span class="ident" id="1805664">MaxRune</span>&nbsp;<span class="op" id="1805672">&lt;</span>&nbsp;<span class="ident" id="1805674">r</span>&nbsp;<span class="op" id="1805676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805681">return</span>&nbsp;<span class="ident" id="1805688">RuneError</span><span class="op" id="1805697">,</span>&nbsp;<span class="num" id="1805699">1</span><span class="op" id="1805700">,</span>&nbsp;<span class="builtintype" id="1805702">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805714">return</span>&nbsp;<span class="ident" id="1805721">r</span><span class="op" id="1805722">,</span>&nbsp;<span class="num" id="1805724">4</span><span class="op" id="1805725">,</span>&nbsp;<span class="builtintype" id="1805727">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1805734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1805738">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1805748">return</span>&nbsp;<span class="ident" id="1805755">RuneError</span><span class="op" id="1805764">,</span>&nbsp;<span class="num" id="1805766">1</span><span class="op" id="1805767">,</span>&nbsp;<span class="builtintype" id="1805769">false</span><br>
<span class="lineno"></span><span class="op" id="1805775">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1805778">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1805865">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1805961">func</span>&nbsp;<span class="ident" id="1805966">FullRune</span><span class="op" id="1805974">(</span><span class="ident" id="1805975">p</span>&nbsp;<span class="op" id="1805977">[</span><span class="op" id="1805978">]</span><span class="builtintype" id="1805979">byte</span><span class="op" id="1805983">)</span>&nbsp;<span class="builtintype" id="1805985">bool</span>&nbsp;<span class="op" id="1805990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1805993">_</span><span class="op" id="1805994">,</span>&nbsp;<span class="ident" id="1805996">_</span><span class="op" id="1805997">,</span>&nbsp;<span class="ident" id="1805999">short</span>&nbsp;<span class="op" id="1806005">:=</span>&nbsp;<span class="ident" id="1806008">decodeRuneInternal</span><span class="op" id="1806026">(</span><span class="ident" id="1806027">p</span><span class="op" id="1806028">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1806031">return</span>&nbsp;<span class="op" id="1806038">!</span><span class="ident" id="1806039">short</span><br>
<span class="lineno"></span><span class="op" id="1806045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1806048">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1806112">func</span>&nbsp;<span class="ident" id="1806117">FullRuneInString</span><span class="op" id="1806133">(</span><span class="ident" id="1806134">s</span>&nbsp;<span class="builtintype" id="1806136">string</span><span class="op" id="1806142">)</span>&nbsp;<span class="builtintype" id="1806144">bool</span>&nbsp;<span class="op" id="1806149">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1806152">_</span><span class="op" id="1806153">,</span>&nbsp;<span class="ident" id="1806155">_</span><span class="op" id="1806156">,</span>&nbsp;<span class="ident" id="1806158">short</span>&nbsp;<span class="op" id="1806164">:=</span>&nbsp;<span class="ident" id="1806167">decodeRuneInStringInternal</span><span class="op" id="1806193">(</span><span class="ident" id="1806194">s</span><span class="op" id="1806195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1806198">return</span>&nbsp;<span class="op" id="1806205">!</span><span class="ident" id="1806206">short</span><br>
<span class="lineno"></span><span class="op" id="1806212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1806215">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1806292">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1806370">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1806445">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1806475">//</span><br>
<span class="lineno"></span><span class="comment" id="1806478">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1806553">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1806625">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1806669">func</span>&nbsp;<span class="ident" id="1806674">DecodeRune</span><span class="op" id="1806684">(</span><span class="ident" id="1806685">p</span>&nbsp;<span class="op" id="1806687">[</span><span class="op" id="1806688">]</span><span class="builtintype" id="1806689">byte</span><span class="op" id="1806693">)</span>&nbsp;<span class="op" id="1806695">(</span><span class="ident" id="1806696">r</span>&nbsp;<span class="builtintype" id="1806698">rune</span><span class="op" id="1806702">,</span>&nbsp;<span class="ident" id="1806704">size</span>&nbsp;<span class="builtintype" id="1806709">int</span><span class="op" id="1806712">)</span>&nbsp;<span class="op" id="1806714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1806717">r</span><span class="op" id="1806718">,</span>&nbsp;<span class="ident" id="1806720">size</span><span class="op" id="1806724">,</span>&nbsp;<span class="ident" id="1806726">_</span>&nbsp;<span class="op" id="1806728">=</span>&nbsp;<span class="ident" id="1806730">decodeRuneInternal</span><span class="op" id="1806748">(</span><span class="ident" id="1806749">p</span><span class="op" id="1806750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1806753">return</span><br>
<span class="lineno">225</span><span class="op" id="1806760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1806763">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1806839">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1806917">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1806991">//</span><br>
<span class="lineno"></span><span class="comment" id="1806994">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1807069">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1807141">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1807185">func</span>&nbsp;<span class="ident" id="1807190">DecodeRuneInString</span><span class="op" id="1807208">(</span><span class="ident" id="1807209">s</span>&nbsp;<span class="builtintype" id="1807211">string</span><span class="op" id="1807217">)</span>&nbsp;<span class="op" id="1807219">(</span><span class="ident" id="1807220">r</span>&nbsp;<span class="builtintype" id="1807222">rune</span><span class="op" id="1807226">,</span>&nbsp;<span class="ident" id="1807228">size</span>&nbsp;<span class="builtintype" id="1807233">int</span><span class="op" id="1807236">)</span>&nbsp;<span class="op" id="1807238">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1807241">r</span><span class="op" id="1807242">,</span>&nbsp;<span class="ident" id="1807244">size</span><span class="op" id="1807248">,</span>&nbsp;<span class="ident" id="1807250">_</span>&nbsp;<span class="op" id="1807252">=</span>&nbsp;<span class="ident" id="1807254">decodeRuneInStringInternal</span><span class="op" id="1807280">(</span><span class="ident" id="1807281">s</span><span class="op" id="1807282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1807285">return</span><br>
<span class="lineno"></span><span class="op" id="1807292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1807295">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1807375">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1807453">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1807528">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1807558">//</span><br>
<span class="lineno"></span><span class="comment" id="1807561">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1807636">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1807708">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1807752">func</span>&nbsp;<span class="ident" id="1807757">DecodeLastRune</span><span class="op" id="1807771">(</span><span class="ident" id="1807772">p</span>&nbsp;<span class="op" id="1807774">[</span><span class="op" id="1807775">]</span><span class="builtintype" id="1807776">byte</span><span class="op" id="1807780">)</span>&nbsp;<span class="op" id="1807782">(</span><span class="ident" id="1807783">r</span>&nbsp;<span class="builtintype" id="1807785">rune</span><span class="op" id="1807789">,</span>&nbsp;<span class="ident" id="1807791">size</span>&nbsp;<span class="builtintype" id="1807796">int</span><span class="op" id="1807799">)</span>&nbsp;<span class="op" id="1807801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1807804">end</span>&nbsp;<span class="op" id="1807808">:=</span>&nbsp;<span class="builtinfunc" id="1807811">len</span><span class="op" id="1807814">(</span><span class="ident" id="1807815">p</span><span class="op" id="1807816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1807819">if</span>&nbsp;<span class="ident" id="1807822">end</span>&nbsp;<span class="op" id="1807826">==</span>&nbsp;<span class="num" id="1807829">0</span>&nbsp;<span class="op" id="1807831">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1807835">return</span>&nbsp;<span class="ident" id="1807842">RuneError</span><span class="op" id="1807851">,</span>&nbsp;<span class="num" id="1807853">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1807856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1807859">start</span>&nbsp;<span class="op" id="1807865">:=</span>&nbsp;<span class="ident" id="1807868">end</span>&nbsp;<span class="op" id="1807872">-</span>&nbsp;<span class="num" id="1807874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1807877">r</span>&nbsp;<span class="op" id="1807879">=</span>&nbsp;<span class="builtintype" id="1807881">rune</span><span class="op" id="1807885">(</span><span class="ident" id="1807886">p</span><span class="op" id="1807887">[</span><span class="ident" id="1807888">start</span><span class="op" id="1807893">]</span><span class="op" id="1807894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1807897">if</span>&nbsp;<span class="ident" id="1807900">r</span>&nbsp;<span class="op" id="1807902">&lt;</span>&nbsp;<span class="ident" id="1807904">RuneSelf</span>&nbsp;<span class="op" id="1807913">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1807917">return</span>&nbsp;<span class="ident" id="1807924">r</span><span class="op" id="1807925">,</span>&nbsp;<span class="num" id="1807927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1807930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1807933">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1807983">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1808036">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808055">lim</span>&nbsp;<span class="op" id="1808059">:=</span>&nbsp;<span class="ident" id="1808062">end</span>&nbsp;<span class="op" id="1808066">-</span>&nbsp;<span class="ident" id="1808068">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808076">if</span>&nbsp;<span class="ident" id="1808079">lim</span>&nbsp;<span class="op" id="1808083">&lt;</span>&nbsp;<span class="num" id="1808085">0</span>&nbsp;<span class="op" id="1808087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808091">lim</span>&nbsp;<span class="op" id="1808095">=</span>&nbsp;<span class="num" id="1808097">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808103">for</span>&nbsp;<span class="ident" id="1808107">start</span><span class="op" id="1808112">--</span><span class="op" id="1808114">;</span>&nbsp;<span class="ident" id="1808116">start</span>&nbsp;<span class="op" id="1808122">&gt;=</span>&nbsp;<span class="ident" id="1808125">lim</span><span class="op" id="1808128">;</span>&nbsp;<span class="ident" id="1808130">start</span><span class="op" id="1808135">--</span>&nbsp;<span class="op" id="1808138">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808142">if</span>&nbsp;<span class="ident" id="1808145">RuneStart</span><span class="op" id="1808154">(</span><span class="ident" id="1808155">p</span><span class="op" id="1808156">[</span><span class="ident" id="1808157">start</span><span class="op" id="1808162">]</span><span class="op" id="1808163">)</span>&nbsp;<span class="op" id="1808165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808170">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808184">if</span>&nbsp;<span class="ident" id="1808187">start</span>&nbsp;<span class="op" id="1808193">&lt;</span>&nbsp;<span class="num" id="1808195">0</span>&nbsp;<span class="op" id="1808197">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808201">start</span>&nbsp;<span class="op" id="1808207">=</span>&nbsp;<span class="num" id="1808209">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808215">r</span><span class="op" id="1808216">,</span>&nbsp;<span class="ident" id="1808218">size</span>&nbsp;<span class="op" id="1808223">=</span>&nbsp;<span class="ident" id="1808225">DecodeRune</span><span class="op" id="1808235">(</span><span class="ident" id="1808236">p</span><span class="op" id="1808237">[</span><span class="ident" id="1808238">start</span><span class="op" id="1808243">:</span><span class="ident" id="1808244">end</span><span class="op" id="1808247">]</span><span class="op" id="1808248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808251">if</span>&nbsp;<span class="ident" id="1808254">start</span><span class="op" id="1808259">+</span><span class="ident" id="1808260">size</span>&nbsp;<span class="op" id="1808265">!=</span>&nbsp;<span class="ident" id="1808268">end</span>&nbsp;<span class="op" id="1808272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808276">return</span>&nbsp;<span class="ident" id="1808283">RuneError</span><span class="op" id="1808292">,</span>&nbsp;<span class="num" id="1808294">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808300">return</span>&nbsp;<span class="ident" id="1808307">r</span><span class="op" id="1808308">,</span>&nbsp;<span class="ident" id="1808310">size</span><br>
<span class="lineno"></span><span class="op" id="1808315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1808318">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1808397">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1808477">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1808554">//</span><br>
<span class="lineno"></span><span class="comment" id="1808557">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1808632">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1808704">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1808748">func</span>&nbsp;<span class="ident" id="1808753">DecodeLastRuneInString</span><span class="op" id="1808775">(</span><span class="ident" id="1808776">s</span>&nbsp;<span class="builtintype" id="1808778">string</span><span class="op" id="1808784">)</span>&nbsp;<span class="op" id="1808786">(</span><span class="ident" id="1808787">r</span>&nbsp;<span class="builtintype" id="1808789">rune</span><span class="op" id="1808793">,</span>&nbsp;<span class="ident" id="1808795">size</span>&nbsp;<span class="builtintype" id="1808800">int</span><span class="op" id="1808803">)</span>&nbsp;<span class="op" id="1808805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808808">end</span>&nbsp;<span class="op" id="1808812">:=</span>&nbsp;<span class="builtinfunc" id="1808815">len</span><span class="op" id="1808818">(</span><span class="ident" id="1808819">s</span><span class="op" id="1808820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808823">if</span>&nbsp;<span class="ident" id="1808826">end</span>&nbsp;<span class="op" id="1808830">==</span>&nbsp;<span class="num" id="1808833">0</span>&nbsp;<span class="op" id="1808835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808839">return</span>&nbsp;<span class="ident" id="1808846">RuneError</span><span class="op" id="1808855">,</span>&nbsp;<span class="num" id="1808857">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808863">start</span>&nbsp;<span class="op" id="1808869">:=</span>&nbsp;<span class="ident" id="1808872">end</span>&nbsp;<span class="op" id="1808876">-</span>&nbsp;<span class="num" id="1808878">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1808881">r</span>&nbsp;<span class="op" id="1808883">=</span>&nbsp;<span class="builtintype" id="1808885">rune</span><span class="op" id="1808889">(</span><span class="ident" id="1808890">s</span><span class="op" id="1808891">[</span><span class="ident" id="1808892">start</span><span class="op" id="1808897">]</span><span class="op" id="1808898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808901">if</span>&nbsp;<span class="ident" id="1808904">r</span>&nbsp;<span class="op" id="1808906">&lt;</span>&nbsp;<span class="ident" id="1808908">RuneSelf</span>&nbsp;<span class="op" id="1808917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1808921">return</span>&nbsp;<span class="ident" id="1808928">r</span><span class="op" id="1808929">,</span>&nbsp;<span class="num" id="1808931">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1808934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1808937">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1808987">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1809040">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1809059">lim</span>&nbsp;<span class="op" id="1809063">:=</span>&nbsp;<span class="ident" id="1809066">end</span>&nbsp;<span class="op" id="1809070">-</span>&nbsp;<span class="ident" id="1809072">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809080">if</span>&nbsp;<span class="ident" id="1809083">lim</span>&nbsp;<span class="op" id="1809087">&lt;</span>&nbsp;<span class="num" id="1809089">0</span>&nbsp;<span class="op" id="1809091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1809095">lim</span>&nbsp;<span class="op" id="1809099">=</span>&nbsp;<span class="num" id="1809101">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1809104">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809107">for</span>&nbsp;<span class="ident" id="1809111">start</span><span class="op" id="1809116">--</span><span class="op" id="1809118">;</span>&nbsp;<span class="ident" id="1809120">start</span>&nbsp;<span class="op" id="1809126">&gt;=</span>&nbsp;<span class="ident" id="1809129">lim</span><span class="op" id="1809132">;</span>&nbsp;<span class="ident" id="1809134">start</span><span class="op" id="1809139">--</span>&nbsp;<span class="op" id="1809142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809146">if</span>&nbsp;<span class="ident" id="1809149">RuneStart</span><span class="op" id="1809158">(</span><span class="ident" id="1809159">s</span><span class="op" id="1809160">[</span><span class="ident" id="1809161">start</span><span class="op" id="1809166">]</span><span class="op" id="1809167">)</span>&nbsp;<span class="op" id="1809169">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1809182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1809185">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809188">if</span>&nbsp;<span class="ident" id="1809191">start</span>&nbsp;<span class="op" id="1809197">&lt;</span>&nbsp;<span class="num" id="1809199">0</span>&nbsp;<span class="op" id="1809201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1809205">start</span>&nbsp;<span class="op" id="1809211">=</span>&nbsp;<span class="num" id="1809213">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1809216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1809219">r</span><span class="op" id="1809220">,</span>&nbsp;<span class="ident" id="1809222">size</span>&nbsp;<span class="op" id="1809227">=</span>&nbsp;<span class="ident" id="1809229">DecodeRuneInString</span><span class="op" id="1809247">(</span><span class="ident" id="1809248">s</span><span class="op" id="1809249">[</span><span class="ident" id="1809250">start</span><span class="op" id="1809255">:</span><span class="ident" id="1809256">end</span><span class="op" id="1809259">]</span><span class="op" id="1809260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809263">if</span>&nbsp;<span class="ident" id="1809266">start</span><span class="op" id="1809271">+</span><span class="ident" id="1809272">size</span>&nbsp;<span class="op" id="1809277">!=</span>&nbsp;<span class="ident" id="1809280">end</span>&nbsp;<span class="op" id="1809284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809288">return</span>&nbsp;<span class="ident" id="1809295">RuneError</span><span class="op" id="1809304">,</span>&nbsp;<span class="num" id="1809306">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1809309">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809312">return</span>&nbsp;<span class="ident" id="1809319">r</span><span class="op" id="1809320">,</span>&nbsp;<span class="ident" id="1809322">size</span><br>
<span class="lineno"></span><span class="op" id="1809327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1809330">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1809398">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1809468">func</span>&nbsp;<span class="ident" id="1809473">RuneLen</span><span class="op" id="1809480">(</span><span class="ident" id="1809481">r</span>&nbsp;<span class="builtintype" id="1809483">rune</span><span class="op" id="1809487">)</span>&nbsp;<span class="builtintype" id="1809489">int</span>&nbsp;<span class="op" id="1809493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809496">switch</span>&nbsp;<span class="op" id="1809503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809506">case</span>&nbsp;<span class="ident" id="1809511">r</span>&nbsp;<span class="op" id="1809513">&lt;</span>&nbsp;<span class="num" id="1809515">0</span><span class="op" id="1809516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809520">return</span>&nbsp;<span class="op" id="1809527">-</span><span class="num" id="1809528">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809531">case</span>&nbsp;<span class="ident" id="1809536">r</span>&nbsp;<span class="op" id="1809538">&lt;=</span>&nbsp;<span class="ident" id="1809541">rune1Max</span><span class="op" id="1809549">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809553">return</span>&nbsp;<span class="num" id="1809560">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809563">case</span>&nbsp;<span class="ident" id="1809568">r</span>&nbsp;<span class="op" id="1809570">&lt;=</span>&nbsp;<span class="ident" id="1809573">rune2Max</span><span class="op" id="1809581">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809585">return</span>&nbsp;<span class="num" id="1809592">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809595">case</span>&nbsp;<span class="ident" id="1809600">surrogateMin</span>&nbsp;<span class="op" id="1809613">&lt;=</span>&nbsp;<span class="ident" id="1809616">r</span>&nbsp;<span class="op" id="1809618">&amp;&amp;</span>&nbsp;<span class="ident" id="1809621">r</span>&nbsp;<span class="op" id="1809623">&lt;=</span>&nbsp;<span class="ident" id="1809626">surrogateMax</span><span class="op" id="1809638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809642">return</span>&nbsp;<span class="op" id="1809649">-</span><span class="num" id="1809650">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809653">case</span>&nbsp;<span class="ident" id="1809658">r</span>&nbsp;<span class="op" id="1809660">&lt;=</span>&nbsp;<span class="ident" id="1809663">rune3Max</span><span class="op" id="1809671">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809675">return</span>&nbsp;<span class="num" id="1809682">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809685">case</span>&nbsp;<span class="ident" id="1809690">r</span>&nbsp;<span class="op" id="1809692">&lt;=</span>&nbsp;<span class="ident" id="1809695">MaxRune</span><span class="op" id="1809702">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809706">return</span>&nbsp;<span class="num" id="1809713">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1809716">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809719">return</span>&nbsp;<span class="op" id="1809726">-</span><span class="num" id="1809727">1</span><br>
<span class="lineno"></span><span class="op" id="1809729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1809732">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1809821">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1809864">func</span>&nbsp;<span class="ident" id="1809869">EncodeRune</span><span class="op" id="1809879">(</span><span class="ident" id="1809880">p</span>&nbsp;<span class="op" id="1809882">[</span><span class="op" id="1809883">]</span><span class="builtintype" id="1809884">byte</span><span class="op" id="1809888">,</span>&nbsp;<span class="ident" id="1809890">r</span>&nbsp;<span class="builtintype" id="1809892">rune</span><span class="op" id="1809896">)</span>&nbsp;<span class="builtintype" id="1809898">int</span>&nbsp;<span class="op" id="1809902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1809905">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1809983">switch</span>&nbsp;<span class="ident" id="1809990">i</span>&nbsp;<span class="op" id="1809992">:=</span>&nbsp;<span class="builtintype" id="1809995">uint32</span><span class="op" id="1810001">(</span><span class="ident" id="1810002">r</span><span class="op" id="1810003">)</span><span class="op" id="1810004">;</span>&nbsp;<span class="op" id="1810006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810009">case</span>&nbsp;<span class="ident" id="1810014">i</span>&nbsp;<span class="op" id="1810016">&lt;=</span>&nbsp;<span class="ident" id="1810019">rune1Max</span><span class="op" id="1810027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810031">p</span><span class="op" id="1810032">[</span><span class="num" id="1810033">0</span><span class="op" id="1810034">]</span>&nbsp;<span class="op" id="1810036">=</span>&nbsp;<span class="builtintype" id="1810038">byte</span><span class="op" id="1810042">(</span><span class="ident" id="1810043">r</span><span class="op" id="1810044">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810048">return</span>&nbsp;<span class="num" id="1810055">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810058">case</span>&nbsp;<span class="ident" id="1810063">i</span>&nbsp;<span class="op" id="1810065">&lt;=</span>&nbsp;<span class="ident" id="1810068">rune2Max</span><span class="op" id="1810076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810080">p</span><span class="op" id="1810081">[</span><span class="num" id="1810082">0</span><span class="op" id="1810083">]</span>&nbsp;<span class="op" id="1810085">=</span>&nbsp;<span class="ident" id="1810087">t2</span>&nbsp;<span class="op" id="1810090">|</span>&nbsp;<span class="builtintype" id="1810092">byte</span><span class="op" id="1810096">(</span><span class="ident" id="1810097">r</span><span class="op" id="1810098">&gt;&gt;</span><span class="num" id="1810100">6</span><span class="op" id="1810101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810105">p</span><span class="op" id="1810106">[</span><span class="num" id="1810107">1</span><span class="op" id="1810108">]</span>&nbsp;<span class="op" id="1810110">=</span>&nbsp;<span class="ident" id="1810112">tx</span>&nbsp;<span class="op" id="1810115">|</span>&nbsp;<span class="builtintype" id="1810117">byte</span><span class="op" id="1810121">(</span><span class="ident" id="1810122">r</span><span class="op" id="1810123">)</span><span class="op" id="1810124">&amp;</span><span class="ident" id="1810125">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810133">return</span>&nbsp;<span class="num" id="1810140">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810143">case</span>&nbsp;<span class="ident" id="1810148">i</span>&nbsp;<span class="op" id="1810150">&gt;</span>&nbsp;<span class="ident" id="1810152">MaxRune</span><span class="op" id="1810159">,</span>&nbsp;<span class="ident" id="1810161">surrogateMin</span>&nbsp;<span class="op" id="1810174">&lt;=</span>&nbsp;<span class="ident" id="1810177">i</span>&nbsp;<span class="op" id="1810179">&amp;&amp;</span>&nbsp;<span class="ident" id="1810182">i</span>&nbsp;<span class="op" id="1810184">&lt;=</span>&nbsp;<span class="ident" id="1810187">surrogateMax</span><span class="op" id="1810199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810203">r</span>&nbsp;<span class="op" id="1810205">=</span>&nbsp;<span class="ident" id="1810207">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810219">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810232">case</span>&nbsp;<span class="ident" id="1810237">i</span>&nbsp;<span class="op" id="1810239">&lt;=</span>&nbsp;<span class="ident" id="1810242">rune3Max</span><span class="op" id="1810250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810254">p</span><span class="op" id="1810255">[</span><span class="num" id="1810256">0</span><span class="op" id="1810257">]</span>&nbsp;<span class="op" id="1810259">=</span>&nbsp;<span class="ident" id="1810261">t3</span>&nbsp;<span class="op" id="1810264">|</span>&nbsp;<span class="builtintype" id="1810266">byte</span><span class="op" id="1810270">(</span><span class="ident" id="1810271">r</span><span class="op" id="1810272">&gt;&gt;</span><span class="num" id="1810274">12</span><span class="op" id="1810276">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810280">p</span><span class="op" id="1810281">[</span><span class="num" id="1810282">1</span><span class="op" id="1810283">]</span>&nbsp;<span class="op" id="1810285">=</span>&nbsp;<span class="ident" id="1810287">tx</span>&nbsp;<span class="op" id="1810290">|</span>&nbsp;<span class="builtintype" id="1810292">byte</span><span class="op" id="1810296">(</span><span class="ident" id="1810297">r</span><span class="op" id="1810298">&gt;&gt;</span><span class="num" id="1810300">6</span><span class="op" id="1810301">)</span><span class="op" id="1810302">&amp;</span><span class="ident" id="1810303">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810311">p</span><span class="op" id="1810312">[</span><span class="num" id="1810313">2</span><span class="op" id="1810314">]</span>&nbsp;<span class="op" id="1810316">=</span>&nbsp;<span class="ident" id="1810318">tx</span>&nbsp;<span class="op" id="1810321">|</span>&nbsp;<span class="builtintype" id="1810323">byte</span><span class="op" id="1810327">(</span><span class="ident" id="1810328">r</span><span class="op" id="1810329">)</span><span class="op" id="1810330">&amp;</span><span class="ident" id="1810331">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810339">return</span>&nbsp;<span class="num" id="1810346">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810349">default</span><span class="op" id="1810356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810360">p</span><span class="op" id="1810361">[</span><span class="num" id="1810362">0</span><span class="op" id="1810363">]</span>&nbsp;<span class="op" id="1810365">=</span>&nbsp;<span class="ident" id="1810367">t4</span>&nbsp;<span class="op" id="1810370">|</span>&nbsp;<span class="builtintype" id="1810372">byte</span><span class="op" id="1810376">(</span><span class="ident" id="1810377">r</span><span class="op" id="1810378">&gt;&gt;</span><span class="num" id="1810380">18</span><span class="op" id="1810382">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810386">p</span><span class="op" id="1810387">[</span><span class="num" id="1810388">1</span><span class="op" id="1810389">]</span>&nbsp;<span class="op" id="1810391">=</span>&nbsp;<span class="ident" id="1810393">tx</span>&nbsp;<span class="op" id="1810396">|</span>&nbsp;<span class="builtintype" id="1810398">byte</span><span class="op" id="1810402">(</span><span class="ident" id="1810403">r</span><span class="op" id="1810404">&gt;&gt;</span><span class="num" id="1810406">12</span><span class="op" id="1810408">)</span><span class="op" id="1810409">&amp;</span><span class="ident" id="1810410">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810418">p</span><span class="op" id="1810419">[</span><span class="num" id="1810420">2</span><span class="op" id="1810421">]</span>&nbsp;<span class="op" id="1810423">=</span>&nbsp;<span class="ident" id="1810425">tx</span>&nbsp;<span class="op" id="1810428">|</span>&nbsp;<span class="builtintype" id="1810430">byte</span><span class="op" id="1810434">(</span><span class="ident" id="1810435">r</span><span class="op" id="1810436">&gt;&gt;</span><span class="num" id="1810438">6</span><span class="op" id="1810439">)</span><span class="op" id="1810440">&amp;</span><span class="ident" id="1810441">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810449">p</span><span class="op" id="1810450">[</span><span class="num" id="1810451">3</span><span class="op" id="1810452">]</span>&nbsp;<span class="op" id="1810454">=</span>&nbsp;<span class="ident" id="1810456">tx</span>&nbsp;<span class="op" id="1810459">|</span>&nbsp;<span class="builtintype" id="1810461">byte</span><span class="op" id="1810465">(</span><span class="ident" id="1810466">r</span><span class="op" id="1810467">)</span><span class="op" id="1810468">&amp;</span><span class="ident" id="1810469">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810477">return</span>&nbsp;<span class="num" id="1810484">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1810487">}</span><br>
<span class="lineno">365</span><span class="op" id="1810489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1810492">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1810560">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1810618">func</span>&nbsp;<span class="ident" id="1810623">RuneCount</span><span class="op" id="1810632">(</span><span class="ident" id="1810633">p</span>&nbsp;<span class="op" id="1810635">[</span><span class="op" id="1810636">]</span><span class="builtintype" id="1810637">byte</span><span class="op" id="1810641">)</span>&nbsp;<span class="builtintype" id="1810643">int</span>&nbsp;<span class="op" id="1810647">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810650">i</span>&nbsp;<span class="op" id="1810652">:=</span>&nbsp;<span class="num" id="1810655">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810658">var</span>&nbsp;<span class="ident" id="1810662">n</span>&nbsp;<span class="builtintype" id="1810664">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810669">for</span>&nbsp;<span class="ident" id="1810673">n</span>&nbsp;<span class="op" id="1810675">=</span>&nbsp;<span class="num" id="1810677">0</span><span class="op" id="1810678">;</span>&nbsp;<span class="ident" id="1810680">i</span>&nbsp;<span class="op" id="1810682">&lt;</span>&nbsp;<span class="builtinfunc" id="1810684">len</span><span class="op" id="1810687">(</span><span class="ident" id="1810688">p</span><span class="op" id="1810689">)</span><span class="op" id="1810690">;</span>&nbsp;<span class="ident" id="1810692">n</span><span class="op" id="1810693">++</span>&nbsp;<span class="op" id="1810696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810700">if</span>&nbsp;<span class="ident" id="1810703">p</span><span class="op" id="1810704">[</span><span class="ident" id="1810705">i</span><span class="op" id="1810706">]</span>&nbsp;<span class="op" id="1810708">&lt;</span>&nbsp;<span class="ident" id="1810710">RuneSelf</span>&nbsp;<span class="op" id="1810719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810724">i</span><span class="op" id="1810725">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1810730">}</span>&nbsp;<span class="keyword" id="1810732">else</span>&nbsp;<span class="op" id="1810737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810742">_</span><span class="op" id="1810743">,</span>&nbsp;<span class="ident" id="1810745">size</span>&nbsp;<span class="op" id="1810750">:=</span>&nbsp;<span class="ident" id="1810753">DecodeRune</span><span class="op" id="1810763">(</span><span class="ident" id="1810764">p</span><span class="op" id="1810765">[</span><span class="ident" id="1810766">i</span><span class="op" id="1810767">:</span><span class="op" id="1810768">]</span><span class="op" id="1810769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810774">i</span>&nbsp;<span class="op" id="1810776">+=</span>&nbsp;<span class="ident" id="1810779">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1810786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1810789">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810792">return</span>&nbsp;<span class="ident" id="1810799">n</span><br>
<span class="lineno"></span><span class="op" id="1810801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1810804">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1810870">func</span>&nbsp;<span class="ident" id="1810875">RuneCountInString</span><span class="op" id="1810892">(</span><span class="ident" id="1810893">s</span>&nbsp;<span class="builtintype" id="1810895">string</span><span class="op" id="1810901">)</span>&nbsp;<span class="op" id="1810903">(</span><span class="ident" id="1810904">n</span>&nbsp;<span class="builtintype" id="1810906">int</span><span class="op" id="1810909">)</span>&nbsp;<span class="op" id="1810911">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810914">for</span>&nbsp;<span class="keyword" id="1810918">range</span>&nbsp;<span class="ident" id="1810924">s</span>&nbsp;<span class="op" id="1810926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1810930">n</span><span class="op" id="1810931">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1810935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1810938">return</span><br>
<span class="lineno"></span><span class="op" id="1810945">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1810948">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1811013">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1811082">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1811105">func</span>&nbsp;<span class="ident" id="1811110">RuneStart</span><span class="op" id="1811119">(</span><span class="ident" id="1811120">b</span>&nbsp;<span class="builtintype" id="1811122">byte</span><span class="op" id="1811126">)</span>&nbsp;<span class="builtintype" id="1811128">bool</span>&nbsp;<span class="op" id="1811133">{</span>&nbsp;<span class="keyword" id="1811135">return</span>&nbsp;<span class="ident" id="1811142">b</span><span class="op" id="1811143">&amp;</span><span class="num" id="1811144">0xC0</span>&nbsp;<span class="op" id="1811149">!=</span>&nbsp;<span class="num" id="1811152">0x80</span>&nbsp;<span class="op" id="1811157">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1811160">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1811235">func</span>&nbsp;<span class="ident" id="1811240">Valid</span><span class="op" id="1811245">(</span><span class="ident" id="1811246">p</span>&nbsp;<span class="op" id="1811248">[</span><span class="op" id="1811249">]</span><span class="builtintype" id="1811250">byte</span><span class="op" id="1811254">)</span>&nbsp;<span class="builtintype" id="1811256">bool</span>&nbsp;<span class="op" id="1811261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1811264">i</span>&nbsp;<span class="op" id="1811266">:=</span>&nbsp;<span class="num" id="1811269">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811272">for</span>&nbsp;<span class="ident" id="1811276">i</span>&nbsp;<span class="op" id="1811278">&lt;</span>&nbsp;<span class="builtinfunc" id="1811280">len</span><span class="op" id="1811283">(</span><span class="ident" id="1811284">p</span><span class="op" id="1811285">)</span>&nbsp;<span class="op" id="1811287">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811291">if</span>&nbsp;<span class="ident" id="1811294">p</span><span class="op" id="1811295">[</span><span class="ident" id="1811296">i</span><span class="op" id="1811297">]</span>&nbsp;<span class="op" id="1811299">&lt;</span>&nbsp;<span class="ident" id="1811301">RuneSelf</span>&nbsp;<span class="op" id="1811310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1811315">i</span><span class="op" id="1811316">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811321">}</span>&nbsp;<span class="keyword" id="1811323">else</span>&nbsp;<span class="op" id="1811328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1811333">_</span><span class="op" id="1811334">,</span>&nbsp;<span class="ident" id="1811336">size</span>&nbsp;<span class="op" id="1811341">:=</span>&nbsp;<span class="ident" id="1811344">DecodeRune</span><span class="op" id="1811354">(</span><span class="ident" id="1811355">p</span><span class="op" id="1811356">[</span><span class="ident" id="1811357">i</span><span class="op" id="1811358">:</span><span class="op" id="1811359">]</span><span class="op" id="1811360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811365">if</span>&nbsp;<span class="ident" id="1811368">size</span>&nbsp;<span class="op" id="1811373">==</span>&nbsp;<span class="num" id="1811376">1</span>&nbsp;<span class="op" id="1811378">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811384">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811424">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811467">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811500">return</span>&nbsp;<span class="builtintype" id="1811507">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811516">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1811521">i</span>&nbsp;<span class="op" id="1811523">+=</span>&nbsp;<span class="ident" id="1811526">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811539">return</span>&nbsp;<span class="builtintype" id="1811546">true</span><br>
<span class="lineno"></span><span class="op" id="1811551">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1811554">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1811635">func</span>&nbsp;<span class="ident" id="1811640">ValidString</span><span class="op" id="1811651">(</span><span class="ident" id="1811652">s</span>&nbsp;<span class="builtintype" id="1811654">string</span><span class="op" id="1811660">)</span>&nbsp;<span class="builtintype" id="1811662">bool</span>&nbsp;<span class="op" id="1811667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811670">for</span>&nbsp;<span class="ident" id="1811674">i</span><span class="op" id="1811675">,</span>&nbsp;<span class="ident" id="1811677">r</span>&nbsp;<span class="op" id="1811679">:=</span>&nbsp;<span class="keyword" id="1811682">range</span>&nbsp;<span class="ident" id="1811688">s</span>&nbsp;<span class="op" id="1811690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811694">if</span>&nbsp;<span class="ident" id="1811697">r</span>&nbsp;<span class="op" id="1811699">==</span>&nbsp;<span class="ident" id="1811702">RuneError</span>&nbsp;<span class="op" id="1811712">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811717">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811759">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811809">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1811859">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1811897">_</span><span class="op" id="1811898">,</span>&nbsp;<span class="ident" id="1811900">size</span>&nbsp;<span class="op" id="1811905">:=</span>&nbsp;<span class="ident" id="1811908">DecodeRuneInString</span><span class="op" id="1811926">(</span><span class="ident" id="1811927">s</span><span class="op" id="1811928">[</span><span class="ident" id="1811929">i</span><span class="op" id="1811930">:</span><span class="op" id="1811931">]</span><span class="op" id="1811932">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811937">if</span>&nbsp;<span class="ident" id="1811940">size</span>&nbsp;<span class="op" id="1811945">==</span>&nbsp;<span class="num" id="1811948">1</span>&nbsp;<span class="op" id="1811950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811956">return</span>&nbsp;<span class="builtintype" id="1811963">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1811979">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1811982">return</span>&nbsp;<span class="builtintype" id="1811989">true</span><br>
<span class="lineno"></span><span class="op" id="1811994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1811997">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1812061">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1812131">func</span>&nbsp;<span class="ident" id="1812136">ValidRune</span><span class="op" id="1812145">(</span><span class="ident" id="1812146">r</span>&nbsp;<span class="builtintype" id="1812148">rune</span><span class="op" id="1812152">)</span>&nbsp;<span class="builtintype" id="1812154">bool</span>&nbsp;<span class="op" id="1812159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812162">switch</span>&nbsp;<span class="op" id="1812169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812172">case</span>&nbsp;<span class="ident" id="1812177">r</span>&nbsp;<span class="op" id="1812179">&lt;</span>&nbsp;<span class="num" id="1812181">0</span><span class="op" id="1812182">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812186">return</span>&nbsp;<span class="builtintype" id="1812193">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812200">case</span>&nbsp;<span class="ident" id="1812205">surrogateMin</span>&nbsp;<span class="op" id="1812218">&lt;=</span>&nbsp;<span class="ident" id="1812221">r</span>&nbsp;<span class="op" id="1812223">&amp;&amp;</span>&nbsp;<span class="ident" id="1812226">r</span>&nbsp;<span class="op" id="1812228">&lt;=</span>&nbsp;<span class="ident" id="1812231">surrogateMax</span><span class="op" id="1812243">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812247">return</span>&nbsp;<span class="builtintype" id="1812254">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812261">case</span>&nbsp;<span class="ident" id="1812266">r</span>&nbsp;<span class="op" id="1812268">&gt;</span>&nbsp;<span class="ident" id="1812270">MaxRune</span><span class="op" id="1812277">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812281">return</span>&nbsp;<span class="builtintype" id="1812288">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1812295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1812298">return</span>&nbsp;<span class="builtintype" id="1812305">true</span><br>
<span class="lineno">445</span><span class="op" id="1812310">}</span>
</div>
</body>
</html>
