<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4977499">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4977554">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4977608">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4977659">package</span>&nbsp;<span class="ident" id="4977667">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4977673">import</span>&nbsp;<span class="op" id="4977680">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4977683">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4977701">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4977711">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4977718">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4977726">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4977740">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4977745">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="4977748">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="4977828">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4977894">const</span>&nbsp;<span class="op" id="4977900">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977903">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4977922">=</span>&nbsp;<span class="ident" id="4977924">flate</span><span class="op" id="4977929">.</span><span class="ident" id="4977930">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977945">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4977964">=</span>&nbsp;<span class="ident" id="4977966">flate</span><span class="op" id="4977971">.</span><span class="ident" id="4977972">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4977983">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4978002">=</span>&nbsp;<span class="ident" id="4978004">flate</span><span class="op" id="4978009">.</span><span class="ident" id="4978010">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978027">DefaultCompression</span>&nbsp;<span class="op" id="4978046">=</span>&nbsp;<span class="ident" id="4978048">flate</span><span class="op" id="4978053">.</span><span class="ident" id="4978054">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="4978073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4978076">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="4978110">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="4978165">type</span>&nbsp;<span class="ident" id="4978170">Writer</span>&nbsp;<span class="keyword" id="4978177">struct</span>&nbsp;<span class="op" id="4978184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978187">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978195">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4978207">io</span><span class="op" id="4978209">.</span><span class="ident" id="4978210">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978218">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978230">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978235">wroteHeader</span>&nbsp;<span class="builtintype" id="4978247">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978253">compressor</span>&nbsp;&nbsp;<span class="op" id="4978265">*</span><span class="ident" id="4978266">flate</span><span class="op" id="4978271">.</span><span class="ident" id="4978272">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978280">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4978292">hash</span><span class="op" id="4978296">.</span><span class="ident" id="4978297">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978305">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978317">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978325">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978337">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978343">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4978355">[</span><span class="num" id="4978356">10</span><span class="op" id="4978358">]</span><span class="builtintype" id="4978359">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978365">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4978377">error</span><br>
<span class="lineno"></span><span class="op" id="4978383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="4978386">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="4978421">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4978487">//</span><br>
<span class="lineno"></span><span class="comment" id="4978490">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="4978571">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="4978626">//</span><br>
<span class="lineno"></span><span class="comment" id="4978629">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4978703">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4978779">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="4978857">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="4978936">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="4978955">func</span>&nbsp;<span class="ident" id="4978960">NewWriter</span><span class="op" id="4978969">(</span><span class="ident" id="4978970">w</span>&nbsp;<span class="ident" id="4978972">io</span><span class="op" id="4978974">.</span><span class="ident" id="4978975">Writer</span><span class="op" id="4978981">)</span>&nbsp;<span class="op" id="4978983">*</span><span class="ident" id="4978984">Writer</span>&nbsp;<span class="op" id="4978991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4978994">z</span><span class="op" id="4978995">,</span>&nbsp;<span class="ident" id="4978997">_</span>&nbsp;<span class="op" id="4978999">:=</span>&nbsp;<span class="ident" id="4979002">NewWriterLevel</span><span class="op" id="4979016">(</span><span class="ident" id="4979017">w</span><span class="op" id="4979018">,</span>&nbsp;<span class="ident" id="4979020">DefaultCompression</span><span class="op" id="4979038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979041">return</span>&nbsp;<span class="ident" id="4979048">z</span><br>
<span class="lineno"></span><span class="op" id="4979050">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="4979053">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="4979133">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="4979168">//</span><br>
<span class="lineno"></span><span class="comment" id="4979171">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="4979245">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="4979321">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="4979368">func</span>&nbsp;<span class="ident" id="4979373">NewWriterLevel</span><span class="op" id="4979387">(</span><span class="ident" id="4979388">w</span>&nbsp;<span class="ident" id="4979390">io</span><span class="op" id="4979392">.</span><span class="ident" id="4979393">Writer</span><span class="op" id="4979399">,</span>&nbsp;<span class="ident" id="4979401">level</span>&nbsp;<span class="builtintype" id="4979407">int</span><span class="op" id="4979410">)</span>&nbsp;<span class="op" id="4979412">(</span><span class="op" id="4979413">*</span><span class="ident" id="4979414">Writer</span><span class="op" id="4979420">,</span>&nbsp;<span class="builtintype" id="4979422">error</span><span class="op" id="4979427">)</span>&nbsp;<span class="op" id="4979429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979432">if</span>&nbsp;<span class="ident" id="4979435">level</span>&nbsp;<span class="op" id="4979441">&lt;</span>&nbsp;<span class="ident" id="4979443">DefaultCompression</span>&nbsp;<span class="op" id="4979462">||</span>&nbsp;<span class="ident" id="4979465">level</span>&nbsp;<span class="op" id="4979471">&gt;</span>&nbsp;<span class="ident" id="4979473">BestCompression</span>&nbsp;<span class="op" id="4979489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979493">return</span>&nbsp;<span class="ident" id="4979500">nil</span><span class="op" id="4979503">,</span>&nbsp;<span class="ident" id="4979505">fmt</span><span class="op" id="4979508">.</span><span class="ident" id="4979509">Errorf</span><span class="op" id="4979515">(</span><span class="string" id="4979516">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="4979553">,</span>&nbsp;<span class="ident" id="4979555">level</span><span class="op" id="4979560">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979566">z</span>&nbsp;<span class="op" id="4979568">:=</span>&nbsp;<span class="builtinfunc" id="4979571">new</span><span class="op" id="4979574">(</span><span class="ident" id="4979575">Writer</span><span class="op" id="4979581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979584">z</span><span class="op" id="4979585">.</span><span class="ident" id="4979586">init</span><span class="op" id="4979590">(</span><span class="ident" id="4979591">w</span><span class="op" id="4979592">,</span>&nbsp;<span class="ident" id="4979594">level</span><span class="op" id="4979599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979602">return</span>&nbsp;<span class="ident" id="4979609">z</span><span class="op" id="4979610">,</span>&nbsp;<span class="ident" id="4979612">nil</span><br>
<span class="lineno"></span><span class="op" id="4979616">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4979619">func</span>&nbsp;<span class="op" id="4979624">(</span><span class="ident" id="4979625">z</span>&nbsp;<span class="op" id="4979627">*</span><span class="ident" id="4979628">Writer</span><span class="op" id="4979634">)</span>&nbsp;<span class="ident" id="4979636">init</span><span class="op" id="4979640">(</span><span class="ident" id="4979641">w</span>&nbsp;<span class="ident" id="4979643">io</span><span class="op" id="4979645">.</span><span class="ident" id="4979646">Writer</span><span class="op" id="4979652">,</span>&nbsp;<span class="ident" id="4979654">level</span>&nbsp;<span class="builtintype" id="4979660">int</span><span class="op" id="4979663">)</span>&nbsp;<span class="op" id="4979665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979668">digest</span>&nbsp;<span class="op" id="4979675">:=</span>&nbsp;<span class="ident" id="4979678">z</span><span class="op" id="4979679">.</span><span class="ident" id="4979680">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979688">if</span>&nbsp;<span class="ident" id="4979691">digest</span>&nbsp;<span class="op" id="4979698">!=</span>&nbsp;<span class="ident" id="4979701">nil</span>&nbsp;<span class="op" id="4979705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979709">digest</span><span class="op" id="4979715">.</span><span class="ident" id="4979716">Reset</span><span class="op" id="4979721">(</span><span class="op" id="4979722">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979725">}</span>&nbsp;<span class="keyword" id="4979727">else</span>&nbsp;<span class="op" id="4979732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979736">digest</span>&nbsp;<span class="op" id="4979743">=</span>&nbsp;<span class="ident" id="4979745">crc32</span><span class="op" id="4979750">.</span><span class="ident" id="4979751">NewIEEE</span><span class="op" id="4979758">(</span><span class="op" id="4979759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979765">compressor</span>&nbsp;<span class="op" id="4979776">:=</span>&nbsp;<span class="ident" id="4979779">z</span><span class="op" id="4979780">.</span><span class="ident" id="4979781">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4979793">if</span>&nbsp;<span class="ident" id="4979796">compressor</span>&nbsp;<span class="op" id="4979807">!=</span>&nbsp;<span class="ident" id="4979810">nil</span>&nbsp;<span class="op" id="4979814">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979818">compressor</span><span class="op" id="4979828">.</span><span class="ident" id="4979829">Reset</span><span class="op" id="4979834">(</span><span class="ident" id="4979835">w</span><span class="op" id="4979836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979842">*</span><span class="ident" id="4979843">z</span>&nbsp;<span class="op" id="4979845">=</span>&nbsp;<span class="ident" id="4979847">Writer</span><span class="op" id="4979853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979857">Header</span><span class="op" id="4979863">:</span>&nbsp;<span class="ident" id="4979865">Header</span><span class="op" id="4979871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979876">OS</span><span class="op" id="4979878">:</span>&nbsp;<span class="num" id="4979880">255</span><span class="op" id="4979883">,</span>&nbsp;<span class="comment" id="4979885">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979898">}</span><span class="op" id="4979899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979903">w</span><span class="op" id="4979904">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4979915">w</span><span class="op" id="4979916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979920">level</span><span class="op" id="4979925">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4979932">level</span><span class="op" id="4979937">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979941">digest</span><span class="op" id="4979947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4979953">digest</span><span class="op" id="4979959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4979963">compressor</span><span class="op" id="4979973">:</span>&nbsp;<span class="ident" id="4979975">compressor</span><span class="op" id="4979985">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4979988">}</span><br>
<span class="lineno"></span><span class="op" id="4979990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4979993">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4980063">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="4980133">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="4980200">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4980225">func</span>&nbsp;<span class="op" id="4980230">(</span><span class="ident" id="4980231">z</span>&nbsp;<span class="op" id="4980233">*</span><span class="ident" id="4980234">Writer</span><span class="op" id="4980240">)</span>&nbsp;<span class="ident" id="4980242">Reset</span><span class="op" id="4980247">(</span><span class="ident" id="4980248">w</span>&nbsp;<span class="ident" id="4980250">io</span><span class="op" id="4980252">.</span><span class="ident" id="4980253">Writer</span><span class="op" id="4980259">)</span>&nbsp;<span class="op" id="4980261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980264">z</span><span class="op" id="4980265">.</span><span class="ident" id="4980266">init</span><span class="op" id="4980270">(</span><span class="ident" id="4980271">w</span><span class="op" id="4980272">,</span>&nbsp;<span class="ident" id="4980274">z</span><span class="op" id="4980275">.</span><span class="ident" id="4980276">level</span><span class="op" id="4980281">)</span><br>
<span class="lineno"></span><span class="op" id="4980283">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="4980286">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4980347">func</span>&nbsp;<span class="ident" id="4980352">put2</span><span class="op" id="4980356">(</span><span class="ident" id="4980357">p</span>&nbsp;<span class="op" id="4980359">[</span><span class="op" id="4980360">]</span><span class="builtintype" id="4980361">byte</span><span class="op" id="4980365">,</span>&nbsp;<span class="ident" id="4980367">v</span>&nbsp;<span class="builtintype" id="4980369">uint16</span><span class="op" id="4980375">)</span>&nbsp;<span class="op" id="4980377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980380">p</span><span class="op" id="4980381">[</span><span class="num" id="4980382">0</span><span class="op" id="4980383">]</span>&nbsp;<span class="op" id="4980385">=</span>&nbsp;<span class="builtintype" id="4980387">uint8</span><span class="op" id="4980392">(</span><span class="ident" id="4980393">v</span>&nbsp;<span class="op" id="4980395">&gt;&gt;</span>&nbsp;<span class="num" id="4980398">0</span><span class="op" id="4980399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980402">p</span><span class="op" id="4980403">[</span><span class="num" id="4980404">1</span><span class="op" id="4980405">]</span>&nbsp;<span class="op" id="4980407">=</span>&nbsp;<span class="builtintype" id="4980409">uint8</span><span class="op" id="4980414">(</span><span class="ident" id="4980415">v</span>&nbsp;<span class="op" id="4980417">&gt;&gt;</span>&nbsp;<span class="num" id="4980420">8</span><span class="op" id="4980421">)</span><br>
<span class="lineno">105</span><span class="op" id="4980423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4980426">func</span>&nbsp;<span class="ident" id="4980431">put4</span><span class="op" id="4980435">(</span><span class="ident" id="4980436">p</span>&nbsp;<span class="op" id="4980438">[</span><span class="op" id="4980439">]</span><span class="builtintype" id="4980440">byte</span><span class="op" id="4980444">,</span>&nbsp;<span class="ident" id="4980446">v</span>&nbsp;<span class="builtintype" id="4980448">uint32</span><span class="op" id="4980454">)</span>&nbsp;<span class="op" id="4980456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980459">p</span><span class="op" id="4980460">[</span><span class="num" id="4980461">0</span><span class="op" id="4980462">]</span>&nbsp;<span class="op" id="4980464">=</span>&nbsp;<span class="builtintype" id="4980466">uint8</span><span class="op" id="4980471">(</span><span class="ident" id="4980472">v</span>&nbsp;<span class="op" id="4980474">&gt;&gt;</span>&nbsp;<span class="num" id="4980477">0</span><span class="op" id="4980478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980481">p</span><span class="op" id="4980482">[</span><span class="num" id="4980483">1</span><span class="op" id="4980484">]</span>&nbsp;<span class="op" id="4980486">=</span>&nbsp;<span class="builtintype" id="4980488">uint8</span><span class="op" id="4980493">(</span><span class="ident" id="4980494">v</span>&nbsp;<span class="op" id="4980496">&gt;&gt;</span>&nbsp;<span class="num" id="4980499">8</span><span class="op" id="4980500">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980503">p</span><span class="op" id="4980504">[</span><span class="num" id="4980505">2</span><span class="op" id="4980506">]</span>&nbsp;<span class="op" id="4980508">=</span>&nbsp;<span class="builtintype" id="4980510">uint8</span><span class="op" id="4980515">(</span><span class="ident" id="4980516">v</span>&nbsp;<span class="op" id="4980518">&gt;&gt;</span>&nbsp;<span class="num" id="4980521">16</span><span class="op" id="4980523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980526">p</span><span class="op" id="4980527">[</span><span class="num" id="4980528">3</span><span class="op" id="4980529">]</span>&nbsp;<span class="op" id="4980531">=</span>&nbsp;<span class="builtintype" id="4980533">uint8</span><span class="op" id="4980538">(</span><span class="ident" id="4980539">v</span>&nbsp;<span class="op" id="4980541">&gt;&gt;</span>&nbsp;<span class="num" id="4980544">24</span><span class="op" id="4980546">)</span><br>
<span class="lineno"></span><span class="op" id="4980548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4980551">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="4980609">func</span>&nbsp;<span class="op" id="4980614">(</span><span class="ident" id="4980615">z</span>&nbsp;<span class="op" id="4980617">*</span><span class="ident" id="4980618">Writer</span><span class="op" id="4980624">)</span>&nbsp;<span class="ident" id="4980626">writeBytes</span><span class="op" id="4980636">(</span><span class="ident" id="4980637">b</span>&nbsp;<span class="op" id="4980639">[</span><span class="op" id="4980640">]</span><span class="builtintype" id="4980641">byte</span><span class="op" id="4980645">)</span>&nbsp;<span class="builtintype" id="4980647">error</span>&nbsp;<span class="op" id="4980653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980656">if</span>&nbsp;<span class="builtinfunc" id="4980659">len</span><span class="op" id="4980662">(</span><span class="ident" id="4980663">b</span><span class="op" id="4980664">)</span>&nbsp;<span class="op" id="4980666">&gt;</span>&nbsp;<span class="num" id="4980668">0xffff</span>&nbsp;<span class="op" id="4980675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980679">return</span>&nbsp;<span class="ident" id="4980686">errors</span><span class="op" id="4980692">.</span><span class="ident" id="4980693">New</span><span class="op" id="4980696">(</span><span class="string" id="4980697">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="4980734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980740">put2</span><span class="op" id="4980744">(</span><span class="ident" id="4980745">z</span><span class="op" id="4980746">.</span><span class="ident" id="4980747">buf</span><span class="op" id="4980750">[</span><span class="num" id="4980751">0</span><span class="op" id="4980752">:</span><span class="num" id="4980753">2</span><span class="op" id="4980754">]</span><span class="op" id="4980755">,</span>&nbsp;<span class="builtintype" id="4980757">uint16</span><span class="op" id="4980763">(</span><span class="builtinfunc" id="4980764">len</span><span class="op" id="4980767">(</span><span class="ident" id="4980768">b</span><span class="op" id="4980769">)</span><span class="op" id="4980770">)</span><span class="op" id="4980771">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980774">_</span><span class="op" id="4980775">,</span>&nbsp;<span class="ident" id="4980777">err</span>&nbsp;<span class="op" id="4980781">:=</span>&nbsp;<span class="ident" id="4980784">z</span><span class="op" id="4980785">.</span><span class="ident" id="4980786">w</span><span class="op" id="4980787">.</span><span class="ident" id="4980788">Write</span><span class="op" id="4980793">(</span><span class="ident" id="4980794">z</span><span class="op" id="4980795">.</span><span class="ident" id="4980796">buf</span><span class="op" id="4980799">[</span><span class="num" id="4980800">0</span><span class="op" id="4980801">:</span><span class="num" id="4980802">2</span><span class="op" id="4980803">]</span><span class="op" id="4980804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980807">if</span>&nbsp;<span class="ident" id="4980810">err</span>&nbsp;<span class="op" id="4980814">!=</span>&nbsp;<span class="ident" id="4980817">nil</span>&nbsp;<span class="op" id="4980821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980825">return</span>&nbsp;<span class="ident" id="4980832">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4980837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4980840">_</span><span class="op" id="4980841">,</span>&nbsp;<span class="ident" id="4980843">err</span>&nbsp;<span class="op" id="4980847">=</span>&nbsp;<span class="ident" id="4980849">z</span><span class="op" id="4980850">.</span><span class="ident" id="4980851">w</span><span class="op" id="4980852">.</span><span class="ident" id="4980853">Write</span><span class="op" id="4980858">(</span><span class="ident" id="4980859">b</span><span class="op" id="4980860">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4980863">return</span>&nbsp;<span class="ident" id="4980870">err</span><br>
<span class="lineno"></span><span class="op" id="4980874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4980877">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="4980941">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="4981024">func</span>&nbsp;<span class="op" id="4981029">(</span><span class="ident" id="4981030">z</span>&nbsp;<span class="op" id="4981032">*</span><span class="ident" id="4981033">Writer</span><span class="op" id="4981039">)</span>&nbsp;<span class="ident" id="4981041">writeString</span><span class="op" id="4981052">(</span><span class="ident" id="4981053">s</span>&nbsp;<span class="builtintype" id="4981055">string</span><span class="op" id="4981061">)</span>&nbsp;<span class="op" id="4981063">(</span><span class="ident" id="4981064">err</span>&nbsp;<span class="builtintype" id="4981068">error</span><span class="op" id="4981073">)</span>&nbsp;<span class="op" id="4981075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981078">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981155">needconv</span>&nbsp;<span class="op" id="4981164">:=</span>&nbsp;<span class="builtintype" id="4981167">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981174">for</span>&nbsp;<span class="ident" id="4981178">_</span><span class="op" id="4981179">,</span>&nbsp;<span class="ident" id="4981181">v</span>&nbsp;<span class="op" id="4981183">:=</span>&nbsp;<span class="keyword" id="4981186">range</span>&nbsp;<span class="ident" id="4981192">s</span>&nbsp;<span class="op" id="4981194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981198">if</span>&nbsp;<span class="ident" id="4981201">v</span>&nbsp;<span class="op" id="4981203">==</span>&nbsp;<span class="num" id="4981206">0</span>&nbsp;<span class="op" id="4981208">||</span>&nbsp;<span class="ident" id="4981211">v</span>&nbsp;<span class="op" id="4981213">&gt;</span>&nbsp;<span class="num" id="4981215">0xff</span>&nbsp;<span class="op" id="4981220">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981225">return</span>&nbsp;<span class="ident" id="4981232">errors</span><span class="op" id="4981238">.</span><span class="ident" id="4981239">New</span><span class="op" id="4981242">(</span><span class="string" id="4981243">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="4981282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981290">if</span>&nbsp;<span class="ident" id="4981293">v</span>&nbsp;<span class="op" id="4981295">&gt;</span>&nbsp;<span class="num" id="4981297">0x7f</span>&nbsp;<span class="op" id="4981302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981307">needconv</span>&nbsp;<span class="op" id="4981316">=</span>&nbsp;<span class="builtintype" id="4981318">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981325">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981331">if</span>&nbsp;<span class="ident" id="4981334">needconv</span>&nbsp;<span class="op" id="4981343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981347">b</span>&nbsp;<span class="op" id="4981349">:=</span>&nbsp;<span class="builtinfunc" id="4981352">make</span><span class="op" id="4981356">(</span><span class="op" id="4981357">[</span><span class="op" id="4981358">]</span><span class="builtintype" id="4981359">byte</span><span class="op" id="4981363">,</span>&nbsp;<span class="num" id="4981365">0</span><span class="op" id="4981366">,</span>&nbsp;<span class="builtinfunc" id="4981368">len</span><span class="op" id="4981371">(</span><span class="ident" id="4981372">s</span><span class="op" id="4981373">)</span><span class="op" id="4981374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981378">for</span>&nbsp;<span class="ident" id="4981382">_</span><span class="op" id="4981383">,</span>&nbsp;<span class="ident" id="4981385">v</span>&nbsp;<span class="op" id="4981387">:=</span>&nbsp;<span class="keyword" id="4981390">range</span>&nbsp;<span class="ident" id="4981396">s</span>&nbsp;<span class="op" id="4981398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981403">b</span>&nbsp;<span class="op" id="4981405">=</span>&nbsp;<span class="builtinfunc" id="4981407">append</span><span class="op" id="4981413">(</span><span class="ident" id="4981414">b</span><span class="op" id="4981415">,</span>&nbsp;<span class="builtintype" id="4981417">byte</span><span class="op" id="4981421">(</span><span class="ident" id="4981422">v</span><span class="op" id="4981423">)</span><span class="op" id="4981424">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981432">_</span><span class="op" id="4981433">,</span>&nbsp;<span class="ident" id="4981435">err</span>&nbsp;<span class="op" id="4981439">=</span>&nbsp;<span class="ident" id="4981441">z</span><span class="op" id="4981442">.</span><span class="ident" id="4981443">w</span><span class="op" id="4981444">.</span><span class="ident" id="4981445">Write</span><span class="op" id="4981450">(</span><span class="ident" id="4981451">b</span><span class="op" id="4981452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981455">}</span>&nbsp;<span class="keyword" id="4981457">else</span>&nbsp;<span class="op" id="4981462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981466">_</span><span class="op" id="4981467">,</span>&nbsp;<span class="ident" id="4981469">err</span>&nbsp;<span class="op" id="4981473">=</span>&nbsp;<span class="ident" id="4981475">io</span><span class="op" id="4981477">.</span><span class="ident" id="4981478">WriteString</span><span class="op" id="4981489">(</span><span class="ident" id="4981490">z</span><span class="op" id="4981491">.</span><span class="ident" id="4981492">w</span><span class="op" id="4981493">,</span>&nbsp;<span class="ident" id="4981495">s</span><span class="op" id="4981496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981499">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981502">if</span>&nbsp;<span class="ident" id="4981505">err</span>&nbsp;<span class="op" id="4981509">!=</span>&nbsp;<span class="ident" id="4981512">nil</span>&nbsp;<span class="op" id="4981516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981520">return</span>&nbsp;<span class="ident" id="4981527">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981535">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981572">z</span><span class="op" id="4981573">.</span><span class="ident" id="4981574">buf</span><span class="op" id="4981577">[</span><span class="num" id="4981578">0</span><span class="op" id="4981579">]</span>&nbsp;<span class="op" id="4981581">=</span>&nbsp;<span class="num" id="4981583">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981586">_</span><span class="op" id="4981587">,</span>&nbsp;<span class="ident" id="4981589">err</span>&nbsp;<span class="op" id="4981593">=</span>&nbsp;<span class="ident" id="4981595">z</span><span class="op" id="4981596">.</span><span class="ident" id="4981597">w</span><span class="op" id="4981598">.</span><span class="ident" id="4981599">Write</span><span class="op" id="4981604">(</span><span class="ident" id="4981605">z</span><span class="op" id="4981606">.</span><span class="ident" id="4981607">buf</span><span class="op" id="4981610">[</span><span class="num" id="4981611">0</span><span class="op" id="4981612">:</span><span class="num" id="4981613">1</span><span class="op" id="4981614">]</span><span class="op" id="4981615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981618">return</span>&nbsp;<span class="ident" id="4981625">err</span><br>
<span class="lineno"></span><span class="op" id="4981629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4981632">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="4981704">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="4981780">func</span>&nbsp;<span class="op" id="4981785">(</span><span class="ident" id="4981786">z</span>&nbsp;<span class="op" id="4981788">*</span><span class="ident" id="4981789">Writer</span><span class="op" id="4981795">)</span>&nbsp;<span class="ident" id="4981797">Write</span><span class="op" id="4981802">(</span><span class="ident" id="4981803">p</span>&nbsp;<span class="op" id="4981805">[</span><span class="op" id="4981806">]</span><span class="builtintype" id="4981807">byte</span><span class="op" id="4981811">)</span>&nbsp;<span class="op" id="4981813">(</span><span class="builtintype" id="4981814">int</span><span class="op" id="4981817">,</span>&nbsp;<span class="builtintype" id="4981819">error</span><span class="op" id="4981824">)</span>&nbsp;<span class="op" id="4981826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981829">if</span>&nbsp;<span class="ident" id="4981832">z</span><span class="op" id="4981833">.</span><span class="ident" id="4981834">err</span>&nbsp;<span class="op" id="4981838">!=</span>&nbsp;<span class="ident" id="4981841">nil</span>&nbsp;<span class="op" id="4981845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981849">return</span>&nbsp;<span class="num" id="4981856">0</span><span class="op" id="4981857">,</span>&nbsp;<span class="ident" id="4981859">z</span><span class="op" id="4981860">.</span><span class="ident" id="4981861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4981866">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981869">var</span>&nbsp;<span class="ident" id="4981873">n</span>&nbsp;<span class="builtintype" id="4981875">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4981880">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4981914">if</span>&nbsp;<span class="op" id="4981917">!</span><span class="ident" id="4981918">z</span><span class="op" id="4981919">.</span><span class="ident" id="4981920">wroteHeader</span>&nbsp;<span class="op" id="4981932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981936">z</span><span class="op" id="4981937">.</span><span class="ident" id="4981938">wroteHeader</span>&nbsp;<span class="op" id="4981950">=</span>&nbsp;<span class="builtintype" id="4981952">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981959">z</span><span class="op" id="4981960">.</span><span class="ident" id="4981961">buf</span><span class="op" id="4981964">[</span><span class="num" id="4981965">0</span><span class="op" id="4981966">]</span>&nbsp;<span class="op" id="4981968">=</span>&nbsp;<span class="ident" id="4981970">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4981980">z</span><span class="op" id="4981981">.</span><span class="ident" id="4981982">buf</span><span class="op" id="4981985">[</span><span class="num" id="4981986">1</span><span class="op" id="4981987">]</span>&nbsp;<span class="op" id="4981989">=</span>&nbsp;<span class="ident" id="4981991">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982001">z</span><span class="op" id="4982002">.</span><span class="ident" id="4982003">buf</span><span class="op" id="4982006">[</span><span class="num" id="4982007">2</span><span class="op" id="4982008">]</span>&nbsp;<span class="op" id="4982010">=</span>&nbsp;<span class="ident" id="4982012">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982026">z</span><span class="op" id="4982027">.</span><span class="ident" id="4982028">buf</span><span class="op" id="4982031">[</span><span class="num" id="4982032">3</span><span class="op" id="4982033">]</span>&nbsp;<span class="op" id="4982035">=</span>&nbsp;<span class="num" id="4982037">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982041">if</span>&nbsp;<span class="ident" id="4982044">z</span><span class="op" id="4982045">.</span><span class="ident" id="4982046">Extra</span>&nbsp;<span class="op" id="4982052">!=</span>&nbsp;<span class="ident" id="4982055">nil</span>&nbsp;<span class="op" id="4982059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982064">z</span><span class="op" id="4982065">.</span><span class="ident" id="4982066">buf</span><span class="op" id="4982069">[</span><span class="num" id="4982070">3</span><span class="op" id="4982071">]</span>&nbsp;<span class="op" id="4982073">|=</span>&nbsp;<span class="num" id="4982076">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982087">if</span>&nbsp;<span class="ident" id="4982090">z</span><span class="op" id="4982091">.</span><span class="ident" id="4982092">Name</span>&nbsp;<span class="op" id="4982097">!=</span>&nbsp;<span class="string" id="4982100">&#34;&#34;</span>&nbsp;<span class="op" id="4982103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982108">z</span><span class="op" id="4982109">.</span><span class="ident" id="4982110">buf</span><span class="op" id="4982113">[</span><span class="num" id="4982114">3</span><span class="op" id="4982115">]</span>&nbsp;<span class="op" id="4982117">|=</span>&nbsp;<span class="num" id="4982120">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982131">if</span>&nbsp;<span class="ident" id="4982134">z</span><span class="op" id="4982135">.</span><span class="ident" id="4982136">Comment</span>&nbsp;<span class="op" id="4982144">!=</span>&nbsp;<span class="string" id="4982147">&#34;&#34;</span>&nbsp;<span class="op" id="4982150">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982155">z</span><span class="op" id="4982156">.</span><span class="ident" id="4982157">buf</span><span class="op" id="4982160">[</span><span class="num" id="4982161">3</span><span class="op" id="4982162">]</span>&nbsp;<span class="op" id="4982164">|=</span>&nbsp;<span class="num" id="4982167">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982178">put4</span><span class="op" id="4982182">(</span><span class="ident" id="4982183">z</span><span class="op" id="4982184">.</span><span class="ident" id="4982185">buf</span><span class="op" id="4982188">[</span><span class="num" id="4982189">4</span><span class="op" id="4982190">:</span><span class="num" id="4982191">8</span><span class="op" id="4982192">]</span><span class="op" id="4982193">,</span>&nbsp;<span class="builtintype" id="4982195">uint32</span><span class="op" id="4982201">(</span><span class="ident" id="4982202">z</span><span class="op" id="4982203">.</span><span class="ident" id="4982204">ModTime</span><span class="op" id="4982211">.</span><span class="ident" id="4982212">Unix</span><span class="op" id="4982216">(</span><span class="op" id="4982217">)</span><span class="op" id="4982218">)</span><span class="op" id="4982219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982223">if</span>&nbsp;<span class="ident" id="4982226">z</span><span class="op" id="4982227">.</span><span class="ident" id="4982228">level</span>&nbsp;<span class="op" id="4982234">==</span>&nbsp;<span class="ident" id="4982237">BestCompression</span>&nbsp;<span class="op" id="4982253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982258">z</span><span class="op" id="4982259">.</span><span class="ident" id="4982260">buf</span><span class="op" id="4982263">[</span><span class="num" id="4982264">8</span><span class="op" id="4982265">]</span>&nbsp;<span class="op" id="4982267">=</span>&nbsp;<span class="num" id="4982269">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982273">}</span>&nbsp;<span class="keyword" id="4982275">else</span>&nbsp;<span class="keyword" id="4982280">if</span>&nbsp;<span class="ident" id="4982283">z</span><span class="op" id="4982284">.</span><span class="ident" id="4982285">level</span>&nbsp;<span class="op" id="4982291">==</span>&nbsp;<span class="ident" id="4982294">BestSpeed</span>&nbsp;<span class="op" id="4982304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982309">z</span><span class="op" id="4982310">.</span><span class="ident" id="4982311">buf</span><span class="op" id="4982314">[</span><span class="num" id="4982315">8</span><span class="op" id="4982316">]</span>&nbsp;<span class="op" id="4982318">=</span>&nbsp;<span class="num" id="4982320">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982324">}</span>&nbsp;<span class="keyword" id="4982326">else</span>&nbsp;<span class="op" id="4982331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982336">z</span><span class="op" id="4982337">.</span><span class="ident" id="4982338">buf</span><span class="op" id="4982341">[</span><span class="num" id="4982342">8</span><span class="op" id="4982343">]</span>&nbsp;<span class="op" id="4982345">=</span>&nbsp;<span class="num" id="4982347">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982351">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982355">z</span><span class="op" id="4982356">.</span><span class="ident" id="4982357">buf</span><span class="op" id="4982360">[</span><span class="num" id="4982361">9</span><span class="op" id="4982362">]</span>&nbsp;<span class="op" id="4982364">=</span>&nbsp;<span class="ident" id="4982366">z</span><span class="op" id="4982367">.</span><span class="ident" id="4982368">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982373">n</span><span class="op" id="4982374">,</span>&nbsp;<span class="ident" id="4982376">z</span><span class="op" id="4982377">.</span><span class="ident" id="4982378">err</span>&nbsp;<span class="op" id="4982382">=</span>&nbsp;<span class="ident" id="4982384">z</span><span class="op" id="4982385">.</span><span class="ident" id="4982386">w</span><span class="op" id="4982387">.</span><span class="ident" id="4982388">Write</span><span class="op" id="4982393">(</span><span class="ident" id="4982394">z</span><span class="op" id="4982395">.</span><span class="ident" id="4982396">buf</span><span class="op" id="4982399">[</span><span class="num" id="4982400">0</span><span class="op" id="4982401">:</span><span class="num" id="4982402">10</span><span class="op" id="4982404">]</span><span class="op" id="4982405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982409">if</span>&nbsp;<span class="ident" id="4982412">z</span><span class="op" id="4982413">.</span><span class="ident" id="4982414">err</span>&nbsp;<span class="op" id="4982418">!=</span>&nbsp;<span class="ident" id="4982421">nil</span>&nbsp;<span class="op" id="4982425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982430">return</span>&nbsp;<span class="ident" id="4982437">n</span><span class="op" id="4982438">,</span>&nbsp;<span class="ident" id="4982440">z</span><span class="op" id="4982441">.</span><span class="ident" id="4982442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982448">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982452">if</span>&nbsp;<span class="ident" id="4982455">z</span><span class="op" id="4982456">.</span><span class="ident" id="4982457">Extra</span>&nbsp;<span class="op" id="4982463">!=</span>&nbsp;<span class="ident" id="4982466">nil</span>&nbsp;<span class="op" id="4982470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982475">z</span><span class="op" id="4982476">.</span><span class="ident" id="4982477">err</span>&nbsp;<span class="op" id="4982481">=</span>&nbsp;<span class="ident" id="4982483">z</span><span class="op" id="4982484">.</span><span class="ident" id="4982485">writeBytes</span><span class="op" id="4982495">(</span><span class="ident" id="4982496">z</span><span class="op" id="4982497">.</span><span class="ident" id="4982498">Extra</span><span class="op" id="4982503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982508">if</span>&nbsp;<span class="ident" id="4982511">z</span><span class="op" id="4982512">.</span><span class="ident" id="4982513">err</span>&nbsp;<span class="op" id="4982517">!=</span>&nbsp;<span class="ident" id="4982520">nil</span>&nbsp;<span class="op" id="4982524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982530">return</span>&nbsp;<span class="ident" id="4982537">n</span><span class="op" id="4982538">,</span>&nbsp;<span class="ident" id="4982540">z</span><span class="op" id="4982541">.</span><span class="ident" id="4982542">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982549">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982557">if</span>&nbsp;<span class="ident" id="4982560">z</span><span class="op" id="4982561">.</span><span class="ident" id="4982562">Name</span>&nbsp;<span class="op" id="4982567">!=</span>&nbsp;<span class="string" id="4982570">&#34;&#34;</span>&nbsp;<span class="op" id="4982573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982578">z</span><span class="op" id="4982579">.</span><span class="ident" id="4982580">err</span>&nbsp;<span class="op" id="4982584">=</span>&nbsp;<span class="ident" id="4982586">z</span><span class="op" id="4982587">.</span><span class="ident" id="4982588">writeString</span><span class="op" id="4982599">(</span><span class="ident" id="4982600">z</span><span class="op" id="4982601">.</span><span class="ident" id="4982602">Name</span><span class="op" id="4982606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982611">if</span>&nbsp;<span class="ident" id="4982614">z</span><span class="op" id="4982615">.</span><span class="ident" id="4982616">err</span>&nbsp;<span class="op" id="4982620">!=</span>&nbsp;<span class="ident" id="4982623">nil</span>&nbsp;<span class="op" id="4982627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982633">return</span>&nbsp;<span class="ident" id="4982640">n</span><span class="op" id="4982641">,</span>&nbsp;<span class="ident" id="4982643">z</span><span class="op" id="4982644">.</span><span class="ident" id="4982645">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982660">if</span>&nbsp;<span class="ident" id="4982663">z</span><span class="op" id="4982664">.</span><span class="ident" id="4982665">Comment</span>&nbsp;<span class="op" id="4982673">!=</span>&nbsp;<span class="string" id="4982676">&#34;&#34;</span>&nbsp;<span class="op" id="4982679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982684">z</span><span class="op" id="4982685">.</span><span class="ident" id="4982686">err</span>&nbsp;<span class="op" id="4982690">=</span>&nbsp;<span class="ident" id="4982692">z</span><span class="op" id="4982693">.</span><span class="ident" id="4982694">writeString</span><span class="op" id="4982705">(</span><span class="ident" id="4982706">z</span><span class="op" id="4982707">.</span><span class="ident" id="4982708">Comment</span><span class="op" id="4982715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982720">if</span>&nbsp;<span class="ident" id="4982723">z</span><span class="op" id="4982724">.</span><span class="ident" id="4982725">err</span>&nbsp;<span class="op" id="4982729">!=</span>&nbsp;<span class="ident" id="4982732">nil</span>&nbsp;<span class="op" id="4982736">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982742">return</span>&nbsp;<span class="ident" id="4982749">n</span><span class="op" id="4982750">,</span>&nbsp;<span class="ident" id="4982752">z</span><span class="op" id="4982753">.</span><span class="ident" id="4982754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982769">if</span>&nbsp;<span class="ident" id="4982772">z</span><span class="op" id="4982773">.</span><span class="ident" id="4982774">compressor</span>&nbsp;<span class="op" id="4982785">==</span>&nbsp;<span class="ident" id="4982788">nil</span>&nbsp;<span class="op" id="4982792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982797">z</span><span class="op" id="4982798">.</span><span class="ident" id="4982799">compressor</span><span class="op" id="4982809">,</span>&nbsp;<span class="ident" id="4982811">_</span>&nbsp;<span class="op" id="4982813">=</span>&nbsp;<span class="ident" id="4982815">flate</span><span class="op" id="4982820">.</span><span class="ident" id="4982821">NewWriter</span><span class="op" id="4982830">(</span><span class="ident" id="4982831">z</span><span class="op" id="4982832">.</span><span class="ident" id="4982833">w</span><span class="op" id="4982834">,</span>&nbsp;<span class="ident" id="4982836">z</span><span class="op" id="4982837">.</span><span class="ident" id="4982838">level</span><span class="op" id="4982843">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4982850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982853">z</span><span class="op" id="4982854">.</span><span class="ident" id="4982855">size</span>&nbsp;<span class="op" id="4982860">+=</span>&nbsp;<span class="builtintype" id="4982863">uint32</span><span class="op" id="4982869">(</span><span class="builtinfunc" id="4982870">len</span><span class="op" id="4982873">(</span><span class="ident" id="4982874">p</span><span class="op" id="4982875">)</span><span class="op" id="4982876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982879">z</span><span class="op" id="4982880">.</span><span class="ident" id="4982881">digest</span><span class="op" id="4982887">.</span><span class="ident" id="4982888">Write</span><span class="op" id="4982893">(</span><span class="ident" id="4982894">p</span><span class="op" id="4982895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4982898">n</span><span class="op" id="4982899">,</span>&nbsp;<span class="ident" id="4982901">z</span><span class="op" id="4982902">.</span><span class="ident" id="4982903">err</span>&nbsp;<span class="op" id="4982907">=</span>&nbsp;<span class="ident" id="4982909">z</span><span class="op" id="4982910">.</span><span class="ident" id="4982911">compressor</span><span class="op" id="4982921">.</span><span class="ident" id="4982922">Write</span><span class="op" id="4982927">(</span><span class="ident" id="4982928">p</span><span class="op" id="4982929">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4982932">return</span>&nbsp;<span class="ident" id="4982939">n</span><span class="op" id="4982940">,</span>&nbsp;<span class="ident" id="4982942">z</span><span class="op" id="4982943">.</span><span class="ident" id="4982944">err</span><br>
<span class="lineno"></span><span class="op" id="4982948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4982951">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="4983022">//</span><br>
<span class="lineno">225</span><span class="comment" id="4983025">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4983096">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="4983167">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4983232">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4983286">//</span><br>
<span class="lineno">230</span><span class="comment" id="4983289">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="4983369">func</span>&nbsp;<span class="op" id="4983374">(</span><span class="ident" id="4983375">z</span>&nbsp;<span class="op" id="4983377">*</span><span class="ident" id="4983378">Writer</span><span class="op" id="4983384">)</span>&nbsp;<span class="ident" id="4983386">Flush</span><span class="op" id="4983391">(</span><span class="op" id="4983392">)</span>&nbsp;<span class="builtintype" id="4983394">error</span>&nbsp;<span class="op" id="4983400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983403">if</span>&nbsp;<span class="ident" id="4983406">z</span><span class="op" id="4983407">.</span><span class="ident" id="4983408">err</span>&nbsp;<span class="op" id="4983412">!=</span>&nbsp;<span class="ident" id="4983415">nil</span>&nbsp;<span class="op" id="4983419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983423">return</span>&nbsp;<span class="ident" id="4983430">z</span><span class="op" id="4983431">.</span><span class="ident" id="4983432">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983437">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983440">if</span>&nbsp;<span class="ident" id="4983443">z</span><span class="op" id="4983444">.</span><span class="ident" id="4983445">closed</span>&nbsp;<span class="op" id="4983452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983456">return</span>&nbsp;<span class="ident" id="4983463">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983471">if</span>&nbsp;<span class="op" id="4983474">!</span><span class="ident" id="4983475">z</span><span class="op" id="4983476">.</span><span class="ident" id="4983477">wroteHeader</span>&nbsp;<span class="op" id="4983489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983493">z</span><span class="op" id="4983494">.</span><span class="ident" id="4983495">Write</span><span class="op" id="4983500">(</span><span class="ident" id="4983501">nil</span><span class="op" id="4983504">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983508">if</span>&nbsp;<span class="ident" id="4983511">z</span><span class="op" id="4983512">.</span><span class="ident" id="4983513">err</span>&nbsp;<span class="op" id="4983517">!=</span>&nbsp;<span class="ident" id="4983520">nil</span>&nbsp;<span class="op" id="4983524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983529">return</span>&nbsp;<span class="ident" id="4983536">z</span><span class="op" id="4983537">.</span><span class="ident" id="4983538">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983550">z</span><span class="op" id="4983551">.</span><span class="ident" id="4983552">err</span>&nbsp;<span class="op" id="4983556">=</span>&nbsp;<span class="ident" id="4983558">z</span><span class="op" id="4983559">.</span><span class="ident" id="4983560">compressor</span><span class="op" id="4983570">.</span><span class="ident" id="4983571">Flush</span><span class="op" id="4983576">(</span><span class="op" id="4983577">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983580">return</span>&nbsp;<span class="ident" id="4983587">z</span><span class="op" id="4983588">.</span><span class="ident" id="4983589">err</span><br>
<span class="lineno"></span><span class="op" id="4983593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4983596">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4983670">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="4983729">func</span>&nbsp;<span class="op" id="4983734">(</span><span class="ident" id="4983735">z</span>&nbsp;<span class="op" id="4983737">*</span><span class="ident" id="4983738">Writer</span><span class="op" id="4983744">)</span>&nbsp;<span class="ident" id="4983746">Close</span><span class="op" id="4983751">(</span><span class="op" id="4983752">)</span>&nbsp;<span class="builtintype" id="4983754">error</span>&nbsp;<span class="op" id="4983760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983763">if</span>&nbsp;<span class="ident" id="4983766">z</span><span class="op" id="4983767">.</span><span class="ident" id="4983768">err</span>&nbsp;<span class="op" id="4983772">!=</span>&nbsp;<span class="ident" id="4983775">nil</span>&nbsp;<span class="op" id="4983779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983783">return</span>&nbsp;<span class="ident" id="4983790">z</span><span class="op" id="4983791">.</span><span class="ident" id="4983792">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983800">if</span>&nbsp;<span class="ident" id="4983803">z</span><span class="op" id="4983804">.</span><span class="ident" id="4983805">closed</span>&nbsp;<span class="op" id="4983812">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983816">return</span>&nbsp;<span class="ident" id="4983823">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983831">z</span><span class="op" id="4983832">.</span><span class="ident" id="4983833">closed</span>&nbsp;<span class="op" id="4983840">=</span>&nbsp;<span class="builtintype" id="4983842">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983848">if</span>&nbsp;<span class="op" id="4983851">!</span><span class="ident" id="4983852">z</span><span class="op" id="4983853">.</span><span class="ident" id="4983854">wroteHeader</span>&nbsp;<span class="op" id="4983866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983870">z</span><span class="op" id="4983871">.</span><span class="ident" id="4983872">Write</span><span class="op" id="4983877">(</span><span class="ident" id="4983878">nil</span><span class="op" id="4983881">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983885">if</span>&nbsp;<span class="ident" id="4983888">z</span><span class="op" id="4983889">.</span><span class="ident" id="4983890">err</span>&nbsp;<span class="op" id="4983894">!=</span>&nbsp;<span class="ident" id="4983897">nil</span>&nbsp;<span class="op" id="4983901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983906">return</span>&nbsp;<span class="ident" id="4983913">z</span><span class="op" id="4983914">.</span><span class="ident" id="4983915">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983927">z</span><span class="op" id="4983928">.</span><span class="ident" id="4983929">err</span>&nbsp;<span class="op" id="4983933">=</span>&nbsp;<span class="ident" id="4983935">z</span><span class="op" id="4983936">.</span><span class="ident" id="4983937">compressor</span><span class="op" id="4983947">.</span><span class="ident" id="4983948">Close</span><span class="op" id="4983953">(</span><span class="op" id="4983954">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983957">if</span>&nbsp;<span class="ident" id="4983960">z</span><span class="op" id="4983961">.</span><span class="ident" id="4983962">err</span>&nbsp;<span class="op" id="4983966">!=</span>&nbsp;<span class="ident" id="4983969">nil</span>&nbsp;<span class="op" id="4983973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4983977">return</span>&nbsp;<span class="ident" id="4983984">z</span><span class="op" id="4983985">.</span><span class="ident" id="4983986">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4983991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4983994">put4</span><span class="op" id="4983998">(</span><span class="ident" id="4983999">z</span><span class="op" id="4984000">.</span><span class="ident" id="4984001">buf</span><span class="op" id="4984004">[</span><span class="num" id="4984005">0</span><span class="op" id="4984006">:</span><span class="num" id="4984007">4</span><span class="op" id="4984008">]</span><span class="op" id="4984009">,</span>&nbsp;<span class="ident" id="4984011">z</span><span class="op" id="4984012">.</span><span class="ident" id="4984013">digest</span><span class="op" id="4984019">.</span><span class="ident" id="4984020">Sum32</span><span class="op" id="4984025">(</span><span class="op" id="4984026">)</span><span class="op" id="4984027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984030">put4</span><span class="op" id="4984034">(</span><span class="ident" id="4984035">z</span><span class="op" id="4984036">.</span><span class="ident" id="4984037">buf</span><span class="op" id="4984040">[</span><span class="num" id="4984041">4</span><span class="op" id="4984042">:</span><span class="num" id="4984043">8</span><span class="op" id="4984044">]</span><span class="op" id="4984045">,</span>&nbsp;<span class="ident" id="4984047">z</span><span class="op" id="4984048">.</span><span class="ident" id="4984049">size</span><span class="op" id="4984053">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4984056">_</span><span class="op" id="4984057">,</span>&nbsp;<span class="ident" id="4984059">z</span><span class="op" id="4984060">.</span><span class="ident" id="4984061">err</span>&nbsp;<span class="op" id="4984065">=</span>&nbsp;<span class="ident" id="4984067">z</span><span class="op" id="4984068">.</span><span class="ident" id="4984069">w</span><span class="op" id="4984070">.</span><span class="ident" id="4984071">Write</span><span class="op" id="4984076">(</span><span class="ident" id="4984077">z</span><span class="op" id="4984078">.</span><span class="ident" id="4984079">buf</span><span class="op" id="4984082">[</span><span class="num" id="4984083">0</span><span class="op" id="4984084">:</span><span class="num" id="4984085">8</span><span class="op" id="4984086">]</span><span class="op" id="4984087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4984090">return</span>&nbsp;<span class="ident" id="4984097">z</span><span class="op" id="4984098">.</span><span class="ident" id="4984099">err</span><br>
<span class="lineno"></span><span class="op" id="4984103">}</span>
</div>
</body>
</html>
