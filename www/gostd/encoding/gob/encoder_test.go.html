<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8095904">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8095959">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8096013">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8096064">package</span>&nbsp;<span class="ident" id="8096072">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8096077">import</span>&nbsp;<span class="op" id="8096084">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8096087">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8096096">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8096103">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8096109">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8096120">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8096131">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8096141">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8096144">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="8096187">func</span>&nbsp;<span class="ident" id="8096192">TestBasicEncoderDecoder</span><span class="op" id="8096215">(</span><span class="ident" id="8096216">t</span>&nbsp;<span class="op" id="8096218">*</span><span class="ident" id="8096219">testing</span><span class="op" id="8096226">.</span><span class="ident" id="8096227">T</span><span class="op" id="8096228">)</span>&nbsp;<span class="op" id="8096230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096233">var</span>&nbsp;<span class="ident" id="8096237">values</span>&nbsp;<span class="op" id="8096244">=</span>&nbsp;<span class="op" id="8096246">[</span><span class="op" id="8096247">]</span><span class="keyword" id="8096248">interface</span><span class="op" id="8096257">{</span><span class="op" id="8096258">}</span><span class="op" id="8096259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096263">true</span><span class="op" id="8096267">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096271">int</span><span class="op" id="8096274">(</span><span class="num" id="8096275">123</span><span class="op" id="8096278">)</span><span class="op" id="8096279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096283">int8</span><span class="op" id="8096287">(</span><span class="num" id="8096288">123</span><span class="op" id="8096291">)</span><span class="op" id="8096292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096296">int16</span><span class="op" id="8096301">(</span><span class="op" id="8096302">-</span><span class="num" id="8096303">12345</span><span class="op" id="8096308">)</span><span class="op" id="8096309">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096313">int32</span><span class="op" id="8096318">(</span><span class="num" id="8096319">123456</span><span class="op" id="8096325">)</span><span class="op" id="8096326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096330">int64</span><span class="op" id="8096335">(</span><span class="op" id="8096336">-</span><span class="num" id="8096337">1234567</span><span class="op" id="8096344">)</span><span class="op" id="8096345">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096349">uint</span><span class="op" id="8096353">(</span><span class="num" id="8096354">123</span><span class="op" id="8096357">)</span><span class="op" id="8096358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096362">uint8</span><span class="op" id="8096367">(</span><span class="num" id="8096368">123</span><span class="op" id="8096371">)</span><span class="op" id="8096372">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096376">uint16</span><span class="op" id="8096382">(</span><span class="num" id="8096383">12345</span><span class="op" id="8096388">)</span><span class="op" id="8096389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096393">uint32</span><span class="op" id="8096399">(</span><span class="num" id="8096400">123456</span><span class="op" id="8096406">)</span><span class="op" id="8096407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096411">uint64</span><span class="op" id="8096417">(</span><span class="num" id="8096418">1234567</span><span class="op" id="8096425">)</span><span class="op" id="8096426">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096430">uintptr</span><span class="op" id="8096437">(</span><span class="num" id="8096438">12345678</span><span class="op" id="8096446">)</span><span class="op" id="8096447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096451">float32</span><span class="op" id="8096458">(</span><span class="num" id="8096459">1.2345</span><span class="op" id="8096465">)</span><span class="op" id="8096466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096470">float64</span><span class="op" id="8096477">(</span><span class="num" id="8096478">1.2345678</span><span class="op" id="8096487">)</span><span class="op" id="8096488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096492">complex64</span><span class="op" id="8096501">(</span><span class="num" id="8096502">1.2345</span>&nbsp;<span class="op" id="8096509">+</span>&nbsp;<span class="num" id="8096511">2.3456i</span><span class="op" id="8096518">)</span><span class="op" id="8096519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096523">complex128</span><span class="op" id="8096533">(</span><span class="num" id="8096534">1.2345678</span>&nbsp;<span class="op" id="8096544">+</span>&nbsp;<span class="num" id="8096546">2.3456789i</span><span class="op" id="8096556">)</span><span class="op" id="8096557">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8096561">[</span><span class="op" id="8096562">]</span><span class="builtintype" id="8096563">byte</span><span class="op" id="8096567">(</span><span class="string" id="8096568">&#34;hello&#34;</span><span class="op" id="8096575">)</span><span class="op" id="8096576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="8096580">string</span><span class="op" id="8096586">(</span><span class="string" id="8096587">&#34;hello&#34;</span><span class="op" id="8096594">)</span><span class="op" id="8096595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8096598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096601">for</span>&nbsp;<span class="ident" id="8096605">_</span><span class="op" id="8096606">,</span>&nbsp;<span class="ident" id="8096608">value</span>&nbsp;<span class="op" id="8096614">:=</span>&nbsp;<span class="keyword" id="8096617">range</span>&nbsp;<span class="ident" id="8096623">values</span>&nbsp;<span class="op" id="8096630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096634">b</span>&nbsp;<span class="op" id="8096636">:=</span>&nbsp;<span class="builtinfunc" id="8096639">new</span><span class="op" id="8096642">(</span><span class="ident" id="8096643">bytes</span><span class="op" id="8096648">.</span><span class="ident" id="8096649">Buffer</span><span class="op" id="8096655">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096659">enc</span>&nbsp;<span class="op" id="8096663">:=</span>&nbsp;<span class="ident" id="8096666">NewEncoder</span><span class="op" id="8096676">(</span><span class="ident" id="8096677">b</span><span class="op" id="8096678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096682">err</span>&nbsp;<span class="op" id="8096686">:=</span>&nbsp;<span class="ident" id="8096689">enc</span><span class="op" id="8096692">.</span><span class="ident" id="8096693">Encode</span><span class="op" id="8096699">(</span><span class="ident" id="8096700">value</span><span class="op" id="8096705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096709">if</span>&nbsp;<span class="ident" id="8096712">err</span>&nbsp;<span class="op" id="8096716">!=</span>&nbsp;<span class="ident" id="8096719">nil</span>&nbsp;<span class="op" id="8096723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096728">t</span><span class="op" id="8096729">.</span><span class="ident" id="8096730">Error</span><span class="op" id="8096735">(</span><span class="string" id="8096736">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8096751">,</span>&nbsp;<span class="ident" id="8096753">err</span><span class="op" id="8096756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8096760">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096764">dec</span>&nbsp;<span class="op" id="8096768">:=</span>&nbsp;<span class="ident" id="8096771">NewDecoder</span><span class="op" id="8096781">(</span><span class="ident" id="8096782">b</span><span class="op" id="8096783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096787">result</span>&nbsp;<span class="op" id="8096794">:=</span>&nbsp;<span class="ident" id="8096797">reflect</span><span class="op" id="8096804">.</span><span class="ident" id="8096805">New</span><span class="op" id="8096808">(</span><span class="ident" id="8096809">reflect</span><span class="op" id="8096816">.</span><span class="ident" id="8096817">TypeOf</span><span class="op" id="8096823">(</span><span class="ident" id="8096824">value</span><span class="op" id="8096829">)</span><span class="op" id="8096830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096834">err</span>&nbsp;<span class="op" id="8096838">=</span>&nbsp;<span class="ident" id="8096840">dec</span><span class="op" id="8096843">.</span><span class="ident" id="8096844">Decode</span><span class="op" id="8096850">(</span><span class="ident" id="8096851">result</span><span class="op" id="8096857">.</span><span class="ident" id="8096858">Interface</span><span class="op" id="8096867">(</span><span class="op" id="8096868">)</span><span class="op" id="8096869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096873">if</span>&nbsp;<span class="ident" id="8096876">err</span>&nbsp;<span class="op" id="8096880">!=</span>&nbsp;<span class="ident" id="8096883">nil</span>&nbsp;<span class="op" id="8096887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8096892">t</span><span class="op" id="8096893">.</span><span class="ident" id="8096894">Fatalf</span><span class="op" id="8096900">(</span><span class="string" id="8096901">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="8096925">,</span>&nbsp;<span class="ident" id="8096927">reflect</span><span class="op" id="8096934">.</span><span class="ident" id="8096935">TypeOf</span><span class="op" id="8096941">(</span><span class="ident" id="8096942">value</span><span class="op" id="8096947">)</span><span class="op" id="8096948">,</span>&nbsp;<span class="ident" id="8096950">err</span><span class="op" id="8096953">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8096957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8096961">if</span>&nbsp;<span class="op" id="8096964">!</span><span class="ident" id="8096965">reflect</span><span class="op" id="8096972">.</span><span class="ident" id="8096973">DeepEqual</span><span class="op" id="8096982">(</span><span class="ident" id="8096983">value</span><span class="op" id="8096988">,</span>&nbsp;<span class="ident" id="8096990">result</span><span class="op" id="8096996">.</span><span class="ident" id="8096997">Elem</span><span class="op" id="8097001">(</span><span class="op" id="8097002">)</span><span class="op" id="8097003">.</span><span class="ident" id="8097004">Interface</span><span class="op" id="8097013">(</span><span class="op" id="8097014">)</span><span class="op" id="8097015">)</span>&nbsp;<span class="op" id="8097017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097022">t</span><span class="op" id="8097023">.</span><span class="ident" id="8097024">Fatalf</span><span class="op" id="8097030">(</span><span class="string" id="8097031">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8097055">,</span>&nbsp;<span class="ident" id="8097057">value</span><span class="op" id="8097062">,</span>&nbsp;<span class="ident" id="8097064">value</span><span class="op" id="8097069">,</span>&nbsp;<span class="ident" id="8097071">result</span><span class="op" id="8097077">.</span><span class="ident" id="8097078">Elem</span><span class="op" id="8097082">(</span><span class="op" id="8097083">)</span><span class="op" id="8097084">.</span><span class="ident" id="8097085">Interface</span><span class="op" id="8097094">(</span><span class="op" id="8097095">)</span><span class="op" id="8097096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097103">}</span><br>
<span class="lineno">55</span><span class="op" id="8097105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8097108">type</span>&nbsp;<span class="ident" id="8097113">ET0</span>&nbsp;<span class="keyword" id="8097117">struct</span>&nbsp;<span class="op" id="8097124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097127">A</span>&nbsp;<span class="builtintype" id="8097129">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097134">B</span>&nbsp;<span class="builtintype" id="8097136">string</span><br>
<span class="lineno">60</span><span class="op" id="8097143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8097146">type</span>&nbsp;<span class="ident" id="8097151">ET2</span>&nbsp;<span class="keyword" id="8097155">struct</span>&nbsp;<span class="op" id="8097162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097165">X</span>&nbsp;<span class="builtintype" id="8097167">string</span><br>
<span class="lineno"></span><span class="op" id="8097174">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="8097177">type</span>&nbsp;<span class="ident" id="8097182">ET1</span>&nbsp;<span class="keyword" id="8097186">struct</span>&nbsp;<span class="op" id="8097193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097196">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8097201">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097206">Et2</span>&nbsp;&nbsp;<span class="op" id="8097211">*</span><span class="ident" id="8097212">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097217">Next</span>&nbsp;<span class="op" id="8097222">*</span><span class="ident" id="8097223">ET1</span><br>
<span class="lineno">70</span><span class="op" id="8097227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8097230">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="8097280">type</span>&nbsp;<span class="ident" id="8097285">ET3</span>&nbsp;<span class="keyword" id="8097289">struct</span>&nbsp;<span class="op" id="8097296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097299">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8097313">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097318">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8097332">*</span><span class="ident" id="8097333">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097338">DifferentNext</span>&nbsp;<span class="op" id="8097352">*</span><span class="ident" id="8097353">ET1</span><br>
<span class="lineno"></span><span class="op" id="8097357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8097360">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="8097410">type</span>&nbsp;<span class="ident" id="8097415">ET4</span>&nbsp;<span class="keyword" id="8097419">struct</span>&nbsp;<span class="op" id="8097426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097429">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8097434">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097439">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="8097444">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097453">Next</span>&nbsp;<span class="builtintype" id="8097458">int</span><br>
<span class="lineno"></span><span class="op" id="8097462">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="8097465">func</span>&nbsp;<span class="ident" id="8097470">TestEncoderDecoder</span><span class="op" id="8097488">(</span><span class="ident" id="8097489">t</span>&nbsp;<span class="op" id="8097491">*</span><span class="ident" id="8097492">testing</span><span class="op" id="8097499">.</span><span class="ident" id="8097500">T</span><span class="op" id="8097501">)</span>&nbsp;<span class="op" id="8097503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097506">b</span>&nbsp;<span class="op" id="8097508">:=</span>&nbsp;<span class="builtinfunc" id="8097511">new</span><span class="op" id="8097514">(</span><span class="ident" id="8097515">bytes</span><span class="op" id="8097520">.</span><span class="ident" id="8097521">Buffer</span><span class="op" id="8097527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097530">enc</span>&nbsp;<span class="op" id="8097534">:=</span>&nbsp;<span class="ident" id="8097537">NewEncoder</span><span class="op" id="8097547">(</span><span class="ident" id="8097548">b</span><span class="op" id="8097549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097552">et0</span>&nbsp;<span class="op" id="8097556">:=</span>&nbsp;<span class="builtinfunc" id="8097559">new</span><span class="op" id="8097562">(</span><span class="ident" id="8097563">ET0</span><span class="op" id="8097566">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097569">et0</span><span class="op" id="8097572">.</span><span class="ident" id="8097573">A</span>&nbsp;<span class="op" id="8097575">=</span>&nbsp;<span class="num" id="8097577">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097580">et0</span><span class="op" id="8097583">.</span><span class="ident" id="8097584">B</span>&nbsp;<span class="op" id="8097586">=</span>&nbsp;<span class="string" id="8097588">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097603">err</span>&nbsp;<span class="op" id="8097607">:=</span>&nbsp;<span class="ident" id="8097610">enc</span><span class="op" id="8097613">.</span><span class="ident" id="8097614">Encode</span><span class="op" id="8097620">(</span><span class="ident" id="8097621">et0</span><span class="op" id="8097624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097627">if</span>&nbsp;<span class="ident" id="8097630">err</span>&nbsp;<span class="op" id="8097634">!=</span>&nbsp;<span class="ident" id="8097637">nil</span>&nbsp;<span class="op" id="8097641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097645">t</span><span class="op" id="8097646">.</span><span class="ident" id="8097647">Error</span><span class="op" id="8097652">(</span><span class="string" id="8097653">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8097668">,</span>&nbsp;<span class="ident" id="8097670">err</span><span class="op" id="8097673">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8097679">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8097711">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097723">dec</span>&nbsp;<span class="op" id="8097727">:=</span>&nbsp;<span class="ident" id="8097730">NewDecoder</span><span class="op" id="8097740">(</span><span class="ident" id="8097741">b</span><span class="op" id="8097742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097745">newEt0</span>&nbsp;<span class="op" id="8097752">:=</span>&nbsp;<span class="builtinfunc" id="8097755">new</span><span class="op" id="8097758">(</span><span class="ident" id="8097759">ET0</span><span class="op" id="8097762">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097765">err</span>&nbsp;<span class="op" id="8097769">=</span>&nbsp;<span class="ident" id="8097771">dec</span><span class="op" id="8097774">.</span><span class="ident" id="8097775">Decode</span><span class="op" id="8097781">(</span><span class="ident" id="8097782">newEt0</span><span class="op" id="8097788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097791">if</span>&nbsp;<span class="ident" id="8097794">err</span>&nbsp;<span class="op" id="8097798">!=</span>&nbsp;<span class="ident" id="8097801">nil</span>&nbsp;<span class="op" id="8097805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097809">t</span><span class="op" id="8097810">.</span><span class="ident" id="8097811">Fatal</span><span class="op" id="8097816">(</span><span class="string" id="8097817">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="8097838">,</span>&nbsp;<span class="ident" id="8097840">err</span><span class="op" id="8097843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097850">if</span>&nbsp;<span class="op" id="8097853">!</span><span class="ident" id="8097854">reflect</span><span class="op" id="8097861">.</span><span class="ident" id="8097862">DeepEqual</span><span class="op" id="8097871">(</span><span class="ident" id="8097872">et0</span><span class="op" id="8097875">,</span>&nbsp;<span class="ident" id="8097877">newEt0</span><span class="op" id="8097883">)</span>&nbsp;<span class="op" id="8097885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097889">t</span><span class="op" id="8097890">.</span><span class="ident" id="8097891">Fatalf</span><span class="op" id="8097897">(</span><span class="string" id="8097898">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8097943">,</span>&nbsp;<span class="op" id="8097945">*</span><span class="ident" id="8097946">et0</span><span class="op" id="8097949">,</span>&nbsp;<span class="op" id="8097951">*</span><span class="ident" id="8097952">newEt0</span><span class="op" id="8097958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8097961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8097964">if</span>&nbsp;<span class="ident" id="8097967">b</span><span class="op" id="8097968">.</span><span class="ident" id="8097969">Len</span><span class="op" id="8097972">(</span><span class="op" id="8097973">)</span>&nbsp;<span class="op" id="8097975">!=</span>&nbsp;<span class="num" id="8097978">0</span>&nbsp;<span class="op" id="8097980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8097984">t</span><span class="op" id="8097985">.</span><span class="ident" id="8097986">Error</span><span class="op" id="8097991">(</span><span class="string" id="8097992">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8098005">,</span>&nbsp;<span class="ident" id="8098007">b</span><span class="op" id="8098008">.</span><span class="ident" id="8098009">Len</span><span class="op" id="8098012">(</span><span class="op" id="8098013">)</span><span class="op" id="8098014">,</span>&nbsp;<span class="string" id="8098016">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8098028">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8098034">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098051">b</span>&nbsp;<span class="op" id="8098053">=</span>&nbsp;<span class="builtinfunc" id="8098055">new</span><span class="op" id="8098058">(</span><span class="ident" id="8098059">bytes</span><span class="op" id="8098064">.</span><span class="ident" id="8098065">Buffer</span><span class="op" id="8098071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098074">enc</span>&nbsp;<span class="op" id="8098078">=</span>&nbsp;<span class="ident" id="8098080">NewEncoder</span><span class="op" id="8098090">(</span><span class="ident" id="8098091">b</span><span class="op" id="8098092">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098095">et1</span>&nbsp;<span class="op" id="8098099">:=</span>&nbsp;<span class="builtinfunc" id="8098102">new</span><span class="op" id="8098105">(</span><span class="ident" id="8098106">ET1</span><span class="op" id="8098109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098112">et1</span><span class="op" id="8098115">.</span><span class="ident" id="8098116">A</span>&nbsp;<span class="op" id="8098118">=</span>&nbsp;<span class="num" id="8098120">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098123">et1</span><span class="op" id="8098126">.</span><span class="ident" id="8098127">Et2</span>&nbsp;<span class="op" id="8098131">=</span>&nbsp;<span class="builtinfunc" id="8098133">new</span><span class="op" id="8098136">(</span><span class="ident" id="8098137">ET2</span><span class="op" id="8098140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098143">err</span>&nbsp;<span class="op" id="8098147">=</span>&nbsp;<span class="ident" id="8098149">enc</span><span class="op" id="8098152">.</span><span class="ident" id="8098153">Encode</span><span class="op" id="8098159">(</span><span class="ident" id="8098160">et1</span><span class="op" id="8098163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098166">if</span>&nbsp;<span class="ident" id="8098169">err</span>&nbsp;<span class="op" id="8098173">!=</span>&nbsp;<span class="ident" id="8098176">nil</span>&nbsp;<span class="op" id="8098180">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098184">t</span><span class="op" id="8098185">.</span><span class="ident" id="8098186">Error</span><span class="op" id="8098191">(</span><span class="string" id="8098192">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8098207">,</span>&nbsp;<span class="ident" id="8098209">err</span><span class="op" id="8098212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098218">dec</span>&nbsp;<span class="op" id="8098222">=</span>&nbsp;<span class="ident" id="8098224">NewDecoder</span><span class="op" id="8098234">(</span><span class="ident" id="8098235">b</span><span class="op" id="8098236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098239">newEt1</span>&nbsp;<span class="op" id="8098246">:=</span>&nbsp;<span class="builtinfunc" id="8098249">new</span><span class="op" id="8098252">(</span><span class="ident" id="8098253">ET1</span><span class="op" id="8098256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098259">err</span>&nbsp;<span class="op" id="8098263">=</span>&nbsp;<span class="ident" id="8098265">dec</span><span class="op" id="8098268">.</span><span class="ident" id="8098269">Decode</span><span class="op" id="8098275">(</span><span class="ident" id="8098276">newEt1</span><span class="op" id="8098282">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098285">if</span>&nbsp;<span class="ident" id="8098288">err</span>&nbsp;<span class="op" id="8098292">!=</span>&nbsp;<span class="ident" id="8098295">nil</span>&nbsp;<span class="op" id="8098299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098303">t</span><span class="op" id="8098304">.</span><span class="ident" id="8098305">Fatal</span><span class="op" id="8098310">(</span><span class="string" id="8098311">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8098332">,</span>&nbsp;<span class="ident" id="8098334">err</span><span class="op" id="8098337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098344">if</span>&nbsp;<span class="op" id="8098347">!</span><span class="ident" id="8098348">reflect</span><span class="op" id="8098355">.</span><span class="ident" id="8098356">DeepEqual</span><span class="op" id="8098365">(</span><span class="ident" id="8098366">et1</span><span class="op" id="8098369">,</span>&nbsp;<span class="ident" id="8098371">newEt1</span><span class="op" id="8098377">)</span>&nbsp;<span class="op" id="8098379">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098383">t</span><span class="op" id="8098384">.</span><span class="ident" id="8098385">Fatalf</span><span class="op" id="8098391">(</span><span class="string" id="8098392">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8098437">,</span>&nbsp;<span class="op" id="8098439">*</span><span class="ident" id="8098440">et1</span><span class="op" id="8098443">,</span>&nbsp;<span class="op" id="8098445">*</span><span class="ident" id="8098446">newEt1</span><span class="op" id="8098452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098458">if</span>&nbsp;<span class="ident" id="8098461">b</span><span class="op" id="8098462">.</span><span class="ident" id="8098463">Len</span><span class="op" id="8098466">(</span><span class="op" id="8098467">)</span>&nbsp;<span class="op" id="8098469">!=</span>&nbsp;<span class="num" id="8098472">0</span>&nbsp;<span class="op" id="8098474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098478">t</span><span class="op" id="8098479">.</span><span class="ident" id="8098480">Error</span><span class="op" id="8098485">(</span><span class="string" id="8098486">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8098499">,</span>&nbsp;<span class="ident" id="8098501">b</span><span class="op" id="8098502">.</span><span class="ident" id="8098503">Len</span><span class="op" id="8098506">(</span><span class="op" id="8098507">)</span><span class="op" id="8098508">,</span>&nbsp;<span class="string" id="8098510">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8098522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098525">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098529">enc</span><span class="op" id="8098532">.</span><span class="ident" id="8098533">Encode</span><span class="op" id="8098539">(</span><span class="ident" id="8098540">et1</span><span class="op" id="8098543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098546">newEt1</span>&nbsp;<span class="op" id="8098553">=</span>&nbsp;<span class="builtinfunc" id="8098555">new</span><span class="op" id="8098558">(</span><span class="ident" id="8098559">ET1</span><span class="op" id="8098562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098565">err</span>&nbsp;<span class="op" id="8098569">=</span>&nbsp;<span class="ident" id="8098571">dec</span><span class="op" id="8098574">.</span><span class="ident" id="8098575">Decode</span><span class="op" id="8098581">(</span><span class="ident" id="8098582">newEt1</span><span class="op" id="8098588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098591">if</span>&nbsp;<span class="ident" id="8098594">err</span>&nbsp;<span class="op" id="8098598">!=</span>&nbsp;<span class="ident" id="8098601">nil</span>&nbsp;<span class="op" id="8098605">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098609">t</span><span class="op" id="8098610">.</span><span class="ident" id="8098611">Fatal</span><span class="op" id="8098616">(</span><span class="string" id="8098617">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="8098647">,</span>&nbsp;<span class="ident" id="8098649">err</span><span class="op" id="8098652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098658">if</span>&nbsp;<span class="op" id="8098661">!</span><span class="ident" id="8098662">reflect</span><span class="op" id="8098669">.</span><span class="ident" id="8098670">DeepEqual</span><span class="op" id="8098679">(</span><span class="ident" id="8098680">et1</span><span class="op" id="8098683">,</span>&nbsp;<span class="ident" id="8098685">newEt1</span><span class="op" id="8098691">)</span>&nbsp;<span class="op" id="8098693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098697">t</span><span class="op" id="8098698">.</span><span class="ident" id="8098699">Fatalf</span><span class="op" id="8098705">(</span><span class="string" id="8098706">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="8098760">,</span>&nbsp;<span class="op" id="8098762">*</span><span class="ident" id="8098763">et1</span><span class="op" id="8098766">,</span>&nbsp;<span class="op" id="8098768">*</span><span class="ident" id="8098769">newEt1</span><span class="op" id="8098775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098778">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098781">if</span>&nbsp;<span class="ident" id="8098784">b</span><span class="op" id="8098785">.</span><span class="ident" id="8098786">Len</span><span class="op" id="8098789">(</span><span class="op" id="8098790">)</span>&nbsp;<span class="op" id="8098792">!=</span>&nbsp;<span class="num" id="8098795">0</span>&nbsp;<span class="op" id="8098797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098801">t</span><span class="op" id="8098802">.</span><span class="ident" id="8098803">Error</span><span class="op" id="8098808">(</span><span class="string" id="8098809">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="8098831">,</span>&nbsp;<span class="ident" id="8098833">b</span><span class="op" id="8098834">.</span><span class="ident" id="8098835">Len</span><span class="op" id="8098838">(</span><span class="op" id="8098839">)</span><span class="op" id="8098840">,</span>&nbsp;<span class="string" id="8098842">&#34;bytes&nbsp;left&#34;</span><span class="op" id="8098854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8098857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8098861">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098945">err</span>&nbsp;<span class="op" id="8098949">=</span>&nbsp;<span class="ident" id="8098951">enc</span><span class="op" id="8098954">.</span><span class="ident" id="8098955">Encode</span><span class="op" id="8098961">(</span><span class="ident" id="8098962">et1</span><span class="op" id="8098965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8098968">if</span>&nbsp;<span class="ident" id="8098971">err</span>&nbsp;<span class="op" id="8098975">!=</span>&nbsp;<span class="ident" id="8098978">nil</span>&nbsp;<span class="op" id="8098982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8098986">t</span><span class="op" id="8098987">.</span><span class="ident" id="8098988">Error</span><span class="op" id="8098993">(</span><span class="string" id="8098994">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="8099018">,</span>&nbsp;<span class="ident" id="8099020">err</span><span class="op" id="8099023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099029">newEt2</span>&nbsp;<span class="op" id="8099036">:=</span>&nbsp;<span class="builtinfunc" id="8099039">new</span><span class="op" id="8099042">(</span><span class="ident" id="8099043">ET2</span><span class="op" id="8099046">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099049">err</span>&nbsp;<span class="op" id="8099053">=</span>&nbsp;<span class="ident" id="8099055">dec</span><span class="op" id="8099058">.</span><span class="ident" id="8099059">Decode</span><span class="op" id="8099065">(</span><span class="ident" id="8099066">newEt2</span><span class="op" id="8099072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099075">if</span>&nbsp;<span class="ident" id="8099078">err</span>&nbsp;<span class="op" id="8099082">==</span>&nbsp;<span class="ident" id="8099085">nil</span>&nbsp;<span class="op" id="8099089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099093">t</span><span class="op" id="8099094">.</span><span class="ident" id="8099095">Fatal</span><span class="op" id="8099100">(</span><span class="string" id="8099101">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="8099150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099153">}</span><br>
<span class="lineno"></span><span class="op" id="8099155">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="8099158">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="8099228">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="8099295">func</span>&nbsp;<span class="ident" id="8099300">badTypeCheck</span><span class="op" id="8099312">(</span><span class="ident" id="8099313">e</span>&nbsp;<span class="keyword" id="8099315">interface</span><span class="op" id="8099324">{</span><span class="op" id="8099325">}</span><span class="op" id="8099326">,</span>&nbsp;<span class="ident" id="8099328">shouldFail</span>&nbsp;<span class="builtintype" id="8099339">bool</span><span class="op" id="8099343">,</span>&nbsp;<span class="ident" id="8099345">msg</span>&nbsp;<span class="builtintype" id="8099349">string</span><span class="op" id="8099355">,</span>&nbsp;<span class="ident" id="8099357">t</span>&nbsp;<span class="op" id="8099359">*</span><span class="ident" id="8099360">testing</span><span class="op" id="8099367">.</span><span class="ident" id="8099368">T</span><span class="op" id="8099369">)</span>&nbsp;<span class="op" id="8099371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099374">b</span>&nbsp;<span class="op" id="8099376">:=</span>&nbsp;<span class="builtinfunc" id="8099379">new</span><span class="op" id="8099382">(</span><span class="ident" id="8099383">bytes</span><span class="op" id="8099388">.</span><span class="ident" id="8099389">Buffer</span><span class="op" id="8099395">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099398">enc</span>&nbsp;<span class="op" id="8099402">:=</span>&nbsp;<span class="ident" id="8099405">NewEncoder</span><span class="op" id="8099415">(</span><span class="ident" id="8099416">b</span><span class="op" id="8099417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099420">et1</span>&nbsp;<span class="op" id="8099424">:=</span>&nbsp;<span class="builtinfunc" id="8099427">new</span><span class="op" id="8099430">(</span><span class="ident" id="8099431">ET1</span><span class="op" id="8099434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099437">et1</span><span class="op" id="8099440">.</span><span class="ident" id="8099441">A</span>&nbsp;<span class="op" id="8099443">=</span>&nbsp;<span class="num" id="8099445">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099448">et1</span><span class="op" id="8099451">.</span><span class="ident" id="8099452">Et2</span>&nbsp;<span class="op" id="8099456">=</span>&nbsp;<span class="builtinfunc" id="8099458">new</span><span class="op" id="8099461">(</span><span class="ident" id="8099462">ET2</span><span class="op" id="8099465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099468">err</span>&nbsp;<span class="op" id="8099472">:=</span>&nbsp;<span class="ident" id="8099475">enc</span><span class="op" id="8099478">.</span><span class="ident" id="8099479">Encode</span><span class="op" id="8099485">(</span><span class="ident" id="8099486">et1</span><span class="op" id="8099489">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099492">if</span>&nbsp;<span class="ident" id="8099495">err</span>&nbsp;<span class="op" id="8099499">!=</span>&nbsp;<span class="ident" id="8099502">nil</span>&nbsp;<span class="op" id="8099506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099510">t</span><span class="op" id="8099511">.</span><span class="ident" id="8099512">Error</span><span class="op" id="8099517">(</span><span class="string" id="8099518">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8099533">,</span>&nbsp;<span class="ident" id="8099535">err</span><span class="op" id="8099538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099544">dec</span>&nbsp;<span class="op" id="8099548">:=</span>&nbsp;<span class="ident" id="8099551">NewDecoder</span><span class="op" id="8099561">(</span><span class="ident" id="8099562">b</span><span class="op" id="8099563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099566">err</span>&nbsp;<span class="op" id="8099570">=</span>&nbsp;<span class="ident" id="8099572">dec</span><span class="op" id="8099575">.</span><span class="ident" id="8099576">Decode</span><span class="op" id="8099582">(</span><span class="ident" id="8099583">e</span><span class="op" id="8099584">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099587">if</span>&nbsp;<span class="ident" id="8099590">shouldFail</span>&nbsp;<span class="op" id="8099601">&amp;&amp;</span>&nbsp;<span class="ident" id="8099604">err</span>&nbsp;<span class="op" id="8099608">==</span>&nbsp;<span class="ident" id="8099611">nil</span>&nbsp;<span class="op" id="8099615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099619">t</span><span class="op" id="8099620">.</span><span class="ident" id="8099621">Error</span><span class="op" id="8099626">(</span><span class="string" id="8099627">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8099647">,</span>&nbsp;<span class="ident" id="8099649">msg</span><span class="op" id="8099652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8099658">if</span>&nbsp;<span class="op" id="8099661">!</span><span class="ident" id="8099662">shouldFail</span>&nbsp;<span class="op" id="8099673">&amp;&amp;</span>&nbsp;<span class="ident" id="8099676">err</span>&nbsp;<span class="op" id="8099680">!=</span>&nbsp;<span class="ident" id="8099683">nil</span>&nbsp;<span class="op" id="8099687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099691">t</span><span class="op" id="8099692">.</span><span class="ident" id="8099693">Error</span><span class="op" id="8099698">(</span><span class="string" id="8099699">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="8099721">,</span>&nbsp;<span class="ident" id="8099723">msg</span><span class="op" id="8099726">,</span>&nbsp;<span class="ident" id="8099728">err</span><span class="op" id="8099731">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8099734">}</span><br>
<span class="lineno"></span><span class="op" id="8099736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8099739">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="8099792">func</span>&nbsp;<span class="ident" id="8099797">TestWrongTypeDecoder</span><span class="op" id="8099817">(</span><span class="ident" id="8099818">t</span>&nbsp;<span class="op" id="8099820">*</span><span class="ident" id="8099821">testing</span><span class="op" id="8099828">.</span><span class="ident" id="8099829">T</span><span class="op" id="8099830">)</span>&nbsp;<span class="op" id="8099832">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099835">badTypeCheck</span><span class="op" id="8099847">(</span><span class="builtinfunc" id="8099848">new</span><span class="op" id="8099851">(</span><span class="ident" id="8099852">ET2</span><span class="op" id="8099855">)</span><span class="op" id="8099856">,</span>&nbsp;<span class="builtintype" id="8099858">true</span><span class="op" id="8099862">,</span>&nbsp;<span class="string" id="8099864">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="8099885">,</span>&nbsp;<span class="ident" id="8099887">t</span><span class="op" id="8099888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099891">badTypeCheck</span><span class="op" id="8099903">(</span><span class="builtinfunc" id="8099904">new</span><span class="op" id="8099907">(</span><span class="ident" id="8099908">ET3</span><span class="op" id="8099911">)</span><span class="op" id="8099912">,</span>&nbsp;<span class="builtintype" id="8099914">false</span><span class="op" id="8099919">,</span>&nbsp;<span class="string" id="8099921">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="8099946">,</span>&nbsp;<span class="ident" id="8099948">t</span><span class="op" id="8099949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8099952">badTypeCheck</span><span class="op" id="8099964">(</span><span class="builtinfunc" id="8099965">new</span><span class="op" id="8099968">(</span><span class="ident" id="8099969">ET4</span><span class="op" id="8099972">)</span><span class="op" id="8099973">,</span>&nbsp;<span class="builtintype" id="8099975">true</span><span class="op" id="8099979">,</span>&nbsp;<span class="string" id="8099981">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="8100006">,</span>&nbsp;<span class="ident" id="8100008">t</span><span class="op" id="8100009">)</span><br>
<span class="lineno"></span><span class="op" id="8100011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8100014">func</span>&nbsp;<span class="ident" id="8100019">corruptDataCheck</span><span class="op" id="8100035">(</span><span class="ident" id="8100036">s</span>&nbsp;<span class="builtintype" id="8100038">string</span><span class="op" id="8100044">,</span>&nbsp;<span class="ident" id="8100046">err</span>&nbsp;<span class="builtintype" id="8100050">error</span><span class="op" id="8100055">,</span>&nbsp;<span class="ident" id="8100057">t</span>&nbsp;<span class="op" id="8100059">*</span><span class="ident" id="8100060">testing</span><span class="op" id="8100067">.</span><span class="ident" id="8100068">T</span><span class="op" id="8100069">)</span>&nbsp;<span class="op" id="8100071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100074">b</span>&nbsp;<span class="op" id="8100076">:=</span>&nbsp;<span class="ident" id="8100079">bytes</span><span class="op" id="8100084">.</span><span class="ident" id="8100085">NewBufferString</span><span class="op" id="8100100">(</span><span class="ident" id="8100101">s</span><span class="op" id="8100102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100105">dec</span>&nbsp;<span class="op" id="8100109">:=</span>&nbsp;<span class="ident" id="8100112">NewDecoder</span><span class="op" id="8100122">(</span><span class="ident" id="8100123">b</span><span class="op" id="8100124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100127">err1</span>&nbsp;<span class="op" id="8100132">:=</span>&nbsp;<span class="ident" id="8100135">dec</span><span class="op" id="8100138">.</span><span class="ident" id="8100139">Decode</span><span class="op" id="8100145">(</span><span class="builtinfunc" id="8100146">new</span><span class="op" id="8100149">(</span><span class="ident" id="8100150">ET2</span><span class="op" id="8100153">)</span><span class="op" id="8100154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100157">if</span>&nbsp;<span class="ident" id="8100160">err1</span>&nbsp;<span class="op" id="8100165">!=</span>&nbsp;<span class="ident" id="8100168">err</span>&nbsp;<span class="op" id="8100172">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100176">t</span><span class="op" id="8100177">.</span><span class="ident" id="8100178">Errorf</span><span class="op" id="8100184">(</span><span class="string" id="8100185">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8100220">,</span>&nbsp;<span class="ident" id="8100222">s</span><span class="op" id="8100223">,</span>&nbsp;<span class="ident" id="8100225">err</span><span class="op" id="8100228">,</span>&nbsp;<span class="ident" id="8100230">err1</span><span class="op" id="8100234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100237">}</span><br>
<span class="lineno"></span><span class="op" id="8100239">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8100242">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="8100277">func</span>&nbsp;<span class="ident" id="8100282">TestBadData</span><span class="op" id="8100293">(</span><span class="ident" id="8100294">t</span>&nbsp;<span class="op" id="8100296">*</span><span class="ident" id="8100297">testing</span><span class="op" id="8100304">.</span><span class="ident" id="8100305">T</span><span class="op" id="8100306">)</span>&nbsp;<span class="op" id="8100308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100311">corruptDataCheck</span><span class="op" id="8100327">(</span><span class="string" id="8100328">&#34;&#34;</span><span class="op" id="8100330">,</span>&nbsp;<span class="ident" id="8100332">io</span><span class="op" id="8100334">.</span><span class="ident" id="8100335">EOF</span><span class="op" id="8100338">,</span>&nbsp;<span class="ident" id="8100340">t</span><span class="op" id="8100341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100344">corruptDataCheck</span><span class="op" id="8100360">(</span><span class="string" id="8100361">&#34;\x7Fhi&#34;</span><span class="op" id="8100369">,</span>&nbsp;<span class="ident" id="8100371">io</span><span class="op" id="8100373">.</span><span class="ident" id="8100374">ErrUnexpectedEOF</span><span class="op" id="8100390">,</span>&nbsp;<span class="ident" id="8100392">t</span><span class="op" id="8100393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100396">corruptDataCheck</span><span class="op" id="8100412">(</span><span class="string" id="8100413">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="8100451">,</span>&nbsp;<span class="ident" id="8100453">errBadType</span><span class="op" id="8100463">,</span>&nbsp;<span class="ident" id="8100465">t</span><span class="op" id="8100466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8100469">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100485">corruptDataCheck</span><span class="op" id="8100501">(</span><span class="string" id="8100502">&#34;\x04\x24foo&#34;</span><span class="op" id="8100515">,</span>&nbsp;<span class="ident" id="8100517">errRange</span><span class="op" id="8100525">,</span>&nbsp;<span class="ident" id="8100527">t</span><span class="op" id="8100528">)</span><br>
<span class="lineno"></span><span class="op" id="8100530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8100533">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="8100585">var</span>&nbsp;<span class="ident" id="8100589">unsupportedValues</span>&nbsp;<span class="op" id="8100607">=</span>&nbsp;<span class="op" id="8100609">[</span><span class="op" id="8100610">]</span><span class="keyword" id="8100611">interface</span><span class="op" id="8100620">{</span><span class="op" id="8100621">}</span><span class="op" id="8100622">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8100625">make</span><span class="op" id="8100629">(</span><span class="keyword" id="8100630">chan</span>&nbsp;<span class="builtintype" id="8100635">int</span><span class="op" id="8100638">)</span><span class="op" id="8100639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100642">func</span><span class="op" id="8100646">(</span><span class="ident" id="8100647">a</span>&nbsp;<span class="builtintype" id="8100649">int</span><span class="op" id="8100652">)</span>&nbsp;<span class="builtintype" id="8100654">bool</span>&nbsp;<span class="op" id="8100659">{</span>&nbsp;<span class="keyword" id="8100661">return</span>&nbsp;<span class="builtintype" id="8100668">true</span>&nbsp;<span class="op" id="8100673">}</span><span class="op" id="8100674">,</span><br>
<span class="lineno"></span><span class="op" id="8100676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8100679">func</span>&nbsp;<span class="ident" id="8100684">TestUnsupported</span><span class="op" id="8100699">(</span><span class="ident" id="8100700">t</span>&nbsp;<span class="op" id="8100702">*</span><span class="ident" id="8100703">testing</span><span class="op" id="8100710">.</span><span class="ident" id="8100711">T</span><span class="op" id="8100712">)</span>&nbsp;<span class="op" id="8100714">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100717">var</span>&nbsp;<span class="ident" id="8100721">b</span>&nbsp;<span class="ident" id="8100723">bytes</span><span class="op" id="8100728">.</span><span class="ident" id="8100729">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100737">enc</span>&nbsp;<span class="op" id="8100741">:=</span>&nbsp;<span class="ident" id="8100744">NewEncoder</span><span class="op" id="8100754">(</span><span class="op" id="8100755">&amp;</span><span class="ident" id="8100756">b</span><span class="op" id="8100757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100760">for</span>&nbsp;<span class="ident" id="8100764">_</span><span class="op" id="8100765">,</span>&nbsp;<span class="ident" id="8100767">v</span>&nbsp;<span class="op" id="8100769">:=</span>&nbsp;<span class="keyword" id="8100772">range</span>&nbsp;<span class="ident" id="8100778">unsupportedValues</span>&nbsp;<span class="op" id="8100796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100800">err</span>&nbsp;<span class="op" id="8100804">:=</span>&nbsp;<span class="ident" id="8100807">enc</span><span class="op" id="8100810">.</span><span class="ident" id="8100811">Encode</span><span class="op" id="8100817">(</span><span class="ident" id="8100818">v</span><span class="op" id="8100819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8100823">if</span>&nbsp;<span class="ident" id="8100826">err</span>&nbsp;<span class="op" id="8100830">==</span>&nbsp;<span class="ident" id="8100833">nil</span>&nbsp;<span class="op" id="8100837">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100842">t</span><span class="op" id="8100843">.</span><span class="ident" id="8100844">Errorf</span><span class="op" id="8100850">(</span><span class="string" id="8100851">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="8100884">,</span>&nbsp;<span class="ident" id="8100886">v</span><span class="op" id="8100887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8100894">}</span><br>
<span class="lineno"></span><span class="op" id="8100896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="8100899">func</span>&nbsp;<span class="ident" id="8100904">encAndDec</span><span class="op" id="8100913">(</span><span class="ident" id="8100914">in</span><span class="op" id="8100916">,</span>&nbsp;<span class="ident" id="8100918">out</span>&nbsp;<span class="keyword" id="8100922">interface</span><span class="op" id="8100931">{</span><span class="op" id="8100932">}</span><span class="op" id="8100933">)</span>&nbsp;<span class="builtintype" id="8100935">error</span>&nbsp;<span class="op" id="8100941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100944">b</span>&nbsp;<span class="op" id="8100946">:=</span>&nbsp;<span class="builtinfunc" id="8100949">new</span><span class="op" id="8100952">(</span><span class="ident" id="8100953">bytes</span><span class="op" id="8100958">.</span><span class="ident" id="8100959">Buffer</span><span class="op" id="8100965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100968">enc</span>&nbsp;<span class="op" id="8100972">:=</span>&nbsp;<span class="ident" id="8100975">NewEncoder</span><span class="op" id="8100985">(</span><span class="ident" id="8100986">b</span><span class="op" id="8100987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8100990">err</span>&nbsp;<span class="op" id="8100994">:=</span>&nbsp;<span class="ident" id="8100997">enc</span><span class="op" id="8101000">.</span><span class="ident" id="8101001">Encode</span><span class="op" id="8101007">(</span><span class="ident" id="8101008">in</span><span class="op" id="8101010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101013">if</span>&nbsp;<span class="ident" id="8101016">err</span>&nbsp;<span class="op" id="8101020">!=</span>&nbsp;<span class="ident" id="8101023">nil</span>&nbsp;<span class="op" id="8101027">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101031">return</span>&nbsp;<span class="ident" id="8101038">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101046">dec</span>&nbsp;<span class="op" id="8101050">:=</span>&nbsp;<span class="ident" id="8101053">NewDecoder</span><span class="op" id="8101063">(</span><span class="ident" id="8101064">b</span><span class="op" id="8101065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101068">err</span>&nbsp;<span class="op" id="8101072">=</span>&nbsp;<span class="ident" id="8101074">dec</span><span class="op" id="8101077">.</span><span class="ident" id="8101078">Decode</span><span class="op" id="8101084">(</span><span class="ident" id="8101085">out</span><span class="op" id="8101088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101091">if</span>&nbsp;<span class="ident" id="8101094">err</span>&nbsp;<span class="op" id="8101098">!=</span>&nbsp;<span class="ident" id="8101101">nil</span>&nbsp;<span class="op" id="8101105">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101109">return</span>&nbsp;<span class="ident" id="8101116">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101124">return</span>&nbsp;<span class="ident" id="8101131">nil</span><br>
<span class="lineno"></span><span class="op" id="8101135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="8101138">func</span>&nbsp;<span class="ident" id="8101143">TestTypeToPtrType</span><span class="op" id="8101160">(</span><span class="ident" id="8101161">t</span>&nbsp;<span class="op" id="8101163">*</span><span class="ident" id="8101164">testing</span><span class="op" id="8101171">.</span><span class="ident" id="8101172">T</span><span class="op" id="8101173">)</span>&nbsp;<span class="op" id="8101175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8101178">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101206">type</span>&nbsp;<span class="ident" id="8101211">Type0</span>&nbsp;<span class="keyword" id="8101217">struct</span>&nbsp;<span class="op" id="8101224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101228">A</span>&nbsp;<span class="builtintype" id="8101230">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101235">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101238">t0</span>&nbsp;<span class="op" id="8101241">:=</span>&nbsp;<span class="ident" id="8101244">Type0</span><span class="op" id="8101249">{</span><span class="num" id="8101250">7</span><span class="op" id="8101251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101254">t0p</span>&nbsp;<span class="op" id="8101258">:=</span>&nbsp;<span class="builtinfunc" id="8101261">new</span><span class="op" id="8101264">(</span><span class="ident" id="8101265">Type0</span><span class="op" id="8101270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101273">if</span>&nbsp;<span class="ident" id="8101276">err</span>&nbsp;<span class="op" id="8101280">:=</span>&nbsp;<span class="ident" id="8101283">encAndDec</span><span class="op" id="8101292">(</span><span class="ident" id="8101293">t0</span><span class="op" id="8101295">,</span>&nbsp;<span class="ident" id="8101297">t0p</span><span class="op" id="8101300">)</span><span class="op" id="8101301">;</span>&nbsp;<span class="ident" id="8101303">err</span>&nbsp;<span class="op" id="8101307">!=</span>&nbsp;<span class="ident" id="8101310">nil</span>&nbsp;<span class="op" id="8101314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101318">t</span><span class="op" id="8101319">.</span><span class="ident" id="8101320">Error</span><span class="op" id="8101325">(</span><span class="ident" id="8101326">err</span><span class="op" id="8101329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101332">}</span><br>
<span class="lineno">250</span><span class="op" id="8101334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8101337">func</span>&nbsp;<span class="ident" id="8101342">TestPtrTypeToType</span><span class="op" id="8101359">(</span><span class="ident" id="8101360">t</span>&nbsp;<span class="op" id="8101362">*</span><span class="ident" id="8101363">testing</span><span class="op" id="8101370">.</span><span class="ident" id="8101371">T</span><span class="op" id="8101372">)</span>&nbsp;<span class="op" id="8101374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8101377">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101405">type</span>&nbsp;<span class="ident" id="8101410">Type1</span>&nbsp;<span class="keyword" id="8101416">struct</span>&nbsp;<span class="op" id="8101423">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101427">A</span>&nbsp;<span class="builtintype" id="8101429">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101438">t1p</span>&nbsp;<span class="op" id="8101442">:=</span>&nbsp;<span class="op" id="8101445">&amp;</span><span class="ident" id="8101446">Type1</span><span class="op" id="8101451">{</span><span class="num" id="8101452">17</span><span class="op" id="8101454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101457">var</span>&nbsp;<span class="ident" id="8101461">t1</span>&nbsp;<span class="ident" id="8101464">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101471">if</span>&nbsp;<span class="ident" id="8101474">err</span>&nbsp;<span class="op" id="8101478">:=</span>&nbsp;<span class="ident" id="8101481">encAndDec</span><span class="op" id="8101490">(</span><span class="ident" id="8101491">t1</span><span class="op" id="8101493">,</span>&nbsp;<span class="ident" id="8101495">t1p</span><span class="op" id="8101498">)</span><span class="op" id="8101499">;</span>&nbsp;<span class="ident" id="8101501">err</span>&nbsp;<span class="op" id="8101505">!=</span>&nbsp;<span class="ident" id="8101508">nil</span>&nbsp;<span class="op" id="8101512">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101516">t</span><span class="op" id="8101517">.</span><span class="ident" id="8101518">Error</span><span class="op" id="8101523">(</span><span class="ident" id="8101524">err</span><span class="op" id="8101527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101530">}</span><br>
<span class="lineno"></span><span class="op" id="8101532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8101535">func</span>&nbsp;<span class="ident" id="8101540">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="8101566">(</span><span class="ident" id="8101567">t</span>&nbsp;<span class="op" id="8101569">*</span><span class="ident" id="8101570">testing</span><span class="op" id="8101577">.</span><span class="ident" id="8101578">T</span><span class="op" id="8101579">)</span>&nbsp;<span class="op" id="8101581">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101584">type</span>&nbsp;<span class="ident" id="8101589">Type2</span>&nbsp;<span class="keyword" id="8101595">struct</span>&nbsp;<span class="op" id="8101602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101606">A</span>&nbsp;<span class="op" id="8101608">*</span><span class="op" id="8101609">*</span><span class="op" id="8101610">*</span><span class="op" id="8101611">*</span><span class="builtintype" id="8101612">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101624">t2</span>&nbsp;<span class="op" id="8101627">:=</span>&nbsp;<span class="ident" id="8101630">Type2</span><span class="op" id="8101635">{</span><span class="op" id="8101636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101639">t2</span><span class="op" id="8101641">.</span><span class="ident" id="8101642">A</span>&nbsp;<span class="op" id="8101644">=</span>&nbsp;<span class="builtinfunc" id="8101646">new</span><span class="op" id="8101649">(</span><span class="op" id="8101650">*</span><span class="op" id="8101651">*</span><span class="op" id="8101652">*</span><span class="builtintype" id="8101653">float64</span><span class="op" id="8101660">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101663">*</span><span class="ident" id="8101664">t2</span><span class="op" id="8101666">.</span><span class="ident" id="8101667">A</span>&nbsp;<span class="op" id="8101669">=</span>&nbsp;<span class="builtinfunc" id="8101671">new</span><span class="op" id="8101674">(</span><span class="op" id="8101675">*</span><span class="op" id="8101676">*</span><span class="builtintype" id="8101677">float64</span><span class="op" id="8101684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101687">*</span><span class="op" id="8101688">*</span><span class="ident" id="8101689">t2</span><span class="op" id="8101691">.</span><span class="ident" id="8101692">A</span>&nbsp;<span class="op" id="8101694">=</span>&nbsp;<span class="builtinfunc" id="8101696">new</span><span class="op" id="8101699">(</span><span class="op" id="8101700">*</span><span class="builtintype" id="8101701">float64</span><span class="op" id="8101708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101711">*</span><span class="op" id="8101712">*</span><span class="op" id="8101713">*</span><span class="ident" id="8101714">t2</span><span class="op" id="8101716">.</span><span class="ident" id="8101717">A</span>&nbsp;<span class="op" id="8101719">=</span>&nbsp;<span class="builtinfunc" id="8101721">new</span><span class="op" id="8101724">(</span><span class="builtintype" id="8101725">float64</span><span class="op" id="8101732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101735">*</span><span class="op" id="8101736">*</span><span class="op" id="8101737">*</span><span class="op" id="8101738">*</span><span class="ident" id="8101739">t2</span><span class="op" id="8101741">.</span><span class="ident" id="8101742">A</span>&nbsp;<span class="op" id="8101744">=</span>&nbsp;<span class="num" id="8101746">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101752">t2pppp</span>&nbsp;<span class="op" id="8101759">:=</span>&nbsp;<span class="builtinfunc" id="8101762">new</span><span class="op" id="8101765">(</span><span class="op" id="8101766">*</span><span class="op" id="8101767">*</span><span class="op" id="8101768">*</span><span class="ident" id="8101769">Type2</span><span class="op" id="8101774">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101777">if</span>&nbsp;<span class="ident" id="8101780">err</span>&nbsp;<span class="op" id="8101784">:=</span>&nbsp;<span class="ident" id="8101787">encAndDec</span><span class="op" id="8101796">(</span><span class="ident" id="8101797">t2</span><span class="op" id="8101799">,</span>&nbsp;<span class="ident" id="8101801">t2pppp</span><span class="op" id="8101807">)</span><span class="op" id="8101808">;</span>&nbsp;<span class="ident" id="8101810">err</span>&nbsp;<span class="op" id="8101814">!=</span>&nbsp;<span class="ident" id="8101817">nil</span>&nbsp;<span class="op" id="8101821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101825">t</span><span class="op" id="8101826">.</span><span class="ident" id="8101827">Fatal</span><span class="op" id="8101832">(</span><span class="ident" id="8101833">err</span><span class="op" id="8101836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101842">if</span>&nbsp;<span class="op" id="8101845">*</span><span class="op" id="8101846">*</span><span class="op" id="8101847">*</span><span class="op" id="8101848">*</span><span class="op" id="8101849">(</span><span class="op" id="8101850">*</span><span class="op" id="8101851">*</span><span class="op" id="8101852">*</span><span class="op" id="8101853">*</span><span class="ident" id="8101854">t2pppp</span><span class="op" id="8101860">)</span><span class="op" id="8101861">.</span><span class="ident" id="8101862">A</span>&nbsp;<span class="op" id="8101864">!=</span>&nbsp;<span class="op" id="8101867">*</span><span class="op" id="8101868">*</span><span class="op" id="8101869">*</span><span class="op" id="8101870">*</span><span class="ident" id="8101871">t2</span><span class="op" id="8101873">.</span><span class="ident" id="8101874">A</span>&nbsp;<span class="op" id="8101876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8101880">t</span><span class="op" id="8101881">.</span><span class="ident" id="8101882">Errorf</span><span class="op" id="8101888">(</span><span class="string" id="8101889">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="8101926">,</span>&nbsp;<span class="op" id="8101928">*</span><span class="op" id="8101929">*</span><span class="op" id="8101930">*</span><span class="op" id="8101931">*</span><span class="op" id="8101932">(</span><span class="op" id="8101933">*</span><span class="op" id="8101934">*</span><span class="op" id="8101935">*</span><span class="op" id="8101936">*</span><span class="ident" id="8101937">t2pppp</span><span class="op" id="8101943">)</span><span class="op" id="8101944">.</span><span class="ident" id="8101945">A</span><span class="op" id="8101946">,</span>&nbsp;<span class="op" id="8101948">*</span><span class="op" id="8101949">*</span><span class="op" id="8101950">*</span><span class="op" id="8101951">*</span><span class="ident" id="8101952">t2</span><span class="op" id="8101954">.</span><span class="ident" id="8101955">A</span><span class="op" id="8101956">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8101959">}</span><br>
<span class="lineno"></span><span class="op" id="8101961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8101964">func</span>&nbsp;<span class="ident" id="8101969">TestSlice</span><span class="op" id="8101978">(</span><span class="ident" id="8101979">t</span>&nbsp;<span class="op" id="8101981">*</span><span class="ident" id="8101982">testing</span><span class="op" id="8101989">.</span><span class="ident" id="8101990">T</span><span class="op" id="8101991">)</span>&nbsp;<span class="op" id="8101993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8101996">type</span>&nbsp;<span class="ident" id="8102001">Type3</span>&nbsp;<span class="keyword" id="8102007">struct</span>&nbsp;<span class="op" id="8102014">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102018">A</span>&nbsp;<span class="op" id="8102020">[</span><span class="op" id="8102021">]</span><span class="builtintype" id="8102022">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102033">t3p</span>&nbsp;<span class="op" id="8102037">:=</span>&nbsp;<span class="op" id="8102040">&amp;</span><span class="ident" id="8102041">Type3</span><span class="op" id="8102046">{</span><span class="op" id="8102047">[</span><span class="op" id="8102048">]</span><span class="builtintype" id="8102049">string</span><span class="op" id="8102055">{</span><span class="string" id="8102056">&#34;hello&#34;</span><span class="op" id="8102063">,</span>&nbsp;<span class="string" id="8102065">&#34;world&#34;</span><span class="op" id="8102072">}</span><span class="op" id="8102073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102076">var</span>&nbsp;<span class="ident" id="8102080">t3</span>&nbsp;<span class="ident" id="8102083">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102090">if</span>&nbsp;<span class="ident" id="8102093">err</span>&nbsp;<span class="op" id="8102097">:=</span>&nbsp;<span class="ident" id="8102100">encAndDec</span><span class="op" id="8102109">(</span><span class="ident" id="8102110">t3</span><span class="op" id="8102112">,</span>&nbsp;<span class="ident" id="8102114">t3p</span><span class="op" id="8102117">)</span><span class="op" id="8102118">;</span>&nbsp;<span class="ident" id="8102120">err</span>&nbsp;<span class="op" id="8102124">!=</span>&nbsp;<span class="ident" id="8102127">nil</span>&nbsp;<span class="op" id="8102131">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102135">t</span><span class="op" id="8102136">.</span><span class="ident" id="8102137">Error</span><span class="op" id="8102142">(</span><span class="ident" id="8102143">err</span><span class="op" id="8102146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102149">}</span><br>
<span class="lineno"></span><span class="op" id="8102151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8102154">func</span>&nbsp;<span class="ident" id="8102159">TestValueError</span><span class="op" id="8102173">(</span><span class="ident" id="8102174">t</span>&nbsp;<span class="op" id="8102176">*</span><span class="ident" id="8102177">testing</span><span class="op" id="8102184">.</span><span class="ident" id="8102185">T</span><span class="op" id="8102186">)</span>&nbsp;<span class="op" id="8102188">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8102191">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102219">type</span>&nbsp;<span class="ident" id="8102224">Type4</span>&nbsp;<span class="keyword" id="8102230">struct</span>&nbsp;<span class="op" id="8102237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102241">A</span>&nbsp;<span class="builtintype" id="8102243">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102251">t4p</span>&nbsp;<span class="op" id="8102255">:=</span>&nbsp;<span class="op" id="8102258">&amp;</span><span class="ident" id="8102259">Type4</span><span class="op" id="8102264">{</span><span class="num" id="8102265">3</span><span class="op" id="8102266">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102269">var</span>&nbsp;<span class="ident" id="8102273">t4</span>&nbsp;<span class="ident" id="8102276">Type4</span>&nbsp;<span class="comment" id="8102282">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102307">if</span>&nbsp;<span class="ident" id="8102310">err</span>&nbsp;<span class="op" id="8102314">:=</span>&nbsp;<span class="ident" id="8102317">encAndDec</span><span class="op" id="8102326">(</span><span class="ident" id="8102327">t4p</span><span class="op" id="8102330">,</span>&nbsp;<span class="ident" id="8102332">t4</span><span class="op" id="8102334">)</span><span class="op" id="8102335">;</span>&nbsp;<span class="ident" id="8102337">err</span>&nbsp;<span class="op" id="8102341">==</span>&nbsp;<span class="ident" id="8102344">nil</span>&nbsp;<span class="op" id="8102348">||</span>&nbsp;<span class="ident" id="8102351">strings</span><span class="op" id="8102358">.</span><span class="ident" id="8102359">Index</span><span class="op" id="8102364">(</span><span class="ident" id="8102365">err</span><span class="op" id="8102368">.</span><span class="ident" id="8102369">Error</span><span class="op" id="8102374">(</span><span class="op" id="8102375">)</span><span class="op" id="8102376">,</span>&nbsp;<span class="string" id="8102378">&#34;pointer&#34;</span><span class="op" id="8102387">)</span>&nbsp;<span class="op" id="8102389">&lt;</span>&nbsp;<span class="num" id="8102391">0</span>&nbsp;<span class="op" id="8102393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102397">t</span><span class="op" id="8102398">.</span><span class="ident" id="8102399">Error</span><span class="op" id="8102404">(</span><span class="string" id="8102405">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="8102440">,</span>&nbsp;<span class="ident" id="8102442">err</span><span class="op" id="8102445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102448">}</span><br>
<span class="lineno"></span><span class="op" id="8102450">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="8102453">func</span>&nbsp;<span class="ident" id="8102458">TestArray</span><span class="op" id="8102467">(</span><span class="ident" id="8102468">t</span>&nbsp;<span class="op" id="8102470">*</span><span class="ident" id="8102471">testing</span><span class="op" id="8102478">.</span><span class="ident" id="8102479">T</span><span class="op" id="8102480">)</span>&nbsp;<span class="op" id="8102482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102485">type</span>&nbsp;<span class="ident" id="8102490">Type5</span>&nbsp;<span class="keyword" id="8102496">struct</span>&nbsp;<span class="op" id="8102503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102507">A</span>&nbsp;<span class="op" id="8102509">[</span><span class="num" id="8102510">3</span><span class="op" id="8102511">]</span><span class="builtintype" id="8102512">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102521">B</span>&nbsp;<span class="op" id="8102523">[</span><span class="num" id="8102524">3</span><span class="op" id="8102525">]</span><span class="builtintype" id="8102526">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102535">type</span>&nbsp;<span class="ident" id="8102540">Type6</span>&nbsp;<span class="keyword" id="8102546">struct</span>&nbsp;<span class="op" id="8102553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102557">A</span>&nbsp;<span class="op" id="8102559">[</span><span class="num" id="8102560">2</span><span class="op" id="8102561">]</span><span class="builtintype" id="8102562">string</span>&nbsp;<span class="comment" id="8102569">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102592">t5</span>&nbsp;<span class="op" id="8102595">:=</span>&nbsp;<span class="ident" id="8102598">Type5</span><span class="op" id="8102603">{</span><span class="op" id="8102604">[</span><span class="num" id="8102605">3</span><span class="op" id="8102606">]</span><span class="builtintype" id="8102607">string</span><span class="op" id="8102613">{</span><span class="string" id="8102614">&#34;hello&#34;</span><span class="op" id="8102621">,</span>&nbsp;<span class="string" id="8102623">&#34;,&#34;</span><span class="op" id="8102626">,</span>&nbsp;<span class="string" id="8102628">&#34;world&#34;</span><span class="op" id="8102635">}</span><span class="op" id="8102636">,</span>&nbsp;<span class="op" id="8102638">[</span><span class="num" id="8102639">3</span><span class="op" id="8102640">]</span><span class="builtintype" id="8102641">byte</span><span class="op" id="8102645">{</span><span class="num" id="8102646">1</span><span class="op" id="8102647">,</span>&nbsp;<span class="num" id="8102649">2</span><span class="op" id="8102650">,</span>&nbsp;<span class="num" id="8102652">3</span><span class="op" id="8102653">}</span><span class="op" id="8102654">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102657">var</span>&nbsp;<span class="ident" id="8102661">t5p</span>&nbsp;<span class="ident" id="8102665">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102672">if</span>&nbsp;<span class="ident" id="8102675">err</span>&nbsp;<span class="op" id="8102679">:=</span>&nbsp;<span class="ident" id="8102682">encAndDec</span><span class="op" id="8102691">(</span><span class="ident" id="8102692">t5</span><span class="op" id="8102694">,</span>&nbsp;<span class="op" id="8102696">&amp;</span><span class="ident" id="8102697">t5p</span><span class="op" id="8102700">)</span><span class="op" id="8102701">;</span>&nbsp;<span class="ident" id="8102703">err</span>&nbsp;<span class="op" id="8102707">!=</span>&nbsp;<span class="ident" id="8102710">nil</span>&nbsp;<span class="op" id="8102714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102718">t</span><span class="op" id="8102719">.</span><span class="ident" id="8102720">Error</span><span class="op" id="8102725">(</span><span class="ident" id="8102726">err</span><span class="op" id="8102729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102735">var</span>&nbsp;<span class="ident" id="8102739">t6</span>&nbsp;<span class="ident" id="8102742">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102749">if</span>&nbsp;<span class="ident" id="8102752">err</span>&nbsp;<span class="op" id="8102756">:=</span>&nbsp;<span class="ident" id="8102759">encAndDec</span><span class="op" id="8102768">(</span><span class="ident" id="8102769">t5</span><span class="op" id="8102771">,</span>&nbsp;<span class="op" id="8102773">&amp;</span><span class="ident" id="8102774">t6</span><span class="op" id="8102776">)</span><span class="op" id="8102777">;</span>&nbsp;<span class="ident" id="8102779">err</span>&nbsp;<span class="op" id="8102783">==</span>&nbsp;<span class="ident" id="8102786">nil</span>&nbsp;<span class="op" id="8102790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102794">t</span><span class="op" id="8102795">.</span><span class="ident" id="8102796">Error</span><span class="op" id="8102801">(</span><span class="string" id="8102802">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="8102843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8102846">}</span><br>
<span class="lineno"></span><span class="op" id="8102848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8102851">func</span>&nbsp;<span class="ident" id="8102856">TestRecursiveMapType</span><span class="op" id="8102876">(</span><span class="ident" id="8102877">t</span>&nbsp;<span class="op" id="8102879">*</span><span class="ident" id="8102880">testing</span><span class="op" id="8102887">.</span><span class="ident" id="8102888">T</span><span class="op" id="8102889">)</span>&nbsp;<span class="op" id="8102891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8102894">type</span>&nbsp;<span class="ident" id="8102899">recursiveMap</span>&nbsp;<span class="keyword" id="8102912">map</span><span class="op" id="8102915">[</span><span class="builtintype" id="8102916">string</span><span class="op" id="8102922">]</span><span class="ident" id="8102923">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8102937">r1</span>&nbsp;<span class="op" id="8102940">:=</span>&nbsp;<span class="ident" id="8102943">recursiveMap</span><span class="op" id="8102955">{</span><span class="string" id="8102956">&#34;A&#34;</span><span class="op" id="8102959">:</span>&nbsp;<span class="ident" id="8102961">recursiveMap</span><span class="op" id="8102973">{</span><span class="string" id="8102974">&#34;B&#34;</span><span class="op" id="8102977">:</span>&nbsp;<span class="ident" id="8102979">nil</span><span class="op" id="8102982">,</span>&nbsp;<span class="string" id="8102984">&#34;C&#34;</span><span class="op" id="8102987">:</span>&nbsp;<span class="ident" id="8102989">nil</span><span class="op" id="8102992">}</span><span class="op" id="8102993">,</span>&nbsp;<span class="string" id="8102995">&#34;D&#34;</span><span class="op" id="8102998">:</span>&nbsp;<span class="ident" id="8103000">nil</span><span class="op" id="8103003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103006">r2</span>&nbsp;<span class="op" id="8103009">:=</span>&nbsp;<span class="builtinfunc" id="8103012">make</span><span class="op" id="8103016">(</span><span class="ident" id="8103017">recursiveMap</span><span class="op" id="8103029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103032">if</span>&nbsp;<span class="ident" id="8103035">err</span>&nbsp;<span class="op" id="8103039">:=</span>&nbsp;<span class="ident" id="8103042">encAndDec</span><span class="op" id="8103051">(</span><span class="ident" id="8103052">r1</span><span class="op" id="8103054">,</span>&nbsp;<span class="op" id="8103056">&amp;</span><span class="ident" id="8103057">r2</span><span class="op" id="8103059">)</span><span class="op" id="8103060">;</span>&nbsp;<span class="ident" id="8103062">err</span>&nbsp;<span class="op" id="8103066">!=</span>&nbsp;<span class="ident" id="8103069">nil</span>&nbsp;<span class="op" id="8103073">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103077">t</span><span class="op" id="8103078">.</span><span class="ident" id="8103079">Error</span><span class="op" id="8103084">(</span><span class="ident" id="8103085">err</span><span class="op" id="8103088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103091">}</span><br>
<span class="lineno"></span><span class="op" id="8103093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8103096">func</span>&nbsp;<span class="ident" id="8103101">TestRecursiveSliceType</span><span class="op" id="8103123">(</span><span class="ident" id="8103124">t</span>&nbsp;<span class="op" id="8103126">*</span><span class="ident" id="8103127">testing</span><span class="op" id="8103134">.</span><span class="ident" id="8103135">T</span><span class="op" id="8103136">)</span>&nbsp;<span class="op" id="8103138">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103141">type</span>&nbsp;<span class="ident" id="8103146">recursiveSlice</span>&nbsp;<span class="op" id="8103161">[</span><span class="op" id="8103162">]</span><span class="ident" id="8103163">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103179">r1</span>&nbsp;<span class="op" id="8103182">:=</span>&nbsp;<span class="ident" id="8103185">recursiveSlice</span><span class="op" id="8103199">{</span><span class="num" id="8103200">0</span><span class="op" id="8103201">:</span>&nbsp;<span class="ident" id="8103203">recursiveSlice</span><span class="op" id="8103217">{</span><span class="num" id="8103218">0</span><span class="op" id="8103219">:</span>&nbsp;<span class="ident" id="8103221">nil</span><span class="op" id="8103224">}</span><span class="op" id="8103225">,</span>&nbsp;<span class="num" id="8103227">1</span><span class="op" id="8103228">:</span>&nbsp;<span class="ident" id="8103230">nil</span><span class="op" id="8103233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103236">r2</span>&nbsp;<span class="op" id="8103239">:=</span>&nbsp;<span class="builtinfunc" id="8103242">make</span><span class="op" id="8103246">(</span><span class="ident" id="8103247">recursiveSlice</span><span class="op" id="8103261">,</span>&nbsp;<span class="num" id="8103263">0</span><span class="op" id="8103264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103267">if</span>&nbsp;<span class="ident" id="8103270">err</span>&nbsp;<span class="op" id="8103274">:=</span>&nbsp;<span class="ident" id="8103277">encAndDec</span><span class="op" id="8103286">(</span><span class="ident" id="8103287">r1</span><span class="op" id="8103289">,</span>&nbsp;<span class="op" id="8103291">&amp;</span><span class="ident" id="8103292">r2</span><span class="op" id="8103294">)</span><span class="op" id="8103295">;</span>&nbsp;<span class="ident" id="8103297">err</span>&nbsp;<span class="op" id="8103301">!=</span>&nbsp;<span class="ident" id="8103304">nil</span>&nbsp;<span class="op" id="8103308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103312">t</span><span class="op" id="8103313">.</span><span class="ident" id="8103314">Error</span><span class="op" id="8103319">(</span><span class="ident" id="8103320">err</span><span class="op" id="8103323">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103326">}</span><br>
<span class="lineno"></span><span class="op" id="8103328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8103331">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="8103395">func</span>&nbsp;<span class="ident" id="8103400">TestDefaultsInArray</span><span class="op" id="8103419">(</span><span class="ident" id="8103420">t</span>&nbsp;<span class="op" id="8103422">*</span><span class="ident" id="8103423">testing</span><span class="op" id="8103430">.</span><span class="ident" id="8103431">T</span><span class="op" id="8103432">)</span>&nbsp;<span class="op" id="8103434">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103437">type</span>&nbsp;<span class="ident" id="8103442">Type7</span>&nbsp;<span class="keyword" id="8103448">struct</span>&nbsp;<span class="op" id="8103455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103459">B</span>&nbsp;<span class="op" id="8103461">[</span><span class="op" id="8103462">]</span><span class="builtintype" id="8103463">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103470">I</span>&nbsp;<span class="op" id="8103472">[</span><span class="op" id="8103473">]</span><span class="builtintype" id="8103474">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103480">S</span>&nbsp;<span class="op" id="8103482">[</span><span class="op" id="8103483">]</span><span class="builtintype" id="8103484">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103493">F</span>&nbsp;<span class="op" id="8103495">[</span><span class="op" id="8103496">]</span><span class="builtintype" id="8103497">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103509">t7</span>&nbsp;<span class="op" id="8103512">:=</span>&nbsp;<span class="ident" id="8103515">Type7</span><span class="op" id="8103520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103524">[</span><span class="op" id="8103525">]</span><span class="builtintype" id="8103526">bool</span><span class="op" id="8103530">{</span><span class="builtintype" id="8103531">false</span><span class="op" id="8103536">,</span>&nbsp;<span class="builtintype" id="8103538">false</span><span class="op" id="8103543">,</span>&nbsp;<span class="builtintype" id="8103545">true</span><span class="op" id="8103549">}</span><span class="op" id="8103550">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103554">[</span><span class="op" id="8103555">]</span><span class="builtintype" id="8103556">int</span><span class="op" id="8103559">{</span><span class="num" id="8103560">0</span><span class="op" id="8103561">,</span>&nbsp;<span class="num" id="8103563">0</span><span class="op" id="8103564">,</span>&nbsp;<span class="num" id="8103566">1</span><span class="op" id="8103567">}</span><span class="op" id="8103568">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103572">[</span><span class="op" id="8103573">]</span><span class="builtintype" id="8103574">string</span><span class="op" id="8103580">{</span><span class="string" id="8103581">&#34;hi&#34;</span><span class="op" id="8103585">,</span>&nbsp;<span class="string" id="8103587">&#34;&#34;</span><span class="op" id="8103589">,</span>&nbsp;<span class="string" id="8103591">&#34;there&#34;</span><span class="op" id="8103598">}</span><span class="op" id="8103599">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103603">[</span><span class="op" id="8103604">]</span><span class="builtintype" id="8103605">float64</span><span class="op" id="8103612">{</span><span class="num" id="8103613">0</span><span class="op" id="8103614">,</span>&nbsp;<span class="num" id="8103616">0</span><span class="op" id="8103617">,</span>&nbsp;<span class="num" id="8103619">1</span><span class="op" id="8103620">}</span><span class="op" id="8103621">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103627">var</span>&nbsp;<span class="ident" id="8103631">t7p</span>&nbsp;<span class="ident" id="8103635">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8103642">if</span>&nbsp;<span class="ident" id="8103645">err</span>&nbsp;<span class="op" id="8103649">:=</span>&nbsp;<span class="ident" id="8103652">encAndDec</span><span class="op" id="8103661">(</span><span class="ident" id="8103662">t7</span><span class="op" id="8103664">,</span>&nbsp;<span class="op" id="8103666">&amp;</span><span class="ident" id="8103667">t7p</span><span class="op" id="8103670">)</span><span class="op" id="8103671">;</span>&nbsp;<span class="ident" id="8103673">err</span>&nbsp;<span class="op" id="8103677">!=</span>&nbsp;<span class="ident" id="8103680">nil</span>&nbsp;<span class="op" id="8103684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103688">t</span><span class="op" id="8103689">.</span><span class="ident" id="8103690">Error</span><span class="op" id="8103695">(</span><span class="ident" id="8103696">err</span><span class="op" id="8103699">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103702">}</span><br>
<span class="lineno"></span><span class="op" id="8103704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8103707">var</span>&nbsp;<span class="ident" id="8103711">testInt</span>&nbsp;<span class="builtintype" id="8103719">int</span><br>
<span class="lineno"></span><span class="keyword" id="8103723">var</span>&nbsp;<span class="ident" id="8103727">testFloat32</span>&nbsp;<span class="builtintype" id="8103739">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="8103747">var</span>&nbsp;<span class="ident" id="8103751">testString</span>&nbsp;<span class="builtintype" id="8103762">string</span><br>
<span class="lineno"></span><span class="keyword" id="8103769">var</span>&nbsp;<span class="ident" id="8103773">testSlice</span>&nbsp;<span class="op" id="8103783">[</span><span class="op" id="8103784">]</span><span class="builtintype" id="8103785">string</span><br>
<span class="lineno"></span><span class="keyword" id="8103792">var</span>&nbsp;<span class="ident" id="8103796">testMap</span>&nbsp;<span class="keyword" id="8103804">map</span><span class="op" id="8103807">[</span><span class="builtintype" id="8103808">string</span><span class="op" id="8103814">]</span><span class="builtintype" id="8103815">int</span><br>
<span class="lineno"></span><span class="keyword" id="8103819">var</span>&nbsp;<span class="ident" id="8103823">testArray</span>&nbsp;<span class="op" id="8103833">[</span><span class="num" id="8103834">7</span><span class="op" id="8103835">]</span><span class="builtintype" id="8103836">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="8103841">type</span>&nbsp;<span class="ident" id="8103846">SingleTest</span>&nbsp;<span class="keyword" id="8103857">struct</span>&nbsp;<span class="op" id="8103864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103867">in</span>&nbsp;&nbsp;<span class="keyword" id="8103871">interface</span><span class="op" id="8103880">{</span><span class="op" id="8103881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103884">out</span>&nbsp;<span class="keyword" id="8103888">interface</span><span class="op" id="8103897">{</span><span class="op" id="8103898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8103901">err</span>&nbsp;<span class="builtintype" id="8103905">string</span><br>
<span class="lineno"></span><span class="op" id="8103912">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="8103915">var</span>&nbsp;<span class="ident" id="8103919">singleTests</span>&nbsp;<span class="op" id="8103931">=</span>&nbsp;<span class="op" id="8103933">[</span><span class="op" id="8103934">]</span><span class="ident" id="8103935">SingleTest</span><span class="op" id="8103945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103948">{</span><span class="num" id="8103949">17</span><span class="op" id="8103951">,</span>&nbsp;<span class="op" id="8103953">&amp;</span><span class="ident" id="8103954">testInt</span><span class="op" id="8103961">,</span>&nbsp;<span class="string" id="8103963">&#34;&#34;</span><span class="op" id="8103965">}</span><span class="op" id="8103966">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8103969">{</span><span class="builtintype" id="8103970">float32</span><span class="op" id="8103977">(</span><span class="num" id="8103978">17.5</span><span class="op" id="8103982">)</span><span class="op" id="8103983">,</span>&nbsp;<span class="op" id="8103985">&amp;</span><span class="ident" id="8103986">testFloat32</span><span class="op" id="8103997">,</span>&nbsp;<span class="string" id="8103999">&#34;&#34;</span><span class="op" id="8104001">}</span><span class="op" id="8104002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104005">{</span><span class="string" id="8104006">&#34;bike&nbsp;shed&#34;</span><span class="op" id="8104017">,</span>&nbsp;<span class="op" id="8104019">&amp;</span><span class="ident" id="8104020">testString</span><span class="op" id="8104030">,</span>&nbsp;<span class="string" id="8104032">&#34;&#34;</span><span class="op" id="8104034">}</span><span class="op" id="8104035">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104038">{</span><span class="op" id="8104039">[</span><span class="op" id="8104040">]</span><span class="builtintype" id="8104041">string</span><span class="op" id="8104047">{</span><span class="string" id="8104048">&#34;bike&#34;</span><span class="op" id="8104054">,</span>&nbsp;<span class="string" id="8104056">&#34;shed&#34;</span><span class="op" id="8104062">,</span>&nbsp;<span class="string" id="8104064">&#34;paint&#34;</span><span class="op" id="8104071">,</span>&nbsp;<span class="string" id="8104073">&#34;color&#34;</span><span class="op" id="8104080">}</span><span class="op" id="8104081">,</span>&nbsp;<span class="op" id="8104083">&amp;</span><span class="ident" id="8104084">testSlice</span><span class="op" id="8104093">,</span>&nbsp;<span class="string" id="8104095">&#34;&#34;</span><span class="op" id="8104097">}</span><span class="op" id="8104098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104101">{</span><span class="keyword" id="8104102">map</span><span class="op" id="8104105">[</span><span class="builtintype" id="8104106">string</span><span class="op" id="8104112">]</span><span class="builtintype" id="8104113">int</span><span class="op" id="8104116">{</span><span class="string" id="8104117">&#34;seven&#34;</span><span class="op" id="8104124">:</span>&nbsp;<span class="num" id="8104126">7</span><span class="op" id="8104127">,</span>&nbsp;<span class="string" id="8104129">&#34;twelve&#34;</span><span class="op" id="8104137">:</span>&nbsp;<span class="num" id="8104139">12</span><span class="op" id="8104141">}</span><span class="op" id="8104142">,</span>&nbsp;<span class="op" id="8104144">&amp;</span><span class="ident" id="8104145">testMap</span><span class="op" id="8104152">,</span>&nbsp;<span class="string" id="8104154">&#34;&#34;</span><span class="op" id="8104156">}</span><span class="op" id="8104157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104160">{</span><span class="op" id="8104161">[</span><span class="num" id="8104162">7</span><span class="op" id="8104163">]</span><span class="builtintype" id="8104164">int</span><span class="op" id="8104167">{</span><span class="num" id="8104168">4</span><span class="op" id="8104169">,</span>&nbsp;<span class="num" id="8104171">55</span><span class="op" id="8104173">,</span>&nbsp;<span class="num" id="8104175">0</span><span class="op" id="8104176">,</span>&nbsp;<span class="num" id="8104178">0</span><span class="op" id="8104179">,</span>&nbsp;<span class="num" id="8104181">0</span><span class="op" id="8104182">,</span>&nbsp;<span class="num" id="8104184">0</span><span class="op" id="8104185">,</span>&nbsp;<span class="num" id="8104187">0</span><span class="op" id="8104188">}</span><span class="op" id="8104189">,</span>&nbsp;<span class="op" id="8104191">&amp;</span><span class="ident" id="8104192">testArray</span><span class="op" id="8104201">,</span>&nbsp;<span class="string" id="8104203">&#34;&#34;</span><span class="op" id="8104205">}</span><span class="op" id="8104206">,</span>&nbsp;<span class="comment" id="8104208">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104243">{</span><span class="op" id="8104244">[</span><span class="num" id="8104245">7</span><span class="op" id="8104246">]</span><span class="builtintype" id="8104247">int</span><span class="op" id="8104250">{</span><span class="num" id="8104251">4</span><span class="op" id="8104252">,</span>&nbsp;<span class="num" id="8104254">55</span><span class="op" id="8104256">,</span>&nbsp;<span class="num" id="8104258">1</span><span class="op" id="8104259">,</span>&nbsp;<span class="num" id="8104261">44</span><span class="op" id="8104263">,</span>&nbsp;<span class="num" id="8104265">22</span><span class="op" id="8104267">,</span>&nbsp;<span class="num" id="8104269">66</span><span class="op" id="8104271">,</span>&nbsp;<span class="num" id="8104273">1234</span><span class="op" id="8104277">}</span><span class="op" id="8104278">,</span>&nbsp;<span class="op" id="8104280">&amp;</span><span class="ident" id="8104281">testArray</span><span class="op" id="8104290">,</span>&nbsp;<span class="string" id="8104292">&#34;&#34;</span><span class="op" id="8104294">}</span><span class="op" id="8104295">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8104299">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104317">{</span><span class="num" id="8104318">172</span><span class="op" id="8104321">,</span>&nbsp;<span class="op" id="8104323">&amp;</span><span class="ident" id="8104324">testFloat32</span><span class="op" id="8104335">,</span>&nbsp;<span class="string" id="8104337">&#34;type&#34;</span><span class="op" id="8104343">}</span><span class="op" id="8104344">,</span><br>
<span class="lineno"></span><span class="op" id="8104346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8104349">func</span>&nbsp;<span class="ident" id="8104354">TestSingletons</span><span class="op" id="8104368">(</span><span class="ident" id="8104369">t</span>&nbsp;<span class="op" id="8104371">*</span><span class="ident" id="8104372">testing</span><span class="op" id="8104379">.</span><span class="ident" id="8104380">T</span><span class="op" id="8104381">)</span>&nbsp;<span class="op" id="8104383">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104386">b</span>&nbsp;<span class="op" id="8104388">:=</span>&nbsp;<span class="builtinfunc" id="8104391">new</span><span class="op" id="8104394">(</span><span class="ident" id="8104395">bytes</span><span class="op" id="8104400">.</span><span class="ident" id="8104401">Buffer</span><span class="op" id="8104407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104410">enc</span>&nbsp;<span class="op" id="8104414">:=</span>&nbsp;<span class="ident" id="8104417">NewEncoder</span><span class="op" id="8104427">(</span><span class="ident" id="8104428">b</span><span class="op" id="8104429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104432">dec</span>&nbsp;<span class="op" id="8104436">:=</span>&nbsp;<span class="ident" id="8104439">NewDecoder</span><span class="op" id="8104449">(</span><span class="ident" id="8104450">b</span><span class="op" id="8104451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104454">for</span>&nbsp;<span class="ident" id="8104458">_</span><span class="op" id="8104459">,</span>&nbsp;<span class="ident" id="8104461">test</span>&nbsp;<span class="op" id="8104466">:=</span>&nbsp;<span class="keyword" id="8104469">range</span>&nbsp;<span class="ident" id="8104475">singleTests</span>&nbsp;<span class="op" id="8104487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104491">b</span><span class="op" id="8104492">.</span><span class="ident" id="8104493">Reset</span><span class="op" id="8104498">(</span><span class="op" id="8104499">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104503">err</span>&nbsp;<span class="op" id="8104507">:=</span>&nbsp;<span class="ident" id="8104510">enc</span><span class="op" id="8104513">.</span><span class="ident" id="8104514">Encode</span><span class="op" id="8104520">(</span><span class="ident" id="8104521">test</span><span class="op" id="8104525">.</span><span class="ident" id="8104526">in</span><span class="op" id="8104528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104532">if</span>&nbsp;<span class="ident" id="8104535">err</span>&nbsp;<span class="op" id="8104539">!=</span>&nbsp;<span class="ident" id="8104542">nil</span>&nbsp;<span class="op" id="8104546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104551">t</span><span class="op" id="8104552">.</span><span class="ident" id="8104553">Errorf</span><span class="op" id="8104559">(</span><span class="string" id="8104560">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8104583">,</span>&nbsp;<span class="ident" id="8104585">test</span><span class="op" id="8104589">.</span><span class="ident" id="8104590">in</span><span class="op" id="8104592">,</span>&nbsp;<span class="ident" id="8104594">err</span><span class="op" id="8104597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104602">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8104613">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104617">err</span>&nbsp;<span class="op" id="8104621">=</span>&nbsp;<span class="ident" id="8104623">dec</span><span class="op" id="8104626">.</span><span class="ident" id="8104627">Decode</span><span class="op" id="8104633">(</span><span class="ident" id="8104634">test</span><span class="op" id="8104638">.</span><span class="ident" id="8104639">out</span><span class="op" id="8104642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104646">switch</span>&nbsp;<span class="op" id="8104653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104657">case</span>&nbsp;<span class="ident" id="8104662">err</span>&nbsp;<span class="op" id="8104666">!=</span>&nbsp;<span class="ident" id="8104669">nil</span>&nbsp;<span class="op" id="8104673">&amp;&amp;</span>&nbsp;<span class="ident" id="8104676">test</span><span class="op" id="8104680">.</span><span class="ident" id="8104681">err</span>&nbsp;<span class="op" id="8104685">==</span>&nbsp;<span class="string" id="8104688">&#34;&#34;</span><span class="op" id="8104690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104695">t</span><span class="op" id="8104696">.</span><span class="ident" id="8104697">Errorf</span><span class="op" id="8104703">(</span><span class="string" id="8104704">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8104727">,</span>&nbsp;<span class="ident" id="8104729">test</span><span class="op" id="8104733">.</span><span class="ident" id="8104734">in</span><span class="op" id="8104736">,</span>&nbsp;<span class="ident" id="8104738">err</span><span class="op" id="8104741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104746">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104757">case</span>&nbsp;<span class="ident" id="8104762">err</span>&nbsp;<span class="op" id="8104766">==</span>&nbsp;<span class="ident" id="8104769">nil</span>&nbsp;<span class="op" id="8104773">&amp;&amp;</span>&nbsp;<span class="ident" id="8104776">test</span><span class="op" id="8104780">.</span><span class="ident" id="8104781">err</span>&nbsp;<span class="op" id="8104785">!=</span>&nbsp;<span class="string" id="8104788">&#34;&#34;</span><span class="op" id="8104790">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104795">t</span><span class="op" id="8104796">.</span><span class="ident" id="8104797">Errorf</span><span class="op" id="8104803">(</span><span class="string" id="8104804">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="8104836">,</span>&nbsp;<span class="ident" id="8104838">test</span><span class="op" id="8104842">.</span><span class="ident" id="8104843">in</span><span class="op" id="8104845">,</span>&nbsp;<span class="ident" id="8104847">test</span><span class="op" id="8104851">.</span><span class="ident" id="8104852">err</span><span class="op" id="8104855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104860">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104871">case</span>&nbsp;<span class="ident" id="8104876">err</span>&nbsp;<span class="op" id="8104880">!=</span>&nbsp;<span class="ident" id="8104883">nil</span>&nbsp;<span class="op" id="8104887">&amp;&amp;</span>&nbsp;<span class="ident" id="8104890">test</span><span class="op" id="8104894">.</span><span class="ident" id="8104895">err</span>&nbsp;<span class="op" id="8104899">!=</span>&nbsp;<span class="string" id="8104902">&#34;&#34;</span><span class="op" id="8104904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8104909">if</span>&nbsp;<span class="ident" id="8104912">strings</span><span class="op" id="8104919">.</span><span class="ident" id="8104920">Index</span><span class="op" id="8104925">(</span><span class="ident" id="8104926">err</span><span class="op" id="8104929">.</span><span class="ident" id="8104930">Error</span><span class="op" id="8104935">(</span><span class="op" id="8104936">)</span><span class="op" id="8104937">,</span>&nbsp;<span class="ident" id="8104939">test</span><span class="op" id="8104943">.</span><span class="ident" id="8104944">err</span><span class="op" id="8104947">)</span>&nbsp;<span class="op" id="8104949">&lt;</span>&nbsp;<span class="num" id="8104951">0</span>&nbsp;<span class="op" id="8104953">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8104959">t</span><span class="op" id="8104960">.</span><span class="ident" id="8104961">Errorf</span><span class="op" id="8104967">(</span><span class="string" id="8104968">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8105012">,</span>&nbsp;<span class="ident" id="8105014">test</span><span class="op" id="8105018">.</span><span class="ident" id="8105019">in</span><span class="op" id="8105021">,</span>&nbsp;<span class="ident" id="8105023">test</span><span class="op" id="8105027">.</span><span class="ident" id="8105028">err</span><span class="op" id="8105031">,</span>&nbsp;<span class="ident" id="8105033">err</span><span class="op" id="8105036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105046">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8105061">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105100">val</span>&nbsp;<span class="op" id="8105104">:=</span>&nbsp;<span class="ident" id="8105107">reflect</span><span class="op" id="8105114">.</span><span class="ident" id="8105115">ValueOf</span><span class="op" id="8105122">(</span><span class="ident" id="8105123">test</span><span class="op" id="8105127">.</span><span class="ident" id="8105128">out</span><span class="op" id="8105131">)</span><span class="op" id="8105132">.</span><span class="ident" id="8105133">Elem</span><span class="op" id="8105137">(</span><span class="op" id="8105138">)</span><span class="op" id="8105139">.</span><span class="ident" id="8105140">Interface</span><span class="op" id="8105149">(</span><span class="op" id="8105150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105154">if</span>&nbsp;<span class="op" id="8105157">!</span><span class="ident" id="8105158">reflect</span><span class="op" id="8105165">.</span><span class="ident" id="8105166">DeepEqual</span><span class="op" id="8105175">(</span><span class="ident" id="8105176">test</span><span class="op" id="8105180">.</span><span class="ident" id="8105181">in</span><span class="op" id="8105183">,</span>&nbsp;<span class="ident" id="8105185">val</span><span class="op" id="8105188">)</span>&nbsp;<span class="op" id="8105190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105195">t</span><span class="op" id="8105196">.</span><span class="ident" id="8105197">Errorf</span><span class="op" id="8105203">(</span><span class="string" id="8105204">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8105244">,</span>&nbsp;<span class="ident" id="8105246">test</span><span class="op" id="8105250">.</span><span class="ident" id="8105251">in</span><span class="op" id="8105253">,</span>&nbsp;<span class="ident" id="8105255">val</span><span class="op" id="8105258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105265">}</span><br>
<span class="lineno">420</span><span class="op" id="8105267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105270">func</span>&nbsp;<span class="ident" id="8105275">TestStructNonStruct</span><span class="op" id="8105294">(</span><span class="ident" id="8105295">t</span>&nbsp;<span class="op" id="8105297">*</span><span class="ident" id="8105298">testing</span><span class="op" id="8105305">.</span><span class="ident" id="8105306">T</span><span class="op" id="8105307">)</span>&nbsp;<span class="op" id="8105309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105312">type</span>&nbsp;<span class="ident" id="8105317">Struct</span>&nbsp;<span class="keyword" id="8105324">struct</span>&nbsp;<span class="op" id="8105331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105335">A</span>&nbsp;<span class="builtintype" id="8105337">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105348">type</span>&nbsp;<span class="ident" id="8105353">NonStruct</span>&nbsp;<span class="builtintype" id="8105363">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105371">s</span>&nbsp;<span class="op" id="8105373">:=</span>&nbsp;<span class="ident" id="8105376">Struct</span><span class="op" id="8105382">{</span><span class="string" id="8105383">&#34;hello&#34;</span><span class="op" id="8105390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105393">var</span>&nbsp;<span class="ident" id="8105397">sp</span>&nbsp;<span class="ident" id="8105400">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105408">if</span>&nbsp;<span class="ident" id="8105411">err</span>&nbsp;<span class="op" id="8105415">:=</span>&nbsp;<span class="ident" id="8105418">encAndDec</span><span class="op" id="8105427">(</span><span class="ident" id="8105428">s</span><span class="op" id="8105429">,</span>&nbsp;<span class="op" id="8105431">&amp;</span><span class="ident" id="8105432">sp</span><span class="op" id="8105434">)</span><span class="op" id="8105435">;</span>&nbsp;<span class="ident" id="8105437">err</span>&nbsp;<span class="op" id="8105441">!=</span>&nbsp;<span class="ident" id="8105444">nil</span>&nbsp;<span class="op" id="8105448">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105452">t</span><span class="op" id="8105453">.</span><span class="ident" id="8105454">Error</span><span class="op" id="8105459">(</span><span class="ident" id="8105460">err</span><span class="op" id="8105463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105469">var</span>&nbsp;<span class="ident" id="8105473">ns</span>&nbsp;<span class="ident" id="8105476">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105487">if</span>&nbsp;<span class="ident" id="8105490">err</span>&nbsp;<span class="op" id="8105494">:=</span>&nbsp;<span class="ident" id="8105497">encAndDec</span><span class="op" id="8105506">(</span><span class="ident" id="8105507">s</span><span class="op" id="8105508">,</span>&nbsp;<span class="op" id="8105510">&amp;</span><span class="ident" id="8105511">ns</span><span class="op" id="8105513">)</span><span class="op" id="8105514">;</span>&nbsp;<span class="ident" id="8105516">err</span>&nbsp;<span class="op" id="8105520">==</span>&nbsp;<span class="ident" id="8105523">nil</span>&nbsp;<span class="op" id="8105527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105531">t</span><span class="op" id="8105532">.</span><span class="ident" id="8105533">Error</span><span class="op" id="8105538">(</span><span class="string" id="8105539">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="8105579">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105582">}</span>&nbsp;<span class="keyword" id="8105584">else</span>&nbsp;<span class="keyword" id="8105589">if</span>&nbsp;<span class="ident" id="8105592">strings</span><span class="op" id="8105599">.</span><span class="ident" id="8105600">Index</span><span class="op" id="8105605">(</span><span class="ident" id="8105606">err</span><span class="op" id="8105609">.</span><span class="ident" id="8105610">Error</span><span class="op" id="8105615">(</span><span class="op" id="8105616">)</span><span class="op" id="8105617">,</span>&nbsp;<span class="string" id="8105619">&#34;type&#34;</span><span class="op" id="8105625">)</span>&nbsp;<span class="op" id="8105627">&lt;</span>&nbsp;<span class="num" id="8105629">0</span>&nbsp;<span class="op" id="8105631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105635">t</span><span class="op" id="8105636">.</span><span class="ident" id="8105637">Error</span><span class="op" id="8105642">(</span><span class="string" id="8105643">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8105691">,</span>&nbsp;<span class="ident" id="8105693">err</span><span class="op" id="8105696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8105702">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105728">var</span>&nbsp;<span class="ident" id="8105732">nsp</span>&nbsp;<span class="ident" id="8105736">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105747">if</span>&nbsp;<span class="ident" id="8105750">err</span>&nbsp;<span class="op" id="8105754">:=</span>&nbsp;<span class="ident" id="8105757">encAndDec</span><span class="op" id="8105766">(</span><span class="ident" id="8105767">ns</span><span class="op" id="8105769">,</span>&nbsp;<span class="op" id="8105771">&amp;</span><span class="ident" id="8105772">nsp</span><span class="op" id="8105775">)</span><span class="op" id="8105776">;</span>&nbsp;<span class="ident" id="8105778">err</span>&nbsp;<span class="op" id="8105782">!=</span>&nbsp;<span class="ident" id="8105785">nil</span>&nbsp;<span class="op" id="8105789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105793">t</span><span class="op" id="8105794">.</span><span class="ident" id="8105795">Error</span><span class="op" id="8105800">(</span><span class="ident" id="8105801">err</span><span class="op" id="8105804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8105810">if</span>&nbsp;<span class="ident" id="8105813">err</span>&nbsp;<span class="op" id="8105817">:=</span>&nbsp;<span class="ident" id="8105820">encAndDec</span><span class="op" id="8105829">(</span><span class="ident" id="8105830">ns</span><span class="op" id="8105832">,</span>&nbsp;<span class="op" id="8105834">&amp;</span><span class="ident" id="8105835">s</span><span class="op" id="8105836">)</span><span class="op" id="8105837">;</span>&nbsp;<span class="ident" id="8105839">err</span>&nbsp;<span class="op" id="8105843">==</span>&nbsp;<span class="ident" id="8105846">nil</span>&nbsp;<span class="op" id="8105850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105854">t</span><span class="op" id="8105855">.</span><span class="ident" id="8105856">Error</span><span class="op" id="8105861">(</span><span class="string" id="8105862">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="8105902">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8105905">}</span>&nbsp;<span class="keyword" id="8105907">else</span>&nbsp;<span class="keyword" id="8105912">if</span>&nbsp;<span class="ident" id="8105915">strings</span><span class="op" id="8105922">.</span><span class="ident" id="8105923">Index</span><span class="op" id="8105928">(</span><span class="ident" id="8105929">err</span><span class="op" id="8105932">.</span><span class="ident" id="8105933">Error</span><span class="op" id="8105938">(</span><span class="op" id="8105939">)</span><span class="op" id="8105940">,</span>&nbsp;<span class="string" id="8105942">&#34;type&#34;</span><span class="op" id="8105948">)</span>&nbsp;<span class="op" id="8105950">&lt;</span>&nbsp;<span class="num" id="8105952">0</span>&nbsp;<span class="op" id="8105954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8105958">t</span><span class="op" id="8105959">.</span><span class="ident" id="8105960">Error</span><span class="op" id="8105965">(</span><span class="string" id="8105966">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8106014">,</span>&nbsp;<span class="ident" id="8106016">err</span><span class="op" id="8106019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8106022">}</span><br>
<span class="lineno"></span><span class="op" id="8106024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8106027">type</span>&nbsp;<span class="ident" id="8106032">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="8106055">interface</span>&nbsp;<span class="op" id="8106065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106068">F</span><span class="op" id="8106069">(</span><span class="op" id="8106070">)</span>&nbsp;<span class="builtintype" id="8106072">bool</span><br>
<span class="lineno"></span><span class="op" id="8106077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8106080">type</span>&nbsp;<span class="ident" id="8106085">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="8106108">struct</span><span class="op" id="8106114">{</span><span class="op" id="8106115">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8106118">func</span>&nbsp;<span class="op" id="8106123">(</span><span class="ident" id="8106124">this</span>&nbsp;<span class="op" id="8106129">*</span><span class="ident" id="8106130">interfaceIndirectTestT</span><span class="op" id="8106152">)</span>&nbsp;<span class="ident" id="8106154">F</span><span class="op" id="8106155">(</span><span class="op" id="8106156">)</span>&nbsp;<span class="builtintype" id="8106158">bool</span>&nbsp;<span class="op" id="8106163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8106166">return</span>&nbsp;<span class="builtintype" id="8106173">true</span><br>
<span class="lineno"></span><span class="op" id="8106178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="8106181">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="8106250">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="8106319">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="8106351">func</span>&nbsp;<span class="ident" id="8106356">TestInterfaceIndirect</span><span class="op" id="8106377">(</span><span class="ident" id="8106378">t</span>&nbsp;<span class="op" id="8106380">*</span><span class="ident" id="8106381">testing</span><span class="op" id="8106388">.</span><span class="ident" id="8106389">T</span><span class="op" id="8106390">)</span>&nbsp;<span class="op" id="8106392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106395">Register</span><span class="op" id="8106403">(</span><span class="op" id="8106404">&amp;</span><span class="ident" id="8106405">interfaceIndirectTestT</span><span class="op" id="8106427">{</span><span class="op" id="8106428">}</span><span class="op" id="8106429">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106432">b</span>&nbsp;<span class="op" id="8106434">:=</span>&nbsp;<span class="builtinfunc" id="8106437">new</span><span class="op" id="8106440">(</span><span class="ident" id="8106441">bytes</span><span class="op" id="8106446">.</span><span class="ident" id="8106447">Buffer</span><span class="op" id="8106453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106456">w</span>&nbsp;<span class="op" id="8106458">:=</span>&nbsp;<span class="op" id="8106461">[</span><span class="op" id="8106462">]</span><span class="ident" id="8106463">interfaceIndirectTestI</span><span class="op" id="8106485">{</span><span class="op" id="8106486">&amp;</span><span class="ident" id="8106487">interfaceIndirectTestT</span><span class="op" id="8106509">{</span><span class="op" id="8106510">}</span><span class="op" id="8106511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106514">err</span>&nbsp;<span class="op" id="8106518">:=</span>&nbsp;<span class="ident" id="8106521">NewEncoder</span><span class="op" id="8106531">(</span><span class="ident" id="8106532">b</span><span class="op" id="8106533">)</span><span class="op" id="8106534">.</span><span class="ident" id="8106535">Encode</span><span class="op" id="8106541">(</span><span class="ident" id="8106542">w</span><span class="op" id="8106543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8106546">if</span>&nbsp;<span class="ident" id="8106549">err</span>&nbsp;<span class="op" id="8106553">!=</span>&nbsp;<span class="ident" id="8106556">nil</span>&nbsp;<span class="op" id="8106560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106564">t</span><span class="op" id="8106565">.</span><span class="ident" id="8106566">Fatal</span><span class="op" id="8106571">(</span><span class="string" id="8106572">&#34;encode&nbsp;error:&#34;</span><span class="op" id="8106587">,</span>&nbsp;<span class="ident" id="8106589">err</span><span class="op" id="8106592">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8106595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8106599">var</span>&nbsp;<span class="ident" id="8106603">r</span>&nbsp;<span class="op" id="8106605">[</span><span class="op" id="8106606">]</span><span class="ident" id="8106607">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106631">err</span>&nbsp;<span class="op" id="8106635">=</span>&nbsp;<span class="ident" id="8106637">NewDecoder</span><span class="op" id="8106647">(</span><span class="ident" id="8106648">b</span><span class="op" id="8106649">)</span><span class="op" id="8106650">.</span><span class="ident" id="8106651">Decode</span><span class="op" id="8106657">(</span><span class="op" id="8106658">&amp;</span><span class="ident" id="8106659">r</span><span class="op" id="8106660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8106663">if</span>&nbsp;<span class="ident" id="8106666">err</span>&nbsp;<span class="op" id="8106670">!=</span>&nbsp;<span class="ident" id="8106673">nil</span>&nbsp;<span class="op" id="8106677">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8106681">t</span><span class="op" id="8106682">.</span><span class="ident" id="8106683">Fatal</span><span class="op" id="8106688">(</span><span class="string" id="8106689">&#34;decode&nbsp;error:&#34;</span><span class="op" id="8106704">,</span>&nbsp;<span class="ident" id="8106706">err</span><span class="op" id="8106709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8106712">}</span><br>
<span class="lineno"></span><span class="op" id="8106714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8106717">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="8106794">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8106843">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="8106919">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="8106996">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="8107069">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8107146">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8107215">type</span>&nbsp;<span class="ident" id="8107220">Struct0</span>&nbsp;<span class="keyword" id="8107228">struct</span>&nbsp;<span class="op" id="8107235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107238">I</span>&nbsp;<span class="keyword" id="8107240">interface</span><span class="op" id="8107249">{</span><span class="op" id="8107250">}</span><br>
<span class="lineno">490</span><span class="op" id="8107252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8107255">type</span>&nbsp;<span class="ident" id="8107260">NewType0</span>&nbsp;<span class="keyword" id="8107269">struct</span>&nbsp;<span class="op" id="8107276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107279">S</span>&nbsp;<span class="builtintype" id="8107281">string</span><br>
<span class="lineno"></span><span class="op" id="8107288">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="8107291">type</span>&nbsp;<span class="ident" id="8107296">ignoreTest</span>&nbsp;<span class="keyword" id="8107307">struct</span>&nbsp;<span class="op" id="8107314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107317">in</span><span class="op" id="8107319">,</span>&nbsp;<span class="ident" id="8107321">out</span>&nbsp;<span class="keyword" id="8107325">interface</span><span class="op" id="8107334">{</span><span class="op" id="8107335">}</span><br>
<span class="lineno"></span><span class="op" id="8107337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="8107340">var</span>&nbsp;<span class="ident" id="8107344">ignoreTests</span>&nbsp;<span class="op" id="8107356">=</span>&nbsp;<span class="op" id="8107358">[</span><span class="op" id="8107359">]</span><span class="ident" id="8107360">ignoreTest</span><span class="op" id="8107370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8107373">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107419">{</span><span class="op" id="8107420">&amp;</span><span class="keyword" id="8107421">struct</span><span class="op" id="8107427">{</span>&nbsp;<span class="ident" id="8107429">A</span>&nbsp;<span class="builtintype" id="8107431">int</span>&nbsp;<span class="op" id="8107435">}</span><span class="op" id="8107436">{</span><span class="num" id="8107437">23</span><span class="op" id="8107439">}</span><span class="op" id="8107440">,</span>&nbsp;<span class="op" id="8107442">&amp;</span><span class="keyword" id="8107443">struct</span><span class="op" id="8107449">{</span><span class="op" id="8107450">}</span><span class="op" id="8107451">{</span><span class="op" id="8107452">}</span><span class="op" id="8107453">}</span><span class="op" id="8107454">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8107457">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107494">{</span><span class="op" id="8107495">&amp;</span><span class="keyword" id="8107496">struct</span><span class="op" id="8107502">{</span>&nbsp;<span class="ident" id="8107504">A</span>&nbsp;<span class="builtintype" id="8107506">int</span>&nbsp;<span class="op" id="8107510">}</span><span class="op" id="8107511">{</span><span class="num" id="8107512">23</span><span class="op" id="8107514">}</span><span class="op" id="8107515">,</span>&nbsp;<span class="ident" id="8107517">nil</span><span class="op" id="8107520">}</span><span class="op" id="8107521">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8107524">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107564">{</span><span class="string" id="8107565">&#34;hello,&nbsp;world&#34;</span><span class="op" id="8107579">,</span>&nbsp;<span class="ident" id="8107581">nil</span><span class="op" id="8107584">}</span><span class="op" id="8107585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8107588">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107627">{</span><span class="op" id="8107628">[</span><span class="op" id="8107629">]</span><span class="builtintype" id="8107630">int</span><span class="op" id="8107633">{</span><span class="num" id="8107634">1</span><span class="op" id="8107635">,</span>&nbsp;<span class="num" id="8107637">2</span><span class="op" id="8107638">,</span>&nbsp;<span class="num" id="8107640">3</span><span class="op" id="8107641">,</span>&nbsp;<span class="num" id="8107643">4</span><span class="op" id="8107644">}</span><span class="op" id="8107645">,</span>&nbsp;<span class="ident" id="8107647">nil</span><span class="op" id="8107650">}</span><span class="op" id="8107651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8107654">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107708">{</span><span class="op" id="8107709">&amp;</span><span class="ident" id="8107710">Struct0</span><span class="op" id="8107717">{</span><span class="op" id="8107718">&amp;</span><span class="ident" id="8107719">NewType0</span><span class="op" id="8107727">{</span><span class="string" id="8107728">&#34;value0&#34;</span><span class="op" id="8107736">}</span><span class="op" id="8107737">}</span><span class="op" id="8107738">,</span>&nbsp;<span class="ident" id="8107740">nil</span><span class="op" id="8107743">}</span><span class="op" id="8107744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8107747">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8107800">{</span><span class="op" id="8107801">[</span><span class="op" id="8107802">]</span><span class="keyword" id="8107803">interface</span><span class="op" id="8107812">{</span><span class="op" id="8107813">}</span><span class="op" id="8107814">{</span><span class="string" id="8107815">&#34;hi&#34;</span><span class="op" id="8107819">,</span>&nbsp;<span class="op" id="8107821">&amp;</span><span class="ident" id="8107822">NewType0</span><span class="op" id="8107830">{</span><span class="string" id="8107831">&#34;value1&#34;</span><span class="op" id="8107839">}</span><span class="op" id="8107840">,</span>&nbsp;<span class="num" id="8107842">23</span><span class="op" id="8107844">}</span><span class="op" id="8107845">,</span>&nbsp;<span class="ident" id="8107847">nil</span><span class="op" id="8107850">}</span><span class="op" id="8107851">,</span><br>
<span class="lineno"></span><span class="op" id="8107853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="8107856">func</span>&nbsp;<span class="ident" id="8107861">TestDecodeIntoNothing</span><span class="op" id="8107882">(</span><span class="ident" id="8107883">t</span>&nbsp;<span class="op" id="8107885">*</span><span class="ident" id="8107886">testing</span><span class="op" id="8107893">.</span><span class="ident" id="8107894">T</span><span class="op" id="8107895">)</span>&nbsp;<span class="op" id="8107897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107900">Register</span><span class="op" id="8107908">(</span><span class="builtinfunc" id="8107909">new</span><span class="op" id="8107912">(</span><span class="ident" id="8107913">NewType0</span><span class="op" id="8107921">)</span><span class="op" id="8107922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8107925">for</span>&nbsp;<span class="ident" id="8107929">i</span><span class="op" id="8107930">,</span>&nbsp;<span class="ident" id="8107932">test</span>&nbsp;<span class="op" id="8107937">:=</span>&nbsp;<span class="keyword" id="8107940">range</span>&nbsp;<span class="ident" id="8107946">ignoreTests</span>&nbsp;<span class="op" id="8107958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107962">b</span>&nbsp;<span class="op" id="8107964">:=</span>&nbsp;<span class="builtinfunc" id="8107967">new</span><span class="op" id="8107970">(</span><span class="ident" id="8107971">bytes</span><span class="op" id="8107976">.</span><span class="ident" id="8107977">Buffer</span><span class="op" id="8107983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8107987">enc</span>&nbsp;<span class="op" id="8107991">:=</span>&nbsp;<span class="ident" id="8107994">NewEncoder</span><span class="op" id="8108004">(</span><span class="ident" id="8108005">b</span><span class="op" id="8108006">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108010">err</span>&nbsp;<span class="op" id="8108014">:=</span>&nbsp;<span class="ident" id="8108017">enc</span><span class="op" id="8108020">.</span><span class="ident" id="8108021">Encode</span><span class="op" id="8108027">(</span><span class="ident" id="8108028">test</span><span class="op" id="8108032">.</span><span class="ident" id="8108033">in</span><span class="op" id="8108035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108039">if</span>&nbsp;<span class="ident" id="8108042">err</span>&nbsp;<span class="op" id="8108046">!=</span>&nbsp;<span class="ident" id="8108049">nil</span>&nbsp;<span class="op" id="8108053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108058">t</span><span class="op" id="8108059">.</span><span class="ident" id="8108060">Errorf</span><span class="op" id="8108066">(</span><span class="string" id="8108067">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="8108089">,</span>&nbsp;<span class="ident" id="8108091">i</span><span class="op" id="8108092">,</span>&nbsp;<span class="ident" id="8108094">err</span><span class="op" id="8108097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108102">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108113">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108117">dec</span>&nbsp;<span class="op" id="8108121">:=</span>&nbsp;<span class="ident" id="8108124">NewDecoder</span><span class="op" id="8108134">(</span><span class="ident" id="8108135">b</span><span class="op" id="8108136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108140">err</span>&nbsp;<span class="op" id="8108144">=</span>&nbsp;<span class="ident" id="8108146">dec</span><span class="op" id="8108149">.</span><span class="ident" id="8108150">Decode</span><span class="op" id="8108156">(</span><span class="ident" id="8108157">test</span><span class="op" id="8108161">.</span><span class="ident" id="8108162">out</span><span class="op" id="8108165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108169">if</span>&nbsp;<span class="ident" id="8108172">err</span>&nbsp;<span class="op" id="8108176">!=</span>&nbsp;<span class="ident" id="8108179">nil</span>&nbsp;<span class="op" id="8108183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108188">t</span><span class="op" id="8108189">.</span><span class="ident" id="8108190">Errorf</span><span class="op" id="8108196">(</span><span class="string" id="8108197">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8108219">,</span>&nbsp;<span class="ident" id="8108221">i</span><span class="op" id="8108222">,</span>&nbsp;<span class="ident" id="8108224">err</span><span class="op" id="8108227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108232">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8108247">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108314">str</span>&nbsp;<span class="op" id="8108318">:=</span>&nbsp;<span class="ident" id="8108321">fmt</span><span class="op" id="8108324">.</span><span class="ident" id="8108325">Sprintf</span><span class="op" id="8108332">(</span><span class="string" id="8108333">&#34;Value&nbsp;%d&#34;</span><span class="op" id="8108343">,</span>&nbsp;<span class="ident" id="8108345">i</span><span class="op" id="8108346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108350">err</span>&nbsp;<span class="op" id="8108354">=</span>&nbsp;<span class="ident" id="8108356">enc</span><span class="op" id="8108359">.</span><span class="ident" id="8108360">Encode</span><span class="op" id="8108366">(</span><span class="op" id="8108367">&amp;</span><span class="ident" id="8108368">NewType0</span><span class="op" id="8108376">{</span><span class="ident" id="8108377">str</span><span class="op" id="8108380">}</span><span class="op" id="8108381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108385">if</span>&nbsp;<span class="ident" id="8108388">err</span>&nbsp;<span class="op" id="8108392">!=</span>&nbsp;<span class="ident" id="8108395">nil</span>&nbsp;<span class="op" id="8108399">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108404">t</span><span class="op" id="8108405">.</span><span class="ident" id="8108406">Fatalf</span><span class="op" id="8108412">(</span><span class="string" id="8108413">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8108444">,</span>&nbsp;<span class="ident" id="8108446">i</span><span class="op" id="8108447">,</span>&nbsp;<span class="ident" id="8108449">err</span><span class="op" id="8108452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108460">ns</span>&nbsp;<span class="op" id="8108463">:=</span>&nbsp;<span class="builtinfunc" id="8108466">new</span><span class="op" id="8108469">(</span><span class="ident" id="8108470">NewType0</span><span class="op" id="8108478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108482">err</span>&nbsp;<span class="op" id="8108486">=</span>&nbsp;<span class="ident" id="8108488">dec</span><span class="op" id="8108491">.</span><span class="ident" id="8108492">Decode</span><span class="op" id="8108498">(</span><span class="ident" id="8108499">ns</span><span class="op" id="8108501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108505">if</span>&nbsp;<span class="ident" id="8108508">err</span>&nbsp;<span class="op" id="8108512">!=</span>&nbsp;<span class="ident" id="8108515">nil</span>&nbsp;<span class="op" id="8108519">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108524">t</span><span class="op" id="8108525">.</span><span class="ident" id="8108526">Fatalf</span><span class="op" id="8108532">(</span><span class="string" id="8108533">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8108564">,</span>&nbsp;<span class="ident" id="8108566">i</span><span class="op" id="8108567">,</span>&nbsp;<span class="ident" id="8108569">err</span><span class="op" id="8108572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108580">if</span>&nbsp;<span class="ident" id="8108583">ns</span><span class="op" id="8108585">.</span><span class="ident" id="8108586">S</span>&nbsp;<span class="op" id="8108588">!=</span>&nbsp;<span class="ident" id="8108591">str</span>&nbsp;<span class="op" id="8108595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108600">t</span><span class="op" id="8108601">.</span><span class="ident" id="8108602">Fatalf</span><span class="op" id="8108608">(</span><span class="string" id="8108609">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8108633">,</span>&nbsp;<span class="ident" id="8108635">i</span><span class="op" id="8108636">,</span>&nbsp;<span class="ident" id="8108638">str</span><span class="op" id="8108641">,</span>&nbsp;<span class="ident" id="8108643">ns</span><span class="op" id="8108645">.</span><span class="ident" id="8108646">S</span><span class="op" id="8108647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108651">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8108654">}</span><br>
<span class="lineno"></span><span class="op" id="8108656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8108659">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="8108721">type</span>&nbsp;<span class="ident" id="8108726">Bug0Outer</span>&nbsp;<span class="keyword" id="8108736">struct</span>&nbsp;<span class="op" id="8108743">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108746">Bug0Field</span>&nbsp;<span class="keyword" id="8108756">interface</span><span class="op" id="8108765">{</span><span class="op" id="8108766">}</span><br>
<span class="lineno"></span><span class="op" id="8108768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8108771">type</span>&nbsp;<span class="ident" id="8108776">Bug0Inner</span>&nbsp;<span class="keyword" id="8108786">struct</span>&nbsp;<span class="op" id="8108793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108796">A</span>&nbsp;<span class="builtintype" id="8108798">int</span><br>
<span class="lineno">555</span><span class="op" id="8108802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8108805">func</span>&nbsp;<span class="ident" id="8108810">TestNestedInterfaces</span><span class="op" id="8108830">(</span><span class="ident" id="8108831">t</span>&nbsp;<span class="op" id="8108833">*</span><span class="ident" id="8108834">testing</span><span class="op" id="8108841">.</span><span class="ident" id="8108842">T</span><span class="op" id="8108843">)</span>&nbsp;<span class="op" id="8108845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8108848">var</span>&nbsp;<span class="ident" id="8108852">buf</span>&nbsp;<span class="ident" id="8108856">bytes</span><span class="op" id="8108861">.</span><span class="ident" id="8108862">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108870">e</span>&nbsp;<span class="op" id="8108872">:=</span>&nbsp;<span class="ident" id="8108875">NewEncoder</span><span class="op" id="8108885">(</span><span class="op" id="8108886">&amp;</span><span class="ident" id="8108887">buf</span><span class="op" id="8108890">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108893">d</span>&nbsp;<span class="op" id="8108895">:=</span>&nbsp;<span class="ident" id="8108898">NewDecoder</span><span class="op" id="8108908">(</span><span class="op" id="8108909">&amp;</span><span class="ident" id="8108910">buf</span><span class="op" id="8108913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108916">Register</span><span class="op" id="8108924">(</span><span class="builtinfunc" id="8108925">new</span><span class="op" id="8108928">(</span><span class="ident" id="8108929">Bug0Outer</span><span class="op" id="8108938">)</span><span class="op" id="8108939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108942">Register</span><span class="op" id="8108950">(</span><span class="builtinfunc" id="8108951">new</span><span class="op" id="8108954">(</span><span class="ident" id="8108955">Bug0Inner</span><span class="op" id="8108964">)</span><span class="op" id="8108965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8108968">f</span>&nbsp;<span class="op" id="8108970">:=</span>&nbsp;<span class="op" id="8108973">&amp;</span><span class="ident" id="8108974">Bug0Outer</span><span class="op" id="8108983">{</span><span class="op" id="8108984">&amp;</span><span class="ident" id="8108985">Bug0Outer</span><span class="op" id="8108994">{</span><span class="op" id="8108995">&amp;</span><span class="ident" id="8108996">Bug0Inner</span><span class="op" id="8109005">{</span><span class="num" id="8109006">7</span><span class="op" id="8109007">}</span><span class="op" id="8109008">}</span><span class="op" id="8109009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109012">var</span>&nbsp;<span class="ident" id="8109016">v</span>&nbsp;<span class="keyword" id="8109018">interface</span><span class="op" id="8109027">{</span><span class="op" id="8109028">}</span>&nbsp;<span class="op" id="8109030">=</span>&nbsp;<span class="ident" id="8109032">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109035">err</span>&nbsp;<span class="op" id="8109039">:=</span>&nbsp;<span class="ident" id="8109042">e</span><span class="op" id="8109043">.</span><span class="ident" id="8109044">Encode</span><span class="op" id="8109050">(</span><span class="op" id="8109051">&amp;</span><span class="ident" id="8109052">v</span><span class="op" id="8109053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109056">if</span>&nbsp;<span class="ident" id="8109059">err</span>&nbsp;<span class="op" id="8109063">!=</span>&nbsp;<span class="ident" id="8109066">nil</span>&nbsp;<span class="op" id="8109070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109074">t</span><span class="op" id="8109075">.</span><span class="ident" id="8109076">Fatal</span><span class="op" id="8109081">(</span><span class="string" id="8109082">&#34;Encode:&#34;</span><span class="op" id="8109091">,</span>&nbsp;<span class="ident" id="8109093">err</span><span class="op" id="8109096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109102">err</span>&nbsp;<span class="op" id="8109106">=</span>&nbsp;<span class="ident" id="8109108">d</span><span class="op" id="8109109">.</span><span class="ident" id="8109110">Decode</span><span class="op" id="8109116">(</span><span class="op" id="8109117">&amp;</span><span class="ident" id="8109118">v</span><span class="op" id="8109119">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109122">if</span>&nbsp;<span class="ident" id="8109125">err</span>&nbsp;<span class="op" id="8109129">!=</span>&nbsp;<span class="ident" id="8109132">nil</span>&nbsp;<span class="op" id="8109136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109140">t</span><span class="op" id="8109141">.</span><span class="ident" id="8109142">Fatal</span><span class="op" id="8109147">(</span><span class="string" id="8109148">&#34;Decode:&#34;</span><span class="op" id="8109157">,</span>&nbsp;<span class="ident" id="8109159">err</span><span class="op" id="8109162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8109168">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109204">outer1</span><span class="op" id="8109210">,</span>&nbsp;<span class="ident" id="8109212">ok</span>&nbsp;<span class="op" id="8109215">:=</span>&nbsp;<span class="ident" id="8109218">v</span><span class="op" id="8109219">.</span><span class="op" id="8109220">(</span><span class="op" id="8109221">*</span><span class="ident" id="8109222">Bug0Outer</span><span class="op" id="8109231">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109234">if</span>&nbsp;<span class="op" id="8109237">!</span><span class="ident" id="8109238">ok</span>&nbsp;<span class="op" id="8109241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109245">t</span><span class="op" id="8109246">.</span><span class="ident" id="8109247">Fatalf</span><span class="op" id="8109253">(</span><span class="string" id="8109254">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8109275">,</span>&nbsp;<span class="ident" id="8109277">v</span><span class="op" id="8109278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109284">outer2</span><span class="op" id="8109290">,</span>&nbsp;<span class="ident" id="8109292">ok</span>&nbsp;<span class="op" id="8109295">:=</span>&nbsp;<span class="ident" id="8109298">outer1</span><span class="op" id="8109304">.</span><span class="ident" id="8109305">Bug0Field</span><span class="op" id="8109314">.</span><span class="op" id="8109315">(</span><span class="op" id="8109316">*</span><span class="ident" id="8109317">Bug0Outer</span><span class="op" id="8109326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109329">if</span>&nbsp;<span class="op" id="8109332">!</span><span class="ident" id="8109333">ok</span>&nbsp;<span class="op" id="8109336">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109340">t</span><span class="op" id="8109341">.</span><span class="ident" id="8109342">Fatalf</span><span class="op" id="8109348">(</span><span class="string" id="8109349">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="8109380">,</span>&nbsp;<span class="ident" id="8109382">outer1</span><span class="op" id="8109388">.</span><span class="ident" id="8109389">Bug0Field</span><span class="op" id="8109398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109404">inner</span><span class="op" id="8109409">,</span>&nbsp;<span class="ident" id="8109411">ok</span>&nbsp;<span class="op" id="8109414">:=</span>&nbsp;<span class="ident" id="8109417">outer2</span><span class="op" id="8109423">.</span><span class="ident" id="8109424">Bug0Field</span><span class="op" id="8109433">.</span><span class="op" id="8109434">(</span><span class="op" id="8109435">*</span><span class="ident" id="8109436">Bug0Inner</span><span class="op" id="8109445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109448">if</span>&nbsp;<span class="op" id="8109451">!</span><span class="ident" id="8109452">ok</span>&nbsp;<span class="op" id="8109455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109459">t</span><span class="op" id="8109460">.</span><span class="ident" id="8109461">Fatalf</span><span class="op" id="8109467">(</span><span class="string" id="8109468">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="8109509">,</span>&nbsp;<span class="ident" id="8109511">outer2</span><span class="op" id="8109517">.</span><span class="ident" id="8109518">Bug0Field</span><span class="op" id="8109527">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109533">if</span>&nbsp;<span class="ident" id="8109536">inner</span><span class="op" id="8109541">.</span><span class="ident" id="8109542">A</span>&nbsp;<span class="op" id="8109544">!=</span>&nbsp;<span class="num" id="8109547">7</span>&nbsp;<span class="op" id="8109549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109553">t</span><span class="op" id="8109554">.</span><span class="ident" id="8109555">Fatalf</span><span class="op" id="8109561">(</span><span class="string" id="8109562">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8109591">,</span>&nbsp;<span class="ident" id="8109593">inner</span><span class="op" id="8109598">.</span><span class="ident" id="8109599">A</span><span class="op" id="8109600">,</span>&nbsp;<span class="num" id="8109602">7</span><span class="op" id="8109603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8109606">}</span><br>
<span class="lineno"></span><span class="op" id="8109608">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="8109611">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8109684">type</span>&nbsp;<span class="ident" id="8109689">Bug1Elem</span>&nbsp;<span class="keyword" id="8109698">struct</span>&nbsp;<span class="op" id="8109705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109708">Name</span>&nbsp;<span class="builtintype" id="8109713">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109721">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8109726">int</span><br>
<span class="lineno"></span><span class="op" id="8109730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8109733">type</span>&nbsp;<span class="ident" id="8109738">Bug1StructMap</span>&nbsp;<span class="keyword" id="8109752">map</span><span class="op" id="8109755">[</span><span class="builtintype" id="8109756">string</span><span class="op" id="8109762">]</span><span class="ident" id="8109763">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="8109773">func</span>&nbsp;<span class="ident" id="8109778">bug1EncDec</span><span class="op" id="8109788">(</span><span class="ident" id="8109789">in</span>&nbsp;<span class="ident" id="8109792">Bug1StructMap</span><span class="op" id="8109805">,</span>&nbsp;<span class="ident" id="8109807">out</span>&nbsp;<span class="op" id="8109811">*</span><span class="ident" id="8109812">Bug1StructMap</span><span class="op" id="8109825">)</span>&nbsp;<span class="builtintype" id="8109827">error</span>&nbsp;<span class="op" id="8109833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8109836">return</span>&nbsp;<span class="ident" id="8109843">nil</span><br>
<span class="lineno"></span><span class="op" id="8109847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8109850">func</span>&nbsp;<span class="ident" id="8109855">TestMapBug1</span><span class="op" id="8109866">(</span><span class="ident" id="8109867">t</span>&nbsp;<span class="op" id="8109869">*</span><span class="ident" id="8109870">testing</span><span class="op" id="8109877">.</span><span class="ident" id="8109878">T</span><span class="op" id="8109879">)</span>&nbsp;<span class="op" id="8109881">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109884">in</span>&nbsp;<span class="op" id="8109887">:=</span>&nbsp;<span class="builtinfunc" id="8109890">make</span><span class="op" id="8109894">(</span><span class="ident" id="8109895">Bug1StructMap</span><span class="op" id="8109908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109911">in</span><span class="op" id="8109913">[</span><span class="string" id="8109914">&#34;val1&#34;</span><span class="op" id="8109920">]</span>&nbsp;<span class="op" id="8109922">=</span>&nbsp;<span class="ident" id="8109924">Bug1Elem</span><span class="op" id="8109932">{</span><span class="string" id="8109933">&#34;elem1&#34;</span><span class="op" id="8109940">,</span>&nbsp;<span class="num" id="8109942">1</span><span class="op" id="8109943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109946">in</span><span class="op" id="8109948">[</span><span class="string" id="8109949">&#34;val2&#34;</span><span class="op" id="8109955">]</span>&nbsp;<span class="op" id="8109957">=</span>&nbsp;<span class="ident" id="8109959">Bug1Elem</span><span class="op" id="8109967">{</span><span class="string" id="8109968">&#34;elem2&#34;</span><span class="op" id="8109975">,</span>&nbsp;<span class="num" id="8109977">2</span><span class="op" id="8109978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8109982">b</span>&nbsp;<span class="op" id="8109984">:=</span>&nbsp;<span class="builtinfunc" id="8109987">new</span><span class="op" id="8109990">(</span><span class="ident" id="8109991">bytes</span><span class="op" id="8109996">.</span><span class="ident" id="8109997">Buffer</span><span class="op" id="8110003">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110006">enc</span>&nbsp;<span class="op" id="8110010">:=</span>&nbsp;<span class="ident" id="8110013">NewEncoder</span><span class="op" id="8110023">(</span><span class="ident" id="8110024">b</span><span class="op" id="8110025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110028">err</span>&nbsp;<span class="op" id="8110032">:=</span>&nbsp;<span class="ident" id="8110035">enc</span><span class="op" id="8110038">.</span><span class="ident" id="8110039">Encode</span><span class="op" id="8110045">(</span><span class="ident" id="8110046">in</span><span class="op" id="8110048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110051">if</span>&nbsp;<span class="ident" id="8110054">err</span>&nbsp;<span class="op" id="8110058">!=</span>&nbsp;<span class="ident" id="8110061">nil</span>&nbsp;<span class="op" id="8110065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110069">t</span><span class="op" id="8110070">.</span><span class="ident" id="8110071">Fatal</span><span class="op" id="8110076">(</span><span class="string" id="8110077">&#34;encode:&#34;</span><span class="op" id="8110086">,</span>&nbsp;<span class="ident" id="8110088">err</span><span class="op" id="8110091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110094">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110097">dec</span>&nbsp;<span class="op" id="8110101">:=</span>&nbsp;<span class="ident" id="8110104">NewDecoder</span><span class="op" id="8110114">(</span><span class="ident" id="8110115">b</span><span class="op" id="8110116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110119">out</span>&nbsp;<span class="op" id="8110123">:=</span>&nbsp;<span class="builtinfunc" id="8110126">make</span><span class="op" id="8110130">(</span><span class="ident" id="8110131">Bug1StructMap</span><span class="op" id="8110144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110147">err</span>&nbsp;<span class="op" id="8110151">=</span>&nbsp;<span class="ident" id="8110153">dec</span><span class="op" id="8110156">.</span><span class="ident" id="8110157">Decode</span><span class="op" id="8110163">(</span><span class="op" id="8110164">&amp;</span><span class="ident" id="8110165">out</span><span class="op" id="8110168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110171">if</span>&nbsp;<span class="ident" id="8110174">err</span>&nbsp;<span class="op" id="8110178">!=</span>&nbsp;<span class="ident" id="8110181">nil</span>&nbsp;<span class="op" id="8110185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110189">t</span><span class="op" id="8110190">.</span><span class="ident" id="8110191">Fatal</span><span class="op" id="8110196">(</span><span class="string" id="8110197">&#34;decode:&#34;</span><span class="op" id="8110206">,</span>&nbsp;<span class="ident" id="8110208">err</span><span class="op" id="8110211">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110217">if</span>&nbsp;<span class="op" id="8110220">!</span><span class="ident" id="8110221">reflect</span><span class="op" id="8110228">.</span><span class="ident" id="8110229">DeepEqual</span><span class="op" id="8110238">(</span><span class="ident" id="8110239">in</span><span class="op" id="8110241">,</span>&nbsp;<span class="ident" id="8110243">out</span><span class="op" id="8110246">)</span>&nbsp;<span class="op" id="8110248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110252">t</span><span class="op" id="8110253">.</span><span class="ident" id="8110254">Errorf</span><span class="op" id="8110260">(</span><span class="string" id="8110261">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="8110278">,</span>&nbsp;<span class="ident" id="8110280">in</span><span class="op" id="8110282">,</span>&nbsp;<span class="ident" id="8110284">out</span><span class="op" id="8110287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110290">}</span><br>
<span class="lineno"></span><span class="op" id="8110292">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="8110295">func</span>&nbsp;<span class="ident" id="8110300">TestGobMapInterfaceEncode</span><span class="op" id="8110325">(</span><span class="ident" id="8110326">t</span>&nbsp;<span class="op" id="8110328">*</span><span class="ident" id="8110329">testing</span><span class="op" id="8110336">.</span><span class="ident" id="8110337">T</span><span class="op" id="8110338">)</span>&nbsp;<span class="op" id="8110340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110343">m</span>&nbsp;<span class="op" id="8110345">:=</span>&nbsp;<span class="keyword" id="8110348">map</span><span class="op" id="8110351">[</span><span class="builtintype" id="8110352">string</span><span class="op" id="8110358">]</span><span class="keyword" id="8110359">interface</span><span class="op" id="8110368">{</span><span class="op" id="8110369">}</span><span class="op" id="8110370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110374">&#34;up&#34;</span><span class="op" id="8110378">:</span>&nbsp;<span class="builtintype" id="8110380">uintptr</span><span class="op" id="8110387">(</span><span class="num" id="8110388">0</span><span class="op" id="8110389">)</span><span class="op" id="8110390">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110394">&#34;i0&#34;</span><span class="op" id="8110398">:</span>&nbsp;<span class="op" id="8110400">[</span><span class="op" id="8110401">]</span><span class="builtintype" id="8110402">int</span><span class="op" id="8110405">{</span><span class="op" id="8110406">-</span><span class="num" id="8110407">1</span><span class="op" id="8110408">}</span><span class="op" id="8110409">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110413">&#34;i1&#34;</span><span class="op" id="8110417">:</span>&nbsp;<span class="op" id="8110419">[</span><span class="op" id="8110420">]</span><span class="builtintype" id="8110421">int8</span><span class="op" id="8110425">{</span><span class="op" id="8110426">-</span><span class="num" id="8110427">1</span><span class="op" id="8110428">}</span><span class="op" id="8110429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110433">&#34;i2&#34;</span><span class="op" id="8110437">:</span>&nbsp;<span class="op" id="8110439">[</span><span class="op" id="8110440">]</span><span class="builtintype" id="8110441">int16</span><span class="op" id="8110446">{</span><span class="op" id="8110447">-</span><span class="num" id="8110448">1</span><span class="op" id="8110449">}</span><span class="op" id="8110450">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110454">&#34;i3&#34;</span><span class="op" id="8110458">:</span>&nbsp;<span class="op" id="8110460">[</span><span class="op" id="8110461">]</span><span class="builtintype" id="8110462">int32</span><span class="op" id="8110467">{</span><span class="op" id="8110468">-</span><span class="num" id="8110469">1</span><span class="op" id="8110470">}</span><span class="op" id="8110471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110475">&#34;i4&#34;</span><span class="op" id="8110479">:</span>&nbsp;<span class="op" id="8110481">[</span><span class="op" id="8110482">]</span><span class="ident" id="8110483">int64</span><span class="op" id="8110488">{</span><span class="op" id="8110489">-</span><span class="num" id="8110490">1</span><span class="op" id="8110491">}</span><span class="op" id="8110492">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110496">&#34;u0&#34;</span><span class="op" id="8110500">:</span>&nbsp;<span class="op" id="8110502">[</span><span class="op" id="8110503">]</span><span class="builtintype" id="8110504">uint</span><span class="op" id="8110508">{</span><span class="num" id="8110509">1</span><span class="op" id="8110510">}</span><span class="op" id="8110511">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110515">&#34;u1&#34;</span><span class="op" id="8110519">:</span>&nbsp;<span class="op" id="8110521">[</span><span class="op" id="8110522">]</span><span class="builtintype" id="8110523">uint8</span><span class="op" id="8110528">{</span><span class="num" id="8110529">1</span><span class="op" id="8110530">}</span><span class="op" id="8110531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110535">&#34;u2&#34;</span><span class="op" id="8110539">:</span>&nbsp;<span class="op" id="8110541">[</span><span class="op" id="8110542">]</span><span class="builtintype" id="8110543">uint16</span><span class="op" id="8110549">{</span><span class="num" id="8110550">1</span><span class="op" id="8110551">}</span><span class="op" id="8110552">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110556">&#34;u3&#34;</span><span class="op" id="8110560">:</span>&nbsp;<span class="op" id="8110562">[</span><span class="op" id="8110563">]</span><span class="builtintype" id="8110564">uint32</span><span class="op" id="8110570">{</span><span class="num" id="8110571">1</span><span class="op" id="8110572">}</span><span class="op" id="8110573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110577">&#34;u4&#34;</span><span class="op" id="8110581">:</span>&nbsp;<span class="op" id="8110583">[</span><span class="op" id="8110584">]</span><span class="ident" id="8110585">uint64</span><span class="op" id="8110591">{</span><span class="num" id="8110592">1</span><span class="op" id="8110593">}</span><span class="op" id="8110594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110598">&#34;f0&#34;</span><span class="op" id="8110602">:</span>&nbsp;<span class="op" id="8110604">[</span><span class="op" id="8110605">]</span><span class="builtintype" id="8110606">float32</span><span class="op" id="8110613">{</span><span class="num" id="8110614">1</span><span class="op" id="8110615">}</span><span class="op" id="8110616">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110620">&#34;f1&#34;</span><span class="op" id="8110624">:</span>&nbsp;<span class="op" id="8110626">[</span><span class="op" id="8110627">]</span><span class="builtintype" id="8110628">float64</span><span class="op" id="8110635">{</span><span class="num" id="8110636">1</span><span class="op" id="8110637">}</span><span class="op" id="8110638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110642">&#34;c0&#34;</span><span class="op" id="8110646">:</span>&nbsp;<span class="op" id="8110648">[</span><span class="op" id="8110649">]</span><span class="builtintype" id="8110650">complex64</span><span class="op" id="8110659">{</span><span class="builtinfunc" id="8110660">complex</span><span class="op" id="8110667">(</span><span class="num" id="8110668">2</span><span class="op" id="8110669">,</span>&nbsp;<span class="op" id="8110671">-</span><span class="num" id="8110672">2</span><span class="op" id="8110673">)</span><span class="op" id="8110674">}</span><span class="op" id="8110675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110679">&#34;c1&#34;</span><span class="op" id="8110683">:</span>&nbsp;<span class="op" id="8110685">[</span><span class="op" id="8110686">]</span><span class="builtintype" id="8110687">complex128</span><span class="op" id="8110697">{</span><span class="builtinfunc" id="8110698">complex</span><span class="op" id="8110705">(</span><span class="num" id="8110706">2</span><span class="op" id="8110707">,</span>&nbsp;<span class="builtintype" id="8110709">float64</span><span class="op" id="8110716">(</span><span class="op" id="8110717">-</span><span class="num" id="8110718">2</span><span class="op" id="8110719">)</span><span class="op" id="8110720">)</span><span class="op" id="8110721">}</span><span class="op" id="8110722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110726">&#34;us&#34;</span><span class="op" id="8110730">:</span>&nbsp;<span class="op" id="8110732">[</span><span class="op" id="8110733">]</span><span class="builtintype" id="8110734">uintptr</span><span class="op" id="8110741">{</span><span class="num" id="8110742">0</span><span class="op" id="8110743">}</span><span class="op" id="8110744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110748">&#34;bo&#34;</span><span class="op" id="8110752">:</span>&nbsp;<span class="op" id="8110754">[</span><span class="op" id="8110755">]</span><span class="builtintype" id="8110756">bool</span><span class="op" id="8110760">{</span><span class="builtintype" id="8110761">false</span><span class="op" id="8110766">}</span><span class="op" id="8110767">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8110771">&#34;st&#34;</span><span class="op" id="8110775">:</span>&nbsp;<span class="op" id="8110777">[</span><span class="op" id="8110778">]</span><span class="builtintype" id="8110779">string</span><span class="op" id="8110785">{</span><span class="string" id="8110786">&#34;s&#34;</span><span class="op" id="8110789">}</span><span class="op" id="8110790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110796">enc</span>&nbsp;<span class="op" id="8110800">:=</span>&nbsp;<span class="ident" id="8110803">NewEncoder</span><span class="op" id="8110813">(</span><span class="builtinfunc" id="8110814">new</span><span class="op" id="8110817">(</span><span class="ident" id="8110818">bytes</span><span class="op" id="8110823">.</span><span class="ident" id="8110824">Buffer</span><span class="op" id="8110830">)</span><span class="op" id="8110831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110834">err</span>&nbsp;<span class="op" id="8110838">:=</span>&nbsp;<span class="ident" id="8110841">enc</span><span class="op" id="8110844">.</span><span class="ident" id="8110845">Encode</span><span class="op" id="8110851">(</span><span class="ident" id="8110852">m</span><span class="op" id="8110853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8110856">if</span>&nbsp;<span class="ident" id="8110859">err</span>&nbsp;<span class="op" id="8110863">!=</span>&nbsp;<span class="ident" id="8110866">nil</span>&nbsp;<span class="op" id="8110870">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110874">t</span><span class="op" id="8110875">.</span><span class="ident" id="8110876">Errorf</span><span class="op" id="8110882">(</span><span class="string" id="8110883">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="8110899">,</span>&nbsp;<span class="ident" id="8110901">err</span><span class="op" id="8110904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110907">}</span><br>
<span class="lineno"></span><span class="op" id="8110909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8110912">func</span>&nbsp;<span class="ident" id="8110917">TestSliceReusesMemory</span><span class="op" id="8110938">(</span><span class="ident" id="8110939">t</span>&nbsp;<span class="op" id="8110941">*</span><span class="ident" id="8110942">testing</span><span class="op" id="8110949">.</span><span class="ident" id="8110950">T</span><span class="op" id="8110951">)</span>&nbsp;<span class="op" id="8110953">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110956">buf</span>&nbsp;<span class="op" id="8110960">:=</span>&nbsp;<span class="builtinfunc" id="8110963">new</span><span class="op" id="8110966">(</span><span class="ident" id="8110967">bytes</span><span class="op" id="8110972">.</span><span class="ident" id="8110973">Buffer</span><span class="op" id="8110979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8110982">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8110992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8110996">x</span>&nbsp;<span class="op" id="8110998">:=</span>&nbsp;<span class="op" id="8111001">[</span><span class="op" id="8111002">]</span><span class="builtintype" id="8111003">byte</span><span class="op" id="8111007">(</span><span class="string" id="8111008">&#34;abcd&#34;</span><span class="op" id="8111014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111018">enc</span>&nbsp;<span class="op" id="8111022">:=</span>&nbsp;<span class="ident" id="8111025">NewEncoder</span><span class="op" id="8111035">(</span><span class="ident" id="8111036">buf</span><span class="op" id="8111039">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111043">err</span>&nbsp;<span class="op" id="8111047">:=</span>&nbsp;<span class="ident" id="8111050">enc</span><span class="op" id="8111053">.</span><span class="ident" id="8111054">Encode</span><span class="op" id="8111060">(</span><span class="ident" id="8111061">x</span><span class="op" id="8111062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111066">if</span>&nbsp;<span class="ident" id="8111069">err</span>&nbsp;<span class="op" id="8111073">!=</span>&nbsp;<span class="ident" id="8111076">nil</span>&nbsp;<span class="op" id="8111080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111085">t</span><span class="op" id="8111086">.</span><span class="ident" id="8111087">Errorf</span><span class="op" id="8111093">(</span><span class="string" id="8111094">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8111113">,</span>&nbsp;<span class="ident" id="8111115">err</span><span class="op" id="8111118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111126">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111167">y</span>&nbsp;<span class="op" id="8111169">:=</span>&nbsp;<span class="op" id="8111172">[</span><span class="op" id="8111173">]</span><span class="builtintype" id="8111174">byte</span><span class="op" id="8111178">(</span><span class="string" id="8111179">&#34;ABCDE&#34;</span><span class="op" id="8111186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111190">addr</span>&nbsp;<span class="op" id="8111195">:=</span>&nbsp;<span class="op" id="8111198">&amp;</span><span class="ident" id="8111199">y</span><span class="op" id="8111200">[</span><span class="num" id="8111201">0</span><span class="op" id="8111202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111206">dec</span>&nbsp;<span class="op" id="8111210">:=</span>&nbsp;<span class="ident" id="8111213">NewDecoder</span><span class="op" id="8111223">(</span><span class="ident" id="8111224">buf</span><span class="op" id="8111227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111231">err</span>&nbsp;<span class="op" id="8111235">=</span>&nbsp;<span class="ident" id="8111237">dec</span><span class="op" id="8111240">.</span><span class="ident" id="8111241">Decode</span><span class="op" id="8111247">(</span><span class="op" id="8111248">&amp;</span><span class="ident" id="8111249">y</span><span class="op" id="8111250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111254">if</span>&nbsp;<span class="ident" id="8111257">err</span>&nbsp;<span class="op" id="8111261">!=</span>&nbsp;<span class="ident" id="8111264">nil</span>&nbsp;<span class="op" id="8111268">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111273">t</span><span class="op" id="8111274">.</span><span class="ident" id="8111275">Fatal</span><span class="op" id="8111280">(</span><span class="string" id="8111281">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="8111297">,</span>&nbsp;<span class="ident" id="8111299">err</span><span class="op" id="8111302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111310">if</span>&nbsp;<span class="op" id="8111313">!</span><span class="ident" id="8111314">bytes</span><span class="op" id="8111319">.</span><span class="ident" id="8111320">Equal</span><span class="op" id="8111325">(</span><span class="ident" id="8111326">x</span><span class="op" id="8111327">,</span>&nbsp;<span class="ident" id="8111329">y</span><span class="op" id="8111330">)</span>&nbsp;<span class="op" id="8111332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111337">t</span><span class="op" id="8111338">.</span><span class="ident" id="8111339">Errorf</span><span class="op" id="8111345">(</span><span class="string" id="8111346">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8111375">,</span>&nbsp;<span class="ident" id="8111377">x</span><span class="op" id="8111378">,</span>&nbsp;<span class="ident" id="8111380">y</span><span class="op" id="8111381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111385">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111389">if</span>&nbsp;<span class="ident" id="8111392">addr</span>&nbsp;<span class="op" id="8111397">!=</span>&nbsp;<span class="op" id="8111400">&amp;</span><span class="ident" id="8111401">y</span><span class="op" id="8111402">[</span><span class="num" id="8111403">0</span><span class="op" id="8111404">]</span>&nbsp;<span class="op" id="8111406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111411">t</span><span class="op" id="8111412">.</span><span class="ident" id="8111413">Errorf</span><span class="op" id="8111419">(</span><span class="string" id="8111420">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8111453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111463">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111485">x</span>&nbsp;<span class="op" id="8111487">:=</span>&nbsp;<span class="op" id="8111490">[</span><span class="op" id="8111491">]</span><span class="builtintype" id="8111492">rune</span><span class="op" id="8111496">(</span><span class="string" id="8111497">&#34;abcd&#34;</span><span class="op" id="8111503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111507">enc</span>&nbsp;<span class="op" id="8111511">:=</span>&nbsp;<span class="ident" id="8111514">NewEncoder</span><span class="op" id="8111524">(</span><span class="ident" id="8111525">buf</span><span class="op" id="8111528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111532">err</span>&nbsp;<span class="op" id="8111536">:=</span>&nbsp;<span class="ident" id="8111539">enc</span><span class="op" id="8111542">.</span><span class="ident" id="8111543">Encode</span><span class="op" id="8111549">(</span><span class="ident" id="8111550">x</span><span class="op" id="8111551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111555">if</span>&nbsp;<span class="ident" id="8111558">err</span>&nbsp;<span class="op" id="8111562">!=</span>&nbsp;<span class="ident" id="8111565">nil</span>&nbsp;<span class="op" id="8111569">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111574">t</span><span class="op" id="8111575">.</span><span class="ident" id="8111576">Errorf</span><span class="op" id="8111582">(</span><span class="string" id="8111583">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="8111601">,</span>&nbsp;<span class="ident" id="8111603">err</span><span class="op" id="8111606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8111614">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111655">y</span>&nbsp;<span class="op" id="8111657">:=</span>&nbsp;<span class="op" id="8111660">[</span><span class="op" id="8111661">]</span><span class="builtintype" id="8111662">rune</span><span class="op" id="8111666">(</span><span class="string" id="8111667">&#34;ABCDE&#34;</span><span class="op" id="8111674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111678">addr</span>&nbsp;<span class="op" id="8111683">:=</span>&nbsp;<span class="op" id="8111686">&amp;</span><span class="ident" id="8111687">y</span><span class="op" id="8111688">[</span><span class="num" id="8111689">0</span><span class="op" id="8111690">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111694">dec</span>&nbsp;<span class="op" id="8111698">:=</span>&nbsp;<span class="ident" id="8111701">NewDecoder</span><span class="op" id="8111711">(</span><span class="ident" id="8111712">buf</span><span class="op" id="8111715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111719">err</span>&nbsp;<span class="op" id="8111723">=</span>&nbsp;<span class="ident" id="8111725">dec</span><span class="op" id="8111728">.</span><span class="ident" id="8111729">Decode</span><span class="op" id="8111735">(</span><span class="op" id="8111736">&amp;</span><span class="ident" id="8111737">y</span><span class="op" id="8111738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111742">if</span>&nbsp;<span class="ident" id="8111745">err</span>&nbsp;<span class="op" id="8111749">!=</span>&nbsp;<span class="ident" id="8111752">nil</span>&nbsp;<span class="op" id="8111756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111761">t</span><span class="op" id="8111762">.</span><span class="ident" id="8111763">Fatal</span><span class="op" id="8111768">(</span><span class="string" id="8111769">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="8111784">,</span>&nbsp;<span class="ident" id="8111786">err</span><span class="op" id="8111789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111793">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111797">if</span>&nbsp;<span class="op" id="8111800">!</span><span class="ident" id="8111801">reflect</span><span class="op" id="8111808">.</span><span class="ident" id="8111809">DeepEqual</span><span class="op" id="8111818">(</span><span class="ident" id="8111819">x</span><span class="op" id="8111820">,</span>&nbsp;<span class="ident" id="8111822">y</span><span class="op" id="8111823">)</span>&nbsp;<span class="op" id="8111825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111830">t</span><span class="op" id="8111831">.</span><span class="ident" id="8111832">Errorf</span><span class="op" id="8111838">(</span><span class="string" id="8111839">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="8111867">,</span>&nbsp;<span class="ident" id="8111869">x</span><span class="op" id="8111870">,</span>&nbsp;<span class="ident" id="8111872">y</span><span class="op" id="8111873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8111881">if</span>&nbsp;<span class="ident" id="8111884">addr</span>&nbsp;<span class="op" id="8111889">!=</span>&nbsp;<span class="op" id="8111892">&amp;</span><span class="ident" id="8111893">y</span><span class="op" id="8111894">[</span><span class="num" id="8111895">0</span><span class="op" id="8111896">]</span>&nbsp;<span class="op" id="8111898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8111903">t</span><span class="op" id="8111904">.</span><span class="ident" id="8111905">Errorf</span><span class="op" id="8111911">(</span><span class="string" id="8111912">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="8111944">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8111951">}</span><br>
<span class="lineno"></span><span class="op" id="8111953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8111956">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="8112005">func</span>&nbsp;<span class="ident" id="8112010">TestBadCount</span><span class="op" id="8112022">(</span><span class="ident" id="8112023">t</span>&nbsp;<span class="op" id="8112025">*</span><span class="ident" id="8112026">testing</span><span class="op" id="8112033">.</span><span class="ident" id="8112034">T</span><span class="op" id="8112035">)</span>&nbsp;<span class="op" id="8112037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112040">b</span>&nbsp;<span class="op" id="8112042">:=</span>&nbsp;<span class="op" id="8112045">[</span><span class="op" id="8112046">]</span><span class="builtintype" id="8112047">byte</span><span class="op" id="8112051">{</span><span class="num" id="8112052">0xfb</span><span class="op" id="8112056">,</span>&nbsp;<span class="num" id="8112058">0xa5</span><span class="op" id="8112062">,</span>&nbsp;<span class="num" id="8112064">0x82</span><span class="op" id="8112068">,</span>&nbsp;<span class="num" id="8112070">0x2f</span><span class="op" id="8112074">,</span>&nbsp;<span class="num" id="8112076">0xca</span><span class="op" id="8112080">,</span>&nbsp;<span class="num" id="8112082">0x1</span><span class="op" id="8112085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112088">if</span>&nbsp;<span class="ident" id="8112091">err</span>&nbsp;<span class="op" id="8112095">:=</span>&nbsp;<span class="ident" id="8112098">NewDecoder</span><span class="op" id="8112108">(</span><span class="ident" id="8112109">bytes</span><span class="op" id="8112114">.</span><span class="ident" id="8112115">NewReader</span><span class="op" id="8112124">(</span><span class="ident" id="8112125">b</span><span class="op" id="8112126">)</span><span class="op" id="8112127">)</span><span class="op" id="8112128">.</span><span class="ident" id="8112129">Decode</span><span class="op" id="8112135">(</span><span class="ident" id="8112136">nil</span><span class="op" id="8112139">)</span><span class="op" id="8112140">;</span>&nbsp;<span class="ident" id="8112142">err</span>&nbsp;<span class="op" id="8112146">==</span>&nbsp;<span class="ident" id="8112149">nil</span>&nbsp;<span class="op" id="8112153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112157">t</span><span class="op" id="8112158">.</span><span class="ident" id="8112159">Error</span><span class="op" id="8112164">(</span><span class="string" id="8112165">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="8112196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112199">}</span>&nbsp;<span class="keyword" id="8112201">else</span>&nbsp;<span class="keyword" id="8112206">if</span>&nbsp;<span class="ident" id="8112209">err</span><span class="op" id="8112212">.</span><span class="ident" id="8112213">Error</span><span class="op" id="8112218">(</span><span class="op" id="8112219">)</span>&nbsp;<span class="op" id="8112221">!=</span>&nbsp;<span class="ident" id="8112224">errBadCount</span><span class="op" id="8112235">.</span><span class="ident" id="8112236">Error</span><span class="op" id="8112241">(</span><span class="op" id="8112242">)</span>&nbsp;<span class="op" id="8112244">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112248">t</span><span class="op" id="8112249">.</span><span class="ident" id="8112250">Error</span><span class="op" id="8112255">(</span><span class="string" id="8112256">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="8112287">,</span>&nbsp;<span class="ident" id="8112289">err</span><span class="op" id="8112292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112295">}</span><br>
<span class="lineno"></span><span class="op" id="8112297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8112300">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="8112364">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="8112424">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="8112459">func</span>&nbsp;<span class="ident" id="8112464">TestSequentialDecoder</span><span class="op" id="8112485">(</span><span class="ident" id="8112486">t</span>&nbsp;<span class="op" id="8112488">*</span><span class="ident" id="8112489">testing</span><span class="op" id="8112496">.</span><span class="ident" id="8112497">T</span><span class="op" id="8112498">)</span>&nbsp;<span class="op" id="8112500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112503">b</span>&nbsp;<span class="op" id="8112505">:=</span>&nbsp;<span class="builtinfunc" id="8112508">new</span><span class="op" id="8112511">(</span><span class="ident" id="8112512">bytes</span><span class="op" id="8112517">.</span><span class="ident" id="8112518">Buffer</span><span class="op" id="8112524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112527">enc</span>&nbsp;<span class="op" id="8112531">:=</span>&nbsp;<span class="ident" id="8112534">NewEncoder</span><span class="op" id="8112544">(</span><span class="ident" id="8112545">b</span><span class="op" id="8112546">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112549">const</span>&nbsp;<span class="ident" id="8112555">count</span>&nbsp;<span class="op" id="8112561">=</span>&nbsp;<span class="num" id="8112563">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112567">for</span>&nbsp;<span class="ident" id="8112571">i</span>&nbsp;<span class="op" id="8112573">:=</span>&nbsp;<span class="num" id="8112576">0</span><span class="op" id="8112577">;</span>&nbsp;<span class="ident" id="8112579">i</span>&nbsp;<span class="op" id="8112581">&lt;</span>&nbsp;<span class="ident" id="8112583">count</span><span class="op" id="8112588">;</span>&nbsp;<span class="ident" id="8112590">i</span><span class="op" id="8112591">++</span>&nbsp;<span class="op" id="8112594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112598">s</span>&nbsp;<span class="op" id="8112600">:=</span>&nbsp;<span class="ident" id="8112603">fmt</span><span class="op" id="8112606">.</span><span class="ident" id="8112607">Sprintf</span><span class="op" id="8112614">(</span><span class="string" id="8112615">&#34;%d&#34;</span><span class="op" id="8112619">,</span>&nbsp;<span class="ident" id="8112621">i</span><span class="op" id="8112622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112626">if</span>&nbsp;<span class="ident" id="8112629">err</span>&nbsp;<span class="op" id="8112633">:=</span>&nbsp;<span class="ident" id="8112636">enc</span><span class="op" id="8112639">.</span><span class="ident" id="8112640">Encode</span><span class="op" id="8112646">(</span><span class="ident" id="8112647">s</span><span class="op" id="8112648">)</span><span class="op" id="8112649">;</span>&nbsp;<span class="ident" id="8112651">err</span>&nbsp;<span class="op" id="8112655">!=</span>&nbsp;<span class="ident" id="8112658">nil</span>&nbsp;<span class="op" id="8112662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112667">t</span><span class="op" id="8112668">.</span><span class="ident" id="8112669">Error</span><span class="op" id="8112674">(</span><span class="string" id="8112675">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="8112690">,</span>&nbsp;<span class="ident" id="8112692">err</span><span class="op" id="8112695">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112705">for</span>&nbsp;<span class="ident" id="8112709">i</span>&nbsp;<span class="op" id="8112711">:=</span>&nbsp;<span class="num" id="8112714">0</span><span class="op" id="8112715">;</span>&nbsp;<span class="ident" id="8112717">i</span>&nbsp;<span class="op" id="8112719">&lt;</span>&nbsp;<span class="ident" id="8112721">count</span><span class="op" id="8112726">;</span>&nbsp;<span class="ident" id="8112728">i</span><span class="op" id="8112729">++</span>&nbsp;<span class="op" id="8112732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112736">dec</span>&nbsp;<span class="op" id="8112740">:=</span>&nbsp;<span class="ident" id="8112743">NewDecoder</span><span class="op" id="8112753">(</span><span class="ident" id="8112754">b</span><span class="op" id="8112755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112759">var</span>&nbsp;<span class="ident" id="8112763">s</span>&nbsp;<span class="builtintype" id="8112765">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112774">if</span>&nbsp;<span class="ident" id="8112777">err</span>&nbsp;<span class="op" id="8112781">:=</span>&nbsp;<span class="ident" id="8112784">dec</span><span class="op" id="8112787">.</span><span class="ident" id="8112788">Decode</span><span class="op" id="8112794">(</span><span class="op" id="8112795">&amp;</span><span class="ident" id="8112796">s</span><span class="op" id="8112797">)</span><span class="op" id="8112798">;</span>&nbsp;<span class="ident" id="8112800">err</span>&nbsp;<span class="op" id="8112804">!=</span>&nbsp;<span class="ident" id="8112807">nil</span>&nbsp;<span class="op" id="8112811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112816">t</span><span class="op" id="8112817">.</span><span class="ident" id="8112818">Fatal</span><span class="op" id="8112823">(</span><span class="string" id="8112824">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="8112839">,</span>&nbsp;<span class="ident" id="8112841">err</span><span class="op" id="8112844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8112852">if</span>&nbsp;<span class="ident" id="8112855">s</span>&nbsp;<span class="op" id="8112857">!=</span>&nbsp;<span class="ident" id="8112860">fmt</span><span class="op" id="8112863">.</span><span class="ident" id="8112864">Sprintf</span><span class="op" id="8112871">(</span><span class="string" id="8112872">&#34;%d&#34;</span><span class="op" id="8112876">,</span>&nbsp;<span class="ident" id="8112878">i</span><span class="op" id="8112879">)</span>&nbsp;<span class="op" id="8112881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8112886">t</span><span class="op" id="8112887">.</span><span class="ident" id="8112888">Fatalf</span><span class="op" id="8112894">(</span><span class="string" id="8112895">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8112922">,</span>&nbsp;<span class="ident" id="8112924">i</span><span class="op" id="8112925">,</span>&nbsp;<span class="ident" id="8112927">s</span><span class="op" id="8112928">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8112935">}</span><br>
<span class="lineno"></span><span class="op" id="8112937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8112940">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="8113036">type</span>&nbsp;<span class="ident" id="8113041">Bug2</span>&nbsp;<span class="keyword" id="8113046">struct</span>&nbsp;<span class="op" id="8113053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113056">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8113060">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113065">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113069">chan</span>&nbsp;<span class="builtintype" id="8113074">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113079">CP</span>&nbsp;&nbsp;<span class="op" id="8113083">*</span><span class="keyword" id="8113084">chan</span>&nbsp;<span class="builtintype" id="8113089">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113094">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113098">func</span><span class="op" id="8113102">(</span><span class="op" id="8113103">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113106">FPP</span>&nbsp;<span class="op" id="8113110">*</span><span class="op" id="8113111">*</span><span class="keyword" id="8113112">func</span><span class="op" id="8113116">(</span><span class="op" id="8113117">)</span><br>
<span class="lineno"></span><span class="op" id="8113119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8113122">func</span>&nbsp;<span class="ident" id="8113127">TestChanFuncIgnored</span><span class="op" id="8113146">(</span><span class="ident" id="8113147">t</span>&nbsp;<span class="op" id="8113149">*</span><span class="ident" id="8113150">testing</span><span class="op" id="8113157">.</span><span class="ident" id="8113158">T</span><span class="op" id="8113159">)</span>&nbsp;<span class="op" id="8113161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113164">c</span>&nbsp;<span class="op" id="8113166">:=</span>&nbsp;<span class="builtinfunc" id="8113169">make</span><span class="op" id="8113173">(</span><span class="keyword" id="8113174">chan</span>&nbsp;<span class="builtintype" id="8113179">int</span><span class="op" id="8113182">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113185">f</span>&nbsp;<span class="op" id="8113187">:=</span>&nbsp;<span class="keyword" id="8113190">func</span><span class="op" id="8113194">(</span><span class="op" id="8113195">)</span>&nbsp;<span class="op" id="8113197">{</span><span class="op" id="8113198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113201">fp</span>&nbsp;<span class="op" id="8113204">:=</span>&nbsp;<span class="op" id="8113207">&amp;</span><span class="ident" id="8113208">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113211">b0</span>&nbsp;<span class="op" id="8113214">:=</span>&nbsp;<span class="ident" id="8113217">Bug2</span><span class="op" id="8113221">{</span><span class="num" id="8113222">23</span><span class="op" id="8113224">,</span>&nbsp;<span class="ident" id="8113226">c</span><span class="op" id="8113227">,</span>&nbsp;<span class="op" id="8113229">&amp;</span><span class="ident" id="8113230">c</span><span class="op" id="8113231">,</span>&nbsp;<span class="ident" id="8113233">f</span><span class="op" id="8113234">,</span>&nbsp;<span class="op" id="8113236">&amp;</span><span class="ident" id="8113237">fp</span><span class="op" id="8113239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113242">var</span>&nbsp;<span class="ident" id="8113246">buf</span>&nbsp;<span class="ident" id="8113250">bytes</span><span class="op" id="8113255">.</span><span class="ident" id="8113256">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113264">enc</span>&nbsp;<span class="op" id="8113268">:=</span>&nbsp;<span class="ident" id="8113271">NewEncoder</span><span class="op" id="8113281">(</span><span class="op" id="8113282">&amp;</span><span class="ident" id="8113283">buf</span><span class="op" id="8113286">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113289">if</span>&nbsp;<span class="ident" id="8113292">err</span>&nbsp;<span class="op" id="8113296">:=</span>&nbsp;<span class="ident" id="8113299">enc</span><span class="op" id="8113302">.</span><span class="ident" id="8113303">Encode</span><span class="op" id="8113309">(</span><span class="ident" id="8113310">b0</span><span class="op" id="8113312">)</span><span class="op" id="8113313">;</span>&nbsp;<span class="ident" id="8113315">err</span>&nbsp;<span class="op" id="8113319">!=</span>&nbsp;<span class="ident" id="8113322">nil</span>&nbsp;<span class="op" id="8113326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113330">t</span><span class="op" id="8113331">.</span><span class="ident" id="8113332">Fatal</span><span class="op" id="8113337">(</span><span class="string" id="8113338">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="8113355">,</span>&nbsp;<span class="ident" id="8113357">err</span><span class="op" id="8113360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113366">var</span>&nbsp;<span class="ident" id="8113370">b1</span>&nbsp;<span class="ident" id="8113373">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113379">err</span>&nbsp;<span class="op" id="8113383">:=</span>&nbsp;<span class="ident" id="8113386">NewDecoder</span><span class="op" id="8113396">(</span><span class="op" id="8113397">&amp;</span><span class="ident" id="8113398">buf</span><span class="op" id="8113401">)</span><span class="op" id="8113402">.</span><span class="ident" id="8113403">Decode</span><span class="op" id="8113409">(</span><span class="op" id="8113410">&amp;</span><span class="ident" id="8113411">b1</span><span class="op" id="8113413">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113416">if</span>&nbsp;<span class="ident" id="8113419">err</span>&nbsp;<span class="op" id="8113423">!=</span>&nbsp;<span class="ident" id="8113426">nil</span>&nbsp;<span class="op" id="8113430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113434">t</span><span class="op" id="8113435">.</span><span class="ident" id="8113436">Fatal</span><span class="op" id="8113441">(</span><span class="string" id="8113442">&#34;decode:&#34;</span><span class="op" id="8113451">,</span>&nbsp;<span class="ident" id="8113453">err</span><span class="op" id="8113456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113462">if</span>&nbsp;<span class="ident" id="8113465">b1</span><span class="op" id="8113467">.</span><span class="ident" id="8113468">A</span>&nbsp;<span class="op" id="8113470">!=</span>&nbsp;<span class="ident" id="8113473">b0</span><span class="op" id="8113475">.</span><span class="ident" id="8113476">A</span>&nbsp;<span class="op" id="8113478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113482">t</span><span class="op" id="8113483">.</span><span class="ident" id="8113484">Fatalf</span><span class="op" id="8113490">(</span><span class="string" id="8113491">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8113507">,</span>&nbsp;<span class="ident" id="8113509">b1</span><span class="op" id="8113511">.</span><span class="ident" id="8113512">A</span><span class="op" id="8113513">,</span>&nbsp;<span class="ident" id="8113515">b0</span><span class="op" id="8113517">.</span><span class="ident" id="8113518">A</span><span class="op" id="8113519">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113525">if</span>&nbsp;<span class="ident" id="8113528">b1</span><span class="op" id="8113530">.</span><span class="ident" id="8113531">C</span>&nbsp;<span class="op" id="8113533">!=</span>&nbsp;<span class="ident" id="8113536">nil</span>&nbsp;<span class="op" id="8113540">||</span>&nbsp;<span class="ident" id="8113543">b1</span><span class="op" id="8113545">.</span><span class="ident" id="8113546">CP</span>&nbsp;<span class="op" id="8113549">!=</span>&nbsp;<span class="ident" id="8113552">nil</span>&nbsp;<span class="op" id="8113556">||</span>&nbsp;<span class="ident" id="8113559">b1</span><span class="op" id="8113561">.</span><span class="ident" id="8113562">F</span>&nbsp;<span class="op" id="8113564">!=</span>&nbsp;<span class="ident" id="8113567">nil</span>&nbsp;<span class="op" id="8113571">||</span>&nbsp;<span class="ident" id="8113574">b1</span><span class="op" id="8113576">.</span><span class="ident" id="8113577">FPP</span>&nbsp;<span class="op" id="8113581">!=</span>&nbsp;<span class="ident" id="8113584">nil</span>&nbsp;<span class="op" id="8113588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113592">t</span><span class="op" id="8113593">.</span><span class="ident" id="8113594">Fatal</span><span class="op" id="8113599">(</span><span class="string" id="8113600">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="8113635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113638">}</span><br>
<span class="lineno"></span><span class="op" id="8113640">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="8113643">func</span>&nbsp;<span class="ident" id="8113648">TestSliceIncompatibility</span><span class="op" id="8113672">(</span><span class="ident" id="8113673">t</span>&nbsp;<span class="op" id="8113675">*</span><span class="ident" id="8113676">testing</span><span class="op" id="8113683">.</span><span class="ident" id="8113684">T</span><span class="op" id="8113685">)</span>&nbsp;<span class="op" id="8113687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113690">var</span>&nbsp;<span class="ident" id="8113694">in</span>&nbsp;<span class="op" id="8113697">=</span>&nbsp;<span class="op" id="8113699">[</span><span class="op" id="8113700">]</span><span class="builtintype" id="8113701">byte</span><span class="op" id="8113705">{</span><span class="num" id="8113706">1</span><span class="op" id="8113707">,</span>&nbsp;<span class="num" id="8113709">2</span><span class="op" id="8113710">,</span>&nbsp;<span class="num" id="8113712">3</span><span class="op" id="8113713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113716">var</span>&nbsp;<span class="ident" id="8113720">out</span>&nbsp;<span class="op" id="8113724">[</span><span class="op" id="8113725">]</span><span class="builtintype" id="8113726">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8113731">if</span>&nbsp;<span class="ident" id="8113734">err</span>&nbsp;<span class="op" id="8113738">:=</span>&nbsp;<span class="ident" id="8113741">encAndDec</span><span class="op" id="8113750">(</span><span class="ident" id="8113751">in</span><span class="op" id="8113753">,</span>&nbsp;<span class="op" id="8113755">&amp;</span><span class="ident" id="8113756">out</span><span class="op" id="8113759">)</span><span class="op" id="8113760">;</span>&nbsp;<span class="ident" id="8113762">err</span>&nbsp;<span class="op" id="8113766">==</span>&nbsp;<span class="ident" id="8113769">nil</span>&nbsp;<span class="op" id="8113773">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113777">t</span><span class="op" id="8113778">.</span><span class="ident" id="8113779">Error</span><span class="op" id="8113784">(</span><span class="string" id="8113785">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="8113815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113818">}</span><br>
<span class="lineno"></span><span class="op" id="8113820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8113823">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="8113880">type</span>&nbsp;<span class="ident" id="8113885">Bug3</span>&nbsp;<span class="keyword" id="8113890">struct</span>&nbsp;<span class="op" id="8113897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113900">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8113909">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113914">Children</span>&nbsp;<span class="op" id="8113923">[</span><span class="op" id="8113924">]</span><span class="op" id="8113925">*</span><span class="ident" id="8113926">Bug3</span><br>
<span class="lineno"></span><span class="op" id="8113931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="8113934">func</span>&nbsp;<span class="ident" id="8113939">TestGobPtrSlices</span><span class="op" id="8113955">(</span><span class="ident" id="8113956">t</span>&nbsp;<span class="op" id="8113958">*</span><span class="ident" id="8113959">testing</span><span class="op" id="8113966">.</span><span class="ident" id="8113967">T</span><span class="op" id="8113968">)</span>&nbsp;<span class="op" id="8113970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8113973">in</span>&nbsp;<span class="op" id="8113976">:=</span>&nbsp;<span class="op" id="8113979">[</span><span class="op" id="8113980">]</span><span class="op" id="8113981">*</span><span class="ident" id="8113982">Bug3</span><span class="op" id="8113986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8113990">{</span><span class="num" id="8113991">1</span><span class="op" id="8113992">,</span>&nbsp;<span class="ident" id="8113994">nil</span><span class="op" id="8113997">}</span><span class="op" id="8113998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114002">{</span><span class="num" id="8114003">2</span><span class="op" id="8114004">,</span>&nbsp;<span class="ident" id="8114006">nil</span><span class="op" id="8114009">}</span><span class="op" id="8114010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114013">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114016">b</span>&nbsp;<span class="op" id="8114018">:=</span>&nbsp;<span class="builtinfunc" id="8114021">new</span><span class="op" id="8114024">(</span><span class="ident" id="8114025">bytes</span><span class="op" id="8114030">.</span><span class="ident" id="8114031">Buffer</span><span class="op" id="8114037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114040">err</span>&nbsp;<span class="op" id="8114044">:=</span>&nbsp;<span class="ident" id="8114047">NewEncoder</span><span class="op" id="8114057">(</span><span class="ident" id="8114058">b</span><span class="op" id="8114059">)</span><span class="op" id="8114060">.</span><span class="ident" id="8114061">Encode</span><span class="op" id="8114067">(</span><span class="op" id="8114068">&amp;</span><span class="ident" id="8114069">in</span><span class="op" id="8114071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114074">if</span>&nbsp;<span class="ident" id="8114077">err</span>&nbsp;<span class="op" id="8114081">!=</span>&nbsp;<span class="ident" id="8114084">nil</span>&nbsp;<span class="op" id="8114088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114092">t</span><span class="op" id="8114093">.</span><span class="ident" id="8114094">Fatal</span><span class="op" id="8114099">(</span><span class="string" id="8114100">&#34;encode:&#34;</span><span class="op" id="8114109">,</span>&nbsp;<span class="ident" id="8114111">err</span><span class="op" id="8114114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114117">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114121">var</span>&nbsp;<span class="ident" id="8114125">out</span>&nbsp;<span class="op" id="8114129">[</span><span class="op" id="8114130">]</span><span class="op" id="8114131">*</span><span class="ident" id="8114132">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114138">err</span>&nbsp;<span class="op" id="8114142">=</span>&nbsp;<span class="ident" id="8114144">NewDecoder</span><span class="op" id="8114154">(</span><span class="ident" id="8114155">b</span><span class="op" id="8114156">)</span><span class="op" id="8114157">.</span><span class="ident" id="8114158">Decode</span><span class="op" id="8114164">(</span><span class="op" id="8114165">&amp;</span><span class="ident" id="8114166">out</span><span class="op" id="8114169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114172">if</span>&nbsp;<span class="ident" id="8114175">err</span>&nbsp;<span class="op" id="8114179">!=</span>&nbsp;<span class="ident" id="8114182">nil</span>&nbsp;<span class="op" id="8114186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114190">t</span><span class="op" id="8114191">.</span><span class="ident" id="8114192">Fatal</span><span class="op" id="8114197">(</span><span class="string" id="8114198">&#34;decode:&#34;</span><span class="op" id="8114207">,</span>&nbsp;<span class="ident" id="8114209">err</span><span class="op" id="8114212">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114218">if</span>&nbsp;<span class="op" id="8114221">!</span><span class="ident" id="8114222">reflect</span><span class="op" id="8114229">.</span><span class="ident" id="8114230">DeepEqual</span><span class="op" id="8114239">(</span><span class="ident" id="8114240">in</span><span class="op" id="8114242">,</span>&nbsp;<span class="ident" id="8114244">out</span><span class="op" id="8114247">)</span>&nbsp;<span class="op" id="8114249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114253">t</span><span class="op" id="8114254">.</span><span class="ident" id="8114255">Fatalf</span><span class="op" id="8114261">(</span><span class="string" id="8114262">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="8114281">,</span>&nbsp;<span class="ident" id="8114283">out</span><span class="op" id="8114286">,</span>&nbsp;<span class="ident" id="8114288">in</span><span class="op" id="8114290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114293">}</span><br>
<span class="lineno"></span><span class="op" id="8114295">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="8114298">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="8114375">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="8114445">func</span>&nbsp;<span class="ident" id="8114450">TestPtrToMapOfMap</span><span class="op" id="8114467">(</span><span class="ident" id="8114468">t</span>&nbsp;<span class="op" id="8114470">*</span><span class="ident" id="8114471">testing</span><span class="op" id="8114478">.</span><span class="ident" id="8114479">T</span><span class="op" id="8114480">)</span>&nbsp;<span class="op" id="8114482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114485">Register</span><span class="op" id="8114493">(</span><span class="builtinfunc" id="8114494">make</span><span class="op" id="8114498">(</span><span class="keyword" id="8114499">map</span><span class="op" id="8114502">[</span><span class="builtintype" id="8114503">string</span><span class="op" id="8114509">]</span><span class="keyword" id="8114510">interface</span><span class="op" id="8114519">{</span><span class="op" id="8114520">}</span><span class="op" id="8114521">)</span><span class="op" id="8114522">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114525">subdata</span>&nbsp;<span class="op" id="8114533">:=</span>&nbsp;<span class="builtinfunc" id="8114536">make</span><span class="op" id="8114540">(</span><span class="keyword" id="8114541">map</span><span class="op" id="8114544">[</span><span class="builtintype" id="8114545">string</span><span class="op" id="8114551">]</span><span class="keyword" id="8114552">interface</span><span class="op" id="8114561">{</span><span class="op" id="8114562">}</span><span class="op" id="8114563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114566">subdata</span><span class="op" id="8114573">[</span><span class="string" id="8114574">&#34;bar&#34;</span><span class="op" id="8114579">]</span>&nbsp;<span class="op" id="8114581">=</span>&nbsp;<span class="string" id="8114583">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114590">data</span>&nbsp;<span class="op" id="8114595">:=</span>&nbsp;<span class="builtinfunc" id="8114598">make</span><span class="op" id="8114602">(</span><span class="keyword" id="8114603">map</span><span class="op" id="8114606">[</span><span class="builtintype" id="8114607">string</span><span class="op" id="8114613">]</span><span class="keyword" id="8114614">interface</span><span class="op" id="8114623">{</span><span class="op" id="8114624">}</span><span class="op" id="8114625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114628">data</span><span class="op" id="8114632">[</span><span class="string" id="8114633">&#34;foo&#34;</span><span class="op" id="8114638">]</span>&nbsp;<span class="op" id="8114640">=</span>&nbsp;<span class="ident" id="8114642">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114652">b</span>&nbsp;<span class="op" id="8114654">:=</span>&nbsp;<span class="builtinfunc" id="8114657">new</span><span class="op" id="8114660">(</span><span class="ident" id="8114661">bytes</span><span class="op" id="8114666">.</span><span class="ident" id="8114667">Buffer</span><span class="op" id="8114673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114676">err</span>&nbsp;<span class="op" id="8114680">:=</span>&nbsp;<span class="ident" id="8114683">NewEncoder</span><span class="op" id="8114693">(</span><span class="ident" id="8114694">b</span><span class="op" id="8114695">)</span><span class="op" id="8114696">.</span><span class="ident" id="8114697">Encode</span><span class="op" id="8114703">(</span><span class="ident" id="8114704">data</span><span class="op" id="8114708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114711">if</span>&nbsp;<span class="ident" id="8114714">err</span>&nbsp;<span class="op" id="8114718">!=</span>&nbsp;<span class="ident" id="8114721">nil</span>&nbsp;<span class="op" id="8114725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114729">t</span><span class="op" id="8114730">.</span><span class="ident" id="8114731">Fatal</span><span class="op" id="8114736">(</span><span class="string" id="8114737">&#34;encode:&#34;</span><span class="op" id="8114746">,</span>&nbsp;<span class="ident" id="8114748">err</span><span class="op" id="8114751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114754">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114757">var</span>&nbsp;<span class="ident" id="8114761">newData</span>&nbsp;<span class="keyword" id="8114769">map</span><span class="op" id="8114772">[</span><span class="builtintype" id="8114773">string</span><span class="op" id="8114779">]</span><span class="keyword" id="8114780">interface</span><span class="op" id="8114789">{</span><span class="op" id="8114790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114793">err</span>&nbsp;<span class="op" id="8114797">=</span>&nbsp;<span class="ident" id="8114799">NewDecoder</span><span class="op" id="8114809">(</span><span class="ident" id="8114810">b</span><span class="op" id="8114811">)</span><span class="op" id="8114812">.</span><span class="ident" id="8114813">Decode</span><span class="op" id="8114819">(</span><span class="op" id="8114820">&amp;</span><span class="ident" id="8114821">newData</span><span class="op" id="8114828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114831">if</span>&nbsp;<span class="ident" id="8114834">err</span>&nbsp;<span class="op" id="8114838">!=</span>&nbsp;<span class="ident" id="8114841">nil</span>&nbsp;<span class="op" id="8114845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114849">t</span><span class="op" id="8114850">.</span><span class="ident" id="8114851">Fatal</span><span class="op" id="8114856">(</span><span class="string" id="8114857">&#34;decode:&#34;</span><span class="op" id="8114866">,</span>&nbsp;<span class="ident" id="8114868">err</span><span class="op" id="8114871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114874">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8114877">if</span>&nbsp;<span class="op" id="8114880">!</span><span class="ident" id="8114881">reflect</span><span class="op" id="8114888">.</span><span class="ident" id="8114889">DeepEqual</span><span class="op" id="8114898">(</span><span class="ident" id="8114899">data</span><span class="op" id="8114903">,</span>&nbsp;<span class="ident" id="8114905">newData</span><span class="op" id="8114912">)</span>&nbsp;<span class="op" id="8114914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8114918">t</span><span class="op" id="8114919">.</span><span class="ident" id="8114920">Fatalf</span><span class="op" id="8114926">(</span><span class="string" id="8114927">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8114947">,</span>&nbsp;<span class="ident" id="8114949">data</span><span class="op" id="8114953">,</span>&nbsp;<span class="ident" id="8114955">newData</span><span class="op" id="8114962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8114965">}</span><br>
<span class="lineno"></span><span class="op" id="8114967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="8114970">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8115053">func</span>&nbsp;<span class="ident" id="8115058">TestTopLevelNilPointer</span><span class="op" id="8115080">(</span><span class="ident" id="8115081">t</span>&nbsp;<span class="op" id="8115083">*</span><span class="ident" id="8115084">testing</span><span class="op" id="8115091">.</span><span class="ident" id="8115092">T</span><span class="op" id="8115093">)</span>&nbsp;<span class="op" id="8115095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115098">errMsg</span>&nbsp;<span class="op" id="8115105">:=</span>&nbsp;<span class="ident" id="8115108">topLevelNilPanic</span><span class="op" id="8115124">(</span><span class="ident" id="8115125">t</span><span class="op" id="8115126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115129">if</span>&nbsp;<span class="ident" id="8115132">errMsg</span>&nbsp;<span class="op" id="8115139">==</span>&nbsp;<span class="string" id="8115142">&#34;&#34;</span>&nbsp;<span class="op" id="8115145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115149">t</span><span class="op" id="8115150">.</span><span class="ident" id="8115151">Fatal</span><span class="op" id="8115156">(</span><span class="string" id="8115157">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="8115194">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115200">if</span>&nbsp;<span class="op" id="8115203">!</span><span class="ident" id="8115204">strings</span><span class="op" id="8115211">.</span><span class="ident" id="8115212">Contains</span><span class="op" id="8115220">(</span><span class="ident" id="8115221">errMsg</span><span class="op" id="8115227">,</span>&nbsp;<span class="string" id="8115229">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8115242">)</span>&nbsp;<span class="op" id="8115244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115248">t</span><span class="op" id="8115249">.</span><span class="ident" id="8115250">Fatal</span><span class="op" id="8115255">(</span><span class="string" id="8115256">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="8115290">,</span>&nbsp;<span class="ident" id="8115292">errMsg</span><span class="op" id="8115298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115301">}</span><br>
<span class="lineno"></span><span class="op" id="8115303">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="8115306">func</span>&nbsp;<span class="ident" id="8115311">topLevelNilPanic</span><span class="op" id="8115327">(</span><span class="ident" id="8115328">t</span>&nbsp;<span class="op" id="8115330">*</span><span class="ident" id="8115331">testing</span><span class="op" id="8115338">.</span><span class="ident" id="8115339">T</span><span class="op" id="8115340">)</span>&nbsp;<span class="op" id="8115342">(</span><span class="ident" id="8115343">panicErr</span>&nbsp;<span class="builtintype" id="8115352">string</span><span class="op" id="8115358">)</span>&nbsp;<span class="op" id="8115360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115363">defer</span>&nbsp;<span class="keyword" id="8115369">func</span><span class="op" id="8115373">(</span><span class="op" id="8115374">)</span>&nbsp;<span class="op" id="8115376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115380">e</span>&nbsp;<span class="op" id="8115382">:=</span>&nbsp;<span class="builtinfunc" id="8115385">recover</span><span class="op" id="8115392">(</span><span class="op" id="8115393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115397">if</span>&nbsp;<span class="ident" id="8115400">err</span><span class="op" id="8115403">,</span>&nbsp;<span class="ident" id="8115405">ok</span>&nbsp;<span class="op" id="8115408">:=</span>&nbsp;<span class="ident" id="8115411">e</span><span class="op" id="8115412">.</span><span class="op" id="8115413">(</span><span class="builtintype" id="8115414">string</span><span class="op" id="8115420">)</span><span class="op" id="8115421">;</span>&nbsp;<span class="ident" id="8115423">ok</span>&nbsp;<span class="op" id="8115426">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115431">panicErr</span>&nbsp;<span class="op" id="8115440">=</span>&nbsp;<span class="ident" id="8115442">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115451">}</span><span class="op" id="8115452">(</span><span class="op" id="8115453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115456">var</span>&nbsp;<span class="ident" id="8115460">ip</span>&nbsp;<span class="op" id="8115463">*</span><span class="builtintype" id="8115464">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115469">buf</span>&nbsp;<span class="op" id="8115473">:=</span>&nbsp;<span class="builtinfunc" id="8115476">new</span><span class="op" id="8115479">(</span><span class="ident" id="8115480">bytes</span><span class="op" id="8115485">.</span><span class="ident" id="8115486">Buffer</span><span class="op" id="8115492">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115495">if</span>&nbsp;<span class="ident" id="8115498">err</span>&nbsp;<span class="op" id="8115502">:=</span>&nbsp;<span class="ident" id="8115505">NewEncoder</span><span class="op" id="8115515">(</span><span class="ident" id="8115516">buf</span><span class="op" id="8115519">)</span><span class="op" id="8115520">.</span><span class="ident" id="8115521">Encode</span><span class="op" id="8115527">(</span><span class="ident" id="8115528">ip</span><span class="op" id="8115530">)</span><span class="op" id="8115531">;</span>&nbsp;<span class="ident" id="8115533">err</span>&nbsp;<span class="op" id="8115537">!=</span>&nbsp;<span class="ident" id="8115540">nil</span>&nbsp;<span class="op" id="8115544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115548">t</span><span class="op" id="8115549">.</span><span class="ident" id="8115550">Fatal</span><span class="op" id="8115555">(</span><span class="string" id="8115556">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="8115574">,</span>&nbsp;<span class="ident" id="8115576">err</span><span class="op" id="8115579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115585">return</span><br>
<span class="lineno"></span><span class="op" id="8115592">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="8115595">func</span>&nbsp;<span class="ident" id="8115600">TestNilPointerInsideInterface</span><span class="op" id="8115629">(</span><span class="ident" id="8115630">t</span>&nbsp;<span class="op" id="8115632">*</span><span class="ident" id="8115633">testing</span><span class="op" id="8115640">.</span><span class="ident" id="8115641">T</span><span class="op" id="8115642">)</span>&nbsp;<span class="op" id="8115644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115647">var</span>&nbsp;<span class="ident" id="8115651">ip</span>&nbsp;<span class="op" id="8115654">*</span><span class="builtintype" id="8115655">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115660">si</span>&nbsp;<span class="op" id="8115663">:=</span>&nbsp;<span class="keyword" id="8115666">struct</span>&nbsp;<span class="op" id="8115673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115677">I</span>&nbsp;<span class="keyword" id="8115679">interface</span><span class="op" id="8115688">{</span><span class="op" id="8115689">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115692">}</span><span class="op" id="8115693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115697">I</span><span class="op" id="8115698">:</span>&nbsp;<span class="ident" id="8115700">ip</span><span class="op" id="8115702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115708">buf</span>&nbsp;<span class="op" id="8115712">:=</span>&nbsp;<span class="builtinfunc" id="8115715">new</span><span class="op" id="8115718">(</span><span class="ident" id="8115719">bytes</span><span class="op" id="8115724">.</span><span class="ident" id="8115725">Buffer</span><span class="op" id="8115731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115734">err</span>&nbsp;<span class="op" id="8115738">:=</span>&nbsp;<span class="ident" id="8115741">NewEncoder</span><span class="op" id="8115751">(</span><span class="ident" id="8115752">buf</span><span class="op" id="8115755">)</span><span class="op" id="8115756">.</span><span class="ident" id="8115757">Encode</span><span class="op" id="8115763">(</span><span class="ident" id="8115764">si</span><span class="op" id="8115766">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115769">if</span>&nbsp;<span class="ident" id="8115772">err</span>&nbsp;<span class="op" id="8115776">==</span>&nbsp;<span class="ident" id="8115779">nil</span>&nbsp;<span class="op" id="8115783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115787">t</span><span class="op" id="8115788">.</span><span class="ident" id="8115789">Fatal</span><span class="op" id="8115794">(</span><span class="string" id="8115795">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="8115821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8115824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115827">errMsg</span>&nbsp;<span class="op" id="8115834">:=</span>&nbsp;<span class="ident" id="8115837">err</span><span class="op" id="8115840">.</span><span class="ident" id="8115841">Error</span><span class="op" id="8115846">(</span><span class="op" id="8115847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8115850">if</span>&nbsp;<span class="op" id="8115853">!</span><span class="ident" id="8115854">strings</span><span class="op" id="8115861">.</span><span class="ident" id="8115862">Contains</span><span class="op" id="8115870">(</span><span class="ident" id="8115871">errMsg</span><span class="op" id="8115877">,</span>&nbsp;<span class="string" id="8115879">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="8115892">)</span>&nbsp;<span class="op" id="8115894">||</span>&nbsp;<span class="op" id="8115897">!</span><span class="ident" id="8115898">strings</span><span class="op" id="8115905">.</span><span class="ident" id="8115906">Contains</span><span class="op" id="8115914">(</span><span class="ident" id="8115915">errMsg</span><span class="op" id="8115921">,</span>&nbsp;<span class="string" id="8115923">&#34;interface&#34;</span><span class="op" id="8115934">)</span>&nbsp;<span class="op" id="8115936">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8115940">t</span><span class="op" id="8115941">.</span><span class="ident" id="8115942">Fatal</span><span class="op" id="8115947">(</span><span class="string" id="8115948">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="8116002">,</span>&nbsp;<span class="ident" id="8116004">errMsg</span><span class="op" id="8116010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116013">}</span><br>
<span class="lineno"></span><span class="op" id="8116015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116018">type</span>&nbsp;<span class="ident" id="8116023">Bug4Public</span>&nbsp;<span class="keyword" id="8116034">struct</span>&nbsp;<span class="op" id="8116041">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116044">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8116051">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116059">Secret</span>&nbsp;<span class="ident" id="8116066">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="8116077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8116080">type</span>&nbsp;<span class="ident" id="8116085">Bug4Secret</span>&nbsp;<span class="keyword" id="8116096">struct</span>&nbsp;<span class="op" id="8116103">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116106">a</span>&nbsp;<span class="builtintype" id="8116108">int</span>&nbsp;<span class="comment" id="8116112">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="8116142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8116145">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="8116223">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="8116238">func</span>&nbsp;<span class="ident" id="8116243">TestMutipleEncodingsOfBadType</span><span class="op" id="8116272">(</span><span class="ident" id="8116273">t</span>&nbsp;<span class="op" id="8116275">*</span><span class="ident" id="8116276">testing</span><span class="op" id="8116283">.</span><span class="ident" id="8116284">T</span><span class="op" id="8116285">)</span>&nbsp;<span class="op" id="8116287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116290">x</span>&nbsp;<span class="op" id="8116292">:=</span>&nbsp;<span class="ident" id="8116295">Bug4Public</span><span class="op" id="8116305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116309">Name</span><span class="op" id="8116313">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8116317">&#34;name&#34;</span><span class="op" id="8116323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116327">Secret</span><span class="op" id="8116333">:</span>&nbsp;<span class="ident" id="8116335">Bug4Secret</span><span class="op" id="8116345">{</span><span class="num" id="8116346">1</span><span class="op" id="8116347">}</span><span class="op" id="8116348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116351">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116354">buf</span>&nbsp;<span class="op" id="8116358">:=</span>&nbsp;<span class="builtinfunc" id="8116361">new</span><span class="op" id="8116364">(</span><span class="ident" id="8116365">bytes</span><span class="op" id="8116370">.</span><span class="ident" id="8116371">Buffer</span><span class="op" id="8116377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116380">enc</span>&nbsp;<span class="op" id="8116384">:=</span>&nbsp;<span class="ident" id="8116387">NewEncoder</span><span class="op" id="8116397">(</span><span class="ident" id="8116398">buf</span><span class="op" id="8116401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116404">err</span>&nbsp;<span class="op" id="8116408">:=</span>&nbsp;<span class="ident" id="8116411">enc</span><span class="op" id="8116414">.</span><span class="ident" id="8116415">Encode</span><span class="op" id="8116421">(</span><span class="ident" id="8116422">x</span><span class="op" id="8116423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116426">if</span>&nbsp;<span class="ident" id="8116429">err</span>&nbsp;<span class="op" id="8116433">==</span>&nbsp;<span class="ident" id="8116436">nil</span>&nbsp;<span class="op" id="8116440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116444">t</span><span class="op" id="8116445">.</span><span class="ident" id="8116446">Fatal</span><span class="op" id="8116451">(</span><span class="string" id="8116452">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8116484">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116490">buf</span><span class="op" id="8116493">.</span><span class="ident" id="8116494">Reset</span><span class="op" id="8116499">(</span><span class="op" id="8116500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116503">enc</span>&nbsp;<span class="op" id="8116507">=</span>&nbsp;<span class="ident" id="8116509">NewEncoder</span><span class="op" id="8116519">(</span><span class="ident" id="8116520">buf</span><span class="op" id="8116523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116526">err</span>&nbsp;<span class="op" id="8116530">=</span>&nbsp;<span class="ident" id="8116532">enc</span><span class="op" id="8116535">.</span><span class="ident" id="8116536">Encode</span><span class="op" id="8116542">(</span><span class="ident" id="8116543">x</span><span class="op" id="8116544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116547">if</span>&nbsp;<span class="ident" id="8116550">err</span>&nbsp;<span class="op" id="8116554">==</span>&nbsp;<span class="ident" id="8116557">nil</span>&nbsp;<span class="op" id="8116561">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116565">t</span><span class="op" id="8116566">.</span><span class="ident" id="8116567">Fatal</span><span class="op" id="8116572">(</span><span class="string" id="8116573">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="8116606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8116612">if</span>&nbsp;<span class="op" id="8116615">!</span><span class="ident" id="8116616">strings</span><span class="op" id="8116623">.</span><span class="ident" id="8116624">Contains</span><span class="op" id="8116632">(</span><span class="ident" id="8116633">err</span><span class="op" id="8116636">.</span><span class="ident" id="8116637">Error</span><span class="op" id="8116642">(</span><span class="op" id="8116643">)</span><span class="op" id="8116644">,</span>&nbsp;<span class="string" id="8116646">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="8116666">)</span>&nbsp;<span class="op" id="8116668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8116672">t</span><span class="op" id="8116673">.</span><span class="ident" id="8116674">Errorf</span><span class="op" id="8116680">(</span><span class="string" id="8116681">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8116730">,</span>&nbsp;<span class="ident" id="8116732">err</span><span class="op" id="8116735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8116738">}</span><br>
<span class="lineno">905</span><span class="op" id="8116740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8116743">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8116814">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="8116882">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="8116952">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8117022">type</span>&nbsp;<span class="ident" id="8117027">Z</span>&nbsp;<span class="keyword" id="8117029">struct</span>&nbsp;<span class="op" id="8117036">{</span><br>
<span class="lineno"></span><span class="op" id="8117038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="8117041">func</span>&nbsp;<span class="ident" id="8117046">Test29ElementSlice</span><span class="op" id="8117064">(</span><span class="ident" id="8117065">t</span>&nbsp;<span class="op" id="8117067">*</span><span class="ident" id="8117068">testing</span><span class="op" id="8117075">.</span><span class="ident" id="8117076">T</span><span class="op" id="8117077">)</span>&nbsp;<span class="op" id="8117079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117082">Register</span><span class="op" id="8117090">(</span><span class="ident" id="8117091">Z</span><span class="op" id="8117092">{</span><span class="op" id="8117093">}</span><span class="op" id="8117094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117097">src</span>&nbsp;<span class="op" id="8117101">:=</span>&nbsp;<span class="builtinfunc" id="8117104">make</span><span class="op" id="8117108">(</span><span class="op" id="8117109">[</span><span class="op" id="8117110">]</span><span class="keyword" id="8117111">interface</span><span class="op" id="8117120">{</span><span class="op" id="8117121">}</span><span class="op" id="8117122">,</span>&nbsp;<span class="num" id="8117124">100</span><span class="op" id="8117127">)</span>&nbsp;<span class="comment" id="8117129">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117187">for</span>&nbsp;<span class="ident" id="8117191">i</span>&nbsp;<span class="op" id="8117193">:=</span>&nbsp;<span class="keyword" id="8117196">range</span>&nbsp;<span class="ident" id="8117202">src</span>&nbsp;<span class="op" id="8117206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117210">src</span><span class="op" id="8117213">[</span><span class="ident" id="8117214">i</span><span class="op" id="8117215">]</span>&nbsp;<span class="op" id="8117217">=</span>&nbsp;<span class="ident" id="8117219">Z</span><span class="op" id="8117220">{</span><span class="op" id="8117221">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117227">buf</span>&nbsp;<span class="op" id="8117231">:=</span>&nbsp;<span class="builtinfunc" id="8117234">new</span><span class="op" id="8117237">(</span><span class="ident" id="8117238">bytes</span><span class="op" id="8117243">.</span><span class="ident" id="8117244">Buffer</span><span class="op" id="8117250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117253">err</span>&nbsp;<span class="op" id="8117257">:=</span>&nbsp;<span class="ident" id="8117260">NewEncoder</span><span class="op" id="8117270">(</span><span class="ident" id="8117271">buf</span><span class="op" id="8117274">)</span><span class="op" id="8117275">.</span><span class="ident" id="8117276">Encode</span><span class="op" id="8117282">(</span><span class="ident" id="8117283">src</span><span class="op" id="8117286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117289">if</span>&nbsp;<span class="ident" id="8117292">err</span>&nbsp;<span class="op" id="8117296">!=</span>&nbsp;<span class="ident" id="8117299">nil</span>&nbsp;<span class="op" id="8117303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117307">t</span><span class="op" id="8117308">.</span><span class="ident" id="8117309">Fatalf</span><span class="op" id="8117315">(</span><span class="string" id="8117316">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="8117328">,</span>&nbsp;<span class="ident" id="8117330">err</span><span class="op" id="8117333">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117337">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117349">var</span>&nbsp;<span class="ident" id="8117353">dst</span>&nbsp;<span class="op" id="8117357">[</span><span class="op" id="8117358">]</span><span class="keyword" id="8117359">interface</span><span class="op" id="8117368">{</span><span class="op" id="8117369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117372">err</span>&nbsp;<span class="op" id="8117376">=</span>&nbsp;<span class="ident" id="8117378">NewDecoder</span><span class="op" id="8117388">(</span><span class="ident" id="8117389">buf</span><span class="op" id="8117392">)</span><span class="op" id="8117393">.</span><span class="ident" id="8117394">Decode</span><span class="op" id="8117400">(</span><span class="op" id="8117401">&amp;</span><span class="ident" id="8117402">dst</span><span class="op" id="8117405">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117408">if</span>&nbsp;<span class="ident" id="8117411">err</span>&nbsp;<span class="op" id="8117415">!=</span>&nbsp;<span class="ident" id="8117418">nil</span>&nbsp;<span class="op" id="8117422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117426">t</span><span class="op" id="8117427">.</span><span class="ident" id="8117428">Errorf</span><span class="op" id="8117434">(</span><span class="string" id="8117435">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="8117447">,</span>&nbsp;<span class="ident" id="8117449">err</span><span class="op" id="8117452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117456">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117464">}</span><br>
<span class="lineno"></span><span class="op" id="8117466">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="8117469">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="8117531">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="8117546">func</span>&nbsp;<span class="ident" id="8117551">TestErrorForHugeSlice</span><span class="op" id="8117572">(</span><span class="ident" id="8117573">t</span>&nbsp;<span class="op" id="8117575">*</span><span class="ident" id="8117576">testing</span><span class="op" id="8117583">.</span><span class="ident" id="8117584">T</span><span class="op" id="8117585">)</span>&nbsp;<span class="op" id="8117587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8117590">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117615">buf</span>&nbsp;<span class="op" id="8117619">:=</span>&nbsp;<span class="builtinfunc" id="8117622">new</span><span class="op" id="8117625">(</span><span class="ident" id="8117626">bytes</span><span class="op" id="8117631">.</span><span class="ident" id="8117632">Buffer</span><span class="op" id="8117638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117641">slice</span>&nbsp;<span class="op" id="8117647">:=</span>&nbsp;<span class="op" id="8117650">[</span><span class="op" id="8117651">]</span><span class="builtintype" id="8117652">int</span><span class="op" id="8117655">{</span><span class="num" id="8117656">1</span><span class="op" id="8117657">,</span>&nbsp;<span class="num" id="8117659">1</span><span class="op" id="8117660">,</span>&nbsp;<span class="num" id="8117662">1</span><span class="op" id="8117663">,</span>&nbsp;<span class="num" id="8117665">1</span><span class="op" id="8117666">,</span>&nbsp;<span class="num" id="8117668">1</span><span class="op" id="8117669">,</span>&nbsp;<span class="num" id="8117671">1</span><span class="op" id="8117672">,</span>&nbsp;<span class="num" id="8117674">1</span><span class="op" id="8117675">,</span>&nbsp;<span class="num" id="8117677">1</span><span class="op" id="8117678">,</span>&nbsp;<span class="num" id="8117680">1</span><span class="op" id="8117681">,</span>&nbsp;<span class="num" id="8117683">1</span><span class="op" id="8117684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117687">err</span>&nbsp;<span class="op" id="8117691">:=</span>&nbsp;<span class="ident" id="8117694">NewEncoder</span><span class="op" id="8117704">(</span><span class="ident" id="8117705">buf</span><span class="op" id="8117708">)</span><span class="op" id="8117709">.</span><span class="ident" id="8117710">Encode</span><span class="op" id="8117716">(</span><span class="ident" id="8117717">slice</span><span class="op" id="8117722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117725">if</span>&nbsp;<span class="ident" id="8117728">err</span>&nbsp;<span class="op" id="8117732">!=</span>&nbsp;<span class="ident" id="8117735">nil</span>&nbsp;<span class="op" id="8117739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117743">t</span><span class="op" id="8117744">.</span><span class="ident" id="8117745">Fatal</span><span class="op" id="8117750">(</span><span class="string" id="8117751">&#34;encode:&#34;</span><span class="op" id="8117760">,</span>&nbsp;<span class="ident" id="8117762">err</span><span class="op" id="8117765">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8117768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8117771">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117854">buf</span><span class="op" id="8117857">.</span><span class="ident" id="8117858">Bytes</span><span class="op" id="8117863">(</span><span class="op" id="8117864">)</span><span class="op" id="8117865">[</span><span class="ident" id="8117866">buf</span><span class="op" id="8117869">.</span><span class="ident" id="8117870">Len</span><span class="op" id="8117873">(</span><span class="op" id="8117874">)</span><span class="op" id="8117875">-</span><span class="builtinfunc" id="8117876">len</span><span class="op" id="8117879">(</span><span class="ident" id="8117880">slice</span><span class="op" id="8117885">)</span><span class="op" id="8117886">-</span><span class="num" id="8117887">1</span><span class="op" id="8117888">]</span>&nbsp;<span class="op" id="8117890">=</span>&nbsp;<span class="num" id="8117892">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8117898">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117924">err</span>&nbsp;<span class="op" id="8117928">=</span>&nbsp;<span class="ident" id="8117930">NewDecoder</span><span class="op" id="8117940">(</span><span class="ident" id="8117941">buf</span><span class="op" id="8117944">)</span><span class="op" id="8117945">.</span><span class="ident" id="8117946">Decode</span><span class="op" id="8117952">(</span><span class="op" id="8117953">&amp;</span><span class="ident" id="8117954">slice</span><span class="op" id="8117959">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8117962">if</span>&nbsp;<span class="ident" id="8117965">err</span>&nbsp;<span class="op" id="8117969">==</span>&nbsp;<span class="ident" id="8117972">nil</span>&nbsp;<span class="op" id="8117976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8117980">t</span><span class="op" id="8117981">.</span><span class="ident" id="8117982">Fatal</span><span class="op" id="8117987">(</span><span class="string" id="8117988">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="8118006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8118012">if</span>&nbsp;<span class="op" id="8118015">!</span><span class="ident" id="8118016">strings</span><span class="op" id="8118023">.</span><span class="ident" id="8118024">Contains</span><span class="op" id="8118032">(</span><span class="ident" id="8118033">err</span><span class="op" id="8118036">.</span><span class="ident" id="8118037">Error</span><span class="op" id="8118042">(</span><span class="op" id="8118043">)</span><span class="op" id="8118044">,</span>&nbsp;<span class="string" id="8118046">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="8118061">)</span>&nbsp;<span class="op" id="8118063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8118067">t</span><span class="op" id="8118068">.</span><span class="ident" id="8118069">Fatal</span><span class="op" id="8118074">(</span><span class="string" id="8118075">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="8118121">,</span>&nbsp;<span class="ident" id="8118123">err</span><span class="op" id="8118126">.</span><span class="ident" id="8118127">Error</span><span class="op" id="8118132">(</span><span class="op" id="8118133">)</span><span class="op" id="8118134">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8118137">}</span><br>
<span class="lineno"></span><span class="op" id="8118139">}</span>
</div>
</body>
</html>
