<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6873267">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6873322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6873376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6873427">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6873477">package</span>&nbsp;<span class="ident" id="6873485">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6873490">import</span>&nbsp;<span class="op" id="6873497">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873500">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6873510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6873513">func</span>&nbsp;<span class="ident" id="6873518">TestRequest</span><span class="op" id="6873529">(</span><span class="ident" id="6873530">t</span>&nbsp;<span class="op" id="6873532">*</span><span class="ident" id="6873533">testing</span><span class="op" id="6873540">.</span><span class="ident" id="6873541">T</span><span class="op" id="6873542">)</span>&nbsp;<span class="op" id="6873544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6873547">env</span>&nbsp;<span class="op" id="6873551">:=</span>&nbsp;<span class="keyword" id="6873554">map</span><span class="op" id="6873557">[</span><span class="builtintype" id="6873558">string</span><span class="op" id="6873564">]</span><span class="builtintype" id="6873565">string</span><span class="op" id="6873571">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873575">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6873592">:</span>&nbsp;<span class="string" id="6873594">&#34;HTTP/1.1&#34;</span><span class="op" id="6873604">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873608">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6873624">:</span>&nbsp;&nbsp;<span class="string" id="6873627">&#34;GET&#34;</span><span class="op" id="6873632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873636">&#34;HTTP_HOST&#34;</span><span class="op" id="6873647">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6873655">&#34;example.com&#34;</span><span class="op" id="6873668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873672">&#34;HTTP_REFERER&#34;</span><span class="op" id="6873686">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6873691">&#34;elsewhere&#34;</span><span class="op" id="6873702">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873706">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="6873723">:</span>&nbsp;<span class="string" id="6873725">&#34;goclient&#34;</span><span class="op" id="6873735">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873739">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="6873753">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6873758">&#34;baz&#34;</span><span class="op" id="6873763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873767">&#34;REQUEST_URI&#34;</span><span class="op" id="6873780">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6873786">&#34;/path?a=b&#34;</span><span class="op" id="6873797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873801">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6873817">:</span>&nbsp;&nbsp;<span class="string" id="6873820">&#34;123&#34;</span><span class="op" id="6873825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873829">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6873843">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6873848">&#34;text/xml&#34;</span><span class="op" id="6873858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6873862">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6873875">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6873881">&#34;5.6.7.8&#34;</span><span class="op" id="6873890">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6873893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6873896">req</span><span class="op" id="6873899">,</span>&nbsp;<span class="ident" id="6873901">err</span>&nbsp;<span class="op" id="6873905">:=</span>&nbsp;<span class="ident" id="6873908">RequestFromMap</span><span class="op" id="6873922">(</span><span class="ident" id="6873923">env</span><span class="op" id="6873926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6873929">if</span>&nbsp;<span class="ident" id="6873932">err</span>&nbsp;<span class="op" id="6873936">!=</span>&nbsp;<span class="ident" id="6873939">nil</span>&nbsp;<span class="op" id="6873943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6873947">t</span><span class="op" id="6873948">.</span><span class="ident" id="6873949">Fatalf</span><span class="op" id="6873955">(</span><span class="string" id="6873956">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6873976">,</span>&nbsp;<span class="ident" id="6873978">err</span><span class="op" id="6873981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6873984">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6873987">if</span>&nbsp;<span class="ident" id="6873990">g</span><span class="op" id="6873991">,</span>&nbsp;<span class="ident" id="6873993">e</span>&nbsp;<span class="op" id="6873995">:=</span>&nbsp;<span class="ident" id="6873998">req</span><span class="op" id="6874001">.</span><span class="ident" id="6874002">UserAgent</span><span class="op" id="6874011">(</span><span class="op" id="6874012">)</span><span class="op" id="6874013">,</span>&nbsp;<span class="string" id="6874015">&#34;goclient&#34;</span><span class="op" id="6874025">;</span>&nbsp;<span class="ident" id="6874027">e</span>&nbsp;<span class="op" id="6874029">!=</span>&nbsp;<span class="ident" id="6874032">g</span>&nbsp;<span class="op" id="6874034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874038">t</span><span class="op" id="6874039">.</span><span class="ident" id="6874040">Errorf</span><span class="op" id="6874046">(</span><span class="string" id="6874047">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874078">,</span>&nbsp;<span class="ident" id="6874080">e</span><span class="op" id="6874081">,</span>&nbsp;<span class="ident" id="6874083">g</span><span class="op" id="6874084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874090">if</span>&nbsp;<span class="ident" id="6874093">g</span><span class="op" id="6874094">,</span>&nbsp;<span class="ident" id="6874096">e</span>&nbsp;<span class="op" id="6874098">:=</span>&nbsp;<span class="ident" id="6874101">req</span><span class="op" id="6874104">.</span><span class="ident" id="6874105">Method</span><span class="op" id="6874111">,</span>&nbsp;<span class="string" id="6874113">&#34;GET&#34;</span><span class="op" id="6874118">;</span>&nbsp;<span class="ident" id="6874120">e</span>&nbsp;<span class="op" id="6874122">!=</span>&nbsp;<span class="ident" id="6874125">g</span>&nbsp;<span class="op" id="6874127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874131">t</span><span class="op" id="6874132">.</span><span class="ident" id="6874133">Errorf</span><span class="op" id="6874139">(</span><span class="string" id="6874140">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874168">,</span>&nbsp;<span class="ident" id="6874170">e</span><span class="op" id="6874171">,</span>&nbsp;<span class="ident" id="6874173">g</span><span class="op" id="6874174">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874180">if</span>&nbsp;<span class="ident" id="6874183">g</span><span class="op" id="6874184">,</span>&nbsp;<span class="ident" id="6874186">e</span>&nbsp;<span class="op" id="6874188">:=</span>&nbsp;<span class="ident" id="6874191">req</span><span class="op" id="6874194">.</span><span class="ident" id="6874195">Header</span><span class="op" id="6874201">.</span><span class="ident" id="6874202">Get</span><span class="op" id="6874205">(</span><span class="string" id="6874206">&#34;Content-Type&#34;</span><span class="op" id="6874220">)</span><span class="op" id="6874221">,</span>&nbsp;<span class="string" id="6874223">&#34;text/xml&#34;</span><span class="op" id="6874233">;</span>&nbsp;<span class="ident" id="6874235">e</span>&nbsp;<span class="op" id="6874237">!=</span>&nbsp;<span class="ident" id="6874240">g</span>&nbsp;<span class="op" id="6874242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874246">t</span><span class="op" id="6874247">.</span><span class="ident" id="6874248">Errorf</span><span class="op" id="6874254">(</span><span class="string" id="6874255">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874289">,</span>&nbsp;<span class="ident" id="6874291">e</span><span class="op" id="6874292">,</span>&nbsp;<span class="ident" id="6874294">g</span><span class="op" id="6874295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874301">if</span>&nbsp;<span class="ident" id="6874304">g</span><span class="op" id="6874305">,</span>&nbsp;<span class="ident" id="6874307">e</span>&nbsp;<span class="op" id="6874309">:=</span>&nbsp;<span class="ident" id="6874312">req</span><span class="op" id="6874315">.</span><span class="ident" id="6874316">ContentLength</span><span class="op" id="6874329">,</span>&nbsp;<span class="ident" id="6874331">int64</span><span class="op" id="6874336">(</span><span class="num" id="6874337">123</span><span class="op" id="6874340">)</span><span class="op" id="6874341">;</span>&nbsp;<span class="ident" id="6874343">e</span>&nbsp;<span class="op" id="6874345">!=</span>&nbsp;<span class="ident" id="6874348">g</span>&nbsp;<span class="op" id="6874350">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874354">t</span><span class="op" id="6874355">.</span><span class="ident" id="6874356">Errorf</span><span class="op" id="6874362">(</span><span class="string" id="6874363">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6874398">,</span>&nbsp;<span class="ident" id="6874400">e</span><span class="op" id="6874401">,</span>&nbsp;<span class="ident" id="6874403">g</span><span class="op" id="6874404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874410">if</span>&nbsp;<span class="ident" id="6874413">g</span><span class="op" id="6874414">,</span>&nbsp;<span class="ident" id="6874416">e</span>&nbsp;<span class="op" id="6874418">:=</span>&nbsp;<span class="ident" id="6874421">req</span><span class="op" id="6874424">.</span><span class="ident" id="6874425">Referer</span><span class="op" id="6874432">(</span><span class="op" id="6874433">)</span><span class="op" id="6874434">,</span>&nbsp;<span class="string" id="6874436">&#34;elsewhere&#34;</span><span class="op" id="6874447">;</span>&nbsp;<span class="ident" id="6874449">e</span>&nbsp;<span class="op" id="6874451">!=</span>&nbsp;<span class="ident" id="6874454">g</span>&nbsp;<span class="op" id="6874456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874460">t</span><span class="op" id="6874461">.</span><span class="ident" id="6874462">Errorf</span><span class="op" id="6874468">(</span><span class="string" id="6874469">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874498">,</span>&nbsp;<span class="ident" id="6874500">e</span><span class="op" id="6874501">,</span>&nbsp;<span class="ident" id="6874503">g</span><span class="op" id="6874504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874507">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874510">if</span>&nbsp;<span class="ident" id="6874513">req</span><span class="op" id="6874516">.</span><span class="ident" id="6874517">Header</span>&nbsp;<span class="op" id="6874524">==</span>&nbsp;<span class="ident" id="6874527">nil</span>&nbsp;<span class="op" id="6874531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874535">t</span><span class="op" id="6874536">.</span><span class="ident" id="6874537">Fatalf</span><span class="op" id="6874543">(</span><span class="string" id="6874544">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="6874567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874573">if</span>&nbsp;<span class="ident" id="6874576">g</span><span class="op" id="6874577">,</span>&nbsp;<span class="ident" id="6874579">e</span>&nbsp;<span class="op" id="6874581">:=</span>&nbsp;<span class="ident" id="6874584">req</span><span class="op" id="6874587">.</span><span class="ident" id="6874588">Header</span><span class="op" id="6874594">.</span><span class="ident" id="6874595">Get</span><span class="op" id="6874598">(</span><span class="string" id="6874599">&#34;Foo-Bar&#34;</span><span class="op" id="6874608">)</span><span class="op" id="6874609">,</span>&nbsp;<span class="string" id="6874611">&#34;baz&#34;</span><span class="op" id="6874616">;</span>&nbsp;<span class="ident" id="6874618">e</span>&nbsp;<span class="op" id="6874620">!=</span>&nbsp;<span class="ident" id="6874623">g</span>&nbsp;<span class="op" id="6874625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874629">t</span><span class="op" id="6874630">.</span><span class="ident" id="6874631">Errorf</span><span class="op" id="6874637">(</span><span class="string" id="6874638">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874667">,</span>&nbsp;<span class="ident" id="6874669">e</span><span class="op" id="6874670">,</span>&nbsp;<span class="ident" id="6874672">g</span><span class="op" id="6874673">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874679">if</span>&nbsp;<span class="ident" id="6874682">g</span><span class="op" id="6874683">,</span>&nbsp;<span class="ident" id="6874685">e</span>&nbsp;<span class="op" id="6874687">:=</span>&nbsp;<span class="ident" id="6874690">req</span><span class="op" id="6874693">.</span><span class="ident" id="6874694">URL</span><span class="op" id="6874697">.</span><span class="ident" id="6874698">String</span><span class="op" id="6874704">(</span><span class="op" id="6874705">)</span><span class="op" id="6874706">,</span>&nbsp;<span class="string" id="6874708">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="6874737">;</span>&nbsp;<span class="ident" id="6874739">e</span>&nbsp;<span class="op" id="6874741">!=</span>&nbsp;<span class="ident" id="6874744">g</span>&nbsp;<span class="op" id="6874746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874750">t</span><span class="op" id="6874751">.</span><span class="ident" id="6874752">Errorf</span><span class="op" id="6874758">(</span><span class="string" id="6874759">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874784">,</span>&nbsp;<span class="ident" id="6874786">e</span><span class="op" id="6874787">,</span>&nbsp;<span class="ident" id="6874789">g</span><span class="op" id="6874790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874796">if</span>&nbsp;<span class="ident" id="6874799">g</span><span class="op" id="6874800">,</span>&nbsp;<span class="ident" id="6874802">e</span>&nbsp;<span class="op" id="6874804">:=</span>&nbsp;<span class="ident" id="6874807">req</span><span class="op" id="6874810">.</span><span class="ident" id="6874811">FormValue</span><span class="op" id="6874820">(</span><span class="string" id="6874821">&#34;a&#34;</span><span class="op" id="6874824">)</span><span class="op" id="6874825">,</span>&nbsp;<span class="string" id="6874827">&#34;b&#34;</span><span class="op" id="6874830">;</span>&nbsp;<span class="ident" id="6874832">e</span>&nbsp;<span class="op" id="6874834">!=</span>&nbsp;<span class="ident" id="6874837">g</span>&nbsp;<span class="op" id="6874839">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874843">t</span><span class="op" id="6874844">.</span><span class="ident" id="6874845">Errorf</span><span class="op" id="6874851">(</span><span class="string" id="6874852">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6874886">,</span>&nbsp;<span class="ident" id="6874888">e</span><span class="op" id="6874889">,</span>&nbsp;<span class="ident" id="6874891">g</span><span class="op" id="6874892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874898">if</span>&nbsp;<span class="ident" id="6874901">req</span><span class="op" id="6874904">.</span><span class="ident" id="6874905">Trailer</span>&nbsp;<span class="op" id="6874913">==</span>&nbsp;<span class="ident" id="6874916">nil</span>&nbsp;<span class="op" id="6874920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874924">t</span><span class="op" id="6874925">.</span><span class="ident" id="6874926">Errorf</span><span class="op" id="6874932">(</span><span class="string" id="6874933">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="6874957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6874960">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6874963">if</span>&nbsp;<span class="ident" id="6874966">req</span><span class="op" id="6874969">.</span><span class="ident" id="6874970">TLS</span>&nbsp;<span class="op" id="6874974">!=</span>&nbsp;<span class="ident" id="6874977">nil</span>&nbsp;<span class="op" id="6874981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6874985">t</span><span class="op" id="6874986">.</span><span class="ident" id="6874987">Errorf</span><span class="op" id="6874993">(</span><span class="string" id="6874994">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="6875012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6875018">if</span>&nbsp;<span class="ident" id="6875021">e</span><span class="op" id="6875022">,</span>&nbsp;<span class="ident" id="6875024">g</span>&nbsp;<span class="op" id="6875026">:=</span>&nbsp;<span class="string" id="6875029">&#34;5.6.7.8:0&#34;</span><span class="op" id="6875040">,</span>&nbsp;<span class="ident" id="6875042">req</span><span class="op" id="6875045">.</span><span class="ident" id="6875046">RemoteAddr</span><span class="op" id="6875056">;</span>&nbsp;<span class="ident" id="6875058">e</span>&nbsp;<span class="op" id="6875060">!=</span>&nbsp;<span class="ident" id="6875063">g</span>&nbsp;<span class="op" id="6875065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875069">t</span><span class="op" id="6875070">.</span><span class="ident" id="6875071">Errorf</span><span class="op" id="6875077">(</span><span class="string" id="6875078">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6875107">,</span>&nbsp;<span class="ident" id="6875109">g</span><span class="op" id="6875110">,</span>&nbsp;<span class="ident" id="6875112">e</span><span class="op" id="6875113">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875116">}</span><br>
<span class="lineno"></span><span class="op" id="6875118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6875121">func</span>&nbsp;<span class="ident" id="6875126">TestRequestWithTLS</span><span class="op" id="6875144">(</span><span class="ident" id="6875145">t</span>&nbsp;<span class="op" id="6875147">*</span><span class="ident" id="6875148">testing</span><span class="op" id="6875155">.</span><span class="ident" id="6875156">T</span><span class="op" id="6875157">)</span>&nbsp;<span class="op" id="6875159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875162">env</span>&nbsp;<span class="op" id="6875166">:=</span>&nbsp;<span class="keyword" id="6875169">map</span><span class="op" id="6875172">[</span><span class="builtintype" id="6875173">string</span><span class="op" id="6875179">]</span><span class="builtintype" id="6875180">string</span><span class="op" id="6875186">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875190">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6875207">:</span>&nbsp;<span class="string" id="6875209">&#34;HTTP/1.1&#34;</span><span class="op" id="6875219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875223">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6875239">:</span>&nbsp;&nbsp;<span class="string" id="6875242">&#34;GET&#34;</span><span class="op" id="6875247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875251">&#34;HTTP_HOST&#34;</span><span class="op" id="6875262">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875270">&#34;example.com&#34;</span><span class="op" id="6875283">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875287">&#34;HTTP_REFERER&#34;</span><span class="op" id="6875301">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875306">&#34;elsewhere&#34;</span><span class="op" id="6875317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875321">&#34;REQUEST_URI&#34;</span><span class="op" id="6875334">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875340">&#34;/path?a=b&#34;</span><span class="op" id="6875351">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875355">&#34;CONTENT_TYPE&#34;</span><span class="op" id="6875369">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875374">&#34;text/xml&#34;</span><span class="op" id="6875384">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875388">&#34;HTTPS&#34;</span><span class="op" id="6875395">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875407">&#34;1&#34;</span><span class="op" id="6875410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875414">&#34;REMOTE_ADDR&#34;</span><span class="op" id="6875427">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875433">&#34;5.6.7.8&#34;</span><span class="op" id="6875442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875448">req</span><span class="op" id="6875451">,</span>&nbsp;<span class="ident" id="6875453">err</span>&nbsp;<span class="op" id="6875457">:=</span>&nbsp;<span class="ident" id="6875460">RequestFromMap</span><span class="op" id="6875474">(</span><span class="ident" id="6875475">env</span><span class="op" id="6875478">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6875481">if</span>&nbsp;<span class="ident" id="6875484">err</span>&nbsp;<span class="op" id="6875488">!=</span>&nbsp;<span class="ident" id="6875491">nil</span>&nbsp;<span class="op" id="6875495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875499">t</span><span class="op" id="6875500">.</span><span class="ident" id="6875501">Fatalf</span><span class="op" id="6875507">(</span><span class="string" id="6875508">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6875528">,</span>&nbsp;<span class="ident" id="6875530">err</span><span class="op" id="6875533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6875539">if</span>&nbsp;<span class="ident" id="6875542">g</span><span class="op" id="6875543">,</span>&nbsp;<span class="ident" id="6875545">e</span>&nbsp;<span class="op" id="6875547">:=</span>&nbsp;<span class="ident" id="6875550">req</span><span class="op" id="6875553">.</span><span class="ident" id="6875554">URL</span><span class="op" id="6875557">.</span><span class="ident" id="6875558">String</span><span class="op" id="6875564">(</span><span class="op" id="6875565">)</span><span class="op" id="6875566">,</span>&nbsp;<span class="string" id="6875568">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="6875598">;</span>&nbsp;<span class="ident" id="6875600">e</span>&nbsp;<span class="op" id="6875602">!=</span>&nbsp;<span class="ident" id="6875605">g</span>&nbsp;<span class="op" id="6875607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875611">t</span><span class="op" id="6875612">.</span><span class="ident" id="6875613">Errorf</span><span class="op" id="6875619">(</span><span class="string" id="6875620">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6875645">,</span>&nbsp;<span class="ident" id="6875647">e</span><span class="op" id="6875648">,</span>&nbsp;<span class="ident" id="6875650">g</span><span class="op" id="6875651">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6875657">if</span>&nbsp;<span class="ident" id="6875660">req</span><span class="op" id="6875663">.</span><span class="ident" id="6875664">TLS</span>&nbsp;<span class="op" id="6875668">==</span>&nbsp;<span class="ident" id="6875671">nil</span>&nbsp;<span class="op" id="6875675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875679">t</span><span class="op" id="6875680">.</span><span class="ident" id="6875681">Errorf</span><span class="op" id="6875687">(</span><span class="string" id="6875688">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="6875710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875713">}</span><br>
<span class="lineno"></span><span class="op" id="6875715">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="6875718">func</span>&nbsp;<span class="ident" id="6875723">TestRequestWithoutHost</span><span class="op" id="6875745">(</span><span class="ident" id="6875746">t</span>&nbsp;<span class="op" id="6875748">*</span><span class="ident" id="6875749">testing</span><span class="op" id="6875756">.</span><span class="ident" id="6875757">T</span><span class="op" id="6875758">)</span>&nbsp;<span class="op" id="6875760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875763">env</span>&nbsp;<span class="op" id="6875767">:=</span>&nbsp;<span class="keyword" id="6875770">map</span><span class="op" id="6875773">[</span><span class="builtintype" id="6875774">string</span><span class="op" id="6875780">]</span><span class="builtintype" id="6875781">string</span><span class="op" id="6875787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875791">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6875808">:</span>&nbsp;<span class="string" id="6875810">&#34;HTTP/1.1&#34;</span><span class="op" id="6875820">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875824">&#34;HTTP_HOST&#34;</span><span class="op" id="6875835">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875843">&#34;&#34;</span><span class="op" id="6875845">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875849">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6875865">:</span>&nbsp;&nbsp;<span class="string" id="6875868">&#34;GET&#34;</span><span class="op" id="6875873">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875877">&#34;REQUEST_URI&#34;</span><span class="op" id="6875890">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6875896">&#34;/path?a=b&#34;</span><span class="op" id="6875907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6875911">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6875927">:</span>&nbsp;&nbsp;<span class="string" id="6875930">&#34;123&#34;</span><span class="op" id="6875935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6875938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875941">req</span><span class="op" id="6875944">,</span>&nbsp;<span class="ident" id="6875946">err</span>&nbsp;<span class="op" id="6875950">:=</span>&nbsp;<span class="ident" id="6875953">RequestFromMap</span><span class="op" id="6875967">(</span><span class="ident" id="6875968">env</span><span class="op" id="6875971">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6875974">if</span>&nbsp;<span class="ident" id="6875977">err</span>&nbsp;<span class="op" id="6875981">!=</span>&nbsp;<span class="ident" id="6875984">nil</span>&nbsp;<span class="op" id="6875988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6875992">t</span><span class="op" id="6875993">.</span><span class="ident" id="6875994">Fatalf</span><span class="op" id="6876000">(</span><span class="string" id="6876001">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6876021">,</span>&nbsp;<span class="ident" id="6876023">err</span><span class="op" id="6876026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6876032">if</span>&nbsp;<span class="ident" id="6876035">req</span><span class="op" id="6876038">.</span><span class="ident" id="6876039">URL</span>&nbsp;<span class="op" id="6876043">==</span>&nbsp;<span class="ident" id="6876046">nil</span>&nbsp;<span class="op" id="6876050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876054">t</span><span class="op" id="6876055">.</span><span class="ident" id="6876056">Fatalf</span><span class="op" id="6876062">(</span><span class="string" id="6876063">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6876083">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6876089">if</span>&nbsp;<span class="ident" id="6876092">g</span><span class="op" id="6876093">,</span>&nbsp;<span class="ident" id="6876095">e</span>&nbsp;<span class="op" id="6876097">:=</span>&nbsp;<span class="ident" id="6876100">req</span><span class="op" id="6876103">.</span><span class="ident" id="6876104">URL</span><span class="op" id="6876107">.</span><span class="ident" id="6876108">String</span><span class="op" id="6876114">(</span><span class="op" id="6876115">)</span><span class="op" id="6876116">,</span>&nbsp;<span class="string" id="6876118">&#34;/path?a=b&#34;</span><span class="op" id="6876129">;</span>&nbsp;<span class="ident" id="6876131">e</span>&nbsp;<span class="op" id="6876133">!=</span>&nbsp;<span class="ident" id="6876136">g</span>&nbsp;<span class="op" id="6876138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876142">t</span><span class="op" id="6876143">.</span><span class="ident" id="6876144">Errorf</span><span class="op" id="6876150">(</span><span class="string" id="6876151">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6876170">,</span>&nbsp;<span class="ident" id="6876172">g</span><span class="op" id="6876173">,</span>&nbsp;<span class="ident" id="6876175">e</span><span class="op" id="6876176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876179">}</span><br>
<span class="lineno"></span><span class="op" id="6876181">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="6876184">func</span>&nbsp;<span class="ident" id="6876189">TestRequestWithoutRequestURI</span><span class="op" id="6876217">(</span><span class="ident" id="6876218">t</span>&nbsp;<span class="op" id="6876220">*</span><span class="ident" id="6876221">testing</span><span class="op" id="6876228">.</span><span class="ident" id="6876229">T</span><span class="op" id="6876230">)</span>&nbsp;<span class="op" id="6876232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876235">env</span>&nbsp;<span class="op" id="6876239">:=</span>&nbsp;<span class="keyword" id="6876242">map</span><span class="op" id="6876245">[</span><span class="builtintype" id="6876246">string</span><span class="op" id="6876252">]</span><span class="builtintype" id="6876253">string</span><span class="op" id="6876259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876263">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="6876280">:</span>&nbsp;<span class="string" id="6876282">&#34;HTTP/1.1&#34;</span><span class="op" id="6876292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876296">&#34;HTTP_HOST&#34;</span><span class="op" id="6876307">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876315">&#34;example.com&#34;</span><span class="op" id="6876328">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876332">&#34;REQUEST_METHOD&#34;</span><span class="op" id="6876348">:</span>&nbsp;&nbsp;<span class="string" id="6876351">&#34;GET&#34;</span><span class="op" id="6876356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876360">&#34;SCRIPT_NAME&#34;</span><span class="op" id="6876373">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876379">&#34;/dir/scriptname&#34;</span><span class="op" id="6876396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876400">&#34;PATH_INFO&#34;</span><span class="op" id="6876411">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876419">&#34;/p1/p2&#34;</span><span class="op" id="6876427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876431">&#34;QUERY_STRING&#34;</span><span class="op" id="6876445">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6876450">&#34;a=1&amp;b=2&#34;</span><span class="op" id="6876459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6876463">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="6876479">:</span>&nbsp;&nbsp;<span class="string" id="6876482">&#34;123&#34;</span><span class="op" id="6876487">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876493">req</span><span class="op" id="6876496">,</span>&nbsp;<span class="ident" id="6876498">err</span>&nbsp;<span class="op" id="6876502">:=</span>&nbsp;<span class="ident" id="6876505">RequestFromMap</span><span class="op" id="6876519">(</span><span class="ident" id="6876520">env</span><span class="op" id="6876523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6876526">if</span>&nbsp;<span class="ident" id="6876529">err</span>&nbsp;<span class="op" id="6876533">!=</span>&nbsp;<span class="ident" id="6876536">nil</span>&nbsp;<span class="op" id="6876540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876544">t</span><span class="op" id="6876545">.</span><span class="ident" id="6876546">Fatalf</span><span class="op" id="6876552">(</span><span class="string" id="6876553">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="6876573">,</span>&nbsp;<span class="ident" id="6876575">err</span><span class="op" id="6876578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876581">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6876584">if</span>&nbsp;<span class="ident" id="6876587">req</span><span class="op" id="6876590">.</span><span class="ident" id="6876591">URL</span>&nbsp;<span class="op" id="6876595">==</span>&nbsp;<span class="ident" id="6876598">nil</span>&nbsp;<span class="op" id="6876602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876606">t</span><span class="op" id="6876607">.</span><span class="ident" id="6876608">Fatalf</span><span class="op" id="6876614">(</span><span class="string" id="6876615">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="6876635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6876641">if</span>&nbsp;<span class="ident" id="6876644">g</span><span class="op" id="6876645">,</span>&nbsp;<span class="ident" id="6876647">e</span>&nbsp;<span class="op" id="6876649">:=</span>&nbsp;<span class="ident" id="6876652">req</span><span class="op" id="6876655">.</span><span class="ident" id="6876656">URL</span><span class="op" id="6876659">.</span><span class="ident" id="6876660">String</span><span class="op" id="6876666">(</span><span class="op" id="6876667">)</span><span class="op" id="6876668">,</span>&nbsp;<span class="string" id="6876670">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="6876719">;</span>&nbsp;<span class="ident" id="6876721">e</span>&nbsp;<span class="op" id="6876723">!=</span>&nbsp;<span class="ident" id="6876726">g</span>&nbsp;<span class="op" id="6876728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6876732">t</span><span class="op" id="6876733">.</span><span class="ident" id="6876734">Errorf</span><span class="op" id="6876740">(</span><span class="string" id="6876741">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6876760">,</span>&nbsp;<span class="ident" id="6876762">g</span><span class="op" id="6876763">,</span>&nbsp;<span class="ident" id="6876765">e</span><span class="op" id="6876766">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6876769">}</span><br>
<span class="lineno"></span><span class="op" id="6876771">}</span>
</div>
</body>
</html>
