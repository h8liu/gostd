<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html" class="current">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4912021">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4912076">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4912130">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4912181">package</span>&nbsp;<span class="ident" id="4912189">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4912195">import</span>&nbsp;<span class="op" id="4912202">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4912205">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="4912213">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4912216">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="4912276">func</span>&nbsp;<span class="op" id="4912281">(</span><span class="ident" id="4912282">d</span>&nbsp;<span class="op" id="4912284">*</span><span class="ident" id="4912285">decoder</span><span class="op" id="4912292">)</span>&nbsp;<span class="ident" id="4912294">makeImg</span><span class="op" id="4912301">(</span><span class="ident" id="4912302">h0</span><span class="op" id="4912304">,</span>&nbsp;<span class="ident" id="4912306">v0</span><span class="op" id="4912308">,</span>&nbsp;<span class="ident" id="4912310">mxx</span><span class="op" id="4912313">,</span>&nbsp;<span class="ident" id="4912315">myy</span>&nbsp;<span class="builtintype" id="4912319">int</span><span class="op" id="4912322">)</span>&nbsp;<span class="op" id="4912324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912327">if</span>&nbsp;<span class="ident" id="4912330">d</span><span class="op" id="4912331">.</span><span class="ident" id="4912332">nComp</span>&nbsp;<span class="op" id="4912338">==</span>&nbsp;<span class="ident" id="4912341">nGrayComponent</span>&nbsp;<span class="op" id="4912356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912360">m</span>&nbsp;<span class="op" id="4912362">:=</span>&nbsp;<span class="ident" id="4912365">image</span><span class="op" id="4912370">.</span><span class="ident" id="4912371">NewGray</span><span class="op" id="4912378">(</span><span class="ident" id="4912379">image</span><span class="op" id="4912384">.</span><span class="ident" id="4912385">Rect</span><span class="op" id="4912389">(</span><span class="num" id="4912390">0</span><span class="op" id="4912391">,</span>&nbsp;<span class="num" id="4912393">0</span><span class="op" id="4912394">,</span>&nbsp;<span class="num" id="4912396">8</span><span class="op" id="4912397">*</span><span class="ident" id="4912398">mxx</span><span class="op" id="4912401">,</span>&nbsp;<span class="num" id="4912403">8</span><span class="op" id="4912404">*</span><span class="ident" id="4912405">myy</span><span class="op" id="4912408">)</span><span class="op" id="4912409">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912413">d</span><span class="op" id="4912414">.</span><span class="ident" id="4912415">img1</span>&nbsp;<span class="op" id="4912420">=</span>&nbsp;<span class="ident" id="4912422">m</span><span class="op" id="4912423">.</span><span class="ident" id="4912424">SubImage</span><span class="op" id="4912432">(</span><span class="ident" id="4912433">image</span><span class="op" id="4912438">.</span><span class="ident" id="4912439">Rect</span><span class="op" id="4912443">(</span><span class="num" id="4912444">0</span><span class="op" id="4912445">,</span>&nbsp;<span class="num" id="4912447">0</span><span class="op" id="4912448">,</span>&nbsp;<span class="ident" id="4912450">d</span><span class="op" id="4912451">.</span><span class="ident" id="4912452">width</span><span class="op" id="4912457">,</span>&nbsp;<span class="ident" id="4912459">d</span><span class="op" id="4912460">.</span><span class="ident" id="4912461">height</span><span class="op" id="4912467">)</span><span class="op" id="4912468">)</span><span class="op" id="4912469">.</span><span class="op" id="4912470">(</span><span class="op" id="4912471">*</span><span class="ident" id="4912472">image</span><span class="op" id="4912477">.</span><span class="ident" id="4912478">Gray</span><span class="op" id="4912482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912486">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912497">var</span>&nbsp;<span class="ident" id="4912501">subsampleRatio</span>&nbsp;<span class="ident" id="4912516">image</span><span class="op" id="4912521">.</span><span class="ident" id="4912522">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912543">switch</span>&nbsp;<span class="op" id="4912550">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912553">case</span>&nbsp;<span class="ident" id="4912558">h0</span>&nbsp;<span class="op" id="4912561">==</span>&nbsp;<span class="num" id="4912564">1</span>&nbsp;<span class="op" id="4912566">&amp;&amp;</span>&nbsp;<span class="ident" id="4912569">v0</span>&nbsp;<span class="op" id="4912572">==</span>&nbsp;<span class="num" id="4912575">1</span><span class="op" id="4912576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912580">subsampleRatio</span>&nbsp;<span class="op" id="4912595">=</span>&nbsp;<span class="ident" id="4912597">image</span><span class="op" id="4912602">.</span><span class="ident" id="4912603">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912627">case</span>&nbsp;<span class="ident" id="4912632">h0</span>&nbsp;<span class="op" id="4912635">==</span>&nbsp;<span class="num" id="4912638">1</span>&nbsp;<span class="op" id="4912640">&amp;&amp;</span>&nbsp;<span class="ident" id="4912643">v0</span>&nbsp;<span class="op" id="4912646">==</span>&nbsp;<span class="num" id="4912649">2</span><span class="op" id="4912650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912654">subsampleRatio</span>&nbsp;<span class="op" id="4912669">=</span>&nbsp;<span class="ident" id="4912671">image</span><span class="op" id="4912676">.</span><span class="ident" id="4912677">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912701">case</span>&nbsp;<span class="ident" id="4912706">h0</span>&nbsp;<span class="op" id="4912709">==</span>&nbsp;<span class="num" id="4912712">2</span>&nbsp;<span class="op" id="4912714">&amp;&amp;</span>&nbsp;<span class="ident" id="4912717">v0</span>&nbsp;<span class="op" id="4912720">==</span>&nbsp;<span class="num" id="4912723">1</span><span class="op" id="4912724">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912728">subsampleRatio</span>&nbsp;<span class="op" id="4912743">=</span>&nbsp;<span class="ident" id="4912745">image</span><span class="op" id="4912750">.</span><span class="ident" id="4912751">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912775">case</span>&nbsp;<span class="ident" id="4912780">h0</span>&nbsp;<span class="op" id="4912783">==</span>&nbsp;<span class="num" id="4912786">2</span>&nbsp;<span class="op" id="4912788">&amp;&amp;</span>&nbsp;<span class="ident" id="4912791">v0</span>&nbsp;<span class="op" id="4912794">==</span>&nbsp;<span class="num" id="4912797">2</span><span class="op" id="4912798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912802">subsampleRatio</span>&nbsp;<span class="op" id="4912817">=</span>&nbsp;<span class="ident" id="4912819">image</span><span class="op" id="4912824">.</span><span class="ident" id="4912825">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4912849">default</span><span class="op" id="4912856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4912860">panic</span><span class="op" id="4912865">(</span><span class="string" id="4912866">&#34;unreachable&#34;</span><span class="op" id="4912879">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4912882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912885">m</span>&nbsp;<span class="op" id="4912887">:=</span>&nbsp;<span class="ident" id="4912890">image</span><span class="op" id="4912895">.</span><span class="ident" id="4912896">NewYCbCr</span><span class="op" id="4912904">(</span><span class="ident" id="4912905">image</span><span class="op" id="4912910">.</span><span class="ident" id="4912911">Rect</span><span class="op" id="4912915">(</span><span class="num" id="4912916">0</span><span class="op" id="4912917">,</span>&nbsp;<span class="num" id="4912919">0</span><span class="op" id="4912920">,</span>&nbsp;<span class="num" id="4912922">8</span><span class="op" id="4912923">*</span><span class="ident" id="4912924">h0</span><span class="op" id="4912926">*</span><span class="ident" id="4912927">mxx</span><span class="op" id="4912930">,</span>&nbsp;<span class="num" id="4912932">8</span><span class="op" id="4912933">*</span><span class="ident" id="4912934">v0</span><span class="op" id="4912936">*</span><span class="ident" id="4912937">myy</span><span class="op" id="4912940">)</span><span class="op" id="4912941">,</span>&nbsp;<span class="ident" id="4912943">subsampleRatio</span><span class="op" id="4912957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4912960">d</span><span class="op" id="4912961">.</span><span class="ident" id="4912962">img3</span>&nbsp;<span class="op" id="4912967">=</span>&nbsp;<span class="ident" id="4912969">m</span><span class="op" id="4912970">.</span><span class="ident" id="4912971">SubImage</span><span class="op" id="4912979">(</span><span class="ident" id="4912980">image</span><span class="op" id="4912985">.</span><span class="ident" id="4912986">Rect</span><span class="op" id="4912990">(</span><span class="num" id="4912991">0</span><span class="op" id="4912992">,</span>&nbsp;<span class="num" id="4912994">0</span><span class="op" id="4912995">,</span>&nbsp;<span class="ident" id="4912997">d</span><span class="op" id="4912998">.</span><span class="ident" id="4912999">width</span><span class="op" id="4913004">,</span>&nbsp;<span class="ident" id="4913006">d</span><span class="op" id="4913007">.</span><span class="ident" id="4913008">height</span><span class="op" id="4913014">)</span><span class="op" id="4913015">)</span><span class="op" id="4913016">.</span><span class="op" id="4913017">(</span><span class="op" id="4913018">*</span><span class="ident" id="4913019">image</span><span class="op" id="4913024">.</span><span class="ident" id="4913025">YCbCr</span><span class="op" id="4913030">)</span><br>
<span class="lineno"></span><span class="op" id="4913032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4913035">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="4913066">func</span>&nbsp;<span class="op" id="4913071">(</span><span class="ident" id="4913072">d</span>&nbsp;<span class="op" id="4913074">*</span><span class="ident" id="4913075">decoder</span><span class="op" id="4913082">)</span>&nbsp;<span class="ident" id="4913084">processSOS</span><span class="op" id="4913094">(</span><span class="ident" id="4913095">n</span>&nbsp;<span class="builtintype" id="4913097">int</span><span class="op" id="4913100">)</span>&nbsp;<span class="builtintype" id="4913102">error</span>&nbsp;<span class="op" id="4913108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913111">if</span>&nbsp;<span class="ident" id="4913114">d</span><span class="op" id="4913115">.</span><span class="ident" id="4913116">nComp</span>&nbsp;<span class="op" id="4913122">==</span>&nbsp;<span class="num" id="4913125">0</span>&nbsp;<span class="op" id="4913127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913131">return</span>&nbsp;<span class="ident" id="4913138">FormatError</span><span class="op" id="4913149">(</span><span class="string" id="4913150">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="4913170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913173">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913176">if</span>&nbsp;<span class="ident" id="4913179">n</span>&nbsp;<span class="op" id="4913181">&lt;</span>&nbsp;<span class="num" id="4913183">6</span>&nbsp;<span class="op" id="4913185">||</span>&nbsp;<span class="num" id="4913188">4</span><span class="op" id="4913189">+</span><span class="num" id="4913190">2</span><span class="op" id="4913191">*</span><span class="ident" id="4913192">d</span><span class="op" id="4913193">.</span><span class="ident" id="4913194">nComp</span>&nbsp;<span class="op" id="4913200">&lt;</span>&nbsp;<span class="ident" id="4913202">n</span>&nbsp;<span class="op" id="4913204">||</span>&nbsp;<span class="ident" id="4913207">n</span><span class="op" id="4913208">%</span><span class="num" id="4913209">2</span>&nbsp;<span class="op" id="4913211">!=</span>&nbsp;<span class="num" id="4913214">0</span>&nbsp;<span class="op" id="4913216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913220">return</span>&nbsp;<span class="ident" id="4913227">FormatError</span><span class="op" id="4913238">(</span><span class="string" id="4913239">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="4913261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913267">if</span>&nbsp;<span class="ident" id="4913270">err</span>&nbsp;<span class="op" id="4913274">:=</span>&nbsp;<span class="ident" id="4913277">d</span><span class="op" id="4913278">.</span><span class="ident" id="4913279">readFull</span><span class="op" id="4913287">(</span><span class="ident" id="4913288">d</span><span class="op" id="4913289">.</span><span class="ident" id="4913290">tmp</span><span class="op" id="4913293">[</span><span class="op" id="4913294">:</span><span class="ident" id="4913295">n</span><span class="op" id="4913296">]</span><span class="op" id="4913297">)</span><span class="op" id="4913298">;</span>&nbsp;<span class="ident" id="4913300">err</span>&nbsp;<span class="op" id="4913304">!=</span>&nbsp;<span class="builtintype" id="4913307">nil</span>&nbsp;<span class="op" id="4913311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913315">return</span>&nbsp;<span class="ident" id="4913322">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913330">nComp</span>&nbsp;<span class="op" id="4913336">:=</span>&nbsp;<span class="builtintype" id="4913339">int</span><span class="op" id="4913342">(</span><span class="ident" id="4913343">d</span><span class="op" id="4913344">.</span><span class="ident" id="4913345">tmp</span><span class="op" id="4913348">[</span><span class="num" id="4913349">0</span><span class="op" id="4913350">]</span><span class="op" id="4913351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913354">if</span>&nbsp;<span class="ident" id="4913357">n</span>&nbsp;<span class="op" id="4913359">!=</span>&nbsp;<span class="num" id="4913362">4</span><span class="op" id="4913363">+</span><span class="num" id="4913364">2</span><span class="op" id="4913365">*</span><span class="ident" id="4913366">nComp</span>&nbsp;<span class="op" id="4913372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913376">return</span>&nbsp;<span class="ident" id="4913383">FormatError</span><span class="op" id="4913394">(</span><span class="string" id="4913395">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="4913446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913449">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913452">var</span>&nbsp;<span class="ident" id="4913456">scan</span>&nbsp;<span class="op" id="4913461">[</span><span class="ident" id="4913462">nColorComponent</span><span class="op" id="4913477">]</span><span class="keyword" id="4913478">struct</span>&nbsp;<span class="op" id="4913485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913489">compIndex</span>&nbsp;<span class="builtintype" id="4913499">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913507">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4913517">uint8</span>&nbsp;<span class="comment" id="4913523">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913547">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4913557">uint8</span>&nbsp;<span class="comment" id="4913563">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913586">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913589">for</span>&nbsp;<span class="ident" id="4913593">i</span>&nbsp;<span class="op" id="4913595">:=</span>&nbsp;<span class="num" id="4913598">0</span><span class="op" id="4913599">;</span>&nbsp;<span class="ident" id="4913601">i</span>&nbsp;<span class="op" id="4913603">&lt;</span>&nbsp;<span class="ident" id="4913605">nComp</span><span class="op" id="4913610">;</span>&nbsp;<span class="ident" id="4913612">i</span><span class="op" id="4913613">++</span>&nbsp;<span class="op" id="4913616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913620">cs</span>&nbsp;<span class="op" id="4913623">:=</span>&nbsp;<span class="ident" id="4913626">d</span><span class="op" id="4913627">.</span><span class="ident" id="4913628">tmp</span><span class="op" id="4913631">[</span><span class="num" id="4913632">1</span><span class="op" id="4913633">+</span><span class="num" id="4913634">2</span><span class="op" id="4913635">*</span><span class="ident" id="4913636">i</span><span class="op" id="4913637">]</span>&nbsp;<span class="comment" id="4913639">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913664">compIndex</span>&nbsp;<span class="op" id="4913674">:=</span>&nbsp;<span class="op" id="4913677">-</span><span class="num" id="4913678">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913682">for</span>&nbsp;<span class="ident" id="4913686">j</span><span class="op" id="4913687">,</span>&nbsp;<span class="ident" id="4913689">comp</span>&nbsp;<span class="op" id="4913694">:=</span>&nbsp;<span class="keyword" id="4913697">range</span>&nbsp;<span class="ident" id="4913703">d</span><span class="op" id="4913704">.</span><span class="ident" id="4913705">comp</span>&nbsp;<span class="op" id="4913710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913715">if</span>&nbsp;<span class="ident" id="4913718">cs</span>&nbsp;<span class="op" id="4913721">==</span>&nbsp;<span class="ident" id="4913724">comp</span><span class="op" id="4913728">.</span><span class="ident" id="4913729">c</span>&nbsp;<span class="op" id="4913731">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913737">compIndex</span>&nbsp;<span class="op" id="4913747">=</span>&nbsp;<span class="ident" id="4913749">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913762">if</span>&nbsp;<span class="ident" id="4913765">compIndex</span>&nbsp;<span class="op" id="4913775">&lt;</span>&nbsp;<span class="num" id="4913777">0</span>&nbsp;<span class="op" id="4913779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913784">return</span>&nbsp;<span class="ident" id="4913791">FormatError</span><span class="op" id="4913802">(</span><span class="string" id="4913803">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="4913831">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913839">scan</span><span class="op" id="4913843">[</span><span class="ident" id="4913844">i</span><span class="op" id="4913845">]</span><span class="op" id="4913846">.</span><span class="ident" id="4913847">compIndex</span>&nbsp;<span class="op" id="4913857">=</span>&nbsp;<span class="builtintype" id="4913859">uint8</span><span class="op" id="4913864">(</span><span class="ident" id="4913865">compIndex</span><span class="op" id="4913874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913878">scan</span><span class="op" id="4913882">[</span><span class="ident" id="4913883">i</span><span class="op" id="4913884">]</span><span class="op" id="4913885">.</span><span class="ident" id="4913886">td</span>&nbsp;<span class="op" id="4913889">=</span>&nbsp;<span class="ident" id="4913891">d</span><span class="op" id="4913892">.</span><span class="ident" id="4913893">tmp</span><span class="op" id="4913896">[</span><span class="num" id="4913897">2</span><span class="op" id="4913898">+</span><span class="num" id="4913899">2</span><span class="op" id="4913900">*</span><span class="ident" id="4913901">i</span><span class="op" id="4913902">]</span>&nbsp;<span class="op" id="4913904">&gt;&gt;</span>&nbsp;<span class="num" id="4913907">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913911">if</span>&nbsp;<span class="ident" id="4913914">scan</span><span class="op" id="4913918">[</span><span class="ident" id="4913919">i</span><span class="op" id="4913920">]</span><span class="op" id="4913921">.</span><span class="ident" id="4913922">td</span>&nbsp;<span class="op" id="4913925">&gt;</span>&nbsp;<span class="ident" id="4913927">maxTh</span>&nbsp;<span class="op" id="4913933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4913938">return</span>&nbsp;<span class="ident" id="4913945">FormatError</span><span class="op" id="4913956">(</span><span class="string" id="4913957">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="4913971">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4913975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4913979">scan</span><span class="op" id="4913983">[</span><span class="ident" id="4913984">i</span><span class="op" id="4913985">]</span><span class="op" id="4913986">.</span><span class="ident" id="4913987">ta</span>&nbsp;<span class="op" id="4913990">=</span>&nbsp;<span class="ident" id="4913992">d</span><span class="op" id="4913993">.</span><span class="ident" id="4913994">tmp</span><span class="op" id="4913997">[</span><span class="num" id="4913998">2</span><span class="op" id="4913999">+</span><span class="num" id="4914000">2</span><span class="op" id="4914001">*</span><span class="ident" id="4914002">i</span><span class="op" id="4914003">]</span>&nbsp;<span class="op" id="4914005">&amp;</span>&nbsp;<span class="num" id="4914007">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914014">if</span>&nbsp;<span class="ident" id="4914017">scan</span><span class="op" id="4914021">[</span><span class="ident" id="4914022">i</span><span class="op" id="4914023">]</span><span class="op" id="4914024">.</span><span class="ident" id="4914025">ta</span>&nbsp;<span class="op" id="4914028">&gt;</span>&nbsp;<span class="ident" id="4914030">maxTh</span>&nbsp;<span class="op" id="4914036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4914041">return</span>&nbsp;<span class="ident" id="4914048">FormatError</span><span class="op" id="4914059">(</span><span class="string" id="4914060">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="4914074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914078">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4914081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914085">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914144">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914212">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914263">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914267">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914337">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914408">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914478">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914545">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914613">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914682">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914749">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914819">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914882">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914903">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4914907">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4914976">zigStart</span><span class="op" id="4914984">,</span>&nbsp;<span class="ident" id="4914986">zigEnd</span><span class="op" id="4914992">,</span>&nbsp;<span class="ident" id="4914994">ah</span><span class="op" id="4914996">,</span>&nbsp;<span class="ident" id="4914998">al</span>&nbsp;<span class="op" id="4915001">:=</span>&nbsp;<span class="builtintype" id="4915004">int32</span><span class="op" id="4915009">(</span><span class="num" id="4915010">0</span><span class="op" id="4915011">)</span><span class="op" id="4915012">,</span>&nbsp;<span class="builtintype" id="4915014">int32</span><span class="op" id="4915019">(</span><span class="ident" id="4915020">blockSize</span><span class="op" id="4915029">-</span><span class="num" id="4915030">1</span><span class="op" id="4915031">)</span><span class="op" id="4915032">,</span>&nbsp;<span class="builtintype" id="4915034">uint32</span><span class="op" id="4915040">(</span><span class="num" id="4915041">0</span><span class="op" id="4915042">)</span><span class="op" id="4915043">,</span>&nbsp;<span class="builtintype" id="4915045">uint32</span><span class="op" id="4915051">(</span><span class="num" id="4915052">0</span><span class="op" id="4915053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915056">if</span>&nbsp;<span class="ident" id="4915059">d</span><span class="op" id="4915060">.</span><span class="ident" id="4915061">progressive</span>&nbsp;<span class="op" id="4915073">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915077">zigStart</span>&nbsp;<span class="op" id="4915086">=</span>&nbsp;<span class="builtintype" id="4915088">int32</span><span class="op" id="4915093">(</span><span class="ident" id="4915094">d</span><span class="op" id="4915095">.</span><span class="ident" id="4915096">tmp</span><span class="op" id="4915099">[</span><span class="num" id="4915100">1</span><span class="op" id="4915101">+</span><span class="num" id="4915102">2</span><span class="op" id="4915103">*</span><span class="ident" id="4915104">nComp</span><span class="op" id="4915109">]</span><span class="op" id="4915110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915114">zigEnd</span>&nbsp;<span class="op" id="4915121">=</span>&nbsp;<span class="builtintype" id="4915123">int32</span><span class="op" id="4915128">(</span><span class="ident" id="4915129">d</span><span class="op" id="4915130">.</span><span class="ident" id="4915131">tmp</span><span class="op" id="4915134">[</span><span class="num" id="4915135">2</span><span class="op" id="4915136">+</span><span class="num" id="4915137">2</span><span class="op" id="4915138">*</span><span class="ident" id="4915139">nComp</span><span class="op" id="4915144">]</span><span class="op" id="4915145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915149">ah</span>&nbsp;<span class="op" id="4915152">=</span>&nbsp;<span class="builtintype" id="4915154">uint32</span><span class="op" id="4915160">(</span><span class="ident" id="4915161">d</span><span class="op" id="4915162">.</span><span class="ident" id="4915163">tmp</span><span class="op" id="4915166">[</span><span class="num" id="4915167">3</span><span class="op" id="4915168">+</span><span class="num" id="4915169">2</span><span class="op" id="4915170">*</span><span class="ident" id="4915171">nComp</span><span class="op" id="4915176">]</span>&nbsp;<span class="op" id="4915178">&gt;&gt;</span>&nbsp;<span class="num" id="4915181">4</span><span class="op" id="4915182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915186">al</span>&nbsp;<span class="op" id="4915189">=</span>&nbsp;<span class="builtintype" id="4915191">uint32</span><span class="op" id="4915197">(</span><span class="ident" id="4915198">d</span><span class="op" id="4915199">.</span><span class="ident" id="4915200">tmp</span><span class="op" id="4915203">[</span><span class="num" id="4915204">3</span><span class="op" id="4915205">+</span><span class="num" id="4915206">2</span><span class="op" id="4915207">*</span><span class="ident" id="4915208">nComp</span><span class="op" id="4915213">]</span>&nbsp;<span class="op" id="4915215">&amp;</span>&nbsp;<span class="num" id="4915217">0x0f</span><span class="op" id="4915221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915225">if</span>&nbsp;<span class="op" id="4915228">(</span><span class="ident" id="4915229">zigStart</span>&nbsp;<span class="op" id="4915238">==</span>&nbsp;<span class="num" id="4915241">0</span>&nbsp;<span class="op" id="4915243">&amp;&amp;</span>&nbsp;<span class="ident" id="4915246">zigEnd</span>&nbsp;<span class="op" id="4915253">!=</span>&nbsp;<span class="num" id="4915256">0</span><span class="op" id="4915257">)</span>&nbsp;<span class="op" id="4915259">||</span>&nbsp;<span class="ident" id="4915262">zigStart</span>&nbsp;<span class="op" id="4915271">&gt;</span>&nbsp;<span class="ident" id="4915273">zigEnd</span>&nbsp;<span class="op" id="4915280">||</span>&nbsp;<span class="ident" id="4915283">blockSize</span>&nbsp;<span class="op" id="4915293">&lt;=</span>&nbsp;<span class="ident" id="4915296">zigEnd</span>&nbsp;<span class="op" id="4915303">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915308">return</span>&nbsp;<span class="ident" id="4915315">FormatError</span><span class="op" id="4915326">(</span><span class="string" id="4915327">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="4915358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915366">if</span>&nbsp;<span class="ident" id="4915369">zigStart</span>&nbsp;<span class="op" id="4915378">!=</span>&nbsp;<span class="num" id="4915381">0</span>&nbsp;<span class="op" id="4915383">&amp;&amp;</span>&nbsp;<span class="ident" id="4915386">nComp</span>&nbsp;<span class="op" id="4915392">!=</span>&nbsp;<span class="num" id="4915395">1</span>&nbsp;<span class="op" id="4915397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915402">return</span>&nbsp;<span class="ident" id="4915409">FormatError</span><span class="op" id="4915420">(</span><span class="string" id="4915421">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="4915478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915482">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915486">if</span>&nbsp;<span class="ident" id="4915489">ah</span>&nbsp;<span class="op" id="4915492">!=</span>&nbsp;<span class="num" id="4915495">0</span>&nbsp;<span class="op" id="4915497">&amp;&amp;</span>&nbsp;<span class="ident" id="4915500">ah</span>&nbsp;<span class="op" id="4915503">!=</span>&nbsp;<span class="ident" id="4915506">al</span><span class="op" id="4915508">+</span><span class="num" id="4915509">1</span>&nbsp;<span class="op" id="4915511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915516">return</span>&nbsp;<span class="ident" id="4915523">FormatError</span><span class="op" id="4915534">(</span><span class="string" id="4915535">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="4915572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4915583">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915658">h0</span><span class="op" id="4915660">,</span>&nbsp;<span class="ident" id="4915662">v0</span>&nbsp;<span class="op" id="4915665">:=</span>&nbsp;<span class="ident" id="4915668">d</span><span class="op" id="4915669">.</span><span class="ident" id="4915670">comp</span><span class="op" id="4915674">[</span><span class="num" id="4915675">0</span><span class="op" id="4915676">]</span><span class="op" id="4915677">.</span><span class="ident" id="4915678">h</span><span class="op" id="4915679">,</span>&nbsp;<span class="ident" id="4915681">d</span><span class="op" id="4915682">.</span><span class="ident" id="4915683">comp</span><span class="op" id="4915687">[</span><span class="num" id="4915688">0</span><span class="op" id="4915689">]</span><span class="op" id="4915690">.</span><span class="ident" id="4915691">v</span>&nbsp;<span class="comment" id="4915693">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915739">mxx</span>&nbsp;<span class="op" id="4915743">:=</span>&nbsp;<span class="op" id="4915746">(</span><span class="ident" id="4915747">d</span><span class="op" id="4915748">.</span><span class="ident" id="4915749">width</span>&nbsp;<span class="op" id="4915755">+</span>&nbsp;<span class="num" id="4915757">8</span><span class="op" id="4915758">*</span><span class="ident" id="4915759">h0</span>&nbsp;<span class="op" id="4915762">-</span>&nbsp;<span class="num" id="4915764">1</span><span class="op" id="4915765">)</span>&nbsp;<span class="op" id="4915767">/</span>&nbsp;<span class="op" id="4915769">(</span><span class="num" id="4915770">8</span>&nbsp;<span class="op" id="4915772">*</span>&nbsp;<span class="ident" id="4915774">h0</span><span class="op" id="4915776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915779">myy</span>&nbsp;<span class="op" id="4915783">:=</span>&nbsp;<span class="op" id="4915786">(</span><span class="ident" id="4915787">d</span><span class="op" id="4915788">.</span><span class="ident" id="4915789">height</span>&nbsp;<span class="op" id="4915796">+</span>&nbsp;<span class="num" id="4915798">8</span><span class="op" id="4915799">*</span><span class="ident" id="4915800">v0</span>&nbsp;<span class="op" id="4915803">-</span>&nbsp;<span class="num" id="4915805">1</span><span class="op" id="4915806">)</span>&nbsp;<span class="op" id="4915808">/</span>&nbsp;<span class="op" id="4915810">(</span><span class="num" id="4915811">8</span>&nbsp;<span class="op" id="4915813">*</span>&nbsp;<span class="ident" id="4915815">v0</span><span class="op" id="4915817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915820">if</span>&nbsp;<span class="ident" id="4915823">d</span><span class="op" id="4915824">.</span><span class="ident" id="4915825">img1</span>&nbsp;<span class="op" id="4915830">==</span>&nbsp;<span class="builtintype" id="4915833">nil</span>&nbsp;<span class="op" id="4915837">&amp;&amp;</span>&nbsp;<span class="ident" id="4915840">d</span><span class="op" id="4915841">.</span><span class="ident" id="4915842">img3</span>&nbsp;<span class="op" id="4915847">==</span>&nbsp;<span class="builtintype" id="4915850">nil</span>&nbsp;<span class="op" id="4915854">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915858">d</span><span class="op" id="4915859">.</span><span class="ident" id="4915860">makeImg</span><span class="op" id="4915867">(</span><span class="ident" id="4915868">h0</span><span class="op" id="4915870">,</span>&nbsp;<span class="ident" id="4915872">v0</span><span class="op" id="4915874">,</span>&nbsp;<span class="ident" id="4915876">mxx</span><span class="op" id="4915879">,</span>&nbsp;<span class="ident" id="4915881">myy</span><span class="op" id="4915884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4915887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915890">if</span>&nbsp;<span class="ident" id="4915893">d</span><span class="op" id="4915894">.</span><span class="ident" id="4915895">progressive</span>&nbsp;<span class="op" id="4915907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915911">for</span>&nbsp;<span class="ident" id="4915915">i</span>&nbsp;<span class="op" id="4915917">:=</span>&nbsp;<span class="num" id="4915920">0</span><span class="op" id="4915921">;</span>&nbsp;<span class="ident" id="4915923">i</span>&nbsp;<span class="op" id="4915925">&lt;</span>&nbsp;<span class="ident" id="4915927">nComp</span><span class="op" id="4915932">;</span>&nbsp;<span class="ident" id="4915934">i</span><span class="op" id="4915935">++</span>&nbsp;<span class="op" id="4915938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4915943">compIndex</span>&nbsp;<span class="op" id="4915953">:=</span>&nbsp;<span class="ident" id="4915956">scan</span><span class="op" id="4915960">[</span><span class="ident" id="4915961">i</span><span class="op" id="4915962">]</span><span class="op" id="4915963">.</span><span class="ident" id="4915964">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4915977">if</span>&nbsp;<span class="ident" id="4915980">d</span><span class="op" id="4915981">.</span><span class="ident" id="4915982">progCoeffs</span><span class="op" id="4915992">[</span><span class="ident" id="4915993">compIndex</span><span class="op" id="4916002">]</span>&nbsp;<span class="op" id="4916004">==</span>&nbsp;<span class="builtintype" id="4916007">nil</span>&nbsp;<span class="op" id="4916011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916017">d</span><span class="op" id="4916018">.</span><span class="ident" id="4916019">progCoeffs</span><span class="op" id="4916029">[</span><span class="ident" id="4916030">compIndex</span><span class="op" id="4916039">]</span>&nbsp;<span class="op" id="4916041">=</span>&nbsp;<span class="builtinfunc" id="4916043">make</span><span class="op" id="4916047">(</span><span class="op" id="4916048">[</span><span class="op" id="4916049">]</span><span class="ident" id="4916050">block</span><span class="op" id="4916055">,</span>&nbsp;<span class="ident" id="4916057">mxx</span><span class="op" id="4916060">*</span><span class="ident" id="4916061">myy</span><span class="op" id="4916064">*</span><span class="ident" id="4916065">d</span><span class="op" id="4916066">.</span><span class="ident" id="4916067">comp</span><span class="op" id="4916071">[</span><span class="ident" id="4916072">compIndex</span><span class="op" id="4916081">]</span><span class="op" id="4916082">.</span><span class="ident" id="4916083">h</span><span class="op" id="4916084">*</span><span class="ident" id="4916085">d</span><span class="op" id="4916086">.</span><span class="ident" id="4916087">comp</span><span class="op" id="4916091">[</span><span class="ident" id="4916092">compIndex</span><span class="op" id="4916101">]</span><span class="op" id="4916102">.</span><span class="ident" id="4916103">v</span><span class="op" id="4916104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916116">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916120">d</span><span class="op" id="4916121">.</span><span class="ident" id="4916122">bits</span>&nbsp;<span class="op" id="4916127">=</span>&nbsp;<span class="ident" id="4916129">bits</span><span class="op" id="4916133">{</span><span class="op" id="4916134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916137">mcu</span><span class="op" id="4916140">,</span>&nbsp;<span class="ident" id="4916142">expectedRST</span>&nbsp;<span class="op" id="4916154">:=</span>&nbsp;<span class="num" id="4916157">0</span><span class="op" id="4916158">,</span>&nbsp;<span class="builtintype" id="4916160">uint8</span><span class="op" id="4916165">(</span><span class="ident" id="4916166">rst0Marker</span><span class="op" id="4916176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916179">var</span>&nbsp;<span class="op" id="4916183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916187">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916255">b</span>&nbsp;&nbsp;<span class="ident" id="4916258">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916266">dc</span>&nbsp;<span class="op" id="4916269">[</span><span class="ident" id="4916270">nColorComponent</span><span class="op" id="4916285">]</span><span class="builtintype" id="4916286">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916294">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916367">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916441">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916514">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916584">bx</span><span class="op" id="4916586">,</span>&nbsp;<span class="ident" id="4916588">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4916595">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916601">blockCount</span>&nbsp;<span class="builtintype" id="4916612">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4916617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916620">for</span>&nbsp;<span class="ident" id="4916624">my</span>&nbsp;<span class="op" id="4916627">:=</span>&nbsp;<span class="num" id="4916630">0</span><span class="op" id="4916631">;</span>&nbsp;<span class="ident" id="4916633">my</span>&nbsp;<span class="op" id="4916636">&lt;</span>&nbsp;<span class="ident" id="4916638">myy</span><span class="op" id="4916641">;</span>&nbsp;<span class="ident" id="4916643">my</span><span class="op" id="4916645">++</span>&nbsp;<span class="op" id="4916648">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916652">for</span>&nbsp;<span class="ident" id="4916656">mx</span>&nbsp;<span class="op" id="4916659">:=</span>&nbsp;<span class="num" id="4916662">0</span><span class="op" id="4916663">;</span>&nbsp;<span class="ident" id="4916665">mx</span>&nbsp;<span class="op" id="4916668">&lt;</span>&nbsp;<span class="ident" id="4916670">mxx</span><span class="op" id="4916673">;</span>&nbsp;<span class="ident" id="4916675">mx</span><span class="op" id="4916677">++</span>&nbsp;<span class="op" id="4916680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916685">for</span>&nbsp;<span class="ident" id="4916689">i</span>&nbsp;<span class="op" id="4916691">:=</span>&nbsp;<span class="num" id="4916694">0</span><span class="op" id="4916695">;</span>&nbsp;<span class="ident" id="4916697">i</span>&nbsp;<span class="op" id="4916699">&lt;</span>&nbsp;<span class="ident" id="4916701">nComp</span><span class="op" id="4916706">;</span>&nbsp;<span class="ident" id="4916708">i</span><span class="op" id="4916709">++</span>&nbsp;<span class="op" id="4916712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916718">compIndex</span>&nbsp;<span class="op" id="4916728">:=</span>&nbsp;<span class="ident" id="4916731">scan</span><span class="op" id="4916735">[</span><span class="ident" id="4916736">i</span><span class="op" id="4916737">]</span><span class="op" id="4916738">.</span><span class="ident" id="4916739">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4916753">qt</span>&nbsp;<span class="op" id="4916756">:=</span>&nbsp;<span class="op" id="4916759">&amp;</span><span class="ident" id="4916760">d</span><span class="op" id="4916761">.</span><span class="ident" id="4916762">quant</span><span class="op" id="4916767">[</span><span class="ident" id="4916768">d</span><span class="op" id="4916769">.</span><span class="ident" id="4916770">comp</span><span class="op" id="4916774">[</span><span class="ident" id="4916775">compIndex</span><span class="op" id="4916784">]</span><span class="op" id="4916785">.</span><span class="ident" id="4916786">tq</span><span class="op" id="4916788">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4916794">for</span>&nbsp;<span class="ident" id="4916798">j</span>&nbsp;<span class="op" id="4916800">:=</span>&nbsp;<span class="num" id="4916803">0</span><span class="op" id="4916804">;</span>&nbsp;<span class="ident" id="4916806">j</span>&nbsp;<span class="op" id="4916808">&lt;</span>&nbsp;<span class="ident" id="4916810">d</span><span class="op" id="4916811">.</span><span class="ident" id="4916812">comp</span><span class="op" id="4916816">[</span><span class="ident" id="4916817">compIndex</span><span class="op" id="4916826">]</span><span class="op" id="4916827">.</span><span class="ident" id="4916828">h</span><span class="op" id="4916829">*</span><span class="ident" id="4916830">d</span><span class="op" id="4916831">.</span><span class="ident" id="4916832">comp</span><span class="op" id="4916836">[</span><span class="ident" id="4916837">compIndex</span><span class="op" id="4916846">]</span><span class="op" id="4916847">.</span><span class="ident" id="4916848">v</span><span class="op" id="4916849">;</span>&nbsp;<span class="ident" id="4916851">j</span><span class="op" id="4916852">++</span>&nbsp;<span class="op" id="4916855">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916862">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4916931">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917000">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917008">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917082">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917098">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917114">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917122">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917199">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917276">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917309">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917325">//&nbsp;&nbsp;&nbsp;&nbsp;4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917341">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917418">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917446">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917454">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917532">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917607">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917686">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917762">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917795">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917811">//&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917827">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917891">//&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4917905">//&nbsp;&nbsp;&nbsp;&nbsp;3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4917919">if</span>&nbsp;<span class="ident" id="4917922">nComp</span>&nbsp;<span class="op" id="4917928">!=</span>&nbsp;<span class="num" id="4917931">1</span>&nbsp;<span class="op" id="4917933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4917941">bx</span><span class="op" id="4917943">,</span>&nbsp;<span class="ident" id="4917945">by</span>&nbsp;<span class="op" id="4917948">=</span>&nbsp;<span class="ident" id="4917950">d</span><span class="op" id="4917951">.</span><span class="ident" id="4917952">comp</span><span class="op" id="4917956">[</span><span class="ident" id="4917957">compIndex</span><span class="op" id="4917966">]</span><span class="op" id="4917967">.</span><span class="ident" id="4917968">h</span><span class="op" id="4917969">*</span><span class="ident" id="4917970">mx</span><span class="op" id="4917972">,</span>&nbsp;<span class="ident" id="4917974">d</span><span class="op" id="4917975">.</span><span class="ident" id="4917976">comp</span><span class="op" id="4917980">[</span><span class="ident" id="4917981">compIndex</span><span class="op" id="4917990">]</span><span class="op" id="4917991">.</span><span class="ident" id="4917992">v</span><span class="op" id="4917993">*</span><span class="ident" id="4917994">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918003">if</span>&nbsp;<span class="ident" id="4918006">h0</span>&nbsp;<span class="op" id="4918009">==</span>&nbsp;<span class="num" id="4918012">1</span>&nbsp;<span class="op" id="4918014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918023">by</span>&nbsp;<span class="op" id="4918026">+=</span>&nbsp;<span class="ident" id="4918029">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918037">}</span>&nbsp;<span class="keyword" id="4918039">else</span>&nbsp;<span class="op" id="4918044">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918053">bx</span>&nbsp;<span class="op" id="4918056">+=</span>&nbsp;<span class="ident" id="4918059">j</span>&nbsp;<span class="op" id="4918061">%</span>&nbsp;<span class="num" id="4918063">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918072">by</span>&nbsp;<span class="op" id="4918075">+=</span>&nbsp;<span class="ident" id="4918078">j</span>&nbsp;<span class="op" id="4918080">/</span>&nbsp;<span class="num" id="4918082">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918097">}</span>&nbsp;<span class="keyword" id="4918099">else</span>&nbsp;<span class="op" id="4918104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918112">q</span>&nbsp;<span class="op" id="4918114">:=</span>&nbsp;<span class="ident" id="4918117">mxx</span>&nbsp;<span class="op" id="4918121">*</span>&nbsp;<span class="ident" id="4918123">d</span><span class="op" id="4918124">.</span><span class="ident" id="4918125">comp</span><span class="op" id="4918129">[</span><span class="ident" id="4918130">compIndex</span><span class="op" id="4918139">]</span><span class="op" id="4918140">.</span><span class="ident" id="4918141">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918149">bx</span>&nbsp;<span class="op" id="4918152">=</span>&nbsp;<span class="ident" id="4918154">blockCount</span>&nbsp;<span class="op" id="4918165">%</span>&nbsp;<span class="ident" id="4918167">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918175">by</span>&nbsp;<span class="op" id="4918178">=</span>&nbsp;<span class="ident" id="4918180">blockCount</span>&nbsp;<span class="op" id="4918191">/</span>&nbsp;<span class="ident" id="4918193">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918201">blockCount</span><span class="op" id="4918211">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918220">if</span>&nbsp;<span class="ident" id="4918223">bx</span><span class="op" id="4918225">*</span><span class="num" id="4918226">8</span>&nbsp;<span class="op" id="4918228">&gt;=</span>&nbsp;<span class="ident" id="4918231">d</span><span class="op" id="4918232">.</span><span class="ident" id="4918233">width</span>&nbsp;<span class="op" id="4918239">||</span>&nbsp;<span class="ident" id="4918242">by</span><span class="op" id="4918244">*</span><span class="num" id="4918245">8</span>&nbsp;<span class="op" id="4918247">&gt;=</span>&nbsp;<span class="ident" id="4918250">d</span><span class="op" id="4918251">.</span><span class="ident" id="4918252">height</span>&nbsp;<span class="op" id="4918259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918268">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918298">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918371">if</span>&nbsp;<span class="ident" id="4918374">d</span><span class="op" id="4918375">.</span><span class="ident" id="4918376">progressive</span>&nbsp;<span class="op" id="4918388">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918396">b</span>&nbsp;<span class="op" id="4918398">=</span>&nbsp;<span class="ident" id="4918400">d</span><span class="op" id="4918401">.</span><span class="ident" id="4918402">progCoeffs</span><span class="op" id="4918412">[</span><span class="ident" id="4918413">compIndex</span><span class="op" id="4918422">]</span><span class="op" id="4918423">[</span><span class="ident" id="4918424">by</span><span class="op" id="4918426">*</span><span class="ident" id="4918427">mxx</span><span class="op" id="4918430">*</span><span class="ident" id="4918431">d</span><span class="op" id="4918432">.</span><span class="ident" id="4918433">comp</span><span class="op" id="4918437">[</span><span class="ident" id="4918438">compIndex</span><span class="op" id="4918447">]</span><span class="op" id="4918448">.</span><span class="ident" id="4918449">h</span><span class="op" id="4918450">+</span><span class="ident" id="4918451">bx</span><span class="op" id="4918453">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918460">}</span>&nbsp;<span class="keyword" id="4918462">else</span>&nbsp;<span class="op" id="4918467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918475">b</span>&nbsp;<span class="op" id="4918477">=</span>&nbsp;<span class="ident" id="4918479">block</span><span class="op" id="4918484">{</span><span class="op" id="4918485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918500">if</span>&nbsp;<span class="ident" id="4918503">ah</span>&nbsp;<span class="op" id="4918506">!=</span>&nbsp;<span class="num" id="4918509">0</span>&nbsp;<span class="op" id="4918511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918519">if</span>&nbsp;<span class="ident" id="4918522">err</span>&nbsp;<span class="op" id="4918526">:=</span>&nbsp;<span class="ident" id="4918529">d</span><span class="op" id="4918530">.</span><span class="ident" id="4918531">refine</span><span class="op" id="4918537">(</span><span class="op" id="4918538">&amp;</span><span class="ident" id="4918539">b</span><span class="op" id="4918540">,</span>&nbsp;<span class="op" id="4918542">&amp;</span><span class="ident" id="4918543">d</span><span class="op" id="4918544">.</span><span class="ident" id="4918545">huff</span><span class="op" id="4918549">[</span><span class="ident" id="4918550">acTable</span><span class="op" id="4918557">]</span><span class="op" id="4918558">[</span><span class="ident" id="4918559">scan</span><span class="op" id="4918563">[</span><span class="ident" id="4918564">i</span><span class="op" id="4918565">]</span><span class="op" id="4918566">.</span><span class="ident" id="4918567">ta</span><span class="op" id="4918569">]</span><span class="op" id="4918570">,</span>&nbsp;<span class="ident" id="4918572">zigStart</span><span class="op" id="4918580">,</span>&nbsp;<span class="ident" id="4918582">zigEnd</span><span class="op" id="4918588">,</span>&nbsp;<span class="num" id="4918590">1</span><span class="op" id="4918591">&lt;&lt;</span><span class="ident" id="4918593">al</span><span class="op" id="4918595">)</span><span class="op" id="4918596">;</span>&nbsp;<span class="ident" id="4918598">err</span>&nbsp;<span class="op" id="4918602">!=</span>&nbsp;<span class="builtintype" id="4918605">nil</span>&nbsp;<span class="op" id="4918609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918618">return</span>&nbsp;<span class="ident" id="4918625">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918642">}</span>&nbsp;<span class="keyword" id="4918644">else</span>&nbsp;<span class="op" id="4918649">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918657">zig</span>&nbsp;<span class="op" id="4918661">:=</span>&nbsp;<span class="ident" id="4918664">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918679">if</span>&nbsp;<span class="ident" id="4918682">zig</span>&nbsp;<span class="op" id="4918686">==</span>&nbsp;<span class="num" id="4918689">0</span>&nbsp;<span class="op" id="4918691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918700">zig</span><span class="op" id="4918703">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4918713">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918783">value</span><span class="op" id="4918788">,</span>&nbsp;<span class="ident" id="4918790">err</span>&nbsp;<span class="op" id="4918794">:=</span>&nbsp;<span class="ident" id="4918797">d</span><span class="op" id="4918798">.</span><span class="ident" id="4918799">decodeHuffman</span><span class="op" id="4918812">(</span><span class="op" id="4918813">&amp;</span><span class="ident" id="4918814">d</span><span class="op" id="4918815">.</span><span class="ident" id="4918816">huff</span><span class="op" id="4918820">[</span><span class="ident" id="4918821">dcTable</span><span class="op" id="4918828">]</span><span class="op" id="4918829">[</span><span class="ident" id="4918830">scan</span><span class="op" id="4918834">[</span><span class="ident" id="4918835">i</span><span class="op" id="4918836">]</span><span class="op" id="4918837">.</span><span class="ident" id="4918838">td</span><span class="op" id="4918840">]</span><span class="op" id="4918841">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918850">if</span>&nbsp;<span class="ident" id="4918853">err</span>&nbsp;<span class="op" id="4918857">!=</span>&nbsp;<span class="builtintype" id="4918860">nil</span>&nbsp;<span class="op" id="4918864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918874">return</span>&nbsp;<span class="ident" id="4918881">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918901">if</span>&nbsp;<span class="ident" id="4918904">value</span>&nbsp;<span class="op" id="4918910">&gt;</span>&nbsp;<span class="num" id="4918912">16</span>&nbsp;<span class="op" id="4918915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4918925">return</span>&nbsp;<span class="ident" id="4918932">UnsupportedError</span><span class="op" id="4918948">(</span><span class="string" id="4918949">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="4918973">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4918982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4918991">dcDelta</span><span class="op" id="4918998">,</span>&nbsp;<span class="ident" id="4919000">err</span>&nbsp;<span class="op" id="4919004">:=</span>&nbsp;<span class="ident" id="4919007">d</span><span class="op" id="4919008">.</span><span class="ident" id="4919009">receiveExtend</span><span class="op" id="4919022">(</span><span class="ident" id="4919023">value</span><span class="op" id="4919028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919037">if</span>&nbsp;<span class="ident" id="4919040">err</span>&nbsp;<span class="op" id="4919044">!=</span>&nbsp;<span class="builtintype" id="4919047">nil</span>&nbsp;<span class="op" id="4919051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919061">return</span>&nbsp;<span class="ident" id="4919068">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919079">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919088">dc</span><span class="op" id="4919090">[</span><span class="ident" id="4919091">compIndex</span><span class="op" id="4919100">]</span>&nbsp;<span class="op" id="4919102">+=</span>&nbsp;<span class="ident" id="4919105">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919120">b</span><span class="op" id="4919121">[</span><span class="num" id="4919122">0</span><span class="op" id="4919123">]</span>&nbsp;<span class="op" id="4919125">=</span>&nbsp;<span class="ident" id="4919127">dc</span><span class="op" id="4919129">[</span><span class="ident" id="4919130">compIndex</span><span class="op" id="4919139">]</span>&nbsp;<span class="op" id="4919141">&lt;&lt;</span>&nbsp;<span class="ident" id="4919144">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919162">if</span>&nbsp;<span class="ident" id="4919165">zig</span>&nbsp;<span class="op" id="4919169">&lt;=</span>&nbsp;<span class="ident" id="4919172">zigEnd</span>&nbsp;<span class="op" id="4919179">&amp;&amp;</span>&nbsp;<span class="ident" id="4919182">d</span><span class="op" id="4919183">.</span><span class="ident" id="4919184">eobRun</span>&nbsp;<span class="op" id="4919191">&gt;</span>&nbsp;<span class="num" id="4919193">0</span>&nbsp;<span class="op" id="4919195">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919204">d</span><span class="op" id="4919205">.</span><span class="ident" id="4919206">eobRun</span><span class="op" id="4919212">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919221">}</span>&nbsp;<span class="keyword" id="4919223">else</span>&nbsp;<span class="op" id="4919228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4919237">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919308">huff</span>&nbsp;<span class="op" id="4919313">:=</span>&nbsp;<span class="op" id="4919316">&amp;</span><span class="ident" id="4919317">d</span><span class="op" id="4919318">.</span><span class="ident" id="4919319">huff</span><span class="op" id="4919323">[</span><span class="ident" id="4919324">acTable</span><span class="op" id="4919331">]</span><span class="op" id="4919332">[</span><span class="ident" id="4919333">scan</span><span class="op" id="4919337">[</span><span class="ident" id="4919338">i</span><span class="op" id="4919339">]</span><span class="op" id="4919340">.</span><span class="ident" id="4919341">ta</span><span class="op" id="4919343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919352">for</span>&nbsp;<span class="op" id="4919356">;</span>&nbsp;<span class="ident" id="4919358">zig</span>&nbsp;<span class="op" id="4919362">&lt;=</span>&nbsp;<span class="ident" id="4919365">zigEnd</span><span class="op" id="4919371">;</span>&nbsp;<span class="ident" id="4919373">zig</span><span class="op" id="4919376">++</span>&nbsp;<span class="op" id="4919379">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919389">value</span><span class="op" id="4919394">,</span>&nbsp;<span class="ident" id="4919396">err</span>&nbsp;<span class="op" id="4919400">:=</span>&nbsp;<span class="ident" id="4919403">d</span><span class="op" id="4919404">.</span><span class="ident" id="4919405">decodeHuffman</span><span class="op" id="4919418">(</span><span class="ident" id="4919419">huff</span><span class="op" id="4919423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919433">if</span>&nbsp;<span class="ident" id="4919436">err</span>&nbsp;<span class="op" id="4919440">!=</span>&nbsp;<span class="builtintype" id="4919443">nil</span>&nbsp;<span class="op" id="4919447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919458">return</span>&nbsp;<span class="ident" id="4919465">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919487">val0</span>&nbsp;<span class="op" id="4919492">:=</span>&nbsp;<span class="ident" id="4919495">value</span>&nbsp;<span class="op" id="4919501">&gt;&gt;</span>&nbsp;<span class="num" id="4919504">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919514">val1</span>&nbsp;<span class="op" id="4919519">:=</span>&nbsp;<span class="ident" id="4919522">value</span>&nbsp;<span class="op" id="4919528">&amp;</span>&nbsp;<span class="num" id="4919530">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919543">if</span>&nbsp;<span class="ident" id="4919546">val1</span>&nbsp;<span class="op" id="4919551">!=</span>&nbsp;<span class="num" id="4919554">0</span>&nbsp;<span class="op" id="4919556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919567">zig</span>&nbsp;<span class="op" id="4919571">+=</span>&nbsp;<span class="builtintype" id="4919574">int32</span><span class="op" id="4919579">(</span><span class="ident" id="4919580">val0</span><span class="op" id="4919584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919595">if</span>&nbsp;<span class="ident" id="4919598">zig</span>&nbsp;<span class="op" id="4919602">&gt;</span>&nbsp;<span class="ident" id="4919604">zigEnd</span>&nbsp;<span class="op" id="4919611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919623">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919649">ac</span><span class="op" id="4919651">,</span>&nbsp;<span class="ident" id="4919653">err</span>&nbsp;<span class="op" id="4919657">:=</span>&nbsp;<span class="ident" id="4919660">d</span><span class="op" id="4919661">.</span><span class="ident" id="4919662">receiveExtend</span><span class="op" id="4919675">(</span><span class="ident" id="4919676">val1</span><span class="op" id="4919680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919691">if</span>&nbsp;<span class="ident" id="4919694">err</span>&nbsp;<span class="op" id="4919698">!=</span>&nbsp;<span class="builtintype" id="4919701">nil</span>&nbsp;<span class="op" id="4919705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919717">return</span>&nbsp;<span class="ident" id="4919724">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919737">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919748">b</span><span class="op" id="4919749">[</span><span class="ident" id="4919750">unzig</span><span class="op" id="4919755">[</span><span class="ident" id="4919756">zig</span><span class="op" id="4919759">]</span><span class="op" id="4919760">]</span>&nbsp;<span class="op" id="4919762">=</span>&nbsp;<span class="ident" id="4919764">ac</span>&nbsp;<span class="op" id="4919767">&lt;&lt;</span>&nbsp;<span class="ident" id="4919770">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919781">}</span>&nbsp;<span class="keyword" id="4919783">else</span>&nbsp;<span class="op" id="4919788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919799">if</span>&nbsp;<span class="ident" id="4919802">val0</span>&nbsp;<span class="op" id="4919807">!=</span>&nbsp;<span class="num" id="4919810">0x0f</span>&nbsp;<span class="op" id="4919815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919827">d</span><span class="op" id="4919828">.</span><span class="ident" id="4919829">eobRun</span>&nbsp;<span class="op" id="4919836">=</span>&nbsp;<span class="builtintype" id="4919838">uint16</span><span class="op" id="4919844">(</span><span class="num" id="4919845">1</span>&nbsp;<span class="op" id="4919847">&lt;&lt;</span>&nbsp;<span class="ident" id="4919850">val0</span><span class="op" id="4919854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919866">if</span>&nbsp;<span class="ident" id="4919869">val0</span>&nbsp;<span class="op" id="4919874">!=</span>&nbsp;<span class="num" id="4919877">0</span>&nbsp;<span class="op" id="4919879">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4919892">bits</span><span class="op" id="4919896">,</span>&nbsp;<span class="ident" id="4919898">err</span>&nbsp;<span class="op" id="4919902">:=</span>&nbsp;<span class="ident" id="4919905">d</span><span class="op" id="4919906">.</span><span class="ident" id="4919907">decodeBits</span><span class="op" id="4919917">(</span><span class="builtintype" id="4919918">int32</span><span class="op" id="4919923">(</span><span class="ident" id="4919924">val0</span><span class="op" id="4919928">)</span><span class="op" id="4919929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919942">if</span>&nbsp;<span class="ident" id="4919945">err</span>&nbsp;<span class="op" id="4919949">!=</span>&nbsp;<span class="builtintype" id="4919952">nil</span>&nbsp;<span class="op" id="4919956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4919970">return</span>&nbsp;<span class="ident" id="4919977">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4919992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920005">d</span><span class="op" id="4920006">.</span><span class="ident" id="4920007">eobRun</span>&nbsp;<span class="op" id="4920014">|=</span>&nbsp;<span class="builtintype" id="4920017">uint16</span><span class="op" id="4920023">(</span><span class="ident" id="4920024">bits</span><span class="op" id="4920028">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920052">d</span><span class="op" id="4920053">.</span><span class="ident" id="4920054">eobRun</span><span class="op" id="4920060">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920073">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920099">zig</span>&nbsp;<span class="op" id="4920103">+=</span>&nbsp;<span class="num" id="4920106">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920151">if</span>&nbsp;<span class="ident" id="4920154">d</span><span class="op" id="4920155">.</span><span class="ident" id="4920156">progressive</span>&nbsp;<span class="op" id="4920168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920176">if</span>&nbsp;<span class="ident" id="4920179">zigEnd</span>&nbsp;<span class="op" id="4920186">!=</span>&nbsp;<span class="ident" id="4920189">blockSize</span><span class="op" id="4920198">-</span><span class="num" id="4920199">1</span>&nbsp;<span class="op" id="4920201">||</span>&nbsp;<span class="ident" id="4920204">al</span>&nbsp;<span class="op" id="4920207">!=</span>&nbsp;<span class="num" id="4920210">0</span>&nbsp;<span class="op" id="4920212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920221">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920300">d</span><span class="op" id="4920301">.</span><span class="ident" id="4920302">progCoeffs</span><span class="op" id="4920312">[</span><span class="ident" id="4920313">compIndex</span><span class="op" id="4920322">]</span><span class="op" id="4920323">[</span><span class="ident" id="4920324">by</span><span class="op" id="4920326">*</span><span class="ident" id="4920327">mxx</span><span class="op" id="4920330">*</span><span class="ident" id="4920331">d</span><span class="op" id="4920332">.</span><span class="ident" id="4920333">comp</span><span class="op" id="4920337">[</span><span class="ident" id="4920338">compIndex</span><span class="op" id="4920347">]</span><span class="op" id="4920348">.</span><span class="ident" id="4920349">h</span><span class="op" id="4920350">+</span><span class="ident" id="4920351">bx</span><span class="op" id="4920353">]</span>&nbsp;<span class="op" id="4920355">=</span>&nbsp;<span class="ident" id="4920357">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920366">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920452">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920538">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920623">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920709">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920770">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4920800">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4920878">for</span>&nbsp;<span class="ident" id="4920882">zig</span>&nbsp;<span class="op" id="4920886">:=</span>&nbsp;<span class="num" id="4920889">0</span><span class="op" id="4920890">;</span>&nbsp;<span class="ident" id="4920892">zig</span>&nbsp;<span class="op" id="4920896">&lt;</span>&nbsp;<span class="ident" id="4920898">blockSize</span><span class="op" id="4920907">;</span>&nbsp;<span class="ident" id="4920909">zig</span><span class="op" id="4920912">++</span>&nbsp;<span class="op" id="4920915">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920923">b</span><span class="op" id="4920924">[</span><span class="ident" id="4920925">unzig</span><span class="op" id="4920930">[</span><span class="ident" id="4920931">zig</span><span class="op" id="4920934">]</span><span class="op" id="4920935">]</span>&nbsp;<span class="op" id="4920937">*=</span>&nbsp;<span class="ident" id="4920940">qt</span><span class="op" id="4920942">[</span><span class="ident" id="4920943">zig</span><span class="op" id="4920946">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4920953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920960">idct</span><span class="op" id="4920964">(</span><span class="op" id="4920965">&amp;</span><span class="ident" id="4920966">b</span><span class="op" id="4920967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4920974">dst</span><span class="op" id="4920977">,</span>&nbsp;<span class="ident" id="4920979">stride</span>&nbsp;<span class="op" id="4920986">:=</span>&nbsp;<span class="op" id="4920989">[</span><span class="op" id="4920990">]</span><span class="builtintype" id="4920991">byte</span><span class="op" id="4920995">(</span><span class="builtintype" id="4920996">nil</span><span class="op" id="4920999">)</span><span class="op" id="4921000">,</span>&nbsp;<span class="num" id="4921002">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921009">if</span>&nbsp;<span class="ident" id="4921012">d</span><span class="op" id="4921013">.</span><span class="ident" id="4921014">nComp</span>&nbsp;<span class="op" id="4921020">==</span>&nbsp;<span class="ident" id="4921023">nGrayComponent</span>&nbsp;<span class="op" id="4921038">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921046">dst</span><span class="op" id="4921049">,</span>&nbsp;<span class="ident" id="4921051">stride</span>&nbsp;<span class="op" id="4921058">=</span>&nbsp;<span class="ident" id="4921060">d</span><span class="op" id="4921061">.</span><span class="ident" id="4921062">img1</span><span class="op" id="4921066">.</span><span class="ident" id="4921067">Pix</span><span class="op" id="4921070">[</span><span class="num" id="4921071">8</span><span class="op" id="4921072">*</span><span class="op" id="4921073">(</span><span class="ident" id="4921074">by</span><span class="op" id="4921076">*</span><span class="ident" id="4921077">d</span><span class="op" id="4921078">.</span><span class="ident" id="4921079">img1</span><span class="op" id="4921083">.</span><span class="ident" id="4921084">Stride</span><span class="op" id="4921090">+</span><span class="ident" id="4921091">bx</span><span class="op" id="4921093">)</span><span class="op" id="4921094">:</span><span class="op" id="4921095">]</span><span class="op" id="4921096">,</span>&nbsp;<span class="ident" id="4921098">d</span><span class="op" id="4921099">.</span><span class="ident" id="4921100">img1</span><span class="op" id="4921104">.</span><span class="ident" id="4921105">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921117">}</span>&nbsp;<span class="keyword" id="4921119">else</span>&nbsp;<span class="op" id="4921124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921132">switch</span>&nbsp;<span class="ident" id="4921139">compIndex</span>&nbsp;<span class="op" id="4921149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921157">case</span>&nbsp;<span class="num" id="4921162">0</span><span class="op" id="4921163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921172">dst</span><span class="op" id="4921175">,</span>&nbsp;<span class="ident" id="4921177">stride</span>&nbsp;<span class="op" id="4921184">=</span>&nbsp;<span class="ident" id="4921186">d</span><span class="op" id="4921187">.</span><span class="ident" id="4921188">img3</span><span class="op" id="4921192">.</span><span class="ident" id="4921193">Y</span><span class="op" id="4921194">[</span><span class="num" id="4921195">8</span><span class="op" id="4921196">*</span><span class="op" id="4921197">(</span><span class="ident" id="4921198">by</span><span class="op" id="4921200">*</span><span class="ident" id="4921201">d</span><span class="op" id="4921202">.</span><span class="ident" id="4921203">img3</span><span class="op" id="4921207">.</span><span class="ident" id="4921208">YStride</span><span class="op" id="4921215">+</span><span class="ident" id="4921216">bx</span><span class="op" id="4921218">)</span><span class="op" id="4921219">:</span><span class="op" id="4921220">]</span><span class="op" id="4921221">,</span>&nbsp;<span class="ident" id="4921223">d</span><span class="op" id="4921224">.</span><span class="ident" id="4921225">img3</span><span class="op" id="4921229">.</span><span class="ident" id="4921230">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921244">case</span>&nbsp;<span class="num" id="4921249">1</span><span class="op" id="4921250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921259">dst</span><span class="op" id="4921262">,</span>&nbsp;<span class="ident" id="4921264">stride</span>&nbsp;<span class="op" id="4921271">=</span>&nbsp;<span class="ident" id="4921273">d</span><span class="op" id="4921274">.</span><span class="ident" id="4921275">img3</span><span class="op" id="4921279">.</span><span class="ident" id="4921280">Cb</span><span class="op" id="4921282">[</span><span class="num" id="4921283">8</span><span class="op" id="4921284">*</span><span class="op" id="4921285">(</span><span class="ident" id="4921286">by</span><span class="op" id="4921288">*</span><span class="ident" id="4921289">d</span><span class="op" id="4921290">.</span><span class="ident" id="4921291">img3</span><span class="op" id="4921295">.</span><span class="ident" id="4921296">CStride</span><span class="op" id="4921303">+</span><span class="ident" id="4921304">bx</span><span class="op" id="4921306">)</span><span class="op" id="4921307">:</span><span class="op" id="4921308">]</span><span class="op" id="4921309">,</span>&nbsp;<span class="ident" id="4921311">d</span><span class="op" id="4921312">.</span><span class="ident" id="4921313">img3</span><span class="op" id="4921317">.</span><span class="ident" id="4921318">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921332">case</span>&nbsp;<span class="num" id="4921337">2</span><span class="op" id="4921338">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921347">dst</span><span class="op" id="4921350">,</span>&nbsp;<span class="ident" id="4921352">stride</span>&nbsp;<span class="op" id="4921359">=</span>&nbsp;<span class="ident" id="4921361">d</span><span class="op" id="4921362">.</span><span class="ident" id="4921363">img3</span><span class="op" id="4921367">.</span><span class="ident" id="4921368">Cr</span><span class="op" id="4921370">[</span><span class="num" id="4921371">8</span><span class="op" id="4921372">*</span><span class="op" id="4921373">(</span><span class="ident" id="4921374">by</span><span class="op" id="4921376">*</span><span class="ident" id="4921377">d</span><span class="op" id="4921378">.</span><span class="ident" id="4921379">img3</span><span class="op" id="4921383">.</span><span class="ident" id="4921384">CStride</span><span class="op" id="4921391">+</span><span class="ident" id="4921392">bx</span><span class="op" id="4921394">)</span><span class="op" id="4921395">:</span><span class="op" id="4921396">]</span><span class="op" id="4921397">,</span>&nbsp;<span class="ident" id="4921399">d</span><span class="op" id="4921400">.</span><span class="ident" id="4921401">img3</span><span class="op" id="4921405">.</span><span class="ident" id="4921406">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921420">default</span><span class="op" id="4921427">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921436">return</span>&nbsp;<span class="ident" id="4921443">UnsupportedError</span><span class="op" id="4921459">(</span><span class="string" id="4921460">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="4921481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921503">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921568">for</span>&nbsp;<span class="ident" id="4921572">y</span>&nbsp;<span class="op" id="4921574">:=</span>&nbsp;<span class="num" id="4921577">0</span><span class="op" id="4921578">;</span>&nbsp;<span class="ident" id="4921580">y</span>&nbsp;<span class="op" id="4921582">&lt;</span>&nbsp;<span class="num" id="4921584">8</span><span class="op" id="4921585">;</span>&nbsp;<span class="ident" id="4921587">y</span><span class="op" id="4921588">++</span>&nbsp;<span class="op" id="4921591">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921599">y8</span>&nbsp;<span class="op" id="4921602">:=</span>&nbsp;<span class="ident" id="4921605">y</span>&nbsp;<span class="op" id="4921607">*</span>&nbsp;<span class="num" id="4921609">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921617">yStride</span>&nbsp;<span class="op" id="4921625">:=</span>&nbsp;<span class="ident" id="4921628">y</span>&nbsp;<span class="op" id="4921630">*</span>&nbsp;<span class="ident" id="4921632">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921645">for</span>&nbsp;<span class="ident" id="4921649">x</span>&nbsp;<span class="op" id="4921651">:=</span>&nbsp;<span class="num" id="4921654">0</span><span class="op" id="4921655">;</span>&nbsp;<span class="ident" id="4921657">x</span>&nbsp;<span class="op" id="4921659">&lt;</span>&nbsp;<span class="num" id="4921661">8</span><span class="op" id="4921662">;</span>&nbsp;<span class="ident" id="4921664">x</span><span class="op" id="4921665">++</span>&nbsp;<span class="op" id="4921668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921677">c</span>&nbsp;<span class="op" id="4921679">:=</span>&nbsp;<span class="ident" id="4921682">b</span><span class="op" id="4921683">[</span><span class="ident" id="4921684">y8</span><span class="op" id="4921686">+</span><span class="ident" id="4921687">x</span><span class="op" id="4921688">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921697">if</span>&nbsp;<span class="ident" id="4921700">c</span>&nbsp;<span class="op" id="4921702">&lt;</span>&nbsp;<span class="op" id="4921704">-</span><span class="num" id="4921705">128</span>&nbsp;<span class="op" id="4921709">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921719">c</span>&nbsp;<span class="op" id="4921721">=</span>&nbsp;<span class="num" id="4921723">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921732">}</span>&nbsp;<span class="keyword" id="4921734">else</span>&nbsp;<span class="keyword" id="4921739">if</span>&nbsp;<span class="ident" id="4921742">c</span>&nbsp;<span class="op" id="4921744">&gt;</span>&nbsp;<span class="num" id="4921746">127</span>&nbsp;<span class="op" id="4921750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921760">c</span>&nbsp;<span class="op" id="4921762">=</span>&nbsp;<span class="num" id="4921764">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921775">}</span>&nbsp;<span class="keyword" id="4921777">else</span>&nbsp;<span class="op" id="4921782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921792">c</span>&nbsp;<span class="op" id="4921794">+=</span>&nbsp;<span class="num" id="4921797">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921817">dst</span><span class="op" id="4921820">[</span><span class="ident" id="4921821">yStride</span><span class="op" id="4921828">+</span><span class="ident" id="4921829">x</span><span class="op" id="4921830">]</span>&nbsp;<span class="op" id="4921832">=</span>&nbsp;<span class="builtintype" id="4921834">uint8</span><span class="op" id="4921839">(</span><span class="ident" id="4921840">c</span><span class="op" id="4921841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921862">}</span>&nbsp;<span class="comment" id="4921864">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4921876">}</span>&nbsp;<span class="comment" id="4921878">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4921890">mcu</span><span class="op" id="4921893">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4921899">if</span>&nbsp;<span class="ident" id="4921902">d</span><span class="op" id="4921903">.</span><span class="ident" id="4921904">ri</span>&nbsp;<span class="op" id="4921907">&gt;</span>&nbsp;<span class="num" id="4921909">0</span>&nbsp;<span class="op" id="4921911">&amp;&amp;</span>&nbsp;<span class="ident" id="4921914">mcu</span><span class="op" id="4921917">%</span><span class="ident" id="4921918">d</span><span class="op" id="4921919">.</span><span class="ident" id="4921920">ri</span>&nbsp;<span class="op" id="4921923">==</span>&nbsp;<span class="num" id="4921926">0</span>&nbsp;<span class="op" id="4921928">&amp;&amp;</span>&nbsp;<span class="ident" id="4921931">mcu</span>&nbsp;<span class="op" id="4921935">&lt;</span>&nbsp;<span class="ident" id="4921937">mxx</span><span class="op" id="4921940">*</span><span class="ident" id="4921941">myy</span>&nbsp;<span class="op" id="4921945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4921951">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922051">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922148">if</span>&nbsp;<span class="ident" id="4922151">err</span>&nbsp;<span class="op" id="4922155">:=</span>&nbsp;<span class="ident" id="4922158">d</span><span class="op" id="4922159">.</span><span class="ident" id="4922160">readFull</span><span class="op" id="4922168">(</span><span class="ident" id="4922169">d</span><span class="op" id="4922170">.</span><span class="ident" id="4922171">tmp</span><span class="op" id="4922174">[</span><span class="op" id="4922175">:</span><span class="num" id="4922176">2</span><span class="op" id="4922177">]</span><span class="op" id="4922178">)</span><span class="op" id="4922179">;</span>&nbsp;<span class="ident" id="4922181">err</span>&nbsp;<span class="op" id="4922185">!=</span>&nbsp;<span class="builtintype" id="4922188">nil</span>&nbsp;<span class="op" id="4922192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922199">return</span>&nbsp;<span class="ident" id="4922206">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922220">if</span>&nbsp;<span class="ident" id="4922223">d</span><span class="op" id="4922224">.</span><span class="ident" id="4922225">tmp</span><span class="op" id="4922228">[</span><span class="num" id="4922229">0</span><span class="op" id="4922230">]</span>&nbsp;<span class="op" id="4922232">!=</span>&nbsp;<span class="num" id="4922235">0xff</span>&nbsp;<span class="op" id="4922240">||</span>&nbsp;<span class="ident" id="4922243">d</span><span class="op" id="4922244">.</span><span class="ident" id="4922245">tmp</span><span class="op" id="4922248">[</span><span class="num" id="4922249">1</span><span class="op" id="4922250">]</span>&nbsp;<span class="op" id="4922252">!=</span>&nbsp;<span class="ident" id="4922255">expectedRST</span>&nbsp;<span class="op" id="4922267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922274">return</span>&nbsp;<span class="ident" id="4922281">FormatError</span><span class="op" id="4922292">(</span><span class="string" id="4922293">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="4922309">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922321">expectedRST</span><span class="op" id="4922332">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922339">if</span>&nbsp;<span class="ident" id="4922342">expectedRST</span>&nbsp;<span class="op" id="4922354">==</span>&nbsp;<span class="ident" id="4922357">rst7Marker</span><span class="op" id="4922367">+</span><span class="num" id="4922368">1</span>&nbsp;<span class="op" id="4922370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922377">expectedRST</span>&nbsp;<span class="op" id="4922389">=</span>&nbsp;<span class="ident" id="4922391">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922406">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922412">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922446">d</span><span class="op" id="4922447">.</span><span class="ident" id="4922448">bits</span>&nbsp;<span class="op" id="4922453">=</span>&nbsp;<span class="ident" id="4922455">bits</span><span class="op" id="4922459">{</span><span class="op" id="4922460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922466">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922524">dc</span>&nbsp;<span class="op" id="4922527">=</span>&nbsp;<span class="op" id="4922529">[</span><span class="ident" id="4922530">nColorComponent</span><span class="op" id="4922545">]</span><span class="builtintype" id="4922546">int32</span><span class="op" id="4922551">{</span><span class="op" id="4922552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922558">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922626">d</span><span class="op" id="4922627">.</span><span class="ident" id="4922628">eobRun</span>&nbsp;<span class="op" id="4922635">=</span>&nbsp;<span class="num" id="4922637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922646">}</span>&nbsp;<span class="comment" id="4922648">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922659">}</span>&nbsp;<span class="comment" id="4922661">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922673">return</span>&nbsp;<span class="builtintype" id="4922680">nil</span><br>
<span class="lineno"></span><span class="op" id="4922684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4922687">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4922766">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="4922784">func</span>&nbsp;<span class="op" id="4922789">(</span><span class="ident" id="4922790">d</span>&nbsp;<span class="op" id="4922792">*</span><span class="ident" id="4922793">decoder</span><span class="op" id="4922800">)</span>&nbsp;<span class="ident" id="4922802">refine</span><span class="op" id="4922808">(</span><span class="ident" id="4922809">b</span>&nbsp;<span class="op" id="4922811">*</span><span class="ident" id="4922812">block</span><span class="op" id="4922817">,</span>&nbsp;<span class="ident" id="4922819">h</span>&nbsp;<span class="op" id="4922821">*</span><span class="ident" id="4922822">huffman</span><span class="op" id="4922829">,</span>&nbsp;<span class="ident" id="4922831">zigStart</span><span class="op" id="4922839">,</span>&nbsp;<span class="ident" id="4922841">zigEnd</span><span class="op" id="4922847">,</span>&nbsp;<span class="ident" id="4922849">delta</span>&nbsp;<span class="builtintype" id="4922855">int32</span><span class="op" id="4922860">)</span>&nbsp;<span class="builtintype" id="4922862">error</span>&nbsp;<span class="op" id="4922868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4922871">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922911">if</span>&nbsp;<span class="ident" id="4922914">zigStart</span>&nbsp;<span class="op" id="4922923">==</span>&nbsp;<span class="num" id="4922926">0</span>&nbsp;<span class="op" id="4922928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4922932">if</span>&nbsp;<span class="ident" id="4922935">zigEnd</span>&nbsp;<span class="op" id="4922942">!=</span>&nbsp;<span class="num" id="4922945">0</span>&nbsp;<span class="op" id="4922947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4922952">panic</span><span class="op" id="4922957">(</span><span class="string" id="4922958">&#34;unreachable&#34;</span><span class="op" id="4922971">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4922975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4922979">bit</span><span class="op" id="4922982">,</span>&nbsp;<span class="ident" id="4922984">err</span>&nbsp;<span class="op" id="4922988">:=</span>&nbsp;<span class="ident" id="4922991">d</span><span class="op" id="4922992">.</span><span class="ident" id="4922993">decodeBit</span><span class="op" id="4923002">(</span><span class="op" id="4923003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923007">if</span>&nbsp;<span class="ident" id="4923010">err</span>&nbsp;<span class="op" id="4923014">!=</span>&nbsp;<span class="builtintype" id="4923017">nil</span>&nbsp;<span class="op" id="4923021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923026">return</span>&nbsp;<span class="ident" id="4923033">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923039">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923043">if</span>&nbsp;<span class="ident" id="4923046">bit</span>&nbsp;<span class="op" id="4923050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923055">b</span><span class="op" id="4923056">[</span><span class="num" id="4923057">0</span><span class="op" id="4923058">]</span>&nbsp;<span class="op" id="4923060">|=</span>&nbsp;<span class="ident" id="4923063">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923075">return</span>&nbsp;<span class="builtintype" id="4923082">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923087">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4923091">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923173">zig</span>&nbsp;<span class="op" id="4923177">:=</span>&nbsp;<span class="ident" id="4923180">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923190">if</span>&nbsp;<span class="ident" id="4923193">d</span><span class="op" id="4923194">.</span><span class="ident" id="4923195">eobRun</span>&nbsp;<span class="op" id="4923202">==</span>&nbsp;<span class="num" id="4923205">0</span>&nbsp;<span class="op" id="4923207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923210">loop</span><span class="op" id="4923214">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923218">for</span>&nbsp;<span class="op" id="4923222">;</span>&nbsp;<span class="ident" id="4923224">zig</span>&nbsp;<span class="op" id="4923228">&lt;=</span>&nbsp;<span class="ident" id="4923231">zigEnd</span><span class="op" id="4923237">;</span>&nbsp;<span class="ident" id="4923239">zig</span><span class="op" id="4923242">++</span>&nbsp;<span class="op" id="4923245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923250">z</span>&nbsp;<span class="op" id="4923252">:=</span>&nbsp;<span class="builtintype" id="4923255">int32</span><span class="op" id="4923260">(</span><span class="num" id="4923261">0</span><span class="op" id="4923262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923267">value</span><span class="op" id="4923272">,</span>&nbsp;<span class="ident" id="4923274">err</span>&nbsp;<span class="op" id="4923278">:=</span>&nbsp;<span class="ident" id="4923281">d</span><span class="op" id="4923282">.</span><span class="ident" id="4923283">decodeHuffman</span><span class="op" id="4923296">(</span><span class="ident" id="4923297">h</span><span class="op" id="4923298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923303">if</span>&nbsp;<span class="ident" id="4923306">err</span>&nbsp;<span class="op" id="4923310">!=</span>&nbsp;<span class="builtintype" id="4923313">nil</span>&nbsp;<span class="op" id="4923317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923323">return</span>&nbsp;<span class="ident" id="4923330">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923342">val0</span>&nbsp;<span class="op" id="4923347">:=</span>&nbsp;<span class="ident" id="4923350">value</span>&nbsp;<span class="op" id="4923356">&gt;&gt;</span>&nbsp;<span class="num" id="4923359">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923364">val1</span>&nbsp;<span class="op" id="4923369">:=</span>&nbsp;<span class="ident" id="4923372">value</span>&nbsp;<span class="op" id="4923378">&amp;</span>&nbsp;<span class="num" id="4923380">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923389">switch</span>&nbsp;<span class="ident" id="4923396">val1</span>&nbsp;<span class="op" id="4923401">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923406">case</span>&nbsp;<span class="num" id="4923411">0</span><span class="op" id="4923412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923418">if</span>&nbsp;<span class="ident" id="4923421">val0</span>&nbsp;<span class="op" id="4923426">!=</span>&nbsp;<span class="num" id="4923429">0x0f</span>&nbsp;<span class="op" id="4923434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923441">d</span><span class="op" id="4923442">.</span><span class="ident" id="4923443">eobRun</span>&nbsp;<span class="op" id="4923450">=</span>&nbsp;<span class="builtintype" id="4923452">uint16</span><span class="op" id="4923458">(</span><span class="num" id="4923459">1</span>&nbsp;<span class="op" id="4923461">&lt;&lt;</span>&nbsp;<span class="ident" id="4923464">val0</span><span class="op" id="4923468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923475">if</span>&nbsp;<span class="ident" id="4923478">val0</span>&nbsp;<span class="op" id="4923483">!=</span>&nbsp;<span class="num" id="4923486">0</span>&nbsp;<span class="op" id="4923488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923496">bits</span><span class="op" id="4923500">,</span>&nbsp;<span class="ident" id="4923502">err</span>&nbsp;<span class="op" id="4923506">:=</span>&nbsp;<span class="ident" id="4923509">d</span><span class="op" id="4923510">.</span><span class="ident" id="4923511">decodeBits</span><span class="op" id="4923521">(</span><span class="builtintype" id="4923522">int32</span><span class="op" id="4923527">(</span><span class="ident" id="4923528">val0</span><span class="op" id="4923532">)</span><span class="op" id="4923533">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923541">if</span>&nbsp;<span class="ident" id="4923544">err</span>&nbsp;<span class="op" id="4923548">!=</span>&nbsp;<span class="builtintype" id="4923551">nil</span>&nbsp;<span class="op" id="4923555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923564">return</span>&nbsp;<span class="ident" id="4923571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923589">d</span><span class="op" id="4923590">.</span><span class="ident" id="4923591">eobRun</span>&nbsp;<span class="op" id="4923598">|=</span>&nbsp;<span class="builtintype" id="4923601">uint16</span><span class="op" id="4923607">(</span><span class="ident" id="4923608">bits</span><span class="op" id="4923612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923619">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923626">break</span>&nbsp;<span class="ident" id="4923632">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923646">case</span>&nbsp;<span class="num" id="4923651">1</span><span class="op" id="4923652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923658">z</span>&nbsp;<span class="op" id="4923660">=</span>&nbsp;<span class="ident" id="4923662">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923672">bit</span><span class="op" id="4923675">,</span>&nbsp;<span class="ident" id="4923677">err</span>&nbsp;<span class="op" id="4923681">:=</span>&nbsp;<span class="ident" id="4923684">d</span><span class="op" id="4923685">.</span><span class="ident" id="4923686">decodeBit</span><span class="op" id="4923695">(</span><span class="op" id="4923696">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923702">if</span>&nbsp;<span class="ident" id="4923705">err</span>&nbsp;<span class="op" id="4923709">!=</span>&nbsp;<span class="builtintype" id="4923712">nil</span>&nbsp;<span class="op" id="4923716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923723">return</span>&nbsp;<span class="ident" id="4923730">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923744">if</span>&nbsp;<span class="op" id="4923747">!</span><span class="ident" id="4923748">bit</span>&nbsp;<span class="op" id="4923752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923759">z</span>&nbsp;<span class="op" id="4923761">=</span>&nbsp;<span class="op" id="4923763">-</span><span class="ident" id="4923764">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923775">default</span><span class="op" id="4923782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923788">return</span>&nbsp;<span class="ident" id="4923795">FormatError</span><span class="op" id="4923806">(</span><span class="string" id="4923807">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="4923832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4923843">zig</span><span class="op" id="4923846">,</span>&nbsp;<span class="ident" id="4923848">err</span>&nbsp;<span class="op" id="4923852">=</span>&nbsp;<span class="ident" id="4923854">d</span><span class="op" id="4923855">.</span><span class="ident" id="4923856">refineNonZeroes</span><span class="op" id="4923871">(</span><span class="ident" id="4923872">b</span><span class="op" id="4923873">,</span>&nbsp;<span class="ident" id="4923875">zig</span><span class="op" id="4923878">,</span>&nbsp;<span class="ident" id="4923880">zigEnd</span><span class="op" id="4923886">,</span>&nbsp;<span class="builtintype" id="4923888">int32</span><span class="op" id="4923893">(</span><span class="ident" id="4923894">val0</span><span class="op" id="4923898">)</span><span class="op" id="4923899">,</span>&nbsp;<span class="ident" id="4923901">delta</span><span class="op" id="4923906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923911">if</span>&nbsp;<span class="ident" id="4923914">err</span>&nbsp;<span class="op" id="4923918">!=</span>&nbsp;<span class="builtintype" id="4923921">nil</span>&nbsp;<span class="op" id="4923925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923931">return</span>&nbsp;<span class="ident" id="4923938">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4923945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923950">if</span>&nbsp;<span class="ident" id="4923953">zig</span>&nbsp;<span class="op" id="4923957">&gt;</span>&nbsp;<span class="ident" id="4923959">zigEnd</span>&nbsp;<span class="op" id="4923966">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4923972">return</span>&nbsp;<span class="ident" id="4923979">FormatError</span><span class="op" id="4923990">(</span><span class="string" id="4923991">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="4924014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924024">if</span>&nbsp;<span class="ident" id="4924027">z</span>&nbsp;<span class="op" id="4924029">!=</span>&nbsp;<span class="num" id="4924032">0</span>&nbsp;<span class="op" id="4924034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924040">b</span><span class="op" id="4924041">[</span><span class="ident" id="4924042">unzig</span><span class="op" id="4924047">[</span><span class="ident" id="4924048">zig</span><span class="op" id="4924051">]</span><span class="op" id="4924052">]</span>&nbsp;<span class="op" id="4924054">=</span>&nbsp;<span class="ident" id="4924056">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924061">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924071">if</span>&nbsp;<span class="ident" id="4924074">d</span><span class="op" id="4924075">.</span><span class="ident" id="4924076">eobRun</span>&nbsp;<span class="op" id="4924083">&gt;</span>&nbsp;<span class="num" id="4924085">0</span>&nbsp;<span class="op" id="4924087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924091">d</span><span class="op" id="4924092">.</span><span class="ident" id="4924093">eobRun</span><span class="op" id="4924099">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924104">if</span>&nbsp;<span class="ident" id="4924107">_</span><span class="op" id="4924108">,</span>&nbsp;<span class="ident" id="4924110">err</span>&nbsp;<span class="op" id="4924114">:=</span>&nbsp;<span class="ident" id="4924117">d</span><span class="op" id="4924118">.</span><span class="ident" id="4924119">refineNonZeroes</span><span class="op" id="4924134">(</span><span class="ident" id="4924135">b</span><span class="op" id="4924136">,</span>&nbsp;<span class="ident" id="4924138">zig</span><span class="op" id="4924141">,</span>&nbsp;<span class="ident" id="4924143">zigEnd</span><span class="op" id="4924149">,</span>&nbsp;<span class="op" id="4924151">-</span><span class="num" id="4924152">1</span><span class="op" id="4924153">,</span>&nbsp;<span class="ident" id="4924155">delta</span><span class="op" id="4924160">)</span><span class="op" id="4924161">;</span>&nbsp;<span class="ident" id="4924163">err</span>&nbsp;<span class="op" id="4924167">!=</span>&nbsp;<span class="builtintype" id="4924170">nil</span>&nbsp;<span class="op" id="4924174">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924179">return</span>&nbsp;<span class="ident" id="4924186">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924198">return</span>&nbsp;<span class="builtintype" id="4924205">nil</span><br>
<span class="lineno"></span><span class="op" id="4924209">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="4924212">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="4924291">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="4924338">func</span>&nbsp;<span class="op" id="4924343">(</span><span class="ident" id="4924344">d</span>&nbsp;<span class="op" id="4924346">*</span><span class="ident" id="4924347">decoder</span><span class="op" id="4924354">)</span>&nbsp;<span class="ident" id="4924356">refineNonZeroes</span><span class="op" id="4924371">(</span><span class="ident" id="4924372">b</span>&nbsp;<span class="op" id="4924374">*</span><span class="ident" id="4924375">block</span><span class="op" id="4924380">,</span>&nbsp;<span class="ident" id="4924382">zig</span><span class="op" id="4924385">,</span>&nbsp;<span class="ident" id="4924387">zigEnd</span><span class="op" id="4924393">,</span>&nbsp;<span class="ident" id="4924395">nz</span><span class="op" id="4924397">,</span>&nbsp;<span class="ident" id="4924399">delta</span>&nbsp;<span class="builtintype" id="4924405">int32</span><span class="op" id="4924410">)</span>&nbsp;<span class="op" id="4924412">(</span><span class="builtintype" id="4924413">int32</span><span class="op" id="4924418">,</span>&nbsp;<span class="builtintype" id="4924420">error</span><span class="op" id="4924425">)</span>&nbsp;<span class="op" id="4924427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924430">for</span>&nbsp;<span class="op" id="4924434">;</span>&nbsp;<span class="ident" id="4924436">zig</span>&nbsp;<span class="op" id="4924440">&lt;=</span>&nbsp;<span class="ident" id="4924443">zigEnd</span><span class="op" id="4924449">;</span>&nbsp;<span class="ident" id="4924451">zig</span><span class="op" id="4924454">++</span>&nbsp;<span class="op" id="4924457">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924461">u</span>&nbsp;<span class="op" id="4924463">:=</span>&nbsp;<span class="ident" id="4924466">unzig</span><span class="op" id="4924471">[</span><span class="ident" id="4924472">zig</span><span class="op" id="4924475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924479">if</span>&nbsp;<span class="ident" id="4924482">b</span><span class="op" id="4924483">[</span><span class="ident" id="4924484">u</span><span class="op" id="4924485">]</span>&nbsp;<span class="op" id="4924487">==</span>&nbsp;<span class="num" id="4924490">0</span>&nbsp;<span class="op" id="4924492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924497">if</span>&nbsp;<span class="ident" id="4924500">nz</span>&nbsp;<span class="op" id="4924503">==</span>&nbsp;<span class="num" id="4924506">0</span>&nbsp;<span class="op" id="4924508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924514">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924523">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924528">nz</span><span class="op" id="4924530">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924536">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924551">bit</span><span class="op" id="4924554">,</span>&nbsp;<span class="ident" id="4924556">err</span>&nbsp;<span class="op" id="4924560">:=</span>&nbsp;<span class="ident" id="4924563">d</span><span class="op" id="4924564">.</span><span class="ident" id="4924565">decodeBit</span><span class="op" id="4924574">(</span><span class="op" id="4924575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924579">if</span>&nbsp;<span class="ident" id="4924582">err</span>&nbsp;<span class="op" id="4924586">!=</span>&nbsp;<span class="builtintype" id="4924589">nil</span>&nbsp;<span class="op" id="4924593">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924598">return</span>&nbsp;<span class="num" id="4924605">0</span><span class="op" id="4924606">,</span>&nbsp;<span class="ident" id="4924608">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924618">if</span>&nbsp;<span class="op" id="4924621">!</span><span class="ident" id="4924622">bit</span>&nbsp;<span class="op" id="4924626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924631">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924642">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924646">if</span>&nbsp;<span class="ident" id="4924649">b</span><span class="op" id="4924650">[</span><span class="ident" id="4924651">u</span><span class="op" id="4924652">]</span>&nbsp;<span class="op" id="4924654">&gt;=</span>&nbsp;<span class="num" id="4924657">0</span>&nbsp;<span class="op" id="4924659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924664">b</span><span class="op" id="4924665">[</span><span class="ident" id="4924666">u</span><span class="op" id="4924667">]</span>&nbsp;<span class="op" id="4924669">+=</span>&nbsp;<span class="ident" id="4924672">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924680">}</span>&nbsp;<span class="keyword" id="4924682">else</span>&nbsp;<span class="op" id="4924687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4924692">b</span><span class="op" id="4924693">[</span><span class="ident" id="4924694">u</span><span class="op" id="4924695">]</span>&nbsp;<span class="op" id="4924697">-=</span>&nbsp;<span class="ident" id="4924700">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924708">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4924711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4924714">return</span>&nbsp;<span class="ident" id="4924721">zig</span><span class="op" id="4924724">,</span>&nbsp;<span class="builtintype" id="4924726">nil</span><br>
<span class="lineno"></span><span class="op" id="4924730">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
