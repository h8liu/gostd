<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3540930">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3540986">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3541040">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3541091">package</span>&nbsp;<span class="ident" id="3541099">textproto</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3541110">import</span>&nbsp;<span class="op" id="3541117">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3541120">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3541129">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3541138">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3541144">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3541157">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3541168">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3541178">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3541181">//&nbsp;BUG(rsc):&nbsp;To&nbsp;let&nbsp;callers&nbsp;manage&nbsp;exposure&nbsp;to&nbsp;denial&nbsp;of&nbsp;service</span><br>
<span class="lineno"></span><span class="comment" id="3541246">//&nbsp;attacks,&nbsp;Reader&nbsp;should&nbsp;allow&nbsp;them&nbsp;to&nbsp;set&nbsp;and&nbsp;reset&nbsp;a&nbsp;limit&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3541311">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;from&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3541361">//&nbsp;A&nbsp;Reader&nbsp;implements&nbsp;convenience&nbsp;methods&nbsp;for&nbsp;reading&nbsp;requests</span><br>
<span class="lineno"></span><span class="comment" id="3541425">//&nbsp;or&nbsp;responses&nbsp;from&nbsp;a&nbsp;text&nbsp;protocol&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3541482">type</span>&nbsp;<span class="ident" id="3541487">Reader</span>&nbsp;<span class="keyword" id="3541494">struct</span>&nbsp;<span class="op" id="3541501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541504">R</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3541508">*</span><span class="ident" id="3541509">bufio</span><span class="op" id="3541514">.</span><span class="ident" id="3541515">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541523">dot</span>&nbsp;<span class="op" id="3541527">*</span><span class="ident" id="3541528">dotReader</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541539">buf</span>&nbsp;<span class="op" id="3541543">[</span><span class="op" id="3541544">]</span><span class="builtintype" id="3541545">byte</span>&nbsp;<span class="comment" id="3541550">//&nbsp;a&nbsp;re-usable&nbsp;buffer&nbsp;for&nbsp;readContinuedLineSlice</span><br>
<span class="lineno"></span><span class="op" id="3541599">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3541602">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="3541652">func</span>&nbsp;<span class="ident" id="3541657">NewReader</span><span class="op" id="3541666">(</span><span class="ident" id="3541667">r</span>&nbsp;<span class="op" id="3541669">*</span><span class="ident" id="3541670">bufio</span><span class="op" id="3541675">.</span><span class="ident" id="3541676">Reader</span><span class="op" id="3541682">)</span>&nbsp;<span class="op" id="3541684">*</span><span class="ident" id="3541685">Reader</span>&nbsp;<span class="op" id="3541692">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541695">return</span>&nbsp;<span class="op" id="3541702">&amp;</span><span class="ident" id="3541703">Reader</span><span class="op" id="3541709">{</span><span class="ident" id="3541710">R</span><span class="op" id="3541711">:</span>&nbsp;<span class="ident" id="3541713">r</span><span class="op" id="3541714">}</span><br>
<span class="lineno"></span><span class="op" id="3541716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3541719">//&nbsp;ReadLine&nbsp;reads&nbsp;a&nbsp;single&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3541759">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;\n&nbsp;or&nbsp;\r\n&nbsp;from&nbsp;the&nbsp;returned&nbsp;string.</span><br>
<span class="lineno">35</span><span class="keyword" id="3541817">func</span>&nbsp;<span class="op" id="3541822">(</span><span class="ident" id="3541823">r</span>&nbsp;<span class="op" id="3541825">*</span><span class="ident" id="3541826">Reader</span><span class="op" id="3541832">)</span>&nbsp;<span class="ident" id="3541834">ReadLine</span><span class="op" id="3541842">(</span><span class="op" id="3541843">)</span>&nbsp;<span class="op" id="3541845">(</span><span class="builtintype" id="3541846">string</span><span class="op" id="3541852">,</span>&nbsp;<span class="builtintype" id="3541854">error</span><span class="op" id="3541859">)</span>&nbsp;<span class="op" id="3541861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541864">line</span><span class="op" id="3541868">,</span>&nbsp;<span class="ident" id="3541870">err</span>&nbsp;<span class="op" id="3541874">:=</span>&nbsp;<span class="ident" id="3541877">r</span><span class="op" id="3541878">.</span><span class="ident" id="3541879">readLineSlice</span><span class="op" id="3541892">(</span><span class="op" id="3541893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541896">return</span>&nbsp;<span class="builtintype" id="3541903">string</span><span class="op" id="3541909">(</span><span class="ident" id="3541910">line</span><span class="op" id="3541914">)</span><span class="op" id="3541915">,</span>&nbsp;<span class="ident" id="3541917">err</span><br>
<span class="lineno"></span><span class="op" id="3541921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="3541924">//&nbsp;ReadLineBytes&nbsp;is&nbsp;like&nbsp;ReadLine&nbsp;but&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3542000">func</span>&nbsp;<span class="op" id="3542005">(</span><span class="ident" id="3542006">r</span>&nbsp;<span class="op" id="3542008">*</span><span class="ident" id="3542009">Reader</span><span class="op" id="3542015">)</span>&nbsp;<span class="ident" id="3542017">ReadLineBytes</span><span class="op" id="3542030">(</span><span class="op" id="3542031">)</span>&nbsp;<span class="op" id="3542033">(</span><span class="op" id="3542034">[</span><span class="op" id="3542035">]</span><span class="builtintype" id="3542036">byte</span><span class="op" id="3542040">,</span>&nbsp;<span class="builtintype" id="3542042">error</span><span class="op" id="3542047">)</span>&nbsp;<span class="op" id="3542049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542052">line</span><span class="op" id="3542056">,</span>&nbsp;<span class="ident" id="3542058">err</span>&nbsp;<span class="op" id="3542062">:=</span>&nbsp;<span class="ident" id="3542065">r</span><span class="op" id="3542066">.</span><span class="ident" id="3542067">readLineSlice</span><span class="op" id="3542080">(</span><span class="op" id="3542081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542084">if</span>&nbsp;<span class="ident" id="3542087">line</span>&nbsp;<span class="op" id="3542092">!=</span>&nbsp;<span class="ident" id="3542095">nil</span>&nbsp;<span class="op" id="3542099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542103">buf</span>&nbsp;<span class="op" id="3542107">:=</span>&nbsp;<span class="builtinfunc" id="3542110">make</span><span class="op" id="3542114">(</span><span class="op" id="3542115">[</span><span class="op" id="3542116">]</span><span class="builtintype" id="3542117">byte</span><span class="op" id="3542121">,</span>&nbsp;<span class="builtinfunc" id="3542123">len</span><span class="op" id="3542126">(</span><span class="ident" id="3542127">line</span><span class="op" id="3542131">)</span><span class="op" id="3542132">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3542136">copy</span><span class="op" id="3542140">(</span><span class="ident" id="3542141">buf</span><span class="op" id="3542144">,</span>&nbsp;<span class="ident" id="3542146">line</span><span class="op" id="3542150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542154">line</span>&nbsp;<span class="op" id="3542159">=</span>&nbsp;<span class="ident" id="3542161">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542169">return</span>&nbsp;<span class="ident" id="3542176">line</span><span class="op" id="3542180">,</span>&nbsp;<span class="ident" id="3542182">err</span><br>
<span class="lineno"></span><span class="op" id="3542186">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="3542189">func</span>&nbsp;<span class="op" id="3542194">(</span><span class="ident" id="3542195">r</span>&nbsp;<span class="op" id="3542197">*</span><span class="ident" id="3542198">Reader</span><span class="op" id="3542204">)</span>&nbsp;<span class="ident" id="3542206">readLineSlice</span><span class="op" id="3542219">(</span><span class="op" id="3542220">)</span>&nbsp;<span class="op" id="3542222">(</span><span class="op" id="3542223">[</span><span class="op" id="3542224">]</span><span class="builtintype" id="3542225">byte</span><span class="op" id="3542229">,</span>&nbsp;<span class="builtintype" id="3542231">error</span><span class="op" id="3542236">)</span>&nbsp;<span class="op" id="3542238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542241">r</span><span class="op" id="3542242">.</span><span class="ident" id="3542243">closeDot</span><span class="op" id="3542251">(</span><span class="op" id="3542252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542255">var</span>&nbsp;<span class="ident" id="3542259">line</span>&nbsp;<span class="op" id="3542264">[</span><span class="op" id="3542265">]</span><span class="builtintype" id="3542266">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542272">for</span>&nbsp;<span class="op" id="3542276">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542280">l</span><span class="op" id="3542281">,</span>&nbsp;<span class="ident" id="3542283">more</span><span class="op" id="3542287">,</span>&nbsp;<span class="ident" id="3542289">err</span>&nbsp;<span class="op" id="3542293">:=</span>&nbsp;<span class="ident" id="3542296">r</span><span class="op" id="3542297">.</span><span class="ident" id="3542298">R</span><span class="op" id="3542299">.</span><span class="ident" id="3542300">ReadLine</span><span class="op" id="3542308">(</span><span class="op" id="3542309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542313">if</span>&nbsp;<span class="ident" id="3542316">err</span>&nbsp;<span class="op" id="3542320">!=</span>&nbsp;<span class="ident" id="3542323">nil</span>&nbsp;<span class="op" id="3542327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542332">return</span>&nbsp;<span class="ident" id="3542339">nil</span><span class="op" id="3542342">,</span>&nbsp;<span class="ident" id="3542344">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542354">//&nbsp;Avoid&nbsp;the&nbsp;copy&nbsp;if&nbsp;the&nbsp;first&nbsp;call&nbsp;produced&nbsp;a&nbsp;full&nbsp;line.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542414">if</span>&nbsp;<span class="ident" id="3542417">line</span>&nbsp;<span class="op" id="3542422">==</span>&nbsp;<span class="ident" id="3542425">nil</span>&nbsp;<span class="op" id="3542429">&amp;&amp;</span>&nbsp;<span class="op" id="3542432">!</span><span class="ident" id="3542433">more</span>&nbsp;<span class="op" id="3542438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542443">return</span>&nbsp;<span class="ident" id="3542450">l</span><span class="op" id="3542451">,</span>&nbsp;<span class="ident" id="3542453">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542463">line</span>&nbsp;<span class="op" id="3542468">=</span>&nbsp;<span class="builtinfunc" id="3542470">append</span><span class="op" id="3542476">(</span><span class="ident" id="3542477">line</span><span class="op" id="3542481">,</span>&nbsp;<span class="ident" id="3542483">l</span><span class="op" id="3542484">...</span><span class="op" id="3542487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542491">if</span>&nbsp;<span class="op" id="3542494">!</span><span class="ident" id="3542495">more</span>&nbsp;<span class="op" id="3542500">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542505">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542519">return</span>&nbsp;<span class="ident" id="3542526">line</span><span class="op" id="3542530">,</span>&nbsp;<span class="ident" id="3542532">nil</span><br>
<span class="lineno"></span><span class="op" id="3542536">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="3542539">//&nbsp;ReadContinuedLine&nbsp;reads&nbsp;a&nbsp;possibly&nbsp;continued&nbsp;line&nbsp;from&nbsp;r,</span><br>
<span class="lineno"></span><span class="comment" id="3542600">//&nbsp;eliding&nbsp;the&nbsp;final&nbsp;trailing&nbsp;ASCII&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="3542649">//&nbsp;Lines&nbsp;after&nbsp;the&nbsp;first&nbsp;are&nbsp;considered&nbsp;continuations&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span><span class="comment" id="3542711">//&nbsp;begin&nbsp;with&nbsp;a&nbsp;space&nbsp;or&nbsp;tab&nbsp;character.&nbsp;&nbsp;In&nbsp;the&nbsp;returned&nbsp;data,</span><br>
<span class="lineno">75</span><span class="comment" id="3542774">//&nbsp;continuation&nbsp;lines&nbsp;are&nbsp;separated&nbsp;from&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3542833">//&nbsp;only&nbsp;by&nbsp;a&nbsp;single&nbsp;space:&nbsp;the&nbsp;newline&nbsp;and&nbsp;leading&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="3542896">//&nbsp;are&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3542912">//</span><br>
<span class="lineno"></span><span class="comment" id="3542915">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">80</span><span class="comment" id="3542952">//</span><br>
<span class="lineno"></span><span class="comment" id="3542955">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3542965">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;continued...</span><br>
<span class="lineno"></span><span class="comment" id="3542983">//&nbsp;&nbsp;&nbsp;&nbspLine&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3542993">//</span><br>
<span class="lineno">85</span><span class="comment" id="3542996">//&nbsp;The&nbsp;first&nbsp;call&nbsp;to&nbsp;ReadContinuedLine&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;1&nbsp;continued...&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3543069">//&nbsp;and&nbsp;the&nbsp;second&nbsp;will&nbsp;return&nbsp;&#34;Line&nbsp;2&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3543109">//</span><br>
<span class="lineno"></span><span class="comment" id="3543112">//&nbsp;A&nbsp;line&nbsp;consisting&nbsp;of&nbsp;only&nbsp;white&nbsp;space&nbsp;is&nbsp;never&nbsp;continued.</span><br>
<span class="lineno"></span><span class="comment" id="3543173">//</span><br>
<span class="lineno">90</span><span class="keyword" id="3543176">func</span>&nbsp;<span class="op" id="3543181">(</span><span class="ident" id="3543182">r</span>&nbsp;<span class="op" id="3543184">*</span><span class="ident" id="3543185">Reader</span><span class="op" id="3543191">)</span>&nbsp;<span class="ident" id="3543193">ReadContinuedLine</span><span class="op" id="3543210">(</span><span class="op" id="3543211">)</span>&nbsp;<span class="op" id="3543213">(</span><span class="builtintype" id="3543214">string</span><span class="op" id="3543220">,</span>&nbsp;<span class="builtintype" id="3543222">error</span><span class="op" id="3543227">)</span>&nbsp;<span class="op" id="3543229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543232">line</span><span class="op" id="3543236">,</span>&nbsp;<span class="ident" id="3543238">err</span>&nbsp;<span class="op" id="3543242">:=</span>&nbsp;<span class="ident" id="3543245">r</span><span class="op" id="3543246">.</span><span class="ident" id="3543247">readContinuedLineSlice</span><span class="op" id="3543269">(</span><span class="op" id="3543270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543273">return</span>&nbsp;<span class="builtintype" id="3543280">string</span><span class="op" id="3543286">(</span><span class="ident" id="3543287">line</span><span class="op" id="3543291">)</span><span class="op" id="3543292">,</span>&nbsp;<span class="ident" id="3543294">err</span><br>
<span class="lineno"></span><span class="op" id="3543298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3543301">//&nbsp;trim&nbsp;returns&nbsp;s&nbsp;with&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;spaces&nbsp;and&nbsp;tabs&nbsp;removed.</span><br>
<span class="lineno"></span><span class="comment" id="3543370">//&nbsp;It&nbsp;does&nbsp;not&nbsp;assume&nbsp;Unicode&nbsp;or&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="3543410">func</span>&nbsp;<span class="ident" id="3543415">trim</span><span class="op" id="3543419">(</span><span class="ident" id="3543420">s</span>&nbsp;<span class="op" id="3543422">[</span><span class="op" id="3543423">]</span><span class="builtintype" id="3543424">byte</span><span class="op" id="3543428">)</span>&nbsp;<span class="op" id="3543430">[</span><span class="op" id="3543431">]</span><span class="builtintype" id="3543432">byte</span>&nbsp;<span class="op" id="3543437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543440">i</span>&nbsp;<span class="op" id="3543442">:=</span>&nbsp;<span class="num" id="3543445">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543448">for</span>&nbsp;<span class="ident" id="3543452">i</span>&nbsp;<span class="op" id="3543454">&lt;</span>&nbsp;<span class="builtinfunc" id="3543456">len</span><span class="op" id="3543459">(</span><span class="ident" id="3543460">s</span><span class="op" id="3543461">)</span>&nbsp;<span class="op" id="3543463">&amp;&amp;</span>&nbsp;<span class="op" id="3543466">(</span><span class="ident" id="3543467">s</span><span class="op" id="3543468">[</span><span class="ident" id="3543469">i</span><span class="op" id="3543470">]</span>&nbsp;<span class="op" id="3543472">==</span>&nbsp;<span class="string" id="3543475">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3543479">||</span>&nbsp;<span class="ident" id="3543482">s</span><span class="op" id="3543483">[</span><span class="ident" id="3543484">i</span><span class="op" id="3543485">]</span>&nbsp;<span class="op" id="3543487">==</span>&nbsp;<span class="string" id="3543490">&#39;\t&#39;</span><span class="op" id="3543494">)</span>&nbsp;<span class="op" id="3543496">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543500">i</span><span class="op" id="3543501">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3543505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543508">n</span>&nbsp;<span class="op" id="3543510">:=</span>&nbsp;<span class="builtinfunc" id="3543513">len</span><span class="op" id="3543516">(</span><span class="ident" id="3543517">s</span><span class="op" id="3543518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543521">for</span>&nbsp;<span class="ident" id="3543525">n</span>&nbsp;<span class="op" id="3543527">&gt;</span>&nbsp;<span class="ident" id="3543529">i</span>&nbsp;<span class="op" id="3543531">&amp;&amp;</span>&nbsp;<span class="op" id="3543534">(</span><span class="ident" id="3543535">s</span><span class="op" id="3543536">[</span><span class="ident" id="3543537">n</span><span class="op" id="3543538">-</span><span class="num" id="3543539">1</span><span class="op" id="3543540">]</span>&nbsp;<span class="op" id="3543542">==</span>&nbsp;<span class="string" id="3543545">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3543549">||</span>&nbsp;<span class="ident" id="3543552">s</span><span class="op" id="3543553">[</span><span class="ident" id="3543554">n</span><span class="op" id="3543555">-</span><span class="num" id="3543556">1</span><span class="op" id="3543557">]</span>&nbsp;<span class="op" id="3543559">==</span>&nbsp;<span class="string" id="3543562">&#39;\t&#39;</span><span class="op" id="3543566">)</span>&nbsp;<span class="op" id="3543568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543572">n</span><span class="op" id="3543573">--</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3543577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543580">return</span>&nbsp;<span class="ident" id="3543587">s</span><span class="op" id="3543588">[</span><span class="ident" id="3543589">i</span><span class="op" id="3543590">:</span><span class="ident" id="3543591">n</span><span class="op" id="3543592">]</span><br>
<span class="lineno"></span><span class="op" id="3543594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3543597">//&nbsp;ReadContinuedLineBytes&nbsp;is&nbsp;like&nbsp;ReadContinuedLine&nbsp;but</span><br>
<span class="lineno">110</span><span class="comment" id="3543653">//&nbsp;returns&nbsp;a&nbsp;[]byte&nbsp;instead&nbsp;of&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3543694">func</span>&nbsp;<span class="op" id="3543699">(</span><span class="ident" id="3543700">r</span>&nbsp;<span class="op" id="3543702">*</span><span class="ident" id="3543703">Reader</span><span class="op" id="3543709">)</span>&nbsp;<span class="ident" id="3543711">ReadContinuedLineBytes</span><span class="op" id="3543733">(</span><span class="op" id="3543734">)</span>&nbsp;<span class="op" id="3543736">(</span><span class="op" id="3543737">[</span><span class="op" id="3543738">]</span><span class="builtintype" id="3543739">byte</span><span class="op" id="3543743">,</span>&nbsp;<span class="builtintype" id="3543745">error</span><span class="op" id="3543750">)</span>&nbsp;<span class="op" id="3543752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543755">line</span><span class="op" id="3543759">,</span>&nbsp;<span class="ident" id="3543761">err</span>&nbsp;<span class="op" id="3543765">:=</span>&nbsp;<span class="ident" id="3543768">r</span><span class="op" id="3543769">.</span><span class="ident" id="3543770">readContinuedLineSlice</span><span class="op" id="3543792">(</span><span class="op" id="3543793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543796">if</span>&nbsp;<span class="ident" id="3543799">line</span>&nbsp;<span class="op" id="3543804">!=</span>&nbsp;<span class="ident" id="3543807">nil</span>&nbsp;<span class="op" id="3543811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543815">buf</span>&nbsp;<span class="op" id="3543819">:=</span>&nbsp;<span class="builtinfunc" id="3543822">make</span><span class="op" id="3543826">(</span><span class="op" id="3543827">[</span><span class="op" id="3543828">]</span><span class="builtintype" id="3543829">byte</span><span class="op" id="3543833">,</span>&nbsp;<span class="builtinfunc" id="3543835">len</span><span class="op" id="3543838">(</span><span class="ident" id="3543839">line</span><span class="op" id="3543843">)</span><span class="op" id="3543844">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3543848">copy</span><span class="op" id="3543852">(</span><span class="ident" id="3543853">buf</span><span class="op" id="3543856">,</span>&nbsp;<span class="ident" id="3543858">line</span><span class="op" id="3543862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543866">line</span>&nbsp;<span class="op" id="3543871">=</span>&nbsp;<span class="ident" id="3543873">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3543878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543881">return</span>&nbsp;<span class="ident" id="3543888">line</span><span class="op" id="3543892">,</span>&nbsp;<span class="ident" id="3543894">err</span><br>
<span class="lineno"></span><span class="op" id="3543898">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="keyword" id="3543901">func</span>&nbsp;<span class="op" id="3543906">(</span><span class="ident" id="3543907">r</span>&nbsp;<span class="op" id="3543909">*</span><span class="ident" id="3543910">Reader</span><span class="op" id="3543916">)</span>&nbsp;<span class="ident" id="3543918">readContinuedLineSlice</span><span class="op" id="3543940">(</span><span class="op" id="3543941">)</span>&nbsp;<span class="op" id="3543943">(</span><span class="op" id="3543944">[</span><span class="op" id="3543945">]</span><span class="builtintype" id="3543946">byte</span><span class="op" id="3543950">,</span>&nbsp;<span class="builtintype" id="3543952">error</span><span class="op" id="3543957">)</span>&nbsp;<span class="op" id="3543959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543962">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543987">line</span><span class="op" id="3543991">,</span>&nbsp;<span class="ident" id="3543993">err</span>&nbsp;<span class="op" id="3543997">:=</span>&nbsp;<span class="ident" id="3544000">r</span><span class="op" id="3544001">.</span><span class="ident" id="3544002">readLineSlice</span><span class="op" id="3544015">(</span><span class="op" id="3544016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544019">if</span>&nbsp;<span class="ident" id="3544022">err</span>&nbsp;<span class="op" id="3544026">!=</span>&nbsp;<span class="ident" id="3544029">nil</span>&nbsp;<span class="op" id="3544033">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544037">return</span>&nbsp;<span class="ident" id="3544044">nil</span><span class="op" id="3544047">,</span>&nbsp;<span class="ident" id="3544049">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544057">if</span>&nbsp;<span class="builtinfunc" id="3544060">len</span><span class="op" id="3544063">(</span><span class="ident" id="3544064">line</span><span class="op" id="3544068">)</span>&nbsp;<span class="op" id="3544070">==</span>&nbsp;<span class="num" id="3544073">0</span>&nbsp;<span class="op" id="3544075">{</span>&nbsp;<span class="comment" id="3544077">//&nbsp;blank&nbsp;line&nbsp;-&nbsp;no&nbsp;continuation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544111">return</span>&nbsp;<span class="ident" id="3544118">line</span><span class="op" id="3544122">,</span>&nbsp;<span class="ident" id="3544124">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544129">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544133">//&nbsp;Optimistically&nbsp;assume&nbsp;that&nbsp;we&nbsp;have&nbsp;started&nbsp;to&nbsp;buffer&nbsp;the&nbsp;next&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544204">//&nbsp;and&nbsp;it&nbsp;starts&nbsp;with&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;(the&nbsp;next&nbsp;header&nbsp;key),&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544276">//&nbsp;avoid&nbsp;copying&nbsp;that&nbsp;buffered&nbsp;data&nbsp;around&nbsp;in&nbsp;memory&nbsp;and&nbsp;skipping&nbsp;over</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544348">//&nbsp;non-existent&nbsp;whitespace.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544377">if</span>&nbsp;<span class="ident" id="3544380">r</span><span class="op" id="3544381">.</span><span class="ident" id="3544382">R</span><span class="op" id="3544383">.</span><span class="ident" id="3544384">Buffered</span><span class="op" id="3544392">(</span><span class="op" id="3544393">)</span>&nbsp;<span class="op" id="3544395">&gt;</span>&nbsp;<span class="num" id="3544397">1</span>&nbsp;<span class="op" id="3544399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544403">peek</span><span class="op" id="3544407">,</span>&nbsp;<span class="ident" id="3544409">err</span>&nbsp;<span class="op" id="3544413">:=</span>&nbsp;<span class="ident" id="3544416">r</span><span class="op" id="3544417">.</span><span class="ident" id="3544418">R</span><span class="op" id="3544419">.</span><span class="ident" id="3544420">Peek</span><span class="op" id="3544424">(</span><span class="num" id="3544425">1</span><span class="op" id="3544426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544430">if</span>&nbsp;<span class="ident" id="3544433">err</span>&nbsp;<span class="op" id="3544437">==</span>&nbsp;<span class="ident" id="3544440">nil</span>&nbsp;<span class="op" id="3544444">&amp;&amp;</span>&nbsp;<span class="ident" id="3544447">isASCIILetter</span><span class="op" id="3544460">(</span><span class="ident" id="3544461">peek</span><span class="op" id="3544465">[</span><span class="num" id="3544466">0</span><span class="op" id="3544467">]</span><span class="op" id="3544468">)</span>&nbsp;<span class="op" id="3544470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544475">return</span>&nbsp;<span class="ident" id="3544482">trim</span><span class="op" id="3544486">(</span><span class="ident" id="3544487">line</span><span class="op" id="3544491">)</span><span class="op" id="3544492">,</span>&nbsp;<span class="ident" id="3544494">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544500">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544507">//&nbsp;ReadByte&nbsp;or&nbsp;the&nbsp;next&nbsp;readLineSlice&nbsp;will&nbsp;flush&nbsp;the&nbsp;read&nbsp;buffer;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544574">//&nbsp;copy&nbsp;the&nbsp;slice&nbsp;into&nbsp;buf.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544603">r</span><span class="op" id="3544604">.</span><span class="ident" id="3544605">buf</span>&nbsp;<span class="op" id="3544609">=</span>&nbsp;<span class="builtinfunc" id="3544611">append</span><span class="op" id="3544617">(</span><span class="ident" id="3544618">r</span><span class="op" id="3544619">.</span><span class="ident" id="3544620">buf</span><span class="op" id="3544623">[</span><span class="op" id="3544624">:</span><span class="num" id="3544625">0</span><span class="op" id="3544626">]</span><span class="op" id="3544627">,</span>&nbsp;<span class="ident" id="3544629">trim</span><span class="op" id="3544633">(</span><span class="ident" id="3544634">line</span><span class="op" id="3544638">)</span><span class="op" id="3544639">...</span><span class="op" id="3544642">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544646">//&nbsp;Read&nbsp;continuation&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544675">for</span>&nbsp;<span class="ident" id="3544679">r</span><span class="op" id="3544680">.</span><span class="ident" id="3544681">skipSpace</span><span class="op" id="3544690">(</span><span class="op" id="3544691">)</span>&nbsp;<span class="op" id="3544693">&gt;</span>&nbsp;<span class="num" id="3544695">0</span>&nbsp;<span class="op" id="3544697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544701">line</span><span class="op" id="3544705">,</span>&nbsp;<span class="ident" id="3544707">err</span>&nbsp;<span class="op" id="3544711">:=</span>&nbsp;<span class="ident" id="3544714">r</span><span class="op" id="3544715">.</span><span class="ident" id="3544716">readLineSlice</span><span class="op" id="3544729">(</span><span class="op" id="3544730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544734">if</span>&nbsp;<span class="ident" id="3544737">err</span>&nbsp;<span class="op" id="3544741">!=</span>&nbsp;<span class="ident" id="3544744">nil</span>&nbsp;<span class="op" id="3544748">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544753">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544765">r</span><span class="op" id="3544766">.</span><span class="ident" id="3544767">buf</span>&nbsp;<span class="op" id="3544771">=</span>&nbsp;<span class="builtinfunc" id="3544773">append</span><span class="op" id="3544779">(</span><span class="ident" id="3544780">r</span><span class="op" id="3544781">.</span><span class="ident" id="3544782">buf</span><span class="op" id="3544785">,</span>&nbsp;<span class="string" id="3544787">&#39;&nbsp;&#39;</span><span class="op" id="3544790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544794">r</span><span class="op" id="3544795">.</span><span class="ident" id="3544796">buf</span>&nbsp;<span class="op" id="3544800">=</span>&nbsp;<span class="builtinfunc" id="3544802">append</span><span class="op" id="3544808">(</span><span class="ident" id="3544809">r</span><span class="op" id="3544810">.</span><span class="ident" id="3544811">buf</span><span class="op" id="3544814">,</span>&nbsp;<span class="ident" id="3544816">line</span><span class="op" id="3544820">...</span><span class="op" id="3544823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544826">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544829">return</span>&nbsp;<span class="ident" id="3544836">r</span><span class="op" id="3544837">.</span><span class="ident" id="3544838">buf</span><span class="op" id="3544841">,</span>&nbsp;<span class="ident" id="3544843">nil</span><br>
<span class="lineno"></span><span class="op" id="3544847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3544850">//&nbsp;skipSpace&nbsp;skips&nbsp;R&nbsp;over&nbsp;all&nbsp;spaces&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="3544928">func</span>&nbsp;<span class="op" id="3544933">(</span><span class="ident" id="3544934">r</span>&nbsp;<span class="op" id="3544936">*</span><span class="ident" id="3544937">Reader</span><span class="op" id="3544943">)</span>&nbsp;<span class="ident" id="3544945">skipSpace</span><span class="op" id="3544954">(</span><span class="op" id="3544955">)</span>&nbsp;<span class="builtintype" id="3544957">int</span>&nbsp;<span class="op" id="3544961">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544964">n</span>&nbsp;<span class="op" id="3544966">:=</span>&nbsp;<span class="num" id="3544969">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544972">for</span>&nbsp;<span class="op" id="3544976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544980">c</span><span class="op" id="3544981">,</span>&nbsp;<span class="ident" id="3544983">err</span>&nbsp;<span class="op" id="3544987">:=</span>&nbsp;<span class="ident" id="3544990">r</span><span class="op" id="3544991">.</span><span class="ident" id="3544992">R</span><span class="op" id="3544993">.</span><span class="ident" id="3544994">ReadByte</span><span class="op" id="3545002">(</span><span class="op" id="3545003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545007">if</span>&nbsp;<span class="ident" id="3545010">err</span>&nbsp;<span class="op" id="3545014">!=</span>&nbsp;<span class="ident" id="3545017">nil</span>&nbsp;<span class="op" id="3545021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545026">//&nbsp;Bufio&nbsp;will&nbsp;keep&nbsp;err&nbsp;until&nbsp;next&nbsp;read.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545069">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545081">if</span>&nbsp;<span class="ident" id="3545084">c</span>&nbsp;<span class="op" id="3545086">!=</span>&nbsp;<span class="string" id="3545089">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3545093">&amp;&amp;</span>&nbsp;<span class="ident" id="3545096">c</span>&nbsp;<span class="op" id="3545098">!=</span>&nbsp;<span class="string" id="3545101">&#39;\t&#39;</span>&nbsp;<span class="op" id="3545106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545111">r</span><span class="op" id="3545112">.</span><span class="ident" id="3545113">R</span><span class="op" id="3545114">.</span><span class="ident" id="3545115">UnreadByte</span><span class="op" id="3545125">(</span><span class="op" id="3545126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545131">break</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545143">n</span><span class="op" id="3545144">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545151">return</span>&nbsp;<span class="ident" id="3545158">n</span><br>
<span class="lineno"></span><span class="op" id="3545160">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="keyword" id="3545163">func</span>&nbsp;<span class="op" id="3545168">(</span><span class="ident" id="3545169">r</span>&nbsp;<span class="op" id="3545171">*</span><span class="ident" id="3545172">Reader</span><span class="op" id="3545178">)</span>&nbsp;<span class="ident" id="3545180">readCodeLine</span><span class="op" id="3545192">(</span><span class="ident" id="3545193">expectCode</span>&nbsp;<span class="builtintype" id="3545204">int</span><span class="op" id="3545207">)</span>&nbsp;<span class="op" id="3545209">(</span><span class="ident" id="3545210">code</span>&nbsp;<span class="builtintype" id="3545215">int</span><span class="op" id="3545218">,</span>&nbsp;<span class="ident" id="3545220">continued</span>&nbsp;<span class="builtintype" id="3545230">bool</span><span class="op" id="3545234">,</span>&nbsp;<span class="ident" id="3545236">message</span>&nbsp;<span class="builtintype" id="3545244">string</span><span class="op" id="3545250">,</span>&nbsp;<span class="ident" id="3545252">err</span>&nbsp;<span class="builtintype" id="3545256">error</span><span class="op" id="3545261">)</span>&nbsp;<span class="op" id="3545263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545266">line</span><span class="op" id="3545270">,</span>&nbsp;<span class="ident" id="3545272">err</span>&nbsp;<span class="op" id="3545276">:=</span>&nbsp;<span class="ident" id="3545279">r</span><span class="op" id="3545280">.</span><span class="ident" id="3545281">ReadLine</span><span class="op" id="3545289">(</span><span class="op" id="3545290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545293">if</span>&nbsp;<span class="ident" id="3545296">err</span>&nbsp;<span class="op" id="3545300">!=</span>&nbsp;<span class="ident" id="3545303">nil</span>&nbsp;<span class="op" id="3545307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545311">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545322">return</span>&nbsp;<span class="ident" id="3545329">parseCodeLine</span><span class="op" id="3545342">(</span><span class="ident" id="3545343">line</span><span class="op" id="3545347">,</span>&nbsp;<span class="ident" id="3545349">expectCode</span><span class="op" id="3545359">)</span><br>
<span class="lineno"></span><span class="op" id="3545361">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3545364">func</span>&nbsp;<span class="ident" id="3545369">parseCodeLine</span><span class="op" id="3545382">(</span><span class="ident" id="3545383">line</span>&nbsp;<span class="builtintype" id="3545388">string</span><span class="op" id="3545394">,</span>&nbsp;<span class="ident" id="3545396">expectCode</span>&nbsp;<span class="builtintype" id="3545407">int</span><span class="op" id="3545410">)</span>&nbsp;<span class="op" id="3545412">(</span><span class="ident" id="3545413">code</span>&nbsp;<span class="builtintype" id="3545418">int</span><span class="op" id="3545421">,</span>&nbsp;<span class="ident" id="3545423">continued</span>&nbsp;<span class="builtintype" id="3545433">bool</span><span class="op" id="3545437">,</span>&nbsp;<span class="ident" id="3545439">message</span>&nbsp;<span class="builtintype" id="3545447">string</span><span class="op" id="3545453">,</span>&nbsp;<span class="ident" id="3545455">err</span>&nbsp;<span class="builtintype" id="3545459">error</span><span class="op" id="3545464">)</span>&nbsp;<span class="op" id="3545466">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545469">if</span>&nbsp;<span class="builtinfunc" id="3545472">len</span><span class="op" id="3545475">(</span><span class="ident" id="3545476">line</span><span class="op" id="3545480">)</span>&nbsp;<span class="op" id="3545482">&lt;</span>&nbsp;<span class="num" id="3545484">4</span>&nbsp;<span class="op" id="3545486">||</span>&nbsp;<span class="ident" id="3545489">line</span><span class="op" id="3545493">[</span><span class="num" id="3545494">3</span><span class="op" id="3545495">]</span>&nbsp;<span class="op" id="3545497">!=</span>&nbsp;<span class="string" id="3545500">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3545504">&amp;&amp;</span>&nbsp;<span class="ident" id="3545507">line</span><span class="op" id="3545511">[</span><span class="num" id="3545512">3</span><span class="op" id="3545513">]</span>&nbsp;<span class="op" id="3545515">!=</span>&nbsp;<span class="string" id="3545518">&#39;-&#39;</span>&nbsp;<span class="op" id="3545522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545526">err</span>&nbsp;<span class="op" id="3545530">=</span>&nbsp;<span class="ident" id="3545532">ProtocolError</span><span class="op" id="3545545">(</span><span class="string" id="3545546">&#34;short&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3545565">+</span>&nbsp;<span class="ident" id="3545567">line</span><span class="op" id="3545571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545575">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545586">continued</span>&nbsp;<span class="op" id="3545596">=</span>&nbsp;<span class="ident" id="3545598">line</span><span class="op" id="3545602">[</span><span class="num" id="3545603">3</span><span class="op" id="3545604">]</span>&nbsp;<span class="op" id="3545606">==</span>&nbsp;<span class="string" id="3545609">&#39;-&#39;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545614">code</span><span class="op" id="3545618">,</span>&nbsp;<span class="ident" id="3545620">err</span>&nbsp;<span class="op" id="3545624">=</span>&nbsp;<span class="ident" id="3545626">strconv</span><span class="op" id="3545633">.</span><span class="ident" id="3545634">Atoi</span><span class="op" id="3545638">(</span><span class="ident" id="3545639">line</span><span class="op" id="3545643">[</span><span class="num" id="3545644">0</span><span class="op" id="3545645">:</span><span class="num" id="3545646">3</span><span class="op" id="3545647">]</span><span class="op" id="3545648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545651">if</span>&nbsp;<span class="ident" id="3545654">err</span>&nbsp;<span class="op" id="3545658">!=</span>&nbsp;<span class="ident" id="3545661">nil</span>&nbsp;<span class="op" id="3545665">||</span>&nbsp;<span class="ident" id="3545668">code</span>&nbsp;<span class="op" id="3545673">&lt;</span>&nbsp;<span class="num" id="3545675">100</span>&nbsp;<span class="op" id="3545679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545683">err</span>&nbsp;<span class="op" id="3545687">=</span>&nbsp;<span class="ident" id="3545689">ProtocolError</span><span class="op" id="3545702">(</span><span class="string" id="3545703">&#34;invalid&nbsp;response&nbsp;code:&nbsp;&#34;</span>&nbsp;<span class="op" id="3545729">+</span>&nbsp;<span class="ident" id="3545731">line</span><span class="op" id="3545735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545739">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545747">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545750">message</span>&nbsp;<span class="op" id="3545758">=</span>&nbsp;<span class="ident" id="3545760">line</span><span class="op" id="3545764">[</span><span class="num" id="3545765">4</span><span class="op" id="3545766">:</span><span class="op" id="3545767">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545770">if</span>&nbsp;<span class="num" id="3545773">1</span>&nbsp;<span class="op" id="3545775">&lt;=</span>&nbsp;<span class="ident" id="3545778">expectCode</span>&nbsp;<span class="op" id="3545789">&amp;&amp;</span>&nbsp;<span class="ident" id="3545792">expectCode</span>&nbsp;<span class="op" id="3545803">&lt;</span>&nbsp;<span class="num" id="3545805">10</span>&nbsp;<span class="op" id="3545808">&amp;&amp;</span>&nbsp;<span class="ident" id="3545811">code</span><span class="op" id="3545815">/</span><span class="num" id="3545816">100</span>&nbsp;<span class="op" id="3545820">!=</span>&nbsp;<span class="ident" id="3545823">expectCode</span>&nbsp;<span class="op" id="3545834">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3545839">10</span>&nbsp;<span class="op" id="3545842">&lt;=</span>&nbsp;<span class="ident" id="3545845">expectCode</span>&nbsp;<span class="op" id="3545856">&amp;&amp;</span>&nbsp;<span class="ident" id="3545859">expectCode</span>&nbsp;<span class="op" id="3545870">&lt;</span>&nbsp;<span class="num" id="3545872">100</span>&nbsp;<span class="op" id="3545876">&amp;&amp;</span>&nbsp;<span class="ident" id="3545879">code</span><span class="op" id="3545883">/</span><span class="num" id="3545884">10</span>&nbsp;<span class="op" id="3545887">!=</span>&nbsp;<span class="ident" id="3545890">expectCode</span>&nbsp;<span class="op" id="3545901">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3545906">100</span>&nbsp;<span class="op" id="3545910">&lt;=</span>&nbsp;<span class="ident" id="3545913">expectCode</span>&nbsp;<span class="op" id="3545924">&amp;&amp;</span>&nbsp;<span class="ident" id="3545927">expectCode</span>&nbsp;<span class="op" id="3545938">&lt;</span>&nbsp;<span class="num" id="3545940">1000</span>&nbsp;<span class="op" id="3545945">&amp;&amp;</span>&nbsp;<span class="ident" id="3545948">code</span>&nbsp;<span class="op" id="3545953">!=</span>&nbsp;<span class="ident" id="3545956">expectCode</span>&nbsp;<span class="op" id="3545967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545971">err</span>&nbsp;<span class="op" id="3545975">=</span>&nbsp;<span class="op" id="3545977">&amp;</span><span class="ident" id="3545978">Error</span><span class="op" id="3545983">{</span><span class="ident" id="3545984">code</span><span class="op" id="3545988">,</span>&nbsp;<span class="ident" id="3545990">message</span><span class="op" id="3545997">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546003">return</span><br>
<span class="lineno"></span><span class="op" id="3546010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3546013">//&nbsp;ReadCodeLine&nbsp;reads&nbsp;a&nbsp;response&nbsp;code&nbsp;line&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno">205</span><span class="comment" id="3546068">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3546084">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code&nbsp;and&nbsp;the&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="3546143">//&nbsp;extends&nbsp;to&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;line.&nbsp;&nbsp;An&nbsp;example&nbsp;of&nbsp;such&nbsp;a&nbsp;line&nbsp;is:</span><br>
<span class="lineno"></span><span class="comment" id="3546210">//&nbsp;&nbsp;&nbsp;&nbsp220&nbsp;plan9.bell-labs.com&nbsp;ESMTP</span><br>
<span class="lineno"></span><span class="comment" id="3546243">//</span><br>
<span class="lineno">210</span><span class="comment" id="3546246">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3546318">//&nbsp;ReadCodeLine&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3546381">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3546447">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3546492">//</span><br>
<span class="lineno">215</span><span class="comment" id="3546495">//&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;multi-line,&nbsp;ReadCodeLine&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="3546560">//</span><br>
<span class="lineno"></span><span class="comment" id="3546563">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3546624">//</span><br>
<span class="lineno"></span><span class="keyword" id="3546627">func</span>&nbsp;<span class="op" id="3546632">(</span><span class="ident" id="3546633">r</span>&nbsp;<span class="op" id="3546635">*</span><span class="ident" id="3546636">Reader</span><span class="op" id="3546642">)</span>&nbsp;<span class="ident" id="3546644">ReadCodeLine</span><span class="op" id="3546656">(</span><span class="ident" id="3546657">expectCode</span>&nbsp;<span class="builtintype" id="3546668">int</span><span class="op" id="3546671">)</span>&nbsp;<span class="op" id="3546673">(</span><span class="ident" id="3546674">code</span>&nbsp;<span class="builtintype" id="3546679">int</span><span class="op" id="3546682">,</span>&nbsp;<span class="ident" id="3546684">message</span>&nbsp;<span class="builtintype" id="3546692">string</span><span class="op" id="3546698">,</span>&nbsp;<span class="ident" id="3546700">err</span>&nbsp;<span class="builtintype" id="3546704">error</span><span class="op" id="3546709">)</span>&nbsp;<span class="op" id="3546711">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546714">code</span><span class="op" id="3546718">,</span>&nbsp;<span class="ident" id="3546720">continued</span><span class="op" id="3546729">,</span>&nbsp;<span class="ident" id="3546731">message</span><span class="op" id="3546738">,</span>&nbsp;<span class="ident" id="3546740">err</span>&nbsp;<span class="op" id="3546744">:=</span>&nbsp;<span class="ident" id="3546747">r</span><span class="op" id="3546748">.</span><span class="ident" id="3546749">readCodeLine</span><span class="op" id="3546761">(</span><span class="ident" id="3546762">expectCode</span><span class="op" id="3546772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546775">if</span>&nbsp;<span class="ident" id="3546778">err</span>&nbsp;<span class="op" id="3546782">==</span>&nbsp;<span class="ident" id="3546785">nil</span>&nbsp;<span class="op" id="3546789">&amp;&amp;</span>&nbsp;<span class="ident" id="3546792">continued</span>&nbsp;<span class="op" id="3546802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546806">err</span>&nbsp;<span class="op" id="3546810">=</span>&nbsp;<span class="ident" id="3546812">ProtocolError</span><span class="op" id="3546825">(</span><span class="string" id="3546826">&#34;unexpected&nbsp;multi-line&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="3546861">+</span>&nbsp;<span class="ident" id="3546863">message</span><span class="op" id="3546870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546876">return</span><br>
<span class="lineno">225</span><span class="op" id="3546883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3546886">//&nbsp;ReadResponse&nbsp;reads&nbsp;a&nbsp;multi-line&nbsp;response&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3546943">//</span><br>
<span class="lineno"></span><span class="comment" id="3546946">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;1</span><br>
<span class="lineno">230</span><span class="comment" id="3546969">//&nbsp;&nbsp;&nbsp;&nbspcode-message&nbsp;line&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3546992">//&nbsp;&nbsp;&nbsp;&nbsp...</span><br>
<span class="lineno"></span><span class="comment" id="3546999">//&nbsp;&nbsp;&nbsp;&nbspcode&nbsp;message&nbsp;line&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="3547022">//</span><br>
<span class="lineno"></span><span class="comment" id="3547025">//&nbsp;where&nbsp;code&nbsp;is&nbsp;a&nbsp;three-digit&nbsp;status&nbsp;code.&nbsp;The&nbsp;first&nbsp;line&nbsp;starts&nbsp;with&nbsp;the</span><br>
<span class="lineno">235</span><span class="comment" id="3547100">//&nbsp;code&nbsp;and&nbsp;a&nbsp;hyphen.&nbsp;The&nbsp;response&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;line&nbsp;that&nbsp;starts</span><br>
<span class="lineno"></span><span class="comment" id="3547171">//&nbsp;with&nbsp;the&nbsp;same&nbsp;code&nbsp;followed&nbsp;by&nbsp;a&nbsp;space.&nbsp;Each&nbsp;line&nbsp;in&nbsp;message&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3547238">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;newline&nbsp;(\n).</span><br>
<span class="lineno"></span><span class="comment" id="3547270">//</span><br>
<span class="lineno"></span><span class="comment" id="3547273">//&nbsp;See&nbsp;page&nbsp;36&nbsp;of&nbsp;RFC&nbsp;959&nbsp;(http://www.ietf.org/rfc/rfc959.txt)&nbsp;for</span><br>
<span class="lineno">240</span><span class="comment" id="3547340">//&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="3547352">//</span><br>
<span class="lineno"></span><span class="comment" id="3547355">//&nbsp;If&nbsp;the&nbsp;prefix&nbsp;of&nbsp;the&nbsp;status&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;digits&nbsp;in&nbsp;expectCode,</span><br>
<span class="lineno"></span><span class="comment" id="3547427">//&nbsp;ReadResponse&nbsp;returns&nbsp;with&nbsp;err&nbsp;set&nbsp;to&nbsp;&amp;Error{code,&nbsp;message}.</span><br>
<span class="lineno"></span><span class="comment" id="3547490">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;expectCode&nbsp;is&nbsp;31,&nbsp;an&nbsp;error&nbsp;will&nbsp;be&nbsp;returned&nbsp;if</span><br>
<span class="lineno">245</span><span class="comment" id="3547556">//&nbsp;the&nbsp;status&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;range&nbsp;[310,319].</span><br>
<span class="lineno"></span><span class="comment" id="3547601">//</span><br>
<span class="lineno"></span><span class="comment" id="3547604">//&nbsp;An&nbsp;expectCode&nbsp;&lt;=&nbsp;0&nbsp;disables&nbsp;the&nbsp;check&nbsp;of&nbsp;the&nbsp;status&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="3547665">//</span><br>
<span class="lineno"></span><span class="keyword" id="3547668">func</span>&nbsp;<span class="op" id="3547673">(</span><span class="ident" id="3547674">r</span>&nbsp;<span class="op" id="3547676">*</span><span class="ident" id="3547677">Reader</span><span class="op" id="3547683">)</span>&nbsp;<span class="ident" id="3547685">ReadResponse</span><span class="op" id="3547697">(</span><span class="ident" id="3547698">expectCode</span>&nbsp;<span class="builtintype" id="3547709">int</span><span class="op" id="3547712">)</span>&nbsp;<span class="op" id="3547714">(</span><span class="ident" id="3547715">code</span>&nbsp;<span class="builtintype" id="3547720">int</span><span class="op" id="3547723">,</span>&nbsp;<span class="ident" id="3547725">message</span>&nbsp;<span class="builtintype" id="3547733">string</span><span class="op" id="3547739">,</span>&nbsp;<span class="ident" id="3547741">err</span>&nbsp;<span class="builtintype" id="3547745">error</span><span class="op" id="3547750">)</span>&nbsp;<span class="op" id="3547752">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547755">code</span><span class="op" id="3547759">,</span>&nbsp;<span class="ident" id="3547761">continued</span><span class="op" id="3547770">,</span>&nbsp;<span class="ident" id="3547772">message</span><span class="op" id="3547779">,</span>&nbsp;<span class="ident" id="3547781">err</span>&nbsp;<span class="op" id="3547785">:=</span>&nbsp;<span class="ident" id="3547788">r</span><span class="op" id="3547789">.</span><span class="ident" id="3547790">readCodeLine</span><span class="op" id="3547802">(</span><span class="ident" id="3547803">expectCode</span><span class="op" id="3547813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547816">for</span>&nbsp;<span class="ident" id="3547820">err</span>&nbsp;<span class="op" id="3547824">==</span>&nbsp;<span class="ident" id="3547827">nil</span>&nbsp;<span class="op" id="3547831">&amp;&amp;</span>&nbsp;<span class="ident" id="3547834">continued</span>&nbsp;<span class="op" id="3547844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547848">line</span><span class="op" id="3547852">,</span>&nbsp;<span class="ident" id="3547854">err</span>&nbsp;<span class="op" id="3547858">:=</span>&nbsp;<span class="ident" id="3547861">r</span><span class="op" id="3547862">.</span><span class="ident" id="3547863">ReadLine</span><span class="op" id="3547871">(</span><span class="op" id="3547872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547876">if</span>&nbsp;<span class="ident" id="3547879">err</span>&nbsp;<span class="op" id="3547883">!=</span>&nbsp;<span class="ident" id="3547886">nil</span>&nbsp;<span class="op" id="3547890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547895">return</span>&nbsp;<span class="num" id="3547902">0</span><span class="op" id="3547903">,</span>&nbsp;<span class="string" id="3547905">&#34;&#34;</span><span class="op" id="3547907">,</span>&nbsp;<span class="ident" id="3547909">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547920">var</span>&nbsp;<span class="ident" id="3547924">code2</span>&nbsp;<span class="builtintype" id="3547930">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547936">var</span>&nbsp;<span class="ident" id="3547940">moreMessage</span>&nbsp;<span class="builtintype" id="3547952">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547961">code2</span><span class="op" id="3547966">,</span>&nbsp;<span class="ident" id="3547968">continued</span><span class="op" id="3547977">,</span>&nbsp;<span class="ident" id="3547979">moreMessage</span><span class="op" id="3547990">,</span>&nbsp;<span class="ident" id="3547992">err</span>&nbsp;<span class="op" id="3547996">=</span>&nbsp;<span class="ident" id="3547998">parseCodeLine</span><span class="op" id="3548011">(</span><span class="ident" id="3548012">line</span><span class="op" id="3548016">,</span>&nbsp;<span class="ident" id="3548018">expectCode</span><span class="op" id="3548028">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548032">if</span>&nbsp;<span class="ident" id="3548035">err</span>&nbsp;<span class="op" id="3548039">!=</span>&nbsp;<span class="ident" id="3548042">nil</span>&nbsp;<span class="op" id="3548046">||</span>&nbsp;<span class="ident" id="3548049">code2</span>&nbsp;<span class="op" id="3548055">!=</span>&nbsp;<span class="ident" id="3548058">code</span>&nbsp;<span class="op" id="3548063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548068">message</span>&nbsp;<span class="op" id="3548076">+=</span>&nbsp;<span class="string" id="3548079">&#34;\n&#34;</span>&nbsp;<span class="op" id="3548084">+</span>&nbsp;<span class="ident" id="3548086">strings</span><span class="op" id="3548093">.</span><span class="ident" id="3548094">TrimRight</span><span class="op" id="3548103">(</span><span class="ident" id="3548104">line</span><span class="op" id="3548108">,</span>&nbsp;<span class="string" id="3548110">&#34;\r\n&#34;</span><span class="op" id="3548116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548121">continued</span>&nbsp;<span class="op" id="3548131">=</span>&nbsp;<span class="builtintype" id="3548133">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548141">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548152">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548156">message</span>&nbsp;<span class="op" id="3548164">+=</span>&nbsp;<span class="string" id="3548167">&#34;\n&#34;</span>&nbsp;<span class="op" id="3548172">+</span>&nbsp;<span class="ident" id="3548174">moreMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548190">return</span><br>
<span class="lineno"></span><span class="op" id="3548197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="3548200">//&nbsp;DotReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;that&nbsp;satisfies&nbsp;Reads&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3548265">//&nbsp;decoded&nbsp;text&nbsp;of&nbsp;a&nbsp;dot-encoded&nbsp;block&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3548317">//&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3548374">//&nbsp;to&nbsp;a&nbsp;method&nbsp;on&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3548395">//</span><br>
<span class="lineno">275</span><span class="comment" id="3548398">//&nbsp;Dot&nbsp;encoding&nbsp;is&nbsp;a&nbsp;common&nbsp;framing&nbsp;used&nbsp;for&nbsp;data&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="3548455">//&nbsp;in&nbsp;text&nbsp;protocols&nbsp;such&nbsp;as&nbsp;SMTP.&nbsp;&nbsp;The&nbsp;data&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="3548523">//&nbsp;of&nbsp;lines,&nbsp;each&nbsp;of&nbsp;which&nbsp;ends&nbsp;in&nbsp;&#34;\r\n&#34;.&nbsp;&nbsp;The&nbsp;sequence&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="3548587">//&nbsp;ends&nbsp;at&nbsp;a&nbsp;line&nbsp;containing&nbsp;just&nbsp;a&nbsp;dot:&nbsp;&#34;.\r\n&#34;.&nbsp;&nbsp;Lines&nbsp;beginning</span><br>
<span class="lineno"></span><span class="comment" id="3548654">//&nbsp;with&nbsp;a&nbsp;dot&nbsp;are&nbsp;escaped&nbsp;with&nbsp;an&nbsp;additional&nbsp;dot&nbsp;to&nbsp;avoid</span><br>
<span class="lineno">280</span><span class="comment" id="3548712">//&nbsp;looking&nbsp;like&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="3548753">//</span><br>
<span class="lineno"></span><span class="comment" id="3548756">//&nbsp;The&nbsp;decoded&nbsp;form&nbsp;returned&nbsp;by&nbsp;the&nbsp;Reader&#39;s&nbsp;Read&nbsp;method</span><br>
<span class="lineno"></span><span class="comment" id="3548813">//&nbsp;rewrites&nbsp;the&nbsp;&#34;\r\n&#34;&nbsp;line&nbsp;endings&nbsp;into&nbsp;the&nbsp;simpler&nbsp;&#34;\n&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="3548872">//&nbsp;removes&nbsp;leading&nbsp;dot&nbsp;escapes&nbsp;if&nbsp;present,&nbsp;and&nbsp;stops&nbsp;with&nbsp;error&nbsp;io.EOF</span><br>
<span class="lineno">285</span><span class="comment" id="3548943">//&nbsp;after&nbsp;consuming&nbsp;(and&nbsp;discarding)&nbsp;the&nbsp;end-of-sequence&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3549005">func</span>&nbsp;<span class="op" id="3549010">(</span><span class="ident" id="3549011">r</span>&nbsp;<span class="op" id="3549013">*</span><span class="ident" id="3549014">Reader</span><span class="op" id="3549020">)</span>&nbsp;<span class="ident" id="3549022">DotReader</span><span class="op" id="3549031">(</span><span class="op" id="3549032">)</span>&nbsp;<span class="ident" id="3549034">io</span><span class="op" id="3549036">.</span><span class="ident" id="3549037">Reader</span>&nbsp;<span class="op" id="3549044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549047">r</span><span class="op" id="3549048">.</span><span class="ident" id="3549049">closeDot</span><span class="op" id="3549057">(</span><span class="op" id="3549058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549061">r</span><span class="op" id="3549062">.</span><span class="ident" id="3549063">dot</span>&nbsp;<span class="op" id="3549067">=</span>&nbsp;<span class="op" id="3549069">&amp;</span><span class="ident" id="3549070">dotReader</span><span class="op" id="3549079">{</span><span class="ident" id="3549080">r</span><span class="op" id="3549081">:</span>&nbsp;<span class="ident" id="3549083">r</span><span class="op" id="3549084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549087">return</span>&nbsp;<span class="ident" id="3549094">r</span><span class="op" id="3549095">.</span><span class="ident" id="3549096">dot</span><br>
<span class="lineno">290</span><span class="op" id="3549100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3549103">type</span>&nbsp;<span class="ident" id="3549108">dotReader</span>&nbsp;<span class="keyword" id="3549118">struct</span>&nbsp;<span class="op" id="3549125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549128">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3549134">*</span><span class="ident" id="3549135">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549143">state</span>&nbsp;<span class="builtintype" id="3549149">int</span><br>
<span class="lineno">295</span><span class="op" id="3549153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3549156">//&nbsp;Read&nbsp;satisfies&nbsp;reads&nbsp;by&nbsp;decoding&nbsp;dot-encoded&nbsp;data&nbsp;read&nbsp;from&nbsp;d.r.</span><br>
<span class="lineno"></span><span class="keyword" id="3549224">func</span>&nbsp;<span class="op" id="3549229">(</span><span class="ident" id="3549230">d</span>&nbsp;<span class="op" id="3549232">*</span><span class="ident" id="3549233">dotReader</span><span class="op" id="3549242">)</span>&nbsp;<span class="ident" id="3549244">Read</span><span class="op" id="3549248">(</span><span class="ident" id="3549249">b</span>&nbsp;<span class="op" id="3549251">[</span><span class="op" id="3549252">]</span><span class="builtintype" id="3549253">byte</span><span class="op" id="3549257">)</span>&nbsp;<span class="op" id="3549259">(</span><span class="ident" id="3549260">n</span>&nbsp;<span class="builtintype" id="3549262">int</span><span class="op" id="3549265">,</span>&nbsp;<span class="ident" id="3549267">err</span>&nbsp;<span class="builtintype" id="3549271">error</span><span class="op" id="3549276">)</span>&nbsp;<span class="op" id="3549278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549281">//&nbsp;Run&nbsp;data&nbsp;through&nbsp;a&nbsp;simple&nbsp;state&nbsp;machine&nbsp;to</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549328">//&nbsp;elide&nbsp;leading&nbsp;dots,&nbsp;rewrite&nbsp;trailing&nbsp;\r\n&nbsp;into&nbsp;\n,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549383">//&nbsp;and&nbsp;detect&nbsp;ending&nbsp;.\r\n&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549417">const</span>&nbsp;<span class="op" id="3549423">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549427">stateBeginLine</span>&nbsp;<span class="op" id="3549442">=</span>&nbsp;<span class="ident" id="3549444">iota</span>&nbsp;<span class="comment" id="3549449">//&nbsp;beginning&nbsp;of&nbsp;line;&nbsp;initial&nbsp;state;&nbsp;must&nbsp;be&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549501">stateDot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549523">//&nbsp;read&nbsp;.&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549556">stateDotCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549578">//&nbsp;read&nbsp;.\r&nbsp;at&nbsp;beginning&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549613">stateCR</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549635">//&nbsp;read&nbsp;\r&nbsp;(possibly&nbsp;at&nbsp;end&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549674">stateData</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549696">//&nbsp;reading&nbsp;data&nbsp;in&nbsp;middle&nbsp;of&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549732">stateEOF</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3549754">//&nbsp;reached&nbsp;.\r\n&nbsp;end&nbsp;marker&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549788">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549791">br</span>&nbsp;<span class="op" id="3549794">:=</span>&nbsp;<span class="ident" id="3549797">d</span><span class="op" id="3549798">.</span><span class="ident" id="3549799">r</span><span class="op" id="3549800">.</span><span class="ident" id="3549801">R</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549804">for</span>&nbsp;<span class="ident" id="3549808">n</span>&nbsp;<span class="op" id="3549810">&lt;</span>&nbsp;<span class="builtinfunc" id="3549812">len</span><span class="op" id="3549815">(</span><span class="ident" id="3549816">b</span><span class="op" id="3549817">)</span>&nbsp;<span class="op" id="3549819">&amp;&amp;</span>&nbsp;<span class="ident" id="3549822">d</span><span class="op" id="3549823">.</span><span class="ident" id="3549824">state</span>&nbsp;<span class="op" id="3549830">!=</span>&nbsp;<span class="ident" id="3549833">stateEOF</span>&nbsp;<span class="op" id="3549842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549846">var</span>&nbsp;<span class="ident" id="3549850">c</span>&nbsp;<span class="builtintype" id="3549852">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549859">c</span><span class="op" id="3549860">,</span>&nbsp;<span class="ident" id="3549862">err</span>&nbsp;<span class="op" id="3549866">=</span>&nbsp;<span class="ident" id="3549868">br</span><span class="op" id="3549870">.</span><span class="ident" id="3549871">ReadByte</span><span class="op" id="3549879">(</span><span class="op" id="3549880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549884">if</span>&nbsp;<span class="ident" id="3549887">err</span>&nbsp;<span class="op" id="3549891">!=</span>&nbsp;<span class="ident" id="3549894">nil</span>&nbsp;<span class="op" id="3549898">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549903">if</span>&nbsp;<span class="ident" id="3549906">err</span>&nbsp;<span class="op" id="3549910">==</span>&nbsp;<span class="ident" id="3549913">io</span><span class="op" id="3549915">.</span><span class="ident" id="3549916">EOF</span>&nbsp;<span class="op" id="3549920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549926">err</span>&nbsp;<span class="op" id="3549930">=</span>&nbsp;<span class="ident" id="3549932">io</span><span class="op" id="3549934">.</span><span class="ident" id="3549935">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549960">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549968">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549972">switch</span>&nbsp;<span class="ident" id="3549979">d</span><span class="op" id="3549980">.</span><span class="ident" id="3549981">state</span>&nbsp;<span class="op" id="3549987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549991">case</span>&nbsp;<span class="ident" id="3549996">stateBeginLine</span><span class="op" id="3550010">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550015">if</span>&nbsp;<span class="ident" id="3550018">c</span>&nbsp;<span class="op" id="3550020">==</span>&nbsp;<span class="string" id="3550023">&#39;.&#39;</span>&nbsp;<span class="op" id="3550027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550033">d</span><span class="op" id="3550034">.</span><span class="ident" id="3550035">state</span>&nbsp;<span class="op" id="3550041">=</span>&nbsp;<span class="ident" id="3550043">stateDot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550056">continue</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550073">if</span>&nbsp;<span class="ident" id="3550076">c</span>&nbsp;<span class="op" id="3550078">==</span>&nbsp;<span class="string" id="3550081">&#39;\r&#39;</span>&nbsp;<span class="op" id="3550086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550092">d</span><span class="op" id="3550093">.</span><span class="ident" id="3550094">state</span>&nbsp;<span class="op" id="3550100">=</span>&nbsp;<span class="ident" id="3550102">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550114">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550126">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550131">d</span><span class="op" id="3550132">.</span><span class="ident" id="3550133">state</span>&nbsp;<span class="op" id="3550139">=</span>&nbsp;<span class="ident" id="3550141">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550154">case</span>&nbsp;<span class="ident" id="3550159">stateDot</span><span class="op" id="3550167">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550172">if</span>&nbsp;<span class="ident" id="3550175">c</span>&nbsp;<span class="op" id="3550177">==</span>&nbsp;<span class="string" id="3550180">&#39;\r&#39;</span>&nbsp;<span class="op" id="3550185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550191">d</span><span class="op" id="3550192">.</span><span class="ident" id="3550193">state</span>&nbsp;<span class="op" id="3550199">=</span>&nbsp;<span class="ident" id="3550201">stateDotCR</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550216">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550233">if</span>&nbsp;<span class="ident" id="3550236">c</span>&nbsp;<span class="op" id="3550238">==</span>&nbsp;<span class="string" id="3550241">&#39;\n&#39;</span>&nbsp;<span class="op" id="3550246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550252">d</span><span class="op" id="3550253">.</span><span class="ident" id="3550254">state</span>&nbsp;<span class="op" id="3550260">=</span>&nbsp;<span class="ident" id="3550262">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550275">continue</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550292">d</span><span class="op" id="3550293">.</span><span class="ident" id="3550294">state</span>&nbsp;<span class="op" id="3550300">=</span>&nbsp;<span class="ident" id="3550302">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550315">case</span>&nbsp;<span class="ident" id="3550320">stateDotCR</span><span class="op" id="3550330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550335">if</span>&nbsp;<span class="ident" id="3550338">c</span>&nbsp;<span class="op" id="3550340">==</span>&nbsp;<span class="string" id="3550343">&#39;\n&#39;</span>&nbsp;<span class="op" id="3550348">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550354">d</span><span class="op" id="3550355">.</span><span class="ident" id="3550356">state</span>&nbsp;<span class="op" id="3550362">=</span>&nbsp;<span class="ident" id="3550364">stateEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550377">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550394">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;.\r\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550419">//&nbsp;Consume&nbsp;leading&nbsp;dot&nbsp;and&nbsp;emit&nbsp;saved&nbsp;\r.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550464">br</span><span class="op" id="3550466">.</span><span class="ident" id="3550467">UnreadByte</span><span class="op" id="3550477">(</span><span class="op" id="3550478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550483">c</span>&nbsp;<span class="op" id="3550485">=</span>&nbsp;<span class="string" id="3550487">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550495">d</span><span class="op" id="3550496">.</span><span class="ident" id="3550497">state</span>&nbsp;<span class="op" id="3550503">=</span>&nbsp;<span class="ident" id="3550505">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550518">case</span>&nbsp;<span class="ident" id="3550523">stateCR</span><span class="op" id="3550530">:</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550535">if</span>&nbsp;<span class="ident" id="3550538">c</span>&nbsp;<span class="op" id="3550540">==</span>&nbsp;<span class="string" id="3550543">&#39;\n&#39;</span>&nbsp;<span class="op" id="3550548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550554">d</span><span class="op" id="3550555">.</span><span class="ident" id="3550556">state</span>&nbsp;<span class="op" id="3550562">=</span>&nbsp;<span class="ident" id="3550564">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550583">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550597">//&nbsp;Not&nbsp;part&nbsp;of&nbsp;\r\n.&nbsp;&nbsp;Emit&nbsp;saved&nbsp;\r</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550636">br</span><span class="op" id="3550638">.</span><span class="ident" id="3550639">UnreadByte</span><span class="op" id="3550649">(</span><span class="op" id="3550650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550655">c</span>&nbsp;<span class="op" id="3550657">=</span>&nbsp;<span class="string" id="3550659">&#39;\r&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550667">d</span><span class="op" id="3550668">.</span><span class="ident" id="3550669">state</span>&nbsp;<span class="op" id="3550675">=</span>&nbsp;<span class="ident" id="3550677">stateData</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550690">case</span>&nbsp;<span class="ident" id="3550695">stateData</span><span class="op" id="3550704">:</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550709">if</span>&nbsp;<span class="ident" id="3550712">c</span>&nbsp;<span class="op" id="3550714">==</span>&nbsp;<span class="string" id="3550717">&#39;\r&#39;</span>&nbsp;<span class="op" id="3550722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550728">d</span><span class="op" id="3550729">.</span><span class="ident" id="3550730">state</span>&nbsp;<span class="op" id="3550736">=</span>&nbsp;<span class="ident" id="3550738">stateCR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550750">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550767">if</span>&nbsp;<span class="ident" id="3550770">c</span>&nbsp;<span class="op" id="3550772">==</span>&nbsp;<span class="string" id="3550775">&#39;\n&#39;</span>&nbsp;<span class="op" id="3550780">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550786">d</span><span class="op" id="3550787">.</span><span class="ident" id="3550788">state</span>&nbsp;<span class="op" id="3550794">=</span>&nbsp;<span class="ident" id="3550796">stateBeginLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550822">b</span><span class="op" id="3550823">[</span><span class="ident" id="3550824">n</span><span class="op" id="3550825">]</span>&nbsp;<span class="op" id="3550827">=</span>&nbsp;<span class="ident" id="3550829">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550833">n</span><span class="op" id="3550834">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550841">if</span>&nbsp;<span class="ident" id="3550844">err</span>&nbsp;<span class="op" id="3550848">==</span>&nbsp;<span class="ident" id="3550851">nil</span>&nbsp;<span class="op" id="3550855">&amp;&amp;</span>&nbsp;<span class="ident" id="3550858">d</span><span class="op" id="3550859">.</span><span class="ident" id="3550860">state</span>&nbsp;<span class="op" id="3550866">==</span>&nbsp;<span class="ident" id="3550869">stateEOF</span>&nbsp;<span class="op" id="3550878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550882">err</span>&nbsp;<span class="op" id="3550886">=</span>&nbsp;<span class="ident" id="3550888">io</span><span class="op" id="3550890">.</span><span class="ident" id="3550891">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550899">if</span>&nbsp;<span class="ident" id="3550902">err</span>&nbsp;<span class="op" id="3550906">!=</span>&nbsp;<span class="ident" id="3550909">nil</span>&nbsp;<span class="op" id="3550913">&amp;&amp;</span>&nbsp;<span class="ident" id="3550916">d</span><span class="op" id="3550917">.</span><span class="ident" id="3550918">r</span><span class="op" id="3550919">.</span><span class="ident" id="3550920">dot</span>&nbsp;<span class="op" id="3550924">==</span>&nbsp;<span class="ident" id="3550927">d</span>&nbsp;<span class="op" id="3550929">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550933">d</span><span class="op" id="3550934">.</span><span class="ident" id="3550935">r</span><span class="op" id="3550936">.</span><span class="ident" id="3550937">dot</span>&nbsp;<span class="op" id="3550941">=</span>&nbsp;<span class="ident" id="3550943">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550951">return</span><br>
<span class="lineno"></span><span class="op" id="3550958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="3550961">//&nbsp;closeDot&nbsp;drains&nbsp;the&nbsp;current&nbsp;DotReader&nbsp;if&nbsp;any,</span><br>
<span class="lineno"></span><span class="comment" id="3551010">//&nbsp;making&nbsp;sure&nbsp;that&nbsp;it&nbsp;reads&nbsp;until&nbsp;the&nbsp;ending&nbsp;dot&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="3551066">func</span>&nbsp;<span class="op" id="3551071">(</span><span class="ident" id="3551072">r</span>&nbsp;<span class="op" id="3551074">*</span><span class="ident" id="3551075">Reader</span><span class="op" id="3551081">)</span>&nbsp;<span class="ident" id="3551083">closeDot</span><span class="op" id="3551091">(</span><span class="op" id="3551092">)</span>&nbsp;<span class="op" id="3551094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551097">if</span>&nbsp;<span class="ident" id="3551100">r</span><span class="op" id="3551101">.</span><span class="ident" id="3551102">dot</span>&nbsp;<span class="op" id="3551106">==</span>&nbsp;<span class="ident" id="3551109">nil</span>&nbsp;<span class="op" id="3551113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551117">return</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551128">buf</span>&nbsp;<span class="op" id="3551132">:=</span>&nbsp;<span class="builtinfunc" id="3551135">make</span><span class="op" id="3551139">(</span><span class="op" id="3551140">[</span><span class="op" id="3551141">]</span><span class="builtintype" id="3551142">byte</span><span class="op" id="3551146">,</span>&nbsp;<span class="num" id="3551148">128</span><span class="op" id="3551151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551154">for</span>&nbsp;<span class="ident" id="3551158">r</span><span class="op" id="3551159">.</span><span class="ident" id="3551160">dot</span>&nbsp;<span class="op" id="3551164">!=</span>&nbsp;<span class="ident" id="3551167">nil</span>&nbsp;<span class="op" id="3551171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551175">//&nbsp;When&nbsp;Read&nbsp;reaches&nbsp;EOF&nbsp;or&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551215">//&nbsp;it&nbsp;will&nbsp;set&nbsp;r.dot&nbsp;==&nbsp;nil.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551246">r</span><span class="op" id="3551247">.</span><span class="ident" id="3551248">dot</span><span class="op" id="3551251">.</span><span class="ident" id="3551252">Read</span><span class="op" id="3551256">(</span><span class="ident" id="3551257">buf</span><span class="op" id="3551260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551263">}</span><br>
<span class="lineno"></span><span class="op" id="3551265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3551268">//&nbsp;ReadDotBytes&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;the&nbsp;decoded&nbsp;data.</span><br>
<span class="lineno">400</span><span class="comment" id="3551335">//</span><br>
<span class="lineno"></span><span class="comment" id="3551338">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="3551420">func</span>&nbsp;<span class="op" id="3551425">(</span><span class="ident" id="3551426">r</span>&nbsp;<span class="op" id="3551428">*</span><span class="ident" id="3551429">Reader</span><span class="op" id="3551435">)</span>&nbsp;<span class="ident" id="3551437">ReadDotBytes</span><span class="op" id="3551449">(</span><span class="op" id="3551450">)</span>&nbsp;<span class="op" id="3551452">(</span><span class="op" id="3551453">[</span><span class="op" id="3551454">]</span><span class="builtintype" id="3551455">byte</span><span class="op" id="3551459">,</span>&nbsp;<span class="builtintype" id="3551461">error</span><span class="op" id="3551466">)</span>&nbsp;<span class="op" id="3551468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551471">return</span>&nbsp;<span class="ident" id="3551478">ioutil</span><span class="op" id="3551484">.</span><span class="ident" id="3551485">ReadAll</span><span class="op" id="3551492">(</span><span class="ident" id="3551493">r</span><span class="op" id="3551494">.</span><span class="ident" id="3551495">DotReader</span><span class="op" id="3551504">(</span><span class="op" id="3551505">)</span><span class="op" id="3551506">)</span><br>
<span class="lineno"></span><span class="op" id="3551508">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="3551511">//&nbsp;ReadDotLines&nbsp;reads&nbsp;a&nbsp;dot-encoding&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="3551568">//&nbsp;containing&nbsp;the&nbsp;decoded&nbsp;lines,&nbsp;with&nbsp;the&nbsp;final&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;elided&nbsp;from&nbsp;each.</span><br>
<span class="lineno"></span><span class="comment" id="3551645">//</span><br>
<span class="lineno"></span><span class="comment" id="3551648">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;DotReader&nbsp;method&nbsp;for&nbsp;details&nbsp;about&nbsp;dot-encoding.</span><br>
<span class="lineno">410</span><span class="keyword" id="3551730">func</span>&nbsp;<span class="op" id="3551735">(</span><span class="ident" id="3551736">r</span>&nbsp;<span class="op" id="3551738">*</span><span class="ident" id="3551739">Reader</span><span class="op" id="3551745">)</span>&nbsp;<span class="ident" id="3551747">ReadDotLines</span><span class="op" id="3551759">(</span><span class="op" id="3551760">)</span>&nbsp;<span class="op" id="3551762">(</span><span class="op" id="3551763">[</span><span class="op" id="3551764">]</span><span class="builtintype" id="3551765">string</span><span class="op" id="3551771">,</span>&nbsp;<span class="builtintype" id="3551773">error</span><span class="op" id="3551778">)</span>&nbsp;<span class="op" id="3551780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551783">//&nbsp;We&nbsp;could&nbsp;use&nbsp;ReadDotBytes&nbsp;and&nbsp;then&nbsp;Split&nbsp;it,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551832">//&nbsp;but&nbsp;reading&nbsp;a&nbsp;line&nbsp;at&nbsp;a&nbsp;time&nbsp;avoids&nbsp;needing&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551882">//&nbsp;large&nbsp;contiguous&nbsp;block&nbsp;of&nbsp;memory&nbsp;and&nbsp;is&nbsp;simpler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551935">var</span>&nbsp;<span class="ident" id="3551939">v</span>&nbsp;<span class="op" id="3551941">[</span><span class="op" id="3551942">]</span><span class="builtintype" id="3551943">string</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551951">var</span>&nbsp;<span class="ident" id="3551955">err</span>&nbsp;<span class="builtintype" id="3551959">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551966">for</span>&nbsp;<span class="op" id="3551970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551974">var</span>&nbsp;<span class="ident" id="3551978">line</span>&nbsp;<span class="builtintype" id="3551983">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551992">line</span><span class="op" id="3551996">,</span>&nbsp;<span class="ident" id="3551998">err</span>&nbsp;<span class="op" id="3552002">=</span>&nbsp;<span class="ident" id="3552004">r</span><span class="op" id="3552005">.</span><span class="ident" id="3552006">ReadLine</span><span class="op" id="3552014">(</span><span class="op" id="3552015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552019">if</span>&nbsp;<span class="ident" id="3552022">err</span>&nbsp;<span class="op" id="3552026">!=</span>&nbsp;<span class="ident" id="3552029">nil</span>&nbsp;<span class="op" id="3552033">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552038">if</span>&nbsp;<span class="ident" id="3552041">err</span>&nbsp;<span class="op" id="3552045">==</span>&nbsp;<span class="ident" id="3552048">io</span><span class="op" id="3552050">.</span><span class="ident" id="3552051">EOF</span>&nbsp;<span class="op" id="3552055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552061">err</span>&nbsp;<span class="op" id="3552065">=</span>&nbsp;<span class="ident" id="3552067">io</span><span class="op" id="3552069">.</span><span class="ident" id="3552070">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552095">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552103">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552108">//&nbsp;Dot&nbsp;by&nbsp;itself&nbsp;marks&nbsp;end;&nbsp;otherwise&nbsp;cut&nbsp;one&nbsp;dot.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552161">if</span>&nbsp;<span class="builtinfunc" id="3552164">len</span><span class="op" id="3552167">(</span><span class="ident" id="3552168">line</span><span class="op" id="3552172">)</span>&nbsp;<span class="op" id="3552174">&gt;</span>&nbsp;<span class="num" id="3552176">0</span>&nbsp;<span class="op" id="3552178">&amp;&amp;</span>&nbsp;<span class="ident" id="3552181">line</span><span class="op" id="3552185">[</span><span class="num" id="3552186">0</span><span class="op" id="3552187">]</span>&nbsp;<span class="op" id="3552189">==</span>&nbsp;<span class="string" id="3552192">&#39;.&#39;</span>&nbsp;<span class="op" id="3552196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552201">if</span>&nbsp;<span class="builtinfunc" id="3552204">len</span><span class="op" id="3552207">(</span><span class="ident" id="3552208">line</span><span class="op" id="3552212">)</span>&nbsp;<span class="op" id="3552214">==</span>&nbsp;<span class="num" id="3552217">1</span>&nbsp;<span class="op" id="3552219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552225">break</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552239">line</span>&nbsp;<span class="op" id="3552244">=</span>&nbsp;<span class="ident" id="3552246">line</span><span class="op" id="3552250">[</span><span class="num" id="3552251">1</span><span class="op" id="3552252">:</span><span class="op" id="3552253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3552261">v</span>&nbsp;<span class="op" id="3552263">=</span>&nbsp;<span class="builtinfunc" id="3552265">append</span><span class="op" id="3552271">(</span><span class="ident" id="3552272">v</span><span class="op" id="3552273">,</span>&nbsp;<span class="ident" id="3552275">line</span><span class="op" id="3552279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3552282">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552285">return</span>&nbsp;<span class="ident" id="3552292">v</span><span class="op" id="3552293">,</span>&nbsp;<span class="ident" id="3552295">err</span><br>
<span class="lineno"></span><span class="op" id="3552299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3552302">//&nbsp;ReadMIMEHeader&nbsp;reads&nbsp;a&nbsp;MIME-style&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3552354">//&nbsp;The&nbsp;header&nbsp;is&nbsp;a&nbsp;sequence&nbsp;of&nbsp;possibly&nbsp;continued&nbsp;Key:&nbsp;Value&nbsp;lines</span><br>
<span class="lineno">440</span><span class="comment" id="3552421">//&nbsp;ending&nbsp;in&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="3552448">//&nbsp;The&nbsp;returned&nbsp;map&nbsp;m&nbsp;maps&nbsp;CanonicalMIMEHeaderKey(key)&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3552508">//&nbsp;sequence&nbsp;of&nbsp;values&nbsp;in&nbsp;the&nbsp;same&nbsp;order&nbsp;encountered&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="comment" id="3552574">//</span><br>
<span class="lineno"></span><span class="comment" id="3552577">//&nbsp;For&nbsp;example,&nbsp;consider&nbsp;this&nbsp;input:</span><br>
<span class="lineno">445</span><span class="comment" id="3552614">//</span><br>
<span class="lineno"></span><span class="comment" id="3552617">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="3552636">//&nbsp;&nbsp;&nbsp;&nbspLong-Key:&nbsp;Even</span><br>
<span class="lineno"></span><span class="comment" id="3552654">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Longer&nbsp;Value</span><br>
<span class="lineno"></span><span class="comment" id="3552677">//&nbsp;&nbsp;&nbsp;&nbspMy-Key:&nbsp;Value&nbsp;2</span><br>
<span class="lineno">450</span><span class="comment" id="3552696">//</span><br>
<span class="lineno"></span><span class="comment" id="3552699">//&nbsp;Given&nbsp;that&nbsp;input,&nbsp;ReadMIMEHeader&nbsp;returns&nbsp;the&nbsp;map:</span><br>
<span class="lineno"></span><span class="comment" id="3552752">//</span><br>
<span class="lineno"></span><span class="comment" id="3552755">//&nbsp;&nbsp;&nbsp;&nbspmap[string][]string{</span><br>
<span class="lineno"></span><span class="comment" id="3552779">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;My-Key&#34;:&nbsp;{&#34;Value&nbsp;1&#34;,&nbsp;&#34;Value&nbsp;2&#34;},</span><br>
<span class="lineno">455</span><span class="comment" id="3552817">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Long-Key&#34;:&nbsp;{&#34;Even&nbsp;Longer&nbsp;Value&#34;},</span><br>
<span class="lineno"></span><span class="comment" id="3552856">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="3552861">//</span><br>
<span class="lineno"></span><span class="keyword" id="3552864">func</span>&nbsp;<span class="op" id="3552869">(</span><span class="ident" id="3552870">r</span>&nbsp;<span class="op" id="3552872">*</span><span class="ident" id="3552873">Reader</span><span class="op" id="3552879">)</span>&nbsp;<span class="ident" id="3552881">ReadMIMEHeader</span><span class="op" id="3552895">(</span><span class="op" id="3552896">)</span>&nbsp;<span class="op" id="3552898">(</span><span class="ident" id="3552899">MIMEHeader</span><span class="op" id="3552909">,</span>&nbsp;<span class="builtintype" id="3552911">error</span><span class="op" id="3552916">)</span>&nbsp;<span class="op" id="3552918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552921">//&nbsp;Avoid&nbsp;lots&nbsp;of&nbsp;small&nbsp;slice&nbsp;allocations&nbsp;later&nbsp;by&nbsp;allocating&nbsp;one</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552987">//&nbsp;large&nbsp;one&nbsp;ahead&nbsp;of&nbsp;time&nbsp;which&nbsp;we&#39;ll&nbsp;cut&nbsp;up&nbsp;into&nbsp;smaller</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553047">//&nbsp;slices.&nbsp;If&nbsp;this&nbsp;isn&#39;t&nbsp;big&nbsp;enough&nbsp;later,&nbsp;we&nbsp;allocate&nbsp;small&nbsp;ones.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553115">var</span>&nbsp;<span class="ident" id="3553119">strs</span>&nbsp;<span class="op" id="3553124">[</span><span class="op" id="3553125">]</span><span class="builtintype" id="3553126">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553134">hint</span>&nbsp;<span class="op" id="3553139">:=</span>&nbsp;<span class="ident" id="3553142">r</span><span class="op" id="3553143">.</span><span class="ident" id="3553144">upcomingHeaderNewlines</span><span class="op" id="3553166">(</span><span class="op" id="3553167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553170">if</span>&nbsp;<span class="ident" id="3553173">hint</span>&nbsp;<span class="op" id="3553178">&gt;</span>&nbsp;<span class="num" id="3553180">0</span>&nbsp;<span class="op" id="3553182">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553186">strs</span>&nbsp;<span class="op" id="3553191">=</span>&nbsp;<span class="builtinfunc" id="3553193">make</span><span class="op" id="3553197">(</span><span class="op" id="3553198">[</span><span class="op" id="3553199">]</span><span class="builtintype" id="3553200">string</span><span class="op" id="3553206">,</span>&nbsp;<span class="ident" id="3553208">hint</span><span class="op" id="3553212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553219">m</span>&nbsp;<span class="op" id="3553221">:=</span>&nbsp;<span class="builtinfunc" id="3553224">make</span><span class="op" id="3553228">(</span><span class="ident" id="3553229">MIMEHeader</span><span class="op" id="3553239">,</span>&nbsp;<span class="ident" id="3553241">hint</span><span class="op" id="3553245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553248">for</span>&nbsp;<span class="op" id="3553252">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553256">kv</span><span class="op" id="3553258">,</span>&nbsp;<span class="ident" id="3553260">err</span>&nbsp;<span class="op" id="3553264">:=</span>&nbsp;<span class="ident" id="3553267">r</span><span class="op" id="3553268">.</span><span class="ident" id="3553269">readContinuedLineSlice</span><span class="op" id="3553291">(</span><span class="op" id="3553292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553296">if</span>&nbsp;<span class="builtinfunc" id="3553299">len</span><span class="op" id="3553302">(</span><span class="ident" id="3553303">kv</span><span class="op" id="3553305">)</span>&nbsp;<span class="op" id="3553307">==</span>&nbsp;<span class="num" id="3553310">0</span>&nbsp;<span class="op" id="3553312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553317">return</span>&nbsp;<span class="ident" id="3553324">m</span><span class="op" id="3553325">,</span>&nbsp;<span class="ident" id="3553327">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553338">//&nbsp;Key&nbsp;ends&nbsp;at&nbsp;first&nbsp;colon;&nbsp;should&nbsp;not&nbsp;have&nbsp;spaces&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553395">//&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;wild,&nbsp;violating&nbsp;specs,&nbsp;so&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553448">//&nbsp;remove&nbsp;them&nbsp;if&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553477">i</span>&nbsp;<span class="op" id="3553479">:=</span>&nbsp;<span class="ident" id="3553482">bytes</span><span class="op" id="3553487">.</span><span class="ident" id="3553488">IndexByte</span><span class="op" id="3553497">(</span><span class="ident" id="3553498">kv</span><span class="op" id="3553500">,</span>&nbsp;<span class="string" id="3553502">&#39;:&#39;</span><span class="op" id="3553505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553509">if</span>&nbsp;<span class="ident" id="3553512">i</span>&nbsp;<span class="op" id="3553514">&lt;</span>&nbsp;<span class="num" id="3553516">0</span>&nbsp;<span class="op" id="3553518">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553523">return</span>&nbsp;<span class="ident" id="3553530">m</span><span class="op" id="3553531">,</span>&nbsp;<span class="ident" id="3553533">ProtocolError</span><span class="op" id="3553546">(</span><span class="string" id="3553547">&#34;malformed&nbsp;MIME&nbsp;header&nbsp;line:&nbsp;&#34;</span>&nbsp;<span class="op" id="3553578">+</span>&nbsp;<span class="builtintype" id="3553580">string</span><span class="op" id="3553586">(</span><span class="ident" id="3553587">kv</span><span class="op" id="3553589">)</span><span class="op" id="3553590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553598">endKey</span>&nbsp;<span class="op" id="3553605">:=</span>&nbsp;<span class="ident" id="3553608">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553612">for</span>&nbsp;<span class="ident" id="3553616">endKey</span>&nbsp;<span class="op" id="3553623">&gt;</span>&nbsp;<span class="num" id="3553625">0</span>&nbsp;<span class="op" id="3553627">&amp;&amp;</span>&nbsp;<span class="ident" id="3553630">kv</span><span class="op" id="3553632">[</span><span class="ident" id="3553633">endKey</span><span class="op" id="3553639">-</span><span class="num" id="3553640">1</span><span class="op" id="3553641">]</span>&nbsp;<span class="op" id="3553643">==</span>&nbsp;<span class="string" id="3553646">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3553650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553655">endKey</span><span class="op" id="3553661">--</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553670">key</span>&nbsp;<span class="op" id="3553674">:=</span>&nbsp;<span class="ident" id="3553677">canonicalMIMEHeaderKey</span><span class="op" id="3553699">(</span><span class="ident" id="3553700">kv</span><span class="op" id="3553702">[</span><span class="op" id="3553703">:</span><span class="ident" id="3553704">endKey</span><span class="op" id="3553710">]</span><span class="op" id="3553711">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553716">//&nbsp;Skip&nbsp;initial&nbsp;spaces&nbsp;in&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553751">i</span><span class="op" id="3553752">++</span>&nbsp;<span class="comment" id="3553755">//&nbsp;skip&nbsp;colon</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553771">for</span>&nbsp;<span class="ident" id="3553775">i</span>&nbsp;<span class="op" id="3553777">&lt;</span>&nbsp;<span class="builtinfunc" id="3553779">len</span><span class="op" id="3553782">(</span><span class="ident" id="3553783">kv</span><span class="op" id="3553785">)</span>&nbsp;<span class="op" id="3553787">&amp;&amp;</span>&nbsp;<span class="op" id="3553790">(</span><span class="ident" id="3553791">kv</span><span class="op" id="3553793">[</span><span class="ident" id="3553794">i</span><span class="op" id="3553795">]</span>&nbsp;<span class="op" id="3553797">==</span>&nbsp;<span class="string" id="3553800">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3553804">||</span>&nbsp;<span class="ident" id="3553807">kv</span><span class="op" id="3553809">[</span><span class="ident" id="3553810">i</span><span class="op" id="3553811">]</span>&nbsp;<span class="op" id="3553813">==</span>&nbsp;<span class="string" id="3553816">&#39;\t&#39;</span><span class="op" id="3553820">)</span>&nbsp;<span class="op" id="3553822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553827">i</span><span class="op" id="3553828">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553837">value</span>&nbsp;<span class="op" id="3553843">:=</span>&nbsp;<span class="builtintype" id="3553846">string</span><span class="op" id="3553852">(</span><span class="ident" id="3553853">kv</span><span class="op" id="3553855">[</span><span class="ident" id="3553856">i</span><span class="op" id="3553857">:</span><span class="op" id="3553858">]</span><span class="op" id="3553859">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553864">vv</span>&nbsp;<span class="op" id="3553867">:=</span>&nbsp;<span class="ident" id="3553870">m</span><span class="op" id="3553871">[</span><span class="ident" id="3553872">key</span><span class="op" id="3553875">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553879">if</span>&nbsp;<span class="ident" id="3553882">vv</span>&nbsp;<span class="op" id="3553885">==</span>&nbsp;<span class="ident" id="3553888">nil</span>&nbsp;<span class="op" id="3553892">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3553895">len</span><span class="op" id="3553898">(</span><span class="ident" id="3553899">strs</span><span class="op" id="3553903">)</span>&nbsp;<span class="op" id="3553905">&gt;</span>&nbsp;<span class="num" id="3553907">0</span>&nbsp;<span class="op" id="3553909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553914">//&nbsp;More&nbsp;than&nbsp;likely&nbsp;this&nbsp;will&nbsp;be&nbsp;a&nbsp;single-element&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553972">//&nbsp;Most&nbsp;headers&nbsp;aren&#39;t&nbsp;multi-valued.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554012">//&nbsp;Set&nbsp;the&nbsp;capacity&nbsp;on&nbsp;strs[0]&nbsp;to&nbsp;1,&nbsp;so&nbsp;any&nbsp;future&nbsp;append</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554073">//&nbsp;won&#39;t&nbsp;extend&nbsp;the&nbsp;slice&nbsp;into&nbsp;the&nbsp;other&nbsp;strings.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554126">vv</span><span class="op" id="3554128">,</span>&nbsp;<span class="ident" id="3554130">strs</span>&nbsp;<span class="op" id="3554135">=</span>&nbsp;<span class="ident" id="3554137">strs</span><span class="op" id="3554141">[</span><span class="op" id="3554142">:</span><span class="num" id="3554143">1</span><span class="op" id="3554144">:</span><span class="num" id="3554145">1</span><span class="op" id="3554146">]</span><span class="op" id="3554147">,</span>&nbsp;<span class="ident" id="3554149">strs</span><span class="op" id="3554153">[</span><span class="num" id="3554154">1</span><span class="op" id="3554155">:</span><span class="op" id="3554156">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554161">vv</span><span class="op" id="3554163">[</span><span class="num" id="3554164">0</span><span class="op" id="3554165">]</span>&nbsp;<span class="op" id="3554167">=</span>&nbsp;<span class="ident" id="3554169">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554178">m</span><span class="op" id="3554179">[</span><span class="ident" id="3554180">key</span><span class="op" id="3554183">]</span>&nbsp;<span class="op" id="3554185">=</span>&nbsp;<span class="ident" id="3554187">vv</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554192">}</span>&nbsp;<span class="keyword" id="3554194">else</span>&nbsp;<span class="op" id="3554199">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554204">m</span><span class="op" id="3554205">[</span><span class="ident" id="3554206">key</span><span class="op" id="3554209">]</span>&nbsp;<span class="op" id="3554211">=</span>&nbsp;<span class="builtinfunc" id="3554213">append</span><span class="op" id="3554219">(</span><span class="ident" id="3554220">vv</span><span class="op" id="3554222">,</span>&nbsp;<span class="ident" id="3554224">value</span><span class="op" id="3554229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554238">if</span>&nbsp;<span class="ident" id="3554241">err</span>&nbsp;<span class="op" id="3554245">!=</span>&nbsp;<span class="ident" id="3554248">nil</span>&nbsp;<span class="op" id="3554252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554257">return</span>&nbsp;<span class="ident" id="3554264">m</span><span class="op" id="3554265">,</span>&nbsp;<span class="ident" id="3554267">err</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554276">}</span><br>
<span class="lineno"></span><span class="op" id="3554278">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3554281">//&nbsp;upcomingHeaderNewlines&nbsp;returns&nbsp;an&nbsp;approximation&nbsp;of&nbsp;the&nbsp;number&nbsp;of&nbsp;newlines</span><br>
<span class="lineno">515</span><span class="comment" id="3554358">//&nbsp;that&nbsp;will&nbsp;be&nbsp;in&nbsp;this&nbsp;header.&nbsp;If&nbsp;it&nbsp;gets&nbsp;confused,&nbsp;it&nbsp;returns&nbsp;0.</span><br>
<span class="lineno"></span><span class="keyword" id="3554425">func</span>&nbsp;<span class="op" id="3554430">(</span><span class="ident" id="3554431">r</span>&nbsp;<span class="op" id="3554433">*</span><span class="ident" id="3554434">Reader</span><span class="op" id="3554440">)</span>&nbsp;<span class="ident" id="3554442">upcomingHeaderNewlines</span><span class="op" id="3554464">(</span><span class="op" id="3554465">)</span>&nbsp;<span class="op" id="3554467">(</span><span class="ident" id="3554468">n</span>&nbsp;<span class="builtintype" id="3554470">int</span><span class="op" id="3554473">)</span>&nbsp;<span class="op" id="3554475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554478">//&nbsp;Try&nbsp;to&nbsp;determine&nbsp;the&nbsp;&#39;hint&#39;&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554516">r</span><span class="op" id="3554517">.</span><span class="ident" id="3554518">R</span><span class="op" id="3554519">.</span><span class="ident" id="3554520">Peek</span><span class="op" id="3554524">(</span><span class="num" id="3554525">1</span><span class="op" id="3554526">)</span>&nbsp;<span class="comment" id="3554528">//&nbsp;force&nbsp;a&nbsp;buffer&nbsp;load&nbsp;if&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554561">s</span>&nbsp;<span class="op" id="3554563">:=</span>&nbsp;<span class="ident" id="3554566">r</span><span class="op" id="3554567">.</span><span class="ident" id="3554568">R</span><span class="op" id="3554569">.</span><span class="ident" id="3554570">Buffered</span><span class="op" id="3554578">(</span><span class="op" id="3554579">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554582">if</span>&nbsp;<span class="ident" id="3554585">s</span>&nbsp;<span class="op" id="3554587">==</span>&nbsp;<span class="num" id="3554590">0</span>&nbsp;<span class="op" id="3554592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554596">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554607">peek</span><span class="op" id="3554611">,</span>&nbsp;<span class="ident" id="3554613">_</span>&nbsp;<span class="op" id="3554615">:=</span>&nbsp;<span class="ident" id="3554618">r</span><span class="op" id="3554619">.</span><span class="ident" id="3554620">R</span><span class="op" id="3554621">.</span><span class="ident" id="3554622">Peek</span><span class="op" id="3554626">(</span><span class="ident" id="3554627">s</span><span class="op" id="3554628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554631">for</span>&nbsp;<span class="builtinfunc" id="3554635">len</span><span class="op" id="3554638">(</span><span class="ident" id="3554639">peek</span><span class="op" id="3554643">)</span>&nbsp;<span class="op" id="3554645">&gt;</span>&nbsp;<span class="num" id="3554647">0</span>&nbsp;<span class="op" id="3554649">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554653">i</span>&nbsp;<span class="op" id="3554655">:=</span>&nbsp;<span class="ident" id="3554658">bytes</span><span class="op" id="3554663">.</span><span class="ident" id="3554664">IndexByte</span><span class="op" id="3554673">(</span><span class="ident" id="3554674">peek</span><span class="op" id="3554678">,</span>&nbsp;<span class="string" id="3554680">&#39;\n&#39;</span><span class="op" id="3554684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554688">if</span>&nbsp;<span class="ident" id="3554691">i</span>&nbsp;<span class="op" id="3554693">&lt;</span>&nbsp;<span class="num" id="3554695">3</span>&nbsp;<span class="op" id="3554697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554702">//&nbsp;Not&nbsp;present&nbsp;(-1)&nbsp;or&nbsp;found&nbsp;within&nbsp;the&nbsp;next&nbsp;few&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554761">//&nbsp;implying&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;(&#34;\r\n\r\n&#34;&nbsp;or&nbsp;&#34;\n\n&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554816">return</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554829">n</span><span class="op" id="3554830">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554835">peek</span>&nbsp;<span class="op" id="3554840">=</span>&nbsp;<span class="ident" id="3554842">peek</span><span class="op" id="3554846">[</span><span class="ident" id="3554847">i</span><span class="op" id="3554848">+</span><span class="num" id="3554849">1</span><span class="op" id="3554850">:</span><span class="op" id="3554851">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554857">return</span><br>
<span class="lineno">535</span><span class="op" id="3554864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3554867">//&nbsp;CanonicalMIMEHeaderKey&nbsp;returns&nbsp;the&nbsp;canonical&nbsp;format&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3554929">//&nbsp;MIME&nbsp;header&nbsp;key&nbsp;s.&nbsp;&nbsp;The&nbsp;canonicalization&nbsp;converts&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="3554992">//&nbsp;letter&nbsp;and&nbsp;any&nbsp;letter&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;to&nbsp;upper&nbsp;case;</span><br>
<span class="lineno">540</span><span class="comment" id="3555051">//&nbsp;the&nbsp;rest&nbsp;are&nbsp;converted&nbsp;to&nbsp;lowercase.&nbsp;&nbsp;For&nbsp;example,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3555109">//&nbsp;canonical&nbsp;key&nbsp;for&nbsp;&#34;accept-encoding&#34;&nbsp;is&nbsp;&#34;Accept-Encoding&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3555170">//&nbsp;MIME&nbsp;header&nbsp;keys&nbsp;are&nbsp;assumed&nbsp;to&nbsp;be&nbsp;ASCII&nbsp;only.</span><br>
<span class="lineno"></span><span class="keyword" id="3555220">func</span>&nbsp;<span class="ident" id="3555225">CanonicalMIMEHeaderKey</span><span class="op" id="3555247">(</span><span class="ident" id="3555248">s</span>&nbsp;<span class="builtintype" id="3555250">string</span><span class="op" id="3555256">)</span>&nbsp;<span class="builtintype" id="3555258">string</span>&nbsp;<span class="op" id="3555265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555268">//&nbsp;Quick&nbsp;check&nbsp;for&nbsp;canonical&nbsp;encoding.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555308">upper</span>&nbsp;<span class="op" id="3555314">:=</span>&nbsp;<span class="builtintype" id="3555317">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555323">for</span>&nbsp;<span class="ident" id="3555327">i</span>&nbsp;<span class="op" id="3555329">:=</span>&nbsp;<span class="num" id="3555332">0</span><span class="op" id="3555333">;</span>&nbsp;<span class="ident" id="3555335">i</span>&nbsp;<span class="op" id="3555337">&lt;</span>&nbsp;<span class="builtinfunc" id="3555339">len</span><span class="op" id="3555342">(</span><span class="ident" id="3555343">s</span><span class="op" id="3555344">)</span><span class="op" id="3555345">;</span>&nbsp;<span class="ident" id="3555347">i</span><span class="op" id="3555348">++</span>&nbsp;<span class="op" id="3555351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555355">c</span>&nbsp;<span class="op" id="3555357">:=</span>&nbsp;<span class="ident" id="3555360">s</span><span class="op" id="3555361">[</span><span class="ident" id="3555362">i</span><span class="op" id="3555363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555367">if</span>&nbsp;<span class="ident" id="3555370">upper</span>&nbsp;<span class="op" id="3555376">&amp;&amp;</span>&nbsp;<span class="string" id="3555379">&#39;a&#39;</span>&nbsp;<span class="op" id="3555383">&lt;=</span>&nbsp;<span class="ident" id="3555386">c</span>&nbsp;<span class="op" id="3555388">&amp;&amp;</span>&nbsp;<span class="ident" id="3555391">c</span>&nbsp;<span class="op" id="3555393">&lt;=</span>&nbsp;<span class="string" id="3555396">&#39;z&#39;</span>&nbsp;<span class="op" id="3555400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555405">return</span>&nbsp;<span class="ident" id="3555412">canonicalMIMEHeaderKey</span><span class="op" id="3555434">(</span><span class="op" id="3555435">[</span><span class="op" id="3555436">]</span><span class="builtintype" id="3555437">byte</span><span class="op" id="3555441">(</span><span class="ident" id="3555442">s</span><span class="op" id="3555443">)</span><span class="op" id="3555444">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555452">if</span>&nbsp;<span class="op" id="3555455">!</span><span class="ident" id="3555456">upper</span>&nbsp;<span class="op" id="3555462">&amp;&amp;</span>&nbsp;<span class="string" id="3555465">&#39;A&#39;</span>&nbsp;<span class="op" id="3555469">&lt;=</span>&nbsp;<span class="ident" id="3555472">c</span>&nbsp;<span class="op" id="3555474">&amp;&amp;</span>&nbsp;<span class="ident" id="3555477">c</span>&nbsp;<span class="op" id="3555479">&lt;=</span>&nbsp;<span class="string" id="3555482">&#39;Z&#39;</span>&nbsp;<span class="op" id="3555486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555491">return</span>&nbsp;<span class="ident" id="3555498">canonicalMIMEHeaderKey</span><span class="op" id="3555520">(</span><span class="op" id="3555521">[</span><span class="op" id="3555522">]</span><span class="builtintype" id="3555523">byte</span><span class="op" id="3555527">(</span><span class="ident" id="3555528">s</span><span class="op" id="3555529">)</span><span class="op" id="3555530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555538">upper</span>&nbsp;<span class="op" id="3555544">=</span>&nbsp;<span class="ident" id="3555546">c</span>&nbsp;<span class="op" id="3555548">==</span>&nbsp;<span class="string" id="3555551">&#39;-&#39;</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555559">return</span>&nbsp;<span class="ident" id="3555566">s</span><br>
<span class="lineno"></span><span class="op" id="3555568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3555571">const</span>&nbsp;<span class="ident" id="3555577">toLower</span>&nbsp;<span class="op" id="3555585">=</span>&nbsp;<span class="string" id="3555587">&#39;a&#39;</span>&nbsp;<span class="op" id="3555591">-</span>&nbsp;<span class="string" id="3555593">&#39;A&#39;</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span><span class="comment" id="3555598">//&nbsp;canonicalMIMEHeaderKey&nbsp;is&nbsp;like&nbsp;CanonicalMIMEHeaderKey&nbsp;but&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3555662">//&nbsp;allowed&nbsp;to&nbsp;mutate&nbsp;the&nbsp;provided&nbsp;byte&nbsp;slice&nbsp;before&nbsp;returning&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3555728">//&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3555739">func</span>&nbsp;<span class="ident" id="3555744">canonicalMIMEHeaderKey</span><span class="op" id="3555766">(</span><span class="ident" id="3555767">a</span>&nbsp;<span class="op" id="3555769">[</span><span class="op" id="3555770">]</span><span class="builtintype" id="3555771">byte</span><span class="op" id="3555775">)</span>&nbsp;<span class="builtintype" id="3555777">string</span>&nbsp;<span class="op" id="3555784">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555787">upper</span>&nbsp;<span class="op" id="3555793">:=</span>&nbsp;<span class="builtintype" id="3555796">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555802">for</span>&nbsp;<span class="ident" id="3555806">i</span><span class="op" id="3555807">,</span>&nbsp;<span class="ident" id="3555809">c</span>&nbsp;<span class="op" id="3555811">:=</span>&nbsp;<span class="keyword" id="3555814">range</span>&nbsp;<span class="ident" id="3555820">a</span>&nbsp;<span class="op" id="3555822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555826">//&nbsp;Canonicalize:&nbsp;first&nbsp;letter&nbsp;upper&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555869">//&nbsp;and&nbsp;upper&nbsp;case&nbsp;after&nbsp;each&nbsp;dash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555906">//&nbsp;(Host,&nbsp;User-Agent,&nbsp;If-Modified-Since).</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555950">//&nbsp;MIME&nbsp;headers&nbsp;are&nbsp;ASCII&nbsp;only,&nbsp;so&nbsp;no&nbsp;Unicode&nbsp;issues.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556006">if</span>&nbsp;<span class="ident" id="3556009">c</span>&nbsp;<span class="op" id="3556011">==</span>&nbsp;<span class="string" id="3556014">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3556018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556023">c</span>&nbsp;<span class="op" id="3556025">=</span>&nbsp;<span class="string" id="3556027">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556033">}</span>&nbsp;<span class="keyword" id="3556035">else</span>&nbsp;<span class="keyword" id="3556040">if</span>&nbsp;<span class="ident" id="3556043">upper</span>&nbsp;<span class="op" id="3556049">&amp;&amp;</span>&nbsp;<span class="string" id="3556052">&#39;a&#39;</span>&nbsp;<span class="op" id="3556056">&lt;=</span>&nbsp;<span class="ident" id="3556059">c</span>&nbsp;<span class="op" id="3556061">&amp;&amp;</span>&nbsp;<span class="ident" id="3556064">c</span>&nbsp;<span class="op" id="3556066">&lt;=</span>&nbsp;<span class="string" id="3556069">&#39;z&#39;</span>&nbsp;<span class="op" id="3556073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556078">c</span>&nbsp;<span class="op" id="3556080">-=</span>&nbsp;<span class="ident" id="3556083">toLower</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556093">}</span>&nbsp;<span class="keyword" id="3556095">else</span>&nbsp;<span class="keyword" id="3556100">if</span>&nbsp;<span class="op" id="3556103">!</span><span class="ident" id="3556104">upper</span>&nbsp;<span class="op" id="3556110">&amp;&amp;</span>&nbsp;<span class="string" id="3556113">&#39;A&#39;</span>&nbsp;<span class="op" id="3556117">&lt;=</span>&nbsp;<span class="ident" id="3556120">c</span>&nbsp;<span class="op" id="3556122">&amp;&amp;</span>&nbsp;<span class="ident" id="3556125">c</span>&nbsp;<span class="op" id="3556127">&lt;=</span>&nbsp;<span class="string" id="3556130">&#39;Z&#39;</span>&nbsp;<span class="op" id="3556134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556139">c</span>&nbsp;<span class="op" id="3556141">+=</span>&nbsp;<span class="ident" id="3556144">toLower</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556158">a</span><span class="op" id="3556159">[</span><span class="ident" id="3556160">i</span><span class="op" id="3556161">]</span>&nbsp;<span class="op" id="3556163">=</span>&nbsp;<span class="ident" id="3556165">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556169">upper</span>&nbsp;<span class="op" id="3556175">=</span>&nbsp;<span class="ident" id="3556177">c</span>&nbsp;<span class="op" id="3556179">==</span>&nbsp;<span class="string" id="3556182">&#39;-&#39;</span>&nbsp;<span class="comment" id="3556186">//&nbsp;for&nbsp;next&nbsp;time</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556207">//&nbsp;The&nbsp;compiler&nbsp;recognizes&nbsp;m[string(byteSlice)]&nbsp;as&nbsp;a&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556269">//&nbsp;case,&nbsp;so&nbsp;a&nbsp;copy&nbsp;of&nbsp;a&#39;s&nbsp;bytes&nbsp;into&nbsp;a&nbsp;new&nbsp;string&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556329">//&nbsp;happen&nbsp;in&nbsp;this&nbsp;map&nbsp;lookup:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556360">if</span>&nbsp;<span class="ident" id="3556363">v</span>&nbsp;<span class="op" id="3556365">:=</span>&nbsp;<span class="ident" id="3556368">commonHeader</span><span class="op" id="3556380">[</span><span class="builtintype" id="3556381">string</span><span class="op" id="3556387">(</span><span class="ident" id="3556388">a</span><span class="op" id="3556389">)</span><span class="op" id="3556390">]</span><span class="op" id="3556391">;</span>&nbsp;<span class="ident" id="3556393">v</span>&nbsp;<span class="op" id="3556395">!=</span>&nbsp;<span class="string" id="3556398">&#34;&#34;</span>&nbsp;<span class="op" id="3556401">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556405">return</span>&nbsp;<span class="ident" id="3556412">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556418">return</span>&nbsp;<span class="builtintype" id="3556425">string</span><span class="op" id="3556431">(</span><span class="ident" id="3556432">a</span><span class="op" id="3556433">)</span><br>
<span class="lineno"></span><span class="op" id="3556435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="3556438">//&nbsp;commonHeader&nbsp;interns&nbsp;common&nbsp;header&nbsp;strings.</span><br>
<span class="lineno"></span><span class="keyword" id="3556485">var</span>&nbsp;<span class="ident" id="3556489">commonHeader</span>&nbsp;<span class="op" id="3556502">=</span>&nbsp;<span class="builtinfunc" id="3556504">make</span><span class="op" id="3556508">(</span><span class="keyword" id="3556509">map</span><span class="op" id="3556512">[</span><span class="builtintype" id="3556513">string</span><span class="op" id="3556519">]</span><span class="builtintype" id="3556520">string</span><span class="op" id="3556526">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3556529">func</span>&nbsp;<span class="ident" id="3556534">init</span><span class="op" id="3556538">(</span><span class="op" id="3556539">)</span>&nbsp;<span class="op" id="3556541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556544">for</span>&nbsp;<span class="ident" id="3556548">_</span><span class="op" id="3556549">,</span>&nbsp;<span class="ident" id="3556551">v</span>&nbsp;<span class="op" id="3556553">:=</span>&nbsp;<span class="keyword" id="3556556">range</span>&nbsp;<span class="op" id="3556562">[</span><span class="op" id="3556563">]</span><span class="builtintype" id="3556564">string</span><span class="op" id="3556570">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556574">&#34;Accept&#34;</span><span class="op" id="3556582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556586">&#34;Accept-Charset&#34;</span><span class="op" id="3556602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556606">&#34;Accept-Encoding&#34;</span><span class="op" id="3556623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556627">&#34;Accept-Language&#34;</span><span class="op" id="3556644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556648">&#34;Accept-Ranges&#34;</span><span class="op" id="3556663">,</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556667">&#34;Cache-Control&#34;</span><span class="op" id="3556682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556686">&#34;Cc&#34;</span><span class="op" id="3556690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556694">&#34;Connection&#34;</span><span class="op" id="3556706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556710">&#34;Content-Id&#34;</span><span class="op" id="3556722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556726">&#34;Content-Language&#34;</span><span class="op" id="3556744">,</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556748">&#34;Content-Length&#34;</span><span class="op" id="3556764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556768">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="3556795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556799">&#34;Content-Type&#34;</span><span class="op" id="3556813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556817">&#34;Cookie&#34;</span><span class="op" id="3556825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556829">&#34;Date&#34;</span><span class="op" id="3556835">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556839">&#34;Dkim-Signature&#34;</span><span class="op" id="3556855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556859">&#34;Etag&#34;</span><span class="op" id="3556865">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556869">&#34;Expires&#34;</span><span class="op" id="3556878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556882">&#34;From&#34;</span><span class="op" id="3556888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556892">&#34;Host&#34;</span><span class="op" id="3556898">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556902">&#34;If-Modified-Since&#34;</span><span class="op" id="3556921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556925">&#34;If-None-Match&#34;</span><span class="op" id="3556940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556944">&#34;In-Reply-To&#34;</span><span class="op" id="3556957">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556961">&#34;Last-Modified&#34;</span><span class="op" id="3556976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556980">&#34;Location&#34;</span><span class="op" id="3556990">,</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3556994">&#34;Message-Id&#34;</span><span class="op" id="3557006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557010">&#34;Mime-Version&#34;</span><span class="op" id="3557024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557028">&#34;Pragma&#34;</span><span class="op" id="3557036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557040">&#34;Received&#34;</span><span class="op" id="3557050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557054">&#34;Return-Path&#34;</span><span class="op" id="3557067">,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557071">&#34;Server&#34;</span><span class="op" id="3557079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557083">&#34;Set-Cookie&#34;</span><span class="op" id="3557095">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557099">&#34;Subject&#34;</span><span class="op" id="3557108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557112">&#34;To&#34;</span><span class="op" id="3557116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557120">&#34;User-Agent&#34;</span><span class="op" id="3557132">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557136">&#34;Via&#34;</span><span class="op" id="3557141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557145">&#34;X-Forwarded-For&#34;</span><span class="op" id="3557162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557166">&#34;X-Imforwards&#34;</span><span class="op" id="3557180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3557184">&#34;X-Powered-By&#34;</span><span class="op" id="3557198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557201">}</span>&nbsp;<span class="op" id="3557203">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557207">commonHeader</span><span class="op" id="3557219">[</span><span class="ident" id="3557220">v</span><span class="op" id="3557221">]</span>&nbsp;<span class="op" id="3557223">=</span>&nbsp;<span class="ident" id="3557225">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557228">}</span><br>
<span class="lineno"></span><span class="op" id="3557230">}</span>
</div>
</body>
</html>
