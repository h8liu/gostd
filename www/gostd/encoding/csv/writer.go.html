<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/csv</h2>
<ul>
<li><a href="/gostd/encoding/csv/reader.go.html">reader.go</a></li>
<li><a href="/gostd/encoding/csv/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/encoding/csv/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/encoding/csv/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5607503">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5607558">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5607612">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5607663">package</span>&nbsp;<span class="ident" id="5607671">csv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5607676">import</span>&nbsp;<span class="op" id="5607683">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5607686">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5607695">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5607701">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5607712">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5607723">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5607738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5607741">//&nbsp;A&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;to&nbsp;a&nbsp;CSV&nbsp;encoded&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5607791">//</span><br>
<span class="lineno"></span><span class="comment" id="5607794">//&nbsp;As&nbsp;returned&nbsp;by&nbsp;NewWriter,&nbsp;a&nbsp;Writer&nbsp;writes&nbsp;records&nbsp;terminated&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5607863">//&nbsp;newline&nbsp;and&nbsp;uses&nbsp;&#39;,&#39;&nbsp;as&nbsp;the&nbsp;field&nbsp;delimiter.&nbsp;&nbsp;The&nbsp;exported&nbsp;fields&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5607939">//&nbsp;changed&nbsp;to&nbsp;customize&nbsp;the&nbsp;details&nbsp;before&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;WriteAll.</span><br>
<span class="lineno">20</span><span class="comment" id="5608019">//</span><br>
<span class="lineno"></span><span class="comment" id="5608022">//&nbsp;Comma&nbsp;is&nbsp;the&nbsp;field&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="5608055">//</span><br>
<span class="lineno"></span><span class="comment" id="5608058">//&nbsp;If&nbsp;UseCRLF&nbsp;is&nbsp;true,&nbsp;the&nbsp;Writer&nbsp;ends&nbsp;each&nbsp;record&nbsp;with&nbsp;\r\n&nbsp;instead&nbsp;of&nbsp;\n.</span><br>
<span class="lineno"></span><span class="keyword" id="5608134">type</span>&nbsp;<span class="ident" id="5608139">Writer</span>&nbsp;<span class="keyword" id="5608146">struct</span>&nbsp;<span class="op" id="5608153">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608156">Comma</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5608164">rune</span>&nbsp;<span class="comment" id="5608169">//&nbsp;Field&nbsp;delimiter&nbsp;(set&nbsp;to&nbsp;&#39;,&#39;&nbsp;by&nbsp;NewWriter)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608215">UseCRLF</span>&nbsp;<span class="builtintype" id="5608223">bool</span>&nbsp;<span class="comment" id="5608228">//&nbsp;True&nbsp;to&nbsp;use&nbsp;\r\n&nbsp;as&nbsp;the&nbsp;line&nbsp;terminator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608272">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5608280">*</span><span class="ident" id="5608281">bufio</span><span class="op" id="5608286">.</span><span class="ident" id="5608287">Writer</span><br>
<span class="lineno"></span><span class="op" id="5608294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5608297">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5608349">func</span>&nbsp;<span class="ident" id="5608354">NewWriter</span><span class="op" id="5608363">(</span><span class="ident" id="5608364">w</span>&nbsp;<span class="ident" id="5608366">io</span><span class="op" id="5608368">.</span><span class="ident" id="5608369">Writer</span><span class="op" id="5608375">)</span>&nbsp;<span class="op" id="5608377">*</span><span class="ident" id="5608378">Writer</span>&nbsp;<span class="op" id="5608385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608388">return</span>&nbsp;<span class="op" id="5608395">&amp;</span><span class="ident" id="5608396">Writer</span><span class="op" id="5608402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608406">Comma</span><span class="op" id="5608411">:</span>&nbsp;<span class="string" id="5608413">&#39;,&#39;</span><span class="op" id="5608416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5608420">w</span><span class="op" id="5608421">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5608427">bufio</span><span class="op" id="5608432">.</span><span class="ident" id="5608433">NewWriter</span><span class="op" id="5608442">(</span><span class="ident" id="5608443">w</span><span class="op" id="5608444">)</span><span class="op" id="5608445">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608448">}</span><br>
<span class="lineno"></span><span class="op" id="5608450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5608453">//&nbsp;Writer&nbsp;writes&nbsp;a&nbsp;single&nbsp;CSV&nbsp;record&nbsp;to&nbsp;w&nbsp;along&nbsp;with&nbsp;any&nbsp;necessary&nbsp;quoting.</span><br>
<span class="lineno"></span><span class="comment" id="5608529">//&nbsp;A&nbsp;record&nbsp;is&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;with&nbsp;each&nbsp;string&nbsp;being&nbsp;one&nbsp;field.</span><br>
<span class="lineno">40</span><span class="keyword" id="5608597">func</span>&nbsp;<span class="op" id="5608602">(</span><span class="ident" id="5608603">w</span>&nbsp;<span class="op" id="5608605">*</span><span class="ident" id="5608606">Writer</span><span class="op" id="5608612">)</span>&nbsp;<span class="ident" id="5608614">Write</span><span class="op" id="5608619">(</span><span class="ident" id="5608620">record</span>&nbsp;<span class="op" id="5608627">[</span><span class="op" id="5608628">]</span><span class="builtintype" id="5608629">string</span><span class="op" id="5608635">)</span>&nbsp;<span class="op" id="5608637">(</span><span class="ident" id="5608638">err</span>&nbsp;<span class="builtintype" id="5608642">error</span><span class="op" id="5608647">)</span>&nbsp;<span class="op" id="5608649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608652">for</span>&nbsp;<span class="ident" id="5608656">n</span><span class="op" id="5608657">,</span>&nbsp;<span class="ident" id="5608659">field</span>&nbsp;<span class="op" id="5608665">:=</span>&nbsp;<span class="keyword" id="5608668">range</span>&nbsp;<span class="ident" id="5608674">record</span>&nbsp;<span class="op" id="5608681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608685">if</span>&nbsp;<span class="ident" id="5608688">n</span>&nbsp;<span class="op" id="5608690">&gt;</span>&nbsp;<span class="num" id="5608692">0</span>&nbsp;<span class="op" id="5608694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608699">if</span>&nbsp;<span class="ident" id="5608702">_</span><span class="op" id="5608703">,</span>&nbsp;<span class="ident" id="5608705">err</span>&nbsp;<span class="op" id="5608709">=</span>&nbsp;<span class="ident" id="5608711">w</span><span class="op" id="5608712">.</span><span class="ident" id="5608713">w</span><span class="op" id="5608714">.</span><span class="ident" id="5608715">WriteRune</span><span class="op" id="5608724">(</span><span class="ident" id="5608725">w</span><span class="op" id="5608726">.</span><span class="ident" id="5608727">Comma</span><span class="op" id="5608732">)</span><span class="op" id="5608733">;</span>&nbsp;<span class="ident" id="5608735">err</span>&nbsp;<span class="op" id="5608739">!=</span>&nbsp;<span class="ident" id="5608742">nil</span>&nbsp;<span class="op" id="5608746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608752">return</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608771">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;have&nbsp;a&nbsp;quoted&nbsp;field&nbsp;then&nbsp;just</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5608826">//&nbsp;write&nbsp;out&nbsp;the&nbsp;field&nbsp;and&nbsp;continue&nbsp;to&nbsp;the&nbsp;next&nbsp;field.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608883">if</span>&nbsp;<span class="op" id="5608886">!</span><span class="ident" id="5608887">w</span><span class="op" id="5608888">.</span><span class="ident" id="5608889">fieldNeedsQuotes</span><span class="op" id="5608905">(</span><span class="ident" id="5608906">field</span><span class="op" id="5608911">)</span>&nbsp;<span class="op" id="5608913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608918">if</span>&nbsp;<span class="ident" id="5608921">_</span><span class="op" id="5608922">,</span>&nbsp;<span class="ident" id="5608924">err</span>&nbsp;<span class="op" id="5608928">=</span>&nbsp;<span class="ident" id="5608930">w</span><span class="op" id="5608931">.</span><span class="ident" id="5608932">w</span><span class="op" id="5608933">.</span><span class="ident" id="5608934">WriteString</span><span class="op" id="5608945">(</span><span class="ident" id="5608946">field</span><span class="op" id="5608951">)</span><span class="op" id="5608952">;</span>&nbsp;<span class="ident" id="5608954">err</span>&nbsp;<span class="op" id="5608958">!=</span>&nbsp;<span class="ident" id="5608961">nil</span>&nbsp;<span class="op" id="5608965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608971">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5608986">continue</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5608997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609001">if</span>&nbsp;<span class="ident" id="5609004">err</span>&nbsp;<span class="op" id="5609008">=</span>&nbsp;<span class="ident" id="5609010">w</span><span class="op" id="5609011">.</span><span class="ident" id="5609012">w</span><span class="op" id="5609013">.</span><span class="ident" id="5609014">WriteByte</span><span class="op" id="5609023">(</span><span class="string" id="5609024">&#39;&#34;&#39;</span><span class="op" id="5609027">)</span><span class="op" id="5609028">;</span>&nbsp;<span class="ident" id="5609030">err</span>&nbsp;<span class="op" id="5609034">!=</span>&nbsp;<span class="ident" id="5609037">nil</span>&nbsp;<span class="op" id="5609041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609060">for</span>&nbsp;<span class="ident" id="5609064">_</span><span class="op" id="5609065">,</span>&nbsp;<span class="ident" id="5609067">r1</span>&nbsp;<span class="op" id="5609070">:=</span>&nbsp;<span class="keyword" id="5609073">range</span>&nbsp;<span class="ident" id="5609079">field</span>&nbsp;<span class="op" id="5609085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609090">switch</span>&nbsp;<span class="ident" id="5609097">r1</span>&nbsp;<span class="op" id="5609100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609105">case</span>&nbsp;<span class="string" id="5609110">&#39;&#34;&#39;</span><span class="op" id="5609113">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609119">_</span><span class="op" id="5609120">,</span>&nbsp;<span class="ident" id="5609122">err</span>&nbsp;<span class="op" id="5609126">=</span>&nbsp;<span class="ident" id="5609128">w</span><span class="op" id="5609129">.</span><span class="ident" id="5609130">w</span><span class="op" id="5609131">.</span><span class="ident" id="5609132">WriteString</span><span class="op" id="5609143">(</span><span class="string" id="5609144">`&#34;&#34;`</span><span class="op" id="5609148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609153">case</span>&nbsp;<span class="string" id="5609158">&#39;\r&#39;</span><span class="op" id="5609162">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609168">if</span>&nbsp;<span class="op" id="5609171">!</span><span class="ident" id="5609172">w</span><span class="op" id="5609173">.</span><span class="ident" id="5609174">UseCRLF</span>&nbsp;<span class="op" id="5609182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609189">err</span>&nbsp;<span class="op" id="5609193">=</span>&nbsp;<span class="ident" id="5609195">w</span><span class="op" id="5609196">.</span><span class="ident" id="5609197">w</span><span class="op" id="5609198">.</span><span class="ident" id="5609199">WriteByte</span><span class="op" id="5609208">(</span><span class="string" id="5609209">&#39;\r&#39;</span><span class="op" id="5609213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609224">case</span>&nbsp;<span class="string" id="5609229">&#39;\n&#39;</span><span class="op" id="5609233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609239">if</span>&nbsp;<span class="ident" id="5609242">w</span><span class="op" id="5609243">.</span><span class="ident" id="5609244">UseCRLF</span>&nbsp;<span class="op" id="5609252">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609259">_</span><span class="op" id="5609260">,</span>&nbsp;<span class="ident" id="5609262">err</span>&nbsp;<span class="op" id="5609266">=</span>&nbsp;<span class="ident" id="5609268">w</span><span class="op" id="5609269">.</span><span class="ident" id="5609270">w</span><span class="op" id="5609271">.</span><span class="ident" id="5609272">WriteString</span><span class="op" id="5609283">(</span><span class="string" id="5609284">&#34;\r\n&#34;</span><span class="op" id="5609290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609296">}</span>&nbsp;<span class="keyword" id="5609298">else</span>&nbsp;<span class="op" id="5609303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609310">err</span>&nbsp;<span class="op" id="5609314">=</span>&nbsp;<span class="ident" id="5609316">w</span><span class="op" id="5609317">.</span><span class="ident" id="5609318">w</span><span class="op" id="5609319">.</span><span class="ident" id="5609320">WriteByte</span><span class="op" id="5609329">(</span><span class="string" id="5609330">&#39;\n&#39;</span><span class="op" id="5609334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609345">default</span><span class="op" id="5609352">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609358">_</span><span class="op" id="5609359">,</span>&nbsp;<span class="ident" id="5609361">err</span>&nbsp;<span class="op" id="5609365">=</span>&nbsp;<span class="ident" id="5609367">w</span><span class="op" id="5609368">.</span><span class="ident" id="5609369">w</span><span class="op" id="5609370">.</span><span class="ident" id="5609371">WriteRune</span><span class="op" id="5609380">(</span><span class="ident" id="5609381">r1</span><span class="op" id="5609383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609393">if</span>&nbsp;<span class="ident" id="5609396">err</span>&nbsp;<span class="op" id="5609400">!=</span>&nbsp;<span class="ident" id="5609403">nil</span>&nbsp;<span class="op" id="5609407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609413">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609423">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609432">if</span>&nbsp;<span class="ident" id="5609435">err</span>&nbsp;<span class="op" id="5609439">=</span>&nbsp;<span class="ident" id="5609441">w</span><span class="op" id="5609442">.</span><span class="ident" id="5609443">w</span><span class="op" id="5609444">.</span><span class="ident" id="5609445">WriteByte</span><span class="op" id="5609454">(</span><span class="string" id="5609455">&#39;&#34;&#39;</span><span class="op" id="5609458">)</span><span class="op" id="5609459">;</span>&nbsp;<span class="ident" id="5609461">err</span>&nbsp;<span class="op" id="5609465">!=</span>&nbsp;<span class="ident" id="5609468">nil</span>&nbsp;<span class="op" id="5609472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609477">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609486">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609492">if</span>&nbsp;<span class="ident" id="5609495">w</span><span class="op" id="5609496">.</span><span class="ident" id="5609497">UseCRLF</span>&nbsp;<span class="op" id="5609505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609509">_</span><span class="op" id="5609510">,</span>&nbsp;<span class="ident" id="5609512">err</span>&nbsp;<span class="op" id="5609516">=</span>&nbsp;<span class="ident" id="5609518">w</span><span class="op" id="5609519">.</span><span class="ident" id="5609520">w</span><span class="op" id="5609521">.</span><span class="ident" id="5609522">WriteString</span><span class="op" id="5609533">(</span><span class="string" id="5609534">&#34;\r\n&#34;</span><span class="op" id="5609540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609543">}</span>&nbsp;<span class="keyword" id="5609545">else</span>&nbsp;<span class="op" id="5609550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609554">err</span>&nbsp;<span class="op" id="5609558">=</span>&nbsp;<span class="ident" id="5609560">w</span><span class="op" id="5609561">.</span><span class="ident" id="5609562">w</span><span class="op" id="5609563">.</span><span class="ident" id="5609564">WriteByte</span><span class="op" id="5609573">(</span><span class="string" id="5609574">&#39;\n&#39;</span><span class="op" id="5609578">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5609581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609584">return</span><br>
<span class="lineno"></span><span class="op" id="5609591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5609594">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">95</span><span class="comment" id="5609657">//&nbsp;To&nbsp;check&nbsp;if&nbsp;an&nbsp;error&nbsp;occurred&nbsp;during&nbsp;the&nbsp;Flush,&nbsp;call&nbsp;Error.</span><br>
<span class="lineno"></span><span class="keyword" id="5609720">func</span>&nbsp;<span class="op" id="5609725">(</span><span class="ident" id="5609726">w</span>&nbsp;<span class="op" id="5609728">*</span><span class="ident" id="5609729">Writer</span><span class="op" id="5609735">)</span>&nbsp;<span class="ident" id="5609737">Flush</span><span class="op" id="5609742">(</span><span class="op" id="5609743">)</span>&nbsp;<span class="op" id="5609745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609748">w</span><span class="op" id="5609749">.</span><span class="ident" id="5609750">w</span><span class="op" id="5609751">.</span><span class="ident" id="5609752">Flush</span><span class="op" id="5609757">(</span><span class="op" id="5609758">)</span><br>
<span class="lineno"></span><span class="op" id="5609760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5609763">//&nbsp;Error&nbsp;reports&nbsp;any&nbsp;error&nbsp;that&nbsp;has&nbsp;occurred&nbsp;during&nbsp;a&nbsp;previous&nbsp;Write&nbsp;or&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="5609842">func</span>&nbsp;<span class="op" id="5609847">(</span><span class="ident" id="5609848">w</span>&nbsp;<span class="op" id="5609850">*</span><span class="ident" id="5609851">Writer</span><span class="op" id="5609857">)</span>&nbsp;<span class="ident" id="5609859">Error</span><span class="op" id="5609864">(</span><span class="op" id="5609865">)</span>&nbsp;<span class="builtintype" id="5609867">error</span>&nbsp;<span class="op" id="5609873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5609876">_</span><span class="op" id="5609877">,</span>&nbsp;<span class="ident" id="5609879">err</span>&nbsp;<span class="op" id="5609883">:=</span>&nbsp;<span class="ident" id="5609886">w</span><span class="op" id="5609887">.</span><span class="ident" id="5609888">w</span><span class="op" id="5609889">.</span><span class="ident" id="5609890">Write</span><span class="op" id="5609895">(</span><span class="ident" id="5609896">nil</span><span class="op" id="5609899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5609902">return</span>&nbsp;<span class="ident" id="5609909">err</span><br>
<span class="lineno"></span><span class="op" id="5609913">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="5609916">//&nbsp;WriteAll&nbsp;writes&nbsp;multiple&nbsp;CSV&nbsp;records&nbsp;to&nbsp;w&nbsp;using&nbsp;Write&nbsp;and&nbsp;then&nbsp;calls&nbsp;Flush.</span><br>
<span class="lineno"></span><span class="keyword" id="5609995">func</span>&nbsp;<span class="op" id="5610000">(</span><span class="ident" id="5610001">w</span>&nbsp;<span class="op" id="5610003">*</span><span class="ident" id="5610004">Writer</span><span class="op" id="5610010">)</span>&nbsp;<span class="ident" id="5610012">WriteAll</span><span class="op" id="5610020">(</span><span class="ident" id="5610021">records</span>&nbsp;<span class="op" id="5610029">[</span><span class="op" id="5610030">]</span><span class="op" id="5610031">[</span><span class="op" id="5610032">]</span><span class="builtintype" id="5610033">string</span><span class="op" id="5610039">)</span>&nbsp;<span class="op" id="5610041">(</span><span class="ident" id="5610042">err</span>&nbsp;<span class="builtintype" id="5610046">error</span><span class="op" id="5610051">)</span>&nbsp;<span class="op" id="5610053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610056">for</span>&nbsp;<span class="ident" id="5610060">_</span><span class="op" id="5610061">,</span>&nbsp;<span class="ident" id="5610063">record</span>&nbsp;<span class="op" id="5610070">:=</span>&nbsp;<span class="keyword" id="5610073">range</span>&nbsp;<span class="ident" id="5610079">records</span>&nbsp;<span class="op" id="5610087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5610091">err</span>&nbsp;<span class="op" id="5610095">=</span>&nbsp;<span class="ident" id="5610097">w</span><span class="op" id="5610098">.</span><span class="ident" id="5610099">Write</span><span class="op" id="5610104">(</span><span class="ident" id="5610105">record</span><span class="op" id="5610111">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610115">if</span>&nbsp;<span class="ident" id="5610118">err</span>&nbsp;<span class="op" id="5610122">!=</span>&nbsp;<span class="ident" id="5610125">nil</span>&nbsp;<span class="op" id="5610129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610134">return</span>&nbsp;<span class="ident" id="5610141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5610150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5610153">return</span>&nbsp;<span class="ident" id="5610160">w</span><span class="op" id="5610161">.</span><span class="ident" id="5610162">w</span><span class="op" id="5610163">.</span><span class="ident" id="5610164">Flush</span><span class="op" id="5610169">(</span><span class="op" id="5610170">)</span><br>
<span class="lineno">115</span><span class="op" id="5610172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5610175">//&nbsp;fieldNeedsQuotes&nbsp;returns&nbsp;true&nbsp;if&nbsp;our&nbsp;field&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno"></span><span class="comment" id="5610249">//&nbsp;Fields&nbsp;with&nbsp;a&nbsp;Comma,&nbsp;fields&nbsp;with&nbsp;a&nbsp;quote&nbsp;or&nbsp;newline,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5610309">//&nbsp;fields&nbsp;which&nbsp;start&nbsp;with&nbsp;a&nbsp;space&nbsp;must&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;quotes.</span><br>
<span class="lineno">120</span><span class="comment" id="5610372">//&nbsp;We&nbsp;used&nbsp;to&nbsp;quote&nbsp;empty&nbsp;strings,&nbsp;but&nbsp;we&nbsp;do&nbsp;not&nbsp;anymore&nbsp;(as&nbsp;of&nbsp;Go&nbsp;1.4).</span><br>
<span class="lineno"></span><span class="comment" id="5610445">//&nbsp;The&nbsp;two&nbsp;representations&nbsp;should&nbsp;be&nbsp;equivalent,&nbsp;but&nbsp;Postgres&nbsp;distinguishes</span><br>
<span class="lineno"></span><span class="comment" id="5610521">//&nbsp;quoted&nbsp;vs&nbsp;non-quoted&nbsp;empty&nbsp;string&nbsp;during&nbsp;database&nbsp;imports,&nbsp;and&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5610594">//&nbsp;an&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;quoted&nbsp;behavior&nbsp;for&nbsp;non-quoted&nbsp;CSV&nbsp;but&nbsp;it&nbsp;has</span><br>
<span class="lineno"></span><span class="comment" id="5610666">//&nbsp;no&nbsp;option&nbsp;to&nbsp;force&nbsp;the&nbsp;non-quoted&nbsp;behavior&nbsp;for&nbsp;quoted&nbsp;CSV,&nbsp;making</span><br>
<span class="lineno">125</span><span class="comment" id="5610735">//&nbsp;CSV&nbsp;with&nbsp;quoted&nbsp;empty&nbsp;strings&nbsp;strictly&nbsp;less&nbsp;useful.</span><br>
<span class="lineno"></span><span class="comment" id="5610790">//&nbsp;Not&nbsp;quoting&nbsp;the&nbsp;empty&nbsp;string&nbsp;also&nbsp;makes&nbsp;this&nbsp;package&nbsp;match&nbsp;the&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="5610865">//&nbsp;of&nbsp;Microsoft&nbsp;Excel&nbsp;and&nbsp;Google&nbsp;Drive.</span><br>
<span class="lineno"></span><span class="comment" id="5610905">//&nbsp;For&nbsp;Postgres,&nbsp;quote&nbsp;the&nbsp;data&nbsp;termating&nbsp;string&nbsp;`\.`.</span><br>
<span class="lineno"></span><span class="keyword" id="5610960">func</span>&nbsp;<span class="op" id="5610965">(</span><span class="ident" id="5610966">w</span>&nbsp;<span class="op" id="5610968">*</span><span class="ident" id="5610969">Writer</span><span class="op" id="5610975">)</span>&nbsp;<span class="ident" id="5610977">fieldNeedsQuotes</span><span class="op" id="5610993">(</span><span class="ident" id="5610994">field</span>&nbsp;<span class="builtintype" id="5611000">string</span><span class="op" id="5611006">)</span>&nbsp;<span class="builtintype" id="5611008">bool</span>&nbsp;<span class="op" id="5611013">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611016">if</span>&nbsp;<span class="ident" id="5611019">field</span>&nbsp;<span class="op" id="5611025">==</span>&nbsp;<span class="string" id="5611028">&#34;&#34;</span>&nbsp;<span class="op" id="5611031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611035">return</span>&nbsp;<span class="builtintype" id="5611042">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611052">if</span>&nbsp;<span class="ident" id="5611055">field</span>&nbsp;<span class="op" id="5611061">==</span>&nbsp;<span class="string" id="5611064">`\.`</span>&nbsp;<span class="op" id="5611069">||</span>&nbsp;<span class="ident" id="5611072">strings</span><span class="op" id="5611079">.</span><span class="ident" id="5611080">IndexRune</span><span class="op" id="5611089">(</span><span class="ident" id="5611090">field</span><span class="op" id="5611095">,</span>&nbsp;<span class="ident" id="5611097">w</span><span class="op" id="5611098">.</span><span class="ident" id="5611099">Comma</span><span class="op" id="5611104">)</span>&nbsp;<span class="op" id="5611106">&gt;=</span>&nbsp;<span class="num" id="5611109">0</span>&nbsp;<span class="op" id="5611111">||</span>&nbsp;<span class="ident" id="5611114">strings</span><span class="op" id="5611121">.</span><span class="ident" id="5611122">IndexAny</span><span class="op" id="5611130">(</span><span class="ident" id="5611131">field</span><span class="op" id="5611136">,</span>&nbsp;<span class="string" id="5611138">&#34;\&#34;\r\n&#34;</span><span class="op" id="5611146">)</span>&nbsp;<span class="op" id="5611148">&gt;=</span>&nbsp;<span class="num" id="5611151">0</span>&nbsp;<span class="op" id="5611153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611157">return</span>&nbsp;<span class="builtintype" id="5611164">true</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5611170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5611174">r1</span><span class="op" id="5611176">,</span>&nbsp;<span class="ident" id="5611178">_</span>&nbsp;<span class="op" id="5611180">:=</span>&nbsp;<span class="ident" id="5611183">utf8</span><span class="op" id="5611187">.</span><span class="ident" id="5611188">DecodeRuneInString</span><span class="op" id="5611206">(</span><span class="ident" id="5611207">field</span><span class="op" id="5611212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5611215">return</span>&nbsp;<span class="ident" id="5611222">unicode</span><span class="op" id="5611229">.</span><span class="ident" id="5611230">IsSpace</span><span class="op" id="5611237">(</span><span class="ident" id="5611238">r1</span><span class="op" id="5611240">)</span><br>
<span class="lineno"></span><span class="op" id="5611242">}</span>
</div>
</body>
</html>
