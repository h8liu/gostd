<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/aes</h2>
<ul>
<li><a href="/gostd/crypto/aes/aes_test.go.html">aes_test.go</a></li>
<li><a href="/gostd/crypto/aes/block.go.html">block.go</a></li>
<li><a href="/gostd/crypto/aes/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/aes/cipher_asm.go.html">cipher_asm.go</a></li>
<li><a href="/gostd/crypto/aes/const.go.html">const.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4563838">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4563893">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4563947">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4563998">//&nbsp;This&nbsp;Go&nbsp;implementation&nbsp;is&nbsp;derived&nbsp;in&nbsp;part&nbsp;from&nbsp;the&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="4564062">//&nbsp;ANSI&nbsp;C&nbsp;implementation,&nbsp;which&nbsp;carries&nbsp;the&nbsp;following&nbsp;notice:</span><br>
<span class="lineno"></span><span class="comment" id="4564124">//</span><br>
<span class="lineno"></span><span class="comment" id="4564127">//&nbsp;&nbsp;&nbsp;&nbsprijndael-alg-fst.c</span><br>
<span class="lineno"></span><span class="comment" id="4564149">//</span><br>
<span class="lineno">10</span><span class="comment" id="4564152">//&nbsp;&nbsp;&nbsp;&nbsp@version&nbsp;3.0&nbsp;(December&nbsp;2000)</span><br>
<span class="lineno"></span><span class="comment" id="4564184">//</span><br>
<span class="lineno"></span><span class="comment" id="4564187">//&nbsp;&nbsp;&nbsp;&nbspOptimised&nbsp;ANSI&nbsp;C&nbsp;code&nbsp;for&nbsp;the&nbsp;Rijndael&nbsp;cipher&nbsp;(now&nbsp;AES)</span><br>
<span class="lineno"></span><span class="comment" id="4564246">//</span><br>
<span class="lineno"></span><span class="comment" id="4564249">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Vincent&nbsp;Rijmen&nbsp;&lt;vincent.rijmen@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno">15</span><span class="comment" id="4564312">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Antoon&nbsp;Bosselaers&nbsp;&lt;antoon.bosselaers@esat.kuleuven.ac.be&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4564381">//&nbsp;&nbsp;&nbsp;&nbsp@author&nbsp;Paulo&nbsp;Barreto&nbsp;&lt;paulo.barreto@terra.com.br&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4564435">//</span><br>
<span class="lineno"></span><span class="comment" id="4564438">//&nbsp;&nbsp;&nbsp;&nbspThis&nbsp;code&nbsp;is&nbsp;hereby&nbsp;placed&nbsp;in&nbsp;the&nbsp;public&nbsp;domain.</span><br>
<span class="lineno"></span><span class="comment" id="4564490">//</span><br>
<span class="lineno">20</span><span class="comment" id="4564493">//&nbsp;&nbsp;&nbsp;&nbspTHIS&nbsp;SOFTWARE&nbsp;IS&nbsp;PROVIDED&nbsp;BY&nbsp;THE&nbsp;AUTHORS&nbsp;&#39;&#39;AS&nbsp;IS&#39;&#39;&nbsp;AND&nbsp;ANY&nbsp;EXPRESS</span><br>
<span class="lineno"></span><span class="comment" id="4564563">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;IMPLIED&nbsp;WARRANTIES,&nbsp;INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;THE&nbsp;IMPLIED</span><br>
<span class="lineno"></span><span class="comment" id="4564632">//&nbsp;&nbsp;&nbsp;&nbspWARRANTIES&nbsp;OF&nbsp;MERCHANTABILITY&nbsp;AND&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE</span><br>
<span class="lineno"></span><span class="comment" id="4564702">//&nbsp;&nbsp;&nbsp;&nbspARE&nbsp;DISCLAIMED.&nbsp;&nbsp;IN&nbsp;NO&nbsp;EVENT&nbsp;SHALL&nbsp;THE&nbsp;AUTHORS&nbsp;OR&nbsp;CONTRIBUTORS&nbsp;BE</span><br>
<span class="lineno"></span><span class="comment" id="4564771">//&nbsp;&nbsp;&nbsp;&nbspLIABLE&nbsp;FOR&nbsp;ANY&nbsp;DIRECT,&nbsp;INDIRECT,&nbsp;INCIDENTAL,&nbsp;SPECIAL,&nbsp;EXEMPLARY,&nbsp;OR</span><br>
<span class="lineno">25</span><span class="comment" id="4564842">//&nbsp;&nbsp;&nbsp;&nbspCONSEQUENTIAL&nbsp;DAMAGES&nbsp;(INCLUDING,&nbsp;BUT&nbsp;NOT&nbsp;LIMITED&nbsp;TO,&nbsp;PROCUREMENT&nbsp;OF</span><br>
<span class="lineno"></span><span class="comment" id="4564914">//&nbsp;&nbsp;&nbsp;&nbspSUBSTITUTE&nbsp;GOODS&nbsp;OR&nbsp;SERVICES;&nbsp;LOSS&nbsp;OF&nbsp;USE,&nbsp;DATA,&nbsp;OR&nbsp;PROFITS;&nbsp;OR</span><br>
<span class="lineno"></span><span class="comment" id="4564981">//&nbsp;&nbsp;&nbsp;&nbspBUSINESS&nbsp;INTERRUPTION)&nbsp;HOWEVER&nbsp;CAUSED&nbsp;AND&nbsp;ON&nbsp;ANY&nbsp;THEORY&nbsp;OF&nbsp;LIABILITY,</span><br>
<span class="lineno"></span><span class="comment" id="4565054">//&nbsp;&nbsp;&nbsp;&nbspWHETHER&nbsp;IN&nbsp;CONTRACT,&nbsp;STRICT&nbsp;LIABILITY,&nbsp;OR&nbsp;TORT&nbsp;(INCLUDING&nbsp;NEGLIGENCE</span><br>
<span class="lineno"></span><span class="comment" id="4565126">//&nbsp;&nbsp;&nbsp;&nbspOR&nbsp;OTHERWISE)&nbsp;ARISING&nbsp;IN&nbsp;ANY&nbsp;WAY&nbsp;OUT&nbsp;OF&nbsp;THE&nbsp;USE&nbsp;OF&nbsp;THIS&nbsp;SOFTWARE,</span><br>
<span class="lineno">30</span><span class="comment" id="4565195">//&nbsp;&nbsp;&nbsp;&nbspEVEN&nbsp;IF&nbsp;ADVISED&nbsp;OF&nbsp;THE&nbsp;POSSIBILITY&nbsp;OF&nbsp;SUCH&nbsp;DAMAGE.</span><br>
<span class="lineno"></span><span class="comment" id="4565249">//</span><br>
<span class="lineno"></span><span class="comment" id="4565252">//&nbsp;See&nbsp;FIPS&nbsp;197&nbsp;for&nbsp;specification,&nbsp;and&nbsp;see&nbsp;Daemen&nbsp;and&nbsp;Rijmen&#39;s&nbsp;Rijndael&nbsp;submission</span><br>
<span class="lineno"></span><span class="comment" id="4565335">//&nbsp;for&nbsp;implementation&nbsp;details.</span><br>
<span class="lineno"></span><span class="comment" id="4565366">//&nbsp;&nbsp;&nbsp;&nbsphttp://www.csrc.nist.gov/publications/fips/fips197/fips-197.pdf</span><br>
<span class="lineno">35</span><span class="comment" id="4565433">//&nbsp;&nbsp;&nbsp;&nbsphttp://csrc.nist.gov/archive/aes/rijndael/Rijndael-ammended.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4565501">package</span>&nbsp;<span class="ident" id="4565509">aes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4565514">//&nbsp;Encrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">40</span><span class="keyword" id="4565581">func</span>&nbsp;<span class="ident" id="4565586">encryptBlockGo</span><span class="op" id="4565600">(</span><span class="ident" id="4565601">xk</span>&nbsp;<span class="op" id="4565604">[</span><span class="op" id="4565605">]</span><span class="builtintype" id="4565606">uint32</span><span class="op" id="4565612">,</span>&nbsp;<span class="ident" id="4565614">dst</span><span class="op" id="4565617">,</span>&nbsp;<span class="ident" id="4565619">src</span>&nbsp;<span class="op" id="4565623">[</span><span class="op" id="4565624">]</span><span class="builtintype" id="4565625">byte</span><span class="op" id="4565629">)</span>&nbsp;<span class="op" id="4565631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4565634">var</span>&nbsp;<span class="ident" id="4565638">s0</span><span class="op" id="4565640">,</span>&nbsp;<span class="ident" id="4565642">s1</span><span class="op" id="4565644">,</span>&nbsp;<span class="ident" id="4565646">s2</span><span class="op" id="4565648">,</span>&nbsp;<span class="ident" id="4565650">s3</span><span class="op" id="4565652">,</span>&nbsp;<span class="ident" id="4565654">t0</span><span class="op" id="4565656">,</span>&nbsp;<span class="ident" id="4565658">t1</span><span class="op" id="4565660">,</span>&nbsp;<span class="ident" id="4565662">t2</span><span class="op" id="4565664">,</span>&nbsp;<span class="ident" id="4565666">t3</span>&nbsp;<span class="builtintype" id="4565669">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565678">s0</span>&nbsp;<span class="op" id="4565681">=</span>&nbsp;<span class="builtintype" id="4565683">uint32</span><span class="op" id="4565689">(</span><span class="ident" id="4565690">src</span><span class="op" id="4565693">[</span><span class="num" id="4565694">0</span><span class="op" id="4565695">]</span><span class="op" id="4565696">)</span><span class="op" id="4565697">&lt;&lt;</span><span class="num" id="4565699">24</span>&nbsp;<span class="op" id="4565702">|</span>&nbsp;<span class="builtintype" id="4565704">uint32</span><span class="op" id="4565710">(</span><span class="ident" id="4565711">src</span><span class="op" id="4565714">[</span><span class="num" id="4565715">1</span><span class="op" id="4565716">]</span><span class="op" id="4565717">)</span><span class="op" id="4565718">&lt;&lt;</span><span class="num" id="4565720">16</span>&nbsp;<span class="op" id="4565723">|</span>&nbsp;<span class="builtintype" id="4565725">uint32</span><span class="op" id="4565731">(</span><span class="ident" id="4565732">src</span><span class="op" id="4565735">[</span><span class="num" id="4565736">2</span><span class="op" id="4565737">]</span><span class="op" id="4565738">)</span><span class="op" id="4565739">&lt;&lt;</span><span class="num" id="4565741">8</span>&nbsp;<span class="op" id="4565743">|</span>&nbsp;<span class="builtintype" id="4565745">uint32</span><span class="op" id="4565751">(</span><span class="ident" id="4565752">src</span><span class="op" id="4565755">[</span><span class="num" id="4565756">3</span><span class="op" id="4565757">]</span><span class="op" id="4565758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565761">s1</span>&nbsp;<span class="op" id="4565764">=</span>&nbsp;<span class="builtintype" id="4565766">uint32</span><span class="op" id="4565772">(</span><span class="ident" id="4565773">src</span><span class="op" id="4565776">[</span><span class="num" id="4565777">4</span><span class="op" id="4565778">]</span><span class="op" id="4565779">)</span><span class="op" id="4565780">&lt;&lt;</span><span class="num" id="4565782">24</span>&nbsp;<span class="op" id="4565785">|</span>&nbsp;<span class="builtintype" id="4565787">uint32</span><span class="op" id="4565793">(</span><span class="ident" id="4565794">src</span><span class="op" id="4565797">[</span><span class="num" id="4565798">5</span><span class="op" id="4565799">]</span><span class="op" id="4565800">)</span><span class="op" id="4565801">&lt;&lt;</span><span class="num" id="4565803">16</span>&nbsp;<span class="op" id="4565806">|</span>&nbsp;<span class="builtintype" id="4565808">uint32</span><span class="op" id="4565814">(</span><span class="ident" id="4565815">src</span><span class="op" id="4565818">[</span><span class="num" id="4565819">6</span><span class="op" id="4565820">]</span><span class="op" id="4565821">)</span><span class="op" id="4565822">&lt;&lt;</span><span class="num" id="4565824">8</span>&nbsp;<span class="op" id="4565826">|</span>&nbsp;<span class="builtintype" id="4565828">uint32</span><span class="op" id="4565834">(</span><span class="ident" id="4565835">src</span><span class="op" id="4565838">[</span><span class="num" id="4565839">7</span><span class="op" id="4565840">]</span><span class="op" id="4565841">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565844">s2</span>&nbsp;<span class="op" id="4565847">=</span>&nbsp;<span class="builtintype" id="4565849">uint32</span><span class="op" id="4565855">(</span><span class="ident" id="4565856">src</span><span class="op" id="4565859">[</span><span class="num" id="4565860">8</span><span class="op" id="4565861">]</span><span class="op" id="4565862">)</span><span class="op" id="4565863">&lt;&lt;</span><span class="num" id="4565865">24</span>&nbsp;<span class="op" id="4565868">|</span>&nbsp;<span class="builtintype" id="4565870">uint32</span><span class="op" id="4565876">(</span><span class="ident" id="4565877">src</span><span class="op" id="4565880">[</span><span class="num" id="4565881">9</span><span class="op" id="4565882">]</span><span class="op" id="4565883">)</span><span class="op" id="4565884">&lt;&lt;</span><span class="num" id="4565886">16</span>&nbsp;<span class="op" id="4565889">|</span>&nbsp;<span class="builtintype" id="4565891">uint32</span><span class="op" id="4565897">(</span><span class="ident" id="4565898">src</span><span class="op" id="4565901">[</span><span class="num" id="4565902">10</span><span class="op" id="4565904">]</span><span class="op" id="4565905">)</span><span class="op" id="4565906">&lt;&lt;</span><span class="num" id="4565908">8</span>&nbsp;<span class="op" id="4565910">|</span>&nbsp;<span class="builtintype" id="4565912">uint32</span><span class="op" id="4565918">(</span><span class="ident" id="4565919">src</span><span class="op" id="4565922">[</span><span class="num" id="4565923">11</span><span class="op" id="4565925">]</span><span class="op" id="4565926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4565929">s3</span>&nbsp;<span class="op" id="4565932">=</span>&nbsp;<span class="builtintype" id="4565934">uint32</span><span class="op" id="4565940">(</span><span class="ident" id="4565941">src</span><span class="op" id="4565944">[</span><span class="num" id="4565945">12</span><span class="op" id="4565947">]</span><span class="op" id="4565948">)</span><span class="op" id="4565949">&lt;&lt;</span><span class="num" id="4565951">24</span>&nbsp;<span class="op" id="4565954">|</span>&nbsp;<span class="builtintype" id="4565956">uint32</span><span class="op" id="4565962">(</span><span class="ident" id="4565963">src</span><span class="op" id="4565966">[</span><span class="num" id="4565967">13</span><span class="op" id="4565969">]</span><span class="op" id="4565970">)</span><span class="op" id="4565971">&lt;&lt;</span><span class="num" id="4565973">16</span>&nbsp;<span class="op" id="4565976">|</span>&nbsp;<span class="builtintype" id="4565978">uint32</span><span class="op" id="4565984">(</span><span class="ident" id="4565985">src</span><span class="op" id="4565988">[</span><span class="num" id="4565989">14</span><span class="op" id="4565991">]</span><span class="op" id="4565992">)</span><span class="op" id="4565993">&lt;&lt;</span><span class="num" id="4565995">8</span>&nbsp;<span class="op" id="4565997">|</span>&nbsp;<span class="builtintype" id="4565999">uint32</span><span class="op" id="4566005">(</span><span class="ident" id="4566006">src</span><span class="op" id="4566009">[</span><span class="num" id="4566010">15</span><span class="op" id="4566012">]</span><span class="op" id="4566013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566017">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566059">s0</span>&nbsp;<span class="op" id="4566062">^=</span>&nbsp;<span class="ident" id="4566065">xk</span><span class="op" id="4566067">[</span><span class="num" id="4566068">0</span><span class="op" id="4566069">]</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566072">s1</span>&nbsp;<span class="op" id="4566075">^=</span>&nbsp;<span class="ident" id="4566078">xk</span><span class="op" id="4566080">[</span><span class="num" id="4566081">1</span><span class="op" id="4566082">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566085">s2</span>&nbsp;<span class="op" id="4566088">^=</span>&nbsp;<span class="ident" id="4566091">xk</span><span class="op" id="4566093">[</span><span class="num" id="4566094">2</span><span class="op" id="4566095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566098">s3</span>&nbsp;<span class="op" id="4566101">^=</span>&nbsp;<span class="ident" id="4566104">xk</span><span class="op" id="4566106">[</span><span class="num" id="4566107">3</span><span class="op" id="4566108">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566112">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566152">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566207">nr</span>&nbsp;<span class="op" id="4566210">:=</span>&nbsp;<span class="builtinfunc" id="4566213">len</span><span class="op" id="4566216">(</span><span class="ident" id="4566217">xk</span><span class="op" id="4566219">)</span><span class="op" id="4566220">/</span><span class="num" id="4566221">4</span>&nbsp;<span class="op" id="4566223">-</span>&nbsp;<span class="num" id="4566225">2</span>&nbsp;<span class="comment" id="4566227">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566262">k</span>&nbsp;<span class="op" id="4566264">:=</span>&nbsp;<span class="num" id="4566267">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4566270">for</span>&nbsp;<span class="ident" id="4566274">r</span>&nbsp;<span class="op" id="4566276">:=</span>&nbsp;<span class="num" id="4566279">0</span><span class="op" id="4566280">;</span>&nbsp;<span class="ident" id="4566282">r</span>&nbsp;<span class="op" id="4566284">&lt;</span>&nbsp;<span class="ident" id="4566286">nr</span><span class="op" id="4566288">;</span>&nbsp;<span class="ident" id="4566290">r</span><span class="op" id="4566291">++</span>&nbsp;<span class="op" id="4566294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566298">t0</span>&nbsp;<span class="op" id="4566301">=</span>&nbsp;<span class="ident" id="4566303">xk</span><span class="op" id="4566305">[</span><span class="ident" id="4566306">k</span><span class="op" id="4566307">+</span><span class="num" id="4566308">0</span><span class="op" id="4566309">]</span>&nbsp;<span class="op" id="4566311">^</span>&nbsp;<span class="ident" id="4566313">te0</span><span class="op" id="4566316">[</span><span class="builtintype" id="4566317">uint8</span><span class="op" id="4566322">(</span><span class="ident" id="4566323">s0</span><span class="op" id="4566325">&gt;&gt;</span><span class="num" id="4566327">24</span><span class="op" id="4566329">)</span><span class="op" id="4566330">]</span>&nbsp;<span class="op" id="4566332">^</span>&nbsp;<span class="ident" id="4566334">te1</span><span class="op" id="4566337">[</span><span class="builtintype" id="4566338">uint8</span><span class="op" id="4566343">(</span><span class="ident" id="4566344">s1</span><span class="op" id="4566346">&gt;&gt;</span><span class="num" id="4566348">16</span><span class="op" id="4566350">)</span><span class="op" id="4566351">]</span>&nbsp;<span class="op" id="4566353">^</span>&nbsp;<span class="ident" id="4566355">te2</span><span class="op" id="4566358">[</span><span class="builtintype" id="4566359">uint8</span><span class="op" id="4566364">(</span><span class="ident" id="4566365">s2</span><span class="op" id="4566367">&gt;&gt;</span><span class="num" id="4566369">8</span><span class="op" id="4566370">)</span><span class="op" id="4566371">]</span>&nbsp;<span class="op" id="4566373">^</span>&nbsp;<span class="ident" id="4566375">te3</span><span class="op" id="4566378">[</span><span class="builtintype" id="4566379">uint8</span><span class="op" id="4566384">(</span><span class="ident" id="4566385">s3</span><span class="op" id="4566387">)</span><span class="op" id="4566388">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566392">t1</span>&nbsp;<span class="op" id="4566395">=</span>&nbsp;<span class="ident" id="4566397">xk</span><span class="op" id="4566399">[</span><span class="ident" id="4566400">k</span><span class="op" id="4566401">+</span><span class="num" id="4566402">1</span><span class="op" id="4566403">]</span>&nbsp;<span class="op" id="4566405">^</span>&nbsp;<span class="ident" id="4566407">te0</span><span class="op" id="4566410">[</span><span class="builtintype" id="4566411">uint8</span><span class="op" id="4566416">(</span><span class="ident" id="4566417">s1</span><span class="op" id="4566419">&gt;&gt;</span><span class="num" id="4566421">24</span><span class="op" id="4566423">)</span><span class="op" id="4566424">]</span>&nbsp;<span class="op" id="4566426">^</span>&nbsp;<span class="ident" id="4566428">te1</span><span class="op" id="4566431">[</span><span class="builtintype" id="4566432">uint8</span><span class="op" id="4566437">(</span><span class="ident" id="4566438">s2</span><span class="op" id="4566440">&gt;&gt;</span><span class="num" id="4566442">16</span><span class="op" id="4566444">)</span><span class="op" id="4566445">]</span>&nbsp;<span class="op" id="4566447">^</span>&nbsp;<span class="ident" id="4566449">te2</span><span class="op" id="4566452">[</span><span class="builtintype" id="4566453">uint8</span><span class="op" id="4566458">(</span><span class="ident" id="4566459">s3</span><span class="op" id="4566461">&gt;&gt;</span><span class="num" id="4566463">8</span><span class="op" id="4566464">)</span><span class="op" id="4566465">]</span>&nbsp;<span class="op" id="4566467">^</span>&nbsp;<span class="ident" id="4566469">te3</span><span class="op" id="4566472">[</span><span class="builtintype" id="4566473">uint8</span><span class="op" id="4566478">(</span><span class="ident" id="4566479">s0</span><span class="op" id="4566481">)</span><span class="op" id="4566482">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566486">t2</span>&nbsp;<span class="op" id="4566489">=</span>&nbsp;<span class="ident" id="4566491">xk</span><span class="op" id="4566493">[</span><span class="ident" id="4566494">k</span><span class="op" id="4566495">+</span><span class="num" id="4566496">2</span><span class="op" id="4566497">]</span>&nbsp;<span class="op" id="4566499">^</span>&nbsp;<span class="ident" id="4566501">te0</span><span class="op" id="4566504">[</span><span class="builtintype" id="4566505">uint8</span><span class="op" id="4566510">(</span><span class="ident" id="4566511">s2</span><span class="op" id="4566513">&gt;&gt;</span><span class="num" id="4566515">24</span><span class="op" id="4566517">)</span><span class="op" id="4566518">]</span>&nbsp;<span class="op" id="4566520">^</span>&nbsp;<span class="ident" id="4566522">te1</span><span class="op" id="4566525">[</span><span class="builtintype" id="4566526">uint8</span><span class="op" id="4566531">(</span><span class="ident" id="4566532">s3</span><span class="op" id="4566534">&gt;&gt;</span><span class="num" id="4566536">16</span><span class="op" id="4566538">)</span><span class="op" id="4566539">]</span>&nbsp;<span class="op" id="4566541">^</span>&nbsp;<span class="ident" id="4566543">te2</span><span class="op" id="4566546">[</span><span class="builtintype" id="4566547">uint8</span><span class="op" id="4566552">(</span><span class="ident" id="4566553">s0</span><span class="op" id="4566555">&gt;&gt;</span><span class="num" id="4566557">8</span><span class="op" id="4566558">)</span><span class="op" id="4566559">]</span>&nbsp;<span class="op" id="4566561">^</span>&nbsp;<span class="ident" id="4566563">te3</span><span class="op" id="4566566">[</span><span class="builtintype" id="4566567">uint8</span><span class="op" id="4566572">(</span><span class="ident" id="4566573">s1</span><span class="op" id="4566575">)</span><span class="op" id="4566576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566580">t3</span>&nbsp;<span class="op" id="4566583">=</span>&nbsp;<span class="ident" id="4566585">xk</span><span class="op" id="4566587">[</span><span class="ident" id="4566588">k</span><span class="op" id="4566589">+</span><span class="num" id="4566590">3</span><span class="op" id="4566591">]</span>&nbsp;<span class="op" id="4566593">^</span>&nbsp;<span class="ident" id="4566595">te0</span><span class="op" id="4566598">[</span><span class="builtintype" id="4566599">uint8</span><span class="op" id="4566604">(</span><span class="ident" id="4566605">s3</span><span class="op" id="4566607">&gt;&gt;</span><span class="num" id="4566609">24</span><span class="op" id="4566611">)</span><span class="op" id="4566612">]</span>&nbsp;<span class="op" id="4566614">^</span>&nbsp;<span class="ident" id="4566616">te1</span><span class="op" id="4566619">[</span><span class="builtintype" id="4566620">uint8</span><span class="op" id="4566625">(</span><span class="ident" id="4566626">s0</span><span class="op" id="4566628">&gt;&gt;</span><span class="num" id="4566630">16</span><span class="op" id="4566632">)</span><span class="op" id="4566633">]</span>&nbsp;<span class="op" id="4566635">^</span>&nbsp;<span class="ident" id="4566637">te2</span><span class="op" id="4566640">[</span><span class="builtintype" id="4566641">uint8</span><span class="op" id="4566646">(</span><span class="ident" id="4566647">s1</span><span class="op" id="4566649">&gt;&gt;</span><span class="num" id="4566651">8</span><span class="op" id="4566652">)</span><span class="op" id="4566653">]</span>&nbsp;<span class="op" id="4566655">^</span>&nbsp;<span class="ident" id="4566657">te3</span><span class="op" id="4566660">[</span><span class="builtintype" id="4566661">uint8</span><span class="op" id="4566666">(</span><span class="ident" id="4566667">s2</span><span class="op" id="4566669">)</span><span class="op" id="4566670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566674">k</span>&nbsp;<span class="op" id="4566676">+=</span>&nbsp;<span class="num" id="4566679">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566683">s0</span><span class="op" id="4566685">,</span>&nbsp;<span class="ident" id="4566687">s1</span><span class="op" id="4566689">,</span>&nbsp;<span class="ident" id="4566691">s2</span><span class="op" id="4566693">,</span>&nbsp;<span class="ident" id="4566695">s3</span>&nbsp;<span class="op" id="4566698">=</span>&nbsp;<span class="ident" id="4566700">t0</span><span class="op" id="4566702">,</span>&nbsp;<span class="ident" id="4566704">t1</span><span class="op" id="4566706">,</span>&nbsp;<span class="ident" id="4566708">t2</span><span class="op" id="4566710">,</span>&nbsp;<span class="ident" id="4566712">t3</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4566716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4566720">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566783">s0</span>&nbsp;<span class="op" id="4566786">=</span>&nbsp;<span class="builtintype" id="4566788">uint32</span><span class="op" id="4566794">(</span><span class="ident" id="4566795">sbox0</span><span class="op" id="4566800">[</span><span class="ident" id="4566801">t0</span><span class="op" id="4566803">&gt;&gt;</span><span class="num" id="4566805">24</span><span class="op" id="4566807">]</span><span class="op" id="4566808">)</span><span class="op" id="4566809">&lt;&lt;</span><span class="num" id="4566811">24</span>&nbsp;<span class="op" id="4566814">|</span>&nbsp;<span class="builtintype" id="4566816">uint32</span><span class="op" id="4566822">(</span><span class="ident" id="4566823">sbox0</span><span class="op" id="4566828">[</span><span class="ident" id="4566829">t1</span><span class="op" id="4566831">&gt;&gt;</span><span class="num" id="4566833">16</span><span class="op" id="4566835">&amp;</span><span class="num" id="4566836">0xff</span><span class="op" id="4566840">]</span><span class="op" id="4566841">)</span><span class="op" id="4566842">&lt;&lt;</span><span class="num" id="4566844">16</span>&nbsp;<span class="op" id="4566847">|</span>&nbsp;<span class="builtintype" id="4566849">uint32</span><span class="op" id="4566855">(</span><span class="ident" id="4566856">sbox0</span><span class="op" id="4566861">[</span><span class="ident" id="4566862">t2</span><span class="op" id="4566864">&gt;&gt;</span><span class="num" id="4566866">8</span><span class="op" id="4566867">&amp;</span><span class="num" id="4566868">0xff</span><span class="op" id="4566872">]</span><span class="op" id="4566873">)</span><span class="op" id="4566874">&lt;&lt;</span><span class="num" id="4566876">8</span>&nbsp;<span class="op" id="4566878">|</span>&nbsp;<span class="builtintype" id="4566880">uint32</span><span class="op" id="4566886">(</span><span class="ident" id="4566887">sbox0</span><span class="op" id="4566892">[</span><span class="ident" id="4566893">t3</span><span class="op" id="4566895">&amp;</span><span class="num" id="4566896">0xff</span><span class="op" id="4566900">]</span><span class="op" id="4566901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4566904">s1</span>&nbsp;<span class="op" id="4566907">=</span>&nbsp;<span class="builtintype" id="4566909">uint32</span><span class="op" id="4566915">(</span><span class="ident" id="4566916">sbox0</span><span class="op" id="4566921">[</span><span class="ident" id="4566922">t1</span><span class="op" id="4566924">&gt;&gt;</span><span class="num" id="4566926">24</span><span class="op" id="4566928">]</span><span class="op" id="4566929">)</span><span class="op" id="4566930">&lt;&lt;</span><span class="num" id="4566932">24</span>&nbsp;<span class="op" id="4566935">|</span>&nbsp;<span class="builtintype" id="4566937">uint32</span><span class="op" id="4566943">(</span><span class="ident" id="4566944">sbox0</span><span class="op" id="4566949">[</span><span class="ident" id="4566950">t2</span><span class="op" id="4566952">&gt;&gt;</span><span class="num" id="4566954">16</span><span class="op" id="4566956">&amp;</span><span class="num" id="4566957">0xff</span><span class="op" id="4566961">]</span><span class="op" id="4566962">)</span><span class="op" id="4566963">&lt;&lt;</span><span class="num" id="4566965">16</span>&nbsp;<span class="op" id="4566968">|</span>&nbsp;<span class="builtintype" id="4566970">uint32</span><span class="op" id="4566976">(</span><span class="ident" id="4566977">sbox0</span><span class="op" id="4566982">[</span><span class="ident" id="4566983">t3</span><span class="op" id="4566985">&gt;&gt;</span><span class="num" id="4566987">8</span><span class="op" id="4566988">&amp;</span><span class="num" id="4566989">0xff</span><span class="op" id="4566993">]</span><span class="op" id="4566994">)</span><span class="op" id="4566995">&lt;&lt;</span><span class="num" id="4566997">8</span>&nbsp;<span class="op" id="4566999">|</span>&nbsp;<span class="builtintype" id="4567001">uint32</span><span class="op" id="4567007">(</span><span class="ident" id="4567008">sbox0</span><span class="op" id="4567013">[</span><span class="ident" id="4567014">t0</span><span class="op" id="4567016">&amp;</span><span class="num" id="4567017">0xff</span><span class="op" id="4567021">]</span><span class="op" id="4567022">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567025">s2</span>&nbsp;<span class="op" id="4567028">=</span>&nbsp;<span class="builtintype" id="4567030">uint32</span><span class="op" id="4567036">(</span><span class="ident" id="4567037">sbox0</span><span class="op" id="4567042">[</span><span class="ident" id="4567043">t2</span><span class="op" id="4567045">&gt;&gt;</span><span class="num" id="4567047">24</span><span class="op" id="4567049">]</span><span class="op" id="4567050">)</span><span class="op" id="4567051">&lt;&lt;</span><span class="num" id="4567053">24</span>&nbsp;<span class="op" id="4567056">|</span>&nbsp;<span class="builtintype" id="4567058">uint32</span><span class="op" id="4567064">(</span><span class="ident" id="4567065">sbox0</span><span class="op" id="4567070">[</span><span class="ident" id="4567071">t3</span><span class="op" id="4567073">&gt;&gt;</span><span class="num" id="4567075">16</span><span class="op" id="4567077">&amp;</span><span class="num" id="4567078">0xff</span><span class="op" id="4567082">]</span><span class="op" id="4567083">)</span><span class="op" id="4567084">&lt;&lt;</span><span class="num" id="4567086">16</span>&nbsp;<span class="op" id="4567089">|</span>&nbsp;<span class="builtintype" id="4567091">uint32</span><span class="op" id="4567097">(</span><span class="ident" id="4567098">sbox0</span><span class="op" id="4567103">[</span><span class="ident" id="4567104">t0</span><span class="op" id="4567106">&gt;&gt;</span><span class="num" id="4567108">8</span><span class="op" id="4567109">&amp;</span><span class="num" id="4567110">0xff</span><span class="op" id="4567114">]</span><span class="op" id="4567115">)</span><span class="op" id="4567116">&lt;&lt;</span><span class="num" id="4567118">8</span>&nbsp;<span class="op" id="4567120">|</span>&nbsp;<span class="builtintype" id="4567122">uint32</span><span class="op" id="4567128">(</span><span class="ident" id="4567129">sbox0</span><span class="op" id="4567134">[</span><span class="ident" id="4567135">t1</span><span class="op" id="4567137">&amp;</span><span class="num" id="4567138">0xff</span><span class="op" id="4567142">]</span><span class="op" id="4567143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567146">s3</span>&nbsp;<span class="op" id="4567149">=</span>&nbsp;<span class="builtintype" id="4567151">uint32</span><span class="op" id="4567157">(</span><span class="ident" id="4567158">sbox0</span><span class="op" id="4567163">[</span><span class="ident" id="4567164">t3</span><span class="op" id="4567166">&gt;&gt;</span><span class="num" id="4567168">24</span><span class="op" id="4567170">]</span><span class="op" id="4567171">)</span><span class="op" id="4567172">&lt;&lt;</span><span class="num" id="4567174">24</span>&nbsp;<span class="op" id="4567177">|</span>&nbsp;<span class="builtintype" id="4567179">uint32</span><span class="op" id="4567185">(</span><span class="ident" id="4567186">sbox0</span><span class="op" id="4567191">[</span><span class="ident" id="4567192">t0</span><span class="op" id="4567194">&gt;&gt;</span><span class="num" id="4567196">16</span><span class="op" id="4567198">&amp;</span><span class="num" id="4567199">0xff</span><span class="op" id="4567203">]</span><span class="op" id="4567204">)</span><span class="op" id="4567205">&lt;&lt;</span><span class="num" id="4567207">16</span>&nbsp;<span class="op" id="4567210">|</span>&nbsp;<span class="builtintype" id="4567212">uint32</span><span class="op" id="4567218">(</span><span class="ident" id="4567219">sbox0</span><span class="op" id="4567224">[</span><span class="ident" id="4567225">t1</span><span class="op" id="4567227">&gt;&gt;</span><span class="num" id="4567229">8</span><span class="op" id="4567230">&amp;</span><span class="num" id="4567231">0xff</span><span class="op" id="4567235">]</span><span class="op" id="4567236">)</span><span class="op" id="4567237">&lt;&lt;</span><span class="num" id="4567239">8</span>&nbsp;<span class="op" id="4567241">|</span>&nbsp;<span class="builtintype" id="4567243">uint32</span><span class="op" id="4567249">(</span><span class="ident" id="4567250">sbox0</span><span class="op" id="4567255">[</span><span class="ident" id="4567256">t2</span><span class="op" id="4567258">&amp;</span><span class="num" id="4567259">0xff</span><span class="op" id="4567263">]</span><span class="op" id="4567264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567268">s0</span>&nbsp;<span class="op" id="4567271">^=</span>&nbsp;<span class="ident" id="4567274">xk</span><span class="op" id="4567276">[</span><span class="ident" id="4567277">k</span><span class="op" id="4567278">+</span><span class="num" id="4567279">0</span><span class="op" id="4567280">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567283">s1</span>&nbsp;<span class="op" id="4567286">^=</span>&nbsp;<span class="ident" id="4567289">xk</span><span class="op" id="4567291">[</span><span class="ident" id="4567292">k</span><span class="op" id="4567293">+</span><span class="num" id="4567294">1</span><span class="op" id="4567295">]</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567298">s2</span>&nbsp;<span class="op" id="4567301">^=</span>&nbsp;<span class="ident" id="4567304">xk</span><span class="op" id="4567306">[</span><span class="ident" id="4567307">k</span><span class="op" id="4567308">+</span><span class="num" id="4567309">2</span><span class="op" id="4567310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567313">s3</span>&nbsp;<span class="op" id="4567316">^=</span>&nbsp;<span class="ident" id="4567319">xk</span><span class="op" id="4567321">[</span><span class="ident" id="4567322">k</span><span class="op" id="4567323">+</span><span class="num" id="4567324">3</span><span class="op" id="4567325">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567329">dst</span><span class="op" id="4567332">[</span><span class="num" id="4567333">0</span><span class="op" id="4567334">]</span><span class="op" id="4567335">,</span>&nbsp;<span class="ident" id="4567337">dst</span><span class="op" id="4567340">[</span><span class="num" id="4567341">1</span><span class="op" id="4567342">]</span><span class="op" id="4567343">,</span>&nbsp;<span class="ident" id="4567345">dst</span><span class="op" id="4567348">[</span><span class="num" id="4567349">2</span><span class="op" id="4567350">]</span><span class="op" id="4567351">,</span>&nbsp;<span class="ident" id="4567353">dst</span><span class="op" id="4567356">[</span><span class="num" id="4567357">3</span><span class="op" id="4567358">]</span>&nbsp;<span class="op" id="4567360">=</span>&nbsp;<span class="builtintype" id="4567362">byte</span><span class="op" id="4567366">(</span><span class="ident" id="4567367">s0</span><span class="op" id="4567369">&gt;&gt;</span><span class="num" id="4567371">24</span><span class="op" id="4567373">)</span><span class="op" id="4567374">,</span>&nbsp;<span class="builtintype" id="4567376">byte</span><span class="op" id="4567380">(</span><span class="ident" id="4567381">s0</span><span class="op" id="4567383">&gt;&gt;</span><span class="num" id="4567385">16</span><span class="op" id="4567387">)</span><span class="op" id="4567388">,</span>&nbsp;<span class="builtintype" id="4567390">byte</span><span class="op" id="4567394">(</span><span class="ident" id="4567395">s0</span><span class="op" id="4567397">&gt;&gt;</span><span class="num" id="4567399">8</span><span class="op" id="4567400">)</span><span class="op" id="4567401">,</span>&nbsp;<span class="builtintype" id="4567403">byte</span><span class="op" id="4567407">(</span><span class="ident" id="4567408">s0</span><span class="op" id="4567410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567413">dst</span><span class="op" id="4567416">[</span><span class="num" id="4567417">4</span><span class="op" id="4567418">]</span><span class="op" id="4567419">,</span>&nbsp;<span class="ident" id="4567421">dst</span><span class="op" id="4567424">[</span><span class="num" id="4567425">5</span><span class="op" id="4567426">]</span><span class="op" id="4567427">,</span>&nbsp;<span class="ident" id="4567429">dst</span><span class="op" id="4567432">[</span><span class="num" id="4567433">6</span><span class="op" id="4567434">]</span><span class="op" id="4567435">,</span>&nbsp;<span class="ident" id="4567437">dst</span><span class="op" id="4567440">[</span><span class="num" id="4567441">7</span><span class="op" id="4567442">]</span>&nbsp;<span class="op" id="4567444">=</span>&nbsp;<span class="builtintype" id="4567446">byte</span><span class="op" id="4567450">(</span><span class="ident" id="4567451">s1</span><span class="op" id="4567453">&gt;&gt;</span><span class="num" id="4567455">24</span><span class="op" id="4567457">)</span><span class="op" id="4567458">,</span>&nbsp;<span class="builtintype" id="4567460">byte</span><span class="op" id="4567464">(</span><span class="ident" id="4567465">s1</span><span class="op" id="4567467">&gt;&gt;</span><span class="num" id="4567469">16</span><span class="op" id="4567471">)</span><span class="op" id="4567472">,</span>&nbsp;<span class="builtintype" id="4567474">byte</span><span class="op" id="4567478">(</span><span class="ident" id="4567479">s1</span><span class="op" id="4567481">&gt;&gt;</span><span class="num" id="4567483">8</span><span class="op" id="4567484">)</span><span class="op" id="4567485">,</span>&nbsp;<span class="builtintype" id="4567487">byte</span><span class="op" id="4567491">(</span><span class="ident" id="4567492">s1</span><span class="op" id="4567494">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567497">dst</span><span class="op" id="4567500">[</span><span class="num" id="4567501">8</span><span class="op" id="4567502">]</span><span class="op" id="4567503">,</span>&nbsp;<span class="ident" id="4567505">dst</span><span class="op" id="4567508">[</span><span class="num" id="4567509">9</span><span class="op" id="4567510">]</span><span class="op" id="4567511">,</span>&nbsp;<span class="ident" id="4567513">dst</span><span class="op" id="4567516">[</span><span class="num" id="4567517">10</span><span class="op" id="4567519">]</span><span class="op" id="4567520">,</span>&nbsp;<span class="ident" id="4567522">dst</span><span class="op" id="4567525">[</span><span class="num" id="4567526">11</span><span class="op" id="4567528">]</span>&nbsp;<span class="op" id="4567530">=</span>&nbsp;<span class="builtintype" id="4567532">byte</span><span class="op" id="4567536">(</span><span class="ident" id="4567537">s2</span><span class="op" id="4567539">&gt;&gt;</span><span class="num" id="4567541">24</span><span class="op" id="4567543">)</span><span class="op" id="4567544">,</span>&nbsp;<span class="builtintype" id="4567546">byte</span><span class="op" id="4567550">(</span><span class="ident" id="4567551">s2</span><span class="op" id="4567553">&gt;&gt;</span><span class="num" id="4567555">16</span><span class="op" id="4567557">)</span><span class="op" id="4567558">,</span>&nbsp;<span class="builtintype" id="4567560">byte</span><span class="op" id="4567564">(</span><span class="ident" id="4567565">s2</span><span class="op" id="4567567">&gt;&gt;</span><span class="num" id="4567569">8</span><span class="op" id="4567570">)</span><span class="op" id="4567571">,</span>&nbsp;<span class="builtintype" id="4567573">byte</span><span class="op" id="4567577">(</span><span class="ident" id="4567578">s2</span><span class="op" id="4567580">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567583">dst</span><span class="op" id="4567586">[</span><span class="num" id="4567587">12</span><span class="op" id="4567589">]</span><span class="op" id="4567590">,</span>&nbsp;<span class="ident" id="4567592">dst</span><span class="op" id="4567595">[</span><span class="num" id="4567596">13</span><span class="op" id="4567598">]</span><span class="op" id="4567599">,</span>&nbsp;<span class="ident" id="4567601">dst</span><span class="op" id="4567604">[</span><span class="num" id="4567605">14</span><span class="op" id="4567607">]</span><span class="op" id="4567608">,</span>&nbsp;<span class="ident" id="4567610">dst</span><span class="op" id="4567613">[</span><span class="num" id="4567614">15</span><span class="op" id="4567616">]</span>&nbsp;<span class="op" id="4567618">=</span>&nbsp;<span class="builtintype" id="4567620">byte</span><span class="op" id="4567624">(</span><span class="ident" id="4567625">s3</span><span class="op" id="4567627">&gt;&gt;</span><span class="num" id="4567629">24</span><span class="op" id="4567631">)</span><span class="op" id="4567632">,</span>&nbsp;<span class="builtintype" id="4567634">byte</span><span class="op" id="4567638">(</span><span class="ident" id="4567639">s3</span><span class="op" id="4567641">&gt;&gt;</span><span class="num" id="4567643">16</span><span class="op" id="4567645">)</span><span class="op" id="4567646">,</span>&nbsp;<span class="builtintype" id="4567648">byte</span><span class="op" id="4567652">(</span><span class="ident" id="4567653">s3</span><span class="op" id="4567655">&gt;&gt;</span><span class="num" id="4567657">8</span><span class="op" id="4567658">)</span><span class="op" id="4567659">,</span>&nbsp;<span class="builtintype" id="4567661">byte</span><span class="op" id="4567665">(</span><span class="ident" id="4567666">s3</span><span class="op" id="4567668">)</span><br>
<span class="lineno"></span><span class="op" id="4567670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4567673">//&nbsp;Decrypt&nbsp;one&nbsp;block&nbsp;from&nbsp;src&nbsp;into&nbsp;dst,&nbsp;using&nbsp;the&nbsp;expanded&nbsp;key&nbsp;xk.</span><br>
<span class="lineno">85</span><span class="keyword" id="4567740">func</span>&nbsp;<span class="ident" id="4567745">decryptBlockGo</span><span class="op" id="4567759">(</span><span class="ident" id="4567760">xk</span>&nbsp;<span class="op" id="4567763">[</span><span class="op" id="4567764">]</span><span class="builtintype" id="4567765">uint32</span><span class="op" id="4567771">,</span>&nbsp;<span class="ident" id="4567773">dst</span><span class="op" id="4567776">,</span>&nbsp;<span class="ident" id="4567778">src</span>&nbsp;<span class="op" id="4567782">[</span><span class="op" id="4567783">]</span><span class="builtintype" id="4567784">byte</span><span class="op" id="4567788">)</span>&nbsp;<span class="op" id="4567790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4567793">var</span>&nbsp;<span class="ident" id="4567797">s0</span><span class="op" id="4567799">,</span>&nbsp;<span class="ident" id="4567801">s1</span><span class="op" id="4567803">,</span>&nbsp;<span class="ident" id="4567805">s2</span><span class="op" id="4567807">,</span>&nbsp;<span class="ident" id="4567809">s3</span><span class="op" id="4567811">,</span>&nbsp;<span class="ident" id="4567813">t0</span><span class="op" id="4567815">,</span>&nbsp;<span class="ident" id="4567817">t1</span><span class="op" id="4567819">,</span>&nbsp;<span class="ident" id="4567821">t2</span><span class="op" id="4567823">,</span>&nbsp;<span class="ident" id="4567825">t3</span>&nbsp;<span class="builtintype" id="4567828">uint32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567837">s0</span>&nbsp;<span class="op" id="4567840">=</span>&nbsp;<span class="builtintype" id="4567842">uint32</span><span class="op" id="4567848">(</span><span class="ident" id="4567849">src</span><span class="op" id="4567852">[</span><span class="num" id="4567853">0</span><span class="op" id="4567854">]</span><span class="op" id="4567855">)</span><span class="op" id="4567856">&lt;&lt;</span><span class="num" id="4567858">24</span>&nbsp;<span class="op" id="4567861">|</span>&nbsp;<span class="builtintype" id="4567863">uint32</span><span class="op" id="4567869">(</span><span class="ident" id="4567870">src</span><span class="op" id="4567873">[</span><span class="num" id="4567874">1</span><span class="op" id="4567875">]</span><span class="op" id="4567876">)</span><span class="op" id="4567877">&lt;&lt;</span><span class="num" id="4567879">16</span>&nbsp;<span class="op" id="4567882">|</span>&nbsp;<span class="builtintype" id="4567884">uint32</span><span class="op" id="4567890">(</span><span class="ident" id="4567891">src</span><span class="op" id="4567894">[</span><span class="num" id="4567895">2</span><span class="op" id="4567896">]</span><span class="op" id="4567897">)</span><span class="op" id="4567898">&lt;&lt;</span><span class="num" id="4567900">8</span>&nbsp;<span class="op" id="4567902">|</span>&nbsp;<span class="builtintype" id="4567904">uint32</span><span class="op" id="4567910">(</span><span class="ident" id="4567911">src</span><span class="op" id="4567914">[</span><span class="num" id="4567915">3</span><span class="op" id="4567916">]</span><span class="op" id="4567917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4567920">s1</span>&nbsp;<span class="op" id="4567923">=</span>&nbsp;<span class="builtintype" id="4567925">uint32</span><span class="op" id="4567931">(</span><span class="ident" id="4567932">src</span><span class="op" id="4567935">[</span><span class="num" id="4567936">4</span><span class="op" id="4567937">]</span><span class="op" id="4567938">)</span><span class="op" id="4567939">&lt;&lt;</span><span class="num" id="4567941">24</span>&nbsp;<span class="op" id="4567944">|</span>&nbsp;<span class="builtintype" id="4567946">uint32</span><span class="op" id="4567952">(</span><span class="ident" id="4567953">src</span><span class="op" id="4567956">[</span><span class="num" id="4567957">5</span><span class="op" id="4567958">]</span><span class="op" id="4567959">)</span><span class="op" id="4567960">&lt;&lt;</span><span class="num" id="4567962">16</span>&nbsp;<span class="op" id="4567965">|</span>&nbsp;<span class="builtintype" id="4567967">uint32</span><span class="op" id="4567973">(</span><span class="ident" id="4567974">src</span><span class="op" id="4567977">[</span><span class="num" id="4567978">6</span><span class="op" id="4567979">]</span><span class="op" id="4567980">)</span><span class="op" id="4567981">&lt;&lt;</span><span class="num" id="4567983">8</span>&nbsp;<span class="op" id="4567985">|</span>&nbsp;<span class="builtintype" id="4567987">uint32</span><span class="op" id="4567993">(</span><span class="ident" id="4567994">src</span><span class="op" id="4567997">[</span><span class="num" id="4567998">7</span><span class="op" id="4567999">]</span><span class="op" id="4568000">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568003">s2</span>&nbsp;<span class="op" id="4568006">=</span>&nbsp;<span class="builtintype" id="4568008">uint32</span><span class="op" id="4568014">(</span><span class="ident" id="4568015">src</span><span class="op" id="4568018">[</span><span class="num" id="4568019">8</span><span class="op" id="4568020">]</span><span class="op" id="4568021">)</span><span class="op" id="4568022">&lt;&lt;</span><span class="num" id="4568024">24</span>&nbsp;<span class="op" id="4568027">|</span>&nbsp;<span class="builtintype" id="4568029">uint32</span><span class="op" id="4568035">(</span><span class="ident" id="4568036">src</span><span class="op" id="4568039">[</span><span class="num" id="4568040">9</span><span class="op" id="4568041">]</span><span class="op" id="4568042">)</span><span class="op" id="4568043">&lt;&lt;</span><span class="num" id="4568045">16</span>&nbsp;<span class="op" id="4568048">|</span>&nbsp;<span class="builtintype" id="4568050">uint32</span><span class="op" id="4568056">(</span><span class="ident" id="4568057">src</span><span class="op" id="4568060">[</span><span class="num" id="4568061">10</span><span class="op" id="4568063">]</span><span class="op" id="4568064">)</span><span class="op" id="4568065">&lt;&lt;</span><span class="num" id="4568067">8</span>&nbsp;<span class="op" id="4568069">|</span>&nbsp;<span class="builtintype" id="4568071">uint32</span><span class="op" id="4568077">(</span><span class="ident" id="4568078">src</span><span class="op" id="4568081">[</span><span class="num" id="4568082">11</span><span class="op" id="4568084">]</span><span class="op" id="4568085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568088">s3</span>&nbsp;<span class="op" id="4568091">=</span>&nbsp;<span class="builtintype" id="4568093">uint32</span><span class="op" id="4568099">(</span><span class="ident" id="4568100">src</span><span class="op" id="4568103">[</span><span class="num" id="4568104">12</span><span class="op" id="4568106">]</span><span class="op" id="4568107">)</span><span class="op" id="4568108">&lt;&lt;</span><span class="num" id="4568110">24</span>&nbsp;<span class="op" id="4568113">|</span>&nbsp;<span class="builtintype" id="4568115">uint32</span><span class="op" id="4568121">(</span><span class="ident" id="4568122">src</span><span class="op" id="4568125">[</span><span class="num" id="4568126">13</span><span class="op" id="4568128">]</span><span class="op" id="4568129">)</span><span class="op" id="4568130">&lt;&lt;</span><span class="num" id="4568132">16</span>&nbsp;<span class="op" id="4568135">|</span>&nbsp;<span class="builtintype" id="4568137">uint32</span><span class="op" id="4568143">(</span><span class="ident" id="4568144">src</span><span class="op" id="4568147">[</span><span class="num" id="4568148">14</span><span class="op" id="4568150">]</span><span class="op" id="4568151">)</span><span class="op" id="4568152">&lt;&lt;</span><span class="num" id="4568154">8</span>&nbsp;<span class="op" id="4568156">|</span>&nbsp;<span class="builtintype" id="4568158">uint32</span><span class="op" id="4568164">(</span><span class="ident" id="4568165">src</span><span class="op" id="4568168">[</span><span class="num" id="4568169">15</span><span class="op" id="4568171">]</span><span class="op" id="4568172">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568176">//&nbsp;First&nbsp;round&nbsp;just&nbsp;XORs&nbsp;input&nbsp;with&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568218">s0</span>&nbsp;<span class="op" id="4568221">^=</span>&nbsp;<span class="ident" id="4568224">xk</span><span class="op" id="4568226">[</span><span class="num" id="4568227">0</span><span class="op" id="4568228">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568231">s1</span>&nbsp;<span class="op" id="4568234">^=</span>&nbsp;<span class="ident" id="4568237">xk</span><span class="op" id="4568239">[</span><span class="num" id="4568240">1</span><span class="op" id="4568241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568244">s2</span>&nbsp;<span class="op" id="4568247">^=</span>&nbsp;<span class="ident" id="4568250">xk</span><span class="op" id="4568252">[</span><span class="num" id="4568253">2</span><span class="op" id="4568254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568257">s3</span>&nbsp;<span class="op" id="4568260">^=</span>&nbsp;<span class="ident" id="4568263">xk</span><span class="op" id="4568265">[</span><span class="num" id="4568266">3</span><span class="op" id="4568267">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568271">//&nbsp;Middle&nbsp;rounds&nbsp;shuffle&nbsp;using&nbsp;tables.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568311">//&nbsp;Number&nbsp;of&nbsp;rounds&nbsp;is&nbsp;set&nbsp;by&nbsp;length&nbsp;of&nbsp;expanded&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568366">nr</span>&nbsp;<span class="op" id="4568369">:=</span>&nbsp;<span class="builtinfunc" id="4568372">len</span><span class="op" id="4568375">(</span><span class="ident" id="4568376">xk</span><span class="op" id="4568378">)</span><span class="op" id="4568379">/</span><span class="num" id="4568380">4</span>&nbsp;<span class="op" id="4568382">-</span>&nbsp;<span class="num" id="4568384">2</span>&nbsp;<span class="comment" id="4568386">//&nbsp;-&nbsp;2:&nbsp;one&nbsp;above,&nbsp;one&nbsp;more&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568421">k</span>&nbsp;<span class="op" id="4568423">:=</span>&nbsp;<span class="num" id="4568426">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4568429">for</span>&nbsp;<span class="ident" id="4568433">r</span>&nbsp;<span class="op" id="4568435">:=</span>&nbsp;<span class="num" id="4568438">0</span><span class="op" id="4568439">;</span>&nbsp;<span class="ident" id="4568441">r</span>&nbsp;<span class="op" id="4568443">&lt;</span>&nbsp;<span class="ident" id="4568445">nr</span><span class="op" id="4568447">;</span>&nbsp;<span class="ident" id="4568449">r</span><span class="op" id="4568450">++</span>&nbsp;<span class="op" id="4568453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568457">t0</span>&nbsp;<span class="op" id="4568460">=</span>&nbsp;<span class="ident" id="4568462">xk</span><span class="op" id="4568464">[</span><span class="ident" id="4568465">k</span><span class="op" id="4568466">+</span><span class="num" id="4568467">0</span><span class="op" id="4568468">]</span>&nbsp;<span class="op" id="4568470">^</span>&nbsp;<span class="ident" id="4568472">td0</span><span class="op" id="4568475">[</span><span class="builtintype" id="4568476">uint8</span><span class="op" id="4568481">(</span><span class="ident" id="4568482">s0</span><span class="op" id="4568484">&gt;&gt;</span><span class="num" id="4568486">24</span><span class="op" id="4568488">)</span><span class="op" id="4568489">]</span>&nbsp;<span class="op" id="4568491">^</span>&nbsp;<span class="ident" id="4568493">td1</span><span class="op" id="4568496">[</span><span class="builtintype" id="4568497">uint8</span><span class="op" id="4568502">(</span><span class="ident" id="4568503">s3</span><span class="op" id="4568505">&gt;&gt;</span><span class="num" id="4568507">16</span><span class="op" id="4568509">)</span><span class="op" id="4568510">]</span>&nbsp;<span class="op" id="4568512">^</span>&nbsp;<span class="ident" id="4568514">td2</span><span class="op" id="4568517">[</span><span class="builtintype" id="4568518">uint8</span><span class="op" id="4568523">(</span><span class="ident" id="4568524">s2</span><span class="op" id="4568526">&gt;&gt;</span><span class="num" id="4568528">8</span><span class="op" id="4568529">)</span><span class="op" id="4568530">]</span>&nbsp;<span class="op" id="4568532">^</span>&nbsp;<span class="ident" id="4568534">td3</span><span class="op" id="4568537">[</span><span class="builtintype" id="4568538">uint8</span><span class="op" id="4568543">(</span><span class="ident" id="4568544">s1</span><span class="op" id="4568546">)</span><span class="op" id="4568547">]</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568551">t1</span>&nbsp;<span class="op" id="4568554">=</span>&nbsp;<span class="ident" id="4568556">xk</span><span class="op" id="4568558">[</span><span class="ident" id="4568559">k</span><span class="op" id="4568560">+</span><span class="num" id="4568561">1</span><span class="op" id="4568562">]</span>&nbsp;<span class="op" id="4568564">^</span>&nbsp;<span class="ident" id="4568566">td0</span><span class="op" id="4568569">[</span><span class="builtintype" id="4568570">uint8</span><span class="op" id="4568575">(</span><span class="ident" id="4568576">s1</span><span class="op" id="4568578">&gt;&gt;</span><span class="num" id="4568580">24</span><span class="op" id="4568582">)</span><span class="op" id="4568583">]</span>&nbsp;<span class="op" id="4568585">^</span>&nbsp;<span class="ident" id="4568587">td1</span><span class="op" id="4568590">[</span><span class="builtintype" id="4568591">uint8</span><span class="op" id="4568596">(</span><span class="ident" id="4568597">s0</span><span class="op" id="4568599">&gt;&gt;</span><span class="num" id="4568601">16</span><span class="op" id="4568603">)</span><span class="op" id="4568604">]</span>&nbsp;<span class="op" id="4568606">^</span>&nbsp;<span class="ident" id="4568608">td2</span><span class="op" id="4568611">[</span><span class="builtintype" id="4568612">uint8</span><span class="op" id="4568617">(</span><span class="ident" id="4568618">s3</span><span class="op" id="4568620">&gt;&gt;</span><span class="num" id="4568622">8</span><span class="op" id="4568623">)</span><span class="op" id="4568624">]</span>&nbsp;<span class="op" id="4568626">^</span>&nbsp;<span class="ident" id="4568628">td3</span><span class="op" id="4568631">[</span><span class="builtintype" id="4568632">uint8</span><span class="op" id="4568637">(</span><span class="ident" id="4568638">s2</span><span class="op" id="4568640">)</span><span class="op" id="4568641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568645">t2</span>&nbsp;<span class="op" id="4568648">=</span>&nbsp;<span class="ident" id="4568650">xk</span><span class="op" id="4568652">[</span><span class="ident" id="4568653">k</span><span class="op" id="4568654">+</span><span class="num" id="4568655">2</span><span class="op" id="4568656">]</span>&nbsp;<span class="op" id="4568658">^</span>&nbsp;<span class="ident" id="4568660">td0</span><span class="op" id="4568663">[</span><span class="builtintype" id="4568664">uint8</span><span class="op" id="4568669">(</span><span class="ident" id="4568670">s2</span><span class="op" id="4568672">&gt;&gt;</span><span class="num" id="4568674">24</span><span class="op" id="4568676">)</span><span class="op" id="4568677">]</span>&nbsp;<span class="op" id="4568679">^</span>&nbsp;<span class="ident" id="4568681">td1</span><span class="op" id="4568684">[</span><span class="builtintype" id="4568685">uint8</span><span class="op" id="4568690">(</span><span class="ident" id="4568691">s1</span><span class="op" id="4568693">&gt;&gt;</span><span class="num" id="4568695">16</span><span class="op" id="4568697">)</span><span class="op" id="4568698">]</span>&nbsp;<span class="op" id="4568700">^</span>&nbsp;<span class="ident" id="4568702">td2</span><span class="op" id="4568705">[</span><span class="builtintype" id="4568706">uint8</span><span class="op" id="4568711">(</span><span class="ident" id="4568712">s0</span><span class="op" id="4568714">&gt;&gt;</span><span class="num" id="4568716">8</span><span class="op" id="4568717">)</span><span class="op" id="4568718">]</span>&nbsp;<span class="op" id="4568720">^</span>&nbsp;<span class="ident" id="4568722">td3</span><span class="op" id="4568725">[</span><span class="builtintype" id="4568726">uint8</span><span class="op" id="4568731">(</span><span class="ident" id="4568732">s3</span><span class="op" id="4568734">)</span><span class="op" id="4568735">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568739">t3</span>&nbsp;<span class="op" id="4568742">=</span>&nbsp;<span class="ident" id="4568744">xk</span><span class="op" id="4568746">[</span><span class="ident" id="4568747">k</span><span class="op" id="4568748">+</span><span class="num" id="4568749">3</span><span class="op" id="4568750">]</span>&nbsp;<span class="op" id="4568752">^</span>&nbsp;<span class="ident" id="4568754">td0</span><span class="op" id="4568757">[</span><span class="builtintype" id="4568758">uint8</span><span class="op" id="4568763">(</span><span class="ident" id="4568764">s3</span><span class="op" id="4568766">&gt;&gt;</span><span class="num" id="4568768">24</span><span class="op" id="4568770">)</span><span class="op" id="4568771">]</span>&nbsp;<span class="op" id="4568773">^</span>&nbsp;<span class="ident" id="4568775">td1</span><span class="op" id="4568778">[</span><span class="builtintype" id="4568779">uint8</span><span class="op" id="4568784">(</span><span class="ident" id="4568785">s2</span><span class="op" id="4568787">&gt;&gt;</span><span class="num" id="4568789">16</span><span class="op" id="4568791">)</span><span class="op" id="4568792">]</span>&nbsp;<span class="op" id="4568794">^</span>&nbsp;<span class="ident" id="4568796">td2</span><span class="op" id="4568799">[</span><span class="builtintype" id="4568800">uint8</span><span class="op" id="4568805">(</span><span class="ident" id="4568806">s1</span><span class="op" id="4568808">&gt;&gt;</span><span class="num" id="4568810">8</span><span class="op" id="4568811">)</span><span class="op" id="4568812">]</span>&nbsp;<span class="op" id="4568814">^</span>&nbsp;<span class="ident" id="4568816">td3</span><span class="op" id="4568819">[</span><span class="builtintype" id="4568820">uint8</span><span class="op" id="4568825">(</span><span class="ident" id="4568826">s0</span><span class="op" id="4568828">)</span><span class="op" id="4568829">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568833">k</span>&nbsp;<span class="op" id="4568835">+=</span>&nbsp;<span class="num" id="4568838">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568842">s0</span><span class="op" id="4568844">,</span>&nbsp;<span class="ident" id="4568846">s1</span><span class="op" id="4568848">,</span>&nbsp;<span class="ident" id="4568850">s2</span><span class="op" id="4568852">,</span>&nbsp;<span class="ident" id="4568854">s3</span>&nbsp;<span class="op" id="4568857">=</span>&nbsp;<span class="ident" id="4568859">t0</span><span class="op" id="4568861">,</span>&nbsp;<span class="ident" id="4568863">t1</span><span class="op" id="4568865">,</span>&nbsp;<span class="ident" id="4568867">t2</span><span class="op" id="4568869">,</span>&nbsp;<span class="ident" id="4568871">t3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4568875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4568879">//&nbsp;Last&nbsp;round&nbsp;uses&nbsp;s-box&nbsp;directly&nbsp;and&nbsp;XORs&nbsp;to&nbsp;produce&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4568942">s0</span>&nbsp;<span class="op" id="4568945">=</span>&nbsp;<span class="builtintype" id="4568947">uint32</span><span class="op" id="4568953">(</span><span class="ident" id="4568954">sbox1</span><span class="op" id="4568959">[</span><span class="ident" id="4568960">t0</span><span class="op" id="4568962">&gt;&gt;</span><span class="num" id="4568964">24</span><span class="op" id="4568966">]</span><span class="op" id="4568967">)</span><span class="op" id="4568968">&lt;&lt;</span><span class="num" id="4568970">24</span>&nbsp;<span class="op" id="4568973">|</span>&nbsp;<span class="builtintype" id="4568975">uint32</span><span class="op" id="4568981">(</span><span class="ident" id="4568982">sbox1</span><span class="op" id="4568987">[</span><span class="ident" id="4568988">t3</span><span class="op" id="4568990">&gt;&gt;</span><span class="num" id="4568992">16</span><span class="op" id="4568994">&amp;</span><span class="num" id="4568995">0xff</span><span class="op" id="4568999">]</span><span class="op" id="4569000">)</span><span class="op" id="4569001">&lt;&lt;</span><span class="num" id="4569003">16</span>&nbsp;<span class="op" id="4569006">|</span>&nbsp;<span class="builtintype" id="4569008">uint32</span><span class="op" id="4569014">(</span><span class="ident" id="4569015">sbox1</span><span class="op" id="4569020">[</span><span class="ident" id="4569021">t2</span><span class="op" id="4569023">&gt;&gt;</span><span class="num" id="4569025">8</span><span class="op" id="4569026">&amp;</span><span class="num" id="4569027">0xff</span><span class="op" id="4569031">]</span><span class="op" id="4569032">)</span><span class="op" id="4569033">&lt;&lt;</span><span class="num" id="4569035">8</span>&nbsp;<span class="op" id="4569037">|</span>&nbsp;<span class="builtintype" id="4569039">uint32</span><span class="op" id="4569045">(</span><span class="ident" id="4569046">sbox1</span><span class="op" id="4569051">[</span><span class="ident" id="4569052">t1</span><span class="op" id="4569054">&amp;</span><span class="num" id="4569055">0xff</span><span class="op" id="4569059">]</span><span class="op" id="4569060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569063">s1</span>&nbsp;<span class="op" id="4569066">=</span>&nbsp;<span class="builtintype" id="4569068">uint32</span><span class="op" id="4569074">(</span><span class="ident" id="4569075">sbox1</span><span class="op" id="4569080">[</span><span class="ident" id="4569081">t1</span><span class="op" id="4569083">&gt;&gt;</span><span class="num" id="4569085">24</span><span class="op" id="4569087">]</span><span class="op" id="4569088">)</span><span class="op" id="4569089">&lt;&lt;</span><span class="num" id="4569091">24</span>&nbsp;<span class="op" id="4569094">|</span>&nbsp;<span class="builtintype" id="4569096">uint32</span><span class="op" id="4569102">(</span><span class="ident" id="4569103">sbox1</span><span class="op" id="4569108">[</span><span class="ident" id="4569109">t0</span><span class="op" id="4569111">&gt;&gt;</span><span class="num" id="4569113">16</span><span class="op" id="4569115">&amp;</span><span class="num" id="4569116">0xff</span><span class="op" id="4569120">]</span><span class="op" id="4569121">)</span><span class="op" id="4569122">&lt;&lt;</span><span class="num" id="4569124">16</span>&nbsp;<span class="op" id="4569127">|</span>&nbsp;<span class="builtintype" id="4569129">uint32</span><span class="op" id="4569135">(</span><span class="ident" id="4569136">sbox1</span><span class="op" id="4569141">[</span><span class="ident" id="4569142">t3</span><span class="op" id="4569144">&gt;&gt;</span><span class="num" id="4569146">8</span><span class="op" id="4569147">&amp;</span><span class="num" id="4569148">0xff</span><span class="op" id="4569152">]</span><span class="op" id="4569153">)</span><span class="op" id="4569154">&lt;&lt;</span><span class="num" id="4569156">8</span>&nbsp;<span class="op" id="4569158">|</span>&nbsp;<span class="builtintype" id="4569160">uint32</span><span class="op" id="4569166">(</span><span class="ident" id="4569167">sbox1</span><span class="op" id="4569172">[</span><span class="ident" id="4569173">t2</span><span class="op" id="4569175">&amp;</span><span class="num" id="4569176">0xff</span><span class="op" id="4569180">]</span><span class="op" id="4569181">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569184">s2</span>&nbsp;<span class="op" id="4569187">=</span>&nbsp;<span class="builtintype" id="4569189">uint32</span><span class="op" id="4569195">(</span><span class="ident" id="4569196">sbox1</span><span class="op" id="4569201">[</span><span class="ident" id="4569202">t2</span><span class="op" id="4569204">&gt;&gt;</span><span class="num" id="4569206">24</span><span class="op" id="4569208">]</span><span class="op" id="4569209">)</span><span class="op" id="4569210">&lt;&lt;</span><span class="num" id="4569212">24</span>&nbsp;<span class="op" id="4569215">|</span>&nbsp;<span class="builtintype" id="4569217">uint32</span><span class="op" id="4569223">(</span><span class="ident" id="4569224">sbox1</span><span class="op" id="4569229">[</span><span class="ident" id="4569230">t1</span><span class="op" id="4569232">&gt;&gt;</span><span class="num" id="4569234">16</span><span class="op" id="4569236">&amp;</span><span class="num" id="4569237">0xff</span><span class="op" id="4569241">]</span><span class="op" id="4569242">)</span><span class="op" id="4569243">&lt;&lt;</span><span class="num" id="4569245">16</span>&nbsp;<span class="op" id="4569248">|</span>&nbsp;<span class="builtintype" id="4569250">uint32</span><span class="op" id="4569256">(</span><span class="ident" id="4569257">sbox1</span><span class="op" id="4569262">[</span><span class="ident" id="4569263">t0</span><span class="op" id="4569265">&gt;&gt;</span><span class="num" id="4569267">8</span><span class="op" id="4569268">&amp;</span><span class="num" id="4569269">0xff</span><span class="op" id="4569273">]</span><span class="op" id="4569274">)</span><span class="op" id="4569275">&lt;&lt;</span><span class="num" id="4569277">8</span>&nbsp;<span class="op" id="4569279">|</span>&nbsp;<span class="builtintype" id="4569281">uint32</span><span class="op" id="4569287">(</span><span class="ident" id="4569288">sbox1</span><span class="op" id="4569293">[</span><span class="ident" id="4569294">t3</span><span class="op" id="4569296">&amp;</span><span class="num" id="4569297">0xff</span><span class="op" id="4569301">]</span><span class="op" id="4569302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569305">s3</span>&nbsp;<span class="op" id="4569308">=</span>&nbsp;<span class="builtintype" id="4569310">uint32</span><span class="op" id="4569316">(</span><span class="ident" id="4569317">sbox1</span><span class="op" id="4569322">[</span><span class="ident" id="4569323">t3</span><span class="op" id="4569325">&gt;&gt;</span><span class="num" id="4569327">24</span><span class="op" id="4569329">]</span><span class="op" id="4569330">)</span><span class="op" id="4569331">&lt;&lt;</span><span class="num" id="4569333">24</span>&nbsp;<span class="op" id="4569336">|</span>&nbsp;<span class="builtintype" id="4569338">uint32</span><span class="op" id="4569344">(</span><span class="ident" id="4569345">sbox1</span><span class="op" id="4569350">[</span><span class="ident" id="4569351">t2</span><span class="op" id="4569353">&gt;&gt;</span><span class="num" id="4569355">16</span><span class="op" id="4569357">&amp;</span><span class="num" id="4569358">0xff</span><span class="op" id="4569362">]</span><span class="op" id="4569363">)</span><span class="op" id="4569364">&lt;&lt;</span><span class="num" id="4569366">16</span>&nbsp;<span class="op" id="4569369">|</span>&nbsp;<span class="builtintype" id="4569371">uint32</span><span class="op" id="4569377">(</span><span class="ident" id="4569378">sbox1</span><span class="op" id="4569383">[</span><span class="ident" id="4569384">t1</span><span class="op" id="4569386">&gt;&gt;</span><span class="num" id="4569388">8</span><span class="op" id="4569389">&amp;</span><span class="num" id="4569390">0xff</span><span class="op" id="4569394">]</span><span class="op" id="4569395">)</span><span class="op" id="4569396">&lt;&lt;</span><span class="num" id="4569398">8</span>&nbsp;<span class="op" id="4569400">|</span>&nbsp;<span class="builtintype" id="4569402">uint32</span><span class="op" id="4569408">(</span><span class="ident" id="4569409">sbox1</span><span class="op" id="4569414">[</span><span class="ident" id="4569415">t0</span><span class="op" id="4569417">&amp;</span><span class="num" id="4569418">0xff</span><span class="op" id="4569422">]</span><span class="op" id="4569423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569427">s0</span>&nbsp;<span class="op" id="4569430">^=</span>&nbsp;<span class="ident" id="4569433">xk</span><span class="op" id="4569435">[</span><span class="ident" id="4569436">k</span><span class="op" id="4569437">+</span><span class="num" id="4569438">0</span><span class="op" id="4569439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569442">s1</span>&nbsp;<span class="op" id="4569445">^=</span>&nbsp;<span class="ident" id="4569448">xk</span><span class="op" id="4569450">[</span><span class="ident" id="4569451">k</span><span class="op" id="4569452">+</span><span class="num" id="4569453">1</span><span class="op" id="4569454">]</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569457">s2</span>&nbsp;<span class="op" id="4569460">^=</span>&nbsp;<span class="ident" id="4569463">xk</span><span class="op" id="4569465">[</span><span class="ident" id="4569466">k</span><span class="op" id="4569467">+</span><span class="num" id="4569468">2</span><span class="op" id="4569469">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569472">s3</span>&nbsp;<span class="op" id="4569475">^=</span>&nbsp;<span class="ident" id="4569478">xk</span><span class="op" id="4569480">[</span><span class="ident" id="4569481">k</span><span class="op" id="4569482">+</span><span class="num" id="4569483">3</span><span class="op" id="4569484">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569488">dst</span><span class="op" id="4569491">[</span><span class="num" id="4569492">0</span><span class="op" id="4569493">]</span><span class="op" id="4569494">,</span>&nbsp;<span class="ident" id="4569496">dst</span><span class="op" id="4569499">[</span><span class="num" id="4569500">1</span><span class="op" id="4569501">]</span><span class="op" id="4569502">,</span>&nbsp;<span class="ident" id="4569504">dst</span><span class="op" id="4569507">[</span><span class="num" id="4569508">2</span><span class="op" id="4569509">]</span><span class="op" id="4569510">,</span>&nbsp;<span class="ident" id="4569512">dst</span><span class="op" id="4569515">[</span><span class="num" id="4569516">3</span><span class="op" id="4569517">]</span>&nbsp;<span class="op" id="4569519">=</span>&nbsp;<span class="builtintype" id="4569521">byte</span><span class="op" id="4569525">(</span><span class="ident" id="4569526">s0</span><span class="op" id="4569528">&gt;&gt;</span><span class="num" id="4569530">24</span><span class="op" id="4569532">)</span><span class="op" id="4569533">,</span>&nbsp;<span class="builtintype" id="4569535">byte</span><span class="op" id="4569539">(</span><span class="ident" id="4569540">s0</span><span class="op" id="4569542">&gt;&gt;</span><span class="num" id="4569544">16</span><span class="op" id="4569546">)</span><span class="op" id="4569547">,</span>&nbsp;<span class="builtintype" id="4569549">byte</span><span class="op" id="4569553">(</span><span class="ident" id="4569554">s0</span><span class="op" id="4569556">&gt;&gt;</span><span class="num" id="4569558">8</span><span class="op" id="4569559">)</span><span class="op" id="4569560">,</span>&nbsp;<span class="builtintype" id="4569562">byte</span><span class="op" id="4569566">(</span><span class="ident" id="4569567">s0</span><span class="op" id="4569569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569572">dst</span><span class="op" id="4569575">[</span><span class="num" id="4569576">4</span><span class="op" id="4569577">]</span><span class="op" id="4569578">,</span>&nbsp;<span class="ident" id="4569580">dst</span><span class="op" id="4569583">[</span><span class="num" id="4569584">5</span><span class="op" id="4569585">]</span><span class="op" id="4569586">,</span>&nbsp;<span class="ident" id="4569588">dst</span><span class="op" id="4569591">[</span><span class="num" id="4569592">6</span><span class="op" id="4569593">]</span><span class="op" id="4569594">,</span>&nbsp;<span class="ident" id="4569596">dst</span><span class="op" id="4569599">[</span><span class="num" id="4569600">7</span><span class="op" id="4569601">]</span>&nbsp;<span class="op" id="4569603">=</span>&nbsp;<span class="builtintype" id="4569605">byte</span><span class="op" id="4569609">(</span><span class="ident" id="4569610">s1</span><span class="op" id="4569612">&gt;&gt;</span><span class="num" id="4569614">24</span><span class="op" id="4569616">)</span><span class="op" id="4569617">,</span>&nbsp;<span class="builtintype" id="4569619">byte</span><span class="op" id="4569623">(</span><span class="ident" id="4569624">s1</span><span class="op" id="4569626">&gt;&gt;</span><span class="num" id="4569628">16</span><span class="op" id="4569630">)</span><span class="op" id="4569631">,</span>&nbsp;<span class="builtintype" id="4569633">byte</span><span class="op" id="4569637">(</span><span class="ident" id="4569638">s1</span><span class="op" id="4569640">&gt;&gt;</span><span class="num" id="4569642">8</span><span class="op" id="4569643">)</span><span class="op" id="4569644">,</span>&nbsp;<span class="builtintype" id="4569646">byte</span><span class="op" id="4569650">(</span><span class="ident" id="4569651">s1</span><span class="op" id="4569653">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569656">dst</span><span class="op" id="4569659">[</span><span class="num" id="4569660">8</span><span class="op" id="4569661">]</span><span class="op" id="4569662">,</span>&nbsp;<span class="ident" id="4569664">dst</span><span class="op" id="4569667">[</span><span class="num" id="4569668">9</span><span class="op" id="4569669">]</span><span class="op" id="4569670">,</span>&nbsp;<span class="ident" id="4569672">dst</span><span class="op" id="4569675">[</span><span class="num" id="4569676">10</span><span class="op" id="4569678">]</span><span class="op" id="4569679">,</span>&nbsp;<span class="ident" id="4569681">dst</span><span class="op" id="4569684">[</span><span class="num" id="4569685">11</span><span class="op" id="4569687">]</span>&nbsp;<span class="op" id="4569689">=</span>&nbsp;<span class="builtintype" id="4569691">byte</span><span class="op" id="4569695">(</span><span class="ident" id="4569696">s2</span><span class="op" id="4569698">&gt;&gt;</span><span class="num" id="4569700">24</span><span class="op" id="4569702">)</span><span class="op" id="4569703">,</span>&nbsp;<span class="builtintype" id="4569705">byte</span><span class="op" id="4569709">(</span><span class="ident" id="4569710">s2</span><span class="op" id="4569712">&gt;&gt;</span><span class="num" id="4569714">16</span><span class="op" id="4569716">)</span><span class="op" id="4569717">,</span>&nbsp;<span class="builtintype" id="4569719">byte</span><span class="op" id="4569723">(</span><span class="ident" id="4569724">s2</span><span class="op" id="4569726">&gt;&gt;</span><span class="num" id="4569728">8</span><span class="op" id="4569729">)</span><span class="op" id="4569730">,</span>&nbsp;<span class="builtintype" id="4569732">byte</span><span class="op" id="4569736">(</span><span class="ident" id="4569737">s2</span><span class="op" id="4569739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4569742">dst</span><span class="op" id="4569745">[</span><span class="num" id="4569746">12</span><span class="op" id="4569748">]</span><span class="op" id="4569749">,</span>&nbsp;<span class="ident" id="4569751">dst</span><span class="op" id="4569754">[</span><span class="num" id="4569755">13</span><span class="op" id="4569757">]</span><span class="op" id="4569758">,</span>&nbsp;<span class="ident" id="4569760">dst</span><span class="op" id="4569763">[</span><span class="num" id="4569764">14</span><span class="op" id="4569766">]</span><span class="op" id="4569767">,</span>&nbsp;<span class="ident" id="4569769">dst</span><span class="op" id="4569772">[</span><span class="num" id="4569773">15</span><span class="op" id="4569775">]</span>&nbsp;<span class="op" id="4569777">=</span>&nbsp;<span class="builtintype" id="4569779">byte</span><span class="op" id="4569783">(</span><span class="ident" id="4569784">s3</span><span class="op" id="4569786">&gt;&gt;</span><span class="num" id="4569788">24</span><span class="op" id="4569790">)</span><span class="op" id="4569791">,</span>&nbsp;<span class="builtintype" id="4569793">byte</span><span class="op" id="4569797">(</span><span class="ident" id="4569798">s3</span><span class="op" id="4569800">&gt;&gt;</span><span class="num" id="4569802">16</span><span class="op" id="4569804">)</span><span class="op" id="4569805">,</span>&nbsp;<span class="builtintype" id="4569807">byte</span><span class="op" id="4569811">(</span><span class="ident" id="4569812">s3</span><span class="op" id="4569814">&gt;&gt;</span><span class="num" id="4569816">8</span><span class="op" id="4569817">)</span><span class="op" id="4569818">,</span>&nbsp;<span class="builtintype" id="4569820">byte</span><span class="op" id="4569824">(</span><span class="ident" id="4569825">s3</span><span class="op" id="4569827">)</span><br>
<span class="lineno"></span><span class="op" id="4569829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4569832">//&nbsp;Apply&nbsp;sbox0&nbsp;to&nbsp;each&nbsp;byte&nbsp;in&nbsp;w.</span><br>
<span class="lineno">130</span><span class="keyword" id="4569866">func</span>&nbsp;<span class="ident" id="4569871">subw</span><span class="op" id="4569875">(</span><span class="ident" id="4569876">w</span>&nbsp;<span class="builtintype" id="4569878">uint32</span><span class="op" id="4569884">)</span>&nbsp;<span class="builtintype" id="4569886">uint32</span>&nbsp;<span class="op" id="4569893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4569896">return</span>&nbsp;<span class="builtintype" id="4569903">uint32</span><span class="op" id="4569909">(</span><span class="ident" id="4569910">sbox0</span><span class="op" id="4569915">[</span><span class="ident" id="4569916">w</span><span class="op" id="4569917">&gt;&gt;</span><span class="num" id="4569919">24</span><span class="op" id="4569921">]</span><span class="op" id="4569922">)</span><span class="op" id="4569923">&lt;&lt;</span><span class="num" id="4569925">24</span>&nbsp;<span class="op" id="4569928">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4569932">uint32</span><span class="op" id="4569938">(</span><span class="ident" id="4569939">sbox0</span><span class="op" id="4569944">[</span><span class="ident" id="4569945">w</span><span class="op" id="4569946">&gt;&gt;</span><span class="num" id="4569948">16</span><span class="op" id="4569950">&amp;</span><span class="num" id="4569951">0xff</span><span class="op" id="4569955">]</span><span class="op" id="4569956">)</span><span class="op" id="4569957">&lt;&lt;</span><span class="num" id="4569959">16</span>&nbsp;<span class="op" id="4569962">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4569966">uint32</span><span class="op" id="4569972">(</span><span class="ident" id="4569973">sbox0</span><span class="op" id="4569978">[</span><span class="ident" id="4569979">w</span><span class="op" id="4569980">&gt;&gt;</span><span class="num" id="4569982">8</span><span class="op" id="4569983">&amp;</span><span class="num" id="4569984">0xff</span><span class="op" id="4569988">]</span><span class="op" id="4569989">)</span><span class="op" id="4569990">&lt;&lt;</span><span class="num" id="4569992">8</span>&nbsp;<span class="op" id="4569994">|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4569998">uint32</span><span class="op" id="4570004">(</span><span class="ident" id="4570005">sbox0</span><span class="op" id="4570010">[</span><span class="ident" id="4570011">w</span><span class="op" id="4570012">&amp;</span><span class="num" id="4570013">0xff</span><span class="op" id="4570017">]</span><span class="op" id="4570018">)</span><br>
<span class="lineno">135</span><span class="op" id="4570020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4570023">//&nbsp;Rotate</span><br>
<span class="lineno"></span><span class="keyword" id="4570033">func</span>&nbsp;<span class="ident" id="4570038">rotw</span><span class="op" id="4570042">(</span><span class="ident" id="4570043">w</span>&nbsp;<span class="builtintype" id="4570045">uint32</span><span class="op" id="4570051">)</span>&nbsp;<span class="builtintype" id="4570053">uint32</span>&nbsp;<span class="op" id="4570060">{</span>&nbsp;<span class="keyword" id="4570062">return</span>&nbsp;<span class="ident" id="4570069">w</span><span class="op" id="4570070">&lt;&lt;</span><span class="num" id="4570072">8</span>&nbsp;<span class="op" id="4570074">|</span>&nbsp;<span class="ident" id="4570076">w</span><span class="op" id="4570077">&gt;&gt;</span><span class="num" id="4570079">24</span>&nbsp;<span class="op" id="4570082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4570085">//&nbsp;Key&nbsp;expansion&nbsp;algorithm.&nbsp;&nbsp;See&nbsp;FIPS-197,&nbsp;Figure&nbsp;11.</span><br>
<span class="lineno"></span><span class="comment" id="4570139">//&nbsp;Their&nbsp;rcon[i]&nbsp;is&nbsp;our&nbsp;powx[i-1]&nbsp;&lt;&lt;&nbsp;24.</span><br>
<span class="lineno"></span><span class="keyword" id="4570180">func</span>&nbsp;<span class="ident" id="4570185">expandKeyGo</span><span class="op" id="4570196">(</span><span class="ident" id="4570197">key</span>&nbsp;<span class="op" id="4570201">[</span><span class="op" id="4570202">]</span><span class="builtintype" id="4570203">byte</span><span class="op" id="4570207">,</span>&nbsp;<span class="ident" id="4570209">enc</span><span class="op" id="4570212">,</span>&nbsp;<span class="ident" id="4570214">dec</span>&nbsp;<span class="op" id="4570218">[</span><span class="op" id="4570219">]</span><span class="builtintype" id="4570220">uint32</span><span class="op" id="4570226">)</span>&nbsp;<span class="op" id="4570228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4570231">//&nbsp;Encryption&nbsp;key&nbsp;setup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570257">var</span>&nbsp;<span class="ident" id="4570261">i</span>&nbsp;<span class="builtintype" id="4570263">int</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570268">nk</span>&nbsp;<span class="op" id="4570271">:=</span>&nbsp;<span class="builtinfunc" id="4570274">len</span><span class="op" id="4570277">(</span><span class="ident" id="4570278">key</span><span class="op" id="4570281">)</span>&nbsp;<span class="op" id="4570283">/</span>&nbsp;<span class="num" id="4570285">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570288">for</span>&nbsp;<span class="ident" id="4570292">i</span>&nbsp;<span class="op" id="4570294">=</span>&nbsp;<span class="num" id="4570296">0</span><span class="op" id="4570297">;</span>&nbsp;<span class="ident" id="4570299">i</span>&nbsp;<span class="op" id="4570301">&lt;</span>&nbsp;<span class="ident" id="4570303">nk</span><span class="op" id="4570305">;</span>&nbsp;<span class="ident" id="4570307">i</span><span class="op" id="4570308">++</span>&nbsp;<span class="op" id="4570311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570315">enc</span><span class="op" id="4570318">[</span><span class="ident" id="4570319">i</span><span class="op" id="4570320">]</span>&nbsp;<span class="op" id="4570322">=</span>&nbsp;<span class="builtintype" id="4570324">uint32</span><span class="op" id="4570330">(</span><span class="ident" id="4570331">key</span><span class="op" id="4570334">[</span><span class="num" id="4570335">4</span><span class="op" id="4570336">*</span><span class="ident" id="4570337">i</span><span class="op" id="4570338">]</span><span class="op" id="4570339">)</span><span class="op" id="4570340">&lt;&lt;</span><span class="num" id="4570342">24</span>&nbsp;<span class="op" id="4570345">|</span>&nbsp;<span class="builtintype" id="4570347">uint32</span><span class="op" id="4570353">(</span><span class="ident" id="4570354">key</span><span class="op" id="4570357">[</span><span class="num" id="4570358">4</span><span class="op" id="4570359">*</span><span class="ident" id="4570360">i</span><span class="op" id="4570361">+</span><span class="num" id="4570362">1</span><span class="op" id="4570363">]</span><span class="op" id="4570364">)</span><span class="op" id="4570365">&lt;&lt;</span><span class="num" id="4570367">16</span>&nbsp;<span class="op" id="4570370">|</span>&nbsp;<span class="builtintype" id="4570372">uint32</span><span class="op" id="4570378">(</span><span class="ident" id="4570379">key</span><span class="op" id="4570382">[</span><span class="num" id="4570383">4</span><span class="op" id="4570384">*</span><span class="ident" id="4570385">i</span><span class="op" id="4570386">+</span><span class="num" id="4570387">2</span><span class="op" id="4570388">]</span><span class="op" id="4570389">)</span><span class="op" id="4570390">&lt;&lt;</span><span class="num" id="4570392">8</span>&nbsp;<span class="op" id="4570394">|</span>&nbsp;<span class="builtintype" id="4570396">uint32</span><span class="op" id="4570402">(</span><span class="ident" id="4570403">key</span><span class="op" id="4570406">[</span><span class="num" id="4570407">4</span><span class="op" id="4570408">*</span><span class="ident" id="4570409">i</span><span class="op" id="4570410">+</span><span class="num" id="4570411">3</span><span class="op" id="4570412">]</span><span class="op" id="4570413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570419">for</span>&nbsp;<span class="op" id="4570423">;</span>&nbsp;<span class="ident" id="4570425">i</span>&nbsp;<span class="op" id="4570427">&lt;</span>&nbsp;<span class="builtinfunc" id="4570429">len</span><span class="op" id="4570432">(</span><span class="ident" id="4570433">enc</span><span class="op" id="4570436">)</span><span class="op" id="4570437">;</span>&nbsp;<span class="ident" id="4570439">i</span><span class="op" id="4570440">++</span>&nbsp;<span class="op" id="4570443">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570447">t</span>&nbsp;<span class="op" id="4570449">:=</span>&nbsp;<span class="ident" id="4570452">enc</span><span class="op" id="4570455">[</span><span class="ident" id="4570456">i</span><span class="op" id="4570457">-</span><span class="num" id="4570458">1</span><span class="op" id="4570459">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570463">if</span>&nbsp;<span class="ident" id="4570466">i</span><span class="op" id="4570467">%</span><span class="ident" id="4570468">nk</span>&nbsp;<span class="op" id="4570471">==</span>&nbsp;<span class="num" id="4570474">0</span>&nbsp;<span class="op" id="4570476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570481">t</span>&nbsp;<span class="op" id="4570483">=</span>&nbsp;<span class="ident" id="4570485">subw</span><span class="op" id="4570489">(</span><span class="ident" id="4570490">rotw</span><span class="op" id="4570494">(</span><span class="ident" id="4570495">t</span><span class="op" id="4570496">)</span><span class="op" id="4570497">)</span>&nbsp;<span class="op" id="4570499">^</span>&nbsp;<span class="op" id="4570501">(</span><span class="builtintype" id="4570502">uint32</span><span class="op" id="4570508">(</span><span class="ident" id="4570509">powx</span><span class="op" id="4570513">[</span><span class="ident" id="4570514">i</span><span class="op" id="4570515">/</span><span class="ident" id="4570516">nk</span><span class="op" id="4570518">-</span><span class="num" id="4570519">1</span><span class="op" id="4570520">]</span><span class="op" id="4570521">)</span>&nbsp;<span class="op" id="4570523">&lt;&lt;</span>&nbsp;<span class="num" id="4570526">24</span><span class="op" id="4570528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570532">}</span>&nbsp;<span class="keyword" id="4570534">else</span>&nbsp;<span class="keyword" id="4570539">if</span>&nbsp;<span class="ident" id="4570542">nk</span>&nbsp;<span class="op" id="4570545">&gt;</span>&nbsp;<span class="num" id="4570547">6</span>&nbsp;<span class="op" id="4570549">&amp;&amp;</span>&nbsp;<span class="ident" id="4570552">i</span><span class="op" id="4570553">%</span><span class="ident" id="4570554">nk</span>&nbsp;<span class="op" id="4570557">==</span>&nbsp;<span class="num" id="4570560">4</span>&nbsp;<span class="op" id="4570562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570567">t</span>&nbsp;<span class="op" id="4570569">=</span>&nbsp;<span class="ident" id="4570571">subw</span><span class="op" id="4570575">(</span><span class="ident" id="4570576">t</span><span class="op" id="4570577">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570585">enc</span><span class="op" id="4570588">[</span><span class="ident" id="4570589">i</span><span class="op" id="4570590">]</span>&nbsp;<span class="op" id="4570592">=</span>&nbsp;<span class="ident" id="4570594">enc</span><span class="op" id="4570597">[</span><span class="ident" id="4570598">i</span><span class="op" id="4570599">-</span><span class="ident" id="4570600">nk</span><span class="op" id="4570602">]</span>&nbsp;<span class="op" id="4570604">^</span>&nbsp;<span class="ident" id="4570606">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4570613">//&nbsp;Derive&nbsp;decryption&nbsp;key&nbsp;from&nbsp;encryption&nbsp;key.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4570660">//&nbsp;Reverse&nbsp;the&nbsp;4-word&nbsp;round&nbsp;key&nbsp;sets&nbsp;from&nbsp;enc&nbsp;to&nbsp;produce&nbsp;dec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4570723">//&nbsp;All&nbsp;sets&nbsp;but&nbsp;the&nbsp;first&nbsp;and&nbsp;last&nbsp;get&nbsp;the&nbsp;MixColumn&nbsp;transform&nbsp;applied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570796">if</span>&nbsp;<span class="ident" id="4570799">dec</span>&nbsp;<span class="op" id="4570803">==</span>&nbsp;<span class="ident" id="4570806">nil</span>&nbsp;<span class="op" id="4570810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570814">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4570822">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570825">n</span>&nbsp;<span class="op" id="4570827">:=</span>&nbsp;<span class="builtinfunc" id="4570830">len</span><span class="op" id="4570833">(</span><span class="ident" id="4570834">enc</span><span class="op" id="4570837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570840">for</span>&nbsp;<span class="ident" id="4570844">i</span>&nbsp;<span class="op" id="4570846">:=</span>&nbsp;<span class="num" id="4570849">0</span><span class="op" id="4570850">;</span>&nbsp;<span class="ident" id="4570852">i</span>&nbsp;<span class="op" id="4570854">&lt;</span>&nbsp;<span class="ident" id="4570856">n</span><span class="op" id="4570857">;</span>&nbsp;<span class="ident" id="4570859">i</span>&nbsp;<span class="op" id="4570861">+=</span>&nbsp;<span class="num" id="4570864">4</span>&nbsp;<span class="op" id="4570866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570870">ei</span>&nbsp;<span class="op" id="4570873">:=</span>&nbsp;<span class="ident" id="4570876">n</span>&nbsp;<span class="op" id="4570878">-</span>&nbsp;<span class="ident" id="4570880">i</span>&nbsp;<span class="op" id="4570882">-</span>&nbsp;<span class="num" id="4570884">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570888">for</span>&nbsp;<span class="ident" id="4570892">j</span>&nbsp;<span class="op" id="4570894">:=</span>&nbsp;<span class="num" id="4570897">0</span><span class="op" id="4570898">;</span>&nbsp;<span class="ident" id="4570900">j</span>&nbsp;<span class="op" id="4570902">&lt;</span>&nbsp;<span class="num" id="4570904">4</span><span class="op" id="4570905">;</span>&nbsp;<span class="ident" id="4570907">j</span><span class="op" id="4570908">++</span>&nbsp;<span class="op" id="4570911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570916">x</span>&nbsp;<span class="op" id="4570918">:=</span>&nbsp;<span class="ident" id="4570921">enc</span><span class="op" id="4570924">[</span><span class="ident" id="4570925">ei</span><span class="op" id="4570927">+</span><span class="ident" id="4570928">j</span><span class="op" id="4570929">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4570934">if</span>&nbsp;<span class="ident" id="4570937">i</span>&nbsp;<span class="op" id="4570939">&gt;</span>&nbsp;<span class="num" id="4570941">0</span>&nbsp;<span class="op" id="4570943">&amp;&amp;</span>&nbsp;<span class="ident" id="4570946">i</span><span class="op" id="4570947">+</span><span class="num" id="4570948">4</span>&nbsp;<span class="op" id="4570950">&lt;</span>&nbsp;<span class="ident" id="4570952">n</span>&nbsp;<span class="op" id="4570954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4570960">x</span>&nbsp;<span class="op" id="4570962">=</span>&nbsp;<span class="ident" id="4570964">td0</span><span class="op" id="4570967">[</span><span class="ident" id="4570968">sbox0</span><span class="op" id="4570973">[</span><span class="ident" id="4570974">x</span><span class="op" id="4570975">&gt;&gt;</span><span class="num" id="4570977">24</span><span class="op" id="4570979">]</span><span class="op" id="4570980">]</span>&nbsp;<span class="op" id="4570982">^</span>&nbsp;<span class="ident" id="4570984">td1</span><span class="op" id="4570987">[</span><span class="ident" id="4570988">sbox0</span><span class="op" id="4570993">[</span><span class="ident" id="4570994">x</span><span class="op" id="4570995">&gt;&gt;</span><span class="num" id="4570997">16</span><span class="op" id="4570999">&amp;</span><span class="num" id="4571000">0xff</span><span class="op" id="4571004">]</span><span class="op" id="4571005">]</span>&nbsp;<span class="op" id="4571007">^</span>&nbsp;<span class="ident" id="4571009">td2</span><span class="op" id="4571012">[</span><span class="ident" id="4571013">sbox0</span><span class="op" id="4571018">[</span><span class="ident" id="4571019">x</span><span class="op" id="4571020">&gt;&gt;</span><span class="num" id="4571022">8</span><span class="op" id="4571023">&amp;</span><span class="num" id="4571024">0xff</span><span class="op" id="4571028">]</span><span class="op" id="4571029">]</span>&nbsp;<span class="op" id="4571031">^</span>&nbsp;<span class="ident" id="4571033">td3</span><span class="op" id="4571036">[</span><span class="ident" id="4571037">sbox0</span><span class="op" id="4571042">[</span><span class="ident" id="4571043">x</span><span class="op" id="4571044">&amp;</span><span class="num" id="4571045">0xff</span><span class="op" id="4571049">]</span><span class="op" id="4571050">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4571060">dec</span><span class="op" id="4571063">[</span><span class="ident" id="4571064">i</span><span class="op" id="4571065">+</span><span class="ident" id="4571066">j</span><span class="op" id="4571067">]</span>&nbsp;<span class="op" id="4571069">=</span>&nbsp;<span class="ident" id="4571071">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571075">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4571078">}</span><br>
<span class="lineno"></span><span class="op" id="4571080">}</span>
</div>
</body>
</html>
