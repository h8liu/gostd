<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6064134">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6064189">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6064243">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6064294">package</span>&nbsp;<span class="ident" id="6064302">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6064307">import</span>&nbsp;<span class="op" id="6064314">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6064317">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6064335">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6064345">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6064351">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6064364">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6064371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6064374">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6064435">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6064501">type</span>&nbsp;<span class="ident" id="6064506">Compressor</span>&nbsp;<span class="keyword" id="6064517">func</span><span class="op" id="6064521">(</span><span class="ident" id="6064522">io</span><span class="op" id="6064524">.</span><span class="ident" id="6064525">Writer</span><span class="op" id="6064531">)</span>&nbsp;<span class="op" id="6064533">(</span><span class="ident" id="6064534">io</span><span class="op" id="6064536">.</span><span class="ident" id="6064537">WriteCloser</span><span class="op" id="6064548">,</span>&nbsp;<span class="builtintype" id="6064550">error</span><span class="op" id="6064555">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6064558">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="6064637">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6064711">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="6064789">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="6064823">type</span>&nbsp;<span class="ident" id="6064828">Decompressor</span>&nbsp;<span class="keyword" id="6064841">func</span><span class="op" id="6064845">(</span><span class="ident" id="6064846">io</span><span class="op" id="6064848">.</span><span class="ident" id="6064849">Reader</span><span class="op" id="6064855">)</span>&nbsp;<span class="ident" id="6064857">io</span><span class="op" id="6064859">.</span><span class="ident" id="6064860">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6064872">var</span>&nbsp;<span class="ident" id="6064876">flateWriterPool</span>&nbsp;<span class="ident" id="6064892">sync</span><span class="op" id="6064896">.</span><span class="ident" id="6064897">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6064903">func</span>&nbsp;<span class="ident" id="6064908">newFlateWriter</span><span class="op" id="6064922">(</span><span class="ident" id="6064923">w</span>&nbsp;<span class="ident" id="6064925">io</span><span class="op" id="6064927">.</span><span class="ident" id="6064928">Writer</span><span class="op" id="6064934">)</span>&nbsp;<span class="ident" id="6064936">io</span><span class="op" id="6064938">.</span><span class="ident" id="6064939">WriteCloser</span>&nbsp;<span class="op" id="6064951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6064954">fw</span><span class="op" id="6064956">,</span>&nbsp;<span class="ident" id="6064958">ok</span>&nbsp;<span class="op" id="6064961">:=</span>&nbsp;<span class="ident" id="6064964">flateWriterPool</span><span class="op" id="6064979">.</span><span class="ident" id="6064980">Get</span><span class="op" id="6064983">(</span><span class="op" id="6064984">)</span><span class="op" id="6064985">.</span><span class="op" id="6064986">(</span><span class="op" id="6064987">*</span><span class="ident" id="6064988">flate</span><span class="op" id="6064993">.</span><span class="ident" id="6064994">Writer</span><span class="op" id="6065000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065003">if</span>&nbsp;<span class="ident" id="6065006">ok</span>&nbsp;<span class="op" id="6065009">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065013">fw</span><span class="op" id="6065015">.</span><span class="ident" id="6065016">Reset</span><span class="op" id="6065021">(</span><span class="ident" id="6065022">w</span><span class="op" id="6065023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065026">}</span>&nbsp;<span class="keyword" id="6065028">else</span>&nbsp;<span class="op" id="6065033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065037">fw</span><span class="op" id="6065039">,</span>&nbsp;<span class="ident" id="6065041">_</span>&nbsp;<span class="op" id="6065043">=</span>&nbsp;<span class="ident" id="6065045">flate</span><span class="op" id="6065050">.</span><span class="ident" id="6065051">NewWriter</span><span class="op" id="6065060">(</span><span class="ident" id="6065061">w</span><span class="op" id="6065062">,</span>&nbsp;<span class="num" id="6065064">5</span><span class="op" id="6065065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065071">return</span>&nbsp;<span class="op" id="6065078">&amp;</span><span class="ident" id="6065079">pooledFlateWriter</span><span class="op" id="6065096">{</span><span class="ident" id="6065097">fw</span><span class="op" id="6065099">:</span>&nbsp;<span class="ident" id="6065101">fw</span><span class="op" id="6065103">}</span><br>
<span class="lineno">35</span><span class="op" id="6065105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065108">type</span>&nbsp;<span class="ident" id="6065113">pooledFlateWriter</span>&nbsp;<span class="keyword" id="6065131">struct</span>&nbsp;<span class="op" id="6065138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065141">mu</span>&nbsp;<span class="ident" id="6065144">sync</span><span class="op" id="6065148">.</span><span class="ident" id="6065149">Mutex</span>&nbsp;<span class="comment" id="6065155">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065182">fw</span>&nbsp;<span class="op" id="6065185">*</span><span class="ident" id="6065186">flate</span><span class="op" id="6065191">.</span><span class="ident" id="6065192">Writer</span><br>
<span class="lineno">40</span><span class="op" id="6065199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065202">func</span>&nbsp;<span class="op" id="6065207">(</span><span class="ident" id="6065208">w</span>&nbsp;<span class="op" id="6065210">*</span><span class="ident" id="6065211">pooledFlateWriter</span><span class="op" id="6065228">)</span>&nbsp;<span class="ident" id="6065230">Write</span><span class="op" id="6065235">(</span><span class="ident" id="6065236">p</span>&nbsp;<span class="op" id="6065238">[</span><span class="op" id="6065239">]</span><span class="builtintype" id="6065240">byte</span><span class="op" id="6065244">)</span>&nbsp;<span class="op" id="6065246">(</span><span class="ident" id="6065247">n</span>&nbsp;<span class="builtintype" id="6065249">int</span><span class="op" id="6065252">,</span>&nbsp;<span class="ident" id="6065254">err</span>&nbsp;<span class="builtintype" id="6065258">error</span><span class="op" id="6065263">)</span>&nbsp;<span class="op" id="6065265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065268">w</span><span class="op" id="6065269">.</span><span class="ident" id="6065270">mu</span><span class="op" id="6065272">.</span><span class="ident" id="6065273">Lock</span><span class="op" id="6065277">(</span><span class="op" id="6065278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065281">defer</span>&nbsp;<span class="ident" id="6065287">w</span><span class="op" id="6065288">.</span><span class="ident" id="6065289">mu</span><span class="op" id="6065291">.</span><span class="ident" id="6065292">Unlock</span><span class="op" id="6065298">(</span><span class="op" id="6065299">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065302">if</span>&nbsp;<span class="ident" id="6065305">w</span><span class="op" id="6065306">.</span><span class="ident" id="6065307">fw</span>&nbsp;<span class="op" id="6065310">==</span>&nbsp;<span class="ident" id="6065313">nil</span>&nbsp;<span class="op" id="6065317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065321">return</span>&nbsp;<span class="num" id="6065328">0</span><span class="op" id="6065329">,</span>&nbsp;<span class="ident" id="6065331">errors</span><span class="op" id="6065337">.</span><span class="ident" id="6065338">New</span><span class="op" id="6065341">(</span><span class="string" id="6065342">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="6065361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065367">return</span>&nbsp;<span class="ident" id="6065374">w</span><span class="op" id="6065375">.</span><span class="ident" id="6065376">fw</span><span class="op" id="6065378">.</span><span class="ident" id="6065379">Write</span><span class="op" id="6065384">(</span><span class="ident" id="6065385">p</span><span class="op" id="6065386">)</span><br>
<span class="lineno"></span><span class="op" id="6065388">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6065391">func</span>&nbsp;<span class="op" id="6065396">(</span><span class="ident" id="6065397">w</span>&nbsp;<span class="op" id="6065399">*</span><span class="ident" id="6065400">pooledFlateWriter</span><span class="op" id="6065417">)</span>&nbsp;<span class="ident" id="6065419">Close</span><span class="op" id="6065424">(</span><span class="op" id="6065425">)</span>&nbsp;<span class="builtintype" id="6065427">error</span>&nbsp;<span class="op" id="6065433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065436">w</span><span class="op" id="6065437">.</span><span class="ident" id="6065438">mu</span><span class="op" id="6065440">.</span><span class="ident" id="6065441">Lock</span><span class="op" id="6065445">(</span><span class="op" id="6065446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065449">defer</span>&nbsp;<span class="ident" id="6065455">w</span><span class="op" id="6065456">.</span><span class="ident" id="6065457">mu</span><span class="op" id="6065459">.</span><span class="ident" id="6065460">Unlock</span><span class="op" id="6065466">(</span><span class="op" id="6065467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065470">var</span>&nbsp;<span class="ident" id="6065474">err</span>&nbsp;<span class="builtintype" id="6065478">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065485">if</span>&nbsp;<span class="ident" id="6065488">w</span><span class="op" id="6065489">.</span><span class="ident" id="6065490">fw</span>&nbsp;<span class="op" id="6065493">!=</span>&nbsp;<span class="ident" id="6065496">nil</span>&nbsp;<span class="op" id="6065500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065504">err</span>&nbsp;<span class="op" id="6065508">=</span>&nbsp;<span class="ident" id="6065510">w</span><span class="op" id="6065511">.</span><span class="ident" id="6065512">fw</span><span class="op" id="6065514">.</span><span class="ident" id="6065515">Close</span><span class="op" id="6065520">(</span><span class="op" id="6065521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065525">flateWriterPool</span><span class="op" id="6065540">.</span><span class="ident" id="6065541">Put</span><span class="op" id="6065544">(</span><span class="ident" id="6065545">w</span><span class="op" id="6065546">.</span><span class="ident" id="6065547">fw</span><span class="op" id="6065549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065553">w</span><span class="op" id="6065554">.</span><span class="ident" id="6065555">fw</span>&nbsp;<span class="op" id="6065558">=</span>&nbsp;<span class="ident" id="6065560">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065565">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6065568">return</span>&nbsp;<span class="ident" id="6065575">err</span><br>
<span class="lineno"></span><span class="op" id="6065579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6065582">var</span>&nbsp;<span class="op" id="6065586">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065589">mu</span>&nbsp;<span class="ident" id="6065592">sync</span><span class="op" id="6065596">.</span><span class="ident" id="6065597">RWMutex</span>&nbsp;<span class="comment" id="6065605">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065650">compressors</span>&nbsp;<span class="op" id="6065662">=</span>&nbsp;<span class="keyword" id="6065664">map</span><span class="op" id="6065667">[</span><span class="builtintype" id="6065668">uint16</span><span class="op" id="6065674">]</span><span class="ident" id="6065675">Compressor</span><span class="op" id="6065685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065689">Store</span><span class="op" id="6065694">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6065698">func</span><span class="op" id="6065702">(</span><span class="ident" id="6065703">w</span>&nbsp;<span class="ident" id="6065705">io</span><span class="op" id="6065707">.</span><span class="ident" id="6065708">Writer</span><span class="op" id="6065714">)</span>&nbsp;<span class="op" id="6065716">(</span><span class="ident" id="6065717">io</span><span class="op" id="6065719">.</span><span class="ident" id="6065720">WriteCloser</span><span class="op" id="6065731">,</span>&nbsp;<span class="builtintype" id="6065733">error</span><span class="op" id="6065738">)</span>&nbsp;<span class="op" id="6065740">{</span>&nbsp;<span class="keyword" id="6065742">return</span>&nbsp;<span class="op" id="6065749">&amp;</span><span class="ident" id="6065750">nopCloser</span><span class="op" id="6065759">{</span><span class="ident" id="6065760">w</span><span class="op" id="6065761">}</span><span class="op" id="6065762">,</span>&nbsp;<span class="ident" id="6065764">nil</span>&nbsp;<span class="op" id="6065768">}</span><span class="op" id="6065769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065773">Deflate</span><span class="op" id="6065780">:</span>&nbsp;<span class="keyword" id="6065782">func</span><span class="op" id="6065786">(</span><span class="ident" id="6065787">w</span>&nbsp;<span class="ident" id="6065789">io</span><span class="op" id="6065791">.</span><span class="ident" id="6065792">Writer</span><span class="op" id="6065798">)</span>&nbsp;<span class="op" id="6065800">(</span><span class="ident" id="6065801">io</span><span class="op" id="6065803">.</span><span class="ident" id="6065804">WriteCloser</span><span class="op" id="6065815">,</span>&nbsp;<span class="builtintype" id="6065817">error</span><span class="op" id="6065822">)</span>&nbsp;<span class="op" id="6065824">{</span>&nbsp;<span class="keyword" id="6065826">return</span>&nbsp;<span class="ident" id="6065833">newFlateWriter</span><span class="op" id="6065847">(</span><span class="ident" id="6065848">w</span><span class="op" id="6065849">)</span><span class="op" id="6065850">,</span>&nbsp;<span class="ident" id="6065852">nil</span>&nbsp;<span class="op" id="6065856">}</span><span class="op" id="6065857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065860">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065864">decompressors</span>&nbsp;<span class="op" id="6065878">=</span>&nbsp;<span class="keyword" id="6065880">map</span><span class="op" id="6065883">[</span><span class="builtintype" id="6065884">uint16</span><span class="op" id="6065890">]</span><span class="ident" id="6065891">Decompressor</span><span class="op" id="6065903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065907">Store</span><span class="op" id="6065912">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6065916">ioutil</span><span class="op" id="6065922">.</span><span class="ident" id="6065923">NopCloser</span><span class="op" id="6065932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6065936">Deflate</span><span class="op" id="6065943">:</span>&nbsp;<span class="ident" id="6065945">flate</span><span class="op" id="6065950">.</span><span class="ident" id="6065951">NewReader</span><span class="op" id="6065960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6065963">}</span><br>
<span class="lineno">75</span><span class="op" id="6065965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6065968">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="6066047">func</span>&nbsp;<span class="ident" id="6066052">RegisterDecompressor</span><span class="op" id="6066072">(</span><span class="ident" id="6066073">method</span>&nbsp;<span class="builtintype" id="6066080">uint16</span><span class="op" id="6066086">,</span>&nbsp;<span class="ident" id="6066088">d</span>&nbsp;<span class="ident" id="6066090">Decompressor</span><span class="op" id="6066102">)</span>&nbsp;<span class="op" id="6066104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066107">mu</span><span class="op" id="6066109">.</span><span class="ident" id="6066110">Lock</span><span class="op" id="6066114">(</span><span class="op" id="6066115">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066118">defer</span>&nbsp;<span class="ident" id="6066124">mu</span><span class="op" id="6066126">.</span><span class="ident" id="6066127">Unlock</span><span class="op" id="6066133">(</span><span class="op" id="6066134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066138">if</span>&nbsp;<span class="ident" id="6066141">_</span><span class="op" id="6066142">,</span>&nbsp;<span class="ident" id="6066144">ok</span>&nbsp;<span class="op" id="6066147">:=</span>&nbsp;<span class="ident" id="6066150">decompressors</span><span class="op" id="6066163">[</span><span class="ident" id="6066164">method</span><span class="op" id="6066170">]</span><span class="op" id="6066171">;</span>&nbsp;<span class="ident" id="6066173">ok</span>&nbsp;<span class="op" id="6066176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6066180">panic</span><span class="op" id="6066185">(</span><span class="string" id="6066186">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6066219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066222">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066225">decompressors</span><span class="op" id="6066238">[</span><span class="ident" id="6066239">method</span><span class="op" id="6066245">]</span>&nbsp;<span class="op" id="6066247">=</span>&nbsp;<span class="ident" id="6066249">d</span><br>
<span class="lineno"></span><span class="op" id="6066251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6066254">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="6066332">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="6066386">func</span>&nbsp;<span class="ident" id="6066391">RegisterCompressor</span><span class="op" id="6066409">(</span><span class="ident" id="6066410">method</span>&nbsp;<span class="builtintype" id="6066417">uint16</span><span class="op" id="6066423">,</span>&nbsp;<span class="ident" id="6066425">comp</span>&nbsp;<span class="ident" id="6066430">Compressor</span><span class="op" id="6066440">)</span>&nbsp;<span class="op" id="6066442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066445">mu</span><span class="op" id="6066447">.</span><span class="ident" id="6066448">Lock</span><span class="op" id="6066452">(</span><span class="op" id="6066453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066456">defer</span>&nbsp;<span class="ident" id="6066462">mu</span><span class="op" id="6066464">.</span><span class="ident" id="6066465">Unlock</span><span class="op" id="6066471">(</span><span class="op" id="6066472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066476">if</span>&nbsp;<span class="ident" id="6066479">_</span><span class="op" id="6066480">,</span>&nbsp;<span class="ident" id="6066482">ok</span>&nbsp;<span class="op" id="6066485">:=</span>&nbsp;<span class="ident" id="6066488">compressors</span><span class="op" id="6066499">[</span><span class="ident" id="6066500">method</span><span class="op" id="6066506">]</span><span class="op" id="6066507">;</span>&nbsp;<span class="ident" id="6066509">ok</span>&nbsp;<span class="op" id="6066512">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6066516">panic</span><span class="op" id="6066521">(</span><span class="string" id="6066522">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6066553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6066556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066559">compressors</span><span class="op" id="6066570">[</span><span class="ident" id="6066571">method</span><span class="op" id="6066577">]</span>&nbsp;<span class="op" id="6066579">=</span>&nbsp;<span class="ident" id="6066581">comp</span><br>
<span class="lineno"></span><span class="op" id="6066586">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6066589">func</span>&nbsp;<span class="ident" id="6066594">compressor</span><span class="op" id="6066604">(</span><span class="ident" id="6066605">method</span>&nbsp;<span class="builtintype" id="6066612">uint16</span><span class="op" id="6066618">)</span>&nbsp;<span class="ident" id="6066620">Compressor</span>&nbsp;<span class="op" id="6066631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066634">mu</span><span class="op" id="6066636">.</span><span class="ident" id="6066637">RLock</span><span class="op" id="6066642">(</span><span class="op" id="6066643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066646">defer</span>&nbsp;<span class="ident" id="6066652">mu</span><span class="op" id="6066654">.</span><span class="ident" id="6066655">RUnlock</span><span class="op" id="6066662">(</span><span class="op" id="6066663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066666">return</span>&nbsp;<span class="ident" id="6066673">compressors</span><span class="op" id="6066684">[</span><span class="ident" id="6066685">method</span><span class="op" id="6066691">]</span><br>
<span class="lineno"></span><span class="op" id="6066693">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6066696">func</span>&nbsp;<span class="ident" id="6066701">decompressor</span><span class="op" id="6066713">(</span><span class="ident" id="6066714">method</span>&nbsp;<span class="builtintype" id="6066721">uint16</span><span class="op" id="6066727">)</span>&nbsp;<span class="ident" id="6066729">Decompressor</span>&nbsp;<span class="op" id="6066742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6066745">mu</span><span class="op" id="6066747">.</span><span class="ident" id="6066748">RLock</span><span class="op" id="6066753">(</span><span class="op" id="6066754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066757">defer</span>&nbsp;<span class="ident" id="6066763">mu</span><span class="op" id="6066765">.</span><span class="ident" id="6066766">RUnlock</span><span class="op" id="6066773">(</span><span class="op" id="6066774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6066777">return</span>&nbsp;<span class="ident" id="6066784">decompressors</span><span class="op" id="6066797">[</span><span class="ident" id="6066798">method</span><span class="op" id="6066804">]</span><br>
<span class="lineno">110</span><span class="op" id="6066806">}</span>
</div>
</body>
</html>
