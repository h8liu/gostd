<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8008656">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8008711">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8008765">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8008816">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8008865">package</span>&nbsp;<span class="ident" id="8008873">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8008878">import</span>&nbsp;<span class="op" id="8008885">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008888">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008897">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008904">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008912">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008918">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008931">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008939">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008950">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8008961">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8008968">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8008971">func</span>&nbsp;<span class="ident" id="8008976">TestOver65kFiles</span><span class="op" id="8008992">(</span><span class="ident" id="8008993">t</span>&nbsp;<span class="op" id="8008995">*</span><span class="ident" id="8008996">testing</span><span class="op" id="8009003">.</span><span class="ident" id="8009004">T</span><span class="op" id="8009005">)</span>&nbsp;<span class="op" id="8009007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009010">buf</span>&nbsp;<span class="op" id="8009014">:=</span>&nbsp;<span class="builtinfunc" id="8009017">new</span><span class="op" id="8009020">(</span><span class="ident" id="8009021">bytes</span><span class="op" id="8009026">.</span><span class="ident" id="8009027">Buffer</span><span class="op" id="8009033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009036">w</span>&nbsp;<span class="op" id="8009038">:=</span>&nbsp;<span class="ident" id="8009041">NewWriter</span><span class="op" id="8009050">(</span><span class="ident" id="8009051">buf</span><span class="op" id="8009054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009057">const</span>&nbsp;<span class="ident" id="8009063">nFiles</span>&nbsp;<span class="op" id="8009070">=</span>&nbsp;<span class="op" id="8009072">(</span><span class="num" id="8009073">1</span>&nbsp;<span class="op" id="8009075">&lt;&lt;</span>&nbsp;<span class="num" id="8009078">16</span><span class="op" id="8009080">)</span>&nbsp;<span class="op" id="8009082">+</span>&nbsp;<span class="num" id="8009084">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009088">for</span>&nbsp;<span class="ident" id="8009092">i</span>&nbsp;<span class="op" id="8009094">:=</span>&nbsp;<span class="num" id="8009097">0</span><span class="op" id="8009098">;</span>&nbsp;<span class="ident" id="8009100">i</span>&nbsp;<span class="op" id="8009102">&lt;</span>&nbsp;<span class="ident" id="8009104">nFiles</span><span class="op" id="8009110">;</span>&nbsp;<span class="ident" id="8009112">i</span><span class="op" id="8009113">++</span>&nbsp;<span class="op" id="8009116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009120">_</span><span class="op" id="8009121">,</span>&nbsp;<span class="ident" id="8009123">err</span>&nbsp;<span class="op" id="8009127">:=</span>&nbsp;<span class="ident" id="8009130">w</span><span class="op" id="8009131">.</span><span class="ident" id="8009132">CreateHeader</span><span class="op" id="8009144">(</span><span class="op" id="8009145">&amp;</span><span class="ident" id="8009146">FileHeader</span><span class="op" id="8009156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009161">Name</span><span class="op" id="8009165">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8009169">fmt</span><span class="op" id="8009172">.</span><span class="ident" id="8009173">Sprintf</span><span class="op" id="8009180">(</span><span class="string" id="8009181">&#34;%d.dat&#34;</span><span class="op" id="8009189">,</span>&nbsp;<span class="ident" id="8009191">i</span><span class="op" id="8009192">)</span><span class="op" id="8009193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009198">Method</span><span class="op" id="8009204">:</span>&nbsp;<span class="ident" id="8009206">Store</span><span class="op" id="8009211">,</span>&nbsp;<span class="comment" id="8009213">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009250">}</span><span class="op" id="8009251">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009255">if</span>&nbsp;<span class="ident" id="8009258">err</span>&nbsp;<span class="op" id="8009262">!=</span>&nbsp;<span class="ident" id="8009265">nil</span>&nbsp;<span class="op" id="8009269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009274">t</span><span class="op" id="8009275">.</span><span class="ident" id="8009276">Fatalf</span><span class="op" id="8009282">(</span><span class="string" id="8009283">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8009305">,</span>&nbsp;<span class="ident" id="8009307">i</span><span class="op" id="8009308">,</span>&nbsp;<span class="ident" id="8009310">err</span><span class="op" id="8009313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009323">if</span>&nbsp;<span class="ident" id="8009326">err</span>&nbsp;<span class="op" id="8009330">:=</span>&nbsp;<span class="ident" id="8009333">w</span><span class="op" id="8009334">.</span><span class="ident" id="8009335">Close</span><span class="op" id="8009340">(</span><span class="op" id="8009341">)</span><span class="op" id="8009342">;</span>&nbsp;<span class="ident" id="8009344">err</span>&nbsp;<span class="op" id="8009348">!=</span>&nbsp;<span class="ident" id="8009351">nil</span>&nbsp;<span class="op" id="8009355">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009359">t</span><span class="op" id="8009360">.</span><span class="ident" id="8009361">Fatalf</span><span class="op" id="8009367">(</span><span class="string" id="8009368">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="8009386">,</span>&nbsp;<span class="ident" id="8009388">err</span><span class="op" id="8009391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009397">s</span>&nbsp;<span class="op" id="8009399">:=</span>&nbsp;<span class="ident" id="8009402">buf</span><span class="op" id="8009405">.</span><span class="ident" id="8009406">String</span><span class="op" id="8009412">(</span><span class="op" id="8009413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009416">zr</span><span class="op" id="8009418">,</span>&nbsp;<span class="ident" id="8009420">err</span>&nbsp;<span class="op" id="8009424">:=</span>&nbsp;<span class="ident" id="8009427">NewReader</span><span class="op" id="8009436">(</span><span class="ident" id="8009437">strings</span><span class="op" id="8009444">.</span><span class="ident" id="8009445">NewReader</span><span class="op" id="8009454">(</span><span class="ident" id="8009455">s</span><span class="op" id="8009456">)</span><span class="op" id="8009457">,</span>&nbsp;<span class="ident" id="8009459">int64</span><span class="op" id="8009464">(</span><span class="builtinfunc" id="8009465">len</span><span class="op" id="8009468">(</span><span class="ident" id="8009469">s</span><span class="op" id="8009470">)</span><span class="op" id="8009471">)</span><span class="op" id="8009472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009475">if</span>&nbsp;<span class="ident" id="8009478">err</span>&nbsp;<span class="op" id="8009482">!=</span>&nbsp;<span class="ident" id="8009485">nil</span>&nbsp;<span class="op" id="8009489">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009493">t</span><span class="op" id="8009494">.</span><span class="ident" id="8009495">Fatalf</span><span class="op" id="8009501">(</span><span class="string" id="8009502">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="8009517">,</span>&nbsp;<span class="ident" id="8009519">err</span><span class="op" id="8009522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009528">if</span>&nbsp;<span class="ident" id="8009531">got</span>&nbsp;<span class="op" id="8009535">:=</span>&nbsp;<span class="builtinfunc" id="8009538">len</span><span class="op" id="8009541">(</span><span class="ident" id="8009542">zr</span><span class="op" id="8009544">.</span><span class="ident" id="8009545">File</span><span class="op" id="8009549">)</span><span class="op" id="8009550">;</span>&nbsp;<span class="ident" id="8009552">got</span>&nbsp;<span class="op" id="8009556">!=</span>&nbsp;<span class="ident" id="8009559">nFiles</span>&nbsp;<span class="op" id="8009566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009570">t</span><span class="op" id="8009571">.</span><span class="ident" id="8009572">Fatalf</span><span class="op" id="8009578">(</span><span class="string" id="8009579">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8009612">,</span>&nbsp;<span class="ident" id="8009614">got</span><span class="op" id="8009617">,</span>&nbsp;<span class="ident" id="8009619">nFiles</span><span class="op" id="8009625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009628">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009631">for</span>&nbsp;<span class="ident" id="8009635">i</span>&nbsp;<span class="op" id="8009637">:=</span>&nbsp;<span class="num" id="8009640">0</span><span class="op" id="8009641">;</span>&nbsp;<span class="ident" id="8009643">i</span>&nbsp;<span class="op" id="8009645">&lt;</span>&nbsp;<span class="ident" id="8009647">nFiles</span><span class="op" id="8009653">;</span>&nbsp;<span class="ident" id="8009655">i</span><span class="op" id="8009656">++</span>&nbsp;<span class="op" id="8009659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009663">want</span>&nbsp;<span class="op" id="8009668">:=</span>&nbsp;<span class="ident" id="8009671">fmt</span><span class="op" id="8009674">.</span><span class="ident" id="8009675">Sprintf</span><span class="op" id="8009682">(</span><span class="string" id="8009683">&#34;%d.dat&#34;</span><span class="op" id="8009691">,</span>&nbsp;<span class="ident" id="8009693">i</span><span class="op" id="8009694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009698">if</span>&nbsp;<span class="ident" id="8009701">zr</span><span class="op" id="8009703">.</span><span class="ident" id="8009704">File</span><span class="op" id="8009708">[</span><span class="ident" id="8009709">i</span><span class="op" id="8009710">]</span><span class="op" id="8009711">.</span><span class="ident" id="8009712">Name</span>&nbsp;<span class="op" id="8009717">!=</span>&nbsp;<span class="ident" id="8009720">want</span>&nbsp;<span class="op" id="8009725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009730">t</span><span class="op" id="8009731">.</span><span class="ident" id="8009732">Fatalf</span><span class="op" id="8009738">(</span><span class="string" id="8009739">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8009763">,</span>&nbsp;<span class="ident" id="8009765">i</span><span class="op" id="8009766">,</span>&nbsp;<span class="ident" id="8009768">zr</span><span class="op" id="8009770">.</span><span class="ident" id="8009771">File</span><span class="op" id="8009775">[</span><span class="ident" id="8009776">i</span><span class="op" id="8009777">]</span><span class="op" id="8009778">.</span><span class="ident" id="8009779">Name</span><span class="op" id="8009783">,</span>&nbsp;<span class="ident" id="8009785">want</span><span class="op" id="8009789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009793">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8009796">}</span><br>
<span class="lineno"></span><span class="op" id="8009798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8009801">func</span>&nbsp;<span class="ident" id="8009806">TestModTime</span><span class="op" id="8009817">(</span><span class="ident" id="8009818">t</span>&nbsp;<span class="op" id="8009820">*</span><span class="ident" id="8009821">testing</span><span class="op" id="8009828">.</span><span class="ident" id="8009829">T</span><span class="op" id="8009830">)</span>&nbsp;<span class="op" id="8009832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009835">var</span>&nbsp;<span class="ident" id="8009839">testTime</span>&nbsp;<span class="op" id="8009848">=</span>&nbsp;<span class="ident" id="8009850">time</span><span class="op" id="8009854">.</span><span class="ident" id="8009855">Date</span><span class="op" id="8009859">(</span><span class="num" id="8009860">2009</span><span class="op" id="8009864">,</span>&nbsp;<span class="ident" id="8009866">time</span><span class="op" id="8009870">.</span><span class="ident" id="8009871">November</span><span class="op" id="8009879">,</span>&nbsp;<span class="num" id="8009881">10</span><span class="op" id="8009883">,</span>&nbsp;<span class="num" id="8009885">23</span><span class="op" id="8009887">,</span>&nbsp;<span class="num" id="8009889">45</span><span class="op" id="8009891">,</span>&nbsp;<span class="num" id="8009893">58</span><span class="op" id="8009895">,</span>&nbsp;<span class="num" id="8009897">0</span><span class="op" id="8009898">,</span>&nbsp;<span class="ident" id="8009900">time</span><span class="op" id="8009904">.</span><span class="ident" id="8009905">UTC</span><span class="op" id="8009908">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009911">fh</span>&nbsp;<span class="op" id="8009914">:=</span>&nbsp;<span class="builtinfunc" id="8009917">new</span><span class="op" id="8009920">(</span><span class="ident" id="8009921">FileHeader</span><span class="op" id="8009931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009934">fh</span><span class="op" id="8009936">.</span><span class="ident" id="8009937">SetModTime</span><span class="op" id="8009947">(</span><span class="ident" id="8009948">testTime</span><span class="op" id="8009956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8009959">outTime</span>&nbsp;<span class="op" id="8009967">:=</span>&nbsp;<span class="ident" id="8009970">fh</span><span class="op" id="8009972">.</span><span class="ident" id="8009973">ModTime</span><span class="op" id="8009980">(</span><span class="op" id="8009981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8009984">if</span>&nbsp;<span class="op" id="8009987">!</span><span class="ident" id="8009988">outTime</span><span class="op" id="8009995">.</span><span class="ident" id="8009996">Equal</span><span class="op" id="8010001">(</span><span class="ident" id="8010002">testTime</span><span class="op" id="8010010">)</span>&nbsp;<span class="op" id="8010012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010016">t</span><span class="op" id="8010017">.</span><span class="ident" id="8010018">Errorf</span><span class="op" id="8010024">(</span><span class="string" id="8010025">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8010061">,</span>&nbsp;<span class="ident" id="8010063">outTime</span><span class="op" id="8010070">,</span>&nbsp;<span class="ident" id="8010072">testTime</span><span class="op" id="8010080">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010083">}</span><br>
<span class="lineno"></span><span class="op" id="8010085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8010088">func</span>&nbsp;<span class="ident" id="8010093">testHeaderRoundTrip</span><span class="op" id="8010112">(</span><span class="ident" id="8010113">fh</span>&nbsp;<span class="op" id="8010116">*</span><span class="ident" id="8010117">FileHeader</span><span class="op" id="8010127">,</span>&nbsp;<span class="ident" id="8010129">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="8010150">uint32</span><span class="op" id="8010156">,</span>&nbsp;<span class="ident" id="8010158">wantUncompressedSize64</span>&nbsp;<span class="ident" id="8010181">uint64</span><span class="op" id="8010187">,</span>&nbsp;<span class="ident" id="8010189">t</span>&nbsp;<span class="op" id="8010191">*</span><span class="ident" id="8010192">testing</span><span class="op" id="8010199">.</span><span class="ident" id="8010200">T</span><span class="op" id="8010201">)</span>&nbsp;<span class="op" id="8010203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010206">fi</span>&nbsp;<span class="op" id="8010209">:=</span>&nbsp;<span class="ident" id="8010212">fh</span><span class="op" id="8010214">.</span><span class="ident" id="8010215">FileInfo</span><span class="op" id="8010223">(</span><span class="op" id="8010224">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010227">fh2</span><span class="op" id="8010230">,</span>&nbsp;<span class="ident" id="8010232">err</span>&nbsp;<span class="op" id="8010236">:=</span>&nbsp;<span class="ident" id="8010239">FileInfoHeader</span><span class="op" id="8010253">(</span><span class="ident" id="8010254">fi</span><span class="op" id="8010256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010259">if</span>&nbsp;<span class="ident" id="8010262">err</span>&nbsp;<span class="op" id="8010266">!=</span>&nbsp;<span class="ident" id="8010269">nil</span>&nbsp;<span class="op" id="8010273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010277">t</span><span class="op" id="8010278">.</span><span class="ident" id="8010279">Fatal</span><span class="op" id="8010284">(</span><span class="ident" id="8010285">err</span><span class="op" id="8010288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010294">if</span>&nbsp;<span class="ident" id="8010297">got</span><span class="op" id="8010300">,</span>&nbsp;<span class="ident" id="8010302">want</span>&nbsp;<span class="op" id="8010307">:=</span>&nbsp;<span class="ident" id="8010310">fh2</span><span class="op" id="8010313">.</span><span class="ident" id="8010314">Name</span><span class="op" id="8010318">,</span>&nbsp;<span class="ident" id="8010320">fh</span><span class="op" id="8010322">.</span><span class="ident" id="8010323">Name</span><span class="op" id="8010327">;</span>&nbsp;<span class="ident" id="8010329">got</span>&nbsp;<span class="op" id="8010333">!=</span>&nbsp;<span class="ident" id="8010336">want</span>&nbsp;<span class="op" id="8010341">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010345">t</span><span class="op" id="8010346">.</span><span class="ident" id="8010347">Errorf</span><span class="op" id="8010353">(</span><span class="string" id="8010354">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="8010379">,</span>&nbsp;<span class="ident" id="8010381">got</span><span class="op" id="8010384">,</span>&nbsp;<span class="ident" id="8010386">want</span><span class="op" id="8010390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010396">if</span>&nbsp;<span class="ident" id="8010399">got</span><span class="op" id="8010402">,</span>&nbsp;<span class="ident" id="8010404">want</span>&nbsp;<span class="op" id="8010409">:=</span>&nbsp;<span class="ident" id="8010412">fh2</span><span class="op" id="8010415">.</span><span class="ident" id="8010416">UncompressedSize</span><span class="op" id="8010432">,</span>&nbsp;<span class="ident" id="8010434">wantUncompressedSize</span><span class="op" id="8010454">;</span>&nbsp;<span class="ident" id="8010456">got</span>&nbsp;<span class="op" id="8010460">!=</span>&nbsp;<span class="ident" id="8010463">want</span>&nbsp;<span class="op" id="8010468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010472">t</span><span class="op" id="8010473">.</span><span class="ident" id="8010474">Errorf</span><span class="op" id="8010480">(</span><span class="string" id="8010481">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8010518">,</span>&nbsp;<span class="ident" id="8010520">got</span><span class="op" id="8010523">,</span>&nbsp;<span class="ident" id="8010525">want</span><span class="op" id="8010529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010532">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010535">if</span>&nbsp;<span class="ident" id="8010538">got</span><span class="op" id="8010541">,</span>&nbsp;<span class="ident" id="8010543">want</span>&nbsp;<span class="op" id="8010548">:=</span>&nbsp;<span class="ident" id="8010551">fh2</span><span class="op" id="8010554">.</span><span class="ident" id="8010555">UncompressedSize64</span><span class="op" id="8010573">,</span>&nbsp;<span class="ident" id="8010575">wantUncompressedSize64</span><span class="op" id="8010597">;</span>&nbsp;<span class="ident" id="8010599">got</span>&nbsp;<span class="op" id="8010603">!=</span>&nbsp;<span class="ident" id="8010606">want</span>&nbsp;<span class="op" id="8010611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010615">t</span><span class="op" id="8010616">.</span><span class="ident" id="8010617">Errorf</span><span class="op" id="8010623">(</span><span class="string" id="8010624">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8010663">,</span>&nbsp;<span class="ident" id="8010665">got</span><span class="op" id="8010668">,</span>&nbsp;<span class="ident" id="8010670">want</span><span class="op" id="8010674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010680">if</span>&nbsp;<span class="ident" id="8010683">got</span><span class="op" id="8010686">,</span>&nbsp;<span class="ident" id="8010688">want</span>&nbsp;<span class="op" id="8010693">:=</span>&nbsp;<span class="ident" id="8010696">fh2</span><span class="op" id="8010699">.</span><span class="ident" id="8010700">ModifiedTime</span><span class="op" id="8010712">,</span>&nbsp;<span class="ident" id="8010714">fh</span><span class="op" id="8010716">.</span><span class="ident" id="8010717">ModifiedTime</span><span class="op" id="8010729">;</span>&nbsp;<span class="ident" id="8010731">got</span>&nbsp;<span class="op" id="8010735">!=</span>&nbsp;<span class="ident" id="8010738">want</span>&nbsp;<span class="op" id="8010743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010747">t</span><span class="op" id="8010748">.</span><span class="ident" id="8010749">Errorf</span><span class="op" id="8010755">(</span><span class="string" id="8010756">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8010789">,</span>&nbsp;<span class="ident" id="8010791">got</span><span class="op" id="8010794">,</span>&nbsp;<span class="ident" id="8010796">want</span><span class="op" id="8010800">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010806">if</span>&nbsp;<span class="ident" id="8010809">got</span><span class="op" id="8010812">,</span>&nbsp;<span class="ident" id="8010814">want</span>&nbsp;<span class="op" id="8010819">:=</span>&nbsp;<span class="ident" id="8010822">fh2</span><span class="op" id="8010825">.</span><span class="ident" id="8010826">ModifiedDate</span><span class="op" id="8010838">,</span>&nbsp;<span class="ident" id="8010840">fh</span><span class="op" id="8010842">.</span><span class="ident" id="8010843">ModifiedDate</span><span class="op" id="8010855">;</span>&nbsp;<span class="ident" id="8010857">got</span>&nbsp;<span class="op" id="8010861">!=</span>&nbsp;<span class="ident" id="8010864">want</span>&nbsp;<span class="op" id="8010869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010873">t</span><span class="op" id="8010874">.</span><span class="ident" id="8010875">Errorf</span><span class="op" id="8010881">(</span><span class="string" id="8010882">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="8010915">,</span>&nbsp;<span class="ident" id="8010917">got</span><span class="op" id="8010920">,</span>&nbsp;<span class="ident" id="8010922">want</span><span class="op" id="8010926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8010929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8010933">if</span>&nbsp;<span class="ident" id="8010936">sysfh</span><span class="op" id="8010941">,</span>&nbsp;<span class="ident" id="8010943">ok</span>&nbsp;<span class="op" id="8010946">:=</span>&nbsp;<span class="ident" id="8010949">fi</span><span class="op" id="8010951">.</span><span class="ident" id="8010952">Sys</span><span class="op" id="8010955">(</span><span class="op" id="8010956">)</span><span class="op" id="8010957">.</span><span class="op" id="8010958">(</span><span class="op" id="8010959">*</span><span class="ident" id="8010960">FileHeader</span><span class="op" id="8010970">)</span><span class="op" id="8010971">;</span>&nbsp;<span class="op" id="8010973">!</span><span class="ident" id="8010974">ok</span>&nbsp;<span class="op" id="8010977">&amp;&amp;</span>&nbsp;<span class="ident" id="8010980">sysfh</span>&nbsp;<span class="op" id="8010986">!=</span>&nbsp;<span class="ident" id="8010989">fh</span>&nbsp;<span class="op" id="8010992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8010996">t</span><span class="op" id="8010997">.</span><span class="ident" id="8010998">Errorf</span><span class="op" id="8011004">(</span><span class="string" id="8011005">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="8011045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011048">}</span><br>
<span class="lineno"></span><span class="op" id="8011050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="8011053">func</span>&nbsp;<span class="ident" id="8011058">TestFileHeaderRoundTrip</span><span class="op" id="8011081">(</span><span class="ident" id="8011082">t</span>&nbsp;<span class="op" id="8011084">*</span><span class="ident" id="8011085">testing</span><span class="op" id="8011092">.</span><span class="ident" id="8011093">T</span><span class="op" id="8011094">)</span>&nbsp;<span class="op" id="8011096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011099">fh</span>&nbsp;<span class="op" id="8011102">:=</span>&nbsp;<span class="op" id="8011105">&amp;</span><span class="ident" id="8011106">FileHeader</span><span class="op" id="8011116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011120">Name</span><span class="op" id="8011124">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8011138">&#34;foo.txt&#34;</span><span class="op" id="8011147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011151">UncompressedSize</span><span class="op" id="8011167">:</span>&nbsp;<span class="num" id="8011169">987654321</span><span class="op" id="8011178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011182">ModifiedTime</span><span class="op" id="8011194">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8011200">1234</span><span class="op" id="8011204">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011208">ModifiedDate</span><span class="op" id="8011220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8011226">5678</span><span class="op" id="8011230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011236">testHeaderRoundTrip</span><span class="op" id="8011255">(</span><span class="ident" id="8011256">fh</span><span class="op" id="8011258">,</span>&nbsp;<span class="ident" id="8011260">fh</span><span class="op" id="8011262">.</span><span class="ident" id="8011263">UncompressedSize</span><span class="op" id="8011279">,</span>&nbsp;<span class="ident" id="8011281">uint64</span><span class="op" id="8011287">(</span><span class="ident" id="8011288">fh</span><span class="op" id="8011290">.</span><span class="ident" id="8011291">UncompressedSize</span><span class="op" id="8011307">)</span><span class="op" id="8011308">,</span>&nbsp;<span class="ident" id="8011310">t</span><span class="op" id="8011311">)</span><br>
<span class="lineno"></span><span class="op" id="8011313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="8011316">func</span>&nbsp;<span class="ident" id="8011321">TestFileHeaderRoundTrip64</span><span class="op" id="8011346">(</span><span class="ident" id="8011347">t</span>&nbsp;<span class="op" id="8011349">*</span><span class="ident" id="8011350">testing</span><span class="op" id="8011357">.</span><span class="ident" id="8011358">T</span><span class="op" id="8011359">)</span>&nbsp;<span class="op" id="8011361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011364">fh</span>&nbsp;<span class="op" id="8011367">:=</span>&nbsp;<span class="op" id="8011370">&amp;</span><span class="ident" id="8011371">FileHeader</span><span class="op" id="8011381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011385">Name</span><span class="op" id="8011389">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8011405">&#34;foo.txt&#34;</span><span class="op" id="8011414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011418">UncompressedSize64</span><span class="op" id="8011436">:</span>&nbsp;<span class="num" id="8011438">9876543210</span><span class="op" id="8011448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011452">ModifiedTime</span><span class="op" id="8011464">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8011472">1234</span><span class="op" id="8011476">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011480">ModifiedDate</span><span class="op" id="8011492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8011500">5678</span><span class="op" id="8011504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011510">testHeaderRoundTrip</span><span class="op" id="8011529">(</span><span class="ident" id="8011530">fh</span><span class="op" id="8011532">,</span>&nbsp;<span class="ident" id="8011534">uint32max</span><span class="op" id="8011543">,</span>&nbsp;<span class="ident" id="8011545">fh</span><span class="op" id="8011547">.</span><span class="ident" id="8011548">UncompressedSize64</span><span class="op" id="8011566">,</span>&nbsp;<span class="ident" id="8011568">t</span><span class="op" id="8011569">)</span><br>
<span class="lineno"></span><span class="op" id="8011571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="8011574">type</span>&nbsp;<span class="ident" id="8011579">repeatedByte</span>&nbsp;<span class="keyword" id="8011592">struct</span>&nbsp;<span class="op" id="8011599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011602">off</span>&nbsp;<span class="ident" id="8011606">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011613">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8011617">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011623">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8011627">int64</span><br>
<span class="lineno"></span><span class="op" id="8011633">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="8011636">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="8011686">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="8011754">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="8011787">type</span>&nbsp;<span class="ident" id="8011792">rleBuffer</span>&nbsp;<span class="keyword" id="8011802">struct</span>&nbsp;<span class="op" id="8011809">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011812">buf</span>&nbsp;<span class="op" id="8011816">[</span><span class="op" id="8011817">]</span><span class="ident" id="8011818">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="8011831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8011834">func</span>&nbsp;<span class="op" id="8011839">(</span><span class="ident" id="8011840">r</span>&nbsp;<span class="op" id="8011842">*</span><span class="ident" id="8011843">rleBuffer</span><span class="op" id="8011852">)</span>&nbsp;<span class="ident" id="8011854">Size</span><span class="op" id="8011858">(</span><span class="op" id="8011859">)</span>&nbsp;<span class="ident" id="8011861">int64</span>&nbsp;<span class="op" id="8011867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8011870">if</span>&nbsp;<span class="builtinfunc" id="8011873">len</span><span class="op" id="8011876">(</span><span class="ident" id="8011877">r</span><span class="op" id="8011878">.</span><span class="ident" id="8011879">buf</span><span class="op" id="8011882">)</span>&nbsp;<span class="op" id="8011884">==</span>&nbsp;<span class="num" id="8011887">0</span>&nbsp;<span class="op" id="8011889">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8011893">return</span>&nbsp;<span class="num" id="8011900">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8011903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8011906">last</span>&nbsp;<span class="op" id="8011911">:=</span>&nbsp;<span class="op" id="8011914">&amp;</span><span class="ident" id="8011915">r</span><span class="op" id="8011916">.</span><span class="ident" id="8011917">buf</span><span class="op" id="8011920">[</span><span class="builtinfunc" id="8011921">len</span><span class="op" id="8011924">(</span><span class="ident" id="8011925">r</span><span class="op" id="8011926">.</span><span class="ident" id="8011927">buf</span><span class="op" id="8011930">)</span><span class="op" id="8011931">-</span><span class="num" id="8011932">1</span><span class="op" id="8011933">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8011936">return</span>&nbsp;<span class="ident" id="8011943">last</span><span class="op" id="8011947">.</span><span class="ident" id="8011948">off</span>&nbsp;<span class="op" id="8011952">+</span>&nbsp;<span class="ident" id="8011954">last</span><span class="op" id="8011958">.</span><span class="ident" id="8011959">n</span><br>
<span class="lineno"></span><span class="op" id="8011961">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="8011964">func</span>&nbsp;<span class="op" id="8011969">(</span><span class="ident" id="8011970">r</span>&nbsp;<span class="op" id="8011972">*</span><span class="ident" id="8011973">rleBuffer</span><span class="op" id="8011982">)</span>&nbsp;<span class="ident" id="8011984">Write</span><span class="op" id="8011989">(</span><span class="ident" id="8011990">p</span>&nbsp;<span class="op" id="8011992">[</span><span class="op" id="8011993">]</span><span class="builtintype" id="8011994">byte</span><span class="op" id="8011998">)</span>&nbsp;<span class="op" id="8012000">(</span><span class="ident" id="8012001">n</span>&nbsp;<span class="builtintype" id="8012003">int</span><span class="op" id="8012006">,</span>&nbsp;<span class="ident" id="8012008">err</span>&nbsp;<span class="builtintype" id="8012012">error</span><span class="op" id="8012017">)</span>&nbsp;<span class="op" id="8012019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012022">var</span>&nbsp;<span class="ident" id="8012026">rp</span>&nbsp;<span class="op" id="8012029">*</span><span class="ident" id="8012030">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012044">if</span>&nbsp;<span class="builtinfunc" id="8012047">len</span><span class="op" id="8012050">(</span><span class="ident" id="8012051">r</span><span class="op" id="8012052">.</span><span class="ident" id="8012053">buf</span><span class="op" id="8012056">)</span>&nbsp;<span class="op" id="8012058">&gt;</span>&nbsp;<span class="num" id="8012060">0</span>&nbsp;<span class="op" id="8012062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012066">rp</span>&nbsp;<span class="op" id="8012069">=</span>&nbsp;<span class="op" id="8012071">&amp;</span><span class="ident" id="8012072">r</span><span class="op" id="8012073">.</span><span class="ident" id="8012074">buf</span><span class="op" id="8012077">[</span><span class="builtinfunc" id="8012078">len</span><span class="op" id="8012081">(</span><span class="ident" id="8012082">r</span><span class="op" id="8012083">.</span><span class="ident" id="8012084">buf</span><span class="op" id="8012087">)</span><span class="op" id="8012088">-</span><span class="num" id="8012089">1</span><span class="op" id="8012090">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8012094">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012151">if</span>&nbsp;<span class="ident" id="8012154">lastByte</span>&nbsp;<span class="op" id="8012163">:=</span>&nbsp;<span class="ident" id="8012166">rp</span><span class="op" id="8012168">.</span><span class="ident" id="8012169">b</span><span class="op" id="8012170">;</span>&nbsp;<span class="builtinfunc" id="8012172">len</span><span class="op" id="8012175">(</span><span class="ident" id="8012176">p</span><span class="op" id="8012177">)</span>&nbsp;<span class="op" id="8012179">&gt;</span>&nbsp;<span class="num" id="8012181">0</span>&nbsp;<span class="op" id="8012183">&amp;&amp;</span>&nbsp;<span class="ident" id="8012186">p</span><span class="op" id="8012187">[</span><span class="num" id="8012188">0</span><span class="op" id="8012189">]</span>&nbsp;<span class="op" id="8012191">==</span>&nbsp;<span class="ident" id="8012194">lastByte</span>&nbsp;<span class="op" id="8012203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012208">all</span>&nbsp;<span class="op" id="8012212">:=</span>&nbsp;<span class="builtintype" id="8012215">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012223">for</span>&nbsp;<span class="ident" id="8012227">_</span><span class="op" id="8012228">,</span>&nbsp;<span class="ident" id="8012230">b</span>&nbsp;<span class="op" id="8012232">:=</span>&nbsp;<span class="keyword" id="8012235">range</span>&nbsp;<span class="ident" id="8012241">p</span>&nbsp;<span class="op" id="8012243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012249">if</span>&nbsp;<span class="ident" id="8012252">b</span>&nbsp;<span class="op" id="8012254">!=</span>&nbsp;<span class="ident" id="8012257">lastByte</span>&nbsp;<span class="op" id="8012266">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012273">all</span>&nbsp;<span class="op" id="8012277">=</span>&nbsp;<span class="builtintype" id="8012279">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012290">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012310">if</span>&nbsp;<span class="ident" id="8012313">all</span>&nbsp;<span class="op" id="8012317">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012323">rp</span><span class="op" id="8012325">.</span><span class="ident" id="8012326">n</span>&nbsp;<span class="op" id="8012328">+=</span>&nbsp;<span class="ident" id="8012331">int64</span><span class="op" id="8012336">(</span><span class="builtinfunc" id="8012337">len</span><span class="op" id="8012340">(</span><span class="ident" id="8012341">p</span><span class="op" id="8012342">)</span><span class="op" id="8012343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012349">return</span>&nbsp;<span class="builtinfunc" id="8012356">len</span><span class="op" id="8012359">(</span><span class="ident" id="8012360">p</span><span class="op" id="8012361">)</span><span class="op" id="8012362">,</span>&nbsp;<span class="ident" id="8012364">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012378">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012382">for</span>&nbsp;<span class="ident" id="8012386">_</span><span class="op" id="8012387">,</span>&nbsp;<span class="ident" id="8012389">b</span>&nbsp;<span class="op" id="8012391">:=</span>&nbsp;<span class="keyword" id="8012394">range</span>&nbsp;<span class="ident" id="8012400">p</span>&nbsp;<span class="op" id="8012402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012406">if</span>&nbsp;<span class="ident" id="8012409">rp</span>&nbsp;<span class="op" id="8012412">==</span>&nbsp;<span class="ident" id="8012415">nil</span>&nbsp;<span class="op" id="8012419">||</span>&nbsp;<span class="ident" id="8012422">rp</span><span class="op" id="8012424">.</span><span class="ident" id="8012425">b</span>&nbsp;<span class="op" id="8012427">!=</span>&nbsp;<span class="ident" id="8012430">b</span>&nbsp;<span class="op" id="8012432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012437">r</span><span class="op" id="8012438">.</span><span class="ident" id="8012439">buf</span>&nbsp;<span class="op" id="8012443">=</span>&nbsp;<span class="builtinfunc" id="8012445">append</span><span class="op" id="8012451">(</span><span class="ident" id="8012452">r</span><span class="op" id="8012453">.</span><span class="ident" id="8012454">buf</span><span class="op" id="8012457">,</span>&nbsp;<span class="ident" id="8012459">repeatedByte</span><span class="op" id="8012471">{</span><span class="ident" id="8012472">r</span><span class="op" id="8012473">.</span><span class="ident" id="8012474">Size</span><span class="op" id="8012478">(</span><span class="op" id="8012479">)</span><span class="op" id="8012480">,</span>&nbsp;<span class="ident" id="8012482">b</span><span class="op" id="8012483">,</span>&nbsp;<span class="num" id="8012485">1</span><span class="op" id="8012486">}</span><span class="op" id="8012487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012492">rp</span>&nbsp;<span class="op" id="8012495">=</span>&nbsp;<span class="op" id="8012497">&amp;</span><span class="ident" id="8012498">r</span><span class="op" id="8012499">.</span><span class="ident" id="8012500">buf</span><span class="op" id="8012503">[</span><span class="builtinfunc" id="8012504">len</span><span class="op" id="8012507">(</span><span class="ident" id="8012508">r</span><span class="op" id="8012509">.</span><span class="ident" id="8012510">buf</span><span class="op" id="8012513">)</span><span class="op" id="8012514">-</span><span class="num" id="8012515">1</span><span class="op" id="8012516">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012520">}</span>&nbsp;<span class="keyword" id="8012522">else</span>&nbsp;<span class="op" id="8012527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012532">rp</span><span class="op" id="8012534">.</span><span class="ident" id="8012535">n</span><span class="op" id="8012536">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012547">return</span>&nbsp;<span class="builtinfunc" id="8012554">len</span><span class="op" id="8012557">(</span><span class="ident" id="8012558">p</span><span class="op" id="8012559">)</span><span class="op" id="8012560">,</span>&nbsp;<span class="ident" id="8012562">nil</span><br>
<span class="lineno">160</span><span class="op" id="8012566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8012569">func</span>&nbsp;<span class="op" id="8012574">(</span><span class="ident" id="8012575">r</span>&nbsp;<span class="op" id="8012577">*</span><span class="ident" id="8012578">rleBuffer</span><span class="op" id="8012587">)</span>&nbsp;<span class="ident" id="8012589">ReadAt</span><span class="op" id="8012595">(</span><span class="ident" id="8012596">p</span>&nbsp;<span class="op" id="8012598">[</span><span class="op" id="8012599">]</span><span class="builtintype" id="8012600">byte</span><span class="op" id="8012604">,</span>&nbsp;<span class="ident" id="8012606">off</span>&nbsp;<span class="ident" id="8012610">int64</span><span class="op" id="8012615">)</span>&nbsp;<span class="op" id="8012617">(</span><span class="ident" id="8012618">n</span>&nbsp;<span class="builtintype" id="8012620">int</span><span class="op" id="8012623">,</span>&nbsp;<span class="ident" id="8012625">err</span>&nbsp;<span class="builtintype" id="8012629">error</span><span class="op" id="8012634">)</span>&nbsp;<span class="op" id="8012636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012639">if</span>&nbsp;<span class="builtinfunc" id="8012642">len</span><span class="op" id="8012645">(</span><span class="ident" id="8012646">p</span><span class="op" id="8012647">)</span>&nbsp;<span class="op" id="8012649">==</span>&nbsp;<span class="num" id="8012652">0</span>&nbsp;<span class="op" id="8012654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012658">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012669">skipParts</span>&nbsp;<span class="op" id="8012679">:=</span>&nbsp;<span class="ident" id="8012682">sort</span><span class="op" id="8012686">.</span><span class="ident" id="8012687">Search</span><span class="op" id="8012693">(</span><span class="builtinfunc" id="8012694">len</span><span class="op" id="8012697">(</span><span class="ident" id="8012698">r</span><span class="op" id="8012699">.</span><span class="ident" id="8012700">buf</span><span class="op" id="8012703">)</span><span class="op" id="8012704">,</span>&nbsp;<span class="keyword" id="8012706">func</span><span class="op" id="8012710">(</span><span class="ident" id="8012711">i</span>&nbsp;<span class="builtintype" id="8012713">int</span><span class="op" id="8012716">)</span>&nbsp;<span class="builtintype" id="8012718">bool</span>&nbsp;<span class="op" id="8012723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012727">part</span>&nbsp;<span class="op" id="8012732">:=</span>&nbsp;<span class="op" id="8012735">&amp;</span><span class="ident" id="8012736">r</span><span class="op" id="8012737">.</span><span class="ident" id="8012738">buf</span><span class="op" id="8012741">[</span><span class="ident" id="8012742">i</span><span class="op" id="8012743">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012747">return</span>&nbsp;<span class="ident" id="8012754">part</span><span class="op" id="8012758">.</span><span class="ident" id="8012759">off</span><span class="op" id="8012762">+</span><span class="ident" id="8012763">part</span><span class="op" id="8012767">.</span><span class="ident" id="8012768">n</span>&nbsp;<span class="op" id="8012770">&gt;</span>&nbsp;<span class="ident" id="8012772">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012777">}</span><span class="op" id="8012778">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012781">parts</span>&nbsp;<span class="op" id="8012787">:=</span>&nbsp;<span class="ident" id="8012790">r</span><span class="op" id="8012791">.</span><span class="ident" id="8012792">buf</span><span class="op" id="8012795">[</span><span class="ident" id="8012796">skipParts</span><span class="op" id="8012805">:</span><span class="op" id="8012806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012809">if</span>&nbsp;<span class="builtinfunc" id="8012812">len</span><span class="op" id="8012815">(</span><span class="ident" id="8012816">parts</span><span class="op" id="8012821">)</span>&nbsp;<span class="op" id="8012823">&gt;</span>&nbsp;<span class="num" id="8012825">0</span>&nbsp;<span class="op" id="8012827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012831">skipBytes</span>&nbsp;<span class="op" id="8012841">:=</span>&nbsp;<span class="ident" id="8012844">off</span>&nbsp;<span class="op" id="8012848">-</span>&nbsp;<span class="ident" id="8012850">parts</span><span class="op" id="8012855">[</span><span class="num" id="8012856">0</span><span class="op" id="8012857">]</span><span class="op" id="8012858">.</span><span class="ident" id="8012859">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012865">for</span>&nbsp;<span class="builtinfunc" id="8012869">len</span><span class="op" id="8012872">(</span><span class="ident" id="8012873">parts</span><span class="op" id="8012878">)</span>&nbsp;<span class="op" id="8012880">&gt;</span>&nbsp;<span class="num" id="8012882">0</span>&nbsp;<span class="op" id="8012884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012889">part</span>&nbsp;<span class="op" id="8012894">:=</span>&nbsp;<span class="ident" id="8012897">parts</span><span class="op" id="8012902">[</span><span class="num" id="8012903">0</span><span class="op" id="8012904">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012909">for</span>&nbsp;<span class="ident" id="8012913">i</span>&nbsp;<span class="op" id="8012915">:=</span>&nbsp;<span class="ident" id="8012918">skipBytes</span><span class="op" id="8012927">;</span>&nbsp;<span class="ident" id="8012929">i</span>&nbsp;<span class="op" id="8012931">&lt;</span>&nbsp;<span class="ident" id="8012933">part</span><span class="op" id="8012937">.</span><span class="ident" id="8012938">n</span><span class="op" id="8012939">;</span>&nbsp;<span class="ident" id="8012941">i</span><span class="op" id="8012942">++</span>&nbsp;<span class="op" id="8012945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012951">if</span>&nbsp;<span class="ident" id="8012954">n</span>&nbsp;<span class="op" id="8012956">==</span>&nbsp;<span class="builtinfunc" id="8012959">len</span><span class="op" id="8012962">(</span><span class="ident" id="8012963">p</span><span class="op" id="8012964">)</span>&nbsp;<span class="op" id="8012966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8012973">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8012984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8012990">p</span><span class="op" id="8012991">[</span><span class="ident" id="8012992">n</span><span class="op" id="8012993">]</span>&nbsp;<span class="op" id="8012995">=</span>&nbsp;<span class="ident" id="8012997">part</span><span class="op" id="8013001">.</span><span class="ident" id="8013002">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013008">n</span><span class="op" id="8013009">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013020">parts</span>&nbsp;<span class="op" id="8013026">=</span>&nbsp;<span class="ident" id="8013028">parts</span><span class="op" id="8013033">[</span><span class="num" id="8013034">1</span><span class="op" id="8013035">:</span><span class="op" id="8013036">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013041">skipBytes</span>&nbsp;<span class="op" id="8013051">=</span>&nbsp;<span class="num" id="8013053">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013057">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013063">if</span>&nbsp;<span class="ident" id="8013066">n</span>&nbsp;<span class="op" id="8013068">!=</span>&nbsp;<span class="builtinfunc" id="8013071">len</span><span class="op" id="8013074">(</span><span class="ident" id="8013075">p</span><span class="op" id="8013076">)</span>&nbsp;<span class="op" id="8013078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013082">err</span>&nbsp;<span class="op" id="8013086">=</span>&nbsp;<span class="ident" id="8013088">io</span><span class="op" id="8013090">.</span><span class="ident" id="8013091">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013112">return</span><br>
<span class="lineno">190</span><span class="op" id="8013119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8013122">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="8013208">func</span>&nbsp;<span class="ident" id="8013213">TestRLEBuffer</span><span class="op" id="8013226">(</span><span class="ident" id="8013227">t</span>&nbsp;<span class="op" id="8013229">*</span><span class="ident" id="8013230">testing</span><span class="op" id="8013237">.</span><span class="ident" id="8013238">T</span><span class="op" id="8013239">)</span>&nbsp;<span class="op" id="8013241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013244">b</span>&nbsp;<span class="op" id="8013246">:=</span>&nbsp;<span class="builtinfunc" id="8013249">new</span><span class="op" id="8013252">(</span><span class="ident" id="8013253">rleBuffer</span><span class="op" id="8013262">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013265">var</span>&nbsp;<span class="ident" id="8013269">all</span>&nbsp;<span class="op" id="8013273">[</span><span class="op" id="8013274">]</span><span class="builtintype" id="8013275">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013281">writes</span>&nbsp;<span class="op" id="8013288">:=</span>&nbsp;<span class="op" id="8013291">[</span><span class="op" id="8013292">]</span><span class="builtintype" id="8013293">string</span><span class="op" id="8013299">{</span><span class="string" id="8013300">&#34;abcdeee&#34;</span><span class="op" id="8013309">,</span>&nbsp;<span class="string" id="8013311">&#34;eeeeeee&#34;</span><span class="op" id="8013320">,</span>&nbsp;<span class="string" id="8013322">&#34;eeeefghaaiii&#34;</span><span class="op" id="8013336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013339">for</span>&nbsp;<span class="ident" id="8013343">_</span><span class="op" id="8013344">,</span>&nbsp;<span class="ident" id="8013346">w</span>&nbsp;<span class="op" id="8013348">:=</span>&nbsp;<span class="keyword" id="8013351">range</span>&nbsp;<span class="ident" id="8013357">writes</span>&nbsp;<span class="op" id="8013364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013368">b</span><span class="op" id="8013369">.</span><span class="ident" id="8013370">Write</span><span class="op" id="8013375">(</span><span class="op" id="8013376">[</span><span class="op" id="8013377">]</span><span class="builtintype" id="8013378">byte</span><span class="op" id="8013382">(</span><span class="ident" id="8013383">w</span><span class="op" id="8013384">)</span><span class="op" id="8013385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013389">all</span>&nbsp;<span class="op" id="8013393">=</span>&nbsp;<span class="builtinfunc" id="8013395">append</span><span class="op" id="8013401">(</span><span class="ident" id="8013402">all</span><span class="op" id="8013405">,</span>&nbsp;<span class="ident" id="8013407">w</span><span class="op" id="8013408">...</span><span class="op" id="8013411">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013417">if</span>&nbsp;<span class="builtinfunc" id="8013420">len</span><span class="op" id="8013423">(</span><span class="ident" id="8013424">b</span><span class="op" id="8013425">.</span><span class="ident" id="8013426">buf</span><span class="op" id="8013429">)</span>&nbsp;<span class="op" id="8013431">!=</span>&nbsp;<span class="num" id="8013434">10</span>&nbsp;<span class="op" id="8013437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013441">t</span><span class="op" id="8013442">.</span><span class="ident" id="8013443">Fatalf</span><span class="op" id="8013449">(</span><span class="string" id="8013450">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="8013476">,</span>&nbsp;<span class="builtinfunc" id="8013478">len</span><span class="op" id="8013481">(</span><span class="ident" id="8013482">b</span><span class="op" id="8013483">.</span><span class="ident" id="8013484">buf</span><span class="op" id="8013487">)</span><span class="op" id="8013488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013495">for</span>&nbsp;<span class="ident" id="8013499">i</span>&nbsp;<span class="op" id="8013501">:=</span>&nbsp;<span class="num" id="8013504">0</span><span class="op" id="8013505">;</span>&nbsp;<span class="ident" id="8013507">i</span>&nbsp;<span class="op" id="8013509">&lt;</span>&nbsp;<span class="builtinfunc" id="8013511">len</span><span class="op" id="8013514">(</span><span class="ident" id="8013515">all</span><span class="op" id="8013518">)</span><span class="op" id="8013519">;</span>&nbsp;<span class="ident" id="8013521">i</span><span class="op" id="8013522">++</span>&nbsp;<span class="op" id="8013525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013529">for</span>&nbsp;<span class="ident" id="8013533">j</span>&nbsp;<span class="op" id="8013535">:=</span>&nbsp;<span class="num" id="8013538">0</span><span class="op" id="8013539">;</span>&nbsp;<span class="ident" id="8013541">j</span>&nbsp;<span class="op" id="8013543">&lt;</span>&nbsp;<span class="builtinfunc" id="8013545">len</span><span class="op" id="8013548">(</span><span class="ident" id="8013549">all</span><span class="op" id="8013552">)</span><span class="op" id="8013553">-</span><span class="ident" id="8013554">i</span><span class="op" id="8013555">;</span>&nbsp;<span class="ident" id="8013557">j</span><span class="op" id="8013558">++</span>&nbsp;<span class="op" id="8013561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013566">buf</span>&nbsp;<span class="op" id="8013570">:=</span>&nbsp;<span class="builtinfunc" id="8013573">make</span><span class="op" id="8013577">(</span><span class="op" id="8013578">[</span><span class="op" id="8013579">]</span><span class="builtintype" id="8013580">byte</span><span class="op" id="8013584">,</span>&nbsp;<span class="ident" id="8013586">j</span><span class="op" id="8013587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013592">n</span><span class="op" id="8013593">,</span>&nbsp;<span class="ident" id="8013595">err</span>&nbsp;<span class="op" id="8013599">:=</span>&nbsp;<span class="ident" id="8013602">b</span><span class="op" id="8013603">.</span><span class="ident" id="8013604">ReadAt</span><span class="op" id="8013610">(</span><span class="ident" id="8013611">buf</span><span class="op" id="8013614">,</span>&nbsp;<span class="ident" id="8013616">int64</span><span class="op" id="8013621">(</span><span class="ident" id="8013622">i</span><span class="op" id="8013623">)</span><span class="op" id="8013624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013629">if</span>&nbsp;<span class="ident" id="8013632">err</span>&nbsp;<span class="op" id="8013636">!=</span>&nbsp;<span class="ident" id="8013639">nil</span>&nbsp;<span class="op" id="8013643">||</span>&nbsp;<span class="ident" id="8013646">n</span>&nbsp;<span class="op" id="8013648">!=</span>&nbsp;<span class="builtinfunc" id="8013651">len</span><span class="op" id="8013654">(</span><span class="ident" id="8013655">buf</span><span class="op" id="8013658">)</span>&nbsp;<span class="op" id="8013660">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013666">t</span><span class="op" id="8013667">.</span><span class="ident" id="8013668">Errorf</span><span class="op" id="8013674">(</span><span class="string" id="8013675">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="8013714">,</span>&nbsp;<span class="ident" id="8013716">i</span><span class="op" id="8013717">,</span>&nbsp;<span class="ident" id="8013719">j</span><span class="op" id="8013720">,</span>&nbsp;<span class="ident" id="8013722">n</span><span class="op" id="8013723">,</span>&nbsp;<span class="ident" id="8013725">err</span><span class="op" id="8013728">,</span>&nbsp;<span class="builtinfunc" id="8013730">len</span><span class="op" id="8013733">(</span><span class="ident" id="8013734">buf</span><span class="op" id="8013737">)</span><span class="op" id="8013738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8013748">if</span>&nbsp;<span class="op" id="8013751">!</span><span class="ident" id="8013752">bytes</span><span class="op" id="8013757">.</span><span class="ident" id="8013758">Equal</span><span class="op" id="8013763">(</span><span class="ident" id="8013764">buf</span><span class="op" id="8013767">,</span>&nbsp;<span class="ident" id="8013769">all</span><span class="op" id="8013772">[</span><span class="ident" id="8013773">i</span><span class="op" id="8013774">:</span><span class="ident" id="8013775">i</span><span class="op" id="8013776">+</span><span class="ident" id="8013777">j</span><span class="op" id="8013778">]</span><span class="op" id="8013779">)</span>&nbsp;<span class="op" id="8013781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013787">t</span><span class="op" id="8013788">.</span><span class="ident" id="8013789">Errorf</span><span class="op" id="8013795">(</span><span class="string" id="8013796">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8013826">,</span>&nbsp;<span class="ident" id="8013828">i</span><span class="op" id="8013829">,</span>&nbsp;<span class="ident" id="8013831">j</span><span class="op" id="8013832">,</span>&nbsp;<span class="ident" id="8013834">buf</span><span class="op" id="8013837">,</span>&nbsp;<span class="ident" id="8013839">all</span><span class="op" id="8013842">[</span><span class="ident" id="8013843">i</span><span class="op" id="8013844">:</span><span class="ident" id="8013845">i</span><span class="op" id="8013846">+</span><span class="ident" id="8013847">j</span><span class="op" id="8013848">]</span><span class="op" id="8013849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013854">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8013861">}</span><br>
<span class="lineno"></span><span class="op" id="8013863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8013866">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="8013921">type</span>&nbsp;<span class="ident" id="8013926">fakeHash32</span>&nbsp;<span class="keyword" id="8013937">struct</span>&nbsp;<span class="op" id="8013944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8013947">hash</span><span class="op" id="8013951">.</span><span class="ident" id="8013952">Hash32</span><br>
<span class="lineno"></span><span class="op" id="8013959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8013962">func</span>&nbsp;<span class="op" id="8013967">(</span><span class="ident" id="8013968">fakeHash32</span><span class="op" id="8013978">)</span>&nbsp;<span class="ident" id="8013980">Write</span><span class="op" id="8013985">(</span><span class="ident" id="8013986">p</span>&nbsp;<span class="op" id="8013988">[</span><span class="op" id="8013989">]</span><span class="builtintype" id="8013990">byte</span><span class="op" id="8013994">)</span>&nbsp;<span class="op" id="8013996">(</span><span class="builtintype" id="8013997">int</span><span class="op" id="8014000">,</span>&nbsp;<span class="builtintype" id="8014002">error</span><span class="op" id="8014007">)</span>&nbsp;<span class="op" id="8014009">{</span>&nbsp;<span class="keyword" id="8014011">return</span>&nbsp;<span class="builtinfunc" id="8014018">len</span><span class="op" id="8014021">(</span><span class="ident" id="8014022">p</span><span class="op" id="8014023">)</span><span class="op" id="8014024">,</span>&nbsp;<span class="ident" id="8014026">nil</span>&nbsp;<span class="op" id="8014030">}</span><br>
<span class="lineno">225</span><span class="keyword" id="8014032">func</span>&nbsp;<span class="op" id="8014037">(</span><span class="ident" id="8014038">fakeHash32</span><span class="op" id="8014048">)</span>&nbsp;<span class="ident" id="8014050">Sum32</span><span class="op" id="8014055">(</span><span class="op" id="8014056">)</span>&nbsp;<span class="builtintype" id="8014058">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8014079">{</span>&nbsp;<span class="keyword" id="8014081">return</span>&nbsp;<span class="num" id="8014088">0</span>&nbsp;<span class="op" id="8014090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8014093">func</span>&nbsp;<span class="ident" id="8014098">TestZip64</span><span class="op" id="8014107">(</span><span class="ident" id="8014108">t</span>&nbsp;<span class="op" id="8014110">*</span><span class="ident" id="8014111">testing</span><span class="op" id="8014118">.</span><span class="ident" id="8014119">T</span><span class="op" id="8014120">)</span>&nbsp;<span class="op" id="8014122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014125">if</span>&nbsp;<span class="ident" id="8014128">testing</span><span class="op" id="8014135">.</span><span class="ident" id="8014136">Short</span><span class="op" id="8014141">(</span><span class="op" id="8014142">)</span>&nbsp;<span class="op" id="8014144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014148">t</span><span class="op" id="8014149">.</span><span class="ident" id="8014150">Skip</span><span class="op" id="8014154">(</span><span class="string" id="8014155">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="8014176">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014182">const</span>&nbsp;<span class="ident" id="8014188">size</span>&nbsp;<span class="op" id="8014193">=</span>&nbsp;<span class="num" id="8014195">1</span>&nbsp;<span class="op" id="8014197">&lt;&lt;</span>&nbsp;<span class="num" id="8014200">32</span>&nbsp;<span class="comment" id="8014203">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014231">testZip64</span><span class="op" id="8014240">(</span><span class="ident" id="8014241">t</span><span class="op" id="8014242">,</span>&nbsp;<span class="ident" id="8014244">size</span><span class="op" id="8014248">)</span><br>
<span class="lineno"></span><span class="op" id="8014250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="8014253">func</span>&nbsp;<span class="ident" id="8014258">testZip64</span><span class="op" id="8014267">(</span><span class="ident" id="8014268">t</span>&nbsp;<span class="ident" id="8014270">testing</span><span class="op" id="8014277">.</span><span class="ident" id="8014278">TB</span><span class="op" id="8014280">,</span>&nbsp;<span class="ident" id="8014282">size</span>&nbsp;<span class="ident" id="8014287">int64</span><span class="op" id="8014292">)</span>&nbsp;<span class="op" id="8014294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014297">const</span>&nbsp;<span class="ident" id="8014303">chunkSize</span>&nbsp;<span class="op" id="8014313">=</span>&nbsp;<span class="num" id="8014315">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014321">chunks</span>&nbsp;<span class="op" id="8014328">:=</span>&nbsp;<span class="builtintype" id="8014331">int</span><span class="op" id="8014334">(</span><span class="ident" id="8014335">size</span>&nbsp;<span class="op" id="8014340">/</span>&nbsp;<span class="ident" id="8014342">chunkSize</span><span class="op" id="8014351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8014354">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014402">buf</span>&nbsp;<span class="op" id="8014406">:=</span>&nbsp;<span class="builtinfunc" id="8014409">new</span><span class="op" id="8014412">(</span><span class="ident" id="8014413">rleBuffer</span><span class="op" id="8014422">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014425">w</span>&nbsp;<span class="op" id="8014427">:=</span>&nbsp;<span class="ident" id="8014430">NewWriter</span><span class="op" id="8014439">(</span><span class="ident" id="8014440">buf</span><span class="op" id="8014443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014446">f</span><span class="op" id="8014447">,</span>&nbsp;<span class="ident" id="8014449">err</span>&nbsp;<span class="op" id="8014453">:=</span>&nbsp;<span class="ident" id="8014456">w</span><span class="op" id="8014457">.</span><span class="ident" id="8014458">CreateHeader</span><span class="op" id="8014470">(</span><span class="op" id="8014471">&amp;</span><span class="ident" id="8014472">FileHeader</span><span class="op" id="8014482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014486">Name</span><span class="op" id="8014490">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8014494">&#34;huge.txt&#34;</span><span class="op" id="8014504">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014508">Method</span><span class="op" id="8014514">:</span>&nbsp;<span class="ident" id="8014516">Store</span><span class="op" id="8014521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014524">}</span><span class="op" id="8014525">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014528">if</span>&nbsp;<span class="ident" id="8014531">err</span>&nbsp;<span class="op" id="8014535">!=</span>&nbsp;<span class="ident" id="8014538">nil</span>&nbsp;<span class="op" id="8014542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014546">t</span><span class="op" id="8014547">.</span><span class="ident" id="8014548">Fatal</span><span class="op" id="8014553">(</span><span class="ident" id="8014554">err</span><span class="op" id="8014557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014563">f</span><span class="op" id="8014564">.</span><span class="op" id="8014565">(</span><span class="op" id="8014566">*</span><span class="ident" id="8014567">fileWriter</span><span class="op" id="8014577">)</span><span class="op" id="8014578">.</span><span class="ident" id="8014579">crc32</span>&nbsp;<span class="op" id="8014585">=</span>&nbsp;<span class="ident" id="8014587">fakeHash32</span><span class="op" id="8014597">{</span><span class="op" id="8014598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014601">chunk</span>&nbsp;<span class="op" id="8014607">:=</span>&nbsp;<span class="builtinfunc" id="8014610">make</span><span class="op" id="8014614">(</span><span class="op" id="8014615">[</span><span class="op" id="8014616">]</span><span class="builtintype" id="8014617">byte</span><span class="op" id="8014621">,</span>&nbsp;<span class="ident" id="8014623">chunkSize</span><span class="op" id="8014632">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014635">for</span>&nbsp;<span class="ident" id="8014639">i</span>&nbsp;<span class="op" id="8014641">:=</span>&nbsp;<span class="keyword" id="8014644">range</span>&nbsp;<span class="ident" id="8014650">chunk</span>&nbsp;<span class="op" id="8014656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014660">chunk</span><span class="op" id="8014665">[</span><span class="ident" id="8014666">i</span><span class="op" id="8014667">]</span>&nbsp;<span class="op" id="8014669">=</span>&nbsp;<span class="string" id="8014671">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014679">for</span>&nbsp;<span class="ident" id="8014683">i</span>&nbsp;<span class="op" id="8014685">:=</span>&nbsp;<span class="num" id="8014688">0</span><span class="op" id="8014689">;</span>&nbsp;<span class="ident" id="8014691">i</span>&nbsp;<span class="op" id="8014693">&lt;</span>&nbsp;<span class="ident" id="8014695">chunks</span><span class="op" id="8014701">;</span>&nbsp;<span class="ident" id="8014703">i</span><span class="op" id="8014704">++</span>&nbsp;<span class="op" id="8014707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014711">_</span><span class="op" id="8014712">,</span>&nbsp;<span class="ident" id="8014714">err</span>&nbsp;<span class="op" id="8014718">:=</span>&nbsp;<span class="ident" id="8014721">f</span><span class="op" id="8014722">.</span><span class="ident" id="8014723">Write</span><span class="op" id="8014728">(</span><span class="ident" id="8014729">chunk</span><span class="op" id="8014734">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014738">if</span>&nbsp;<span class="ident" id="8014741">err</span>&nbsp;<span class="op" id="8014745">!=</span>&nbsp;<span class="ident" id="8014748">nil</span>&nbsp;<span class="op" id="8014752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014757">t</span><span class="op" id="8014758">.</span><span class="ident" id="8014759">Fatal</span><span class="op" id="8014764">(</span><span class="string" id="8014765">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="8014779">,</span>&nbsp;<span class="ident" id="8014781">err</span><span class="op" id="8014784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014794">end</span>&nbsp;<span class="op" id="8014798">:=</span>&nbsp;<span class="op" id="8014801">[</span><span class="op" id="8014802">]</span><span class="builtintype" id="8014803">byte</span><span class="op" id="8014807">(</span><span class="string" id="8014808">&#34;END\n&#34;</span><span class="op" id="8014815">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014818">_</span><span class="op" id="8014819">,</span>&nbsp;<span class="ident" id="8014821">err</span>&nbsp;<span class="op" id="8014825">=</span>&nbsp;<span class="ident" id="8014827">f</span><span class="op" id="8014828">.</span><span class="ident" id="8014829">Write</span><span class="op" id="8014834">(</span><span class="ident" id="8014835">end</span><span class="op" id="8014838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014841">if</span>&nbsp;<span class="ident" id="8014844">err</span>&nbsp;<span class="op" id="8014848">!=</span>&nbsp;<span class="ident" id="8014851">nil</span>&nbsp;<span class="op" id="8014855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014859">t</span><span class="op" id="8014860">.</span><span class="ident" id="8014861">Fatal</span><span class="op" id="8014866">(</span><span class="string" id="8014867">&#34;write&nbsp;end:&#34;</span><span class="op" id="8014879">,</span>&nbsp;<span class="ident" id="8014881">err</span><span class="op" id="8014884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8014890">if</span>&nbsp;<span class="ident" id="8014893">err</span>&nbsp;<span class="op" id="8014897">:=</span>&nbsp;<span class="ident" id="8014900">w</span><span class="op" id="8014901">.</span><span class="ident" id="8014902">Close</span><span class="op" id="8014907">(</span><span class="op" id="8014908">)</span><span class="op" id="8014909">;</span>&nbsp;<span class="ident" id="8014911">err</span>&nbsp;<span class="op" id="8014915">!=</span>&nbsp;<span class="ident" id="8014918">nil</span>&nbsp;<span class="op" id="8014922">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8014926">t</span><span class="op" id="8014927">.</span><span class="ident" id="8014928">Fatal</span><span class="op" id="8014933">(</span><span class="ident" id="8014934">err</span><span class="op" id="8014937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8014940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8014944">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015006">r</span><span class="op" id="8015007">,</span>&nbsp;<span class="ident" id="8015009">err</span>&nbsp;<span class="op" id="8015013">:=</span>&nbsp;<span class="ident" id="8015016">NewReader</span><span class="op" id="8015025">(</span><span class="ident" id="8015026">buf</span><span class="op" id="8015029">,</span>&nbsp;<span class="ident" id="8015031">int64</span><span class="op" id="8015036">(</span><span class="ident" id="8015037">buf</span><span class="op" id="8015040">.</span><span class="ident" id="8015041">Size</span><span class="op" id="8015045">(</span><span class="op" id="8015046">)</span><span class="op" id="8015047">)</span><span class="op" id="8015048">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015051">if</span>&nbsp;<span class="ident" id="8015054">err</span>&nbsp;<span class="op" id="8015058">!=</span>&nbsp;<span class="ident" id="8015061">nil</span>&nbsp;<span class="op" id="8015065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015069">t</span><span class="op" id="8015070">.</span><span class="ident" id="8015071">Fatal</span><span class="op" id="8015076">(</span><span class="string" id="8015077">&#34;reader:&#34;</span><span class="op" id="8015086">,</span>&nbsp;<span class="ident" id="8015088">err</span><span class="op" id="8015091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015097">f0</span>&nbsp;<span class="op" id="8015100">:=</span>&nbsp;<span class="ident" id="8015103">r</span><span class="op" id="8015104">.</span><span class="ident" id="8015105">File</span><span class="op" id="8015109">[</span><span class="num" id="8015110">0</span><span class="op" id="8015111">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015114">rc</span><span class="op" id="8015116">,</span>&nbsp;<span class="ident" id="8015118">err</span>&nbsp;<span class="op" id="8015122">:=</span>&nbsp;<span class="ident" id="8015125">f0</span><span class="op" id="8015127">.</span><span class="ident" id="8015128">Open</span><span class="op" id="8015132">(</span><span class="op" id="8015133">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015136">if</span>&nbsp;<span class="ident" id="8015139">err</span>&nbsp;<span class="op" id="8015143">!=</span>&nbsp;<span class="ident" id="8015146">nil</span>&nbsp;<span class="op" id="8015150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015154">t</span><span class="op" id="8015155">.</span><span class="ident" id="8015156">Fatal</span><span class="op" id="8015161">(</span><span class="string" id="8015162">&#34;opening:&#34;</span><span class="op" id="8015172">,</span>&nbsp;<span class="ident" id="8015174">err</span><span class="op" id="8015177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015183">rc</span><span class="op" id="8015185">.</span><span class="op" id="8015186">(</span><span class="op" id="8015187">*</span><span class="ident" id="8015188">checksumReader</span><span class="op" id="8015202">)</span><span class="op" id="8015203">.</span><span class="ident" id="8015204">hash</span>&nbsp;<span class="op" id="8015209">=</span>&nbsp;<span class="ident" id="8015211">fakeHash32</span><span class="op" id="8015221">{</span><span class="op" id="8015222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015225">for</span>&nbsp;<span class="ident" id="8015229">i</span>&nbsp;<span class="op" id="8015231">:=</span>&nbsp;<span class="num" id="8015234">0</span><span class="op" id="8015235">;</span>&nbsp;<span class="ident" id="8015237">i</span>&nbsp;<span class="op" id="8015239">&lt;</span>&nbsp;<span class="ident" id="8015241">chunks</span><span class="op" id="8015247">;</span>&nbsp;<span class="ident" id="8015249">i</span><span class="op" id="8015250">++</span>&nbsp;<span class="op" id="8015253">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015257">_</span><span class="op" id="8015258">,</span>&nbsp;<span class="ident" id="8015260">err</span>&nbsp;<span class="op" id="8015264">:=</span>&nbsp;<span class="ident" id="8015267">io</span><span class="op" id="8015269">.</span><span class="ident" id="8015270">ReadFull</span><span class="op" id="8015278">(</span><span class="ident" id="8015279">rc</span><span class="op" id="8015281">,</span>&nbsp;<span class="ident" id="8015283">chunk</span><span class="op" id="8015288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015292">if</span>&nbsp;<span class="ident" id="8015295">err</span>&nbsp;<span class="op" id="8015299">!=</span>&nbsp;<span class="ident" id="8015302">nil</span>&nbsp;<span class="op" id="8015306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015311">t</span><span class="op" id="8015312">.</span><span class="ident" id="8015313">Fatal</span><span class="op" id="8015318">(</span><span class="string" id="8015319">&#34;read:&#34;</span><span class="op" id="8015326">,</span>&nbsp;<span class="ident" id="8015328">err</span><span class="op" id="8015331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015338">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015341">gotEnd</span><span class="op" id="8015347">,</span>&nbsp;<span class="ident" id="8015349">err</span>&nbsp;<span class="op" id="8015353">:=</span>&nbsp;<span class="ident" id="8015356">ioutil</span><span class="op" id="8015362">.</span><span class="ident" id="8015363">ReadAll</span><span class="op" id="8015370">(</span><span class="ident" id="8015371">rc</span><span class="op" id="8015373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015376">if</span>&nbsp;<span class="ident" id="8015379">err</span>&nbsp;<span class="op" id="8015383">!=</span>&nbsp;<span class="ident" id="8015386">nil</span>&nbsp;<span class="op" id="8015390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015394">t</span><span class="op" id="8015395">.</span><span class="ident" id="8015396">Fatal</span><span class="op" id="8015401">(</span><span class="string" id="8015402">&#34;read&nbsp;end:&#34;</span><span class="op" id="8015413">,</span>&nbsp;<span class="ident" id="8015415">err</span><span class="op" id="8015418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015424">if</span>&nbsp;<span class="op" id="8015427">!</span><span class="ident" id="8015428">bytes</span><span class="op" id="8015433">.</span><span class="ident" id="8015434">Equal</span><span class="op" id="8015439">(</span><span class="ident" id="8015440">gotEnd</span><span class="op" id="8015446">,</span>&nbsp;<span class="ident" id="8015448">end</span><span class="op" id="8015451">)</span>&nbsp;<span class="op" id="8015453">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015457">t</span><span class="op" id="8015458">.</span><span class="ident" id="8015459">Errorf</span><span class="op" id="8015465">(</span><span class="string" id="8015466">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8015500">,</span>&nbsp;<span class="ident" id="8015502">gotEnd</span><span class="op" id="8015508">,</span>&nbsp;<span class="ident" id="8015510">end</span><span class="op" id="8015513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015519">err</span>&nbsp;<span class="op" id="8015523">=</span>&nbsp;<span class="ident" id="8015525">rc</span><span class="op" id="8015527">.</span><span class="ident" id="8015528">Close</span><span class="op" id="8015533">(</span><span class="op" id="8015534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015537">if</span>&nbsp;<span class="ident" id="8015540">err</span>&nbsp;<span class="op" id="8015544">!=</span>&nbsp;<span class="ident" id="8015547">nil</span>&nbsp;<span class="op" id="8015551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015555">t</span><span class="op" id="8015556">.</span><span class="ident" id="8015557">Fatal</span><span class="op" id="8015562">(</span><span class="string" id="8015563">&#34;closing:&#34;</span><span class="op" id="8015573">,</span>&nbsp;<span class="ident" id="8015575">err</span><span class="op" id="8015578">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015584">if</span>&nbsp;<span class="ident" id="8015587">size</span>&nbsp;<span class="op" id="8015592">==</span>&nbsp;<span class="num" id="8015595">1</span><span class="op" id="8015596">&lt;&lt;</span><span class="num" id="8015598">32</span>&nbsp;<span class="op" id="8015601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015605">if</span>&nbsp;<span class="ident" id="8015608">got</span><span class="op" id="8015611">,</span>&nbsp;<span class="ident" id="8015613">want</span>&nbsp;<span class="op" id="8015618">:=</span>&nbsp;<span class="ident" id="8015621">f0</span><span class="op" id="8015623">.</span><span class="ident" id="8015624">UncompressedSize</span><span class="op" id="8015640">,</span>&nbsp;<span class="builtintype" id="8015642">uint32</span><span class="op" id="8015648">(</span><span class="ident" id="8015649">uint32max</span><span class="op" id="8015658">)</span><span class="op" id="8015659">;</span>&nbsp;<span class="ident" id="8015661">got</span>&nbsp;<span class="op" id="8015665">!=</span>&nbsp;<span class="ident" id="8015668">want</span>&nbsp;<span class="op" id="8015673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015678">t</span><span class="op" id="8015679">.</span><span class="ident" id="8015680">Errorf</span><span class="op" id="8015686">(</span><span class="string" id="8015687">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8015717">,</span>&nbsp;<span class="ident" id="8015719">got</span><span class="op" id="8015722">,</span>&nbsp;<span class="ident" id="8015724">want</span><span class="op" id="8015728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015732">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015739">if</span>&nbsp;<span class="ident" id="8015742">got</span><span class="op" id="8015745">,</span>&nbsp;<span class="ident" id="8015747">want</span>&nbsp;<span class="op" id="8015752">:=</span>&nbsp;<span class="ident" id="8015755">f0</span><span class="op" id="8015757">.</span><span class="ident" id="8015758">UncompressedSize64</span><span class="op" id="8015776">,</span>&nbsp;<span class="ident" id="8015778">uint64</span><span class="op" id="8015784">(</span><span class="ident" id="8015785">size</span><span class="op" id="8015789">)</span><span class="op" id="8015790">+</span><span class="ident" id="8015791">uint64</span><span class="op" id="8015797">(</span><span class="builtinfunc" id="8015798">len</span><span class="op" id="8015801">(</span><span class="ident" id="8015802">end</span><span class="op" id="8015805">)</span><span class="op" id="8015806">)</span><span class="op" id="8015807">;</span>&nbsp;<span class="ident" id="8015809">got</span>&nbsp;<span class="op" id="8015813">!=</span>&nbsp;<span class="ident" id="8015816">want</span>&nbsp;<span class="op" id="8015821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015825">t</span><span class="op" id="8015826">.</span><span class="ident" id="8015827">Errorf</span><span class="op" id="8015833">(</span><span class="string" id="8015834">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8015866">,</span>&nbsp;<span class="ident" id="8015868">got</span><span class="op" id="8015871">,</span>&nbsp;<span class="ident" id="8015873">want</span><span class="op" id="8015877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8015880">}</span><br>
<span class="lineno">305</span><span class="op" id="8015882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8015885">func</span>&nbsp;<span class="ident" id="8015890">testInvalidHeader</span><span class="op" id="8015907">(</span><span class="ident" id="8015908">h</span>&nbsp;<span class="op" id="8015910">*</span><span class="ident" id="8015911">FileHeader</span><span class="op" id="8015921">,</span>&nbsp;<span class="ident" id="8015923">t</span>&nbsp;<span class="op" id="8015925">*</span><span class="ident" id="8015926">testing</span><span class="op" id="8015933">.</span><span class="ident" id="8015934">T</span><span class="op" id="8015935">)</span>&nbsp;<span class="op" id="8015937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8015940">var</span>&nbsp;<span class="ident" id="8015944">buf</span>&nbsp;<span class="ident" id="8015948">bytes</span><span class="op" id="8015953">.</span><span class="ident" id="8015954">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015962">z</span>&nbsp;<span class="op" id="8015964">:=</span>&nbsp;<span class="ident" id="8015967">NewWriter</span><span class="op" id="8015976">(</span><span class="op" id="8015977">&amp;</span><span class="ident" id="8015978">buf</span><span class="op" id="8015981">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8015985">f</span><span class="op" id="8015986">,</span>&nbsp;<span class="ident" id="8015988">err</span>&nbsp;<span class="op" id="8015992">:=</span>&nbsp;<span class="ident" id="8015995">z</span><span class="op" id="8015996">.</span><span class="ident" id="8015997">CreateHeader</span><span class="op" id="8016009">(</span><span class="ident" id="8016010">h</span><span class="op" id="8016011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016014">if</span>&nbsp;<span class="ident" id="8016017">err</span>&nbsp;<span class="op" id="8016021">!=</span>&nbsp;<span class="ident" id="8016024">nil</span>&nbsp;<span class="op" id="8016028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016032">t</span><span class="op" id="8016033">.</span><span class="ident" id="8016034">Fatalf</span><span class="op" id="8016040">(</span><span class="string" id="8016041">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8016068">,</span>&nbsp;<span class="ident" id="8016070">err</span><span class="op" id="8016073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016076">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016079">if</span>&nbsp;<span class="ident" id="8016082">_</span><span class="op" id="8016083">,</span>&nbsp;<span class="ident" id="8016085">err</span>&nbsp;<span class="op" id="8016089">:=</span>&nbsp;<span class="ident" id="8016092">f</span><span class="op" id="8016093">.</span><span class="ident" id="8016094">Write</span><span class="op" id="8016099">(</span><span class="op" id="8016100">[</span><span class="op" id="8016101">]</span><span class="builtintype" id="8016102">byte</span><span class="op" id="8016106">(</span><span class="string" id="8016107">&#34;hi&#34;</span><span class="op" id="8016111">)</span><span class="op" id="8016112">)</span><span class="op" id="8016113">;</span>&nbsp;<span class="ident" id="8016115">err</span>&nbsp;<span class="op" id="8016119">!=</span>&nbsp;<span class="ident" id="8016122">nil</span>&nbsp;<span class="op" id="8016126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016130">t</span><span class="op" id="8016131">.</span><span class="ident" id="8016132">Fatalf</span><span class="op" id="8016138">(</span><span class="string" id="8016139">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="8016166">,</span>&nbsp;<span class="ident" id="8016168">err</span><span class="op" id="8016171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016177">if</span>&nbsp;<span class="ident" id="8016180">err</span>&nbsp;<span class="op" id="8016184">:=</span>&nbsp;<span class="ident" id="8016187">z</span><span class="op" id="8016188">.</span><span class="ident" id="8016189">Close</span><span class="op" id="8016194">(</span><span class="op" id="8016195">)</span><span class="op" id="8016196">;</span>&nbsp;<span class="ident" id="8016198">err</span>&nbsp;<span class="op" id="8016202">!=</span>&nbsp;<span class="ident" id="8016205">nil</span>&nbsp;<span class="op" id="8016209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016213">t</span><span class="op" id="8016214">.</span><span class="ident" id="8016215">Fatalf</span><span class="op" id="8016221">(</span><span class="string" id="8016222">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="8016252">,</span>&nbsp;<span class="ident" id="8016254">err</span><span class="op" id="8016257">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016264">b</span>&nbsp;<span class="op" id="8016266">:=</span>&nbsp;<span class="ident" id="8016269">buf</span><span class="op" id="8016272">.</span><span class="ident" id="8016273">Bytes</span><span class="op" id="8016278">(</span><span class="op" id="8016279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016282">if</span>&nbsp;<span class="ident" id="8016285">_</span><span class="op" id="8016286">,</span>&nbsp;<span class="ident" id="8016288">err</span>&nbsp;<span class="op" id="8016292">=</span>&nbsp;<span class="ident" id="8016294">NewReader</span><span class="op" id="8016303">(</span><span class="ident" id="8016304">bytes</span><span class="op" id="8016309">.</span><span class="ident" id="8016310">NewReader</span><span class="op" id="8016319">(</span><span class="ident" id="8016320">b</span><span class="op" id="8016321">)</span><span class="op" id="8016322">,</span>&nbsp;<span class="ident" id="8016324">int64</span><span class="op" id="8016329">(</span><span class="builtinfunc" id="8016330">len</span><span class="op" id="8016333">(</span><span class="ident" id="8016334">b</span><span class="op" id="8016335">)</span><span class="op" id="8016336">)</span><span class="op" id="8016337">)</span><span class="op" id="8016338">;</span>&nbsp;<span class="ident" id="8016340">err</span>&nbsp;<span class="op" id="8016344">!=</span>&nbsp;<span class="ident" id="8016347">ErrFormat</span>&nbsp;<span class="op" id="8016357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016361">t</span><span class="op" id="8016362">.</span><span class="ident" id="8016363">Fatalf</span><span class="op" id="8016369">(</span><span class="string" id="8016370">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="8016398">,</span>&nbsp;<span class="ident" id="8016400">err</span><span class="op" id="8016403">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016406">}</span><br>
<span class="lineno"></span><span class="op" id="8016408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8016411">func</span>&nbsp;<span class="ident" id="8016416">testValidHeader</span><span class="op" id="8016431">(</span><span class="ident" id="8016432">h</span>&nbsp;<span class="op" id="8016434">*</span><span class="ident" id="8016435">FileHeader</span><span class="op" id="8016445">,</span>&nbsp;<span class="ident" id="8016447">t</span>&nbsp;<span class="op" id="8016449">*</span><span class="ident" id="8016450">testing</span><span class="op" id="8016457">.</span><span class="ident" id="8016458">T</span><span class="op" id="8016459">)</span>&nbsp;<span class="op" id="8016461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016464">var</span>&nbsp;<span class="ident" id="8016468">buf</span>&nbsp;<span class="ident" id="8016472">bytes</span><span class="op" id="8016477">.</span><span class="ident" id="8016478">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016486">z</span>&nbsp;<span class="op" id="8016488">:=</span>&nbsp;<span class="ident" id="8016491">NewWriter</span><span class="op" id="8016500">(</span><span class="op" id="8016501">&amp;</span><span class="ident" id="8016502">buf</span><span class="op" id="8016505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016509">f</span><span class="op" id="8016510">,</span>&nbsp;<span class="ident" id="8016512">err</span>&nbsp;<span class="op" id="8016516">:=</span>&nbsp;<span class="ident" id="8016519">z</span><span class="op" id="8016520">.</span><span class="ident" id="8016521">CreateHeader</span><span class="op" id="8016533">(</span><span class="ident" id="8016534">h</span><span class="op" id="8016535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016538">if</span>&nbsp;<span class="ident" id="8016541">err</span>&nbsp;<span class="op" id="8016545">!=</span>&nbsp;<span class="ident" id="8016548">nil</span>&nbsp;<span class="op" id="8016552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016556">t</span><span class="op" id="8016557">.</span><span class="ident" id="8016558">Fatalf</span><span class="op" id="8016564">(</span><span class="string" id="8016565">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8016592">,</span>&nbsp;<span class="ident" id="8016594">err</span><span class="op" id="8016597">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016603">if</span>&nbsp;<span class="ident" id="8016606">_</span><span class="op" id="8016607">,</span>&nbsp;<span class="ident" id="8016609">err</span>&nbsp;<span class="op" id="8016613">:=</span>&nbsp;<span class="ident" id="8016616">f</span><span class="op" id="8016617">.</span><span class="ident" id="8016618">Write</span><span class="op" id="8016623">(</span><span class="op" id="8016624">[</span><span class="op" id="8016625">]</span><span class="builtintype" id="8016626">byte</span><span class="op" id="8016630">(</span><span class="string" id="8016631">&#34;hi&#34;</span><span class="op" id="8016635">)</span><span class="op" id="8016636">)</span><span class="op" id="8016637">;</span>&nbsp;<span class="ident" id="8016639">err</span>&nbsp;<span class="op" id="8016643">!=</span>&nbsp;<span class="ident" id="8016646">nil</span>&nbsp;<span class="op" id="8016650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016654">t</span><span class="op" id="8016655">.</span><span class="ident" id="8016656">Fatalf</span><span class="op" id="8016662">(</span><span class="string" id="8016663">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="8016690">,</span>&nbsp;<span class="ident" id="8016692">err</span><span class="op" id="8016695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016701">if</span>&nbsp;<span class="ident" id="8016704">err</span>&nbsp;<span class="op" id="8016708">:=</span>&nbsp;<span class="ident" id="8016711">z</span><span class="op" id="8016712">.</span><span class="ident" id="8016713">Close</span><span class="op" id="8016718">(</span><span class="op" id="8016719">)</span><span class="op" id="8016720">;</span>&nbsp;<span class="ident" id="8016722">err</span>&nbsp;<span class="op" id="8016726">!=</span>&nbsp;<span class="ident" id="8016729">nil</span>&nbsp;<span class="op" id="8016733">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016737">t</span><span class="op" id="8016738">.</span><span class="ident" id="8016739">Fatalf</span><span class="op" id="8016745">(</span><span class="string" id="8016746">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="8016776">,</span>&nbsp;<span class="ident" id="8016778">err</span><span class="op" id="8016781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016788">b</span>&nbsp;<span class="op" id="8016790">:=</span>&nbsp;<span class="ident" id="8016793">buf</span><span class="op" id="8016796">.</span><span class="ident" id="8016797">Bytes</span><span class="op" id="8016802">(</span><span class="op" id="8016803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016806">if</span>&nbsp;<span class="ident" id="8016809">_</span><span class="op" id="8016810">,</span>&nbsp;<span class="ident" id="8016812">err</span>&nbsp;<span class="op" id="8016816">=</span>&nbsp;<span class="ident" id="8016818">NewReader</span><span class="op" id="8016827">(</span><span class="ident" id="8016828">bytes</span><span class="op" id="8016833">.</span><span class="ident" id="8016834">NewReader</span><span class="op" id="8016843">(</span><span class="ident" id="8016844">b</span><span class="op" id="8016845">)</span><span class="op" id="8016846">,</span>&nbsp;<span class="ident" id="8016848">int64</span><span class="op" id="8016853">(</span><span class="builtinfunc" id="8016854">len</span><span class="op" id="8016857">(</span><span class="ident" id="8016858">b</span><span class="op" id="8016859">)</span><span class="op" id="8016860">)</span><span class="op" id="8016861">)</span><span class="op" id="8016862">;</span>&nbsp;<span class="ident" id="8016864">err</span>&nbsp;<span class="op" id="8016868">!=</span>&nbsp;<span class="ident" id="8016871">nil</span>&nbsp;<span class="op" id="8016875">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8016879">t</span><span class="op" id="8016880">.</span><span class="ident" id="8016881">Fatalf</span><span class="op" id="8016887">(</span><span class="string" id="8016888">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="8016910">,</span>&nbsp;<span class="ident" id="8016912">err</span><span class="op" id="8016915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8016918">}</span><br>
<span class="lineno"></span><span class="op" id="8016920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8016923">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="8016938">func</span>&nbsp;<span class="ident" id="8016943">TestHeaderInvalidTagAndSize</span><span class="op" id="8016970">(</span><span class="ident" id="8016971">t</span>&nbsp;<span class="op" id="8016973">*</span><span class="ident" id="8016974">testing</span><span class="op" id="8016981">.</span><span class="ident" id="8016982">T</span><span class="op" id="8016983">)</span>&nbsp;<span class="op" id="8016985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8016988">const</span>&nbsp;<span class="ident" id="8016994">timeFormat</span>&nbsp;<span class="op" id="8017005">=</span>&nbsp;<span class="string" id="8017007">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017035">ts</span>&nbsp;<span class="op" id="8017038">:=</span>&nbsp;<span class="ident" id="8017041">time</span><span class="op" id="8017045">.</span><span class="ident" id="8017046">Now</span><span class="op" id="8017049">(</span><span class="op" id="8017050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017053">filename</span>&nbsp;<span class="op" id="8017062">:=</span>&nbsp;<span class="ident" id="8017065">ts</span><span class="op" id="8017067">.</span><span class="ident" id="8017068">Format</span><span class="op" id="8017074">(</span><span class="ident" id="8017075">timeFormat</span><span class="op" id="8017085">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017089">h</span>&nbsp;<span class="op" id="8017091">:=</span>&nbsp;<span class="ident" id="8017094">FileHeader</span><span class="op" id="8017104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017108">Name</span><span class="op" id="8017112">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8017116">filename</span><span class="op" id="8017124">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017128">Method</span><span class="op" id="8017134">:</span>&nbsp;<span class="ident" id="8017136">Deflate</span><span class="op" id="8017143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017147">Extra</span><span class="op" id="8017152">:</span>&nbsp;&nbsp;<span class="op" id="8017155">[</span><span class="op" id="8017156">]</span><span class="builtintype" id="8017157">byte</span><span class="op" id="8017161">(</span><span class="ident" id="8017162">ts</span><span class="op" id="8017164">.</span><span class="ident" id="8017165">Format</span><span class="op" id="8017171">(</span><span class="ident" id="8017172">time</span><span class="op" id="8017176">.</span><span class="ident" id="8017177">RFC3339Nano</span><span class="op" id="8017188">)</span><span class="op" id="8017189">)</span><span class="op" id="8017190">,</span>&nbsp;<span class="comment" id="8017192">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017219">h</span><span class="op" id="8017220">.</span><span class="ident" id="8017221">SetModTime</span><span class="op" id="8017231">(</span><span class="ident" id="8017232">ts</span><span class="op" id="8017234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017238">testInvalidHeader</span><span class="op" id="8017255">(</span><span class="op" id="8017256">&amp;</span><span class="ident" id="8017257">h</span><span class="op" id="8017258">,</span>&nbsp;<span class="ident" id="8017260">t</span><span class="op" id="8017261">)</span><br>
<span class="lineno"></span><span class="op" id="8017263">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8017266">func</span>&nbsp;<span class="ident" id="8017271">TestHeaderTooShort</span><span class="op" id="8017289">(</span><span class="ident" id="8017290">t</span>&nbsp;<span class="op" id="8017292">*</span><span class="ident" id="8017293">testing</span><span class="op" id="8017300">.</span><span class="ident" id="8017301">T</span><span class="op" id="8017302">)</span>&nbsp;<span class="op" id="8017304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017307">h</span>&nbsp;<span class="op" id="8017309">:=</span>&nbsp;<span class="ident" id="8017312">FileHeader</span><span class="op" id="8017322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017326">Name</span><span class="op" id="8017330">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8017334">&#34;foo.txt&#34;</span><span class="op" id="8017343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017347">Method</span><span class="op" id="8017353">:</span>&nbsp;<span class="ident" id="8017355">Deflate</span><span class="op" id="8017362">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017366">Extra</span><span class="op" id="8017371">:</span>&nbsp;&nbsp;<span class="op" id="8017374">[</span><span class="op" id="8017375">]</span><span class="builtintype" id="8017376">byte</span><span class="op" id="8017380">{</span><span class="ident" id="8017381">zip64ExtraId</span><span class="op" id="8017393">}</span><span class="op" id="8017394">,</span>&nbsp;<span class="comment" id="8017396">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017416">testInvalidHeader</span><span class="op" id="8017433">(</span><span class="op" id="8017434">&amp;</span><span class="ident" id="8017435">h</span><span class="op" id="8017436">,</span>&nbsp;<span class="ident" id="8017438">t</span><span class="op" id="8017439">)</span><br>
<span class="lineno"></span><span class="op" id="8017441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="8017444">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="8017500">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="8017527">func</span>&nbsp;<span class="ident" id="8017532">TestZeroLengthHeader</span><span class="op" id="8017552">(</span><span class="ident" id="8017553">t</span>&nbsp;<span class="op" id="8017555">*</span><span class="ident" id="8017556">testing</span><span class="op" id="8017563">.</span><span class="ident" id="8017564">T</span><span class="op" id="8017565">)</span>&nbsp;<span class="op" id="8017567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017570">h</span>&nbsp;<span class="op" id="8017572">:=</span>&nbsp;<span class="ident" id="8017575">FileHeader</span><span class="op" id="8017585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017589">Name</span><span class="op" id="8017593">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="8017597">&#34;extadata.txt&#34;</span><span class="op" id="8017611">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017615">Method</span><span class="op" id="8017621">:</span>&nbsp;<span class="ident" id="8017623">Deflate</span><span class="op" id="8017630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017634">Extra</span><span class="op" id="8017639">:</span>&nbsp;<span class="op" id="8017641">[</span><span class="op" id="8017642">]</span><span class="builtintype" id="8017643">byte</span><span class="op" id="8017647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8017652">85</span><span class="op" id="8017654">,</span>&nbsp;<span class="num" id="8017656">84</span><span class="op" id="8017658">,</span>&nbsp;<span class="num" id="8017660">5</span><span class="op" id="8017661">,</span>&nbsp;<span class="num" id="8017663">0</span><span class="op" id="8017664">,</span>&nbsp;<span class="num" id="8017666">3</span><span class="op" id="8017667">,</span>&nbsp;<span class="num" id="8017669">154</span><span class="op" id="8017672">,</span>&nbsp;<span class="num" id="8017674">144</span><span class="op" id="8017677">,</span>&nbsp;<span class="num" id="8017679">195</span><span class="op" id="8017682">,</span>&nbsp;<span class="num" id="8017684">77</span><span class="op" id="8017686">,</span>&nbsp;<span class="comment" id="8017688">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8017711">85</span><span class="op" id="8017713">,</span>&nbsp;<span class="num" id="8017715">120</span><span class="op" id="8017718">,</span>&nbsp;<span class="num" id="8017720">0</span><span class="op" id="8017721">,</span>&nbsp;<span class="num" id="8017723">0</span><span class="op" id="8017724">,</span>&nbsp;<span class="comment" id="8017726">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017748">}</span><span class="op" id="8017749">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8017752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017755">testValidHeader</span><span class="op" id="8017770">(</span><span class="op" id="8017771">&amp;</span><span class="ident" id="8017772">h</span><span class="op" id="8017773">,</span>&nbsp;<span class="ident" id="8017775">t</span><span class="op" id="8017776">)</span><br>
<span class="lineno"></span><span class="op" id="8017778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8017781">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="8017851">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="8017922">func</span>&nbsp;<span class="ident" id="8017927">BenchmarkZip64Test</span><span class="op" id="8017945">(</span><span class="ident" id="8017946">b</span>&nbsp;<span class="op" id="8017948">*</span><span class="ident" id="8017949">testing</span><span class="op" id="8017956">.</span><span class="ident" id="8017957">B</span><span class="op" id="8017958">)</span>&nbsp;<span class="op" id="8017960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8017963">for</span>&nbsp;<span class="ident" id="8017967">i</span>&nbsp;<span class="op" id="8017969">:=</span>&nbsp;<span class="num" id="8017972">0</span><span class="op" id="8017973">;</span>&nbsp;<span class="ident" id="8017975">i</span>&nbsp;<span class="op" id="8017977">&lt;</span>&nbsp;<span class="ident" id="8017979">b</span><span class="op" id="8017980">.</span><span class="ident" id="8017981">N</span><span class="op" id="8017982">;</span>&nbsp;<span class="ident" id="8017984">i</span><span class="op" id="8017985">++</span>&nbsp;<span class="op" id="8017988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8017992">testZip64</span><span class="op" id="8018001">(</span><span class="ident" id="8018002">b</span><span class="op" id="8018003">,</span>&nbsp;<span class="num" id="8018005">1</span><span class="op" id="8018006">&lt;&lt;</span><span class="num" id="8018008">26</span><span class="op" id="8018010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8018013">}</span><br>
<span class="lineno">395</span><span class="op" id="8018015">}</span>
</div>
</body>
</html>
