<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html" class="current">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3794364">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3794419">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3794473">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3794524">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3794578">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="3794626">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="3794678">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="3794729">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="3794802">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3794874">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="3794951">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="3795025">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="3795103">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="3795178">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="3795255">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3795316">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="3795387">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="3795464">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3795539">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="3795618">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="3795694">package</span>&nbsp;<span class="ident" id="3795702">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3795715">import</span>&nbsp;<span class="string" id="3795722">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3795730">func</span>&nbsp;<span class="ident" id="3795735">qsufsort</span><span class="op" id="3795743">(</span><span class="ident" id="3795744">data</span>&nbsp;<span class="op" id="3795749">[</span><span class="op" id="3795750">]</span><span class="builtintype" id="3795751">byte</span><span class="op" id="3795755">)</span>&nbsp;<span class="op" id="3795757">[</span><span class="op" id="3795758">]</span><span class="builtintype" id="3795759">int</span>&nbsp;<span class="op" id="3795763">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795766">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795810">sa</span>&nbsp;<span class="op" id="3795813">:=</span>&nbsp;<span class="ident" id="3795816">sortedByFirstByte</span><span class="op" id="3795833">(</span><span class="ident" id="3795834">data</span><span class="op" id="3795838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795841">if</span>&nbsp;<span class="builtinfunc" id="3795844">len</span><span class="op" id="3795847">(</span><span class="ident" id="3795848">sa</span><span class="op" id="3795850">)</span>&nbsp;<span class="op" id="3795852">&lt;</span>&nbsp;<span class="num" id="3795854">2</span>&nbsp;<span class="op" id="3795856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3795860">return</span>&nbsp;<span class="ident" id="3795867">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3795871">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795874">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3795912">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3795988">inv</span>&nbsp;<span class="op" id="3795992">:=</span>&nbsp;<span class="ident" id="3795995">initGroups</span><span class="op" id="3796005">(</span><span class="ident" id="3796006">sa</span><span class="op" id="3796008">,</span>&nbsp;<span class="ident" id="3796010">data</span><span class="op" id="3796014">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796018">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796049">sufSortable</span>&nbsp;<span class="op" id="3796061">:=</span>&nbsp;<span class="op" id="3796064">&amp;</span><span class="ident" id="3796065">suffixSortable</span><span class="op" id="3796079">{</span><span class="ident" id="3796080">sa</span><span class="op" id="3796082">:</span>&nbsp;<span class="ident" id="3796084">sa</span><span class="op" id="3796086">,</span>&nbsp;<span class="ident" id="3796088">inv</span><span class="op" id="3796091">:</span>&nbsp;<span class="ident" id="3796093">inv</span><span class="op" id="3796096">,</span>&nbsp;<span class="ident" id="3796098">h</span><span class="op" id="3796099">:</span>&nbsp;<span class="num" id="3796101">1</span><span class="op" id="3796102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796106">for</span>&nbsp;<span class="ident" id="3796110">sa</span><span class="op" id="3796112">[</span><span class="num" id="3796113">0</span><span class="op" id="3796114">]</span>&nbsp;<span class="op" id="3796116">&gt;</span>&nbsp;<span class="op" id="3796118">-</span><span class="builtinfunc" id="3796119">len</span><span class="op" id="3796122">(</span><span class="ident" id="3796123">sa</span><span class="op" id="3796125">)</span>&nbsp;<span class="op" id="3796127">{</span>&nbsp;<span class="comment" id="3796129">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3796178">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796233">pi</span>&nbsp;<span class="op" id="3796236">:=</span>&nbsp;<span class="num" id="3796239">0</span>&nbsp;<span class="comment" id="3796241">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796282">sl</span>&nbsp;<span class="op" id="3796285">:=</span>&nbsp;<span class="num" id="3796288">0</span>&nbsp;<span class="comment" id="3796290">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796333">for</span>&nbsp;<span class="ident" id="3796337">pi</span>&nbsp;<span class="op" id="3796340">&lt;</span>&nbsp;<span class="builtinfunc" id="3796342">len</span><span class="op" id="3796345">(</span><span class="ident" id="3796346">sa</span><span class="op" id="3796348">)</span>&nbsp;<span class="op" id="3796350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796355">if</span>&nbsp;<span class="ident" id="3796358">s</span>&nbsp;<span class="op" id="3796360">:=</span>&nbsp;<span class="ident" id="3796363">sa</span><span class="op" id="3796365">[</span><span class="ident" id="3796366">pi</span><span class="op" id="3796368">]</span><span class="op" id="3796369">;</span>&nbsp;<span class="ident" id="3796371">s</span>&nbsp;<span class="op" id="3796373">&lt;</span>&nbsp;<span class="num" id="3796375">0</span>&nbsp;<span class="op" id="3796377">{</span>&nbsp;<span class="comment" id="3796379">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796412">pi</span>&nbsp;<span class="op" id="3796415">-=</span>&nbsp;<span class="ident" id="3796418">s</span>&nbsp;<span class="comment" id="3796420">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796450">sl</span>&nbsp;<span class="op" id="3796453">+=</span>&nbsp;<span class="ident" id="3796456">s</span>&nbsp;<span class="comment" id="3796458">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3796489">}</span>&nbsp;<span class="keyword" id="3796491">else</span>&nbsp;<span class="op" id="3796496">{</span>&nbsp;<span class="comment" id="3796498">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796533">if</span>&nbsp;<span class="ident" id="3796536">sl</span>&nbsp;<span class="op" id="3796539">!=</span>&nbsp;<span class="num" id="3796542">0</span>&nbsp;<span class="op" id="3796544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796551">sa</span><span class="op" id="3796553">[</span><span class="ident" id="3796554">pi</span><span class="op" id="3796556">+</span><span class="ident" id="3796557">sl</span><span class="op" id="3796559">]</span>&nbsp;<span class="op" id="3796561">=</span>&nbsp;<span class="ident" id="3796563">sl</span>&nbsp;<span class="comment" id="3796566">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796606">sl</span>&nbsp;<span class="op" id="3796609">=</span>&nbsp;<span class="num" id="3796611">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3796617">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796623">pk</span>&nbsp;<span class="op" id="3796626">:=</span>&nbsp;<span class="ident" id="3796629">inv</span><span class="op" id="3796632">[</span><span class="ident" id="3796633">s</span><span class="op" id="3796634">]</span>&nbsp;<span class="op" id="3796636">+</span>&nbsp;<span class="num" id="3796638">1</span>&nbsp;<span class="comment" id="3796640">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796687">sufSortable</span><span class="op" id="3796698">.</span><span class="ident" id="3796699">sa</span>&nbsp;<span class="op" id="3796702">=</span>&nbsp;<span class="ident" id="3796704">sa</span><span class="op" id="3796706">[</span><span class="ident" id="3796707">pi</span><span class="op" id="3796709">:</span><span class="ident" id="3796710">pk</span><span class="op" id="3796712">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796718">sort</span><span class="op" id="3796722">.</span><span class="ident" id="3796723">Sort</span><span class="op" id="3796727">(</span><span class="ident" id="3796728">sufSortable</span><span class="op" id="3796739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796745">sufSortable</span><span class="op" id="3796756">.</span><span class="ident" id="3796757">updateGroups</span><span class="op" id="3796769">(</span><span class="ident" id="3796770">pi</span><span class="op" id="3796772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796778">pi</span>&nbsp;<span class="op" id="3796781">=</span>&nbsp;<span class="ident" id="3796783">pk</span>&nbsp;<span class="comment" id="3796786">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3796803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3796807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796811">if</span>&nbsp;<span class="ident" id="3796814">sl</span>&nbsp;<span class="op" id="3796817">!=</span>&nbsp;<span class="num" id="3796820">0</span>&nbsp;<span class="op" id="3796822">{</span>&nbsp;<span class="comment" id="3796824">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796868">sa</span><span class="op" id="3796870">[</span><span class="ident" id="3796871">pi</span><span class="op" id="3796873">+</span><span class="ident" id="3796874">sl</span><span class="op" id="3796876">]</span>&nbsp;<span class="op" id="3796878">=</span>&nbsp;<span class="ident" id="3796880">sl</span>&nbsp;<span class="comment" id="3796883">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3796923">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3796928">sufSortable</span><span class="op" id="3796939">.</span><span class="ident" id="3796940">h</span>&nbsp;<span class="op" id="3796942">*=</span>&nbsp;<span class="num" id="3796945">2</span>&nbsp;<span class="comment" id="3796947">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3796971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3796975">for</span>&nbsp;<span class="ident" id="3796979">i</span>&nbsp;<span class="op" id="3796981">:=</span>&nbsp;<span class="keyword" id="3796984">range</span>&nbsp;<span class="ident" id="3796990">sa</span>&nbsp;<span class="op" id="3796993">{</span>&nbsp;<span class="comment" id="3796995">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797038">sa</span><span class="op" id="3797040">[</span><span class="ident" id="3797041">inv</span><span class="op" id="3797044">[</span><span class="ident" id="3797045">i</span><span class="op" id="3797046">]</span><span class="op" id="3797047">]</span>&nbsp;<span class="op" id="3797049">=</span>&nbsp;<span class="ident" id="3797051">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797057">return</span>&nbsp;<span class="ident" id="3797064">sa</span><br>
<span class="lineno"></span><span class="op" id="3797067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="3797070">func</span>&nbsp;<span class="ident" id="3797075">sortedByFirstByte</span><span class="op" id="3797092">(</span><span class="ident" id="3797093">data</span>&nbsp;<span class="op" id="3797098">[</span><span class="op" id="3797099">]</span><span class="builtintype" id="3797100">byte</span><span class="op" id="3797104">)</span>&nbsp;<span class="op" id="3797106">[</span><span class="op" id="3797107">]</span><span class="builtintype" id="3797108">int</span>&nbsp;<span class="op" id="3797112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797115">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797137">var</span>&nbsp;<span class="ident" id="3797141">count</span>&nbsp;<span class="op" id="3797147">[</span><span class="num" id="3797148">256</span><span class="op" id="3797151">]</span><span class="builtintype" id="3797152">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797157">for</span>&nbsp;<span class="ident" id="3797161">_</span><span class="op" id="3797162">,</span>&nbsp;<span class="ident" id="3797164">b</span>&nbsp;<span class="op" id="3797166">:=</span>&nbsp;<span class="keyword" id="3797169">range</span>&nbsp;<span class="ident" id="3797175">data</span>&nbsp;<span class="op" id="3797180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797184">count</span><span class="op" id="3797189">[</span><span class="ident" id="3797190">b</span><span class="op" id="3797191">]</span><span class="op" id="3797192">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797199">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797270">sum</span>&nbsp;<span class="op" id="3797274">:=</span>&nbsp;<span class="num" id="3797277">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797280">for</span>&nbsp;<span class="ident" id="3797284">b</span>&nbsp;<span class="op" id="3797286">:=</span>&nbsp;<span class="keyword" id="3797289">range</span>&nbsp;<span class="ident" id="3797295">count</span>&nbsp;<span class="op" id="3797301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797305">count</span><span class="op" id="3797310">[</span><span class="ident" id="3797311">b</span><span class="op" id="3797312">]</span><span class="op" id="3797313">,</span>&nbsp;<span class="ident" id="3797315">sum</span>&nbsp;<span class="op" id="3797319">=</span>&nbsp;<span class="ident" id="3797321">sum</span><span class="op" id="3797324">,</span>&nbsp;<span class="ident" id="3797326">count</span><span class="op" id="3797331">[</span><span class="ident" id="3797332">b</span><span class="op" id="3797333">]</span><span class="op" id="3797334">+</span><span class="ident" id="3797335">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797343">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797412">sa</span>&nbsp;<span class="op" id="3797415">:=</span>&nbsp;<span class="builtinfunc" id="3797418">make</span><span class="op" id="3797422">(</span><span class="op" id="3797423">[</span><span class="op" id="3797424">]</span><span class="builtintype" id="3797425">int</span><span class="op" id="3797428">,</span>&nbsp;<span class="builtinfunc" id="3797430">len</span><span class="op" id="3797433">(</span><span class="ident" id="3797434">data</span><span class="op" id="3797438">)</span><span class="op" id="3797439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797442">for</span>&nbsp;<span class="ident" id="3797446">i</span><span class="op" id="3797447">,</span>&nbsp;<span class="ident" id="3797449">b</span>&nbsp;<span class="op" id="3797451">:=</span>&nbsp;<span class="keyword" id="3797454">range</span>&nbsp;<span class="ident" id="3797460">data</span>&nbsp;<span class="op" id="3797465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797469">sa</span><span class="op" id="3797471">[</span><span class="ident" id="3797472">count</span><span class="op" id="3797477">[</span><span class="ident" id="3797478">b</span><span class="op" id="3797479">]</span><span class="op" id="3797480">]</span>&nbsp;<span class="op" id="3797482">=</span>&nbsp;<span class="ident" id="3797484">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797488">count</span><span class="op" id="3797493">[</span><span class="ident" id="3797494">b</span><span class="op" id="3797495">]</span><span class="op" id="3797496">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797503">return</span>&nbsp;<span class="ident" id="3797510">sa</span><br>
<span class="lineno"></span><span class="op" id="3797513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3797516">func</span>&nbsp;<span class="ident" id="3797521">initGroups</span><span class="op" id="3797531">(</span><span class="ident" id="3797532">sa</span>&nbsp;<span class="op" id="3797535">[</span><span class="op" id="3797536">]</span><span class="builtintype" id="3797537">int</span><span class="op" id="3797540">,</span>&nbsp;<span class="ident" id="3797542">data</span>&nbsp;<span class="op" id="3797547">[</span><span class="op" id="3797548">]</span><span class="builtintype" id="3797549">byte</span><span class="op" id="3797553">)</span>&nbsp;<span class="op" id="3797555">[</span><span class="op" id="3797556">]</span><span class="builtintype" id="3797557">int</span>&nbsp;<span class="op" id="3797561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797564">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797631">inv</span>&nbsp;<span class="op" id="3797635">:=</span>&nbsp;<span class="builtinfunc" id="3797638">make</span><span class="op" id="3797642">(</span><span class="op" id="3797643">[</span><span class="op" id="3797644">]</span><span class="builtintype" id="3797645">int</span><span class="op" id="3797648">,</span>&nbsp;<span class="builtinfunc" id="3797650">len</span><span class="op" id="3797653">(</span><span class="ident" id="3797654">data</span><span class="op" id="3797658">)</span><span class="op" id="3797659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797662">prevGroup</span>&nbsp;<span class="op" id="3797672">:=</span>&nbsp;<span class="builtinfunc" id="3797675">len</span><span class="op" id="3797678">(</span><span class="ident" id="3797679">sa</span><span class="op" id="3797681">)</span>&nbsp;<span class="op" id="3797683">-</span>&nbsp;<span class="num" id="3797685">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797688">groupByte</span>&nbsp;<span class="op" id="3797698">:=</span>&nbsp;<span class="ident" id="3797701">data</span><span class="op" id="3797705">[</span><span class="ident" id="3797706">sa</span><span class="op" id="3797708">[</span><span class="ident" id="3797709">prevGroup</span><span class="op" id="3797718">]</span><span class="op" id="3797719">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797722">for</span>&nbsp;<span class="ident" id="3797726">i</span>&nbsp;<span class="op" id="3797728">:=</span>&nbsp;<span class="builtinfunc" id="3797731">len</span><span class="op" id="3797734">(</span><span class="ident" id="3797735">sa</span><span class="op" id="3797737">)</span>&nbsp;<span class="op" id="3797739">-</span>&nbsp;<span class="num" id="3797741">1</span><span class="op" id="3797742">;</span>&nbsp;<span class="ident" id="3797744">i</span>&nbsp;<span class="op" id="3797746">&gt;=</span>&nbsp;<span class="num" id="3797749">0</span><span class="op" id="3797750">;</span>&nbsp;<span class="ident" id="3797752">i</span><span class="op" id="3797753">--</span>&nbsp;<span class="op" id="3797756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797760">if</span>&nbsp;<span class="ident" id="3797763">b</span>&nbsp;<span class="op" id="3797765">:=</span>&nbsp;<span class="ident" id="3797768">data</span><span class="op" id="3797772">[</span><span class="ident" id="3797773">sa</span><span class="op" id="3797775">[</span><span class="ident" id="3797776">i</span><span class="op" id="3797777">]</span><span class="op" id="3797778">]</span><span class="op" id="3797779">;</span>&nbsp;<span class="ident" id="3797781">b</span>&nbsp;<span class="op" id="3797783">&lt;</span>&nbsp;<span class="ident" id="3797785">groupByte</span>&nbsp;<span class="op" id="3797795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797800">if</span>&nbsp;<span class="ident" id="3797803">prevGroup</span>&nbsp;<span class="op" id="3797813">==</span>&nbsp;<span class="ident" id="3797816">i</span><span class="op" id="3797817">+</span><span class="num" id="3797818">1</span>&nbsp;<span class="op" id="3797820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797826">sa</span><span class="op" id="3797828">[</span><span class="ident" id="3797829">i</span><span class="op" id="3797830">+</span><span class="num" id="3797831">1</span><span class="op" id="3797832">]</span>&nbsp;<span class="op" id="3797834">=</span>&nbsp;<span class="op" id="3797836">-</span><span class="num" id="3797837">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797842">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797847">groupByte</span>&nbsp;<span class="op" id="3797857">=</span>&nbsp;<span class="ident" id="3797859">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797864">prevGroup</span>&nbsp;<span class="op" id="3797874">=</span>&nbsp;<span class="ident" id="3797876">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797884">inv</span><span class="op" id="3797887">[</span><span class="ident" id="3797888">sa</span><span class="op" id="3797890">[</span><span class="ident" id="3797891">i</span><span class="op" id="3797892">]</span><span class="op" id="3797893">]</span>&nbsp;<span class="op" id="3797895">=</span>&nbsp;<span class="ident" id="3797897">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3797909">if</span>&nbsp;<span class="ident" id="3797912">prevGroup</span>&nbsp;<span class="op" id="3797922">==</span>&nbsp;<span class="num" id="3797925">0</span>&nbsp;<span class="op" id="3797927">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3797932">sa</span><span class="op" id="3797934">[</span><span class="num" id="3797935">0</span><span class="op" id="3797936">]</span>&nbsp;<span class="op" id="3797938">=</span>&nbsp;<span class="op" id="3797940">-</span><span class="num" id="3797941">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3797948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3797951">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3798012">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3798075">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798119">lastByte</span>&nbsp;<span class="op" id="3798128">:=</span>&nbsp;<span class="ident" id="3798131">data</span><span class="op" id="3798135">[</span><span class="builtinfunc" id="3798136">len</span><span class="op" id="3798139">(</span><span class="ident" id="3798140">data</span><span class="op" id="3798144">)</span><span class="op" id="3798145">-</span><span class="num" id="3798146">1</span><span class="op" id="3798147">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798150">s</span>&nbsp;<span class="op" id="3798152">:=</span>&nbsp;<span class="op" id="3798155">-</span><span class="num" id="3798156">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798159">for</span>&nbsp;<span class="ident" id="3798163">i</span>&nbsp;<span class="op" id="3798165">:=</span>&nbsp;<span class="keyword" id="3798168">range</span>&nbsp;<span class="ident" id="3798174">sa</span>&nbsp;<span class="op" id="3798177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798181">if</span>&nbsp;<span class="ident" id="3798184">sa</span><span class="op" id="3798186">[</span><span class="ident" id="3798187">i</span><span class="op" id="3798188">]</span>&nbsp;<span class="op" id="3798190">&gt;=</span>&nbsp;<span class="num" id="3798193">0</span>&nbsp;<span class="op" id="3798195">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798200">if</span>&nbsp;<span class="ident" id="3798203">data</span><span class="op" id="3798207">[</span><span class="ident" id="3798208">sa</span><span class="op" id="3798210">[</span><span class="ident" id="3798211">i</span><span class="op" id="3798212">]</span><span class="op" id="3798213">]</span>&nbsp;<span class="op" id="3798215">==</span>&nbsp;<span class="ident" id="3798218">lastByte</span>&nbsp;<span class="op" id="3798227">&amp;&amp;</span>&nbsp;<span class="ident" id="3798230">s</span>&nbsp;<span class="op" id="3798232">==</span>&nbsp;<span class="op" id="3798235">-</span><span class="num" id="3798236">1</span>&nbsp;<span class="op" id="3798238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798244">s</span>&nbsp;<span class="op" id="3798246">=</span>&nbsp;<span class="ident" id="3798248">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798258">if</span>&nbsp;<span class="ident" id="3798261">sa</span><span class="op" id="3798263">[</span><span class="ident" id="3798264">i</span><span class="op" id="3798265">]</span>&nbsp;<span class="op" id="3798267">==</span>&nbsp;<span class="builtinfunc" id="3798270">len</span><span class="op" id="3798273">(</span><span class="ident" id="3798274">sa</span><span class="op" id="3798276">)</span><span class="op" id="3798277">-</span><span class="num" id="3798278">1</span>&nbsp;<span class="op" id="3798280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798286">sa</span><span class="op" id="3798288">[</span><span class="ident" id="3798289">i</span><span class="op" id="3798290">]</span><span class="op" id="3798291">,</span>&nbsp;<span class="ident" id="3798293">sa</span><span class="op" id="3798295">[</span><span class="ident" id="3798296">s</span><span class="op" id="3798297">]</span>&nbsp;<span class="op" id="3798299">=</span>&nbsp;<span class="ident" id="3798301">sa</span><span class="op" id="3798303">[</span><span class="ident" id="3798304">s</span><span class="op" id="3798305">]</span><span class="op" id="3798306">,</span>&nbsp;<span class="ident" id="3798308">sa</span><span class="op" id="3798310">[</span><span class="ident" id="3798311">i</span><span class="op" id="3798312">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798318">inv</span><span class="op" id="3798321">[</span><span class="ident" id="3798322">sa</span><span class="op" id="3798324">[</span><span class="ident" id="3798325">s</span><span class="op" id="3798326">]</span><span class="op" id="3798327">]</span>&nbsp;<span class="op" id="3798329">=</span>&nbsp;<span class="ident" id="3798331">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798337">sa</span><span class="op" id="3798339">[</span><span class="ident" id="3798340">s</span><span class="op" id="3798341">]</span>&nbsp;<span class="op" id="3798343">=</span>&nbsp;<span class="op" id="3798345">-</span><span class="num" id="3798346">1</span>&nbsp;<span class="comment" id="3798348">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798391">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798404">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798410">return</span>&nbsp;<span class="ident" id="3798417">inv</span><br>
<span class="lineno"></span><span class="op" id="3798421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3798424">type</span>&nbsp;<span class="ident" id="3798429">suffixSortable</span>&nbsp;<span class="keyword" id="3798444">struct</span>&nbsp;<span class="op" id="3798451">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798454">sa</span>&nbsp;&nbsp;<span class="op" id="3798458">[</span><span class="op" id="3798459">]</span><span class="builtintype" id="3798460">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798465">inv</span>&nbsp;<span class="op" id="3798469">[</span><span class="op" id="3798470">]</span><span class="builtintype" id="3798471">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798476">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3798480">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798485">buf</span>&nbsp;<span class="op" id="3798489">[</span><span class="op" id="3798490">]</span><span class="builtintype" id="3798491">int</span>&nbsp;<span class="comment" id="3798495">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="3798519">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="3798522">func</span>&nbsp;<span class="op" id="3798527">(</span><span class="ident" id="3798528">x</span>&nbsp;<span class="op" id="3798530">*</span><span class="ident" id="3798531">suffixSortable</span><span class="op" id="3798545">)</span>&nbsp;<span class="ident" id="3798547">Len</span><span class="op" id="3798550">(</span><span class="op" id="3798551">)</span>&nbsp;<span class="builtintype" id="3798553">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798567">{</span>&nbsp;<span class="keyword" id="3798569">return</span>&nbsp;<span class="builtinfunc" id="3798576">len</span><span class="op" id="3798579">(</span><span class="ident" id="3798580">x</span><span class="op" id="3798581">.</span><span class="ident" id="3798582">sa</span><span class="op" id="3798584">)</span>&nbsp;<span class="op" id="3798586">}</span><br>
<span class="lineno"></span><span class="keyword" id="3798588">func</span>&nbsp;<span class="op" id="3798593">(</span><span class="ident" id="3798594">x</span>&nbsp;<span class="op" id="3798596">*</span><span class="ident" id="3798597">suffixSortable</span><span class="op" id="3798611">)</span>&nbsp;<span class="ident" id="3798613">Less</span><span class="op" id="3798617">(</span><span class="ident" id="3798618">i</span><span class="op" id="3798619">,</span>&nbsp;<span class="ident" id="3798621">j</span>&nbsp;<span class="builtintype" id="3798623">int</span><span class="op" id="3798626">)</span>&nbsp;<span class="builtintype" id="3798628">bool</span>&nbsp;<span class="op" id="3798633">{</span>&nbsp;<span class="keyword" id="3798635">return</span>&nbsp;<span class="ident" id="3798642">x</span><span class="op" id="3798643">.</span><span class="ident" id="3798644">inv</span><span class="op" id="3798647">[</span><span class="ident" id="3798648">x</span><span class="op" id="3798649">.</span><span class="ident" id="3798650">sa</span><span class="op" id="3798652">[</span><span class="ident" id="3798653">i</span><span class="op" id="3798654">]</span><span class="op" id="3798655">+</span><span class="ident" id="3798656">x</span><span class="op" id="3798657">.</span><span class="ident" id="3798658">h</span><span class="op" id="3798659">]</span>&nbsp;<span class="op" id="3798661">&lt;</span>&nbsp;<span class="ident" id="3798663">x</span><span class="op" id="3798664">.</span><span class="ident" id="3798665">inv</span><span class="op" id="3798668">[</span><span class="ident" id="3798669">x</span><span class="op" id="3798670">.</span><span class="ident" id="3798671">sa</span><span class="op" id="3798673">[</span><span class="ident" id="3798674">j</span><span class="op" id="3798675">]</span><span class="op" id="3798676">+</span><span class="ident" id="3798677">x</span><span class="op" id="3798678">.</span><span class="ident" id="3798679">h</span><span class="op" id="3798680">]</span>&nbsp;<span class="op" id="3798682">}</span><br>
<span class="lineno"></span><span class="keyword" id="3798684">func</span>&nbsp;<span class="op" id="3798689">(</span><span class="ident" id="3798690">x</span>&nbsp;<span class="op" id="3798692">*</span><span class="ident" id="3798693">suffixSortable</span><span class="op" id="3798707">)</span>&nbsp;<span class="ident" id="3798709">Swap</span><span class="op" id="3798713">(</span><span class="ident" id="3798714">i</span><span class="op" id="3798715">,</span>&nbsp;<span class="ident" id="3798717">j</span>&nbsp;<span class="builtintype" id="3798719">int</span><span class="op" id="3798722">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798729">{</span>&nbsp;<span class="ident" id="3798731">x</span><span class="op" id="3798732">.</span><span class="ident" id="3798733">sa</span><span class="op" id="3798735">[</span><span class="ident" id="3798736">i</span><span class="op" id="3798737">]</span><span class="op" id="3798738">,</span>&nbsp;<span class="ident" id="3798740">x</span><span class="op" id="3798741">.</span><span class="ident" id="3798742">sa</span><span class="op" id="3798744">[</span><span class="ident" id="3798745">j</span><span class="op" id="3798746">]</span>&nbsp;<span class="op" id="3798748">=</span>&nbsp;<span class="ident" id="3798750">x</span><span class="op" id="3798751">.</span><span class="ident" id="3798752">sa</span><span class="op" id="3798754">[</span><span class="ident" id="3798755">j</span><span class="op" id="3798756">]</span><span class="op" id="3798757">,</span>&nbsp;<span class="ident" id="3798759">x</span><span class="op" id="3798760">.</span><span class="ident" id="3798761">sa</span><span class="op" id="3798763">[</span><span class="ident" id="3798764">i</span><span class="op" id="3798765">]</span>&nbsp;<span class="op" id="3798767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="3798770">func</span>&nbsp;<span class="op" id="3798775">(</span><span class="ident" id="3798776">x</span>&nbsp;<span class="op" id="3798778">*</span><span class="ident" id="3798779">suffixSortable</span><span class="op" id="3798793">)</span>&nbsp;<span class="ident" id="3798795">updateGroups</span><span class="op" id="3798807">(</span><span class="ident" id="3798808">offset</span>&nbsp;<span class="builtintype" id="3798815">int</span><span class="op" id="3798818">)</span>&nbsp;<span class="op" id="3798820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798823">bounds</span>&nbsp;<span class="op" id="3798830">:=</span>&nbsp;<span class="ident" id="3798833">x</span><span class="op" id="3798834">.</span><span class="ident" id="3798835">buf</span><span class="op" id="3798838">[</span><span class="num" id="3798839">0</span><span class="op" id="3798840">:</span><span class="num" id="3798841">0</span><span class="op" id="3798842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798845">group</span>&nbsp;<span class="op" id="3798851">:=</span>&nbsp;<span class="ident" id="3798854">x</span><span class="op" id="3798855">.</span><span class="ident" id="3798856">inv</span><span class="op" id="3798859">[</span><span class="ident" id="3798860">x</span><span class="op" id="3798861">.</span><span class="ident" id="3798862">sa</span><span class="op" id="3798864">[</span><span class="num" id="3798865">0</span><span class="op" id="3798866">]</span><span class="op" id="3798867">+</span><span class="ident" id="3798868">x</span><span class="op" id="3798869">.</span><span class="ident" id="3798870">h</span><span class="op" id="3798871">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798874">for</span>&nbsp;<span class="ident" id="3798878">i</span>&nbsp;<span class="op" id="3798880">:=</span>&nbsp;<span class="num" id="3798883">1</span><span class="op" id="3798884">;</span>&nbsp;<span class="ident" id="3798886">i</span>&nbsp;<span class="op" id="3798888">&lt;</span>&nbsp;<span class="builtinfunc" id="3798890">len</span><span class="op" id="3798893">(</span><span class="ident" id="3798894">x</span><span class="op" id="3798895">.</span><span class="ident" id="3798896">sa</span><span class="op" id="3798898">)</span><span class="op" id="3798899">;</span>&nbsp;<span class="ident" id="3798901">i</span><span class="op" id="3798902">++</span>&nbsp;<span class="op" id="3798905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3798909">if</span>&nbsp;<span class="ident" id="3798912">g</span>&nbsp;<span class="op" id="3798914">:=</span>&nbsp;<span class="ident" id="3798917">x</span><span class="op" id="3798918">.</span><span class="ident" id="3798919">inv</span><span class="op" id="3798922">[</span><span class="ident" id="3798923">x</span><span class="op" id="3798924">.</span><span class="ident" id="3798925">sa</span><span class="op" id="3798927">[</span><span class="ident" id="3798928">i</span><span class="op" id="3798929">]</span><span class="op" id="3798930">+</span><span class="ident" id="3798931">x</span><span class="op" id="3798932">.</span><span class="ident" id="3798933">h</span><span class="op" id="3798934">]</span><span class="op" id="3798935">;</span>&nbsp;<span class="ident" id="3798937">g</span>&nbsp;<span class="op" id="3798939">&gt;</span>&nbsp;<span class="ident" id="3798941">group</span>&nbsp;<span class="op" id="3798947">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798952">bounds</span>&nbsp;<span class="op" id="3798959">=</span>&nbsp;<span class="builtinfunc" id="3798961">append</span><span class="op" id="3798967">(</span><span class="ident" id="3798968">bounds</span><span class="op" id="3798974">,</span>&nbsp;<span class="ident" id="3798976">i</span><span class="op" id="3798977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3798982">group</span>&nbsp;<span class="op" id="3798988">=</span>&nbsp;<span class="ident" id="3798990">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3798997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799000">bounds</span>&nbsp;<span class="op" id="3799007">=</span>&nbsp;<span class="builtinfunc" id="3799009">append</span><span class="op" id="3799015">(</span><span class="ident" id="3799016">bounds</span><span class="op" id="3799022">,</span>&nbsp;<span class="builtinfunc" id="3799024">len</span><span class="op" id="3799027">(</span><span class="ident" id="3799028">x</span><span class="op" id="3799029">.</span><span class="ident" id="3799030">sa</span><span class="op" id="3799032">)</span><span class="op" id="3799033">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799036">x</span><span class="op" id="3799037">.</span><span class="ident" id="3799038">buf</span>&nbsp;<span class="op" id="3799042">=</span>&nbsp;<span class="ident" id="3799044">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3799053">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799121">prev</span>&nbsp;<span class="op" id="3799126">:=</span>&nbsp;<span class="num" id="3799129">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799132">for</span>&nbsp;<span class="ident" id="3799136">_</span><span class="op" id="3799137">,</span>&nbsp;<span class="ident" id="3799139">b</span>&nbsp;<span class="op" id="3799141">:=</span>&nbsp;<span class="keyword" id="3799144">range</span>&nbsp;<span class="ident" id="3799150">bounds</span>&nbsp;<span class="op" id="3799157">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799161">for</span>&nbsp;<span class="ident" id="3799165">i</span>&nbsp;<span class="op" id="3799167">:=</span>&nbsp;<span class="ident" id="3799170">prev</span><span class="op" id="3799174">;</span>&nbsp;<span class="ident" id="3799176">i</span>&nbsp;<span class="op" id="3799178">&lt;</span>&nbsp;<span class="ident" id="3799180">b</span><span class="op" id="3799181">;</span>&nbsp;<span class="ident" id="3799183">i</span><span class="op" id="3799184">++</span>&nbsp;<span class="op" id="3799187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799192">x</span><span class="op" id="3799193">.</span><span class="ident" id="3799194">inv</span><span class="op" id="3799197">[</span><span class="ident" id="3799198">x</span><span class="op" id="3799199">.</span><span class="ident" id="3799200">sa</span><span class="op" id="3799202">[</span><span class="ident" id="3799203">i</span><span class="op" id="3799204">]</span><span class="op" id="3799205">]</span>&nbsp;<span class="op" id="3799207">=</span>&nbsp;<span class="ident" id="3799209">offset</span>&nbsp;<span class="op" id="3799216">+</span>&nbsp;<span class="ident" id="3799218">b</span>&nbsp;<span class="op" id="3799220">-</span>&nbsp;<span class="num" id="3799222">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3799230">if</span>&nbsp;<span class="ident" id="3799233">b</span><span class="op" id="3799234">-</span><span class="ident" id="3799235">prev</span>&nbsp;<span class="op" id="3799240">==</span>&nbsp;<span class="num" id="3799243">1</span>&nbsp;<span class="op" id="3799245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799250">x</span><span class="op" id="3799251">.</span><span class="ident" id="3799252">sa</span><span class="op" id="3799254">[</span><span class="ident" id="3799255">prev</span><span class="op" id="3799259">]</span>&nbsp;<span class="op" id="3799261">=</span>&nbsp;<span class="op" id="3799263">-</span><span class="num" id="3799264">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3799272">prev</span>&nbsp;<span class="op" id="3799277">=</span>&nbsp;<span class="ident" id="3799279">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3799282">}</span><br>
<span class="lineno"></span><span class="op" id="3799284">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
