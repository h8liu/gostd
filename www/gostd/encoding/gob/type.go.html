<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4986627">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4986682">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4986736">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4986787">package</span>&nbsp;<span class="ident" id="4986795">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4986800">import</span>&nbsp;<span class="op" id="4986807">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986810">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986822">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986832">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986839">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986845">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986856">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986864">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986879">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4986890">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4986905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4986908">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="4986990">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="4987069">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4987078">type</span>&nbsp;<span class="ident" id="4987083">userTypeInfo</span>&nbsp;<span class="keyword" id="4987096">struct</span>&nbsp;<span class="op" id="4987103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987106">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987118">reflect</span><span class="op" id="4987125">.</span><span class="ident" id="4987126">Type</span>&nbsp;<span class="comment" id="4987131">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987163">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987175">reflect</span><span class="op" id="4987182">.</span><span class="ident" id="4987183">Type</span>&nbsp;<span class="comment" id="4987188">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987229">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4987241">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987254">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987304">externalEnc</span>&nbsp;<span class="builtintype" id="4987316">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987329">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987357">externalDec</span>&nbsp;<span class="builtintype" id="4987369">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987382">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987409">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4987421">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987434">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987505">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4987517">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987530">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="4987600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4987603">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="4987628">const</span>&nbsp;<span class="op" id="4987634">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987637">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4987645">=</span>&nbsp;<span class="num" id="4987647">1</span>&nbsp;<span class="op" id="4987649">+</span>&nbsp;<span class="ident" id="4987651">iota</span>&nbsp;<span class="comment" id="4987656">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987685">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987704">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987763">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987782">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="4987836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4987839">var</span>&nbsp;<span class="op" id="4987843">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987846">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4987909">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987971">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="4987985">sync</span><span class="op" id="4987989">.</span><span class="ident" id="4987990">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4987999">userTypeCache</span>&nbsp;<span class="op" id="4988013">=</span>&nbsp;<span class="builtinfunc" id="4988015">make</span><span class="op" id="4988019">(</span><span class="keyword" id="4988020">map</span><span class="op" id="4988023">[</span><span class="ident" id="4988024">reflect</span><span class="op" id="4988031">.</span><span class="ident" id="4988032">Type</span><span class="op" id="4988036">]</span><span class="op" id="4988037">*</span><span class="ident" id="4988038">userTypeInfo</span><span class="op" id="4988050">)</span><br>
<span class="lineno"></span><span class="op" id="4988052">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4988055">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4988143">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="4988233">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="4988251">func</span>&nbsp;<span class="ident" id="4988256">validUserType</span><span class="op" id="4988269">(</span><span class="ident" id="4988270">rt</span>&nbsp;<span class="ident" id="4988273">reflect</span><span class="op" id="4988280">.</span><span class="ident" id="4988281">Type</span><span class="op" id="4988285">)</span>&nbsp;<span class="op" id="4988287">(</span><span class="ident" id="4988288">ut</span>&nbsp;<span class="op" id="4988291">*</span><span class="ident" id="4988292">userTypeInfo</span><span class="op" id="4988304">,</span>&nbsp;<span class="ident" id="4988306">err</span>&nbsp;<span class="builtintype" id="4988310">error</span><span class="op" id="4988315">)</span>&nbsp;<span class="op" id="4988317">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988320">userTypeLock</span><span class="op" id="4988332">.</span><span class="ident" id="4988333">RLock</span><span class="op" id="4988338">(</span><span class="op" id="4988339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988342">ut</span>&nbsp;<span class="op" id="4988345">=</span>&nbsp;<span class="ident" id="4988347">userTypeCache</span><span class="op" id="4988360">[</span><span class="ident" id="4988361">rt</span><span class="op" id="4988363">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988366">userTypeLock</span><span class="op" id="4988378">.</span><span class="ident" id="4988379">RUnlock</span><span class="op" id="4988386">(</span><span class="op" id="4988387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988390">if</span>&nbsp;<span class="ident" id="4988393">ut</span>&nbsp;<span class="op" id="4988396">!=</span>&nbsp;<span class="ident" id="4988399">nil</span>&nbsp;<span class="op" id="4988403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988407">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4988415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988418">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988462">userTypeLock</span><span class="op" id="4988474">.</span><span class="ident" id="4988475">Lock</span><span class="op" id="4988479">(</span><span class="op" id="4988480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988483">defer</span>&nbsp;<span class="ident" id="4988489">userTypeLock</span><span class="op" id="4988501">.</span><span class="ident" id="4988502">Unlock</span><span class="op" id="4988508">(</span><span class="op" id="4988509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988512">if</span>&nbsp;<span class="ident" id="4988515">ut</span>&nbsp;<span class="op" id="4988518">=</span>&nbsp;<span class="ident" id="4988520">userTypeCache</span><span class="op" id="4988533">[</span><span class="ident" id="4988534">rt</span><span class="op" id="4988536">]</span><span class="op" id="4988537">;</span>&nbsp;<span class="ident" id="4988539">ut</span>&nbsp;<span class="op" id="4988542">!=</span>&nbsp;<span class="ident" id="4988545">nil</span>&nbsp;<span class="op" id="4988549">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988553">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4988588">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4988596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988599">ut</span>&nbsp;<span class="op" id="4988602">=</span>&nbsp;<span class="builtinfunc" id="4988604">new</span><span class="op" id="4988607">(</span><span class="ident" id="4988608">userTypeInfo</span><span class="op" id="4988620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988623">ut</span><span class="op" id="4988625">.</span><span class="ident" id="4988626">base</span>&nbsp;<span class="op" id="4988631">=</span>&nbsp;<span class="ident" id="4988633">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988637">ut</span><span class="op" id="4988639">.</span><span class="ident" id="4988640">user</span>&nbsp;<span class="op" id="4988645">=</span>&nbsp;<span class="ident" id="4988647">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988651">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988722">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988791">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988859">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4988929">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4988979">slowpoke</span>&nbsp;<span class="op" id="4988988">:=</span>&nbsp;<span class="ident" id="4988991">ut</span><span class="op" id="4988993">.</span><span class="ident" id="4988994">base</span>&nbsp;<span class="comment" id="4988999">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989033">for</span>&nbsp;<span class="op" id="4989037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989041">pt</span>&nbsp;<span class="op" id="4989044">:=</span>&nbsp;<span class="ident" id="4989047">ut</span><span class="op" id="4989049">.</span><span class="ident" id="4989050">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989057">if</span>&nbsp;<span class="ident" id="4989060">pt</span><span class="op" id="4989062">.</span><span class="ident" id="4989063">Kind</span><span class="op" id="4989067">(</span><span class="op" id="4989068">)</span>&nbsp;<span class="op" id="4989070">!=</span>&nbsp;<span class="ident" id="4989073">reflect</span><span class="op" id="4989080">.</span><span class="ident" id="4989081">Ptr</span>&nbsp;<span class="op" id="4989085">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989090">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989102">ut</span><span class="op" id="4989104">.</span><span class="ident" id="4989105">base</span>&nbsp;<span class="op" id="4989110">=</span>&nbsp;<span class="ident" id="4989112">pt</span><span class="op" id="4989114">.</span><span class="ident" id="4989115">Elem</span><span class="op" id="4989119">(</span><span class="op" id="4989120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989124">if</span>&nbsp;<span class="ident" id="4989127">ut</span><span class="op" id="4989129">.</span><span class="ident" id="4989130">base</span>&nbsp;<span class="op" id="4989135">==</span>&nbsp;<span class="ident" id="4989138">slowpoke</span>&nbsp;<span class="op" id="4989147">{</span>&nbsp;<span class="comment" id="4989149">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989179">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989209">return</span>&nbsp;<span class="ident" id="4989216">nil</span><span class="op" id="4989219">,</span>&nbsp;<span class="ident" id="4989221">errors</span><span class="op" id="4989227">.</span><span class="ident" id="4989228">New</span><span class="op" id="4989231">(</span><span class="string" id="4989232">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4989274">+</span>&nbsp;<span class="ident" id="4989276">ut</span><span class="op" id="4989278">.</span><span class="ident" id="4989279">base</span><span class="op" id="4989283">.</span><span class="ident" id="4989284">String</span><span class="op" id="4989290">(</span><span class="op" id="4989291">)</span><span class="op" id="4989292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989300">if</span>&nbsp;<span class="ident" id="4989303">ut</span><span class="op" id="4989305">.</span><span class="ident" id="4989306">indir</span><span class="op" id="4989311">%</span><span class="num" id="4989312">2</span>&nbsp;<span class="op" id="4989314">==</span>&nbsp;<span class="num" id="4989317">0</span>&nbsp;<span class="op" id="4989319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989324">slowpoke</span>&nbsp;<span class="op" id="4989333">=</span>&nbsp;<span class="ident" id="4989335">slowpoke</span><span class="op" id="4989343">.</span><span class="ident" id="4989344">Elem</span><span class="op" id="4989348">(</span><span class="op" id="4989349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989353">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989357">ut</span><span class="op" id="4989359">.</span><span class="ident" id="4989360">indir</span><span class="op" id="4989365">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989373">if</span>&nbsp;<span class="ident" id="4989376">ok</span><span class="op" id="4989378">,</span>&nbsp;<span class="ident" id="4989380">indir</span>&nbsp;<span class="op" id="4989386">:=</span>&nbsp;<span class="ident" id="4989389">implementsInterface</span><span class="op" id="4989408">(</span><span class="ident" id="4989409">ut</span><span class="op" id="4989411">.</span><span class="ident" id="4989412">user</span><span class="op" id="4989416">,</span>&nbsp;<span class="ident" id="4989418">gobEncoderInterfaceType</span><span class="op" id="4989441">)</span><span class="op" id="4989442">;</span>&nbsp;<span class="ident" id="4989444">ok</span>&nbsp;<span class="op" id="4989447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989451">ut</span><span class="op" id="4989453">.</span><span class="ident" id="4989454">externalEnc</span><span class="op" id="4989465">,</span>&nbsp;<span class="ident" id="4989467">ut</span><span class="op" id="4989469">.</span><span class="ident" id="4989470">encIndir</span>&nbsp;<span class="op" id="4989479">=</span>&nbsp;<span class="ident" id="4989481">xGob</span><span class="op" id="4989485">,</span>&nbsp;<span class="ident" id="4989487">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989494">}</span>&nbsp;<span class="keyword" id="4989496">else</span>&nbsp;<span class="keyword" id="4989501">if</span>&nbsp;<span class="ident" id="4989504">ok</span><span class="op" id="4989506">,</span>&nbsp;<span class="ident" id="4989508">indir</span>&nbsp;<span class="op" id="4989514">:=</span>&nbsp;<span class="ident" id="4989517">implementsInterface</span><span class="op" id="4989536">(</span><span class="ident" id="4989537">ut</span><span class="op" id="4989539">.</span><span class="ident" id="4989540">user</span><span class="op" id="4989544">,</span>&nbsp;<span class="ident" id="4989546">binaryMarshalerInterfaceType</span><span class="op" id="4989574">)</span><span class="op" id="4989575">;</span>&nbsp;<span class="ident" id="4989577">ok</span>&nbsp;<span class="op" id="4989580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4989584">ut</span><span class="op" id="4989586">.</span><span class="ident" id="4989587">externalEnc</span><span class="op" id="4989598">,</span>&nbsp;<span class="ident" id="4989600">ut</span><span class="op" id="4989602">.</span><span class="ident" id="4989603">encIndir</span>&nbsp;<span class="op" id="4989612">=</span>&nbsp;<span class="ident" id="4989614">xBinary</span><span class="op" id="4989621">,</span>&nbsp;<span class="ident" id="4989623">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4989630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989634">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989718">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989782">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989872">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4989920">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4989927">if</span>&nbsp;<span class="ident" id="4989930">ok</span><span class="op" id="4989932">,</span>&nbsp;<span class="ident" id="4989934">indir</span>&nbsp;<span class="op" id="4989940">:=</span>&nbsp;<span class="ident" id="4989943">implementsInterface</span><span class="op" id="4989962">(</span><span class="ident" id="4989963">ut</span><span class="op" id="4989965">.</span><span class="ident" id="4989966">user</span><span class="op" id="4989970">,</span>&nbsp;<span class="ident" id="4989972">gobDecoderInterfaceType</span><span class="op" id="4989995">)</span><span class="op" id="4989996">;</span>&nbsp;<span class="ident" id="4989998">ok</span>&nbsp;<span class="op" id="4990001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990005">ut</span><span class="op" id="4990007">.</span><span class="ident" id="4990008">externalDec</span><span class="op" id="4990019">,</span>&nbsp;<span class="ident" id="4990021">ut</span><span class="op" id="4990023">.</span><span class="ident" id="4990024">decIndir</span>&nbsp;<span class="op" id="4990033">=</span>&nbsp;<span class="ident" id="4990035">xGob</span><span class="op" id="4990039">,</span>&nbsp;<span class="ident" id="4990041">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990048">}</span>&nbsp;<span class="keyword" id="4990050">else</span>&nbsp;<span class="keyword" id="4990055">if</span>&nbsp;<span class="ident" id="4990058">ok</span><span class="op" id="4990060">,</span>&nbsp;<span class="ident" id="4990062">indir</span>&nbsp;<span class="op" id="4990068">:=</span>&nbsp;<span class="ident" id="4990071">implementsInterface</span><span class="op" id="4990090">(</span><span class="ident" id="4990091">ut</span><span class="op" id="4990093">.</span><span class="ident" id="4990094">user</span><span class="op" id="4990098">,</span>&nbsp;<span class="ident" id="4990100">binaryUnmarshalerInterfaceType</span><span class="op" id="4990130">)</span><span class="op" id="4990131">;</span>&nbsp;<span class="ident" id="4990133">ok</span>&nbsp;<span class="op" id="4990136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990140">ut</span><span class="op" id="4990142">.</span><span class="ident" id="4990143">externalDec</span><span class="op" id="4990154">,</span>&nbsp;<span class="ident" id="4990156">ut</span><span class="op" id="4990158">.</span><span class="ident" id="4990159">decIndir</span>&nbsp;<span class="op" id="4990168">=</span>&nbsp;<span class="ident" id="4990170">xBinary</span><span class="op" id="4990177">,</span>&nbsp;<span class="ident" id="4990179">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990186">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990190">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990210">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990302">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ut.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4990350">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990357">userTypeCache</span><span class="op" id="4990370">[</span><span class="ident" id="4990371">rt</span><span class="op" id="4990373">]</span>&nbsp;<span class="op" id="4990375">=</span>&nbsp;<span class="ident" id="4990377">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4990381">return</span><br>
<span class="lineno"></span><span class="op" id="4990388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4990391">var</span>&nbsp;<span class="op" id="4990395">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990398">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990429">=</span>&nbsp;<span class="ident" id="4990431">reflect</span><span class="op" id="4990438">.</span><span class="ident" id="4990439">TypeOf</span><span class="op" id="4990445">(</span><span class="op" id="4990446">(</span><span class="op" id="4990447">*</span><span class="ident" id="4990448">GobEncoder</span><span class="op" id="4990458">)</span><span class="op" id="4990459">(</span><span class="ident" id="4990460">nil</span><span class="op" id="4990463">)</span><span class="op" id="4990464">)</span><span class="op" id="4990465">.</span><span class="ident" id="4990466">Elem</span><span class="op" id="4990470">(</span><span class="op" id="4990471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990474">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990505">=</span>&nbsp;<span class="ident" id="4990507">reflect</span><span class="op" id="4990514">.</span><span class="ident" id="4990515">TypeOf</span><span class="op" id="4990521">(</span><span class="op" id="4990522">(</span><span class="op" id="4990523">*</span><span class="ident" id="4990524">GobDecoder</span><span class="op" id="4990534">)</span><span class="op" id="4990535">(</span><span class="ident" id="4990536">nil</span><span class="op" id="4990539">)</span><span class="op" id="4990540">)</span><span class="op" id="4990541">.</span><span class="ident" id="4990542">Elem</span><span class="op" id="4990546">(</span><span class="op" id="4990547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990550">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4990581">=</span>&nbsp;<span class="ident" id="4990583">reflect</span><span class="op" id="4990590">.</span><span class="ident" id="4990591">TypeOf</span><span class="op" id="4990597">(</span><span class="op" id="4990598">(</span><span class="op" id="4990599">*</span><span class="ident" id="4990600">encoding</span><span class="op" id="4990608">.</span><span class="ident" id="4990609">BinaryMarshaler</span><span class="op" id="4990624">)</span><span class="op" id="4990625">(</span><span class="ident" id="4990626">nil</span><span class="op" id="4990629">)</span><span class="op" id="4990630">)</span><span class="op" id="4990631">.</span><span class="ident" id="4990632">Elem</span><span class="op" id="4990636">(</span><span class="op" id="4990637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990640">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="4990671">=</span>&nbsp;<span class="ident" id="4990673">reflect</span><span class="op" id="4990680">.</span><span class="ident" id="4990681">TypeOf</span><span class="op" id="4990687">(</span><span class="op" id="4990688">(</span><span class="op" id="4990689">*</span><span class="ident" id="4990690">encoding</span><span class="op" id="4990698">.</span><span class="ident" id="4990699">BinaryUnmarshaler</span><span class="op" id="4990716">)</span><span class="op" id="4990717">(</span><span class="ident" id="4990718">nil</span><span class="op" id="4990721">)</span><span class="op" id="4990722">)</span><span class="op" id="4990723">.</span><span class="ident" id="4990724">Elem</span><span class="op" id="4990728">(</span><span class="op" id="4990729">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990732">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4990763">=</span>&nbsp;<span class="ident" id="4990765">reflect</span><span class="op" id="4990772">.</span><span class="ident" id="4990773">TypeOf</span><span class="op" id="4990779">(</span><span class="op" id="4990780">(</span><span class="op" id="4990781">*</span><span class="ident" id="4990782">encoding</span><span class="op" id="4990790">.</span><span class="ident" id="4990791">TextMarshaler</span><span class="op" id="4990804">)</span><span class="op" id="4990805">(</span><span class="ident" id="4990806">nil</span><span class="op" id="4990809">)</span><span class="op" id="4990810">)</span><span class="op" id="4990811">.</span><span class="ident" id="4990812">Elem</span><span class="op" id="4990816">(</span><span class="op" id="4990817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4990820">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4990851">=</span>&nbsp;<span class="ident" id="4990853">reflect</span><span class="op" id="4990860">.</span><span class="ident" id="4990861">TypeOf</span><span class="op" id="4990867">(</span><span class="op" id="4990868">(</span><span class="op" id="4990869">*</span><span class="ident" id="4990870">encoding</span><span class="op" id="4990878">.</span><span class="ident" id="4990879">TextUnmarshaler</span><span class="op" id="4990894">)</span><span class="op" id="4990895">(</span><span class="ident" id="4990896">nil</span><span class="op" id="4990899">)</span><span class="op" id="4990900">)</span><span class="op" id="4990901">.</span><span class="ident" id="4990902">Elem</span><span class="op" id="4990906">(</span><span class="op" id="4990907">)</span><br>
<span class="lineno"></span><span class="op" id="4990909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4990912">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="4990975">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4991011">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4991080">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="4991099">func</span>&nbsp;<span class="ident" id="4991104">implementsInterface</span><span class="op" id="4991123">(</span><span class="ident" id="4991124">typ</span><span class="op" id="4991127">,</span>&nbsp;<span class="ident" id="4991129">gobEncDecType</span>&nbsp;<span class="ident" id="4991143">reflect</span><span class="op" id="4991150">.</span><span class="ident" id="4991151">Type</span><span class="op" id="4991155">)</span>&nbsp;<span class="op" id="4991157">(</span><span class="ident" id="4991158">success</span>&nbsp;<span class="builtintype" id="4991166">bool</span><span class="op" id="4991170">,</span>&nbsp;<span class="ident" id="4991172">indir</span>&nbsp;<span class="builtintype" id="4991178">int8</span><span class="op" id="4991182">)</span>&nbsp;<span class="op" id="4991184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991187">if</span>&nbsp;<span class="ident" id="4991190">typ</span>&nbsp;<span class="op" id="4991194">==</span>&nbsp;<span class="ident" id="4991197">nil</span>&nbsp;<span class="op" id="4991201">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991205">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4991216">rt</span>&nbsp;<span class="op" id="4991219">:=</span>&nbsp;<span class="ident" id="4991222">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991227">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991279">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991347">for</span>&nbsp;<span class="op" id="4991351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991355">if</span>&nbsp;<span class="ident" id="4991358">rt</span><span class="op" id="4991360">.</span><span class="ident" id="4991361">Implements</span><span class="op" id="4991371">(</span><span class="ident" id="4991372">gobEncDecType</span><span class="op" id="4991385">)</span>&nbsp;<span class="op" id="4991387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991392">return</span>&nbsp;<span class="builtintype" id="4991399">true</span><span class="op" id="4991403">,</span>&nbsp;<span class="ident" id="4991405">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991417">if</span>&nbsp;<span class="ident" id="4991420">p</span>&nbsp;<span class="op" id="4991422">:=</span>&nbsp;<span class="ident" id="4991425">rt</span><span class="op" id="4991427">;</span>&nbsp;<span class="ident" id="4991429">p</span><span class="op" id="4991430">.</span><span class="ident" id="4991431">Kind</span><span class="op" id="4991435">(</span><span class="op" id="4991436">)</span>&nbsp;<span class="op" id="4991438">==</span>&nbsp;<span class="ident" id="4991441">reflect</span><span class="op" id="4991448">.</span><span class="ident" id="4991449">Ptr</span>&nbsp;<span class="op" id="4991453">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4991458">indir</span><span class="op" id="4991463">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991469">if</span>&nbsp;<span class="ident" id="4991472">indir</span>&nbsp;<span class="op" id="4991478">&gt;</span>&nbsp;<span class="num" id="4991480">100</span>&nbsp;<span class="op" id="4991484">{</span>&nbsp;<span class="comment" id="4991486">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991523">return</span>&nbsp;<span class="builtintype" id="4991530">false</span><span class="op" id="4991535">,</span>&nbsp;<span class="num" id="4991537">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4991547">rt</span>&nbsp;<span class="op" id="4991550">=</span>&nbsp;<span class="ident" id="4991552">p</span><span class="op" id="4991553">.</span><span class="ident" id="4991554">Elem</span><span class="op" id="4991558">(</span><span class="op" id="4991559">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991564">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991579">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991589">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991675">if</span>&nbsp;<span class="ident" id="4991678">typ</span><span class="op" id="4991681">.</span><span class="ident" id="4991682">Kind</span><span class="op" id="4991686">(</span><span class="op" id="4991687">)</span>&nbsp;<span class="op" id="4991689">!=</span>&nbsp;<span class="ident" id="4991692">reflect</span><span class="op" id="4991699">.</span><span class="ident" id="4991700">Ptr</span>&nbsp;<span class="op" id="4991704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4991708">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991755">if</span>&nbsp;<span class="ident" id="4991758">reflect</span><span class="op" id="4991765">.</span><span class="ident" id="4991766">PtrTo</span><span class="op" id="4991771">(</span><span class="ident" id="4991772">typ</span><span class="op" id="4991775">)</span><span class="op" id="4991776">.</span><span class="ident" id="4991777">Implements</span><span class="op" id="4991787">(</span><span class="ident" id="4991788">gobEncDecType</span><span class="op" id="4991801">)</span>&nbsp;<span class="op" id="4991803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991808">return</span>&nbsp;<span class="builtintype" id="4991815">true</span><span class="op" id="4991819">,</span>&nbsp;<span class="op" id="4991821">-</span><span class="num" id="4991822">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991826">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4991829">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4991832">return</span>&nbsp;<span class="builtintype" id="4991839">false</span><span class="op" id="4991844">,</span>&nbsp;<span class="num" id="4991846">0</span><br>
<span class="lineno"></span><span class="op" id="4991848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4991851">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="4991938">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4991988">func</span>&nbsp;<span class="ident" id="4991993">userType</span><span class="op" id="4992001">(</span><span class="ident" id="4992002">rt</span>&nbsp;<span class="ident" id="4992005">reflect</span><span class="op" id="4992012">.</span><span class="ident" id="4992013">Type</span><span class="op" id="4992017">)</span>&nbsp;<span class="op" id="4992019">*</span><span class="ident" id="4992020">userTypeInfo</span>&nbsp;<span class="op" id="4992033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992036">ut</span><span class="op" id="4992038">,</span>&nbsp;<span class="ident" id="4992040">err</span>&nbsp;<span class="op" id="4992044">:=</span>&nbsp;<span class="ident" id="4992047">validUserType</span><span class="op" id="4992060">(</span><span class="ident" id="4992061">rt</span><span class="op" id="4992063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992066">if</span>&nbsp;<span class="ident" id="4992069">err</span>&nbsp;<span class="op" id="4992073">!=</span>&nbsp;<span class="ident" id="4992076">nil</span>&nbsp;<span class="op" id="4992080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992084">error_</span><span class="op" id="4992090">(</span><span class="ident" id="4992091">err</span><span class="op" id="4992094">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4992097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992100">return</span>&nbsp;<span class="ident" id="4992107">ut</span><br>
<span class="lineno"></span><span class="op" id="4992110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4992113">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="4992193">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="4992279">type</span>&nbsp;<span class="ident" id="4992284">typeId</span>&nbsp;<span class="builtintype" id="4992291">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4992298">var</span>&nbsp;<span class="ident" id="4992302">nextId</span>&nbsp;<span class="ident" id="4992309">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992322">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="4992364">var</span>&nbsp;<span class="ident" id="4992368">typeLock</span>&nbsp;<span class="ident" id="4992377">sync</span><span class="op" id="4992381">.</span><span class="ident" id="4992382">Mutex</span>&nbsp;<span class="comment" id="4992388">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="4992417">const</span>&nbsp;<span class="ident" id="4992423">firstUserId</span>&nbsp;<span class="op" id="4992435">=</span>&nbsp;<span class="num" id="4992437">64</span>&nbsp;&nbsp;<span class="comment" id="4992441">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4992478">type</span>&nbsp;<span class="ident" id="4992483">gobType</span>&nbsp;<span class="keyword" id="4992491">interface</span>&nbsp;<span class="op" id="4992501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992504">id</span><span class="op" id="4992506">(</span><span class="op" id="4992507">)</span>&nbsp;<span class="ident" id="4992509">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992517">setId</span><span class="op" id="4992522">(</span><span class="ident" id="4992523">id</span>&nbsp;<span class="ident" id="4992526">typeId</span><span class="op" id="4992532">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992535">name</span><span class="op" id="4992539">(</span><span class="op" id="4992540">)</span>&nbsp;<span class="builtintype" id="4992542">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4992550">string</span><span class="op" id="4992556">(</span><span class="op" id="4992557">)</span>&nbsp;<span class="builtintype" id="4992559">string</span>&nbsp;<span class="comment" id="4992566">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992601">safeString</span><span class="op" id="4992611">(</span><span class="ident" id="4992612">seen</span>&nbsp;<span class="keyword" id="4992617">map</span><span class="op" id="4992620">[</span><span class="ident" id="4992621">typeId</span><span class="op" id="4992627">]</span><span class="builtintype" id="4992628">bool</span><span class="op" id="4992632">)</span>&nbsp;<span class="builtintype" id="4992634">string</span><br>
<span class="lineno"></span><span class="op" id="4992641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="4992644">var</span>&nbsp;<span class="ident" id="4992648">types</span>&nbsp;<span class="op" id="4992654">=</span>&nbsp;<span class="builtinfunc" id="4992656">make</span><span class="op" id="4992660">(</span><span class="keyword" id="4992661">map</span><span class="op" id="4992664">[</span><span class="ident" id="4992665">reflect</span><span class="op" id="4992672">.</span><span class="ident" id="4992673">Type</span><span class="op" id="4992677">]</span><span class="ident" id="4992678">gobType</span><span class="op" id="4992685">)</span><br>
<span class="lineno"></span><span class="keyword" id="4992687">var</span>&nbsp;<span class="ident" id="4992691">idToType</span>&nbsp;<span class="op" id="4992700">=</span>&nbsp;<span class="builtinfunc" id="4992702">make</span><span class="op" id="4992706">(</span><span class="keyword" id="4992707">map</span><span class="op" id="4992710">[</span><span class="ident" id="4992711">typeId</span><span class="op" id="4992717">]</span><span class="ident" id="4992718">gobType</span><span class="op" id="4992725">)</span><br>
<span class="lineno"></span><span class="keyword" id="4992727">var</span>&nbsp;<span class="ident" id="4992731">builtinIdToType</span>&nbsp;<span class="keyword" id="4992747">map</span><span class="op" id="4992750">[</span><span class="ident" id="4992751">typeId</span><span class="op" id="4992757">]</span><span class="ident" id="4992758">gobType</span>&nbsp;<span class="comment" id="4992766">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4992815">func</span>&nbsp;<span class="ident" id="4992820">setTypeId</span><span class="op" id="4992829">(</span><span class="ident" id="4992830">typ</span>&nbsp;<span class="ident" id="4992834">gobType</span><span class="op" id="4992841">)</span>&nbsp;<span class="op" id="4992843">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4992846">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992914">if</span>&nbsp;<span class="ident" id="4992917">typ</span><span class="op" id="4992920">.</span><span class="ident" id="4992921">id</span><span class="op" id="4992923">(</span><span class="op" id="4992924">)</span>&nbsp;<span class="op" id="4992926">!=</span>&nbsp;<span class="num" id="4992929">0</span>&nbsp;<span class="op" id="4992931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4992935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4992943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992946">nextId</span><span class="op" id="4992952">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992956">typ</span><span class="op" id="4992959">.</span><span class="ident" id="4992960">setId</span><span class="op" id="4992965">(</span><span class="ident" id="4992966">nextId</span><span class="op" id="4992972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4992975">idToType</span><span class="op" id="4992983">[</span><span class="ident" id="4992984">nextId</span><span class="op" id="4992990">]</span>&nbsp;<span class="op" id="4992992">=</span>&nbsp;<span class="ident" id="4992994">typ</span><br>
<span class="lineno"></span><span class="op" id="4992998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993001">func</span>&nbsp;<span class="op" id="4993006">(</span><span class="ident" id="4993007">t</span>&nbsp;<span class="ident" id="4993009">typeId</span><span class="op" id="4993015">)</span>&nbsp;<span class="ident" id="4993017">gobType</span><span class="op" id="4993024">(</span><span class="op" id="4993025">)</span>&nbsp;<span class="ident" id="4993027">gobType</span>&nbsp;<span class="op" id="4993035">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993038">if</span>&nbsp;<span class="ident" id="4993041">t</span>&nbsp;<span class="op" id="4993043">==</span>&nbsp;<span class="num" id="4993046">0</span>&nbsp;<span class="op" id="4993048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993052">return</span>&nbsp;<span class="ident" id="4993059">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993067">return</span>&nbsp;<span class="ident" id="4993074">idToType</span><span class="op" id="4993082">[</span><span class="ident" id="4993083">t</span><span class="op" id="4993084">]</span><br>
<span class="lineno"></span><span class="op" id="4993086">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4993089">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="4993173">func</span>&nbsp;<span class="op" id="4993178">(</span><span class="ident" id="4993179">t</span>&nbsp;<span class="ident" id="4993181">typeId</span><span class="op" id="4993187">)</span>&nbsp;<span class="builtintype" id="4993189">string</span><span class="op" id="4993195">(</span><span class="op" id="4993196">)</span>&nbsp;<span class="builtintype" id="4993198">string</span>&nbsp;<span class="op" id="4993205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993208">if</span>&nbsp;<span class="ident" id="4993211">t</span><span class="op" id="4993212">.</span><span class="ident" id="4993213">gobType</span><span class="op" id="4993220">(</span><span class="op" id="4993221">)</span>&nbsp;<span class="op" id="4993223">==</span>&nbsp;<span class="ident" id="4993226">nil</span>&nbsp;<span class="op" id="4993230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993234">return</span>&nbsp;<span class="string" id="4993241">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993253">return</span>&nbsp;<span class="ident" id="4993260">t</span><span class="op" id="4993261">.</span><span class="ident" id="4993262">gobType</span><span class="op" id="4993269">(</span><span class="op" id="4993270">)</span><span class="op" id="4993271">.</span><span class="builtintype" id="4993272">string</span><span class="op" id="4993278">(</span><span class="op" id="4993279">)</span><br>
<span class="lineno"></span><span class="op" id="4993281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4993284">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="4993349">func</span>&nbsp;<span class="op" id="4993354">(</span><span class="ident" id="4993355">t</span>&nbsp;<span class="ident" id="4993357">typeId</span><span class="op" id="4993363">)</span>&nbsp;<span class="ident" id="4993365">name</span><span class="op" id="4993369">(</span><span class="op" id="4993370">)</span>&nbsp;<span class="builtintype" id="4993372">string</span>&nbsp;<span class="op" id="4993379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993382">if</span>&nbsp;<span class="ident" id="4993385">t</span><span class="op" id="4993386">.</span><span class="ident" id="4993387">gobType</span><span class="op" id="4993394">(</span><span class="op" id="4993395">)</span>&nbsp;<span class="op" id="4993397">==</span>&nbsp;<span class="ident" id="4993400">nil</span>&nbsp;<span class="op" id="4993404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993408">return</span>&nbsp;<span class="string" id="4993415">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4993424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993427">return</span>&nbsp;<span class="ident" id="4993434">t</span><span class="op" id="4993435">.</span><span class="ident" id="4993436">gobType</span><span class="op" id="4993443">(</span><span class="op" id="4993444">)</span><span class="op" id="4993445">.</span><span class="ident" id="4993446">name</span><span class="op" id="4993450">(</span><span class="op" id="4993451">)</span><br>
<span class="lineno">220</span><span class="op" id="4993453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4993456">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="4993499">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4993574">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="4993651">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4993694">type</span>&nbsp;<span class="ident" id="4993699">CommonType</span>&nbsp;<span class="keyword" id="4993710">struct</span>&nbsp;<span class="op" id="4993717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993720">Name</span>&nbsp;<span class="builtintype" id="4993725">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4993733">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4993738">typeId</span><br>
<span class="lineno"></span><span class="op" id="4993745">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="4993748">func</span>&nbsp;<span class="op" id="4993753">(</span><span class="ident" id="4993754">t</span>&nbsp;<span class="op" id="4993756">*</span><span class="ident" id="4993757">CommonType</span><span class="op" id="4993767">)</span>&nbsp;<span class="ident" id="4993769">id</span><span class="op" id="4993771">(</span><span class="op" id="4993772">)</span>&nbsp;<span class="ident" id="4993774">typeId</span>&nbsp;<span class="op" id="4993781">{</span>&nbsp;<span class="keyword" id="4993783">return</span>&nbsp;<span class="ident" id="4993790">t</span><span class="op" id="4993791">.</span><span class="ident" id="4993792">Id</span>&nbsp;<span class="op" id="4993795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993798">func</span>&nbsp;<span class="op" id="4993803">(</span><span class="ident" id="4993804">t</span>&nbsp;<span class="op" id="4993806">*</span><span class="ident" id="4993807">CommonType</span><span class="op" id="4993817">)</span>&nbsp;<span class="ident" id="4993819">setId</span><span class="op" id="4993824">(</span><span class="ident" id="4993825">id</span>&nbsp;<span class="ident" id="4993828">typeId</span><span class="op" id="4993834">)</span>&nbsp;<span class="op" id="4993836">{</span>&nbsp;<span class="ident" id="4993838">t</span><span class="op" id="4993839">.</span><span class="ident" id="4993840">Id</span>&nbsp;<span class="op" id="4993843">=</span>&nbsp;<span class="ident" id="4993845">id</span>&nbsp;<span class="op" id="4993848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4993851">func</span>&nbsp;<span class="op" id="4993856">(</span><span class="ident" id="4993857">t</span>&nbsp;<span class="op" id="4993859">*</span><span class="ident" id="4993860">CommonType</span><span class="op" id="4993870">)</span>&nbsp;<span class="builtintype" id="4993872">string</span><span class="op" id="4993878">(</span><span class="op" id="4993879">)</span>&nbsp;<span class="builtintype" id="4993881">string</span>&nbsp;<span class="op" id="4993888">{</span>&nbsp;<span class="keyword" id="4993890">return</span>&nbsp;<span class="ident" id="4993897">t</span><span class="op" id="4993898">.</span><span class="ident" id="4993899">Name</span>&nbsp;<span class="op" id="4993904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4993907">func</span>&nbsp;<span class="op" id="4993912">(</span><span class="ident" id="4993913">t</span>&nbsp;<span class="op" id="4993915">*</span><span class="ident" id="4993916">CommonType</span><span class="op" id="4993926">)</span>&nbsp;<span class="ident" id="4993928">safeString</span><span class="op" id="4993938">(</span><span class="ident" id="4993939">seen</span>&nbsp;<span class="keyword" id="4993944">map</span><span class="op" id="4993947">[</span><span class="ident" id="4993948">typeId</span><span class="op" id="4993954">]</span><span class="builtintype" id="4993955">bool</span><span class="op" id="4993959">)</span>&nbsp;<span class="builtintype" id="4993961">string</span>&nbsp;<span class="op" id="4993968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4993971">return</span>&nbsp;<span class="ident" id="4993978">t</span><span class="op" id="4993979">.</span><span class="ident" id="4993980">Name</span><br>
<span class="lineno"></span><span class="op" id="4993985">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4993988">func</span>&nbsp;<span class="op" id="4993993">(</span><span class="ident" id="4993994">t</span>&nbsp;<span class="op" id="4993996">*</span><span class="ident" id="4993997">CommonType</span><span class="op" id="4994007">)</span>&nbsp;<span class="ident" id="4994009">name</span><span class="op" id="4994013">(</span><span class="op" id="4994014">)</span>&nbsp;<span class="builtintype" id="4994016">string</span>&nbsp;<span class="op" id="4994023">{</span>&nbsp;<span class="keyword" id="4994025">return</span>&nbsp;<span class="ident" id="4994032">t</span><span class="op" id="4994033">.</span><span class="ident" id="4994034">Name</span>&nbsp;<span class="op" id="4994039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4994042">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="4994079">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4994157">var</span>&nbsp;<span class="op" id="4994161">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4994164">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4994216">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4994270">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994321">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994332">=</span>&nbsp;<span class="ident" id="4994334">bootstrapType</span><span class="op" id="4994347">(</span><span class="string" id="4994348">&#34;bool&#34;</span><span class="op" id="4994354">,</span>&nbsp;<span class="op" id="4994356">(</span><span class="op" id="4994357">*</span><span class="builtintype" id="4994358">bool</span><span class="op" id="4994362">)</span><span class="op" id="4994363">(</span><span class="ident" id="4994364">nil</span><span class="op" id="4994367">)</span><span class="op" id="4994368">,</span>&nbsp;<span class="num" id="4994370">1</span><span class="op" id="4994371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994374">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994385">=</span>&nbsp;<span class="ident" id="4994387">bootstrapType</span><span class="op" id="4994400">(</span><span class="string" id="4994401">&#34;int&#34;</span><span class="op" id="4994406">,</span>&nbsp;<span class="op" id="4994408">(</span><span class="op" id="4994409">*</span><span class="builtintype" id="4994410">int</span><span class="op" id="4994413">)</span><span class="op" id="4994414">(</span><span class="ident" id="4994415">nil</span><span class="op" id="4994418">)</span><span class="op" id="4994419">,</span>&nbsp;<span class="num" id="4994421">2</span><span class="op" id="4994422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994425">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994436">=</span>&nbsp;<span class="ident" id="4994438">bootstrapType</span><span class="op" id="4994451">(</span><span class="string" id="4994452">&#34;uint&#34;</span><span class="op" id="4994458">,</span>&nbsp;<span class="op" id="4994460">(</span><span class="op" id="4994461">*</span><span class="builtintype" id="4994462">uint</span><span class="op" id="4994466">)</span><span class="op" id="4994467">(</span><span class="ident" id="4994468">nil</span><span class="op" id="4994471">)</span><span class="op" id="4994472">,</span>&nbsp;<span class="num" id="4994474">3</span><span class="op" id="4994475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994478">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994489">=</span>&nbsp;<span class="ident" id="4994491">bootstrapType</span><span class="op" id="4994504">(</span><span class="string" id="4994505">&#34;float&#34;</span><span class="op" id="4994512">,</span>&nbsp;<span class="op" id="4994514">(</span><span class="op" id="4994515">*</span><span class="builtintype" id="4994516">float64</span><span class="op" id="4994523">)</span><span class="op" id="4994524">(</span><span class="ident" id="4994525">nil</span><span class="op" id="4994528">)</span><span class="op" id="4994529">,</span>&nbsp;<span class="num" id="4994531">4</span><span class="op" id="4994532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994535">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994546">=</span>&nbsp;<span class="ident" id="4994548">bootstrapType</span><span class="op" id="4994561">(</span><span class="string" id="4994562">&#34;bytes&#34;</span><span class="op" id="4994569">,</span>&nbsp;<span class="op" id="4994571">(</span><span class="op" id="4994572">*</span><span class="op" id="4994573">[</span><span class="op" id="4994574">]</span><span class="builtintype" id="4994575">byte</span><span class="op" id="4994579">)</span><span class="op" id="4994580">(</span><span class="ident" id="4994581">nil</span><span class="op" id="4994584">)</span><span class="op" id="4994585">,</span>&nbsp;<span class="num" id="4994587">5</span><span class="op" id="4994588">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994591">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4994602">=</span>&nbsp;<span class="ident" id="4994604">bootstrapType</span><span class="op" id="4994617">(</span><span class="string" id="4994618">&#34;string&#34;</span><span class="op" id="4994626">,</span>&nbsp;<span class="op" id="4994628">(</span><span class="op" id="4994629">*</span><span class="builtintype" id="4994630">string</span><span class="op" id="4994636">)</span><span class="op" id="4994637">(</span><span class="ident" id="4994638">nil</span><span class="op" id="4994641">)</span><span class="op" id="4994642">,</span>&nbsp;<span class="num" id="4994644">6</span><span class="op" id="4994645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994648">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4994659">=</span>&nbsp;<span class="ident" id="4994661">bootstrapType</span><span class="op" id="4994674">(</span><span class="string" id="4994675">&#34;complex&#34;</span><span class="op" id="4994684">,</span>&nbsp;<span class="op" id="4994686">(</span><span class="op" id="4994687">*</span><span class="builtintype" id="4994688">complex128</span><span class="op" id="4994698">)</span><span class="op" id="4994699">(</span><span class="ident" id="4994700">nil</span><span class="op" id="4994703">)</span><span class="op" id="4994704">,</span>&nbsp;<span class="num" id="4994706">7</span><span class="op" id="4994707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994710">tInterface</span>&nbsp;<span class="op" id="4994721">=</span>&nbsp;<span class="ident" id="4994723">bootstrapType</span><span class="op" id="4994736">(</span><span class="string" id="4994737">&#34;interface&#34;</span><span class="op" id="4994748">,</span>&nbsp;<span class="op" id="4994750">(</span><span class="op" id="4994751">*</span><span class="keyword" id="4994752">interface</span><span class="op" id="4994761">{</span><span class="op" id="4994762">}</span><span class="op" id="4994763">)</span><span class="op" id="4994764">(</span><span class="ident" id="4994765">nil</span><span class="op" id="4994768">)</span><span class="op" id="4994769">,</span>&nbsp;<span class="num" id="4994771">8</span><span class="op" id="4994772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4994775">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994821">tReserved7</span>&nbsp;<span class="op" id="4994832">=</span>&nbsp;<span class="ident" id="4994834">bootstrapType</span><span class="op" id="4994847">(</span><span class="string" id="4994848">&#34;_reserved1&#34;</span><span class="op" id="4994860">,</span>&nbsp;<span class="op" id="4994862">(</span><span class="op" id="4994863">*</span><span class="keyword" id="4994864">struct</span><span class="op" id="4994870">{</span>&nbsp;<span class="ident" id="4994872">r7</span>&nbsp;<span class="builtintype" id="4994875">int</span>&nbsp;<span class="op" id="4994879">}</span><span class="op" id="4994880">)</span><span class="op" id="4994881">(</span><span class="ident" id="4994882">nil</span><span class="op" id="4994885">)</span><span class="op" id="4994886">,</span>&nbsp;<span class="num" id="4994888">9</span><span class="op" id="4994889">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994892">tReserved6</span>&nbsp;<span class="op" id="4994903">=</span>&nbsp;<span class="ident" id="4994905">bootstrapType</span><span class="op" id="4994918">(</span><span class="string" id="4994919">&#34;_reserved1&#34;</span><span class="op" id="4994931">,</span>&nbsp;<span class="op" id="4994933">(</span><span class="op" id="4994934">*</span><span class="keyword" id="4994935">struct</span><span class="op" id="4994941">{</span>&nbsp;<span class="ident" id="4994943">r6</span>&nbsp;<span class="builtintype" id="4994946">int</span>&nbsp;<span class="op" id="4994950">}</span><span class="op" id="4994951">)</span><span class="op" id="4994952">(</span><span class="ident" id="4994953">nil</span><span class="op" id="4994956">)</span><span class="op" id="4994957">,</span>&nbsp;<span class="num" id="4994959">10</span><span class="op" id="4994961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4994964">tReserved5</span>&nbsp;<span class="op" id="4994975">=</span>&nbsp;<span class="ident" id="4994977">bootstrapType</span><span class="op" id="4994990">(</span><span class="string" id="4994991">&#34;_reserved1&#34;</span><span class="op" id="4995003">,</span>&nbsp;<span class="op" id="4995005">(</span><span class="op" id="4995006">*</span><span class="keyword" id="4995007">struct</span><span class="op" id="4995013">{</span>&nbsp;<span class="ident" id="4995015">r5</span>&nbsp;<span class="builtintype" id="4995018">int</span>&nbsp;<span class="op" id="4995022">}</span><span class="op" id="4995023">)</span><span class="op" id="4995024">(</span><span class="ident" id="4995025">nil</span><span class="op" id="4995028">)</span><span class="op" id="4995029">,</span>&nbsp;<span class="num" id="4995031">11</span><span class="op" id="4995033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995036">tReserved4</span>&nbsp;<span class="op" id="4995047">=</span>&nbsp;<span class="ident" id="4995049">bootstrapType</span><span class="op" id="4995062">(</span><span class="string" id="4995063">&#34;_reserved1&#34;</span><span class="op" id="4995075">,</span>&nbsp;<span class="op" id="4995077">(</span><span class="op" id="4995078">*</span><span class="keyword" id="4995079">struct</span><span class="op" id="4995085">{</span>&nbsp;<span class="ident" id="4995087">r4</span>&nbsp;<span class="builtintype" id="4995090">int</span>&nbsp;<span class="op" id="4995094">}</span><span class="op" id="4995095">)</span><span class="op" id="4995096">(</span><span class="ident" id="4995097">nil</span><span class="op" id="4995100">)</span><span class="op" id="4995101">,</span>&nbsp;<span class="num" id="4995103">12</span><span class="op" id="4995105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995108">tReserved3</span>&nbsp;<span class="op" id="4995119">=</span>&nbsp;<span class="ident" id="4995121">bootstrapType</span><span class="op" id="4995134">(</span><span class="string" id="4995135">&#34;_reserved1&#34;</span><span class="op" id="4995147">,</span>&nbsp;<span class="op" id="4995149">(</span><span class="op" id="4995150">*</span><span class="keyword" id="4995151">struct</span><span class="op" id="4995157">{</span>&nbsp;<span class="ident" id="4995159">r3</span>&nbsp;<span class="builtintype" id="4995162">int</span>&nbsp;<span class="op" id="4995166">}</span><span class="op" id="4995167">)</span><span class="op" id="4995168">(</span><span class="ident" id="4995169">nil</span><span class="op" id="4995172">)</span><span class="op" id="4995173">,</span>&nbsp;<span class="num" id="4995175">13</span><span class="op" id="4995177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995180">tReserved2</span>&nbsp;<span class="op" id="4995191">=</span>&nbsp;<span class="ident" id="4995193">bootstrapType</span><span class="op" id="4995206">(</span><span class="string" id="4995207">&#34;_reserved1&#34;</span><span class="op" id="4995219">,</span>&nbsp;<span class="op" id="4995221">(</span><span class="op" id="4995222">*</span><span class="keyword" id="4995223">struct</span><span class="op" id="4995229">{</span>&nbsp;<span class="ident" id="4995231">r2</span>&nbsp;<span class="builtintype" id="4995234">int</span>&nbsp;<span class="op" id="4995238">}</span><span class="op" id="4995239">)</span><span class="op" id="4995240">(</span><span class="ident" id="4995241">nil</span><span class="op" id="4995244">)</span><span class="op" id="4995245">,</span>&nbsp;<span class="num" id="4995247">14</span><span class="op" id="4995249">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995252">tReserved1</span>&nbsp;<span class="op" id="4995263">=</span>&nbsp;<span class="ident" id="4995265">bootstrapType</span><span class="op" id="4995278">(</span><span class="string" id="4995279">&#34;_reserved1&#34;</span><span class="op" id="4995291">,</span>&nbsp;<span class="op" id="4995293">(</span><span class="op" id="4995294">*</span><span class="keyword" id="4995295">struct</span><span class="op" id="4995301">{</span>&nbsp;<span class="ident" id="4995303">r1</span>&nbsp;<span class="builtintype" id="4995306">int</span>&nbsp;<span class="op" id="4995310">}</span><span class="op" id="4995311">)</span><span class="op" id="4995312">(</span><span class="ident" id="4995313">nil</span><span class="op" id="4995316">)</span><span class="op" id="4995317">,</span>&nbsp;<span class="num" id="4995319">15</span><span class="op" id="4995321">)</span><br>
<span class="lineno"></span><span class="op" id="4995323">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4995326">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="4995375">var</span>&nbsp;<span class="ident" id="4995379">tWireType</span>&nbsp;<span class="op" id="4995389">=</span>&nbsp;<span class="ident" id="4995391">mustGetTypeInfo</span><span class="op" id="4995406">(</span><span class="ident" id="4995407">reflect</span><span class="op" id="4995414">.</span><span class="ident" id="4995415">TypeOf</span><span class="op" id="4995421">(</span><span class="ident" id="4995422">wireType</span><span class="op" id="4995430">{</span><span class="op" id="4995431">}</span><span class="op" id="4995432">)</span><span class="op" id="4995433">)</span><span class="op" id="4995434">.</span><span class="ident" id="4995435">id</span><br>
<span class="lineno">270</span><span class="keyword" id="4995438">var</span>&nbsp;<span class="ident" id="4995442">wireTypeUserInfo</span>&nbsp;<span class="op" id="4995459">*</span><span class="ident" id="4995460">userTypeInfo</span>&nbsp;<span class="comment" id="4995473">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4995505">func</span>&nbsp;<span class="ident" id="4995510">init</span><span class="op" id="4995514">(</span><span class="op" id="4995515">)</span>&nbsp;<span class="op" id="4995517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4995520">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995580">checkId</span><span class="op" id="4995587">(</span><span class="num" id="4995588">16</span><span class="op" id="4995590">,</span>&nbsp;<span class="ident" id="4995592">tWireType</span><span class="op" id="4995601">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995604">checkId</span><span class="op" id="4995611">(</span><span class="num" id="4995612">17</span><span class="op" id="4995614">,</span>&nbsp;<span class="ident" id="4995616">mustGetTypeInfo</span><span class="op" id="4995631">(</span><span class="ident" id="4995632">reflect</span><span class="op" id="4995639">.</span><span class="ident" id="4995640">TypeOf</span><span class="op" id="4995646">(</span><span class="ident" id="4995647">arrayType</span><span class="op" id="4995656">{</span><span class="op" id="4995657">}</span><span class="op" id="4995658">)</span><span class="op" id="4995659">)</span><span class="op" id="4995660">.</span><span class="ident" id="4995661">id</span><span class="op" id="4995663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995666">checkId</span><span class="op" id="4995673">(</span><span class="num" id="4995674">18</span><span class="op" id="4995676">,</span>&nbsp;<span class="ident" id="4995678">mustGetTypeInfo</span><span class="op" id="4995693">(</span><span class="ident" id="4995694">reflect</span><span class="op" id="4995701">.</span><span class="ident" id="4995702">TypeOf</span><span class="op" id="4995708">(</span><span class="ident" id="4995709">CommonType</span><span class="op" id="4995719">{</span><span class="op" id="4995720">}</span><span class="op" id="4995721">)</span><span class="op" id="4995722">)</span><span class="op" id="4995723">.</span><span class="ident" id="4995724">id</span><span class="op" id="4995726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995729">checkId</span><span class="op" id="4995736">(</span><span class="num" id="4995737">19</span><span class="op" id="4995739">,</span>&nbsp;<span class="ident" id="4995741">mustGetTypeInfo</span><span class="op" id="4995756">(</span><span class="ident" id="4995757">reflect</span><span class="op" id="4995764">.</span><span class="ident" id="4995765">TypeOf</span><span class="op" id="4995771">(</span><span class="ident" id="4995772">sliceType</span><span class="op" id="4995781">{</span><span class="op" id="4995782">}</span><span class="op" id="4995783">)</span><span class="op" id="4995784">)</span><span class="op" id="4995785">.</span><span class="ident" id="4995786">id</span><span class="op" id="4995788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995791">checkId</span><span class="op" id="4995798">(</span><span class="num" id="4995799">20</span><span class="op" id="4995801">,</span>&nbsp;<span class="ident" id="4995803">mustGetTypeInfo</span><span class="op" id="4995818">(</span><span class="ident" id="4995819">reflect</span><span class="op" id="4995826">.</span><span class="ident" id="4995827">TypeOf</span><span class="op" id="4995833">(</span><span class="ident" id="4995834">structType</span><span class="op" id="4995844">{</span><span class="op" id="4995845">}</span><span class="op" id="4995846">)</span><span class="op" id="4995847">)</span><span class="op" id="4995848">.</span><span class="ident" id="4995849">id</span><span class="op" id="4995851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995854">checkId</span><span class="op" id="4995861">(</span><span class="num" id="4995862">21</span><span class="op" id="4995864">,</span>&nbsp;<span class="ident" id="4995866">mustGetTypeInfo</span><span class="op" id="4995881">(</span><span class="ident" id="4995882">reflect</span><span class="op" id="4995889">.</span><span class="ident" id="4995890">TypeOf</span><span class="op" id="4995896">(</span><span class="ident" id="4995897">fieldType</span><span class="op" id="4995906">{</span><span class="op" id="4995907">}</span><span class="op" id="4995908">)</span><span class="op" id="4995909">)</span><span class="op" id="4995910">.</span><span class="ident" id="4995911">id</span><span class="op" id="4995913">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995916">checkId</span><span class="op" id="4995923">(</span><span class="num" id="4995924">23</span><span class="op" id="4995926">,</span>&nbsp;<span class="ident" id="4995928">mustGetTypeInfo</span><span class="op" id="4995943">(</span><span class="ident" id="4995944">reflect</span><span class="op" id="4995951">.</span><span class="ident" id="4995952">TypeOf</span><span class="op" id="4995958">(</span><span class="ident" id="4995959">mapType</span><span class="op" id="4995966">{</span><span class="op" id="4995967">}</span><span class="op" id="4995968">)</span><span class="op" id="4995969">)</span><span class="op" id="4995970">.</span><span class="ident" id="4995971">id</span><span class="op" id="4995973">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4995977">builtinIdToType</span>&nbsp;<span class="op" id="4995993">=</span>&nbsp;<span class="builtinfunc" id="4995995">make</span><span class="op" id="4995999">(</span><span class="keyword" id="4996000">map</span><span class="op" id="4996003">[</span><span class="ident" id="4996004">typeId</span><span class="op" id="4996010">]</span><span class="ident" id="4996011">gobType</span><span class="op" id="4996018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996021">for</span>&nbsp;<span class="ident" id="4996025">k</span><span class="op" id="4996026">,</span>&nbsp;<span class="ident" id="4996028">v</span>&nbsp;<span class="op" id="4996030">:=</span>&nbsp;<span class="keyword" id="4996033">range</span>&nbsp;<span class="ident" id="4996039">idToType</span>&nbsp;<span class="op" id="4996048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996052">builtinIdToType</span><span class="op" id="4996067">[</span><span class="ident" id="4996068">k</span><span class="op" id="4996069">]</span>&nbsp;<span class="op" id="4996071">=</span>&nbsp;<span class="ident" id="4996073">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996080">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996154">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996191">if</span>&nbsp;<span class="ident" id="4996194">nextId</span>&nbsp;<span class="op" id="4996201">&gt;</span>&nbsp;<span class="ident" id="4996203">firstUserId</span>&nbsp;<span class="op" id="4996215">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4996219">panic</span><span class="op" id="4996224">(</span><span class="ident" id="4996225">fmt</span><span class="op" id="4996228">.</span><span class="ident" id="4996229">Sprintln</span><span class="op" id="4996237">(</span><span class="string" id="4996238">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="4996257">,</span>&nbsp;<span class="ident" id="4996259">nextId</span><span class="op" id="4996265">)</span><span class="op" id="4996266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996272">nextId</span>&nbsp;<span class="op" id="4996279">=</span>&nbsp;<span class="ident" id="4996281">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996294">registerBasics</span><span class="op" id="4996308">(</span><span class="op" id="4996309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996312">wireTypeUserInfo</span>&nbsp;<span class="op" id="4996329">=</span>&nbsp;<span class="ident" id="4996331">userType</span><span class="op" id="4996339">(</span><span class="ident" id="4996340">reflect</span><span class="op" id="4996347">.</span><span class="ident" id="4996348">TypeOf</span><span class="op" id="4996354">(</span><span class="op" id="4996355">(</span><span class="op" id="4996356">*</span><span class="ident" id="4996357">wireType</span><span class="op" id="4996365">)</span><span class="op" id="4996366">(</span><span class="ident" id="4996367">nil</span><span class="op" id="4996370">)</span><span class="op" id="4996371">)</span><span class="op" id="4996372">)</span><br>
<span class="lineno">295</span><span class="op" id="4996374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4996377">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4996391">type</span>&nbsp;<span class="ident" id="4996396">arrayType</span>&nbsp;<span class="keyword" id="4996406">struct</span>&nbsp;<span class="op" id="4996413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996416">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996428">Elem</span>&nbsp;<span class="ident" id="4996433">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996441">Len</span>&nbsp;&nbsp;<span class="builtintype" id="4996446">int</span><br>
<span class="lineno"></span><span class="op" id="4996450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4996453">func</span>&nbsp;<span class="ident" id="4996458">newArrayType</span><span class="op" id="4996470">(</span><span class="ident" id="4996471">name</span>&nbsp;<span class="builtintype" id="4996476">string</span><span class="op" id="4996482">)</span>&nbsp;<span class="op" id="4996484">*</span><span class="ident" id="4996485">arrayType</span>&nbsp;<span class="op" id="4996495">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996498">a</span>&nbsp;<span class="op" id="4996500">:=</span>&nbsp;<span class="op" id="4996503">&amp;</span><span class="ident" id="4996504">arrayType</span><span class="op" id="4996513">{</span><span class="ident" id="4996514">CommonType</span><span class="op" id="4996524">{</span><span class="ident" id="4996525">Name</span><span class="op" id="4996529">:</span>&nbsp;<span class="ident" id="4996531">name</span><span class="op" id="4996535">}</span><span class="op" id="4996536">,</span>&nbsp;<span class="num" id="4996538">0</span><span class="op" id="4996539">,</span>&nbsp;<span class="num" id="4996541">0</span><span class="op" id="4996542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996545">return</span>&nbsp;<span class="ident" id="4996552">a</span><br>
<span class="lineno"></span><span class="op" id="4996554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4996557">func</span>&nbsp;<span class="op" id="4996562">(</span><span class="ident" id="4996563">a</span>&nbsp;<span class="op" id="4996565">*</span><span class="ident" id="4996566">arrayType</span><span class="op" id="4996575">)</span>&nbsp;<span class="ident" id="4996577">init</span><span class="op" id="4996581">(</span><span class="ident" id="4996582">elem</span>&nbsp;<span class="ident" id="4996587">gobType</span><span class="op" id="4996594">,</span>&nbsp;<span class="builtinfunc" id="4996596">len</span>&nbsp;<span class="builtintype" id="4996600">int</span><span class="op" id="4996603">)</span>&nbsp;<span class="op" id="4996605">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4996608">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996683">setTypeId</span><span class="op" id="4996692">(</span><span class="ident" id="4996693">a</span><span class="op" id="4996694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996697">a</span><span class="op" id="4996698">.</span><span class="ident" id="4996699">Elem</span>&nbsp;<span class="op" id="4996704">=</span>&nbsp;<span class="ident" id="4996706">elem</span><span class="op" id="4996710">.</span><span class="ident" id="4996711">id</span><span class="op" id="4996713">(</span><span class="op" id="4996714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996717">a</span><span class="op" id="4996718">.</span><span class="ident" id="4996719">Len</span>&nbsp;<span class="op" id="4996723">=</span>&nbsp;<span class="builtinfunc" id="4996725">len</span><br>
<span class="lineno"></span><span class="op" id="4996729">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4996732">func</span>&nbsp;<span class="op" id="4996737">(</span><span class="ident" id="4996738">a</span>&nbsp;<span class="op" id="4996740">*</span><span class="ident" id="4996741">arrayType</span><span class="op" id="4996750">)</span>&nbsp;<span class="ident" id="4996752">safeString</span><span class="op" id="4996762">(</span><span class="ident" id="4996763">seen</span>&nbsp;<span class="keyword" id="4996768">map</span><span class="op" id="4996771">[</span><span class="ident" id="4996772">typeId</span><span class="op" id="4996778">]</span><span class="builtintype" id="4996779">bool</span><span class="op" id="4996783">)</span>&nbsp;<span class="builtintype" id="4996785">string</span>&nbsp;<span class="op" id="4996792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996795">if</span>&nbsp;<span class="ident" id="4996798">seen</span><span class="op" id="4996802">[</span><span class="ident" id="4996803">a</span><span class="op" id="4996804">.</span><span class="ident" id="4996805">Id</span><span class="op" id="4996807">]</span>&nbsp;<span class="op" id="4996809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996813">return</span>&nbsp;<span class="ident" id="4996820">a</span><span class="op" id="4996821">.</span><span class="ident" id="4996822">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4996828">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4996831">seen</span><span class="op" id="4996835">[</span><span class="ident" id="4996836">a</span><span class="op" id="4996837">.</span><span class="ident" id="4996838">Id</span><span class="op" id="4996840">]</span>&nbsp;<span class="op" id="4996842">=</span>&nbsp;<span class="builtintype" id="4996844">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4996850">return</span>&nbsp;<span class="ident" id="4996857">fmt</span><span class="op" id="4996860">.</span><span class="ident" id="4996861">Sprintf</span><span class="op" id="4996868">(</span><span class="string" id="4996869">&#34;[%d]%s&#34;</span><span class="op" id="4996877">,</span>&nbsp;<span class="ident" id="4996879">a</span><span class="op" id="4996880">.</span><span class="ident" id="4996881">Len</span><span class="op" id="4996884">,</span>&nbsp;<span class="ident" id="4996886">a</span><span class="op" id="4996887">.</span><span class="ident" id="4996888">Elem</span><span class="op" id="4996892">.</span><span class="ident" id="4996893">gobType</span><span class="op" id="4996900">(</span><span class="op" id="4996901">)</span><span class="op" id="4996902">.</span><span class="ident" id="4996903">safeString</span><span class="op" id="4996913">(</span><span class="ident" id="4996914">seen</span><span class="op" id="4996918">)</span><span class="op" id="4996919">)</span><br>
<span class="lineno"></span><span class="op" id="4996921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4996924">func</span>&nbsp;<span class="op" id="4996929">(</span><span class="ident" id="4996930">a</span>&nbsp;<span class="op" id="4996932">*</span><span class="ident" id="4996933">arrayType</span><span class="op" id="4996942">)</span>&nbsp;<span class="builtintype" id="4996944">string</span><span class="op" id="4996950">(</span><span class="op" id="4996951">)</span>&nbsp;<span class="builtintype" id="4996953">string</span>&nbsp;<span class="op" id="4996960">{</span>&nbsp;<span class="keyword" id="4996962">return</span>&nbsp;<span class="ident" id="4996969">a</span><span class="op" id="4996970">.</span><span class="ident" id="4996971">safeString</span><span class="op" id="4996981">(</span><span class="builtinfunc" id="4996982">make</span><span class="op" id="4996986">(</span><span class="keyword" id="4996987">map</span><span class="op" id="4996990">[</span><span class="ident" id="4996991">typeId</span><span class="op" id="4996997">]</span><span class="builtintype" id="4996998">bool</span><span class="op" id="4997002">)</span><span class="op" id="4997003">)</span>&nbsp;<span class="op" id="4997005">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4997008">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="4997080">type</span>&nbsp;<span class="ident" id="4997085">gobEncoderType</span>&nbsp;<span class="keyword" id="4997100">struct</span>&nbsp;<span class="op" id="4997107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997110">CommonType</span><br>
<span class="lineno"></span><span class="op" id="4997121">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4997124">func</span>&nbsp;<span class="ident" id="4997129">newGobEncoderType</span><span class="op" id="4997146">(</span><span class="ident" id="4997147">name</span>&nbsp;<span class="builtintype" id="4997152">string</span><span class="op" id="4997158">)</span>&nbsp;<span class="op" id="4997160">*</span><span class="ident" id="4997161">gobEncoderType</span>&nbsp;<span class="op" id="4997176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997179">g</span>&nbsp;<span class="op" id="4997181">:=</span>&nbsp;<span class="op" id="4997184">&amp;</span><span class="ident" id="4997185">gobEncoderType</span><span class="op" id="4997199">{</span><span class="ident" id="4997200">CommonType</span><span class="op" id="4997210">{</span><span class="ident" id="4997211">Name</span><span class="op" id="4997215">:</span>&nbsp;<span class="ident" id="4997217">name</span><span class="op" id="4997221">}</span><span class="op" id="4997222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997225">setTypeId</span><span class="op" id="4997234">(</span><span class="ident" id="4997235">g</span><span class="op" id="4997236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997239">return</span>&nbsp;<span class="ident" id="4997246">g</span><br>
<span class="lineno">335</span><span class="op" id="4997248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997251">func</span>&nbsp;<span class="op" id="4997256">(</span><span class="ident" id="4997257">g</span>&nbsp;<span class="op" id="4997259">*</span><span class="ident" id="4997260">gobEncoderType</span><span class="op" id="4997274">)</span>&nbsp;<span class="ident" id="4997276">safeString</span><span class="op" id="4997286">(</span><span class="ident" id="4997287">seen</span>&nbsp;<span class="keyword" id="4997292">map</span><span class="op" id="4997295">[</span><span class="ident" id="4997296">typeId</span><span class="op" id="4997302">]</span><span class="builtintype" id="4997303">bool</span><span class="op" id="4997307">)</span>&nbsp;<span class="builtintype" id="4997309">string</span>&nbsp;<span class="op" id="4997316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997319">return</span>&nbsp;<span class="ident" id="4997326">g</span><span class="op" id="4997327">.</span><span class="ident" id="4997328">Name</span><br>
<span class="lineno"></span><span class="op" id="4997333">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="4997336">func</span>&nbsp;<span class="op" id="4997341">(</span><span class="ident" id="4997342">g</span>&nbsp;<span class="op" id="4997344">*</span><span class="ident" id="4997345">gobEncoderType</span><span class="op" id="4997359">)</span>&nbsp;<span class="builtintype" id="4997361">string</span><span class="op" id="4997367">(</span><span class="op" id="4997368">)</span>&nbsp;<span class="builtintype" id="4997370">string</span>&nbsp;<span class="op" id="4997377">{</span>&nbsp;<span class="keyword" id="4997379">return</span>&nbsp;<span class="ident" id="4997386">g</span><span class="op" id="4997387">.</span><span class="ident" id="4997388">Name</span>&nbsp;<span class="op" id="4997393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4997396">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4997408">type</span>&nbsp;<span class="ident" id="4997413">mapType</span>&nbsp;<span class="keyword" id="4997421">struct</span>&nbsp;<span class="op" id="4997428">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997431">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997443">Key</span>&nbsp;&nbsp;<span class="ident" id="4997448">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997456">Elem</span>&nbsp;<span class="ident" id="4997461">typeId</span><br>
<span class="lineno"></span><span class="op" id="4997468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4997471">func</span>&nbsp;<span class="ident" id="4997476">newMapType</span><span class="op" id="4997486">(</span><span class="ident" id="4997487">name</span>&nbsp;<span class="builtintype" id="4997492">string</span><span class="op" id="4997498">)</span>&nbsp;<span class="op" id="4997500">*</span><span class="ident" id="4997501">mapType</span>&nbsp;<span class="op" id="4997509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997512">m</span>&nbsp;<span class="op" id="4997514">:=</span>&nbsp;<span class="op" id="4997517">&amp;</span><span class="ident" id="4997518">mapType</span><span class="op" id="4997525">{</span><span class="ident" id="4997526">CommonType</span><span class="op" id="4997536">{</span><span class="ident" id="4997537">Name</span><span class="op" id="4997541">:</span>&nbsp;<span class="ident" id="4997543">name</span><span class="op" id="4997547">}</span><span class="op" id="4997548">,</span>&nbsp;<span class="num" id="4997550">0</span><span class="op" id="4997551">,</span>&nbsp;<span class="num" id="4997553">0</span><span class="op" id="4997554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997557">return</span>&nbsp;<span class="ident" id="4997564">m</span><br>
<span class="lineno"></span><span class="op" id="4997566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="4997569">func</span>&nbsp;<span class="op" id="4997574">(</span><span class="ident" id="4997575">m</span>&nbsp;<span class="op" id="4997577">*</span><span class="ident" id="4997578">mapType</span><span class="op" id="4997585">)</span>&nbsp;<span class="ident" id="4997587">init</span><span class="op" id="4997591">(</span><span class="ident" id="4997592">key</span><span class="op" id="4997595">,</span>&nbsp;<span class="ident" id="4997597">elem</span>&nbsp;<span class="ident" id="4997602">gobType</span><span class="op" id="4997609">)</span>&nbsp;<span class="op" id="4997611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4997614">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997689">setTypeId</span><span class="op" id="4997698">(</span><span class="ident" id="4997699">m</span><span class="op" id="4997700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997703">m</span><span class="op" id="4997704">.</span><span class="ident" id="4997705">Key</span>&nbsp;<span class="op" id="4997709">=</span>&nbsp;<span class="ident" id="4997711">key</span><span class="op" id="4997714">.</span><span class="ident" id="4997715">id</span><span class="op" id="4997717">(</span><span class="op" id="4997718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997721">m</span><span class="op" id="4997722">.</span><span class="ident" id="4997723">Elem</span>&nbsp;<span class="op" id="4997728">=</span>&nbsp;<span class="ident" id="4997730">elem</span><span class="op" id="4997734">.</span><span class="ident" id="4997735">id</span><span class="op" id="4997737">(</span><span class="op" id="4997738">)</span><br>
<span class="lineno">360</span><span class="op" id="4997740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997743">func</span>&nbsp;<span class="op" id="4997748">(</span><span class="ident" id="4997749">m</span>&nbsp;<span class="op" id="4997751">*</span><span class="ident" id="4997752">mapType</span><span class="op" id="4997759">)</span>&nbsp;<span class="ident" id="4997761">safeString</span><span class="op" id="4997771">(</span><span class="ident" id="4997772">seen</span>&nbsp;<span class="keyword" id="4997777">map</span><span class="op" id="4997780">[</span><span class="ident" id="4997781">typeId</span><span class="op" id="4997787">]</span><span class="builtintype" id="4997788">bool</span><span class="op" id="4997792">)</span>&nbsp;<span class="builtintype" id="4997794">string</span>&nbsp;<span class="op" id="4997801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997804">if</span>&nbsp;<span class="ident" id="4997807">seen</span><span class="op" id="4997811">[</span><span class="ident" id="4997812">m</span><span class="op" id="4997813">.</span><span class="ident" id="4997814">Id</span><span class="op" id="4997816">]</span>&nbsp;<span class="op" id="4997818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997822">return</span>&nbsp;<span class="ident" id="4997829">m</span><span class="op" id="4997830">.</span><span class="ident" id="4997831">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4997837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997840">seen</span><span class="op" id="4997844">[</span><span class="ident" id="4997845">m</span><span class="op" id="4997846">.</span><span class="ident" id="4997847">Id</span><span class="op" id="4997849">]</span>&nbsp;<span class="op" id="4997851">=</span>&nbsp;<span class="builtintype" id="4997853">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997859">key</span>&nbsp;<span class="op" id="4997863">:=</span>&nbsp;<span class="ident" id="4997866">m</span><span class="op" id="4997867">.</span><span class="ident" id="4997868">Key</span><span class="op" id="4997871">.</span><span class="ident" id="4997872">gobType</span><span class="op" id="4997879">(</span><span class="op" id="4997880">)</span><span class="op" id="4997881">.</span><span class="ident" id="4997882">safeString</span><span class="op" id="4997892">(</span><span class="ident" id="4997893">seen</span><span class="op" id="4997897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4997900">elem</span>&nbsp;<span class="op" id="4997905">:=</span>&nbsp;<span class="ident" id="4997908">m</span><span class="op" id="4997909">.</span><span class="ident" id="4997910">Elem</span><span class="op" id="4997914">.</span><span class="ident" id="4997915">gobType</span><span class="op" id="4997922">(</span><span class="op" id="4997923">)</span><span class="op" id="4997924">.</span><span class="ident" id="4997925">safeString</span><span class="op" id="4997935">(</span><span class="ident" id="4997936">seen</span><span class="op" id="4997940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4997943">return</span>&nbsp;<span class="ident" id="4997950">fmt</span><span class="op" id="4997953">.</span><span class="ident" id="4997954">Sprintf</span><span class="op" id="4997961">(</span><span class="string" id="4997962">&#34;map[%s]%s&#34;</span><span class="op" id="4997973">,</span>&nbsp;<span class="ident" id="4997975">key</span><span class="op" id="4997978">,</span>&nbsp;<span class="ident" id="4997980">elem</span><span class="op" id="4997984">)</span><br>
<span class="lineno">370</span><span class="op" id="4997986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4997989">func</span>&nbsp;<span class="op" id="4997994">(</span><span class="ident" id="4997995">m</span>&nbsp;<span class="op" id="4997997">*</span><span class="ident" id="4997998">mapType</span><span class="op" id="4998005">)</span>&nbsp;<span class="builtintype" id="4998007">string</span><span class="op" id="4998013">(</span><span class="op" id="4998014">)</span>&nbsp;<span class="builtintype" id="4998016">string</span>&nbsp;<span class="op" id="4998023">{</span>&nbsp;<span class="keyword" id="4998025">return</span>&nbsp;<span class="ident" id="4998032">m</span><span class="op" id="4998033">.</span><span class="ident" id="4998034">safeString</span><span class="op" id="4998044">(</span><span class="builtinfunc" id="4998045">make</span><span class="op" id="4998049">(</span><span class="keyword" id="4998050">map</span><span class="op" id="4998053">[</span><span class="ident" id="4998054">typeId</span><span class="op" id="4998060">]</span><span class="builtintype" id="4998061">bool</span><span class="op" id="4998065">)</span><span class="op" id="4998066">)</span>&nbsp;<span class="op" id="4998068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4998071">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="4998085">type</span>&nbsp;<span class="ident" id="4998090">sliceType</span>&nbsp;<span class="keyword" id="4998100">struct</span>&nbsp;<span class="op" id="4998107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998110">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998122">Elem</span>&nbsp;<span class="ident" id="4998127">typeId</span><br>
<span class="lineno"></span><span class="op" id="4998134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4998137">func</span>&nbsp;<span class="ident" id="4998142">newSliceType</span><span class="op" id="4998154">(</span><span class="ident" id="4998155">name</span>&nbsp;<span class="builtintype" id="4998160">string</span><span class="op" id="4998166">)</span>&nbsp;<span class="op" id="4998168">*</span><span class="ident" id="4998169">sliceType</span>&nbsp;<span class="op" id="4998179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998182">s</span>&nbsp;<span class="op" id="4998184">:=</span>&nbsp;<span class="op" id="4998187">&amp;</span><span class="ident" id="4998188">sliceType</span><span class="op" id="4998197">{</span><span class="ident" id="4998198">CommonType</span><span class="op" id="4998208">{</span><span class="ident" id="4998209">Name</span><span class="op" id="4998213">:</span>&nbsp;<span class="ident" id="4998215">name</span><span class="op" id="4998219">}</span><span class="op" id="4998220">,</span>&nbsp;<span class="num" id="4998222">0</span><span class="op" id="4998223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998226">return</span>&nbsp;<span class="ident" id="4998233">s</span><br>
<span class="lineno"></span><span class="op" id="4998235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4998238">func</span>&nbsp;<span class="op" id="4998243">(</span><span class="ident" id="4998244">s</span>&nbsp;<span class="op" id="4998246">*</span><span class="ident" id="4998247">sliceType</span><span class="op" id="4998256">)</span>&nbsp;<span class="ident" id="4998258">init</span><span class="op" id="4998262">(</span><span class="ident" id="4998263">elem</span>&nbsp;<span class="ident" id="4998268">gobType</span><span class="op" id="4998275">)</span>&nbsp;<span class="op" id="4998277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998280">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998355">setTypeId</span><span class="op" id="4998364">(</span><span class="ident" id="4998365">s</span><span class="op" id="4998366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998369">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4998434">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998469">if</span>&nbsp;<span class="ident" id="4998472">elem</span><span class="op" id="4998476">.</span><span class="ident" id="4998477">id</span><span class="op" id="4998479">(</span><span class="op" id="4998480">)</span>&nbsp;<span class="op" id="4998482">==</span>&nbsp;<span class="num" id="4998485">0</span>&nbsp;<span class="op" id="4998487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998491">setTypeId</span><span class="op" id="4998500">(</span><span class="ident" id="4998501">elem</span><span class="op" id="4998505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998511">s</span><span class="op" id="4998512">.</span><span class="ident" id="4998513">Elem</span>&nbsp;<span class="op" id="4998518">=</span>&nbsp;<span class="ident" id="4998520">elem</span><span class="op" id="4998524">.</span><span class="ident" id="4998525">id</span><span class="op" id="4998527">(</span><span class="op" id="4998528">)</span><br>
<span class="lineno"></span><span class="op" id="4998530">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="4998533">func</span>&nbsp;<span class="op" id="4998538">(</span><span class="ident" id="4998539">s</span>&nbsp;<span class="op" id="4998541">*</span><span class="ident" id="4998542">sliceType</span><span class="op" id="4998551">)</span>&nbsp;<span class="ident" id="4998553">safeString</span><span class="op" id="4998563">(</span><span class="ident" id="4998564">seen</span>&nbsp;<span class="keyword" id="4998569">map</span><span class="op" id="4998572">[</span><span class="ident" id="4998573">typeId</span><span class="op" id="4998579">]</span><span class="builtintype" id="4998580">bool</span><span class="op" id="4998584">)</span>&nbsp;<span class="builtintype" id="4998586">string</span>&nbsp;<span class="op" id="4998593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998596">if</span>&nbsp;<span class="ident" id="4998599">seen</span><span class="op" id="4998603">[</span><span class="ident" id="4998604">s</span><span class="op" id="4998605">.</span><span class="ident" id="4998606">Id</span><span class="op" id="4998608">]</span>&nbsp;<span class="op" id="4998610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998614">return</span>&nbsp;<span class="ident" id="4998621">s</span><span class="op" id="4998622">.</span><span class="ident" id="4998623">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4998629">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998632">seen</span><span class="op" id="4998636">[</span><span class="ident" id="4998637">s</span><span class="op" id="4998638">.</span><span class="ident" id="4998639">Id</span><span class="op" id="4998641">]</span>&nbsp;<span class="op" id="4998643">=</span>&nbsp;<span class="builtintype" id="4998645">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998651">return</span>&nbsp;<span class="ident" id="4998658">fmt</span><span class="op" id="4998661">.</span><span class="ident" id="4998662">Sprintf</span><span class="op" id="4998669">(</span><span class="string" id="4998670">&#34;[]%s&#34;</span><span class="op" id="4998676">,</span>&nbsp;<span class="ident" id="4998678">s</span><span class="op" id="4998679">.</span><span class="ident" id="4998680">Elem</span><span class="op" id="4998684">.</span><span class="ident" id="4998685">gobType</span><span class="op" id="4998692">(</span><span class="op" id="4998693">)</span><span class="op" id="4998694">.</span><span class="ident" id="4998695">safeString</span><span class="op" id="4998705">(</span><span class="ident" id="4998706">seen</span><span class="op" id="4998710">)</span><span class="op" id="4998711">)</span><br>
<span class="lineno"></span><span class="op" id="4998713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998716">func</span>&nbsp;<span class="op" id="4998721">(</span><span class="ident" id="4998722">s</span>&nbsp;<span class="op" id="4998724">*</span><span class="ident" id="4998725">sliceType</span><span class="op" id="4998734">)</span>&nbsp;<span class="builtintype" id="4998736">string</span><span class="op" id="4998742">(</span><span class="op" id="4998743">)</span>&nbsp;<span class="builtintype" id="4998745">string</span>&nbsp;<span class="op" id="4998752">{</span>&nbsp;<span class="keyword" id="4998754">return</span>&nbsp;<span class="ident" id="4998761">s</span><span class="op" id="4998762">.</span><span class="ident" id="4998763">safeString</span><span class="op" id="4998773">(</span><span class="builtinfunc" id="4998774">make</span><span class="op" id="4998778">(</span><span class="keyword" id="4998779">map</span><span class="op" id="4998782">[</span><span class="ident" id="4998783">typeId</span><span class="op" id="4998789">]</span><span class="builtintype" id="4998790">bool</span><span class="op" id="4998794">)</span><span class="op" id="4998795">)</span>&nbsp;<span class="op" id="4998797">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4998800">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4998815">type</span>&nbsp;<span class="ident" id="4998820">fieldType</span>&nbsp;<span class="keyword" id="4998830">struct</span>&nbsp;<span class="op" id="4998837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998840">Name</span>&nbsp;<span class="builtintype" id="4998845">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998853">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4998858">typeId</span><br>
<span class="lineno">410</span><span class="op" id="4998865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998868">type</span>&nbsp;<span class="ident" id="4998873">structType</span>&nbsp;<span class="keyword" id="4998884">struct</span>&nbsp;<span class="op" id="4998891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998894">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4998906">Field</span>&nbsp;<span class="op" id="4998912">[</span><span class="op" id="4998913">]</span><span class="op" id="4998914">*</span><span class="ident" id="4998915">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="4998925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4998928">func</span>&nbsp;<span class="op" id="4998933">(</span><span class="ident" id="4998934">s</span>&nbsp;<span class="op" id="4998936">*</span><span class="ident" id="4998937">structType</span><span class="op" id="4998947">)</span>&nbsp;<span class="ident" id="4998949">safeString</span><span class="op" id="4998959">(</span><span class="ident" id="4998960">seen</span>&nbsp;<span class="keyword" id="4998965">map</span><span class="op" id="4998968">[</span><span class="ident" id="4998969">typeId</span><span class="op" id="4998975">]</span><span class="builtintype" id="4998976">bool</span><span class="op" id="4998980">)</span>&nbsp;<span class="builtintype" id="4998982">string</span>&nbsp;<span class="op" id="4998989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4998992">if</span>&nbsp;<span class="ident" id="4998995">s</span>&nbsp;<span class="op" id="4998997">==</span>&nbsp;<span class="ident" id="4999000">nil</span>&nbsp;<span class="op" id="4999004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999008">return</span>&nbsp;<span class="string" id="4999015">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999027">if</span>&nbsp;<span class="ident" id="4999030">_</span><span class="op" id="4999031">,</span>&nbsp;<span class="ident" id="4999033">ok</span>&nbsp;<span class="op" id="4999036">:=</span>&nbsp;<span class="ident" id="4999039">seen</span><span class="op" id="4999043">[</span><span class="ident" id="4999044">s</span><span class="op" id="4999045">.</span><span class="ident" id="4999046">Id</span><span class="op" id="4999048">]</span><span class="op" id="4999049">;</span>&nbsp;<span class="ident" id="4999051">ok</span>&nbsp;<span class="op" id="4999054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999058">return</span>&nbsp;<span class="ident" id="4999065">s</span><span class="op" id="4999066">.</span><span class="ident" id="4999067">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999076">seen</span><span class="op" id="4999080">[</span><span class="ident" id="4999081">s</span><span class="op" id="4999082">.</span><span class="ident" id="4999083">Id</span><span class="op" id="4999085">]</span>&nbsp;<span class="op" id="4999087">=</span>&nbsp;<span class="builtintype" id="4999089">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999095">str</span>&nbsp;<span class="op" id="4999099">:=</span>&nbsp;<span class="ident" id="4999102">s</span><span class="op" id="4999103">.</span><span class="ident" id="4999104">Name</span>&nbsp;<span class="op" id="4999109">+</span>&nbsp;<span class="string" id="4999111">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999127">for</span>&nbsp;<span class="ident" id="4999131">_</span><span class="op" id="4999132">,</span>&nbsp;<span class="ident" id="4999134">f</span>&nbsp;<span class="op" id="4999136">:=</span>&nbsp;<span class="keyword" id="4999139">range</span>&nbsp;<span class="ident" id="4999145">s</span><span class="op" id="4999146">.</span><span class="ident" id="4999147">Field</span>&nbsp;<span class="op" id="4999153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999157">str</span>&nbsp;<span class="op" id="4999161">+=</span>&nbsp;<span class="ident" id="4999164">fmt</span><span class="op" id="4999167">.</span><span class="ident" id="4999168">Sprintf</span><span class="op" id="4999175">(</span><span class="string" id="4999176">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="4999185">,</span>&nbsp;<span class="ident" id="4999187">f</span><span class="op" id="4999188">.</span><span class="ident" id="4999189">Name</span><span class="op" id="4999193">,</span>&nbsp;<span class="ident" id="4999195">f</span><span class="op" id="4999196">.</span><span class="ident" id="4999197">Id</span><span class="op" id="4999199">.</span><span class="ident" id="4999200">gobType</span><span class="op" id="4999207">(</span><span class="op" id="4999208">)</span><span class="op" id="4999209">.</span><span class="ident" id="4999210">safeString</span><span class="op" id="4999220">(</span><span class="ident" id="4999221">seen</span><span class="op" id="4999225">)</span><span class="op" id="4999226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4999229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999232">str</span>&nbsp;<span class="op" id="4999236">+=</span>&nbsp;<span class="string" id="4999239">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999244">return</span>&nbsp;<span class="ident" id="4999251">str</span><br>
<span class="lineno"></span><span class="op" id="4999255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4999258">func</span>&nbsp;<span class="op" id="4999263">(</span><span class="ident" id="4999264">s</span>&nbsp;<span class="op" id="4999266">*</span><span class="ident" id="4999267">structType</span><span class="op" id="4999277">)</span>&nbsp;<span class="builtintype" id="4999279">string</span><span class="op" id="4999285">(</span><span class="op" id="4999286">)</span>&nbsp;<span class="builtintype" id="4999288">string</span>&nbsp;<span class="op" id="4999295">{</span>&nbsp;<span class="keyword" id="4999297">return</span>&nbsp;<span class="ident" id="4999304">s</span><span class="op" id="4999305">.</span><span class="ident" id="4999306">safeString</span><span class="op" id="4999316">(</span><span class="builtinfunc" id="4999317">make</span><span class="op" id="4999321">(</span><span class="keyword" id="4999322">map</span><span class="op" id="4999325">[</span><span class="ident" id="4999326">typeId</span><span class="op" id="4999332">]</span><span class="builtintype" id="4999333">bool</span><span class="op" id="4999337">)</span><span class="op" id="4999338">)</span>&nbsp;<span class="op" id="4999340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="4999343">func</span>&nbsp;<span class="ident" id="4999348">newStructType</span><span class="op" id="4999361">(</span><span class="ident" id="4999362">name</span>&nbsp;<span class="builtintype" id="4999367">string</span><span class="op" id="4999373">)</span>&nbsp;<span class="op" id="4999375">*</span><span class="ident" id="4999376">structType</span>&nbsp;<span class="op" id="4999387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999390">s</span>&nbsp;<span class="op" id="4999392">:=</span>&nbsp;<span class="op" id="4999395">&amp;</span><span class="ident" id="4999396">structType</span><span class="op" id="4999406">{</span><span class="ident" id="4999407">CommonType</span><span class="op" id="4999417">{</span><span class="ident" id="4999418">Name</span><span class="op" id="4999422">:</span>&nbsp;<span class="ident" id="4999424">name</span><span class="op" id="4999428">}</span><span class="op" id="4999429">,</span>&nbsp;<span class="ident" id="4999431">nil</span><span class="op" id="4999434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999437">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999501">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4999551">setTypeId</span><span class="op" id="4999560">(</span><span class="ident" id="4999561">s</span><span class="op" id="4999562">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999565">return</span>&nbsp;<span class="ident" id="4999572">s</span><br>
<span class="lineno"></span><span class="op" id="4999574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4999577">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4999642">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="4999707">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="4999717">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="4999782">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="4999832">func</span>&nbsp;<span class="ident" id="4999837">newTypeObject</span><span class="op" id="4999850">(</span><span class="ident" id="4999851">name</span>&nbsp;<span class="builtintype" id="4999856">string</span><span class="op" id="4999862">,</span>&nbsp;<span class="ident" id="4999864">ut</span>&nbsp;<span class="op" id="4999867">*</span><span class="ident" id="4999868">userTypeInfo</span><span class="op" id="4999880">,</span>&nbsp;<span class="ident" id="4999882">rt</span>&nbsp;<span class="ident" id="4999885">reflect</span><span class="op" id="4999892">.</span><span class="ident" id="4999893">Type</span><span class="op" id="4999897">)</span>&nbsp;<span class="op" id="4999899">(</span><span class="ident" id="4999900">gobType</span><span class="op" id="4999907">,</span>&nbsp;<span class="builtintype" id="4999909">error</span><span class="op" id="4999914">)</span>&nbsp;<span class="op" id="4999916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4999919">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999960">if</span>&nbsp;<span class="ident" id="4999963">ut</span><span class="op" id="4999965">.</span><span class="ident" id="4999966">externalEnc</span>&nbsp;<span class="op" id="4999978">!=</span>&nbsp;<span class="num" id="4999981">0</span>&nbsp;<span class="op" id="4999983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4999987">return</span>&nbsp;<span class="ident" id="4999994">newGobEncoderType</span><span class="op" id="5000011">(</span><span class="ident" id="5000012">name</span><span class="op" id="5000016">)</span><span class="op" id="5000017">,</span>&nbsp;<span class="ident" id="5000019">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000027">var</span>&nbsp;<span class="ident" id="5000031">err</span>&nbsp;<span class="builtintype" id="5000035">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000042">var</span>&nbsp;<span class="ident" id="5000046">type0</span><span class="op" id="5000051">,</span>&nbsp;<span class="ident" id="5000053">type1</span>&nbsp;<span class="ident" id="5000059">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000068">defer</span>&nbsp;<span class="keyword" id="5000074">func</span><span class="op" id="5000078">(</span><span class="op" id="5000079">)</span>&nbsp;<span class="op" id="5000081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000085">if</span>&nbsp;<span class="ident" id="5000088">err</span>&nbsp;<span class="op" id="5000092">!=</span>&nbsp;<span class="ident" id="5000095">nil</span>&nbsp;<span class="op" id="5000099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5000104">delete</span><span class="op" id="5000110">(</span><span class="ident" id="5000111">types</span><span class="op" id="5000116">,</span>&nbsp;<span class="ident" id="5000118">rt</span><span class="op" id="5000120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5000127">}</span><span class="op" id="5000128">(</span><span class="op" id="5000129">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5000132">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5000203">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000261">switch</span>&nbsp;<span class="ident" id="5000268">t</span>&nbsp;<span class="op" id="5000270">:=</span>&nbsp;<span class="ident" id="5000273">rt</span><span class="op" id="5000275">;</span>&nbsp;<span class="ident" id="5000277">t</span><span class="op" id="5000278">.</span><span class="ident" id="5000279">Kind</span><span class="op" id="5000283">(</span><span class="op" id="5000284">)</span>&nbsp;<span class="op" id="5000286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5000289">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000340">case</span>&nbsp;<span class="ident" id="5000345">reflect</span><span class="op" id="5000352">.</span><span class="ident" id="5000353">Bool</span><span class="op" id="5000357">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000361">return</span>&nbsp;<span class="ident" id="5000368">tBool</span><span class="op" id="5000373">.</span><span class="ident" id="5000374">gobType</span><span class="op" id="5000381">(</span><span class="op" id="5000382">)</span><span class="op" id="5000383">,</span>&nbsp;<span class="ident" id="5000385">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000391">case</span>&nbsp;<span class="ident" id="5000396">reflect</span><span class="op" id="5000403">.</span><span class="ident" id="5000404">Int</span><span class="op" id="5000407">,</span>&nbsp;<span class="ident" id="5000409">reflect</span><span class="op" id="5000416">.</span><span class="ident" id="5000417">Int8</span><span class="op" id="5000421">,</span>&nbsp;<span class="ident" id="5000423">reflect</span><span class="op" id="5000430">.</span><span class="ident" id="5000431">Int16</span><span class="op" id="5000436">,</span>&nbsp;<span class="ident" id="5000438">reflect</span><span class="op" id="5000445">.</span><span class="ident" id="5000446">Int32</span><span class="op" id="5000451">,</span>&nbsp;<span class="ident" id="5000453">reflect</span><span class="op" id="5000460">.</span><span class="ident" id="5000461">Int64</span><span class="op" id="5000466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000470">return</span>&nbsp;<span class="ident" id="5000477">tInt</span><span class="op" id="5000481">.</span><span class="ident" id="5000482">gobType</span><span class="op" id="5000489">(</span><span class="op" id="5000490">)</span><span class="op" id="5000491">,</span>&nbsp;<span class="ident" id="5000493">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000499">case</span>&nbsp;<span class="ident" id="5000504">reflect</span><span class="op" id="5000511">.</span><span class="ident" id="5000512">Uint</span><span class="op" id="5000516">,</span>&nbsp;<span class="ident" id="5000518">reflect</span><span class="op" id="5000525">.</span><span class="ident" id="5000526">Uint8</span><span class="op" id="5000531">,</span>&nbsp;<span class="ident" id="5000533">reflect</span><span class="op" id="5000540">.</span><span class="ident" id="5000541">Uint16</span><span class="op" id="5000547">,</span>&nbsp;<span class="ident" id="5000549">reflect</span><span class="op" id="5000556">.</span><span class="ident" id="5000557">Uint32</span><span class="op" id="5000563">,</span>&nbsp;<span class="ident" id="5000565">reflect</span><span class="op" id="5000572">.</span><span class="ident" id="5000573">Uint64</span><span class="op" id="5000579">,</span>&nbsp;<span class="ident" id="5000581">reflect</span><span class="op" id="5000588">.</span><span class="ident" id="5000589">Uintptr</span><span class="op" id="5000596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000600">return</span>&nbsp;<span class="ident" id="5000607">tUint</span><span class="op" id="5000612">.</span><span class="ident" id="5000613">gobType</span><span class="op" id="5000620">(</span><span class="op" id="5000621">)</span><span class="op" id="5000622">,</span>&nbsp;<span class="ident" id="5000624">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000630">case</span>&nbsp;<span class="ident" id="5000635">reflect</span><span class="op" id="5000642">.</span><span class="ident" id="5000643">Float32</span><span class="op" id="5000650">,</span>&nbsp;<span class="ident" id="5000652">reflect</span><span class="op" id="5000659">.</span><span class="ident" id="5000660">Float64</span><span class="op" id="5000667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000671">return</span>&nbsp;<span class="ident" id="5000678">tFloat</span><span class="op" id="5000684">.</span><span class="ident" id="5000685">gobType</span><span class="op" id="5000692">(</span><span class="op" id="5000693">)</span><span class="op" id="5000694">,</span>&nbsp;<span class="ident" id="5000696">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000702">case</span>&nbsp;<span class="ident" id="5000707">reflect</span><span class="op" id="5000714">.</span><span class="ident" id="5000715">Complex64</span><span class="op" id="5000724">,</span>&nbsp;<span class="ident" id="5000726">reflect</span><span class="op" id="5000733">.</span><span class="ident" id="5000734">Complex128</span><span class="op" id="5000744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000748">return</span>&nbsp;<span class="ident" id="5000755">tComplex</span><span class="op" id="5000763">.</span><span class="ident" id="5000764">gobType</span><span class="op" id="5000771">(</span><span class="op" id="5000772">)</span><span class="op" id="5000773">,</span>&nbsp;<span class="ident" id="5000775">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000781">case</span>&nbsp;<span class="ident" id="5000786">reflect</span><span class="op" id="5000793">.</span><span class="ident" id="5000794">String</span><span class="op" id="5000800">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000804">return</span>&nbsp;<span class="ident" id="5000811">tString</span><span class="op" id="5000818">.</span><span class="ident" id="5000819">gobType</span><span class="op" id="5000826">(</span><span class="op" id="5000827">)</span><span class="op" id="5000828">,</span>&nbsp;<span class="ident" id="5000830">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000836">case</span>&nbsp;<span class="ident" id="5000841">reflect</span><span class="op" id="5000848">.</span><span class="ident" id="5000849">Interface</span><span class="op" id="5000858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000862">return</span>&nbsp;<span class="ident" id="5000869">tInterface</span><span class="op" id="5000879">.</span><span class="ident" id="5000880">gobType</span><span class="op" id="5000887">(</span><span class="op" id="5000888">)</span><span class="op" id="5000889">,</span>&nbsp;<span class="ident" id="5000891">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5000897">case</span>&nbsp;<span class="ident" id="5000902">reflect</span><span class="op" id="5000909">.</span><span class="ident" id="5000910">Array</span><span class="op" id="5000915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000919">at</span>&nbsp;<span class="op" id="5000922">:=</span>&nbsp;<span class="ident" id="5000925">newArrayType</span><span class="op" id="5000937">(</span><span class="ident" id="5000938">name</span><span class="op" id="5000942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000946">types</span><span class="op" id="5000951">[</span><span class="ident" id="5000952">rt</span><span class="op" id="5000954">]</span>&nbsp;<span class="op" id="5000956">=</span>&nbsp;<span class="ident" id="5000958">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5000963">type0</span><span class="op" id="5000968">,</span>&nbsp;<span class="ident" id="5000970">err</span>&nbsp;<span class="op" id="5000974">=</span>&nbsp;<span class="ident" id="5000976">getBaseType</span><span class="op" id="5000987">(</span><span class="string" id="5000988">&#34;&#34;</span><span class="op" id="5000990">,</span>&nbsp;<span class="ident" id="5000992">t</span><span class="op" id="5000993">.</span><span class="ident" id="5000994">Elem</span><span class="op" id="5000998">(</span><span class="op" id="5000999">)</span><span class="op" id="5001000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001004">if</span>&nbsp;<span class="ident" id="5001007">err</span>&nbsp;<span class="op" id="5001011">!=</span>&nbsp;<span class="ident" id="5001014">nil</span>&nbsp;<span class="op" id="5001018">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001023">return</span>&nbsp;<span class="ident" id="5001030">nil</span><span class="op" id="5001033">,</span>&nbsp;<span class="ident" id="5001035">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001045">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001068">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001141">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001219">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001289">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001361">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001432">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001499">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001555">at</span><span class="op" id="5001557">.</span><span class="ident" id="5001558">init</span><span class="op" id="5001562">(</span><span class="ident" id="5001563">type0</span><span class="op" id="5001568">,</span>&nbsp;<span class="ident" id="5001570">t</span><span class="op" id="5001571">.</span><span class="ident" id="5001572">Len</span><span class="op" id="5001575">(</span><span class="op" id="5001576">)</span><span class="op" id="5001577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001581">return</span>&nbsp;<span class="ident" id="5001588">at</span><span class="op" id="5001590">,</span>&nbsp;<span class="ident" id="5001592">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001598">case</span>&nbsp;<span class="ident" id="5001603">reflect</span><span class="op" id="5001610">.</span><span class="ident" id="5001611">Map</span><span class="op" id="5001614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001618">mt</span>&nbsp;<span class="op" id="5001621">:=</span>&nbsp;<span class="ident" id="5001624">newMapType</span><span class="op" id="5001634">(</span><span class="ident" id="5001635">name</span><span class="op" id="5001639">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001643">types</span><span class="op" id="5001648">[</span><span class="ident" id="5001649">rt</span><span class="op" id="5001651">]</span>&nbsp;<span class="op" id="5001653">=</span>&nbsp;<span class="ident" id="5001655">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001660">type0</span><span class="op" id="5001665">,</span>&nbsp;<span class="ident" id="5001667">err</span>&nbsp;<span class="op" id="5001671">=</span>&nbsp;<span class="ident" id="5001673">getBaseType</span><span class="op" id="5001684">(</span><span class="string" id="5001685">&#34;&#34;</span><span class="op" id="5001687">,</span>&nbsp;<span class="ident" id="5001689">t</span><span class="op" id="5001690">.</span><span class="ident" id="5001691">Key</span><span class="op" id="5001694">(</span><span class="op" id="5001695">)</span><span class="op" id="5001696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001700">if</span>&nbsp;<span class="ident" id="5001703">err</span>&nbsp;<span class="op" id="5001707">!=</span>&nbsp;<span class="ident" id="5001710">nil</span>&nbsp;<span class="op" id="5001714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001719">return</span>&nbsp;<span class="ident" id="5001726">nil</span><span class="op" id="5001729">,</span>&nbsp;<span class="ident" id="5001731">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001737">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001741">type1</span><span class="op" id="5001746">,</span>&nbsp;<span class="ident" id="5001748">err</span>&nbsp;<span class="op" id="5001752">=</span>&nbsp;<span class="ident" id="5001754">getBaseType</span><span class="op" id="5001765">(</span><span class="string" id="5001766">&#34;&#34;</span><span class="op" id="5001768">,</span>&nbsp;<span class="ident" id="5001770">t</span><span class="op" id="5001771">.</span><span class="ident" id="5001772">Elem</span><span class="op" id="5001776">(</span><span class="op" id="5001777">)</span><span class="op" id="5001778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001782">if</span>&nbsp;<span class="ident" id="5001785">err</span>&nbsp;<span class="op" id="5001789">!=</span>&nbsp;<span class="ident" id="5001792">nil</span>&nbsp;<span class="op" id="5001796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001801">return</span>&nbsp;<span class="ident" id="5001808">nil</span><span class="op" id="5001811">,</span>&nbsp;<span class="ident" id="5001813">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5001823">mt</span><span class="op" id="5001825">.</span><span class="ident" id="5001826">init</span><span class="op" id="5001830">(</span><span class="ident" id="5001831">type0</span><span class="op" id="5001836">,</span>&nbsp;<span class="ident" id="5001838">type1</span><span class="op" id="5001843">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001847">return</span>&nbsp;<span class="ident" id="5001854">mt</span><span class="op" id="5001856">,</span>&nbsp;<span class="ident" id="5001858">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001864">case</span>&nbsp;<span class="ident" id="5001869">reflect</span><span class="op" id="5001876">.</span><span class="ident" id="5001877">Slice</span><span class="op" id="5001882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5001886">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001927">if</span>&nbsp;<span class="ident" id="5001930">t</span><span class="op" id="5001931">.</span><span class="ident" id="5001932">Elem</span><span class="op" id="5001936">(</span><span class="op" id="5001937">)</span><span class="op" id="5001938">.</span><span class="ident" id="5001939">Kind</span><span class="op" id="5001943">(</span><span class="op" id="5001944">)</span>&nbsp;<span class="op" id="5001946">==</span>&nbsp;<span class="ident" id="5001949">reflect</span><span class="op" id="5001956">.</span><span class="ident" id="5001957">Uint8</span>&nbsp;<span class="op" id="5001963">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5001968">return</span>&nbsp;<span class="ident" id="5001975">tBytes</span><span class="op" id="5001981">.</span><span class="ident" id="5001982">gobType</span><span class="op" id="5001989">(</span><span class="op" id="5001990">)</span><span class="op" id="5001991">,</span>&nbsp;<span class="ident" id="5001993">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5001999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002003">st</span>&nbsp;<span class="op" id="5002006">:=</span>&nbsp;<span class="ident" id="5002009">newSliceType</span><span class="op" id="5002021">(</span><span class="ident" id="5002022">name</span><span class="op" id="5002026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002030">types</span><span class="op" id="5002035">[</span><span class="ident" id="5002036">rt</span><span class="op" id="5002038">]</span>&nbsp;<span class="op" id="5002040">=</span>&nbsp;<span class="ident" id="5002042">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002047">type0</span><span class="op" id="5002052">,</span>&nbsp;<span class="ident" id="5002054">err</span>&nbsp;<span class="op" id="5002058">=</span>&nbsp;<span class="ident" id="5002060">getBaseType</span><span class="op" id="5002071">(</span><span class="ident" id="5002072">t</span><span class="op" id="5002073">.</span><span class="ident" id="5002074">Elem</span><span class="op" id="5002078">(</span><span class="op" id="5002079">)</span><span class="op" id="5002080">.</span><span class="ident" id="5002081">Name</span><span class="op" id="5002085">(</span><span class="op" id="5002086">)</span><span class="op" id="5002087">,</span>&nbsp;<span class="ident" id="5002089">t</span><span class="op" id="5002090">.</span><span class="ident" id="5002091">Elem</span><span class="op" id="5002095">(</span><span class="op" id="5002096">)</span><span class="op" id="5002097">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002101">if</span>&nbsp;<span class="ident" id="5002104">err</span>&nbsp;<span class="op" id="5002108">!=</span>&nbsp;<span class="ident" id="5002111">nil</span>&nbsp;<span class="op" id="5002115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002120">return</span>&nbsp;<span class="ident" id="5002127">nil</span><span class="op" id="5002130">,</span>&nbsp;<span class="ident" id="5002132">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002142">st</span><span class="op" id="5002144">.</span><span class="ident" id="5002145">init</span><span class="op" id="5002149">(</span><span class="ident" id="5002150">type0</span><span class="op" id="5002155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002159">return</span>&nbsp;<span class="ident" id="5002166">st</span><span class="op" id="5002168">,</span>&nbsp;<span class="ident" id="5002170">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002176">case</span>&nbsp;<span class="ident" id="5002181">reflect</span><span class="op" id="5002188">.</span><span class="ident" id="5002189">Struct</span><span class="op" id="5002195">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002199">st</span>&nbsp;<span class="op" id="5002202">:=</span>&nbsp;<span class="ident" id="5002205">newStructType</span><span class="op" id="5002218">(</span><span class="ident" id="5002219">name</span><span class="op" id="5002223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002227">types</span><span class="op" id="5002232">[</span><span class="ident" id="5002233">rt</span><span class="op" id="5002235">]</span>&nbsp;<span class="op" id="5002237">=</span>&nbsp;<span class="ident" id="5002239">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002244">idToType</span><span class="op" id="5002252">[</span><span class="ident" id="5002253">st</span><span class="op" id="5002255">.</span><span class="ident" id="5002256">id</span><span class="op" id="5002258">(</span><span class="op" id="5002259">)</span><span class="op" id="5002260">]</span>&nbsp;<span class="op" id="5002262">=</span>&nbsp;<span class="ident" id="5002264">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002269">for</span>&nbsp;<span class="ident" id="5002273">i</span>&nbsp;<span class="op" id="5002275">:=</span>&nbsp;<span class="num" id="5002278">0</span><span class="op" id="5002279">;</span>&nbsp;<span class="ident" id="5002281">i</span>&nbsp;<span class="op" id="5002283">&lt;</span>&nbsp;<span class="ident" id="5002285">t</span><span class="op" id="5002286">.</span><span class="ident" id="5002287">NumField</span><span class="op" id="5002295">(</span><span class="op" id="5002296">)</span><span class="op" id="5002297">;</span>&nbsp;<span class="ident" id="5002299">i</span><span class="op" id="5002300">++</span>&nbsp;<span class="op" id="5002303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002308">f</span>&nbsp;<span class="op" id="5002310">:=</span>&nbsp;<span class="ident" id="5002313">t</span><span class="op" id="5002314">.</span><span class="ident" id="5002315">Field</span><span class="op" id="5002320">(</span><span class="ident" id="5002321">i</span><span class="op" id="5002322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002327">if</span>&nbsp;<span class="op" id="5002330">!</span><span class="ident" id="5002331">isSent</span><span class="op" id="5002337">(</span><span class="op" id="5002338">&amp;</span><span class="ident" id="5002339">f</span><span class="op" id="5002340">)</span>&nbsp;<span class="op" id="5002342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002348">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002360">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002365">typ</span>&nbsp;<span class="op" id="5002369">:=</span>&nbsp;<span class="ident" id="5002372">userType</span><span class="op" id="5002380">(</span><span class="ident" id="5002381">f</span><span class="op" id="5002382">.</span><span class="ident" id="5002383">Type</span><span class="op" id="5002387">)</span><span class="op" id="5002388">.</span><span class="ident" id="5002389">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002397">tname</span>&nbsp;<span class="op" id="5002403">:=</span>&nbsp;<span class="ident" id="5002406">typ</span><span class="op" id="5002409">.</span><span class="ident" id="5002410">Name</span><span class="op" id="5002414">(</span><span class="op" id="5002415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002420">if</span>&nbsp;<span class="ident" id="5002423">tname</span>&nbsp;<span class="op" id="5002429">==</span>&nbsp;<span class="string" id="5002432">&#34;&#34;</span>&nbsp;<span class="op" id="5002435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002441">t</span>&nbsp;<span class="op" id="5002443">:=</span>&nbsp;<span class="ident" id="5002446">userType</span><span class="op" id="5002454">(</span><span class="ident" id="5002455">f</span><span class="op" id="5002456">.</span><span class="ident" id="5002457">Type</span><span class="op" id="5002461">)</span><span class="op" id="5002462">.</span><span class="ident" id="5002463">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002472">tname</span>&nbsp;<span class="op" id="5002478">=</span>&nbsp;<span class="ident" id="5002480">t</span><span class="op" id="5002481">.</span><span class="ident" id="5002482">String</span><span class="op" id="5002488">(</span><span class="op" id="5002489">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002499">gt</span><span class="op" id="5002501">,</span>&nbsp;<span class="ident" id="5002503">err</span>&nbsp;<span class="op" id="5002507">:=</span>&nbsp;<span class="ident" id="5002510">getBaseType</span><span class="op" id="5002521">(</span><span class="ident" id="5002522">tname</span><span class="op" id="5002527">,</span>&nbsp;<span class="ident" id="5002529">f</span><span class="op" id="5002530">.</span><span class="ident" id="5002531">Type</span><span class="op" id="5002535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002540">if</span>&nbsp;<span class="ident" id="5002543">err</span>&nbsp;<span class="op" id="5002547">!=</span>&nbsp;<span class="ident" id="5002550">nil</span>&nbsp;<span class="op" id="5002554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002560">return</span>&nbsp;<span class="ident" id="5002567">nil</span><span class="op" id="5002570">,</span>&nbsp;<span class="ident" id="5002572">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002579">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5002584">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5002650">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5002714">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5002783">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002853">if</span>&nbsp;<span class="ident" id="5002856">gt</span><span class="op" id="5002858">.</span><span class="ident" id="5002859">id</span><span class="op" id="5002861">(</span><span class="op" id="5002862">)</span>&nbsp;<span class="op" id="5002864">==</span>&nbsp;<span class="num" id="5002867">0</span>&nbsp;<span class="op" id="5002869">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002875">setTypeId</span><span class="op" id="5002884">(</span><span class="ident" id="5002885">gt</span><span class="op" id="5002887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5002897">st</span><span class="op" id="5002899">.</span><span class="ident" id="5002900">Field</span>&nbsp;<span class="op" id="5002906">=</span>&nbsp;<span class="builtinfunc" id="5002908">append</span><span class="op" id="5002914">(</span><span class="ident" id="5002915">st</span><span class="op" id="5002917">.</span><span class="ident" id="5002918">Field</span><span class="op" id="5002923">,</span>&nbsp;<span class="op" id="5002925">&amp;</span><span class="ident" id="5002926">fieldType</span><span class="op" id="5002935">{</span><span class="ident" id="5002936">f</span><span class="op" id="5002937">.</span><span class="ident" id="5002938">Name</span><span class="op" id="5002942">,</span>&nbsp;<span class="ident" id="5002944">gt</span><span class="op" id="5002946">.</span><span class="ident" id="5002947">id</span><span class="op" id="5002949">(</span><span class="op" id="5002950">)</span><span class="op" id="5002951">}</span><span class="op" id="5002952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5002956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002960">return</span>&nbsp;<span class="ident" id="5002967">st</span><span class="op" id="5002969">,</span>&nbsp;<span class="ident" id="5002971">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002977">default</span><span class="op" id="5002984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5002988">return</span>&nbsp;<span class="ident" id="5002995">nil</span><span class="op" id="5002998">,</span>&nbsp;<span class="ident" id="5003000">errors</span><span class="op" id="5003006">.</span><span class="ident" id="5003007">New</span><span class="op" id="5003010">(</span><span class="string" id="5003011">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="5003051">+</span>&nbsp;<span class="ident" id="5003053">rt</span><span class="op" id="5003055">.</span><span class="ident" id="5003056">String</span><span class="op" id="5003062">(</span><span class="op" id="5003063">)</span><span class="op" id="5003064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5003067">}</span><br>
<span class="lineno"></span><span class="op" id="5003069">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="5003072">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="5003143">func</span>&nbsp;<span class="ident" id="5003148">isExported</span><span class="op" id="5003158">(</span><span class="ident" id="5003159">name</span>&nbsp;<span class="builtintype" id="5003164">string</span><span class="op" id="5003170">)</span>&nbsp;<span class="builtintype" id="5003172">bool</span>&nbsp;<span class="op" id="5003177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5003180">rune</span><span class="op" id="5003184">,</span>&nbsp;<span class="ident" id="5003186">_</span>&nbsp;<span class="op" id="5003188">:=</span>&nbsp;<span class="ident" id="5003191">utf8</span><span class="op" id="5003195">.</span><span class="ident" id="5003196">DecodeRuneInString</span><span class="op" id="5003214">(</span><span class="ident" id="5003215">name</span><span class="op" id="5003219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003222">return</span>&nbsp;<span class="ident" id="5003229">unicode</span><span class="op" id="5003236">.</span><span class="ident" id="5003237">IsUpper</span><span class="op" id="5003244">(</span><span class="builtintype" id="5003245">rune</span><span class="op" id="5003249">)</span><br>
<span class="lineno">570</span><span class="op" id="5003251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5003254">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="5003320">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="5003398">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="5003429">func</span>&nbsp;<span class="ident" id="5003434">isSent</span><span class="op" id="5003440">(</span><span class="ident" id="5003441">field</span>&nbsp;<span class="op" id="5003447">*</span><span class="ident" id="5003448">reflect</span><span class="op" id="5003455">.</span><span class="ident" id="5003456">StructField</span><span class="op" id="5003467">)</span>&nbsp;<span class="builtintype" id="5003469">bool</span>&nbsp;<span class="op" id="5003474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003477">if</span>&nbsp;<span class="op" id="5003480">!</span><span class="ident" id="5003481">isExported</span><span class="op" id="5003491">(</span><span class="ident" id="5003492">field</span><span class="op" id="5003497">.</span><span class="ident" id="5003498">Name</span><span class="op" id="5003502">)</span>&nbsp;<span class="op" id="5003504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003508">return</span>&nbsp;<span class="builtintype" id="5003515">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5003522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003525">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5003595">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003643">typ</span>&nbsp;<span class="op" id="5003647">:=</span>&nbsp;<span class="ident" id="5003650">field</span><span class="op" id="5003655">.</span><span class="ident" id="5003656">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003662">for</span>&nbsp;<span class="ident" id="5003666">typ</span><span class="op" id="5003669">.</span><span class="ident" id="5003670">Kind</span><span class="op" id="5003674">(</span><span class="op" id="5003675">)</span>&nbsp;<span class="op" id="5003677">==</span>&nbsp;<span class="ident" id="5003680">reflect</span><span class="op" id="5003687">.</span><span class="ident" id="5003688">Ptr</span>&nbsp;<span class="op" id="5003692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003696">typ</span>&nbsp;<span class="op" id="5003700">=</span>&nbsp;<span class="ident" id="5003702">typ</span><span class="op" id="5003705">.</span><span class="ident" id="5003706">Elem</span><span class="op" id="5003710">(</span><span class="op" id="5003711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5003714">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003717">if</span>&nbsp;<span class="ident" id="5003720">typ</span><span class="op" id="5003723">.</span><span class="ident" id="5003724">Kind</span><span class="op" id="5003728">(</span><span class="op" id="5003729">)</span>&nbsp;<span class="op" id="5003731">==</span>&nbsp;<span class="ident" id="5003734">reflect</span><span class="op" id="5003741">.</span><span class="ident" id="5003742">Chan</span>&nbsp;<span class="op" id="5003747">||</span>&nbsp;<span class="ident" id="5003750">typ</span><span class="op" id="5003753">.</span><span class="ident" id="5003754">Kind</span><span class="op" id="5003758">(</span><span class="op" id="5003759">)</span>&nbsp;<span class="op" id="5003761">==</span>&nbsp;<span class="ident" id="5003764">reflect</span><span class="op" id="5003771">.</span><span class="ident" id="5003772">Func</span>&nbsp;<span class="op" id="5003777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003781">return</span>&nbsp;<span class="builtintype" id="5003788">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5003795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5003798">return</span>&nbsp;<span class="builtintype" id="5003805">true</span><br>
<span class="lineno"></span><span class="op" id="5003810">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="5003813">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5003896">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5003922">func</span>&nbsp;<span class="ident" id="5003927">getBaseType</span><span class="op" id="5003938">(</span><span class="ident" id="5003939">name</span>&nbsp;<span class="builtintype" id="5003944">string</span><span class="op" id="5003950">,</span>&nbsp;<span class="ident" id="5003952">rt</span>&nbsp;<span class="ident" id="5003955">reflect</span><span class="op" id="5003962">.</span><span class="ident" id="5003963">Type</span><span class="op" id="5003967">)</span>&nbsp;<span class="op" id="5003969">(</span><span class="ident" id="5003970">gobType</span><span class="op" id="5003977">,</span>&nbsp;<span class="builtintype" id="5003979">error</span><span class="op" id="5003984">)</span>&nbsp;<span class="op" id="5003986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5003989">ut</span>&nbsp;<span class="op" id="5003992">:=</span>&nbsp;<span class="ident" id="5003995">userType</span><span class="op" id="5004003">(</span><span class="ident" id="5004004">rt</span><span class="op" id="5004006">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004009">return</span>&nbsp;<span class="ident" id="5004016">getType</span><span class="op" id="5004023">(</span><span class="ident" id="5004024">name</span><span class="op" id="5004028">,</span>&nbsp;<span class="ident" id="5004030">ut</span><span class="op" id="5004032">,</span>&nbsp;<span class="ident" id="5004034">ut</span><span class="op" id="5004036">.</span><span class="ident" id="5004037">base</span><span class="op" id="5004041">)</span><br>
<span class="lineno"></span><span class="op" id="5004043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5004046">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="5004113">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="5004174">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5004241">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="5004272">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="5004298">func</span>&nbsp;<span class="ident" id="5004303">getType</span><span class="op" id="5004310">(</span><span class="ident" id="5004311">name</span>&nbsp;<span class="builtintype" id="5004316">string</span><span class="op" id="5004322">,</span>&nbsp;<span class="ident" id="5004324">ut</span>&nbsp;<span class="op" id="5004327">*</span><span class="ident" id="5004328">userTypeInfo</span><span class="op" id="5004340">,</span>&nbsp;<span class="ident" id="5004342">rt</span>&nbsp;<span class="ident" id="5004345">reflect</span><span class="op" id="5004352">.</span><span class="ident" id="5004353">Type</span><span class="op" id="5004357">)</span>&nbsp;<span class="op" id="5004359">(</span><span class="ident" id="5004360">gobType</span><span class="op" id="5004367">,</span>&nbsp;<span class="builtintype" id="5004369">error</span><span class="op" id="5004374">)</span>&nbsp;<span class="op" id="5004376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004379">typ</span><span class="op" id="5004382">,</span>&nbsp;<span class="ident" id="5004384">present</span>&nbsp;<span class="op" id="5004392">:=</span>&nbsp;<span class="ident" id="5004395">types</span><span class="op" id="5004400">[</span><span class="ident" id="5004401">rt</span><span class="op" id="5004403">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004406">if</span>&nbsp;<span class="ident" id="5004409">present</span>&nbsp;<span class="op" id="5004417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004421">return</span>&nbsp;<span class="ident" id="5004428">typ</span><span class="op" id="5004431">,</span>&nbsp;<span class="ident" id="5004433">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004441">typ</span><span class="op" id="5004444">,</span>&nbsp;<span class="ident" id="5004446">err</span>&nbsp;<span class="op" id="5004450">:=</span>&nbsp;<span class="ident" id="5004453">newTypeObject</span><span class="op" id="5004466">(</span><span class="ident" id="5004467">name</span><span class="op" id="5004471">,</span>&nbsp;<span class="ident" id="5004473">ut</span><span class="op" id="5004475">,</span>&nbsp;<span class="ident" id="5004477">rt</span><span class="op" id="5004479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004482">if</span>&nbsp;<span class="ident" id="5004485">err</span>&nbsp;<span class="op" id="5004489">==</span>&nbsp;<span class="ident" id="5004492">nil</span>&nbsp;<span class="op" id="5004496">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004500">types</span><span class="op" id="5004505">[</span><span class="ident" id="5004506">rt</span><span class="op" id="5004508">]</span>&nbsp;<span class="op" id="5004510">=</span>&nbsp;<span class="ident" id="5004512">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004520">return</span>&nbsp;<span class="ident" id="5004527">typ</span><span class="op" id="5004530">,</span>&nbsp;<span class="ident" id="5004532">err</span><br>
<span class="lineno"></span><span class="op" id="5004536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="5004539">func</span>&nbsp;<span class="ident" id="5004544">checkId</span><span class="op" id="5004551">(</span><span class="ident" id="5004552">want</span><span class="op" id="5004556">,</span>&nbsp;<span class="ident" id="5004558">got</span>&nbsp;<span class="ident" id="5004562">typeId</span><span class="op" id="5004568">)</span>&nbsp;<span class="op" id="5004570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5004573">if</span>&nbsp;<span class="ident" id="5004576">want</span>&nbsp;<span class="op" id="5004581">!=</span>&nbsp;<span class="ident" id="5004584">got</span>&nbsp;<span class="op" id="5004588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004592">fmt</span><span class="op" id="5004595">.</span><span class="ident" id="5004596">Fprintf</span><span class="op" id="5004603">(</span><span class="ident" id="5004604">os</span><span class="op" id="5004606">.</span><span class="ident" id="5004607">Stderr</span><span class="op" id="5004613">,</span>&nbsp;<span class="string" id="5004615">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="5004643">,</span>&nbsp;<span class="builtintype" id="5004645">int</span><span class="op" id="5004648">(</span><span class="ident" id="5004649">got</span><span class="op" id="5004652">)</span><span class="op" id="5004653">,</span>&nbsp;<span class="builtintype" id="5004655">int</span><span class="op" id="5004658">(</span><span class="ident" id="5004659">want</span><span class="op" id="5004663">)</span><span class="op" id="5004664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5004668">panic</span><span class="op" id="5004673">(</span><span class="string" id="5004674">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="5004702">+</span>&nbsp;<span class="ident" id="5004704">got</span><span class="op" id="5004707">.</span><span class="ident" id="5004708">name</span><span class="op" id="5004712">(</span><span class="op" id="5004713">)</span>&nbsp;<span class="op" id="5004715">+</span>&nbsp;<span class="string" id="5004717">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5004721">+</span>&nbsp;<span class="ident" id="5004723">got</span><span class="op" id="5004726">.</span><span class="builtintype" id="5004727">string</span><span class="op" id="5004733">(</span><span class="op" id="5004734">)</span>&nbsp;<span class="op" id="5004736">+</span>&nbsp;<span class="string" id="5004738">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="5004746">+</span>&nbsp;<span class="ident" id="5004748">want</span><span class="op" id="5004752">.</span><span class="builtintype" id="5004753">string</span><span class="op" id="5004759">(</span><span class="op" id="5004760">)</span><span class="op" id="5004761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5004764">}</span><br>
<span class="lineno">620</span><span class="op" id="5004766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5004769">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5004846">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="5004887">func</span>&nbsp;<span class="ident" id="5004892">bootstrapType</span><span class="op" id="5004905">(</span><span class="ident" id="5004906">name</span>&nbsp;<span class="builtintype" id="5004911">string</span><span class="op" id="5004917">,</span>&nbsp;<span class="ident" id="5004919">e</span>&nbsp;<span class="keyword" id="5004921">interface</span><span class="op" id="5004930">{</span><span class="op" id="5004931">}</span><span class="op" id="5004932">,</span>&nbsp;<span class="ident" id="5004934">expect</span>&nbsp;<span class="ident" id="5004941">typeId</span><span class="op" id="5004947">)</span>&nbsp;<span class="ident" id="5004949">typeId</span>&nbsp;<span class="op" id="5004956">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004959">rt</span>&nbsp;<span class="op" id="5004962">:=</span>&nbsp;<span class="ident" id="5004965">reflect</span><span class="op" id="5004972">.</span><span class="ident" id="5004973">TypeOf</span><span class="op" id="5004979">(</span><span class="ident" id="5004980">e</span><span class="op" id="5004981">)</span><span class="op" id="5004982">.</span><span class="ident" id="5004983">Elem</span><span class="op" id="5004987">(</span><span class="op" id="5004988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5004991">_</span><span class="op" id="5004992">,</span>&nbsp;<span class="ident" id="5004994">present</span>&nbsp;<span class="op" id="5005002">:=</span>&nbsp;<span class="ident" id="5005005">types</span><span class="op" id="5005010">[</span><span class="ident" id="5005011">rt</span><span class="op" id="5005013">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005016">if</span>&nbsp;<span class="ident" id="5005019">present</span>&nbsp;<span class="op" id="5005027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5005031">panic</span><span class="op" id="5005036">(</span><span class="string" id="5005037">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="5005072">+</span>&nbsp;<span class="ident" id="5005074">name</span>&nbsp;<span class="op" id="5005079">+</span>&nbsp;<span class="string" id="5005081">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="5005086">+</span>&nbsp;<span class="ident" id="5005088">rt</span><span class="op" id="5005090">.</span><span class="ident" id="5005091">String</span><span class="op" id="5005097">(</span><span class="op" id="5005098">)</span><span class="op" id="5005099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005102">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005105">typ</span>&nbsp;<span class="op" id="5005109">:=</span>&nbsp;<span class="op" id="5005112">&amp;</span><span class="ident" id="5005113">CommonType</span><span class="op" id="5005123">{</span><span class="ident" id="5005124">Name</span><span class="op" id="5005128">:</span>&nbsp;<span class="ident" id="5005130">name</span><span class="op" id="5005134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005137">types</span><span class="op" id="5005142">[</span><span class="ident" id="5005143">rt</span><span class="op" id="5005145">]</span>&nbsp;<span class="op" id="5005147">=</span>&nbsp;<span class="ident" id="5005149">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005154">setTypeId</span><span class="op" id="5005163">(</span><span class="ident" id="5005164">typ</span><span class="op" id="5005167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005170">checkId</span><span class="op" id="5005177">(</span><span class="ident" id="5005178">expect</span><span class="op" id="5005184">,</span>&nbsp;<span class="ident" id="5005186">nextId</span><span class="op" id="5005192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005195">userType</span><span class="op" id="5005203">(</span><span class="ident" id="5005204">rt</span><span class="op" id="5005206">)</span>&nbsp;<span class="comment" id="5005208">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5005239">return</span>&nbsp;<span class="ident" id="5005246">nextId</span><br>
<span class="lineno"></span><span class="op" id="5005253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5005256">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="5005330">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="5005404">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="5005478">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="5005498">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="5005568">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="5005645">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="5005719">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="5005791">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="5005836">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="5005909">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="5005933">type</span>&nbsp;<span class="ident" id="5005938">wireType</span>&nbsp;<span class="keyword" id="5005947">struct</span>&nbsp;<span class="op" id="5005954">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005957">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5005974">*</span><span class="ident" id="5005975">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5005986">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006003">*</span><span class="ident" id="5006004">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006015">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006032">*</span><span class="ident" id="5006033">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006045">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006062">*</span><span class="ident" id="5006063">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006072">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006089">*</span><span class="ident" id="5006090">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006106">BinaryMarshalerT</span>&nbsp;<span class="op" id="5006123">*</span><span class="ident" id="5006124">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006140">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5006157">*</span><span class="ident" id="5006158">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="5006173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006176">func</span>&nbsp;<span class="op" id="5006181">(</span><span class="ident" id="5006182">w</span>&nbsp;<span class="op" id="5006184">*</span><span class="ident" id="5006185">wireType</span><span class="op" id="5006193">)</span>&nbsp;<span class="builtintype" id="5006195">string</span><span class="op" id="5006201">(</span><span class="op" id="5006202">)</span>&nbsp;<span class="builtintype" id="5006204">string</span>&nbsp;<span class="op" id="5006211">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006214">const</span>&nbsp;<span class="ident" id="5006220">unknown</span>&nbsp;<span class="op" id="5006228">=</span>&nbsp;<span class="string" id="5006230">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006246">if</span>&nbsp;<span class="ident" id="5006249">w</span>&nbsp;<span class="op" id="5006251">==</span>&nbsp;<span class="ident" id="5006254">nil</span>&nbsp;<span class="op" id="5006258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006262">return</span>&nbsp;<span class="ident" id="5006269">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006281">switch</span>&nbsp;<span class="op" id="5006288">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006291">case</span>&nbsp;<span class="ident" id="5006296">w</span><span class="op" id="5006297">.</span><span class="ident" id="5006298">ArrayT</span>&nbsp;<span class="op" id="5006305">!=</span>&nbsp;<span class="ident" id="5006308">nil</span><span class="op" id="5006311">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006315">return</span>&nbsp;<span class="ident" id="5006322">w</span><span class="op" id="5006323">.</span><span class="ident" id="5006324">ArrayT</span><span class="op" id="5006330">.</span><span class="ident" id="5006331">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006337">case</span>&nbsp;<span class="ident" id="5006342">w</span><span class="op" id="5006343">.</span><span class="ident" id="5006344">SliceT</span>&nbsp;<span class="op" id="5006351">!=</span>&nbsp;<span class="ident" id="5006354">nil</span><span class="op" id="5006357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006361">return</span>&nbsp;<span class="ident" id="5006368">w</span><span class="op" id="5006369">.</span><span class="ident" id="5006370">SliceT</span><span class="op" id="5006376">.</span><span class="ident" id="5006377">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006383">case</span>&nbsp;<span class="ident" id="5006388">w</span><span class="op" id="5006389">.</span><span class="ident" id="5006390">StructT</span>&nbsp;<span class="op" id="5006398">!=</span>&nbsp;<span class="ident" id="5006401">nil</span><span class="op" id="5006404">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006408">return</span>&nbsp;<span class="ident" id="5006415">w</span><span class="op" id="5006416">.</span><span class="ident" id="5006417">StructT</span><span class="op" id="5006424">.</span><span class="ident" id="5006425">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006431">case</span>&nbsp;<span class="ident" id="5006436">w</span><span class="op" id="5006437">.</span><span class="ident" id="5006438">MapT</span>&nbsp;<span class="op" id="5006443">!=</span>&nbsp;<span class="ident" id="5006446">nil</span><span class="op" id="5006449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006453">return</span>&nbsp;<span class="ident" id="5006460">w</span><span class="op" id="5006461">.</span><span class="ident" id="5006462">MapT</span><span class="op" id="5006466">.</span><span class="ident" id="5006467">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006473">case</span>&nbsp;<span class="ident" id="5006478">w</span><span class="op" id="5006479">.</span><span class="ident" id="5006480">GobEncoderT</span>&nbsp;<span class="op" id="5006492">!=</span>&nbsp;<span class="ident" id="5006495">nil</span><span class="op" id="5006498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006502">return</span>&nbsp;<span class="ident" id="5006509">w</span><span class="op" id="5006510">.</span><span class="ident" id="5006511">GobEncoderT</span><span class="op" id="5006522">.</span><span class="ident" id="5006523">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006529">case</span>&nbsp;<span class="ident" id="5006534">w</span><span class="op" id="5006535">.</span><span class="ident" id="5006536">BinaryMarshalerT</span>&nbsp;<span class="op" id="5006553">!=</span>&nbsp;<span class="ident" id="5006556">nil</span><span class="op" id="5006559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006563">return</span>&nbsp;<span class="ident" id="5006570">w</span><span class="op" id="5006571">.</span><span class="ident" id="5006572">BinaryMarshalerT</span><span class="op" id="5006588">.</span><span class="ident" id="5006589">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006595">case</span>&nbsp;<span class="ident" id="5006600">w</span><span class="op" id="5006601">.</span><span class="ident" id="5006602">TextMarshalerT</span>&nbsp;<span class="op" id="5006617">!=</span>&nbsp;<span class="ident" id="5006620">nil</span><span class="op" id="5006623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006627">return</span>&nbsp;<span class="ident" id="5006634">w</span><span class="op" id="5006635">.</span><span class="ident" id="5006636">TextMarshalerT</span><span class="op" id="5006650">.</span><span class="ident" id="5006651">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006657">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5006660">return</span>&nbsp;<span class="ident" id="5006667">unknown</span><br>
<span class="lineno"></span><span class="op" id="5006675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5006678">type</span>&nbsp;<span class="ident" id="5006683">typeInfo</span>&nbsp;<span class="keyword" id="5006692">struct</span>&nbsp;<span class="op" id="5006699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006702">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006710">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006718">encInit</span>&nbsp;<span class="ident" id="5006726">sync</span><span class="op" id="5006730">.</span><span class="ident" id="5006731">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5006739">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006772">encoder</span>&nbsp;<span class="ident" id="5006780">atomic</span><span class="op" id="5006786">.</span><span class="ident" id="5006787">Value</span>&nbsp;<span class="comment" id="5006793">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5006808">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5006816">*</span><span class="ident" id="5006817">wireType</span><br>
<span class="lineno"></span><span class="op" id="5006826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="5006829">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="5006896">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="5006958">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5007028">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5007098">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="5007170">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="5007195">var</span>&nbsp;<span class="ident" id="5007199">typeInfoMap</span>&nbsp;<span class="ident" id="5007211">atomic</span><span class="op" id="5007217">.</span><span class="ident" id="5007218">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007225">func</span>&nbsp;<span class="ident" id="5007230">lookupTypeInfo</span><span class="op" id="5007244">(</span><span class="ident" id="5007245">rt</span>&nbsp;<span class="ident" id="5007248">reflect</span><span class="op" id="5007255">.</span><span class="ident" id="5007256">Type</span><span class="op" id="5007260">)</span>&nbsp;<span class="op" id="5007262">*</span><span class="ident" id="5007263">typeInfo</span>&nbsp;<span class="op" id="5007272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007275">m</span><span class="op" id="5007276">,</span>&nbsp;<span class="ident" id="5007278">_</span>&nbsp;<span class="op" id="5007280">:=</span>&nbsp;<span class="ident" id="5007283">typeInfoMap</span><span class="op" id="5007294">.</span><span class="ident" id="5007295">Load</span><span class="op" id="5007299">(</span><span class="op" id="5007300">)</span><span class="op" id="5007301">.</span><span class="op" id="5007302">(</span><span class="keyword" id="5007303">map</span><span class="op" id="5007306">[</span><span class="ident" id="5007307">reflect</span><span class="op" id="5007314">.</span><span class="ident" id="5007315">Type</span><span class="op" id="5007319">]</span><span class="op" id="5007320">*</span><span class="ident" id="5007321">typeInfo</span><span class="op" id="5007329">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007332">return</span>&nbsp;<span class="ident" id="5007339">m</span><span class="op" id="5007340">[</span><span class="ident" id="5007341">rt</span><span class="op" id="5007343">]</span><br>
<span class="lineno"></span><span class="op" id="5007345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5007348">func</span>&nbsp;<span class="ident" id="5007353">getTypeInfo</span><span class="op" id="5007364">(</span><span class="ident" id="5007365">ut</span>&nbsp;<span class="op" id="5007368">*</span><span class="ident" id="5007369">userTypeInfo</span><span class="op" id="5007381">)</span>&nbsp;<span class="op" id="5007383">(</span><span class="op" id="5007384">*</span><span class="ident" id="5007385">typeInfo</span><span class="op" id="5007393">,</span>&nbsp;<span class="builtintype" id="5007395">error</span><span class="op" id="5007400">)</span>&nbsp;<span class="op" id="5007402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007405">rt</span>&nbsp;<span class="op" id="5007408">:=</span>&nbsp;<span class="ident" id="5007411">ut</span><span class="op" id="5007413">.</span><span class="ident" id="5007414">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007420">if</span>&nbsp;<span class="ident" id="5007423">ut</span><span class="op" id="5007425">.</span><span class="ident" id="5007426">externalEnc</span>&nbsp;<span class="op" id="5007438">!=</span>&nbsp;<span class="num" id="5007441">0</span>&nbsp;<span class="op" id="5007443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5007447">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007494">rt</span>&nbsp;<span class="op" id="5007497">=</span>&nbsp;<span class="ident" id="5007499">ut</span><span class="op" id="5007501">.</span><span class="ident" id="5007502">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007511">if</span>&nbsp;<span class="ident" id="5007514">info</span>&nbsp;<span class="op" id="5007519">:=</span>&nbsp;<span class="ident" id="5007522">lookupTypeInfo</span><span class="op" id="5007536">(</span><span class="ident" id="5007537">rt</span><span class="op" id="5007539">)</span><span class="op" id="5007540">;</span>&nbsp;<span class="ident" id="5007542">info</span>&nbsp;<span class="op" id="5007547">!=</span>&nbsp;<span class="ident" id="5007550">nil</span>&nbsp;<span class="op" id="5007554">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007558">return</span>&nbsp;<span class="ident" id="5007565">info</span><span class="op" id="5007569">,</span>&nbsp;<span class="ident" id="5007571">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007579">return</span>&nbsp;<span class="ident" id="5007586">buildTypeInfo</span><span class="op" id="5007599">(</span><span class="ident" id="5007600">ut</span><span class="op" id="5007602">,</span>&nbsp;<span class="ident" id="5007604">rt</span><span class="op" id="5007606">)</span><br>
<span class="lineno"></span><span class="op" id="5007608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="5007611">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5007673">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="5007712">func</span>&nbsp;<span class="ident" id="5007717">buildTypeInfo</span><span class="op" id="5007730">(</span><span class="ident" id="5007731">ut</span>&nbsp;<span class="op" id="5007734">*</span><span class="ident" id="5007735">userTypeInfo</span><span class="op" id="5007747">,</span>&nbsp;<span class="ident" id="5007749">rt</span>&nbsp;<span class="ident" id="5007752">reflect</span><span class="op" id="5007759">.</span><span class="ident" id="5007760">Type</span><span class="op" id="5007764">)</span>&nbsp;<span class="op" id="5007766">(</span><span class="op" id="5007767">*</span><span class="ident" id="5007768">typeInfo</span><span class="op" id="5007776">,</span>&nbsp;<span class="builtintype" id="5007778">error</span><span class="op" id="5007783">)</span>&nbsp;<span class="op" id="5007785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007788">typeLock</span><span class="op" id="5007796">.</span><span class="ident" id="5007797">Lock</span><span class="op" id="5007801">(</span><span class="op" id="5007802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007805">defer</span>&nbsp;<span class="ident" id="5007811">typeLock</span><span class="op" id="5007819">.</span><span class="ident" id="5007820">Unlock</span><span class="op" id="5007826">(</span><span class="op" id="5007827">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007831">if</span>&nbsp;<span class="ident" id="5007834">info</span>&nbsp;<span class="op" id="5007839">:=</span>&nbsp;<span class="ident" id="5007842">lookupTypeInfo</span><span class="op" id="5007856">(</span><span class="ident" id="5007857">rt</span><span class="op" id="5007859">)</span><span class="op" id="5007860">;</span>&nbsp;<span class="ident" id="5007862">info</span>&nbsp;<span class="op" id="5007867">!=</span>&nbsp;<span class="ident" id="5007870">nil</span>&nbsp;<span class="op" id="5007874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007878">return</span>&nbsp;<span class="ident" id="5007885">info</span><span class="op" id="5007889">,</span>&nbsp;<span class="ident" id="5007891">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007900">gt</span><span class="op" id="5007902">,</span>&nbsp;<span class="ident" id="5007904">err</span>&nbsp;<span class="op" id="5007908">:=</span>&nbsp;<span class="ident" id="5007911">getBaseType</span><span class="op" id="5007922">(</span><span class="ident" id="5007923">rt</span><span class="op" id="5007925">.</span><span class="ident" id="5007926">Name</span><span class="op" id="5007930">(</span><span class="op" id="5007931">)</span><span class="op" id="5007932">,</span>&nbsp;<span class="ident" id="5007934">rt</span><span class="op" id="5007936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007939">if</span>&nbsp;<span class="ident" id="5007942">err</span>&nbsp;<span class="op" id="5007946">!=</span>&nbsp;<span class="ident" id="5007949">nil</span>&nbsp;<span class="op" id="5007953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5007957">return</span>&nbsp;<span class="ident" id="5007964">nil</span><span class="op" id="5007967">,</span>&nbsp;<span class="ident" id="5007969">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5007974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5007977">info</span>&nbsp;<span class="op" id="5007982">:=</span>&nbsp;<span class="op" id="5007985">&amp;</span><span class="ident" id="5007986">typeInfo</span><span class="op" id="5007994">{</span><span class="ident" id="5007995">id</span><span class="op" id="5007997">:</span>&nbsp;<span class="ident" id="5007999">gt</span><span class="op" id="5008001">.</span><span class="ident" id="5008002">id</span><span class="op" id="5008004">(</span><span class="op" id="5008005">)</span><span class="op" id="5008006">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008010">if</span>&nbsp;<span class="ident" id="5008013">ut</span><span class="op" id="5008015">.</span><span class="ident" id="5008016">externalEnc</span>&nbsp;<span class="op" id="5008028">!=</span>&nbsp;<span class="num" id="5008031">0</span>&nbsp;<span class="op" id="5008033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008037">userType</span><span class="op" id="5008045">,</span>&nbsp;<span class="ident" id="5008047">err</span>&nbsp;<span class="op" id="5008051">:=</span>&nbsp;<span class="ident" id="5008054">getType</span><span class="op" id="5008061">(</span><span class="ident" id="5008062">rt</span><span class="op" id="5008064">.</span><span class="ident" id="5008065">Name</span><span class="op" id="5008069">(</span><span class="op" id="5008070">)</span><span class="op" id="5008071">,</span>&nbsp;<span class="ident" id="5008073">ut</span><span class="op" id="5008075">,</span>&nbsp;<span class="ident" id="5008077">rt</span><span class="op" id="5008079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008083">if</span>&nbsp;<span class="ident" id="5008086">err</span>&nbsp;<span class="op" id="5008090">!=</span>&nbsp;<span class="ident" id="5008093">nil</span>&nbsp;<span class="op" id="5008097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008102">return</span>&nbsp;<span class="ident" id="5008109">nil</span><span class="op" id="5008112">,</span>&nbsp;<span class="ident" id="5008114">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008124">gt</span>&nbsp;<span class="op" id="5008127">:=</span>&nbsp;<span class="ident" id="5008130">userType</span><span class="op" id="5008138">.</span><span class="ident" id="5008139">id</span><span class="op" id="5008141">(</span><span class="op" id="5008142">)</span><span class="op" id="5008143">.</span><span class="ident" id="5008144">gobType</span><span class="op" id="5008151">(</span><span class="op" id="5008152">)</span><span class="op" id="5008153">.</span><span class="op" id="5008154">(</span><span class="op" id="5008155">*</span><span class="ident" id="5008156">gobEncoderType</span><span class="op" id="5008170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008174">switch</span>&nbsp;<span class="ident" id="5008181">ut</span><span class="op" id="5008183">.</span><span class="ident" id="5008184">externalEnc</span>&nbsp;<span class="op" id="5008196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008200">case</span>&nbsp;<span class="ident" id="5008205">xGob</span><span class="op" id="5008209">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008214">info</span><span class="op" id="5008218">.</span><span class="ident" id="5008219">wire</span>&nbsp;<span class="op" id="5008224">=</span>&nbsp;<span class="op" id="5008226">&amp;</span><span class="ident" id="5008227">wireType</span><span class="op" id="5008235">{</span><span class="ident" id="5008236">GobEncoderT</span><span class="op" id="5008247">:</span>&nbsp;<span class="ident" id="5008249">gt</span><span class="op" id="5008251">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008255">case</span>&nbsp;<span class="ident" id="5008260">xBinary</span><span class="op" id="5008267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008272">info</span><span class="op" id="5008276">.</span><span class="ident" id="5008277">wire</span>&nbsp;<span class="op" id="5008282">=</span>&nbsp;<span class="op" id="5008284">&amp;</span><span class="ident" id="5008285">wireType</span><span class="op" id="5008293">{</span><span class="ident" id="5008294">BinaryMarshalerT</span><span class="op" id="5008310">:</span>&nbsp;<span class="ident" id="5008312">gt</span><span class="op" id="5008314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008318">case</span>&nbsp;<span class="ident" id="5008323">xText</span><span class="op" id="5008328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008333">info</span><span class="op" id="5008337">.</span><span class="ident" id="5008338">wire</span>&nbsp;<span class="op" id="5008343">=</span>&nbsp;<span class="op" id="5008345">&amp;</span><span class="ident" id="5008346">wireType</span><span class="op" id="5008354">{</span><span class="ident" id="5008355">TextMarshalerT</span><span class="op" id="5008369">:</span>&nbsp;<span class="ident" id="5008371">gt</span><span class="op" id="5008373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008377">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008381">rt</span>&nbsp;<span class="op" id="5008384">=</span>&nbsp;<span class="ident" id="5008386">ut</span><span class="op" id="5008388">.</span><span class="ident" id="5008389">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008395">}</span>&nbsp;<span class="keyword" id="5008397">else</span>&nbsp;<span class="op" id="5008402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008406">t</span>&nbsp;<span class="op" id="5008408">:=</span>&nbsp;<span class="ident" id="5008411">info</span><span class="op" id="5008415">.</span><span class="ident" id="5008416">id</span><span class="op" id="5008418">.</span><span class="ident" id="5008419">gobType</span><span class="op" id="5008426">(</span><span class="op" id="5008427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008431">switch</span>&nbsp;<span class="ident" id="5008438">typ</span>&nbsp;<span class="op" id="5008442">:=</span>&nbsp;<span class="ident" id="5008445">rt</span><span class="op" id="5008447">;</span>&nbsp;<span class="ident" id="5008449">typ</span><span class="op" id="5008452">.</span><span class="ident" id="5008453">Kind</span><span class="op" id="5008457">(</span><span class="op" id="5008458">)</span>&nbsp;<span class="op" id="5008460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008464">case</span>&nbsp;<span class="ident" id="5008469">reflect</span><span class="op" id="5008476">.</span><span class="ident" id="5008477">Array</span><span class="op" id="5008482">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008487">info</span><span class="op" id="5008491">.</span><span class="ident" id="5008492">wire</span>&nbsp;<span class="op" id="5008497">=</span>&nbsp;<span class="op" id="5008499">&amp;</span><span class="ident" id="5008500">wireType</span><span class="op" id="5008508">{</span><span class="ident" id="5008509">ArrayT</span><span class="op" id="5008515">:</span>&nbsp;<span class="ident" id="5008517">t</span><span class="op" id="5008518">.</span><span class="op" id="5008519">(</span><span class="op" id="5008520">*</span><span class="ident" id="5008521">arrayType</span><span class="op" id="5008530">)</span><span class="op" id="5008531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008535">case</span>&nbsp;<span class="ident" id="5008540">reflect</span><span class="op" id="5008547">.</span><span class="ident" id="5008548">Map</span><span class="op" id="5008551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008556">info</span><span class="op" id="5008560">.</span><span class="ident" id="5008561">wire</span>&nbsp;<span class="op" id="5008566">=</span>&nbsp;<span class="op" id="5008568">&amp;</span><span class="ident" id="5008569">wireType</span><span class="op" id="5008577">{</span><span class="ident" id="5008578">MapT</span><span class="op" id="5008582">:</span>&nbsp;<span class="ident" id="5008584">t</span><span class="op" id="5008585">.</span><span class="op" id="5008586">(</span><span class="op" id="5008587">*</span><span class="ident" id="5008588">mapType</span><span class="op" id="5008595">)</span><span class="op" id="5008596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008600">case</span>&nbsp;<span class="ident" id="5008605">reflect</span><span class="op" id="5008612">.</span><span class="ident" id="5008613">Slice</span><span class="op" id="5008618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008623">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008684">if</span>&nbsp;<span class="ident" id="5008687">typ</span><span class="op" id="5008690">.</span><span class="ident" id="5008691">Elem</span><span class="op" id="5008695">(</span><span class="op" id="5008696">)</span><span class="op" id="5008697">.</span><span class="ident" id="5008698">Kind</span><span class="op" id="5008702">(</span><span class="op" id="5008703">)</span>&nbsp;<span class="op" id="5008705">!=</span>&nbsp;<span class="ident" id="5008708">reflect</span><span class="op" id="5008715">.</span><span class="ident" id="5008716">Uint8</span>&nbsp;<span class="op" id="5008722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008728">info</span><span class="op" id="5008732">.</span><span class="ident" id="5008733">wire</span>&nbsp;<span class="op" id="5008738">=</span>&nbsp;<span class="op" id="5008740">&amp;</span><span class="ident" id="5008741">wireType</span><span class="op" id="5008749">{</span><span class="ident" id="5008750">SliceT</span><span class="op" id="5008756">:</span>&nbsp;<span class="ident" id="5008758">t</span><span class="op" id="5008759">.</span><span class="op" id="5008760">(</span><span class="op" id="5008761">*</span><span class="ident" id="5008762">sliceType</span><span class="op" id="5008771">)</span><span class="op" id="5008772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5008781">case</span>&nbsp;<span class="ident" id="5008786">reflect</span><span class="op" id="5008793">.</span><span class="ident" id="5008794">Struct</span><span class="op" id="5008800">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008805">info</span><span class="op" id="5008809">.</span><span class="ident" id="5008810">wire</span>&nbsp;<span class="op" id="5008815">=</span>&nbsp;<span class="op" id="5008817">&amp;</span><span class="ident" id="5008818">wireType</span><span class="op" id="5008826">{</span><span class="ident" id="5008827">StructT</span><span class="op" id="5008834">:</span>&nbsp;<span class="ident" id="5008836">t</span><span class="op" id="5008837">.</span><span class="op" id="5008838">(</span><span class="op" id="5008839">*</span><span class="ident" id="5008840">structType</span><span class="op" id="5008850">)</span><span class="op" id="5008851">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5008858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5008862">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008915">newm</span>&nbsp;<span class="op" id="5008920">:=</span>&nbsp;<span class="builtinfunc" id="5008923">make</span><span class="op" id="5008927">(</span><span class="keyword" id="5008928">map</span><span class="op" id="5008931">[</span><span class="ident" id="5008932">reflect</span><span class="op" id="5008939">.</span><span class="ident" id="5008940">Type</span><span class="op" id="5008944">]</span><span class="op" id="5008945">*</span><span class="ident" id="5008946">typeInfo</span><span class="op" id="5008954">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5008957">m</span><span class="op" id="5008958">,</span>&nbsp;<span class="ident" id="5008960">_</span>&nbsp;<span class="op" id="5008962">:=</span>&nbsp;<span class="ident" id="5008965">typeInfoMap</span><span class="op" id="5008976">.</span><span class="ident" id="5008977">Load</span><span class="op" id="5008981">(</span><span class="op" id="5008982">)</span><span class="op" id="5008983">.</span><span class="op" id="5008984">(</span><span class="keyword" id="5008985">map</span><span class="op" id="5008988">[</span><span class="ident" id="5008989">reflect</span><span class="op" id="5008996">.</span><span class="ident" id="5008997">Type</span><span class="op" id="5009001">]</span><span class="op" id="5009002">*</span><span class="ident" id="5009003">typeInfo</span><span class="op" id="5009011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009014">for</span>&nbsp;<span class="ident" id="5009018">k</span><span class="op" id="5009019">,</span>&nbsp;<span class="ident" id="5009021">v</span>&nbsp;<span class="op" id="5009023">:=</span>&nbsp;<span class="keyword" id="5009026">range</span>&nbsp;<span class="ident" id="5009032">m</span>&nbsp;<span class="op" id="5009034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009038">newm</span><span class="op" id="5009042">[</span><span class="ident" id="5009043">k</span><span class="op" id="5009044">]</span>&nbsp;<span class="op" id="5009046">=</span>&nbsp;<span class="ident" id="5009048">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009054">newm</span><span class="op" id="5009058">[</span><span class="ident" id="5009059">rt</span><span class="op" id="5009061">]</span>&nbsp;<span class="op" id="5009063">=</span>&nbsp;<span class="ident" id="5009065">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009071">typeInfoMap</span><span class="op" id="5009082">.</span><span class="ident" id="5009083">Store</span><span class="op" id="5009088">(</span><span class="ident" id="5009089">newm</span><span class="op" id="5009093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009096">return</span>&nbsp;<span class="ident" id="5009103">info</span><span class="op" id="5009107">,</span>&nbsp;<span class="ident" id="5009109">nil</span><br>
<span class="lineno"></span><span class="op" id="5009113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009116">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="5009174">func</span>&nbsp;<span class="ident" id="5009179">mustGetTypeInfo</span><span class="op" id="5009194">(</span><span class="ident" id="5009195">rt</span>&nbsp;<span class="ident" id="5009198">reflect</span><span class="op" id="5009205">.</span><span class="ident" id="5009206">Type</span><span class="op" id="5009210">)</span>&nbsp;<span class="op" id="5009212">*</span><span class="ident" id="5009213">typeInfo</span>&nbsp;<span class="op" id="5009222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5009225">t</span><span class="op" id="5009226">,</span>&nbsp;<span class="ident" id="5009228">err</span>&nbsp;<span class="op" id="5009232">:=</span>&nbsp;<span class="ident" id="5009235">getTypeInfo</span><span class="op" id="5009246">(</span><span class="ident" id="5009247">userType</span><span class="op" id="5009255">(</span><span class="ident" id="5009256">rt</span><span class="op" id="5009258">)</span><span class="op" id="5009259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009262">if</span>&nbsp;<span class="ident" id="5009265">err</span>&nbsp;<span class="op" id="5009269">!=</span>&nbsp;<span class="ident" id="5009272">nil</span>&nbsp;<span class="op" id="5009276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5009280">panic</span><span class="op" id="5009285">(</span><span class="string" id="5009286">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="5009302">+</span>&nbsp;<span class="ident" id="5009304">err</span><span class="op" id="5009307">.</span><span class="ident" id="5009308">Error</span><span class="op" id="5009313">(</span><span class="op" id="5009314">)</span><span class="op" id="5009315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5009318">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5009321">return</span>&nbsp;<span class="ident" id="5009328">t</span><br>
<span class="lineno"></span><span class="op" id="5009330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5009333">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5009402">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="5009474">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="5009539">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="5009604">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5009671">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="5009726">//</span><br>
<span class="lineno">790</span><span class="comment" id="5009729">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="5009794">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5009861">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="5009931">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5009979">type</span>&nbsp;<span class="ident" id="5009984">GobEncoder</span>&nbsp;<span class="keyword" id="5009995">interface</span>&nbsp;<span class="op" id="5010005">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010008">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010076">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010143">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010162">GobEncode</span><span class="op" id="5010171">(</span><span class="op" id="5010172">)</span>&nbsp;<span class="op" id="5010174">(</span><span class="op" id="5010175">[</span><span class="op" id="5010176">]</span><span class="builtintype" id="5010177">byte</span><span class="op" id="5010181">,</span>&nbsp;<span class="builtintype" id="5010183">error</span><span class="op" id="5010188">)</span><br>
<span class="lineno"></span><span class="op" id="5010190">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="5010193">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="5010262">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="5010327">type</span>&nbsp;<span class="ident" id="5010332">GobDecoder</span>&nbsp;<span class="keyword" id="5010343">interface</span>&nbsp;<span class="op" id="5010353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010356">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010420">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010488">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010542">GobDecode</span><span class="op" id="5010551">(</span><span class="op" id="5010552">[</span><span class="op" id="5010553">]</span><span class="builtintype" id="5010554">byte</span><span class="op" id="5010558">)</span>&nbsp;<span class="builtintype" id="5010560">error</span><br>
<span class="lineno"></span><span class="op" id="5010566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5010569">var</span>&nbsp;<span class="op" id="5010573">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010576">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010595">sync</span><span class="op" id="5010599">.</span><span class="ident" id="5010600">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010609">nameToConcreteType</span>&nbsp;<span class="op" id="5010628">=</span>&nbsp;<span class="builtinfunc" id="5010630">make</span><span class="op" id="5010634">(</span><span class="keyword" id="5010635">map</span><span class="op" id="5010638">[</span><span class="builtintype" id="5010639">string</span><span class="op" id="5010645">]</span><span class="ident" id="5010646">reflect</span><span class="op" id="5010653">.</span><span class="ident" id="5010654">Type</span><span class="op" id="5010658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010661">concreteTypeToName</span>&nbsp;<span class="op" id="5010680">=</span>&nbsp;<span class="builtinfunc" id="5010682">make</span><span class="op" id="5010686">(</span><span class="keyword" id="5010687">map</span><span class="op" id="5010690">[</span><span class="ident" id="5010691">reflect</span><span class="op" id="5010698">.</span><span class="ident" id="5010699">Type</span><span class="op" id="5010703">]</span><span class="builtintype" id="5010704">string</span><span class="op" id="5010710">)</span><br>
<span class="lineno"></span><span class="op" id="5010712">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5010715">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5010791">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="5010810">func</span>&nbsp;<span class="ident" id="5010815">RegisterName</span><span class="op" id="5010827">(</span><span class="ident" id="5010828">name</span>&nbsp;<span class="builtintype" id="5010833">string</span><span class="op" id="5010839">,</span>&nbsp;<span class="ident" id="5010841">value</span>&nbsp;<span class="keyword" id="5010847">interface</span><span class="op" id="5010856">{</span><span class="op" id="5010857">}</span><span class="op" id="5010858">)</span>&nbsp;<span class="op" id="5010860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010863">if</span>&nbsp;<span class="ident" id="5010866">name</span>&nbsp;<span class="op" id="5010871">==</span>&nbsp;<span class="string" id="5010874">&#34;&#34;</span>&nbsp;<span class="op" id="5010877">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5010881">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5010903">panic</span><span class="op" id="5010908">(</span><span class="string" id="5010909">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="5010941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5010944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010947">registerLock</span><span class="op" id="5010959">.</span><span class="ident" id="5010960">Lock</span><span class="op" id="5010964">(</span><span class="op" id="5010965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5010968">defer</span>&nbsp;<span class="ident" id="5010974">registerLock</span><span class="op" id="5010986">.</span><span class="ident" id="5010987">Unlock</span><span class="op" id="5010993">(</span><span class="op" id="5010994">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5010997">ut</span>&nbsp;<span class="op" id="5011000">:=</span>&nbsp;<span class="ident" id="5011003">userType</span><span class="op" id="5011011">(</span><span class="ident" id="5011012">reflect</span><span class="op" id="5011019">.</span><span class="ident" id="5011020">TypeOf</span><span class="op" id="5011026">(</span><span class="ident" id="5011027">value</span><span class="op" id="5011032">)</span><span class="op" id="5011033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011036">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011102">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011138">if</span>&nbsp;<span class="ident" id="5011141">t</span><span class="op" id="5011142">,</span>&nbsp;<span class="ident" id="5011144">ok</span>&nbsp;<span class="op" id="5011147">:=</span>&nbsp;<span class="ident" id="5011150">nameToConcreteType</span><span class="op" id="5011168">[</span><span class="ident" id="5011169">name</span><span class="op" id="5011173">]</span><span class="op" id="5011174">;</span>&nbsp;<span class="ident" id="5011176">ok</span>&nbsp;<span class="op" id="5011179">&amp;&amp;</span>&nbsp;<span class="ident" id="5011182">t</span>&nbsp;<span class="op" id="5011184">!=</span>&nbsp;<span class="ident" id="5011187">ut</span><span class="op" id="5011189">.</span><span class="ident" id="5011190">user</span>&nbsp;<span class="op" id="5011195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5011199">panic</span><span class="op" id="5011204">(</span><span class="ident" id="5011205">fmt</span><span class="op" id="5011208">.</span><span class="ident" id="5011209">Sprintf</span><span class="op" id="5011216">(</span><span class="string" id="5011217">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="5011268">,</span>&nbsp;<span class="ident" id="5011270">name</span><span class="op" id="5011274">,</span>&nbsp;<span class="ident" id="5011276">t</span><span class="op" id="5011277">,</span>&nbsp;<span class="ident" id="5011279">ut</span><span class="op" id="5011281">.</span><span class="ident" id="5011282">user</span><span class="op" id="5011286">)</span><span class="op" id="5011287">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5011293">if</span>&nbsp;<span class="ident" id="5011296">n</span><span class="op" id="5011297">,</span>&nbsp;<span class="ident" id="5011299">ok</span>&nbsp;<span class="op" id="5011302">:=</span>&nbsp;<span class="ident" id="5011305">concreteTypeToName</span><span class="op" id="5011323">[</span><span class="ident" id="5011324">ut</span><span class="op" id="5011326">.</span><span class="ident" id="5011327">base</span><span class="op" id="5011331">]</span><span class="op" id="5011332">;</span>&nbsp;<span class="ident" id="5011334">ok</span>&nbsp;<span class="op" id="5011337">&amp;&amp;</span>&nbsp;<span class="ident" id="5011340">n</span>&nbsp;<span class="op" id="5011342">!=</span>&nbsp;<span class="ident" id="5011345">name</span>&nbsp;<span class="op" id="5011350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5011354">panic</span><span class="op" id="5011359">(</span><span class="ident" id="5011360">fmt</span><span class="op" id="5011363">.</span><span class="ident" id="5011364">Sprintf</span><span class="op" id="5011371">(</span><span class="string" id="5011372">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="5011423">,</span>&nbsp;<span class="ident" id="5011425">ut</span><span class="op" id="5011427">.</span><span class="ident" id="5011428">user</span><span class="op" id="5011432">,</span>&nbsp;<span class="ident" id="5011434">n</span><span class="op" id="5011435">,</span>&nbsp;<span class="ident" id="5011437">name</span><span class="op" id="5011441">)</span><span class="op" id="5011442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5011445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011448">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011501">nameToConcreteType</span><span class="op" id="5011519">[</span><span class="ident" id="5011520">name</span><span class="op" id="5011524">]</span>&nbsp;<span class="op" id="5011526">=</span>&nbsp;<span class="ident" id="5011528">reflect</span><span class="op" id="5011535">.</span><span class="ident" id="5011536">TypeOf</span><span class="op" id="5011542">(</span><span class="ident" id="5011543">value</span><span class="op" id="5011548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5011551">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5011629">concreteTypeToName</span><span class="op" id="5011647">[</span><span class="ident" id="5011648">ut</span><span class="op" id="5011650">.</span><span class="ident" id="5011651">base</span><span class="op" id="5011655">]</span>&nbsp;<span class="op" id="5011657">=</span>&nbsp;<span class="ident" id="5011659">name</span><br>
<span class="lineno"></span><span class="op" id="5011664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="5011667">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5011742">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5011819">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5011890">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="5011967">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="5012044">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="5012091">func</span>&nbsp;<span class="ident" id="5012096">Register</span><span class="op" id="5012104">(</span><span class="ident" id="5012105">value</span>&nbsp;<span class="keyword" id="5012111">interface</span><span class="op" id="5012120">{</span><span class="op" id="5012121">}</span><span class="op" id="5012122">)</span>&nbsp;<span class="op" id="5012124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012127">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012183">rt</span>&nbsp;<span class="op" id="5012186">:=</span>&nbsp;<span class="ident" id="5012189">reflect</span><span class="op" id="5012196">.</span><span class="ident" id="5012197">TypeOf</span><span class="op" id="5012203">(</span><span class="ident" id="5012204">value</span><span class="op" id="5012209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012212">name</span>&nbsp;<span class="op" id="5012217">:=</span>&nbsp;<span class="ident" id="5012220">rt</span><span class="op" id="5012222">.</span><span class="ident" id="5012223">String</span><span class="op" id="5012229">(</span><span class="op" id="5012230">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012234">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012331">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012385">star</span>&nbsp;<span class="op" id="5012390">:=</span>&nbsp;<span class="string" id="5012393">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012397">if</span>&nbsp;<span class="ident" id="5012400">rt</span><span class="op" id="5012402">.</span><span class="ident" id="5012403">Name</span><span class="op" id="5012407">(</span><span class="op" id="5012408">)</span>&nbsp;<span class="op" id="5012410">==</span>&nbsp;<span class="string" id="5012413">&#34;&#34;</span>&nbsp;<span class="op" id="5012416">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5012420">if</span>&nbsp;<span class="ident" id="5012423">pt</span>&nbsp;<span class="op" id="5012426">:=</span>&nbsp;<span class="ident" id="5012429">rt</span><span class="op" id="5012431">;</span>&nbsp;<span class="ident" id="5012433">pt</span><span class="op" id="5012435">.</span><span class="ident" id="5012436">Kind</span><span class="op" id="5012440">(</span><span class="op" id="5012441">)</span>&nbsp;<span class="op" id="5012443">==</span>&nbsp;<span class="ident" id="5012446">reflect</span><span class="op" id="5012453">.</span><span class="ident" id="5012454">Ptr</span>&nbsp;<span class="op" id="5012458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5012463">star</span>&nbsp;<span class="op" id="5012468">=</span>&nbsp;<span class="string" id="5012470">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012477">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012546">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012623">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012649">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012655">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012722">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012742">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012775">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012845">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012867">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012873">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012922">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012928">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5012973">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013014">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5013020">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013104">rt</span>&nbsp;<span class="op" id="5013107">=</span>&nbsp;<span class="ident" id="5013109">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013114">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013120">if</span>&nbsp;<span class="ident" id="5013123">rt</span><span class="op" id="5013125">.</span><span class="ident" id="5013126">Name</span><span class="op" id="5013130">(</span><span class="op" id="5013131">)</span>&nbsp;<span class="op" id="5013133">!=</span>&nbsp;<span class="string" id="5013136">&#34;&#34;</span>&nbsp;<span class="op" id="5013139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5013143">if</span>&nbsp;<span class="ident" id="5013146">rt</span><span class="op" id="5013148">.</span><span class="ident" id="5013149">PkgPath</span><span class="op" id="5013156">(</span><span class="op" id="5013157">)</span>&nbsp;<span class="op" id="5013159">==</span>&nbsp;<span class="string" id="5013162">&#34;&#34;</span>&nbsp;<span class="op" id="5013165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013170">name</span>&nbsp;<span class="op" id="5013175">=</span>&nbsp;<span class="ident" id="5013177">star</span>&nbsp;<span class="op" id="5013182">+</span>&nbsp;<span class="ident" id="5013184">rt</span><span class="op" id="5013186">.</span><span class="ident" id="5013187">Name</span><span class="op" id="5013191">(</span><span class="op" id="5013192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013196">}</span>&nbsp;<span class="keyword" id="5013198">else</span>&nbsp;<span class="op" id="5013203">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013208">name</span>&nbsp;<span class="op" id="5013213">=</span>&nbsp;<span class="ident" id="5013215">star</span>&nbsp;<span class="op" id="5013220">+</span>&nbsp;<span class="ident" id="5013222">rt</span><span class="op" id="5013224">.</span><span class="ident" id="5013225">PkgPath</span><span class="op" id="5013232">(</span><span class="op" id="5013233">)</span>&nbsp;<span class="op" id="5013235">+</span>&nbsp;<span class="string" id="5013237">&#34;.&#34;</span>&nbsp;<span class="op" id="5013241">+</span>&nbsp;<span class="ident" id="5013243">rt</span><span class="op" id="5013245">.</span><span class="ident" id="5013246">Name</span><span class="op" id="5013250">(</span><span class="op" id="5013251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5013258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013262">RegisterName</span><span class="op" id="5013274">(</span><span class="ident" id="5013275">name</span><span class="op" id="5013279">,</span>&nbsp;<span class="ident" id="5013281">value</span><span class="op" id="5013286">)</span><br>
<span class="lineno">885</span><span class="op" id="5013288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5013291">func</span>&nbsp;<span class="ident" id="5013296">registerBasics</span><span class="op" id="5013310">(</span><span class="op" id="5013311">)</span>&nbsp;<span class="op" id="5013313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013316">Register</span><span class="op" id="5013324">(</span><span class="builtintype" id="5013325">int</span><span class="op" id="5013328">(</span><span class="num" id="5013329">0</span><span class="op" id="5013330">)</span><span class="op" id="5013331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013334">Register</span><span class="op" id="5013342">(</span><span class="builtintype" id="5013343">int8</span><span class="op" id="5013347">(</span><span class="num" id="5013348">0</span><span class="op" id="5013349">)</span><span class="op" id="5013350">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013353">Register</span><span class="op" id="5013361">(</span><span class="builtintype" id="5013362">int16</span><span class="op" id="5013367">(</span><span class="num" id="5013368">0</span><span class="op" id="5013369">)</span><span class="op" id="5013370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013373">Register</span><span class="op" id="5013381">(</span><span class="builtintype" id="5013382">int32</span><span class="op" id="5013387">(</span><span class="num" id="5013388">0</span><span class="op" id="5013389">)</span><span class="op" id="5013390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013393">Register</span><span class="op" id="5013401">(</span><span class="ident" id="5013402">int64</span><span class="op" id="5013407">(</span><span class="num" id="5013408">0</span><span class="op" id="5013409">)</span><span class="op" id="5013410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013413">Register</span><span class="op" id="5013421">(</span><span class="builtintype" id="5013422">uint</span><span class="op" id="5013426">(</span><span class="num" id="5013427">0</span><span class="op" id="5013428">)</span><span class="op" id="5013429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013432">Register</span><span class="op" id="5013440">(</span><span class="builtintype" id="5013441">uint8</span><span class="op" id="5013446">(</span><span class="num" id="5013447">0</span><span class="op" id="5013448">)</span><span class="op" id="5013449">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013452">Register</span><span class="op" id="5013460">(</span><span class="builtintype" id="5013461">uint16</span><span class="op" id="5013467">(</span><span class="num" id="5013468">0</span><span class="op" id="5013469">)</span><span class="op" id="5013470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013473">Register</span><span class="op" id="5013481">(</span><span class="builtintype" id="5013482">uint32</span><span class="op" id="5013488">(</span><span class="num" id="5013489">0</span><span class="op" id="5013490">)</span><span class="op" id="5013491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013494">Register</span><span class="op" id="5013502">(</span><span class="ident" id="5013503">uint64</span><span class="op" id="5013509">(</span><span class="num" id="5013510">0</span><span class="op" id="5013511">)</span><span class="op" id="5013512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013515">Register</span><span class="op" id="5013523">(</span><span class="builtintype" id="5013524">float32</span><span class="op" id="5013531">(</span><span class="num" id="5013532">0</span><span class="op" id="5013533">)</span><span class="op" id="5013534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013537">Register</span><span class="op" id="5013545">(</span><span class="builtintype" id="5013546">float64</span><span class="op" id="5013553">(</span><span class="num" id="5013554">0</span><span class="op" id="5013555">)</span><span class="op" id="5013556">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013559">Register</span><span class="op" id="5013567">(</span><span class="builtintype" id="5013568">complex64</span><span class="op" id="5013577">(</span><span class="num" id="5013578">0i</span><span class="op" id="5013580">)</span><span class="op" id="5013581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013584">Register</span><span class="op" id="5013592">(</span><span class="builtintype" id="5013593">complex128</span><span class="op" id="5013603">(</span><span class="num" id="5013604">0i</span><span class="op" id="5013606">)</span><span class="op" id="5013607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013610">Register</span><span class="op" id="5013618">(</span><span class="builtintype" id="5013619">uintptr</span><span class="op" id="5013626">(</span><span class="num" id="5013627">0</span><span class="op" id="5013628">)</span><span class="op" id="5013629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013632">Register</span><span class="op" id="5013640">(</span><span class="builtintype" id="5013641">false</span><span class="op" id="5013646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013649">Register</span><span class="op" id="5013657">(</span><span class="string" id="5013658">&#34;&#34;</span><span class="op" id="5013660">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013663">Register</span><span class="op" id="5013671">(</span><span class="op" id="5013672">[</span><span class="op" id="5013673">]</span><span class="builtintype" id="5013674">byte</span><span class="op" id="5013678">(</span><span class="ident" id="5013679">nil</span><span class="op" id="5013682">)</span><span class="op" id="5013683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013686">Register</span><span class="op" id="5013694">(</span><span class="op" id="5013695">[</span><span class="op" id="5013696">]</span><span class="builtintype" id="5013697">int</span><span class="op" id="5013700">(</span><span class="ident" id="5013701">nil</span><span class="op" id="5013704">)</span><span class="op" id="5013705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013708">Register</span><span class="op" id="5013716">(</span><span class="op" id="5013717">[</span><span class="op" id="5013718">]</span><span class="builtintype" id="5013719">int8</span><span class="op" id="5013723">(</span><span class="ident" id="5013724">nil</span><span class="op" id="5013727">)</span><span class="op" id="5013728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013731">Register</span><span class="op" id="5013739">(</span><span class="op" id="5013740">[</span><span class="op" id="5013741">]</span><span class="builtintype" id="5013742">int16</span><span class="op" id="5013747">(</span><span class="ident" id="5013748">nil</span><span class="op" id="5013751">)</span><span class="op" id="5013752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013755">Register</span><span class="op" id="5013763">(</span><span class="op" id="5013764">[</span><span class="op" id="5013765">]</span><span class="builtintype" id="5013766">int32</span><span class="op" id="5013771">(</span><span class="ident" id="5013772">nil</span><span class="op" id="5013775">)</span><span class="op" id="5013776">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013779">Register</span><span class="op" id="5013787">(</span><span class="op" id="5013788">[</span><span class="op" id="5013789">]</span><span class="ident" id="5013790">int64</span><span class="op" id="5013795">(</span><span class="ident" id="5013796">nil</span><span class="op" id="5013799">)</span><span class="op" id="5013800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013803">Register</span><span class="op" id="5013811">(</span><span class="op" id="5013812">[</span><span class="op" id="5013813">]</span><span class="builtintype" id="5013814">uint</span><span class="op" id="5013818">(</span><span class="ident" id="5013819">nil</span><span class="op" id="5013822">)</span><span class="op" id="5013823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013826">Register</span><span class="op" id="5013834">(</span><span class="op" id="5013835">[</span><span class="op" id="5013836">]</span><span class="builtintype" id="5013837">uint8</span><span class="op" id="5013842">(</span><span class="ident" id="5013843">nil</span><span class="op" id="5013846">)</span><span class="op" id="5013847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013850">Register</span><span class="op" id="5013858">(</span><span class="op" id="5013859">[</span><span class="op" id="5013860">]</span><span class="builtintype" id="5013861">uint16</span><span class="op" id="5013867">(</span><span class="ident" id="5013868">nil</span><span class="op" id="5013871">)</span><span class="op" id="5013872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013875">Register</span><span class="op" id="5013883">(</span><span class="op" id="5013884">[</span><span class="op" id="5013885">]</span><span class="builtintype" id="5013886">uint32</span><span class="op" id="5013892">(</span><span class="ident" id="5013893">nil</span><span class="op" id="5013896">)</span><span class="op" id="5013897">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013900">Register</span><span class="op" id="5013908">(</span><span class="op" id="5013909">[</span><span class="op" id="5013910">]</span><span class="ident" id="5013911">uint64</span><span class="op" id="5013917">(</span><span class="ident" id="5013918">nil</span><span class="op" id="5013921">)</span><span class="op" id="5013922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013925">Register</span><span class="op" id="5013933">(</span><span class="op" id="5013934">[</span><span class="op" id="5013935">]</span><span class="builtintype" id="5013936">float32</span><span class="op" id="5013943">(</span><span class="ident" id="5013944">nil</span><span class="op" id="5013947">)</span><span class="op" id="5013948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013951">Register</span><span class="op" id="5013959">(</span><span class="op" id="5013960">[</span><span class="op" id="5013961">]</span><span class="builtintype" id="5013962">float64</span><span class="op" id="5013969">(</span><span class="ident" id="5013970">nil</span><span class="op" id="5013973">)</span><span class="op" id="5013974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5013977">Register</span><span class="op" id="5013985">(</span><span class="op" id="5013986">[</span><span class="op" id="5013987">]</span><span class="builtintype" id="5013988">complex64</span><span class="op" id="5013997">(</span><span class="ident" id="5013998">nil</span><span class="op" id="5014001">)</span><span class="op" id="5014002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014005">Register</span><span class="op" id="5014013">(</span><span class="op" id="5014014">[</span><span class="op" id="5014015">]</span><span class="builtintype" id="5014016">complex128</span><span class="op" id="5014026">(</span><span class="ident" id="5014027">nil</span><span class="op" id="5014030">)</span><span class="op" id="5014031">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014034">Register</span><span class="op" id="5014042">(</span><span class="op" id="5014043">[</span><span class="op" id="5014044">]</span><span class="builtintype" id="5014045">uintptr</span><span class="op" id="5014052">(</span><span class="ident" id="5014053">nil</span><span class="op" id="5014056">)</span><span class="op" id="5014057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014060">Register</span><span class="op" id="5014068">(</span><span class="op" id="5014069">[</span><span class="op" id="5014070">]</span><span class="builtintype" id="5014071">bool</span><span class="op" id="5014075">(</span><span class="ident" id="5014076">nil</span><span class="op" id="5014079">)</span><span class="op" id="5014080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5014083">Register</span><span class="op" id="5014091">(</span><span class="op" id="5014092">[</span><span class="op" id="5014093">]</span><span class="builtintype" id="5014094">string</span><span class="op" id="5014100">(</span><span class="ident" id="5014101">nil</span><span class="op" id="5014104">)</span><span class="op" id="5014105">)</span><br>
<span class="lineno"></span><span class="op" id="5014107">}</span>
</div>
</body>
</html>
