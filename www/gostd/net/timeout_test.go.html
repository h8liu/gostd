<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8325346">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8325401">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8325455">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8325506">package</span>&nbsp;<span class="ident" id="8325514">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8325519">import</span>&nbsp;<span class="op" id="8325526">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8325529">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8325536">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8325542">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8325555">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8325566">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8325577">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8325584">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8325587">func</span>&nbsp;<span class="ident" id="8325592">isTimeout</span><span class="op" id="8325601">(</span><span class="ident" id="8325602">err</span>&nbsp;<span class="builtintype" id="8325606">error</span><span class="op" id="8325611">)</span>&nbsp;<span class="builtintype" id="8325613">bool</span>&nbsp;<span class="op" id="8325618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325621">e</span><span class="op" id="8325622">,</span>&nbsp;<span class="ident" id="8325624">ok</span>&nbsp;<span class="op" id="8325627">:=</span>&nbsp;<span class="ident" id="8325630">err</span><span class="op" id="8325633">.</span><span class="op" id="8325634">(</span><span class="ident" id="8325635">Error</span><span class="op" id="8325640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325643">return</span>&nbsp;<span class="ident" id="8325650">ok</span>&nbsp;<span class="op" id="8325653">&amp;&amp;</span>&nbsp;<span class="ident" id="8325656">e</span><span class="op" id="8325657">.</span><span class="ident" id="8325658">Timeout</span><span class="op" id="8325665">(</span><span class="op" id="8325666">)</span><br>
<span class="lineno"></span><span class="op" id="8325668">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8325671">type</span>&nbsp;<span class="ident" id="8325676">copyRes</span>&nbsp;<span class="keyword" id="8325684">struct</span>&nbsp;<span class="op" id="8325691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325694">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8325698">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325705">err</span>&nbsp;<span class="builtintype" id="8325709">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325716">d</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8325720">time</span><span class="op" id="8325724">.</span><span class="ident" id="8325725">Duration</span><br>
<span class="lineno">25</span><span class="op" id="8325734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8325737">func</span>&nbsp;<span class="ident" id="8325742">TestAcceptTimeout</span><span class="op" id="8325759">(</span><span class="ident" id="8325760">t</span>&nbsp;<span class="op" id="8325762">*</span><span class="ident" id="8325763">testing</span><span class="op" id="8325770">.</span><span class="ident" id="8325771">T</span><span class="op" id="8325772">)</span>&nbsp;<span class="op" id="8325774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325777">switch</span>&nbsp;<span class="ident" id="8325784">runtime</span><span class="op" id="8325791">.</span><span class="ident" id="8325792">GOOS</span>&nbsp;<span class="op" id="8325797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325800">case</span>&nbsp;<span class="string" id="8325805">&#34;plan9&#34;</span><span class="op" id="8325812">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325816">t</span><span class="op" id="8325817">.</span><span class="ident" id="8325818">Skipf</span><span class="op" id="8325823">(</span><span class="string" id="8325824">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8325845">,</span>&nbsp;<span class="ident" id="8325847">runtime</span><span class="op" id="8325854">.</span><span class="ident" id="8325855">GOOS</span><span class="op" id="8325859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8325862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325866">ln</span>&nbsp;<span class="op" id="8325869">:=</span>&nbsp;<span class="ident" id="8325872">newLocalListener</span><span class="op" id="8325888">(</span><span class="ident" id="8325889">t</span><span class="op" id="8325890">)</span><span class="op" id="8325891">.</span><span class="op" id="8325892">(</span><span class="op" id="8325893">*</span><span class="ident" id="8325894">TCPListener</span><span class="op" id="8325905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325908">defer</span>&nbsp;<span class="ident" id="8325914">ln</span><span class="op" id="8325916">.</span><span class="ident" id="8325917">Close</span><span class="op" id="8325922">(</span><span class="op" id="8325923">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8325926">ln</span><span class="op" id="8325928">.</span><span class="ident" id="8325929">SetDeadline</span><span class="op" id="8325940">(</span><span class="ident" id="8325941">time</span><span class="op" id="8325945">.</span><span class="ident" id="8325946">Now</span><span class="op" id="8325949">(</span><span class="op" id="8325950">)</span><span class="op" id="8325951">.</span><span class="ident" id="8325952">Add</span><span class="op" id="8325955">(</span><span class="op" id="8325956">-</span><span class="num" id="8325957">1</span>&nbsp;<span class="op" id="8325959">*</span>&nbsp;<span class="ident" id="8325961">time</span><span class="op" id="8325965">.</span><span class="ident" id="8325966">Second</span><span class="op" id="8325972">)</span><span class="op" id="8325973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8325976">if</span>&nbsp;<span class="ident" id="8325979">_</span><span class="op" id="8325980">,</span>&nbsp;<span class="ident" id="8325982">err</span>&nbsp;<span class="op" id="8325986">:=</span>&nbsp;<span class="ident" id="8325989">ln</span><span class="op" id="8325991">.</span><span class="ident" id="8325992">Accept</span><span class="op" id="8325998">(</span><span class="op" id="8325999">)</span><span class="op" id="8326000">;</span>&nbsp;<span class="op" id="8326002">!</span><span class="ident" id="8326003">isTimeout</span><span class="op" id="8326012">(</span><span class="ident" id="8326013">err</span><span class="op" id="8326016">)</span>&nbsp;<span class="op" id="8326018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326022">t</span><span class="op" id="8326023">.</span><span class="ident" id="8326024">Fatalf</span><span class="op" id="8326030">(</span><span class="string" id="8326031">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8326064">,</span>&nbsp;<span class="ident" id="8326066">errTimeout</span><span class="op" id="8326076">,</span>&nbsp;<span class="ident" id="8326078">err</span><span class="op" id="8326081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326087">if</span>&nbsp;<span class="ident" id="8326090">_</span><span class="op" id="8326091">,</span>&nbsp;<span class="ident" id="8326093">err</span>&nbsp;<span class="op" id="8326097">:=</span>&nbsp;<span class="ident" id="8326100">ln</span><span class="op" id="8326102">.</span><span class="ident" id="8326103">Accept</span><span class="op" id="8326109">(</span><span class="op" id="8326110">)</span><span class="op" id="8326111">;</span>&nbsp;<span class="op" id="8326113">!</span><span class="ident" id="8326114">isTimeout</span><span class="op" id="8326123">(</span><span class="ident" id="8326124">err</span><span class="op" id="8326127">)</span>&nbsp;<span class="op" id="8326129">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326133">t</span><span class="op" id="8326134">.</span><span class="ident" id="8326135">Fatalf</span><span class="op" id="8326141">(</span><span class="string" id="8326142">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8326175">,</span>&nbsp;<span class="ident" id="8326177">errTimeout</span><span class="op" id="8326187">,</span>&nbsp;<span class="ident" id="8326189">err</span><span class="op" id="8326192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326198">ln</span><span class="op" id="8326200">.</span><span class="ident" id="8326201">SetDeadline</span><span class="op" id="8326212">(</span><span class="ident" id="8326213">time</span><span class="op" id="8326217">.</span><span class="ident" id="8326218">Now</span><span class="op" id="8326221">(</span><span class="op" id="8326222">)</span><span class="op" id="8326223">.</span><span class="ident" id="8326224">Add</span><span class="op" id="8326227">(</span><span class="num" id="8326228">100</span>&nbsp;<span class="op" id="8326232">*</span>&nbsp;<span class="ident" id="8326234">time</span><span class="op" id="8326238">.</span><span class="ident" id="8326239">Millisecond</span><span class="op" id="8326250">)</span><span class="op" id="8326251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326254">if</span>&nbsp;<span class="ident" id="8326257">_</span><span class="op" id="8326258">,</span>&nbsp;<span class="ident" id="8326260">err</span>&nbsp;<span class="op" id="8326264">:=</span>&nbsp;<span class="ident" id="8326267">ln</span><span class="op" id="8326269">.</span><span class="ident" id="8326270">Accept</span><span class="op" id="8326276">(</span><span class="op" id="8326277">)</span><span class="op" id="8326278">;</span>&nbsp;<span class="op" id="8326280">!</span><span class="ident" id="8326281">isTimeout</span><span class="op" id="8326290">(</span><span class="ident" id="8326291">err</span><span class="op" id="8326294">)</span>&nbsp;<span class="op" id="8326296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326300">t</span><span class="op" id="8326301">.</span><span class="ident" id="8326302">Fatalf</span><span class="op" id="8326308">(</span><span class="string" id="8326309">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8326342">,</span>&nbsp;<span class="ident" id="8326344">errTimeout</span><span class="op" id="8326354">,</span>&nbsp;<span class="ident" id="8326356">err</span><span class="op" id="8326359">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326365">if</span>&nbsp;<span class="ident" id="8326368">_</span><span class="op" id="8326369">,</span>&nbsp;<span class="ident" id="8326371">err</span>&nbsp;<span class="op" id="8326375">:=</span>&nbsp;<span class="ident" id="8326378">ln</span><span class="op" id="8326380">.</span><span class="ident" id="8326381">Accept</span><span class="op" id="8326387">(</span><span class="op" id="8326388">)</span><span class="op" id="8326389">;</span>&nbsp;<span class="op" id="8326391">!</span><span class="ident" id="8326392">isTimeout</span><span class="op" id="8326401">(</span><span class="ident" id="8326402">err</span><span class="op" id="8326405">)</span>&nbsp;<span class="op" id="8326407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326411">t</span><span class="op" id="8326412">.</span><span class="ident" id="8326413">Fatalf</span><span class="op" id="8326419">(</span><span class="string" id="8326420">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8326453">,</span>&nbsp;<span class="ident" id="8326455">errTimeout</span><span class="op" id="8326465">,</span>&nbsp;<span class="ident" id="8326467">err</span><span class="op" id="8326470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326476">ln</span><span class="op" id="8326478">.</span><span class="ident" id="8326479">SetDeadline</span><span class="op" id="8326490">(</span><span class="ident" id="8326491">noDeadline</span><span class="op" id="8326501">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326504">errc</span>&nbsp;<span class="op" id="8326509">:=</span>&nbsp;<span class="builtinfunc" id="8326512">make</span><span class="op" id="8326516">(</span><span class="keyword" id="8326517">chan</span>&nbsp;<span class="builtintype" id="8326522">error</span><span class="op" id="8326527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326530">go</span>&nbsp;<span class="keyword" id="8326533">func</span><span class="op" id="8326537">(</span><span class="op" id="8326538">)</span>&nbsp;<span class="op" id="8326540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326544">_</span><span class="op" id="8326545">,</span>&nbsp;<span class="ident" id="8326547">err</span>&nbsp;<span class="op" id="8326551">:=</span>&nbsp;<span class="ident" id="8326554">ln</span><span class="op" id="8326556">.</span><span class="ident" id="8326557">Accept</span><span class="op" id="8326563">(</span><span class="op" id="8326564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326568">errc</span>&nbsp;<span class="op" id="8326573">&lt;-</span>&nbsp;<span class="ident" id="8326576">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326581">}</span><span class="op" id="8326582">(</span><span class="op" id="8326583">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326586">time</span><span class="op" id="8326590">.</span><span class="ident" id="8326591">Sleep</span><span class="op" id="8326596">(</span><span class="num" id="8326597">100</span>&nbsp;<span class="op" id="8326601">*</span>&nbsp;<span class="ident" id="8326603">time</span><span class="op" id="8326607">.</span><span class="ident" id="8326608">Millisecond</span><span class="op" id="8326619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326622">select</span>&nbsp;<span class="op" id="8326629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326632">case</span>&nbsp;<span class="ident" id="8326637">err</span>&nbsp;<span class="op" id="8326641">:=</span>&nbsp;<span class="op" id="8326644">&lt;-</span><span class="ident" id="8326646">errc</span><span class="op" id="8326650">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326654">t</span><span class="op" id="8326655">.</span><span class="ident" id="8326656">Fatalf</span><span class="op" id="8326662">(</span><span class="string" id="8326663">&#34;Expected&nbsp;Accept()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8326723">,</span>&nbsp;<span class="ident" id="8326725">err</span><span class="op" id="8326728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326731">default</span><span class="op" id="8326738">:</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326744">ln</span><span class="op" id="8326746">.</span><span class="ident" id="8326747">Close</span><span class="op" id="8326752">(</span><span class="op" id="8326753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326756">switch</span>&nbsp;<span class="ident" id="8326763">nerr</span>&nbsp;<span class="op" id="8326768">:=</span>&nbsp;<span class="op" id="8326771">&lt;-</span><span class="ident" id="8326773">errc</span><span class="op" id="8326777">;</span>&nbsp;<span class="ident" id="8326779">err</span>&nbsp;<span class="op" id="8326783">:=</span>&nbsp;<span class="ident" id="8326786">nerr</span><span class="op" id="8326790">.</span><span class="op" id="8326791">(</span><span class="keyword" id="8326792">type</span><span class="op" id="8326796">)</span>&nbsp;<span class="op" id="8326798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326801">case</span>&nbsp;<span class="op" id="8326806">*</span><span class="ident" id="8326807">OpError</span><span class="op" id="8326814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326818">if</span>&nbsp;<span class="ident" id="8326821">err</span><span class="op" id="8326824">.</span><span class="ident" id="8326825">Err</span>&nbsp;<span class="op" id="8326829">!=</span>&nbsp;<span class="ident" id="8326832">errClosing</span>&nbsp;<span class="op" id="8326843">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326848">t</span><span class="op" id="8326849">.</span><span class="ident" id="8326850">Fatalf</span><span class="op" id="8326856">(</span><span class="string" id="8326857">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8326890">,</span>&nbsp;<span class="ident" id="8326892">errClosing</span><span class="op" id="8326902">,</span>&nbsp;<span class="ident" id="8326904">err</span><span class="op" id="8326907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8326911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326914">default</span><span class="op" id="8326921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8326925">if</span>&nbsp;<span class="ident" id="8326928">err</span>&nbsp;<span class="op" id="8326932">!=</span>&nbsp;<span class="ident" id="8326935">errClosing</span>&nbsp;<span class="op" id="8326946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8326951">t</span><span class="op" id="8326952">.</span><span class="ident" id="8326953">Fatalf</span><span class="op" id="8326959">(</span><span class="string" id="8326960">&#34;Accept:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8326993">,</span>&nbsp;<span class="ident" id="8326995">errClosing</span><span class="op" id="8327005">,</span>&nbsp;<span class="ident" id="8327007">err</span><span class="op" id="8327010">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327017">}</span><br>
<span class="lineno"></span><span class="op" id="8327019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8327022">func</span>&nbsp;<span class="ident" id="8327027">TestReadTimeout</span><span class="op" id="8327042">(</span><span class="ident" id="8327043">t</span>&nbsp;<span class="op" id="8327045">*</span><span class="ident" id="8327046">testing</span><span class="op" id="8327053">.</span><span class="ident" id="8327054">T</span><span class="op" id="8327055">)</span>&nbsp;<span class="op" id="8327057">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327060">switch</span>&nbsp;<span class="ident" id="8327067">runtime</span><span class="op" id="8327074">.</span><span class="ident" id="8327075">GOOS</span>&nbsp;<span class="op" id="8327080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327083">case</span>&nbsp;<span class="string" id="8327088">&#34;plan9&#34;</span><span class="op" id="8327095">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327099">t</span><span class="op" id="8327100">.</span><span class="ident" id="8327101">Skipf</span><span class="op" id="8327106">(</span><span class="string" id="8327107">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8327128">,</span>&nbsp;<span class="ident" id="8327130">runtime</span><span class="op" id="8327137">.</span><span class="ident" id="8327138">GOOS</span><span class="op" id="8327142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327149">ln</span>&nbsp;<span class="op" id="8327152">:=</span>&nbsp;<span class="ident" id="8327155">newLocalListener</span><span class="op" id="8327171">(</span><span class="ident" id="8327172">t</span><span class="op" id="8327173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327176">defer</span>&nbsp;<span class="ident" id="8327182">ln</span><span class="op" id="8327184">.</span><span class="ident" id="8327185">Close</span><span class="op" id="8327190">(</span><span class="op" id="8327191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327194">c</span><span class="op" id="8327195">,</span>&nbsp;<span class="ident" id="8327197">err</span>&nbsp;<span class="op" id="8327201">:=</span>&nbsp;<span class="ident" id="8327204">DialTCP</span><span class="op" id="8327211">(</span><span class="string" id="8327212">&#34;tcp&#34;</span><span class="op" id="8327217">,</span>&nbsp;<span class="ident" id="8327219">nil</span><span class="op" id="8327222">,</span>&nbsp;<span class="ident" id="8327224">ln</span><span class="op" id="8327226">.</span><span class="ident" id="8327227">Addr</span><span class="op" id="8327231">(</span><span class="op" id="8327232">)</span><span class="op" id="8327233">.</span><span class="op" id="8327234">(</span><span class="op" id="8327235">*</span><span class="ident" id="8327236">TCPAddr</span><span class="op" id="8327243">)</span><span class="op" id="8327244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327247">if</span>&nbsp;<span class="ident" id="8327250">err</span>&nbsp;<span class="op" id="8327254">!=</span>&nbsp;<span class="ident" id="8327257">nil</span>&nbsp;<span class="op" id="8327261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327265">t</span><span class="op" id="8327266">.</span><span class="ident" id="8327267">Fatalf</span><span class="op" id="8327273">(</span><span class="string" id="8327274">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8327287">,</span>&nbsp;<span class="ident" id="8327289">err</span><span class="op" id="8327292">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327298">defer</span>&nbsp;<span class="ident" id="8327304">c</span><span class="op" id="8327305">.</span><span class="ident" id="8327306">Close</span><span class="op" id="8327311">(</span><span class="op" id="8327312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327315">c</span><span class="op" id="8327316">.</span><span class="ident" id="8327317">SetDeadline</span><span class="op" id="8327328">(</span><span class="ident" id="8327329">time</span><span class="op" id="8327333">.</span><span class="ident" id="8327334">Now</span><span class="op" id="8327337">(</span><span class="op" id="8327338">)</span><span class="op" id="8327339">.</span><span class="ident" id="8327340">Add</span><span class="op" id="8327343">(</span><span class="ident" id="8327344">time</span><span class="op" id="8327348">.</span><span class="ident" id="8327349">Hour</span><span class="op" id="8327353">)</span><span class="op" id="8327354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327357">c</span><span class="op" id="8327358">.</span><span class="ident" id="8327359">SetReadDeadline</span><span class="op" id="8327374">(</span><span class="ident" id="8327375">time</span><span class="op" id="8327379">.</span><span class="ident" id="8327380">Now</span><span class="op" id="8327383">(</span><span class="op" id="8327384">)</span><span class="op" id="8327385">.</span><span class="ident" id="8327386">Add</span><span class="op" id="8327389">(</span><span class="op" id="8327390">-</span><span class="num" id="8327391">1</span>&nbsp;<span class="op" id="8327393">*</span>&nbsp;<span class="ident" id="8327395">time</span><span class="op" id="8327399">.</span><span class="ident" id="8327400">Second</span><span class="op" id="8327406">)</span><span class="op" id="8327407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327410">buf</span>&nbsp;<span class="op" id="8327414">:=</span>&nbsp;<span class="builtinfunc" id="8327417">make</span><span class="op" id="8327421">(</span><span class="op" id="8327422">[</span><span class="op" id="8327423">]</span><span class="builtintype" id="8327424">byte</span><span class="op" id="8327428">,</span>&nbsp;<span class="num" id="8327430">1</span><span class="op" id="8327431">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327434">if</span>&nbsp;<span class="ident" id="8327437">_</span><span class="op" id="8327438">,</span>&nbsp;<span class="ident" id="8327440">err</span>&nbsp;<span class="op" id="8327444">=</span>&nbsp;<span class="ident" id="8327446">c</span><span class="op" id="8327447">.</span><span class="ident" id="8327448">Read</span><span class="op" id="8327452">(</span><span class="ident" id="8327453">buf</span><span class="op" id="8327456">)</span><span class="op" id="8327457">;</span>&nbsp;<span class="op" id="8327459">!</span><span class="ident" id="8327460">isTimeout</span><span class="op" id="8327469">(</span><span class="ident" id="8327470">err</span><span class="op" id="8327473">)</span>&nbsp;<span class="op" id="8327475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327479">t</span><span class="op" id="8327480">.</span><span class="ident" id="8327481">Fatalf</span><span class="op" id="8327487">(</span><span class="string" id="8327488">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8327519">,</span>&nbsp;<span class="ident" id="8327521">errTimeout</span><span class="op" id="8327531">,</span>&nbsp;<span class="ident" id="8327533">err</span><span class="op" id="8327536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327542">if</span>&nbsp;<span class="ident" id="8327545">_</span><span class="op" id="8327546">,</span>&nbsp;<span class="ident" id="8327548">err</span>&nbsp;<span class="op" id="8327552">=</span>&nbsp;<span class="ident" id="8327554">c</span><span class="op" id="8327555">.</span><span class="ident" id="8327556">Read</span><span class="op" id="8327560">(</span><span class="ident" id="8327561">buf</span><span class="op" id="8327564">)</span><span class="op" id="8327565">;</span>&nbsp;<span class="op" id="8327567">!</span><span class="ident" id="8327568">isTimeout</span><span class="op" id="8327577">(</span><span class="ident" id="8327578">err</span><span class="op" id="8327581">)</span>&nbsp;<span class="op" id="8327583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327587">t</span><span class="op" id="8327588">.</span><span class="ident" id="8327589">Fatalf</span><span class="op" id="8327595">(</span><span class="string" id="8327596">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8327627">,</span>&nbsp;<span class="ident" id="8327629">errTimeout</span><span class="op" id="8327639">,</span>&nbsp;<span class="ident" id="8327641">err</span><span class="op" id="8327644">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327650">c</span><span class="op" id="8327651">.</span><span class="ident" id="8327652">SetDeadline</span><span class="op" id="8327663">(</span><span class="ident" id="8327664">time</span><span class="op" id="8327668">.</span><span class="ident" id="8327669">Now</span><span class="op" id="8327672">(</span><span class="op" id="8327673">)</span><span class="op" id="8327674">.</span><span class="ident" id="8327675">Add</span><span class="op" id="8327678">(</span><span class="num" id="8327679">100</span>&nbsp;<span class="op" id="8327683">*</span>&nbsp;<span class="ident" id="8327685">time</span><span class="op" id="8327689">.</span><span class="ident" id="8327690">Millisecond</span><span class="op" id="8327701">)</span><span class="op" id="8327702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327705">if</span>&nbsp;<span class="ident" id="8327708">_</span><span class="op" id="8327709">,</span>&nbsp;<span class="ident" id="8327711">err</span>&nbsp;<span class="op" id="8327715">=</span>&nbsp;<span class="ident" id="8327717">c</span><span class="op" id="8327718">.</span><span class="ident" id="8327719">Read</span><span class="op" id="8327723">(</span><span class="ident" id="8327724">buf</span><span class="op" id="8327727">)</span><span class="op" id="8327728">;</span>&nbsp;<span class="op" id="8327730">!</span><span class="ident" id="8327731">isTimeout</span><span class="op" id="8327740">(</span><span class="ident" id="8327741">err</span><span class="op" id="8327744">)</span>&nbsp;<span class="op" id="8327746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327750">t</span><span class="op" id="8327751">.</span><span class="ident" id="8327752">Fatalf</span><span class="op" id="8327758">(</span><span class="string" id="8327759">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8327790">,</span>&nbsp;<span class="ident" id="8327792">errTimeout</span><span class="op" id="8327802">,</span>&nbsp;<span class="ident" id="8327804">err</span><span class="op" id="8327807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327810">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8327813">if</span>&nbsp;<span class="ident" id="8327816">_</span><span class="op" id="8327817">,</span>&nbsp;<span class="ident" id="8327819">err</span>&nbsp;<span class="op" id="8327823">=</span>&nbsp;<span class="ident" id="8327825">c</span><span class="op" id="8327826">.</span><span class="ident" id="8327827">Read</span><span class="op" id="8327831">(</span><span class="ident" id="8327832">buf</span><span class="op" id="8327835">)</span><span class="op" id="8327836">;</span>&nbsp;<span class="op" id="8327838">!</span><span class="ident" id="8327839">isTimeout</span><span class="op" id="8327848">(</span><span class="ident" id="8327849">err</span><span class="op" id="8327852">)</span>&nbsp;<span class="op" id="8327854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327858">t</span><span class="op" id="8327859">.</span><span class="ident" id="8327860">Fatalf</span><span class="op" id="8327866">(</span><span class="string" id="8327867">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8327898">,</span>&nbsp;<span class="ident" id="8327900">errTimeout</span><span class="op" id="8327910">,</span>&nbsp;<span class="ident" id="8327912">err</span><span class="op" id="8327915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8327918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327921">c</span><span class="op" id="8327922">.</span><span class="ident" id="8327923">SetReadDeadline</span><span class="op" id="8327938">(</span><span class="ident" id="8327939">noDeadline</span><span class="op" id="8327949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8327952">c</span><span class="op" id="8327953">.</span><span class="ident" id="8327954">SetWriteDeadline</span><span class="op" id="8327970">(</span><span class="ident" id="8327971">time</span><span class="op" id="8327975">.</span><span class="ident" id="8327976">Now</span><span class="op" id="8327979">(</span><span class="op" id="8327980">)</span><span class="op" id="8327981">.</span><span class="ident" id="8327982">Add</span><span class="op" id="8327985">(</span><span class="op" id="8327986">-</span><span class="num" id="8327987">1</span>&nbsp;<span class="op" id="8327989">*</span>&nbsp;<span class="ident" id="8327991">time</span><span class="op" id="8327995">.</span><span class="ident" id="8327996">Second</span><span class="op" id="8328002">)</span><span class="op" id="8328003">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328006">errc</span>&nbsp;<span class="op" id="8328011">:=</span>&nbsp;<span class="builtinfunc" id="8328014">make</span><span class="op" id="8328018">(</span><span class="keyword" id="8328019">chan</span>&nbsp;<span class="builtintype" id="8328024">error</span><span class="op" id="8328029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328032">go</span>&nbsp;<span class="keyword" id="8328035">func</span><span class="op" id="8328039">(</span><span class="op" id="8328040">)</span>&nbsp;<span class="op" id="8328042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328046">_</span><span class="op" id="8328047">,</span>&nbsp;<span class="ident" id="8328049">err</span>&nbsp;<span class="op" id="8328053">:=</span>&nbsp;<span class="ident" id="8328056">c</span><span class="op" id="8328057">.</span><span class="ident" id="8328058">Read</span><span class="op" id="8328062">(</span><span class="ident" id="8328063">buf</span><span class="op" id="8328066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328070">errc</span>&nbsp;<span class="op" id="8328075">&lt;-</span>&nbsp;<span class="ident" id="8328078">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328083">}</span><span class="op" id="8328084">(</span><span class="op" id="8328085">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328088">time</span><span class="op" id="8328092">.</span><span class="ident" id="8328093">Sleep</span><span class="op" id="8328098">(</span><span class="num" id="8328099">100</span>&nbsp;<span class="op" id="8328103">*</span>&nbsp;<span class="ident" id="8328105">time</span><span class="op" id="8328109">.</span><span class="ident" id="8328110">Millisecond</span><span class="op" id="8328121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328124">select</span>&nbsp;<span class="op" id="8328131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328134">case</span>&nbsp;<span class="ident" id="8328139">err</span>&nbsp;<span class="op" id="8328143">:=</span>&nbsp;<span class="op" id="8328146">&lt;-</span><span class="ident" id="8328148">errc</span><span class="op" id="8328152">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328156">t</span><span class="op" id="8328157">.</span><span class="ident" id="8328158">Fatalf</span><span class="op" id="8328164">(</span><span class="string" id="8328165">&#34;Expected&nbsp;Read()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8328223">,</span>&nbsp;<span class="ident" id="8328225">err</span><span class="op" id="8328228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328231">default</span><span class="op" id="8328238">:</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328244">c</span><span class="op" id="8328245">.</span><span class="ident" id="8328246">Close</span><span class="op" id="8328251">(</span><span class="op" id="8328252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328255">switch</span>&nbsp;<span class="ident" id="8328262">nerr</span>&nbsp;<span class="op" id="8328267">:=</span>&nbsp;<span class="op" id="8328270">&lt;-</span><span class="ident" id="8328272">errc</span><span class="op" id="8328276">;</span>&nbsp;<span class="ident" id="8328278">err</span>&nbsp;<span class="op" id="8328282">:=</span>&nbsp;<span class="ident" id="8328285">nerr</span><span class="op" id="8328289">.</span><span class="op" id="8328290">(</span><span class="keyword" id="8328291">type</span><span class="op" id="8328295">)</span>&nbsp;<span class="op" id="8328297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328300">case</span>&nbsp;<span class="op" id="8328305">*</span><span class="ident" id="8328306">OpError</span><span class="op" id="8328313">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328317">if</span>&nbsp;<span class="ident" id="8328320">err</span><span class="op" id="8328323">.</span><span class="ident" id="8328324">Err</span>&nbsp;<span class="op" id="8328328">!=</span>&nbsp;<span class="ident" id="8328331">errClosing</span>&nbsp;<span class="op" id="8328342">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328347">t</span><span class="op" id="8328348">.</span><span class="ident" id="8328349">Fatalf</span><span class="op" id="8328355">(</span><span class="string" id="8328356">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8328387">,</span>&nbsp;<span class="ident" id="8328389">errClosing</span><span class="op" id="8328399">,</span>&nbsp;<span class="ident" id="8328401">err</span><span class="op" id="8328404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328411">default</span><span class="op" id="8328418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328422">if</span>&nbsp;<span class="ident" id="8328425">err</span>&nbsp;<span class="op" id="8328429">==</span>&nbsp;<span class="ident" id="8328432">io</span><span class="op" id="8328434">.</span><span class="ident" id="8328435">EOF</span>&nbsp;<span class="op" id="8328439">&amp;&amp;</span>&nbsp;<span class="ident" id="8328442">runtime</span><span class="op" id="8328449">.</span><span class="ident" id="8328450">GOOS</span>&nbsp;<span class="op" id="8328455">==</span>&nbsp;<span class="string" id="8328458">&#34;nacl&#34;</span>&nbsp;<span class="op" id="8328465">{</span>&nbsp;<span class="comment" id="8328467">//&nbsp;close&nbsp;enough;&nbsp;golang.org/issue/8044</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328509">break</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328521">if</span>&nbsp;<span class="ident" id="8328524">err</span>&nbsp;<span class="op" id="8328528">!=</span>&nbsp;<span class="ident" id="8328531">errClosing</span>&nbsp;<span class="op" id="8328542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328547">t</span><span class="op" id="8328548">.</span><span class="ident" id="8328549">Fatalf</span><span class="op" id="8328555">(</span><span class="string" id="8328556">&#34;Read:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8328587">,</span>&nbsp;<span class="ident" id="8328589">errClosing</span><span class="op" id="8328599">,</span>&nbsp;<span class="ident" id="8328601">err</span><span class="op" id="8328604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328611">}</span><br>
<span class="lineno">130</span><span class="op" id="8328613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8328616">func</span>&nbsp;<span class="ident" id="8328621">TestWriteTimeout</span><span class="op" id="8328637">(</span><span class="ident" id="8328638">t</span>&nbsp;<span class="op" id="8328640">*</span><span class="ident" id="8328641">testing</span><span class="op" id="8328648">.</span><span class="ident" id="8328649">T</span><span class="op" id="8328650">)</span>&nbsp;<span class="op" id="8328652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328655">switch</span>&nbsp;<span class="ident" id="8328662">runtime</span><span class="op" id="8328669">.</span><span class="ident" id="8328670">GOOS</span>&nbsp;<span class="op" id="8328675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328678">case</span>&nbsp;<span class="string" id="8328683">&#34;plan9&#34;</span><span class="op" id="8328690">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328694">t</span><span class="op" id="8328695">.</span><span class="ident" id="8328696">Skipf</span><span class="op" id="8328701">(</span><span class="string" id="8328702">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8328723">,</span>&nbsp;<span class="ident" id="8328725">runtime</span><span class="op" id="8328732">.</span><span class="ident" id="8328733">GOOS</span><span class="op" id="8328737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328744">ln</span>&nbsp;<span class="op" id="8328747">:=</span>&nbsp;<span class="ident" id="8328750">newLocalListener</span><span class="op" id="8328766">(</span><span class="ident" id="8328767">t</span><span class="op" id="8328768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328771">defer</span>&nbsp;<span class="ident" id="8328777">ln</span><span class="op" id="8328779">.</span><span class="ident" id="8328780">Close</span><span class="op" id="8328785">(</span><span class="op" id="8328786">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328789">c</span><span class="op" id="8328790">,</span>&nbsp;<span class="ident" id="8328792">err</span>&nbsp;<span class="op" id="8328796">:=</span>&nbsp;<span class="ident" id="8328799">DialTCP</span><span class="op" id="8328806">(</span><span class="string" id="8328807">&#34;tcp&#34;</span><span class="op" id="8328812">,</span>&nbsp;<span class="ident" id="8328814">nil</span><span class="op" id="8328817">,</span>&nbsp;<span class="ident" id="8328819">ln</span><span class="op" id="8328821">.</span><span class="ident" id="8328822">Addr</span><span class="op" id="8328826">(</span><span class="op" id="8328827">)</span><span class="op" id="8328828">.</span><span class="op" id="8328829">(</span><span class="op" id="8328830">*</span><span class="ident" id="8328831">TCPAddr</span><span class="op" id="8328838">)</span><span class="op" id="8328839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328842">if</span>&nbsp;<span class="ident" id="8328845">err</span>&nbsp;<span class="op" id="8328849">!=</span>&nbsp;<span class="ident" id="8328852">nil</span>&nbsp;<span class="op" id="8328856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328860">t</span><span class="op" id="8328861">.</span><span class="ident" id="8328862">Fatalf</span><span class="op" id="8328868">(</span><span class="string" id="8328869">&#34;Connect:&nbsp;%v&#34;</span><span class="op" id="8328882">,</span>&nbsp;<span class="ident" id="8328884">err</span><span class="op" id="8328887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8328890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8328893">defer</span>&nbsp;<span class="ident" id="8328899">c</span><span class="op" id="8328900">.</span><span class="ident" id="8328901">Close</span><span class="op" id="8328906">(</span><span class="op" id="8328907">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328910">c</span><span class="op" id="8328911">.</span><span class="ident" id="8328912">SetDeadline</span><span class="op" id="8328923">(</span><span class="ident" id="8328924">time</span><span class="op" id="8328928">.</span><span class="ident" id="8328929">Now</span><span class="op" id="8328932">(</span><span class="op" id="8328933">)</span><span class="op" id="8328934">.</span><span class="ident" id="8328935">Add</span><span class="op" id="8328938">(</span><span class="ident" id="8328939">time</span><span class="op" id="8328943">.</span><span class="ident" id="8328944">Hour</span><span class="op" id="8328948">)</span><span class="op" id="8328949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8328952">c</span><span class="op" id="8328953">.</span><span class="ident" id="8328954">SetWriteDeadline</span><span class="op" id="8328970">(</span><span class="ident" id="8328971">time</span><span class="op" id="8328975">.</span><span class="ident" id="8328976">Now</span><span class="op" id="8328979">(</span><span class="op" id="8328980">)</span><span class="op" id="8328981">.</span><span class="ident" id="8328982">Add</span><span class="op" id="8328985">(</span><span class="op" id="8328986">-</span><span class="num" id="8328987">1</span>&nbsp;<span class="op" id="8328989">*</span>&nbsp;<span class="ident" id="8328991">time</span><span class="op" id="8328995">.</span><span class="ident" id="8328996">Second</span><span class="op" id="8329002">)</span><span class="op" id="8329003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329006">buf</span>&nbsp;<span class="op" id="8329010">:=</span>&nbsp;<span class="builtinfunc" id="8329013">make</span><span class="op" id="8329017">(</span><span class="op" id="8329018">[</span><span class="op" id="8329019">]</span><span class="builtintype" id="8329020">byte</span><span class="op" id="8329024">,</span>&nbsp;<span class="num" id="8329026">4096</span><span class="op" id="8329030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329033">writeUntilTimeout</span>&nbsp;<span class="op" id="8329051">:=</span>&nbsp;<span class="keyword" id="8329054">func</span><span class="op" id="8329058">(</span><span class="op" id="8329059">)</span>&nbsp;<span class="op" id="8329061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329065">for</span>&nbsp;<span class="op" id="8329069">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329074">_</span><span class="op" id="8329075">,</span>&nbsp;<span class="ident" id="8329077">err</span>&nbsp;<span class="op" id="8329081">:=</span>&nbsp;<span class="ident" id="8329084">c</span><span class="op" id="8329085">.</span><span class="ident" id="8329086">Write</span><span class="op" id="8329091">(</span><span class="ident" id="8329092">buf</span><span class="op" id="8329095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329100">if</span>&nbsp;<span class="ident" id="8329103">err</span>&nbsp;<span class="op" id="8329107">!=</span>&nbsp;<span class="ident" id="8329110">nil</span>&nbsp;<span class="op" id="8329114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329120">if</span>&nbsp;<span class="ident" id="8329123">isTimeout</span><span class="op" id="8329132">(</span><span class="ident" id="8329133">err</span><span class="op" id="8329136">)</span>&nbsp;<span class="op" id="8329138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329156">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329162">t</span><span class="op" id="8329163">.</span><span class="ident" id="8329164">Fatalf</span><span class="op" id="8329170">(</span><span class="string" id="8329171">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8329203">,</span>&nbsp;<span class="ident" id="8329205">errTimeout</span><span class="op" id="8329215">,</span>&nbsp;<span class="ident" id="8329217">err</span><span class="op" id="8329220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329235">writeUntilTimeout</span><span class="op" id="8329252">(</span><span class="op" id="8329253">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329256">c</span><span class="op" id="8329257">.</span><span class="ident" id="8329258">SetDeadline</span><span class="op" id="8329269">(</span><span class="ident" id="8329270">time</span><span class="op" id="8329274">.</span><span class="ident" id="8329275">Now</span><span class="op" id="8329278">(</span><span class="op" id="8329279">)</span><span class="op" id="8329280">.</span><span class="ident" id="8329281">Add</span><span class="op" id="8329284">(</span><span class="num" id="8329285">10</span>&nbsp;<span class="op" id="8329288">*</span>&nbsp;<span class="ident" id="8329290">time</span><span class="op" id="8329294">.</span><span class="ident" id="8329295">Millisecond</span><span class="op" id="8329306">)</span><span class="op" id="8329307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329310">writeUntilTimeout</span><span class="op" id="8329327">(</span><span class="op" id="8329328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329331">writeUntilTimeout</span><span class="op" id="8329348">(</span><span class="op" id="8329349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329352">c</span><span class="op" id="8329353">.</span><span class="ident" id="8329354">SetWriteDeadline</span><span class="op" id="8329370">(</span><span class="ident" id="8329371">noDeadline</span><span class="op" id="8329381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329384">c</span><span class="op" id="8329385">.</span><span class="ident" id="8329386">SetReadDeadline</span><span class="op" id="8329401">(</span><span class="ident" id="8329402">time</span><span class="op" id="8329406">.</span><span class="ident" id="8329407">Now</span><span class="op" id="8329410">(</span><span class="op" id="8329411">)</span><span class="op" id="8329412">.</span><span class="ident" id="8329413">Add</span><span class="op" id="8329416">(</span><span class="op" id="8329417">-</span><span class="num" id="8329418">1</span>&nbsp;<span class="op" id="8329420">*</span>&nbsp;<span class="ident" id="8329422">time</span><span class="op" id="8329426">.</span><span class="ident" id="8329427">Second</span><span class="op" id="8329433">)</span><span class="op" id="8329434">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329437">errc</span>&nbsp;<span class="op" id="8329442">:=</span>&nbsp;<span class="builtinfunc" id="8329445">make</span><span class="op" id="8329449">(</span><span class="keyword" id="8329450">chan</span>&nbsp;<span class="builtintype" id="8329455">error</span><span class="op" id="8329460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329463">go</span>&nbsp;<span class="keyword" id="8329466">func</span><span class="op" id="8329470">(</span><span class="op" id="8329471">)</span>&nbsp;<span class="op" id="8329473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329477">for</span>&nbsp;<span class="op" id="8329481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329486">_</span><span class="op" id="8329487">,</span>&nbsp;<span class="ident" id="8329489">err</span>&nbsp;<span class="op" id="8329493">:=</span>&nbsp;<span class="ident" id="8329496">c</span><span class="op" id="8329497">.</span><span class="ident" id="8329498">Write</span><span class="op" id="8329503">(</span><span class="ident" id="8329504">buf</span><span class="op" id="8329507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329512">if</span>&nbsp;<span class="ident" id="8329515">err</span>&nbsp;<span class="op" id="8329519">!=</span>&nbsp;<span class="ident" id="8329522">nil</span>&nbsp;<span class="op" id="8329526">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329532">errc</span>&nbsp;<span class="op" id="8329537">&lt;-</span>&nbsp;<span class="ident" id="8329540">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329554">}</span><span class="op" id="8329555">(</span><span class="op" id="8329556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329559">time</span><span class="op" id="8329563">.</span><span class="ident" id="8329564">Sleep</span><span class="op" id="8329569">(</span><span class="num" id="8329570">100</span>&nbsp;<span class="op" id="8329574">*</span>&nbsp;<span class="ident" id="8329576">time</span><span class="op" id="8329580">.</span><span class="ident" id="8329581">Millisecond</span><span class="op" id="8329592">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329595">select</span>&nbsp;<span class="op" id="8329602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329605">case</span>&nbsp;<span class="ident" id="8329610">err</span>&nbsp;<span class="op" id="8329614">:=</span>&nbsp;<span class="op" id="8329617">&lt;-</span><span class="ident" id="8329619">errc</span><span class="op" id="8329623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329627">t</span><span class="op" id="8329628">.</span><span class="ident" id="8329629">Fatalf</span><span class="op" id="8329635">(</span><span class="string" id="8329636">&#34;Expected&nbsp;Write()&nbsp;to&nbsp;not&nbsp;return,&nbsp;but&nbsp;it&nbsp;returned&nbsp;with&nbsp;%v\n&#34;</span><span class="op" id="8329695">,</span>&nbsp;<span class="ident" id="8329697">err</span><span class="op" id="8329700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329703">default</span><span class="op" id="8329710">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329713">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329716">c</span><span class="op" id="8329717">.</span><span class="ident" id="8329718">Close</span><span class="op" id="8329723">(</span><span class="op" id="8329724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329727">switch</span>&nbsp;<span class="ident" id="8329734">nerr</span>&nbsp;<span class="op" id="8329739">:=</span>&nbsp;<span class="op" id="8329742">&lt;-</span><span class="ident" id="8329744">errc</span><span class="op" id="8329748">;</span>&nbsp;<span class="ident" id="8329750">err</span>&nbsp;<span class="op" id="8329754">:=</span>&nbsp;<span class="ident" id="8329757">nerr</span><span class="op" id="8329761">.</span><span class="op" id="8329762">(</span><span class="keyword" id="8329763">type</span><span class="op" id="8329767">)</span>&nbsp;<span class="op" id="8329769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329772">case</span>&nbsp;<span class="op" id="8329777">*</span><span class="ident" id="8329778">OpError</span><span class="op" id="8329785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329789">if</span>&nbsp;<span class="ident" id="8329792">err</span><span class="op" id="8329795">.</span><span class="ident" id="8329796">Err</span>&nbsp;<span class="op" id="8329800">!=</span>&nbsp;<span class="ident" id="8329803">errClosing</span>&nbsp;<span class="op" id="8329814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329819">t</span><span class="op" id="8329820">.</span><span class="ident" id="8329821">Fatalf</span><span class="op" id="8329827">(</span><span class="string" id="8329828">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8329860">,</span>&nbsp;<span class="ident" id="8329862">errClosing</span><span class="op" id="8329872">,</span>&nbsp;<span class="ident" id="8329874">err</span><span class="op" id="8329877">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329884">default</span><span class="op" id="8329891">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8329895">if</span>&nbsp;<span class="ident" id="8329898">err</span>&nbsp;<span class="op" id="8329902">!=</span>&nbsp;<span class="ident" id="8329905">errClosing</span>&nbsp;<span class="op" id="8329916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8329921">t</span><span class="op" id="8329922">.</span><span class="ident" id="8329923">Fatalf</span><span class="op" id="8329929">(</span><span class="string" id="8329930">&#34;Write:&nbsp;expected&nbsp;err&nbsp;%v,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="8329962">,</span>&nbsp;<span class="ident" id="8329964">errClosing</span><span class="op" id="8329974">,</span>&nbsp;<span class="ident" id="8329976">err</span><span class="op" id="8329979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329983">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8329986">}</span><br>
<span class="lineno"></span><span class="op" id="8329988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8329991">func</span>&nbsp;<span class="ident" id="8329996">testTimeout</span><span class="op" id="8330007">(</span><span class="ident" id="8330008">t</span>&nbsp;<span class="op" id="8330010">*</span><span class="ident" id="8330011">testing</span><span class="op" id="8330018">.</span><span class="ident" id="8330019">T</span><span class="op" id="8330020">,</span>&nbsp;<span class="ident" id="8330022">net</span><span class="op" id="8330025">,</span>&nbsp;<span class="ident" id="8330027">addr</span>&nbsp;<span class="builtintype" id="8330032">string</span><span class="op" id="8330038">,</span>&nbsp;<span class="ident" id="8330040">readFrom</span>&nbsp;<span class="builtintype" id="8330049">bool</span><span class="op" id="8330053">)</span>&nbsp;<span class="op" id="8330055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330058">c</span><span class="op" id="8330059">,</span>&nbsp;<span class="ident" id="8330061">err</span>&nbsp;<span class="op" id="8330065">:=</span>&nbsp;<span class="ident" id="8330068">Dial</span><span class="op" id="8330072">(</span><span class="ident" id="8330073">net</span><span class="op" id="8330076">,</span>&nbsp;<span class="ident" id="8330078">addr</span><span class="op" id="8330082">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330085">if</span>&nbsp;<span class="ident" id="8330088">err</span>&nbsp;<span class="op" id="8330092">!=</span>&nbsp;<span class="ident" id="8330095">nil</span>&nbsp;<span class="op" id="8330099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330103">t</span><span class="op" id="8330104">.</span><span class="ident" id="8330105">Errorf</span><span class="op" id="8330111">(</span><span class="string" id="8330112">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8330137">,</span>&nbsp;<span class="ident" id="8330139">net</span><span class="op" id="8330142">,</span>&nbsp;<span class="ident" id="8330144">addr</span><span class="op" id="8330148">,</span>&nbsp;<span class="ident" id="8330150">err</span><span class="op" id="8330153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330157">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330168">defer</span>&nbsp;<span class="ident" id="8330174">c</span><span class="op" id="8330175">.</span><span class="ident" id="8330176">Close</span><span class="op" id="8330181">(</span><span class="op" id="8330182">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330185">what</span>&nbsp;<span class="op" id="8330190">:=</span>&nbsp;<span class="string" id="8330193">&#34;Read&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330201">if</span>&nbsp;<span class="ident" id="8330204">readFrom</span>&nbsp;<span class="op" id="8330213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330217">what</span>&nbsp;<span class="op" id="8330222">=</span>&nbsp;<span class="string" id="8330224">&#34;ReadFrom&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330240">errc</span>&nbsp;<span class="op" id="8330245">:=</span>&nbsp;<span class="builtinfunc" id="8330248">make</span><span class="op" id="8330252">(</span><span class="keyword" id="8330253">chan</span>&nbsp;<span class="builtintype" id="8330258">error</span><span class="op" id="8330263">,</span>&nbsp;<span class="num" id="8330265">1</span><span class="op" id="8330266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330269">go</span>&nbsp;<span class="keyword" id="8330272">func</span><span class="op" id="8330276">(</span><span class="op" id="8330277">)</span>&nbsp;<span class="op" id="8330279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330283">t0</span>&nbsp;<span class="op" id="8330286">:=</span>&nbsp;<span class="ident" id="8330289">time</span><span class="op" id="8330293">.</span><span class="ident" id="8330294">Now</span><span class="op" id="8330297">(</span><span class="op" id="8330298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330302">c</span><span class="op" id="8330303">.</span><span class="ident" id="8330304">SetReadDeadline</span><span class="op" id="8330319">(</span><span class="ident" id="8330320">time</span><span class="op" id="8330324">.</span><span class="ident" id="8330325">Now</span><span class="op" id="8330328">(</span><span class="op" id="8330329">)</span><span class="op" id="8330330">.</span><span class="ident" id="8330331">Add</span><span class="op" id="8330334">(</span><span class="num" id="8330335">100</span>&nbsp;<span class="op" id="8330339">*</span>&nbsp;<span class="ident" id="8330341">time</span><span class="op" id="8330345">.</span><span class="ident" id="8330346">Millisecond</span><span class="op" id="8330357">)</span><span class="op" id="8330358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330362">var</span>&nbsp;<span class="ident" id="8330366">b</span>&nbsp;<span class="op" id="8330368">[</span><span class="num" id="8330369">100</span><span class="op" id="8330372">]</span><span class="builtintype" id="8330373">byte</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330380">var</span>&nbsp;<span class="ident" id="8330384">n</span>&nbsp;<span class="builtintype" id="8330386">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330392">var</span>&nbsp;<span class="ident" id="8330396">err</span>&nbsp;<span class="builtintype" id="8330400">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330408">if</span>&nbsp;<span class="ident" id="8330411">readFrom</span>&nbsp;<span class="op" id="8330420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330425">n</span><span class="op" id="8330426">,</span>&nbsp;<span class="ident" id="8330428">_</span><span class="op" id="8330429">,</span>&nbsp;<span class="ident" id="8330431">err</span>&nbsp;<span class="op" id="8330435">=</span>&nbsp;<span class="ident" id="8330437">c</span><span class="op" id="8330438">.</span><span class="op" id="8330439">(</span><span class="ident" id="8330440">PacketConn</span><span class="op" id="8330450">)</span><span class="op" id="8330451">.</span><span class="ident" id="8330452">ReadFrom</span><span class="op" id="8330460">(</span><span class="ident" id="8330461">b</span><span class="op" id="8330462">[</span><span class="num" id="8330463">0</span><span class="op" id="8330464">:</span><span class="op" id="8330465">]</span><span class="op" id="8330466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330470">}</span>&nbsp;<span class="keyword" id="8330472">else</span>&nbsp;<span class="op" id="8330477">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330482">n</span><span class="op" id="8330483">,</span>&nbsp;<span class="ident" id="8330485">err</span>&nbsp;<span class="op" id="8330489">=</span>&nbsp;<span class="ident" id="8330491">c</span><span class="op" id="8330492">.</span><span class="ident" id="8330493">Read</span><span class="op" id="8330497">(</span><span class="ident" id="8330498">b</span><span class="op" id="8330499">[</span><span class="num" id="8330500">0</span><span class="op" id="8330501">:</span><span class="op" id="8330502">]</span><span class="op" id="8330503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330511">t1</span>&nbsp;<span class="op" id="8330514">:=</span>&nbsp;<span class="ident" id="8330517">time</span><span class="op" id="8330521">.</span><span class="ident" id="8330522">Now</span><span class="op" id="8330525">(</span><span class="op" id="8330526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330530">if</span>&nbsp;<span class="ident" id="8330533">n</span>&nbsp;<span class="op" id="8330535">!=</span>&nbsp;<span class="num" id="8330538">0</span>&nbsp;<span class="op" id="8330540">||</span>&nbsp;<span class="ident" id="8330543">err</span>&nbsp;<span class="op" id="8330547">==</span>&nbsp;<span class="ident" id="8330550">nil</span>&nbsp;<span class="op" id="8330554">||</span>&nbsp;<span class="op" id="8330557">!</span><span class="ident" id="8330558">err</span><span class="op" id="8330561">.</span><span class="op" id="8330562">(</span><span class="ident" id="8330563">Error</span><span class="op" id="8330568">)</span><span class="op" id="8330569">.</span><span class="ident" id="8330570">Timeout</span><span class="op" id="8330577">(</span><span class="op" id="8330578">)</span>&nbsp;<span class="op" id="8330580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330585">errc</span>&nbsp;<span class="op" id="8330590">&lt;-</span>&nbsp;<span class="ident" id="8330593">fmt</span><span class="op" id="8330596">.</span><span class="ident" id="8330597">Errorf</span><span class="op" id="8330603">(</span><span class="string" id="8330604">&#34;%s(%q,&nbsp;%q)&nbsp;did&nbsp;not&nbsp;return&nbsp;0,&nbsp;timeout:&nbsp;%v,&nbsp;%v&#34;</span><span class="op" id="8330650">,</span>&nbsp;<span class="ident" id="8330652">what</span><span class="op" id="8330656">,</span>&nbsp;<span class="ident" id="8330658">net</span><span class="op" id="8330661">,</span>&nbsp;<span class="ident" id="8330663">addr</span><span class="op" id="8330667">,</span>&nbsp;<span class="ident" id="8330669">n</span><span class="op" id="8330670">,</span>&nbsp;<span class="ident" id="8330672">err</span><span class="op" id="8330675">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330680">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330693">if</span>&nbsp;<span class="ident" id="8330696">dt</span>&nbsp;<span class="op" id="8330699">:=</span>&nbsp;<span class="ident" id="8330702">t1</span><span class="op" id="8330704">.</span><span class="ident" id="8330705">Sub</span><span class="op" id="8330708">(</span><span class="ident" id="8330709">t0</span><span class="op" id="8330711">)</span><span class="op" id="8330712">;</span>&nbsp;<span class="ident" id="8330714">dt</span>&nbsp;<span class="op" id="8330717">&lt;</span>&nbsp;<span class="num" id="8330719">50</span><span class="op" id="8330721">*</span><span class="ident" id="8330722">time</span><span class="op" id="8330726">.</span><span class="ident" id="8330727">Millisecond</span>&nbsp;<span class="op" id="8330739">||</span>&nbsp;<span class="op" id="8330742">!</span><span class="ident" id="8330743">testing</span><span class="op" id="8330750">.</span><span class="ident" id="8330751">Short</span><span class="op" id="8330756">(</span><span class="op" id="8330757">)</span>&nbsp;<span class="op" id="8330759">&amp;&amp;</span>&nbsp;<span class="ident" id="8330762">dt</span>&nbsp;<span class="op" id="8330765">&gt;</span>&nbsp;<span class="num" id="8330767">250</span><span class="op" id="8330770">*</span><span class="ident" id="8330771">time</span><span class="op" id="8330775">.</span><span class="ident" id="8330776">Millisecond</span>&nbsp;<span class="op" id="8330788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330793">errc</span>&nbsp;<span class="op" id="8330798">&lt;-</span>&nbsp;<span class="ident" id="8330801">fmt</span><span class="op" id="8330804">.</span><span class="ident" id="8330805">Errorf</span><span class="op" id="8330811">(</span><span class="string" id="8330812">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;%s,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8330847">,</span>&nbsp;<span class="ident" id="8330849">what</span><span class="op" id="8330853">,</span>&nbsp;<span class="ident" id="8330855">net</span><span class="op" id="8330858">,</span>&nbsp;<span class="ident" id="8330860">addr</span><span class="op" id="8330864">,</span>&nbsp;<span class="ident" id="8330866">dt</span><span class="op" id="8330868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330873">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330886">errc</span>&nbsp;<span class="op" id="8330891">&lt;-</span>&nbsp;<span class="ident" id="8330894">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330899">}</span><span class="op" id="8330900">(</span><span class="op" id="8330901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330904">select</span>&nbsp;<span class="op" id="8330911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330914">case</span>&nbsp;<span class="ident" id="8330919">err</span>&nbsp;<span class="op" id="8330923">:=</span>&nbsp;<span class="op" id="8330926">&lt;-</span><span class="ident" id="8330928">errc</span><span class="op" id="8330932">:</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330936">if</span>&nbsp;<span class="ident" id="8330939">err</span>&nbsp;<span class="op" id="8330943">!=</span>&nbsp;<span class="ident" id="8330946">nil</span>&nbsp;<span class="op" id="8330950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8330955">t</span><span class="op" id="8330956">.</span><span class="ident" id="8330957">Error</span><span class="op" id="8330962">(</span><span class="ident" id="8330963">err</span><span class="op" id="8330966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8330970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8330973">case</span>&nbsp;<span class="op" id="8330978">&lt;-</span><span class="ident" id="8330980">time</span><span class="op" id="8330984">.</span><span class="ident" id="8330985">After</span><span class="op" id="8330990">(</span><span class="num" id="8330991">1</span>&nbsp;<span class="op" id="8330993">*</span>&nbsp;<span class="ident" id="8330995">time</span><span class="op" id="8330999">.</span><span class="ident" id="8331000">Second</span><span class="op" id="8331006">)</span><span class="op" id="8331007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331011">t</span><span class="op" id="8331012">.</span><span class="ident" id="8331013">Errorf</span><span class="op" id="8331019">(</span><span class="string" id="8331020">&#34;%s(%q,&nbsp;%q)&nbsp;took&nbsp;over&nbsp;1&nbsp;second,&nbsp;expected&nbsp;0.1s&#34;</span><span class="op" id="8331066">,</span>&nbsp;<span class="ident" id="8331068">what</span><span class="op" id="8331072">,</span>&nbsp;<span class="ident" id="8331074">net</span><span class="op" id="8331077">,</span>&nbsp;<span class="ident" id="8331079">addr</span><span class="op" id="8331083">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331086">}</span><br>
<span class="lineno"></span><span class="op" id="8331088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8331091">func</span>&nbsp;<span class="ident" id="8331096">TestTimeoutUDP</span><span class="op" id="8331110">(</span><span class="ident" id="8331111">t</span>&nbsp;<span class="op" id="8331113">*</span><span class="ident" id="8331114">testing</span><span class="op" id="8331121">.</span><span class="ident" id="8331122">T</span><span class="op" id="8331123">)</span>&nbsp;<span class="op" id="8331125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331128">switch</span>&nbsp;<span class="ident" id="8331135">runtime</span><span class="op" id="8331142">.</span><span class="ident" id="8331143">GOOS</span>&nbsp;<span class="op" id="8331148">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331151">case</span>&nbsp;<span class="string" id="8331156">&#34;plan9&#34;</span><span class="op" id="8331163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331167">t</span><span class="op" id="8331168">.</span><span class="ident" id="8331169">Skipf</span><span class="op" id="8331174">(</span><span class="string" id="8331175">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8331196">,</span>&nbsp;<span class="ident" id="8331198">runtime</span><span class="op" id="8331205">.</span><span class="ident" id="8331206">GOOS</span><span class="op" id="8331210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8331217">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331260">listening</span>&nbsp;<span class="op" id="8331270">:=</span>&nbsp;<span class="builtinfunc" id="8331273">make</span><span class="op" id="8331277">(</span><span class="keyword" id="8331278">chan</span>&nbsp;<span class="builtintype" id="8331283">string</span><span class="op" id="8331289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331292">done</span>&nbsp;<span class="op" id="8331297">:=</span>&nbsp;<span class="builtinfunc" id="8331300">make</span><span class="op" id="8331304">(</span><span class="keyword" id="8331305">chan</span>&nbsp;<span class="builtintype" id="8331310">int</span><span class="op" id="8331313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331316">go</span>&nbsp;<span class="ident" id="8331319">runDatagramPacketConnServer</span><span class="op" id="8331346">(</span><span class="ident" id="8331347">t</span><span class="op" id="8331348">,</span>&nbsp;<span class="string" id="8331350">&#34;udp&#34;</span><span class="op" id="8331355">,</span>&nbsp;<span class="string" id="8331357">&#34;127.0.0.1:0&#34;</span><span class="op" id="8331370">,</span>&nbsp;<span class="ident" id="8331372">listening</span><span class="op" id="8331381">,</span>&nbsp;<span class="ident" id="8331383">done</span><span class="op" id="8331387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331390">addr</span>&nbsp;<span class="op" id="8331395">:=</span>&nbsp;<span class="op" id="8331398">&lt;-</span><span class="ident" id="8331400">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331412">testTimeout</span><span class="op" id="8331423">(</span><span class="ident" id="8331424">t</span><span class="op" id="8331425">,</span>&nbsp;<span class="string" id="8331427">&#34;udp&#34;</span><span class="op" id="8331432">,</span>&nbsp;<span class="ident" id="8331434">addr</span><span class="op" id="8331438">,</span>&nbsp;<span class="builtintype" id="8331440">false</span><span class="op" id="8331445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331448">testTimeout</span><span class="op" id="8331459">(</span><span class="ident" id="8331460">t</span><span class="op" id="8331461">,</span>&nbsp;<span class="string" id="8331463">&#34;udp&#34;</span><span class="op" id="8331468">,</span>&nbsp;<span class="ident" id="8331470">addr</span><span class="op" id="8331474">,</span>&nbsp;<span class="builtintype" id="8331476">true</span><span class="op" id="8331480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331483">&lt;-</span><span class="ident" id="8331485">done</span><br>
<span class="lineno"></span><span class="op" id="8331490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="8331493">func</span>&nbsp;<span class="ident" id="8331498">TestTimeoutTCP</span><span class="op" id="8331512">(</span><span class="ident" id="8331513">t</span>&nbsp;<span class="op" id="8331515">*</span><span class="ident" id="8331516">testing</span><span class="op" id="8331523">.</span><span class="ident" id="8331524">T</span><span class="op" id="8331525">)</span>&nbsp;<span class="op" id="8331527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331530">switch</span>&nbsp;<span class="ident" id="8331537">runtime</span><span class="op" id="8331544">.</span><span class="ident" id="8331545">GOOS</span>&nbsp;<span class="op" id="8331550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331553">case</span>&nbsp;<span class="string" id="8331558">&#34;plan9&#34;</span><span class="op" id="8331565">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331569">t</span><span class="op" id="8331570">.</span><span class="ident" id="8331571">Skipf</span><span class="op" id="8331576">(</span><span class="string" id="8331577">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8331598">,</span>&nbsp;<span class="ident" id="8331600">runtime</span><span class="op" id="8331607">.</span><span class="ident" id="8331608">GOOS</span><span class="op" id="8331612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331615">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8331619">//&nbsp;set&nbsp;up&nbsp;a&nbsp;listener&nbsp;that&nbsp;won&#39;t&nbsp;talk&nbsp;back</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331662">listening</span>&nbsp;<span class="op" id="8331672">:=</span>&nbsp;<span class="builtinfunc" id="8331675">make</span><span class="op" id="8331679">(</span><span class="keyword" id="8331680">chan</span>&nbsp;<span class="builtintype" id="8331685">string</span><span class="op" id="8331691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331694">done</span>&nbsp;<span class="op" id="8331699">:=</span>&nbsp;<span class="builtinfunc" id="8331702">make</span><span class="op" id="8331706">(</span><span class="keyword" id="8331707">chan</span>&nbsp;<span class="builtintype" id="8331712">int</span><span class="op" id="8331715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331718">go</span>&nbsp;<span class="ident" id="8331721">runStreamConnServer</span><span class="op" id="8331740">(</span><span class="ident" id="8331741">t</span><span class="op" id="8331742">,</span>&nbsp;<span class="string" id="8331744">&#34;tcp&#34;</span><span class="op" id="8331749">,</span>&nbsp;<span class="string" id="8331751">&#34;127.0.0.1:0&#34;</span><span class="op" id="8331764">,</span>&nbsp;<span class="ident" id="8331766">listening</span><span class="op" id="8331775">,</span>&nbsp;<span class="ident" id="8331777">done</span><span class="op" id="8331781">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331784">addr</span>&nbsp;<span class="op" id="8331789">:=</span>&nbsp;<span class="op" id="8331792">&lt;-</span><span class="ident" id="8331794">listening</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331806">testTimeout</span><span class="op" id="8331817">(</span><span class="ident" id="8331818">t</span><span class="op" id="8331819">,</span>&nbsp;<span class="string" id="8331821">&#34;tcp&#34;</span><span class="op" id="8331826">,</span>&nbsp;<span class="ident" id="8331828">addr</span><span class="op" id="8331832">,</span>&nbsp;<span class="builtintype" id="8331834">false</span><span class="op" id="8331839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331842">&lt;-</span><span class="ident" id="8331844">done</span><br>
<span class="lineno"></span><span class="op" id="8331849">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="keyword" id="8331852">func</span>&nbsp;<span class="ident" id="8331857">TestDeadlineReset</span><span class="op" id="8331874">(</span><span class="ident" id="8331875">t</span>&nbsp;<span class="op" id="8331877">*</span><span class="ident" id="8331878">testing</span><span class="op" id="8331885">.</span><span class="ident" id="8331886">T</span><span class="op" id="8331887">)</span>&nbsp;<span class="op" id="8331889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331892">switch</span>&nbsp;<span class="ident" id="8331899">runtime</span><span class="op" id="8331906">.</span><span class="ident" id="8331907">GOOS</span>&nbsp;<span class="op" id="8331912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8331915">case</span>&nbsp;<span class="string" id="8331920">&#34;plan9&#34;</span><span class="op" id="8331927">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331931">t</span><span class="op" id="8331932">.</span><span class="ident" id="8331933">Skipf</span><span class="op" id="8331938">(</span><span class="string" id="8331939">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8331960">,</span>&nbsp;<span class="ident" id="8331962">runtime</span><span class="op" id="8331969">.</span><span class="ident" id="8331970">GOOS</span><span class="op" id="8331974">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8331977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8331980">ln</span><span class="op" id="8331982">,</span>&nbsp;<span class="ident" id="8331984">err</span>&nbsp;<span class="op" id="8331988">:=</span>&nbsp;<span class="ident" id="8331991">Listen</span><span class="op" id="8331997">(</span><span class="string" id="8331998">&#34;tcp&#34;</span><span class="op" id="8332003">,</span>&nbsp;<span class="string" id="8332005">&#34;127.0.0.1:0&#34;</span><span class="op" id="8332018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332021">if</span>&nbsp;<span class="ident" id="8332024">err</span>&nbsp;<span class="op" id="8332028">!=</span>&nbsp;<span class="ident" id="8332031">nil</span>&nbsp;<span class="op" id="8332035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332039">t</span><span class="op" id="8332040">.</span><span class="ident" id="8332041">Fatal</span><span class="op" id="8332046">(</span><span class="ident" id="8332047">err</span><span class="op" id="8332050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332053">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332056">defer</span>&nbsp;<span class="ident" id="8332062">ln</span><span class="op" id="8332064">.</span><span class="ident" id="8332065">Close</span><span class="op" id="8332070">(</span><span class="op" id="8332071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332074">tl</span>&nbsp;<span class="op" id="8332077">:=</span>&nbsp;<span class="ident" id="8332080">ln</span><span class="op" id="8332082">.</span><span class="op" id="8332083">(</span><span class="op" id="8332084">*</span><span class="ident" id="8332085">TCPListener</span><span class="op" id="8332096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332099">tl</span><span class="op" id="8332101">.</span><span class="ident" id="8332102">SetDeadline</span><span class="op" id="8332113">(</span><span class="ident" id="8332114">time</span><span class="op" id="8332118">.</span><span class="ident" id="8332119">Now</span><span class="op" id="8332122">(</span><span class="op" id="8332123">)</span><span class="op" id="8332124">.</span><span class="ident" id="8332125">Add</span><span class="op" id="8332128">(</span><span class="num" id="8332129">1</span>&nbsp;<span class="op" id="8332131">*</span>&nbsp;<span class="ident" id="8332133">time</span><span class="op" id="8332137">.</span><span class="ident" id="8332138">Minute</span><span class="op" id="8332144">)</span><span class="op" id="8332145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332148">tl</span><span class="op" id="8332150">.</span><span class="ident" id="8332151">SetDeadline</span><span class="op" id="8332162">(</span><span class="ident" id="8332163">noDeadline</span><span class="op" id="8332173">)</span>&nbsp;<span class="comment" id="8332175">//&nbsp;reset&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332188">errc</span>&nbsp;<span class="op" id="8332193">:=</span>&nbsp;<span class="builtinfunc" id="8332196">make</span><span class="op" id="8332200">(</span><span class="keyword" id="8332201">chan</span>&nbsp;<span class="builtintype" id="8332206">error</span><span class="op" id="8332211">,</span>&nbsp;<span class="num" id="8332213">1</span><span class="op" id="8332214">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332217">go</span>&nbsp;<span class="keyword" id="8332220">func</span><span class="op" id="8332224">(</span><span class="op" id="8332225">)</span>&nbsp;<span class="op" id="8332227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332231">_</span><span class="op" id="8332232">,</span>&nbsp;<span class="ident" id="8332234">err</span>&nbsp;<span class="op" id="8332238">:=</span>&nbsp;<span class="ident" id="8332241">ln</span><span class="op" id="8332243">.</span><span class="ident" id="8332244">Accept</span><span class="op" id="8332250">(</span><span class="op" id="8332251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332255">errc</span>&nbsp;<span class="op" id="8332260">&lt;-</span>&nbsp;<span class="ident" id="8332263">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332268">}</span><span class="op" id="8332269">(</span><span class="op" id="8332270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332273">select</span>&nbsp;<span class="op" id="8332280">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332283">case</span>&nbsp;<span class="op" id="8332288">&lt;-</span><span class="ident" id="8332290">time</span><span class="op" id="8332294">.</span><span class="ident" id="8332295">After</span><span class="op" id="8332300">(</span><span class="num" id="8332301">50</span>&nbsp;<span class="op" id="8332304">*</span>&nbsp;<span class="ident" id="8332306">time</span><span class="op" id="8332310">.</span><span class="ident" id="8332311">Millisecond</span><span class="op" id="8332322">)</span><span class="op" id="8332323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8332327">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332337">case</span>&nbsp;<span class="ident" id="8332342">err</span>&nbsp;<span class="op" id="8332346">:=</span>&nbsp;<span class="op" id="8332349">&lt;-</span><span class="ident" id="8332351">errc</span><span class="op" id="8332355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8332359">//&nbsp;Accept&nbsp;should&nbsp;never&nbsp;return;&nbsp;we&nbsp;never</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8332401">//&nbsp;connected&nbsp;to&nbsp;it.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332423">t</span><span class="op" id="8332424">.</span><span class="ident" id="8332425">Errorf</span><span class="op" id="8332431">(</span><span class="string" id="8332432">&#34;unexpected&nbsp;return&nbsp;from&nbsp;Accept;&nbsp;err=%v&#34;</span><span class="op" id="8332471">,</span>&nbsp;<span class="ident" id="8332473">err</span><span class="op" id="8332476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332479">}</span><br>
<span class="lineno"></span><span class="op" id="8332481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8332484">func</span>&nbsp;<span class="ident" id="8332489">TestTimeoutAccept</span><span class="op" id="8332506">(</span><span class="ident" id="8332507">t</span>&nbsp;<span class="op" id="8332509">*</span><span class="ident" id="8332510">testing</span><span class="op" id="8332517">.</span><span class="ident" id="8332518">T</span><span class="op" id="8332519">)</span>&nbsp;<span class="op" id="8332521">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332524">switch</span>&nbsp;<span class="ident" id="8332531">runtime</span><span class="op" id="8332538">.</span><span class="ident" id="8332539">GOOS</span>&nbsp;<span class="op" id="8332544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332547">case</span>&nbsp;<span class="string" id="8332552">&#34;plan9&#34;</span><span class="op" id="8332559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332563">t</span><span class="op" id="8332564">.</span><span class="ident" id="8332565">Skipf</span><span class="op" id="8332570">(</span><span class="string" id="8332571">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8332592">,</span>&nbsp;<span class="ident" id="8332594">runtime</span><span class="op" id="8332601">.</span><span class="ident" id="8332602">GOOS</span><span class="op" id="8332606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332612">ln</span><span class="op" id="8332614">,</span>&nbsp;<span class="ident" id="8332616">err</span>&nbsp;<span class="op" id="8332620">:=</span>&nbsp;<span class="ident" id="8332623">Listen</span><span class="op" id="8332629">(</span><span class="string" id="8332630">&#34;tcp&#34;</span><span class="op" id="8332635">,</span>&nbsp;<span class="string" id="8332637">&#34;127.0.0.1:0&#34;</span><span class="op" id="8332650">)</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332653">if</span>&nbsp;<span class="ident" id="8332656">err</span>&nbsp;<span class="op" id="8332660">!=</span>&nbsp;<span class="ident" id="8332663">nil</span>&nbsp;<span class="op" id="8332667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332671">t</span><span class="op" id="8332672">.</span><span class="ident" id="8332673">Fatal</span><span class="op" id="8332678">(</span><span class="ident" id="8332679">err</span><span class="op" id="8332682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332688">defer</span>&nbsp;<span class="ident" id="8332694">ln</span><span class="op" id="8332696">.</span><span class="ident" id="8332697">Close</span><span class="op" id="8332702">(</span><span class="op" id="8332703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332706">tl</span>&nbsp;<span class="op" id="8332709">:=</span>&nbsp;<span class="ident" id="8332712">ln</span><span class="op" id="8332714">.</span><span class="op" id="8332715">(</span><span class="op" id="8332716">*</span><span class="ident" id="8332717">TCPListener</span><span class="op" id="8332728">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332731">tl</span><span class="op" id="8332733">.</span><span class="ident" id="8332734">SetDeadline</span><span class="op" id="8332745">(</span><span class="ident" id="8332746">time</span><span class="op" id="8332750">.</span><span class="ident" id="8332751">Now</span><span class="op" id="8332754">(</span><span class="op" id="8332755">)</span><span class="op" id="8332756">.</span><span class="ident" id="8332757">Add</span><span class="op" id="8332760">(</span><span class="num" id="8332761">100</span>&nbsp;<span class="op" id="8332765">*</span>&nbsp;<span class="ident" id="8332767">time</span><span class="op" id="8332771">.</span><span class="ident" id="8332772">Millisecond</span><span class="op" id="8332783">)</span><span class="op" id="8332784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332787">errc</span>&nbsp;<span class="op" id="8332792">:=</span>&nbsp;<span class="builtinfunc" id="8332795">make</span><span class="op" id="8332799">(</span><span class="keyword" id="8332800">chan</span>&nbsp;<span class="builtintype" id="8332805">error</span><span class="op" id="8332810">,</span>&nbsp;<span class="num" id="8332812">1</span><span class="op" id="8332813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332816">go</span>&nbsp;<span class="keyword" id="8332819">func</span><span class="op" id="8332823">(</span><span class="op" id="8332824">)</span>&nbsp;<span class="op" id="8332826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332830">_</span><span class="op" id="8332831">,</span>&nbsp;<span class="ident" id="8332833">err</span>&nbsp;<span class="op" id="8332837">:=</span>&nbsp;<span class="ident" id="8332840">ln</span><span class="op" id="8332842">.</span><span class="ident" id="8332843">Accept</span><span class="op" id="8332849">(</span><span class="op" id="8332850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332854">errc</span>&nbsp;<span class="op" id="8332859">&lt;-</span>&nbsp;<span class="ident" id="8332862">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8332867">}</span><span class="op" id="8332868">(</span><span class="op" id="8332869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332872">select</span>&nbsp;<span class="op" id="8332879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8332882">case</span>&nbsp;<span class="op" id="8332887">&lt;-</span><span class="ident" id="8332889">time</span><span class="op" id="8332893">.</span><span class="ident" id="8332894">After</span><span class="op" id="8332899">(</span><span class="num" id="8332900">1</span>&nbsp;<span class="op" id="8332902">*</span>&nbsp;<span class="ident" id="8332904">time</span><span class="op" id="8332908">.</span><span class="ident" id="8332909">Second</span><span class="op" id="8332915">)</span><span class="op" id="8332916">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8332920">//&nbsp;Accept&nbsp;shouldn&#39;t&nbsp;block&nbsp;indefinitely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8332961">t</span><span class="op" id="8332962">.</span><span class="ident" id="8332963">Errorf</span><span class="op" id="8332969">(</span><span class="string" id="8332970">&#34;Accept&nbsp;didn&#39;t&nbsp;return&nbsp;in&nbsp;an&nbsp;expected&nbsp;time&#34;</span><span class="op" id="8333012">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333015">case</span>&nbsp;<span class="op" id="8333020">&lt;-</span><span class="ident" id="8333022">errc</span><span class="op" id="8333026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8333030">//&nbsp;Pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333040">}</span><br>
<span class="lineno"></span><span class="op" id="8333042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="8333045">func</span>&nbsp;<span class="ident" id="8333050">TestReadWriteDeadline</span><span class="op" id="8333071">(</span><span class="ident" id="8333072">t</span>&nbsp;<span class="op" id="8333074">*</span><span class="ident" id="8333075">testing</span><span class="op" id="8333082">.</span><span class="ident" id="8333083">T</span><span class="op" id="8333084">)</span>&nbsp;<span class="op" id="8333086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333089">switch</span>&nbsp;<span class="ident" id="8333096">runtime</span><span class="op" id="8333103">.</span><span class="ident" id="8333104">GOOS</span>&nbsp;<span class="op" id="8333109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333112">case</span>&nbsp;<span class="string" id="8333117">&#34;plan9&#34;</span><span class="op" id="8333124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333128">t</span><span class="op" id="8333129">.</span><span class="ident" id="8333130">Skipf</span><span class="op" id="8333135">(</span><span class="string" id="8333136">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8333157">,</span>&nbsp;<span class="ident" id="8333159">runtime</span><span class="op" id="8333166">.</span><span class="ident" id="8333167">GOOS</span><span class="op" id="8333171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333174">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333178">const</span>&nbsp;<span class="op" id="8333184">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333188">readTimeout</span>&nbsp;&nbsp;<span class="op" id="8333201">=</span>&nbsp;<span class="num" id="8333203">50</span>&nbsp;<span class="op" id="8333206">*</span>&nbsp;<span class="ident" id="8333208">time</span><span class="op" id="8333212">.</span><span class="ident" id="8333213">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333227">writeTimeout</span>&nbsp;<span class="op" id="8333240">=</span>&nbsp;<span class="num" id="8333242">250</span>&nbsp;<span class="op" id="8333246">*</span>&nbsp;<span class="ident" id="8333248">time</span><span class="op" id="8333252">.</span><span class="ident" id="8333253">Millisecond</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333266">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333269">checkTimeout</span>&nbsp;<span class="op" id="8333282">:=</span>&nbsp;<span class="keyword" id="8333285">func</span><span class="op" id="8333289">(</span><span class="ident" id="8333290">command</span>&nbsp;<span class="builtintype" id="8333298">string</span><span class="op" id="8333304">,</span>&nbsp;<span class="ident" id="8333306">start</span>&nbsp;<span class="ident" id="8333312">time</span><span class="op" id="8333316">.</span><span class="ident" id="8333317">Time</span><span class="op" id="8333321">,</span>&nbsp;<span class="ident" id="8333323">should</span>&nbsp;<span class="ident" id="8333330">time</span><span class="op" id="8333334">.</span><span class="ident" id="8333335">Duration</span><span class="op" id="8333343">)</span>&nbsp;<span class="op" id="8333345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333349">is</span>&nbsp;<span class="op" id="8333352">:=</span>&nbsp;<span class="ident" id="8333355">time</span><span class="op" id="8333359">.</span><span class="ident" id="8333360">Now</span><span class="op" id="8333363">(</span><span class="op" id="8333364">)</span><span class="op" id="8333365">.</span><span class="ident" id="8333366">Sub</span><span class="op" id="8333369">(</span><span class="ident" id="8333370">start</span><span class="op" id="8333375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333379">d</span>&nbsp;<span class="op" id="8333381">:=</span>&nbsp;<span class="ident" id="8333384">is</span>&nbsp;<span class="op" id="8333387">-</span>&nbsp;<span class="ident" id="8333389">should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333398">if</span>&nbsp;<span class="ident" id="8333401">d</span>&nbsp;<span class="op" id="8333403">&lt;</span>&nbsp;<span class="op" id="8333405">-</span><span class="num" id="8333406">30</span><span class="op" id="8333408">*</span><span class="ident" id="8333409">time</span><span class="op" id="8333413">.</span><span class="ident" id="8333414">Millisecond</span>&nbsp;<span class="op" id="8333426">||</span>&nbsp;<span class="op" id="8333429">!</span><span class="ident" id="8333430">testing</span><span class="op" id="8333437">.</span><span class="ident" id="8333438">Short</span><span class="op" id="8333443">(</span><span class="op" id="8333444">)</span>&nbsp;<span class="op" id="8333446">&amp;&amp;</span>&nbsp;<span class="num" id="8333449">150</span><span class="op" id="8333452">*</span><span class="ident" id="8333453">time</span><span class="op" id="8333457">.</span><span class="ident" id="8333458">Millisecond</span>&nbsp;<span class="op" id="8333470">&lt;</span>&nbsp;<span class="ident" id="8333472">d</span>&nbsp;<span class="op" id="8333474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333479">t</span><span class="op" id="8333480">.</span><span class="ident" id="8333481">Errorf</span><span class="op" id="8333487">(</span><span class="string" id="8333488">&#34;%s&nbsp;timeout&nbsp;test&nbsp;failed:&nbsp;is=%v&nbsp;should=%v\n&#34;</span><span class="op" id="8333531">,</span>&nbsp;<span class="ident" id="8333533">command</span><span class="op" id="8333540">,</span>&nbsp;<span class="ident" id="8333542">is</span><span class="op" id="8333544">,</span>&nbsp;<span class="ident" id="8333546">should</span><span class="op" id="8333552">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333563">ln</span><span class="op" id="8333565">,</span>&nbsp;<span class="ident" id="8333567">err</span>&nbsp;<span class="op" id="8333571">:=</span>&nbsp;<span class="ident" id="8333574">Listen</span><span class="op" id="8333580">(</span><span class="string" id="8333581">&#34;tcp&#34;</span><span class="op" id="8333586">,</span>&nbsp;<span class="string" id="8333588">&#34;127.0.0.1:0&#34;</span><span class="op" id="8333601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333604">if</span>&nbsp;<span class="ident" id="8333607">err</span>&nbsp;<span class="op" id="8333611">!=</span>&nbsp;<span class="ident" id="8333614">nil</span>&nbsp;<span class="op" id="8333618">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333622">t</span><span class="op" id="8333623">.</span><span class="ident" id="8333624">Fatalf</span><span class="op" id="8333630">(</span><span class="string" id="8333631">&#34;ListenTCP&nbsp;on&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="8333652">,</span>&nbsp;<span class="ident" id="8333654">err</span><span class="op" id="8333657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333663">defer</span>&nbsp;<span class="ident" id="8333669">ln</span><span class="op" id="8333671">.</span><span class="ident" id="8333672">Close</span><span class="op" id="8333677">(</span><span class="op" id="8333678">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333682">lnquit</span>&nbsp;<span class="op" id="8333689">:=</span>&nbsp;<span class="builtinfunc" id="8333692">make</span><span class="op" id="8333696">(</span><span class="keyword" id="8333697">chan</span>&nbsp;<span class="builtintype" id="8333702">bool</span><span class="op" id="8333706">)</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333710">go</span>&nbsp;<span class="keyword" id="8333713">func</span><span class="op" id="8333717">(</span><span class="op" id="8333718">)</span>&nbsp;<span class="op" id="8333720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333724">c</span><span class="op" id="8333725">,</span>&nbsp;<span class="ident" id="8333727">err</span>&nbsp;<span class="op" id="8333731">:=</span>&nbsp;<span class="ident" id="8333734">ln</span><span class="op" id="8333736">.</span><span class="ident" id="8333737">Accept</span><span class="op" id="8333743">(</span><span class="op" id="8333744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333748">if</span>&nbsp;<span class="ident" id="8333751">err</span>&nbsp;<span class="op" id="8333755">!=</span>&nbsp;<span class="ident" id="8333758">nil</span>&nbsp;<span class="op" id="8333762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333767">t</span><span class="op" id="8333768">.</span><span class="ident" id="8333769">Errorf</span><span class="op" id="8333775">(</span><span class="string" id="8333776">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8333788">,</span>&nbsp;<span class="ident" id="8333790">err</span><span class="op" id="8333793">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333798">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333811">defer</span>&nbsp;<span class="ident" id="8333817">c</span><span class="op" id="8333818">.</span><span class="ident" id="8333819">Close</span><span class="op" id="8333824">(</span><span class="op" id="8333825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333829">lnquit</span>&nbsp;<span class="op" id="8333836">&lt;-</span>&nbsp;<span class="builtintype" id="8333839">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333845">}</span><span class="op" id="8333846">(</span><span class="op" id="8333847">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333851">c</span><span class="op" id="8333852">,</span>&nbsp;<span class="ident" id="8333854">err</span>&nbsp;<span class="op" id="8333858">:=</span>&nbsp;<span class="ident" id="8333861">Dial</span><span class="op" id="8333865">(</span><span class="string" id="8333866">&#34;tcp&#34;</span><span class="op" id="8333871">,</span>&nbsp;<span class="ident" id="8333873">ln</span><span class="op" id="8333875">.</span><span class="ident" id="8333876">Addr</span><span class="op" id="8333880">(</span><span class="op" id="8333881">)</span><span class="op" id="8333882">.</span><span class="ident" id="8333883">String</span><span class="op" id="8333889">(</span><span class="op" id="8333890">)</span><span class="op" id="8333891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333894">if</span>&nbsp;<span class="ident" id="8333897">err</span>&nbsp;<span class="op" id="8333901">!=</span>&nbsp;<span class="ident" id="8333904">nil</span>&nbsp;<span class="op" id="8333908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333912">t</span><span class="op" id="8333913">.</span><span class="ident" id="8333914">Fatalf</span><span class="op" id="8333920">(</span><span class="string" id="8333921">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8333931">,</span>&nbsp;<span class="ident" id="8333933">err</span><span class="op" id="8333936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8333939">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8333942">defer</span>&nbsp;<span class="ident" id="8333948">c</span><span class="op" id="8333949">.</span><span class="ident" id="8333950">Close</span><span class="op" id="8333955">(</span><span class="op" id="8333956">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333960">start</span>&nbsp;<span class="op" id="8333966">:=</span>&nbsp;<span class="ident" id="8333969">time</span><span class="op" id="8333973">.</span><span class="ident" id="8333974">Now</span><span class="op" id="8333977">(</span><span class="op" id="8333978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8333981">err</span>&nbsp;<span class="op" id="8333985">=</span>&nbsp;<span class="ident" id="8333987">c</span><span class="op" id="8333988">.</span><span class="ident" id="8333989">SetReadDeadline</span><span class="op" id="8334004">(</span><span class="ident" id="8334005">start</span><span class="op" id="8334010">.</span><span class="ident" id="8334011">Add</span><span class="op" id="8334014">(</span><span class="ident" id="8334015">readTimeout</span><span class="op" id="8334026">)</span><span class="op" id="8334027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334030">if</span>&nbsp;<span class="ident" id="8334033">err</span>&nbsp;<span class="op" id="8334037">!=</span>&nbsp;<span class="ident" id="8334040">nil</span>&nbsp;<span class="op" id="8334044">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334048">t</span><span class="op" id="8334049">.</span><span class="ident" id="8334050">Fatalf</span><span class="op" id="8334056">(</span><span class="string" id="8334057">&#34;SetReadDeadline:&nbsp;%v&#34;</span><span class="op" id="8334078">,</span>&nbsp;<span class="ident" id="8334080">err</span><span class="op" id="8334083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334089">err</span>&nbsp;<span class="op" id="8334093">=</span>&nbsp;<span class="ident" id="8334095">c</span><span class="op" id="8334096">.</span><span class="ident" id="8334097">SetWriteDeadline</span><span class="op" id="8334113">(</span><span class="ident" id="8334114">start</span><span class="op" id="8334119">.</span><span class="ident" id="8334120">Add</span><span class="op" id="8334123">(</span><span class="ident" id="8334124">writeTimeout</span><span class="op" id="8334136">)</span><span class="op" id="8334137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334140">if</span>&nbsp;<span class="ident" id="8334143">err</span>&nbsp;<span class="op" id="8334147">!=</span>&nbsp;<span class="ident" id="8334150">nil</span>&nbsp;<span class="op" id="8334154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334158">t</span><span class="op" id="8334159">.</span><span class="ident" id="8334160">Fatalf</span><span class="op" id="8334166">(</span><span class="string" id="8334167">&#34;SetWriteDeadline:&nbsp;%v&#34;</span><span class="op" id="8334189">,</span>&nbsp;<span class="ident" id="8334191">err</span><span class="op" id="8334194">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334201">quit</span>&nbsp;<span class="op" id="8334206">:=</span>&nbsp;<span class="builtinfunc" id="8334209">make</span><span class="op" id="8334213">(</span><span class="keyword" id="8334214">chan</span>&nbsp;<span class="builtintype" id="8334219">bool</span><span class="op" id="8334223">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334227">go</span>&nbsp;<span class="keyword" id="8334230">func</span><span class="op" id="8334234">(</span><span class="op" id="8334235">)</span>&nbsp;<span class="op" id="8334237">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334241">var</span>&nbsp;<span class="ident" id="8334245">buf</span>&nbsp;<span class="op" id="8334249">[</span><span class="num" id="8334250">10</span><span class="op" id="8334252">]</span><span class="builtintype" id="8334253">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334260">_</span><span class="op" id="8334261">,</span>&nbsp;<span class="ident" id="8334263">err</span>&nbsp;<span class="op" id="8334267">:=</span>&nbsp;<span class="ident" id="8334270">c</span><span class="op" id="8334271">.</span><span class="ident" id="8334272">Read</span><span class="op" id="8334276">(</span><span class="ident" id="8334277">buf</span><span class="op" id="8334280">[</span><span class="op" id="8334281">:</span><span class="op" id="8334282">]</span><span class="op" id="8334283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334287">if</span>&nbsp;<span class="ident" id="8334290">err</span>&nbsp;<span class="op" id="8334294">==</span>&nbsp;<span class="ident" id="8334297">nil</span>&nbsp;<span class="op" id="8334301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334306">t</span><span class="op" id="8334307">.</span><span class="ident" id="8334308">Errorf</span><span class="op" id="8334314">(</span><span class="string" id="8334315">&#34;Read&nbsp;should&nbsp;not&nbsp;succeed&#34;</span><span class="op" id="8334340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334344">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334348">checkTimeout</span><span class="op" id="8334360">(</span><span class="string" id="8334361">&#34;Read&#34;</span><span class="op" id="8334367">,</span>&nbsp;<span class="ident" id="8334369">start</span><span class="op" id="8334374">,</span>&nbsp;<span class="ident" id="8334376">readTimeout</span><span class="op" id="8334387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334391">quit</span>&nbsp;<span class="op" id="8334396">&lt;-</span>&nbsp;<span class="builtintype" id="8334399">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334405">}</span><span class="op" id="8334406">(</span><span class="op" id="8334407">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334411">go</span>&nbsp;<span class="keyword" id="8334414">func</span><span class="op" id="8334418">(</span><span class="op" id="8334419">)</span>&nbsp;<span class="op" id="8334421">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334425">var</span>&nbsp;<span class="ident" id="8334429">buf</span>&nbsp;<span class="op" id="8334433">[</span><span class="num" id="8334434">10000</span><span class="op" id="8334439">]</span><span class="builtintype" id="8334440">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334447">for</span>&nbsp;<span class="op" id="8334451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334456">_</span><span class="op" id="8334457">,</span>&nbsp;<span class="ident" id="8334459">err</span>&nbsp;<span class="op" id="8334463">:=</span>&nbsp;<span class="ident" id="8334466">c</span><span class="op" id="8334467">.</span><span class="ident" id="8334468">Write</span><span class="op" id="8334473">(</span><span class="ident" id="8334474">buf</span><span class="op" id="8334477">[</span><span class="op" id="8334478">:</span><span class="op" id="8334479">]</span><span class="op" id="8334480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334485">if</span>&nbsp;<span class="ident" id="8334488">err</span>&nbsp;<span class="op" id="8334492">!=</span>&nbsp;<span class="ident" id="8334495">nil</span>&nbsp;<span class="op" id="8334499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334505">break</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334522">checkTimeout</span><span class="op" id="8334534">(</span><span class="string" id="8334535">&#34;Write&#34;</span><span class="op" id="8334542">,</span>&nbsp;<span class="ident" id="8334544">start</span><span class="op" id="8334549">,</span>&nbsp;<span class="ident" id="8334551">writeTimeout</span><span class="op" id="8334563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334567">quit</span>&nbsp;<span class="op" id="8334572">&lt;-</span>&nbsp;<span class="builtintype" id="8334575">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334581">}</span><span class="op" id="8334582">(</span><span class="op" id="8334583">)</span><br>
<span class="lineno">400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334587">&lt;-</span><span class="ident" id="8334589">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334595">&lt;-</span><span class="ident" id="8334597">quit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334603">&lt;-</span><span class="ident" id="8334605">lnquit</span><br>
<span class="lineno"></span><span class="op" id="8334612">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="8334615">type</span>&nbsp;<span class="ident" id="8334620">neverEnding</span>&nbsp;<span class="builtintype" id="8334632">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8334638">func</span>&nbsp;<span class="op" id="8334643">(</span><span class="ident" id="8334644">b</span>&nbsp;<span class="ident" id="8334646">neverEnding</span><span class="op" id="8334657">)</span>&nbsp;<span class="ident" id="8334659">Read</span><span class="op" id="8334663">(</span><span class="ident" id="8334664">p</span>&nbsp;<span class="op" id="8334666">[</span><span class="op" id="8334667">]</span><span class="builtintype" id="8334668">byte</span><span class="op" id="8334672">)</span>&nbsp;<span class="op" id="8334674">(</span><span class="ident" id="8334675">n</span>&nbsp;<span class="builtintype" id="8334677">int</span><span class="op" id="8334680">,</span>&nbsp;<span class="ident" id="8334682">err</span>&nbsp;<span class="builtintype" id="8334686">error</span><span class="op" id="8334691">)</span>&nbsp;<span class="op" id="8334693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334696">for</span>&nbsp;<span class="ident" id="8334700">i</span>&nbsp;<span class="op" id="8334702">:=</span>&nbsp;<span class="keyword" id="8334705">range</span>&nbsp;<span class="ident" id="8334711">p</span>&nbsp;<span class="op" id="8334713">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334717">p</span><span class="op" id="8334718">[</span><span class="ident" id="8334719">i</span><span class="op" id="8334720">]</span>&nbsp;<span class="op" id="8334722">=</span>&nbsp;<span class="builtintype" id="8334724">byte</span><span class="op" id="8334728">(</span><span class="ident" id="8334729">b</span><span class="op" id="8334730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8334733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334736">return</span>&nbsp;<span class="builtinfunc" id="8334743">len</span><span class="op" id="8334746">(</span><span class="ident" id="8334747">p</span><span class="op" id="8334748">)</span><span class="op" id="8334749">,</span>&nbsp;<span class="ident" id="8334751">nil</span><br>
<span class="lineno"></span><span class="op" id="8334755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="8334758">func</span>&nbsp;<span class="ident" id="8334763">TestVariousDeadlines1Proc</span><span class="op" id="8334788">(</span><span class="ident" id="8334789">t</span>&nbsp;<span class="op" id="8334791">*</span><span class="ident" id="8334792">testing</span><span class="op" id="8334799">.</span><span class="ident" id="8334800">T</span><span class="op" id="8334801">)</span>&nbsp;<span class="op" id="8334803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334806">testVariousDeadlines</span><span class="op" id="8334826">(</span><span class="ident" id="8334827">t</span><span class="op" id="8334828">,</span>&nbsp;<span class="num" id="8334830">1</span><span class="op" id="8334831">)</span><br>
<span class="lineno"></span><span class="op" id="8334833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8334836">func</span>&nbsp;<span class="ident" id="8334841">TestVariousDeadlines4Proc</span><span class="op" id="8334866">(</span><span class="ident" id="8334867">t</span>&nbsp;<span class="op" id="8334869">*</span><span class="ident" id="8334870">testing</span><span class="op" id="8334877">.</span><span class="ident" id="8334878">T</span><span class="op" id="8334879">)</span>&nbsp;<span class="op" id="8334881">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8334884">testVariousDeadlines</span><span class="op" id="8334904">(</span><span class="ident" id="8334905">t</span><span class="op" id="8334906">,</span>&nbsp;<span class="num" id="8334908">4</span><span class="op" id="8334909">)</span><br>
<span class="lineno"></span><span class="op" id="8334911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8334914">func</span>&nbsp;<span class="ident" id="8334919">testVariousDeadlines</span><span class="op" id="8334939">(</span><span class="ident" id="8334940">t</span>&nbsp;<span class="op" id="8334942">*</span><span class="ident" id="8334943">testing</span><span class="op" id="8334950">.</span><span class="ident" id="8334951">T</span><span class="op" id="8334952">,</span>&nbsp;<span class="ident" id="8334954">maxProcs</span>&nbsp;<span class="builtintype" id="8334963">int</span><span class="op" id="8334966">)</span>&nbsp;<span class="op" id="8334968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334971">switch</span>&nbsp;<span class="ident" id="8334978">runtime</span><span class="op" id="8334985">.</span><span class="ident" id="8334986">GOOS</span>&nbsp;<span class="op" id="8334991">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8334994">case</span>&nbsp;<span class="string" id="8334999">&#34;plan9&#34;</span><span class="op" id="8335006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335010">t</span><span class="op" id="8335011">.</span><span class="ident" id="8335012">Skipf</span><span class="op" id="8335017">(</span><span class="string" id="8335018">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8335039">,</span>&nbsp;<span class="ident" id="8335041">runtime</span><span class="op" id="8335048">.</span><span class="ident" id="8335049">GOOS</span><span class="op" id="8335053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335060">defer</span>&nbsp;<span class="ident" id="8335066">runtime</span><span class="op" id="8335073">.</span><span class="ident" id="8335074">GOMAXPROCS</span><span class="op" id="8335084">(</span><span class="ident" id="8335085">runtime</span><span class="op" id="8335092">.</span><span class="ident" id="8335093">GOMAXPROCS</span><span class="op" id="8335103">(</span><span class="ident" id="8335104">maxProcs</span><span class="op" id="8335112">)</span><span class="op" id="8335113">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335116">ln</span>&nbsp;<span class="op" id="8335119">:=</span>&nbsp;<span class="ident" id="8335122">newLocalListener</span><span class="op" id="8335138">(</span><span class="ident" id="8335139">t</span><span class="op" id="8335140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335143">defer</span>&nbsp;<span class="ident" id="8335149">ln</span><span class="op" id="8335151">.</span><span class="ident" id="8335152">Close</span><span class="op" id="8335157">(</span><span class="op" id="8335158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335161">acceptc</span>&nbsp;<span class="op" id="8335169">:=</span>&nbsp;<span class="builtinfunc" id="8335172">make</span><span class="op" id="8335176">(</span><span class="keyword" id="8335177">chan</span>&nbsp;<span class="builtintype" id="8335182">error</span><span class="op" id="8335187">,</span>&nbsp;<span class="num" id="8335189">1</span><span class="op" id="8335190">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335194">//&nbsp;The&nbsp;server,&nbsp;with&nbsp;no&nbsp;timeouts&nbsp;of&nbsp;its&nbsp;own,&nbsp;sending&nbsp;bytes&nbsp;to&nbsp;clients</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8335264">//&nbsp;as&nbsp;fast&nbsp;as&nbsp;it&nbsp;can.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335287">servec</span>&nbsp;<span class="op" id="8335294">:=</span>&nbsp;<span class="builtinfunc" id="8335297">make</span><span class="op" id="8335301">(</span><span class="keyword" id="8335302">chan</span>&nbsp;<span class="ident" id="8335307">copyRes</span><span class="op" id="8335314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335317">go</span>&nbsp;<span class="keyword" id="8335320">func</span><span class="op" id="8335324">(</span><span class="op" id="8335325">)</span>&nbsp;<span class="op" id="8335327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335331">for</span>&nbsp;<span class="op" id="8335335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335340">c</span><span class="op" id="8335341">,</span>&nbsp;<span class="ident" id="8335343">err</span>&nbsp;<span class="op" id="8335347">:=</span>&nbsp;<span class="ident" id="8335350">ln</span><span class="op" id="8335352">.</span><span class="ident" id="8335353">Accept</span><span class="op" id="8335359">(</span><span class="op" id="8335360">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335365">if</span>&nbsp;<span class="ident" id="8335368">err</span>&nbsp;<span class="op" id="8335372">!=</span>&nbsp;<span class="ident" id="8335375">nil</span>&nbsp;<span class="op" id="8335379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335385">acceptc</span>&nbsp;<span class="op" id="8335393">&lt;-</span>&nbsp;<span class="ident" id="8335396">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335404">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335419">go</span>&nbsp;<span class="keyword" id="8335422">func</span><span class="op" id="8335426">(</span><span class="op" id="8335427">)</span>&nbsp;<span class="op" id="8335429">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335435">t0</span>&nbsp;<span class="op" id="8335438">:=</span>&nbsp;<span class="ident" id="8335441">time</span><span class="op" id="8335445">.</span><span class="ident" id="8335446">Now</span><span class="op" id="8335449">(</span><span class="op" id="8335450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335456">n</span><span class="op" id="8335457">,</span>&nbsp;<span class="ident" id="8335459">err</span>&nbsp;<span class="op" id="8335463">:=</span>&nbsp;<span class="ident" id="8335466">io</span><span class="op" id="8335468">.</span><span class="ident" id="8335469">Copy</span><span class="op" id="8335473">(</span><span class="ident" id="8335474">c</span><span class="op" id="8335475">,</span>&nbsp;<span class="ident" id="8335477">neverEnding</span><span class="op" id="8335488">(</span><span class="string" id="8335489">&#39;a&#39;</span><span class="op" id="8335492">)</span><span class="op" id="8335493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335499">d</span>&nbsp;<span class="op" id="8335501">:=</span>&nbsp;<span class="ident" id="8335504">time</span><span class="op" id="8335508">.</span><span class="ident" id="8335509">Since</span><span class="op" id="8335514">(</span><span class="ident" id="8335515">t0</span><span class="op" id="8335517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335523">c</span><span class="op" id="8335524">.</span><span class="ident" id="8335525">Close</span><span class="op" id="8335530">(</span><span class="op" id="8335531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8335537">servec</span>&nbsp;<span class="op" id="8335544">&lt;-</span>&nbsp;<span class="ident" id="8335547">copyRes</span><span class="op" id="8335554">{</span><span class="ident" id="8335555">n</span><span class="op" id="8335556">,</span>&nbsp;<span class="ident" id="8335558">err</span><span class="op" id="8335561">,</span>&nbsp;<span class="ident" id="8335563">d</span><span class="op" id="8335564">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335569">}</span><span class="op" id="8335570">(</span><span class="op" id="8335571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8335578">}</span><span class="op" id="8335579">(</span><span class="op" id="8335580">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8335584">for</span>&nbsp;<span class="ident" id="8335588">_</span><span class="op" id="8335589">,</span>&nbsp;<span class="ident" id="8335591">timeout</span>&nbsp;<span class="op" id="8335599">:=</span>&nbsp;<span class="keyword" id="8335602">range</span>&nbsp;<span class="op" id="8335608">[</span><span class="op" id="8335609">]</span><span class="ident" id="8335610">time</span><span class="op" id="8335614">.</span><span class="ident" id="8335615">Duration</span><span class="op" id="8335623">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335627">1</span>&nbsp;<span class="op" id="8335629">*</span>&nbsp;<span class="ident" id="8335631">time</span><span class="op" id="8335635">.</span><span class="ident" id="8335636">Nanosecond</span><span class="op" id="8335646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335650">2</span>&nbsp;<span class="op" id="8335652">*</span>&nbsp;<span class="ident" id="8335654">time</span><span class="op" id="8335658">.</span><span class="ident" id="8335659">Nanosecond</span><span class="op" id="8335669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335673">5</span>&nbsp;<span class="op" id="8335675">*</span>&nbsp;<span class="ident" id="8335677">time</span><span class="op" id="8335681">.</span><span class="ident" id="8335682">Nanosecond</span><span class="op" id="8335692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335696">50</span>&nbsp;<span class="op" id="8335699">*</span>&nbsp;<span class="ident" id="8335701">time</span><span class="op" id="8335705">.</span><span class="ident" id="8335706">Nanosecond</span><span class="op" id="8335716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335720">100</span>&nbsp;<span class="op" id="8335724">*</span>&nbsp;<span class="ident" id="8335726">time</span><span class="op" id="8335730">.</span><span class="ident" id="8335731">Nanosecond</span><span class="op" id="8335741">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335745">200</span>&nbsp;<span class="op" id="8335749">*</span>&nbsp;<span class="ident" id="8335751">time</span><span class="op" id="8335755">.</span><span class="ident" id="8335756">Nanosecond</span><span class="op" id="8335766">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335770">500</span>&nbsp;<span class="op" id="8335774">*</span>&nbsp;<span class="ident" id="8335776">time</span><span class="op" id="8335780">.</span><span class="ident" id="8335781">Nanosecond</span><span class="op" id="8335791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335795">750</span>&nbsp;<span class="op" id="8335799">*</span>&nbsp;<span class="ident" id="8335801">time</span><span class="op" id="8335805">.</span><span class="ident" id="8335806">Nanosecond</span><span class="op" id="8335816">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335820">1</span>&nbsp;<span class="op" id="8335822">*</span>&nbsp;<span class="ident" id="8335824">time</span><span class="op" id="8335828">.</span><span class="ident" id="8335829">Microsecond</span><span class="op" id="8335840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335844">5</span>&nbsp;<span class="op" id="8335846">*</span>&nbsp;<span class="ident" id="8335848">time</span><span class="op" id="8335852">.</span><span class="ident" id="8335853">Microsecond</span><span class="op" id="8335864">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335868">25</span>&nbsp;<span class="op" id="8335871">*</span>&nbsp;<span class="ident" id="8335873">time</span><span class="op" id="8335877">.</span><span class="ident" id="8335878">Microsecond</span><span class="op" id="8335889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335893">250</span>&nbsp;<span class="op" id="8335897">*</span>&nbsp;<span class="ident" id="8335899">time</span><span class="op" id="8335903">.</span><span class="ident" id="8335904">Microsecond</span><span class="op" id="8335915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335919">500</span>&nbsp;<span class="op" id="8335923">*</span>&nbsp;<span class="ident" id="8335925">time</span><span class="op" id="8335929">.</span><span class="ident" id="8335930">Microsecond</span><span class="op" id="8335941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335945">1</span>&nbsp;<span class="op" id="8335947">*</span>&nbsp;<span class="ident" id="8335949">time</span><span class="op" id="8335953">.</span><span class="ident" id="8335954">Millisecond</span><span class="op" id="8335965">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335969">5</span>&nbsp;<span class="op" id="8335971">*</span>&nbsp;<span class="ident" id="8335973">time</span><span class="op" id="8335977">.</span><span class="ident" id="8335978">Millisecond</span><span class="op" id="8335989">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8335993">100</span>&nbsp;<span class="op" id="8335997">*</span>&nbsp;<span class="ident" id="8335999">time</span><span class="op" id="8336003">.</span><span class="ident" id="8336004">Millisecond</span><span class="op" id="8336015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8336019">250</span>&nbsp;<span class="op" id="8336023">*</span>&nbsp;<span class="ident" id="8336025">time</span><span class="op" id="8336029">.</span><span class="ident" id="8336030">Millisecond</span><span class="op" id="8336041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8336045">500</span>&nbsp;<span class="op" id="8336049">*</span>&nbsp;<span class="ident" id="8336051">time</span><span class="op" id="8336055">.</span><span class="ident" id="8336056">Millisecond</span><span class="op" id="8336067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="8336071">1</span>&nbsp;<span class="op" id="8336073">*</span>&nbsp;<span class="ident" id="8336075">time</span><span class="op" id="8336079">.</span><span class="ident" id="8336080">Second</span><span class="op" id="8336086">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336089">}</span>&nbsp;<span class="op" id="8336091">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336095">numRuns</span>&nbsp;<span class="op" id="8336103">:=</span>&nbsp;<span class="num" id="8336106">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336110">if</span>&nbsp;<span class="ident" id="8336113">testing</span><span class="op" id="8336120">.</span><span class="ident" id="8336121">Short</span><span class="op" id="8336126">(</span><span class="op" id="8336127">)</span>&nbsp;<span class="op" id="8336129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336134">numRuns</span>&nbsp;<span class="op" id="8336142">=</span>&nbsp;<span class="num" id="8336144">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336149">if</span>&nbsp;<span class="ident" id="8336152">timeout</span>&nbsp;<span class="op" id="8336160">&gt;</span>&nbsp;<span class="num" id="8336162">500</span><span class="op" id="8336165">*</span><span class="ident" id="8336166">time</span><span class="op" id="8336170">.</span><span class="ident" id="8336171">Microsecond</span>&nbsp;<span class="op" id="8336183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336189">continue</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336209">for</span>&nbsp;<span class="ident" id="8336213">run</span>&nbsp;<span class="op" id="8336217">:=</span>&nbsp;<span class="num" id="8336220">0</span><span class="op" id="8336221">;</span>&nbsp;<span class="ident" id="8336223">run</span>&nbsp;<span class="op" id="8336227">&lt;</span>&nbsp;<span class="ident" id="8336229">numRuns</span><span class="op" id="8336236">;</span>&nbsp;<span class="ident" id="8336238">run</span><span class="op" id="8336241">++</span>&nbsp;<span class="op" id="8336244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336249">name</span>&nbsp;<span class="op" id="8336254">:=</span>&nbsp;<span class="ident" id="8336257">fmt</span><span class="op" id="8336260">.</span><span class="ident" id="8336261">Sprintf</span><span class="op" id="8336268">(</span><span class="string" id="8336269">&#34;%v&nbsp;run&nbsp;%d/%d&#34;</span><span class="op" id="8336283">,</span>&nbsp;<span class="ident" id="8336285">timeout</span><span class="op" id="8336292">,</span>&nbsp;<span class="ident" id="8336294">run</span><span class="op" id="8336297">+</span><span class="num" id="8336298">1</span><span class="op" id="8336299">,</span>&nbsp;<span class="ident" id="8336301">numRuns</span><span class="op" id="8336308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336313">t</span><span class="op" id="8336314">.</span><span class="ident" id="8336315">Log</span><span class="op" id="8336318">(</span><span class="ident" id="8336319">name</span><span class="op" id="8336323">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336329">c</span><span class="op" id="8336330">,</span>&nbsp;<span class="ident" id="8336332">err</span>&nbsp;<span class="op" id="8336336">:=</span>&nbsp;<span class="ident" id="8336339">Dial</span><span class="op" id="8336343">(</span><span class="string" id="8336344">&#34;tcp&#34;</span><span class="op" id="8336349">,</span>&nbsp;<span class="ident" id="8336351">ln</span><span class="op" id="8336353">.</span><span class="ident" id="8336354">Addr</span><span class="op" id="8336358">(</span><span class="op" id="8336359">)</span><span class="op" id="8336360">.</span><span class="ident" id="8336361">String</span><span class="op" id="8336367">(</span><span class="op" id="8336368">)</span><span class="op" id="8336369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336374">if</span>&nbsp;<span class="ident" id="8336377">err</span>&nbsp;<span class="op" id="8336381">!=</span>&nbsp;<span class="ident" id="8336384">nil</span>&nbsp;<span class="op" id="8336388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336394">t</span><span class="op" id="8336395">.</span><span class="ident" id="8336396">Fatalf</span><span class="op" id="8336402">(</span><span class="string" id="8336403">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8336413">,</span>&nbsp;<span class="ident" id="8336415">err</span><span class="op" id="8336418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336423">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336428">clientc</span>&nbsp;<span class="op" id="8336436">:=</span>&nbsp;<span class="builtinfunc" id="8336439">make</span><span class="op" id="8336443">(</span><span class="keyword" id="8336444">chan</span>&nbsp;<span class="ident" id="8336449">copyRes</span><span class="op" id="8336456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336461">go</span>&nbsp;<span class="keyword" id="8336464">func</span><span class="op" id="8336468">(</span><span class="op" id="8336469">)</span>&nbsp;<span class="op" id="8336471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336477">t0</span>&nbsp;<span class="op" id="8336480">:=</span>&nbsp;<span class="ident" id="8336483">time</span><span class="op" id="8336487">.</span><span class="ident" id="8336488">Now</span><span class="op" id="8336491">(</span><span class="op" id="8336492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336498">c</span><span class="op" id="8336499">.</span><span class="ident" id="8336500">SetDeadline</span><span class="op" id="8336511">(</span><span class="ident" id="8336512">t0</span><span class="op" id="8336514">.</span><span class="ident" id="8336515">Add</span><span class="op" id="8336518">(</span><span class="ident" id="8336519">timeout</span><span class="op" id="8336526">)</span><span class="op" id="8336527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336533">n</span><span class="op" id="8336534">,</span>&nbsp;<span class="ident" id="8336536">err</span>&nbsp;<span class="op" id="8336540">:=</span>&nbsp;<span class="ident" id="8336543">io</span><span class="op" id="8336545">.</span><span class="ident" id="8336546">Copy</span><span class="op" id="8336550">(</span><span class="ident" id="8336551">ioutil</span><span class="op" id="8336557">.</span><span class="ident" id="8336558">Discard</span><span class="op" id="8336565">,</span>&nbsp;<span class="ident" id="8336567">c</span><span class="op" id="8336568">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336574">d</span>&nbsp;<span class="op" id="8336576">:=</span>&nbsp;<span class="ident" id="8336579">time</span><span class="op" id="8336583">.</span><span class="ident" id="8336584">Since</span><span class="op" id="8336589">(</span><span class="ident" id="8336590">t0</span><span class="op" id="8336592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336598">c</span><span class="op" id="8336599">.</span><span class="ident" id="8336600">Close</span><span class="op" id="8336605">(</span><span class="op" id="8336606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336612">clientc</span>&nbsp;<span class="op" id="8336620">&lt;-</span>&nbsp;<span class="ident" id="8336623">copyRes</span><span class="op" id="8336630">{</span><span class="ident" id="8336631">n</span><span class="op" id="8336632">,</span>&nbsp;<span class="ident" id="8336634">err</span><span class="op" id="8336637">,</span>&nbsp;<span class="ident" id="8336639">d</span><span class="op" id="8336640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336645">}</span><span class="op" id="8336646">(</span><span class="op" id="8336647">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336653">tooLong</span>&nbsp;<span class="op" id="8336661">:=</span>&nbsp;<span class="num" id="8336664">5</span>&nbsp;<span class="op" id="8336666">*</span>&nbsp;<span class="ident" id="8336668">time</span><span class="op" id="8336672">.</span><span class="ident" id="8336673">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336683">select</span>&nbsp;<span class="op" id="8336690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336695">case</span>&nbsp;<span class="ident" id="8336700">res</span>&nbsp;<span class="op" id="8336704">:=</span>&nbsp;<span class="op" id="8336707">&lt;-</span><span class="ident" id="8336709">clientc</span><span class="op" id="8336716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336722">if</span>&nbsp;<span class="ident" id="8336725">isTimeout</span><span class="op" id="8336734">(</span><span class="ident" id="8336735">res</span><span class="op" id="8336738">.</span><span class="ident" id="8336739">err</span><span class="op" id="8336742">)</span>&nbsp;<span class="op" id="8336744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336751">t</span><span class="op" id="8336752">.</span><span class="ident" id="8336753">Logf</span><span class="op" id="8336757">(</span><span class="string" id="8336758">&#34;for&nbsp;%v,&nbsp;good&nbsp;client&nbsp;timeout&nbsp;after&nbsp;%v,&nbsp;reading&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8336814">,</span>&nbsp;<span class="ident" id="8336816">name</span><span class="op" id="8336820">,</span>&nbsp;<span class="ident" id="8336822">res</span><span class="op" id="8336825">.</span><span class="ident" id="8336826">d</span><span class="op" id="8336827">,</span>&nbsp;<span class="ident" id="8336829">res</span><span class="op" id="8336832">.</span><span class="ident" id="8336833">n</span><span class="op" id="8336834">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336840">}</span>&nbsp;<span class="keyword" id="8336842">else</span>&nbsp;<span class="op" id="8336847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336854">t</span><span class="op" id="8336855">.</span><span class="ident" id="8336856">Fatalf</span><span class="op" id="8336862">(</span><span class="string" id="8336863">&#34;for&nbsp;%v:&nbsp;client&nbsp;Copy&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;(want&nbsp;timeout)&#34;</span><span class="op" id="8336908">,</span>&nbsp;<span class="ident" id="8336910">name</span><span class="op" id="8336914">,</span>&nbsp;<span class="ident" id="8336916">res</span><span class="op" id="8336919">.</span><span class="ident" id="8336920">n</span><span class="op" id="8336921">,</span>&nbsp;<span class="ident" id="8336923">res</span><span class="op" id="8336926">.</span><span class="ident" id="8336927">err</span><span class="op" id="8336930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8336936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8336941">case</span>&nbsp;<span class="op" id="8336946">&lt;-</span><span class="ident" id="8336948">time</span><span class="op" id="8336952">.</span><span class="ident" id="8336953">After</span><span class="op" id="8336958">(</span><span class="ident" id="8336959">tooLong</span><span class="op" id="8336966">)</span><span class="op" id="8336967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8336973">t</span><span class="op" id="8336974">.</span><span class="ident" id="8336975">Fatalf</span><span class="op" id="8336981">(</span><span class="string" id="8336982">&#34;for&nbsp;%v:&nbsp;timeout&nbsp;(%v)&nbsp;waiting&nbsp;for&nbsp;client&nbsp;to&nbsp;timeout&nbsp;(%v)&nbsp;reading&#34;</span><span class="op" id="8337047">,</span>&nbsp;<span class="ident" id="8337049">name</span><span class="op" id="8337053">,</span>&nbsp;<span class="ident" id="8337055">tooLong</span><span class="op" id="8337062">,</span>&nbsp;<span class="ident" id="8337064">timeout</span><span class="op" id="8337071">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337082">select</span>&nbsp;<span class="op" id="8337089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337094">case</span>&nbsp;<span class="ident" id="8337099">res</span>&nbsp;<span class="op" id="8337103">:=</span>&nbsp;<span class="op" id="8337106">&lt;-</span><span class="ident" id="8337108">servec</span><span class="op" id="8337114">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337120">t</span><span class="op" id="8337121">.</span><span class="ident" id="8337122">Logf</span><span class="op" id="8337126">(</span><span class="string" id="8337127">&#34;for&nbsp;%v:&nbsp;server&nbsp;in&nbsp;%v&nbsp;wrote&nbsp;%d,&nbsp;%v&#34;</span><span class="op" id="8337162">,</span>&nbsp;<span class="ident" id="8337164">name</span><span class="op" id="8337168">,</span>&nbsp;<span class="ident" id="8337170">res</span><span class="op" id="8337173">.</span><span class="ident" id="8337174">d</span><span class="op" id="8337175">,</span>&nbsp;<span class="ident" id="8337177">res</span><span class="op" id="8337180">.</span><span class="ident" id="8337181">n</span><span class="op" id="8337182">,</span>&nbsp;<span class="ident" id="8337184">res</span><span class="op" id="8337187">.</span><span class="ident" id="8337188">err</span><span class="op" id="8337191">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337196">case</span>&nbsp;<span class="ident" id="8337201">err</span>&nbsp;<span class="op" id="8337205">:=</span>&nbsp;<span class="op" id="8337208">&lt;-</span><span class="ident" id="8337210">acceptc</span><span class="op" id="8337217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337223">t</span><span class="op" id="8337224">.</span><span class="ident" id="8337225">Fatalf</span><span class="op" id="8337231">(</span><span class="string" id="8337232">&#34;for&nbsp;%v:&nbsp;server&nbsp;Accept&nbsp;=&nbsp;%v&#34;</span><span class="op" id="8337260">,</span>&nbsp;<span class="ident" id="8337262">name</span><span class="op" id="8337266">,</span>&nbsp;<span class="ident" id="8337268">err</span><span class="op" id="8337271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337276">case</span>&nbsp;<span class="op" id="8337281">&lt;-</span><span class="ident" id="8337283">time</span><span class="op" id="8337287">.</span><span class="ident" id="8337288">After</span><span class="op" id="8337293">(</span><span class="ident" id="8337294">tooLong</span><span class="op" id="8337301">)</span><span class="op" id="8337302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337308">t</span><span class="op" id="8337309">.</span><span class="ident" id="8337310">Fatalf</span><span class="op" id="8337316">(</span><span class="string" id="8337317">&#34;for&nbsp;%v,&nbsp;timeout&nbsp;waiting&nbsp;for&nbsp;server&nbsp;to&nbsp;finish&nbsp;writing&#34;</span><span class="op" id="8337371">,</span>&nbsp;<span class="ident" id="8337373">name</span><span class="op" id="8337377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337382">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337389">}</span><br>
<span class="lineno"></span><span class="op" id="8337391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8337394">//&nbsp;TestReadDeadlineDataAvailable&nbsp;tests&nbsp;that&nbsp;read&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">525</span><span class="comment" id="8337464">//&nbsp;if&nbsp;there&#39;s&nbsp;data&nbsp;ready&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="8337501">func</span>&nbsp;<span class="ident" id="8337506">TestReadDeadlineDataAvailable</span><span class="op" id="8337535">(</span><span class="ident" id="8337536">t</span>&nbsp;<span class="op" id="8337538">*</span><span class="ident" id="8337539">testing</span><span class="op" id="8337546">.</span><span class="ident" id="8337547">T</span><span class="op" id="8337548">)</span>&nbsp;<span class="op" id="8337550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337553">switch</span>&nbsp;<span class="ident" id="8337560">runtime</span><span class="op" id="8337567">.</span><span class="ident" id="8337568">GOOS</span>&nbsp;<span class="op" id="8337573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337576">case</span>&nbsp;<span class="string" id="8337581">&#34;plan9&#34;</span><span class="op" id="8337588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337592">t</span><span class="op" id="8337593">.</span><span class="ident" id="8337594">Skipf</span><span class="op" id="8337599">(</span><span class="string" id="8337600">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8337621">,</span>&nbsp;<span class="ident" id="8337623">runtime</span><span class="op" id="8337630">.</span><span class="ident" id="8337631">GOOS</span><span class="op" id="8337635">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337642">ln</span>&nbsp;<span class="op" id="8337645">:=</span>&nbsp;<span class="ident" id="8337648">newLocalListener</span><span class="op" id="8337664">(</span><span class="ident" id="8337665">t</span><span class="op" id="8337666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337669">defer</span>&nbsp;<span class="ident" id="8337675">ln</span><span class="op" id="8337677">.</span><span class="ident" id="8337678">Close</span><span class="op" id="8337683">(</span><span class="op" id="8337684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337688">servec</span>&nbsp;<span class="op" id="8337695">:=</span>&nbsp;<span class="builtinfunc" id="8337698">make</span><span class="op" id="8337702">(</span><span class="keyword" id="8337703">chan</span>&nbsp;<span class="ident" id="8337708">copyRes</span><span class="op" id="8337715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337718">const</span>&nbsp;<span class="ident" id="8337724">msg</span>&nbsp;<span class="op" id="8337728">=</span>&nbsp;<span class="string" id="8337730">&#34;data&nbsp;client&nbsp;shouldn&#39;t&nbsp;read,&nbsp;even&nbsp;though&nbsp;it&#39;ll&nbsp;be&nbsp;waiting&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337790">go</span>&nbsp;<span class="keyword" id="8337793">func</span><span class="op" id="8337797">(</span><span class="op" id="8337798">)</span>&nbsp;<span class="op" id="8337800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337804">c</span><span class="op" id="8337805">,</span>&nbsp;<span class="ident" id="8337807">err</span>&nbsp;<span class="op" id="8337811">:=</span>&nbsp;<span class="ident" id="8337814">ln</span><span class="op" id="8337816">.</span><span class="ident" id="8337817">Accept</span><span class="op" id="8337823">(</span><span class="op" id="8337824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337828">if</span>&nbsp;<span class="ident" id="8337831">err</span>&nbsp;<span class="op" id="8337835">!=</span>&nbsp;<span class="ident" id="8337838">nil</span>&nbsp;<span class="op" id="8337842">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337847">t</span><span class="op" id="8337848">.</span><span class="ident" id="8337849">Errorf</span><span class="op" id="8337855">(</span><span class="string" id="8337856">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8337868">,</span>&nbsp;<span class="ident" id="8337870">err</span><span class="op" id="8337873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337878">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8337891">defer</span>&nbsp;<span class="ident" id="8337897">c</span><span class="op" id="8337898">.</span><span class="ident" id="8337899">Close</span><span class="op" id="8337904">(</span><span class="op" id="8337905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337909">n</span><span class="op" id="8337910">,</span>&nbsp;<span class="ident" id="8337912">err</span>&nbsp;<span class="op" id="8337916">:=</span>&nbsp;<span class="ident" id="8337919">c</span><span class="op" id="8337920">.</span><span class="ident" id="8337921">Write</span><span class="op" id="8337926">(</span><span class="op" id="8337927">[</span><span class="op" id="8337928">]</span><span class="builtintype" id="8337929">byte</span><span class="op" id="8337933">(</span><span class="ident" id="8337934">msg</span><span class="op" id="8337937">)</span><span class="op" id="8337938">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337942">servec</span>&nbsp;<span class="op" id="8337949">&lt;-</span>&nbsp;<span class="ident" id="8337952">copyRes</span><span class="op" id="8337959">{</span><span class="ident" id="8337960">n</span><span class="op" id="8337961">:</span>&nbsp;<span class="ident" id="8337963">int64</span><span class="op" id="8337968">(</span><span class="ident" id="8337969">n</span><span class="op" id="8337970">)</span><span class="op" id="8337971">,</span>&nbsp;<span class="ident" id="8337973">err</span><span class="op" id="8337976">:</span>&nbsp;<span class="ident" id="8337978">err</span><span class="op" id="8337981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8337984">}</span><span class="op" id="8337985">(</span><span class="op" id="8337986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8337990">c</span><span class="op" id="8337991">,</span>&nbsp;<span class="ident" id="8337993">err</span>&nbsp;<span class="op" id="8337997">:=</span>&nbsp;<span class="ident" id="8338000">Dial</span><span class="op" id="8338004">(</span><span class="string" id="8338005">&#34;tcp&#34;</span><span class="op" id="8338010">,</span>&nbsp;<span class="ident" id="8338012">ln</span><span class="op" id="8338014">.</span><span class="ident" id="8338015">Addr</span><span class="op" id="8338019">(</span><span class="op" id="8338020">)</span><span class="op" id="8338021">.</span><span class="ident" id="8338022">String</span><span class="op" id="8338028">(</span><span class="op" id="8338029">)</span><span class="op" id="8338030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338033">if</span>&nbsp;<span class="ident" id="8338036">err</span>&nbsp;<span class="op" id="8338040">!=</span>&nbsp;<span class="ident" id="8338043">nil</span>&nbsp;<span class="op" id="8338047">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338051">t</span><span class="op" id="8338052">.</span><span class="ident" id="8338053">Fatalf</span><span class="op" id="8338059">(</span><span class="string" id="8338060">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8338070">,</span>&nbsp;<span class="ident" id="8338072">err</span><span class="op" id="8338075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338081">defer</span>&nbsp;<span class="ident" id="8338087">c</span><span class="op" id="8338088">.</span><span class="ident" id="8338089">Close</span><span class="op" id="8338094">(</span><span class="op" id="8338095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338098">if</span>&nbsp;<span class="ident" id="8338101">res</span>&nbsp;<span class="op" id="8338105">:=</span>&nbsp;<span class="op" id="8338108">&lt;-</span><span class="ident" id="8338110">servec</span><span class="op" id="8338116">;</span>&nbsp;<span class="ident" id="8338118">res</span><span class="op" id="8338121">.</span><span class="ident" id="8338122">err</span>&nbsp;<span class="op" id="8338126">!=</span>&nbsp;<span class="ident" id="8338129">nil</span>&nbsp;<span class="op" id="8338133">||</span>&nbsp;<span class="ident" id="8338136">res</span><span class="op" id="8338139">.</span><span class="ident" id="8338140">n</span>&nbsp;<span class="op" id="8338142">!=</span>&nbsp;<span class="ident" id="8338145">int64</span><span class="op" id="8338150">(</span><span class="builtinfunc" id="8338151">len</span><span class="op" id="8338154">(</span><span class="ident" id="8338155">msg</span><span class="op" id="8338158">)</span><span class="op" id="8338159">)</span>&nbsp;<span class="op" id="8338161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338165">t</span><span class="op" id="8338166">.</span><span class="ident" id="8338167">Fatalf</span><span class="op" id="8338173">(</span><span class="string" id="8338174">&#34;unexpected&nbsp;server&nbsp;Write:&nbsp;n=%d,&nbsp;err=%v;&nbsp;want&nbsp;n=%d,&nbsp;err=nil&#34;</span><span class="op" id="8338233">,</span>&nbsp;<span class="ident" id="8338235">res</span><span class="op" id="8338238">.</span><span class="ident" id="8338239">n</span><span class="op" id="8338240">,</span>&nbsp;<span class="ident" id="8338242">res</span><span class="op" id="8338245">.</span><span class="ident" id="8338246">err</span><span class="op" id="8338249">,</span>&nbsp;<span class="builtinfunc" id="8338251">len</span><span class="op" id="8338254">(</span><span class="ident" id="8338255">msg</span><span class="op" id="8338258">)</span><span class="op" id="8338259">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338265">c</span><span class="op" id="8338266">.</span><span class="ident" id="8338267">SetReadDeadline</span><span class="op" id="8338282">(</span><span class="ident" id="8338283">time</span><span class="op" id="8338287">.</span><span class="ident" id="8338288">Now</span><span class="op" id="8338291">(</span><span class="op" id="8338292">)</span><span class="op" id="8338293">.</span><span class="ident" id="8338294">Add</span><span class="op" id="8338297">(</span><span class="op" id="8338298">-</span><span class="num" id="8338299">5</span>&nbsp;<span class="op" id="8338301">*</span>&nbsp;<span class="ident" id="8338303">time</span><span class="op" id="8338307">.</span><span class="ident" id="8338308">Second</span><span class="op" id="8338314">)</span><span class="op" id="8338315">)</span>&nbsp;<span class="comment" id="8338317">//&nbsp;in&nbsp;the&nbsp;psat.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338334">buf</span>&nbsp;<span class="op" id="8338338">:=</span>&nbsp;<span class="builtinfunc" id="8338341">make</span><span class="op" id="8338345">(</span><span class="op" id="8338346">[</span><span class="op" id="8338347">]</span><span class="builtintype" id="8338348">byte</span><span class="op" id="8338352">,</span>&nbsp;<span class="builtinfunc" id="8338354">len</span><span class="op" id="8338357">(</span><span class="ident" id="8338358">msg</span><span class="op" id="8338361">)</span><span class="op" id="8338362">/</span><span class="num" id="8338363">2</span><span class="op" id="8338364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338367">n</span><span class="op" id="8338368">,</span>&nbsp;<span class="ident" id="8338370">err</span>&nbsp;<span class="op" id="8338374">:=</span>&nbsp;<span class="ident" id="8338377">c</span><span class="op" id="8338378">.</span><span class="ident" id="8338379">Read</span><span class="op" id="8338383">(</span><span class="ident" id="8338384">buf</span><span class="op" id="8338387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338390">if</span>&nbsp;<span class="ident" id="8338393">n</span>&nbsp;<span class="op" id="8338395">&gt;</span>&nbsp;<span class="num" id="8338397">0</span>&nbsp;<span class="op" id="8338399">||</span>&nbsp;<span class="op" id="8338402">!</span><span class="ident" id="8338403">isTimeout</span><span class="op" id="8338412">(</span><span class="ident" id="8338413">err</span><span class="op" id="8338416">)</span>&nbsp;<span class="op" id="8338418">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338422">t</span><span class="op" id="8338423">.</span><span class="ident" id="8338424">Fatalf</span><span class="op" id="8338430">(</span><span class="string" id="8338431">&#34;client&nbsp;read&nbsp;=&nbsp;%d&nbsp;(%q)&nbsp;err=%v;&nbsp;want&nbsp;0,&nbsp;timeout&#34;</span><span class="op" id="8338478">,</span>&nbsp;<span class="ident" id="8338480">n</span><span class="op" id="8338481">,</span>&nbsp;<span class="ident" id="8338483">buf</span><span class="op" id="8338486">[</span><span class="op" id="8338487">:</span><span class="ident" id="8338488">n</span><span class="op" id="8338489">]</span><span class="op" id="8338490">,</span>&nbsp;<span class="ident" id="8338492">err</span><span class="op" id="8338495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338498">}</span><br>
<span class="lineno"></span><span class="op" id="8338500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8338503">//&nbsp;TestWriteDeadlineBufferAvailable&nbsp;tests&nbsp;that&nbsp;write&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">565</span><span class="comment" id="8338577">//&nbsp;if&nbsp;there&#39;s&nbsp;buffer&nbsp;space&nbsp;available&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span><span class="keyword" id="8338624">func</span>&nbsp;<span class="ident" id="8338629">TestWriteDeadlineBufferAvailable</span><span class="op" id="8338661">(</span><span class="ident" id="8338662">t</span>&nbsp;<span class="op" id="8338664">*</span><span class="ident" id="8338665">testing</span><span class="op" id="8338672">.</span><span class="ident" id="8338673">T</span><span class="op" id="8338674">)</span>&nbsp;<span class="op" id="8338676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338679">switch</span>&nbsp;<span class="ident" id="8338686">runtime</span><span class="op" id="8338693">.</span><span class="ident" id="8338694">GOOS</span>&nbsp;<span class="op" id="8338699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338702">case</span>&nbsp;<span class="string" id="8338707">&#34;plan9&#34;</span><span class="op" id="8338714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338718">t</span><span class="op" id="8338719">.</span><span class="ident" id="8338720">Skipf</span><span class="op" id="8338725">(</span><span class="string" id="8338726">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8338747">,</span>&nbsp;<span class="ident" id="8338749">runtime</span><span class="op" id="8338756">.</span><span class="ident" id="8338757">GOOS</span><span class="op" id="8338761">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338768">ln</span>&nbsp;<span class="op" id="8338771">:=</span>&nbsp;<span class="ident" id="8338774">newLocalListener</span><span class="op" id="8338790">(</span><span class="ident" id="8338791">t</span><span class="op" id="8338792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338795">defer</span>&nbsp;<span class="ident" id="8338801">ln</span><span class="op" id="8338803">.</span><span class="ident" id="8338804">Close</span><span class="op" id="8338809">(</span><span class="op" id="8338810">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338814">servec</span>&nbsp;<span class="op" id="8338821">:=</span>&nbsp;<span class="builtinfunc" id="8338824">make</span><span class="op" id="8338828">(</span><span class="keyword" id="8338829">chan</span>&nbsp;<span class="ident" id="8338834">copyRes</span><span class="op" id="8338841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338844">go</span>&nbsp;<span class="keyword" id="8338847">func</span><span class="op" id="8338851">(</span><span class="op" id="8338852">)</span>&nbsp;<span class="op" id="8338854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338858">c</span><span class="op" id="8338859">,</span>&nbsp;<span class="ident" id="8338861">err</span>&nbsp;<span class="op" id="8338865">:=</span>&nbsp;<span class="ident" id="8338868">ln</span><span class="op" id="8338870">.</span><span class="ident" id="8338871">Accept</span><span class="op" id="8338877">(</span><span class="op" id="8338878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338882">if</span>&nbsp;<span class="ident" id="8338885">err</span>&nbsp;<span class="op" id="8338889">!=</span>&nbsp;<span class="ident" id="8338892">nil</span>&nbsp;<span class="op" id="8338896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338901">t</span><span class="op" id="8338902">.</span><span class="ident" id="8338903">Errorf</span><span class="op" id="8338909">(</span><span class="string" id="8338910">&#34;Accept:&nbsp;%v&#34;</span><span class="op" id="8338922">,</span>&nbsp;<span class="ident" id="8338924">err</span><span class="op" id="8338927">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338932">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8338941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8338945">defer</span>&nbsp;<span class="ident" id="8338951">c</span><span class="op" id="8338952">.</span><span class="ident" id="8338953">Close</span><span class="op" id="8338958">(</span><span class="op" id="8338959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8338963">c</span><span class="op" id="8338964">.</span><span class="ident" id="8338965">SetWriteDeadline</span><span class="op" id="8338981">(</span><span class="ident" id="8338982">time</span><span class="op" id="8338986">.</span><span class="ident" id="8338987">Now</span><span class="op" id="8338990">(</span><span class="op" id="8338991">)</span><span class="op" id="8338992">.</span><span class="ident" id="8338993">Add</span><span class="op" id="8338996">(</span><span class="op" id="8338997">-</span><span class="num" id="8338998">5</span>&nbsp;<span class="op" id="8339000">*</span>&nbsp;<span class="ident" id="8339002">time</span><span class="op" id="8339006">.</span><span class="ident" id="8339007">Second</span><span class="op" id="8339013">)</span><span class="op" id="8339014">)</span>&nbsp;<span class="comment" id="8339016">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339033">n</span><span class="op" id="8339034">,</span>&nbsp;<span class="ident" id="8339036">err</span>&nbsp;<span class="op" id="8339040">:=</span>&nbsp;<span class="ident" id="8339043">c</span><span class="op" id="8339044">.</span><span class="ident" id="8339045">Write</span><span class="op" id="8339050">(</span><span class="op" id="8339051">[</span><span class="op" id="8339052">]</span><span class="builtintype" id="8339053">byte</span><span class="op" id="8339057">{</span><span class="string" id="8339058">&#39;x&#39;</span><span class="op" id="8339061">}</span><span class="op" id="8339062">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339066">servec</span>&nbsp;<span class="op" id="8339073">&lt;-</span>&nbsp;<span class="ident" id="8339076">copyRes</span><span class="op" id="8339083">{</span><span class="ident" id="8339084">n</span><span class="op" id="8339085">:</span>&nbsp;<span class="ident" id="8339087">int64</span><span class="op" id="8339092">(</span><span class="ident" id="8339093">n</span><span class="op" id="8339094">)</span><span class="op" id="8339095">,</span>&nbsp;<span class="ident" id="8339097">err</span><span class="op" id="8339100">:</span>&nbsp;<span class="ident" id="8339102">err</span><span class="op" id="8339105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339108">}</span><span class="op" id="8339109">(</span><span class="op" id="8339110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339114">c</span><span class="op" id="8339115">,</span>&nbsp;<span class="ident" id="8339117">err</span>&nbsp;<span class="op" id="8339121">:=</span>&nbsp;<span class="ident" id="8339124">Dial</span><span class="op" id="8339128">(</span><span class="string" id="8339129">&#34;tcp&#34;</span><span class="op" id="8339134">,</span>&nbsp;<span class="ident" id="8339136">ln</span><span class="op" id="8339138">.</span><span class="ident" id="8339139">Addr</span><span class="op" id="8339143">(</span><span class="op" id="8339144">)</span><span class="op" id="8339145">.</span><span class="ident" id="8339146">String</span><span class="op" id="8339152">(</span><span class="op" id="8339153">)</span><span class="op" id="8339154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339157">if</span>&nbsp;<span class="ident" id="8339160">err</span>&nbsp;<span class="op" id="8339164">!=</span>&nbsp;<span class="ident" id="8339167">nil</span>&nbsp;<span class="op" id="8339171">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339175">t</span><span class="op" id="8339176">.</span><span class="ident" id="8339177">Fatalf</span><span class="op" id="8339183">(</span><span class="string" id="8339184">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8339194">,</span>&nbsp;<span class="ident" id="8339196">err</span><span class="op" id="8339199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339205">defer</span>&nbsp;<span class="ident" id="8339211">c</span><span class="op" id="8339212">.</span><span class="ident" id="8339213">Close</span><span class="op" id="8339218">(</span><span class="op" id="8339219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339222">res</span>&nbsp;<span class="op" id="8339226">:=</span>&nbsp;<span class="op" id="8339229">&lt;-</span><span class="ident" id="8339231">servec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339239">if</span>&nbsp;<span class="ident" id="8339242">res</span><span class="op" id="8339245">.</span><span class="ident" id="8339246">n</span>&nbsp;<span class="op" id="8339248">!=</span>&nbsp;<span class="num" id="8339251">0</span>&nbsp;<span class="op" id="8339253">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339257">t</span><span class="op" id="8339258">.</span><span class="ident" id="8339259">Errorf</span><span class="op" id="8339265">(</span><span class="string" id="8339266">&#34;Write&nbsp;=&nbsp;%d;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8339286">,</span>&nbsp;<span class="ident" id="8339288">res</span><span class="op" id="8339291">.</span><span class="ident" id="8339292">n</span><span class="op" id="8339293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339299">if</span>&nbsp;<span class="op" id="8339302">!</span><span class="ident" id="8339303">isTimeout</span><span class="op" id="8339312">(</span><span class="ident" id="8339313">res</span><span class="op" id="8339316">.</span><span class="ident" id="8339317">err</span><span class="op" id="8339320">)</span>&nbsp;<span class="op" id="8339322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339326">t</span><span class="op" id="8339327">.</span><span class="ident" id="8339328">Errorf</span><span class="op" id="8339334">(</span><span class="string" id="8339335">&#34;Write&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8339367">,</span>&nbsp;<span class="ident" id="8339369">res</span><span class="op" id="8339372">.</span><span class="ident" id="8339373">err</span><span class="op" id="8339376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339379">}</span><br>
<span class="lineno">600</span><span class="op" id="8339381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8339384">//&nbsp;TestAcceptDeadlineConnectionAvailable&nbsp;tests&nbsp;that&nbsp;accept&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno"></span><span class="comment" id="8339464">//&nbsp;if&nbsp;there&#39;s&nbsp;incoming&nbsp;connections&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="8339510">func</span>&nbsp;<span class="ident" id="8339515">TestAcceptDeadlineConnectionAvailable</span><span class="op" id="8339552">(</span><span class="ident" id="8339553">t</span>&nbsp;<span class="op" id="8339555">*</span><span class="ident" id="8339556">testing</span><span class="op" id="8339563">.</span><span class="ident" id="8339564">T</span><span class="op" id="8339565">)</span>&nbsp;<span class="op" id="8339567">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339570">switch</span>&nbsp;<span class="ident" id="8339577">runtime</span><span class="op" id="8339584">.</span><span class="ident" id="8339585">GOOS</span>&nbsp;<span class="op" id="8339590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339593">case</span>&nbsp;<span class="string" id="8339598">&#34;plan9&#34;</span><span class="op" id="8339605">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339609">t</span><span class="op" id="8339610">.</span><span class="ident" id="8339611">Skipf</span><span class="op" id="8339616">(</span><span class="string" id="8339617">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8339638">,</span>&nbsp;<span class="ident" id="8339640">runtime</span><span class="op" id="8339647">.</span><span class="ident" id="8339648">GOOS</span><span class="op" id="8339652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339659">ln</span>&nbsp;<span class="op" id="8339662">:=</span>&nbsp;<span class="ident" id="8339665">newLocalListener</span><span class="op" id="8339681">(</span><span class="ident" id="8339682">t</span><span class="op" id="8339683">)</span><span class="op" id="8339684">.</span><span class="op" id="8339685">(</span><span class="op" id="8339686">*</span><span class="ident" id="8339687">TCPListener</span><span class="op" id="8339698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339701">defer</span>&nbsp;<span class="ident" id="8339707">ln</span><span class="op" id="8339709">.</span><span class="ident" id="8339710">Close</span><span class="op" id="8339715">(</span><span class="op" id="8339716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339720">go</span>&nbsp;<span class="keyword" id="8339723">func</span><span class="op" id="8339727">(</span><span class="op" id="8339728">)</span>&nbsp;<span class="op" id="8339730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339734">c</span><span class="op" id="8339735">,</span>&nbsp;<span class="ident" id="8339737">err</span>&nbsp;<span class="op" id="8339741">:=</span>&nbsp;<span class="ident" id="8339744">Dial</span><span class="op" id="8339748">(</span><span class="string" id="8339749">&#34;tcp&#34;</span><span class="op" id="8339754">,</span>&nbsp;<span class="ident" id="8339756">ln</span><span class="op" id="8339758">.</span><span class="ident" id="8339759">Addr</span><span class="op" id="8339763">(</span><span class="op" id="8339764">)</span><span class="op" id="8339765">.</span><span class="ident" id="8339766">String</span><span class="op" id="8339772">(</span><span class="op" id="8339773">)</span><span class="op" id="8339774">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339778">if</span>&nbsp;<span class="ident" id="8339781">err</span>&nbsp;<span class="op" id="8339785">!=</span>&nbsp;<span class="ident" id="8339788">nil</span>&nbsp;<span class="op" id="8339792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339797">t</span><span class="op" id="8339798">.</span><span class="ident" id="8339799">Errorf</span><span class="op" id="8339805">(</span><span class="string" id="8339806">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8339816">,</span>&nbsp;<span class="ident" id="8339818">err</span><span class="op" id="8339821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339826">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339839">defer</span>&nbsp;<span class="ident" id="8339845">c</span><span class="op" id="8339846">.</span><span class="ident" id="8339847">Close</span><span class="op" id="8339852">(</span><span class="op" id="8339853">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8339857">var</span>&nbsp;<span class="ident" id="8339861">buf</span>&nbsp;<span class="op" id="8339865">[</span><span class="num" id="8339866">1</span><span class="op" id="8339867">]</span><span class="builtintype" id="8339868">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339875">c</span><span class="op" id="8339876">.</span><span class="ident" id="8339877">Read</span><span class="op" id="8339881">(</span><span class="ident" id="8339882">buf</span><span class="op" id="8339885">[</span><span class="op" id="8339886">:</span><span class="op" id="8339887">]</span><span class="op" id="8339888">)</span>&nbsp;<span class="comment" id="8339890">//&nbsp;block&nbsp;until&nbsp;the&nbsp;connection&nbsp;or&nbsp;listener&nbsp;is&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8339943">}</span><span class="op" id="8339944">(</span><span class="op" id="8339945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339948">time</span><span class="op" id="8339952">.</span><span class="ident" id="8339953">Sleep</span><span class="op" id="8339958">(</span><span class="num" id="8339959">10</span>&nbsp;<span class="op" id="8339962">*</span>&nbsp;<span class="ident" id="8339964">time</span><span class="op" id="8339968">.</span><span class="ident" id="8339969">Millisecond</span><span class="op" id="8339980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8339983">ln</span><span class="op" id="8339985">.</span><span class="ident" id="8339986">SetDeadline</span><span class="op" id="8339997">(</span><span class="ident" id="8339998">time</span><span class="op" id="8340002">.</span><span class="ident" id="8340003">Now</span><span class="op" id="8340006">(</span><span class="op" id="8340007">)</span><span class="op" id="8340008">.</span><span class="ident" id="8340009">Add</span><span class="op" id="8340012">(</span><span class="op" id="8340013">-</span><span class="num" id="8340014">5</span>&nbsp;<span class="op" id="8340016">*</span>&nbsp;<span class="ident" id="8340018">time</span><span class="op" id="8340022">.</span><span class="ident" id="8340023">Second</span><span class="op" id="8340029">)</span><span class="op" id="8340030">)</span>&nbsp;<span class="comment" id="8340032">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340048">c</span><span class="op" id="8340049">,</span>&nbsp;<span class="ident" id="8340051">err</span>&nbsp;<span class="op" id="8340055">:=</span>&nbsp;<span class="ident" id="8340058">ln</span><span class="op" id="8340060">.</span><span class="ident" id="8340061">Accept</span><span class="op" id="8340067">(</span><span class="op" id="8340068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340071">if</span>&nbsp;<span class="ident" id="8340074">err</span>&nbsp;<span class="op" id="8340078">==</span>&nbsp;<span class="ident" id="8340081">nil</span>&nbsp;<span class="op" id="8340085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340089">defer</span>&nbsp;<span class="ident" id="8340095">c</span><span class="op" id="8340096">.</span><span class="ident" id="8340097">Close</span><span class="op" id="8340102">(</span><span class="op" id="8340103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340109">if</span>&nbsp;<span class="op" id="8340112">!</span><span class="ident" id="8340113">isTimeout</span><span class="op" id="8340122">(</span><span class="ident" id="8340123">err</span><span class="op" id="8340126">)</span>&nbsp;<span class="op" id="8340128">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340132">t</span><span class="op" id="8340133">.</span><span class="ident" id="8340134">Fatalf</span><span class="op" id="8340140">(</span><span class="string" id="8340141">&#34;Accept:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8340171">,</span>&nbsp;<span class="ident" id="8340173">err</span><span class="op" id="8340176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340179">}</span><br>
<span class="lineno"></span><span class="op" id="8340181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8340184">//&nbsp;TestConnectDeadlineInThePast&nbsp;tests&nbsp;that&nbsp;connect&nbsp;deadlines&nbsp;work,&nbsp;even</span><br>
<span class="lineno">635</span><span class="comment" id="8340256">//&nbsp;if&nbsp;the&nbsp;connection&nbsp;can&nbsp;be&nbsp;established&nbsp;w/o&nbsp;blocking.</span><br>
<span class="lineno"></span><span class="keyword" id="8340310">func</span>&nbsp;<span class="ident" id="8340315">TestConnectDeadlineInThePast</span><span class="op" id="8340343">(</span><span class="ident" id="8340344">t</span>&nbsp;<span class="op" id="8340346">*</span><span class="ident" id="8340347">testing</span><span class="op" id="8340354">.</span><span class="ident" id="8340355">T</span><span class="op" id="8340356">)</span>&nbsp;<span class="op" id="8340358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340361">switch</span>&nbsp;<span class="ident" id="8340368">runtime</span><span class="op" id="8340375">.</span><span class="ident" id="8340376">GOOS</span>&nbsp;<span class="op" id="8340381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340384">case</span>&nbsp;<span class="string" id="8340389">&#34;plan9&#34;</span><span class="op" id="8340396">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340400">t</span><span class="op" id="8340401">.</span><span class="ident" id="8340402">Skipf</span><span class="op" id="8340407">(</span><span class="string" id="8340408">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8340429">,</span>&nbsp;<span class="ident" id="8340431">runtime</span><span class="op" id="8340438">.</span><span class="ident" id="8340439">GOOS</span><span class="op" id="8340443">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340450">ln</span>&nbsp;<span class="op" id="8340453">:=</span>&nbsp;<span class="ident" id="8340456">newLocalListener</span><span class="op" id="8340472">(</span><span class="ident" id="8340473">t</span><span class="op" id="8340474">)</span><span class="op" id="8340475">.</span><span class="op" id="8340476">(</span><span class="op" id="8340477">*</span><span class="ident" id="8340478">TCPListener</span><span class="op" id="8340489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340492">defer</span>&nbsp;<span class="ident" id="8340498">ln</span><span class="op" id="8340500">.</span><span class="ident" id="8340501">Close</span><span class="op" id="8340506">(</span><span class="op" id="8340507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340511">go</span>&nbsp;<span class="keyword" id="8340514">func</span><span class="op" id="8340518">(</span><span class="op" id="8340519">)</span>&nbsp;<span class="op" id="8340521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340525">c</span><span class="op" id="8340526">,</span>&nbsp;<span class="ident" id="8340528">err</span>&nbsp;<span class="op" id="8340532">:=</span>&nbsp;<span class="ident" id="8340535">ln</span><span class="op" id="8340537">.</span><span class="ident" id="8340538">Accept</span><span class="op" id="8340544">(</span><span class="op" id="8340545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340549">if</span>&nbsp;<span class="ident" id="8340552">err</span>&nbsp;<span class="op" id="8340556">==</span>&nbsp;<span class="ident" id="8340559">nil</span>&nbsp;<span class="op" id="8340563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340568">defer</span>&nbsp;<span class="ident" id="8340574">c</span><span class="op" id="8340575">.</span><span class="ident" id="8340576">Close</span><span class="op" id="8340581">(</span><span class="op" id="8340582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340586">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340589">}</span><span class="op" id="8340590">(</span><span class="op" id="8340591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340594">time</span><span class="op" id="8340598">.</span><span class="ident" id="8340599">Sleep</span><span class="op" id="8340604">(</span><span class="num" id="8340605">10</span>&nbsp;<span class="op" id="8340608">*</span>&nbsp;<span class="ident" id="8340610">time</span><span class="op" id="8340614">.</span><span class="ident" id="8340615">Millisecond</span><span class="op" id="8340626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340629">c</span><span class="op" id="8340630">,</span>&nbsp;<span class="ident" id="8340632">err</span>&nbsp;<span class="op" id="8340636">:=</span>&nbsp;<span class="ident" id="8340639">DialTimeout</span><span class="op" id="8340650">(</span><span class="string" id="8340651">&#34;tcp&#34;</span><span class="op" id="8340656">,</span>&nbsp;<span class="ident" id="8340658">ln</span><span class="op" id="8340660">.</span><span class="ident" id="8340661">Addr</span><span class="op" id="8340665">(</span><span class="op" id="8340666">)</span><span class="op" id="8340667">.</span><span class="ident" id="8340668">String</span><span class="op" id="8340674">(</span><span class="op" id="8340675">)</span><span class="op" id="8340676">,</span>&nbsp;<span class="op" id="8340678">-</span><span class="num" id="8340679">5</span><span class="op" id="8340680">*</span><span class="ident" id="8340681">time</span><span class="op" id="8340685">.</span><span class="ident" id="8340686">Second</span><span class="op" id="8340692">)</span>&nbsp;<span class="comment" id="8340694">//&nbsp;in&nbsp;the&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340710">if</span>&nbsp;<span class="ident" id="8340713">err</span>&nbsp;<span class="op" id="8340717">==</span>&nbsp;<span class="ident" id="8340720">nil</span>&nbsp;<span class="op" id="8340724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340728">defer</span>&nbsp;<span class="ident" id="8340734">c</span><span class="op" id="8340735">.</span><span class="ident" id="8340736">Close</span><span class="op" id="8340741">(</span><span class="op" id="8340742">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340748">if</span>&nbsp;<span class="op" id="8340751">!</span><span class="ident" id="8340752">isTimeout</span><span class="op" id="8340761">(</span><span class="ident" id="8340762">err</span><span class="op" id="8340765">)</span>&nbsp;<span class="op" id="8340767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8340771">t</span><span class="op" id="8340772">.</span><span class="ident" id="8340773">Fatalf</span><span class="op" id="8340779">(</span><span class="string" id="8340780">&#34;DialTimeout:&nbsp;got&nbsp;%v;&nbsp;want&nbsp;timeout&#34;</span><span class="op" id="8340815">,</span>&nbsp;<span class="ident" id="8340817">err</span><span class="op" id="8340820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8340823">}</span><br>
<span class="lineno"></span><span class="op" id="8340825">}</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span><span class="comment" id="8340828">//&nbsp;TestProlongTimeout&nbsp;tests&nbsp;concurrent&nbsp;deadline&nbsp;modification.</span><br>
<span class="lineno"></span><span class="comment" id="8340890">//&nbsp;Known&nbsp;to&nbsp;cause&nbsp;data&nbsp;races&nbsp;in&nbsp;the&nbsp;past.</span><br>
<span class="lineno"></span><span class="keyword" id="8340932">func</span>&nbsp;<span class="ident" id="8340937">TestProlongTimeout</span><span class="op" id="8340955">(</span><span class="ident" id="8340956">t</span>&nbsp;<span class="op" id="8340958">*</span><span class="ident" id="8340959">testing</span><span class="op" id="8340966">.</span><span class="ident" id="8340967">T</span><span class="op" id="8340968">)</span>&nbsp;<span class="op" id="8340970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340973">switch</span>&nbsp;<span class="ident" id="8340980">runtime</span><span class="op" id="8340987">.</span><span class="ident" id="8340988">GOOS</span>&nbsp;<span class="op" id="8340993">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8340996">case</span>&nbsp;<span class="string" id="8341001">&#34;plan9&#34;</span><span class="op" id="8341008">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341012">t</span><span class="op" id="8341013">.</span><span class="ident" id="8341014">Skipf</span><span class="op" id="8341019">(</span><span class="string" id="8341020">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8341041">,</span>&nbsp;<span class="ident" id="8341043">runtime</span><span class="op" id="8341050">.</span><span class="ident" id="8341051">GOOS</span><span class="op" id="8341055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341062">ln</span>&nbsp;<span class="op" id="8341065">:=</span>&nbsp;<span class="ident" id="8341068">newLocalListener</span><span class="op" id="8341084">(</span><span class="ident" id="8341085">t</span><span class="op" id="8341086">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341089">defer</span>&nbsp;<span class="ident" id="8341095">ln</span><span class="op" id="8341097">.</span><span class="ident" id="8341098">Close</span><span class="op" id="8341103">(</span><span class="op" id="8341104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341107">connected</span>&nbsp;<span class="op" id="8341117">:=</span>&nbsp;<span class="builtinfunc" id="8341120">make</span><span class="op" id="8341124">(</span><span class="keyword" id="8341125">chan</span>&nbsp;<span class="builtintype" id="8341130">bool</span><span class="op" id="8341134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341137">go</span>&nbsp;<span class="keyword" id="8341140">func</span><span class="op" id="8341144">(</span><span class="op" id="8341145">)</span>&nbsp;<span class="op" id="8341147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341151">s</span><span class="op" id="8341152">,</span>&nbsp;<span class="ident" id="8341154">err</span>&nbsp;<span class="op" id="8341158">:=</span>&nbsp;<span class="ident" id="8341161">ln</span><span class="op" id="8341163">.</span><span class="ident" id="8341164">Accept</span><span class="op" id="8341170">(</span><span class="op" id="8341171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341175">connected</span>&nbsp;<span class="op" id="8341185">&lt;-</span>&nbsp;<span class="builtintype" id="8341188">true</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341195">if</span>&nbsp;<span class="ident" id="8341198">err</span>&nbsp;<span class="op" id="8341202">!=</span>&nbsp;<span class="ident" id="8341205">nil</span>&nbsp;<span class="op" id="8341209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341214">t</span><span class="op" id="8341215">.</span><span class="ident" id="8341216">Errorf</span><span class="op" id="8341222">(</span><span class="string" id="8341223">&#34;ln.Accept:&nbsp;%v&#34;</span><span class="op" id="8341238">,</span>&nbsp;<span class="ident" id="8341240">err</span><span class="op" id="8341243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341248">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341261">defer</span>&nbsp;<span class="ident" id="8341267">s</span><span class="op" id="8341268">.</span><span class="ident" id="8341269">Close</span><span class="op" id="8341274">(</span><span class="op" id="8341275">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341279">s</span><span class="op" id="8341280">.</span><span class="ident" id="8341281">SetDeadline</span><span class="op" id="8341292">(</span><span class="ident" id="8341293">time</span><span class="op" id="8341297">.</span><span class="ident" id="8341298">Now</span><span class="op" id="8341301">(</span><span class="op" id="8341302">)</span><span class="op" id="8341303">.</span><span class="ident" id="8341304">Add</span><span class="op" id="8341307">(</span><span class="ident" id="8341308">time</span><span class="op" id="8341312">.</span><span class="ident" id="8341313">Hour</span><span class="op" id="8341317">)</span><span class="op" id="8341318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341322">go</span>&nbsp;<span class="keyword" id="8341325">func</span><span class="op" id="8341329">(</span><span class="op" id="8341330">)</span>&nbsp;<span class="op" id="8341332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341337">var</span>&nbsp;<span class="ident" id="8341341">buf</span>&nbsp;<span class="op" id="8341345">[</span><span class="num" id="8341346">4096</span><span class="op" id="8341350">]</span><span class="builtintype" id="8341351">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341359">for</span>&nbsp;<span class="op" id="8341363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341369">_</span><span class="op" id="8341370">,</span>&nbsp;<span class="ident" id="8341372">err</span>&nbsp;<span class="op" id="8341376">:=</span>&nbsp;<span class="ident" id="8341379">s</span><span class="op" id="8341380">.</span><span class="ident" id="8341381">Write</span><span class="op" id="8341386">(</span><span class="ident" id="8341387">buf</span><span class="op" id="8341390">[</span><span class="op" id="8341391">:</span><span class="op" id="8341392">]</span><span class="op" id="8341393">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341399">if</span>&nbsp;<span class="ident" id="8341402">err</span>&nbsp;<span class="op" id="8341406">!=</span>&nbsp;<span class="ident" id="8341409">nil</span>&nbsp;<span class="op" id="8341413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341420">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341436">s</span><span class="op" id="8341437">.</span><span class="ident" id="8341438">SetDeadline</span><span class="op" id="8341449">(</span><span class="ident" id="8341450">time</span><span class="op" id="8341454">.</span><span class="ident" id="8341455">Now</span><span class="op" id="8341458">(</span><span class="op" id="8341459">)</span><span class="op" id="8341460">.</span><span class="ident" id="8341461">Add</span><span class="op" id="8341464">(</span><span class="ident" id="8341465">time</span><span class="op" id="8341469">.</span><span class="ident" id="8341470">Hour</span><span class="op" id="8341474">)</span><span class="op" id="8341475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341480">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341484">}</span><span class="op" id="8341485">(</span><span class="op" id="8341486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341490">buf</span>&nbsp;<span class="op" id="8341494">:=</span>&nbsp;<span class="builtinfunc" id="8341497">make</span><span class="op" id="8341501">(</span><span class="op" id="8341502">[</span><span class="op" id="8341503">]</span><span class="builtintype" id="8341504">byte</span><span class="op" id="8341508">,</span>&nbsp;<span class="num" id="8341510">1</span><span class="op" id="8341511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341515">for</span>&nbsp;<span class="op" id="8341519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341524">_</span><span class="op" id="8341525">,</span>&nbsp;<span class="ident" id="8341527">err</span>&nbsp;<span class="op" id="8341531">:=</span>&nbsp;<span class="ident" id="8341534">s</span><span class="op" id="8341535">.</span><span class="ident" id="8341536">Read</span><span class="op" id="8341540">(</span><span class="ident" id="8341541">buf</span><span class="op" id="8341544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341549">if</span>&nbsp;<span class="ident" id="8341552">err</span>&nbsp;<span class="op" id="8341556">!=</span>&nbsp;<span class="ident" id="8341559">nil</span>&nbsp;<span class="op" id="8341563">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341569">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341583">s</span><span class="op" id="8341584">.</span><span class="ident" id="8341585">SetDeadline</span><span class="op" id="8341596">(</span><span class="ident" id="8341597">time</span><span class="op" id="8341601">.</span><span class="ident" id="8341602">Now</span><span class="op" id="8341605">(</span><span class="op" id="8341606">)</span><span class="op" id="8341607">.</span><span class="ident" id="8341608">Add</span><span class="op" id="8341611">(</span><span class="ident" id="8341612">time</span><span class="op" id="8341616">.</span><span class="ident" id="8341617">Hour</span><span class="op" id="8341621">)</span><span class="op" id="8341622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341629">}</span><span class="op" id="8341630">(</span><span class="op" id="8341631">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341634">c</span><span class="op" id="8341635">,</span>&nbsp;<span class="ident" id="8341637">err</span>&nbsp;<span class="op" id="8341641">:=</span>&nbsp;<span class="ident" id="8341644">Dial</span><span class="op" id="8341648">(</span><span class="string" id="8341649">&#34;tcp&#34;</span><span class="op" id="8341654">,</span>&nbsp;<span class="ident" id="8341656">ln</span><span class="op" id="8341658">.</span><span class="ident" id="8341659">Addr</span><span class="op" id="8341663">(</span><span class="op" id="8341664">)</span><span class="op" id="8341665">.</span><span class="ident" id="8341666">String</span><span class="op" id="8341672">(</span><span class="op" id="8341673">)</span><span class="op" id="8341674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341677">if</span>&nbsp;<span class="ident" id="8341680">err</span>&nbsp;<span class="op" id="8341684">!=</span>&nbsp;<span class="ident" id="8341687">nil</span>&nbsp;<span class="op" id="8341691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341695">t</span><span class="op" id="8341696">.</span><span class="ident" id="8341697">Fatalf</span><span class="op" id="8341703">(</span><span class="string" id="8341704">&#34;DialTCP:&nbsp;%v&#34;</span><span class="op" id="8341717">,</span>&nbsp;<span class="ident" id="8341719">err</span><span class="op" id="8341722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341728">defer</span>&nbsp;<span class="ident" id="8341734">c</span><span class="op" id="8341735">.</span><span class="ident" id="8341736">Close</span><span class="op" id="8341741">(</span><span class="op" id="8341742">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341745">&lt;-</span><span class="ident" id="8341747">connected</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341758">for</span>&nbsp;<span class="ident" id="8341762">i</span>&nbsp;<span class="op" id="8341764">:=</span>&nbsp;<span class="num" id="8341767">0</span><span class="op" id="8341768">;</span>&nbsp;<span class="ident" id="8341770">i</span>&nbsp;<span class="op" id="8341772">&lt;</span>&nbsp;<span class="num" id="8341774">1024</span><span class="op" id="8341778">;</span>&nbsp;<span class="ident" id="8341780">i</span><span class="op" id="8341781">++</span>&nbsp;<span class="op" id="8341784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341788">var</span>&nbsp;<span class="ident" id="8341792">buf</span>&nbsp;<span class="op" id="8341796">[</span><span class="num" id="8341797">1</span><span class="op" id="8341798">]</span><span class="builtintype" id="8341799">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341806">c</span><span class="op" id="8341807">.</span><span class="ident" id="8341808">Write</span><span class="op" id="8341813">(</span><span class="ident" id="8341814">buf</span><span class="op" id="8341817">[</span><span class="op" id="8341818">:</span><span class="op" id="8341819">]</span><span class="op" id="8341820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341823">}</span><br>
<span class="lineno">710</span><span class="op" id="8341825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8341828">func</span>&nbsp;<span class="ident" id="8341833">TestDeadlineRace</span><span class="op" id="8341849">(</span><span class="ident" id="8341850">t</span>&nbsp;<span class="op" id="8341852">*</span><span class="ident" id="8341853">testing</span><span class="op" id="8341860">.</span><span class="ident" id="8341861">T</span><span class="op" id="8341862">)</span>&nbsp;<span class="op" id="8341864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341867">switch</span>&nbsp;<span class="ident" id="8341874">runtime</span><span class="op" id="8341881">.</span><span class="ident" id="8341882">GOOS</span>&nbsp;<span class="op" id="8341887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341890">case</span>&nbsp;<span class="string" id="8341895">&#34;nacl&#34;</span><span class="op" id="8341901">,</span>&nbsp;<span class="string" id="8341903">&#34;plan9&#34;</span><span class="op" id="8341910">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341914">t</span><span class="op" id="8341915">.</span><span class="ident" id="8341916">Skipf</span><span class="op" id="8341921">(</span><span class="string" id="8341922">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="8341943">,</span>&nbsp;<span class="ident" id="8341945">runtime</span><span class="op" id="8341952">.</span><span class="ident" id="8341953">GOOS</span><span class="op" id="8341957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8341960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341964">N</span>&nbsp;<span class="op" id="8341966">:=</span>&nbsp;<span class="num" id="8341969">1000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8341975">if</span>&nbsp;<span class="ident" id="8341978">testing</span><span class="op" id="8341985">.</span><span class="ident" id="8341986">Short</span><span class="op" id="8341991">(</span><span class="op" id="8341992">)</span>&nbsp;<span class="op" id="8341994">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8341998">N</span>&nbsp;<span class="op" id="8342000">=</span>&nbsp;<span class="num" id="8342002">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342009">defer</span>&nbsp;<span class="ident" id="8342015">runtime</span><span class="op" id="8342022">.</span><span class="ident" id="8342023">GOMAXPROCS</span><span class="op" id="8342033">(</span><span class="ident" id="8342034">runtime</span><span class="op" id="8342041">.</span><span class="ident" id="8342042">GOMAXPROCS</span><span class="op" id="8342052">(</span><span class="num" id="8342053">4</span><span class="op" id="8342054">)</span><span class="op" id="8342055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342058">ln</span>&nbsp;<span class="op" id="8342061">:=</span>&nbsp;<span class="ident" id="8342064">newLocalListener</span><span class="op" id="8342080">(</span><span class="ident" id="8342081">t</span><span class="op" id="8342082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342085">defer</span>&nbsp;<span class="ident" id="8342091">ln</span><span class="op" id="8342093">.</span><span class="ident" id="8342094">Close</span><span class="op" id="8342099">(</span><span class="op" id="8342100">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342103">c</span><span class="op" id="8342104">,</span>&nbsp;<span class="ident" id="8342106">err</span>&nbsp;<span class="op" id="8342110">:=</span>&nbsp;<span class="ident" id="8342113">Dial</span><span class="op" id="8342117">(</span><span class="string" id="8342118">&#34;tcp&#34;</span><span class="op" id="8342123">,</span>&nbsp;<span class="ident" id="8342125">ln</span><span class="op" id="8342127">.</span><span class="ident" id="8342128">Addr</span><span class="op" id="8342132">(</span><span class="op" id="8342133">)</span><span class="op" id="8342134">.</span><span class="ident" id="8342135">String</span><span class="op" id="8342141">(</span><span class="op" id="8342142">)</span><span class="op" id="8342143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342146">if</span>&nbsp;<span class="ident" id="8342149">err</span>&nbsp;<span class="op" id="8342153">!=</span>&nbsp;<span class="ident" id="8342156">nil</span>&nbsp;<span class="op" id="8342160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342164">t</span><span class="op" id="8342165">.</span><span class="ident" id="8342166">Fatalf</span><span class="op" id="8342172">(</span><span class="string" id="8342173">&#34;Dial:&nbsp;%v&#34;</span><span class="op" id="8342183">,</span>&nbsp;<span class="ident" id="8342185">err</span><span class="op" id="8342188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342194">defer</span>&nbsp;<span class="ident" id="8342200">c</span><span class="op" id="8342201">.</span><span class="ident" id="8342202">Close</span><span class="op" id="8342207">(</span><span class="op" id="8342208">)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342211">done</span>&nbsp;<span class="op" id="8342216">:=</span>&nbsp;<span class="builtinfunc" id="8342219">make</span><span class="op" id="8342223">(</span><span class="keyword" id="8342224">chan</span>&nbsp;<span class="builtintype" id="8342229">bool</span><span class="op" id="8342233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342236">go</span>&nbsp;<span class="keyword" id="8342239">func</span><span class="op" id="8342243">(</span><span class="op" id="8342244">)</span>&nbsp;<span class="op" id="8342246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342250">t</span>&nbsp;<span class="op" id="8342252">:=</span>&nbsp;<span class="ident" id="8342255">time</span><span class="op" id="8342259">.</span><span class="ident" id="8342260">NewTicker</span><span class="op" id="8342269">(</span><span class="num" id="8342270">2</span>&nbsp;<span class="op" id="8342272">*</span>&nbsp;<span class="ident" id="8342274">time</span><span class="op" id="8342278">.</span><span class="ident" id="8342279">Microsecond</span><span class="op" id="8342290">)</span><span class="op" id="8342291">.</span><span class="ident" id="8342292">C</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342296">for</span>&nbsp;<span class="ident" id="8342300">i</span>&nbsp;<span class="op" id="8342302">:=</span>&nbsp;<span class="num" id="8342305">0</span><span class="op" id="8342306">;</span>&nbsp;<span class="ident" id="8342308">i</span>&nbsp;<span class="op" id="8342310">&lt;</span>&nbsp;<span class="ident" id="8342312">N</span><span class="op" id="8342313">;</span>&nbsp;<span class="ident" id="8342315">i</span><span class="op" id="8342316">++</span>&nbsp;<span class="op" id="8342319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342324">if</span>&nbsp;<span class="ident" id="8342327">err</span>&nbsp;<span class="op" id="8342331">:=</span>&nbsp;<span class="ident" id="8342334">c</span><span class="op" id="8342335">.</span><span class="ident" id="8342336">SetDeadline</span><span class="op" id="8342347">(</span><span class="ident" id="8342348">time</span><span class="op" id="8342352">.</span><span class="ident" id="8342353">Now</span><span class="op" id="8342356">(</span><span class="op" id="8342357">)</span><span class="op" id="8342358">.</span><span class="ident" id="8342359">Add</span><span class="op" id="8342362">(</span><span class="num" id="8342363">2</span>&nbsp;<span class="op" id="8342365">*</span>&nbsp;<span class="ident" id="8342367">time</span><span class="op" id="8342371">.</span><span class="ident" id="8342372">Microsecond</span><span class="op" id="8342383">)</span><span class="op" id="8342384">)</span><span class="op" id="8342385">;</span>&nbsp;<span class="ident" id="8342387">err</span>&nbsp;<span class="op" id="8342391">!=</span>&nbsp;<span class="ident" id="8342394">nil</span>&nbsp;<span class="op" id="8342398">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342404">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342418">&lt;-</span><span class="ident" id="8342420">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342428">done</span>&nbsp;<span class="op" id="8342433">&lt;-</span>&nbsp;<span class="builtintype" id="8342436">true</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342442">}</span><span class="op" id="8342443">(</span><span class="op" id="8342444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342447">var</span>&nbsp;<span class="ident" id="8342451">buf</span>&nbsp;<span class="op" id="8342455">[</span><span class="num" id="8342456">1</span><span class="op" id="8342457">]</span><span class="builtintype" id="8342458">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8342464">for</span>&nbsp;<span class="ident" id="8342468">i</span>&nbsp;<span class="op" id="8342470">:=</span>&nbsp;<span class="num" id="8342473">0</span><span class="op" id="8342474">;</span>&nbsp;<span class="ident" id="8342476">i</span>&nbsp;<span class="op" id="8342478">&lt;</span>&nbsp;<span class="ident" id="8342480">N</span><span class="op" id="8342481">;</span>&nbsp;<span class="ident" id="8342483">i</span><span class="op" id="8342484">++</span>&nbsp;<span class="op" id="8342487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342491">c</span><span class="op" id="8342492">.</span><span class="ident" id="8342493">Read</span><span class="op" id="8342497">(</span><span class="ident" id="8342498">buf</span><span class="op" id="8342501">[</span><span class="op" id="8342502">:</span><span class="op" id="8342503">]</span><span class="op" id="8342504">)</span>&nbsp;<span class="comment" id="8342506">//&nbsp;ignore&nbsp;possible&nbsp;timeout&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342541">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8342544">c</span><span class="op" id="8342545">.</span><span class="ident" id="8342546">Close</span><span class="op" id="8342551">(</span><span class="op" id="8342552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8342555">&lt;-</span><span class="ident" id="8342557">done</span><br>
<span class="lineno"></span><span class="op" id="8342562">}</span>
</div>
</body>
</html>
