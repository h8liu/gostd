<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3243935">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3243990">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3244044">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3244095">package</span>&nbsp;<span class="ident" id="3244103">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3244113">import</span>&nbsp;<span class="op" id="3244120">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3244123">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3244130">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3244141">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3244163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3244166">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="3244227">type</span>&nbsp;<span class="ident" id="3244232">common</span>&nbsp;<span class="keyword" id="3244239">struct</span>&nbsp;<span class="op" id="3244246">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244249">tmpl</span>&nbsp;<span class="keyword" id="3244254">map</span><span class="op" id="3244257">[</span><span class="builtintype" id="3244258">string</span><span class="op" id="3244264">]</span><span class="op" id="3244265">*</span><span class="ident" id="3244266">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244276">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244336">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3244395">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244432">parseFuncs</span>&nbsp;<span class="ident" id="3244443">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244452">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="3244463">map</span><span class="op" id="3244466">[</span><span class="builtintype" id="3244467">string</span><span class="op" id="3244473">]</span><span class="ident" id="3244474">reflect</span><span class="op" id="3244481">.</span><span class="ident" id="3244482">Value</span><br>
<span class="lineno"></span><span class="op" id="3244488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3244491">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="3244563">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="3244636">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3244675">type</span>&nbsp;<span class="ident" id="3244680">Template</span>&nbsp;<span class="keyword" id="3244689">struct</span>&nbsp;<span class="op" id="3244696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244699">name</span>&nbsp;<span class="builtintype" id="3244704">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3244712">*</span><span class="ident" id="3244713">parse</span><span class="op" id="3244718">.</span><span class="ident" id="3244719">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3244725">*</span><span class="ident" id="3244726">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244734">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="3244745">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244753">rightDelim</span>&nbsp;<span class="builtintype" id="3244764">string</span><br>
<span class="lineno"></span><span class="op" id="3244771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3244774">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="3244827">func</span>&nbsp;<span class="ident" id="3244832">New</span><span class="op" id="3244835">(</span><span class="ident" id="3244836">name</span>&nbsp;<span class="builtintype" id="3244841">string</span><span class="op" id="3244847">)</span>&nbsp;<span class="op" id="3244849">*</span><span class="ident" id="3244850">Template</span>&nbsp;<span class="op" id="3244859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3244862">return</span>&nbsp;<span class="op" id="3244869">&amp;</span><span class="ident" id="3244870">Template</span><span class="op" id="3244878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3244882">name</span><span class="op" id="3244886">:</span>&nbsp;<span class="ident" id="3244888">name</span><span class="op" id="3244892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3244895">}</span><br>
<span class="lineno"></span><span class="op" id="3244897">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3244900">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3244942">func</span>&nbsp;<span class="op" id="3244947">(</span><span class="ident" id="3244948">t</span>&nbsp;<span class="op" id="3244950">*</span><span class="ident" id="3244951">Template</span><span class="op" id="3244959">)</span>&nbsp;<span class="ident" id="3244961">Name</span><span class="op" id="3244965">(</span><span class="op" id="3244966">)</span>&nbsp;<span class="builtintype" id="3244968">string</span>&nbsp;<span class="op" id="3244975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3244978">return</span>&nbsp;<span class="ident" id="3244985">t</span><span class="op" id="3244986">.</span><span class="ident" id="3244987">name</span><br>
<span class="lineno"></span><span class="op" id="3244992">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3244995">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3245075">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3245151">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3245197">func</span>&nbsp;<span class="op" id="3245202">(</span><span class="ident" id="3245203">t</span>&nbsp;<span class="op" id="3245205">*</span><span class="ident" id="3245206">Template</span><span class="op" id="3245214">)</span>&nbsp;<span class="ident" id="3245216">New</span><span class="op" id="3245219">(</span><span class="ident" id="3245220">name</span>&nbsp;<span class="builtintype" id="3245225">string</span><span class="op" id="3245231">)</span>&nbsp;<span class="op" id="3245233">*</span><span class="ident" id="3245234">Template</span>&nbsp;<span class="op" id="3245243">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245246">t</span><span class="op" id="3245247">.</span><span class="ident" id="3245248">init</span><span class="op" id="3245252">(</span><span class="op" id="3245253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245256">return</span>&nbsp;<span class="op" id="3245263">&amp;</span><span class="ident" id="3245264">Template</span><span class="op" id="3245272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245276">name</span><span class="op" id="3245280">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3245288">name</span><span class="op" id="3245292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245296">common</span><span class="op" id="3245302">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3245308">t</span><span class="op" id="3245309">.</span><span class="ident" id="3245310">common</span><span class="op" id="3245316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245320">leftDelim</span><span class="op" id="3245329">:</span>&nbsp;&nbsp;<span class="ident" id="3245332">t</span><span class="op" id="3245333">.</span><span class="ident" id="3245334">leftDelim</span><span class="op" id="3245343">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245347">rightDelim</span><span class="op" id="3245357">:</span>&nbsp;<span class="ident" id="3245359">t</span><span class="op" id="3245360">.</span><span class="ident" id="3245361">rightDelim</span><span class="op" id="3245371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245374">}</span><br>
<span class="lineno"></span><span class="op" id="3245376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3245379">func</span>&nbsp;<span class="op" id="3245384">(</span><span class="ident" id="3245385">t</span>&nbsp;<span class="op" id="3245387">*</span><span class="ident" id="3245388">Template</span><span class="op" id="3245396">)</span>&nbsp;<span class="ident" id="3245398">init</span><span class="op" id="3245402">(</span><span class="op" id="3245403">)</span>&nbsp;<span class="op" id="3245405">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3245408">if</span>&nbsp;<span class="ident" id="3245411">t</span><span class="op" id="3245412">.</span><span class="ident" id="3245413">common</span>&nbsp;<span class="op" id="3245420">==</span>&nbsp;<span class="ident" id="3245423">nil</span>&nbsp;<span class="op" id="3245427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245431">t</span><span class="op" id="3245432">.</span><span class="ident" id="3245433">common</span>&nbsp;<span class="op" id="3245440">=</span>&nbsp;<span class="builtinfunc" id="3245442">new</span><span class="op" id="3245445">(</span><span class="ident" id="3245446">common</span><span class="op" id="3245452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245456">t</span><span class="op" id="3245457">.</span><span class="ident" id="3245458">tmpl</span>&nbsp;<span class="op" id="3245463">=</span>&nbsp;<span class="builtinfunc" id="3245465">make</span><span class="op" id="3245469">(</span><span class="keyword" id="3245470">map</span><span class="op" id="3245473">[</span><span class="builtintype" id="3245474">string</span><span class="op" id="3245480">]</span><span class="op" id="3245481">*</span><span class="ident" id="3245482">Template</span><span class="op" id="3245490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245494">t</span><span class="op" id="3245495">.</span><span class="ident" id="3245496">parseFuncs</span>&nbsp;<span class="op" id="3245507">=</span>&nbsp;<span class="builtinfunc" id="3245509">make</span><span class="op" id="3245513">(</span><span class="ident" id="3245514">FuncMap</span><span class="op" id="3245521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3245525">t</span><span class="op" id="3245526">.</span><span class="ident" id="3245527">execFuncs</span>&nbsp;<span class="op" id="3245537">=</span>&nbsp;<span class="builtinfunc" id="3245539">make</span><span class="op" id="3245543">(</span><span class="keyword" id="3245544">map</span><span class="op" id="3245547">[</span><span class="builtintype" id="3245548">string</span><span class="op" id="3245554">]</span><span class="ident" id="3245555">reflect</span><span class="op" id="3245562">.</span><span class="ident" id="3245563">Value</span><span class="op" id="3245568">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3245571">}</span><br>
<span class="lineno"></span><span class="op" id="3245573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3245576">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3245647">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="3245724">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="3245799">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="3245878">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3245956">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="3246007">func</span>&nbsp;<span class="op" id="3246012">(</span><span class="ident" id="3246013">t</span>&nbsp;<span class="op" id="3246015">*</span><span class="ident" id="3246016">Template</span><span class="op" id="3246024">)</span>&nbsp;<span class="ident" id="3246026">Clone</span><span class="op" id="3246031">(</span><span class="op" id="3246032">)</span>&nbsp;<span class="op" id="3246034">(</span><span class="op" id="3246035">*</span><span class="ident" id="3246036">Template</span><span class="op" id="3246044">,</span>&nbsp;<span class="builtintype" id="3246046">error</span><span class="op" id="3246051">)</span>&nbsp;<span class="op" id="3246053">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246056">nt</span>&nbsp;<span class="op" id="3246059">:=</span>&nbsp;<span class="ident" id="3246062">t</span><span class="op" id="3246063">.</span><span class="builtinfunc" id="3246064">copy</span><span class="op" id="3246068">(</span><span class="ident" id="3246069">nil</span><span class="op" id="3246072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246075">nt</span><span class="op" id="3246077">.</span><span class="ident" id="3246078">init</span><span class="op" id="3246082">(</span><span class="op" id="3246083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246086">nt</span><span class="op" id="3246088">.</span><span class="ident" id="3246089">tmpl</span><span class="op" id="3246093">[</span><span class="ident" id="3246094">t</span><span class="op" id="3246095">.</span><span class="ident" id="3246096">name</span><span class="op" id="3246100">]</span>&nbsp;<span class="op" id="3246102">=</span>&nbsp;<span class="ident" id="3246104">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246108">for</span>&nbsp;<span class="ident" id="3246112">k</span><span class="op" id="3246113">,</span>&nbsp;<span class="ident" id="3246115">v</span>&nbsp;<span class="op" id="3246117">:=</span>&nbsp;<span class="keyword" id="3246120">range</span>&nbsp;<span class="ident" id="3246126">t</span><span class="op" id="3246127">.</span><span class="ident" id="3246128">tmpl</span>&nbsp;<span class="op" id="3246133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246137">if</span>&nbsp;<span class="ident" id="3246140">k</span>&nbsp;<span class="op" id="3246142">==</span>&nbsp;<span class="ident" id="3246145">t</span><span class="op" id="3246146">.</span><span class="ident" id="3246147">name</span>&nbsp;<span class="op" id="3246152">{</span>&nbsp;<span class="comment" id="3246154">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246179">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3246194">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246253">tmpl</span>&nbsp;<span class="op" id="3246258">:=</span>&nbsp;<span class="ident" id="3246261">v</span><span class="op" id="3246262">.</span><span class="builtinfunc" id="3246263">copy</span><span class="op" id="3246267">(</span><span class="ident" id="3246268">nt</span><span class="op" id="3246270">.</span><span class="ident" id="3246271">common</span><span class="op" id="3246277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246281">nt</span><span class="op" id="3246283">.</span><span class="ident" id="3246284">tmpl</span><span class="op" id="3246288">[</span><span class="ident" id="3246289">k</span><span class="op" id="3246290">]</span>&nbsp;<span class="op" id="3246292">=</span>&nbsp;<span class="ident" id="3246294">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246303">for</span>&nbsp;<span class="ident" id="3246307">k</span><span class="op" id="3246308">,</span>&nbsp;<span class="ident" id="3246310">v</span>&nbsp;<span class="op" id="3246312">:=</span>&nbsp;<span class="keyword" id="3246315">range</span>&nbsp;<span class="ident" id="3246321">t</span><span class="op" id="3246322">.</span><span class="ident" id="3246323">parseFuncs</span>&nbsp;<span class="op" id="3246334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246338">nt</span><span class="op" id="3246340">.</span><span class="ident" id="3246341">parseFuncs</span><span class="op" id="3246351">[</span><span class="ident" id="3246352">k</span><span class="op" id="3246353">]</span>&nbsp;<span class="op" id="3246355">=</span>&nbsp;<span class="ident" id="3246357">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246363">for</span>&nbsp;<span class="ident" id="3246367">k</span><span class="op" id="3246368">,</span>&nbsp;<span class="ident" id="3246370">v</span>&nbsp;<span class="op" id="3246372">:=</span>&nbsp;<span class="keyword" id="3246375">range</span>&nbsp;<span class="ident" id="3246381">t</span><span class="op" id="3246382">.</span><span class="ident" id="3246383">execFuncs</span>&nbsp;<span class="op" id="3246393">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246397">nt</span><span class="op" id="3246399">.</span><span class="ident" id="3246400">execFuncs</span><span class="op" id="3246409">[</span><span class="ident" id="3246410">k</span><span class="op" id="3246411">]</span>&nbsp;<span class="op" id="3246413">=</span>&nbsp;<span class="ident" id="3246415">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246421">return</span>&nbsp;<span class="ident" id="3246428">nt</span><span class="op" id="3246430">,</span>&nbsp;<span class="ident" id="3246432">nil</span><br>
<span class="lineno"></span><span class="op" id="3246436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3246439">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3246509">func</span>&nbsp;<span class="op" id="3246514">(</span><span class="ident" id="3246515">t</span>&nbsp;<span class="op" id="3246517">*</span><span class="ident" id="3246518">Template</span><span class="op" id="3246526">)</span>&nbsp;<span class="builtinfunc" id="3246528">copy</span><span class="op" id="3246532">(</span><span class="ident" id="3246533">c</span>&nbsp;<span class="op" id="3246535">*</span><span class="ident" id="3246536">common</span><span class="op" id="3246542">)</span>&nbsp;<span class="op" id="3246544">*</span><span class="ident" id="3246545">Template</span>&nbsp;<span class="op" id="3246554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246557">nt</span>&nbsp;<span class="op" id="3246560">:=</span>&nbsp;<span class="ident" id="3246563">New</span><span class="op" id="3246566">(</span><span class="ident" id="3246567">t</span><span class="op" id="3246568">.</span><span class="ident" id="3246569">name</span><span class="op" id="3246573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246576">nt</span><span class="op" id="3246578">.</span><span class="ident" id="3246579">Tree</span>&nbsp;<span class="op" id="3246584">=</span>&nbsp;<span class="ident" id="3246586">t</span><span class="op" id="3246587">.</span><span class="ident" id="3246588">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246594">nt</span><span class="op" id="3246596">.</span><span class="ident" id="3246597">common</span>&nbsp;<span class="op" id="3246604">=</span>&nbsp;<span class="ident" id="3246606">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246609">nt</span><span class="op" id="3246611">.</span><span class="ident" id="3246612">leftDelim</span>&nbsp;<span class="op" id="3246622">=</span>&nbsp;<span class="ident" id="3246624">t</span><span class="op" id="3246625">.</span><span class="ident" id="3246626">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246637">nt</span><span class="op" id="3246639">.</span><span class="ident" id="3246640">rightDelim</span>&nbsp;<span class="op" id="3246651">=</span>&nbsp;<span class="ident" id="3246653">t</span><span class="op" id="3246654">.</span><span class="ident" id="3246655">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246667">return</span>&nbsp;<span class="ident" id="3246674">nt</span><br>
<span class="lineno"></span><span class="op" id="3246677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3246680">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="3246748">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="3246777">func</span>&nbsp;<span class="op" id="3246782">(</span><span class="ident" id="3246783">t</span>&nbsp;<span class="op" id="3246785">*</span><span class="ident" id="3246786">Template</span><span class="op" id="3246794">)</span>&nbsp;<span class="ident" id="3246796">AddParseTree</span><span class="op" id="3246808">(</span><span class="ident" id="3246809">name</span>&nbsp;<span class="builtintype" id="3246814">string</span><span class="op" id="3246820">,</span>&nbsp;<span class="ident" id="3246822">tree</span>&nbsp;<span class="op" id="3246827">*</span><span class="ident" id="3246828">parse</span><span class="op" id="3246833">.</span><span class="ident" id="3246834">Tree</span><span class="op" id="3246838">)</span>&nbsp;<span class="op" id="3246840">(</span><span class="op" id="3246841">*</span><span class="ident" id="3246842">Template</span><span class="op" id="3246850">,</span>&nbsp;<span class="builtintype" id="3246852">error</span><span class="op" id="3246857">)</span>&nbsp;<span class="op" id="3246859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246862">if</span>&nbsp;<span class="ident" id="3246865">t</span><span class="op" id="3246866">.</span><span class="ident" id="3246867">common</span>&nbsp;<span class="op" id="3246874">!=</span>&nbsp;<span class="ident" id="3246877">nil</span>&nbsp;<span class="op" id="3246881">&amp;&amp;</span>&nbsp;<span class="ident" id="3246884">t</span><span class="op" id="3246885">.</span><span class="ident" id="3246886">tmpl</span><span class="op" id="3246890">[</span><span class="ident" id="3246891">name</span><span class="op" id="3246895">]</span>&nbsp;<span class="op" id="3246897">!=</span>&nbsp;<span class="ident" id="3246900">nil</span>&nbsp;<span class="op" id="3246904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3246908">return</span>&nbsp;<span class="ident" id="3246915">nil</span><span class="op" id="3246918">,</span>&nbsp;<span class="ident" id="3246920">fmt</span><span class="op" id="3246923">.</span><span class="ident" id="3246924">Errorf</span><span class="op" id="3246930">(</span><span class="string" id="3246931">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3246970">,</span>&nbsp;<span class="ident" id="3246972">name</span><span class="op" id="3246976">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3246979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3246982">nt</span>&nbsp;<span class="op" id="3246985">:=</span>&nbsp;<span class="ident" id="3246988">t</span><span class="op" id="3246989">.</span><span class="ident" id="3246990">New</span><span class="op" id="3246993">(</span><span class="ident" id="3246994">name</span><span class="op" id="3246998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247001">nt</span><span class="op" id="3247003">.</span><span class="ident" id="3247004">Tree</span>&nbsp;<span class="op" id="3247009">=</span>&nbsp;<span class="ident" id="3247011">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247017">t</span><span class="op" id="3247018">.</span><span class="ident" id="3247019">tmpl</span><span class="op" id="3247023">[</span><span class="ident" id="3247024">name</span><span class="op" id="3247028">]</span>&nbsp;<span class="op" id="3247030">=</span>&nbsp;<span class="ident" id="3247032">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247036">return</span>&nbsp;<span class="ident" id="3247043">nt</span><span class="op" id="3247045">,</span>&nbsp;<span class="ident" id="3247047">nil</span><br>
<span class="lineno">115</span><span class="op" id="3247051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3247054">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="3247131">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="3247142">func</span>&nbsp;<span class="op" id="3247147">(</span><span class="ident" id="3247148">t</span>&nbsp;<span class="op" id="3247150">*</span><span class="ident" id="3247151">Template</span><span class="op" id="3247159">)</span>&nbsp;<span class="ident" id="3247161">Templates</span><span class="op" id="3247170">(</span><span class="op" id="3247171">)</span>&nbsp;<span class="op" id="3247173">[</span><span class="op" id="3247174">]</span><span class="op" id="3247175">*</span><span class="ident" id="3247176">Template</span>&nbsp;<span class="op" id="3247185">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247188">if</span>&nbsp;<span class="ident" id="3247191">t</span><span class="op" id="3247192">.</span><span class="ident" id="3247193">common</span>&nbsp;<span class="op" id="3247200">==</span>&nbsp;<span class="ident" id="3247203">nil</span>&nbsp;<span class="op" id="3247207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247211">return</span>&nbsp;<span class="ident" id="3247218">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3247226">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247273">m</span>&nbsp;<span class="op" id="3247275">:=</span>&nbsp;<span class="builtinfunc" id="3247278">make</span><span class="op" id="3247282">(</span><span class="op" id="3247283">[</span><span class="op" id="3247284">]</span><span class="op" id="3247285">*</span><span class="ident" id="3247286">Template</span><span class="op" id="3247294">,</span>&nbsp;<span class="num" id="3247296">0</span><span class="op" id="3247297">,</span>&nbsp;<span class="builtinfunc" id="3247299">len</span><span class="op" id="3247302">(</span><span class="ident" id="3247303">t</span><span class="op" id="3247304">.</span><span class="ident" id="3247305">tmpl</span><span class="op" id="3247309">)</span><span class="op" id="3247310">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247313">for</span>&nbsp;<span class="ident" id="3247317">_</span><span class="op" id="3247318">,</span>&nbsp;<span class="ident" id="3247320">v</span>&nbsp;<span class="op" id="3247322">:=</span>&nbsp;<span class="keyword" id="3247325">range</span>&nbsp;<span class="ident" id="3247331">t</span><span class="op" id="3247332">.</span><span class="ident" id="3247333">tmpl</span>&nbsp;<span class="op" id="3247338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247342">m</span>&nbsp;<span class="op" id="3247344">=</span>&nbsp;<span class="builtinfunc" id="3247346">append</span><span class="op" id="3247352">(</span><span class="ident" id="3247353">m</span><span class="op" id="3247354">,</span>&nbsp;<span class="ident" id="3247356">v</span><span class="op" id="3247357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3247360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247363">return</span>&nbsp;<span class="ident" id="3247370">m</span><br>
<span class="lineno"></span><span class="op" id="3247372">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3247375">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3247452">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3247524">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3247600">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="3247636">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3247698">func</span>&nbsp;<span class="op" id="3247703">(</span><span class="ident" id="3247704">t</span>&nbsp;<span class="op" id="3247706">*</span><span class="ident" id="3247707">Template</span><span class="op" id="3247715">)</span>&nbsp;<span class="ident" id="3247717">Delims</span><span class="op" id="3247723">(</span><span class="ident" id="3247724">left</span><span class="op" id="3247728">,</span>&nbsp;<span class="ident" id="3247730">right</span>&nbsp;<span class="builtintype" id="3247736">string</span><span class="op" id="3247742">)</span>&nbsp;<span class="op" id="3247744">*</span><span class="ident" id="3247745">Template</span>&nbsp;<span class="op" id="3247754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247757">t</span><span class="op" id="3247758">.</span><span class="ident" id="3247759">leftDelim</span>&nbsp;<span class="op" id="3247769">=</span>&nbsp;<span class="ident" id="3247771">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3247777">t</span><span class="op" id="3247778">.</span><span class="ident" id="3247779">rightDelim</span>&nbsp;<span class="op" id="3247790">=</span>&nbsp;<span class="ident" id="3247792">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3247799">return</span>&nbsp;<span class="ident" id="3247806">t</span><br>
<span class="lineno">140</span><span class="op" id="3247808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3247811">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3247890">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3247967">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="3248042">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3248093">func</span>&nbsp;<span class="op" id="3248098">(</span><span class="ident" id="3248099">t</span>&nbsp;<span class="op" id="3248101">*</span><span class="ident" id="3248102">Template</span><span class="op" id="3248110">)</span>&nbsp;<span class="ident" id="3248112">Funcs</span><span class="op" id="3248117">(</span><span class="ident" id="3248118">funcMap</span>&nbsp;<span class="ident" id="3248126">FuncMap</span><span class="op" id="3248133">)</span>&nbsp;<span class="op" id="3248135">*</span><span class="ident" id="3248136">Template</span>&nbsp;<span class="op" id="3248145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248148">t</span><span class="op" id="3248149">.</span><span class="ident" id="3248150">init</span><span class="op" id="3248154">(</span><span class="op" id="3248155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248158">addValueFuncs</span><span class="op" id="3248171">(</span><span class="ident" id="3248172">t</span><span class="op" id="3248173">.</span><span class="ident" id="3248174">execFuncs</span><span class="op" id="3248183">,</span>&nbsp;<span class="ident" id="3248185">funcMap</span><span class="op" id="3248192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3248195">addFuncs</span><span class="op" id="3248203">(</span><span class="ident" id="3248204">t</span><span class="op" id="3248205">.</span><span class="ident" id="3248206">parseFuncs</span><span class="op" id="3248216">,</span>&nbsp;<span class="ident" id="3248218">funcMap</span><span class="op" id="3248225">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248228">return</span>&nbsp;<span class="ident" id="3248235">t</span><br>
<span class="lineno"></span><span class="op" id="3248237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3248240">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="3248318">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="3248358">func</span>&nbsp;<span class="op" id="3248363">(</span><span class="ident" id="3248364">t</span>&nbsp;<span class="op" id="3248366">*</span><span class="ident" id="3248367">Template</span><span class="op" id="3248375">)</span>&nbsp;<span class="ident" id="3248377">Lookup</span><span class="op" id="3248383">(</span><span class="ident" id="3248384">name</span>&nbsp;<span class="builtintype" id="3248389">string</span><span class="op" id="3248395">)</span>&nbsp;<span class="op" id="3248397">*</span><span class="ident" id="3248398">Template</span>&nbsp;<span class="op" id="3248407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248410">if</span>&nbsp;<span class="ident" id="3248413">t</span><span class="op" id="3248414">.</span><span class="ident" id="3248415">common</span>&nbsp;<span class="op" id="3248422">==</span>&nbsp;<span class="ident" id="3248425">nil</span>&nbsp;<span class="op" id="3248429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248433">return</span>&nbsp;<span class="ident" id="3248440">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3248445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3248448">return</span>&nbsp;<span class="ident" id="3248455">t</span><span class="op" id="3248456">.</span><span class="ident" id="3248457">tmpl</span><span class="op" id="3248461">[</span><span class="ident" id="3248462">name</span><span class="op" id="3248466">]</span><br>
<span class="lineno">160</span><span class="op" id="3248468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3248471">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3248549">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3248629">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="3248707">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3248780">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3248855">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3248933">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="3249008">func</span>&nbsp;<span class="op" id="3249013">(</span><span class="ident" id="3249014">t</span>&nbsp;<span class="op" id="3249016">*</span><span class="ident" id="3249017">Template</span><span class="op" id="3249025">)</span>&nbsp;<span class="ident" id="3249027">Parse</span><span class="op" id="3249032">(</span><span class="ident" id="3249033">text</span>&nbsp;<span class="builtintype" id="3249038">string</span><span class="op" id="3249044">)</span>&nbsp;<span class="op" id="3249046">(</span><span class="op" id="3249047">*</span><span class="ident" id="3249048">Template</span><span class="op" id="3249056">,</span>&nbsp;<span class="builtintype" id="3249058">error</span><span class="op" id="3249063">)</span>&nbsp;<span class="op" id="3249065">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249068">t</span><span class="op" id="3249069">.</span><span class="ident" id="3249070">init</span><span class="op" id="3249074">(</span><span class="op" id="3249075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249078">trees</span><span class="op" id="3249083">,</span>&nbsp;<span class="ident" id="3249085">err</span>&nbsp;<span class="op" id="3249089">:=</span>&nbsp;<span class="ident" id="3249092">parse</span><span class="op" id="3249097">.</span><span class="ident" id="3249098">Parse</span><span class="op" id="3249103">(</span><span class="ident" id="3249104">t</span><span class="op" id="3249105">.</span><span class="ident" id="3249106">name</span><span class="op" id="3249110">,</span>&nbsp;<span class="ident" id="3249112">text</span><span class="op" id="3249116">,</span>&nbsp;<span class="ident" id="3249118">t</span><span class="op" id="3249119">.</span><span class="ident" id="3249120">leftDelim</span><span class="op" id="3249129">,</span>&nbsp;<span class="ident" id="3249131">t</span><span class="op" id="3249132">.</span><span class="ident" id="3249133">rightDelim</span><span class="op" id="3249143">,</span>&nbsp;<span class="ident" id="3249145">t</span><span class="op" id="3249146">.</span><span class="ident" id="3249147">parseFuncs</span><span class="op" id="3249157">,</span>&nbsp;<span class="ident" id="3249159">builtins</span><span class="op" id="3249167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249170">if</span>&nbsp;<span class="ident" id="3249173">err</span>&nbsp;<span class="op" id="3249177">!=</span>&nbsp;<span class="ident" id="3249180">nil</span>&nbsp;<span class="op" id="3249184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249188">return</span>&nbsp;<span class="ident" id="3249195">nil</span><span class="op" id="3249198">,</span>&nbsp;<span class="ident" id="3249200">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249205">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249208">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249292">for</span>&nbsp;<span class="ident" id="3249296">name</span><span class="op" id="3249300">,</span>&nbsp;<span class="ident" id="3249302">tree</span>&nbsp;<span class="op" id="3249307">:=</span>&nbsp;<span class="keyword" id="3249310">range</span>&nbsp;<span class="ident" id="3249316">trees</span>&nbsp;<span class="op" id="3249322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249326">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249408">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249466">tmpl</span>&nbsp;<span class="op" id="3249471">:=</span>&nbsp;<span class="ident" id="3249474">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249478">if</span>&nbsp;<span class="ident" id="3249481">name</span>&nbsp;<span class="op" id="3249486">!=</span>&nbsp;<span class="ident" id="3249489">t</span><span class="op" id="3249490">.</span><span class="ident" id="3249491">name</span>&nbsp;<span class="op" id="3249496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249501">tmpl</span>&nbsp;<span class="op" id="3249506">=</span>&nbsp;<span class="ident" id="3249508">t</span><span class="op" id="3249509">.</span><span class="ident" id="3249510">New</span><span class="op" id="3249513">(</span><span class="ident" id="3249514">name</span><span class="op" id="3249518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3249526">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249596">if</span>&nbsp;<span class="ident" id="3249599">replace</span><span class="op" id="3249606">,</span>&nbsp;<span class="ident" id="3249608">err</span>&nbsp;<span class="op" id="3249612">:=</span>&nbsp;<span class="ident" id="3249615">t</span><span class="op" id="3249616">.</span><span class="ident" id="3249617">associate</span><span class="op" id="3249626">(</span><span class="ident" id="3249627">tmpl</span><span class="op" id="3249631">,</span>&nbsp;<span class="ident" id="3249633">tree</span><span class="op" id="3249637">)</span><span class="op" id="3249638">;</span>&nbsp;<span class="ident" id="3249640">err</span>&nbsp;<span class="op" id="3249644">!=</span>&nbsp;<span class="ident" id="3249647">nil</span>&nbsp;<span class="op" id="3249651">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249656">return</span>&nbsp;<span class="ident" id="3249663">nil</span><span class="op" id="3249666">,</span>&nbsp;<span class="ident" id="3249668">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249674">}</span>&nbsp;<span class="keyword" id="3249676">else</span>&nbsp;<span class="keyword" id="3249681">if</span>&nbsp;<span class="ident" id="3249684">replace</span>&nbsp;<span class="op" id="3249692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249697">tmpl</span><span class="op" id="3249701">.</span><span class="ident" id="3249702">Tree</span>&nbsp;<span class="op" id="3249707">=</span>&nbsp;<span class="ident" id="3249709">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249720">tmpl</span><span class="op" id="3249724">.</span><span class="ident" id="3249725">leftDelim</span>&nbsp;<span class="op" id="3249735">=</span>&nbsp;<span class="ident" id="3249737">t</span><span class="op" id="3249738">.</span><span class="ident" id="3249739">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3249751">tmpl</span><span class="op" id="3249755">.</span><span class="ident" id="3249756">rightDelim</span>&nbsp;<span class="op" id="3249767">=</span>&nbsp;<span class="ident" id="3249769">t</span><span class="op" id="3249770">.</span><span class="ident" id="3249771">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3249783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3249786">return</span>&nbsp;<span class="ident" id="3249793">t</span><span class="op" id="3249794">,</span>&nbsp;<span class="ident" id="3249796">nil</span><br>
<span class="lineno"></span><span class="op" id="3249800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="3249803">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3249881">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="3249952">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3250022">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="3250095">func</span>&nbsp;<span class="op" id="3250100">(</span><span class="ident" id="3250101">t</span>&nbsp;<span class="op" id="3250103">*</span><span class="ident" id="3250104">Template</span><span class="op" id="3250112">)</span>&nbsp;<span class="ident" id="3250114">associate</span><span class="op" id="3250123">(</span><span class="builtinfunc" id="3250124">new</span>&nbsp;<span class="op" id="3250128">*</span><span class="ident" id="3250129">Template</span><span class="op" id="3250137">,</span>&nbsp;<span class="ident" id="3250139">tree</span>&nbsp;<span class="op" id="3250144">*</span><span class="ident" id="3250145">parse</span><span class="op" id="3250150">.</span><span class="ident" id="3250151">Tree</span><span class="op" id="3250155">)</span>&nbsp;<span class="op" id="3250157">(</span><span class="builtintype" id="3250158">bool</span><span class="op" id="3250162">,</span>&nbsp;<span class="builtintype" id="3250164">error</span><span class="op" id="3250169">)</span>&nbsp;<span class="op" id="3250171">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250174">if</span>&nbsp;<span class="builtinfunc" id="3250177">new</span><span class="op" id="3250180">.</span><span class="ident" id="3250181">common</span>&nbsp;<span class="op" id="3250188">!=</span>&nbsp;<span class="ident" id="3250191">t</span><span class="op" id="3250192">.</span><span class="ident" id="3250193">common</span>&nbsp;<span class="op" id="3250200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3250204">panic</span><span class="op" id="3250209">(</span><span class="string" id="3250210">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="3250248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250254">name</span>&nbsp;<span class="op" id="3250259">:=</span>&nbsp;<span class="builtinfunc" id="3250262">new</span><span class="op" id="3250265">.</span><span class="ident" id="3250266">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250272">if</span>&nbsp;<span class="ident" id="3250275">old</span>&nbsp;<span class="op" id="3250279">:=</span>&nbsp;<span class="ident" id="3250282">t</span><span class="op" id="3250283">.</span><span class="ident" id="3250284">tmpl</span><span class="op" id="3250288">[</span><span class="ident" id="3250289">name</span><span class="op" id="3250293">]</span><span class="op" id="3250294">;</span>&nbsp;<span class="ident" id="3250296">old</span>&nbsp;<span class="op" id="3250300">!=</span>&nbsp;<span class="ident" id="3250303">nil</span>&nbsp;<span class="op" id="3250307">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250311">oldIsEmpty</span>&nbsp;<span class="op" id="3250322">:=</span>&nbsp;<span class="ident" id="3250325">parse</span><span class="op" id="3250330">.</span><span class="ident" id="3250331">IsEmptyTree</span><span class="op" id="3250342">(</span><span class="ident" id="3250343">old</span><span class="op" id="3250346">.</span><span class="ident" id="3250347">Root</span><span class="op" id="3250351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250355">newIsEmpty</span>&nbsp;<span class="op" id="3250366">:=</span>&nbsp;<span class="ident" id="3250369">parse</span><span class="op" id="3250374">.</span><span class="ident" id="3250375">IsEmptyTree</span><span class="op" id="3250386">(</span><span class="ident" id="3250387">tree</span><span class="op" id="3250391">.</span><span class="ident" id="3250392">Root</span><span class="op" id="3250396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250400">if</span>&nbsp;<span class="ident" id="3250403">newIsEmpty</span>&nbsp;<span class="op" id="3250414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3250419">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250494">return</span>&nbsp;<span class="builtintype" id="3250501">false</span><span class="op" id="3250506">,</span>&nbsp;<span class="ident" id="3250508">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250518">if</span>&nbsp;<span class="op" id="3250521">!</span><span class="ident" id="3250522">oldIsEmpty</span>&nbsp;<span class="op" id="3250533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250538">return</span>&nbsp;<span class="builtintype" id="3250545">false</span><span class="op" id="3250550">,</span>&nbsp;<span class="ident" id="3250552">fmt</span><span class="op" id="3250555">.</span><span class="ident" id="3250556">Errorf</span><span class="op" id="3250562">(</span><span class="string" id="3250563">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3250602">,</span>&nbsp;<span class="ident" id="3250604">name</span><span class="op" id="3250608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3250615">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3250618">t</span><span class="op" id="3250619">.</span><span class="ident" id="3250620">tmpl</span><span class="op" id="3250624">[</span><span class="ident" id="3250625">name</span><span class="op" id="3250629">]</span>&nbsp;<span class="op" id="3250631">=</span>&nbsp;<span class="builtinfunc" id="3250633">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3250638">return</span>&nbsp;<span class="builtintype" id="3250645">true</span><span class="op" id="3250649">,</span>&nbsp;<span class="ident" id="3250651">nil</span><br>
<span class="lineno"></span><span class="op" id="3250655">}</span>
</div>
</body>
</html>
