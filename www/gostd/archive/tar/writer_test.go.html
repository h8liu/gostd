<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8398960">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8399015">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8399069">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8399120">package</span>&nbsp;<span class="ident" id="8399128">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8399133">import</span>&nbsp;<span class="op" id="8399140">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399143">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399152">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399159">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399165">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399178">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399184">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399195">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399206">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399217">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8399235">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8399242">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8399245">type</span>&nbsp;<span class="ident" id="8399250">writerTestEntry</span>&nbsp;<span class="keyword" id="8399266">struct</span>&nbsp;<span class="op" id="8399273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399276">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8399285">*</span><span class="ident" id="8399286">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399294">contents</span>&nbsp;<span class="builtintype" id="8399303">string</span><br>
<span class="lineno"></span><span class="op" id="8399310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8399313">type</span>&nbsp;<span class="ident" id="8399318">writerTest</span>&nbsp;<span class="keyword" id="8399329">struct</span>&nbsp;<span class="op" id="8399336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399339">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8399347">string</span>&nbsp;<span class="comment" id="8399354">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399386">entries</span>&nbsp;<span class="op" id="8399394">[</span><span class="op" id="8399395">]</span><span class="op" id="8399396">*</span><span class="ident" id="8399397">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="8399413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8399416">var</span>&nbsp;<span class="ident" id="8399420">writerTests</span>&nbsp;<span class="op" id="8399432">=</span>&nbsp;<span class="op" id="8399434">[</span><span class="op" id="8399435">]</span><span class="op" id="8399436">*</span><span class="ident" id="8399437">writerTest</span><span class="op" id="8399447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8399450">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8399507">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8399530">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8399561">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399642">file</span><span class="op" id="8399646">:</span>&nbsp;<span class="string" id="8399648">&#34;testdata/writer.tar&#34;</span><span class="op" id="8399669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399673">entries</span><span class="op" id="8399680">:</span>&nbsp;<span class="op" id="8399682">[</span><span class="op" id="8399683">]</span><span class="op" id="8399684">*</span><span class="ident" id="8399685">writerTestEntry</span><span class="op" id="8399700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399711">header</span><span class="op" id="8399717">:</span>&nbsp;<span class="op" id="8399719">&amp;</span><span class="ident" id="8399720">Header</span><span class="op" id="8399726">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399733">Name</span><span class="op" id="8399737">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399743">&#34;small.txt&#34;</span><span class="op" id="8399754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399761">Mode</span><span class="op" id="8399765">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8399771">0640</span><span class="op" id="8399775">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399782">Uid</span><span class="op" id="8399785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8399792">73025</span><span class="op" id="8399797">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399804">Gid</span><span class="op" id="8399807">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8399814">5000</span><span class="op" id="8399818">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399825">Size</span><span class="op" id="8399829">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8399835">5</span><span class="op" id="8399836">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399843">ModTime</span><span class="op" id="8399850">:</span>&nbsp;&nbsp;<span class="ident" id="8399853">time</span><span class="op" id="8399857">.</span><span class="ident" id="8399858">Unix</span><span class="op" id="8399862">(</span><span class="num" id="8399863">1246508266</span><span class="op" id="8399873">,</span>&nbsp;<span class="num" id="8399875">0</span><span class="op" id="8399876">)</span><span class="op" id="8399877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399884">Typeflag</span><span class="op" id="8399892">:</span>&nbsp;<span class="string" id="8399894">&#39;0&#39;</span><span class="op" id="8399897">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399904">Uname</span><span class="op" id="8399909">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399914">&#34;dsymonds&#34;</span><span class="op" id="8399924">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399931">Gname</span><span class="op" id="8399936">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8399941">&#34;eng&#34;</span><span class="op" id="8399946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399952">}</span><span class="op" id="8399953">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399959">contents</span><span class="op" id="8399967">:</span>&nbsp;<span class="string" id="8399969">&#34;Kilts&#34;</span><span class="op" id="8399976">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399981">}</span><span class="op" id="8399982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8399987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8399993">header</span><span class="op" id="8399999">:</span>&nbsp;<span class="op" id="8400001">&amp;</span><span class="ident" id="8400002">Header</span><span class="op" id="8400008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400015">Name</span><span class="op" id="8400019">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400025">&#34;small2.txt&#34;</span><span class="op" id="8400037">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400044">Mode</span><span class="op" id="8400048">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400054">0640</span><span class="op" id="8400058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400065">Uid</span><span class="op" id="8400068">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400075">73025</span><span class="op" id="8400080">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400087">Gid</span><span class="op" id="8400090">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400097">5000</span><span class="op" id="8400101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400108">Size</span><span class="op" id="8400112">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400118">11</span><span class="op" id="8400120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400127">ModTime</span><span class="op" id="8400134">:</span>&nbsp;&nbsp;<span class="ident" id="8400137">time</span><span class="op" id="8400141">.</span><span class="ident" id="8400142">Unix</span><span class="op" id="8400146">(</span><span class="num" id="8400147">1245217492</span><span class="op" id="8400157">,</span>&nbsp;<span class="num" id="8400159">0</span><span class="op" id="8400160">)</span><span class="op" id="8400161">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400168">Typeflag</span><span class="op" id="8400176">:</span>&nbsp;<span class="string" id="8400178">&#39;0&#39;</span><span class="op" id="8400181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400188">Uname</span><span class="op" id="8400193">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400198">&#34;dsymonds&#34;</span><span class="op" id="8400208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400215">Gname</span><span class="op" id="8400220">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400225">&#34;eng&#34;</span><span class="op" id="8400230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400236">}</span><span class="op" id="8400237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400243">contents</span><span class="op" id="8400251">:</span>&nbsp;<span class="string" id="8400253">&#34;Google.com\n&#34;</span><span class="op" id="8400267">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400272">}</span><span class="op" id="8400273">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400284">header</span><span class="op" id="8400290">:</span>&nbsp;<span class="op" id="8400292">&amp;</span><span class="ident" id="8400293">Header</span><span class="op" id="8400299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400306">Name</span><span class="op" id="8400310">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400316">&#34;link.txt&#34;</span><span class="op" id="8400326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400333">Mode</span><span class="op" id="8400337">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400343">0777</span><span class="op" id="8400347">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400354">Uid</span><span class="op" id="8400357">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400364">1000</span><span class="op" id="8400368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400375">Gid</span><span class="op" id="8400378">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400385">1000</span><span class="op" id="8400389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400396">Size</span><span class="op" id="8400400">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400406">0</span><span class="op" id="8400407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400414">ModTime</span><span class="op" id="8400421">:</span>&nbsp;&nbsp;<span class="ident" id="8400424">time</span><span class="op" id="8400428">.</span><span class="ident" id="8400429">Unix</span><span class="op" id="8400433">(</span><span class="num" id="8400434">1314603082</span><span class="op" id="8400444">,</span>&nbsp;<span class="num" id="8400446">0</span><span class="op" id="8400447">)</span><span class="op" id="8400448">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400455">Typeflag</span><span class="op" id="8400463">:</span>&nbsp;<span class="string" id="8400465">&#39;2&#39;</span><span class="op" id="8400468">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400475">Linkname</span><span class="op" id="8400483">:</span>&nbsp;<span class="string" id="8400485">&#34;small.txt&#34;</span><span class="op" id="8400496">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400503">Uname</span><span class="op" id="8400508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400513">&#34;strings&#34;</span><span class="op" id="8400522">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400529">Gname</span><span class="op" id="8400534">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400539">&#34;strings&#34;</span><span class="op" id="8400548">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400554">}</span><span class="op" id="8400555">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400561">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400579">}</span><span class="op" id="8400580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400584">}</span><span class="op" id="8400585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400588">}</span><span class="op" id="8400589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400592">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400655">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8400717">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400795">file</span><span class="op" id="8400799">:</span>&nbsp;<span class="string" id="8400801">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="8400826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400830">entries</span><span class="op" id="8400837">:</span>&nbsp;<span class="op" id="8400839">[</span><span class="op" id="8400840">]</span><span class="op" id="8400841">*</span><span class="ident" id="8400842">writerTestEntry</span><span class="op" id="8400857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8400862">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400868">header</span><span class="op" id="8400874">:</span>&nbsp;<span class="op" id="8400876">&amp;</span><span class="ident" id="8400877">Header</span><span class="op" id="8400883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400890">Name</span><span class="op" id="8400894">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8400900">&#34;tmp/16gig.txt&#34;</span><span class="op" id="8400915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400922">Mode</span><span class="op" id="8400926">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400932">0640</span><span class="op" id="8400936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400943">Uid</span><span class="op" id="8400946">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400953">73025</span><span class="op" id="8400958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400965">Gid</span><span class="op" id="8400968">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400975">5000</span><span class="op" id="8400979">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8400986">Size</span><span class="op" id="8400990">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8400996">16</span>&nbsp;<span class="op" id="8400999">&lt;&lt;</span>&nbsp;<span class="num" id="8401002">30</span><span class="op" id="8401004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401011">ModTime</span><span class="op" id="8401018">:</span>&nbsp;&nbsp;<span class="ident" id="8401021">time</span><span class="op" id="8401025">.</span><span class="ident" id="8401026">Unix</span><span class="op" id="8401030">(</span><span class="num" id="8401031">1254699560</span><span class="op" id="8401041">,</span>&nbsp;<span class="num" id="8401043">0</span><span class="op" id="8401044">)</span><span class="op" id="8401045">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401052">Typeflag</span><span class="op" id="8401060">:</span>&nbsp;<span class="string" id="8401062">&#39;0&#39;</span><span class="op" id="8401065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401072">Uname</span><span class="op" id="8401077">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401082">&#34;dsymonds&#34;</span><span class="op" id="8401092">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401099">Gname</span><span class="op" id="8401104">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401109">&#34;eng&#34;</span><span class="op" id="8401114">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401120">}</span><span class="op" id="8401121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401127">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401148">contents</span><span class="op" id="8401156">:</span>&nbsp;<span class="ident" id="8401158">strings</span><span class="op" id="8401165">.</span><span class="ident" id="8401166">Repeat</span><span class="op" id="8401172">(</span><span class="string" id="8401173">&#34;\x00&#34;</span><span class="op" id="8401179">,</span>&nbsp;<span class="num" id="8401181">4</span><span class="op" id="8401182">&lt;&lt;</span><span class="num" id="8401184">10</span><span class="op" id="8401186">)</span><span class="op" id="8401187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401192">}</span><span class="op" id="8401193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401197">}</span><span class="op" id="8401198">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401201">}</span><span class="op" id="8401202">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401205">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401268">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401341">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401431">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401435">file</span><span class="op" id="8401439">:</span>&nbsp;<span class="string" id="8401441">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="8401471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401475">entries</span><span class="op" id="8401482">:</span>&nbsp;<span class="op" id="8401484">[</span><span class="op" id="8401485">]</span><span class="op" id="8401486">*</span><span class="ident" id="8401487">writerTestEntry</span><span class="op" id="8401502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401513">header</span><span class="op" id="8401519">:</span>&nbsp;<span class="op" id="8401521">&amp;</span><span class="ident" id="8401522">Header</span><span class="op" id="8401528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401535">Name</span><span class="op" id="8401539">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8401545">strings</span><span class="op" id="8401552">.</span><span class="ident" id="8401553">Repeat</span><span class="op" id="8401559">(</span><span class="string" id="8401560">&#34;longname/&#34;</span><span class="op" id="8401571">,</span>&nbsp;<span class="num" id="8401573">15</span><span class="op" id="8401575">)</span>&nbsp;<span class="op" id="8401577">+</span>&nbsp;<span class="string" id="8401579">&#34;16gig.txt&#34;</span><span class="op" id="8401590">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401597">Mode</span><span class="op" id="8401601">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8401607">0644</span><span class="op" id="8401611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401618">Uid</span><span class="op" id="8401621">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8401628">1000</span><span class="op" id="8401632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401639">Gid</span><span class="op" id="8401642">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8401649">1000</span><span class="op" id="8401653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401660">Size</span><span class="op" id="8401664">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8401670">16</span>&nbsp;<span class="op" id="8401673">&lt;&lt;</span>&nbsp;<span class="num" id="8401676">30</span><span class="op" id="8401678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401685">ModTime</span><span class="op" id="8401692">:</span>&nbsp;&nbsp;<span class="ident" id="8401695">time</span><span class="op" id="8401699">.</span><span class="ident" id="8401700">Unix</span><span class="op" id="8401704">(</span><span class="num" id="8401705">1399583047</span><span class="op" id="8401715">,</span>&nbsp;<span class="num" id="8401717">0</span><span class="op" id="8401718">)</span><span class="op" id="8401719">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401726">Typeflag</span><span class="op" id="8401734">:</span>&nbsp;<span class="string" id="8401736">&#39;0&#39;</span><span class="op" id="8401739">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401746">Uname</span><span class="op" id="8401751">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401756">&#34;guillaume&#34;</span><span class="op" id="8401767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401774">Gname</span><span class="op" id="8401779">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8401784">&#34;guillaume&#34;</span><span class="op" id="8401795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401801">}</span><span class="op" id="8401802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401808">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401829">contents</span><span class="op" id="8401837">:</span>&nbsp;<span class="ident" id="8401839">strings</span><span class="op" id="8401846">.</span><span class="ident" id="8401847">Repeat</span><span class="op" id="8401853">(</span><span class="string" id="8401854">&#34;\x00&#34;</span><span class="op" id="8401860">,</span>&nbsp;<span class="num" id="8401862">4</span><span class="op" id="8401863">&lt;&lt;</span><span class="num" id="8401865">10</span><span class="op" id="8401867">)</span><span class="op" id="8401868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401873">}</span><span class="op" id="8401874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401878">}</span><span class="op" id="8401879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401882">}</span><span class="op" id="8401883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401886">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8401932">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8401990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8401994">file</span><span class="op" id="8401998">:</span>&nbsp;<span class="string" id="8402000">&#34;testdata/ustar.tar&#34;</span><span class="op" id="8402020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402024">entries</span><span class="op" id="8402031">:</span>&nbsp;<span class="op" id="8402033">[</span><span class="op" id="8402034">]</span><span class="op" id="8402035">*</span><span class="ident" id="8402036">writerTestEntry</span><span class="op" id="8402051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402056">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402062">header</span><span class="op" id="8402068">:</span>&nbsp;<span class="op" id="8402070">&amp;</span><span class="ident" id="8402071">Header</span><span class="op" id="8402077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402084">Name</span><span class="op" id="8402088">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8402094">strings</span><span class="op" id="8402101">.</span><span class="ident" id="8402102">Repeat</span><span class="op" id="8402108">(</span><span class="string" id="8402109">&#34;longname/&#34;</span><span class="op" id="8402120">,</span>&nbsp;<span class="num" id="8402122">15</span><span class="op" id="8402124">)</span>&nbsp;<span class="op" id="8402126">+</span>&nbsp;<span class="string" id="8402128">&#34;file.txt&#34;</span><span class="op" id="8402138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402145">Mode</span><span class="op" id="8402149">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8402155">0644</span><span class="op" id="8402159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402166">Uid</span><span class="op" id="8402169">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8402176">0765</span><span class="op" id="8402180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402187">Gid</span><span class="op" id="8402190">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8402197">024</span><span class="op" id="8402200">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402207">Size</span><span class="op" id="8402211">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8402217">06</span><span class="op" id="8402219">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402226">ModTime</span><span class="op" id="8402233">:</span>&nbsp;&nbsp;<span class="ident" id="8402236">time</span><span class="op" id="8402240">.</span><span class="ident" id="8402241">Unix</span><span class="op" id="8402245">(</span><span class="num" id="8402246">1360135598</span><span class="op" id="8402256">,</span>&nbsp;<span class="num" id="8402258">0</span><span class="op" id="8402259">)</span><span class="op" id="8402260">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402267">Typeflag</span><span class="op" id="8402275">:</span>&nbsp;<span class="string" id="8402277">&#39;0&#39;</span><span class="op" id="8402280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402287">Uname</span><span class="op" id="8402292">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402297">&#34;shane&#34;</span><span class="op" id="8402304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402311">Gname</span><span class="op" id="8402316">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8402321">&#34;staff&#34;</span><span class="op" id="8402328">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402334">}</span><span class="op" id="8402335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402341">contents</span><span class="op" id="8402349">:</span>&nbsp;<span class="string" id="8402351">&#34;hello\n&#34;</span><span class="op" id="8402360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402365">}</span><span class="op" id="8402366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402370">}</span><span class="op" id="8402371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402374">}</span><span class="op" id="8402375">,</span><br>
<span class="lineno">150</span><span class="op" id="8402377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8402380">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="8402475">func</span>&nbsp;<span class="ident" id="8402480">bytestr</span><span class="op" id="8402487">(</span><span class="ident" id="8402488">offset</span>&nbsp;<span class="builtintype" id="8402495">int</span><span class="op" id="8402498">,</span>&nbsp;<span class="ident" id="8402500">b</span>&nbsp;<span class="op" id="8402502">[</span><span class="op" id="8402503">]</span><span class="builtintype" id="8402504">byte</span><span class="op" id="8402508">)</span>&nbsp;<span class="builtintype" id="8402510">string</span>&nbsp;<span class="op" id="8402517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402520">const</span>&nbsp;<span class="ident" id="8402526">rowLen</span>&nbsp;<span class="op" id="8402533">=</span>&nbsp;<span class="num" id="8402535">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402539">s</span>&nbsp;<span class="op" id="8402541">:=</span>&nbsp;<span class="ident" id="8402544">fmt</span><span class="op" id="8402547">.</span><span class="ident" id="8402548">Sprintf</span><span class="op" id="8402555">(</span><span class="string" id="8402556">&#34;%04x&nbsp;&#34;</span><span class="op" id="8402563">,</span>&nbsp;<span class="ident" id="8402565">offset</span><span class="op" id="8402571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402574">for</span>&nbsp;<span class="ident" id="8402578">_</span><span class="op" id="8402579">,</span>&nbsp;<span class="ident" id="8402581">ch</span>&nbsp;<span class="op" id="8402584">:=</span>&nbsp;<span class="keyword" id="8402587">range</span>&nbsp;<span class="ident" id="8402593">b</span>&nbsp;<span class="op" id="8402595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402599">switch</span>&nbsp;<span class="op" id="8402606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402610">case</span>&nbsp;<span class="string" id="8402615">&#39;0&#39;</span>&nbsp;<span class="op" id="8402619">&lt;=</span>&nbsp;<span class="ident" id="8402622">ch</span>&nbsp;<span class="op" id="8402625">&amp;&amp;</span>&nbsp;<span class="ident" id="8402628">ch</span>&nbsp;<span class="op" id="8402631">&lt;=</span>&nbsp;<span class="string" id="8402634">&#39;9&#39;</span><span class="op" id="8402637">,</span>&nbsp;<span class="string" id="8402639">&#39;A&#39;</span>&nbsp;<span class="op" id="8402643">&lt;=</span>&nbsp;<span class="ident" id="8402646">ch</span>&nbsp;<span class="op" id="8402649">&amp;&amp;</span>&nbsp;<span class="ident" id="8402652">ch</span>&nbsp;<span class="op" id="8402655">&lt;=</span>&nbsp;<span class="string" id="8402658">&#39;Z&#39;</span><span class="op" id="8402661">,</span>&nbsp;<span class="string" id="8402663">&#39;a&#39;</span>&nbsp;<span class="op" id="8402667">&lt;=</span>&nbsp;<span class="ident" id="8402670">ch</span>&nbsp;<span class="op" id="8402673">&amp;&amp;</span>&nbsp;<span class="ident" id="8402676">ch</span>&nbsp;<span class="op" id="8402679">&lt;=</span>&nbsp;<span class="string" id="8402682">&#39;z&#39;</span><span class="op" id="8402685">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402690">s</span>&nbsp;<span class="op" id="8402692">+=</span>&nbsp;<span class="ident" id="8402695">fmt</span><span class="op" id="8402698">.</span><span class="ident" id="8402699">Sprintf</span><span class="op" id="8402706">(</span><span class="string" id="8402707">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="8402713">,</span>&nbsp;<span class="ident" id="8402715">ch</span><span class="op" id="8402717">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402721">default</span><span class="op" id="8402728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402733">s</span>&nbsp;<span class="op" id="8402735">+=</span>&nbsp;<span class="ident" id="8402738">fmt</span><span class="op" id="8402741">.</span><span class="ident" id="8402742">Sprintf</span><span class="op" id="8402749">(</span><span class="string" id="8402750">&#34;&nbsp;%02x&#34;</span><span class="op" id="8402757">,</span>&nbsp;<span class="ident" id="8402759">ch</span><span class="op" id="8402761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8402768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402771">return</span>&nbsp;<span class="ident" id="8402778">s</span><br>
<span class="lineno">165</span><span class="op" id="8402780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8402783">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="8402836">func</span>&nbsp;<span class="ident" id="8402841">bytediff</span><span class="op" id="8402849">(</span><span class="ident" id="8402850">a</span>&nbsp;<span class="op" id="8402852">[</span><span class="op" id="8402853">]</span><span class="builtintype" id="8402854">byte</span><span class="op" id="8402858">,</span>&nbsp;<span class="ident" id="8402860">b</span>&nbsp;<span class="op" id="8402862">[</span><span class="op" id="8402863">]</span><span class="builtintype" id="8402864">byte</span><span class="op" id="8402868">)</span>&nbsp;<span class="builtintype" id="8402870">string</span>&nbsp;<span class="op" id="8402877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402880">const</span>&nbsp;<span class="ident" id="8402886">rowLen</span>&nbsp;<span class="op" id="8402893">=</span>&nbsp;<span class="num" id="8402895">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8402899">s</span>&nbsp;<span class="op" id="8402901">:=</span>&nbsp;<span class="ident" id="8402904">fmt</span><span class="op" id="8402907">.</span><span class="ident" id="8402908">Sprintf</span><span class="op" id="8402915">(</span><span class="string" id="8402916">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="8402943">,</span>&nbsp;<span class="builtinfunc" id="8402945">len</span><span class="op" id="8402948">(</span><span class="ident" id="8402949">a</span><span class="op" id="8402950">)</span><span class="op" id="8402951">,</span>&nbsp;<span class="builtinfunc" id="8402953">len</span><span class="op" id="8402956">(</span><span class="ident" id="8402957">b</span><span class="op" id="8402958">)</span><span class="op" id="8402959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8402962">for</span>&nbsp;<span class="ident" id="8402966">offset</span>&nbsp;<span class="op" id="8402973">:=</span>&nbsp;<span class="num" id="8402976">0</span><span class="op" id="8402977">;</span>&nbsp;<span class="builtinfunc" id="8402979">len</span><span class="op" id="8402982">(</span><span class="ident" id="8402983">a</span><span class="op" id="8402984">)</span><span class="op" id="8402985">+</span><span class="builtinfunc" id="8402986">len</span><span class="op" id="8402989">(</span><span class="ident" id="8402990">b</span><span class="op" id="8402991">)</span>&nbsp;<span class="op" id="8402993">&gt;</span>&nbsp;<span class="num" id="8402995">0</span><span class="op" id="8402996">;</span>&nbsp;<span class="ident" id="8402998">offset</span>&nbsp;<span class="op" id="8403005">+=</span>&nbsp;<span class="ident" id="8403008">rowLen</span>&nbsp;<span class="op" id="8403015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403019">na</span><span class="op" id="8403021">,</span>&nbsp;<span class="ident" id="8403023">nb</span>&nbsp;<span class="op" id="8403026">:=</span>&nbsp;<span class="ident" id="8403029">rowLen</span><span class="op" id="8403035">,</span>&nbsp;<span class="ident" id="8403037">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403046">if</span>&nbsp;<span class="ident" id="8403049">na</span>&nbsp;<span class="op" id="8403052">&gt;</span>&nbsp;<span class="builtinfunc" id="8403054">len</span><span class="op" id="8403057">(</span><span class="ident" id="8403058">a</span><span class="op" id="8403059">)</span>&nbsp;<span class="op" id="8403061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403066">na</span>&nbsp;<span class="op" id="8403069">=</span>&nbsp;<span class="builtinfunc" id="8403071">len</span><span class="op" id="8403074">(</span><span class="ident" id="8403075">a</span><span class="op" id="8403076">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8403080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403084">if</span>&nbsp;<span class="ident" id="8403087">nb</span>&nbsp;<span class="op" id="8403090">&gt;</span>&nbsp;<span class="builtinfunc" id="8403092">len</span><span class="op" id="8403095">(</span><span class="ident" id="8403096">b</span><span class="op" id="8403097">)</span>&nbsp;<span class="op" id="8403099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403104">nb</span>&nbsp;<span class="op" id="8403107">=</span>&nbsp;<span class="builtinfunc" id="8403109">len</span><span class="op" id="8403112">(</span><span class="ident" id="8403113">b</span><span class="op" id="8403114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8403118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403122">sa</span>&nbsp;<span class="op" id="8403125">:=</span>&nbsp;<span class="ident" id="8403128">bytestr</span><span class="op" id="8403135">(</span><span class="ident" id="8403136">offset</span><span class="op" id="8403142">,</span>&nbsp;<span class="ident" id="8403144">a</span><span class="op" id="8403145">[</span><span class="num" id="8403146">0</span><span class="op" id="8403147">:</span><span class="ident" id="8403148">na</span><span class="op" id="8403150">]</span><span class="op" id="8403151">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403155">sb</span>&nbsp;<span class="op" id="8403158">:=</span>&nbsp;<span class="ident" id="8403161">bytestr</span><span class="op" id="8403168">(</span><span class="ident" id="8403169">offset</span><span class="op" id="8403175">,</span>&nbsp;<span class="ident" id="8403177">b</span><span class="op" id="8403178">[</span><span class="num" id="8403179">0</span><span class="op" id="8403180">:</span><span class="ident" id="8403181">nb</span><span class="op" id="8403183">]</span><span class="op" id="8403184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403188">if</span>&nbsp;<span class="ident" id="8403191">sa</span>&nbsp;<span class="op" id="8403194">!=</span>&nbsp;<span class="ident" id="8403197">sb</span>&nbsp;<span class="op" id="8403200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403205">s</span>&nbsp;<span class="op" id="8403207">+=</span>&nbsp;<span class="ident" id="8403210">fmt</span><span class="op" id="8403213">.</span><span class="ident" id="8403214">Sprintf</span><span class="op" id="8403221">(</span><span class="string" id="8403222">&#34;-%v\n+%v\n&#34;</span><span class="op" id="8403234">,</span>&nbsp;<span class="ident" id="8403236">sa</span><span class="op" id="8403238">,</span>&nbsp;<span class="ident" id="8403240">sb</span><span class="op" id="8403242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8403246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403250">a</span>&nbsp;<span class="op" id="8403252">=</span>&nbsp;<span class="ident" id="8403254">a</span><span class="op" id="8403255">[</span><span class="ident" id="8403256">na</span><span class="op" id="8403258">:</span><span class="op" id="8403259">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403263">b</span>&nbsp;<span class="op" id="8403265">=</span>&nbsp;<span class="ident" id="8403267">b</span><span class="op" id="8403268">[</span><span class="ident" id="8403269">nb</span><span class="op" id="8403271">:</span><span class="op" id="8403272">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8403275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403278">return</span>&nbsp;<span class="ident" id="8403285">s</span><br>
<span class="lineno"></span><span class="op" id="8403287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8403290">func</span>&nbsp;<span class="ident" id="8403295">TestWriter</span><span class="op" id="8403305">(</span><span class="ident" id="8403306">t</span>&nbsp;<span class="op" id="8403308">*</span><span class="ident" id="8403309">testing</span><span class="op" id="8403316">.</span><span class="ident" id="8403317">T</span><span class="op" id="8403318">)</span>&nbsp;<span class="op" id="8403320">{</span><br>
<span class="lineno"></span><span class="ident" id="8403322">testLoop</span><span class="op" id="8403330">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403333">for</span>&nbsp;<span class="ident" id="8403337">i</span><span class="op" id="8403338">,</span>&nbsp;<span class="ident" id="8403340">test</span>&nbsp;<span class="op" id="8403345">:=</span>&nbsp;<span class="keyword" id="8403348">range</span>&nbsp;<span class="ident" id="8403354">writerTests</span>&nbsp;<span class="op" id="8403366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403370">expected</span><span class="op" id="8403378">,</span>&nbsp;<span class="ident" id="8403380">err</span>&nbsp;<span class="op" id="8403384">:=</span>&nbsp;<span class="ident" id="8403387">ioutil</span><span class="op" id="8403393">.</span><span class="ident" id="8403394">ReadFile</span><span class="op" id="8403402">(</span><span class="ident" id="8403403">test</span><span class="op" id="8403407">.</span><span class="ident" id="8403408">file</span><span class="op" id="8403412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403416">if</span>&nbsp;<span class="ident" id="8403419">err</span>&nbsp;<span class="op" id="8403423">!=</span>&nbsp;<span class="ident" id="8403426">nil</span>&nbsp;<span class="op" id="8403430">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403435">t</span><span class="op" id="8403436">.</span><span class="ident" id="8403437">Errorf</span><span class="op" id="8403443">(</span><span class="string" id="8403444">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="8403475">,</span>&nbsp;<span class="ident" id="8403477">i</span><span class="op" id="8403478">,</span>&nbsp;<span class="ident" id="8403480">err</span><span class="op" id="8403483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403488">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8403499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403504">buf</span>&nbsp;<span class="op" id="8403508">:=</span>&nbsp;<span class="builtinfunc" id="8403511">new</span><span class="op" id="8403514">(</span><span class="ident" id="8403515">bytes</span><span class="op" id="8403520">.</span><span class="ident" id="8403521">Buffer</span><span class="op" id="8403527">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403531">tw</span>&nbsp;<span class="op" id="8403534">:=</span>&nbsp;<span class="ident" id="8403537">NewWriter</span><span class="op" id="8403546">(</span><span class="ident" id="8403547">iotest</span><span class="op" id="8403553">.</span><span class="ident" id="8403554">TruncateWriter</span><span class="op" id="8403568">(</span><span class="ident" id="8403569">buf</span><span class="op" id="8403572">,</span>&nbsp;<span class="num" id="8403574">4</span><span class="op" id="8403575">&lt;&lt;</span><span class="num" id="8403577">10</span><span class="op" id="8403579">)</span><span class="op" id="8403580">)</span>&nbsp;<span class="comment" id="8403582">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403613">big</span>&nbsp;<span class="op" id="8403617">:=</span>&nbsp;<span class="builtintype" id="8403620">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403628">for</span>&nbsp;<span class="ident" id="8403632">j</span><span class="op" id="8403633">,</span>&nbsp;<span class="ident" id="8403635">entry</span>&nbsp;<span class="op" id="8403641">:=</span>&nbsp;<span class="keyword" id="8403644">range</span>&nbsp;<span class="ident" id="8403650">test</span><span class="op" id="8403654">.</span><span class="ident" id="8403655">entries</span>&nbsp;<span class="op" id="8403663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403668">big</span>&nbsp;<span class="op" id="8403672">=</span>&nbsp;<span class="ident" id="8403674">big</span>&nbsp;<span class="op" id="8403678">||</span>&nbsp;<span class="ident" id="8403681">entry</span><span class="op" id="8403686">.</span><span class="ident" id="8403687">header</span><span class="op" id="8403693">.</span><span class="ident" id="8403694">Size</span>&nbsp;<span class="op" id="8403699">&gt;</span>&nbsp;<span class="num" id="8403701">1</span><span class="op" id="8403702">&lt;&lt;</span><span class="num" id="8403704">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403710">if</span>&nbsp;<span class="ident" id="8403713">err</span>&nbsp;<span class="op" id="8403717">:=</span>&nbsp;<span class="ident" id="8403720">tw</span><span class="op" id="8403722">.</span><span class="ident" id="8403723">WriteHeader</span><span class="op" id="8403734">(</span><span class="ident" id="8403735">entry</span><span class="op" id="8403740">.</span><span class="ident" id="8403741">header</span><span class="op" id="8403747">)</span><span class="op" id="8403748">;</span>&nbsp;<span class="ident" id="8403750">err</span>&nbsp;<span class="op" id="8403754">!=</span>&nbsp;<span class="ident" id="8403757">nil</span>&nbsp;<span class="op" id="8403761">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403767">t</span><span class="op" id="8403768">.</span><span class="ident" id="8403769">Errorf</span><span class="op" id="8403775">(</span><span class="string" id="8403776">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="8403822">,</span>&nbsp;<span class="ident" id="8403824">i</span><span class="op" id="8403825">,</span>&nbsp;<span class="ident" id="8403827">j</span><span class="op" id="8403828">,</span>&nbsp;<span class="ident" id="8403830">err</span><span class="op" id="8403833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403839">continue</span>&nbsp;<span class="ident" id="8403848">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8403860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8403865">if</span>&nbsp;<span class="ident" id="8403868">_</span><span class="op" id="8403869">,</span>&nbsp;<span class="ident" id="8403871">err</span>&nbsp;<span class="op" id="8403875">:=</span>&nbsp;<span class="ident" id="8403878">io</span><span class="op" id="8403880">.</span><span class="ident" id="8403881">WriteString</span><span class="op" id="8403892">(</span><span class="ident" id="8403893">tw</span><span class="op" id="8403895">,</span>&nbsp;<span class="ident" id="8403897">entry</span><span class="op" id="8403902">.</span><span class="ident" id="8403903">contents</span><span class="op" id="8403911">)</span><span class="op" id="8403912">;</span>&nbsp;<span class="ident" id="8403914">err</span>&nbsp;<span class="op" id="8403918">!=</span>&nbsp;<span class="ident" id="8403921">nil</span>&nbsp;<span class="op" id="8403925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8403931">t</span><span class="op" id="8403932">.</span><span class="ident" id="8403933">Errorf</span><span class="op" id="8403939">(</span><span class="string" id="8403940">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="8403988">,</span>&nbsp;<span class="ident" id="8403990">i</span><span class="op" id="8403991">,</span>&nbsp;<span class="ident" id="8403993">j</span><span class="op" id="8403994">,</span>&nbsp;<span class="ident" id="8403996">err</span><span class="op" id="8403999">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404005">continue</span>&nbsp;<span class="ident" id="8404014">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8404034">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404094">if</span>&nbsp;<span class="ident" id="8404097">err</span>&nbsp;<span class="op" id="8404101">:=</span>&nbsp;<span class="ident" id="8404104">tw</span><span class="op" id="8404106">.</span><span class="ident" id="8404107">Close</span><span class="op" id="8404112">(</span><span class="op" id="8404113">)</span><span class="op" id="8404114">;</span>&nbsp;<span class="ident" id="8404116">err</span>&nbsp;<span class="op" id="8404120">!=</span>&nbsp;<span class="ident" id="8404123">nil</span>&nbsp;<span class="op" id="8404127">&amp;&amp;</span>&nbsp;<span class="op" id="8404130">!</span><span class="ident" id="8404131">big</span>&nbsp;<span class="op" id="8404135">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404140">t</span><span class="op" id="8404141">.</span><span class="ident" id="8404142">Errorf</span><span class="op" id="8404148">(</span><span class="string" id="8404149">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="8404186">,</span>&nbsp;<span class="ident" id="8404188">i</span><span class="op" id="8404189">,</span>&nbsp;<span class="ident" id="8404191">err</span><span class="op" id="8404194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404199">continue</span>&nbsp;<span class="ident" id="8404208">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404224">actual</span>&nbsp;<span class="op" id="8404231">:=</span>&nbsp;<span class="ident" id="8404234">buf</span><span class="op" id="8404237">.</span><span class="ident" id="8404238">Bytes</span><span class="op" id="8404243">(</span><span class="op" id="8404244">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404248">if</span>&nbsp;<span class="op" id="8404251">!</span><span class="ident" id="8404252">bytes</span><span class="op" id="8404257">.</span><span class="ident" id="8404258">Equal</span><span class="op" id="8404263">(</span><span class="ident" id="8404264">expected</span><span class="op" id="8404272">,</span>&nbsp;<span class="ident" id="8404274">actual</span><span class="op" id="8404280">)</span>&nbsp;<span class="op" id="8404282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404287">t</span><span class="op" id="8404288">.</span><span class="ident" id="8404289">Errorf</span><span class="op" id="8404295">(</span><span class="string" id="8404296">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="8404351">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404357">i</span><span class="op" id="8404358">,</span>&nbsp;<span class="ident" id="8404360">bytediff</span><span class="op" id="8404368">(</span><span class="ident" id="8404369">expected</span><span class="op" id="8404377">,</span>&nbsp;<span class="ident" id="8404379">actual</span><span class="op" id="8404385">)</span><span class="op" id="8404386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404394">if</span>&nbsp;<span class="ident" id="8404397">testing</span><span class="op" id="8404404">.</span><span class="ident" id="8404405">Short</span><span class="op" id="8404410">(</span><span class="op" id="8404411">)</span>&nbsp;<span class="op" id="8404413">{</span>&nbsp;<span class="comment" id="8404415">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404451">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404462">}</span><br>
<span class="lineno"></span><span class="op" id="8404464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="8404467">func</span>&nbsp;<span class="ident" id="8404472">TestPax</span><span class="op" id="8404479">(</span><span class="ident" id="8404480">t</span>&nbsp;<span class="op" id="8404482">*</span><span class="ident" id="8404483">testing</span><span class="op" id="8404490">.</span><span class="ident" id="8404491">T</span><span class="op" id="8404492">)</span>&nbsp;<span class="op" id="8404494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8404497">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404537">fileinfo</span><span class="op" id="8404545">,</span>&nbsp;<span class="ident" id="8404547">err</span>&nbsp;<span class="op" id="8404551">:=</span>&nbsp;<span class="ident" id="8404554">os</span><span class="op" id="8404556">.</span><span class="ident" id="8404557">Stat</span><span class="op" id="8404561">(</span><span class="string" id="8404562">&#34;testdata/small.txt&#34;</span><span class="op" id="8404582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404585">if</span>&nbsp;<span class="ident" id="8404588">err</span>&nbsp;<span class="op" id="8404592">!=</span>&nbsp;<span class="ident" id="8404595">nil</span>&nbsp;<span class="op" id="8404599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404603">t</span><span class="op" id="8404604">.</span><span class="ident" id="8404605">Fatal</span><span class="op" id="8404610">(</span><span class="ident" id="8404611">err</span><span class="op" id="8404614">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404620">hdr</span><span class="op" id="8404623">,</span>&nbsp;<span class="ident" id="8404625">err</span>&nbsp;<span class="op" id="8404629">:=</span>&nbsp;<span class="ident" id="8404632">FileInfoHeader</span><span class="op" id="8404646">(</span><span class="ident" id="8404647">fileinfo</span><span class="op" id="8404655">,</span>&nbsp;<span class="string" id="8404657">&#34;&#34;</span><span class="op" id="8404659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404662">if</span>&nbsp;<span class="ident" id="8404665">err</span>&nbsp;<span class="op" id="8404669">!=</span>&nbsp;<span class="ident" id="8404672">nil</span>&nbsp;<span class="op" id="8404676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404680">t</span><span class="op" id="8404681">.</span><span class="ident" id="8404682">Fatalf</span><span class="op" id="8404688">(</span><span class="string" id="8404689">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="8404702">,</span>&nbsp;<span class="ident" id="8404704">err</span><span class="op" id="8404707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404710">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8404713">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404753">longName</span>&nbsp;<span class="op" id="8404762">:=</span>&nbsp;<span class="ident" id="8404765">strings</span><span class="op" id="8404772">.</span><span class="ident" id="8404773">Repeat</span><span class="op" id="8404779">(</span><span class="string" id="8404780">&#34;ab&#34;</span><span class="op" id="8404784">,</span>&nbsp;<span class="num" id="8404786">100</span><span class="op" id="8404789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404792">contents</span>&nbsp;<span class="op" id="8404801">:=</span>&nbsp;<span class="ident" id="8404804">strings</span><span class="op" id="8404811">.</span><span class="ident" id="8404812">Repeat</span><span class="op" id="8404818">(</span><span class="string" id="8404819">&#34;&nbsp;&#34;</span><span class="op" id="8404822">,</span>&nbsp;<span class="builtintype" id="8404824">int</span><span class="op" id="8404827">(</span><span class="ident" id="8404828">hdr</span><span class="op" id="8404831">.</span><span class="ident" id="8404832">Size</span><span class="op" id="8404836">)</span><span class="op" id="8404837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404840">hdr</span><span class="op" id="8404843">.</span><span class="ident" id="8404844">Name</span>&nbsp;<span class="op" id="8404849">=</span>&nbsp;<span class="ident" id="8404851">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404861">var</span>&nbsp;<span class="ident" id="8404865">buf</span>&nbsp;<span class="ident" id="8404869">bytes</span><span class="op" id="8404874">.</span><span class="ident" id="8404875">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404883">writer</span>&nbsp;<span class="op" id="8404890">:=</span>&nbsp;<span class="ident" id="8404893">NewWriter</span><span class="op" id="8404902">(</span><span class="op" id="8404903">&amp;</span><span class="ident" id="8404904">buf</span><span class="op" id="8404907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404910">if</span>&nbsp;<span class="ident" id="8404913">err</span>&nbsp;<span class="op" id="8404917">:=</span>&nbsp;<span class="ident" id="8404920">writer</span><span class="op" id="8404926">.</span><span class="ident" id="8404927">WriteHeader</span><span class="op" id="8404938">(</span><span class="ident" id="8404939">hdr</span><span class="op" id="8404942">)</span><span class="op" id="8404943">;</span>&nbsp;<span class="ident" id="8404945">err</span>&nbsp;<span class="op" id="8404949">!=</span>&nbsp;<span class="ident" id="8404952">nil</span>&nbsp;<span class="op" id="8404956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404960">t</span><span class="op" id="8404961">.</span><span class="ident" id="8404962">Fatal</span><span class="op" id="8404967">(</span><span class="ident" id="8404968">err</span><span class="op" id="8404971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404977">if</span>&nbsp;<span class="ident" id="8404980">_</span><span class="op" id="8404981">,</span>&nbsp;<span class="ident" id="8404983">err</span>&nbsp;<span class="op" id="8404987">=</span>&nbsp;<span class="ident" id="8404989">writer</span><span class="op" id="8404995">.</span><span class="ident" id="8404996">Write</span><span class="op" id="8405001">(</span><span class="op" id="8405002">[</span><span class="op" id="8405003">]</span><span class="builtintype" id="8405004">byte</span><span class="op" id="8405008">(</span><span class="ident" id="8405009">contents</span><span class="op" id="8405017">)</span><span class="op" id="8405018">)</span><span class="op" id="8405019">;</span>&nbsp;<span class="ident" id="8405021">err</span>&nbsp;<span class="op" id="8405025">!=</span>&nbsp;<span class="ident" id="8405028">nil</span>&nbsp;<span class="op" id="8405032">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405036">t</span><span class="op" id="8405037">.</span><span class="ident" id="8405038">Fatal</span><span class="op" id="8405043">(</span><span class="ident" id="8405044">err</span><span class="op" id="8405047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405053">if</span>&nbsp;<span class="ident" id="8405056">err</span>&nbsp;<span class="op" id="8405060">:=</span>&nbsp;<span class="ident" id="8405063">writer</span><span class="op" id="8405069">.</span><span class="ident" id="8405070">Close</span><span class="op" id="8405075">(</span><span class="op" id="8405076">)</span><span class="op" id="8405077">;</span>&nbsp;<span class="ident" id="8405079">err</span>&nbsp;<span class="op" id="8405083">!=</span>&nbsp;<span class="ident" id="8405086">nil</span>&nbsp;<span class="op" id="8405090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405094">t</span><span class="op" id="8405095">.</span><span class="ident" id="8405096">Fatal</span><span class="op" id="8405101">(</span><span class="ident" id="8405102">err</span><span class="op" id="8405105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405108">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405111">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405169">if</span>&nbsp;<span class="op" id="8405172">!</span><span class="ident" id="8405173">bytes</span><span class="op" id="8405178">.</span><span class="ident" id="8405179">Contains</span><span class="op" id="8405187">(</span><span class="ident" id="8405188">buf</span><span class="op" id="8405191">.</span><span class="ident" id="8405192">Bytes</span><span class="op" id="8405197">(</span><span class="op" id="8405198">)</span><span class="op" id="8405199">,</span>&nbsp;<span class="op" id="8405201">[</span><span class="op" id="8405202">]</span><span class="builtintype" id="8405203">byte</span><span class="op" id="8405207">(</span><span class="string" id="8405208">&#34;PaxHeaders.&#34;</span><span class="op" id="8405221">)</span><span class="op" id="8405222">)</span>&nbsp;<span class="op" id="8405224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405228">t</span><span class="op" id="8405229">.</span><span class="ident" id="8405230">Fatal</span><span class="op" id="8405235">(</span><span class="string" id="8405236">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="8405285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405291">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405353">reader</span>&nbsp;<span class="op" id="8405360">:=</span>&nbsp;<span class="ident" id="8405363">NewReader</span><span class="op" id="8405372">(</span><span class="op" id="8405373">&amp;</span><span class="ident" id="8405374">buf</span><span class="op" id="8405377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405380">hdr</span><span class="op" id="8405383">,</span>&nbsp;<span class="ident" id="8405385">err</span>&nbsp;<span class="op" id="8405389">=</span>&nbsp;<span class="ident" id="8405391">reader</span><span class="op" id="8405397">.</span><span class="ident" id="8405398">Next</span><span class="op" id="8405402">(</span><span class="op" id="8405403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405406">if</span>&nbsp;<span class="ident" id="8405409">err</span>&nbsp;<span class="op" id="8405413">!=</span>&nbsp;<span class="ident" id="8405416">nil</span>&nbsp;<span class="op" id="8405420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405424">t</span><span class="op" id="8405425">.</span><span class="ident" id="8405426">Fatal</span><span class="op" id="8405431">(</span><span class="ident" id="8405432">err</span><span class="op" id="8405435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405438">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405441">if</span>&nbsp;<span class="ident" id="8405444">hdr</span><span class="op" id="8405447">.</span><span class="ident" id="8405448">Name</span>&nbsp;<span class="op" id="8405453">!=</span>&nbsp;<span class="ident" id="8405456">longName</span>&nbsp;<span class="op" id="8405465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405469">t</span><span class="op" id="8405470">.</span><span class="ident" id="8405471">Fatal</span><span class="op" id="8405476">(</span><span class="string" id="8405477">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="8405510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405513">}</span><br>
<span class="lineno"></span><span class="op" id="8405515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="8405518">func</span>&nbsp;<span class="ident" id="8405523">TestPaxSymlink</span><span class="op" id="8405537">(</span><span class="ident" id="8405538">t</span>&nbsp;<span class="op" id="8405540">*</span><span class="ident" id="8405541">testing</span><span class="op" id="8405548">.</span><span class="ident" id="8405549">T</span><span class="op" id="8405550">)</span>&nbsp;<span class="op" id="8405552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405555">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405599">fileinfo</span><span class="op" id="8405607">,</span>&nbsp;<span class="ident" id="8405609">err</span>&nbsp;<span class="op" id="8405613">:=</span>&nbsp;<span class="ident" id="8405616">os</span><span class="op" id="8405618">.</span><span class="ident" id="8405619">Stat</span><span class="op" id="8405623">(</span><span class="string" id="8405624">&#34;testdata/small.txt&#34;</span><span class="op" id="8405644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405647">if</span>&nbsp;<span class="ident" id="8405650">err</span>&nbsp;<span class="op" id="8405654">!=</span>&nbsp;<span class="ident" id="8405657">nil</span>&nbsp;<span class="op" id="8405661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405665">t</span><span class="op" id="8405666">.</span><span class="ident" id="8405667">Fatal</span><span class="op" id="8405672">(</span><span class="ident" id="8405673">err</span><span class="op" id="8405676">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405682">hdr</span><span class="op" id="8405685">,</span>&nbsp;<span class="ident" id="8405687">err</span>&nbsp;<span class="op" id="8405691">:=</span>&nbsp;<span class="ident" id="8405694">FileInfoHeader</span><span class="op" id="8405708">(</span><span class="ident" id="8405709">fileinfo</span><span class="op" id="8405717">,</span>&nbsp;<span class="string" id="8405719">&#34;&#34;</span><span class="op" id="8405721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405724">hdr</span><span class="op" id="8405727">.</span><span class="ident" id="8405728">Typeflag</span>&nbsp;<span class="op" id="8405737">=</span>&nbsp;<span class="ident" id="8405739">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405752">if</span>&nbsp;<span class="ident" id="8405755">err</span>&nbsp;<span class="op" id="8405759">!=</span>&nbsp;<span class="ident" id="8405762">nil</span>&nbsp;<span class="op" id="8405766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405770">t</span><span class="op" id="8405771">.</span><span class="ident" id="8405772">Fatalf</span><span class="op" id="8405778">(</span><span class="string" id="8405779">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="8405793">,</span>&nbsp;<span class="ident" id="8405795">err</span><span class="op" id="8405798">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405804">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405848">longLinkname</span>&nbsp;<span class="op" id="8405861">:=</span>&nbsp;<span class="ident" id="8405864">strings</span><span class="op" id="8405871">.</span><span class="ident" id="8405872">Repeat</span><span class="op" id="8405878">(</span><span class="string" id="8405879">&#34;1234567890/1234567890&#34;</span><span class="op" id="8405902">,</span>&nbsp;<span class="num" id="8405904">10</span><span class="op" id="8405906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405909">hdr</span><span class="op" id="8405912">.</span><span class="ident" id="8405913">Linkname</span>&nbsp;<span class="op" id="8405922">=</span>&nbsp;<span class="ident" id="8405924">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405939">hdr</span><span class="op" id="8405942">.</span><span class="ident" id="8405943">Size</span>&nbsp;<span class="op" id="8405948">=</span>&nbsp;<span class="num" id="8405950">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405953">var</span>&nbsp;<span class="ident" id="8405957">buf</span>&nbsp;<span class="ident" id="8405961">bytes</span><span class="op" id="8405966">.</span><span class="ident" id="8405967">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405975">writer</span>&nbsp;<span class="op" id="8405982">:=</span>&nbsp;<span class="ident" id="8405985">NewWriter</span><span class="op" id="8405994">(</span><span class="op" id="8405995">&amp;</span><span class="ident" id="8405996">buf</span><span class="op" id="8405999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406002">if</span>&nbsp;<span class="ident" id="8406005">err</span>&nbsp;<span class="op" id="8406009">:=</span>&nbsp;<span class="ident" id="8406012">writer</span><span class="op" id="8406018">.</span><span class="ident" id="8406019">WriteHeader</span><span class="op" id="8406030">(</span><span class="ident" id="8406031">hdr</span><span class="op" id="8406034">)</span><span class="op" id="8406035">;</span>&nbsp;<span class="ident" id="8406037">err</span>&nbsp;<span class="op" id="8406041">!=</span>&nbsp;<span class="ident" id="8406044">nil</span>&nbsp;<span class="op" id="8406048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406052">t</span><span class="op" id="8406053">.</span><span class="ident" id="8406054">Fatal</span><span class="op" id="8406059">(</span><span class="ident" id="8406060">err</span><span class="op" id="8406063">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406069">if</span>&nbsp;<span class="ident" id="8406072">err</span>&nbsp;<span class="op" id="8406076">:=</span>&nbsp;<span class="ident" id="8406079">writer</span><span class="op" id="8406085">.</span><span class="ident" id="8406086">Close</span><span class="op" id="8406091">(</span><span class="op" id="8406092">)</span><span class="op" id="8406093">;</span>&nbsp;<span class="ident" id="8406095">err</span>&nbsp;<span class="op" id="8406099">!=</span>&nbsp;<span class="ident" id="8406102">nil</span>&nbsp;<span class="op" id="8406106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406110">t</span><span class="op" id="8406111">.</span><span class="ident" id="8406112">Fatal</span><span class="op" id="8406117">(</span><span class="ident" id="8406118">err</span><span class="op" id="8406121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406127">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406185">if</span>&nbsp;<span class="op" id="8406188">!</span><span class="ident" id="8406189">bytes</span><span class="op" id="8406194">.</span><span class="ident" id="8406195">Contains</span><span class="op" id="8406203">(</span><span class="ident" id="8406204">buf</span><span class="op" id="8406207">.</span><span class="ident" id="8406208">Bytes</span><span class="op" id="8406213">(</span><span class="op" id="8406214">)</span><span class="op" id="8406215">,</span>&nbsp;<span class="op" id="8406217">[</span><span class="op" id="8406218">]</span><span class="builtintype" id="8406219">byte</span><span class="op" id="8406223">(</span><span class="string" id="8406224">&#34;PaxHeaders.&#34;</span><span class="op" id="8406237">)</span><span class="op" id="8406238">)</span>&nbsp;<span class="op" id="8406240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406244">t</span><span class="op" id="8406245">.</span><span class="ident" id="8406246">Fatal</span><span class="op" id="8406251">(</span><span class="string" id="8406252">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="8406301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406307">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406369">reader</span>&nbsp;<span class="op" id="8406376">:=</span>&nbsp;<span class="ident" id="8406379">NewReader</span><span class="op" id="8406388">(</span><span class="op" id="8406389">&amp;</span><span class="ident" id="8406390">buf</span><span class="op" id="8406393">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406396">hdr</span><span class="op" id="8406399">,</span>&nbsp;<span class="ident" id="8406401">err</span>&nbsp;<span class="op" id="8406405">=</span>&nbsp;<span class="ident" id="8406407">reader</span><span class="op" id="8406413">.</span><span class="ident" id="8406414">Next</span><span class="op" id="8406418">(</span><span class="op" id="8406419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406422">if</span>&nbsp;<span class="ident" id="8406425">err</span>&nbsp;<span class="op" id="8406429">!=</span>&nbsp;<span class="ident" id="8406432">nil</span>&nbsp;<span class="op" id="8406436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406440">t</span><span class="op" id="8406441">.</span><span class="ident" id="8406442">Fatal</span><span class="op" id="8406447">(</span><span class="ident" id="8406448">err</span><span class="op" id="8406451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406457">if</span>&nbsp;<span class="ident" id="8406460">hdr</span><span class="op" id="8406463">.</span><span class="ident" id="8406464">Linkname</span>&nbsp;<span class="op" id="8406473">!=</span>&nbsp;<span class="ident" id="8406476">longLinkname</span>&nbsp;<span class="op" id="8406489">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406493">t</span><span class="op" id="8406494">.</span><span class="ident" id="8406495">Fatal</span><span class="op" id="8406500">(</span><span class="string" id="8406501">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="8406534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406537">}</span><br>
<span class="lineno"></span><span class="op" id="8406539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8406542">func</span>&nbsp;<span class="ident" id="8406547">TestPaxNonAscii</span><span class="op" id="8406562">(</span><span class="ident" id="8406563">t</span>&nbsp;<span class="op" id="8406565">*</span><span class="ident" id="8406566">testing</span><span class="op" id="8406573">.</span><span class="ident" id="8406574">T</span><span class="op" id="8406575">)</span>&nbsp;<span class="op" id="8406577">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406580">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406652">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406707">fileinfo</span><span class="op" id="8406715">,</span>&nbsp;<span class="ident" id="8406717">err</span>&nbsp;<span class="op" id="8406721">:=</span>&nbsp;<span class="ident" id="8406724">os</span><span class="op" id="8406726">.</span><span class="ident" id="8406727">Stat</span><span class="op" id="8406731">(</span><span class="string" id="8406732">&#34;testdata/small.txt&#34;</span><span class="op" id="8406752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406755">if</span>&nbsp;<span class="ident" id="8406758">err</span>&nbsp;<span class="op" id="8406762">!=</span>&nbsp;<span class="ident" id="8406765">nil</span>&nbsp;<span class="op" id="8406769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406773">t</span><span class="op" id="8406774">.</span><span class="ident" id="8406775">Fatal</span><span class="op" id="8406780">(</span><span class="ident" id="8406781">err</span><span class="op" id="8406784">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406791">hdr</span><span class="op" id="8406794">,</span>&nbsp;<span class="ident" id="8406796">err</span>&nbsp;<span class="op" id="8406800">:=</span>&nbsp;<span class="ident" id="8406803">FileInfoHeader</span><span class="op" id="8406817">(</span><span class="ident" id="8406818">fileinfo</span><span class="op" id="8406826">,</span>&nbsp;<span class="string" id="8406828">&#34;&#34;</span><span class="op" id="8406830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406833">if</span>&nbsp;<span class="ident" id="8406836">err</span>&nbsp;<span class="op" id="8406840">!=</span>&nbsp;<span class="ident" id="8406843">nil</span>&nbsp;<span class="op" id="8406847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406851">t</span><span class="op" id="8406852">.</span><span class="ident" id="8406853">Fatalf</span><span class="op" id="8406859">(</span><span class="string" id="8406860">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="8406874">,</span>&nbsp;<span class="ident" id="8406876">err</span><span class="op" id="8406879">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406886">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406907">chineseFilename</span>&nbsp;<span class="op" id="8406923">:=</span>&nbsp;<span class="string" id="8406926">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406939">chineseGroupname</span>&nbsp;<span class="op" id="8406956">:=</span>&nbsp;<span class="string" id="8406959">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406966">chineseUsername</span>&nbsp;<span class="op" id="8406982">:=</span>&nbsp;<span class="string" id="8406985">&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406999">hdr</span><span class="op" id="8407002">.</span><span class="ident" id="8407003">Name</span>&nbsp;<span class="op" id="8407008">=</span>&nbsp;<span class="ident" id="8407010">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407027">hdr</span><span class="op" id="8407030">.</span><span class="ident" id="8407031">Gname</span>&nbsp;<span class="op" id="8407037">=</span>&nbsp;<span class="ident" id="8407039">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407057">hdr</span><span class="op" id="8407060">.</span><span class="ident" id="8407061">Uname</span>&nbsp;<span class="op" id="8407067">=</span>&nbsp;<span class="ident" id="8407069">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407087">contents</span>&nbsp;<span class="op" id="8407096">:=</span>&nbsp;<span class="ident" id="8407099">strings</span><span class="op" id="8407106">.</span><span class="ident" id="8407107">Repeat</span><span class="op" id="8407113">(</span><span class="string" id="8407114">&#34;&nbsp;&#34;</span><span class="op" id="8407117">,</span>&nbsp;<span class="builtintype" id="8407119">int</span><span class="op" id="8407122">(</span><span class="ident" id="8407123">hdr</span><span class="op" id="8407126">.</span><span class="ident" id="8407127">Size</span><span class="op" id="8407131">)</span><span class="op" id="8407132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407136">var</span>&nbsp;<span class="ident" id="8407140">buf</span>&nbsp;<span class="ident" id="8407144">bytes</span><span class="op" id="8407149">.</span><span class="ident" id="8407150">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407158">writer</span>&nbsp;<span class="op" id="8407165">:=</span>&nbsp;<span class="ident" id="8407168">NewWriter</span><span class="op" id="8407177">(</span><span class="op" id="8407178">&amp;</span><span class="ident" id="8407179">buf</span><span class="op" id="8407182">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407185">if</span>&nbsp;<span class="ident" id="8407188">err</span>&nbsp;<span class="op" id="8407192">:=</span>&nbsp;<span class="ident" id="8407195">writer</span><span class="op" id="8407201">.</span><span class="ident" id="8407202">WriteHeader</span><span class="op" id="8407213">(</span><span class="ident" id="8407214">hdr</span><span class="op" id="8407217">)</span><span class="op" id="8407218">;</span>&nbsp;<span class="ident" id="8407220">err</span>&nbsp;<span class="op" id="8407224">!=</span>&nbsp;<span class="ident" id="8407227">nil</span>&nbsp;<span class="op" id="8407231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407235">t</span><span class="op" id="8407236">.</span><span class="ident" id="8407237">Fatal</span><span class="op" id="8407242">(</span><span class="ident" id="8407243">err</span><span class="op" id="8407246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407252">if</span>&nbsp;<span class="ident" id="8407255">_</span><span class="op" id="8407256">,</span>&nbsp;<span class="ident" id="8407258">err</span>&nbsp;<span class="op" id="8407262">=</span>&nbsp;<span class="ident" id="8407264">writer</span><span class="op" id="8407270">.</span><span class="ident" id="8407271">Write</span><span class="op" id="8407276">(</span><span class="op" id="8407277">[</span><span class="op" id="8407278">]</span><span class="builtintype" id="8407279">byte</span><span class="op" id="8407283">(</span><span class="ident" id="8407284">contents</span><span class="op" id="8407292">)</span><span class="op" id="8407293">)</span><span class="op" id="8407294">;</span>&nbsp;<span class="ident" id="8407296">err</span>&nbsp;<span class="op" id="8407300">!=</span>&nbsp;<span class="ident" id="8407303">nil</span>&nbsp;<span class="op" id="8407307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407311">t</span><span class="op" id="8407312">.</span><span class="ident" id="8407313">Fatal</span><span class="op" id="8407318">(</span><span class="ident" id="8407319">err</span><span class="op" id="8407322">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407328">if</span>&nbsp;<span class="ident" id="8407331">err</span>&nbsp;<span class="op" id="8407335">:=</span>&nbsp;<span class="ident" id="8407338">writer</span><span class="op" id="8407344">.</span><span class="ident" id="8407345">Close</span><span class="op" id="8407350">(</span><span class="op" id="8407351">)</span><span class="op" id="8407352">;</span>&nbsp;<span class="ident" id="8407354">err</span>&nbsp;<span class="op" id="8407358">!=</span>&nbsp;<span class="ident" id="8407361">nil</span>&nbsp;<span class="op" id="8407365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407369">t</span><span class="op" id="8407370">.</span><span class="ident" id="8407371">Fatal</span><span class="op" id="8407376">(</span><span class="ident" id="8407377">err</span><span class="op" id="8407380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407386">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407444">if</span>&nbsp;<span class="op" id="8407447">!</span><span class="ident" id="8407448">bytes</span><span class="op" id="8407453">.</span><span class="ident" id="8407454">Contains</span><span class="op" id="8407462">(</span><span class="ident" id="8407463">buf</span><span class="op" id="8407466">.</span><span class="ident" id="8407467">Bytes</span><span class="op" id="8407472">(</span><span class="op" id="8407473">)</span><span class="op" id="8407474">,</span>&nbsp;<span class="op" id="8407476">[</span><span class="op" id="8407477">]</span><span class="builtintype" id="8407478">byte</span><span class="op" id="8407482">(</span><span class="string" id="8407483">&#34;PaxHeaders.&#34;</span><span class="op" id="8407496">)</span><span class="op" id="8407497">)</span>&nbsp;<span class="op" id="8407499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407503">t</span><span class="op" id="8407504">.</span><span class="ident" id="8407505">Fatal</span><span class="op" id="8407510">(</span><span class="string" id="8407511">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="8407560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407566">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407628">reader</span>&nbsp;<span class="op" id="8407635">:=</span>&nbsp;<span class="ident" id="8407638">NewReader</span><span class="op" id="8407647">(</span><span class="op" id="8407648">&amp;</span><span class="ident" id="8407649">buf</span><span class="op" id="8407652">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407655">hdr</span><span class="op" id="8407658">,</span>&nbsp;<span class="ident" id="8407660">err</span>&nbsp;<span class="op" id="8407664">=</span>&nbsp;<span class="ident" id="8407666">reader</span><span class="op" id="8407672">.</span><span class="ident" id="8407673">Next</span><span class="op" id="8407677">(</span><span class="op" id="8407678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407681">if</span>&nbsp;<span class="ident" id="8407684">err</span>&nbsp;<span class="op" id="8407688">!=</span>&nbsp;<span class="ident" id="8407691">nil</span>&nbsp;<span class="op" id="8407695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407699">t</span><span class="op" id="8407700">.</span><span class="ident" id="8407701">Fatal</span><span class="op" id="8407706">(</span><span class="ident" id="8407707">err</span><span class="op" id="8407710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407716">if</span>&nbsp;<span class="ident" id="8407719">hdr</span><span class="op" id="8407722">.</span><span class="ident" id="8407723">Name</span>&nbsp;<span class="op" id="8407728">!=</span>&nbsp;<span class="ident" id="8407731">chineseFilename</span>&nbsp;<span class="op" id="8407747">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407751">t</span><span class="op" id="8407752">.</span><span class="ident" id="8407753">Fatal</span><span class="op" id="8407758">(</span><span class="string" id="8407759">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="8407790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407796">if</span>&nbsp;<span class="ident" id="8407799">hdr</span><span class="op" id="8407802">.</span><span class="ident" id="8407803">Gname</span>&nbsp;<span class="op" id="8407809">!=</span>&nbsp;<span class="ident" id="8407812">chineseGroupname</span>&nbsp;<span class="op" id="8407829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407833">t</span><span class="op" id="8407834">.</span><span class="ident" id="8407835">Fatal</span><span class="op" id="8407840">(</span><span class="string" id="8407841">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="8407873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407876">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407879">if</span>&nbsp;<span class="ident" id="8407882">hdr</span><span class="op" id="8407885">.</span><span class="ident" id="8407886">Uname</span>&nbsp;<span class="op" id="8407892">!=</span>&nbsp;<span class="ident" id="8407895">chineseUsername</span>&nbsp;<span class="op" id="8407911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407915">t</span><span class="op" id="8407916">.</span><span class="ident" id="8407917">Fatal</span><span class="op" id="8407922">(</span><span class="string" id="8407923">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="8407954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407957">}</span><br>
<span class="lineno"></span><span class="op" id="8407959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="8407962">func</span>&nbsp;<span class="ident" id="8407967">TestPaxXattrs</span><span class="op" id="8407980">(</span><span class="ident" id="8407981">t</span>&nbsp;<span class="op" id="8407983">*</span><span class="ident" id="8407984">testing</span><span class="op" id="8407991">.</span><span class="ident" id="8407992">T</span><span class="op" id="8407993">)</span>&nbsp;<span class="op" id="8407995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407998">xattrs</span>&nbsp;<span class="op" id="8408005">:=</span>&nbsp;<span class="keyword" id="8408008">map</span><span class="op" id="8408011">[</span><span class="builtintype" id="8408012">string</span><span class="op" id="8408018">]</span><span class="builtintype" id="8408019">string</span><span class="op" id="8408025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408029">&#34;user.key&#34;</span><span class="op" id="8408039">:</span>&nbsp;<span class="string" id="8408041">&#34;value&#34;</span><span class="op" id="8408048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8408055">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408091">fileinfo</span><span class="op" id="8408099">,</span>&nbsp;<span class="ident" id="8408101">err</span>&nbsp;<span class="op" id="8408105">:=</span>&nbsp;<span class="ident" id="8408108">os</span><span class="op" id="8408110">.</span><span class="ident" id="8408111">Stat</span><span class="op" id="8408115">(</span><span class="string" id="8408116">&#34;testdata/small.txt&#34;</span><span class="op" id="8408136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408139">if</span>&nbsp;<span class="ident" id="8408142">err</span>&nbsp;<span class="op" id="8408146">!=</span>&nbsp;<span class="ident" id="8408149">nil</span>&nbsp;<span class="op" id="8408153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408157">t</span><span class="op" id="8408158">.</span><span class="ident" id="8408159">Fatal</span><span class="op" id="8408164">(</span><span class="ident" id="8408165">err</span><span class="op" id="8408168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408171">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408174">hdr</span><span class="op" id="8408177">,</span>&nbsp;<span class="ident" id="8408179">err</span>&nbsp;<span class="op" id="8408183">:=</span>&nbsp;<span class="ident" id="8408186">FileInfoHeader</span><span class="op" id="8408200">(</span><span class="ident" id="8408201">fileinfo</span><span class="op" id="8408209">,</span>&nbsp;<span class="string" id="8408211">&#34;&#34;</span><span class="op" id="8408213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408216">if</span>&nbsp;<span class="ident" id="8408219">err</span>&nbsp;<span class="op" id="8408223">!=</span>&nbsp;<span class="ident" id="8408226">nil</span>&nbsp;<span class="op" id="8408230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408234">t</span><span class="op" id="8408235">.</span><span class="ident" id="8408236">Fatalf</span><span class="op" id="8408242">(</span><span class="string" id="8408243">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="8408256">,</span>&nbsp;<span class="ident" id="8408258">err</span><span class="op" id="8408261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408267">contents</span>&nbsp;<span class="op" id="8408276">:=</span>&nbsp;<span class="string" id="8408279">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408288">hdr</span><span class="op" id="8408291">.</span><span class="ident" id="8408292">Xattrs</span>&nbsp;<span class="op" id="8408299">=</span>&nbsp;<span class="ident" id="8408301">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408309">var</span>&nbsp;<span class="ident" id="8408313">buf</span>&nbsp;<span class="ident" id="8408317">bytes</span><span class="op" id="8408322">.</span><span class="ident" id="8408323">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408331">writer</span>&nbsp;<span class="op" id="8408338">:=</span>&nbsp;<span class="ident" id="8408341">NewWriter</span><span class="op" id="8408350">(</span><span class="op" id="8408351">&amp;</span><span class="ident" id="8408352">buf</span><span class="op" id="8408355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408358">if</span>&nbsp;<span class="ident" id="8408361">err</span>&nbsp;<span class="op" id="8408365">:=</span>&nbsp;<span class="ident" id="8408368">writer</span><span class="op" id="8408374">.</span><span class="ident" id="8408375">WriteHeader</span><span class="op" id="8408386">(</span><span class="ident" id="8408387">hdr</span><span class="op" id="8408390">)</span><span class="op" id="8408391">;</span>&nbsp;<span class="ident" id="8408393">err</span>&nbsp;<span class="op" id="8408397">!=</span>&nbsp;<span class="ident" id="8408400">nil</span>&nbsp;<span class="op" id="8408404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408408">t</span><span class="op" id="8408409">.</span><span class="ident" id="8408410">Fatal</span><span class="op" id="8408415">(</span><span class="ident" id="8408416">err</span><span class="op" id="8408419">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408425">if</span>&nbsp;<span class="ident" id="8408428">_</span><span class="op" id="8408429">,</span>&nbsp;<span class="ident" id="8408431">err</span>&nbsp;<span class="op" id="8408435">=</span>&nbsp;<span class="ident" id="8408437">writer</span><span class="op" id="8408443">.</span><span class="ident" id="8408444">Write</span><span class="op" id="8408449">(</span><span class="op" id="8408450">[</span><span class="op" id="8408451">]</span><span class="builtintype" id="8408452">byte</span><span class="op" id="8408456">(</span><span class="ident" id="8408457">contents</span><span class="op" id="8408465">)</span><span class="op" id="8408466">)</span><span class="op" id="8408467">;</span>&nbsp;<span class="ident" id="8408469">err</span>&nbsp;<span class="op" id="8408473">!=</span>&nbsp;<span class="ident" id="8408476">nil</span>&nbsp;<span class="op" id="8408480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408484">t</span><span class="op" id="8408485">.</span><span class="ident" id="8408486">Fatal</span><span class="op" id="8408491">(</span><span class="ident" id="8408492">err</span><span class="op" id="8408495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408501">if</span>&nbsp;<span class="ident" id="8408504">err</span>&nbsp;<span class="op" id="8408508">:=</span>&nbsp;<span class="ident" id="8408511">writer</span><span class="op" id="8408517">.</span><span class="ident" id="8408518">Close</span><span class="op" id="8408523">(</span><span class="op" id="8408524">)</span><span class="op" id="8408525">;</span>&nbsp;<span class="ident" id="8408527">err</span>&nbsp;<span class="op" id="8408531">!=</span>&nbsp;<span class="ident" id="8408534">nil</span>&nbsp;<span class="op" id="8408538">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408542">t</span><span class="op" id="8408543">.</span><span class="ident" id="8408544">Fatal</span><span class="op" id="8408549">(</span><span class="ident" id="8408550">err</span><span class="op" id="8408553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8408559">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408620">reader</span>&nbsp;<span class="op" id="8408627">:=</span>&nbsp;<span class="ident" id="8408630">NewReader</span><span class="op" id="8408639">(</span><span class="op" id="8408640">&amp;</span><span class="ident" id="8408641">buf</span><span class="op" id="8408644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408647">hdr</span><span class="op" id="8408650">,</span>&nbsp;<span class="ident" id="8408652">err</span>&nbsp;<span class="op" id="8408656">=</span>&nbsp;<span class="ident" id="8408658">reader</span><span class="op" id="8408664">.</span><span class="ident" id="8408665">Next</span><span class="op" id="8408669">(</span><span class="op" id="8408670">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408673">if</span>&nbsp;<span class="ident" id="8408676">err</span>&nbsp;<span class="op" id="8408680">!=</span>&nbsp;<span class="ident" id="8408683">nil</span>&nbsp;<span class="op" id="8408687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408691">t</span><span class="op" id="8408692">.</span><span class="ident" id="8408693">Fatal</span><span class="op" id="8408698">(</span><span class="ident" id="8408699">err</span><span class="op" id="8408702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408708">if</span>&nbsp;<span class="op" id="8408711">!</span><span class="ident" id="8408712">reflect</span><span class="op" id="8408719">.</span><span class="ident" id="8408720">DeepEqual</span><span class="op" id="8408729">(</span><span class="ident" id="8408730">hdr</span><span class="op" id="8408733">.</span><span class="ident" id="8408734">Xattrs</span><span class="op" id="8408740">,</span>&nbsp;<span class="ident" id="8408742">xattrs</span><span class="op" id="8408748">)</span>&nbsp;<span class="op" id="8408750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408754">t</span><span class="op" id="8408755">.</span><span class="ident" id="8408756">Fatalf</span><span class="op" id="8408762">(</span><span class="string" id="8408763">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="8408817">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408822">hdr</span><span class="op" id="8408825">.</span><span class="ident" id="8408826">Xattrs</span><span class="op" id="8408832">,</span>&nbsp;<span class="ident" id="8408834">xattrs</span><span class="op" id="8408840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408843">}</span><br>
<span class="lineno"></span><span class="op" id="8408845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8408848">func</span>&nbsp;<span class="ident" id="8408853">TestPAXHeader</span><span class="op" id="8408866">(</span><span class="ident" id="8408867">t</span>&nbsp;<span class="op" id="8408869">*</span><span class="ident" id="8408870">testing</span><span class="op" id="8408877">.</span><span class="ident" id="8408878">T</span><span class="op" id="8408879">)</span>&nbsp;<span class="op" id="8408881">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408884">medName</span>&nbsp;<span class="op" id="8408892">:=</span>&nbsp;<span class="ident" id="8408895">strings</span><span class="op" id="8408902">.</span><span class="ident" id="8408903">Repeat</span><span class="op" id="8408909">(</span><span class="string" id="8408910">&#34;CD&#34;</span><span class="op" id="8408914">,</span>&nbsp;<span class="num" id="8408916">50</span><span class="op" id="8408918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408921">longName</span>&nbsp;<span class="op" id="8408930">:=</span>&nbsp;<span class="ident" id="8408933">strings</span><span class="op" id="8408940">.</span><span class="ident" id="8408941">Repeat</span><span class="op" id="8408947">(</span><span class="string" id="8408948">&#34;AB&#34;</span><span class="op" id="8408952">,</span>&nbsp;<span class="num" id="8408954">100</span><span class="op" id="8408957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408960">paxTests</span>&nbsp;<span class="op" id="8408969">:=</span>&nbsp;<span class="op" id="8408972">[</span><span class="op" id="8408973">]</span><span class="op" id="8408974">[</span><span class="num" id="8408975">2</span><span class="op" id="8408976">]</span><span class="builtintype" id="8408977">string</span><span class="op" id="8408983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408987">{</span><span class="ident" id="8408988">paxPath</span>&nbsp;<span class="op" id="8408996">+</span>&nbsp;<span class="string" id="8408998">&#34;=/etc/hosts&#34;</span><span class="op" id="8409011">,</span>&nbsp;<span class="string" id="8409013">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="8409035">}</span><span class="op" id="8409036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409040">{</span><span class="string" id="8409041">&#34;a=b&#34;</span><span class="op" id="8409046">,</span>&nbsp;<span class="string" id="8409048">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="8409057">}</span><span class="op" id="8409058">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8409069">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409094">{</span><span class="string" id="8409095">&#34;a=names&#34;</span><span class="op" id="8409104">,</span>&nbsp;<span class="string" id="8409106">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="8409120">}</span><span class="op" id="8409121">,</span>&nbsp;<span class="comment" id="8409123">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409156">{</span><span class="ident" id="8409157">paxPath</span>&nbsp;<span class="op" id="8409165">+</span>&nbsp;<span class="string" id="8409167">&#34;=&#34;</span>&nbsp;<span class="op" id="8409171">+</span>&nbsp;<span class="ident" id="8409173">longName</span><span class="op" id="8409181">,</span>&nbsp;<span class="ident" id="8409183">fmt</span><span class="op" id="8409186">.</span><span class="ident" id="8409187">Sprintf</span><span class="op" id="8409194">(</span><span class="string" id="8409195">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="8409210">,</span>&nbsp;<span class="ident" id="8409212">longName</span><span class="op" id="8409220">)</span><span class="op" id="8409221">}</span><span class="op" id="8409222">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409226">{</span><span class="ident" id="8409227">paxPath</span>&nbsp;<span class="op" id="8409235">+</span>&nbsp;<span class="string" id="8409237">&#34;=&#34;</span>&nbsp;<span class="op" id="8409241">+</span>&nbsp;<span class="ident" id="8409243">medName</span><span class="op" id="8409250">,</span>&nbsp;<span class="ident" id="8409252">fmt</span><span class="op" id="8409255">.</span><span class="ident" id="8409256">Sprintf</span><span class="op" id="8409263">(</span><span class="string" id="8409264">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="8409279">,</span>&nbsp;<span class="ident" id="8409281">medName</span><span class="op" id="8409288">)</span><span class="op" id="8409289">}</span><span class="op" id="8409290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409294">for</span>&nbsp;<span class="ident" id="8409298">_</span><span class="op" id="8409299">,</span>&nbsp;<span class="ident" id="8409301">test</span>&nbsp;<span class="op" id="8409306">:=</span>&nbsp;<span class="keyword" id="8409309">range</span>&nbsp;<span class="ident" id="8409315">paxTests</span>&nbsp;<span class="op" id="8409324">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409328">key</span><span class="op" id="8409331">,</span>&nbsp;<span class="ident" id="8409333">expected</span>&nbsp;<span class="op" id="8409342">:=</span>&nbsp;<span class="ident" id="8409345">test</span><span class="op" id="8409349">[</span><span class="num" id="8409350">0</span><span class="op" id="8409351">]</span><span class="op" id="8409352">,</span>&nbsp;<span class="ident" id="8409354">test</span><span class="op" id="8409358">[</span><span class="num" id="8409359">1</span><span class="op" id="8409360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409364">if</span>&nbsp;<span class="ident" id="8409367">result</span>&nbsp;<span class="op" id="8409374">:=</span>&nbsp;<span class="ident" id="8409377">paxHeader</span><span class="op" id="8409386">(</span><span class="ident" id="8409387">key</span><span class="op" id="8409390">)</span><span class="op" id="8409391">;</span>&nbsp;<span class="ident" id="8409393">result</span>&nbsp;<span class="op" id="8409400">!=</span>&nbsp;<span class="ident" id="8409403">expected</span>&nbsp;<span class="op" id="8409412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409417">t</span><span class="op" id="8409418">.</span><span class="ident" id="8409419">Fatalf</span><span class="op" id="8409425">(</span><span class="string" id="8409426">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="8409458">,</span>&nbsp;<span class="ident" id="8409460">result</span><span class="op" id="8409466">,</span>&nbsp;<span class="ident" id="8409468">expected</span><span class="op" id="8409476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409483">}</span><br>
<span class="lineno">420</span><span class="op" id="8409485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8409488">func</span>&nbsp;<span class="ident" id="8409493">TestUSTARLongName</span><span class="op" id="8409510">(</span><span class="ident" id="8409511">t</span>&nbsp;<span class="op" id="8409513">*</span><span class="ident" id="8409514">testing</span><span class="op" id="8409521">.</span><span class="ident" id="8409522">T</span><span class="op" id="8409523">)</span>&nbsp;<span class="op" id="8409525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409528">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409626">fileinfo</span><span class="op" id="8409634">,</span>&nbsp;<span class="ident" id="8409636">err</span>&nbsp;<span class="op" id="8409640">:=</span>&nbsp;<span class="ident" id="8409643">os</span><span class="op" id="8409645">.</span><span class="ident" id="8409646">Stat</span><span class="op" id="8409650">(</span><span class="string" id="8409651">&#34;testdata/small.txt&#34;</span><span class="op" id="8409671">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409674">if</span>&nbsp;<span class="ident" id="8409677">err</span>&nbsp;<span class="op" id="8409681">!=</span>&nbsp;<span class="ident" id="8409684">nil</span>&nbsp;<span class="op" id="8409688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409692">t</span><span class="op" id="8409693">.</span><span class="ident" id="8409694">Fatal</span><span class="op" id="8409699">(</span><span class="ident" id="8409700">err</span><span class="op" id="8409703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409709">hdr</span><span class="op" id="8409712">,</span>&nbsp;<span class="ident" id="8409714">err</span>&nbsp;<span class="op" id="8409718">:=</span>&nbsp;<span class="ident" id="8409721">FileInfoHeader</span><span class="op" id="8409735">(</span><span class="ident" id="8409736">fileinfo</span><span class="op" id="8409744">,</span>&nbsp;<span class="string" id="8409746">&#34;&#34;</span><span class="op" id="8409748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409751">hdr</span><span class="op" id="8409754">.</span><span class="ident" id="8409755">Typeflag</span>&nbsp;<span class="op" id="8409764">=</span>&nbsp;<span class="ident" id="8409766">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409775">if</span>&nbsp;<span class="ident" id="8409778">err</span>&nbsp;<span class="op" id="8409782">!=</span>&nbsp;<span class="ident" id="8409785">nil</span>&nbsp;<span class="op" id="8409789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409793">t</span><span class="op" id="8409794">.</span><span class="ident" id="8409795">Fatalf</span><span class="op" id="8409801">(</span><span class="string" id="8409802">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="8409816">,</span>&nbsp;<span class="ident" id="8409818">err</span><span class="op" id="8409821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409827">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409912">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409991">longName</span>&nbsp;<span class="op" id="8410000">:=</span>&nbsp;<span class="string" id="8410003">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410262">hdr</span><span class="op" id="8410265">.</span><span class="ident" id="8410266">Name</span>&nbsp;<span class="op" id="8410271">=</span>&nbsp;<span class="ident" id="8410273">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410284">hdr</span><span class="op" id="8410287">.</span><span class="ident" id="8410288">Size</span>&nbsp;<span class="op" id="8410293">=</span>&nbsp;<span class="num" id="8410295">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410298">var</span>&nbsp;<span class="ident" id="8410302">buf</span>&nbsp;<span class="ident" id="8410306">bytes</span><span class="op" id="8410311">.</span><span class="ident" id="8410312">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410320">writer</span>&nbsp;<span class="op" id="8410327">:=</span>&nbsp;<span class="ident" id="8410330">NewWriter</span><span class="op" id="8410339">(</span><span class="op" id="8410340">&amp;</span><span class="ident" id="8410341">buf</span><span class="op" id="8410344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410347">if</span>&nbsp;<span class="ident" id="8410350">err</span>&nbsp;<span class="op" id="8410354">:=</span>&nbsp;<span class="ident" id="8410357">writer</span><span class="op" id="8410363">.</span><span class="ident" id="8410364">WriteHeader</span><span class="op" id="8410375">(</span><span class="ident" id="8410376">hdr</span><span class="op" id="8410379">)</span><span class="op" id="8410380">;</span>&nbsp;<span class="ident" id="8410382">err</span>&nbsp;<span class="op" id="8410386">!=</span>&nbsp;<span class="ident" id="8410389">nil</span>&nbsp;<span class="op" id="8410393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410397">t</span><span class="op" id="8410398">.</span><span class="ident" id="8410399">Fatal</span><span class="op" id="8410404">(</span><span class="ident" id="8410405">err</span><span class="op" id="8410408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8410411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410414">if</span>&nbsp;<span class="ident" id="8410417">err</span>&nbsp;<span class="op" id="8410421">:=</span>&nbsp;<span class="ident" id="8410424">writer</span><span class="op" id="8410430">.</span><span class="ident" id="8410431">Close</span><span class="op" id="8410436">(</span><span class="op" id="8410437">)</span><span class="op" id="8410438">;</span>&nbsp;<span class="ident" id="8410440">err</span>&nbsp;<span class="op" id="8410444">!=</span>&nbsp;<span class="ident" id="8410447">nil</span>&nbsp;<span class="op" id="8410451">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410455">t</span><span class="op" id="8410456">.</span><span class="ident" id="8410457">Fatal</span><span class="op" id="8410462">(</span><span class="ident" id="8410463">err</span><span class="op" id="8410466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8410469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8410472">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410534">reader</span>&nbsp;<span class="op" id="8410541">:=</span>&nbsp;<span class="ident" id="8410544">NewReader</span><span class="op" id="8410553">(</span><span class="op" id="8410554">&amp;</span><span class="ident" id="8410555">buf</span><span class="op" id="8410558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410561">hdr</span><span class="op" id="8410564">,</span>&nbsp;<span class="ident" id="8410566">err</span>&nbsp;<span class="op" id="8410570">=</span>&nbsp;<span class="ident" id="8410572">reader</span><span class="op" id="8410578">.</span><span class="ident" id="8410579">Next</span><span class="op" id="8410583">(</span><span class="op" id="8410584">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410587">if</span>&nbsp;<span class="ident" id="8410590">err</span>&nbsp;<span class="op" id="8410594">!=</span>&nbsp;<span class="ident" id="8410597">nil</span>&nbsp;<span class="op" id="8410601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410605">t</span><span class="op" id="8410606">.</span><span class="ident" id="8410607">Fatal</span><span class="op" id="8410612">(</span><span class="ident" id="8410613">err</span><span class="op" id="8410616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8410619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410622">if</span>&nbsp;<span class="ident" id="8410625">hdr</span><span class="op" id="8410628">.</span><span class="ident" id="8410629">Name</span>&nbsp;<span class="op" id="8410634">!=</span>&nbsp;<span class="ident" id="8410637">longName</span>&nbsp;<span class="op" id="8410646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410650">t</span><span class="op" id="8410651">.</span><span class="ident" id="8410652">Fatal</span><span class="op" id="8410657">(</span><span class="string" id="8410658">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="8410686">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8410689">}</span><br>
<span class="lineno"></span><span class="op" id="8410691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8410694">func</span>&nbsp;<span class="ident" id="8410699">TestValidTypeflagWithPAXHeader</span><span class="op" id="8410729">(</span><span class="ident" id="8410730">t</span>&nbsp;<span class="op" id="8410732">*</span><span class="ident" id="8410733">testing</span><span class="op" id="8410740">.</span><span class="ident" id="8410741">T</span><span class="op" id="8410742">)</span>&nbsp;<span class="op" id="8410744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410747">var</span>&nbsp;<span class="ident" id="8410751">buffer</span>&nbsp;<span class="ident" id="8410758">bytes</span><span class="op" id="8410763">.</span><span class="ident" id="8410764">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410772">tw</span>&nbsp;<span class="op" id="8410775">:=</span>&nbsp;<span class="ident" id="8410778">NewWriter</span><span class="op" id="8410787">(</span><span class="op" id="8410788">&amp;</span><span class="ident" id="8410789">buffer</span><span class="op" id="8410795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410799">fileName</span>&nbsp;<span class="op" id="8410808">:=</span>&nbsp;<span class="ident" id="8410811">strings</span><span class="op" id="8410818">.</span><span class="ident" id="8410819">Repeat</span><span class="op" id="8410825">(</span><span class="string" id="8410826">&#34;ab&#34;</span><span class="op" id="8410830">,</span>&nbsp;<span class="num" id="8410832">100</span><span class="op" id="8410835">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410839">hdr</span>&nbsp;<span class="op" id="8410843">:=</span>&nbsp;<span class="op" id="8410846">&amp;</span><span class="ident" id="8410847">Header</span><span class="op" id="8410853">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410857">Name</span><span class="op" id="8410861">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8410867">fileName</span><span class="op" id="8410875">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410879">Size</span><span class="op" id="8410883">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="8410889">4</span><span class="op" id="8410890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410894">Typeflag</span><span class="op" id="8410902">:</span>&nbsp;<span class="num" id="8410904">0</span><span class="op" id="8410905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8410908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410911">if</span>&nbsp;<span class="ident" id="8410914">err</span>&nbsp;<span class="op" id="8410918">:=</span>&nbsp;<span class="ident" id="8410921">tw</span><span class="op" id="8410923">.</span><span class="ident" id="8410924">WriteHeader</span><span class="op" id="8410935">(</span><span class="ident" id="8410936">hdr</span><span class="op" id="8410939">)</span><span class="op" id="8410940">;</span>&nbsp;<span class="ident" id="8410942">err</span>&nbsp;<span class="op" id="8410946">!=</span>&nbsp;<span class="ident" id="8410949">nil</span>&nbsp;<span class="op" id="8410953">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410957">t</span><span class="op" id="8410958">.</span><span class="ident" id="8410959">Fatalf</span><span class="op" id="8410965">(</span><span class="string" id="8410966">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="8410994">,</span>&nbsp;<span class="ident" id="8410996">err</span><span class="op" id="8410999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8411002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8411005">if</span>&nbsp;<span class="ident" id="8411008">_</span><span class="op" id="8411009">,</span>&nbsp;<span class="ident" id="8411011">err</span>&nbsp;<span class="op" id="8411015">:=</span>&nbsp;<span class="ident" id="8411018">tw</span><span class="op" id="8411020">.</span><span class="ident" id="8411021">Write</span><span class="op" id="8411026">(</span><span class="op" id="8411027">[</span><span class="op" id="8411028">]</span><span class="builtintype" id="8411029">byte</span><span class="op" id="8411033">(</span><span class="string" id="8411034">&#34;fooo&#34;</span><span class="op" id="8411040">)</span><span class="op" id="8411041">)</span><span class="op" id="8411042">;</span>&nbsp;<span class="ident" id="8411044">err</span>&nbsp;<span class="op" id="8411048">!=</span>&nbsp;<span class="ident" id="8411051">nil</span>&nbsp;<span class="op" id="8411055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8411059">t</span><span class="op" id="8411060">.</span><span class="ident" id="8411061">Fatalf</span><span class="op" id="8411067">(</span><span class="string" id="8411068">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="8411105">,</span>&nbsp;<span class="ident" id="8411107">err</span><span class="op" id="8411110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8411113">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8411116">tw</span><span class="op" id="8411118">.</span><span class="ident" id="8411119">Close</span><span class="op" id="8411124">(</span><span class="op" id="8411125">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8411129">tr</span>&nbsp;<span class="op" id="8411132">:=</span>&nbsp;<span class="ident" id="8411135">NewReader</span><span class="op" id="8411144">(</span><span class="op" id="8411145">&amp;</span><span class="ident" id="8411146">buffer</span><span class="op" id="8411152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8411156">for</span>&nbsp;<span class="op" id="8411160">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8411164">header</span><span class="op" id="8411170">,</span>&nbsp;<span class="ident" id="8411172">err</span>&nbsp;<span class="op" id="8411176">:=</span>&nbsp;<span class="ident" id="8411179">tr</span><span class="op" id="8411181">.</span><span class="ident" id="8411182">Next</span><span class="op" id="8411186">(</span><span class="op" id="8411187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8411191">if</span>&nbsp;<span class="ident" id="8411194">err</span>&nbsp;<span class="op" id="8411198">==</span>&nbsp;<span class="ident" id="8411201">io</span><span class="op" id="8411203">.</span><span class="ident" id="8411204">EOF</span>&nbsp;<span class="op" id="8411208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8411213">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8411221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8411225">if</span>&nbsp;<span class="ident" id="8411228">err</span>&nbsp;<span class="op" id="8411232">!=</span>&nbsp;<span class="ident" id="8411235">nil</span>&nbsp;<span class="op" id="8411239">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8411244">t</span><span class="op" id="8411245">.</span><span class="ident" id="8411246">Fatalf</span><span class="op" id="8411252">(</span><span class="string" id="8411253">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="8411280">,</span>&nbsp;<span class="ident" id="8411282">err</span><span class="op" id="8411285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8411289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8411293">if</span>&nbsp;<span class="ident" id="8411296">header</span><span class="op" id="8411302">.</span><span class="ident" id="8411303">Typeflag</span>&nbsp;<span class="op" id="8411312">!=</span>&nbsp;<span class="num" id="8411315">0</span>&nbsp;<span class="op" id="8411317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8411322">t</span><span class="op" id="8411323">.</span><span class="ident" id="8411324">Fatalf</span><span class="op" id="8411330">(</span><span class="string" id="8411331">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="8411368">,</span>&nbsp;<span class="ident" id="8411370">header</span><span class="op" id="8411376">.</span><span class="ident" id="8411377">Typeflag</span><span class="op" id="8411385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8411389">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8411392">}</span><br>
<span class="lineno"></span><span class="op" id="8411394">}</span>
</div>
</body>
</html>
