<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html" class="current">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4678599">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4678654">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4678708">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4678759">package</span>&nbsp;<span class="ident" id="4678767">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4678773">import</span>&nbsp;<span class="op" id="4678780">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4678783">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4678798">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4678801">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4678839">type</span>&nbsp;<span class="ident" id="4678844">CertPool</span>&nbsp;<span class="keyword" id="4678853">struct</span>&nbsp;<span class="op" id="4678860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678863">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4678878">map</span><span class="op" id="4678881">[</span><span class="builtintype" id="4678882">string</span><span class="op" id="4678888">]</span><span class="op" id="4678889">[</span><span class="op" id="4678890">]</span><span class="builtintype" id="4678891">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678896">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4678911">map</span><span class="op" id="4678914">[</span><span class="builtintype" id="4678915">string</span><span class="op" id="4678921">]</span><span class="op" id="4678922">[</span><span class="op" id="4678923">]</span><span class="builtintype" id="4678924">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4678929">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4678944">[</span><span class="op" id="4678945">]</span><span class="op" id="4678946">*</span><span class="ident" id="4678947">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4678959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4678962">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4679008">func</span>&nbsp;<span class="ident" id="4679013">NewCertPool</span><span class="op" id="4679024">(</span><span class="op" id="4679025">)</span>&nbsp;<span class="op" id="4679027">*</span><span class="ident" id="4679028">CertPool</span>&nbsp;<span class="op" id="4679037">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679040">return</span>&nbsp;<span class="op" id="4679047">&amp;</span><span class="ident" id="4679048">CertPool</span><span class="op" id="4679056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4679060">make</span><span class="op" id="4679064">(</span><span class="keyword" id="4679065">map</span><span class="op" id="4679068">[</span><span class="builtintype" id="4679069">string</span><span class="op" id="4679075">]</span><span class="op" id="4679076">[</span><span class="op" id="4679077">]</span><span class="builtintype" id="4679078">int</span><span class="op" id="4679081">)</span><span class="op" id="4679082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4679086">make</span><span class="op" id="4679090">(</span><span class="keyword" id="4679091">map</span><span class="op" id="4679094">[</span><span class="builtintype" id="4679095">string</span><span class="op" id="4679101">]</span><span class="op" id="4679102">[</span><span class="op" id="4679103">]</span><span class="builtintype" id="4679104">int</span><span class="op" id="4679107">)</span><span class="op" id="4679108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679112">nil</span><span class="op" id="4679115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679118">}</span><br>
<span class="lineno">25</span><span class="op" id="4679120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4679123">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4679203">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4679282">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4679358">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4679371">func</span>&nbsp;<span class="op" id="4679376">(</span><span class="ident" id="4679377">s</span>&nbsp;<span class="op" id="4679379">*</span><span class="ident" id="4679380">CertPool</span><span class="op" id="4679388">)</span>&nbsp;<span class="ident" id="4679390">findVerifiedParents</span><span class="op" id="4679409">(</span><span class="ident" id="4679410">cert</span>&nbsp;<span class="op" id="4679415">*</span><span class="ident" id="4679416">Certificate</span><span class="op" id="4679427">)</span>&nbsp;<span class="op" id="4679429">(</span><span class="ident" id="4679430">parents</span>&nbsp;<span class="op" id="4679438">[</span><span class="op" id="4679439">]</span><span class="builtintype" id="4679440">int</span><span class="op" id="4679443">,</span>&nbsp;<span class="ident" id="4679445">errCert</span>&nbsp;<span class="op" id="4679453">*</span><span class="ident" id="4679454">Certificate</span><span class="op" id="4679465">,</span>&nbsp;<span class="ident" id="4679467">err</span>&nbsp;<span class="builtintype" id="4679471">error</span><span class="op" id="4679476">)</span>&nbsp;<span class="op" id="4679478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679481">if</span>&nbsp;<span class="ident" id="4679484">s</span>&nbsp;<span class="op" id="4679486">==</span>&nbsp;<span class="ident" id="4679489">nil</span>&nbsp;<span class="op" id="4679493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679497">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679505">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679508">var</span>&nbsp;<span class="ident" id="4679512">candidates</span>&nbsp;<span class="op" id="4679523">[</span><span class="op" id="4679524">]</span><span class="builtintype" id="4679525">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679531">if</span>&nbsp;<span class="builtinfunc" id="4679534">len</span><span class="op" id="4679537">(</span><span class="ident" id="4679538">cert</span><span class="op" id="4679542">.</span><span class="ident" id="4679543">AuthorityKeyId</span><span class="op" id="4679557">)</span>&nbsp;<span class="op" id="4679559">&gt;</span>&nbsp;<span class="num" id="4679561">0</span>&nbsp;<span class="op" id="4679563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679567">candidates</span>&nbsp;<span class="op" id="4679578">=</span>&nbsp;<span class="ident" id="4679580">s</span><span class="op" id="4679581">.</span><span class="ident" id="4679582">bySubjectKeyId</span><span class="op" id="4679596">[</span><span class="builtintype" id="4679597">string</span><span class="op" id="4679603">(</span><span class="ident" id="4679604">cert</span><span class="op" id="4679608">.</span><span class="ident" id="4679609">AuthorityKeyId</span><span class="op" id="4679623">)</span><span class="op" id="4679624">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679627">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679630">if</span>&nbsp;<span class="builtinfunc" id="4679633">len</span><span class="op" id="4679636">(</span><span class="ident" id="4679637">candidates</span><span class="op" id="4679647">)</span>&nbsp;<span class="op" id="4679649">==</span>&nbsp;<span class="num" id="4679652">0</span>&nbsp;<span class="op" id="4679654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679658">candidates</span>&nbsp;<span class="op" id="4679669">=</span>&nbsp;<span class="ident" id="4679671">s</span><span class="op" id="4679672">.</span><span class="ident" id="4679673">byName</span><span class="op" id="4679679">[</span><span class="builtintype" id="4679680">string</span><span class="op" id="4679686">(</span><span class="ident" id="4679687">cert</span><span class="op" id="4679691">.</span><span class="ident" id="4679692">RawIssuer</span><span class="op" id="4679701">)</span><span class="op" id="4679702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679709">for</span>&nbsp;<span class="ident" id="4679713">_</span><span class="op" id="4679714">,</span>&nbsp;<span class="ident" id="4679716">c</span>&nbsp;<span class="op" id="4679718">:=</span>&nbsp;<span class="keyword" id="4679721">range</span>&nbsp;<span class="ident" id="4679727">candidates</span>&nbsp;<span class="op" id="4679738">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679742">if</span>&nbsp;<span class="ident" id="4679745">err</span>&nbsp;<span class="op" id="4679749">=</span>&nbsp;<span class="ident" id="4679751">cert</span><span class="op" id="4679755">.</span><span class="ident" id="4679756">CheckSignatureFrom</span><span class="op" id="4679774">(</span><span class="ident" id="4679775">s</span><span class="op" id="4679776">.</span><span class="ident" id="4679777">certs</span><span class="op" id="4679782">[</span><span class="ident" id="4679783">c</span><span class="op" id="4679784">]</span><span class="op" id="4679785">)</span><span class="op" id="4679786">;</span>&nbsp;<span class="ident" id="4679788">err</span>&nbsp;<span class="op" id="4679792">==</span>&nbsp;<span class="ident" id="4679795">nil</span>&nbsp;<span class="op" id="4679799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679804">parents</span>&nbsp;<span class="op" id="4679812">=</span>&nbsp;<span class="builtinfunc" id="4679814">append</span><span class="op" id="4679820">(</span><span class="ident" id="4679821">parents</span><span class="op" id="4679828">,</span>&nbsp;<span class="ident" id="4679830">c</span><span class="op" id="4679831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679835">}</span>&nbsp;<span class="keyword" id="4679837">else</span>&nbsp;<span class="op" id="4679842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4679847">errCert</span>&nbsp;<span class="op" id="4679855">=</span>&nbsp;<span class="ident" id="4679857">s</span><span class="op" id="4679858">.</span><span class="ident" id="4679859">certs</span><span class="op" id="4679864">[</span><span class="ident" id="4679865">c</span><span class="op" id="4679866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679870">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4679873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679877">return</span><br>
<span class="lineno"></span><span class="op" id="4679884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4679887">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4679928">func</span>&nbsp;<span class="op" id="4679933">(</span><span class="ident" id="4679934">s</span>&nbsp;<span class="op" id="4679936">*</span><span class="ident" id="4679937">CertPool</span><span class="op" id="4679945">)</span>&nbsp;<span class="ident" id="4679947">AddCert</span><span class="op" id="4679954">(</span><span class="ident" id="4679955">cert</span>&nbsp;<span class="op" id="4679960">*</span><span class="ident" id="4679961">Certificate</span><span class="op" id="4679972">)</span>&nbsp;<span class="op" id="4679974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4679977">if</span>&nbsp;<span class="ident" id="4679980">cert</span>&nbsp;<span class="op" id="4679985">==</span>&nbsp;<span class="ident" id="4679988">nil</span>&nbsp;<span class="op" id="4679992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4679996">panic</span><span class="op" id="4680001">(</span><span class="string" id="4680002">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4680038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680041">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4680045">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680101">for</span>&nbsp;<span class="ident" id="4680105">_</span><span class="op" id="4680106">,</span>&nbsp;<span class="ident" id="4680108">c</span>&nbsp;<span class="op" id="4680110">:=</span>&nbsp;<span class="keyword" id="4680113">range</span>&nbsp;<span class="ident" id="4680119">s</span><span class="op" id="4680120">.</span><span class="ident" id="4680121">certs</span>&nbsp;<span class="op" id="4680127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680131">if</span>&nbsp;<span class="ident" id="4680134">c</span><span class="op" id="4680135">.</span><span class="ident" id="4680136">Equal</span><span class="op" id="4680141">(</span><span class="ident" id="4680142">cert</span><span class="op" id="4680146">)</span>&nbsp;<span class="op" id="4680148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680153">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680169">n</span>&nbsp;<span class="op" id="4680171">:=</span>&nbsp;<span class="builtinfunc" id="4680174">len</span><span class="op" id="4680177">(</span><span class="ident" id="4680178">s</span><span class="op" id="4680179">.</span><span class="ident" id="4680180">certs</span><span class="op" id="4680185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680188">s</span><span class="op" id="4680189">.</span><span class="ident" id="4680190">certs</span>&nbsp;<span class="op" id="4680196">=</span>&nbsp;<span class="builtinfunc" id="4680198">append</span><span class="op" id="4680204">(</span><span class="ident" id="4680205">s</span><span class="op" id="4680206">.</span><span class="ident" id="4680207">certs</span><span class="op" id="4680212">,</span>&nbsp;<span class="ident" id="4680214">cert</span><span class="op" id="4680218">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680222">if</span>&nbsp;<span class="builtinfunc" id="4680225">len</span><span class="op" id="4680228">(</span><span class="ident" id="4680229">cert</span><span class="op" id="4680233">.</span><span class="ident" id="4680234">SubjectKeyId</span><span class="op" id="4680246">)</span>&nbsp;<span class="op" id="4680248">&gt;</span>&nbsp;<span class="num" id="4680250">0</span>&nbsp;<span class="op" id="4680252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680256">keyId</span>&nbsp;<span class="op" id="4680262">:=</span>&nbsp;<span class="builtintype" id="4680265">string</span><span class="op" id="4680271">(</span><span class="ident" id="4680272">cert</span><span class="op" id="4680276">.</span><span class="ident" id="4680277">SubjectKeyId</span><span class="op" id="4680289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680293">s</span><span class="op" id="4680294">.</span><span class="ident" id="4680295">bySubjectKeyId</span><span class="op" id="4680309">[</span><span class="ident" id="4680310">keyId</span><span class="op" id="4680315">]</span>&nbsp;<span class="op" id="4680317">=</span>&nbsp;<span class="builtinfunc" id="4680319">append</span><span class="op" id="4680325">(</span><span class="ident" id="4680326">s</span><span class="op" id="4680327">.</span><span class="ident" id="4680328">bySubjectKeyId</span><span class="op" id="4680342">[</span><span class="ident" id="4680343">keyId</span><span class="op" id="4680348">]</span><span class="op" id="4680349">,</span>&nbsp;<span class="ident" id="4680351">n</span><span class="op" id="4680352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680355">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680358">name</span>&nbsp;<span class="op" id="4680363">:=</span>&nbsp;<span class="builtintype" id="4680366">string</span><span class="op" id="4680372">(</span><span class="ident" id="4680373">cert</span><span class="op" id="4680377">.</span><span class="ident" id="4680378">RawSubject</span><span class="op" id="4680388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680391">s</span><span class="op" id="4680392">.</span><span class="ident" id="4680393">byName</span><span class="op" id="4680399">[</span><span class="ident" id="4680400">name</span><span class="op" id="4680404">]</span>&nbsp;<span class="op" id="4680406">=</span>&nbsp;<span class="builtinfunc" id="4680408">append</span><span class="op" id="4680414">(</span><span class="ident" id="4680415">s</span><span class="op" id="4680416">.</span><span class="ident" id="4680417">byName</span><span class="op" id="4680423">[</span><span class="ident" id="4680424">name</span><span class="op" id="4680428">]</span><span class="op" id="4680429">,</span>&nbsp;<span class="ident" id="4680431">n</span><span class="op" id="4680432">)</span><br>
<span class="lineno"></span><span class="op" id="4680434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4680437">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4680515">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4680594">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4680623">//</span><br>
<span class="lineno"></span><span class="comment" id="4680626">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4680703">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4680758">func</span>&nbsp;<span class="op" id="4680763">(</span><span class="ident" id="4680764">s</span>&nbsp;<span class="op" id="4680766">*</span><span class="ident" id="4680767">CertPool</span><span class="op" id="4680775">)</span>&nbsp;<span class="ident" id="4680777">AppendCertsFromPEM</span><span class="op" id="4680795">(</span><span class="ident" id="4680796">pemCerts</span>&nbsp;<span class="op" id="4680805">[</span><span class="op" id="4680806">]</span><span class="builtintype" id="4680807">byte</span><span class="op" id="4680811">)</span>&nbsp;<span class="op" id="4680813">(</span><span class="ident" id="4680814">ok</span>&nbsp;<span class="builtintype" id="4680817">bool</span><span class="op" id="4680821">)</span>&nbsp;<span class="op" id="4680823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680826">for</span>&nbsp;<span class="builtinfunc" id="4680830">len</span><span class="op" id="4680833">(</span><span class="ident" id="4680834">pemCerts</span><span class="op" id="4680842">)</span>&nbsp;<span class="op" id="4680844">&gt;</span>&nbsp;<span class="num" id="4680846">0</span>&nbsp;<span class="op" id="4680848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680852">var</span>&nbsp;<span class="ident" id="4680856">block</span>&nbsp;<span class="op" id="4680862">*</span><span class="ident" id="4680863">pem</span><span class="op" id="4680866">.</span><span class="ident" id="4680867">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4680875">block</span><span class="op" id="4680880">,</span>&nbsp;<span class="ident" id="4680882">pemCerts</span>&nbsp;<span class="op" id="4680891">=</span>&nbsp;<span class="ident" id="4680893">pem</span><span class="op" id="4680896">.</span><span class="ident" id="4680897">Decode</span><span class="op" id="4680903">(</span><span class="ident" id="4680904">pemCerts</span><span class="op" id="4680912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680916">if</span>&nbsp;<span class="ident" id="4680919">block</span>&nbsp;<span class="op" id="4680925">==</span>&nbsp;<span class="ident" id="4680928">nil</span>&nbsp;<span class="op" id="4680932">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680937">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4680945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4680949">if</span>&nbsp;<span class="ident" id="4680952">block</span><span class="op" id="4680957">.</span><span class="ident" id="4680958">Type</span>&nbsp;<span class="op" id="4680963">!=</span>&nbsp;<span class="string" id="4680966">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4680980">||</span>&nbsp;<span class="builtinfunc" id="4680983">len</span><span class="op" id="4680986">(</span><span class="ident" id="4680987">block</span><span class="op" id="4680992">.</span><span class="ident" id="4680993">Headers</span><span class="op" id="4681000">)</span>&nbsp;<span class="op" id="4681002">!=</span>&nbsp;<span class="num" id="4681005">0</span>&nbsp;<span class="op" id="4681007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681012">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681023">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681028">cert</span><span class="op" id="4681032">,</span>&nbsp;<span class="ident" id="4681034">err</span>&nbsp;<span class="op" id="4681038">:=</span>&nbsp;<span class="ident" id="4681041">ParseCertificate</span><span class="op" id="4681057">(</span><span class="ident" id="4681058">block</span><span class="op" id="4681063">.</span><span class="ident" id="4681064">Bytes</span><span class="op" id="4681069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681073">if</span>&nbsp;<span class="ident" id="4681076">err</span>&nbsp;<span class="op" id="4681080">!=</span>&nbsp;<span class="ident" id="4681083">nil</span>&nbsp;<span class="op" id="4681087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681092">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681103">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681108">s</span><span class="op" id="4681109">.</span><span class="ident" id="4681110">AddCert</span><span class="op" id="4681117">(</span><span class="ident" id="4681118">cert</span><span class="op" id="4681122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681126">ok</span>&nbsp;<span class="op" id="4681129">=</span>&nbsp;<span class="builtintype" id="4681131">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681137">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681141">return</span><br>
<span class="lineno"></span><span class="op" id="4681148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4681151">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4681209">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4681249">func</span>&nbsp;<span class="op" id="4681254">(</span><span class="ident" id="4681255">s</span>&nbsp;<span class="op" id="4681257">*</span><span class="ident" id="4681258">CertPool</span><span class="op" id="4681266">)</span>&nbsp;<span class="ident" id="4681268">Subjects</span><span class="op" id="4681276">(</span><span class="op" id="4681277">)</span>&nbsp;<span class="op" id="4681279">(</span><span class="ident" id="4681280">res</span>&nbsp;<span class="op" id="4681284">[</span><span class="op" id="4681285">]</span><span class="op" id="4681286">[</span><span class="op" id="4681287">]</span><span class="builtintype" id="4681288">byte</span><span class="op" id="4681292">)</span>&nbsp;<span class="op" id="4681294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681297">res</span>&nbsp;<span class="op" id="4681301">=</span>&nbsp;<span class="builtinfunc" id="4681303">make</span><span class="op" id="4681307">(</span><span class="op" id="4681308">[</span><span class="op" id="4681309">]</span><span class="op" id="4681310">[</span><span class="op" id="4681311">]</span><span class="builtintype" id="4681312">byte</span><span class="op" id="4681316">,</span>&nbsp;<span class="builtinfunc" id="4681318">len</span><span class="op" id="4681321">(</span><span class="ident" id="4681322">s</span><span class="op" id="4681323">.</span><span class="ident" id="4681324">certs</span><span class="op" id="4681329">)</span><span class="op" id="4681330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681333">for</span>&nbsp;<span class="ident" id="4681337">i</span><span class="op" id="4681338">,</span>&nbsp;<span class="ident" id="4681340">c</span>&nbsp;<span class="op" id="4681342">:=</span>&nbsp;<span class="keyword" id="4681345">range</span>&nbsp;<span class="ident" id="4681351">s</span><span class="op" id="4681352">.</span><span class="ident" id="4681353">certs</span>&nbsp;<span class="op" id="4681359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4681363">res</span><span class="op" id="4681366">[</span><span class="ident" id="4681367">i</span><span class="op" id="4681368">]</span>&nbsp;<span class="op" id="4681370">=</span>&nbsp;<span class="ident" id="4681372">c</span><span class="op" id="4681373">.</span><span class="ident" id="4681374">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4681386">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4681389">return</span><br>
<span class="lineno"></span><span class="op" id="4681396">}</span>
</div>
</body>
</html>
