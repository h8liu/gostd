<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8404486">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8404541">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8404595">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8404646">package</span>&nbsp;<span class="ident" id="8404654">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8404664">import</span>&nbsp;<span class="op" id="8404671">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8404674">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8404683">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8404693">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8404706">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8404717">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="8404739">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="8404742">func</span>&nbsp;<span class="ident" id="8404747">TestAddParseTree</span><span class="op" id="8404763">(</span><span class="ident" id="8404764">t</span>&nbsp;<span class="op" id="8404766">*</span><span class="ident" id="8404767">testing</span><span class="op" id="8404774">.</span><span class="ident" id="8404775">T</span><span class="op" id="8404776">)</span>&nbsp;<span class="op" id="8404778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404781">root</span>&nbsp;<span class="op" id="8404786">:=</span>&nbsp;<span class="ident" id="8404789">Must</span><span class="op" id="8404793">(</span><span class="ident" id="8404794">New</span><span class="op" id="8404797">(</span><span class="string" id="8404798">&#34;root&#34;</span><span class="op" id="8404804">)</span><span class="op" id="8404805">.</span><span class="ident" id="8404806">Parse</span><span class="op" id="8404811">(</span><span class="string" id="8404812">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="8404871">)</span><span class="op" id="8404872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404875">tree</span><span class="op" id="8404879">,</span>&nbsp;<span class="ident" id="8404881">err</span>&nbsp;<span class="op" id="8404885">:=</span>&nbsp;<span class="ident" id="8404888">parse</span><span class="op" id="8404893">.</span><span class="ident" id="8404894">Parse</span><span class="op" id="8404899">(</span><span class="string" id="8404900">&#34;t&#34;</span><span class="op" id="8404903">,</span>&nbsp;<span class="string" id="8404905">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="8404937">,</span>&nbsp;<span class="string" id="8404939">&#34;&#34;</span><span class="op" id="8404941">,</span>&nbsp;<span class="string" id="8404943">&#34;&#34;</span><span class="op" id="8404945">,</span>&nbsp;<span class="ident" id="8404947">nil</span><span class="op" id="8404950">,</span>&nbsp;<span class="ident" id="8404952">nil</span><span class="op" id="8404955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8404958">if</span>&nbsp;<span class="ident" id="8404961">err</span>&nbsp;<span class="op" id="8404965">!=</span>&nbsp;<span class="ident" id="8404968">nil</span>&nbsp;<span class="op" id="8404972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404976">t</span><span class="op" id="8404977">.</span><span class="ident" id="8404978">Fatal</span><span class="op" id="8404983">(</span><span class="ident" id="8404984">err</span><span class="op" id="8404987">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8404990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8404993">added</span>&nbsp;<span class="op" id="8404999">:=</span>&nbsp;<span class="ident" id="8405002">Must</span><span class="op" id="8405006">(</span><span class="ident" id="8405007">root</span><span class="op" id="8405011">.</span><span class="ident" id="8405012">AddParseTree</span><span class="op" id="8405024">(</span><span class="string" id="8405025">&#34;b&#34;</span><span class="op" id="8405028">,</span>&nbsp;<span class="ident" id="8405030">tree</span><span class="op" id="8405034">[</span><span class="string" id="8405035">&#34;b&#34;</span><span class="op" id="8405038">]</span><span class="op" id="8405039">)</span><span class="op" id="8405040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405043">b</span>&nbsp;<span class="op" id="8405045">:=</span>&nbsp;<span class="builtinfunc" id="8405048">new</span><span class="op" id="8405051">(</span><span class="ident" id="8405052">bytes</span><span class="op" id="8405057">.</span><span class="ident" id="8405058">Buffer</span><span class="op" id="8405064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405067">err</span>&nbsp;<span class="op" id="8405071">=</span>&nbsp;<span class="ident" id="8405073">added</span><span class="op" id="8405078">.</span><span class="ident" id="8405079">ExecuteTemplate</span><span class="op" id="8405094">(</span><span class="ident" id="8405095">b</span><span class="op" id="8405096">,</span>&nbsp;<span class="string" id="8405098">&#34;a&#34;</span><span class="op" id="8405101">,</span>&nbsp;<span class="string" id="8405103">&#34;1&gt;0&#34;</span><span class="op" id="8405108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405111">if</span>&nbsp;<span class="ident" id="8405114">err</span>&nbsp;<span class="op" id="8405118">!=</span>&nbsp;<span class="ident" id="8405121">nil</span>&nbsp;<span class="op" id="8405125">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405129">t</span><span class="op" id="8405130">.</span><span class="ident" id="8405131">Fatal</span><span class="op" id="8405136">(</span><span class="ident" id="8405137">err</span><span class="op" id="8405140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405146">if</span>&nbsp;<span class="ident" id="8405149">got</span><span class="op" id="8405152">,</span>&nbsp;<span class="ident" id="8405154">want</span>&nbsp;<span class="op" id="8405159">:=</span>&nbsp;<span class="ident" id="8405162">b</span><span class="op" id="8405163">.</span><span class="ident" id="8405164">String</span><span class="op" id="8405170">(</span><span class="op" id="8405171">)</span><span class="op" id="8405172">,</span>&nbsp;<span class="string" id="8405174">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="8405206">;</span>&nbsp;<span class="ident" id="8405208">got</span>&nbsp;<span class="op" id="8405212">!=</span>&nbsp;<span class="ident" id="8405215">want</span>&nbsp;<span class="op" id="8405220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405224">t</span><span class="op" id="8405225">.</span><span class="ident" id="8405226">Errorf</span><span class="op" id="8405232">(</span><span class="string" id="8405233">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8405249">,</span>&nbsp;<span class="ident" id="8405251">got</span><span class="op" id="8405254">,</span>&nbsp;<span class="ident" id="8405256">want</span><span class="op" id="8405260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8405263">}</span><br>
<span class="lineno">30</span><span class="op" id="8405265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8405268">func</span>&nbsp;<span class="ident" id="8405273">TestClone</span><span class="op" id="8405282">(</span><span class="ident" id="8405283">t</span>&nbsp;<span class="op" id="8405285">*</span><span class="ident" id="8405286">testing</span><span class="op" id="8405293">.</span><span class="ident" id="8405294">T</span><span class="op" id="8405295">)</span>&nbsp;<span class="op" id="8405297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405300">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405372">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405426">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405479">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405539">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405592">const</span>&nbsp;<span class="ident" id="8405598">tmpl</span>&nbsp;<span class="op" id="8405603">=</span>&nbsp;<span class="string" id="8405605">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405671">b</span>&nbsp;<span class="op" id="8405673">:=</span>&nbsp;<span class="builtinfunc" id="8405676">new</span><span class="op" id="8405679">(</span><span class="ident" id="8405680">bytes</span><span class="op" id="8405685">.</span><span class="ident" id="8405686">Buffer</span><span class="op" id="8405692">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405696">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405734">t0</span>&nbsp;<span class="op" id="8405737">:=</span>&nbsp;<span class="ident" id="8405740">Must</span><span class="op" id="8405744">(</span><span class="ident" id="8405745">New</span><span class="op" id="8405748">(</span><span class="string" id="8405749">&#34;t0&#34;</span><span class="op" id="8405753">)</span><span class="op" id="8405754">.</span><span class="ident" id="8405755">Parse</span><span class="op" id="8405760">(</span><span class="ident" id="8405761">tmpl</span><span class="op" id="8405765">)</span><span class="op" id="8405766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405770">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405790">t1</span>&nbsp;<span class="op" id="8405793">:=</span>&nbsp;<span class="ident" id="8405796">Must</span><span class="op" id="8405800">(</span><span class="ident" id="8405801">t0</span><span class="op" id="8405803">.</span><span class="ident" id="8405804">Clone</span><span class="op" id="8405809">(</span><span class="op" id="8405810">)</span><span class="op" id="8405811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405814">Must</span><span class="op" id="8405818">(</span><span class="ident" id="8405819">t1</span><span class="op" id="8405821">.</span><span class="ident" id="8405822">Parse</span><span class="op" id="8405827">(</span><span class="string" id="8405828">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="8405864">)</span><span class="op" id="8405865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405868">Must</span><span class="op" id="8405872">(</span><span class="ident" id="8405873">t1</span><span class="op" id="8405875">.</span><span class="ident" id="8405876">Parse</span><span class="op" id="8405881">(</span><span class="string" id="8405882">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="8405915">)</span><span class="op" id="8405916">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8405920">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8405936">b</span><span class="op" id="8405937">.</span><span class="ident" id="8405938">Reset</span><span class="op" id="8405943">(</span><span class="op" id="8405944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8405947">if</span>&nbsp;<span class="ident" id="8405950">err</span>&nbsp;<span class="op" id="8405954">:=</span>&nbsp;<span class="ident" id="8405957">t1</span><span class="op" id="8405959">.</span><span class="ident" id="8405960">ExecuteTemplate</span><span class="op" id="8405975">(</span><span class="ident" id="8405976">b</span><span class="op" id="8405977">,</span>&nbsp;<span class="string" id="8405979">&#34;a&#34;</span><span class="op" id="8405982">,</span>&nbsp;<span class="string" id="8405984">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8405991">)</span><span class="op" id="8405992">;</span>&nbsp;<span class="ident" id="8405994">err</span>&nbsp;<span class="op" id="8405998">!=</span>&nbsp;<span class="ident" id="8406001">nil</span>&nbsp;<span class="op" id="8406005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406009">t</span><span class="op" id="8406010">.</span><span class="ident" id="8406011">Fatal</span><span class="op" id="8406016">(</span><span class="ident" id="8406017">err</span><span class="op" id="8406020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406026">if</span>&nbsp;<span class="ident" id="8406029">got</span><span class="op" id="8406032">,</span>&nbsp;<span class="ident" id="8406034">want</span>&nbsp;<span class="op" id="8406039">:=</span>&nbsp;<span class="ident" id="8406042">b</span><span class="op" id="8406043">.</span><span class="ident" id="8406044">String</span><span class="op" id="8406050">(</span><span class="op" id="8406051">)</span><span class="op" id="8406052">,</span>&nbsp;<span class="string" id="8406054">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="8406084">;</span>&nbsp;<span class="ident" id="8406086">got</span>&nbsp;<span class="op" id="8406090">!=</span>&nbsp;<span class="ident" id="8406093">want</span>&nbsp;<span class="op" id="8406098">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406102">t</span><span class="op" id="8406103">.</span><span class="ident" id="8406104">Errorf</span><span class="op" id="8406110">(</span><span class="string" id="8406111">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8406131">,</span>&nbsp;<span class="ident" id="8406133">got</span><span class="op" id="8406136">,</span>&nbsp;<span class="ident" id="8406138">want</span><span class="op" id="8406142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406149">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406169">t2</span>&nbsp;<span class="op" id="8406172">:=</span>&nbsp;<span class="ident" id="8406175">Must</span><span class="op" id="8406179">(</span><span class="ident" id="8406180">t0</span><span class="op" id="8406182">.</span><span class="ident" id="8406183">Clone</span><span class="op" id="8406188">(</span><span class="op" id="8406189">)</span><span class="op" id="8406190">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406193">Must</span><span class="op" id="8406197">(</span><span class="ident" id="8406198">t2</span><span class="op" id="8406200">.</span><span class="ident" id="8406201">Parse</span><span class="op" id="8406206">(</span><span class="string" id="8406207">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="8406257">)</span><span class="op" id="8406258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406261">Must</span><span class="op" id="8406265">(</span><span class="ident" id="8406266">t2</span><span class="op" id="8406268">.</span><span class="ident" id="8406269">Parse</span><span class="op" id="8406274">(</span><span class="string" id="8406275">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="8406308">)</span><span class="op" id="8406309">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406313">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406329">b</span><span class="op" id="8406330">.</span><span class="ident" id="8406331">Reset</span><span class="op" id="8406336">(</span><span class="op" id="8406337">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406340">if</span>&nbsp;<span class="ident" id="8406343">err</span>&nbsp;<span class="op" id="8406347">:=</span>&nbsp;<span class="ident" id="8406350">t2</span><span class="op" id="8406352">.</span><span class="ident" id="8406353">ExecuteTemplate</span><span class="op" id="8406368">(</span><span class="ident" id="8406369">b</span><span class="op" id="8406370">,</span>&nbsp;<span class="string" id="8406372">&#34;a&#34;</span><span class="op" id="8406375">,</span>&nbsp;<span class="string" id="8406377">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8406384">)</span><span class="op" id="8406385">;</span>&nbsp;<span class="ident" id="8406387">err</span>&nbsp;<span class="op" id="8406391">!=</span>&nbsp;<span class="ident" id="8406394">nil</span>&nbsp;<span class="op" id="8406398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406402">t</span><span class="op" id="8406403">.</span><span class="ident" id="8406404">Fatal</span><span class="op" id="8406409">(</span><span class="ident" id="8406410">err</span><span class="op" id="8406413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406419">if</span>&nbsp;<span class="ident" id="8406422">got</span><span class="op" id="8406425">,</span>&nbsp;<span class="ident" id="8406427">want</span>&nbsp;<span class="op" id="8406432">:=</span>&nbsp;<span class="ident" id="8406435">b</span><span class="op" id="8406436">.</span><span class="ident" id="8406437">String</span><span class="op" id="8406443">(</span><span class="op" id="8406444">)</span><span class="op" id="8406445">,</span>&nbsp;<span class="string" id="8406447">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="8406507">;</span>&nbsp;<span class="ident" id="8406509">got</span>&nbsp;<span class="op" id="8406513">!=</span>&nbsp;<span class="ident" id="8406516">want</span>&nbsp;<span class="op" id="8406521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406525">t</span><span class="op" id="8406526">.</span><span class="ident" id="8406527">Errorf</span><span class="op" id="8406533">(</span><span class="string" id="8406534">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8406554">,</span>&nbsp;<span class="ident" id="8406556">got</span><span class="op" id="8406559">,</span>&nbsp;<span class="ident" id="8406561">want</span><span class="op" id="8406565">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8406568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406572">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406619">t3</span>&nbsp;<span class="op" id="8406622">:=</span>&nbsp;<span class="ident" id="8406625">Must</span><span class="op" id="8406629">(</span><span class="ident" id="8406630">t0</span><span class="op" id="8406632">.</span><span class="ident" id="8406633">Clone</span><span class="op" id="8406638">(</span><span class="op" id="8406639">)</span><span class="op" id="8406640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406643">Must</span><span class="op" id="8406647">(</span><span class="ident" id="8406648">t3</span><span class="op" id="8406650">.</span><span class="ident" id="8406651">Parse</span><span class="op" id="8406656">(</span><span class="string" id="8406657">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="8406691">)</span><span class="op" id="8406692">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406695">Must</span><span class="op" id="8406699">(</span><span class="ident" id="8406700">t3</span><span class="op" id="8406702">.</span><span class="ident" id="8406703">Parse</span><span class="op" id="8406708">(</span><span class="string" id="8406709">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="8406744">)</span><span class="op" id="8406745">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406749">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406766">Must</span><span class="op" id="8406770">(</span><span class="ident" id="8406771">t0</span><span class="op" id="8406773">.</span><span class="ident" id="8406774">Parse</span><span class="op" id="8406779">(</span><span class="string" id="8406780">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="8406808">)</span><span class="op" id="8406809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406812">Must</span><span class="op" id="8406816">(</span><span class="ident" id="8406817">t0</span><span class="op" id="8406819">.</span><span class="ident" id="8406820">Parse</span><span class="op" id="8406825">(</span><span class="string" id="8406826">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="8406854">)</span><span class="op" id="8406855">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8406859">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8406922">t4</span>&nbsp;<span class="op" id="8406925">:=</span>&nbsp;<span class="ident" id="8406928">Must</span><span class="op" id="8406932">(</span><span class="ident" id="8406933">t0</span><span class="op" id="8406935">.</span><span class="ident" id="8406936">Clone</span><span class="op" id="8406941">(</span><span class="op" id="8406942">)</span><span class="op" id="8406943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8406946">if</span>&nbsp;<span class="ident" id="8406949">_</span><span class="op" id="8406950">,</span>&nbsp;<span class="ident" id="8406952">err</span>&nbsp;<span class="op" id="8406956">:=</span>&nbsp;<span class="ident" id="8406959">t4</span><span class="op" id="8406961">.</span><span class="ident" id="8406962">Parse</span><span class="op" id="8406967">(</span><span class="string" id="8406968">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="8406999">)</span><span class="op" id="8407000">;</span>&nbsp;<span class="ident" id="8407002">err</span>&nbsp;<span class="op" id="8407006">==</span>&nbsp;<span class="ident" id="8407009">nil</span>&nbsp;<span class="op" id="8407013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407017">t</span><span class="op" id="8407018">.</span><span class="ident" id="8407019">Error</span><span class="op" id="8407024">(</span><span class="string" id="8407025">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8407067">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407074">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407090">b</span><span class="op" id="8407091">.</span><span class="ident" id="8407092">Reset</span><span class="op" id="8407097">(</span><span class="op" id="8407098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407101">if</span>&nbsp;<span class="ident" id="8407104">err</span>&nbsp;<span class="op" id="8407108">:=</span>&nbsp;<span class="ident" id="8407111">t0</span><span class="op" id="8407113">.</span><span class="ident" id="8407114">ExecuteTemplate</span><span class="op" id="8407129">(</span><span class="ident" id="8407130">b</span><span class="op" id="8407131">,</span>&nbsp;<span class="string" id="8407133">&#34;a&#34;</span><span class="op" id="8407136">,</span>&nbsp;<span class="string" id="8407138">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8407145">)</span><span class="op" id="8407146">;</span>&nbsp;<span class="ident" id="8407148">err</span>&nbsp;<span class="op" id="8407152">!=</span>&nbsp;<span class="ident" id="8407155">nil</span>&nbsp;<span class="op" id="8407159">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407163">t</span><span class="op" id="8407164">.</span><span class="ident" id="8407165">Fatal</span><span class="op" id="8407170">(</span><span class="ident" id="8407171">err</span><span class="op" id="8407174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407180">if</span>&nbsp;<span class="ident" id="8407183">got</span><span class="op" id="8407186">,</span>&nbsp;<span class="ident" id="8407188">want</span>&nbsp;<span class="op" id="8407193">:=</span>&nbsp;<span class="ident" id="8407196">b</span><span class="op" id="8407197">.</span><span class="ident" id="8407198">String</span><span class="op" id="8407204">(</span><span class="op" id="8407205">)</span><span class="op" id="8407206">,</span>&nbsp;<span class="string" id="8407208">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="8407227">;</span>&nbsp;<span class="ident" id="8407229">got</span>&nbsp;<span class="op" id="8407233">!=</span>&nbsp;<span class="ident" id="8407236">want</span>&nbsp;<span class="op" id="8407241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407245">t</span><span class="op" id="8407246">.</span><span class="ident" id="8407247">Errorf</span><span class="op" id="8407253">(</span><span class="string" id="8407254">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8407274">,</span>&nbsp;<span class="ident" id="8407276">got</span><span class="op" id="8407279">,</span>&nbsp;<span class="ident" id="8407281">want</span><span class="op" id="8407285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407288">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407292">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407352">if</span>&nbsp;<span class="ident" id="8407355">_</span><span class="op" id="8407356">,</span>&nbsp;<span class="ident" id="8407358">err</span>&nbsp;<span class="op" id="8407362">:=</span>&nbsp;<span class="ident" id="8407365">t0</span><span class="op" id="8407367">.</span><span class="ident" id="8407368">Clone</span><span class="op" id="8407373">(</span><span class="op" id="8407374">)</span><span class="op" id="8407375">;</span>&nbsp;<span class="ident" id="8407377">err</span>&nbsp;<span class="op" id="8407381">==</span>&nbsp;<span class="ident" id="8407384">nil</span>&nbsp;<span class="op" id="8407388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407392">t</span><span class="op" id="8407393">.</span><span class="ident" id="8407394">Error</span><span class="op" id="8407399">(</span><span class="string" id="8407400">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8407438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407441">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407445">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407495">if</span>&nbsp;<span class="ident" id="8407498">_</span><span class="op" id="8407499">,</span>&nbsp;<span class="ident" id="8407501">err</span>&nbsp;<span class="op" id="8407505">:=</span>&nbsp;<span class="ident" id="8407508">t0</span><span class="op" id="8407510">.</span><span class="ident" id="8407511">Lookup</span><span class="op" id="8407517">(</span><span class="string" id="8407518">&#34;a&#34;</span><span class="op" id="8407521">)</span><span class="op" id="8407522">.</span><span class="ident" id="8407523">Clone</span><span class="op" id="8407528">(</span><span class="op" id="8407529">)</span><span class="op" id="8407530">;</span>&nbsp;<span class="ident" id="8407532">err</span>&nbsp;<span class="op" id="8407536">==</span>&nbsp;<span class="ident" id="8407539">nil</span>&nbsp;<span class="op" id="8407543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407547">t</span><span class="op" id="8407548">.</span><span class="ident" id="8407549">Error</span><span class="op" id="8407554">(</span><span class="string" id="8407555">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8407605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407608">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407611">if</span>&nbsp;<span class="ident" id="8407614">_</span><span class="op" id="8407615">,</span>&nbsp;<span class="ident" id="8407617">err</span>&nbsp;<span class="op" id="8407621">:=</span>&nbsp;<span class="ident" id="8407624">t0</span><span class="op" id="8407626">.</span><span class="ident" id="8407627">Lookup</span><span class="op" id="8407633">(</span><span class="string" id="8407634">&#34;lhs&#34;</span><span class="op" id="8407639">)</span><span class="op" id="8407640">.</span><span class="ident" id="8407641">Clone</span><span class="op" id="8407646">(</span><span class="op" id="8407647">)</span><span class="op" id="8407648">;</span>&nbsp;<span class="ident" id="8407650">err</span>&nbsp;<span class="op" id="8407654">==</span>&nbsp;<span class="ident" id="8407657">nil</span>&nbsp;<span class="op" id="8407661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407665">t</span><span class="op" id="8407666">.</span><span class="ident" id="8407667">Error</span><span class="op" id="8407672">(</span><span class="string" id="8407673">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="8407725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8407732">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407748">b</span><span class="op" id="8407749">.</span><span class="ident" id="8407750">Reset</span><span class="op" id="8407755">(</span><span class="op" id="8407756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407759">if</span>&nbsp;<span class="ident" id="8407762">err</span>&nbsp;<span class="op" id="8407766">:=</span>&nbsp;<span class="ident" id="8407769">t3</span><span class="op" id="8407771">.</span><span class="ident" id="8407772">ExecuteTemplate</span><span class="op" id="8407787">(</span><span class="ident" id="8407788">b</span><span class="op" id="8407789">,</span>&nbsp;<span class="string" id="8407791">&#34;a&#34;</span><span class="op" id="8407794">,</span>&nbsp;<span class="string" id="8407796">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="8407803">)</span><span class="op" id="8407804">;</span>&nbsp;<span class="ident" id="8407806">err</span>&nbsp;<span class="op" id="8407810">!=</span>&nbsp;<span class="ident" id="8407813">nil</span>&nbsp;<span class="op" id="8407817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407821">t</span><span class="op" id="8407822">.</span><span class="ident" id="8407823">Fatal</span><span class="op" id="8407828">(</span><span class="ident" id="8407829">err</span><span class="op" id="8407832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8407838">if</span>&nbsp;<span class="ident" id="8407841">got</span><span class="op" id="8407844">,</span>&nbsp;<span class="ident" id="8407846">want</span>&nbsp;<span class="op" id="8407851">:=</span>&nbsp;<span class="ident" id="8407854">b</span><span class="op" id="8407855">.</span><span class="ident" id="8407856">String</span><span class="op" id="8407862">(</span><span class="op" id="8407863">)</span><span class="op" id="8407864">,</span>&nbsp;<span class="string" id="8407866">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="8407895">;</span>&nbsp;<span class="ident" id="8407897">got</span>&nbsp;<span class="op" id="8407901">!=</span>&nbsp;<span class="ident" id="8407904">want</span>&nbsp;<span class="op" id="8407909">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407913">t</span><span class="op" id="8407914">.</span><span class="ident" id="8407915">Errorf</span><span class="op" id="8407921">(</span><span class="string" id="8407922">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8407942">,</span>&nbsp;<span class="ident" id="8407944">got</span><span class="op" id="8407947">,</span>&nbsp;<span class="ident" id="8407949">want</span><span class="op" id="8407953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8407956">}</span><br>
<span class="lineno"></span><span class="op" id="8407958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8407961">func</span>&nbsp;<span class="ident" id="8407966">TestTemplates</span><span class="op" id="8407979">(</span><span class="ident" id="8407980">t</span>&nbsp;<span class="op" id="8407982">*</span><span class="ident" id="8407983">testing</span><span class="op" id="8407990">.</span><span class="ident" id="8407991">T</span><span class="op" id="8407992">)</span>&nbsp;<span class="op" id="8407994">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8407997">names</span>&nbsp;<span class="op" id="8408003">:=</span>&nbsp;<span class="op" id="8408006">[</span><span class="op" id="8408007">]</span><span class="builtintype" id="8408008">string</span><span class="op" id="8408014">{</span><span class="string" id="8408015">&#34;t0&#34;</span><span class="op" id="8408019">,</span>&nbsp;<span class="string" id="8408021">&#34;a&#34;</span><span class="op" id="8408024">,</span>&nbsp;<span class="string" id="8408026">&#34;lhs&#34;</span><span class="op" id="8408031">,</span>&nbsp;<span class="string" id="8408033">&#34;rhs&#34;</span><span class="op" id="8408038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8408041">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408096">const</span>&nbsp;<span class="ident" id="8408102">tmpl</span>&nbsp;<span class="op" id="8408107">=</span>&nbsp;<span class="string" id="8408109">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408249">t0</span>&nbsp;<span class="op" id="8408252">:=</span>&nbsp;<span class="ident" id="8408255">Must</span><span class="op" id="8408259">(</span><span class="ident" id="8408260">New</span><span class="op" id="8408263">(</span><span class="string" id="8408264">&#34;t0&#34;</span><span class="op" id="8408268">)</span><span class="op" id="8408269">.</span><span class="ident" id="8408270">Parse</span><span class="op" id="8408275">(</span><span class="ident" id="8408276">tmpl</span><span class="op" id="8408280">)</span><span class="op" id="8408281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408284">templates</span>&nbsp;<span class="op" id="8408294">:=</span>&nbsp;<span class="ident" id="8408297">t0</span><span class="op" id="8408299">.</span><span class="ident" id="8408300">Templates</span><span class="op" id="8408309">(</span><span class="op" id="8408310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408313">if</span>&nbsp;<span class="builtinfunc" id="8408316">len</span><span class="op" id="8408319">(</span><span class="ident" id="8408320">templates</span><span class="op" id="8408329">)</span>&nbsp;<span class="op" id="8408331">!=</span>&nbsp;<span class="builtinfunc" id="8408334">len</span><span class="op" id="8408337">(</span><span class="ident" id="8408338">names</span><span class="op" id="8408343">)</span>&nbsp;<span class="op" id="8408345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408349">t</span><span class="op" id="8408350">.</span><span class="ident" id="8408351">Errorf</span><span class="op" id="8408357">(</span><span class="string" id="8408358">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8408389">,</span>&nbsp;<span class="builtinfunc" id="8408391">len</span><span class="op" id="8408394">(</span><span class="ident" id="8408395">names</span><span class="op" id="8408400">)</span><span class="op" id="8408401">,</span>&nbsp;<span class="builtinfunc" id="8408403">len</span><span class="op" id="8408406">(</span><span class="ident" id="8408407">templates</span><span class="op" id="8408416">)</span><span class="op" id="8408417">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408423">for</span>&nbsp;<span class="ident" id="8408427">_</span><span class="op" id="8408428">,</span>&nbsp;<span class="ident" id="8408430">name</span>&nbsp;<span class="op" id="8408435">:=</span>&nbsp;<span class="keyword" id="8408438">range</span>&nbsp;<span class="ident" id="8408444">names</span>&nbsp;<span class="op" id="8408450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408454">found</span>&nbsp;<span class="op" id="8408460">:=</span>&nbsp;<span class="builtintype" id="8408463">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408471">for</span>&nbsp;<span class="ident" id="8408475">_</span><span class="op" id="8408476">,</span>&nbsp;<span class="ident" id="8408478">tmpl</span>&nbsp;<span class="op" id="8408483">:=</span>&nbsp;<span class="keyword" id="8408486">range</span>&nbsp;<span class="ident" id="8408492">templates</span>&nbsp;<span class="op" id="8408502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408507">if</span>&nbsp;<span class="ident" id="8408510">name</span>&nbsp;<span class="op" id="8408515">==</span>&nbsp;<span class="ident" id="8408518">tmpl</span><span class="op" id="8408522">.</span><span class="ident" id="8408523">text</span><span class="op" id="8408527">.</span><span class="ident" id="8408528">Name</span><span class="op" id="8408532">(</span><span class="op" id="8408533">)</span>&nbsp;<span class="op" id="8408535">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408541">found</span>&nbsp;<span class="op" id="8408547">=</span>&nbsp;<span class="builtintype" id="8408549">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408558">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408575">if</span>&nbsp;<span class="op" id="8408578">!</span><span class="ident" id="8408579">found</span>&nbsp;<span class="op" id="8408585">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408590">t</span><span class="op" id="8408591">.</span><span class="ident" id="8408592">Error</span><span class="op" id="8408597">(</span><span class="string" id="8408598">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="8408623">,</span>&nbsp;<span class="ident" id="8408625">name</span><span class="op" id="8408629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408636">}</span><br>
<span class="lineno"></span><span class="op" id="8408638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="8408641">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="8408693">func</span>&nbsp;<span class="ident" id="8408698">TestCloneCrash</span><span class="op" id="8408712">(</span><span class="ident" id="8408713">t</span>&nbsp;<span class="op" id="8408715">*</span><span class="ident" id="8408716">testing</span><span class="op" id="8408723">.</span><span class="ident" id="8408724">T</span><span class="op" id="8408725">)</span>&nbsp;<span class="op" id="8408727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408730">t1</span>&nbsp;<span class="op" id="8408733">:=</span>&nbsp;<span class="ident" id="8408736">New</span><span class="op" id="8408739">(</span><span class="string" id="8408740">&#34;all&#34;</span><span class="op" id="8408745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408748">Must</span><span class="op" id="8408752">(</span><span class="ident" id="8408753">t1</span><span class="op" id="8408755">.</span><span class="ident" id="8408756">New</span><span class="op" id="8408759">(</span><span class="string" id="8408760">&#34;t1&#34;</span><span class="op" id="8408764">)</span><span class="op" id="8408765">.</span><span class="ident" id="8408766">Parse</span><span class="op" id="8408771">(</span><span class="string" id="8408772">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="8408800">)</span><span class="op" id="8408801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408804">t1</span><span class="op" id="8408806">.</span><span class="ident" id="8408807">Clone</span><span class="op" id="8408812">(</span><span class="op" id="8408813">)</span><br>
<span class="lineno">150</span><span class="op" id="8408815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8408818">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="8408873">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="8408931">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="8408972">func</span>&nbsp;<span class="ident" id="8408977">TestCloneThenParse</span><span class="op" id="8408995">(</span><span class="ident" id="8408996">t</span>&nbsp;<span class="op" id="8408998">*</span><span class="ident" id="8408999">testing</span><span class="op" id="8409006">.</span><span class="ident" id="8409007">T</span><span class="op" id="8409008">)</span>&nbsp;<span class="op" id="8409010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409013">t0</span>&nbsp;<span class="op" id="8409016">:=</span>&nbsp;<span class="ident" id="8409019">Must</span><span class="op" id="8409023">(</span><span class="ident" id="8409024">New</span><span class="op" id="8409027">(</span><span class="string" id="8409028">&#34;t0&#34;</span><span class="op" id="8409032">)</span><span class="op" id="8409033">.</span><span class="ident" id="8409034">Parse</span><span class="op" id="8409039">(</span><span class="string" id="8409040">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="8409086">)</span><span class="op" id="8409087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409090">t1</span>&nbsp;<span class="op" id="8409093">:=</span>&nbsp;<span class="ident" id="8409096">Must</span><span class="op" id="8409100">(</span><span class="ident" id="8409101">t0</span><span class="op" id="8409103">.</span><span class="ident" id="8409104">Clone</span><span class="op" id="8409109">(</span><span class="op" id="8409110">)</span><span class="op" id="8409111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409114">Must</span><span class="op" id="8409118">(</span><span class="ident" id="8409119">t1</span><span class="op" id="8409121">.</span><span class="ident" id="8409122">Parse</span><span class="op" id="8409127">(</span><span class="string" id="8409128">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="8409160">)</span><span class="op" id="8409161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409164">if</span>&nbsp;<span class="builtinfunc" id="8409167">len</span><span class="op" id="8409170">(</span><span class="ident" id="8409171">t0</span><span class="op" id="8409173">.</span><span class="ident" id="8409174">Templates</span><span class="op" id="8409183">(</span><span class="op" id="8409184">)</span><span class="op" id="8409185">)</span><span class="op" id="8409186">+</span><span class="num" id="8409187">1</span>&nbsp;<span class="op" id="8409189">!=</span>&nbsp;<span class="builtinfunc" id="8409192">len</span><span class="op" id="8409195">(</span><span class="ident" id="8409196">t1</span><span class="op" id="8409198">.</span><span class="ident" id="8409199">Templates</span><span class="op" id="8409208">(</span><span class="op" id="8409209">)</span><span class="op" id="8409210">)</span>&nbsp;<span class="op" id="8409212">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409216">t</span><span class="op" id="8409217">.</span><span class="ident" id="8409218">Error</span><span class="op" id="8409223">(</span><span class="string" id="8409224">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="8409279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409285">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409361">err</span>&nbsp;<span class="op" id="8409365">:=</span>&nbsp;<span class="ident" id="8409368">t0</span><span class="op" id="8409370">.</span><span class="ident" id="8409371">ExecuteTemplate</span><span class="op" id="8409386">(</span><span class="ident" id="8409387">ioutil</span><span class="op" id="8409393">.</span><span class="ident" id="8409394">Discard</span><span class="op" id="8409401">,</span>&nbsp;<span class="string" id="8409403">&#34;a&#34;</span><span class="op" id="8409406">,</span>&nbsp;<span class="ident" id="8409408">nil</span><span class="op" id="8409411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409414">if</span>&nbsp;<span class="ident" id="8409417">err</span>&nbsp;<span class="op" id="8409421">==</span>&nbsp;<span class="ident" id="8409424">nil</span>&nbsp;<span class="op" id="8409428">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409432">t</span><span class="op" id="8409433">.</span><span class="ident" id="8409434">Error</span><span class="op" id="8409439">(</span><span class="string" id="8409440">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="8409475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409478">}</span><br>
<span class="lineno"></span><span class="op" id="8409480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8409483">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="8409537">func</span>&nbsp;<span class="ident" id="8409542">TestFuncMapWorksAfterClone</span><span class="op" id="8409568">(</span><span class="ident" id="8409569">t</span>&nbsp;<span class="op" id="8409571">*</span><span class="ident" id="8409572">testing</span><span class="op" id="8409579">.</span><span class="ident" id="8409580">T</span><span class="op" id="8409581">)</span>&nbsp;<span class="op" id="8409583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409586">funcs</span>&nbsp;<span class="op" id="8409592">:=</span>&nbsp;<span class="ident" id="8409595">FuncMap</span><span class="op" id="8409602">{</span><span class="string" id="8409603">&#34;customFunc&#34;</span><span class="op" id="8409615">:</span>&nbsp;<span class="keyword" id="8409617">func</span><span class="op" id="8409621">(</span><span class="op" id="8409622">)</span>&nbsp;<span class="op" id="8409624">(</span><span class="builtintype" id="8409625">string</span><span class="op" id="8409631">,</span>&nbsp;<span class="builtintype" id="8409633">error</span><span class="op" id="8409638">)</span>&nbsp;<span class="op" id="8409640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409644">return</span>&nbsp;<span class="string" id="8409651">&#34;&#34;</span><span class="op" id="8409653">,</span>&nbsp;<span class="ident" id="8409655">errors</span><span class="op" id="8409661">.</span><span class="ident" id="8409662">New</span><span class="op" id="8409665">(</span><span class="string" id="8409666">&#34;issue5980&#34;</span><span class="op" id="8409677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409680">}</span><span class="op" id="8409681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409685">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409730">uncloned</span>&nbsp;<span class="op" id="8409739">:=</span>&nbsp;<span class="ident" id="8409742">Must</span><span class="op" id="8409746">(</span><span class="ident" id="8409747">New</span><span class="op" id="8409750">(</span><span class="string" id="8409751">&#34;&#34;</span><span class="op" id="8409753">)</span><span class="op" id="8409754">.</span><span class="ident" id="8409755">Funcs</span><span class="op" id="8409760">(</span><span class="ident" id="8409761">funcs</span><span class="op" id="8409766">)</span><span class="op" id="8409767">.</span><span class="ident" id="8409768">Parse</span><span class="op" id="8409773">(</span><span class="string" id="8409774">&#34;{{customFunc}}&#34;</span><span class="op" id="8409790">)</span><span class="op" id="8409791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409794">wantErr</span>&nbsp;<span class="op" id="8409802">:=</span>&nbsp;<span class="ident" id="8409805">uncloned</span><span class="op" id="8409813">.</span><span class="ident" id="8409814">Execute</span><span class="op" id="8409821">(</span><span class="ident" id="8409822">ioutil</span><span class="op" id="8409828">.</span><span class="ident" id="8409829">Discard</span><span class="op" id="8409836">,</span>&nbsp;<span class="ident" id="8409838">nil</span><span class="op" id="8409841">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409845">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8409924">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409972">toClone</span>&nbsp;<span class="op" id="8409980">:=</span>&nbsp;<span class="ident" id="8409983">Must</span><span class="op" id="8409987">(</span><span class="ident" id="8409988">New</span><span class="op" id="8409991">(</span><span class="string" id="8409992">&#34;&#34;</span><span class="op" id="8409994">)</span><span class="op" id="8409995">.</span><span class="ident" id="8409996">Funcs</span><span class="op" id="8410001">(</span><span class="ident" id="8410002">funcs</span><span class="op" id="8410007">)</span><span class="op" id="8410008">.</span><span class="ident" id="8410009">Parse</span><span class="op" id="8410014">(</span><span class="string" id="8410015">&#34;{{customFunc}}&#34;</span><span class="op" id="8410031">)</span><span class="op" id="8410032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410035">cloned</span>&nbsp;<span class="op" id="8410042">:=</span>&nbsp;<span class="ident" id="8410045">Must</span><span class="op" id="8410049">(</span><span class="ident" id="8410050">toClone</span><span class="op" id="8410057">.</span><span class="ident" id="8410058">Clone</span><span class="op" id="8410063">(</span><span class="op" id="8410064">)</span><span class="op" id="8410065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410068">gotErr</span>&nbsp;<span class="op" id="8410075">:=</span>&nbsp;<span class="ident" id="8410078">cloned</span><span class="op" id="8410084">.</span><span class="ident" id="8410085">Execute</span><span class="op" id="8410092">(</span><span class="ident" id="8410093">ioutil</span><span class="op" id="8410099">.</span><span class="ident" id="8410100">Discard</span><span class="op" id="8410107">,</span>&nbsp;<span class="ident" id="8410109">nil</span><span class="op" id="8410112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8410116">if</span>&nbsp;<span class="ident" id="8410119">wantErr</span><span class="op" id="8410126">.</span><span class="ident" id="8410127">Error</span><span class="op" id="8410132">(</span><span class="op" id="8410133">)</span>&nbsp;<span class="op" id="8410135">!=</span>&nbsp;<span class="ident" id="8410138">gotErr</span><span class="op" id="8410144">.</span><span class="ident" id="8410145">Error</span><span class="op" id="8410150">(</span><span class="op" id="8410151">)</span>&nbsp;<span class="op" id="8410153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8410157">t</span><span class="op" id="8410158">.</span><span class="ident" id="8410159">Errorf</span><span class="op" id="8410165">(</span><span class="string" id="8410166">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8410211">,</span>&nbsp;<span class="ident" id="8410213">wantErr</span><span class="op" id="8410220">,</span>&nbsp;<span class="ident" id="8410222">gotErr</span><span class="op" id="8410228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8410231">}</span><br>
<span class="lineno"></span><span class="op" id="8410233">}</span>
</div>
</body>
</html>
