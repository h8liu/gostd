<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/format</h2>
<ul>
<li><a href="/gostd/go/format/format.go.html">format.go</a></li>
<li><a href="/gostd/go/format/format_test.go.html">format_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6360952">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6361007">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6361061">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6361112">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="6361175">package</span>&nbsp;<span class="ident" id="6361183">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6361191">import</span>&nbsp;<span class="op" id="6361198">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361201">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361210">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361217">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361227">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361240">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361254">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361266">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6361272">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6361282">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6361285">var</span>&nbsp;<span class="ident" id="6361289">config</span>&nbsp;<span class="op" id="6361296">=</span>&nbsp;<span class="ident" id="6361298">printer</span><span class="op" id="6361305">.</span><span class="ident" id="6361306">Config</span><span class="op" id="6361312">{</span><span class="ident" id="6361313">Mode</span><span class="op" id="6361317">:</span>&nbsp;<span class="ident" id="6361319">printer</span><span class="op" id="6361326">.</span><span class="ident" id="6361327">UseSpaces</span>&nbsp;<span class="op" id="6361337">|</span>&nbsp;<span class="ident" id="6361339">printer</span><span class="op" id="6361346">.</span><span class="ident" id="6361347">TabIndent</span><span class="op" id="6361356">,</span>&nbsp;<span class="ident" id="6361358">Tabwidth</span><span class="op" id="6361366">:</span>&nbsp;<span class="num" id="6361368">8</span><span class="op" id="6361369">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="6361372">const</span>&nbsp;<span class="ident" id="6361378">parserMode</span>&nbsp;<span class="op" id="6361389">=</span>&nbsp;<span class="ident" id="6361391">parser</span><span class="op" id="6361397">.</span><span class="ident" id="6361398">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6361413">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="6361489">//</span><br>
<span class="lineno">25</span><span class="comment" id="6361492">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="6361564">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="6361637">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6361707">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6361779">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="6361848">//</span><br>
<span class="lineno"></span><span class="comment" id="6361851">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="6361922">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="6361994">//</span><br>
<span class="lineno"></span><span class="keyword" id="6361997">func</span>&nbsp;<span class="ident" id="6362002">Node</span><span class="op" id="6362006">(</span><span class="ident" id="6362007">dst</span>&nbsp;<span class="ident" id="6362011">io</span><span class="op" id="6362013">.</span><span class="ident" id="6362014">Writer</span><span class="op" id="6362020">,</span>&nbsp;<span class="ident" id="6362022">fset</span>&nbsp;<span class="op" id="6362027">*</span><span class="ident" id="6362028">token</span><span class="op" id="6362033">.</span><span class="ident" id="6362034">FileSet</span><span class="op" id="6362041">,</span>&nbsp;<span class="ident" id="6362043">node</span>&nbsp;<span class="keyword" id="6362048">interface</span><span class="op" id="6362057">{</span><span class="op" id="6362058">}</span><span class="op" id="6362059">)</span>&nbsp;<span class="builtintype" id="6362061">error</span>&nbsp;<span class="op" id="6362067">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362070">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362133">var</span>&nbsp;<span class="ident" id="6362137">file</span>&nbsp;<span class="op" id="6362142">*</span><span class="ident" id="6362143">ast</span><span class="op" id="6362146">.</span><span class="ident" id="6362147">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362153">var</span>&nbsp;<span class="ident" id="6362157">cnode</span>&nbsp;<span class="op" id="6362163">*</span><span class="ident" id="6362164">printer</span><span class="op" id="6362171">.</span><span class="ident" id="6362172">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362187">switch</span>&nbsp;<span class="ident" id="6362194">n</span>&nbsp;<span class="op" id="6362196">:=</span>&nbsp;<span class="ident" id="6362199">node</span><span class="op" id="6362203">.</span><span class="op" id="6362204">(</span><span class="keyword" id="6362205">type</span><span class="op" id="6362209">)</span>&nbsp;<span class="op" id="6362211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362214">case</span>&nbsp;<span class="op" id="6362219">*</span><span class="ident" id="6362220">ast</span><span class="op" id="6362223">.</span><span class="ident" id="6362224">File</span><span class="op" id="6362228">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362232">file</span>&nbsp;<span class="op" id="6362237">=</span>&nbsp;<span class="ident" id="6362239">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362242">case</span>&nbsp;<span class="op" id="6362247">*</span><span class="ident" id="6362248">printer</span><span class="op" id="6362255">.</span><span class="ident" id="6362256">CommentedNode</span><span class="op" id="6362269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362273">if</span>&nbsp;<span class="ident" id="6362276">f</span><span class="op" id="6362277">,</span>&nbsp;<span class="ident" id="6362279">ok</span>&nbsp;<span class="op" id="6362282">:=</span>&nbsp;<span class="ident" id="6362285">n</span><span class="op" id="6362286">.</span><span class="ident" id="6362287">Node</span><span class="op" id="6362291">.</span><span class="op" id="6362292">(</span><span class="op" id="6362293">*</span><span class="ident" id="6362294">ast</span><span class="op" id="6362297">.</span><span class="ident" id="6362298">File</span><span class="op" id="6362302">)</span><span class="op" id="6362303">;</span>&nbsp;<span class="ident" id="6362305">ok</span>&nbsp;<span class="op" id="6362308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362313">file</span>&nbsp;<span class="op" id="6362318">=</span>&nbsp;<span class="ident" id="6362320">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362325">cnode</span>&nbsp;<span class="op" id="6362331">=</span>&nbsp;<span class="ident" id="6362333">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362344">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362375">if</span>&nbsp;<span class="ident" id="6362378">file</span>&nbsp;<span class="op" id="6362383">!=</span>&nbsp;<span class="ident" id="6362386">nil</span>&nbsp;<span class="op" id="6362390">&amp;&amp;</span>&nbsp;<span class="ident" id="6362393">hasUnsortedImports</span><span class="op" id="6362411">(</span><span class="ident" id="6362412">file</span><span class="op" id="6362416">)</span>&nbsp;<span class="op" id="6362418">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362422">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362490">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362531">var</span>&nbsp;<span class="ident" id="6362535">buf</span>&nbsp;<span class="ident" id="6362539">bytes</span><span class="op" id="6362544">.</span><span class="ident" id="6362545">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362554">err</span>&nbsp;<span class="op" id="6362558">:=</span>&nbsp;<span class="ident" id="6362561">config</span><span class="op" id="6362567">.</span><span class="ident" id="6362568">Fprint</span><span class="op" id="6362574">(</span><span class="op" id="6362575">&amp;</span><span class="ident" id="6362576">buf</span><span class="op" id="6362579">,</span>&nbsp;<span class="ident" id="6362581">fset</span><span class="op" id="6362585">,</span>&nbsp;<span class="ident" id="6362587">file</span><span class="op" id="6362591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362595">if</span>&nbsp;<span class="ident" id="6362598">err</span>&nbsp;<span class="op" id="6362602">!=</span>&nbsp;<span class="ident" id="6362605">nil</span>&nbsp;<span class="op" id="6362609">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362614">return</span>&nbsp;<span class="ident" id="6362621">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362631">file</span><span class="op" id="6362635">,</span>&nbsp;<span class="ident" id="6362637">err</span>&nbsp;<span class="op" id="6362641">=</span>&nbsp;<span class="ident" id="6362643">parser</span><span class="op" id="6362649">.</span><span class="ident" id="6362650">ParseFile</span><span class="op" id="6362659">(</span><span class="ident" id="6362660">fset</span><span class="op" id="6362664">,</span>&nbsp;<span class="string" id="6362666">&#34;&#34;</span><span class="op" id="6362668">,</span>&nbsp;<span class="ident" id="6362670">buf</span><span class="op" id="6362673">.</span><span class="ident" id="6362674">Bytes</span><span class="op" id="6362679">(</span><span class="op" id="6362680">)</span><span class="op" id="6362681">,</span>&nbsp;<span class="ident" id="6362683">parserMode</span><span class="op" id="6362693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362697">if</span>&nbsp;<span class="ident" id="6362700">err</span>&nbsp;<span class="op" id="6362704">!=</span>&nbsp;<span class="ident" id="6362707">nil</span>&nbsp;<span class="op" id="6362711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362716">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362783">return</span>&nbsp;<span class="ident" id="6362790">fmt</span><span class="op" id="6362793">.</span><span class="ident" id="6362794">Errorf</span><span class="op" id="6362800">(</span><span class="string" id="6362801">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="6362834">,</span>&nbsp;<span class="ident" id="6362836">err</span><span class="op" id="6362839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362847">ast</span><span class="op" id="6362850">.</span><span class="ident" id="6362851">SortImports</span><span class="op" id="6362862">(</span><span class="ident" id="6362863">fset</span><span class="op" id="6362867">,</span>&nbsp;<span class="ident" id="6362869">file</span><span class="op" id="6362873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362878">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362917">node</span>&nbsp;<span class="op" id="6362922">=</span>&nbsp;<span class="ident" id="6362924">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362931">if</span>&nbsp;<span class="ident" id="6362934">cnode</span>&nbsp;<span class="op" id="6362940">!=</span>&nbsp;<span class="ident" id="6362943">nil</span>&nbsp;<span class="op" id="6362947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362952">node</span>&nbsp;<span class="op" id="6362957">=</span>&nbsp;<span class="op" id="6362959">&amp;</span><span class="ident" id="6362960">printer</span><span class="op" id="6362967">.</span><span class="ident" id="6362968">CommentedNode</span><span class="op" id="6362981">{</span><span class="ident" id="6362982">Node</span><span class="op" id="6362986">:</span>&nbsp;<span class="ident" id="6362988">file</span><span class="op" id="6362992">,</span>&nbsp;<span class="ident" id="6362994">Comments</span><span class="op" id="6363002">:</span>&nbsp;<span class="ident" id="6363004">cnode</span><span class="op" id="6363009">.</span><span class="ident" id="6363010">Comments</span><span class="op" id="6363018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363025">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363029">return</span>&nbsp;<span class="ident" id="6363036">config</span><span class="op" id="6363042">.</span><span class="ident" id="6363043">Fprint</span><span class="op" id="6363049">(</span><span class="ident" id="6363050">dst</span><span class="op" id="6363053">,</span>&nbsp;<span class="ident" id="6363055">fset</span><span class="op" id="6363059">,</span>&nbsp;<span class="ident" id="6363061">node</span><span class="op" id="6363065">)</span><br>
<span class="lineno"></span><span class="op" id="6363067">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363070">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="6363140">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="6363210">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="6363281">//</span><br>
<span class="lineno"></span><span class="comment" id="6363284">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6363358">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="6363434">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="6363511">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="6363592">//</span><br>
<span class="lineno"></span><span class="keyword" id="6363595">func</span>&nbsp;<span class="ident" id="6363600">Source</span><span class="op" id="6363606">(</span><span class="ident" id="6363607">src</span>&nbsp;<span class="op" id="6363611">[</span><span class="op" id="6363612">]</span><span class="builtintype" id="6363613">byte</span><span class="op" id="6363617">)</span>&nbsp;<span class="op" id="6363619">(</span><span class="op" id="6363620">[</span><span class="op" id="6363621">]</span><span class="builtintype" id="6363622">byte</span><span class="op" id="6363626">,</span>&nbsp;<span class="builtintype" id="6363628">error</span><span class="op" id="6363633">)</span>&nbsp;<span class="op" id="6363635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363638">fset</span>&nbsp;<span class="op" id="6363643">:=</span>&nbsp;<span class="ident" id="6363646">token</span><span class="op" id="6363651">.</span><span class="ident" id="6363652">NewFileSet</span><span class="op" id="6363662">(</span><span class="op" id="6363663">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363666">file</span><span class="op" id="6363670">,</span>&nbsp;<span class="ident" id="6363672">sourceAdj</span><span class="op" id="6363681">,</span>&nbsp;<span class="ident" id="6363683">indentAdj</span><span class="op" id="6363692">,</span>&nbsp;<span class="ident" id="6363694">err</span>&nbsp;<span class="op" id="6363698">:=</span>&nbsp;<span class="ident" id="6363701">parse</span><span class="op" id="6363706">(</span><span class="ident" id="6363707">fset</span><span class="op" id="6363711">,</span>&nbsp;<span class="string" id="6363713">&#34;&#34;</span><span class="op" id="6363715">,</span>&nbsp;<span class="ident" id="6363717">src</span><span class="op" id="6363720">,</span>&nbsp;<span class="builtintype" id="6363722">true</span><span class="op" id="6363726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363729">if</span>&nbsp;<span class="ident" id="6363732">err</span>&nbsp;<span class="op" id="6363736">!=</span>&nbsp;<span class="ident" id="6363739">nil</span>&nbsp;<span class="op" id="6363743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363747">return</span>&nbsp;<span class="ident" id="6363754">nil</span><span class="op" id="6363757">,</span>&nbsp;<span class="ident" id="6363759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363768">if</span>&nbsp;<span class="ident" id="6363771">sourceAdj</span>&nbsp;<span class="op" id="6363781">==</span>&nbsp;<span class="ident" id="6363784">nil</span>&nbsp;<span class="op" id="6363788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363792">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363819">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363862">ast</span><span class="op" id="6363865">.</span><span class="ident" id="6363866">SortImports</span><span class="op" id="6363877">(</span><span class="ident" id="6363878">fset</span><span class="op" id="6363882">,</span>&nbsp;<span class="ident" id="6363884">file</span><span class="op" id="6363888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363891">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363895">return</span>&nbsp;<span class="ident" id="6363902">format</span><span class="op" id="6363908">(</span><span class="ident" id="6363909">fset</span><span class="op" id="6363913">,</span>&nbsp;<span class="ident" id="6363915">file</span><span class="op" id="6363919">,</span>&nbsp;<span class="ident" id="6363921">sourceAdj</span><span class="op" id="6363930">,</span>&nbsp;<span class="ident" id="6363932">indentAdj</span><span class="op" id="6363941">,</span>&nbsp;<span class="ident" id="6363943">src</span><span class="op" id="6363946">,</span>&nbsp;<span class="ident" id="6363948">config</span><span class="op" id="6363954">)</span><br>
<span class="lineno"></span><span class="op" id="6363956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6363959">func</span>&nbsp;<span class="ident" id="6363964">hasUnsortedImports</span><span class="op" id="6363982">(</span><span class="ident" id="6363983">file</span>&nbsp;<span class="op" id="6363988">*</span><span class="ident" id="6363989">ast</span><span class="op" id="6363992">.</span><span class="ident" id="6363993">File</span><span class="op" id="6363997">)</span>&nbsp;<span class="builtintype" id="6363999">bool</span>&nbsp;<span class="op" id="6364004">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364007">for</span>&nbsp;<span class="ident" id="6364011">_</span><span class="op" id="6364012">,</span>&nbsp;<span class="ident" id="6364014">d</span>&nbsp;<span class="op" id="6364016">:=</span>&nbsp;<span class="keyword" id="6364019">range</span>&nbsp;<span class="ident" id="6364025">file</span><span class="op" id="6364029">.</span><span class="ident" id="6364030">Decls</span>&nbsp;<span class="op" id="6364036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364040">d</span><span class="op" id="6364041">,</span>&nbsp;<span class="ident" id="6364043">ok</span>&nbsp;<span class="op" id="6364046">:=</span>&nbsp;<span class="ident" id="6364049">d</span><span class="op" id="6364050">.</span><span class="op" id="6364051">(</span><span class="op" id="6364052">*</span><span class="ident" id="6364053">ast</span><span class="op" id="6364056">.</span><span class="ident" id="6364057">GenDecl</span><span class="op" id="6364064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364068">if</span>&nbsp;<span class="op" id="6364071">!</span><span class="ident" id="6364072">ok</span>&nbsp;<span class="op" id="6364075">||</span>&nbsp;<span class="ident" id="6364078">d</span><span class="op" id="6364079">.</span><span class="ident" id="6364080">Tok</span>&nbsp;<span class="op" id="6364084">!=</span>&nbsp;<span class="ident" id="6364087">token</span><span class="op" id="6364092">.</span><span class="ident" id="6364093">IMPORT</span>&nbsp;<span class="op" id="6364100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6364105">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6364153">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364185">return</span>&nbsp;<span class="builtintype" id="6364192">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364204">if</span>&nbsp;<span class="ident" id="6364207">d</span><span class="op" id="6364208">.</span><span class="ident" id="6364209">Lparen</span><span class="op" id="6364215">.</span><span class="ident" id="6364216">IsValid</span><span class="op" id="6364223">(</span><span class="op" id="6364224">)</span>&nbsp;<span class="op" id="6364226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6364231">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6364286">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364343">return</span>&nbsp;<span class="builtintype" id="6364350">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6364361">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364409">return</span>&nbsp;<span class="builtintype" id="6364416">false</span><br>
<span class="lineno">115</span><span class="op" id="6364422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364425">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="6364505">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="6364526">//</span><br>
<span class="lineno">120</span><span class="comment" id="6364529">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6364600">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="6364667">//</span><br>
<span class="lineno"></span><span class="comment" id="6364670">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="6364727">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="6364784">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="6364840">func</span>&nbsp;<span class="ident" id="6364845">parse</span><span class="op" id="6364850">(</span><span class="ident" id="6364851">fset</span>&nbsp;<span class="op" id="6364856">*</span><span class="ident" id="6364857">token</span><span class="op" id="6364862">.</span><span class="ident" id="6364863">FileSet</span><span class="op" id="6364870">,</span>&nbsp;<span class="ident" id="6364872">filename</span>&nbsp;<span class="builtintype" id="6364881">string</span><span class="op" id="6364887">,</span>&nbsp;<span class="ident" id="6364889">src</span>&nbsp;<span class="op" id="6364893">[</span><span class="op" id="6364894">]</span><span class="builtintype" id="6364895">byte</span><span class="op" id="6364899">,</span>&nbsp;<span class="ident" id="6364901">fragmentOk</span>&nbsp;<span class="builtintype" id="6364912">bool</span><span class="op" id="6364916">)</span>&nbsp;<span class="op" id="6364918">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364921">file</span>&nbsp;<span class="op" id="6364926">*</span><span class="ident" id="6364927">ast</span><span class="op" id="6364930">.</span><span class="ident" id="6364931">File</span><span class="op" id="6364935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364938">sourceAdj</span>&nbsp;<span class="keyword" id="6364948">func</span><span class="op" id="6364952">(</span><span class="ident" id="6364953">src</span>&nbsp;<span class="op" id="6364957">[</span><span class="op" id="6364958">]</span><span class="builtintype" id="6364959">byte</span><span class="op" id="6364963">,</span>&nbsp;<span class="ident" id="6364965">indent</span>&nbsp;<span class="builtintype" id="6364972">int</span><span class="op" id="6364975">)</span>&nbsp;<span class="op" id="6364977">[</span><span class="op" id="6364978">]</span><span class="builtintype" id="6364979">byte</span><span class="op" id="6364983">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364986">indentAdj</span>&nbsp;<span class="builtintype" id="6364996">int</span><span class="op" id="6364999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365002">err</span>&nbsp;<span class="builtintype" id="6365006">error</span><span class="op" id="6365011">,</span><br>
<span class="lineno"></span><span class="op" id="6365013">)</span>&nbsp;<span class="op" id="6365015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365018">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365048">file</span><span class="op" id="6365052">,</span>&nbsp;<span class="ident" id="6365054">err</span>&nbsp;<span class="op" id="6365058">=</span>&nbsp;<span class="ident" id="6365060">parser</span><span class="op" id="6365066">.</span><span class="ident" id="6365067">ParseFile</span><span class="op" id="6365076">(</span><span class="ident" id="6365077">fset</span><span class="op" id="6365081">,</span>&nbsp;<span class="ident" id="6365083">filename</span><span class="op" id="6365091">,</span>&nbsp;<span class="ident" id="6365093">src</span><span class="op" id="6365096">,</span>&nbsp;<span class="ident" id="6365098">parserMode</span><span class="op" id="6365108">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365111">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365202">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365264">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365331">if</span>&nbsp;<span class="ident" id="6365334">err</span>&nbsp;<span class="op" id="6365338">==</span>&nbsp;<span class="ident" id="6365341">nil</span>&nbsp;<span class="op" id="6365345">||</span>&nbsp;<span class="op" id="6365348">!</span><span class="ident" id="6365349">fragmentOk</span>&nbsp;<span class="op" id="6365360">||</span>&nbsp;<span class="op" id="6365363">!</span><span class="ident" id="6365364">strings</span><span class="op" id="6365371">.</span><span class="ident" id="6365372">Contains</span><span class="op" id="6365380">(</span><span class="ident" id="6365381">err</span><span class="op" id="6365384">.</span><span class="ident" id="6365385">Error</span><span class="op" id="6365390">(</span><span class="op" id="6365391">)</span><span class="op" id="6365392">,</span>&nbsp;<span class="string" id="6365394">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="6365414">)</span>&nbsp;<span class="op" id="6365416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365420">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365432">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365489">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365524">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365586">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365621">psrc</span>&nbsp;<span class="op" id="6365626">:=</span>&nbsp;<span class="builtinfunc" id="6365629">append</span><span class="op" id="6365635">(</span><span class="op" id="6365636">[</span><span class="op" id="6365637">]</span><span class="builtintype" id="6365638">byte</span><span class="op" id="6365642">(</span><span class="string" id="6365643">&#34;package&nbsp;p;&#34;</span><span class="op" id="6365655">)</span><span class="op" id="6365656">,</span>&nbsp;<span class="ident" id="6365658">src</span><span class="op" id="6365661">...</span><span class="op" id="6365664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365667">file</span><span class="op" id="6365671">,</span>&nbsp;<span class="ident" id="6365673">err</span>&nbsp;<span class="op" id="6365677">=</span>&nbsp;<span class="ident" id="6365679">parser</span><span class="op" id="6365685">.</span><span class="ident" id="6365686">ParseFile</span><span class="op" id="6365695">(</span><span class="ident" id="6365696">fset</span><span class="op" id="6365700">,</span>&nbsp;<span class="ident" id="6365702">filename</span><span class="op" id="6365710">,</span>&nbsp;<span class="ident" id="6365712">psrc</span><span class="op" id="6365716">,</span>&nbsp;<span class="ident" id="6365718">parserMode</span><span class="op" id="6365728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365731">if</span>&nbsp;<span class="ident" id="6365734">err</span>&nbsp;<span class="op" id="6365738">==</span>&nbsp;<span class="ident" id="6365741">nil</span>&nbsp;<span class="op" id="6365745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365749">sourceAdj</span>&nbsp;<span class="op" id="6365759">=</span>&nbsp;<span class="keyword" id="6365761">func</span><span class="op" id="6365765">(</span><span class="ident" id="6365766">src</span>&nbsp;<span class="op" id="6365770">[</span><span class="op" id="6365771">]</span><span class="builtintype" id="6365772">byte</span><span class="op" id="6365776">,</span>&nbsp;<span class="ident" id="6365778">indent</span>&nbsp;<span class="builtintype" id="6365785">int</span><span class="op" id="6365788">)</span>&nbsp;<span class="op" id="6365790">[</span><span class="op" id="6365791">]</span><span class="builtintype" id="6365792">byte</span>&nbsp;<span class="op" id="6365797">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365802">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365835">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365875">src</span>&nbsp;<span class="op" id="6365879">=</span>&nbsp;<span class="ident" id="6365881">src</span><span class="op" id="6365884">[</span><span class="ident" id="6365885">indent</span><span class="op" id="6365891">+</span><span class="builtinfunc" id="6365892">len</span><span class="op" id="6365895">(</span><span class="string" id="6365896">&#34;package&nbsp;p\n&#34;</span><span class="op" id="6365909">)</span><span class="op" id="6365910">:</span><span class="op" id="6365911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365916">return</span>&nbsp;<span class="ident" id="6365923">bytes</span><span class="op" id="6365928">.</span><span class="ident" id="6365929">TrimSpace</span><span class="op" id="6365938">(</span><span class="ident" id="6365939">src</span><span class="op" id="6365942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365946">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365961">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366022">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366080">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366120">if</span>&nbsp;<span class="op" id="6366123">!</span><span class="ident" id="6366124">strings</span><span class="op" id="6366131">.</span><span class="ident" id="6366132">Contains</span><span class="op" id="6366140">(</span><span class="ident" id="6366141">err</span><span class="op" id="6366144">.</span><span class="ident" id="6366145">Error</span><span class="op" id="6366150">(</span><span class="op" id="6366151">)</span><span class="op" id="6366152">,</span>&nbsp;<span class="string" id="6366154">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="6366176">)</span>&nbsp;<span class="op" id="6366178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366182">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366194">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366249">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366304">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366361">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366423">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366458">fsrc</span>&nbsp;<span class="op" id="6366463">:=</span>&nbsp;<span class="builtinfunc" id="6366466">append</span><span class="op" id="6366472">(</span><span class="builtinfunc" id="6366473">append</span><span class="op" id="6366479">(</span><span class="op" id="6366480">[</span><span class="op" id="6366481">]</span><span class="builtintype" id="6366482">byte</span><span class="op" id="6366486">(</span><span class="string" id="6366487">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6366510">)</span><span class="op" id="6366511">,</span>&nbsp;<span class="ident" id="6366513">src</span><span class="op" id="6366516">...</span><span class="op" id="6366519">)</span><span class="op" id="6366520">,</span>&nbsp;<span class="string" id="6366522">&#39;\n&#39;</span><span class="op" id="6366526">,</span>&nbsp;<span class="string" id="6366528">&#39;}&#39;</span><span class="op" id="6366531">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366534">file</span><span class="op" id="6366538">,</span>&nbsp;<span class="ident" id="6366540">err</span>&nbsp;<span class="op" id="6366544">=</span>&nbsp;<span class="ident" id="6366546">parser</span><span class="op" id="6366552">.</span><span class="ident" id="6366553">ParseFile</span><span class="op" id="6366562">(</span><span class="ident" id="6366563">fset</span><span class="op" id="6366567">,</span>&nbsp;<span class="ident" id="6366569">filename</span><span class="op" id="6366577">,</span>&nbsp;<span class="ident" id="6366579">fsrc</span><span class="op" id="6366583">,</span>&nbsp;<span class="ident" id="6366585">parserMode</span><span class="op" id="6366595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366598">if</span>&nbsp;<span class="ident" id="6366601">err</span>&nbsp;<span class="op" id="6366605">==</span>&nbsp;<span class="ident" id="6366608">nil</span>&nbsp;<span class="op" id="6366612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366616">sourceAdj</span>&nbsp;<span class="op" id="6366626">=</span>&nbsp;<span class="keyword" id="6366628">func</span><span class="op" id="6366632">(</span><span class="ident" id="6366633">src</span>&nbsp;<span class="op" id="6366637">[</span><span class="op" id="6366638">]</span><span class="builtintype" id="6366639">byte</span><span class="op" id="6366643">,</span>&nbsp;<span class="ident" id="6366645">indent</span>&nbsp;<span class="builtintype" id="6366652">int</span><span class="op" id="6366655">)</span>&nbsp;<span class="op" id="6366657">[</span><span class="op" id="6366658">]</span><span class="builtintype" id="6366659">byte</span>&nbsp;<span class="op" id="6366664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366669">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366704">if</span>&nbsp;<span class="ident" id="6366707">indent</span>&nbsp;<span class="op" id="6366714">&lt;</span>&nbsp;<span class="num" id="6366716">0</span>&nbsp;<span class="op" id="6366718">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366724">indent</span>&nbsp;<span class="op" id="6366731">=</span>&nbsp;<span class="num" id="6366733">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366743">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366770">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6366812">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366881">src</span>&nbsp;<span class="op" id="6366885">=</span>&nbsp;<span class="ident" id="6366887">src</span><span class="op" id="6366890">[</span><span class="num" id="6366891">2</span><span class="op" id="6366892">*</span><span class="ident" id="6366893">indent</span><span class="op" id="6366899">+</span><span class="builtinfunc" id="6366900">len</span><span class="op" id="6366903">(</span><span class="string" id="6366904">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="6366929">)</span><span class="op" id="6366930">:</span><span class="op" id="6366931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366936">src</span>&nbsp;<span class="op" id="6366940">=</span>&nbsp;<span class="ident" id="6366942">src</span><span class="op" id="6366945">[</span><span class="op" id="6366946">:</span><span class="builtinfunc" id="6366947">len</span><span class="op" id="6366950">(</span><span class="ident" id="6366951">src</span><span class="op" id="6366954">)</span><span class="op" id="6366955">-</span><span class="op" id="6366956">(</span><span class="ident" id="6366957">indent</span><span class="op" id="6366963">+</span><span class="builtinfunc" id="6366964">len</span><span class="op" id="6366967">(</span><span class="string" id="6366968">&#34;\n}\n&#34;</span><span class="op" id="6366975">)</span><span class="op" id="6366976">)</span><span class="op" id="6366977">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366982">return</span>&nbsp;<span class="ident" id="6366989">bytes</span><span class="op" id="6366994">.</span><span class="ident" id="6366995">TrimSpace</span><span class="op" id="6367004">(</span><span class="ident" id="6367005">src</span><span class="op" id="6367008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367016">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367074">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367107">indentAdj</span>&nbsp;<span class="op" id="6367117">=</span>&nbsp;<span class="op" id="6367119">-</span><span class="num" id="6367120">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367127">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367161">return</span><br>
<span class="lineno"></span><span class="op" id="6367168">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6367171">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="6367241">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="6367310">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="6367328">func</span>&nbsp;<span class="ident" id="6367333">format</span><span class="op" id="6367339">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367342">fset</span>&nbsp;<span class="op" id="6367347">*</span><span class="ident" id="6367348">token</span><span class="op" id="6367353">.</span><span class="ident" id="6367354">FileSet</span><span class="op" id="6367361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367364">file</span>&nbsp;<span class="op" id="6367369">*</span><span class="ident" id="6367370">ast</span><span class="op" id="6367373">.</span><span class="ident" id="6367374">File</span><span class="op" id="6367378">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367381">sourceAdj</span>&nbsp;<span class="keyword" id="6367391">func</span><span class="op" id="6367395">(</span><span class="ident" id="6367396">src</span>&nbsp;<span class="op" id="6367400">[</span><span class="op" id="6367401">]</span><span class="builtintype" id="6367402">byte</span><span class="op" id="6367406">,</span>&nbsp;<span class="ident" id="6367408">indent</span>&nbsp;<span class="builtintype" id="6367415">int</span><span class="op" id="6367418">)</span>&nbsp;<span class="op" id="6367420">[</span><span class="op" id="6367421">]</span><span class="builtintype" id="6367422">byte</span><span class="op" id="6367426">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367429">indentAdj</span>&nbsp;<span class="builtintype" id="6367439">int</span><span class="op" id="6367442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367445">src</span>&nbsp;<span class="op" id="6367449">[</span><span class="op" id="6367450">]</span><span class="builtintype" id="6367451">byte</span><span class="op" id="6367455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367458">cfg</span>&nbsp;<span class="ident" id="6367462">printer</span><span class="op" id="6367469">.</span><span class="ident" id="6367470">Config</span><span class="op" id="6367476">,</span><br>
<span class="lineno"></span><span class="op" id="6367478">)</span>&nbsp;<span class="op" id="6367480">(</span><span class="op" id="6367481">[</span><span class="op" id="6367482">]</span><span class="builtintype" id="6367483">byte</span><span class="op" id="6367487">,</span>&nbsp;<span class="builtintype" id="6367489">error</span><span class="op" id="6367494">)</span>&nbsp;<span class="op" id="6367496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367499">if</span>&nbsp;<span class="ident" id="6367502">sourceAdj</span>&nbsp;<span class="op" id="6367512">==</span>&nbsp;<span class="ident" id="6367515">nil</span>&nbsp;<span class="op" id="6367519">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367523">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367550">var</span>&nbsp;<span class="ident" id="6367554">buf</span>&nbsp;<span class="ident" id="6367558">bytes</span><span class="op" id="6367563">.</span><span class="ident" id="6367564">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367573">err</span>&nbsp;<span class="op" id="6367577">:=</span>&nbsp;<span class="ident" id="6367580">cfg</span><span class="op" id="6367583">.</span><span class="ident" id="6367584">Fprint</span><span class="op" id="6367590">(</span><span class="op" id="6367591">&amp;</span><span class="ident" id="6367592">buf</span><span class="op" id="6367595">,</span>&nbsp;<span class="ident" id="6367597">fset</span><span class="op" id="6367601">,</span>&nbsp;<span class="ident" id="6367603">file</span><span class="op" id="6367607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367611">if</span>&nbsp;<span class="ident" id="6367614">err</span>&nbsp;<span class="op" id="6367618">!=</span>&nbsp;<span class="ident" id="6367621">nil</span>&nbsp;<span class="op" id="6367625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367630">return</span>&nbsp;<span class="ident" id="6367637">nil</span><span class="op" id="6367640">,</span>&nbsp;<span class="ident" id="6367642">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367652">return</span>&nbsp;<span class="ident" id="6367659">buf</span><span class="op" id="6367662">.</span><span class="ident" id="6367663">Bytes</span><span class="op" id="6367668">(</span><span class="op" id="6367669">)</span><span class="op" id="6367670">,</span>&nbsp;<span class="ident" id="6367672">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367681">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367706">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367747">i</span><span class="op" id="6367748">,</span>&nbsp;<span class="ident" id="6367750">j</span>&nbsp;<span class="op" id="6367752">:=</span>&nbsp;<span class="num" id="6367755">0</span><span class="op" id="6367756">,</span>&nbsp;<span class="num" id="6367758">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367761">for</span>&nbsp;<span class="ident" id="6367765">j</span>&nbsp;<span class="op" id="6367767">&lt;</span>&nbsp;<span class="builtinfunc" id="6367769">len</span><span class="op" id="6367772">(</span><span class="ident" id="6367773">src</span><span class="op" id="6367776">)</span>&nbsp;<span class="op" id="6367778">&amp;&amp;</span>&nbsp;<span class="ident" id="6367781">isSpace</span><span class="op" id="6367788">(</span><span class="ident" id="6367789">src</span><span class="op" id="6367792">[</span><span class="ident" id="6367793">j</span><span class="op" id="6367794">]</span><span class="op" id="6367795">)</span>&nbsp;<span class="op" id="6367797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367801">if</span>&nbsp;<span class="ident" id="6367804">src</span><span class="op" id="6367807">[</span><span class="ident" id="6367808">j</span><span class="op" id="6367809">]</span>&nbsp;<span class="op" id="6367811">==</span>&nbsp;<span class="string" id="6367814">&#39;\n&#39;</span>&nbsp;<span class="op" id="6367819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367824">i</span>&nbsp;<span class="op" id="6367826">=</span>&nbsp;<span class="ident" id="6367828">j</span>&nbsp;<span class="op" id="6367830">+</span>&nbsp;<span class="num" id="6367832">1</span>&nbsp;<span class="comment" id="6367834">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367885">j</span><span class="op" id="6367886">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367893">var</span>&nbsp;<span class="ident" id="6367897">res</span>&nbsp;<span class="op" id="6367901">[</span><span class="op" id="6367902">]</span><span class="builtintype" id="6367903">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367909">res</span>&nbsp;<span class="op" id="6367913">=</span>&nbsp;<span class="builtinfunc" id="6367915">append</span><span class="op" id="6367921">(</span><span class="ident" id="6367922">res</span><span class="op" id="6367925">,</span>&nbsp;<span class="ident" id="6367927">src</span><span class="op" id="6367930">[</span><span class="op" id="6367931">:</span><span class="ident" id="6367932">i</span><span class="op" id="6367933">]</span><span class="op" id="6367934">...</span><span class="op" id="6367937">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367941">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367999">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368048">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368091">indent</span>&nbsp;<span class="op" id="6368098">:=</span>&nbsp;<span class="num" id="6368101">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368104">hasSpace</span>&nbsp;<span class="op" id="6368113">:=</span>&nbsp;<span class="builtintype" id="6368116">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368123">for</span>&nbsp;<span class="ident" id="6368127">_</span><span class="op" id="6368128">,</span>&nbsp;<span class="ident" id="6368130">b</span>&nbsp;<span class="op" id="6368132">:=</span>&nbsp;<span class="keyword" id="6368135">range</span>&nbsp;<span class="ident" id="6368141">src</span><span class="op" id="6368144">[</span><span class="ident" id="6368145">i</span><span class="op" id="6368146">:</span><span class="ident" id="6368147">j</span><span class="op" id="6368148">]</span>&nbsp;<span class="op" id="6368150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368154">switch</span>&nbsp;<span class="ident" id="6368161">b</span>&nbsp;<span class="op" id="6368163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368167">case</span>&nbsp;<span class="string" id="6368172">&#39;&nbsp;&#39;</span><span class="op" id="6368175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368180">hasSpace</span>&nbsp;<span class="op" id="6368189">=</span>&nbsp;<span class="builtintype" id="6368191">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368198">case</span>&nbsp;<span class="string" id="6368203">&#39;\t&#39;</span><span class="op" id="6368207">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368212">indent</span><span class="op" id="6368218">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368229">if</span>&nbsp;<span class="ident" id="6368232">indent</span>&nbsp;<span class="op" id="6368239">==</span>&nbsp;<span class="num" id="6368242">0</span>&nbsp;<span class="op" id="6368244">&amp;&amp;</span>&nbsp;<span class="ident" id="6368247">hasSpace</span>&nbsp;<span class="op" id="6368256">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368260">indent</span>&nbsp;<span class="op" id="6368267">=</span>&nbsp;<span class="num" id="6368269">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368275">for</span>&nbsp;<span class="ident" id="6368279">i</span>&nbsp;<span class="op" id="6368281">:=</span>&nbsp;<span class="num" id="6368284">0</span><span class="op" id="6368285">;</span>&nbsp;<span class="ident" id="6368287">i</span>&nbsp;<span class="op" id="6368289">&lt;</span>&nbsp;<span class="ident" id="6368291">indent</span><span class="op" id="6368297">;</span>&nbsp;<span class="ident" id="6368299">i</span><span class="op" id="6368300">++</span>&nbsp;<span class="op" id="6368303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368307">res</span>&nbsp;<span class="op" id="6368311">=</span>&nbsp;<span class="builtinfunc" id="6368313">append</span><span class="op" id="6368319">(</span><span class="ident" id="6368320">res</span><span class="op" id="6368323">,</span>&nbsp;<span class="string" id="6368325">&#39;\t&#39;</span><span class="op" id="6368329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368332">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368336">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368359">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368412">cfg</span><span class="op" id="6368415">.</span><span class="ident" id="6368416">Indent</span>&nbsp;<span class="op" id="6368423">=</span>&nbsp;<span class="ident" id="6368425">indent</span>&nbsp;<span class="op" id="6368432">+</span>&nbsp;<span class="ident" id="6368434">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368445">var</span>&nbsp;<span class="ident" id="6368449">buf</span>&nbsp;<span class="ident" id="6368453">bytes</span><span class="op" id="6368458">.</span><span class="ident" id="6368459">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368467">err</span>&nbsp;<span class="op" id="6368471">:=</span>&nbsp;<span class="ident" id="6368474">cfg</span><span class="op" id="6368477">.</span><span class="ident" id="6368478">Fprint</span><span class="op" id="6368484">(</span><span class="op" id="6368485">&amp;</span><span class="ident" id="6368486">buf</span><span class="op" id="6368489">,</span>&nbsp;<span class="ident" id="6368491">fset</span><span class="op" id="6368495">,</span>&nbsp;<span class="ident" id="6368497">file</span><span class="op" id="6368501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368504">if</span>&nbsp;<span class="ident" id="6368507">err</span>&nbsp;<span class="op" id="6368511">!=</span>&nbsp;<span class="ident" id="6368514">nil</span>&nbsp;<span class="op" id="6368518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368522">return</span>&nbsp;<span class="ident" id="6368529">nil</span><span class="op" id="6368532">,</span>&nbsp;<span class="ident" id="6368534">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368542">res</span>&nbsp;<span class="op" id="6368546">=</span>&nbsp;<span class="builtinfunc" id="6368548">append</span><span class="op" id="6368554">(</span><span class="ident" id="6368555">res</span><span class="op" id="6368558">,</span>&nbsp;<span class="ident" id="6368560">sourceAdj</span><span class="op" id="6368569">(</span><span class="ident" id="6368570">buf</span><span class="op" id="6368573">.</span><span class="ident" id="6368574">Bytes</span><span class="op" id="6368579">(</span><span class="op" id="6368580">)</span><span class="op" id="6368581">,</span>&nbsp;<span class="ident" id="6368583">cfg</span><span class="op" id="6368586">.</span><span class="ident" id="6368587">Indent</span><span class="op" id="6368593">)</span><span class="op" id="6368594">...</span><span class="op" id="6368597">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368601">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368642">i</span>&nbsp;<span class="op" id="6368644">=</span>&nbsp;<span class="builtinfunc" id="6368646">len</span><span class="op" id="6368649">(</span><span class="ident" id="6368650">src</span><span class="op" id="6368653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368656">for</span>&nbsp;<span class="ident" id="6368660">i</span>&nbsp;<span class="op" id="6368662">&gt;</span>&nbsp;<span class="num" id="6368664">0</span>&nbsp;<span class="op" id="6368666">&amp;&amp;</span>&nbsp;<span class="ident" id="6368669">isSpace</span><span class="op" id="6368676">(</span><span class="ident" id="6368677">src</span><span class="op" id="6368680">[</span><span class="ident" id="6368681">i</span><span class="op" id="6368682">-</span><span class="num" id="6368683">1</span><span class="op" id="6368684">]</span><span class="op" id="6368685">)</span>&nbsp;<span class="op" id="6368687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368691">i</span><span class="op" id="6368692">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368699">return</span>&nbsp;<span class="builtinfunc" id="6368706">append</span><span class="op" id="6368712">(</span><span class="ident" id="6368713">res</span><span class="op" id="6368716">,</span>&nbsp;<span class="ident" id="6368718">src</span><span class="op" id="6368721">[</span><span class="ident" id="6368722">i</span><span class="op" id="6368723">:</span><span class="op" id="6368724">]</span><span class="op" id="6368725">...</span><span class="op" id="6368728">)</span><span class="op" id="6368729">,</span>&nbsp;<span class="ident" id="6368731">nil</span><br>
<span class="lineno"></span><span class="op" id="6368735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6368738">func</span>&nbsp;<span class="ident" id="6368743">isSpace</span><span class="op" id="6368750">(</span><span class="ident" id="6368751">b</span>&nbsp;<span class="builtintype" id="6368753">byte</span><span class="op" id="6368757">)</span>&nbsp;<span class="builtintype" id="6368759">bool</span>&nbsp;<span class="op" id="6368764">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368767">return</span>&nbsp;<span class="ident" id="6368774">b</span>&nbsp;<span class="op" id="6368776">==</span>&nbsp;<span class="string" id="6368779">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6368783">||</span>&nbsp;<span class="ident" id="6368786">b</span>&nbsp;<span class="op" id="6368788">==</span>&nbsp;<span class="string" id="6368791">&#39;\t&#39;</span>&nbsp;<span class="op" id="6368796">||</span>&nbsp;<span class="ident" id="6368799">b</span>&nbsp;<span class="op" id="6368801">==</span>&nbsp;<span class="string" id="6368804">&#39;\n&#39;</span>&nbsp;<span class="op" id="6368809">||</span>&nbsp;<span class="ident" id="6368812">b</span>&nbsp;<span class="op" id="6368814">==</span>&nbsp;<span class="string" id="6368817">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="6368822">}</span>
</div>
</body>
</html>
