<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>unicode/utf8</h2>
<ul>
<li><a href="/gostd/unicode/utf8/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8.go.html" class="current">utf8.go</a></li>
<li><a href="/gostd/unicode/utf8/utf8_test.go.html">utf8_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1883700">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1883755">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1883809">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1883860">//&nbsp;Package&nbsp;utf8&nbsp;implements&nbsp;functions&nbsp;and&nbsp;constants&nbsp;to&nbsp;support&nbsp;text&nbsp;encoded&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1883938">//&nbsp;UTF-8.&nbsp;It&nbsp;includes&nbsp;functions&nbsp;to&nbsp;translate&nbsp;between&nbsp;runes&nbsp;and&nbsp;UTF-8&nbsp;byte&nbsp;sequences.</span><br>
<span class="lineno"></span><span class="keyword" id="1884023">package</span>&nbsp;<span class="ident" id="1884031">utf8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1884037">//&nbsp;The&nbsp;conditions&nbsp;RuneError==unicode.ReplacementChar&nbsp;and</span><br>
<span class="lineno">10</span><span class="comment" id="1884094">//&nbsp;MaxRune==unicode.MaxRune&nbsp;are&nbsp;verified&nbsp;in&nbsp;the&nbsp;tests.</span><br>
<span class="lineno"></span><span class="comment" id="1884149">//&nbsp;Defining&nbsp;them&nbsp;locally&nbsp;avoids&nbsp;this&nbsp;package&nbsp;depending&nbsp;on&nbsp;package&nbsp;unicode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1884225">//&nbsp;Numbers&nbsp;fundamental&nbsp;to&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="1884265">const</span>&nbsp;<span class="op" id="1884271">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884274">RuneError</span>&nbsp;<span class="op" id="1884284">=</span>&nbsp;<span class="string" id="1884286">&#39;\uFFFD&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1884299">//&nbsp;the&nbsp;&#34;error&#34;&nbsp;Rune&nbsp;or&nbsp;&#34;Unicode&nbsp;replacement&nbsp;character&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884355">RuneSelf</span>&nbsp;&nbsp;<span class="op" id="1884365">=</span>&nbsp;<span class="num" id="1884367">0x80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1884380">//&nbsp;characters&nbsp;below&nbsp;Runeself&nbsp;are&nbsp;represented&nbsp;as&nbsp;themselves&nbsp;in&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884458">MaxRune</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1884468">=</span>&nbsp;<span class="string" id="1884470">&#39;\U0010FFFF&#39;</span>&nbsp;<span class="comment" id="1884483">//&nbsp;Maximum&nbsp;valid&nbsp;Unicode&nbsp;code&nbsp;point.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884521">UTFMax</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1884531">=</span>&nbsp;<span class="num" id="1884533">4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1884546">//&nbsp;maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;of&nbsp;a&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character.</span><br>
<span class="lineno"></span><span class="op" id="1884611">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="1884614">//&nbsp;Code&nbsp;points&nbsp;in&nbsp;the&nbsp;surrogate&nbsp;range&nbsp;are&nbsp;not&nbsp;valid&nbsp;for&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="keyword" id="1884677">const</span>&nbsp;<span class="op" id="1884683">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884686">surrogateMin</span>&nbsp;<span class="op" id="1884699">=</span>&nbsp;<span class="num" id="1884701">0xD800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884709">surrogateMax</span>&nbsp;<span class="op" id="1884722">=</span>&nbsp;<span class="num" id="1884724">0xDFFF</span><br>
<span class="lineno">25</span><span class="op" id="1884731">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1884734">const</span>&nbsp;<span class="op" id="1884740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884743">t1</span>&nbsp;<span class="op" id="1884746">=</span>&nbsp;<span class="num" id="1884748">0x00</span>&nbsp;<span class="comment" id="1884753">//&nbsp;0000&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884767">tx</span>&nbsp;<span class="op" id="1884770">=</span>&nbsp;<span class="num" id="1884772">0x80</span>&nbsp;<span class="comment" id="1884777">//&nbsp;1000&nbsp;0000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884791">t2</span>&nbsp;<span class="op" id="1884794">=</span>&nbsp;<span class="num" id="1884796">0xC0</span>&nbsp;<span class="comment" id="1884801">//&nbsp;1100&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884815">t3</span>&nbsp;<span class="op" id="1884818">=</span>&nbsp;<span class="num" id="1884820">0xE0</span>&nbsp;<span class="comment" id="1884825">//&nbsp;1110&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884839">t4</span>&nbsp;<span class="op" id="1884842">=</span>&nbsp;<span class="num" id="1884844">0xF0</span>&nbsp;<span class="comment" id="1884849">//&nbsp;1111&nbsp;0000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884863">t5</span>&nbsp;<span class="op" id="1884866">=</span>&nbsp;<span class="num" id="1884868">0xF8</span>&nbsp;<span class="comment" id="1884873">//&nbsp;1111&nbsp;1000</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884888">maskx</span>&nbsp;<span class="op" id="1884894">=</span>&nbsp;<span class="num" id="1884896">0x3F</span>&nbsp;<span class="comment" id="1884901">//&nbsp;0011&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884915">mask2</span>&nbsp;<span class="op" id="1884921">=</span>&nbsp;<span class="num" id="1884923">0x1F</span>&nbsp;<span class="comment" id="1884928">//&nbsp;0001&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884942">mask3</span>&nbsp;<span class="op" id="1884948">=</span>&nbsp;<span class="num" id="1884950">0x0F</span>&nbsp;<span class="comment" id="1884955">//&nbsp;0000&nbsp;1111</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884969">mask4</span>&nbsp;<span class="op" id="1884975">=</span>&nbsp;<span class="num" id="1884977">0x07</span>&nbsp;<span class="comment" id="1884982">//&nbsp;0000&nbsp;0111</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1884997">rune1Max</span>&nbsp;<span class="op" id="1885006">=</span>&nbsp;<span class="num" id="1885008">1</span><span class="op" id="1885009">&lt;&lt;</span><span class="num" id="1885011">7</span>&nbsp;<span class="op" id="1885013">-</span>&nbsp;<span class="num" id="1885015">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885018">rune2Max</span>&nbsp;<span class="op" id="1885027">=</span>&nbsp;<span class="num" id="1885029">1</span><span class="op" id="1885030">&lt;&lt;</span><span class="num" id="1885032">11</span>&nbsp;<span class="op" id="1885035">-</span>&nbsp;<span class="num" id="1885037">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885040">rune3Max</span>&nbsp;<span class="op" id="1885049">=</span>&nbsp;<span class="num" id="1885051">1</span><span class="op" id="1885052">&lt;&lt;</span><span class="num" id="1885054">16</span>&nbsp;<span class="op" id="1885057">-</span>&nbsp;<span class="num" id="1885059">1</span><br>
<span class="lineno"></span><span class="op" id="1885061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="1885064">func</span>&nbsp;<span class="ident" id="1885069">decodeRuneInternal</span><span class="op" id="1885087">(</span><span class="ident" id="1885088">p</span>&nbsp;<span class="op" id="1885090">[</span><span class="op" id="1885091">]</span><span class="builtintype" id="1885092">byte</span><span class="op" id="1885096">)</span>&nbsp;<span class="op" id="1885098">(</span><span class="ident" id="1885099">r</span>&nbsp;<span class="builtintype" id="1885101">rune</span><span class="op" id="1885105">,</span>&nbsp;<span class="ident" id="1885107">size</span>&nbsp;<span class="builtintype" id="1885112">int</span><span class="op" id="1885115">,</span>&nbsp;<span class="ident" id="1885117">short</span>&nbsp;<span class="builtintype" id="1885123">bool</span><span class="op" id="1885127">)</span>&nbsp;<span class="op" id="1885129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885132">n</span>&nbsp;<span class="op" id="1885134">:=</span>&nbsp;<span class="builtinfunc" id="1885137">len</span><span class="op" id="1885140">(</span><span class="ident" id="1885141">p</span><span class="op" id="1885142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885145">if</span>&nbsp;<span class="ident" id="1885148">n</span>&nbsp;<span class="op" id="1885150">&lt;</span>&nbsp;<span class="num" id="1885152">1</span>&nbsp;<span class="op" id="1885154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885158">return</span>&nbsp;<span class="ident" id="1885165">RuneError</span><span class="op" id="1885174">,</span>&nbsp;<span class="num" id="1885176">0</span><span class="op" id="1885177">,</span>&nbsp;<span class="builtintype" id="1885179">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885185">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885188">c0</span>&nbsp;<span class="op" id="1885191">:=</span>&nbsp;<span class="ident" id="1885194">p</span><span class="op" id="1885195">[</span><span class="num" id="1885196">0</span><span class="op" id="1885197">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1885201">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885229">if</span>&nbsp;<span class="ident" id="1885232">c0</span>&nbsp;<span class="op" id="1885235">&lt;</span>&nbsp;<span class="ident" id="1885237">tx</span>&nbsp;<span class="op" id="1885240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885244">return</span>&nbsp;<span class="builtintype" id="1885251">rune</span><span class="op" id="1885255">(</span><span class="ident" id="1885256">c0</span><span class="op" id="1885258">)</span><span class="op" id="1885259">,</span>&nbsp;<span class="num" id="1885261">1</span><span class="op" id="1885262">,</span>&nbsp;<span class="builtintype" id="1885264">false</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1885275">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885309">if</span>&nbsp;<span class="ident" id="1885312">c0</span>&nbsp;<span class="op" id="1885315">&lt;</span>&nbsp;<span class="ident" id="1885317">t2</span>&nbsp;<span class="op" id="1885320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885324">return</span>&nbsp;<span class="ident" id="1885331">RuneError</span><span class="op" id="1885340">,</span>&nbsp;<span class="num" id="1885342">1</span><span class="op" id="1885343">,</span>&nbsp;<span class="builtintype" id="1885345">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1885356">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885389">if</span>&nbsp;<span class="ident" id="1885392">n</span>&nbsp;<span class="op" id="1885394">&lt;</span>&nbsp;<span class="num" id="1885396">2</span>&nbsp;<span class="op" id="1885398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885402">return</span>&nbsp;<span class="ident" id="1885409">RuneError</span><span class="op" id="1885418">,</span>&nbsp;<span class="num" id="1885420">1</span><span class="op" id="1885421">,</span>&nbsp;<span class="builtintype" id="1885423">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885432">c1</span>&nbsp;<span class="op" id="1885435">:=</span>&nbsp;<span class="ident" id="1885438">p</span><span class="op" id="1885439">[</span><span class="num" id="1885440">1</span><span class="op" id="1885441">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885444">if</span>&nbsp;<span class="ident" id="1885447">c1</span>&nbsp;<span class="op" id="1885450">&lt;</span>&nbsp;<span class="ident" id="1885452">tx</span>&nbsp;<span class="op" id="1885455">||</span>&nbsp;<span class="ident" id="1885458">t2</span>&nbsp;<span class="op" id="1885461">&lt;=</span>&nbsp;<span class="ident" id="1885464">c1</span>&nbsp;<span class="op" id="1885467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885471">return</span>&nbsp;<span class="ident" id="1885478">RuneError</span><span class="op" id="1885487">,</span>&nbsp;<span class="num" id="1885489">1</span><span class="op" id="1885490">,</span>&nbsp;<span class="builtintype" id="1885492">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885499">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1885503">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885532">if</span>&nbsp;<span class="ident" id="1885535">c0</span>&nbsp;<span class="op" id="1885538">&lt;</span>&nbsp;<span class="ident" id="1885540">t3</span>&nbsp;<span class="op" id="1885543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885547">r</span>&nbsp;<span class="op" id="1885549">=</span>&nbsp;<span class="builtintype" id="1885551">rune</span><span class="op" id="1885555">(</span><span class="ident" id="1885556">c0</span><span class="op" id="1885558">&amp;</span><span class="ident" id="1885559">mask2</span><span class="op" id="1885564">)</span><span class="op" id="1885565">&lt;&lt;</span><span class="num" id="1885567">6</span>&nbsp;<span class="op" id="1885569">|</span>&nbsp;<span class="builtintype" id="1885571">rune</span><span class="op" id="1885575">(</span><span class="ident" id="1885576">c1</span><span class="op" id="1885578">&amp;</span><span class="ident" id="1885579">maskx</span><span class="op" id="1885584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885588">if</span>&nbsp;<span class="ident" id="1885591">r</span>&nbsp;<span class="op" id="1885593">&lt;=</span>&nbsp;<span class="ident" id="1885596">rune1Max</span>&nbsp;<span class="op" id="1885605">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885610">return</span>&nbsp;<span class="ident" id="1885617">RuneError</span><span class="op" id="1885626">,</span>&nbsp;<span class="num" id="1885628">1</span><span class="op" id="1885629">,</span>&nbsp;<span class="builtintype" id="1885631">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885643">return</span>&nbsp;<span class="ident" id="1885650">r</span><span class="op" id="1885651">,</span>&nbsp;<span class="num" id="1885653">2</span><span class="op" id="1885654">,</span>&nbsp;<span class="builtintype" id="1885656">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1885667">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885701">if</span>&nbsp;<span class="ident" id="1885704">n</span>&nbsp;<span class="op" id="1885706">&lt;</span>&nbsp;<span class="num" id="1885708">3</span>&nbsp;<span class="op" id="1885710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885714">return</span>&nbsp;<span class="ident" id="1885721">RuneError</span><span class="op" id="1885730">,</span>&nbsp;<span class="num" id="1885732">1</span><span class="op" id="1885733">,</span>&nbsp;<span class="builtintype" id="1885735">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885744">c2</span>&nbsp;<span class="op" id="1885747">:=</span>&nbsp;<span class="ident" id="1885750">p</span><span class="op" id="1885751">[</span><span class="num" id="1885752">2</span><span class="op" id="1885753">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885756">if</span>&nbsp;<span class="ident" id="1885759">c2</span>&nbsp;<span class="op" id="1885762">&lt;</span>&nbsp;<span class="ident" id="1885764">tx</span>&nbsp;<span class="op" id="1885767">||</span>&nbsp;<span class="ident" id="1885770">t2</span>&nbsp;<span class="op" id="1885773">&lt;=</span>&nbsp;<span class="ident" id="1885776">c2</span>&nbsp;<span class="op" id="1885779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885783">return</span>&nbsp;<span class="ident" id="1885790">RuneError</span><span class="op" id="1885799">,</span>&nbsp;<span class="num" id="1885801">1</span><span class="op" id="1885802">,</span>&nbsp;<span class="builtintype" id="1885804">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1885815">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885844">if</span>&nbsp;<span class="ident" id="1885847">c0</span>&nbsp;<span class="op" id="1885850">&lt;</span>&nbsp;<span class="ident" id="1885852">t4</span>&nbsp;<span class="op" id="1885855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1885859">r</span>&nbsp;<span class="op" id="1885861">=</span>&nbsp;<span class="builtintype" id="1885863">rune</span><span class="op" id="1885867">(</span><span class="ident" id="1885868">c0</span><span class="op" id="1885870">&amp;</span><span class="ident" id="1885871">mask3</span><span class="op" id="1885876">)</span><span class="op" id="1885877">&lt;&lt;</span><span class="num" id="1885879">12</span>&nbsp;<span class="op" id="1885882">|</span>&nbsp;<span class="builtintype" id="1885884">rune</span><span class="op" id="1885888">(</span><span class="ident" id="1885889">c1</span><span class="op" id="1885891">&amp;</span><span class="ident" id="1885892">maskx</span><span class="op" id="1885897">)</span><span class="op" id="1885898">&lt;&lt;</span><span class="num" id="1885900">6</span>&nbsp;<span class="op" id="1885902">|</span>&nbsp;<span class="builtintype" id="1885904">rune</span><span class="op" id="1885908">(</span><span class="ident" id="1885909">c2</span><span class="op" id="1885911">&amp;</span><span class="ident" id="1885912">maskx</span><span class="op" id="1885917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885921">if</span>&nbsp;<span class="ident" id="1885924">r</span>&nbsp;<span class="op" id="1885926">&lt;=</span>&nbsp;<span class="ident" id="1885929">rune2Max</span>&nbsp;<span class="op" id="1885938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885943">return</span>&nbsp;<span class="ident" id="1885950">RuneError</span><span class="op" id="1885959">,</span>&nbsp;<span class="num" id="1885961">1</span><span class="op" id="1885962">,</span>&nbsp;<span class="builtintype" id="1885964">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1885972">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1885976">if</span>&nbsp;<span class="ident" id="1885979">surrogateMin</span>&nbsp;<span class="op" id="1885992">&lt;=</span>&nbsp;<span class="ident" id="1885995">r</span>&nbsp;<span class="op" id="1885997">&amp;&amp;</span>&nbsp;<span class="ident" id="1886000">r</span>&nbsp;<span class="op" id="1886002">&lt;=</span>&nbsp;<span class="ident" id="1886005">surrogateMax</span>&nbsp;<span class="op" id="1886018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886023">return</span>&nbsp;<span class="ident" id="1886030">RuneError</span><span class="op" id="1886039">,</span>&nbsp;<span class="num" id="1886041">1</span><span class="op" id="1886042">,</span>&nbsp;<span class="builtintype" id="1886044">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886056">return</span>&nbsp;<span class="ident" id="1886063">r</span><span class="op" id="1886064">,</span>&nbsp;<span class="num" id="1886066">3</span><span class="op" id="1886067">,</span>&nbsp;<span class="builtintype" id="1886069">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886076">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886080">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886113">if</span>&nbsp;<span class="ident" id="1886116">n</span>&nbsp;<span class="op" id="1886118">&lt;</span>&nbsp;<span class="num" id="1886120">4</span>&nbsp;<span class="op" id="1886122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886126">return</span>&nbsp;<span class="ident" id="1886133">RuneError</span><span class="op" id="1886142">,</span>&nbsp;<span class="num" id="1886144">1</span><span class="op" id="1886145">,</span>&nbsp;<span class="builtintype" id="1886147">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886153">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1886156">c3</span>&nbsp;<span class="op" id="1886159">:=</span>&nbsp;<span class="ident" id="1886162">p</span><span class="op" id="1886163">[</span><span class="num" id="1886164">3</span><span class="op" id="1886165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886168">if</span>&nbsp;<span class="ident" id="1886171">c3</span>&nbsp;<span class="op" id="1886174">&lt;</span>&nbsp;<span class="ident" id="1886176">tx</span>&nbsp;<span class="op" id="1886179">||</span>&nbsp;<span class="ident" id="1886182">t2</span>&nbsp;<span class="op" id="1886185">&lt;=</span>&nbsp;<span class="ident" id="1886188">c3</span>&nbsp;<span class="op" id="1886191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886195">return</span>&nbsp;<span class="ident" id="1886202">RuneError</span><span class="op" id="1886211">,</span>&nbsp;<span class="num" id="1886213">1</span><span class="op" id="1886214">,</span>&nbsp;<span class="builtintype" id="1886216">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886227">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886256">if</span>&nbsp;<span class="ident" id="1886259">c0</span>&nbsp;<span class="op" id="1886262">&lt;</span>&nbsp;<span class="ident" id="1886264">t5</span>&nbsp;<span class="op" id="1886267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1886271">r</span>&nbsp;<span class="op" id="1886273">=</span>&nbsp;<span class="builtintype" id="1886275">rune</span><span class="op" id="1886279">(</span><span class="ident" id="1886280">c0</span><span class="op" id="1886282">&amp;</span><span class="ident" id="1886283">mask4</span><span class="op" id="1886288">)</span><span class="op" id="1886289">&lt;&lt;</span><span class="num" id="1886291">18</span>&nbsp;<span class="op" id="1886294">|</span>&nbsp;<span class="builtintype" id="1886296">rune</span><span class="op" id="1886300">(</span><span class="ident" id="1886301">c1</span><span class="op" id="1886303">&amp;</span><span class="ident" id="1886304">maskx</span><span class="op" id="1886309">)</span><span class="op" id="1886310">&lt;&lt;</span><span class="num" id="1886312">12</span>&nbsp;<span class="op" id="1886315">|</span>&nbsp;<span class="builtintype" id="1886317">rune</span><span class="op" id="1886321">(</span><span class="ident" id="1886322">c2</span><span class="op" id="1886324">&amp;</span><span class="ident" id="1886325">maskx</span><span class="op" id="1886330">)</span><span class="op" id="1886331">&lt;&lt;</span><span class="num" id="1886333">6</span>&nbsp;<span class="op" id="1886335">|</span>&nbsp;<span class="builtintype" id="1886337">rune</span><span class="op" id="1886341">(</span><span class="ident" id="1886342">c3</span><span class="op" id="1886344">&amp;</span><span class="ident" id="1886345">maskx</span><span class="op" id="1886350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886354">if</span>&nbsp;<span class="ident" id="1886357">r</span>&nbsp;<span class="op" id="1886359">&lt;=</span>&nbsp;<span class="ident" id="1886362">rune3Max</span>&nbsp;<span class="op" id="1886371">||</span>&nbsp;<span class="ident" id="1886374">MaxRune</span>&nbsp;<span class="op" id="1886382">&lt;</span>&nbsp;<span class="ident" id="1886384">r</span>&nbsp;<span class="op" id="1886386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886391">return</span>&nbsp;<span class="ident" id="1886398">RuneError</span><span class="op" id="1886407">,</span>&nbsp;<span class="num" id="1886409">1</span><span class="op" id="1886410">,</span>&nbsp;<span class="builtintype" id="1886412">false</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886424">return</span>&nbsp;<span class="ident" id="1886431">r</span><span class="op" id="1886432">,</span>&nbsp;<span class="num" id="1886434">4</span><span class="op" id="1886435">,</span>&nbsp;<span class="builtintype" id="1886437">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886448">//&nbsp;error</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886458">return</span>&nbsp;<span class="ident" id="1886465">RuneError</span><span class="op" id="1886474">,</span>&nbsp;<span class="num" id="1886476">1</span><span class="op" id="1886477">,</span>&nbsp;<span class="builtintype" id="1886479">false</span><br>
<span class="lineno"></span><span class="op" id="1886485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1886488">func</span>&nbsp;<span class="ident" id="1886493">decodeRuneInStringInternal</span><span class="op" id="1886519">(</span><span class="ident" id="1886520">s</span>&nbsp;<span class="builtintype" id="1886522">string</span><span class="op" id="1886528">)</span>&nbsp;<span class="op" id="1886530">(</span><span class="ident" id="1886531">r</span>&nbsp;<span class="builtintype" id="1886533">rune</span><span class="op" id="1886537">,</span>&nbsp;<span class="ident" id="1886539">size</span>&nbsp;<span class="builtintype" id="1886544">int</span><span class="op" id="1886547">,</span>&nbsp;<span class="ident" id="1886549">short</span>&nbsp;<span class="builtintype" id="1886555">bool</span><span class="op" id="1886559">)</span>&nbsp;<span class="op" id="1886561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1886564">n</span>&nbsp;<span class="op" id="1886566">:=</span>&nbsp;<span class="builtinfunc" id="1886569">len</span><span class="op" id="1886572">(</span><span class="ident" id="1886573">s</span><span class="op" id="1886574">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886577">if</span>&nbsp;<span class="ident" id="1886580">n</span>&nbsp;<span class="op" id="1886582">&lt;</span>&nbsp;<span class="num" id="1886584">1</span>&nbsp;<span class="op" id="1886586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886590">return</span>&nbsp;<span class="ident" id="1886597">RuneError</span><span class="op" id="1886606">,</span>&nbsp;<span class="num" id="1886608">0</span><span class="op" id="1886609">,</span>&nbsp;<span class="builtintype" id="1886611">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1886620">c0</span>&nbsp;<span class="op" id="1886623">:=</span>&nbsp;<span class="ident" id="1886626">s</span><span class="op" id="1886627">[</span><span class="num" id="1886628">0</span><span class="op" id="1886629">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886633">//&nbsp;1-byte,&nbsp;7-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886661">if</span>&nbsp;<span class="ident" id="1886664">c0</span>&nbsp;<span class="op" id="1886667">&lt;</span>&nbsp;<span class="ident" id="1886669">tx</span>&nbsp;<span class="op" id="1886672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886676">return</span>&nbsp;<span class="builtintype" id="1886683">rune</span><span class="op" id="1886687">(</span><span class="ident" id="1886688">c0</span><span class="op" id="1886690">)</span><span class="op" id="1886691">,</span>&nbsp;<span class="num" id="1886693">1</span><span class="op" id="1886694">,</span>&nbsp;<span class="builtintype" id="1886696">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886707">//&nbsp;unexpected&nbsp;continuation&nbsp;byte?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886741">if</span>&nbsp;<span class="ident" id="1886744">c0</span>&nbsp;<span class="op" id="1886747">&lt;</span>&nbsp;<span class="ident" id="1886749">t2</span>&nbsp;<span class="op" id="1886752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886756">return</span>&nbsp;<span class="ident" id="1886763">RuneError</span><span class="op" id="1886772">,</span>&nbsp;<span class="num" id="1886774">1</span><span class="op" id="1886775">,</span>&nbsp;<span class="builtintype" id="1886777">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886788">//&nbsp;need&nbsp;first&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886821">if</span>&nbsp;<span class="ident" id="1886824">n</span>&nbsp;<span class="op" id="1886826">&lt;</span>&nbsp;<span class="num" id="1886828">2</span>&nbsp;<span class="op" id="1886830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886834">return</span>&nbsp;<span class="ident" id="1886841">RuneError</span><span class="op" id="1886850">,</span>&nbsp;<span class="num" id="1886852">1</span><span class="op" id="1886853">,</span>&nbsp;<span class="builtintype" id="1886855">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1886864">c1</span>&nbsp;<span class="op" id="1886867">:=</span>&nbsp;<span class="ident" id="1886870">s</span><span class="op" id="1886871">[</span><span class="num" id="1886872">1</span><span class="op" id="1886873">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886876">if</span>&nbsp;<span class="ident" id="1886879">c1</span>&nbsp;<span class="op" id="1886882">&lt;</span>&nbsp;<span class="ident" id="1886884">tx</span>&nbsp;<span class="op" id="1886887">||</span>&nbsp;<span class="ident" id="1886890">t2</span>&nbsp;<span class="op" id="1886893">&lt;=</span>&nbsp;<span class="ident" id="1886896">c1</span>&nbsp;<span class="op" id="1886899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886903">return</span>&nbsp;<span class="ident" id="1886910">RuneError</span><span class="op" id="1886919">,</span>&nbsp;<span class="num" id="1886921">1</span><span class="op" id="1886922">,</span>&nbsp;<span class="builtintype" id="1886924">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1886931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1886935">//&nbsp;2-byte,&nbsp;11-bit&nbsp;sequence?</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1886964">if</span>&nbsp;<span class="ident" id="1886967">c0</span>&nbsp;<span class="op" id="1886970">&lt;</span>&nbsp;<span class="ident" id="1886972">t3</span>&nbsp;<span class="op" id="1886975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1886979">r</span>&nbsp;<span class="op" id="1886981">=</span>&nbsp;<span class="builtintype" id="1886983">rune</span><span class="op" id="1886987">(</span><span class="ident" id="1886988">c0</span><span class="op" id="1886990">&amp;</span><span class="ident" id="1886991">mask2</span><span class="op" id="1886996">)</span><span class="op" id="1886997">&lt;&lt;</span><span class="num" id="1886999">6</span>&nbsp;<span class="op" id="1887001">|</span>&nbsp;<span class="builtintype" id="1887003">rune</span><span class="op" id="1887007">(</span><span class="ident" id="1887008">c1</span><span class="op" id="1887010">&amp;</span><span class="ident" id="1887011">maskx</span><span class="op" id="1887016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887020">if</span>&nbsp;<span class="ident" id="1887023">r</span>&nbsp;<span class="op" id="1887025">&lt;=</span>&nbsp;<span class="ident" id="1887028">rune1Max</span>&nbsp;<span class="op" id="1887037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887042">return</span>&nbsp;<span class="ident" id="1887049">RuneError</span><span class="op" id="1887058">,</span>&nbsp;<span class="num" id="1887060">1</span><span class="op" id="1887061">,</span>&nbsp;<span class="builtintype" id="1887063">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887071">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887075">return</span>&nbsp;<span class="ident" id="1887082">r</span><span class="op" id="1887083">,</span>&nbsp;<span class="num" id="1887085">2</span><span class="op" id="1887086">,</span>&nbsp;<span class="builtintype" id="1887088">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1887099">//&nbsp;need&nbsp;second&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887133">if</span>&nbsp;<span class="ident" id="1887136">n</span>&nbsp;<span class="op" id="1887138">&lt;</span>&nbsp;<span class="num" id="1887140">3</span>&nbsp;<span class="op" id="1887142">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887146">return</span>&nbsp;<span class="ident" id="1887153">RuneError</span><span class="op" id="1887162">,</span>&nbsp;<span class="num" id="1887164">1</span><span class="op" id="1887165">,</span>&nbsp;<span class="builtintype" id="1887167">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1887176">c2</span>&nbsp;<span class="op" id="1887179">:=</span>&nbsp;<span class="ident" id="1887182">s</span><span class="op" id="1887183">[</span><span class="num" id="1887184">2</span><span class="op" id="1887185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887188">if</span>&nbsp;<span class="ident" id="1887191">c2</span>&nbsp;<span class="op" id="1887194">&lt;</span>&nbsp;<span class="ident" id="1887196">tx</span>&nbsp;<span class="op" id="1887199">||</span>&nbsp;<span class="ident" id="1887202">t2</span>&nbsp;<span class="op" id="1887205">&lt;=</span>&nbsp;<span class="ident" id="1887208">c2</span>&nbsp;<span class="op" id="1887211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887215">return</span>&nbsp;<span class="ident" id="1887222">RuneError</span><span class="op" id="1887231">,</span>&nbsp;<span class="num" id="1887233">1</span><span class="op" id="1887234">,</span>&nbsp;<span class="builtintype" id="1887236">false</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1887247">//&nbsp;3-byte,&nbsp;16-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887276">if</span>&nbsp;<span class="ident" id="1887279">c0</span>&nbsp;<span class="op" id="1887282">&lt;</span>&nbsp;<span class="ident" id="1887284">t4</span>&nbsp;<span class="op" id="1887287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1887291">r</span>&nbsp;<span class="op" id="1887293">=</span>&nbsp;<span class="builtintype" id="1887295">rune</span><span class="op" id="1887299">(</span><span class="ident" id="1887300">c0</span><span class="op" id="1887302">&amp;</span><span class="ident" id="1887303">mask3</span><span class="op" id="1887308">)</span><span class="op" id="1887309">&lt;&lt;</span><span class="num" id="1887311">12</span>&nbsp;<span class="op" id="1887314">|</span>&nbsp;<span class="builtintype" id="1887316">rune</span><span class="op" id="1887320">(</span><span class="ident" id="1887321">c1</span><span class="op" id="1887323">&amp;</span><span class="ident" id="1887324">maskx</span><span class="op" id="1887329">)</span><span class="op" id="1887330">&lt;&lt;</span><span class="num" id="1887332">6</span>&nbsp;<span class="op" id="1887334">|</span>&nbsp;<span class="builtintype" id="1887336">rune</span><span class="op" id="1887340">(</span><span class="ident" id="1887341">c2</span><span class="op" id="1887343">&amp;</span><span class="ident" id="1887344">maskx</span><span class="op" id="1887349">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887353">if</span>&nbsp;<span class="ident" id="1887356">r</span>&nbsp;<span class="op" id="1887358">&lt;=</span>&nbsp;<span class="ident" id="1887361">rune2Max</span>&nbsp;<span class="op" id="1887370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887375">return</span>&nbsp;<span class="ident" id="1887382">RuneError</span><span class="op" id="1887391">,</span>&nbsp;<span class="num" id="1887393">1</span><span class="op" id="1887394">,</span>&nbsp;<span class="builtintype" id="1887396">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887408">if</span>&nbsp;<span class="ident" id="1887411">surrogateMin</span>&nbsp;<span class="op" id="1887424">&lt;=</span>&nbsp;<span class="ident" id="1887427">r</span>&nbsp;<span class="op" id="1887429">&amp;&amp;</span>&nbsp;<span class="ident" id="1887432">r</span>&nbsp;<span class="op" id="1887434">&lt;=</span>&nbsp;<span class="ident" id="1887437">surrogateMax</span>&nbsp;<span class="op" id="1887450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887455">return</span>&nbsp;<span class="ident" id="1887462">RuneError</span><span class="op" id="1887471">,</span>&nbsp;<span class="num" id="1887473">1</span><span class="op" id="1887474">,</span>&nbsp;<span class="builtintype" id="1887476">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887488">return</span>&nbsp;<span class="ident" id="1887495">r</span><span class="op" id="1887496">,</span>&nbsp;<span class="num" id="1887498">3</span><span class="op" id="1887499">,</span>&nbsp;<span class="builtintype" id="1887501">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1887512">//&nbsp;need&nbsp;third&nbsp;continuation&nbsp;byte</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887545">if</span>&nbsp;<span class="ident" id="1887548">n</span>&nbsp;<span class="op" id="1887550">&lt;</span>&nbsp;<span class="num" id="1887552">4</span>&nbsp;<span class="op" id="1887554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887558">return</span>&nbsp;<span class="ident" id="1887565">RuneError</span><span class="op" id="1887574">,</span>&nbsp;<span class="num" id="1887576">1</span><span class="op" id="1887577">,</span>&nbsp;<span class="builtintype" id="1887579">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1887588">c3</span>&nbsp;<span class="op" id="1887591">:=</span>&nbsp;<span class="ident" id="1887594">s</span><span class="op" id="1887595">[</span><span class="num" id="1887596">3</span><span class="op" id="1887597">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887600">if</span>&nbsp;<span class="ident" id="1887603">c3</span>&nbsp;<span class="op" id="1887606">&lt;</span>&nbsp;<span class="ident" id="1887608">tx</span>&nbsp;<span class="op" id="1887611">||</span>&nbsp;<span class="ident" id="1887614">t2</span>&nbsp;<span class="op" id="1887617">&lt;=</span>&nbsp;<span class="ident" id="1887620">c3</span>&nbsp;<span class="op" id="1887623">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887627">return</span>&nbsp;<span class="ident" id="1887634">RuneError</span><span class="op" id="1887643">,</span>&nbsp;<span class="num" id="1887645">1</span><span class="op" id="1887646">,</span>&nbsp;<span class="builtintype" id="1887648">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1887659">//&nbsp;4-byte,&nbsp;21-bit&nbsp;sequence?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887688">if</span>&nbsp;<span class="ident" id="1887691">c0</span>&nbsp;<span class="op" id="1887694">&lt;</span>&nbsp;<span class="ident" id="1887696">t5</span>&nbsp;<span class="op" id="1887699">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1887703">r</span>&nbsp;<span class="op" id="1887705">=</span>&nbsp;<span class="builtintype" id="1887707">rune</span><span class="op" id="1887711">(</span><span class="ident" id="1887712">c0</span><span class="op" id="1887714">&amp;</span><span class="ident" id="1887715">mask4</span><span class="op" id="1887720">)</span><span class="op" id="1887721">&lt;&lt;</span><span class="num" id="1887723">18</span>&nbsp;<span class="op" id="1887726">|</span>&nbsp;<span class="builtintype" id="1887728">rune</span><span class="op" id="1887732">(</span><span class="ident" id="1887733">c1</span><span class="op" id="1887735">&amp;</span><span class="ident" id="1887736">maskx</span><span class="op" id="1887741">)</span><span class="op" id="1887742">&lt;&lt;</span><span class="num" id="1887744">12</span>&nbsp;<span class="op" id="1887747">|</span>&nbsp;<span class="builtintype" id="1887749">rune</span><span class="op" id="1887753">(</span><span class="ident" id="1887754">c2</span><span class="op" id="1887756">&amp;</span><span class="ident" id="1887757">maskx</span><span class="op" id="1887762">)</span><span class="op" id="1887763">&lt;&lt;</span><span class="num" id="1887765">6</span>&nbsp;<span class="op" id="1887767">|</span>&nbsp;<span class="builtintype" id="1887769">rune</span><span class="op" id="1887773">(</span><span class="ident" id="1887774">c3</span><span class="op" id="1887776">&amp;</span><span class="ident" id="1887777">maskx</span><span class="op" id="1887782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887786">if</span>&nbsp;<span class="ident" id="1887789">r</span>&nbsp;<span class="op" id="1887791">&lt;=</span>&nbsp;<span class="ident" id="1887794">rune3Max</span>&nbsp;<span class="op" id="1887803">||</span>&nbsp;<span class="ident" id="1887806">MaxRune</span>&nbsp;<span class="op" id="1887814">&lt;</span>&nbsp;<span class="ident" id="1887816">r</span>&nbsp;<span class="op" id="1887818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887823">return</span>&nbsp;<span class="ident" id="1887830">RuneError</span><span class="op" id="1887839">,</span>&nbsp;<span class="num" id="1887841">1</span><span class="op" id="1887842">,</span>&nbsp;<span class="builtintype" id="1887844">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887856">return</span>&nbsp;<span class="ident" id="1887863">r</span><span class="op" id="1887864">,</span>&nbsp;<span class="num" id="1887866">4</span><span class="op" id="1887867">,</span>&nbsp;<span class="builtintype" id="1887869">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1887876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1887880">//&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1887890">return</span>&nbsp;<span class="ident" id="1887897">RuneError</span><span class="op" id="1887906">,</span>&nbsp;<span class="num" id="1887908">1</span><span class="op" id="1887909">,</span>&nbsp;<span class="builtintype" id="1887911">false</span><br>
<span class="lineno"></span><span class="op" id="1887917">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="1887920">//&nbsp;FullRune&nbsp;reports&nbsp;whether&nbsp;the&nbsp;bytes&nbsp;in&nbsp;p&nbsp;begin&nbsp;with&nbsp;a&nbsp;full&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;a&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1888007">//&nbsp;An&nbsp;invalid&nbsp;encoding&nbsp;is&nbsp;considered&nbsp;a&nbsp;full&nbsp;Rune&nbsp;since&nbsp;it&nbsp;will&nbsp;convert&nbsp;as&nbsp;a&nbsp;width-1&nbsp;error&nbsp;rune.</span><br>
<span class="lineno"></span><span class="keyword" id="1888103">func</span>&nbsp;<span class="ident" id="1888108">FullRune</span><span class="op" id="1888116">(</span><span class="ident" id="1888117">p</span>&nbsp;<span class="op" id="1888119">[</span><span class="op" id="1888120">]</span><span class="builtintype" id="1888121">byte</span><span class="op" id="1888125">)</span>&nbsp;<span class="builtintype" id="1888127">bool</span>&nbsp;<span class="op" id="1888132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1888135">_</span><span class="op" id="1888136">,</span>&nbsp;<span class="ident" id="1888138">_</span><span class="op" id="1888139">,</span>&nbsp;<span class="ident" id="1888141">short</span>&nbsp;<span class="op" id="1888147">:=</span>&nbsp;<span class="ident" id="1888150">decodeRuneInternal</span><span class="op" id="1888168">(</span><span class="ident" id="1888169">p</span><span class="op" id="1888170">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1888173">return</span>&nbsp;<span class="op" id="1888180">!</span><span class="ident" id="1888181">short</span><br>
<span class="lineno"></span><span class="op" id="1888187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1888190">//&nbsp;FullRuneInString&nbsp;is&nbsp;like&nbsp;FullRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1888254">func</span>&nbsp;<span class="ident" id="1888259">FullRuneInString</span><span class="op" id="1888275">(</span><span class="ident" id="1888276">s</span>&nbsp;<span class="builtintype" id="1888278">string</span><span class="op" id="1888284">)</span>&nbsp;<span class="builtintype" id="1888286">bool</span>&nbsp;<span class="op" id="1888291">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1888294">_</span><span class="op" id="1888295">,</span>&nbsp;<span class="ident" id="1888297">_</span><span class="op" id="1888298">,</span>&nbsp;<span class="ident" id="1888300">short</span>&nbsp;<span class="op" id="1888306">:=</span>&nbsp;<span class="ident" id="1888309">decodeRuneInStringInternal</span><span class="op" id="1888335">(</span><span class="ident" id="1888336">s</span><span class="op" id="1888337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1888340">return</span>&nbsp;<span class="op" id="1888347">!</span><span class="ident" id="1888348">short</span><br>
<span class="lineno"></span><span class="op" id="1888354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1888357">//&nbsp;DecodeRune&nbsp;unpacks&nbsp;the&nbsp;first&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">215</span><span class="comment" id="1888434">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1888512">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1888587">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1888617">//</span><br>
<span class="lineno"></span><span class="comment" id="1888620">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">220</span><span class="comment" id="1888695">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1888767">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1888811">func</span>&nbsp;<span class="ident" id="1888816">DecodeRune</span><span class="op" id="1888826">(</span><span class="ident" id="1888827">p</span>&nbsp;<span class="op" id="1888829">[</span><span class="op" id="1888830">]</span><span class="builtintype" id="1888831">byte</span><span class="op" id="1888835">)</span>&nbsp;<span class="op" id="1888837">(</span><span class="ident" id="1888838">r</span>&nbsp;<span class="builtintype" id="1888840">rune</span><span class="op" id="1888844">,</span>&nbsp;<span class="ident" id="1888846">size</span>&nbsp;<span class="builtintype" id="1888851">int</span><span class="op" id="1888854">)</span>&nbsp;<span class="op" id="1888856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1888859">r</span><span class="op" id="1888860">,</span>&nbsp;<span class="ident" id="1888862">size</span><span class="op" id="1888866">,</span>&nbsp;<span class="ident" id="1888868">_</span>&nbsp;<span class="op" id="1888870">=</span>&nbsp;<span class="ident" id="1888872">decodeRuneInternal</span><span class="op" id="1888890">(</span><span class="ident" id="1888891">p</span><span class="op" id="1888892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1888895">return</span><br>
<span class="lineno">225</span><span class="op" id="1888902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1888905">//&nbsp;DecodeRuneInString&nbsp;is&nbsp;like&nbsp;DecodeRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If&nbsp;s&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1888981">//&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="1889059">//&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno">230</span><span class="comment" id="1889133">//</span><br>
<span class="lineno"></span><span class="comment" id="1889136">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1889211">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1889283">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1889327">func</span>&nbsp;<span class="ident" id="1889332">DecodeRuneInString</span><span class="op" id="1889350">(</span><span class="ident" id="1889351">s</span>&nbsp;<span class="builtintype" id="1889353">string</span><span class="op" id="1889359">)</span>&nbsp;<span class="op" id="1889361">(</span><span class="ident" id="1889362">r</span>&nbsp;<span class="builtintype" id="1889364">rune</span><span class="op" id="1889368">,</span>&nbsp;<span class="ident" id="1889370">size</span>&nbsp;<span class="builtintype" id="1889375">int</span><span class="op" id="1889378">)</span>&nbsp;<span class="op" id="1889380">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1889383">r</span><span class="op" id="1889384">,</span>&nbsp;<span class="ident" id="1889386">size</span><span class="op" id="1889390">,</span>&nbsp;<span class="ident" id="1889392">_</span>&nbsp;<span class="op" id="1889394">=</span>&nbsp;<span class="ident" id="1889396">decodeRuneInStringInternal</span><span class="op" id="1889422">(</span><span class="ident" id="1889423">s</span><span class="op" id="1889424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1889427">return</span><br>
<span class="lineno"></span><span class="op" id="1889434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1889437">//&nbsp;DecodeLastRune&nbsp;unpacks&nbsp;the&nbsp;last&nbsp;UTF-8&nbsp;encoding&nbsp;in&nbsp;p&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune&nbsp;and</span><br>
<span class="lineno">240</span><span class="comment" id="1889517">//&nbsp;its&nbsp;width&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;p&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="1889595">//&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible</span><br>
<span class="lineno"></span><span class="comment" id="1889670">//&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1889700">//</span><br>
<span class="lineno"></span><span class="comment" id="1889703">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno">245</span><span class="comment" id="1889778">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1889850">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1889894">func</span>&nbsp;<span class="ident" id="1889899">DecodeLastRune</span><span class="op" id="1889913">(</span><span class="ident" id="1889914">p</span>&nbsp;<span class="op" id="1889916">[</span><span class="op" id="1889917">]</span><span class="builtintype" id="1889918">byte</span><span class="op" id="1889922">)</span>&nbsp;<span class="op" id="1889924">(</span><span class="ident" id="1889925">r</span>&nbsp;<span class="builtintype" id="1889927">rune</span><span class="op" id="1889931">,</span>&nbsp;<span class="ident" id="1889933">size</span>&nbsp;<span class="builtintype" id="1889938">int</span><span class="op" id="1889941">)</span>&nbsp;<span class="op" id="1889943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1889946">end</span>&nbsp;<span class="op" id="1889950">:=</span>&nbsp;<span class="builtinfunc" id="1889953">len</span><span class="op" id="1889956">(</span><span class="ident" id="1889957">p</span><span class="op" id="1889958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1889961">if</span>&nbsp;<span class="ident" id="1889964">end</span>&nbsp;<span class="op" id="1889968">==</span>&nbsp;<span class="num" id="1889971">0</span>&nbsp;<span class="op" id="1889973">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1889977">return</span>&nbsp;<span class="ident" id="1889984">RuneError</span><span class="op" id="1889993">,</span>&nbsp;<span class="num" id="1889995">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1889998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890001">start</span>&nbsp;<span class="op" id="1890007">:=</span>&nbsp;<span class="ident" id="1890010">end</span>&nbsp;<span class="op" id="1890014">-</span>&nbsp;<span class="num" id="1890016">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890019">r</span>&nbsp;<span class="op" id="1890021">=</span>&nbsp;<span class="builtintype" id="1890023">rune</span><span class="op" id="1890027">(</span><span class="ident" id="1890028">p</span><span class="op" id="1890029">[</span><span class="ident" id="1890030">start</span><span class="op" id="1890035">]</span><span class="op" id="1890036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890039">if</span>&nbsp;<span class="ident" id="1890042">r</span>&nbsp;<span class="op" id="1890044">&lt;</span>&nbsp;<span class="ident" id="1890046">RuneSelf</span>&nbsp;<span class="op" id="1890055">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890059">return</span>&nbsp;<span class="ident" id="1890066">r</span><span class="op" id="1890067">,</span>&nbsp;<span class="num" id="1890069">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1890072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1890075">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1890125">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1890178">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890197">lim</span>&nbsp;<span class="op" id="1890201">:=</span>&nbsp;<span class="ident" id="1890204">end</span>&nbsp;<span class="op" id="1890208">-</span>&nbsp;<span class="ident" id="1890210">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890218">if</span>&nbsp;<span class="ident" id="1890221">lim</span>&nbsp;<span class="op" id="1890225">&lt;</span>&nbsp;<span class="num" id="1890227">0</span>&nbsp;<span class="op" id="1890229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890233">lim</span>&nbsp;<span class="op" id="1890237">=</span>&nbsp;<span class="num" id="1890239">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1890242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890245">for</span>&nbsp;<span class="ident" id="1890249">start</span><span class="op" id="1890254">--</span><span class="op" id="1890256">;</span>&nbsp;<span class="ident" id="1890258">start</span>&nbsp;<span class="op" id="1890264">&gt;=</span>&nbsp;<span class="ident" id="1890267">lim</span><span class="op" id="1890270">;</span>&nbsp;<span class="ident" id="1890272">start</span><span class="op" id="1890277">--</span>&nbsp;<span class="op" id="1890280">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890284">if</span>&nbsp;<span class="ident" id="1890287">RuneStart</span><span class="op" id="1890296">(</span><span class="ident" id="1890297">p</span><span class="op" id="1890298">[</span><span class="ident" id="1890299">start</span><span class="op" id="1890304">]</span><span class="op" id="1890305">)</span>&nbsp;<span class="op" id="1890307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890312">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1890320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1890323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890326">if</span>&nbsp;<span class="ident" id="1890329">start</span>&nbsp;<span class="op" id="1890335">&lt;</span>&nbsp;<span class="num" id="1890337">0</span>&nbsp;<span class="op" id="1890339">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890343">start</span>&nbsp;<span class="op" id="1890349">=</span>&nbsp;<span class="num" id="1890351">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1890354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890357">r</span><span class="op" id="1890358">,</span>&nbsp;<span class="ident" id="1890360">size</span>&nbsp;<span class="op" id="1890365">=</span>&nbsp;<span class="ident" id="1890367">DecodeRune</span><span class="op" id="1890377">(</span><span class="ident" id="1890378">p</span><span class="op" id="1890379">[</span><span class="ident" id="1890380">start</span><span class="op" id="1890385">:</span><span class="ident" id="1890386">end</span><span class="op" id="1890389">]</span><span class="op" id="1890390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890393">if</span>&nbsp;<span class="ident" id="1890396">start</span><span class="op" id="1890401">+</span><span class="ident" id="1890402">size</span>&nbsp;<span class="op" id="1890407">!=</span>&nbsp;<span class="ident" id="1890410">end</span>&nbsp;<span class="op" id="1890414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890418">return</span>&nbsp;<span class="ident" id="1890425">RuneError</span><span class="op" id="1890434">,</span>&nbsp;<span class="num" id="1890436">1</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1890439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890442">return</span>&nbsp;<span class="ident" id="1890449">r</span><span class="op" id="1890450">,</span>&nbsp;<span class="ident" id="1890452">size</span><br>
<span class="lineno"></span><span class="op" id="1890457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1890460">//&nbsp;DecodeLastRuneInString&nbsp;is&nbsp;like&nbsp;DecodeLastRune&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.&nbsp;If</span><br>
<span class="lineno">280</span><span class="comment" id="1890539">//&nbsp;s&nbsp;is&nbsp;empty&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;0).&nbsp;Otherwise,&nbsp;if&nbsp;the&nbsp;encoding&nbsp;is&nbsp;invalid,</span><br>
<span class="lineno"></span><span class="comment" id="1890619">//&nbsp;it&nbsp;returns&nbsp;(RuneError,&nbsp;1).&nbsp;Both&nbsp;are&nbsp;impossible&nbsp;results&nbsp;for&nbsp;correct&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1890696">//</span><br>
<span class="lineno"></span><span class="comment" id="1890699">//&nbsp;An&nbsp;encoding&nbsp;is&nbsp;invalid&nbsp;if&nbsp;it&nbsp;is&nbsp;incorrect&nbsp;UTF-8,&nbsp;encodes&nbsp;a&nbsp;rune&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1890774">//&nbsp;out&nbsp;of&nbsp;range,&nbsp;or&nbsp;is&nbsp;not&nbsp;the&nbsp;shortest&nbsp;possible&nbsp;UTF-8&nbsp;encoding&nbsp;for&nbsp;the</span><br>
<span class="lineno">285</span><span class="comment" id="1890846">//&nbsp;value.&nbsp;No&nbsp;other&nbsp;validation&nbsp;is&nbsp;performed.</span><br>
<span class="lineno"></span><span class="keyword" id="1890890">func</span>&nbsp;<span class="ident" id="1890895">DecodeLastRuneInString</span><span class="op" id="1890917">(</span><span class="ident" id="1890918">s</span>&nbsp;<span class="builtintype" id="1890920">string</span><span class="op" id="1890926">)</span>&nbsp;<span class="op" id="1890928">(</span><span class="ident" id="1890929">r</span>&nbsp;<span class="builtintype" id="1890931">rune</span><span class="op" id="1890935">,</span>&nbsp;<span class="ident" id="1890937">size</span>&nbsp;<span class="builtintype" id="1890942">int</span><span class="op" id="1890945">)</span>&nbsp;<span class="op" id="1890947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1890950">end</span>&nbsp;<span class="op" id="1890954">:=</span>&nbsp;<span class="builtinfunc" id="1890957">len</span><span class="op" id="1890960">(</span><span class="ident" id="1890961">s</span><span class="op" id="1890962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890965">if</span>&nbsp;<span class="ident" id="1890968">end</span>&nbsp;<span class="op" id="1890972">==</span>&nbsp;<span class="num" id="1890975">0</span>&nbsp;<span class="op" id="1890977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1890981">return</span>&nbsp;<span class="ident" id="1890988">RuneError</span><span class="op" id="1890997">,</span>&nbsp;<span class="num" id="1890999">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1891005">start</span>&nbsp;<span class="op" id="1891011">:=</span>&nbsp;<span class="ident" id="1891014">end</span>&nbsp;<span class="op" id="1891018">-</span>&nbsp;<span class="num" id="1891020">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1891023">r</span>&nbsp;<span class="op" id="1891025">=</span>&nbsp;<span class="builtintype" id="1891027">rune</span><span class="op" id="1891031">(</span><span class="ident" id="1891032">s</span><span class="op" id="1891033">[</span><span class="ident" id="1891034">start</span><span class="op" id="1891039">]</span><span class="op" id="1891040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891043">if</span>&nbsp;<span class="ident" id="1891046">r</span>&nbsp;<span class="op" id="1891048">&lt;</span>&nbsp;<span class="ident" id="1891050">RuneSelf</span>&nbsp;<span class="op" id="1891059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891063">return</span>&nbsp;<span class="ident" id="1891070">r</span><span class="op" id="1891071">,</span>&nbsp;<span class="num" id="1891073">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1891079">//&nbsp;guard&nbsp;against&nbsp;O(n^2)&nbsp;behavior&nbsp;when&nbsp;traversing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1891129">//&nbsp;backwards&nbsp;through&nbsp;strings&nbsp;with&nbsp;long&nbsp;sequences&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1891182">//&nbsp;invalid&nbsp;UTF-8.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1891201">lim</span>&nbsp;<span class="op" id="1891205">:=</span>&nbsp;<span class="ident" id="1891208">end</span>&nbsp;<span class="op" id="1891212">-</span>&nbsp;<span class="ident" id="1891214">UTFMax</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891222">if</span>&nbsp;<span class="ident" id="1891225">lim</span>&nbsp;<span class="op" id="1891229">&lt;</span>&nbsp;<span class="num" id="1891231">0</span>&nbsp;<span class="op" id="1891233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1891237">lim</span>&nbsp;<span class="op" id="1891241">=</span>&nbsp;<span class="num" id="1891243">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891249">for</span>&nbsp;<span class="ident" id="1891253">start</span><span class="op" id="1891258">--</span><span class="op" id="1891260">;</span>&nbsp;<span class="ident" id="1891262">start</span>&nbsp;<span class="op" id="1891268">&gt;=</span>&nbsp;<span class="ident" id="1891271">lim</span><span class="op" id="1891274">;</span>&nbsp;<span class="ident" id="1891276">start</span><span class="op" id="1891281">--</span>&nbsp;<span class="op" id="1891284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891288">if</span>&nbsp;<span class="ident" id="1891291">RuneStart</span><span class="op" id="1891300">(</span><span class="ident" id="1891301">s</span><span class="op" id="1891302">[</span><span class="ident" id="1891303">start</span><span class="op" id="1891308">]</span><span class="op" id="1891309">)</span>&nbsp;<span class="op" id="1891311">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891316">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891330">if</span>&nbsp;<span class="ident" id="1891333">start</span>&nbsp;<span class="op" id="1891339">&lt;</span>&nbsp;<span class="num" id="1891341">0</span>&nbsp;<span class="op" id="1891343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1891347">start</span>&nbsp;<span class="op" id="1891353">=</span>&nbsp;<span class="num" id="1891355">0</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1891361">r</span><span class="op" id="1891362">,</span>&nbsp;<span class="ident" id="1891364">size</span>&nbsp;<span class="op" id="1891369">=</span>&nbsp;<span class="ident" id="1891371">DecodeRuneInString</span><span class="op" id="1891389">(</span><span class="ident" id="1891390">s</span><span class="op" id="1891391">[</span><span class="ident" id="1891392">start</span><span class="op" id="1891397">:</span><span class="ident" id="1891398">end</span><span class="op" id="1891401">]</span><span class="op" id="1891402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891405">if</span>&nbsp;<span class="ident" id="1891408">start</span><span class="op" id="1891413">+</span><span class="ident" id="1891414">size</span>&nbsp;<span class="op" id="1891419">!=</span>&nbsp;<span class="ident" id="1891422">end</span>&nbsp;<span class="op" id="1891426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891430">return</span>&nbsp;<span class="ident" id="1891437">RuneError</span><span class="op" id="1891446">,</span>&nbsp;<span class="num" id="1891448">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891451">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891454">return</span>&nbsp;<span class="ident" id="1891461">r</span><span class="op" id="1891462">,</span>&nbsp;<span class="ident" id="1891464">size</span><br>
<span class="lineno"></span><span class="op" id="1891469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1891472">//&nbsp;RuneLen&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;required&nbsp;to&nbsp;encode&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1891540">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;the&nbsp;rune&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;value&nbsp;to&nbsp;encode&nbsp;in&nbsp;UTF-8.</span><br>
<span class="lineno">320</span><span class="keyword" id="1891610">func</span>&nbsp;<span class="ident" id="1891615">RuneLen</span><span class="op" id="1891622">(</span><span class="ident" id="1891623">r</span>&nbsp;<span class="builtintype" id="1891625">rune</span><span class="op" id="1891629">)</span>&nbsp;<span class="builtintype" id="1891631">int</span>&nbsp;<span class="op" id="1891635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891638">switch</span>&nbsp;<span class="op" id="1891645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891648">case</span>&nbsp;<span class="ident" id="1891653">r</span>&nbsp;<span class="op" id="1891655">&lt;</span>&nbsp;<span class="num" id="1891657">0</span><span class="op" id="1891658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891662">return</span>&nbsp;<span class="op" id="1891669">-</span><span class="num" id="1891670">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891673">case</span>&nbsp;<span class="ident" id="1891678">r</span>&nbsp;<span class="op" id="1891680">&lt;=</span>&nbsp;<span class="ident" id="1891683">rune1Max</span><span class="op" id="1891691">:</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891695">return</span>&nbsp;<span class="num" id="1891702">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891705">case</span>&nbsp;<span class="ident" id="1891710">r</span>&nbsp;<span class="op" id="1891712">&lt;=</span>&nbsp;<span class="ident" id="1891715">rune2Max</span><span class="op" id="1891723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891727">return</span>&nbsp;<span class="num" id="1891734">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891737">case</span>&nbsp;<span class="ident" id="1891742">surrogateMin</span>&nbsp;<span class="op" id="1891755">&lt;=</span>&nbsp;<span class="ident" id="1891758">r</span>&nbsp;<span class="op" id="1891760">&amp;&amp;</span>&nbsp;<span class="ident" id="1891763">r</span>&nbsp;<span class="op" id="1891765">&lt;=</span>&nbsp;<span class="ident" id="1891768">surrogateMax</span><span class="op" id="1891780">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891784">return</span>&nbsp;<span class="op" id="1891791">-</span><span class="num" id="1891792">1</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891795">case</span>&nbsp;<span class="ident" id="1891800">r</span>&nbsp;<span class="op" id="1891802">&lt;=</span>&nbsp;<span class="ident" id="1891805">rune3Max</span><span class="op" id="1891813">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891817">return</span>&nbsp;<span class="num" id="1891824">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891827">case</span>&nbsp;<span class="ident" id="1891832">r</span>&nbsp;<span class="op" id="1891834">&lt;=</span>&nbsp;<span class="ident" id="1891837">MaxRune</span><span class="op" id="1891844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891848">return</span>&nbsp;<span class="num" id="1891855">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1891858">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1891861">return</span>&nbsp;<span class="op" id="1891868">-</span><span class="num" id="1891869">1</span><br>
<span class="lineno"></span><span class="op" id="1891871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1891874">//&nbsp;EncodeRune&nbsp;writes&nbsp;into&nbsp;p&nbsp;(which&nbsp;must&nbsp;be&nbsp;large&nbsp;enough)&nbsp;the&nbsp;UTF-8&nbsp;encoding&nbsp;of&nbsp;the&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="1891963">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">340</span><span class="keyword" id="1892006">func</span>&nbsp;<span class="ident" id="1892011">EncodeRune</span><span class="op" id="1892021">(</span><span class="ident" id="1892022">p</span>&nbsp;<span class="op" id="1892024">[</span><span class="op" id="1892025">]</span><span class="builtintype" id="1892026">byte</span><span class="op" id="1892030">,</span>&nbsp;<span class="ident" id="1892032">r</span>&nbsp;<span class="builtintype" id="1892034">rune</span><span class="op" id="1892038">)</span>&nbsp;<span class="builtintype" id="1892040">int</span>&nbsp;<span class="op" id="1892044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1892047">//&nbsp;Negative&nbsp;values&nbsp;are&nbsp;erroneous.&nbsp;&nbsp;Making&nbsp;it&nbsp;unsigned&nbsp;addresses&nbsp;the&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892125">switch</span>&nbsp;<span class="ident" id="1892132">i</span>&nbsp;<span class="op" id="1892134">:=</span>&nbsp;<span class="builtintype" id="1892137">uint32</span><span class="op" id="1892143">(</span><span class="ident" id="1892144">r</span><span class="op" id="1892145">)</span><span class="op" id="1892146">;</span>&nbsp;<span class="op" id="1892148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892151">case</span>&nbsp;<span class="ident" id="1892156">i</span>&nbsp;<span class="op" id="1892158">&lt;=</span>&nbsp;<span class="ident" id="1892161">rune1Max</span><span class="op" id="1892169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892173">p</span><span class="op" id="1892174">[</span><span class="num" id="1892175">0</span><span class="op" id="1892176">]</span>&nbsp;<span class="op" id="1892178">=</span>&nbsp;<span class="builtintype" id="1892180">byte</span><span class="op" id="1892184">(</span><span class="ident" id="1892185">r</span><span class="op" id="1892186">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892190">return</span>&nbsp;<span class="num" id="1892197">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892200">case</span>&nbsp;<span class="ident" id="1892205">i</span>&nbsp;<span class="op" id="1892207">&lt;=</span>&nbsp;<span class="ident" id="1892210">rune2Max</span><span class="op" id="1892218">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892222">p</span><span class="op" id="1892223">[</span><span class="num" id="1892224">0</span><span class="op" id="1892225">]</span>&nbsp;<span class="op" id="1892227">=</span>&nbsp;<span class="ident" id="1892229">t2</span>&nbsp;<span class="op" id="1892232">|</span>&nbsp;<span class="builtintype" id="1892234">byte</span><span class="op" id="1892238">(</span><span class="ident" id="1892239">r</span><span class="op" id="1892240">&gt;&gt;</span><span class="num" id="1892242">6</span><span class="op" id="1892243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892247">p</span><span class="op" id="1892248">[</span><span class="num" id="1892249">1</span><span class="op" id="1892250">]</span>&nbsp;<span class="op" id="1892252">=</span>&nbsp;<span class="ident" id="1892254">tx</span>&nbsp;<span class="op" id="1892257">|</span>&nbsp;<span class="builtintype" id="1892259">byte</span><span class="op" id="1892263">(</span><span class="ident" id="1892264">r</span><span class="op" id="1892265">)</span><span class="op" id="1892266">&amp;</span><span class="ident" id="1892267">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892275">return</span>&nbsp;<span class="num" id="1892282">2</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892285">case</span>&nbsp;<span class="ident" id="1892290">i</span>&nbsp;<span class="op" id="1892292">&gt;</span>&nbsp;<span class="ident" id="1892294">MaxRune</span><span class="op" id="1892301">,</span>&nbsp;<span class="ident" id="1892303">surrogateMin</span>&nbsp;<span class="op" id="1892316">&lt;=</span>&nbsp;<span class="ident" id="1892319">i</span>&nbsp;<span class="op" id="1892321">&amp;&amp;</span>&nbsp;<span class="ident" id="1892324">i</span>&nbsp;<span class="op" id="1892326">&lt;=</span>&nbsp;<span class="ident" id="1892329">surrogateMax</span><span class="op" id="1892341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892345">r</span>&nbsp;<span class="op" id="1892347">=</span>&nbsp;<span class="ident" id="1892349">RuneError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892361">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892374">case</span>&nbsp;<span class="ident" id="1892379">i</span>&nbsp;<span class="op" id="1892381">&lt;=</span>&nbsp;<span class="ident" id="1892384">rune3Max</span><span class="op" id="1892392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892396">p</span><span class="op" id="1892397">[</span><span class="num" id="1892398">0</span><span class="op" id="1892399">]</span>&nbsp;<span class="op" id="1892401">=</span>&nbsp;<span class="ident" id="1892403">t3</span>&nbsp;<span class="op" id="1892406">|</span>&nbsp;<span class="builtintype" id="1892408">byte</span><span class="op" id="1892412">(</span><span class="ident" id="1892413">r</span><span class="op" id="1892414">&gt;&gt;</span><span class="num" id="1892416">12</span><span class="op" id="1892418">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892422">p</span><span class="op" id="1892423">[</span><span class="num" id="1892424">1</span><span class="op" id="1892425">]</span>&nbsp;<span class="op" id="1892427">=</span>&nbsp;<span class="ident" id="1892429">tx</span>&nbsp;<span class="op" id="1892432">|</span>&nbsp;<span class="builtintype" id="1892434">byte</span><span class="op" id="1892438">(</span><span class="ident" id="1892439">r</span><span class="op" id="1892440">&gt;&gt;</span><span class="num" id="1892442">6</span><span class="op" id="1892443">)</span><span class="op" id="1892444">&amp;</span><span class="ident" id="1892445">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892453">p</span><span class="op" id="1892454">[</span><span class="num" id="1892455">2</span><span class="op" id="1892456">]</span>&nbsp;<span class="op" id="1892458">=</span>&nbsp;<span class="ident" id="1892460">tx</span>&nbsp;<span class="op" id="1892463">|</span>&nbsp;<span class="builtintype" id="1892465">byte</span><span class="op" id="1892469">(</span><span class="ident" id="1892470">r</span><span class="op" id="1892471">)</span><span class="op" id="1892472">&amp;</span><span class="ident" id="1892473">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892481">return</span>&nbsp;<span class="num" id="1892488">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892491">default</span><span class="op" id="1892498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892502">p</span><span class="op" id="1892503">[</span><span class="num" id="1892504">0</span><span class="op" id="1892505">]</span>&nbsp;<span class="op" id="1892507">=</span>&nbsp;<span class="ident" id="1892509">t4</span>&nbsp;<span class="op" id="1892512">|</span>&nbsp;<span class="builtintype" id="1892514">byte</span><span class="op" id="1892518">(</span><span class="ident" id="1892519">r</span><span class="op" id="1892520">&gt;&gt;</span><span class="num" id="1892522">18</span><span class="op" id="1892524">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892528">p</span><span class="op" id="1892529">[</span><span class="num" id="1892530">1</span><span class="op" id="1892531">]</span>&nbsp;<span class="op" id="1892533">=</span>&nbsp;<span class="ident" id="1892535">tx</span>&nbsp;<span class="op" id="1892538">|</span>&nbsp;<span class="builtintype" id="1892540">byte</span><span class="op" id="1892544">(</span><span class="ident" id="1892545">r</span><span class="op" id="1892546">&gt;&gt;</span><span class="num" id="1892548">12</span><span class="op" id="1892550">)</span><span class="op" id="1892551">&amp;</span><span class="ident" id="1892552">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892560">p</span><span class="op" id="1892561">[</span><span class="num" id="1892562">2</span><span class="op" id="1892563">]</span>&nbsp;<span class="op" id="1892565">=</span>&nbsp;<span class="ident" id="1892567">tx</span>&nbsp;<span class="op" id="1892570">|</span>&nbsp;<span class="builtintype" id="1892572">byte</span><span class="op" id="1892576">(</span><span class="ident" id="1892577">r</span><span class="op" id="1892578">&gt;&gt;</span><span class="num" id="1892580">6</span><span class="op" id="1892581">)</span><span class="op" id="1892582">&amp;</span><span class="ident" id="1892583">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892591">p</span><span class="op" id="1892592">[</span><span class="num" id="1892593">3</span><span class="op" id="1892594">]</span>&nbsp;<span class="op" id="1892596">=</span>&nbsp;<span class="ident" id="1892598">tx</span>&nbsp;<span class="op" id="1892601">|</span>&nbsp;<span class="builtintype" id="1892603">byte</span><span class="op" id="1892607">(</span><span class="ident" id="1892608">r</span><span class="op" id="1892609">)</span><span class="op" id="1892610">&amp;</span><span class="ident" id="1892611">maskx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892619">return</span>&nbsp;<span class="num" id="1892626">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1892629">}</span><br>
<span class="lineno">365</span><span class="op" id="1892631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1892634">//&nbsp;RuneCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;runes&nbsp;in&nbsp;p.&nbsp;&nbsp;Erroneous&nbsp;and&nbsp;short</span><br>
<span class="lineno"></span><span class="comment" id="1892702">//&nbsp;encodings&nbsp;are&nbsp;treated&nbsp;as&nbsp;single&nbsp;runes&nbsp;of&nbsp;width&nbsp;1&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="1892760">func</span>&nbsp;<span class="ident" id="1892765">RuneCount</span><span class="op" id="1892774">(</span><span class="ident" id="1892775">p</span>&nbsp;<span class="op" id="1892777">[</span><span class="op" id="1892778">]</span><span class="builtintype" id="1892779">byte</span><span class="op" id="1892783">)</span>&nbsp;<span class="builtintype" id="1892785">int</span>&nbsp;<span class="op" id="1892789">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892792">i</span>&nbsp;<span class="op" id="1892794">:=</span>&nbsp;<span class="num" id="1892797">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892800">var</span>&nbsp;<span class="ident" id="1892804">n</span>&nbsp;<span class="builtintype" id="1892806">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892811">for</span>&nbsp;<span class="ident" id="1892815">n</span>&nbsp;<span class="op" id="1892817">=</span>&nbsp;<span class="num" id="1892819">0</span><span class="op" id="1892820">;</span>&nbsp;<span class="ident" id="1892822">i</span>&nbsp;<span class="op" id="1892824">&lt;</span>&nbsp;<span class="builtinfunc" id="1892826">len</span><span class="op" id="1892829">(</span><span class="ident" id="1892830">p</span><span class="op" id="1892831">)</span><span class="op" id="1892832">;</span>&nbsp;<span class="ident" id="1892834">n</span><span class="op" id="1892835">++</span>&nbsp;<span class="op" id="1892838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892842">if</span>&nbsp;<span class="ident" id="1892845">p</span><span class="op" id="1892846">[</span><span class="ident" id="1892847">i</span><span class="op" id="1892848">]</span>&nbsp;<span class="op" id="1892850">&lt;</span>&nbsp;<span class="ident" id="1892852">RuneSelf</span>&nbsp;<span class="op" id="1892861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892866">i</span><span class="op" id="1892867">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1892872">}</span>&nbsp;<span class="keyword" id="1892874">else</span>&nbsp;<span class="op" id="1892879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892884">_</span><span class="op" id="1892885">,</span>&nbsp;<span class="ident" id="1892887">size</span>&nbsp;<span class="op" id="1892892">:=</span>&nbsp;<span class="ident" id="1892895">DecodeRune</span><span class="op" id="1892905">(</span><span class="ident" id="1892906">p</span><span class="op" id="1892907">[</span><span class="ident" id="1892908">i</span><span class="op" id="1892909">:</span><span class="op" id="1892910">]</span><span class="op" id="1892911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1892916">i</span>&nbsp;<span class="op" id="1892918">+=</span>&nbsp;<span class="ident" id="1892921">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1892928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1892931">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1892934">return</span>&nbsp;<span class="ident" id="1892941">n</span><br>
<span class="lineno"></span><span class="op" id="1892943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1892946">//&nbsp;RuneCountInString&nbsp;is&nbsp;like&nbsp;RuneCount&nbsp;but&nbsp;its&nbsp;input&nbsp;is&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="1893012">func</span>&nbsp;<span class="ident" id="1893017">RuneCountInString</span><span class="op" id="1893034">(</span><span class="ident" id="1893035">s</span>&nbsp;<span class="builtintype" id="1893037">string</span><span class="op" id="1893043">)</span>&nbsp;<span class="op" id="1893045">(</span><span class="ident" id="1893046">n</span>&nbsp;<span class="builtintype" id="1893048">int</span><span class="op" id="1893051">)</span>&nbsp;<span class="op" id="1893053">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893056">for</span>&nbsp;<span class="keyword" id="1893060">range</span>&nbsp;<span class="ident" id="1893066">s</span>&nbsp;<span class="op" id="1893068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1893072">n</span><span class="op" id="1893073">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1893077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893080">return</span><br>
<span class="lineno"></span><span class="op" id="1893087">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="1893090">//&nbsp;RuneStart&nbsp;reports&nbsp;whether&nbsp;the&nbsp;byte&nbsp;could&nbsp;be&nbsp;the&nbsp;first&nbsp;byte&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1893155">//&nbsp;an&nbsp;encoded&nbsp;rune.&nbsp;&nbsp;Second&nbsp;and&nbsp;subsequent&nbsp;bytes&nbsp;always&nbsp;have&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span><span class="comment" id="1893224">//&nbsp;two&nbsp;bits&nbsp;set&nbsp;to&nbsp;10.</span><br>
<span class="lineno"></span><span class="keyword" id="1893247">func</span>&nbsp;<span class="ident" id="1893252">RuneStart</span><span class="op" id="1893261">(</span><span class="ident" id="1893262">b</span>&nbsp;<span class="builtintype" id="1893264">byte</span><span class="op" id="1893268">)</span>&nbsp;<span class="builtintype" id="1893270">bool</span>&nbsp;<span class="op" id="1893275">{</span>&nbsp;<span class="keyword" id="1893277">return</span>&nbsp;<span class="ident" id="1893284">b</span><span class="op" id="1893285">&amp;</span><span class="num" id="1893286">0xC0</span>&nbsp;<span class="op" id="1893291">!=</span>&nbsp;<span class="num" id="1893294">0x80</span>&nbsp;<span class="op" id="1893299">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1893302">//&nbsp;Valid&nbsp;reports&nbsp;whether&nbsp;p&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1893377">func</span>&nbsp;<span class="ident" id="1893382">Valid</span><span class="op" id="1893387">(</span><span class="ident" id="1893388">p</span>&nbsp;<span class="op" id="1893390">[</span><span class="op" id="1893391">]</span><span class="builtintype" id="1893392">byte</span><span class="op" id="1893396">)</span>&nbsp;<span class="builtintype" id="1893398">bool</span>&nbsp;<span class="op" id="1893403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1893406">i</span>&nbsp;<span class="op" id="1893408">:=</span>&nbsp;<span class="num" id="1893411">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893414">for</span>&nbsp;<span class="ident" id="1893418">i</span>&nbsp;<span class="op" id="1893420">&lt;</span>&nbsp;<span class="builtinfunc" id="1893422">len</span><span class="op" id="1893425">(</span><span class="ident" id="1893426">p</span><span class="op" id="1893427">)</span>&nbsp;<span class="op" id="1893429">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893433">if</span>&nbsp;<span class="ident" id="1893436">p</span><span class="op" id="1893437">[</span><span class="ident" id="1893438">i</span><span class="op" id="1893439">]</span>&nbsp;<span class="op" id="1893441">&lt;</span>&nbsp;<span class="ident" id="1893443">RuneSelf</span>&nbsp;<span class="op" id="1893452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1893457">i</span><span class="op" id="1893458">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1893463">}</span>&nbsp;<span class="keyword" id="1893465">else</span>&nbsp;<span class="op" id="1893470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1893475">_</span><span class="op" id="1893476">,</span>&nbsp;<span class="ident" id="1893478">size</span>&nbsp;<span class="op" id="1893483">:=</span>&nbsp;<span class="ident" id="1893486">DecodeRune</span><span class="op" id="1893496">(</span><span class="ident" id="1893497">p</span><span class="op" id="1893498">[</span><span class="ident" id="1893499">i</span><span class="op" id="1893500">:</span><span class="op" id="1893501">]</span><span class="op" id="1893502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893507">if</span>&nbsp;<span class="ident" id="1893510">size</span>&nbsp;<span class="op" id="1893515">==</span>&nbsp;<span class="num" id="1893518">1</span>&nbsp;<span class="op" id="1893520">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1893526">//&nbsp;All&nbsp;valid&nbsp;runes&nbsp;of&nbsp;size&nbsp;1&nbsp;(those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1893566">//&nbsp;below&nbsp;RuneSelf)&nbsp;were&nbsp;handled&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1893609">//&nbsp;This&nbsp;must&nbsp;be&nbsp;a&nbsp;RuneError.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893642">return</span>&nbsp;<span class="builtintype" id="1893649">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1893658">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1893663">i</span>&nbsp;<span class="op" id="1893665">+=</span>&nbsp;<span class="ident" id="1893668">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1893675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1893678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893681">return</span>&nbsp;<span class="builtintype" id="1893688">true</span><br>
<span class="lineno"></span><span class="op" id="1893693">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="1893696">//&nbsp;ValidString&nbsp;reports&nbsp;whether&nbsp;s&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;valid&nbsp;UTF-8-encoded&nbsp;runes.</span><br>
<span class="lineno"></span><span class="keyword" id="1893777">func</span>&nbsp;<span class="ident" id="1893782">ValidString</span><span class="op" id="1893793">(</span><span class="ident" id="1893794">s</span>&nbsp;<span class="builtintype" id="1893796">string</span><span class="op" id="1893802">)</span>&nbsp;<span class="builtintype" id="1893804">bool</span>&nbsp;<span class="op" id="1893809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893812">for</span>&nbsp;<span class="ident" id="1893816">i</span><span class="op" id="1893817">,</span>&nbsp;<span class="ident" id="1893819">r</span>&nbsp;<span class="op" id="1893821">:=</span>&nbsp;<span class="keyword" id="1893824">range</span>&nbsp;<span class="ident" id="1893830">s</span>&nbsp;<span class="op" id="1893832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1893836">if</span>&nbsp;<span class="ident" id="1893839">r</span>&nbsp;<span class="op" id="1893841">==</span>&nbsp;<span class="ident" id="1893844">RuneError</span>&nbsp;<span class="op" id="1893854">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1893859">//&nbsp;The&nbsp;RuneError&nbsp;value&nbsp;can&nbsp;be&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1893901">//&nbsp;sentinel&nbsp;value&nbsp;(if&nbsp;it&#39;s&nbsp;size&nbsp;1)&nbsp;or&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1893951">//&nbsp;value&nbsp;encoded&nbsp;properly.&nbsp;Decode&nbsp;it&nbsp;to&nbsp;see&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1894001">//&nbsp;it&#39;s&nbsp;the&nbsp;1&nbsp;byte&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1894039">_</span><span class="op" id="1894040">,</span>&nbsp;<span class="ident" id="1894042">size</span>&nbsp;<span class="op" id="1894047">:=</span>&nbsp;<span class="ident" id="1894050">DecodeRuneInString</span><span class="op" id="1894068">(</span><span class="ident" id="1894069">s</span><span class="op" id="1894070">[</span><span class="ident" id="1894071">i</span><span class="op" id="1894072">:</span><span class="op" id="1894073">]</span><span class="op" id="1894074">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894079">if</span>&nbsp;<span class="ident" id="1894082">size</span>&nbsp;<span class="op" id="1894087">==</span>&nbsp;<span class="num" id="1894090">1</span>&nbsp;<span class="op" id="1894092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894098">return</span>&nbsp;<span class="builtintype" id="1894105">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1894114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1894118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1894121">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894124">return</span>&nbsp;<span class="builtintype" id="1894131">true</span><br>
<span class="lineno"></span><span class="op" id="1894136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1894139">//&nbsp;ValidRune&nbsp;reports&nbsp;whether&nbsp;r&nbsp;can&nbsp;be&nbsp;legally&nbsp;encoded&nbsp;as&nbsp;UTF-8.</span><br>
<span class="lineno"></span><span class="comment" id="1894203">//&nbsp;Code&nbsp;points&nbsp;that&nbsp;are&nbsp;out&nbsp;of&nbsp;range&nbsp;or&nbsp;a&nbsp;surrogate&nbsp;half&nbsp;are&nbsp;illegal.</span><br>
<span class="lineno">435</span><span class="keyword" id="1894273">func</span>&nbsp;<span class="ident" id="1894278">ValidRune</span><span class="op" id="1894287">(</span><span class="ident" id="1894288">r</span>&nbsp;<span class="builtintype" id="1894290">rune</span><span class="op" id="1894294">)</span>&nbsp;<span class="builtintype" id="1894296">bool</span>&nbsp;<span class="op" id="1894301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894304">switch</span>&nbsp;<span class="op" id="1894311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894314">case</span>&nbsp;<span class="ident" id="1894319">r</span>&nbsp;<span class="op" id="1894321">&lt;</span>&nbsp;<span class="num" id="1894323">0</span><span class="op" id="1894324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894328">return</span>&nbsp;<span class="builtintype" id="1894335">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894342">case</span>&nbsp;<span class="ident" id="1894347">surrogateMin</span>&nbsp;<span class="op" id="1894360">&lt;=</span>&nbsp;<span class="ident" id="1894363">r</span>&nbsp;<span class="op" id="1894365">&amp;&amp;</span>&nbsp;<span class="ident" id="1894368">r</span>&nbsp;<span class="op" id="1894370">&lt;=</span>&nbsp;<span class="ident" id="1894373">surrogateMax</span><span class="op" id="1894385">:</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894389">return</span>&nbsp;<span class="builtintype" id="1894396">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894403">case</span>&nbsp;<span class="ident" id="1894408">r</span>&nbsp;<span class="op" id="1894410">&gt;</span>&nbsp;<span class="ident" id="1894412">MaxRune</span><span class="op" id="1894419">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894423">return</span>&nbsp;<span class="builtintype" id="1894430">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1894437">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1894440">return</span>&nbsp;<span class="builtintype" id="1894447">true</span><br>
<span class="lineno">445</span><span class="op" id="1894452">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
