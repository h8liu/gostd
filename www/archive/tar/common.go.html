<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6008601">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6008656">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6008710">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6008761">//&nbsp;Package&nbsp;tar&nbsp;implements&nbsp;access&nbsp;to&nbsp;tar&nbsp;archives.</span><br>
<span class="lineno"></span><span class="comment" id="6008811">//&nbsp;It&nbsp;aims&nbsp;to&nbsp;cover&nbsp;most&nbsp;of&nbsp;the&nbsp;variations,&nbsp;including&nbsp;those&nbsp;produced</span><br>
<span class="lineno"></span><span class="comment" id="6008880">//&nbsp;by&nbsp;GNU&nbsp;and&nbsp;BSD&nbsp;tars.</span><br>
<span class="lineno"></span><span class="comment" id="6008904">//</span><br>
<span class="lineno"></span><span class="comment" id="6008907">//&nbsp;References:</span><br>
<span class="lineno">10</span><span class="comment" id="6008922">//&nbsp;&nbsp;&nbsp;http://www.freebsd.org/cgi/man.cgi?query=tar&amp;sektion=5</span><br>
<span class="lineno"></span><span class="comment" id="6008982">//&nbsp;&nbsp;&nbsp;http://www.gnu.org/software/tar/manual/html_node/Standard.html</span><br>
<span class="lineno"></span><span class="comment" id="6009050">//&nbsp;&nbsp;&nbsp;http://pubs.opengroup.org/onlinepubs/9699919799/utilities/pax.html</span><br>
<span class="lineno"></span><span class="keyword" id="6009122">package</span>&nbsp;<span class="ident" id="6009130">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6009135">import</span>&nbsp;<span class="op" id="6009142">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6009145">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6009154">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6009164">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6009171">&#34;os&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6009177">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6009185">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6009192">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6009195">const</span>&nbsp;<span class="op" id="6009201">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009204">blockSize</span>&nbsp;<span class="op" id="6009214">=</span>&nbsp;<span class="num" id="6009216">512</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6009222">//&nbsp;Types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009232">TypeReg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009250">=</span>&nbsp;<span class="string" id="6009252">&#39;0&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009259">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009276">TypeRegA</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009294">=</span>&nbsp;<span class="string" id="6009296">&#39;\x00&#39;</span>&nbsp;<span class="comment" id="6009303">//&nbsp;regular&nbsp;file</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009320">TypeLink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009338">=</span>&nbsp;<span class="string" id="6009340">&#39;1&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009347">//&nbsp;hard&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009361">TypeSymlink</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009379">=</span>&nbsp;<span class="string" id="6009381">&#39;2&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009388">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009406">TypeChar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009424">=</span>&nbsp;<span class="string" id="6009426">&#39;3&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009433">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009459">TypeBlock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009477">=</span>&nbsp;<span class="string" id="6009479">&#39;4&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009486">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009508">TypeDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009526">=</span>&nbsp;<span class="string" id="6009528">&#39;5&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009535">//&nbsp;directory</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009549">TypeFifo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009567">=</span>&nbsp;<span class="string" id="6009569">&#39;6&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009576">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009590">TypeCont</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009608">=</span>&nbsp;<span class="string" id="6009610">&#39;7&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009617">//&nbsp;reserved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009630">TypeXHeader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009648">=</span>&nbsp;<span class="string" id="6009650">&#39;x&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009657">//&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009677">TypeXGlobalHeader</span>&nbsp;<span class="op" id="6009695">=</span>&nbsp;<span class="string" id="6009697">&#39;g&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009704">//&nbsp;global&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009731">TypeGNULongName</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6009749">=</span>&nbsp;<span class="string" id="6009751">&#39;L&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009758">//&nbsp;Next&nbsp;file&nbsp;has&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009788">TypeGNULongLink</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6009806">=</span>&nbsp;<span class="string" id="6009808">&#39;K&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009815">//&nbsp;Next&nbsp;file&nbsp;symlinks&nbsp;to&nbsp;a&nbsp;file&nbsp;w/&nbsp;a&nbsp;long&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6009863">TypeGNUSparse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6009881">=</span>&nbsp;<span class="string" id="6009883">&#39;S&#39;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6009890">//&nbsp;sparse&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="6009905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6009908">//&nbsp;A&nbsp;Header&nbsp;represents&nbsp;a&nbsp;single&nbsp;header&nbsp;in&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno">45</span><span class="comment" id="6009965">//&nbsp;Some&nbsp;fields&nbsp;may&nbsp;not&nbsp;be&nbsp;populated.</span><br>
<span class="lineno"></span><span class="keyword" id="6010002">type</span>&nbsp;<span class="ident" id="6010007">Header</span>&nbsp;<span class="keyword" id="6010014">struct</span>&nbsp;<span class="op" id="6010021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010024">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010035">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010045">//&nbsp;name&nbsp;of&nbsp;header&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010075">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010086">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010096">//&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010125">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010136">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010146">//&nbsp;user&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010167">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010178">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010188">//&nbsp;group&nbsp;id&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010210">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010221">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010231">//&nbsp;length&nbsp;in&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010251">ModTime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6010262">time</span><span class="op" id="6010266">.</span><span class="ident" id="6010267">Time</span>&nbsp;<span class="comment" id="6010272">//&nbsp;modified&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010290">Typeflag</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010301">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010311">//&nbsp;type&nbsp;of&nbsp;header&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010336">Linkname</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010347">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010357">//&nbsp;target&nbsp;name&nbsp;of&nbsp;link</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010381">Uname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010392">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010402">//&nbsp;user&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010425">Gname</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6010436">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010446">//&nbsp;group&nbsp;name&nbsp;of&nbsp;owner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010470">Devmajor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6010481">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010491">//&nbsp;major&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010537">Devminor</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6010548">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6010558">//&nbsp;minor&nbsp;number&nbsp;of&nbsp;character&nbsp;or&nbsp;block&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010604">AccessTime</span>&nbsp;<span class="ident" id="6010615">time</span><span class="op" id="6010619">.</span><span class="ident" id="6010620">Time</span>&nbsp;<span class="comment" id="6010625">//&nbsp;access&nbsp;time</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010641">ChangeTime</span>&nbsp;<span class="ident" id="6010652">time</span><span class="op" id="6010656">.</span><span class="ident" id="6010657">Time</span>&nbsp;<span class="comment" id="6010662">//&nbsp;status&nbsp;change&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010685">Xattrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6010696">map</span><span class="op" id="6010699">[</span><span class="builtintype" id="6010700">string</span><span class="op" id="6010706">]</span><span class="builtintype" id="6010707">string</span><br>
<span class="lineno"></span><span class="op" id="6010714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6010717">//&nbsp;File&nbsp;name&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno">65</span><span class="keyword" id="6010759">const</span>&nbsp;<span class="op" id="6010765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010768">fileNameSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6010787">=</span>&nbsp;<span class="num" id="6010789">100</span>&nbsp;<span class="comment" id="6010793">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;a&nbsp;standard&nbsp;tar&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6010845">fileNamePrefixSize</span>&nbsp;<span class="op" id="6010864">=</span>&nbsp;<span class="num" id="6010866">155</span>&nbsp;<span class="comment" id="6010870">//&nbsp;Maximum&nbsp;number&nbsp;of&nbsp;ustar&nbsp;extension&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="op" id="6010914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6010917">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;Header.</span><br>
<span class="lineno"></span><span class="keyword" id="6010968">func</span>&nbsp;<span class="op" id="6010973">(</span><span class="ident" id="6010974">h</span>&nbsp;<span class="op" id="6010976">*</span><span class="ident" id="6010977">Header</span><span class="op" id="6010983">)</span>&nbsp;<span class="ident" id="6010985">FileInfo</span><span class="op" id="6010993">(</span><span class="op" id="6010994">)</span>&nbsp;<span class="ident" id="6010996">os</span><span class="op" id="6010998">.</span><span class="ident" id="6010999">FileInfo</span>&nbsp;<span class="op" id="6011008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011011">return</span>&nbsp;<span class="ident" id="6011018">headerFileInfo</span><span class="op" id="6011032">{</span><span class="ident" id="6011033">h</span><span class="op" id="6011034">}</span><br>
<span class="lineno"></span><span class="op" id="6011036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6011039">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6011081">type</span>&nbsp;<span class="ident" id="6011086">headerFileInfo</span>&nbsp;<span class="keyword" id="6011101">struct</span>&nbsp;<span class="op" id="6011108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011111">h</span>&nbsp;<span class="op" id="6011113">*</span><span class="ident" id="6011114">Header</span><br>
<span class="lineno"></span><span class="op" id="6011121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6011124">func</span>&nbsp;<span class="op" id="6011129">(</span><span class="ident" id="6011130">fi</span>&nbsp;<span class="ident" id="6011133">headerFileInfo</span><span class="op" id="6011147">)</span>&nbsp;<span class="ident" id="6011149">Size</span><span class="op" id="6011153">(</span><span class="op" id="6011154">)</span>&nbsp;<span class="ident" id="6011156">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011169">{</span>&nbsp;<span class="keyword" id="6011171">return</span>&nbsp;<span class="ident" id="6011178">fi</span><span class="op" id="6011180">.</span><span class="ident" id="6011181">h</span><span class="op" id="6011182">.</span><span class="ident" id="6011183">Size</span>&nbsp;<span class="op" id="6011188">}</span><br>
<span class="lineno"></span><span class="keyword" id="6011190">func</span>&nbsp;<span class="op" id="6011195">(</span><span class="ident" id="6011196">fi</span>&nbsp;<span class="ident" id="6011199">headerFileInfo</span><span class="op" id="6011213">)</span>&nbsp;<span class="ident" id="6011215">IsDir</span><span class="op" id="6011220">(</span><span class="op" id="6011221">)</span>&nbsp;<span class="builtintype" id="6011223">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6011235">{</span>&nbsp;<span class="keyword" id="6011237">return</span>&nbsp;<span class="ident" id="6011244">fi</span><span class="op" id="6011246">.</span><span class="ident" id="6011247">Mode</span><span class="op" id="6011251">(</span><span class="op" id="6011252">)</span><span class="op" id="6011253">.</span><span class="ident" id="6011254">IsDir</span><span class="op" id="6011259">(</span><span class="op" id="6011260">)</span>&nbsp;<span class="op" id="6011262">}</span><br>
<span class="lineno"></span><span class="keyword" id="6011264">func</span>&nbsp;<span class="op" id="6011269">(</span><span class="ident" id="6011270">fi</span>&nbsp;<span class="ident" id="6011273">headerFileInfo</span><span class="op" id="6011287">)</span>&nbsp;<span class="ident" id="6011289">ModTime</span><span class="op" id="6011296">(</span><span class="op" id="6011297">)</span>&nbsp;<span class="ident" id="6011299">time</span><span class="op" id="6011303">.</span><span class="ident" id="6011304">Time</span>&nbsp;<span class="op" id="6011309">{</span>&nbsp;<span class="keyword" id="6011311">return</span>&nbsp;<span class="ident" id="6011318">fi</span><span class="op" id="6011320">.</span><span class="ident" id="6011321">h</span><span class="op" id="6011322">.</span><span class="ident" id="6011323">ModTime</span>&nbsp;<span class="op" id="6011331">}</span><br>
<span class="lineno"></span><span class="keyword" id="6011333">func</span>&nbsp;<span class="op" id="6011338">(</span><span class="ident" id="6011339">fi</span>&nbsp;<span class="ident" id="6011342">headerFileInfo</span><span class="op" id="6011356">)</span>&nbsp;<span class="ident" id="6011358">Sys</span><span class="op" id="6011361">(</span><span class="op" id="6011362">)</span>&nbsp;<span class="keyword" id="6011364">interface</span><span class="op" id="6011373">{</span><span class="op" id="6011374">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6011378">{</span>&nbsp;<span class="keyword" id="6011380">return</span>&nbsp;<span class="ident" id="6011387">fi</span><span class="op" id="6011389">.</span><span class="ident" id="6011390">h</span>&nbsp;<span class="op" id="6011392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6011395">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;base&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6011438">func</span>&nbsp;<span class="op" id="6011443">(</span><span class="ident" id="6011444">fi</span>&nbsp;<span class="ident" id="6011447">headerFileInfo</span><span class="op" id="6011461">)</span>&nbsp;<span class="ident" id="6011463">Name</span><span class="op" id="6011467">(</span><span class="op" id="6011468">)</span>&nbsp;<span class="builtintype" id="6011470">string</span>&nbsp;<span class="op" id="6011477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011480">if</span>&nbsp;<span class="ident" id="6011483">fi</span><span class="op" id="6011485">.</span><span class="ident" id="6011486">IsDir</span><span class="op" id="6011491">(</span><span class="op" id="6011492">)</span>&nbsp;<span class="op" id="6011494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011498">return</span>&nbsp;<span class="ident" id="6011505">path</span><span class="op" id="6011509">.</span><span class="ident" id="6011510">Base</span><span class="op" id="6011514">(</span><span class="ident" id="6011515">path</span><span class="op" id="6011519">.</span><span class="ident" id="6011520">Clean</span><span class="op" id="6011525">(</span><span class="ident" id="6011526">fi</span><span class="op" id="6011528">.</span><span class="ident" id="6011529">h</span><span class="op" id="6011530">.</span><span class="ident" id="6011531">Name</span><span class="op" id="6011535">)</span><span class="op" id="6011536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011539">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011542">return</span>&nbsp;<span class="ident" id="6011549">path</span><span class="op" id="6011553">.</span><span class="ident" id="6011554">Base</span><span class="op" id="6011558">(</span><span class="ident" id="6011559">fi</span><span class="op" id="6011561">.</span><span class="ident" id="6011562">h</span><span class="op" id="6011563">.</span><span class="ident" id="6011564">Name</span><span class="op" id="6011568">)</span><br>
<span class="lineno"></span><span class="op" id="6011570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6011573">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;headerFileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="6011642">func</span>&nbsp;<span class="op" id="6011647">(</span><span class="ident" id="6011648">fi</span>&nbsp;<span class="ident" id="6011651">headerFileInfo</span><span class="op" id="6011665">)</span>&nbsp;<span class="ident" id="6011667">Mode</span><span class="op" id="6011671">(</span><span class="op" id="6011672">)</span>&nbsp;<span class="op" id="6011674">(</span><span class="ident" id="6011675">mode</span>&nbsp;<span class="ident" id="6011680">os</span><span class="op" id="6011682">.</span><span class="ident" id="6011683">FileMode</span><span class="op" id="6011691">)</span>&nbsp;<span class="op" id="6011693">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011696">//&nbsp;Set&nbsp;file&nbsp;permission&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011726">mode</span>&nbsp;<span class="op" id="6011731">=</span>&nbsp;<span class="ident" id="6011733">os</span><span class="op" id="6011735">.</span><span class="ident" id="6011736">FileMode</span><span class="op" id="6011744">(</span><span class="ident" id="6011745">fi</span><span class="op" id="6011747">.</span><span class="ident" id="6011748">h</span><span class="op" id="6011749">.</span><span class="ident" id="6011750">Mode</span><span class="op" id="6011754">)</span><span class="op" id="6011755">.</span><span class="ident" id="6011756">Perm</span><span class="op" id="6011760">(</span><span class="op" id="6011761">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011765">//&nbsp;Set&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011805">if</span>&nbsp;<span class="ident" id="6011808">fi</span><span class="op" id="6011810">.</span><span class="ident" id="6011811">h</span><span class="op" id="6011812">.</span><span class="ident" id="6011813">Mode</span><span class="op" id="6011817">&amp;</span><span class="ident" id="6011818">c_ISUID</span>&nbsp;<span class="op" id="6011826">!=</span>&nbsp;<span class="num" id="6011829">0</span>&nbsp;<span class="op" id="6011831">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011835">//&nbsp;setuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011847">mode</span>&nbsp;<span class="op" id="6011852">|=</span>&nbsp;<span class="ident" id="6011855">os</span><span class="op" id="6011857">.</span><span class="ident" id="6011858">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011873">if</span>&nbsp;<span class="ident" id="6011876">fi</span><span class="op" id="6011878">.</span><span class="ident" id="6011879">h</span><span class="op" id="6011880">.</span><span class="ident" id="6011881">Mode</span><span class="op" id="6011885">&amp;</span><span class="ident" id="6011886">c_ISGID</span>&nbsp;<span class="op" id="6011894">!=</span>&nbsp;<span class="num" id="6011897">0</span>&nbsp;<span class="op" id="6011899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011903">//&nbsp;setgid</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011915">mode</span>&nbsp;<span class="op" id="6011920">|=</span>&nbsp;<span class="ident" id="6011923">os</span><span class="op" id="6011925">.</span><span class="ident" id="6011926">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6011938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6011941">if</span>&nbsp;<span class="ident" id="6011944">fi</span><span class="op" id="6011946">.</span><span class="ident" id="6011947">h</span><span class="op" id="6011948">.</span><span class="ident" id="6011949">Mode</span><span class="op" id="6011953">&amp;</span><span class="ident" id="6011954">c_ISVTX</span>&nbsp;<span class="op" id="6011962">!=</span>&nbsp;<span class="num" id="6011965">0</span>&nbsp;<span class="op" id="6011967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6011971">//&nbsp;sticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6011983">mode</span>&nbsp;<span class="op" id="6011988">|=</span>&nbsp;<span class="ident" id="6011991">os</span><span class="op" id="6011993">.</span><span class="ident" id="6011994">ModeSticky</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012010">//&nbsp;Set&nbsp;file&nbsp;mode&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012034">//&nbsp;clear&nbsp;perm,&nbsp;setuid,&nbsp;setgid&nbsp;and&nbsp;sticky&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012082">m</span>&nbsp;<span class="op" id="6012084">:=</span>&nbsp;<span class="ident" id="6012087">os</span><span class="op" id="6012089">.</span><span class="ident" id="6012090">FileMode</span><span class="op" id="6012098">(</span><span class="ident" id="6012099">fi</span><span class="op" id="6012101">.</span><span class="ident" id="6012102">h</span><span class="op" id="6012103">.</span><span class="ident" id="6012104">Mode</span><span class="op" id="6012108">)</span>&nbsp;<span class="op" id="6012110">&amp;^</span>&nbsp;<span class="num" id="6012113">07777</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012120">if</span>&nbsp;<span class="ident" id="6012123">m</span>&nbsp;<span class="op" id="6012125">==</span>&nbsp;<span class="ident" id="6012128">c_ISDIR</span>&nbsp;<span class="op" id="6012136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012140">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012155">mode</span>&nbsp;<span class="op" id="6012160">|=</span>&nbsp;<span class="ident" id="6012163">os</span><span class="op" id="6012165">.</span><span class="ident" id="6012166">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012178">if</span>&nbsp;<span class="ident" id="6012181">m</span>&nbsp;<span class="op" id="6012183">==</span>&nbsp;<span class="ident" id="6012186">c_ISFIFO</span>&nbsp;<span class="op" id="6012195">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012199">//&nbsp;named&nbsp;pipe&nbsp;(FIFO)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012222">mode</span>&nbsp;<span class="op" id="6012227">|=</span>&nbsp;<span class="ident" id="6012230">os</span><span class="op" id="6012232">.</span><span class="ident" id="6012233">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012251">if</span>&nbsp;<span class="ident" id="6012254">m</span>&nbsp;<span class="op" id="6012256">==</span>&nbsp;<span class="ident" id="6012259">c_ISLNK</span>&nbsp;<span class="op" id="6012267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012271">//&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012290">mode</span>&nbsp;<span class="op" id="6012295">|=</span>&nbsp;<span class="ident" id="6012298">os</span><span class="op" id="6012300">.</span><span class="ident" id="6012301">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012317">if</span>&nbsp;<span class="ident" id="6012320">m</span>&nbsp;<span class="op" id="6012322">==</span>&nbsp;<span class="ident" id="6012325">c_ISBLK</span>&nbsp;<span class="op" id="6012333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012337">//&nbsp;device&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012354">mode</span>&nbsp;<span class="op" id="6012359">|=</span>&nbsp;<span class="ident" id="6012362">os</span><span class="op" id="6012364">.</span><span class="ident" id="6012365">ModeDevice</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012380">if</span>&nbsp;<span class="ident" id="6012383">m</span>&nbsp;<span class="op" id="6012385">==</span>&nbsp;<span class="ident" id="6012388">c_ISCHR</span>&nbsp;<span class="op" id="6012396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012400">//&nbsp;Unix&nbsp;character&nbsp;device</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012427">mode</span>&nbsp;<span class="op" id="6012432">|=</span>&nbsp;<span class="ident" id="6012435">os</span><span class="op" id="6012437">.</span><span class="ident" id="6012438">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012451">mode</span>&nbsp;<span class="op" id="6012456">|=</span>&nbsp;<span class="ident" id="6012459">os</span><span class="op" id="6012461">.</span><span class="ident" id="6012462">ModeCharDevice</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012481">if</span>&nbsp;<span class="ident" id="6012484">m</span>&nbsp;<span class="op" id="6012486">==</span>&nbsp;<span class="ident" id="6012489">c_ISSOCK</span>&nbsp;<span class="op" id="6012498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012502">//&nbsp;Unix&nbsp;domain&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012526">mode</span>&nbsp;<span class="op" id="6012531">|=</span>&nbsp;<span class="ident" id="6012534">os</span><span class="op" id="6012536">.</span><span class="ident" id="6012537">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012549">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012553">switch</span>&nbsp;<span class="ident" id="6012560">fi</span><span class="op" id="6012562">.</span><span class="ident" id="6012563">h</span><span class="op" id="6012564">.</span><span class="ident" id="6012565">Typeflag</span>&nbsp;<span class="op" id="6012574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012577">case</span>&nbsp;<span class="ident" id="6012582">TypeLink</span><span class="op" id="6012590">,</span>&nbsp;<span class="ident" id="6012592">TypeSymlink</span><span class="op" id="6012603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012607">//&nbsp;hard&nbsp;link,&nbsp;symbolic&nbsp;link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012637">mode</span>&nbsp;<span class="op" id="6012642">|=</span>&nbsp;<span class="ident" id="6012645">os</span><span class="op" id="6012647">.</span><span class="ident" id="6012648">ModeSymlink</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012661">case</span>&nbsp;<span class="ident" id="6012666">TypeChar</span><span class="op" id="6012674">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012678">//&nbsp;character&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012705">mode</span>&nbsp;<span class="op" id="6012710">|=</span>&nbsp;<span class="ident" id="6012713">os</span><span class="op" id="6012715">.</span><span class="ident" id="6012716">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012729">mode</span>&nbsp;<span class="op" id="6012734">|=</span>&nbsp;<span class="ident" id="6012737">os</span><span class="op" id="6012739">.</span><span class="ident" id="6012740">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012756">case</span>&nbsp;<span class="ident" id="6012761">TypeBlock</span><span class="op" id="6012770">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012774">//&nbsp;block&nbsp;device&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012797">mode</span>&nbsp;<span class="op" id="6012802">|=</span>&nbsp;<span class="ident" id="6012805">os</span><span class="op" id="6012807">.</span><span class="ident" id="6012808">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012820">case</span>&nbsp;<span class="ident" id="6012825">TypeDir</span><span class="op" id="6012832">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012836">//&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012851">mode</span>&nbsp;<span class="op" id="6012856">|=</span>&nbsp;<span class="ident" id="6012859">os</span><span class="op" id="6012861">.</span><span class="ident" id="6012862">ModeDir</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012871">case</span>&nbsp;<span class="ident" id="6012876">TypeFifo</span><span class="op" id="6012884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6012888">//&nbsp;fifo&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6012903">mode</span>&nbsp;<span class="op" id="6012908">|=</span>&nbsp;<span class="ident" id="6012911">os</span><span class="op" id="6012913">.</span><span class="ident" id="6012914">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6012929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6012933">return</span>&nbsp;<span class="ident" id="6012940">mode</span><br>
<span class="lineno"></span><span class="op" id="6012945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6012948">//&nbsp;sysStat,&nbsp;if&nbsp;non-nil,&nbsp;populates&nbsp;h&nbsp;from&nbsp;system-dependent&nbsp;fields&nbsp;of&nbsp;fi.</span><br>
<span class="lineno"></span><span class="keyword" id="6013020">var</span>&nbsp;<span class="ident" id="6013024">sysStat</span>&nbsp;<span class="keyword" id="6013032">func</span><span class="op" id="6013036">(</span><span class="ident" id="6013037">fi</span>&nbsp;<span class="ident" id="6013040">os</span><span class="op" id="6013042">.</span><span class="ident" id="6013043">FileInfo</span><span class="op" id="6013051">,</span>&nbsp;<span class="ident" id="6013053">h</span>&nbsp;<span class="op" id="6013055">*</span><span class="ident" id="6013056">Header</span><span class="op" id="6013062">)</span>&nbsp;<span class="builtintype" id="6013064">error</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="6013071">//&nbsp;Mode&nbsp;constants&nbsp;from&nbsp;the&nbsp;tar&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="6013108">const</span>&nbsp;<span class="op" id="6013114">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013117">c_ISUID</span>&nbsp;&nbsp;<span class="op" id="6013126">=</span>&nbsp;<span class="num" id="6013128">04000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6013136">//&nbsp;Set&nbsp;uid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013148">c_ISGID</span>&nbsp;&nbsp;<span class="op" id="6013157">=</span>&nbsp;<span class="num" id="6013159">02000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6013167">//&nbsp;Set&nbsp;gid</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013179">c_ISVTX</span>&nbsp;&nbsp;<span class="op" id="6013188">=</span>&nbsp;<span class="num" id="6013190">01000</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6013198">//&nbsp;Save&nbsp;text&nbsp;(sticky&nbsp;bit)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013225">c_ISDIR</span>&nbsp;&nbsp;<span class="op" id="6013234">=</span>&nbsp;<span class="num" id="6013236">040000</span>&nbsp;&nbsp;<span class="comment" id="6013244">//&nbsp;Directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013258">c_ISFIFO</span>&nbsp;<span class="op" id="6013267">=</span>&nbsp;<span class="num" id="6013269">010000</span>&nbsp;&nbsp;<span class="comment" id="6013277">//&nbsp;FIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013286">c_ISREG</span>&nbsp;&nbsp;<span class="op" id="6013295">=</span>&nbsp;<span class="num" id="6013297">0100000</span>&nbsp;<span class="comment" id="6013305">//&nbsp;Regular&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013322">c_ISLNK</span>&nbsp;&nbsp;<span class="op" id="6013331">=</span>&nbsp;<span class="num" id="6013333">0120000</span>&nbsp;<span class="comment" id="6013341">//&nbsp;Symbolic&nbsp;link</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013359">c_ISBLK</span>&nbsp;&nbsp;<span class="op" id="6013368">=</span>&nbsp;<span class="num" id="6013370">060000</span>&nbsp;&nbsp;<span class="comment" id="6013378">//&nbsp;Block&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013401">c_ISCHR</span>&nbsp;&nbsp;<span class="op" id="6013410">=</span>&nbsp;<span class="num" id="6013412">020000</span>&nbsp;&nbsp;<span class="comment" id="6013420">//&nbsp;Character&nbsp;special&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013447">c_ISSOCK</span>&nbsp;<span class="op" id="6013456">=</span>&nbsp;<span class="num" id="6013458">0140000</span>&nbsp;<span class="comment" id="6013466">//&nbsp;Socket</span><br>
<span class="lineno"></span><span class="op" id="6013476">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="6013479">//&nbsp;Keywords&nbsp;for&nbsp;the&nbsp;PAX&nbsp;Extended&nbsp;Header</span><br>
<span class="lineno"></span><span class="keyword" id="6013519">const</span>&nbsp;<span class="op" id="6013525">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013528">paxAtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013540">=</span>&nbsp;<span class="string" id="6013542">&#34;atime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013551">paxCharset</span>&nbsp;&nbsp;<span class="op" id="6013563">=</span>&nbsp;<span class="string" id="6013565">&#34;charset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013576">paxComment</span>&nbsp;&nbsp;<span class="op" id="6013588">=</span>&nbsp;<span class="string" id="6013590">&#34;comment&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013601">paxCtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013613">=</span>&nbsp;<span class="string" id="6013615">&#34;ctime&#34;</span>&nbsp;<span class="comment" id="6013623">//&nbsp;please&nbsp;note&nbsp;that&nbsp;ctime&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013677">paxGid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013689">=</span>&nbsp;<span class="string" id="6013691">&#34;gid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013698">paxGname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013710">=</span>&nbsp;<span class="string" id="6013712">&#34;gname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013721">paxLinkpath</span>&nbsp;<span class="op" id="6013733">=</span>&nbsp;<span class="string" id="6013735">&#34;linkpath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013747">paxMtime</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013759">=</span>&nbsp;<span class="string" id="6013761">&#34;mtime&#34;</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013770">paxPath</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013782">=</span>&nbsp;<span class="string" id="6013784">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013792">paxSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013804">=</span>&nbsp;<span class="string" id="6013806">&#34;size&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013814">paxUid</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013826">=</span>&nbsp;<span class="string" id="6013828">&#34;uid&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013835">paxUname</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013847">=</span>&nbsp;<span class="string" id="6013849">&#34;uname&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013858">paxXattr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013870">=</span>&nbsp;<span class="string" id="6013872">&#34;SCHILY.xattr.&#34;</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6013889">paxNone</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6013901">=</span>&nbsp;<span class="string" id="6013903">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="6013906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6013909">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;Header&nbsp;from&nbsp;fi.</span><br>
<span class="lineno"></span><span class="comment" id="6013973">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;symlink,&nbsp;FileInfoHeader&nbsp;records&nbsp;link&nbsp;as&nbsp;the&nbsp;link&nbsp;target.</span><br>
<span class="lineno">200</span><span class="comment" id="6014051">//&nbsp;If&nbsp;fi&nbsp;describes&nbsp;a&nbsp;directory,&nbsp;a&nbsp;slash&nbsp;is&nbsp;appended&nbsp;to&nbsp;the&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="6014116">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6014183">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6014254">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6014323">func</span>&nbsp;<span class="ident" id="6014328">FileInfoHeader</span><span class="op" id="6014342">(</span><span class="ident" id="6014343">fi</span>&nbsp;<span class="ident" id="6014346">os</span><span class="op" id="6014348">.</span><span class="ident" id="6014349">FileInfo</span><span class="op" id="6014357">,</span>&nbsp;<span class="ident" id="6014359">link</span>&nbsp;<span class="builtintype" id="6014364">string</span><span class="op" id="6014370">)</span>&nbsp;<span class="op" id="6014372">(</span><span class="op" id="6014373">*</span><span class="ident" id="6014374">Header</span><span class="op" id="6014380">,</span>&nbsp;<span class="builtintype" id="6014382">error</span><span class="op" id="6014387">)</span>&nbsp;<span class="op" id="6014389">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014392">if</span>&nbsp;<span class="ident" id="6014395">fi</span>&nbsp;<span class="op" id="6014398">==</span>&nbsp;<span class="ident" id="6014401">nil</span>&nbsp;<span class="op" id="6014405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014409">return</span>&nbsp;<span class="ident" id="6014416">nil</span><span class="op" id="6014419">,</span>&nbsp;<span class="ident" id="6014421">errors</span><span class="op" id="6014427">.</span><span class="ident" id="6014428">New</span><span class="op" id="6014431">(</span><span class="string" id="6014432">&#34;tar:&nbsp;FileInfo&nbsp;is&nbsp;nil&#34;</span><span class="op" id="6014454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014460">fm</span>&nbsp;<span class="op" id="6014463">:=</span>&nbsp;<span class="ident" id="6014466">fi</span><span class="op" id="6014468">.</span><span class="ident" id="6014469">Mode</span><span class="op" id="6014473">(</span><span class="op" id="6014474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014477">h</span>&nbsp;<span class="op" id="6014479">:=</span>&nbsp;<span class="op" id="6014482">&amp;</span><span class="ident" id="6014483">Header</span><span class="op" id="6014489">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014493">Name</span><span class="op" id="6014497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014502">fi</span><span class="op" id="6014504">.</span><span class="ident" id="6014505">Name</span><span class="op" id="6014509">(</span><span class="op" id="6014510">)</span><span class="op" id="6014511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014515">ModTime</span><span class="op" id="6014522">:</span>&nbsp;<span class="ident" id="6014524">fi</span><span class="op" id="6014526">.</span><span class="ident" id="6014527">ModTime</span><span class="op" id="6014534">(</span><span class="op" id="6014535">)</span><span class="op" id="6014536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014540">Mode</span><span class="op" id="6014544">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6014549">int64</span><span class="op" id="6014554">(</span><span class="ident" id="6014555">fm</span><span class="op" id="6014557">.</span><span class="ident" id="6014558">Perm</span><span class="op" id="6014562">(</span><span class="op" id="6014563">)</span><span class="op" id="6014564">)</span><span class="op" id="6014565">,</span>&nbsp;<span class="comment" id="6014567">//&nbsp;or&#39;d&nbsp;with&nbsp;c_IS*&nbsp;constants&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014606">switch</span>&nbsp;<span class="op" id="6014613">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014616">case</span>&nbsp;<span class="ident" id="6014621">fm</span><span class="op" id="6014623">.</span><span class="ident" id="6014624">IsRegular</span><span class="op" id="6014633">(</span><span class="op" id="6014634">)</span><span class="op" id="6014635">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014639">h</span><span class="op" id="6014640">.</span><span class="ident" id="6014641">Mode</span>&nbsp;<span class="op" id="6014646">|=</span>&nbsp;<span class="ident" id="6014649">c_ISREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014659">h</span><span class="op" id="6014660">.</span><span class="ident" id="6014661">Typeflag</span>&nbsp;<span class="op" id="6014670">=</span>&nbsp;<span class="ident" id="6014672">TypeReg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014682">h</span><span class="op" id="6014683">.</span><span class="ident" id="6014684">Size</span>&nbsp;<span class="op" id="6014689">=</span>&nbsp;<span class="ident" id="6014691">fi</span><span class="op" id="6014693">.</span><span class="ident" id="6014694">Size</span><span class="op" id="6014698">(</span><span class="op" id="6014699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014702">case</span>&nbsp;<span class="ident" id="6014707">fi</span><span class="op" id="6014709">.</span><span class="ident" id="6014710">IsDir</span><span class="op" id="6014715">(</span><span class="op" id="6014716">)</span><span class="op" id="6014717">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014721">h</span><span class="op" id="6014722">.</span><span class="ident" id="6014723">Typeflag</span>&nbsp;<span class="op" id="6014732">=</span>&nbsp;<span class="ident" id="6014734">TypeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014744">h</span><span class="op" id="6014745">.</span><span class="ident" id="6014746">Mode</span>&nbsp;<span class="op" id="6014751">|=</span>&nbsp;<span class="ident" id="6014754">c_ISDIR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014764">h</span><span class="op" id="6014765">.</span><span class="ident" id="6014766">Name</span>&nbsp;<span class="op" id="6014771">+=</span>&nbsp;<span class="string" id="6014774">&#34;/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014779">case</span>&nbsp;<span class="ident" id="6014784">fm</span><span class="op" id="6014786">&amp;</span><span class="ident" id="6014787">os</span><span class="op" id="6014789">.</span><span class="ident" id="6014790">ModeSymlink</span>&nbsp;<span class="op" id="6014802">!=</span>&nbsp;<span class="num" id="6014805">0</span><span class="op" id="6014806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014810">h</span><span class="op" id="6014811">.</span><span class="ident" id="6014812">Typeflag</span>&nbsp;<span class="op" id="6014821">=</span>&nbsp;<span class="ident" id="6014823">TypeSymlink</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014837">h</span><span class="op" id="6014838">.</span><span class="ident" id="6014839">Mode</span>&nbsp;<span class="op" id="6014844">|=</span>&nbsp;<span class="ident" id="6014847">c_ISLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014857">h</span><span class="op" id="6014858">.</span><span class="ident" id="6014859">Linkname</span>&nbsp;<span class="op" id="6014868">=</span>&nbsp;<span class="ident" id="6014870">link</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014876">case</span>&nbsp;<span class="ident" id="6014881">fm</span><span class="op" id="6014883">&amp;</span><span class="ident" id="6014884">os</span><span class="op" id="6014886">.</span><span class="ident" id="6014887">ModeDevice</span>&nbsp;<span class="op" id="6014898">!=</span>&nbsp;<span class="num" id="6014901">0</span><span class="op" id="6014902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6014906">if</span>&nbsp;<span class="ident" id="6014909">fm</span><span class="op" id="6014911">&amp;</span><span class="ident" id="6014912">os</span><span class="op" id="6014914">.</span><span class="ident" id="6014915">ModeCharDevice</span>&nbsp;<span class="op" id="6014930">!=</span>&nbsp;<span class="num" id="6014933">0</span>&nbsp;<span class="op" id="6014935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014940">h</span><span class="op" id="6014941">.</span><span class="ident" id="6014942">Mode</span>&nbsp;<span class="op" id="6014947">|=</span>&nbsp;<span class="ident" id="6014950">c_ISCHR</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014961">h</span><span class="op" id="6014962">.</span><span class="ident" id="6014963">Typeflag</span>&nbsp;<span class="op" id="6014972">=</span>&nbsp;<span class="ident" id="6014974">TypeChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6014985">}</span>&nbsp;<span class="keyword" id="6014987">else</span>&nbsp;<span class="op" id="6014992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6014997">h</span><span class="op" id="6014998">.</span><span class="ident" id="6014999">Mode</span>&nbsp;<span class="op" id="6015004">|=</span>&nbsp;<span class="ident" id="6015007">c_ISBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015018">h</span><span class="op" id="6015019">.</span><span class="ident" id="6015020">Typeflag</span>&nbsp;<span class="op" id="6015029">=</span>&nbsp;<span class="ident" id="6015031">TypeBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015043">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015046">case</span>&nbsp;<span class="ident" id="6015051">fm</span><span class="op" id="6015053">&amp;</span><span class="ident" id="6015054">os</span><span class="op" id="6015056">.</span><span class="ident" id="6015057">ModeNamedPipe</span>&nbsp;<span class="op" id="6015071">!=</span>&nbsp;<span class="num" id="6015074">0</span><span class="op" id="6015075">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015079">h</span><span class="op" id="6015080">.</span><span class="ident" id="6015081">Typeflag</span>&nbsp;<span class="op" id="6015090">=</span>&nbsp;<span class="ident" id="6015092">TypeFifo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015103">h</span><span class="op" id="6015104">.</span><span class="ident" id="6015105">Mode</span>&nbsp;<span class="op" id="6015110">|=</span>&nbsp;<span class="ident" id="6015113">c_ISFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015123">case</span>&nbsp;<span class="ident" id="6015128">fm</span><span class="op" id="6015130">&amp;</span><span class="ident" id="6015131">os</span><span class="op" id="6015133">.</span><span class="ident" id="6015134">ModeSocket</span>&nbsp;<span class="op" id="6015145">!=</span>&nbsp;<span class="num" id="6015148">0</span><span class="op" id="6015149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015153">h</span><span class="op" id="6015154">.</span><span class="ident" id="6015155">Mode</span>&nbsp;<span class="op" id="6015160">|=</span>&nbsp;<span class="ident" id="6015163">c_ISSOCK</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015173">default</span><span class="op" id="6015180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015184">return</span>&nbsp;<span class="ident" id="6015191">nil</span><span class="op" id="6015194">,</span>&nbsp;<span class="ident" id="6015196">fmt</span><span class="op" id="6015199">.</span><span class="ident" id="6015200">Errorf</span><span class="op" id="6015206">(</span><span class="string" id="6015207">&#34;archive/tar:&nbsp;unknown&nbsp;file&nbsp;mode&nbsp;%v&#34;</span><span class="op" id="6015242">,</span>&nbsp;<span class="ident" id="6015244">fm</span><span class="op" id="6015246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015252">if</span>&nbsp;<span class="ident" id="6015255">fm</span><span class="op" id="6015257">&amp;</span><span class="ident" id="6015258">os</span><span class="op" id="6015260">.</span><span class="ident" id="6015261">ModeSetuid</span>&nbsp;<span class="op" id="6015272">!=</span>&nbsp;<span class="num" id="6015275">0</span>&nbsp;<span class="op" id="6015277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015281">h</span><span class="op" id="6015282">.</span><span class="ident" id="6015283">Mode</span>&nbsp;<span class="op" id="6015288">|=</span>&nbsp;<span class="ident" id="6015291">c_ISUID</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015303">if</span>&nbsp;<span class="ident" id="6015306">fm</span><span class="op" id="6015308">&amp;</span><span class="ident" id="6015309">os</span><span class="op" id="6015311">.</span><span class="ident" id="6015312">ModeSetgid</span>&nbsp;<span class="op" id="6015323">!=</span>&nbsp;<span class="num" id="6015326">0</span>&nbsp;<span class="op" id="6015328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015332">h</span><span class="op" id="6015333">.</span><span class="ident" id="6015334">Mode</span>&nbsp;<span class="op" id="6015339">|=</span>&nbsp;<span class="ident" id="6015342">c_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015354">if</span>&nbsp;<span class="ident" id="6015357">fm</span><span class="op" id="6015359">&amp;</span><span class="ident" id="6015360">os</span><span class="op" id="6015362">.</span><span class="ident" id="6015363">ModeSticky</span>&nbsp;<span class="op" id="6015374">!=</span>&nbsp;<span class="num" id="6015377">0</span>&nbsp;<span class="op" id="6015379">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015383">h</span><span class="op" id="6015384">.</span><span class="ident" id="6015385">Mode</span>&nbsp;<span class="op" id="6015390">|=</span>&nbsp;<span class="ident" id="6015393">c_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015405">if</span>&nbsp;<span class="ident" id="6015408">sysStat</span>&nbsp;<span class="op" id="6015416">!=</span>&nbsp;<span class="ident" id="6015419">nil</span>&nbsp;<span class="op" id="6015423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015427">return</span>&nbsp;<span class="ident" id="6015434">h</span><span class="op" id="6015435">,</span>&nbsp;<span class="ident" id="6015437">sysStat</span><span class="op" id="6015444">(</span><span class="ident" id="6015445">fi</span><span class="op" id="6015447">,</span>&nbsp;<span class="ident" id="6015449">h</span><span class="op" id="6015450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015453">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015456">return</span>&nbsp;<span class="ident" id="6015463">h</span><span class="op" id="6015464">,</span>&nbsp;<span class="ident" id="6015466">nil</span><br>
<span class="lineno"></span><span class="op" id="6015470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6015473">var</span>&nbsp;<span class="ident" id="6015477">zeroBlock</span>&nbsp;<span class="op" id="6015487">=</span>&nbsp;<span class="builtinfunc" id="6015489">make</span><span class="op" id="6015493">(</span><span class="op" id="6015494">[</span><span class="op" id="6015495">]</span><span class="builtintype" id="6015496">byte</span><span class="op" id="6015500">,</span>&nbsp;<span class="ident" id="6015502">blockSize</span><span class="op" id="6015511">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6015514">//&nbsp;POSIX&nbsp;specifies&nbsp;a&nbsp;sum&nbsp;of&nbsp;the&nbsp;unsigned&nbsp;byte&nbsp;values,&nbsp;but&nbsp;the&nbsp;Sun&nbsp;tar&nbsp;uses&nbsp;signed&nbsp;byte&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="6015609">//&nbsp;We&nbsp;compute&nbsp;and&nbsp;return&nbsp;both.</span><br>
<span class="lineno"></span><span class="keyword" id="6015640">func</span>&nbsp;<span class="ident" id="6015645">checksum</span><span class="op" id="6015653">(</span><span class="ident" id="6015654">header</span>&nbsp;<span class="op" id="6015661">[</span><span class="op" id="6015662">]</span><span class="builtintype" id="6015663">byte</span><span class="op" id="6015667">)</span>&nbsp;<span class="op" id="6015669">(</span><span class="ident" id="6015670">unsigned</span>&nbsp;<span class="ident" id="6015679">int64</span><span class="op" id="6015684">,</span>&nbsp;<span class="ident" id="6015686">signed</span>&nbsp;<span class="ident" id="6015693">int64</span><span class="op" id="6015698">)</span>&nbsp;<span class="op" id="6015700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015703">for</span>&nbsp;<span class="ident" id="6015707">i</span>&nbsp;<span class="op" id="6015709">:=</span>&nbsp;<span class="num" id="6015712">0</span><span class="op" id="6015713">;</span>&nbsp;<span class="ident" id="6015715">i</span>&nbsp;<span class="op" id="6015717">&lt;</span>&nbsp;<span class="builtinfunc" id="6015719">len</span><span class="op" id="6015722">(</span><span class="ident" id="6015723">header</span><span class="op" id="6015729">)</span><span class="op" id="6015730">;</span>&nbsp;<span class="ident" id="6015732">i</span><span class="op" id="6015733">++</span>&nbsp;<span class="op" id="6015736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015740">if</span>&nbsp;<span class="ident" id="6015743">i</span>&nbsp;<span class="op" id="6015745">==</span>&nbsp;<span class="num" id="6015748">148</span>&nbsp;<span class="op" id="6015752">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6015757">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;(header[148:156])&nbsp;is&nbsp;special:&nbsp;it&nbsp;should&nbsp;be&nbsp;treated&nbsp;as&nbsp;space&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015847">unsigned</span>&nbsp;<span class="op" id="6015856">+=</span>&nbsp;<span class="string" id="6015859">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6015863">*</span>&nbsp;<span class="num" id="6015865">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015870">signed</span>&nbsp;<span class="op" id="6015877">+=</span>&nbsp;<span class="string" id="6015880">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6015884">*</span>&nbsp;<span class="num" id="6015886">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015891">i</span>&nbsp;<span class="op" id="6015893">+=</span>&nbsp;<span class="num" id="6015896">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015901">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015916">unsigned</span>&nbsp;<span class="op" id="6015925">+=</span>&nbsp;<span class="ident" id="6015928">int64</span><span class="op" id="6015933">(</span><span class="ident" id="6015934">header</span><span class="op" id="6015940">[</span><span class="ident" id="6015941">i</span><span class="op" id="6015942">]</span><span class="op" id="6015943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6015947">signed</span>&nbsp;<span class="op" id="6015954">+=</span>&nbsp;<span class="ident" id="6015957">int64</span><span class="op" id="6015962">(</span><span class="builtintype" id="6015963">int8</span><span class="op" id="6015967">(</span><span class="ident" id="6015968">header</span><span class="op" id="6015974">[</span><span class="ident" id="6015975">i</span><span class="op" id="6015976">]</span><span class="op" id="6015977">)</span><span class="op" id="6015978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6015981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6015984">return</span><br>
<span class="lineno">275</span><span class="op" id="6015991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6015994">type</span>&nbsp;<span class="ident" id="6015999">slicer</span>&nbsp;<span class="op" id="6016006">[</span><span class="op" id="6016007">]</span><span class="builtintype" id="6016008">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6016014">func</span>&nbsp;<span class="op" id="6016019">(</span><span class="ident" id="6016020">sp</span>&nbsp;<span class="op" id="6016023">*</span><span class="ident" id="6016024">slicer</span><span class="op" id="6016030">)</span>&nbsp;<span class="ident" id="6016032">next</span><span class="op" id="6016036">(</span><span class="ident" id="6016037">n</span>&nbsp;<span class="builtintype" id="6016039">int</span><span class="op" id="6016042">)</span>&nbsp;<span class="op" id="6016044">(</span><span class="ident" id="6016045">b</span>&nbsp;<span class="op" id="6016047">[</span><span class="op" id="6016048">]</span><span class="builtintype" id="6016049">byte</span><span class="op" id="6016053">)</span>&nbsp;<span class="op" id="6016055">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016058">s</span>&nbsp;<span class="op" id="6016060">:=</span>&nbsp;<span class="op" id="6016063">*</span><span class="ident" id="6016064">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016068">b</span><span class="op" id="6016069">,</span>&nbsp;<span class="op" id="6016071">*</span><span class="ident" id="6016072">sp</span>&nbsp;<span class="op" id="6016075">=</span>&nbsp;<span class="ident" id="6016077">s</span><span class="op" id="6016078">[</span><span class="num" id="6016079">0</span><span class="op" id="6016080">:</span><span class="ident" id="6016081">n</span><span class="op" id="6016082">]</span><span class="op" id="6016083">,</span>&nbsp;<span class="ident" id="6016085">s</span><span class="op" id="6016086">[</span><span class="ident" id="6016087">n</span><span class="op" id="6016088">:</span><span class="op" id="6016089">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016092">return</span><br>
<span class="lineno"></span><span class="op" id="6016099">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="6016102">func</span>&nbsp;<span class="ident" id="6016107">isASCII</span><span class="op" id="6016114">(</span><span class="ident" id="6016115">s</span>&nbsp;<span class="builtintype" id="6016117">string</span><span class="op" id="6016123">)</span>&nbsp;<span class="builtintype" id="6016125">bool</span>&nbsp;<span class="op" id="6016130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016133">for</span>&nbsp;<span class="ident" id="6016137">_</span><span class="op" id="6016138">,</span>&nbsp;<span class="ident" id="6016140">c</span>&nbsp;<span class="op" id="6016142">:=</span>&nbsp;<span class="keyword" id="6016145">range</span>&nbsp;<span class="ident" id="6016151">s</span>&nbsp;<span class="op" id="6016153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016157">if</span>&nbsp;<span class="ident" id="6016160">c</span>&nbsp;<span class="op" id="6016162">&gt;=</span>&nbsp;<span class="num" id="6016165">0x80</span>&nbsp;<span class="op" id="6016170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016175">return</span>&nbsp;<span class="ident" id="6016182">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016190">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016196">return</span>&nbsp;<span class="ident" id="6016203">true</span><br>
<span class="lineno"></span><span class="op" id="6016208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6016211">func</span>&nbsp;<span class="ident" id="6016216">toASCII</span><span class="op" id="6016223">(</span><span class="ident" id="6016224">s</span>&nbsp;<span class="builtintype" id="6016226">string</span><span class="op" id="6016232">)</span>&nbsp;<span class="builtintype" id="6016234">string</span>&nbsp;<span class="op" id="6016241">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016244">if</span>&nbsp;<span class="ident" id="6016247">isASCII</span><span class="op" id="6016254">(</span><span class="ident" id="6016255">s</span><span class="op" id="6016256">)</span>&nbsp;<span class="op" id="6016258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016262">return</span>&nbsp;<span class="ident" id="6016269">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016275">var</span>&nbsp;<span class="ident" id="6016279">buf</span>&nbsp;<span class="ident" id="6016283">bytes</span><span class="op" id="6016288">.</span><span class="ident" id="6016289">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016297">for</span>&nbsp;<span class="ident" id="6016301">_</span><span class="op" id="6016302">,</span>&nbsp;<span class="ident" id="6016304">c</span>&nbsp;<span class="op" id="6016306">:=</span>&nbsp;<span class="keyword" id="6016309">range</span>&nbsp;<span class="ident" id="6016315">s</span>&nbsp;<span class="op" id="6016317">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016321">if</span>&nbsp;<span class="ident" id="6016324">c</span>&nbsp;<span class="op" id="6016326">&lt;</span>&nbsp;<span class="num" id="6016328">0x80</span>&nbsp;<span class="op" id="6016333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6016338">buf</span><span class="op" id="6016341">.</span><span class="ident" id="6016342">WriteByte</span><span class="op" id="6016351">(</span><span class="builtintype" id="6016352">byte</span><span class="op" id="6016356">(</span><span class="ident" id="6016357">c</span><span class="op" id="6016358">)</span><span class="op" id="6016359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6016366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6016369">return</span>&nbsp;<span class="ident" id="6016376">buf</span><span class="op" id="6016379">.</span><span class="ident" id="6016380">String</span><span class="op" id="6016386">(</span><span class="op" id="6016387">)</span><br>
<span class="lineno">305</span><span class="op" id="6016389">}</span>
</div>
</body>
</html>
