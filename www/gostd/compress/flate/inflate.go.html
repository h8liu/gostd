<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html" class="current">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5033398">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5033453">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5033507">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5033558">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-output&nbsp;fixedhuff.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5033608">//&nbsp;Package&nbsp;flate&nbsp;implements&nbsp;the&nbsp;DEFLATE&nbsp;compressed&nbsp;data&nbsp;format,&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5033685">//&nbsp;RFC&nbsp;1951.&nbsp;&nbsp;The&nbsp;gzip&nbsp;and&nbsp;zlib&nbsp;packages&nbsp;implement&nbsp;access&nbsp;to&nbsp;DEFLATE-based&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="5033765">//&nbsp;formats.</span><br>
<span class="lineno">10</span><span class="keyword" id="5033777">package</span>&nbsp;<span class="ident" id="5033785">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5033792">import</span>&nbsp;<span class="op" id="5033799">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5033802">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5033811">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5033817">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5033827">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5033830">const</span>&nbsp;<span class="op" id="5033836">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033839">maxCodeLen</span>&nbsp;<span class="op" id="5033850">=</span>&nbsp;<span class="num" id="5033852">16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5033858">//&nbsp;max&nbsp;length&nbsp;of&nbsp;Huffman&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033889">maxHist</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5033900">=</span>&nbsp;<span class="num" id="5033902">32768</span>&nbsp;<span class="comment" id="5033908">//&nbsp;max&nbsp;history&nbsp;required</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5033933">//&nbsp;The&nbsp;next&nbsp;three&nbsp;numbers&nbsp;come&nbsp;from&nbsp;the&nbsp;RFC,&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5033994">maxLit</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5034003">=</span>&nbsp;<span class="num" id="5034005">286</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034010">maxDist</span>&nbsp;&nbsp;<span class="op" id="5034019">=</span>&nbsp;<span class="num" id="5034021">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034025">numCodes</span>&nbsp;<span class="op" id="5034034">=</span>&nbsp;<span class="num" id="5034036">19</span>&nbsp;<span class="comment" id="5034039">//&nbsp;number&nbsp;of&nbsp;codes&nbsp;in&nbsp;Huffman&nbsp;meta-code</span><br>
<span class="lineno">25</span><span class="op" id="5034079">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5034082">//&nbsp;A&nbsp;CorruptInputError&nbsp;reports&nbsp;the&nbsp;presence&nbsp;of&nbsp;corrupt&nbsp;input&nbsp;at&nbsp;a&nbsp;given&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5034162">type</span>&nbsp;<span class="ident" id="5034167">CorruptInputError</span>&nbsp;<span class="ident" id="5034185">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="5034192">func</span>&nbsp;<span class="op" id="5034197">(</span><span class="ident" id="5034198">e</span>&nbsp;<span class="ident" id="5034200">CorruptInputError</span><span class="op" id="5034217">)</span>&nbsp;<span class="ident" id="5034219">Error</span><span class="op" id="5034224">(</span><span class="op" id="5034225">)</span>&nbsp;<span class="builtintype" id="5034227">string</span>&nbsp;<span class="op" id="5034234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034237">return</span>&nbsp;<span class="string" id="5034244">&#34;flate:&nbsp;corrupt&nbsp;input&nbsp;before&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="5034282">+</span>&nbsp;<span class="ident" id="5034284">strconv</span><span class="op" id="5034291">.</span><span class="ident" id="5034292">FormatInt</span><span class="op" id="5034301">(</span><span class="ident" id="5034302">int64</span><span class="op" id="5034307">(</span><span class="ident" id="5034308">e</span><span class="op" id="5034309">)</span><span class="op" id="5034310">,</span>&nbsp;<span class="num" id="5034312">10</span><span class="op" id="5034314">)</span><br>
<span class="lineno"></span><span class="op" id="5034316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5034319">//&nbsp;An&nbsp;InternalError&nbsp;reports&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;flate&nbsp;code&nbsp;itself.</span><br>
<span class="lineno">35</span><span class="keyword" id="5034382">type</span>&nbsp;<span class="ident" id="5034387">InternalError</span>&nbsp;<span class="builtintype" id="5034401">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5034409">func</span>&nbsp;<span class="op" id="5034414">(</span><span class="ident" id="5034415">e</span>&nbsp;<span class="ident" id="5034417">InternalError</span><span class="op" id="5034430">)</span>&nbsp;<span class="ident" id="5034432">Error</span><span class="op" id="5034437">(</span><span class="op" id="5034438">)</span>&nbsp;<span class="builtintype" id="5034440">string</span>&nbsp;<span class="op" id="5034447">{</span>&nbsp;<span class="keyword" id="5034449">return</span>&nbsp;<span class="string" id="5034456">&#34;flate:&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="5034482">+</span>&nbsp;<span class="builtintype" id="5034484">string</span><span class="op" id="5034490">(</span><span class="ident" id="5034491">e</span><span class="op" id="5034492">)</span>&nbsp;<span class="op" id="5034494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5034497">//&nbsp;A&nbsp;ReadError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;reading&nbsp;input.</span><br>
<span class="lineno">40</span><span class="keyword" id="5034562">type</span>&nbsp;<span class="ident" id="5034567">ReadError</span>&nbsp;<span class="keyword" id="5034577">struct</span>&nbsp;<span class="op" id="5034584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034587">Offset</span>&nbsp;<span class="ident" id="5034594">int64</span>&nbsp;<span class="comment" id="5034600">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034637">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5034644">error</span>&nbsp;<span class="comment" id="5034650">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Read</span><br>
<span class="lineno"></span><span class="op" id="5034687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="5034690">func</span>&nbsp;<span class="op" id="5034695">(</span><span class="ident" id="5034696">e</span>&nbsp;<span class="op" id="5034698">*</span><span class="ident" id="5034699">ReadError</span><span class="op" id="5034708">)</span>&nbsp;<span class="ident" id="5034710">Error</span><span class="op" id="5034715">(</span><span class="op" id="5034716">)</span>&nbsp;<span class="builtintype" id="5034718">string</span>&nbsp;<span class="op" id="5034725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5034728">return</span>&nbsp;<span class="string" id="5034735">&#34;flate:&nbsp;read&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="5034766">+</span>&nbsp;<span class="ident" id="5034768">strconv</span><span class="op" id="5034775">.</span><span class="ident" id="5034776">FormatInt</span><span class="op" id="5034785">(</span><span class="ident" id="5034786">e</span><span class="op" id="5034787">.</span><span class="ident" id="5034788">Offset</span><span class="op" id="5034794">,</span>&nbsp;<span class="num" id="5034796">10</span><span class="op" id="5034798">)</span>&nbsp;<span class="op" id="5034800">+</span>&nbsp;<span class="string" id="5034802">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="5034807">+</span>&nbsp;<span class="ident" id="5034809">e</span><span class="op" id="5034810">.</span><span class="ident" id="5034811">Err</span><span class="op" id="5034814">.</span><span class="ident" id="5034815">Error</span><span class="op" id="5034820">(</span><span class="op" id="5034821">)</span><br>
<span class="lineno"></span><span class="op" id="5034823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5034826">//&nbsp;A&nbsp;WriteError&nbsp;reports&nbsp;an&nbsp;error&nbsp;encountered&nbsp;while&nbsp;writing&nbsp;output.</span><br>
<span class="lineno">50</span><span class="keyword" id="5034893">type</span>&nbsp;<span class="ident" id="5034898">WriteError</span>&nbsp;<span class="keyword" id="5034909">struct</span>&nbsp;<span class="op" id="5034916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034919">Offset</span>&nbsp;<span class="ident" id="5034926">int64</span>&nbsp;<span class="comment" id="5034932">//&nbsp;byte&nbsp;offset&nbsp;where&nbsp;error&nbsp;occurred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5034969">Err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5034976">error</span>&nbsp;<span class="comment" id="5034982">//&nbsp;error&nbsp;returned&nbsp;by&nbsp;underlying&nbsp;Write</span><br>
<span class="lineno"></span><span class="op" id="5035020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5035023">func</span>&nbsp;<span class="op" id="5035028">(</span><span class="ident" id="5035029">e</span>&nbsp;<span class="op" id="5035031">*</span><span class="ident" id="5035032">WriteError</span><span class="op" id="5035042">)</span>&nbsp;<span class="ident" id="5035044">Error</span><span class="op" id="5035049">(</span><span class="op" id="5035050">)</span>&nbsp;<span class="builtintype" id="5035052">string</span>&nbsp;<span class="op" id="5035059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5035062">return</span>&nbsp;<span class="string" id="5035069">&#34;flate:&nbsp;write&nbsp;error&nbsp;at&nbsp;offset&nbsp;&#34;</span>&nbsp;<span class="op" id="5035101">+</span>&nbsp;<span class="ident" id="5035103">strconv</span><span class="op" id="5035110">.</span><span class="ident" id="5035111">FormatInt</span><span class="op" id="5035120">(</span><span class="ident" id="5035121">e</span><span class="op" id="5035122">.</span><span class="ident" id="5035123">Offset</span><span class="op" id="5035129">,</span>&nbsp;<span class="num" id="5035131">10</span><span class="op" id="5035133">)</span>&nbsp;<span class="op" id="5035135">+</span>&nbsp;<span class="string" id="5035137">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="5035142">+</span>&nbsp;<span class="ident" id="5035144">e</span><span class="op" id="5035145">.</span><span class="ident" id="5035146">Err</span><span class="op" id="5035149">.</span><span class="ident" id="5035150">Error</span><span class="op" id="5035155">(</span><span class="op" id="5035156">)</span><br>
<span class="lineno"></span><span class="op" id="5035158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5035161">//&nbsp;Resetter&nbsp;resets&nbsp;a&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;or&nbsp;NewReaderDict&nbsp;to</span><br>
<span class="lineno">60</span><span class="comment" id="5035235">//&nbsp;to&nbsp;switch&nbsp;to&nbsp;a&nbsp;new&nbsp;underlying&nbsp;Reader.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;ReadCloser</span><br>
<span class="lineno"></span><span class="comment" id="5035310">//&nbsp;instead&nbsp;of&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="5035346">type</span>&nbsp;<span class="ident" id="5035351">Resetter</span>&nbsp;<span class="keyword" id="5035360">interface</span>&nbsp;<span class="op" id="5035370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5035373">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data&nbsp;and&nbsp;resets&nbsp;the&nbsp;Resetter&nbsp;as&nbsp;if&nbsp;it&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5035447">//&nbsp;newly&nbsp;initialized&nbsp;with&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5035492">Reset</span><span class="op" id="5035497">(</span><span class="ident" id="5035498">r</span>&nbsp;<span class="ident" id="5035500">io</span><span class="op" id="5035502">.</span><span class="ident" id="5035503">Reader</span><span class="op" id="5035509">,</span>&nbsp;<span class="ident" id="5035511">dict</span>&nbsp;<span class="op" id="5035516">[</span><span class="op" id="5035517">]</span><span class="builtintype" id="5035518">byte</span><span class="op" id="5035522">)</span>&nbsp;<span class="builtintype" id="5035524">error</span><br>
<span class="lineno"></span><span class="op" id="5035530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5035533">//&nbsp;Note&nbsp;that&nbsp;much&nbsp;of&nbsp;the&nbsp;implementation&nbsp;of&nbsp;huffmanDecoder&nbsp;is&nbsp;also&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="5035606">//&nbsp;into&nbsp;gen.go&nbsp;(in&nbsp;package&nbsp;main)&nbsp;for&nbsp;the&nbsp;purpose&nbsp;of&nbsp;precomputing&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="5035675">//&nbsp;fixed&nbsp;huffman&nbsp;tables&nbsp;so&nbsp;they&nbsp;can&nbsp;be&nbsp;included&nbsp;statically.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5035736">//&nbsp;The&nbsp;data&nbsp;structure&nbsp;for&nbsp;decoding&nbsp;Huffman&nbsp;tables&nbsp;is&nbsp;based&nbsp;on&nbsp;that&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5035806">//&nbsp;zlib.&nbsp;There&nbsp;is&nbsp;a&nbsp;lookup&nbsp;table&nbsp;of&nbsp;a&nbsp;fixed&nbsp;bit&nbsp;width&nbsp;(huffmanChunkBits),</span><br>
<span class="lineno"></span><span class="comment" id="5035880">//&nbsp;For&nbsp;codes&nbsp;smaller&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;there&nbsp;are&nbsp;multiple&nbsp;entries</span><br>
<span class="lineno">75</span><span class="comment" id="5035950">//&nbsp;(each&nbsp;combination&nbsp;of&nbsp;trailing&nbsp;bits&nbsp;has&nbsp;the&nbsp;same&nbsp;value).&nbsp;For&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="5036019">//&nbsp;larger&nbsp;than&nbsp;the&nbsp;table&nbsp;width,&nbsp;the&nbsp;table&nbsp;contains&nbsp;a&nbsp;link&nbsp;to&nbsp;an&nbsp;overflow</span><br>
<span class="lineno"></span><span class="comment" id="5036092">//&nbsp;table.&nbsp;The&nbsp;width&nbsp;of&nbsp;each&nbsp;entry&nbsp;in&nbsp;the&nbsp;link&nbsp;table&nbsp;is&nbsp;the&nbsp;maximum&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5036164">//&nbsp;size&nbsp;minus&nbsp;the&nbsp;chunk&nbsp;width.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5036196">//&nbsp;Note&nbsp;that&nbsp;you&nbsp;can&nbsp;do&nbsp;a&nbsp;lookup&nbsp;in&nbsp;the&nbsp;table&nbsp;even&nbsp;without&nbsp;all&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5036264">//&nbsp;filled.&nbsp;Since&nbsp;the&nbsp;extra&nbsp;bits&nbsp;are&nbsp;zero,&nbsp;and&nbsp;the&nbsp;DEFLATE&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><span class="comment" id="5036336">//&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;shorter&nbsp;codes&nbsp;come&nbsp;before&nbsp;longer&nbsp;ones,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5036405">//&nbsp;bit&nbsp;length&nbsp;estimate&nbsp;in&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;lower&nbsp;bound&nbsp;on&nbsp;the&nbsp;actual</span><br>
<span class="lineno"></span><span class="comment" id="5036473">//&nbsp;number&nbsp;of&nbsp;bits.</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="5036493">//&nbsp;chunk&nbsp;&amp;&nbsp;15&nbsp;is&nbsp;number&nbsp;of&nbsp;bits</span><br>
<span class="lineno"></span><span class="comment" id="5036525">//&nbsp;chunk&nbsp;&gt;&gt;&nbsp;4&nbsp;is&nbsp;value,&nbsp;including&nbsp;table&nbsp;link</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5036571">const</span>&nbsp;<span class="op" id="5036577">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036580">huffmanChunkBits</span>&nbsp;&nbsp;<span class="op" id="5036598">=</span>&nbsp;<span class="num" id="5036600">9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036603">huffmanNumChunks</span>&nbsp;&nbsp;<span class="op" id="5036621">=</span>&nbsp;<span class="num" id="5036623">1</span>&nbsp;<span class="op" id="5036625">&lt;&lt;</span>&nbsp;<span class="ident" id="5036628">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036646">huffmanCountMask</span>&nbsp;&nbsp;<span class="op" id="5036664">=</span>&nbsp;<span class="num" id="5036666">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036670">huffmanValueShift</span>&nbsp;<span class="op" id="5036688">=</span>&nbsp;<span class="num" id="5036690">4</span><br>
<span class="lineno"></span><span class="op" id="5036692">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="5036695">type</span>&nbsp;<span class="ident" id="5036700">huffmanDecoder</span>&nbsp;<span class="keyword" id="5036715">struct</span>&nbsp;<span class="op" id="5036722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036725">min</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5036734">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5036759">//&nbsp;the&nbsp;minimum&nbsp;code&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036787">chunks</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5036796">[</span><span class="ident" id="5036797">huffmanNumChunks</span><span class="op" id="5036813">]</span><span class="builtintype" id="5036814">uint32</span>&nbsp;<span class="comment" id="5036821">//&nbsp;chunks&nbsp;as&nbsp;described&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036851">links</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5036860">[</span><span class="op" id="5036861">]</span><span class="op" id="5036862">[</span><span class="op" id="5036863">]</span><span class="builtintype" id="5036864">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5036885">//&nbsp;overflow&nbsp;links</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5036904">linkMask</span>&nbsp;<span class="builtintype" id="5036913">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5036938">//&nbsp;mask&nbsp;the&nbsp;width&nbsp;of&nbsp;the&nbsp;link&nbsp;table</span><br>
<span class="lineno"></span><span class="op" id="5036974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5036977">//&nbsp;Initialize&nbsp;Huffman&nbsp;decoding&nbsp;tables&nbsp;from&nbsp;array&nbsp;of&nbsp;code&nbsp;lengths.</span><br>
<span class="lineno"></span><span class="keyword" id="5037043">func</span>&nbsp;<span class="op" id="5037048">(</span><span class="ident" id="5037049">h</span>&nbsp;<span class="op" id="5037051">*</span><span class="ident" id="5037052">huffmanDecoder</span><span class="op" id="5037066">)</span>&nbsp;<span class="ident" id="5037068">init</span><span class="op" id="5037072">(</span><span class="ident" id="5037073">bits</span>&nbsp;<span class="op" id="5037078">[</span><span class="op" id="5037079">]</span><span class="builtintype" id="5037080">int</span><span class="op" id="5037083">)</span>&nbsp;<span class="builtintype" id="5037085">bool</span>&nbsp;<span class="op" id="5037090">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037093">if</span>&nbsp;<span class="ident" id="5037096">h</span><span class="op" id="5037097">.</span><span class="ident" id="5037098">min</span>&nbsp;<span class="op" id="5037102">!=</span>&nbsp;<span class="num" id="5037105">0</span>&nbsp;<span class="op" id="5037107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037111">*</span><span class="ident" id="5037112">h</span>&nbsp;<span class="op" id="5037114">=</span>&nbsp;<span class="ident" id="5037116">huffmanDecoder</span><span class="op" id="5037130">{</span><span class="op" id="5037131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037138">//&nbsp;Count&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;each&nbsp;length,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037180">//&nbsp;compute&nbsp;min&nbsp;and&nbsp;max&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037212">var</span>&nbsp;<span class="ident" id="5037216">count</span>&nbsp;<span class="op" id="5037222">[</span><span class="ident" id="5037223">maxCodeLen</span><span class="op" id="5037233">]</span><span class="builtintype" id="5037234">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037239">var</span>&nbsp;<span class="ident" id="5037243">min</span><span class="op" id="5037246">,</span>&nbsp;<span class="ident" id="5037248">max</span>&nbsp;<span class="builtintype" id="5037252">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037257">for</span>&nbsp;<span class="ident" id="5037261">_</span><span class="op" id="5037262">,</span>&nbsp;<span class="ident" id="5037264">n</span>&nbsp;<span class="op" id="5037266">:=</span>&nbsp;<span class="keyword" id="5037269">range</span>&nbsp;<span class="ident" id="5037275">bits</span>&nbsp;<span class="op" id="5037280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037284">if</span>&nbsp;<span class="ident" id="5037287">n</span>&nbsp;<span class="op" id="5037289">==</span>&nbsp;<span class="num" id="5037292">0</span>&nbsp;<span class="op" id="5037294">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037299">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037314">if</span>&nbsp;<span class="ident" id="5037317">min</span>&nbsp;<span class="op" id="5037321">==</span>&nbsp;<span class="num" id="5037324">0</span>&nbsp;<span class="op" id="5037326">||</span>&nbsp;<span class="ident" id="5037329">n</span>&nbsp;<span class="op" id="5037331">&lt;</span>&nbsp;<span class="ident" id="5037333">min</span>&nbsp;<span class="op" id="5037337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037342">min</span>&nbsp;<span class="op" id="5037346">=</span>&nbsp;<span class="ident" id="5037348">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037352">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037356">if</span>&nbsp;<span class="ident" id="5037359">n</span>&nbsp;<span class="op" id="5037361">&gt;</span>&nbsp;<span class="ident" id="5037363">max</span>&nbsp;<span class="op" id="5037367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037372">max</span>&nbsp;<span class="op" id="5037376">=</span>&nbsp;<span class="ident" id="5037378">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037386">count</span><span class="op" id="5037391">[</span><span class="ident" id="5037392">n</span><span class="op" id="5037393">]</span><span class="op" id="5037394">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037398">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037401">if</span>&nbsp;<span class="ident" id="5037404">max</span>&nbsp;<span class="op" id="5037408">==</span>&nbsp;<span class="num" id="5037411">0</span>&nbsp;<span class="op" id="5037413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037417">return</span>&nbsp;<span class="builtintype" id="5037424">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037435">h</span><span class="op" id="5037436">.</span><span class="ident" id="5037437">min</span>&nbsp;<span class="op" id="5037441">=</span>&nbsp;<span class="ident" id="5037443">min</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037448">var</span>&nbsp;<span class="ident" id="5037452">linkBits</span>&nbsp;<span class="builtintype" id="5037461">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037467">var</span>&nbsp;<span class="ident" id="5037471">numLinks</span>&nbsp;<span class="builtintype" id="5037480">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037485">if</span>&nbsp;<span class="ident" id="5037488">max</span>&nbsp;<span class="op" id="5037492">&gt;</span>&nbsp;<span class="ident" id="5037494">huffmanChunkBits</span>&nbsp;<span class="op" id="5037511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037515">linkBits</span>&nbsp;<span class="op" id="5037524">=</span>&nbsp;<span class="builtintype" id="5037526">uint</span><span class="op" id="5037530">(</span><span class="ident" id="5037531">max</span><span class="op" id="5037534">)</span>&nbsp;<span class="op" id="5037536">-</span>&nbsp;<span class="ident" id="5037538">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037557">numLinks</span>&nbsp;<span class="op" id="5037566">=</span>&nbsp;<span class="num" id="5037568">1</span>&nbsp;<span class="op" id="5037570">&lt;&lt;</span>&nbsp;<span class="ident" id="5037573">linkBits</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037584">h</span><span class="op" id="5037585">.</span><span class="ident" id="5037586">linkMask</span>&nbsp;<span class="op" id="5037595">=</span>&nbsp;<span class="builtintype" id="5037597">uint32</span><span class="op" id="5037603">(</span><span class="ident" id="5037604">numLinks</span>&nbsp;<span class="op" id="5037613">-</span>&nbsp;<span class="num" id="5037615">1</span><span class="op" id="5037616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037622">code</span>&nbsp;<span class="op" id="5037627">:=</span>&nbsp;<span class="num" id="5037630">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037633">var</span>&nbsp;<span class="ident" id="5037637">nextcode</span>&nbsp;<span class="op" id="5037646">[</span><span class="ident" id="5037647">maxCodeLen</span><span class="op" id="5037657">]</span><span class="builtintype" id="5037658">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037663">for</span>&nbsp;<span class="ident" id="5037667">i</span>&nbsp;<span class="op" id="5037669">:=</span>&nbsp;<span class="ident" id="5037672">min</span><span class="op" id="5037675">;</span>&nbsp;<span class="ident" id="5037677">i</span>&nbsp;<span class="op" id="5037679">&lt;=</span>&nbsp;<span class="ident" id="5037682">max</span><span class="op" id="5037685">;</span>&nbsp;<span class="ident" id="5037687">i</span><span class="op" id="5037688">++</span>&nbsp;<span class="op" id="5037691">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037695">if</span>&nbsp;<span class="ident" id="5037698">i</span>&nbsp;<span class="op" id="5037700">==</span>&nbsp;<span class="ident" id="5037703">huffmanChunkBits</span><span class="op" id="5037719">+</span><span class="num" id="5037720">1</span>&nbsp;<span class="op" id="5037722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5037727">//&nbsp;create&nbsp;link&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037752">link</span>&nbsp;<span class="op" id="5037757">:=</span>&nbsp;<span class="ident" id="5037760">code</span>&nbsp;<span class="op" id="5037765">&gt;&gt;</span>&nbsp;<span class="num" id="5037768">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037773">if</span>&nbsp;<span class="ident" id="5037776">huffmanNumChunks</span>&nbsp;<span class="op" id="5037793">&lt;</span>&nbsp;<span class="ident" id="5037795">link</span>&nbsp;<span class="op" id="5037800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037806">return</span>&nbsp;<span class="builtintype" id="5037813">false</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5037822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037827">h</span><span class="op" id="5037828">.</span><span class="ident" id="5037829">links</span>&nbsp;<span class="op" id="5037835">=</span>&nbsp;<span class="builtinfunc" id="5037837">make</span><span class="op" id="5037841">(</span><span class="op" id="5037842">[</span><span class="op" id="5037843">]</span><span class="op" id="5037844">[</span><span class="op" id="5037845">]</span><span class="builtintype" id="5037846">uint32</span><span class="op" id="5037852">,</span>&nbsp;<span class="ident" id="5037854">huffmanNumChunks</span><span class="op" id="5037870">-</span><span class="ident" id="5037871">link</span><span class="op" id="5037875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5037880">for</span>&nbsp;<span class="ident" id="5037884">j</span>&nbsp;<span class="op" id="5037886">:=</span>&nbsp;<span class="builtintype" id="5037889">uint</span><span class="op" id="5037893">(</span><span class="ident" id="5037894">link</span><span class="op" id="5037898">)</span><span class="op" id="5037899">;</span>&nbsp;<span class="ident" id="5037901">j</span>&nbsp;<span class="op" id="5037903">&lt;</span>&nbsp;<span class="ident" id="5037905">huffmanNumChunks</span><span class="op" id="5037921">;</span>&nbsp;<span class="ident" id="5037923">j</span><span class="op" id="5037924">++</span>&nbsp;<span class="op" id="5037927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5037933">reverse</span>&nbsp;<span class="op" id="5037941">:=</span>&nbsp;<span class="builtintype" id="5037944">int</span><span class="op" id="5037947">(</span><span class="ident" id="5037948">reverseByte</span><span class="op" id="5037959">[</span><span class="ident" id="5037960">j</span><span class="op" id="5037961">&gt;&gt;</span><span class="num" id="5037963">8</span><span class="op" id="5037964">]</span><span class="op" id="5037965">)</span>&nbsp;<span class="op" id="5037967">|</span>&nbsp;<span class="builtintype" id="5037969">int</span><span class="op" id="5037972">(</span><span class="ident" id="5037973">reverseByte</span><span class="op" id="5037984">[</span><span class="ident" id="5037985">j</span><span class="op" id="5037986">&amp;</span><span class="num" id="5037987">0xff</span><span class="op" id="5037991">]</span><span class="op" id="5037992">)</span><span class="op" id="5037993">&lt;&lt;</span><span class="num" id="5037995">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038001">reverse</span>&nbsp;<span class="op" id="5038009">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="5038013">uint</span><span class="op" id="5038017">(</span><span class="num" id="5038018">16</span>&nbsp;<span class="op" id="5038021">-</span>&nbsp;<span class="ident" id="5038023">huffmanChunkBits</span><span class="op" id="5038039">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038045">off</span>&nbsp;<span class="op" id="5038049">:=</span>&nbsp;<span class="ident" id="5038052">j</span>&nbsp;<span class="op" id="5038054">-</span>&nbsp;<span class="builtintype" id="5038056">uint</span><span class="op" id="5038060">(</span><span class="ident" id="5038061">link</span><span class="op" id="5038065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038071">h</span><span class="op" id="5038072">.</span><span class="ident" id="5038073">chunks</span><span class="op" id="5038079">[</span><span class="ident" id="5038080">reverse</span><span class="op" id="5038087">]</span>&nbsp;<span class="op" id="5038089">=</span>&nbsp;<span class="builtintype" id="5038091">uint32</span><span class="op" id="5038097">(</span><span class="ident" id="5038098">off</span><span class="op" id="5038101">&lt;&lt;</span><span class="ident" id="5038103">huffmanValueShift</span>&nbsp;<span class="op" id="5038121">+</span>&nbsp;<span class="builtintype" id="5038123">uint</span><span class="op" id="5038127">(</span><span class="ident" id="5038128">i</span><span class="op" id="5038129">)</span><span class="op" id="5038130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038136">h</span><span class="op" id="5038137">.</span><span class="ident" id="5038138">links</span><span class="op" id="5038143">[</span><span class="ident" id="5038144">off</span><span class="op" id="5038147">]</span>&nbsp;<span class="op" id="5038149">=</span>&nbsp;<span class="builtinfunc" id="5038151">make</span><span class="op" id="5038155">(</span><span class="op" id="5038156">[</span><span class="op" id="5038157">]</span><span class="builtintype" id="5038158">uint32</span><span class="op" id="5038164">,</span>&nbsp;<span class="num" id="5038166">1</span><span class="op" id="5038167">&lt;&lt;</span><span class="ident" id="5038169">linkBits</span><span class="op" id="5038177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038186">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038190">n</span>&nbsp;<span class="op" id="5038192">:=</span>&nbsp;<span class="ident" id="5038195">count</span><span class="op" id="5038200">[</span><span class="ident" id="5038201">i</span><span class="op" id="5038202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038206">nextcode</span><span class="op" id="5038214">[</span><span class="ident" id="5038215">i</span><span class="op" id="5038216">]</span>&nbsp;<span class="op" id="5038218">=</span>&nbsp;<span class="ident" id="5038220">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038227">code</span>&nbsp;<span class="op" id="5038232">+=</span>&nbsp;<span class="ident" id="5038235">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038239">code</span>&nbsp;<span class="op" id="5038244">&lt;&lt;=</span>&nbsp;<span class="num" id="5038248">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038251">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038255">for</span>&nbsp;<span class="ident" id="5038259">i</span><span class="op" id="5038260">,</span>&nbsp;<span class="ident" id="5038262">n</span>&nbsp;<span class="op" id="5038264">:=</span>&nbsp;<span class="keyword" id="5038267">range</span>&nbsp;<span class="ident" id="5038273">bits</span>&nbsp;<span class="op" id="5038278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038282">if</span>&nbsp;<span class="ident" id="5038285">n</span>&nbsp;<span class="op" id="5038287">==</span>&nbsp;<span class="num" id="5038290">0</span>&nbsp;<span class="op" id="5038292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038297">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038308">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038312">code</span>&nbsp;<span class="op" id="5038317">:=</span>&nbsp;<span class="ident" id="5038320">nextcode</span><span class="op" id="5038328">[</span><span class="ident" id="5038329">n</span><span class="op" id="5038330">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038334">nextcode</span><span class="op" id="5038342">[</span><span class="ident" id="5038343">n</span><span class="op" id="5038344">]</span><span class="op" id="5038345">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038350">chunk</span>&nbsp;<span class="op" id="5038356">:=</span>&nbsp;<span class="builtintype" id="5038359">uint32</span><span class="op" id="5038365">(</span><span class="ident" id="5038366">i</span><span class="op" id="5038367">&lt;&lt;</span><span class="ident" id="5038369">huffmanValueShift</span>&nbsp;<span class="op" id="5038387">|</span>&nbsp;<span class="ident" id="5038389">n</span><span class="op" id="5038390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038394">reverse</span>&nbsp;<span class="op" id="5038402">:=</span>&nbsp;<span class="builtintype" id="5038405">int</span><span class="op" id="5038408">(</span><span class="ident" id="5038409">reverseByte</span><span class="op" id="5038420">[</span><span class="ident" id="5038421">code</span><span class="op" id="5038425">&gt;&gt;</span><span class="num" id="5038427">8</span><span class="op" id="5038428">]</span><span class="op" id="5038429">)</span>&nbsp;<span class="op" id="5038431">|</span>&nbsp;<span class="builtintype" id="5038433">int</span><span class="op" id="5038436">(</span><span class="ident" id="5038437">reverseByte</span><span class="op" id="5038448">[</span><span class="ident" id="5038449">code</span><span class="op" id="5038453">&amp;</span><span class="num" id="5038454">0xff</span><span class="op" id="5038458">]</span><span class="op" id="5038459">)</span><span class="op" id="5038460">&lt;&lt;</span><span class="num" id="5038462">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038466">reverse</span>&nbsp;<span class="op" id="5038474">&gt;&gt;=</span>&nbsp;<span class="builtintype" id="5038478">uint</span><span class="op" id="5038482">(</span><span class="num" id="5038483">16</span>&nbsp;<span class="op" id="5038486">-</span>&nbsp;<span class="ident" id="5038488">n</span><span class="op" id="5038489">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038493">if</span>&nbsp;<span class="ident" id="5038496">n</span>&nbsp;<span class="op" id="5038498">&lt;=</span>&nbsp;<span class="ident" id="5038501">huffmanChunkBits</span>&nbsp;<span class="op" id="5038518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038523">for</span>&nbsp;<span class="ident" id="5038527">off</span>&nbsp;<span class="op" id="5038531">:=</span>&nbsp;<span class="ident" id="5038534">reverse</span><span class="op" id="5038541">;</span>&nbsp;<span class="ident" id="5038543">off</span>&nbsp;<span class="op" id="5038547">&lt;</span>&nbsp;<span class="ident" id="5038549">huffmanNumChunks</span><span class="op" id="5038565">;</span>&nbsp;<span class="ident" id="5038567">off</span>&nbsp;<span class="op" id="5038571">+=</span>&nbsp;<span class="num" id="5038574">1</span>&nbsp;<span class="op" id="5038576">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5038579">uint</span><span class="op" id="5038583">(</span><span class="ident" id="5038584">n</span><span class="op" id="5038585">)</span>&nbsp;<span class="op" id="5038587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038593">h</span><span class="op" id="5038594">.</span><span class="ident" id="5038595">chunks</span><span class="op" id="5038601">[</span><span class="ident" id="5038602">off</span><span class="op" id="5038605">]</span>&nbsp;<span class="op" id="5038607">=</span>&nbsp;<span class="ident" id="5038609">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038622">}</span>&nbsp;<span class="keyword" id="5038624">else</span>&nbsp;<span class="op" id="5038629">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038634">value</span>&nbsp;<span class="op" id="5038640">:=</span>&nbsp;<span class="ident" id="5038643">h</span><span class="op" id="5038644">.</span><span class="ident" id="5038645">chunks</span><span class="op" id="5038651">[</span><span class="ident" id="5038652">reverse</span><span class="op" id="5038659">&amp;</span><span class="op" id="5038660">(</span><span class="ident" id="5038661">huffmanNumChunks</span><span class="op" id="5038677">-</span><span class="num" id="5038678">1</span><span class="op" id="5038679">)</span><span class="op" id="5038680">]</span>&nbsp;<span class="op" id="5038682">&gt;&gt;</span>&nbsp;<span class="ident" id="5038685">huffmanValueShift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038706">if</span>&nbsp;<span class="ident" id="5038709">value</span>&nbsp;<span class="op" id="5038715">&gt;=</span>&nbsp;<span class="builtintype" id="5038718">uint32</span><span class="op" id="5038724">(</span><span class="builtinfunc" id="5038725">len</span><span class="op" id="5038728">(</span><span class="ident" id="5038729">h</span><span class="op" id="5038730">.</span><span class="ident" id="5038731">links</span><span class="op" id="5038736">)</span><span class="op" id="5038737">)</span>&nbsp;<span class="op" id="5038739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038745">return</span>&nbsp;<span class="builtintype" id="5038752">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038766">linktab</span>&nbsp;<span class="op" id="5038774">:=</span>&nbsp;<span class="ident" id="5038777">h</span><span class="op" id="5038778">.</span><span class="ident" id="5038779">links</span><span class="op" id="5038784">[</span><span class="ident" id="5038785">value</span><span class="op" id="5038790">]</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038795">reverse</span>&nbsp;<span class="op" id="5038803">&gt;&gt;=</span>&nbsp;<span class="ident" id="5038807">huffmanChunkBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038827">for</span>&nbsp;<span class="ident" id="5038831">off</span>&nbsp;<span class="op" id="5038835">:=</span>&nbsp;<span class="ident" id="5038838">reverse</span><span class="op" id="5038845">;</span>&nbsp;<span class="ident" id="5038847">off</span>&nbsp;<span class="op" id="5038851">&lt;</span>&nbsp;<span class="ident" id="5038853">numLinks</span><span class="op" id="5038861">;</span>&nbsp;<span class="ident" id="5038863">off</span>&nbsp;<span class="op" id="5038867">+=</span>&nbsp;<span class="num" id="5038870">1</span>&nbsp;<span class="op" id="5038872">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5038875">uint</span><span class="op" id="5038879">(</span><span class="ident" id="5038880">n</span><span class="op" id="5038881">-</span><span class="ident" id="5038882">huffmanChunkBits</span><span class="op" id="5038898">)</span>&nbsp;<span class="op" id="5038900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5038906">linktab</span><span class="op" id="5038913">[</span><span class="ident" id="5038914">off</span><span class="op" id="5038917">]</span>&nbsp;<span class="op" id="5038919">=</span>&nbsp;<span class="ident" id="5038921">chunk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038934">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5038937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5038940">return</span>&nbsp;<span class="builtintype" id="5038947">true</span><br>
<span class="lineno"></span><span class="op" id="5038952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5038955">//&nbsp;The&nbsp;actual&nbsp;read&nbsp;interface&nbsp;needed&nbsp;by&nbsp;NewReader.</span><br>
<span class="lineno">190</span><span class="comment" id="5039005">//&nbsp;If&nbsp;the&nbsp;passed&nbsp;in&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,</span><br>
<span class="lineno"></span><span class="comment" id="5039064">//&nbsp;the&nbsp;NewReader&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="5039115">type</span>&nbsp;<span class="ident" id="5039120">Reader</span>&nbsp;<span class="keyword" id="5039127">interface</span>&nbsp;<span class="op" id="5039137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039140">io</span><span class="op" id="5039142">.</span><span class="ident" id="5039143">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039151">io</span><span class="op" id="5039153">.</span><span class="ident" id="5039154">ByteReader</span><br>
<span class="lineno">195</span><span class="op" id="5039165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5039168">//&nbsp;Decompress&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5039189">type</span>&nbsp;<span class="ident" id="5039194">decompressor</span>&nbsp;<span class="keyword" id="5039207">struct</span>&nbsp;<span class="op" id="5039214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039217">//&nbsp;Input&nbsp;source.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039235">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5039243">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039251">roffset</span>&nbsp;<span class="ident" id="5039259">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039266">woffset</span>&nbsp;<span class="ident" id="5039274">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039282">//&nbsp;Input&nbsp;bits,&nbsp;in&nbsp;top&nbsp;of&nbsp;b.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039311">b</span>&nbsp;&nbsp;<span class="builtintype" id="5039314">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039322">nb</span>&nbsp;<span class="builtintype" id="5039325">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039332">//&nbsp;Huffman&nbsp;decoders&nbsp;for&nbsp;literal/length,&nbsp;distance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039383">h1</span><span class="op" id="5039385">,</span>&nbsp;<span class="ident" id="5039387">h2</span>&nbsp;<span class="ident" id="5039390">huffmanDecoder</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039407">//&nbsp;Length&nbsp;arrays&nbsp;used&nbsp;to&nbsp;define&nbsp;Huffman&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039455">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5039464">*</span><span class="op" id="5039465">[</span><span class="ident" id="5039466">maxLit</span>&nbsp;<span class="op" id="5039473">+</span>&nbsp;<span class="ident" id="5039475">maxDist</span><span class="op" id="5039482">]</span><span class="builtintype" id="5039483">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039488">codebits</span>&nbsp;<span class="op" id="5039497">*</span><span class="op" id="5039498">[</span><span class="ident" id="5039499">numCodes</span><span class="op" id="5039507">]</span><span class="builtintype" id="5039508">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039514">//&nbsp;Output&nbsp;history,&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039542">hist</span>&nbsp;&nbsp;<span class="op" id="5039548">*</span><span class="op" id="5039549">[</span><span class="ident" id="5039550">maxHist</span><span class="op" id="5039557">]</span><span class="builtintype" id="5039558">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039564">hp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5039570">int</span>&nbsp;&nbsp;<span class="comment" id="5039575">//&nbsp;current&nbsp;output&nbsp;position&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039613">hw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5039619">int</span>&nbsp;&nbsp;<span class="comment" id="5039624">//&nbsp;have&nbsp;written&nbsp;hist[0:hw]&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039660">hfull</span>&nbsp;<span class="builtintype" id="5039666">bool</span>&nbsp;<span class="comment" id="5039671">//&nbsp;buffer&nbsp;has&nbsp;filled&nbsp;at&nbsp;least&nbsp;once</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039708">//&nbsp;Temporary&nbsp;buffer&nbsp;(avoids&nbsp;repeated&nbsp;allocation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039759">buf</span>&nbsp;<span class="op" id="5039763">[</span><span class="num" id="5039764">4</span><span class="op" id="5039765">]</span><span class="builtintype" id="5039766">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039773">//&nbsp;Next&nbsp;step&nbsp;in&nbsp;the&nbsp;decompression,</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5039809">//&nbsp;and&nbsp;decompression&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039838">step</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5039847">func</span><span class="op" id="5039851">(</span><span class="op" id="5039852">*</span><span class="ident" id="5039853">decompressor</span><span class="op" id="5039865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039868">final</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5039877">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039883">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5039892">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039899">toRead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5039908">[</span><span class="op" id="5039909">]</span><span class="builtintype" id="5039910">byte</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039916">hl</span><span class="op" id="5039918">,</span>&nbsp;<span class="ident" id="5039920">hd</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5039925">*</span><span class="ident" id="5039926">huffmanDecoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039942">copyLen</span>&nbsp;&nbsp;<span class="builtintype" id="5039951">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5039956">copyDist</span>&nbsp;<span class="builtintype" id="5039965">int</span><br>
<span class="lineno"></span><span class="op" id="5039969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="5039972">func</span>&nbsp;<span class="op" id="5039977">(</span><span class="ident" id="5039978">f</span>&nbsp;<span class="op" id="5039980">*</span><span class="ident" id="5039981">decompressor</span><span class="op" id="5039993">)</span>&nbsp;<span class="ident" id="5039995">nextBlock</span><span class="op" id="5040004">(</span><span class="op" id="5040005">)</span>&nbsp;<span class="op" id="5040007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040010">if</span>&nbsp;<span class="ident" id="5040013">f</span><span class="op" id="5040014">.</span><span class="ident" id="5040015">final</span>&nbsp;<span class="op" id="5040021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040025">if</span>&nbsp;<span class="ident" id="5040028">f</span><span class="op" id="5040029">.</span><span class="ident" id="5040030">hw</span>&nbsp;<span class="op" id="5040033">!=</span>&nbsp;<span class="ident" id="5040036">f</span><span class="op" id="5040037">.</span><span class="ident" id="5040038">hp</span>&nbsp;<span class="op" id="5040041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040046">f</span><span class="op" id="5040047">.</span><span class="ident" id="5040048">flush</span><span class="op" id="5040053">(</span><span class="op" id="5040054">(</span><span class="op" id="5040055">*</span><span class="ident" id="5040056">decompressor</span><span class="op" id="5040068">)</span><span class="op" id="5040069">.</span><span class="ident" id="5040070">nextBlock</span><span class="op" id="5040079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040084">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040097">f</span><span class="op" id="5040098">.</span><span class="ident" id="5040099">err</span>&nbsp;<span class="op" id="5040103">=</span>&nbsp;<span class="ident" id="5040105">io</span><span class="op" id="5040107">.</span><span class="ident" id="5040108">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040114">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040125">for</span>&nbsp;<span class="ident" id="5040129">f</span><span class="op" id="5040130">.</span><span class="ident" id="5040131">nb</span>&nbsp;<span class="op" id="5040134">&lt;</span>&nbsp;<span class="num" id="5040136">1</span><span class="op" id="5040137">+</span><span class="num" id="5040138">2</span>&nbsp;<span class="op" id="5040140">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040144">if</span>&nbsp;<span class="ident" id="5040147">f</span><span class="op" id="5040148">.</span><span class="ident" id="5040149">err</span>&nbsp;<span class="op" id="5040153">=</span>&nbsp;<span class="ident" id="5040155">f</span><span class="op" id="5040156">.</span><span class="ident" id="5040157">moreBits</span><span class="op" id="5040165">(</span><span class="op" id="5040166">)</span><span class="op" id="5040167">;</span>&nbsp;<span class="ident" id="5040169">f</span><span class="op" id="5040170">.</span><span class="ident" id="5040171">err</span>&nbsp;<span class="op" id="5040175">!=</span>&nbsp;<span class="ident" id="5040178">nil</span>&nbsp;<span class="op" id="5040182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040187">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040202">f</span><span class="op" id="5040203">.</span><span class="ident" id="5040204">final</span>&nbsp;<span class="op" id="5040210">=</span>&nbsp;<span class="ident" id="5040212">f</span><span class="op" id="5040213">.</span><span class="ident" id="5040214">b</span><span class="op" id="5040215">&amp;</span><span class="num" id="5040216">1</span>&nbsp;<span class="op" id="5040218">==</span>&nbsp;<span class="num" id="5040221">1</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040224">f</span><span class="op" id="5040225">.</span><span class="ident" id="5040226">b</span>&nbsp;<span class="op" id="5040228">&gt;&gt;=</span>&nbsp;<span class="num" id="5040232">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040235">typ</span>&nbsp;<span class="op" id="5040239">:=</span>&nbsp;<span class="ident" id="5040242">f</span><span class="op" id="5040243">.</span><span class="ident" id="5040244">b</span>&nbsp;<span class="op" id="5040246">&amp;</span>&nbsp;<span class="num" id="5040248">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040251">f</span><span class="op" id="5040252">.</span><span class="ident" id="5040253">b</span>&nbsp;<span class="op" id="5040255">&gt;&gt;=</span>&nbsp;<span class="num" id="5040259">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040262">f</span><span class="op" id="5040263">.</span><span class="ident" id="5040264">nb</span>&nbsp;<span class="op" id="5040267">-=</span>&nbsp;<span class="num" id="5040270">1</span>&nbsp;<span class="op" id="5040272">+</span>&nbsp;<span class="num" id="5040274">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040277">switch</span>&nbsp;<span class="ident" id="5040284">typ</span>&nbsp;<span class="op" id="5040288">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040291">case</span>&nbsp;<span class="num" id="5040296">0</span><span class="op" id="5040297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040301">f</span><span class="op" id="5040302">.</span><span class="ident" id="5040303">dataBlock</span><span class="op" id="5040312">(</span><span class="op" id="5040313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040316">case</span>&nbsp;<span class="num" id="5040321">1</span><span class="op" id="5040322">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5040326">//&nbsp;compressed,&nbsp;fixed&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040364">f</span><span class="op" id="5040365">.</span><span class="ident" id="5040366">hl</span>&nbsp;<span class="op" id="5040369">=</span>&nbsp;<span class="op" id="5040371">&amp;</span><span class="ident" id="5040372">fixedHuffmanDecoder</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040394">f</span><span class="op" id="5040395">.</span><span class="ident" id="5040396">hd</span>&nbsp;<span class="op" id="5040399">=</span>&nbsp;<span class="ident" id="5040401">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040407">f</span><span class="op" id="5040408">.</span><span class="ident" id="5040409">huffmanBlock</span><span class="op" id="5040421">(</span><span class="op" id="5040422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040425">case</span>&nbsp;<span class="num" id="5040430">2</span><span class="op" id="5040431">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5040435">//&nbsp;compressed,&nbsp;dynamic&nbsp;Huffman&nbsp;tables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040475">if</span>&nbsp;<span class="ident" id="5040478">f</span><span class="op" id="5040479">.</span><span class="ident" id="5040480">err</span>&nbsp;<span class="op" id="5040484">=</span>&nbsp;<span class="ident" id="5040486">f</span><span class="op" id="5040487">.</span><span class="ident" id="5040488">readHuffman</span><span class="op" id="5040499">(</span><span class="op" id="5040500">)</span><span class="op" id="5040501">;</span>&nbsp;<span class="ident" id="5040503">f</span><span class="op" id="5040504">.</span><span class="ident" id="5040505">err</span>&nbsp;<span class="op" id="5040509">!=</span>&nbsp;<span class="ident" id="5040512">nil</span>&nbsp;<span class="op" id="5040516">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040521">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040533">f</span><span class="op" id="5040534">.</span><span class="ident" id="5040535">hl</span>&nbsp;<span class="op" id="5040538">=</span>&nbsp;<span class="op" id="5040540">&amp;</span><span class="ident" id="5040541">f</span><span class="op" id="5040542">.</span><span class="ident" id="5040543">h1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040548">f</span><span class="op" id="5040549">.</span><span class="ident" id="5040550">hd</span>&nbsp;<span class="op" id="5040553">=</span>&nbsp;<span class="op" id="5040555">&amp;</span><span class="ident" id="5040556">f</span><span class="op" id="5040557">.</span><span class="ident" id="5040558">h2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040563">f</span><span class="op" id="5040564">.</span><span class="ident" id="5040565">huffmanBlock</span><span class="op" id="5040577">(</span><span class="op" id="5040578">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040581">default</span><span class="op" id="5040588">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5040592">//&nbsp;3&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040612">f</span><span class="op" id="5040613">.</span><span class="ident" id="5040614">err</span>&nbsp;<span class="op" id="5040618">=</span>&nbsp;<span class="ident" id="5040620">CorruptInputError</span><span class="op" id="5040637">(</span><span class="ident" id="5040638">f</span><span class="op" id="5040639">.</span><span class="ident" id="5040640">roffset</span><span class="op" id="5040647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040650">}</span><br>
<span class="lineno"></span><span class="op" id="5040652">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="5040655">func</span>&nbsp;<span class="op" id="5040660">(</span><span class="ident" id="5040661">f</span>&nbsp;<span class="op" id="5040663">*</span><span class="ident" id="5040664">decompressor</span><span class="op" id="5040676">)</span>&nbsp;<span class="ident" id="5040678">Read</span><span class="op" id="5040682">(</span><span class="ident" id="5040683">b</span>&nbsp;<span class="op" id="5040685">[</span><span class="op" id="5040686">]</span><span class="builtintype" id="5040687">byte</span><span class="op" id="5040691">)</span>&nbsp;<span class="op" id="5040693">(</span><span class="builtintype" id="5040694">int</span><span class="op" id="5040697">,</span>&nbsp;<span class="builtintype" id="5040699">error</span><span class="op" id="5040704">)</span>&nbsp;<span class="op" id="5040706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040709">for</span>&nbsp;<span class="op" id="5040713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040717">if</span>&nbsp;<span class="builtinfunc" id="5040720">len</span><span class="op" id="5040723">(</span><span class="ident" id="5040724">f</span><span class="op" id="5040725">.</span><span class="ident" id="5040726">toRead</span><span class="op" id="5040732">)</span>&nbsp;<span class="op" id="5040734">&gt;</span>&nbsp;<span class="num" id="5040736">0</span>&nbsp;<span class="op" id="5040738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040743">n</span>&nbsp;<span class="op" id="5040745">:=</span>&nbsp;<span class="builtinfunc" id="5040748">copy</span><span class="op" id="5040752">(</span><span class="ident" id="5040753">b</span><span class="op" id="5040754">,</span>&nbsp;<span class="ident" id="5040756">f</span><span class="op" id="5040757">.</span><span class="ident" id="5040758">toRead</span><span class="op" id="5040764">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040769">f</span><span class="op" id="5040770">.</span><span class="ident" id="5040771">toRead</span>&nbsp;<span class="op" id="5040778">=</span>&nbsp;<span class="ident" id="5040780">f</span><span class="op" id="5040781">.</span><span class="ident" id="5040782">toRead</span><span class="op" id="5040788">[</span><span class="ident" id="5040789">n</span><span class="op" id="5040790">:</span><span class="op" id="5040791">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040796">return</span>&nbsp;<span class="ident" id="5040803">n</span><span class="op" id="5040804">,</span>&nbsp;<span class="ident" id="5040806">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040816">if</span>&nbsp;<span class="ident" id="5040819">f</span><span class="op" id="5040820">.</span><span class="ident" id="5040821">err</span>&nbsp;<span class="op" id="5040825">!=</span>&nbsp;<span class="ident" id="5040828">nil</span>&nbsp;<span class="op" id="5040832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040837">return</span>&nbsp;<span class="num" id="5040844">0</span><span class="op" id="5040845">,</span>&nbsp;<span class="ident" id="5040847">f</span><span class="op" id="5040848">.</span><span class="ident" id="5040849">err</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5040859">f</span><span class="op" id="5040860">.</span><span class="ident" id="5040861">step</span><span class="op" id="5040865">(</span><span class="ident" id="5040866">f</span><span class="op" id="5040867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040870">}</span><br>
<span class="lineno"></span><span class="op" id="5040872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="5040875">func</span>&nbsp;<span class="op" id="5040880">(</span><span class="ident" id="5040881">f</span>&nbsp;<span class="op" id="5040883">*</span><span class="ident" id="5040884">decompressor</span><span class="op" id="5040896">)</span>&nbsp;<span class="ident" id="5040898">Close</span><span class="op" id="5040903">(</span><span class="op" id="5040904">)</span>&nbsp;<span class="builtintype" id="5040906">error</span>&nbsp;<span class="op" id="5040912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040915">if</span>&nbsp;<span class="ident" id="5040918">f</span><span class="op" id="5040919">.</span><span class="ident" id="5040920">err</span>&nbsp;<span class="op" id="5040924">==</span>&nbsp;<span class="ident" id="5040927">io</span><span class="op" id="5040929">.</span><span class="ident" id="5040930">EOF</span>&nbsp;<span class="op" id="5040934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040938">return</span>&nbsp;<span class="ident" id="5040945">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5040950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5040953">return</span>&nbsp;<span class="ident" id="5040960">f</span><span class="op" id="5040961">.</span><span class="ident" id="5040962">err</span><br>
<span class="lineno">295</span><span class="op" id="5040966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5040969">//&nbsp;RFC&nbsp;1951&nbsp;section&nbsp;3.2.7.</span><br>
<span class="lineno"></span><span class="comment" id="5040996">//&nbsp;Compression&nbsp;with&nbsp;dynamic&nbsp;Huffman&nbsp;codes</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="5041039">var</span>&nbsp;<span class="ident" id="5041043">codeOrder</span>&nbsp;<span class="op" id="5041053">=</span>&nbsp;<span class="op" id="5041055">[</span><span class="op" id="5041056">...</span><span class="op" id="5041059">]</span><span class="builtintype" id="5041060">int</span><span class="op" id="5041063">{</span><span class="num" id="5041064">16</span><span class="op" id="5041066">,</span>&nbsp;<span class="num" id="5041068">17</span><span class="op" id="5041070">,</span>&nbsp;<span class="num" id="5041072">18</span><span class="op" id="5041074">,</span>&nbsp;<span class="num" id="5041076">0</span><span class="op" id="5041077">,</span>&nbsp;<span class="num" id="5041079">8</span><span class="op" id="5041080">,</span>&nbsp;<span class="num" id="5041082">7</span><span class="op" id="5041083">,</span>&nbsp;<span class="num" id="5041085">9</span><span class="op" id="5041086">,</span>&nbsp;<span class="num" id="5041088">6</span><span class="op" id="5041089">,</span>&nbsp;<span class="num" id="5041091">10</span><span class="op" id="5041093">,</span>&nbsp;<span class="num" id="5041095">5</span><span class="op" id="5041096">,</span>&nbsp;<span class="num" id="5041098">11</span><span class="op" id="5041100">,</span>&nbsp;<span class="num" id="5041102">4</span><span class="op" id="5041103">,</span>&nbsp;<span class="num" id="5041105">12</span><span class="op" id="5041107">,</span>&nbsp;<span class="num" id="5041109">3</span><span class="op" id="5041110">,</span>&nbsp;<span class="num" id="5041112">13</span><span class="op" id="5041114">,</span>&nbsp;<span class="num" id="5041116">2</span><span class="op" id="5041117">,</span>&nbsp;<span class="num" id="5041119">14</span><span class="op" id="5041121">,</span>&nbsp;<span class="num" id="5041123">1</span><span class="op" id="5041124">,</span>&nbsp;<span class="num" id="5041126">15</span><span class="op" id="5041128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5041131">func</span>&nbsp;<span class="op" id="5041136">(</span><span class="ident" id="5041137">f</span>&nbsp;<span class="op" id="5041139">*</span><span class="ident" id="5041140">decompressor</span><span class="op" id="5041152">)</span>&nbsp;<span class="ident" id="5041154">readHuffman</span><span class="op" id="5041165">(</span><span class="op" id="5041166">)</span>&nbsp;<span class="builtintype" id="5041168">error</span>&nbsp;<span class="op" id="5041174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041177">//&nbsp;HLIT[5],&nbsp;HDIST[5],&nbsp;HCLEN[4].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041210">for</span>&nbsp;<span class="ident" id="5041214">f</span><span class="op" id="5041215">.</span><span class="ident" id="5041216">nb</span>&nbsp;<span class="op" id="5041219">&lt;</span>&nbsp;<span class="num" id="5041221">5</span><span class="op" id="5041222">+</span><span class="num" id="5041223">5</span><span class="op" id="5041224">+</span><span class="num" id="5041225">4</span>&nbsp;<span class="op" id="5041227">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041231">if</span>&nbsp;<span class="ident" id="5041234">err</span>&nbsp;<span class="op" id="5041238">:=</span>&nbsp;<span class="ident" id="5041241">f</span><span class="op" id="5041242">.</span><span class="ident" id="5041243">moreBits</span><span class="op" id="5041251">(</span><span class="op" id="5041252">)</span><span class="op" id="5041253">;</span>&nbsp;<span class="ident" id="5041255">err</span>&nbsp;<span class="op" id="5041259">!=</span>&nbsp;<span class="ident" id="5041262">nil</span>&nbsp;<span class="op" id="5041266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041271">return</span>&nbsp;<span class="ident" id="5041278">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041290">nlit</span>&nbsp;<span class="op" id="5041295">:=</span>&nbsp;<span class="builtintype" id="5041298">int</span><span class="op" id="5041301">(</span><span class="ident" id="5041302">f</span><span class="op" id="5041303">.</span><span class="ident" id="5041304">b</span><span class="op" id="5041305">&amp;</span><span class="num" id="5041306">0x1F</span><span class="op" id="5041310">)</span>&nbsp;<span class="op" id="5041312">+</span>&nbsp;<span class="num" id="5041314">257</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041319">if</span>&nbsp;<span class="ident" id="5041322">nlit</span>&nbsp;<span class="op" id="5041327">&gt;</span>&nbsp;<span class="ident" id="5041329">maxLit</span>&nbsp;<span class="op" id="5041336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041340">return</span>&nbsp;<span class="ident" id="5041347">CorruptInputError</span><span class="op" id="5041364">(</span><span class="ident" id="5041365">f</span><span class="op" id="5041366">.</span><span class="ident" id="5041367">roffset</span><span class="op" id="5041374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041380">f</span><span class="op" id="5041381">.</span><span class="ident" id="5041382">b</span>&nbsp;<span class="op" id="5041384">&gt;&gt;=</span>&nbsp;<span class="num" id="5041388">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041391">ndist</span>&nbsp;<span class="op" id="5041397">:=</span>&nbsp;<span class="builtintype" id="5041400">int</span><span class="op" id="5041403">(</span><span class="ident" id="5041404">f</span><span class="op" id="5041405">.</span><span class="ident" id="5041406">b</span><span class="op" id="5041407">&amp;</span><span class="num" id="5041408">0x1F</span><span class="op" id="5041412">)</span>&nbsp;<span class="op" id="5041414">+</span>&nbsp;<span class="num" id="5041416">1</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041419">//&nbsp;maxDist&nbsp;is&nbsp;32,&nbsp;so&nbsp;ndist&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041464">f</span><span class="op" id="5041465">.</span><span class="ident" id="5041466">b</span>&nbsp;<span class="op" id="5041468">&gt;&gt;=</span>&nbsp;<span class="num" id="5041472">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041475">nclen</span>&nbsp;<span class="op" id="5041481">:=</span>&nbsp;<span class="builtintype" id="5041484">int</span><span class="op" id="5041487">(</span><span class="ident" id="5041488">f</span><span class="op" id="5041489">.</span><span class="ident" id="5041490">b</span><span class="op" id="5041491">&amp;</span><span class="num" id="5041492">0xF</span><span class="op" id="5041495">)</span>&nbsp;<span class="op" id="5041497">+</span>&nbsp;<span class="num" id="5041499">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041502">//&nbsp;numCodes&nbsp;is&nbsp;19,&nbsp;so&nbsp;nclen&nbsp;is&nbsp;always&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041548">f</span><span class="op" id="5041549">.</span><span class="ident" id="5041550">b</span>&nbsp;<span class="op" id="5041552">&gt;&gt;=</span>&nbsp;<span class="num" id="5041556">4</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041559">f</span><span class="op" id="5041560">.</span><span class="ident" id="5041561">nb</span>&nbsp;<span class="op" id="5041564">-=</span>&nbsp;<span class="num" id="5041567">5</span>&nbsp;<span class="op" id="5041569">+</span>&nbsp;<span class="num" id="5041571">5</span>&nbsp;<span class="op" id="5041573">+</span>&nbsp;<span class="num" id="5041575">4</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041579">//&nbsp;(HCLEN+4)*3&nbsp;bits:&nbsp;code&nbsp;lengths&nbsp;in&nbsp;the&nbsp;magic&nbsp;codeOrder&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041644">for</span>&nbsp;<span class="ident" id="5041648">i</span>&nbsp;<span class="op" id="5041650">:=</span>&nbsp;<span class="num" id="5041653">0</span><span class="op" id="5041654">;</span>&nbsp;<span class="ident" id="5041656">i</span>&nbsp;<span class="op" id="5041658">&lt;</span>&nbsp;<span class="ident" id="5041660">nclen</span><span class="op" id="5041665">;</span>&nbsp;<span class="ident" id="5041667">i</span><span class="op" id="5041668">++</span>&nbsp;<span class="op" id="5041671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041675">for</span>&nbsp;<span class="ident" id="5041679">f</span><span class="op" id="5041680">.</span><span class="ident" id="5041681">nb</span>&nbsp;<span class="op" id="5041684">&lt;</span>&nbsp;<span class="num" id="5041686">3</span>&nbsp;<span class="op" id="5041688">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041693">if</span>&nbsp;<span class="ident" id="5041696">err</span>&nbsp;<span class="op" id="5041700">:=</span>&nbsp;<span class="ident" id="5041703">f</span><span class="op" id="5041704">.</span><span class="ident" id="5041705">moreBits</span><span class="op" id="5041713">(</span><span class="op" id="5041714">)</span><span class="op" id="5041715">;</span>&nbsp;<span class="ident" id="5041717">err</span>&nbsp;<span class="op" id="5041721">!=</span>&nbsp;<span class="ident" id="5041724">nil</span>&nbsp;<span class="op" id="5041728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041734">return</span>&nbsp;<span class="ident" id="5041741">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041756">f</span><span class="op" id="5041757">.</span><span class="ident" id="5041758">codebits</span><span class="op" id="5041766">[</span><span class="ident" id="5041767">codeOrder</span><span class="op" id="5041776">[</span><span class="ident" id="5041777">i</span><span class="op" id="5041778">]</span><span class="op" id="5041779">]</span>&nbsp;<span class="op" id="5041781">=</span>&nbsp;<span class="builtintype" id="5041783">int</span><span class="op" id="5041786">(</span><span class="ident" id="5041787">f</span><span class="op" id="5041788">.</span><span class="ident" id="5041789">b</span>&nbsp;<span class="op" id="5041791">&amp;</span>&nbsp;<span class="num" id="5041793">0x7</span><span class="op" id="5041796">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041800">f</span><span class="op" id="5041801">.</span><span class="ident" id="5041802">b</span>&nbsp;<span class="op" id="5041804">&gt;&gt;=</span>&nbsp;<span class="num" id="5041808">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041812">f</span><span class="op" id="5041813">.</span><span class="ident" id="5041814">nb</span>&nbsp;<span class="op" id="5041817">-=</span>&nbsp;<span class="num" id="5041820">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041826">for</span>&nbsp;<span class="ident" id="5041830">i</span>&nbsp;<span class="op" id="5041832">:=</span>&nbsp;<span class="ident" id="5041835">nclen</span><span class="op" id="5041840">;</span>&nbsp;<span class="ident" id="5041842">i</span>&nbsp;<span class="op" id="5041844">&lt;</span>&nbsp;<span class="builtinfunc" id="5041846">len</span><span class="op" id="5041849">(</span><span class="ident" id="5041850">codeOrder</span><span class="op" id="5041859">)</span><span class="op" id="5041860">;</span>&nbsp;<span class="ident" id="5041862">i</span><span class="op" id="5041863">++</span>&nbsp;<span class="op" id="5041866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5041870">f</span><span class="op" id="5041871">.</span><span class="ident" id="5041872">codebits</span><span class="op" id="5041880">[</span><span class="ident" id="5041881">codeOrder</span><span class="op" id="5041890">[</span><span class="ident" id="5041891">i</span><span class="op" id="5041892">]</span><span class="op" id="5041893">]</span>&nbsp;<span class="op" id="5041895">=</span>&nbsp;<span class="num" id="5041897">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041903">if</span>&nbsp;<span class="op" id="5041906">!</span><span class="ident" id="5041907">f</span><span class="op" id="5041908">.</span><span class="ident" id="5041909">h1</span><span class="op" id="5041911">.</span><span class="ident" id="5041912">init</span><span class="op" id="5041916">(</span><span class="ident" id="5041917">f</span><span class="op" id="5041918">.</span><span class="ident" id="5041919">codebits</span><span class="op" id="5041927">[</span><span class="num" id="5041928">0</span><span class="op" id="5041929">:</span><span class="op" id="5041930">]</span><span class="op" id="5041931">)</span>&nbsp;<span class="op" id="5041933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5041937">return</span>&nbsp;<span class="ident" id="5041944">CorruptInputError</span><span class="op" id="5041961">(</span><span class="ident" id="5041962">f</span><span class="op" id="5041963">.</span><span class="ident" id="5041964">roffset</span><span class="op" id="5041971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5041974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5041978">//&nbsp;HLIT&nbsp;+&nbsp;257&nbsp;code&nbsp;lengths,&nbsp;HDIST&nbsp;+&nbsp;1&nbsp;code&nbsp;lengths,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042031">//&nbsp;using&nbsp;the&nbsp;code&nbsp;length&nbsp;Huffman&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042071">for</span>&nbsp;<span class="ident" id="5042075">i</span><span class="op" id="5042076">,</span>&nbsp;<span class="ident" id="5042078">n</span>&nbsp;<span class="op" id="5042080">:=</span>&nbsp;<span class="num" id="5042083">0</span><span class="op" id="5042084">,</span>&nbsp;<span class="ident" id="5042086">nlit</span><span class="op" id="5042090">+</span><span class="ident" id="5042091">ndist</span><span class="op" id="5042096">;</span>&nbsp;<span class="ident" id="5042098">i</span>&nbsp;<span class="op" id="5042100">&lt;</span>&nbsp;<span class="ident" id="5042102">n</span><span class="op" id="5042103">;</span>&nbsp;<span class="op" id="5042105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042109">x</span><span class="op" id="5042110">,</span>&nbsp;<span class="ident" id="5042112">err</span>&nbsp;<span class="op" id="5042116">:=</span>&nbsp;<span class="ident" id="5042119">f</span><span class="op" id="5042120">.</span><span class="ident" id="5042121">huffSym</span><span class="op" id="5042128">(</span><span class="op" id="5042129">&amp;</span><span class="ident" id="5042130">f</span><span class="op" id="5042131">.</span><span class="ident" id="5042132">h1</span><span class="op" id="5042134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042138">if</span>&nbsp;<span class="ident" id="5042141">err</span>&nbsp;<span class="op" id="5042145">!=</span>&nbsp;<span class="ident" id="5042148">nil</span>&nbsp;<span class="op" id="5042152">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042157">return</span>&nbsp;<span class="ident" id="5042164">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042174">if</span>&nbsp;<span class="ident" id="5042177">x</span>&nbsp;<span class="op" id="5042179">&lt;</span>&nbsp;<span class="num" id="5042181">16</span>&nbsp;<span class="op" id="5042184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042189">//&nbsp;Actual&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042210">f</span><span class="op" id="5042211">.</span><span class="ident" id="5042212">bits</span><span class="op" id="5042216">[</span><span class="ident" id="5042217">i</span><span class="op" id="5042218">]</span>&nbsp;<span class="op" id="5042220">=</span>&nbsp;<span class="ident" id="5042222">x</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042227">i</span><span class="op" id="5042228">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042234">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5042249">//&nbsp;Repeat&nbsp;previous&nbsp;length&nbsp;or&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042286">var</span>&nbsp;<span class="ident" id="5042290">rep</span>&nbsp;<span class="builtintype" id="5042294">int</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042300">var</span>&nbsp;<span class="ident" id="5042304">nb</span>&nbsp;<span class="builtintype" id="5042307">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042314">var</span>&nbsp;<span class="ident" id="5042318">b</span>&nbsp;<span class="builtintype" id="5042320">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042326">switch</span>&nbsp;<span class="ident" id="5042333">x</span>&nbsp;<span class="op" id="5042335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042339">default</span><span class="op" id="5042346">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042351">return</span>&nbsp;<span class="ident" id="5042358">InternalError</span><span class="op" id="5042371">(</span><span class="string" id="5042372">&#34;unexpected&nbsp;length&nbsp;code&#34;</span><span class="op" id="5042396">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042400">case</span>&nbsp;<span class="num" id="5042405">16</span><span class="op" id="5042407">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042412">rep</span>&nbsp;<span class="op" id="5042416">=</span>&nbsp;<span class="num" id="5042418">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042423">nb</span>&nbsp;<span class="op" id="5042426">=</span>&nbsp;<span class="num" id="5042428">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042433">if</span>&nbsp;<span class="ident" id="5042436">i</span>&nbsp;<span class="op" id="5042438">==</span>&nbsp;<span class="num" id="5042441">0</span>&nbsp;<span class="op" id="5042443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042449">return</span>&nbsp;<span class="ident" id="5042456">CorruptInputError</span><span class="op" id="5042473">(</span><span class="ident" id="5042474">f</span><span class="op" id="5042475">.</span><span class="ident" id="5042476">roffset</span><span class="op" id="5042483">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042493">b</span>&nbsp;<span class="op" id="5042495">=</span>&nbsp;<span class="ident" id="5042497">f</span><span class="op" id="5042498">.</span><span class="ident" id="5042499">bits</span><span class="op" id="5042503">[</span><span class="ident" id="5042504">i</span><span class="op" id="5042505">-</span><span class="num" id="5042506">1</span><span class="op" id="5042507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042511">case</span>&nbsp;<span class="num" id="5042516">17</span><span class="op" id="5042518">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042523">rep</span>&nbsp;<span class="op" id="5042527">=</span>&nbsp;<span class="num" id="5042529">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042534">nb</span>&nbsp;<span class="op" id="5042537">=</span>&nbsp;<span class="num" id="5042539">3</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042544">b</span>&nbsp;<span class="op" id="5042546">=</span>&nbsp;<span class="num" id="5042548">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042552">case</span>&nbsp;<span class="num" id="5042557">18</span><span class="op" id="5042559">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042564">rep</span>&nbsp;<span class="op" id="5042568">=</span>&nbsp;<span class="num" id="5042570">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042576">nb</span>&nbsp;<span class="op" id="5042579">=</span>&nbsp;<span class="num" id="5042581">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042586">b</span>&nbsp;<span class="op" id="5042588">=</span>&nbsp;<span class="num" id="5042590">0</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042598">for</span>&nbsp;<span class="ident" id="5042602">f</span><span class="op" id="5042603">.</span><span class="ident" id="5042604">nb</span>&nbsp;<span class="op" id="5042607">&lt;</span>&nbsp;<span class="ident" id="5042609">nb</span>&nbsp;<span class="op" id="5042612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042617">if</span>&nbsp;<span class="ident" id="5042620">err</span>&nbsp;<span class="op" id="5042624">:=</span>&nbsp;<span class="ident" id="5042627">f</span><span class="op" id="5042628">.</span><span class="ident" id="5042629">moreBits</span><span class="op" id="5042637">(</span><span class="op" id="5042638">)</span><span class="op" id="5042639">;</span>&nbsp;<span class="ident" id="5042641">err</span>&nbsp;<span class="op" id="5042645">!=</span>&nbsp;<span class="ident" id="5042648">nil</span>&nbsp;<span class="op" id="5042652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042658">return</span>&nbsp;<span class="ident" id="5042665">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042672">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042680">rep</span>&nbsp;<span class="op" id="5042684">+=</span>&nbsp;<span class="builtintype" id="5042687">int</span><span class="op" id="5042690">(</span><span class="ident" id="5042691">f</span><span class="op" id="5042692">.</span><span class="ident" id="5042693">b</span>&nbsp;<span class="op" id="5042695">&amp;</span>&nbsp;<span class="builtintype" id="5042697">uint32</span><span class="op" id="5042703">(</span><span class="num" id="5042704">1</span><span class="op" id="5042705">&lt;&lt;</span><span class="ident" id="5042707">nb</span><span class="op" id="5042709">-</span><span class="num" id="5042710">1</span><span class="op" id="5042711">)</span><span class="op" id="5042712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042716">f</span><span class="op" id="5042717">.</span><span class="ident" id="5042718">b</span>&nbsp;<span class="op" id="5042720">&gt;&gt;=</span>&nbsp;<span class="ident" id="5042724">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042729">f</span><span class="op" id="5042730">.</span><span class="ident" id="5042731">nb</span>&nbsp;<span class="op" id="5042734">-=</span>&nbsp;<span class="ident" id="5042737">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042742">if</span>&nbsp;<span class="ident" id="5042745">i</span><span class="op" id="5042746">+</span><span class="ident" id="5042747">rep</span>&nbsp;<span class="op" id="5042751">&gt;</span>&nbsp;<span class="ident" id="5042753">n</span>&nbsp;<span class="op" id="5042755">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042760">return</span>&nbsp;<span class="ident" id="5042767">CorruptInputError</span><span class="op" id="5042784">(</span><span class="ident" id="5042785">f</span><span class="op" id="5042786">.</span><span class="ident" id="5042787">roffset</span><span class="op" id="5042794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042802">for</span>&nbsp;<span class="ident" id="5042806">j</span>&nbsp;<span class="op" id="5042808">:=</span>&nbsp;<span class="num" id="5042811">0</span><span class="op" id="5042812">;</span>&nbsp;<span class="ident" id="5042814">j</span>&nbsp;<span class="op" id="5042816">&lt;</span>&nbsp;<span class="ident" id="5042818">rep</span><span class="op" id="5042821">;</span>&nbsp;<span class="ident" id="5042823">j</span><span class="op" id="5042824">++</span>&nbsp;<span class="op" id="5042827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042832">f</span><span class="op" id="5042833">.</span><span class="ident" id="5042834">bits</span><span class="op" id="5042838">[</span><span class="ident" id="5042839">i</span><span class="op" id="5042840">]</span>&nbsp;<span class="op" id="5042842">=</span>&nbsp;<span class="ident" id="5042844">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5042849">i</span><span class="op" id="5042850">++</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042862">if</span>&nbsp;<span class="op" id="5042865">!</span><span class="ident" id="5042866">f</span><span class="op" id="5042867">.</span><span class="ident" id="5042868">h1</span><span class="op" id="5042870">.</span><span class="ident" id="5042871">init</span><span class="op" id="5042875">(</span><span class="ident" id="5042876">f</span><span class="op" id="5042877">.</span><span class="ident" id="5042878">bits</span><span class="op" id="5042882">[</span><span class="num" id="5042883">0</span><span class="op" id="5042884">:</span><span class="ident" id="5042885">nlit</span><span class="op" id="5042889">]</span><span class="op" id="5042890">)</span>&nbsp;<span class="op" id="5042892">||</span>&nbsp;<span class="op" id="5042895">!</span><span class="ident" id="5042896">f</span><span class="op" id="5042897">.</span><span class="ident" id="5042898">h2</span><span class="op" id="5042900">.</span><span class="ident" id="5042901">init</span><span class="op" id="5042905">(</span><span class="ident" id="5042906">f</span><span class="op" id="5042907">.</span><span class="ident" id="5042908">bits</span><span class="op" id="5042912">[</span><span class="ident" id="5042913">nlit</span><span class="op" id="5042917">:</span><span class="ident" id="5042918">nlit</span><span class="op" id="5042922">+</span><span class="ident" id="5042923">ndist</span><span class="op" id="5042928">]</span><span class="op" id="5042929">)</span>&nbsp;<span class="op" id="5042931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042935">return</span>&nbsp;<span class="ident" id="5042942">CorruptInputError</span><span class="op" id="5042959">(</span><span class="ident" id="5042960">f</span><span class="op" id="5042961">.</span><span class="ident" id="5042962">roffset</span><span class="op" id="5042969">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5042972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5042976">return</span>&nbsp;<span class="ident" id="5042983">nil</span><br>
<span class="lineno"></span><span class="op" id="5042987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="5042990">//&nbsp;Decode&nbsp;a&nbsp;single&nbsp;Huffman&nbsp;block&nbsp;from&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="5043031">//&nbsp;hl&nbsp;and&nbsp;hd&nbsp;are&nbsp;the&nbsp;Huffman&nbsp;states&nbsp;for&nbsp;the&nbsp;lit/length&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="5043093">//&nbsp;and&nbsp;the&nbsp;distance&nbsp;values,&nbsp;respectively.&nbsp;&nbsp;If&nbsp;hd&nbsp;==&nbsp;nil,&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5043160">//&nbsp;fixed&nbsp;distance&nbsp;encoding&nbsp;associated&nbsp;with&nbsp;fixed&nbsp;Huffman&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="5043225">func</span>&nbsp;<span class="op" id="5043230">(</span><span class="ident" id="5043231">f</span>&nbsp;<span class="op" id="5043233">*</span><span class="ident" id="5043234">decompressor</span><span class="op" id="5043246">)</span>&nbsp;<span class="ident" id="5043248">huffmanBlock</span><span class="op" id="5043260">(</span><span class="op" id="5043261">)</span>&nbsp;<span class="op" id="5043263">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043266">for</span>&nbsp;<span class="op" id="5043270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043274">v</span><span class="op" id="5043275">,</span>&nbsp;<span class="ident" id="5043277">err</span>&nbsp;<span class="op" id="5043281">:=</span>&nbsp;<span class="ident" id="5043284">f</span><span class="op" id="5043285">.</span><span class="ident" id="5043286">huffSym</span><span class="op" id="5043293">(</span><span class="ident" id="5043294">f</span><span class="op" id="5043295">.</span><span class="ident" id="5043296">hl</span><span class="op" id="5043298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043302">if</span>&nbsp;<span class="ident" id="5043305">err</span>&nbsp;<span class="op" id="5043309">!=</span>&nbsp;<span class="ident" id="5043312">nil</span>&nbsp;<span class="op" id="5043316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043321">f</span><span class="op" id="5043322">.</span><span class="ident" id="5043323">err</span>&nbsp;<span class="op" id="5043327">=</span>&nbsp;<span class="ident" id="5043329">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043336">return</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043349">var</span>&nbsp;<span class="ident" id="5043353">n</span>&nbsp;<span class="builtintype" id="5043355">uint</span>&nbsp;<span class="comment" id="5043360">//&nbsp;number&nbsp;of&nbsp;bits&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043386">var</span>&nbsp;<span class="ident" id="5043390">length</span>&nbsp;<span class="builtintype" id="5043397">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043403">switch</span>&nbsp;<span class="op" id="5043410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043414">case</span>&nbsp;<span class="ident" id="5043419">v</span>&nbsp;<span class="op" id="5043421">&lt;</span>&nbsp;<span class="num" id="5043423">256</span><span class="op" id="5043426">:</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043431">f</span><span class="op" id="5043432">.</span><span class="ident" id="5043433">hist</span><span class="op" id="5043437">[</span><span class="ident" id="5043438">f</span><span class="op" id="5043439">.</span><span class="ident" id="5043440">hp</span><span class="op" id="5043442">]</span>&nbsp;<span class="op" id="5043444">=</span>&nbsp;<span class="builtintype" id="5043446">byte</span><span class="op" id="5043450">(</span><span class="ident" id="5043451">v</span><span class="op" id="5043452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043457">f</span><span class="op" id="5043458">.</span><span class="ident" id="5043459">hp</span><span class="op" id="5043461">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043467">if</span>&nbsp;<span class="ident" id="5043470">f</span><span class="op" id="5043471">.</span><span class="ident" id="5043472">hp</span>&nbsp;<span class="op" id="5043475">==</span>&nbsp;<span class="builtinfunc" id="5043478">len</span><span class="op" id="5043481">(</span><span class="ident" id="5043482">f</span><span class="op" id="5043483">.</span><span class="ident" id="5043484">hist</span><span class="op" id="5043488">)</span>&nbsp;<span class="op" id="5043490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043496">//&nbsp;After&nbsp;the&nbsp;flush,&nbsp;continue&nbsp;this&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043540">f</span><span class="op" id="5043541">.</span><span class="ident" id="5043542">flush</span><span class="op" id="5043547">(</span><span class="op" id="5043548">(</span><span class="op" id="5043549">*</span><span class="ident" id="5043550">decompressor</span><span class="op" id="5043562">)</span><span class="op" id="5043563">.</span><span class="ident" id="5043564">huffmanBlock</span><span class="op" id="5043576">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043582">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5043592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043597">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043608">case</span>&nbsp;<span class="ident" id="5043613">v</span>&nbsp;<span class="op" id="5043615">==</span>&nbsp;<span class="num" id="5043618">256</span><span class="op" id="5043621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043626">//&nbsp;Done&nbsp;with&nbsp;huffman&nbsp;block;&nbsp;read&nbsp;next&nbsp;block.</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043674">f</span><span class="op" id="5043675">.</span><span class="ident" id="5043676">step</span>&nbsp;<span class="op" id="5043681">=</span>&nbsp;<span class="op" id="5043683">(</span><span class="op" id="5043684">*</span><span class="ident" id="5043685">decompressor</span><span class="op" id="5043697">)</span><span class="op" id="5043698">.</span><span class="ident" id="5043699">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043712">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5043721">//&nbsp;otherwise,&nbsp;reference&nbsp;to&nbsp;older&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043761">case</span>&nbsp;<span class="ident" id="5043766">v</span>&nbsp;<span class="op" id="5043768">&lt;</span>&nbsp;<span class="num" id="5043770">265</span><span class="op" id="5043773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043778">length</span>&nbsp;<span class="op" id="5043785">=</span>&nbsp;<span class="ident" id="5043787">v</span>&nbsp;<span class="op" id="5043789">-</span>&nbsp;<span class="op" id="5043791">(</span><span class="num" id="5043792">257</span>&nbsp;<span class="op" id="5043796">-</span>&nbsp;<span class="num" id="5043798">3</span><span class="op" id="5043799">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043804">n</span>&nbsp;<span class="op" id="5043806">=</span>&nbsp;<span class="num" id="5043808">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043812">case</span>&nbsp;<span class="ident" id="5043817">v</span>&nbsp;<span class="op" id="5043819">&lt;</span>&nbsp;<span class="num" id="5043821">269</span><span class="op" id="5043824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043829">length</span>&nbsp;<span class="op" id="5043836">=</span>&nbsp;<span class="ident" id="5043838">v</span><span class="op" id="5043839">*</span><span class="num" id="5043840">2</span>&nbsp;<span class="op" id="5043842">-</span>&nbsp;<span class="op" id="5043844">(</span><span class="num" id="5043845">265</span><span class="op" id="5043848">*</span><span class="num" id="5043849">2</span>&nbsp;<span class="op" id="5043851">-</span>&nbsp;<span class="num" id="5043853">11</span><span class="op" id="5043855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043860">n</span>&nbsp;<span class="op" id="5043862">=</span>&nbsp;<span class="num" id="5043864">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043868">case</span>&nbsp;<span class="ident" id="5043873">v</span>&nbsp;<span class="op" id="5043875">&lt;</span>&nbsp;<span class="num" id="5043877">273</span><span class="op" id="5043880">:</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043885">length</span>&nbsp;<span class="op" id="5043892">=</span>&nbsp;<span class="ident" id="5043894">v</span><span class="op" id="5043895">*</span><span class="num" id="5043896">4</span>&nbsp;<span class="op" id="5043898">-</span>&nbsp;<span class="op" id="5043900">(</span><span class="num" id="5043901">269</span><span class="op" id="5043904">*</span><span class="num" id="5043905">4</span>&nbsp;<span class="op" id="5043907">-</span>&nbsp;<span class="num" id="5043909">19</span><span class="op" id="5043911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043916">n</span>&nbsp;<span class="op" id="5043918">=</span>&nbsp;<span class="num" id="5043920">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043924">case</span>&nbsp;<span class="ident" id="5043929">v</span>&nbsp;<span class="op" id="5043931">&lt;</span>&nbsp;<span class="num" id="5043933">277</span><span class="op" id="5043936">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043941">length</span>&nbsp;<span class="op" id="5043948">=</span>&nbsp;<span class="ident" id="5043950">v</span><span class="op" id="5043951">*</span><span class="num" id="5043952">8</span>&nbsp;<span class="op" id="5043954">-</span>&nbsp;<span class="op" id="5043956">(</span><span class="num" id="5043957">273</span><span class="op" id="5043960">*</span><span class="num" id="5043961">8</span>&nbsp;<span class="op" id="5043963">-</span>&nbsp;<span class="num" id="5043965">35</span><span class="op" id="5043967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043972">n</span>&nbsp;<span class="op" id="5043974">=</span>&nbsp;<span class="num" id="5043976">3</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5043980">case</span>&nbsp;<span class="ident" id="5043985">v</span>&nbsp;<span class="op" id="5043987">&lt;</span>&nbsp;<span class="num" id="5043989">281</span><span class="op" id="5043992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5043997">length</span>&nbsp;<span class="op" id="5044004">=</span>&nbsp;<span class="ident" id="5044006">v</span><span class="op" id="5044007">*</span><span class="num" id="5044008">16</span>&nbsp;<span class="op" id="5044011">-</span>&nbsp;<span class="op" id="5044013">(</span><span class="num" id="5044014">277</span><span class="op" id="5044017">*</span><span class="num" id="5044018">16</span>&nbsp;<span class="op" id="5044021">-</span>&nbsp;<span class="num" id="5044023">67</span><span class="op" id="5044025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044030">n</span>&nbsp;<span class="op" id="5044032">=</span>&nbsp;<span class="num" id="5044034">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044038">case</span>&nbsp;<span class="ident" id="5044043">v</span>&nbsp;<span class="op" id="5044045">&lt;</span>&nbsp;<span class="num" id="5044047">285</span><span class="op" id="5044050">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044055">length</span>&nbsp;<span class="op" id="5044062">=</span>&nbsp;<span class="ident" id="5044064">v</span><span class="op" id="5044065">*</span><span class="num" id="5044066">32</span>&nbsp;<span class="op" id="5044069">-</span>&nbsp;<span class="op" id="5044071">(</span><span class="num" id="5044072">281</span><span class="op" id="5044075">*</span><span class="num" id="5044076">32</span>&nbsp;<span class="op" id="5044079">-</span>&nbsp;<span class="num" id="5044081">131</span><span class="op" id="5044084">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044089">n</span>&nbsp;<span class="op" id="5044091">=</span>&nbsp;<span class="num" id="5044093">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044097">default</span><span class="op" id="5044104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044109">length</span>&nbsp;<span class="op" id="5044116">=</span>&nbsp;<span class="num" id="5044118">258</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044125">n</span>&nbsp;<span class="op" id="5044127">=</span>&nbsp;<span class="num" id="5044129">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044133">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044137">if</span>&nbsp;<span class="ident" id="5044140">n</span>&nbsp;<span class="op" id="5044142">&gt;</span>&nbsp;<span class="num" id="5044144">0</span>&nbsp;<span class="op" id="5044146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044151">for</span>&nbsp;<span class="ident" id="5044155">f</span><span class="op" id="5044156">.</span><span class="ident" id="5044157">nb</span>&nbsp;<span class="op" id="5044160">&lt;</span>&nbsp;<span class="ident" id="5044162">n</span>&nbsp;<span class="op" id="5044164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044170">if</span>&nbsp;<span class="ident" id="5044173">err</span>&nbsp;<span class="op" id="5044177">=</span>&nbsp;<span class="ident" id="5044179">f</span><span class="op" id="5044180">.</span><span class="ident" id="5044181">moreBits</span><span class="op" id="5044189">(</span><span class="op" id="5044190">)</span><span class="op" id="5044191">;</span>&nbsp;<span class="ident" id="5044193">err</span>&nbsp;<span class="op" id="5044197">!=</span>&nbsp;<span class="ident" id="5044200">nil</span>&nbsp;<span class="op" id="5044204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044211">f</span><span class="op" id="5044212">.</span><span class="ident" id="5044213">err</span>&nbsp;<span class="op" id="5044217">=</span>&nbsp;<span class="ident" id="5044219">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044228">return</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044249">length</span>&nbsp;<span class="op" id="5044256">+=</span>&nbsp;<span class="builtintype" id="5044259">int</span><span class="op" id="5044262">(</span><span class="ident" id="5044263">f</span><span class="op" id="5044264">.</span><span class="ident" id="5044265">b</span>&nbsp;<span class="op" id="5044267">&amp;</span>&nbsp;<span class="builtintype" id="5044269">uint32</span><span class="op" id="5044275">(</span><span class="num" id="5044276">1</span><span class="op" id="5044277">&lt;&lt;</span><span class="ident" id="5044279">n</span><span class="op" id="5044280">-</span><span class="num" id="5044281">1</span><span class="op" id="5044282">)</span><span class="op" id="5044283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044288">f</span><span class="op" id="5044289">.</span><span class="ident" id="5044290">b</span>&nbsp;<span class="op" id="5044292">&gt;&gt;=</span>&nbsp;<span class="ident" id="5044296">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044301">f</span><span class="op" id="5044302">.</span><span class="ident" id="5044303">nb</span>&nbsp;<span class="op" id="5044306">-=</span>&nbsp;<span class="ident" id="5044309">n</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044318">var</span>&nbsp;<span class="ident" id="5044322">dist</span>&nbsp;<span class="builtintype" id="5044327">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044333">if</span>&nbsp;<span class="ident" id="5044336">f</span><span class="op" id="5044337">.</span><span class="ident" id="5044338">hd</span>&nbsp;<span class="op" id="5044341">==</span>&nbsp;<span class="ident" id="5044344">nil</span>&nbsp;<span class="op" id="5044348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044353">for</span>&nbsp;<span class="ident" id="5044357">f</span><span class="op" id="5044358">.</span><span class="ident" id="5044359">nb</span>&nbsp;<span class="op" id="5044362">&lt;</span>&nbsp;<span class="num" id="5044364">5</span>&nbsp;<span class="op" id="5044366">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044372">if</span>&nbsp;<span class="ident" id="5044375">err</span>&nbsp;<span class="op" id="5044379">=</span>&nbsp;<span class="ident" id="5044381">f</span><span class="op" id="5044382">.</span><span class="ident" id="5044383">moreBits</span><span class="op" id="5044391">(</span><span class="op" id="5044392">)</span><span class="op" id="5044393">;</span>&nbsp;<span class="ident" id="5044395">err</span>&nbsp;<span class="op" id="5044399">!=</span>&nbsp;<span class="ident" id="5044402">nil</span>&nbsp;<span class="op" id="5044406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044413">f</span><span class="op" id="5044414">.</span><span class="ident" id="5044415">err</span>&nbsp;<span class="op" id="5044419">=</span>&nbsp;<span class="ident" id="5044421">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044430">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044446">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044451">dist</span>&nbsp;<span class="op" id="5044456">=</span>&nbsp;<span class="builtintype" id="5044458">int</span><span class="op" id="5044461">(</span><span class="ident" id="5044462">reverseByte</span><span class="op" id="5044473">[</span><span class="op" id="5044474">(</span><span class="ident" id="5044475">f</span><span class="op" id="5044476">.</span><span class="ident" id="5044477">b</span><span class="op" id="5044478">&amp;</span><span class="num" id="5044479">0x1F</span><span class="op" id="5044483">)</span><span class="op" id="5044484">&lt;&lt;</span><span class="num" id="5044486">3</span><span class="op" id="5044487">]</span><span class="op" id="5044488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044493">f</span><span class="op" id="5044494">.</span><span class="ident" id="5044495">b</span>&nbsp;<span class="op" id="5044497">&gt;&gt;=</span>&nbsp;<span class="num" id="5044501">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044506">f</span><span class="op" id="5044507">.</span><span class="ident" id="5044508">nb</span>&nbsp;<span class="op" id="5044511">-=</span>&nbsp;<span class="num" id="5044514">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044518">}</span>&nbsp;<span class="keyword" id="5044520">else</span>&nbsp;<span class="op" id="5044525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044530">if</span>&nbsp;<span class="ident" id="5044533">dist</span><span class="op" id="5044537">,</span>&nbsp;<span class="ident" id="5044539">err</span>&nbsp;<span class="op" id="5044543">=</span>&nbsp;<span class="ident" id="5044545">f</span><span class="op" id="5044546">.</span><span class="ident" id="5044547">huffSym</span><span class="op" id="5044554">(</span><span class="ident" id="5044555">f</span><span class="op" id="5044556">.</span><span class="ident" id="5044557">hd</span><span class="op" id="5044559">)</span><span class="op" id="5044560">;</span>&nbsp;<span class="ident" id="5044562">err</span>&nbsp;<span class="op" id="5044566">!=</span>&nbsp;<span class="ident" id="5044569">nil</span>&nbsp;<span class="op" id="5044573">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044579">f</span><span class="op" id="5044580">.</span><span class="ident" id="5044581">err</span>&nbsp;<span class="op" id="5044585">=</span>&nbsp;<span class="ident" id="5044587">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044595">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044614">switch</span>&nbsp;<span class="op" id="5044621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044625">case</span>&nbsp;<span class="ident" id="5044630">dist</span>&nbsp;<span class="op" id="5044635">&lt;</span>&nbsp;<span class="num" id="5044637">4</span><span class="op" id="5044638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044643">dist</span><span class="op" id="5044647">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044652">case</span>&nbsp;<span class="ident" id="5044657">dist</span>&nbsp;<span class="op" id="5044662">&gt;=</span>&nbsp;<span class="num" id="5044665">30</span><span class="op" id="5044667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044672">f</span><span class="op" id="5044673">.</span><span class="ident" id="5044674">err</span>&nbsp;<span class="op" id="5044678">=</span>&nbsp;<span class="ident" id="5044680">CorruptInputError</span><span class="op" id="5044697">(</span><span class="ident" id="5044698">f</span><span class="op" id="5044699">.</span><span class="ident" id="5044700">roffset</span><span class="op" id="5044707">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044712">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044721">default</span><span class="op" id="5044728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044733">nb</span>&nbsp;<span class="op" id="5044736">:=</span>&nbsp;<span class="builtintype" id="5044739">uint</span><span class="op" id="5044743">(</span><span class="ident" id="5044744">dist</span><span class="op" id="5044748">-</span><span class="num" id="5044749">2</span><span class="op" id="5044750">)</span>&nbsp;<span class="op" id="5044752">&gt;&gt;</span>&nbsp;<span class="num" id="5044755">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5044760">//&nbsp;have&nbsp;1&nbsp;bit&nbsp;in&nbsp;bottom&nbsp;of&nbsp;dist,&nbsp;need&nbsp;nb&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044810">extra</span>&nbsp;<span class="op" id="5044816">:=</span>&nbsp;<span class="op" id="5044819">(</span><span class="ident" id="5044820">dist</span>&nbsp;<span class="op" id="5044825">&amp;</span>&nbsp;<span class="num" id="5044827">1</span><span class="op" id="5044828">)</span>&nbsp;<span class="op" id="5044830">&lt;&lt;</span>&nbsp;<span class="ident" id="5044833">nb</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044839">for</span>&nbsp;<span class="ident" id="5044843">f</span><span class="op" id="5044844">.</span><span class="ident" id="5044845">nb</span>&nbsp;<span class="op" id="5044848">&lt;</span>&nbsp;<span class="ident" id="5044850">nb</span>&nbsp;<span class="op" id="5044853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044859">if</span>&nbsp;<span class="ident" id="5044862">err</span>&nbsp;<span class="op" id="5044866">=</span>&nbsp;<span class="ident" id="5044868">f</span><span class="op" id="5044869">.</span><span class="ident" id="5044870">moreBits</span><span class="op" id="5044878">(</span><span class="op" id="5044879">)</span><span class="op" id="5044880">;</span>&nbsp;<span class="ident" id="5044882">err</span>&nbsp;<span class="op" id="5044886">!=</span>&nbsp;<span class="ident" id="5044889">nil</span>&nbsp;<span class="op" id="5044893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044900">f</span><span class="op" id="5044901">.</span><span class="ident" id="5044902">err</span>&nbsp;<span class="op" id="5044906">=</span>&nbsp;<span class="ident" id="5044908">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5044917">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044928">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5044933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044938">extra</span>&nbsp;<span class="op" id="5044944">|=</span>&nbsp;<span class="builtintype" id="5044947">int</span><span class="op" id="5044950">(</span><span class="ident" id="5044951">f</span><span class="op" id="5044952">.</span><span class="ident" id="5044953">b</span>&nbsp;<span class="op" id="5044955">&amp;</span>&nbsp;<span class="builtintype" id="5044957">uint32</span><span class="op" id="5044963">(</span><span class="num" id="5044964">1</span><span class="op" id="5044965">&lt;&lt;</span><span class="ident" id="5044967">nb</span><span class="op" id="5044969">-</span><span class="num" id="5044970">1</span><span class="op" id="5044971">)</span><span class="op" id="5044972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044977">f</span><span class="op" id="5044978">.</span><span class="ident" id="5044979">b</span>&nbsp;<span class="op" id="5044981">&gt;&gt;=</span>&nbsp;<span class="ident" id="5044985">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5044991">f</span><span class="op" id="5044992">.</span><span class="ident" id="5044993">nb</span>&nbsp;<span class="op" id="5044996">-=</span>&nbsp;<span class="ident" id="5044999">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045005">dist</span>&nbsp;<span class="op" id="5045010">=</span>&nbsp;<span class="num" id="5045012">1</span><span class="op" id="5045013">&lt;&lt;</span><span class="op" id="5045015">(</span><span class="ident" id="5045016">nb</span><span class="op" id="5045018">+</span><span class="num" id="5045019">1</span><span class="op" id="5045020">)</span>&nbsp;<span class="op" id="5045022">+</span>&nbsp;<span class="num" id="5045024">1</span>&nbsp;<span class="op" id="5045026">+</span>&nbsp;<span class="ident" id="5045028">extra</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5045041">//&nbsp;Copy&nbsp;history[-dist:-dist+length]&nbsp;into&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045092">if</span>&nbsp;<span class="ident" id="5045095">dist</span>&nbsp;<span class="op" id="5045100">&gt;</span>&nbsp;<span class="builtinfunc" id="5045102">len</span><span class="op" id="5045105">(</span><span class="ident" id="5045106">f</span><span class="op" id="5045107">.</span><span class="ident" id="5045108">hist</span><span class="op" id="5045112">)</span>&nbsp;<span class="op" id="5045114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045119">f</span><span class="op" id="5045120">.</span><span class="ident" id="5045121">err</span>&nbsp;<span class="op" id="5045125">=</span>&nbsp;<span class="ident" id="5045127">InternalError</span><span class="op" id="5045140">(</span><span class="string" id="5045141">&#34;bad&nbsp;history&nbsp;distance&#34;</span><span class="op" id="5045163">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045168">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5045182">//&nbsp;No&nbsp;check&nbsp;on&nbsp;length;&nbsp;encoding&nbsp;can&nbsp;be&nbsp;prescient.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045234">if</span>&nbsp;<span class="op" id="5045237">!</span><span class="ident" id="5045238">f</span><span class="op" id="5045239">.</span><span class="ident" id="5045240">hfull</span>&nbsp;<span class="op" id="5045246">&amp;&amp;</span>&nbsp;<span class="ident" id="5045249">dist</span>&nbsp;<span class="op" id="5045254">&gt;</span>&nbsp;<span class="ident" id="5045256">f</span><span class="op" id="5045257">.</span><span class="ident" id="5045258">hp</span>&nbsp;<span class="op" id="5045261">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045266">f</span><span class="op" id="5045267">.</span><span class="ident" id="5045268">err</span>&nbsp;<span class="op" id="5045272">=</span>&nbsp;<span class="ident" id="5045274">CorruptInputError</span><span class="op" id="5045291">(</span><span class="ident" id="5045292">f</span><span class="op" id="5045293">.</span><span class="ident" id="5045294">roffset</span><span class="op" id="5045301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045306">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045320">f</span><span class="op" id="5045321">.</span><span class="ident" id="5045322">copyLen</span><span class="op" id="5045329">,</span>&nbsp;<span class="ident" id="5045331">f</span><span class="op" id="5045332">.</span><span class="ident" id="5045333">copyDist</span>&nbsp;<span class="op" id="5045342">=</span>&nbsp;<span class="ident" id="5045344">length</span><span class="op" id="5045350">,</span>&nbsp;<span class="ident" id="5045352">dist</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045359">if</span>&nbsp;<span class="ident" id="5045362">f</span><span class="op" id="5045363">.</span><span class="ident" id="5045364">copyHist</span><span class="op" id="5045372">(</span><span class="op" id="5045373">)</span>&nbsp;<span class="op" id="5045375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045380">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045392">}</span><br>
<span class="lineno"></span><span class="op" id="5045394">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span><span class="comment" id="5045397">//&nbsp;copyHist&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;f.hist&nbsp;(f.copyDist&nbsp;bytes&nbsp;ago)&nbsp;to&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="5045478">//&nbsp;It&nbsp;reports&nbsp;whether&nbsp;the&nbsp;f.hist&nbsp;buffer&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="5045527">func</span>&nbsp;<span class="op" id="5045532">(</span><span class="ident" id="5045533">f</span>&nbsp;<span class="op" id="5045535">*</span><span class="ident" id="5045536">decompressor</span><span class="op" id="5045548">)</span>&nbsp;<span class="ident" id="5045550">copyHist</span><span class="op" id="5045558">(</span><span class="op" id="5045559">)</span>&nbsp;<span class="builtintype" id="5045561">bool</span>&nbsp;<span class="op" id="5045566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045569">p</span>&nbsp;<span class="op" id="5045571">:=</span>&nbsp;<span class="ident" id="5045574">f</span><span class="op" id="5045575">.</span><span class="ident" id="5045576">hp</span>&nbsp;<span class="op" id="5045579">-</span>&nbsp;<span class="ident" id="5045581">f</span><span class="op" id="5045582">.</span><span class="ident" id="5045583">copyDist</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045593">if</span>&nbsp;<span class="ident" id="5045596">p</span>&nbsp;<span class="op" id="5045598">&lt;</span>&nbsp;<span class="num" id="5045600">0</span>&nbsp;<span class="op" id="5045602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045606">p</span>&nbsp;<span class="op" id="5045608">+=</span>&nbsp;<span class="builtinfunc" id="5045611">len</span><span class="op" id="5045614">(</span><span class="ident" id="5045615">f</span><span class="op" id="5045616">.</span><span class="ident" id="5045617">hist</span><span class="op" id="5045621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045627">for</span>&nbsp;<span class="ident" id="5045631">f</span><span class="op" id="5045632">.</span><span class="ident" id="5045633">copyLen</span>&nbsp;<span class="op" id="5045641">&gt;</span>&nbsp;<span class="num" id="5045643">0</span>&nbsp;<span class="op" id="5045645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045649">n</span>&nbsp;<span class="op" id="5045651">:=</span>&nbsp;<span class="ident" id="5045654">f</span><span class="op" id="5045655">.</span><span class="ident" id="5045656">copyLen</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045666">if</span>&nbsp;<span class="ident" id="5045669">x</span>&nbsp;<span class="op" id="5045671">:=</span>&nbsp;<span class="builtinfunc" id="5045674">len</span><span class="op" id="5045677">(</span><span class="ident" id="5045678">f</span><span class="op" id="5045679">.</span><span class="ident" id="5045680">hist</span><span class="op" id="5045684">)</span>&nbsp;<span class="op" id="5045686">-</span>&nbsp;<span class="ident" id="5045688">f</span><span class="op" id="5045689">.</span><span class="ident" id="5045690">hp</span><span class="op" id="5045692">;</span>&nbsp;<span class="ident" id="5045694">n</span>&nbsp;<span class="op" id="5045696">&gt;</span>&nbsp;<span class="ident" id="5045698">x</span>&nbsp;<span class="op" id="5045700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045705">n</span>&nbsp;<span class="op" id="5045707">=</span>&nbsp;<span class="ident" id="5045709">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045717">if</span>&nbsp;<span class="ident" id="5045720">x</span>&nbsp;<span class="op" id="5045722">:=</span>&nbsp;<span class="builtinfunc" id="5045725">len</span><span class="op" id="5045728">(</span><span class="ident" id="5045729">f</span><span class="op" id="5045730">.</span><span class="ident" id="5045731">hist</span><span class="op" id="5045735">)</span>&nbsp;<span class="op" id="5045737">-</span>&nbsp;<span class="ident" id="5045739">p</span><span class="op" id="5045740">;</span>&nbsp;<span class="ident" id="5045742">n</span>&nbsp;<span class="op" id="5045744">&gt;</span>&nbsp;<span class="ident" id="5045746">x</span>&nbsp;<span class="op" id="5045748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045753">n</span>&nbsp;<span class="op" id="5045755">=</span>&nbsp;<span class="ident" id="5045757">x</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045765">forwardCopy</span><span class="op" id="5045776">(</span><span class="ident" id="5045777">f</span><span class="op" id="5045778">.</span><span class="ident" id="5045779">hist</span><span class="op" id="5045783">[</span><span class="op" id="5045784">:</span><span class="op" id="5045785">]</span><span class="op" id="5045786">,</span>&nbsp;<span class="ident" id="5045788">f</span><span class="op" id="5045789">.</span><span class="ident" id="5045790">hp</span><span class="op" id="5045792">,</span>&nbsp;<span class="ident" id="5045794">p</span><span class="op" id="5045795">,</span>&nbsp;<span class="ident" id="5045797">n</span><span class="op" id="5045798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045802">p</span>&nbsp;<span class="op" id="5045804">+=</span>&nbsp;<span class="ident" id="5045807">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045811">f</span><span class="op" id="5045812">.</span><span class="ident" id="5045813">hp</span>&nbsp;<span class="op" id="5045816">+=</span>&nbsp;<span class="ident" id="5045819">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045823">f</span><span class="op" id="5045824">.</span><span class="ident" id="5045825">copyLen</span>&nbsp;<span class="op" id="5045833">-=</span>&nbsp;<span class="ident" id="5045836">n</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045840">if</span>&nbsp;<span class="ident" id="5045843">f</span><span class="op" id="5045844">.</span><span class="ident" id="5045845">hp</span>&nbsp;<span class="op" id="5045848">==</span>&nbsp;<span class="builtinfunc" id="5045851">len</span><span class="op" id="5045854">(</span><span class="ident" id="5045855">f</span><span class="op" id="5045856">.</span><span class="ident" id="5045857">hist</span><span class="op" id="5045861">)</span>&nbsp;<span class="op" id="5045863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5045868">//&nbsp;After&nbsp;flush&nbsp;continue&nbsp;copying&nbsp;out&nbsp;of&nbsp;history.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045919">f</span><span class="op" id="5045920">.</span><span class="ident" id="5045921">flush</span><span class="op" id="5045926">(</span><span class="op" id="5045927">(</span><span class="op" id="5045928">*</span><span class="ident" id="5045929">decompressor</span><span class="op" id="5045941">)</span><span class="op" id="5045942">.</span><span class="ident" id="5045943">copyHuff</span><span class="op" id="5045951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045956">return</span>&nbsp;<span class="builtintype" id="5045963">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5045970">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5045974">if</span>&nbsp;<span class="ident" id="5045977">p</span>&nbsp;<span class="op" id="5045979">==</span>&nbsp;<span class="builtinfunc" id="5045982">len</span><span class="op" id="5045985">(</span><span class="ident" id="5045986">f</span><span class="op" id="5045987">.</span><span class="ident" id="5045988">hist</span><span class="op" id="5045992">)</span>&nbsp;<span class="op" id="5045994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5045999">p</span>&nbsp;<span class="op" id="5046001">=</span>&nbsp;<span class="num" id="5046003">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046013">return</span>&nbsp;<span class="builtintype" id="5046020">false</span><br>
<span class="lineno">550</span><span class="op" id="5046026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5046029">func</span>&nbsp;<span class="op" id="5046034">(</span><span class="ident" id="5046035">f</span>&nbsp;<span class="op" id="5046037">*</span><span class="ident" id="5046038">decompressor</span><span class="op" id="5046050">)</span>&nbsp;<span class="ident" id="5046052">copyHuff</span><span class="op" id="5046060">(</span><span class="op" id="5046061">)</span>&nbsp;<span class="op" id="5046063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046066">if</span>&nbsp;<span class="ident" id="5046069">f</span><span class="op" id="5046070">.</span><span class="ident" id="5046071">copyHist</span><span class="op" id="5046079">(</span><span class="op" id="5046080">)</span>&nbsp;<span class="op" id="5046082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046086">return</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046097">f</span><span class="op" id="5046098">.</span><span class="ident" id="5046099">huffmanBlock</span><span class="op" id="5046111">(</span><span class="op" id="5046112">)</span><br>
<span class="lineno"></span><span class="op" id="5046114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5046117">//&nbsp;Copy&nbsp;a&nbsp;single&nbsp;uncompressed&nbsp;data&nbsp;block&nbsp;from&nbsp;input&nbsp;to&nbsp;output.</span><br>
<span class="lineno">560</span><span class="keyword" id="5046180">func</span>&nbsp;<span class="op" id="5046185">(</span><span class="ident" id="5046186">f</span>&nbsp;<span class="op" id="5046188">*</span><span class="ident" id="5046189">decompressor</span><span class="op" id="5046201">)</span>&nbsp;<span class="ident" id="5046203">dataBlock</span><span class="op" id="5046212">(</span><span class="op" id="5046213">)</span>&nbsp;<span class="op" id="5046215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046218">//&nbsp;Uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046236">//&nbsp;Discard&nbsp;current&nbsp;half-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046267">f</span><span class="op" id="5046268">.</span><span class="ident" id="5046269">nb</span>&nbsp;<span class="op" id="5046272">=</span>&nbsp;<span class="num" id="5046274">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046277">f</span><span class="op" id="5046278">.</span><span class="ident" id="5046279">b</span>&nbsp;<span class="op" id="5046281">=</span>&nbsp;<span class="num" id="5046283">0</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046287">//&nbsp;Length&nbsp;then&nbsp;ones-complement&nbsp;of&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046330">nr</span><span class="op" id="5046332">,</span>&nbsp;<span class="ident" id="5046334">err</span>&nbsp;<span class="op" id="5046338">:=</span>&nbsp;<span class="ident" id="5046341">io</span><span class="op" id="5046343">.</span><span class="ident" id="5046344">ReadFull</span><span class="op" id="5046352">(</span><span class="ident" id="5046353">f</span><span class="op" id="5046354">.</span><span class="ident" id="5046355">r</span><span class="op" id="5046356">,</span>&nbsp;<span class="ident" id="5046358">f</span><span class="op" id="5046359">.</span><span class="ident" id="5046360">buf</span><span class="op" id="5046363">[</span><span class="num" id="5046364">0</span><span class="op" id="5046365">:</span><span class="num" id="5046366">4</span><span class="op" id="5046367">]</span><span class="op" id="5046368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046371">f</span><span class="op" id="5046372">.</span><span class="ident" id="5046373">roffset</span>&nbsp;<span class="op" id="5046381">+=</span>&nbsp;<span class="ident" id="5046384">int64</span><span class="op" id="5046389">(</span><span class="ident" id="5046390">nr</span><span class="op" id="5046392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046395">if</span>&nbsp;<span class="ident" id="5046398">err</span>&nbsp;<span class="op" id="5046402">!=</span>&nbsp;<span class="ident" id="5046405">nil</span>&nbsp;<span class="op" id="5046409">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046413">f</span><span class="op" id="5046414">.</span><span class="ident" id="5046415">err</span>&nbsp;<span class="op" id="5046419">=</span>&nbsp;<span class="op" id="5046421">&amp;</span><span class="ident" id="5046422">ReadError</span><span class="op" id="5046431">{</span><span class="ident" id="5046432">f</span><span class="op" id="5046433">.</span><span class="ident" id="5046434">roffset</span><span class="op" id="5046441">,</span>&nbsp;<span class="ident" id="5046443">err</span><span class="op" id="5046446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046461">n</span>&nbsp;<span class="op" id="5046463">:=</span>&nbsp;<span class="builtintype" id="5046466">int</span><span class="op" id="5046469">(</span><span class="ident" id="5046470">f</span><span class="op" id="5046471">.</span><span class="ident" id="5046472">buf</span><span class="op" id="5046475">[</span><span class="num" id="5046476">0</span><span class="op" id="5046477">]</span><span class="op" id="5046478">)</span>&nbsp;<span class="op" id="5046480">|</span>&nbsp;<span class="builtintype" id="5046482">int</span><span class="op" id="5046485">(</span><span class="ident" id="5046486">f</span><span class="op" id="5046487">.</span><span class="ident" id="5046488">buf</span><span class="op" id="5046491">[</span><span class="num" id="5046492">1</span><span class="op" id="5046493">]</span><span class="op" id="5046494">)</span><span class="op" id="5046495">&lt;&lt;</span><span class="num" id="5046497">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046500">nn</span>&nbsp;<span class="op" id="5046503">:=</span>&nbsp;<span class="builtintype" id="5046506">int</span><span class="op" id="5046509">(</span><span class="ident" id="5046510">f</span><span class="op" id="5046511">.</span><span class="ident" id="5046512">buf</span><span class="op" id="5046515">[</span><span class="num" id="5046516">2</span><span class="op" id="5046517">]</span><span class="op" id="5046518">)</span>&nbsp;<span class="op" id="5046520">|</span>&nbsp;<span class="builtintype" id="5046522">int</span><span class="op" id="5046525">(</span><span class="ident" id="5046526">f</span><span class="op" id="5046527">.</span><span class="ident" id="5046528">buf</span><span class="op" id="5046531">[</span><span class="num" id="5046532">3</span><span class="op" id="5046533">]</span><span class="op" id="5046534">)</span><span class="op" id="5046535">&lt;&lt;</span><span class="num" id="5046537">8</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046540">if</span>&nbsp;<span class="builtintype" id="5046543">uint16</span><span class="op" id="5046549">(</span><span class="ident" id="5046550">nn</span><span class="op" id="5046552">)</span>&nbsp;<span class="op" id="5046554">!=</span>&nbsp;<span class="builtintype" id="5046557">uint16</span><span class="op" id="5046563">(</span><span class="op" id="5046564">^</span><span class="ident" id="5046565">n</span><span class="op" id="5046566">)</span>&nbsp;<span class="op" id="5046568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046572">f</span><span class="op" id="5046573">.</span><span class="ident" id="5046574">err</span>&nbsp;<span class="op" id="5046578">=</span>&nbsp;<span class="ident" id="5046580">CorruptInputError</span><span class="op" id="5046597">(</span><span class="ident" id="5046598">f</span><span class="op" id="5046599">.</span><span class="ident" id="5046600">roffset</span><span class="op" id="5046607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046611">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046623">if</span>&nbsp;<span class="ident" id="5046626">n</span>&nbsp;<span class="op" id="5046628">==</span>&nbsp;<span class="num" id="5046631">0</span>&nbsp;<span class="op" id="5046633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5046637">//&nbsp;0-length&nbsp;block&nbsp;means&nbsp;sync</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046668">f</span><span class="op" id="5046669">.</span><span class="ident" id="5046670">flush</span><span class="op" id="5046675">(</span><span class="op" id="5046676">(</span><span class="op" id="5046677">*</span><span class="ident" id="5046678">decompressor</span><span class="op" id="5046690">)</span><span class="op" id="5046691">.</span><span class="ident" id="5046692">nextBlock</span><span class="op" id="5046701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046705">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046713">}</span><br>
<span class="lineno">585</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046717">f</span><span class="op" id="5046718">.</span><span class="ident" id="5046719">copyLen</span>&nbsp;<span class="op" id="5046727">=</span>&nbsp;<span class="ident" id="5046729">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046732">f</span><span class="op" id="5046733">.</span><span class="ident" id="5046734">copyData</span><span class="op" id="5046742">(</span><span class="op" id="5046743">)</span><br>
<span class="lineno"></span><span class="op" id="5046745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="5046748">//&nbsp;copyData&nbsp;copies&nbsp;f.copyLen&nbsp;bytes&nbsp;from&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;into&nbsp;f.hist.</span><br>
<span class="lineno"></span><span class="comment" id="5046823">//&nbsp;It&nbsp;pauses&nbsp;for&nbsp;reads&nbsp;when&nbsp;f.hist&nbsp;is&nbsp;full.</span><br>
<span class="lineno"></span><span class="keyword" id="5046867">func</span>&nbsp;<span class="op" id="5046872">(</span><span class="ident" id="5046873">f</span>&nbsp;<span class="op" id="5046875">*</span><span class="ident" id="5046876">decompressor</span><span class="op" id="5046888">)</span>&nbsp;<span class="ident" id="5046890">copyData</span><span class="op" id="5046898">(</span><span class="op" id="5046899">)</span>&nbsp;<span class="op" id="5046901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046904">n</span>&nbsp;<span class="op" id="5046906">:=</span>&nbsp;<span class="ident" id="5046909">f</span><span class="op" id="5046910">.</span><span class="ident" id="5046911">copyLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046920">for</span>&nbsp;<span class="ident" id="5046924">n</span>&nbsp;<span class="op" id="5046926">&gt;</span>&nbsp;<span class="num" id="5046928">0</span>&nbsp;<span class="op" id="5046930">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046934">m</span>&nbsp;<span class="op" id="5046936">:=</span>&nbsp;<span class="builtinfunc" id="5046939">len</span><span class="op" id="5046942">(</span><span class="ident" id="5046943">f</span><span class="op" id="5046944">.</span><span class="ident" id="5046945">hist</span><span class="op" id="5046949">)</span>&nbsp;<span class="op" id="5046951">-</span>&nbsp;<span class="ident" id="5046953">f</span><span class="op" id="5046954">.</span><span class="ident" id="5046955">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5046960">if</span>&nbsp;<span class="ident" id="5046963">m</span>&nbsp;<span class="op" id="5046965">&gt;</span>&nbsp;<span class="ident" id="5046967">n</span>&nbsp;<span class="op" id="5046969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046974">m</span>&nbsp;<span class="op" id="5046976">=</span>&nbsp;<span class="ident" id="5046978">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5046982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5046986">m</span><span class="op" id="5046987">,</span>&nbsp;<span class="ident" id="5046989">err</span>&nbsp;<span class="op" id="5046993">:=</span>&nbsp;<span class="ident" id="5046996">io</span><span class="op" id="5046998">.</span><span class="ident" id="5046999">ReadFull</span><span class="op" id="5047007">(</span><span class="ident" id="5047008">f</span><span class="op" id="5047009">.</span><span class="ident" id="5047010">r</span><span class="op" id="5047011">,</span>&nbsp;<span class="ident" id="5047013">f</span><span class="op" id="5047014">.</span><span class="ident" id="5047015">hist</span><span class="op" id="5047019">[</span><span class="ident" id="5047020">f</span><span class="op" id="5047021">.</span><span class="ident" id="5047022">hp</span><span class="op" id="5047024">:</span><span class="ident" id="5047025">f</span><span class="op" id="5047026">.</span><span class="ident" id="5047027">hp</span><span class="op" id="5047029">+</span><span class="ident" id="5047030">m</span><span class="op" id="5047031">]</span><span class="op" id="5047032">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047036">f</span><span class="op" id="5047037">.</span><span class="ident" id="5047038">roffset</span>&nbsp;<span class="op" id="5047046">+=</span>&nbsp;<span class="ident" id="5047049">int64</span><span class="op" id="5047054">(</span><span class="ident" id="5047055">m</span><span class="op" id="5047056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047060">if</span>&nbsp;<span class="ident" id="5047063">err</span>&nbsp;<span class="op" id="5047067">!=</span>&nbsp;<span class="ident" id="5047070">nil</span>&nbsp;<span class="op" id="5047074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047079">f</span><span class="op" id="5047080">.</span><span class="ident" id="5047081">err</span>&nbsp;<span class="op" id="5047085">=</span>&nbsp;<span class="op" id="5047087">&amp;</span><span class="ident" id="5047088">ReadError</span><span class="op" id="5047097">{</span><span class="ident" id="5047098">f</span><span class="op" id="5047099">.</span><span class="ident" id="5047100">roffset</span><span class="op" id="5047107">,</span>&nbsp;<span class="ident" id="5047109">err</span><span class="op" id="5047112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047126">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047130">n</span>&nbsp;<span class="op" id="5047132">-=</span>&nbsp;<span class="ident" id="5047135">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047139">f</span><span class="op" id="5047140">.</span><span class="ident" id="5047141">hp</span>&nbsp;<span class="op" id="5047144">+=</span>&nbsp;<span class="ident" id="5047147">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047151">if</span>&nbsp;<span class="ident" id="5047154">f</span><span class="op" id="5047155">.</span><span class="ident" id="5047156">hp</span>&nbsp;<span class="op" id="5047159">==</span>&nbsp;<span class="builtinfunc" id="5047162">len</span><span class="op" id="5047165">(</span><span class="ident" id="5047166">f</span><span class="op" id="5047167">.</span><span class="ident" id="5047168">hist</span><span class="op" id="5047172">)</span>&nbsp;<span class="op" id="5047174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047179">f</span><span class="op" id="5047180">.</span><span class="ident" id="5047181">copyLen</span>&nbsp;<span class="op" id="5047189">=</span>&nbsp;<span class="ident" id="5047191">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047196">f</span><span class="op" id="5047197">.</span><span class="ident" id="5047198">flush</span><span class="op" id="5047203">(</span><span class="op" id="5047204">(</span><span class="op" id="5047205">*</span><span class="ident" id="5047206">decompressor</span><span class="op" id="5047218">)</span><span class="op" id="5047219">.</span><span class="ident" id="5047220">copyData</span><span class="op" id="5047228">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047233">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047248">f</span><span class="op" id="5047249">.</span><span class="ident" id="5047250">step</span>&nbsp;<span class="op" id="5047255">=</span>&nbsp;<span class="op" id="5047257">(</span><span class="op" id="5047258">*</span><span class="ident" id="5047259">decompressor</span><span class="op" id="5047271">)</span><span class="op" id="5047272">.</span><span class="ident" id="5047273">nextBlock</span><br>
<span class="lineno"></span><span class="op" id="5047283">}</span><br>
<span class="lineno">615</span><br>
<span class="lineno"></span><span class="keyword" id="5047286">func</span>&nbsp;<span class="op" id="5047291">(</span><span class="ident" id="5047292">f</span>&nbsp;<span class="op" id="5047294">*</span><span class="ident" id="5047295">decompressor</span><span class="op" id="5047307">)</span>&nbsp;<span class="ident" id="5047309">setDict</span><span class="op" id="5047316">(</span><span class="ident" id="5047317">dict</span>&nbsp;<span class="op" id="5047322">[</span><span class="op" id="5047323">]</span><span class="builtintype" id="5047324">byte</span><span class="op" id="5047328">)</span>&nbsp;<span class="op" id="5047330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047333">if</span>&nbsp;<span class="builtinfunc" id="5047336">len</span><span class="op" id="5047339">(</span><span class="ident" id="5047340">dict</span><span class="op" id="5047344">)</span>&nbsp;<span class="op" id="5047346">&gt;</span>&nbsp;<span class="builtinfunc" id="5047348">len</span><span class="op" id="5047351">(</span><span class="ident" id="5047352">f</span><span class="op" id="5047353">.</span><span class="ident" id="5047354">hist</span><span class="op" id="5047358">)</span>&nbsp;<span class="op" id="5047360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5047364">//&nbsp;Will&nbsp;only&nbsp;remember&nbsp;the&nbsp;tail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047398">dict</span>&nbsp;<span class="op" id="5047403">=</span>&nbsp;<span class="ident" id="5047405">dict</span><span class="op" id="5047409">[</span><span class="builtinfunc" id="5047410">len</span><span class="op" id="5047413">(</span><span class="ident" id="5047414">dict</span><span class="op" id="5047418">)</span><span class="op" id="5047419">-</span><span class="builtinfunc" id="5047420">len</span><span class="op" id="5047423">(</span><span class="ident" id="5047424">f</span><span class="op" id="5047425">.</span><span class="ident" id="5047426">hist</span><span class="op" id="5047430">)</span><span class="op" id="5047431">:</span><span class="op" id="5047432">]</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047439">f</span><span class="op" id="5047440">.</span><span class="ident" id="5047441">hp</span>&nbsp;<span class="op" id="5047444">=</span>&nbsp;<span class="builtinfunc" id="5047446">copy</span><span class="op" id="5047450">(</span><span class="ident" id="5047451">f</span><span class="op" id="5047452">.</span><span class="ident" id="5047453">hist</span><span class="op" id="5047457">[</span><span class="op" id="5047458">:</span><span class="op" id="5047459">]</span><span class="op" id="5047460">,</span>&nbsp;<span class="ident" id="5047462">dict</span><span class="op" id="5047466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047469">if</span>&nbsp;<span class="ident" id="5047472">f</span><span class="op" id="5047473">.</span><span class="ident" id="5047474">hp</span>&nbsp;<span class="op" id="5047477">==</span>&nbsp;<span class="builtinfunc" id="5047480">len</span><span class="op" id="5047483">(</span><span class="ident" id="5047484">f</span><span class="op" id="5047485">.</span><span class="ident" id="5047486">hist</span><span class="op" id="5047490">)</span>&nbsp;<span class="op" id="5047492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047496">f</span><span class="op" id="5047497">.</span><span class="ident" id="5047498">hp</span>&nbsp;<span class="op" id="5047501">=</span>&nbsp;<span class="num" id="5047503">0</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047507">f</span><span class="op" id="5047508">.</span><span class="ident" id="5047509">hfull</span>&nbsp;<span class="op" id="5047515">=</span>&nbsp;<span class="builtintype" id="5047517">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047526">f</span><span class="op" id="5047527">.</span><span class="ident" id="5047528">hw</span>&nbsp;<span class="op" id="5047531">=</span>&nbsp;<span class="ident" id="5047533">f</span><span class="op" id="5047534">.</span><span class="ident" id="5047535">hp</span><br>
<span class="lineno"></span><span class="op" id="5047538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="5047541">func</span>&nbsp;<span class="op" id="5047546">(</span><span class="ident" id="5047547">f</span>&nbsp;<span class="op" id="5047549">*</span><span class="ident" id="5047550">decompressor</span><span class="op" id="5047562">)</span>&nbsp;<span class="ident" id="5047564">moreBits</span><span class="op" id="5047572">(</span><span class="op" id="5047573">)</span>&nbsp;<span class="builtintype" id="5047575">error</span>&nbsp;<span class="op" id="5047581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047584">c</span><span class="op" id="5047585">,</span>&nbsp;<span class="ident" id="5047587">err</span>&nbsp;<span class="op" id="5047591">:=</span>&nbsp;<span class="ident" id="5047594">f</span><span class="op" id="5047595">.</span><span class="ident" id="5047596">r</span><span class="op" id="5047597">.</span><span class="ident" id="5047598">ReadByte</span><span class="op" id="5047606">(</span><span class="op" id="5047607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047610">if</span>&nbsp;<span class="ident" id="5047613">err</span>&nbsp;<span class="op" id="5047617">!=</span>&nbsp;<span class="ident" id="5047620">nil</span>&nbsp;<span class="op" id="5047624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047628">if</span>&nbsp;<span class="ident" id="5047631">err</span>&nbsp;<span class="op" id="5047635">==</span>&nbsp;<span class="ident" id="5047638">io</span><span class="op" id="5047640">.</span><span class="ident" id="5047641">EOF</span>&nbsp;<span class="op" id="5047645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047650">err</span>&nbsp;<span class="op" id="5047654">=</span>&nbsp;<span class="ident" id="5047656">io</span><span class="op" id="5047658">.</span><span class="ident" id="5047659">ErrUnexpectedEOF</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047682">return</span>&nbsp;<span class="ident" id="5047689">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047697">f</span><span class="op" id="5047698">.</span><span class="ident" id="5047699">roffset</span><span class="op" id="5047706">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047710">f</span><span class="op" id="5047711">.</span><span class="ident" id="5047712">b</span>&nbsp;<span class="op" id="5047714">|=</span>&nbsp;<span class="builtintype" id="5047717">uint32</span><span class="op" id="5047723">(</span><span class="ident" id="5047724">c</span><span class="op" id="5047725">)</span>&nbsp;<span class="op" id="5047727">&lt;&lt;</span>&nbsp;<span class="ident" id="5047730">f</span><span class="op" id="5047731">.</span><span class="ident" id="5047732">nb</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047736">f</span><span class="op" id="5047737">.</span><span class="ident" id="5047738">nb</span>&nbsp;<span class="op" id="5047741">+=</span>&nbsp;<span class="num" id="5047744">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047747">return</span>&nbsp;<span class="ident" id="5047754">nil</span><br>
<span class="lineno"></span><span class="op" id="5047758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047761">//&nbsp;Read&nbsp;the&nbsp;next&nbsp;Huffman-encoded&nbsp;symbol&nbsp;from&nbsp;f&nbsp;according&nbsp;to&nbsp;h.</span><br>
<span class="lineno">645</span><span class="keyword" id="5047824">func</span>&nbsp;<span class="op" id="5047829">(</span><span class="ident" id="5047830">f</span>&nbsp;<span class="op" id="5047832">*</span><span class="ident" id="5047833">decompressor</span><span class="op" id="5047845">)</span>&nbsp;<span class="ident" id="5047847">huffSym</span><span class="op" id="5047854">(</span><span class="ident" id="5047855">h</span>&nbsp;<span class="op" id="5047857">*</span><span class="ident" id="5047858">huffmanDecoder</span><span class="op" id="5047872">)</span>&nbsp;<span class="op" id="5047874">(</span><span class="builtintype" id="5047875">int</span><span class="op" id="5047878">,</span>&nbsp;<span class="builtintype" id="5047880">error</span><span class="op" id="5047885">)</span>&nbsp;<span class="op" id="5047887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5047890">n</span>&nbsp;<span class="op" id="5047892">:=</span>&nbsp;<span class="builtintype" id="5047895">uint</span><span class="op" id="5047899">(</span><span class="ident" id="5047900">h</span><span class="op" id="5047901">.</span><span class="ident" id="5047902">min</span><span class="op" id="5047905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047908">for</span>&nbsp;<span class="op" id="5047912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047916">for</span>&nbsp;<span class="ident" id="5047920">f</span><span class="op" id="5047921">.</span><span class="ident" id="5047922">nb</span>&nbsp;<span class="op" id="5047925">&lt;</span>&nbsp;<span class="ident" id="5047927">n</span>&nbsp;<span class="op" id="5047929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047934">if</span>&nbsp;<span class="ident" id="5047937">err</span>&nbsp;<span class="op" id="5047941">:=</span>&nbsp;<span class="ident" id="5047944">f</span><span class="op" id="5047945">.</span><span class="ident" id="5047946">moreBits</span><span class="op" id="5047954">(</span><span class="op" id="5047955">)</span><span class="op" id="5047956">;</span>&nbsp;<span class="ident" id="5047958">err</span>&nbsp;<span class="op" id="5047962">!=</span>&nbsp;<span class="ident" id="5047965">nil</span>&nbsp;<span class="op" id="5047969">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5047975">return</span>&nbsp;<span class="num" id="5047982">0</span><span class="op" id="5047983">,</span>&nbsp;<span class="ident" id="5047985">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5047996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048000">chunk</span>&nbsp;<span class="op" id="5048006">:=</span>&nbsp;<span class="ident" id="5048009">h</span><span class="op" id="5048010">.</span><span class="ident" id="5048011">chunks</span><span class="op" id="5048017">[</span><span class="ident" id="5048018">f</span><span class="op" id="5048019">.</span><span class="ident" id="5048020">b</span><span class="op" id="5048021">&amp;</span><span class="op" id="5048022">(</span><span class="ident" id="5048023">huffmanNumChunks</span><span class="op" id="5048039">-</span><span class="num" id="5048040">1</span><span class="op" id="5048041">)</span><span class="op" id="5048042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048046">n</span>&nbsp;<span class="op" id="5048048">=</span>&nbsp;<span class="builtintype" id="5048050">uint</span><span class="op" id="5048054">(</span><span class="ident" id="5048055">chunk</span>&nbsp;<span class="op" id="5048061">&amp;</span>&nbsp;<span class="ident" id="5048063">huffmanCountMask</span><span class="op" id="5048079">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048083">if</span>&nbsp;<span class="ident" id="5048086">n</span>&nbsp;<span class="op" id="5048088">&gt;</span>&nbsp;<span class="ident" id="5048090">huffmanChunkBits</span>&nbsp;<span class="op" id="5048107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048112">chunk</span>&nbsp;<span class="op" id="5048118">=</span>&nbsp;<span class="ident" id="5048120">h</span><span class="op" id="5048121">.</span><span class="ident" id="5048122">links</span><span class="op" id="5048127">[</span><span class="ident" id="5048128">chunk</span><span class="op" id="5048133">&gt;&gt;</span><span class="ident" id="5048135">huffmanValueShift</span><span class="op" id="5048152">]</span><span class="op" id="5048153">[</span><span class="op" id="5048154">(</span><span class="ident" id="5048155">f</span><span class="op" id="5048156">.</span><span class="ident" id="5048157">b</span><span class="op" id="5048158">&gt;&gt;</span><span class="ident" id="5048160">huffmanChunkBits</span><span class="op" id="5048176">)</span><span class="op" id="5048177">&amp;</span><span class="ident" id="5048178">h</span><span class="op" id="5048179">.</span><span class="ident" id="5048180">linkMask</span><span class="op" id="5048188">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048193">n</span>&nbsp;<span class="op" id="5048195">=</span>&nbsp;<span class="builtintype" id="5048197">uint</span><span class="op" id="5048201">(</span><span class="ident" id="5048202">chunk</span>&nbsp;<span class="op" id="5048208">&amp;</span>&nbsp;<span class="ident" id="5048210">huffmanCountMask</span><span class="op" id="5048226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048231">if</span>&nbsp;<span class="ident" id="5048234">n</span>&nbsp;<span class="op" id="5048236">==</span>&nbsp;<span class="num" id="5048239">0</span>&nbsp;<span class="op" id="5048241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048247">f</span><span class="op" id="5048248">.</span><span class="ident" id="5048249">err</span>&nbsp;<span class="op" id="5048253">=</span>&nbsp;<span class="ident" id="5048255">CorruptInputError</span><span class="op" id="5048272">(</span><span class="ident" id="5048273">f</span><span class="op" id="5048274">.</span><span class="ident" id="5048275">roffset</span><span class="op" id="5048282">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048288">return</span>&nbsp;<span class="num" id="5048295">0</span><span class="op" id="5048296">,</span>&nbsp;<span class="ident" id="5048298">f</span><span class="op" id="5048299">.</span><span class="ident" id="5048300">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048315">if</span>&nbsp;<span class="ident" id="5048318">n</span>&nbsp;<span class="op" id="5048320">&lt;=</span>&nbsp;<span class="ident" id="5048323">f</span><span class="op" id="5048324">.</span><span class="ident" id="5048325">nb</span>&nbsp;<span class="op" id="5048328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048333">f</span><span class="op" id="5048334">.</span><span class="ident" id="5048335">b</span>&nbsp;<span class="op" id="5048337">&gt;&gt;=</span>&nbsp;<span class="ident" id="5048341">n</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048346">f</span><span class="op" id="5048347">.</span><span class="ident" id="5048348">nb</span>&nbsp;<span class="op" id="5048351">-=</span>&nbsp;<span class="ident" id="5048354">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048359">return</span>&nbsp;<span class="builtintype" id="5048366">int</span><span class="op" id="5048369">(</span><span class="ident" id="5048370">chunk</span>&nbsp;<span class="op" id="5048376">&gt;&gt;</span>&nbsp;<span class="ident" id="5048379">huffmanValueShift</span><span class="op" id="5048396">)</span><span class="op" id="5048397">,</span>&nbsp;<span class="ident" id="5048399">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048408">}</span><br>
<span class="lineno"></span><span class="op" id="5048410">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="comment" id="5048413">//&nbsp;Flush&nbsp;any&nbsp;buffered&nbsp;output&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5048468">func</span>&nbsp;<span class="op" id="5048473">(</span><span class="ident" id="5048474">f</span>&nbsp;<span class="op" id="5048476">*</span><span class="ident" id="5048477">decompressor</span><span class="op" id="5048489">)</span>&nbsp;<span class="ident" id="5048491">flush</span><span class="op" id="5048496">(</span><span class="ident" id="5048497">step</span>&nbsp;<span class="keyword" id="5048502">func</span><span class="op" id="5048506">(</span><span class="op" id="5048507">*</span><span class="ident" id="5048508">decompressor</span><span class="op" id="5048520">)</span><span class="op" id="5048521">)</span>&nbsp;<span class="op" id="5048523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048526">f</span><span class="op" id="5048527">.</span><span class="ident" id="5048528">toRead</span>&nbsp;<span class="op" id="5048535">=</span>&nbsp;<span class="ident" id="5048537">f</span><span class="op" id="5048538">.</span><span class="ident" id="5048539">hist</span><span class="op" id="5048543">[</span><span class="ident" id="5048544">f</span><span class="op" id="5048545">.</span><span class="ident" id="5048546">hw</span><span class="op" id="5048548">:</span><span class="ident" id="5048549">f</span><span class="op" id="5048550">.</span><span class="ident" id="5048551">hp</span><span class="op" id="5048553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048556">f</span><span class="op" id="5048557">.</span><span class="ident" id="5048558">woffset</span>&nbsp;<span class="op" id="5048566">+=</span>&nbsp;<span class="ident" id="5048569">int64</span><span class="op" id="5048574">(</span><span class="ident" id="5048575">f</span><span class="op" id="5048576">.</span><span class="ident" id="5048577">hp</span>&nbsp;<span class="op" id="5048580">-</span>&nbsp;<span class="ident" id="5048582">f</span><span class="op" id="5048583">.</span><span class="ident" id="5048584">hw</span><span class="op" id="5048586">)</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048589">f</span><span class="op" id="5048590">.</span><span class="ident" id="5048591">hw</span>&nbsp;<span class="op" id="5048594">=</span>&nbsp;<span class="ident" id="5048596">f</span><span class="op" id="5048597">.</span><span class="ident" id="5048598">hp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048602">if</span>&nbsp;<span class="ident" id="5048605">f</span><span class="op" id="5048606">.</span><span class="ident" id="5048607">hp</span>&nbsp;<span class="op" id="5048610">==</span>&nbsp;<span class="builtinfunc" id="5048613">len</span><span class="op" id="5048616">(</span><span class="ident" id="5048617">f</span><span class="op" id="5048618">.</span><span class="ident" id="5048619">hist</span><span class="op" id="5048623">)</span>&nbsp;<span class="op" id="5048625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048629">f</span><span class="op" id="5048630">.</span><span class="ident" id="5048631">hp</span>&nbsp;<span class="op" id="5048634">=</span>&nbsp;<span class="num" id="5048636">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048640">f</span><span class="op" id="5048641">.</span><span class="ident" id="5048642">hw</span>&nbsp;<span class="op" id="5048645">=</span>&nbsp;<span class="num" id="5048647">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048651">f</span><span class="op" id="5048652">.</span><span class="ident" id="5048653">hfull</span>&nbsp;<span class="op" id="5048659">=</span>&nbsp;<span class="builtintype" id="5048661">true</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048670">f</span><span class="op" id="5048671">.</span><span class="ident" id="5048672">step</span>&nbsp;<span class="op" id="5048677">=</span>&nbsp;<span class="ident" id="5048679">step</span><br>
<span class="lineno"></span><span class="op" id="5048684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5048687">func</span>&nbsp;<span class="ident" id="5048692">makeReader</span><span class="op" id="5048702">(</span><span class="ident" id="5048703">r</span>&nbsp;<span class="ident" id="5048705">io</span><span class="op" id="5048707">.</span><span class="ident" id="5048708">Reader</span><span class="op" id="5048714">)</span>&nbsp;<span class="ident" id="5048716">Reader</span>&nbsp;<span class="op" id="5048723">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048726">if</span>&nbsp;<span class="ident" id="5048729">rr</span><span class="op" id="5048731">,</span>&nbsp;<span class="ident" id="5048733">ok</span>&nbsp;<span class="op" id="5048736">:=</span>&nbsp;<span class="ident" id="5048739">r</span><span class="op" id="5048740">.</span><span class="op" id="5048741">(</span><span class="ident" id="5048742">Reader</span><span class="op" id="5048748">)</span><span class="op" id="5048749">;</span>&nbsp;<span class="ident" id="5048751">ok</span>&nbsp;<span class="op" id="5048754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048758">return</span>&nbsp;<span class="ident" id="5048765">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5048772">return</span>&nbsp;<span class="ident" id="5048779">bufio</span><span class="op" id="5048784">.</span><span class="ident" id="5048785">NewReader</span><span class="op" id="5048794">(</span><span class="ident" id="5048795">r</span><span class="op" id="5048796">)</span><br>
<span class="lineno"></span><span class="op" id="5048798">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="5048801">func</span>&nbsp;<span class="op" id="5048806">(</span><span class="ident" id="5048807">f</span>&nbsp;<span class="op" id="5048809">*</span><span class="ident" id="5048810">decompressor</span><span class="op" id="5048822">)</span>&nbsp;<span class="ident" id="5048824">Reset</span><span class="op" id="5048829">(</span><span class="ident" id="5048830">r</span>&nbsp;<span class="ident" id="5048832">io</span><span class="op" id="5048834">.</span><span class="ident" id="5048835">Reader</span><span class="op" id="5048841">,</span>&nbsp;<span class="ident" id="5048843">dict</span>&nbsp;<span class="op" id="5048848">[</span><span class="op" id="5048849">]</span><span class="builtintype" id="5048850">byte</span><span class="op" id="5048854">)</span>&nbsp;<span class="builtintype" id="5048856">error</span>&nbsp;<span class="op" id="5048862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5048865">*</span><span class="ident" id="5048866">f</span>&nbsp;<span class="op" id="5048868">=</span>&nbsp;<span class="ident" id="5048870">decompressor</span><span class="op" id="5048882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048886">r</span><span class="op" id="5048887">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048896">makeReader</span><span class="op" id="5048906">(</span><span class="ident" id="5048907">r</span><span class="op" id="5048908">)</span><span class="op" id="5048909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048913">bits</span><span class="op" id="5048917">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048923">f</span><span class="op" id="5048924">.</span><span class="ident" id="5048925">bits</span><span class="op" id="5048929">,</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048933">codebits</span><span class="op" id="5048941">:</span>&nbsp;<span class="ident" id="5048943">f</span><span class="op" id="5048944">.</span><span class="ident" id="5048945">codebits</span><span class="op" id="5048953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048957">hist</span><span class="op" id="5048961">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048967">f</span><span class="op" id="5048968">.</span><span class="ident" id="5048969">hist</span><span class="op" id="5048973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5048977">step</span><span class="op" id="5048981">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5048987">(</span><span class="op" id="5048988">*</span><span class="ident" id="5048989">decompressor</span><span class="op" id="5049001">)</span><span class="op" id="5049002">.</span><span class="ident" id="5049003">nextBlock</span><span class="op" id="5049012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049018">if</span>&nbsp;<span class="ident" id="5049021">dict</span>&nbsp;<span class="op" id="5049026">!=</span>&nbsp;<span class="ident" id="5049029">nil</span>&nbsp;<span class="op" id="5049033">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049037">f</span><span class="op" id="5049038">.</span><span class="ident" id="5049039">setDict</span><span class="op" id="5049046">(</span><span class="ident" id="5049047">dict</span><span class="op" id="5049051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5049054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049057">return</span>&nbsp;<span class="ident" id="5049064">nil</span><br>
<span class="lineno"></span><span class="op" id="5049068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">705</span><span class="comment" id="5049071">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;ReadCloser&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5049126">//&nbsp;to&nbsp;read&nbsp;the&nbsp;uncompressed&nbsp;version&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5049168">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="5049215">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5049277">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;ReadCloser</span><br>
<span class="lineno">710</span><span class="comment" id="5049346">//&nbsp;when&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="comment" id="5049372">//</span><br>
<span class="lineno"></span><span class="comment" id="5049375">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno"></span><span class="keyword" id="5049441">func</span>&nbsp;<span class="ident" id="5049446">NewReader</span><span class="op" id="5049455">(</span><span class="ident" id="5049456">r</span>&nbsp;<span class="ident" id="5049458">io</span><span class="op" id="5049460">.</span><span class="ident" id="5049461">Reader</span><span class="op" id="5049467">)</span>&nbsp;<span class="ident" id="5049469">io</span><span class="op" id="5049471">.</span><span class="ident" id="5049472">ReadCloser</span>&nbsp;<span class="op" id="5049483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049486">var</span>&nbsp;<span class="ident" id="5049490">f</span>&nbsp;<span class="ident" id="5049492">decompressor</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049506">f</span><span class="op" id="5049507">.</span><span class="ident" id="5049508">bits</span>&nbsp;<span class="op" id="5049513">=</span>&nbsp;<span class="builtinfunc" id="5049515">new</span><span class="op" id="5049518">(</span><span class="op" id="5049519">[</span><span class="ident" id="5049520">maxLit</span>&nbsp;<span class="op" id="5049527">+</span>&nbsp;<span class="ident" id="5049529">maxDist</span><span class="op" id="5049536">]</span><span class="builtintype" id="5049537">int</span><span class="op" id="5049540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049543">f</span><span class="op" id="5049544">.</span><span class="ident" id="5049545">codebits</span>&nbsp;<span class="op" id="5049554">=</span>&nbsp;<span class="builtinfunc" id="5049556">new</span><span class="op" id="5049559">(</span><span class="op" id="5049560">[</span><span class="ident" id="5049561">numCodes</span><span class="op" id="5049569">]</span><span class="builtintype" id="5049570">int</span><span class="op" id="5049573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049576">f</span><span class="op" id="5049577">.</span><span class="ident" id="5049578">r</span>&nbsp;<span class="op" id="5049580">=</span>&nbsp;<span class="ident" id="5049582">makeReader</span><span class="op" id="5049592">(</span><span class="ident" id="5049593">r</span><span class="op" id="5049594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049597">f</span><span class="op" id="5049598">.</span><span class="ident" id="5049599">hist</span>&nbsp;<span class="op" id="5049604">=</span>&nbsp;<span class="builtinfunc" id="5049606">new</span><span class="op" id="5049609">(</span><span class="op" id="5049610">[</span><span class="ident" id="5049611">maxHist</span><span class="op" id="5049618">]</span><span class="builtintype" id="5049619">byte</span><span class="op" id="5049623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5049626">f</span><span class="op" id="5049627">.</span><span class="ident" id="5049628">step</span>&nbsp;<span class="op" id="5049633">=</span>&nbsp;<span class="op" id="5049635">(</span><span class="op" id="5049636">*</span><span class="ident" id="5049637">decompressor</span><span class="op" id="5049649">)</span><span class="op" id="5049650">.</span><span class="ident" id="5049651">nextBlock</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5049662">return</span>&nbsp;<span class="op" id="5049669">&amp;</span><span class="ident" id="5049670">f</span><br>
<span class="lineno"></span><span class="op" id="5049672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049675">//&nbsp;NewReaderDict&nbsp;is&nbsp;like&nbsp;NewReader&nbsp;but&nbsp;initializes&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="5049737">//&nbsp;with&nbsp;a&nbsp;preset&nbsp;dictionary.&nbsp;&nbsp;The&nbsp;returned&nbsp;Reader&nbsp;behaves&nbsp;as&nbsp;if</span><br>
<span class="lineno">725</span><span class="comment" id="5049801">//&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;stream&nbsp;started&nbsp;with&nbsp;the&nbsp;given&nbsp;dictionary,</span><br>
<span class="lineno"></span><span class="comment" id="5049868">//&nbsp;which&nbsp;has&nbsp;already&nbsp;been&nbsp;read.&nbsp;&nbsp;NewReaderDict&nbsp;is&nbsp;typically&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5049933">//&nbsp;to&nbsp;read&nbsp;data&nbsp;compressed&nbsp;by&nbsp;NewWriterDict.</span><br>
<span class="lineno"></span><span class="comment" id="5049978">//</span><br>
<span class="lineno"></span><span class="comment" id="5049981">//&nbsp;The&nbsp;ReadCloser&nbsp;returned&nbsp;by&nbsp;NewReader&nbsp;also&nbsp;implements&nbsp;Resetter.</span><br>
<span class="lineno">730</span><span class="keyword" id="5050047">func</span>&nbsp;<span class="ident" id="5050052">NewReaderDict</span><span class="op" id="5050065">(</span><span class="ident" id="5050066">r</span>&nbsp;<span class="ident" id="5050068">io</span><span class="op" id="5050070">.</span><span class="ident" id="5050071">Reader</span><span class="op" id="5050077">,</span>&nbsp;<span class="ident" id="5050079">dict</span>&nbsp;<span class="op" id="5050084">[</span><span class="op" id="5050085">]</span><span class="builtintype" id="5050086">byte</span><span class="op" id="5050090">)</span>&nbsp;<span class="ident" id="5050092">io</span><span class="op" id="5050094">.</span><span class="ident" id="5050095">ReadCloser</span>&nbsp;<span class="op" id="5050106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050109">var</span>&nbsp;<span class="ident" id="5050113">f</span>&nbsp;<span class="ident" id="5050115">decompressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050129">f</span><span class="op" id="5050130">.</span><span class="ident" id="5050131">r</span>&nbsp;<span class="op" id="5050133">=</span>&nbsp;<span class="ident" id="5050135">makeReader</span><span class="op" id="5050145">(</span><span class="ident" id="5050146">r</span><span class="op" id="5050147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050150">f</span><span class="op" id="5050151">.</span><span class="ident" id="5050152">hist</span>&nbsp;<span class="op" id="5050157">=</span>&nbsp;<span class="builtinfunc" id="5050159">new</span><span class="op" id="5050162">(</span><span class="op" id="5050163">[</span><span class="ident" id="5050164">maxHist</span><span class="op" id="5050171">]</span><span class="builtintype" id="5050172">byte</span><span class="op" id="5050176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050179">f</span><span class="op" id="5050180">.</span><span class="ident" id="5050181">bits</span>&nbsp;<span class="op" id="5050186">=</span>&nbsp;<span class="builtinfunc" id="5050188">new</span><span class="op" id="5050191">(</span><span class="op" id="5050192">[</span><span class="ident" id="5050193">maxLit</span>&nbsp;<span class="op" id="5050200">+</span>&nbsp;<span class="ident" id="5050202">maxDist</span><span class="op" id="5050209">]</span><span class="builtintype" id="5050210">int</span><span class="op" id="5050213">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050216">f</span><span class="op" id="5050217">.</span><span class="ident" id="5050218">codebits</span>&nbsp;<span class="op" id="5050227">=</span>&nbsp;<span class="builtinfunc" id="5050229">new</span><span class="op" id="5050232">(</span><span class="op" id="5050233">[</span><span class="ident" id="5050234">numCodes</span><span class="op" id="5050242">]</span><span class="builtintype" id="5050243">int</span><span class="op" id="5050246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050249">f</span><span class="op" id="5050250">.</span><span class="ident" id="5050251">step</span>&nbsp;<span class="op" id="5050256">=</span>&nbsp;<span class="op" id="5050258">(</span><span class="op" id="5050259">*</span><span class="ident" id="5050260">decompressor</span><span class="op" id="5050272">)</span><span class="op" id="5050273">.</span><span class="ident" id="5050274">nextBlock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5050285">f</span><span class="op" id="5050286">.</span><span class="ident" id="5050287">setDict</span><span class="op" id="5050294">(</span><span class="ident" id="5050295">dict</span><span class="op" id="5050299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5050302">return</span>&nbsp;<span class="op" id="5050309">&amp;</span><span class="ident" id="5050310">f</span><br>
<span class="lineno"></span><span class="op" id="5050312">}</span>
</div>
</body>
</html>
