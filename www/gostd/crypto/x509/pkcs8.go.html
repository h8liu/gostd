<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4313304">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4313359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4313413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4313464">package</span>&nbsp;<span class="ident" id="4313472">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4313478">import</span>&nbsp;<span class="op" id="4313485">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4313488">&#34;crypto/x509/pkix&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4313508">&#34;encoding/asn1&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4313525">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4313535">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="4313541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4313544">//&nbsp;pkcs8&nbsp;reflects&nbsp;an&nbsp;ASN.1,&nbsp;PKCS#8&nbsp;PrivateKey.&nbsp;See</span><br>
<span class="lineno">15</span><span class="comment" id="4313595">//&nbsp;ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-8/pkcs-8v1_2.asn</span><br>
<span class="lineno"></span><span class="comment" id="4313655">//&nbsp;and&nbsp;RFC5208.</span><br>
<span class="lineno"></span><span class="keyword" id="4313671">type</span>&nbsp;<span class="ident" id="4313676">pkcs8</span>&nbsp;<span class="keyword" id="4313682">struct</span>&nbsp;<span class="op" id="4313689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313692">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4313703">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313708">Algo</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4313719">pkix</span><span class="op" id="4313723">.</span><span class="ident" id="4313724">AlgorithmIdentifier</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4313745">PrivateKey</span>&nbsp;<span class="op" id="4313756">[</span><span class="op" id="4313757">]</span><span class="builtintype" id="4313758">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4313764">//&nbsp;optional&nbsp;attributes&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="op" id="4313796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4313799">//&nbsp;ParsePKCS8PrivateKey&nbsp;parses&nbsp;an&nbsp;unencrypted,&nbsp;PKCS#8&nbsp;private&nbsp;key.&nbsp;See</span><br>
<span class="lineno">25</span><span class="comment" id="4313870">//&nbsp;http://www.rsa.com/rsalabs/node.asp?id=2130&nbsp;and&nbsp;RFC5208.</span><br>
<span class="lineno"></span><span class="keyword" id="4313930">func</span>&nbsp;<span class="ident" id="4313935">ParsePKCS8PrivateKey</span><span class="op" id="4313955">(</span><span class="ident" id="4313956">der</span>&nbsp;<span class="op" id="4313960">[</span><span class="op" id="4313961">]</span><span class="builtintype" id="4313962">byte</span><span class="op" id="4313966">)</span>&nbsp;<span class="op" id="4313968">(</span><span class="ident" id="4313969">key</span>&nbsp;<span class="keyword" id="4313973">interface</span><span class="op" id="4313982">{</span><span class="op" id="4313983">}</span><span class="op" id="4313984">,</span>&nbsp;<span class="ident" id="4313986">err</span>&nbsp;<span class="builtintype" id="4313990">error</span><span class="op" id="4313995">)</span>&nbsp;<span class="op" id="4313997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314000">var</span>&nbsp;<span class="ident" id="4314004">privKey</span>&nbsp;<span class="ident" id="4314012">pkcs8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314019">if</span>&nbsp;<span class="ident" id="4314022">_</span><span class="op" id="4314023">,</span>&nbsp;<span class="ident" id="4314025">err</span>&nbsp;<span class="op" id="4314029">:=</span>&nbsp;<span class="ident" id="4314032">asn1</span><span class="op" id="4314036">.</span><span class="ident" id="4314037">Unmarshal</span><span class="op" id="4314046">(</span><span class="ident" id="4314047">der</span><span class="op" id="4314050">,</span>&nbsp;<span class="op" id="4314052">&amp;</span><span class="ident" id="4314053">privKey</span><span class="op" id="4314060">)</span><span class="op" id="4314061">;</span>&nbsp;<span class="ident" id="4314063">err</span>&nbsp;<span class="op" id="4314067">!=</span>&nbsp;<span class="ident" id="4314070">nil</span>&nbsp;<span class="op" id="4314074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314078">return</span>&nbsp;<span class="ident" id="4314085">nil</span><span class="op" id="4314088">,</span>&nbsp;<span class="ident" id="4314090">err</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314098">switch</span>&nbsp;<span class="op" id="4314105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314108">case</span>&nbsp;<span class="ident" id="4314113">privKey</span><span class="op" id="4314120">.</span><span class="ident" id="4314121">Algo</span><span class="op" id="4314125">.</span><span class="ident" id="4314126">Algorithm</span><span class="op" id="4314135">.</span><span class="ident" id="4314136">Equal</span><span class="op" id="4314141">(</span><span class="ident" id="4314142">oidPublicKeyRSA</span><span class="op" id="4314157">)</span><span class="op" id="4314158">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314162">key</span><span class="op" id="4314165">,</span>&nbsp;<span class="ident" id="4314167">err</span>&nbsp;<span class="op" id="4314171">=</span>&nbsp;<span class="ident" id="4314173">ParsePKCS1PrivateKey</span><span class="op" id="4314193">(</span><span class="ident" id="4314194">privKey</span><span class="op" id="4314201">.</span><span class="ident" id="4314202">PrivateKey</span><span class="op" id="4314212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314216">if</span>&nbsp;<span class="ident" id="4314219">err</span>&nbsp;<span class="op" id="4314223">!=</span>&nbsp;<span class="ident" id="4314226">nil</span>&nbsp;<span class="op" id="4314230">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314235">return</span>&nbsp;<span class="ident" id="4314242">nil</span><span class="op" id="4314245">,</span>&nbsp;<span class="ident" id="4314247">errors</span><span class="op" id="4314253">.</span><span class="ident" id="4314254">New</span><span class="op" id="4314257">(</span><span class="string" id="4314258">&#34;x509:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;RSA&nbsp;private&nbsp;key&nbsp;embedded&nbsp;in&nbsp;PKCS#8:&nbsp;&#34;</span>&nbsp;<span class="op" id="4314319">+</span>&nbsp;<span class="ident" id="4314321">err</span><span class="op" id="4314324">.</span><span class="ident" id="4314325">Error</span><span class="op" id="4314330">(</span><span class="op" id="4314331">)</span><span class="op" id="4314332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314340">return</span>&nbsp;<span class="ident" id="4314347">key</span><span class="op" id="4314350">,</span>&nbsp;<span class="ident" id="4314352">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314358">case</span>&nbsp;<span class="ident" id="4314363">privKey</span><span class="op" id="4314370">.</span><span class="ident" id="4314371">Algo</span><span class="op" id="4314375">.</span><span class="ident" id="4314376">Algorithm</span><span class="op" id="4314385">.</span><span class="ident" id="4314386">Equal</span><span class="op" id="4314391">(</span><span class="ident" id="4314392">oidPublicKeyECDSA</span><span class="op" id="4314409">)</span><span class="op" id="4314410">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314414">bytes</span>&nbsp;<span class="op" id="4314420">:=</span>&nbsp;<span class="ident" id="4314423">privKey</span><span class="op" id="4314430">.</span><span class="ident" id="4314431">Algo</span><span class="op" id="4314435">.</span><span class="ident" id="4314436">Parameters</span><span class="op" id="4314446">.</span><span class="ident" id="4314447">FullBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314459">namedCurveOID</span>&nbsp;<span class="op" id="4314473">:=</span>&nbsp;<span class="builtinfunc" id="4314476">new</span><span class="op" id="4314479">(</span><span class="ident" id="4314480">asn1</span><span class="op" id="4314484">.</span><span class="ident" id="4314485">ObjectIdentifier</span><span class="op" id="4314501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314505">if</span>&nbsp;<span class="ident" id="4314508">_</span><span class="op" id="4314509">,</span>&nbsp;<span class="ident" id="4314511">err</span>&nbsp;<span class="op" id="4314515">:=</span>&nbsp;<span class="ident" id="4314518">asn1</span><span class="op" id="4314522">.</span><span class="ident" id="4314523">Unmarshal</span><span class="op" id="4314532">(</span><span class="ident" id="4314533">bytes</span><span class="op" id="4314538">,</span>&nbsp;<span class="ident" id="4314540">namedCurveOID</span><span class="op" id="4314553">)</span><span class="op" id="4314554">;</span>&nbsp;<span class="ident" id="4314556">err</span>&nbsp;<span class="op" id="4314560">!=</span>&nbsp;<span class="ident" id="4314563">nil</span>&nbsp;<span class="op" id="4314567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314572">namedCurveOID</span>&nbsp;<span class="op" id="4314586">=</span>&nbsp;<span class="ident" id="4314588">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314594">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4314598">key</span><span class="op" id="4314601">,</span>&nbsp;<span class="ident" id="4314603">err</span>&nbsp;<span class="op" id="4314607">=</span>&nbsp;<span class="ident" id="4314609">parseECPrivateKey</span><span class="op" id="4314626">(</span><span class="ident" id="4314627">namedCurveOID</span><span class="op" id="4314640">,</span>&nbsp;<span class="ident" id="4314642">privKey</span><span class="op" id="4314649">.</span><span class="ident" id="4314650">PrivateKey</span><span class="op" id="4314660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314664">if</span>&nbsp;<span class="ident" id="4314667">err</span>&nbsp;<span class="op" id="4314671">!=</span>&nbsp;<span class="ident" id="4314674">nil</span>&nbsp;<span class="op" id="4314678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314683">return</span>&nbsp;<span class="ident" id="4314690">nil</span><span class="op" id="4314693">,</span>&nbsp;<span class="ident" id="4314695">errors</span><span class="op" id="4314701">.</span><span class="ident" id="4314702">New</span><span class="op" id="4314705">(</span><span class="string" id="4314706">&#34;x509:&nbsp;failed&nbsp;to&nbsp;parse&nbsp;EC&nbsp;private&nbsp;key&nbsp;embedded&nbsp;in&nbsp;PKCS#8:&nbsp;&#34;</span>&nbsp;<span class="op" id="4314766">+</span>&nbsp;<span class="ident" id="4314768">err</span><span class="op" id="4314771">.</span><span class="ident" id="4314772">Error</span><span class="op" id="4314777">(</span><span class="op" id="4314778">)</span><span class="op" id="4314779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314787">return</span>&nbsp;<span class="ident" id="4314794">key</span><span class="op" id="4314797">,</span>&nbsp;<span class="ident" id="4314799">nil</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314805">default</span><span class="op" id="4314812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4314816">return</span>&nbsp;<span class="ident" id="4314823">nil</span><span class="op" id="4314826">,</span>&nbsp;<span class="ident" id="4314828">fmt</span><span class="op" id="4314831">.</span><span class="ident" id="4314832">Errorf</span><span class="op" id="4314838">(</span><span class="string" id="4314839">&#34;x509:&nbsp;PKCS#8&nbsp;wrapping&nbsp;contained&nbsp;private&nbsp;key&nbsp;with&nbsp;unknown&nbsp;algorithm:&nbsp;%v&#34;</span><span class="op" id="4314911">,</span>&nbsp;<span class="ident" id="4314913">privKey</span><span class="op" id="4314920">.</span><span class="ident" id="4314921">Algo</span><span class="op" id="4314925">.</span><span class="ident" id="4314926">Algorithm</span><span class="op" id="4314935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4314938">}</span><br>
<span class="lineno"></span><span class="op" id="4314940">}</span>
</div>
</body>
</html>
