<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/format</h2>
<ul>
<li><a href="/gostd/go/format/format.go.html">format.go</a></li>
<li><a href="/gostd/go/format/format_test.go.html">format_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5649695">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5649750">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5649804">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5649855">//&nbsp;Package&nbsp;format&nbsp;implements&nbsp;standard&nbsp;formatting&nbsp;of&nbsp;Go&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="5649918">package</span>&nbsp;<span class="ident" id="5649926">format</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5649934">import</span>&nbsp;<span class="op" id="5649941">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5649944">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5649953">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5649960">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5649970">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5649983">&#34;go/printer&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5649997">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5650009">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5650015">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5650025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5650028">var</span>&nbsp;<span class="ident" id="5650032">config</span>&nbsp;<span class="op" id="5650039">=</span>&nbsp;<span class="ident" id="5650041">printer</span><span class="op" id="5650048">.</span><span class="ident" id="5650049">Config</span><span class="op" id="5650055">{</span><span class="ident" id="5650056">Mode</span><span class="op" id="5650060">:</span>&nbsp;<span class="ident" id="5650062">printer</span><span class="op" id="5650069">.</span><span class="ident" id="5650070">UseSpaces</span>&nbsp;<span class="op" id="5650080">|</span>&nbsp;<span class="ident" id="5650082">printer</span><span class="op" id="5650089">.</span><span class="ident" id="5650090">TabIndent</span><span class="op" id="5650099">,</span>&nbsp;<span class="ident" id="5650101">Tabwidth</span><span class="op" id="5650109">:</span>&nbsp;<span class="num" id="5650111">8</span><span class="op" id="5650112">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5650115">const</span>&nbsp;<span class="ident" id="5650121">parserMode</span>&nbsp;<span class="op" id="5650132">=</span>&nbsp;<span class="ident" id="5650134">parser</span><span class="op" id="5650140">.</span><span class="ident" id="5650141">ParseComments</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5650156">//&nbsp;Node&nbsp;formats&nbsp;node&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;writes&nbsp;the&nbsp;result&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="5650232">//</span><br>
<span class="lineno">25</span><span class="comment" id="5650235">//&nbsp;The&nbsp;node&nbsp;type&nbsp;must&nbsp;be&nbsp;*ast.File,&nbsp;*printer.CommentedNode,&nbsp;[]ast.Decl,</span><br>
<span class="lineno"></span><span class="comment" id="5650307">//&nbsp;[]ast.Stmt,&nbsp;or&nbsp;assignment-compatible&nbsp;to&nbsp;ast.Expr,&nbsp;ast.Decl,&nbsp;ast.Spec,</span><br>
<span class="lineno"></span><span class="comment" id="5650380">//&nbsp;or&nbsp;ast.Stmt.&nbsp;Node&nbsp;does&nbsp;not&nbsp;modify&nbsp;node.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5650450">//&nbsp;nodes&nbsp;representing&nbsp;partial&nbsp;source&nbsp;files&nbsp;(i.e.,&nbsp;if&nbsp;the&nbsp;node&nbsp;is&nbsp;not&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5650522">//&nbsp;*ast.File&nbsp;or&nbsp;a&nbsp;*printer.CommentedNode&nbsp;not&nbsp;wrapping&nbsp;an&nbsp;*ast.File).</span><br>
<span class="lineno">30</span><span class="comment" id="5650591">//</span><br>
<span class="lineno"></span><span class="comment" id="5650594">//&nbsp;The&nbsp;function&nbsp;may&nbsp;return&nbsp;early&nbsp;(before&nbsp;the&nbsp;entire&nbsp;result&nbsp;is&nbsp;written)</span><br>
<span class="lineno"></span><span class="comment" id="5650665">//&nbsp;and&nbsp;return&nbsp;a&nbsp;formatting&nbsp;error,&nbsp;for&nbsp;instance&nbsp;due&nbsp;to&nbsp;an&nbsp;incorrect&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5650737">//</span><br>
<span class="lineno"></span><span class="keyword" id="5650740">func</span>&nbsp;<span class="ident" id="5650745">Node</span><span class="op" id="5650749">(</span><span class="ident" id="5650750">dst</span>&nbsp;<span class="ident" id="5650754">io</span><span class="op" id="5650756">.</span><span class="ident" id="5650757">Writer</span><span class="op" id="5650763">,</span>&nbsp;<span class="ident" id="5650765">fset</span>&nbsp;<span class="op" id="5650770">*</span><span class="ident" id="5650771">token</span><span class="op" id="5650776">.</span><span class="ident" id="5650777">FileSet</span><span class="op" id="5650784">,</span>&nbsp;<span class="ident" id="5650786">node</span>&nbsp;<span class="keyword" id="5650791">interface</span><span class="op" id="5650800">{</span><span class="op" id="5650801">}</span><span class="op" id="5650802">)</span>&nbsp;<span class="builtintype" id="5650804">error</span>&nbsp;<span class="op" id="5650810">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5650813">//&nbsp;Determine&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;complete&nbsp;source&nbsp;file&nbsp;(file&nbsp;!=&nbsp;nil).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650876">var</span>&nbsp;<span class="ident" id="5650880">file</span>&nbsp;<span class="op" id="5650885">*</span><span class="ident" id="5650886">ast</span><span class="op" id="5650889">.</span><span class="ident" id="5650890">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650896">var</span>&nbsp;<span class="ident" id="5650900">cnode</span>&nbsp;<span class="op" id="5650906">*</span><span class="ident" id="5650907">printer</span><span class="op" id="5650914">.</span><span class="ident" id="5650915">CommentedNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650930">switch</span>&nbsp;<span class="ident" id="5650937">n</span>&nbsp;<span class="op" id="5650939">:=</span>&nbsp;<span class="ident" id="5650942">node</span><span class="op" id="5650946">.</span><span class="op" id="5650947">(</span><span class="keyword" id="5650948">type</span><span class="op" id="5650952">)</span>&nbsp;<span class="op" id="5650954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650957">case</span>&nbsp;<span class="op" id="5650962">*</span><span class="ident" id="5650963">ast</span><span class="op" id="5650966">.</span><span class="ident" id="5650967">File</span><span class="op" id="5650971">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5650975">file</span>&nbsp;<span class="op" id="5650980">=</span>&nbsp;<span class="ident" id="5650982">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5650985">case</span>&nbsp;<span class="op" id="5650990">*</span><span class="ident" id="5650991">printer</span><span class="op" id="5650998">.</span><span class="ident" id="5650999">CommentedNode</span><span class="op" id="5651012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651016">if</span>&nbsp;<span class="ident" id="5651019">f</span><span class="op" id="5651020">,</span>&nbsp;<span class="ident" id="5651022">ok</span>&nbsp;<span class="op" id="5651025">:=</span>&nbsp;<span class="ident" id="5651028">n</span><span class="op" id="5651029">.</span><span class="ident" id="5651030">Node</span><span class="op" id="5651034">.</span><span class="op" id="5651035">(</span><span class="op" id="5651036">*</span><span class="ident" id="5651037">ast</span><span class="op" id="5651040">.</span><span class="ident" id="5651041">File</span><span class="op" id="5651045">)</span><span class="op" id="5651046">;</span>&nbsp;<span class="ident" id="5651048">ok</span>&nbsp;<span class="op" id="5651051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651056">file</span>&nbsp;<span class="op" id="5651061">=</span>&nbsp;<span class="ident" id="5651063">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651068">cnode</span>&nbsp;<span class="op" id="5651074">=</span>&nbsp;<span class="ident" id="5651076">n</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651087">//&nbsp;Sort&nbsp;imports&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651118">if</span>&nbsp;<span class="ident" id="5651121">file</span>&nbsp;<span class="op" id="5651126">!=</span>&nbsp;<span class="ident" id="5651129">nil</span>&nbsp;<span class="op" id="5651133">&amp;&amp;</span>&nbsp;<span class="ident" id="5651136">hasUnsortedImports</span><span class="op" id="5651154">(</span><span class="ident" id="5651155">file</span><span class="op" id="5651159">)</span>&nbsp;<span class="op" id="5651161">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651165">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;AST&nbsp;because&nbsp;ast.SortImports&nbsp;is&nbsp;destructive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651233">//&nbsp;TODO(gri)&nbsp;Do&nbsp;this&nbsp;more&nbsp;efficiently.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651274">var</span>&nbsp;<span class="ident" id="5651278">buf</span>&nbsp;<span class="ident" id="5651282">bytes</span><span class="op" id="5651287">.</span><span class="ident" id="5651288">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651297">err</span>&nbsp;<span class="op" id="5651301">:=</span>&nbsp;<span class="ident" id="5651304">config</span><span class="op" id="5651310">.</span><span class="ident" id="5651311">Fprint</span><span class="op" id="5651317">(</span><span class="op" id="5651318">&amp;</span><span class="ident" id="5651319">buf</span><span class="op" id="5651322">,</span>&nbsp;<span class="ident" id="5651324">fset</span><span class="op" id="5651328">,</span>&nbsp;<span class="ident" id="5651330">file</span><span class="op" id="5651334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651338">if</span>&nbsp;<span class="ident" id="5651341">err</span>&nbsp;<span class="op" id="5651345">!=</span>&nbsp;<span class="ident" id="5651348">nil</span>&nbsp;<span class="op" id="5651352">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651357">return</span>&nbsp;<span class="ident" id="5651364">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651374">file</span><span class="op" id="5651378">,</span>&nbsp;<span class="ident" id="5651380">err</span>&nbsp;<span class="op" id="5651384">=</span>&nbsp;<span class="ident" id="5651386">parser</span><span class="op" id="5651392">.</span><span class="ident" id="5651393">ParseFile</span><span class="op" id="5651402">(</span><span class="ident" id="5651403">fset</span><span class="op" id="5651407">,</span>&nbsp;<span class="string" id="5651409">&#34;&#34;</span><span class="op" id="5651411">,</span>&nbsp;<span class="ident" id="5651413">buf</span><span class="op" id="5651416">.</span><span class="ident" id="5651417">Bytes</span><span class="op" id="5651422">(</span><span class="op" id="5651423">)</span><span class="op" id="5651424">,</span>&nbsp;<span class="ident" id="5651426">parserMode</span><span class="op" id="5651436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651440">if</span>&nbsp;<span class="ident" id="5651443">err</span>&nbsp;<span class="op" id="5651447">!=</span>&nbsp;<span class="ident" id="5651450">nil</span>&nbsp;<span class="op" id="5651454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651459">//&nbsp;We&nbsp;should&nbsp;never&nbsp;get&nbsp;here.&nbsp;If&nbsp;we&nbsp;do,&nbsp;provide&nbsp;good&nbsp;diagnostic.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651526">return</span>&nbsp;<span class="ident" id="5651533">fmt</span><span class="op" id="5651536">.</span><span class="ident" id="5651537">Errorf</span><span class="op" id="5651543">(</span><span class="string" id="5651544">&#34;format.Node&nbsp;internal&nbsp;error&nbsp;(%s)&#34;</span><span class="op" id="5651577">,</span>&nbsp;<span class="ident" id="5651579">err</span><span class="op" id="5651582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651590">ast</span><span class="op" id="5651593">.</span><span class="ident" id="5651594">SortImports</span><span class="op" id="5651605">(</span><span class="ident" id="5651606">fset</span><span class="op" id="5651610">,</span>&nbsp;<span class="ident" id="5651612">file</span><span class="op" id="5651616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651621">//&nbsp;Use&nbsp;new&nbsp;file&nbsp;with&nbsp;sorted&nbsp;imports.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651660">node</span>&nbsp;<span class="op" id="5651665">=</span>&nbsp;<span class="ident" id="5651667">file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651674">if</span>&nbsp;<span class="ident" id="5651677">cnode</span>&nbsp;<span class="op" id="5651683">!=</span>&nbsp;<span class="ident" id="5651686">nil</span>&nbsp;<span class="op" id="5651690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651695">node</span>&nbsp;<span class="op" id="5651700">=</span>&nbsp;<span class="op" id="5651702">&amp;</span><span class="ident" id="5651703">printer</span><span class="op" id="5651710">.</span><span class="ident" id="5651711">CommentedNode</span><span class="op" id="5651724">{</span><span class="ident" id="5651725">Node</span><span class="op" id="5651729">:</span>&nbsp;<span class="ident" id="5651731">file</span><span class="op" id="5651735">,</span>&nbsp;<span class="ident" id="5651737">Comments</span><span class="op" id="5651745">:</span>&nbsp;<span class="ident" id="5651747">cnode</span><span class="op" id="5651752">.</span><span class="ident" id="5651753">Comments</span><span class="op" id="5651761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5651768">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5651772">return</span>&nbsp;<span class="ident" id="5651779">config</span><span class="op" id="5651785">.</span><span class="ident" id="5651786">Fprint</span><span class="op" id="5651792">(</span><span class="ident" id="5651793">dst</span><span class="op" id="5651796">,</span>&nbsp;<span class="ident" id="5651798">fset</span><span class="op" id="5651802">,</span>&nbsp;<span class="ident" id="5651804">node</span><span class="op" id="5651808">)</span><br>
<span class="lineno"></span><span class="op" id="5651810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651813">//&nbsp;Source&nbsp;formats&nbsp;src&nbsp;in&nbsp;canonical&nbsp;gofmt&nbsp;style&nbsp;and&nbsp;returns&nbsp;the&nbsp;result</span><br>
<span class="lineno">75</span><span class="comment" id="5651883">//&nbsp;or&nbsp;an&nbsp;(I/O&nbsp;or&nbsp;syntax)&nbsp;error.&nbsp;src&nbsp;is&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;syntactically</span><br>
<span class="lineno"></span><span class="comment" id="5651953">//&nbsp;correct&nbsp;Go&nbsp;source&nbsp;file,&nbsp;or&nbsp;a&nbsp;list&nbsp;of&nbsp;Go&nbsp;declarations&nbsp;or&nbsp;statements.</span><br>
<span class="lineno"></span><span class="comment" id="5652024">//</span><br>
<span class="lineno"></span><span class="comment" id="5652027">//&nbsp;If&nbsp;src&nbsp;is&nbsp;a&nbsp;partial&nbsp;source&nbsp;file,&nbsp;the&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space&nbsp;of&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5652101">//&nbsp;is&nbsp;applied&nbsp;to&nbsp;the&nbsp;result&nbsp;(such&nbsp;that&nbsp;it&nbsp;has&nbsp;the&nbsp;same&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno">80</span><span class="comment" id="5652177">//&nbsp;space&nbsp;as&nbsp;src),&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;indented&nbsp;by&nbsp;the&nbsp;same&nbsp;amount&nbsp;as&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="5652254">//&nbsp;line&nbsp;of&nbsp;src&nbsp;containing&nbsp;code.&nbsp;Imports&nbsp;are&nbsp;not&nbsp;sorted&nbsp;for&nbsp;partial&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5652335">//</span><br>
<span class="lineno"></span><span class="keyword" id="5652338">func</span>&nbsp;<span class="ident" id="5652343">Source</span><span class="op" id="5652349">(</span><span class="ident" id="5652350">src</span>&nbsp;<span class="op" id="5652354">[</span><span class="op" id="5652355">]</span><span class="builtintype" id="5652356">byte</span><span class="op" id="5652360">)</span>&nbsp;<span class="op" id="5652362">(</span><span class="op" id="5652363">[</span><span class="op" id="5652364">]</span><span class="builtintype" id="5652365">byte</span><span class="op" id="5652369">,</span>&nbsp;<span class="builtintype" id="5652371">error</span><span class="op" id="5652376">)</span>&nbsp;<span class="op" id="5652378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652381">fset</span>&nbsp;<span class="op" id="5652386">:=</span>&nbsp;<span class="ident" id="5652389">token</span><span class="op" id="5652394">.</span><span class="ident" id="5652395">NewFileSet</span><span class="op" id="5652405">(</span><span class="op" id="5652406">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652409">file</span><span class="op" id="5652413">,</span>&nbsp;<span class="ident" id="5652415">sourceAdj</span><span class="op" id="5652424">,</span>&nbsp;<span class="ident" id="5652426">indentAdj</span><span class="op" id="5652435">,</span>&nbsp;<span class="ident" id="5652437">err</span>&nbsp;<span class="op" id="5652441">:=</span>&nbsp;<span class="ident" id="5652444">parse</span><span class="op" id="5652449">(</span><span class="ident" id="5652450">fset</span><span class="op" id="5652454">,</span>&nbsp;<span class="string" id="5652456">&#34;&#34;</span><span class="op" id="5652458">,</span>&nbsp;<span class="ident" id="5652460">src</span><span class="op" id="5652463">,</span>&nbsp;<span class="builtintype" id="5652465">true</span><span class="op" id="5652469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652472">if</span>&nbsp;<span class="ident" id="5652475">err</span>&nbsp;<span class="op" id="5652479">!=</span>&nbsp;<span class="ident" id="5652482">nil</span>&nbsp;<span class="op" id="5652486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652490">return</span>&nbsp;<span class="ident" id="5652497">nil</span><span class="op" id="5652500">,</span>&nbsp;<span class="ident" id="5652502">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652511">if</span>&nbsp;<span class="ident" id="5652514">sourceAdj</span>&nbsp;<span class="op" id="5652524">==</span>&nbsp;<span class="ident" id="5652527">nil</span>&nbsp;<span class="op" id="5652531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652535">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652562">//&nbsp;TODO(gri)&nbsp;consider&nbsp;doing&nbsp;this&nbsp;always.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652605">ast</span><span class="op" id="5652608">.</span><span class="ident" id="5652609">SortImports</span><span class="op" id="5652620">(</span><span class="ident" id="5652621">fset</span><span class="op" id="5652625">,</span>&nbsp;<span class="ident" id="5652627">file</span><span class="op" id="5652631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652634">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652638">return</span>&nbsp;<span class="ident" id="5652645">format</span><span class="op" id="5652651">(</span><span class="ident" id="5652652">fset</span><span class="op" id="5652656">,</span>&nbsp;<span class="ident" id="5652658">file</span><span class="op" id="5652662">,</span>&nbsp;<span class="ident" id="5652664">sourceAdj</span><span class="op" id="5652673">,</span>&nbsp;<span class="ident" id="5652675">indentAdj</span><span class="op" id="5652684">,</span>&nbsp;<span class="ident" id="5652686">src</span><span class="op" id="5652689">,</span>&nbsp;<span class="ident" id="5652691">config</span><span class="op" id="5652697">)</span><br>
<span class="lineno"></span><span class="op" id="5652699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5652702">func</span>&nbsp;<span class="ident" id="5652707">hasUnsortedImports</span><span class="op" id="5652725">(</span><span class="ident" id="5652726">file</span>&nbsp;<span class="op" id="5652731">*</span><span class="ident" id="5652732">ast</span><span class="op" id="5652735">.</span><span class="ident" id="5652736">File</span><span class="op" id="5652740">)</span>&nbsp;<span class="builtintype" id="5652742">bool</span>&nbsp;<span class="op" id="5652747">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652750">for</span>&nbsp;<span class="ident" id="5652754">_</span><span class="op" id="5652755">,</span>&nbsp;<span class="ident" id="5652757">d</span>&nbsp;<span class="op" id="5652759">:=</span>&nbsp;<span class="keyword" id="5652762">range</span>&nbsp;<span class="ident" id="5652768">file</span><span class="op" id="5652772">.</span><span class="ident" id="5652773">Decls</span>&nbsp;<span class="op" id="5652779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652783">d</span><span class="op" id="5652784">,</span>&nbsp;<span class="ident" id="5652786">ok</span>&nbsp;<span class="op" id="5652789">:=</span>&nbsp;<span class="ident" id="5652792">d</span><span class="op" id="5652793">.</span><span class="op" id="5652794">(</span><span class="op" id="5652795">*</span><span class="ident" id="5652796">ast</span><span class="op" id="5652799">.</span><span class="ident" id="5652800">GenDecl</span><span class="op" id="5652807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652811">if</span>&nbsp;<span class="op" id="5652814">!</span><span class="ident" id="5652815">ok</span>&nbsp;<span class="op" id="5652818">||</span>&nbsp;<span class="ident" id="5652821">d</span><span class="op" id="5652822">.</span><span class="ident" id="5652823">Tok</span>&nbsp;<span class="op" id="5652827">!=</span>&nbsp;<span class="ident" id="5652830">token</span><span class="op" id="5652835">.</span><span class="ident" id="5652836">IMPORT</span>&nbsp;<span class="op" id="5652843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652848">//&nbsp;Not&nbsp;an&nbsp;import&nbsp;declaration,&nbsp;so&nbsp;we&#39;re&nbsp;done.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652896">//&nbsp;Imports&nbsp;are&nbsp;always&nbsp;first.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652928">return</span>&nbsp;<span class="builtintype" id="5652935">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652947">if</span>&nbsp;<span class="ident" id="5652950">d</span><span class="op" id="5652951">.</span><span class="ident" id="5652952">Lparen</span><span class="op" id="5652958">.</span><span class="ident" id="5652959">IsValid</span><span class="op" id="5652966">(</span><span class="op" id="5652967">)</span>&nbsp;<span class="op" id="5652969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5652974">//&nbsp;For&nbsp;now&nbsp;assume&nbsp;all&nbsp;grouped&nbsp;imports&nbsp;are&nbsp;unsorted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653029">//&nbsp;TODO(gri)&nbsp;Should&nbsp;check&nbsp;if&nbsp;they&nbsp;are&nbsp;sorted&nbsp;already.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653086">return</span>&nbsp;<span class="builtintype" id="5653093">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653104">//&nbsp;Ungrouped&nbsp;imports&nbsp;are&nbsp;sorted&nbsp;by&nbsp;default.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653152">return</span>&nbsp;<span class="builtintype" id="5653159">false</span><br>
<span class="lineno">115</span><span class="op" id="5653165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5653168">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5653248">//&nbsp;Support&nbsp;functions</span><br>
<span class="lineno"></span><span class="comment" id="5653269">//</span><br>
<span class="lineno">120</span><span class="comment" id="5653272">//&nbsp;The&nbsp;functions&nbsp;parse,&nbsp;format,&nbsp;and&nbsp;isSpace&nbsp;below&nbsp;are&nbsp;identical&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5653343">//&nbsp;respective&nbsp;functions&nbsp;in&nbsp;cmd/gofmt/gofmt.go&nbsp;-&nbsp;keep&nbsp;them&nbsp;in&nbsp;sync!</span><br>
<span class="lineno"></span><span class="comment" id="5653410">//</span><br>
<span class="lineno"></span><span class="comment" id="5653413">//&nbsp;TODO(gri)&nbsp;Factor&nbsp;out&nbsp;this&nbsp;functionality,&nbsp;eventually.</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5653470">//&nbsp;parse&nbsp;parses&nbsp;src,&nbsp;which&nbsp;was&nbsp;read&nbsp;from&nbsp;the&nbsp;named&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="5653527">//&nbsp;as&nbsp;a&nbsp;Go&nbsp;source&nbsp;file,&nbsp;declaration,&nbsp;or&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5653583">func</span>&nbsp;<span class="ident" id="5653588">parse</span><span class="op" id="5653593">(</span><span class="ident" id="5653594">fset</span>&nbsp;<span class="op" id="5653599">*</span><span class="ident" id="5653600">token</span><span class="op" id="5653605">.</span><span class="ident" id="5653606">FileSet</span><span class="op" id="5653613">,</span>&nbsp;<span class="ident" id="5653615">filename</span>&nbsp;<span class="builtintype" id="5653624">string</span><span class="op" id="5653630">,</span>&nbsp;<span class="ident" id="5653632">src</span>&nbsp;<span class="op" id="5653636">[</span><span class="op" id="5653637">]</span><span class="builtintype" id="5653638">byte</span><span class="op" id="5653642">,</span>&nbsp;<span class="ident" id="5653644">fragmentOk</span>&nbsp;<span class="builtintype" id="5653655">bool</span><span class="op" id="5653659">)</span>&nbsp;<span class="op" id="5653661">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653664">file</span>&nbsp;<span class="op" id="5653669">*</span><span class="ident" id="5653670">ast</span><span class="op" id="5653673">.</span><span class="ident" id="5653674">File</span><span class="op" id="5653678">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653681">sourceAdj</span>&nbsp;<span class="keyword" id="5653691">func</span><span class="op" id="5653695">(</span><span class="ident" id="5653696">src</span>&nbsp;<span class="op" id="5653700">[</span><span class="op" id="5653701">]</span><span class="builtintype" id="5653702">byte</span><span class="op" id="5653706">,</span>&nbsp;<span class="ident" id="5653708">indent</span>&nbsp;<span class="builtintype" id="5653715">int</span><span class="op" id="5653718">)</span>&nbsp;<span class="op" id="5653720">[</span><span class="op" id="5653721">]</span><span class="builtintype" id="5653722">byte</span><span class="op" id="5653726">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653729">indentAdj</span>&nbsp;<span class="builtintype" id="5653739">int</span><span class="op" id="5653742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653745">err</span>&nbsp;<span class="builtintype" id="5653749">error</span><span class="op" id="5653754">,</span><br>
<span class="lineno"></span><span class="op" id="5653756">)</span>&nbsp;<span class="op" id="5653758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653761">//&nbsp;Try&nbsp;as&nbsp;whole&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653791">file</span><span class="op" id="5653795">,</span>&nbsp;<span class="ident" id="5653797">err</span>&nbsp;<span class="op" id="5653801">=</span>&nbsp;<span class="ident" id="5653803">parser</span><span class="op" id="5653809">.</span><span class="ident" id="5653810">ParseFile</span><span class="op" id="5653819">(</span><span class="ident" id="5653820">fset</span><span class="op" id="5653824">,</span>&nbsp;<span class="ident" id="5653826">filename</span><span class="op" id="5653834">,</span>&nbsp;<span class="ident" id="5653836">src</span><span class="op" id="5653839">,</span>&nbsp;<span class="ident" id="5653841">parserMode</span><span class="op" id="5653851">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653854">//&nbsp;If&nbsp;there&#39;s&nbsp;no&nbsp;error,&nbsp;return.&nbsp;&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5653945">//&nbsp;package&nbsp;line&nbsp;and&nbsp;source&nbsp;fragments&nbsp;are&nbsp;ok,&nbsp;fall&nbsp;through&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654007">//&nbsp;try&nbsp;as&nbsp;a&nbsp;source&nbsp;fragment.&nbsp;&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654074">if</span>&nbsp;<span class="ident" id="5654077">err</span>&nbsp;<span class="op" id="5654081">==</span>&nbsp;<span class="ident" id="5654084">nil</span>&nbsp;<span class="op" id="5654088">||</span>&nbsp;<span class="op" id="5654091">!</span><span class="ident" id="5654092">fragmentOk</span>&nbsp;<span class="op" id="5654103">||</span>&nbsp;<span class="op" id="5654106">!</span><span class="ident" id="5654107">strings</span><span class="op" id="5654114">.</span><span class="ident" id="5654115">Contains</span><span class="op" id="5654123">(</span><span class="ident" id="5654124">err</span><span class="op" id="5654127">.</span><span class="ident" id="5654128">Error</span><span class="op" id="5654133">(</span><span class="op" id="5654134">)</span><span class="op" id="5654135">,</span>&nbsp;<span class="string" id="5654137">&#34;expected&nbsp;&#39;package&#39;&#34;</span><span class="op" id="5654157">)</span>&nbsp;<span class="op" id="5654159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654163">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654175">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;declaration&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654232">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654267">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654329">//&nbsp;in&nbsp;psrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654364">psrc</span>&nbsp;<span class="op" id="5654369">:=</span>&nbsp;<span class="builtinfunc" id="5654372">append</span><span class="op" id="5654378">(</span><span class="op" id="5654379">[</span><span class="op" id="5654380">]</span><span class="builtintype" id="5654381">byte</span><span class="op" id="5654385">(</span><span class="string" id="5654386">&#34;package&nbsp;p;&#34;</span><span class="op" id="5654398">)</span><span class="op" id="5654399">,</span>&nbsp;<span class="ident" id="5654401">src</span><span class="op" id="5654404">...</span><span class="op" id="5654407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654410">file</span><span class="op" id="5654414">,</span>&nbsp;<span class="ident" id="5654416">err</span>&nbsp;<span class="op" id="5654420">=</span>&nbsp;<span class="ident" id="5654422">parser</span><span class="op" id="5654428">.</span><span class="ident" id="5654429">ParseFile</span><span class="op" id="5654438">(</span><span class="ident" id="5654439">fset</span><span class="op" id="5654443">,</span>&nbsp;<span class="ident" id="5654445">filename</span><span class="op" id="5654453">,</span>&nbsp;<span class="ident" id="5654455">psrc</span><span class="op" id="5654459">,</span>&nbsp;<span class="ident" id="5654461">parserMode</span><span class="op" id="5654471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654474">if</span>&nbsp;<span class="ident" id="5654477">err</span>&nbsp;<span class="op" id="5654481">==</span>&nbsp;<span class="ident" id="5654484">nil</span>&nbsp;<span class="op" id="5654488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654492">sourceAdj</span>&nbsp;<span class="op" id="5654502">=</span>&nbsp;<span class="keyword" id="5654504">func</span><span class="op" id="5654508">(</span><span class="ident" id="5654509">src</span>&nbsp;<span class="op" id="5654513">[</span><span class="op" id="5654514">]</span><span class="builtintype" id="5654515">byte</span><span class="op" id="5654519">,</span>&nbsp;<span class="ident" id="5654521">indent</span>&nbsp;<span class="builtintype" id="5654528">int</span><span class="op" id="5654531">)</span>&nbsp;<span class="op" id="5654533">[</span><span class="op" id="5654534">]</span><span class="builtintype" id="5654535">byte</span>&nbsp;<span class="op" id="5654540">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654545">//&nbsp;Remove&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654578">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654618">src</span>&nbsp;<span class="op" id="5654622">=</span>&nbsp;<span class="ident" id="5654624">src</span><span class="op" id="5654627">[</span><span class="ident" id="5654628">indent</span><span class="op" id="5654634">+</span><span class="builtinfunc" id="5654635">len</span><span class="op" id="5654638">(</span><span class="string" id="5654639">&#34;package&nbsp;p\n&#34;</span><span class="op" id="5654652">)</span><span class="op" id="5654653">:</span><span class="op" id="5654654">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654659">return</span>&nbsp;<span class="ident" id="5654666">bytes</span><span class="op" id="5654671">.</span><span class="ident" id="5654672">TrimSpace</span><span class="op" id="5654681">(</span><span class="ident" id="5654682">src</span><span class="op" id="5654685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654689">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654693">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654704">//&nbsp;If&nbsp;the&nbsp;error&nbsp;is&nbsp;that&nbsp;the&nbsp;source&nbsp;file&nbsp;didn&#39;t&nbsp;begin&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654765">//&nbsp;declaration,&nbsp;fall&nbsp;through&nbsp;to&nbsp;try&nbsp;as&nbsp;a&nbsp;statement&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654823">//&nbsp;Stop&nbsp;and&nbsp;return&nbsp;on&nbsp;any&nbsp;other&nbsp;error.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654863">if</span>&nbsp;<span class="op" id="5654866">!</span><span class="ident" id="5654867">strings</span><span class="op" id="5654874">.</span><span class="ident" id="5654875">Contains</span><span class="op" id="5654883">(</span><span class="ident" id="5654884">err</span><span class="op" id="5654887">.</span><span class="ident" id="5654888">Error</span><span class="op" id="5654893">(</span><span class="op" id="5654894">)</span><span class="op" id="5654895">,</span>&nbsp;<span class="string" id="5654897">&#34;expected&nbsp;declaration&#34;</span><span class="op" id="5654919">)</span>&nbsp;<span class="op" id="5654921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654925">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654937">//&nbsp;If&nbsp;this&nbsp;is&nbsp;a&nbsp;statement&nbsp;list,&nbsp;make&nbsp;it&nbsp;a&nbsp;source&nbsp;file</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5654992">//&nbsp;by&nbsp;inserting&nbsp;a&nbsp;package&nbsp;clause&nbsp;and&nbsp;turning&nbsp;the&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655047">//&nbsp;into&nbsp;a&nbsp;function&nbsp;body.&nbsp;&nbsp;This&nbsp;handles&nbsp;expressions&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655104">//&nbsp;Insert&nbsp;using&nbsp;a&nbsp;;,&nbsp;not&nbsp;a&nbsp;newline,&nbsp;so&nbsp;that&nbsp;the&nbsp;line&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655166">//&nbsp;in&nbsp;fsrc&nbsp;match&nbsp;the&nbsp;ones&nbsp;in&nbsp;src.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655201">fsrc</span>&nbsp;<span class="op" id="5655206">:=</span>&nbsp;<span class="builtinfunc" id="5655209">append</span><span class="op" id="5655215">(</span><span class="builtinfunc" id="5655216">append</span><span class="op" id="5655222">(</span><span class="op" id="5655223">[</span><span class="op" id="5655224">]</span><span class="builtintype" id="5655225">byte</span><span class="op" id="5655229">(</span><span class="string" id="5655230">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5655253">)</span><span class="op" id="5655254">,</span>&nbsp;<span class="ident" id="5655256">src</span><span class="op" id="5655259">...</span><span class="op" id="5655262">)</span><span class="op" id="5655263">,</span>&nbsp;<span class="string" id="5655265">&#39;\n&#39;</span><span class="op" id="5655269">,</span>&nbsp;<span class="string" id="5655271">&#39;}&#39;</span><span class="op" id="5655274">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655277">file</span><span class="op" id="5655281">,</span>&nbsp;<span class="ident" id="5655283">err</span>&nbsp;<span class="op" id="5655287">=</span>&nbsp;<span class="ident" id="5655289">parser</span><span class="op" id="5655295">.</span><span class="ident" id="5655296">ParseFile</span><span class="op" id="5655305">(</span><span class="ident" id="5655306">fset</span><span class="op" id="5655310">,</span>&nbsp;<span class="ident" id="5655312">filename</span><span class="op" id="5655320">,</span>&nbsp;<span class="ident" id="5655322">fsrc</span><span class="op" id="5655326">,</span>&nbsp;<span class="ident" id="5655328">parserMode</span><span class="op" id="5655338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655341">if</span>&nbsp;<span class="ident" id="5655344">err</span>&nbsp;<span class="op" id="5655348">==</span>&nbsp;<span class="ident" id="5655351">nil</span>&nbsp;<span class="op" id="5655355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655359">sourceAdj</span>&nbsp;<span class="op" id="5655369">=</span>&nbsp;<span class="keyword" id="5655371">func</span><span class="op" id="5655375">(</span><span class="ident" id="5655376">src</span>&nbsp;<span class="op" id="5655380">[</span><span class="op" id="5655381">]</span><span class="builtintype" id="5655382">byte</span><span class="op" id="5655386">,</span>&nbsp;<span class="ident" id="5655388">indent</span>&nbsp;<span class="builtintype" id="5655395">int</span><span class="op" id="5655398">)</span>&nbsp;<span class="op" id="5655400">[</span><span class="op" id="5655401">]</span><span class="builtintype" id="5655402">byte</span>&nbsp;<span class="op" id="5655407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655412">//&nbsp;Cap&nbsp;adjusted&nbsp;indent&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655447">if</span>&nbsp;<span class="ident" id="5655450">indent</span>&nbsp;<span class="op" id="5655457">&lt;</span>&nbsp;<span class="num" id="5655459">0</span>&nbsp;<span class="op" id="5655461">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655467">indent</span>&nbsp;<span class="op" id="5655474">=</span>&nbsp;<span class="num" id="5655476">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655486">//&nbsp;Remove&nbsp;the&nbsp;wrapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655513">//&nbsp;Gofmt&nbsp;has&nbsp;turned&nbsp;the&nbsp;;&nbsp;into&nbsp;a&nbsp;\n\n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655555">//&nbsp;There&nbsp;will&nbsp;be&nbsp;two&nbsp;non-blank&nbsp;lines&nbsp;with&nbsp;indent,&nbsp;hence&nbsp;2*indent.</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655624">src</span>&nbsp;<span class="op" id="5655628">=</span>&nbsp;<span class="ident" id="5655630">src</span><span class="op" id="5655633">[</span><span class="num" id="5655634">2</span><span class="op" id="5655635">*</span><span class="ident" id="5655636">indent</span><span class="op" id="5655642">+</span><span class="builtinfunc" id="5655643">len</span><span class="op" id="5655646">(</span><span class="string" id="5655647">&#34;package&nbsp;p\n\nfunc&nbsp;_()&nbsp;{&#34;</span><span class="op" id="5655672">)</span><span class="op" id="5655673">:</span><span class="op" id="5655674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655679">src</span>&nbsp;<span class="op" id="5655683">=</span>&nbsp;<span class="ident" id="5655685">src</span><span class="op" id="5655688">[</span><span class="op" id="5655689">:</span><span class="builtinfunc" id="5655690">len</span><span class="op" id="5655693">(</span><span class="ident" id="5655694">src</span><span class="op" id="5655697">)</span><span class="op" id="5655698">-</span><span class="op" id="5655699">(</span><span class="ident" id="5655700">indent</span><span class="op" id="5655706">+</span><span class="builtinfunc" id="5655707">len</span><span class="op" id="5655710">(</span><span class="string" id="5655711">&#34;\n}\n&#34;</span><span class="op" id="5655718">)</span><span class="op" id="5655719">)</span><span class="op" id="5655720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655725">return</span>&nbsp;<span class="ident" id="5655732">bytes</span><span class="op" id="5655737">.</span><span class="ident" id="5655738">TrimSpace</span><span class="op" id="5655747">(</span><span class="ident" id="5655748">src</span><span class="op" id="5655751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655759">//&nbsp;Gofmt&nbsp;has&nbsp;also&nbsp;indented&nbsp;the&nbsp;function&nbsp;body&nbsp;one&nbsp;level.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655817">//&nbsp;Adjust&nbsp;that&nbsp;with&nbsp;indentAdj.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655850">indentAdj</span>&nbsp;<span class="op" id="5655860">=</span>&nbsp;<span class="op" id="5655862">-</span><span class="num" id="5655863">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5655870">//&nbsp;Succeeded,&nbsp;or&nbsp;out&nbsp;of&nbsp;options.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655904">return</span><br>
<span class="lineno"></span><span class="op" id="5655911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5655914">//&nbsp;format&nbsp;formats&nbsp;the&nbsp;given&nbsp;package&nbsp;file&nbsp;originally&nbsp;obtained&nbsp;from&nbsp;src</span><br>
<span class="lineno"></span><span class="comment" id="5655984">//&nbsp;and&nbsp;adjusts&nbsp;the&nbsp;result&nbsp;based&nbsp;on&nbsp;the&nbsp;original&nbsp;source&nbsp;via&nbsp;sourceAdj</span><br>
<span class="lineno">195</span><span class="comment" id="5656053">//&nbsp;and&nbsp;indentAdj.</span><br>
<span class="lineno"></span><span class="keyword" id="5656071">func</span>&nbsp;<span class="ident" id="5656076">format</span><span class="op" id="5656082">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656085">fset</span>&nbsp;<span class="op" id="5656090">*</span><span class="ident" id="5656091">token</span><span class="op" id="5656096">.</span><span class="ident" id="5656097">FileSet</span><span class="op" id="5656104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656107">file</span>&nbsp;<span class="op" id="5656112">*</span><span class="ident" id="5656113">ast</span><span class="op" id="5656116">.</span><span class="ident" id="5656117">File</span><span class="op" id="5656121">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656124">sourceAdj</span>&nbsp;<span class="keyword" id="5656134">func</span><span class="op" id="5656138">(</span><span class="ident" id="5656139">src</span>&nbsp;<span class="op" id="5656143">[</span><span class="op" id="5656144">]</span><span class="builtintype" id="5656145">byte</span><span class="op" id="5656149">,</span>&nbsp;<span class="ident" id="5656151">indent</span>&nbsp;<span class="builtintype" id="5656158">int</span><span class="op" id="5656161">)</span>&nbsp;<span class="op" id="5656163">[</span><span class="op" id="5656164">]</span><span class="builtintype" id="5656165">byte</span><span class="op" id="5656169">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656172">indentAdj</span>&nbsp;<span class="builtintype" id="5656182">int</span><span class="op" id="5656185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656188">src</span>&nbsp;<span class="op" id="5656192">[</span><span class="op" id="5656193">]</span><span class="builtintype" id="5656194">byte</span><span class="op" id="5656198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656201">cfg</span>&nbsp;<span class="ident" id="5656205">printer</span><span class="op" id="5656212">.</span><span class="ident" id="5656213">Config</span><span class="op" id="5656219">,</span><br>
<span class="lineno"></span><span class="op" id="5656221">)</span>&nbsp;<span class="op" id="5656223">(</span><span class="op" id="5656224">[</span><span class="op" id="5656225">]</span><span class="builtintype" id="5656226">byte</span><span class="op" id="5656230">,</span>&nbsp;<span class="builtintype" id="5656232">error</span><span class="op" id="5656237">)</span>&nbsp;<span class="op" id="5656239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656242">if</span>&nbsp;<span class="ident" id="5656245">sourceAdj</span>&nbsp;<span class="op" id="5656255">==</span>&nbsp;<span class="ident" id="5656258">nil</span>&nbsp;<span class="op" id="5656262">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656266">//&nbsp;Complete&nbsp;source&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656293">var</span>&nbsp;<span class="ident" id="5656297">buf</span>&nbsp;<span class="ident" id="5656301">bytes</span><span class="op" id="5656306">.</span><span class="ident" id="5656307">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656316">err</span>&nbsp;<span class="op" id="5656320">:=</span>&nbsp;<span class="ident" id="5656323">cfg</span><span class="op" id="5656326">.</span><span class="ident" id="5656327">Fprint</span><span class="op" id="5656333">(</span><span class="op" id="5656334">&amp;</span><span class="ident" id="5656335">buf</span><span class="op" id="5656338">,</span>&nbsp;<span class="ident" id="5656340">fset</span><span class="op" id="5656344">,</span>&nbsp;<span class="ident" id="5656346">file</span><span class="op" id="5656350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656354">if</span>&nbsp;<span class="ident" id="5656357">err</span>&nbsp;<span class="op" id="5656361">!=</span>&nbsp;<span class="ident" id="5656364">nil</span>&nbsp;<span class="op" id="5656368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656373">return</span>&nbsp;<span class="ident" id="5656380">nil</span><span class="op" id="5656383">,</span>&nbsp;<span class="ident" id="5656385">err</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656395">return</span>&nbsp;<span class="ident" id="5656402">buf</span><span class="op" id="5656405">.</span><span class="ident" id="5656406">Bytes</span><span class="op" id="5656411">(</span><span class="op" id="5656412">)</span><span class="op" id="5656413">,</span>&nbsp;<span class="ident" id="5656415">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656424">//&nbsp;Partial&nbsp;source&nbsp;file.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656449">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;leading&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656490">i</span><span class="op" id="5656491">,</span>&nbsp;<span class="ident" id="5656493">j</span>&nbsp;<span class="op" id="5656495">:=</span>&nbsp;<span class="num" id="5656498">0</span><span class="op" id="5656499">,</span>&nbsp;<span class="num" id="5656501">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656504">for</span>&nbsp;<span class="ident" id="5656508">j</span>&nbsp;<span class="op" id="5656510">&lt;</span>&nbsp;<span class="builtinfunc" id="5656512">len</span><span class="op" id="5656515">(</span><span class="ident" id="5656516">src</span><span class="op" id="5656519">)</span>&nbsp;<span class="op" id="5656521">&amp;&amp;</span>&nbsp;<span class="ident" id="5656524">isSpace</span><span class="op" id="5656531">(</span><span class="ident" id="5656532">src</span><span class="op" id="5656535">[</span><span class="ident" id="5656536">j</span><span class="op" id="5656537">]</span><span class="op" id="5656538">)</span>&nbsp;<span class="op" id="5656540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656544">if</span>&nbsp;<span class="ident" id="5656547">src</span><span class="op" id="5656550">[</span><span class="ident" id="5656551">j</span><span class="op" id="5656552">]</span>&nbsp;<span class="op" id="5656554">==</span>&nbsp;<span class="string" id="5656557">&#39;\n&#39;</span>&nbsp;<span class="op" id="5656562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656567">i</span>&nbsp;<span class="op" id="5656569">=</span>&nbsp;<span class="ident" id="5656571">j</span>&nbsp;<span class="op" id="5656573">+</span>&nbsp;<span class="num" id="5656575">1</span>&nbsp;<span class="comment" id="5656577">//&nbsp;byte&nbsp;offset&nbsp;of&nbsp;last&nbsp;line&nbsp;in&nbsp;leading&nbsp;space</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656628">j</span><span class="op" id="5656629">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656636">var</span>&nbsp;<span class="ident" id="5656640">res</span>&nbsp;<span class="op" id="5656644">[</span><span class="op" id="5656645">]</span><span class="builtintype" id="5656646">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656652">res</span>&nbsp;<span class="op" id="5656656">=</span>&nbsp;<span class="builtinfunc" id="5656658">append</span><span class="op" id="5656664">(</span><span class="ident" id="5656665">res</span><span class="op" id="5656668">,</span>&nbsp;<span class="ident" id="5656670">src</span><span class="op" id="5656673">[</span><span class="op" id="5656674">:</span><span class="ident" id="5656675">i</span><span class="op" id="5656676">]</span><span class="op" id="5656677">...</span><span class="op" id="5656680">)</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656684">//&nbsp;Determine&nbsp;and&nbsp;prepend&nbsp;indentation&nbsp;of&nbsp;first&nbsp;code&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656742">//&nbsp;Spaces&nbsp;are&nbsp;ignored&nbsp;unless&nbsp;there&nbsp;are&nbsp;no&nbsp;tabs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656791">//&nbsp;in&nbsp;which&nbsp;case&nbsp;spaces&nbsp;count&nbsp;as&nbsp;one&nbsp;tab.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656834">indent</span>&nbsp;<span class="op" id="5656841">:=</span>&nbsp;<span class="num" id="5656844">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656847">hasSpace</span>&nbsp;<span class="op" id="5656856">:=</span>&nbsp;<span class="builtintype" id="5656859">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656866">for</span>&nbsp;<span class="ident" id="5656870">_</span><span class="op" id="5656871">,</span>&nbsp;<span class="ident" id="5656873">b</span>&nbsp;<span class="op" id="5656875">:=</span>&nbsp;<span class="keyword" id="5656878">range</span>&nbsp;<span class="ident" id="5656884">src</span><span class="op" id="5656887">[</span><span class="ident" id="5656888">i</span><span class="op" id="5656889">:</span><span class="ident" id="5656890">j</span><span class="op" id="5656891">]</span>&nbsp;<span class="op" id="5656893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656897">switch</span>&nbsp;<span class="ident" id="5656904">b</span>&nbsp;<span class="op" id="5656906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656910">case</span>&nbsp;<span class="string" id="5656915">&#39;&nbsp;&#39;</span><span class="op" id="5656918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656923">hasSpace</span>&nbsp;<span class="op" id="5656932">=</span>&nbsp;<span class="builtintype" id="5656934">true</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656941">case</span>&nbsp;<span class="string" id="5656946">&#39;\t&#39;</span><span class="op" id="5656950">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656955">indent</span><span class="op" id="5656961">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656972">if</span>&nbsp;<span class="ident" id="5656975">indent</span>&nbsp;<span class="op" id="5656982">==</span>&nbsp;<span class="num" id="5656985">0</span>&nbsp;<span class="op" id="5656987">&amp;&amp;</span>&nbsp;<span class="ident" id="5656990">hasSpace</span>&nbsp;<span class="op" id="5656999">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657003">indent</span>&nbsp;<span class="op" id="5657010">=</span>&nbsp;<span class="num" id="5657012">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657018">for</span>&nbsp;<span class="ident" id="5657022">i</span>&nbsp;<span class="op" id="5657024">:=</span>&nbsp;<span class="num" id="5657027">0</span><span class="op" id="5657028">;</span>&nbsp;<span class="ident" id="5657030">i</span>&nbsp;<span class="op" id="5657032">&lt;</span>&nbsp;<span class="ident" id="5657034">indent</span><span class="op" id="5657040">;</span>&nbsp;<span class="ident" id="5657042">i</span><span class="op" id="5657043">++</span>&nbsp;<span class="op" id="5657046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657050">res</span>&nbsp;<span class="op" id="5657054">=</span>&nbsp;<span class="builtinfunc" id="5657056">append</span><span class="op" id="5657062">(</span><span class="ident" id="5657063">res</span><span class="op" id="5657066">,</span>&nbsp;<span class="string" id="5657068">&#39;\t&#39;</span><span class="op" id="5657072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657075">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5657079">//&nbsp;Format&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5657102">//&nbsp;Write&nbsp;it&nbsp;without&nbsp;any&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657155">cfg</span><span class="op" id="5657158">.</span><span class="ident" id="5657159">Indent</span>&nbsp;<span class="op" id="5657166">=</span>&nbsp;<span class="ident" id="5657168">indent</span>&nbsp;<span class="op" id="5657175">+</span>&nbsp;<span class="ident" id="5657177">indentAdj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657188">var</span>&nbsp;<span class="ident" id="5657192">buf</span>&nbsp;<span class="ident" id="5657196">bytes</span><span class="op" id="5657201">.</span><span class="ident" id="5657202">Buffer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657210">err</span>&nbsp;<span class="op" id="5657214">:=</span>&nbsp;<span class="ident" id="5657217">cfg</span><span class="op" id="5657220">.</span><span class="ident" id="5657221">Fprint</span><span class="op" id="5657227">(</span><span class="op" id="5657228">&amp;</span><span class="ident" id="5657229">buf</span><span class="op" id="5657232">,</span>&nbsp;<span class="ident" id="5657234">fset</span><span class="op" id="5657238">,</span>&nbsp;<span class="ident" id="5657240">file</span><span class="op" id="5657244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657247">if</span>&nbsp;<span class="ident" id="5657250">err</span>&nbsp;<span class="op" id="5657254">!=</span>&nbsp;<span class="ident" id="5657257">nil</span>&nbsp;<span class="op" id="5657261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657265">return</span>&nbsp;<span class="ident" id="5657272">nil</span><span class="op" id="5657275">,</span>&nbsp;<span class="ident" id="5657277">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657285">res</span>&nbsp;<span class="op" id="5657289">=</span>&nbsp;<span class="builtinfunc" id="5657291">append</span><span class="op" id="5657297">(</span><span class="ident" id="5657298">res</span><span class="op" id="5657301">,</span>&nbsp;<span class="ident" id="5657303">sourceAdj</span><span class="op" id="5657312">(</span><span class="ident" id="5657313">buf</span><span class="op" id="5657316">.</span><span class="ident" id="5657317">Bytes</span><span class="op" id="5657322">(</span><span class="op" id="5657323">)</span><span class="op" id="5657324">,</span>&nbsp;<span class="ident" id="5657326">cfg</span><span class="op" id="5657329">.</span><span class="ident" id="5657330">Indent</span><span class="op" id="5657336">)</span><span class="op" id="5657337">...</span><span class="op" id="5657340">)</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5657344">//&nbsp;Determine&nbsp;and&nbsp;append&nbsp;trailing&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657385">i</span>&nbsp;<span class="op" id="5657387">=</span>&nbsp;<span class="builtinfunc" id="5657389">len</span><span class="op" id="5657392">(</span><span class="ident" id="5657393">src</span><span class="op" id="5657396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657399">for</span>&nbsp;<span class="ident" id="5657403">i</span>&nbsp;<span class="op" id="5657405">&gt;</span>&nbsp;<span class="num" id="5657407">0</span>&nbsp;<span class="op" id="5657409">&amp;&amp;</span>&nbsp;<span class="ident" id="5657412">isSpace</span><span class="op" id="5657419">(</span><span class="ident" id="5657420">src</span><span class="op" id="5657423">[</span><span class="ident" id="5657424">i</span><span class="op" id="5657425">-</span><span class="num" id="5657426">1</span><span class="op" id="5657427">]</span><span class="op" id="5657428">)</span>&nbsp;<span class="op" id="5657430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657434">i</span><span class="op" id="5657435">--</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657442">return</span>&nbsp;<span class="builtinfunc" id="5657449">append</span><span class="op" id="5657455">(</span><span class="ident" id="5657456">res</span><span class="op" id="5657459">,</span>&nbsp;<span class="ident" id="5657461">src</span><span class="op" id="5657464">[</span><span class="ident" id="5657465">i</span><span class="op" id="5657466">:</span><span class="op" id="5657467">]</span><span class="op" id="5657468">...</span><span class="op" id="5657471">)</span><span class="op" id="5657472">,</span>&nbsp;<span class="ident" id="5657474">nil</span><br>
<span class="lineno"></span><span class="op" id="5657478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5657481">func</span>&nbsp;<span class="ident" id="5657486">isSpace</span><span class="op" id="5657493">(</span><span class="ident" id="5657494">b</span>&nbsp;<span class="builtintype" id="5657496">byte</span><span class="op" id="5657500">)</span>&nbsp;<span class="builtintype" id="5657502">bool</span>&nbsp;<span class="op" id="5657507">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657510">return</span>&nbsp;<span class="ident" id="5657517">b</span>&nbsp;<span class="op" id="5657519">==</span>&nbsp;<span class="string" id="5657522">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="5657526">||</span>&nbsp;<span class="ident" id="5657529">b</span>&nbsp;<span class="op" id="5657531">==</span>&nbsp;<span class="string" id="5657534">&#39;\t&#39;</span>&nbsp;<span class="op" id="5657539">||</span>&nbsp;<span class="ident" id="5657542">b</span>&nbsp;<span class="op" id="5657544">==</span>&nbsp;<span class="string" id="5657547">&#39;\n&#39;</span>&nbsp;<span class="op" id="5657552">||</span>&nbsp;<span class="ident" id="5657555">b</span>&nbsp;<span class="op" id="5657557">==</span>&nbsp;<span class="string" id="5657560">&#39;\r&#39;</span><br>
<span class="lineno"></span><span class="op" id="5657565">}</span>
</div>
</body>
</html>
