<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7269502">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7269557">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7269611">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7269662">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;parser&nbsp;test&nbsp;harness.&nbsp;The&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata</span><br>
<span class="lineno"></span><span class="comment" id="7269735">//&nbsp;directory&nbsp;are&nbsp;parsed&nbsp;and&nbsp;the&nbsp;errors&nbsp;reported&nbsp;are&nbsp;compared&nbsp;against&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7269808">//&nbsp;error&nbsp;messages&nbsp;expected&nbsp;in&nbsp;the&nbsp;test&nbsp;files.&nbsp;The&nbsp;test&nbsp;files&nbsp;must&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="7269881">//&nbsp;.src&nbsp;rather&nbsp;than&nbsp;.go&nbsp;so&nbsp;that&nbsp;they&nbsp;are&nbsp;not&nbsp;disturbed&nbsp;by&nbsp;gofmt&nbsp;runs.</span><br>
<span class="lineno"></span><span class="comment" id="7269951">//</span><br>
<span class="lineno">10</span><span class="comment" id="7269954">//&nbsp;Expected&nbsp;errors&nbsp;are&nbsp;indicated&nbsp;in&nbsp;the&nbsp;test&nbsp;files&nbsp;by&nbsp;putting&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span><span class="comment" id="7270026">//&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;immediately&nbsp;following&nbsp;an&nbsp;offending&nbsp;token.</span><br>
<span class="lineno"></span><span class="comment" id="7270100">//&nbsp;The&nbsp;harness&nbsp;will&nbsp;verify&nbsp;that&nbsp;an&nbsp;error&nbsp;matching&nbsp;the&nbsp;regular&nbsp;expression</span><br>
<span class="lineno"></span><span class="comment" id="7270173">//&nbsp;rx&nbsp;is&nbsp;reported&nbsp;at&nbsp;that&nbsp;source&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="7270216">//</span><br>
<span class="lineno">15</span><span class="comment" id="7270219">//&nbsp;For&nbsp;instance,&nbsp;the&nbsp;following&nbsp;test&nbsp;file&nbsp;indicates&nbsp;that&nbsp;a&nbsp;&#34;not&nbsp;declared&#34;</span><br>
<span class="lineno"></span><span class="comment" id="7270292">//&nbsp;error&nbsp;should&nbsp;be&nbsp;reported&nbsp;for&nbsp;the&nbsp;undeclared&nbsp;variable&nbsp;x:</span><br>
<span class="lineno"></span><span class="comment" id="7270351">//</span><br>
<span class="lineno"></span><span class="comment" id="7270354">//&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="7270367">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;f()&nbsp;{</span><br>
<span class="lineno">20</span><span class="comment" id="7270381">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp_&nbsp;=&nbsp;x&nbsp;/*&nbsp;ERROR&nbsp;&#34;not&nbsp;declared&#34;&nbsp;*/&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="7270422">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7270428">package</span>&nbsp;<span class="ident" id="7270436">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7270444">import</span>&nbsp;<span class="op" id="7270451">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270454">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270468">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270480">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270493">&#34;path/filepath&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270510">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270520">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7270531">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7270541">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="7270544">const</span>&nbsp;<span class="ident" id="7270550">testdata</span>&nbsp;<span class="op" id="7270559">=</span>&nbsp;<span class="string" id="7270561">&#34;testdata&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7270573">var</span>&nbsp;<span class="ident" id="7270577">fsetErrs</span>&nbsp;<span class="op" id="7270586">=</span>&nbsp;<span class="ident" id="7270588">token</span><span class="op" id="7270593">.</span><span class="ident" id="7270594">NewFileSet</span><span class="op" id="7270604">(</span><span class="op" id="7270605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7270608">//&nbsp;getFile&nbsp;assumes&nbsp;that&nbsp;each&nbsp;filename&nbsp;occurs&nbsp;at&nbsp;most&nbsp;once</span><br>
<span class="lineno">40</span><span class="keyword" id="7270666">func</span>&nbsp;<span class="ident" id="7270671">getFile</span><span class="op" id="7270678">(</span><span class="ident" id="7270679">filename</span>&nbsp;<span class="builtintype" id="7270688">string</span><span class="op" id="7270694">)</span>&nbsp;<span class="op" id="7270696">(</span><span class="ident" id="7270697">file</span>&nbsp;<span class="op" id="7270702">*</span><span class="ident" id="7270703">token</span><span class="op" id="7270708">.</span><span class="ident" id="7270709">File</span><span class="op" id="7270713">)</span>&nbsp;<span class="op" id="7270715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270718">fsetErrs</span><span class="op" id="7270726">.</span><span class="ident" id="7270727">Iterate</span><span class="op" id="7270734">(</span><span class="keyword" id="7270735">func</span><span class="op" id="7270739">(</span><span class="ident" id="7270740">f</span>&nbsp;<span class="op" id="7270742">*</span><span class="ident" id="7270743">token</span><span class="op" id="7270748">.</span><span class="ident" id="7270749">File</span><span class="op" id="7270753">)</span>&nbsp;<span class="builtintype" id="7270755">bool</span>&nbsp;<span class="op" id="7270760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270764">if</span>&nbsp;<span class="ident" id="7270767">f</span><span class="op" id="7270768">.</span><span class="ident" id="7270769">Name</span><span class="op" id="7270773">(</span><span class="op" id="7270774">)</span>&nbsp;<span class="op" id="7270776">==</span>&nbsp;<span class="ident" id="7270779">filename</span>&nbsp;<span class="op" id="7270788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270793">if</span>&nbsp;<span class="ident" id="7270796">file</span>&nbsp;<span class="op" id="7270801">!=</span>&nbsp;<span class="ident" id="7270804">nil</span>&nbsp;<span class="op" id="7270808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7270814">panic</span><span class="op" id="7270819">(</span><span class="ident" id="7270820">filename</span>&nbsp;<span class="op" id="7270829">+</span>&nbsp;<span class="string" id="7270831">&#34;&nbsp;used&nbsp;multiple&nbsp;times&#34;</span><span class="op" id="7270853">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7270863">file</span>&nbsp;<span class="op" id="7270868">=</span>&nbsp;<span class="ident" id="7270870">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270878">return</span>&nbsp;<span class="builtintype" id="7270885">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7270891">}</span><span class="op" id="7270892">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270895">return</span>&nbsp;<span class="ident" id="7270902">file</span><br>
<span class="lineno"></span><span class="op" id="7270907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7270910">func</span>&nbsp;<span class="ident" id="7270915">getPos</span><span class="op" id="7270921">(</span><span class="ident" id="7270922">filename</span>&nbsp;<span class="builtintype" id="7270931">string</span><span class="op" id="7270937">,</span>&nbsp;<span class="ident" id="7270939">offset</span>&nbsp;<span class="builtintype" id="7270946">int</span><span class="op" id="7270949">)</span>&nbsp;<span class="ident" id="7270951">token</span><span class="op" id="7270956">.</span><span class="ident" id="7270957">Pos</span>&nbsp;<span class="op" id="7270961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7270964">if</span>&nbsp;<span class="ident" id="7270967">f</span>&nbsp;<span class="op" id="7270969">:=</span>&nbsp;<span class="ident" id="7270972">getFile</span><span class="op" id="7270979">(</span><span class="ident" id="7270980">filename</span><span class="op" id="7270988">)</span><span class="op" id="7270989">;</span>&nbsp;<span class="ident" id="7270991">f</span>&nbsp;<span class="op" id="7270993">!=</span>&nbsp;<span class="ident" id="7270996">nil</span>&nbsp;<span class="op" id="7271000">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271004">return</span>&nbsp;<span class="ident" id="7271011">f</span><span class="op" id="7271012">.</span><span class="ident" id="7271013">Pos</span><span class="op" id="7271016">(</span><span class="ident" id="7271017">offset</span><span class="op" id="7271023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7271026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271029">return</span>&nbsp;<span class="ident" id="7271036">token</span><span class="op" id="7271041">.</span><span class="ident" id="7271042">NoPos</span><br>
<span class="lineno"></span><span class="op" id="7271048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="7271051">//&nbsp;ERROR&nbsp;comments&nbsp;must&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;and&nbsp;rx&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="7271116">//&nbsp;a&nbsp;regular&nbsp;expression&nbsp;that&nbsp;matches&nbsp;the&nbsp;expected&nbsp;error&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="7271181">//&nbsp;The&nbsp;special&nbsp;form&nbsp;/*&nbsp;ERROR&nbsp;HERE&nbsp;&#34;rx&#34;&nbsp;*/&nbsp;must&nbsp;be&nbsp;used&nbsp;for&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="7271246">//&nbsp;messages&nbsp;that&nbsp;appear&nbsp;immediately&nbsp;after&nbsp;a&nbsp;token,&nbsp;rather&nbsp;than&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="7271312">//&nbsp;a&nbsp;token&#39;s&nbsp;position.</span><br>
<span class="lineno">65</span><span class="comment" id="7271335">//</span><br>
<span class="lineno"></span><span class="keyword" id="7271338">var</span>&nbsp;<span class="ident" id="7271342">errRx</span>&nbsp;<span class="op" id="7271348">=</span>&nbsp;<span class="ident" id="7271350">regexp</span><span class="op" id="7271356">.</span><span class="ident" id="7271357">MustCompile</span><span class="op" id="7271368">(</span><span class="string" id="7271369">`^/\*&nbsp;*ERROR&nbsp;*(HERE)?&nbsp;*&#34;([^&#34;]*)&#34;&nbsp;*\*/$`</span><span class="op" id="7271408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7271411">//&nbsp;expectedErrors&nbsp;collects&nbsp;the&nbsp;regular&nbsp;expressions&nbsp;of&nbsp;ERROR&nbsp;comments&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="7271486">//&nbsp;in&nbsp;files&nbsp;and&nbsp;returns&nbsp;them&nbsp;as&nbsp;a&nbsp;map&nbsp;of&nbsp;error&nbsp;positions&nbsp;to&nbsp;error&nbsp;messages.</span><br>
<span class="lineno">70</span><span class="comment" id="7271562">//</span><br>
<span class="lineno"></span><span class="keyword" id="7271565">func</span>&nbsp;<span class="ident" id="7271570">expectedErrors</span><span class="op" id="7271584">(</span><span class="ident" id="7271585">t</span>&nbsp;<span class="op" id="7271587">*</span><span class="ident" id="7271588">testing</span><span class="op" id="7271595">.</span><span class="ident" id="7271596">T</span><span class="op" id="7271597">,</span>&nbsp;<span class="ident" id="7271599">filename</span>&nbsp;<span class="builtintype" id="7271608">string</span><span class="op" id="7271614">,</span>&nbsp;<span class="ident" id="7271616">src</span>&nbsp;<span class="op" id="7271620">[</span><span class="op" id="7271621">]</span><span class="builtintype" id="7271622">byte</span><span class="op" id="7271626">)</span>&nbsp;<span class="keyword" id="7271628">map</span><span class="op" id="7271631">[</span><span class="ident" id="7271632">token</span><span class="op" id="7271637">.</span><span class="ident" id="7271638">Pos</span><span class="op" id="7271641">]</span><span class="builtintype" id="7271642">string</span>&nbsp;<span class="op" id="7271649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271652">errors</span>&nbsp;<span class="op" id="7271659">:=</span>&nbsp;<span class="builtinfunc" id="7271662">make</span><span class="op" id="7271666">(</span><span class="keyword" id="7271667">map</span><span class="op" id="7271670">[</span><span class="ident" id="7271671">token</span><span class="op" id="7271676">.</span><span class="ident" id="7271677">Pos</span><span class="op" id="7271680">]</span><span class="builtintype" id="7271681">string</span><span class="op" id="7271687">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271691">var</span>&nbsp;<span class="ident" id="7271695">s</span>&nbsp;<span class="ident" id="7271697">scanner</span><span class="op" id="7271704">.</span><span class="ident" id="7271705">Scanner</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7271714">//&nbsp;file&nbsp;was&nbsp;parsed&nbsp;already&nbsp;-&nbsp;do&nbsp;not&nbsp;add&nbsp;it&nbsp;again&nbsp;to&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7271776">//&nbsp;set&nbsp;otherwise&nbsp;the&nbsp;position&nbsp;information&nbsp;returned&nbsp;here&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7271838">//&nbsp;not&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;collected&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7271901">s</span><span class="op" id="7271902">.</span><span class="ident" id="7271903">Init</span><span class="op" id="7271907">(</span><span class="ident" id="7271908">getFile</span><span class="op" id="7271915">(</span><span class="ident" id="7271916">filename</span><span class="op" id="7271924">)</span><span class="op" id="7271925">,</span>&nbsp;<span class="ident" id="7271927">src</span><span class="op" id="7271930">,</span>&nbsp;<span class="ident" id="7271932">nil</span><span class="op" id="7271935">,</span>&nbsp;<span class="ident" id="7271937">scanner</span><span class="op" id="7271944">.</span><span class="ident" id="7271945">ScanComments</span><span class="op" id="7271957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7271960">var</span>&nbsp;<span class="ident" id="7271964">prev</span>&nbsp;<span class="ident" id="7271969">token</span><span class="op" id="7271974">.</span><span class="ident" id="7271975">Pos</span>&nbsp;<span class="comment" id="7271979">//&nbsp;position&nbsp;of&nbsp;last&nbsp;non-comment,&nbsp;non-semicolon&nbsp;token</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272033">var</span>&nbsp;<span class="ident" id="7272037">here</span>&nbsp;<span class="ident" id="7272042">token</span><span class="op" id="7272047">.</span><span class="ident" id="7272048">Pos</span>&nbsp;<span class="comment" id="7272052">//&nbsp;position&nbsp;immediately&nbsp;after&nbsp;the&nbsp;token&nbsp;at&nbsp;position&nbsp;prev</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272111">for</span>&nbsp;<span class="op" id="7272115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272119">pos</span><span class="op" id="7272122">,</span>&nbsp;<span class="ident" id="7272124">tok</span><span class="op" id="7272127">,</span>&nbsp;<span class="ident" id="7272129">lit</span>&nbsp;<span class="op" id="7272133">:=</span>&nbsp;<span class="ident" id="7272136">s</span><span class="op" id="7272137">.</span><span class="ident" id="7272138">Scan</span><span class="op" id="7272142">(</span><span class="op" id="7272143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272147">switch</span>&nbsp;<span class="ident" id="7272154">tok</span>&nbsp;<span class="op" id="7272158">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272162">case</span>&nbsp;<span class="ident" id="7272167">token</span><span class="op" id="7272172">.</span><span class="ident" id="7272173">EOF</span><span class="op" id="7272176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272181">return</span>&nbsp;<span class="ident" id="7272188">errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272197">case</span>&nbsp;<span class="ident" id="7272202">token</span><span class="op" id="7272207">.</span><span class="ident" id="7272208">COMMENT</span><span class="op" id="7272215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272220">s</span>&nbsp;<span class="op" id="7272222">:=</span>&nbsp;<span class="ident" id="7272225">errRx</span><span class="op" id="7272230">.</span><span class="ident" id="7272231">FindStringSubmatch</span><span class="op" id="7272249">(</span><span class="ident" id="7272250">lit</span><span class="op" id="7272253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272258">if</span>&nbsp;<span class="builtinfunc" id="7272261">len</span><span class="op" id="7272264">(</span><span class="ident" id="7272265">s</span><span class="op" id="7272266">)</span>&nbsp;<span class="op" id="7272268">==</span>&nbsp;<span class="num" id="7272271">3</span>&nbsp;<span class="op" id="7272273">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272279">pos</span>&nbsp;<span class="op" id="7272283">:=</span>&nbsp;<span class="ident" id="7272286">prev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272295">if</span>&nbsp;<span class="ident" id="7272298">s</span><span class="op" id="7272299">[</span><span class="num" id="7272300">1</span><span class="op" id="7272301">]</span>&nbsp;<span class="op" id="7272303">==</span>&nbsp;<span class="string" id="7272306">&#34;HERE&#34;</span>&nbsp;<span class="op" id="7272313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272320">pos</span>&nbsp;<span class="op" id="7272324">=</span>&nbsp;<span class="ident" id="7272326">here</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272341">errors</span><span class="op" id="7272347">[</span><span class="ident" id="7272348">pos</span><span class="op" id="7272351">]</span>&nbsp;<span class="op" id="7272353">=</span>&nbsp;<span class="builtintype" id="7272355">string</span><span class="op" id="7272361">(</span><span class="ident" id="7272362">s</span><span class="op" id="7272363">[</span><span class="num" id="7272364">2</span><span class="op" id="7272365">]</span><span class="op" id="7272366">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272375">default</span><span class="op" id="7272382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272387">prev</span>&nbsp;<span class="op" id="7272392">=</span>&nbsp;<span class="ident" id="7272394">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272401">var</span>&nbsp;<span class="ident" id="7272405">l</span>&nbsp;<span class="builtintype" id="7272407">int</span>&nbsp;<span class="comment" id="7272411">//&nbsp;token&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272430">if</span>&nbsp;<span class="ident" id="7272433">tok</span><span class="op" id="7272436">.</span><span class="ident" id="7272437">IsLiteral</span><span class="op" id="7272446">(</span><span class="op" id="7272447">)</span>&nbsp;<span class="op" id="7272449">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272455">l</span>&nbsp;<span class="op" id="7272457">=</span>&nbsp;<span class="builtinfunc" id="7272459">len</span><span class="op" id="7272462">(</span><span class="ident" id="7272463">lit</span><span class="op" id="7272466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272471">}</span>&nbsp;<span class="keyword" id="7272473">else</span>&nbsp;<span class="op" id="7272478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272484">l</span>&nbsp;<span class="op" id="7272486">=</span>&nbsp;<span class="builtinfunc" id="7272488">len</span><span class="op" id="7272491">(</span><span class="ident" id="7272492">tok</span><span class="op" id="7272495">.</span><span class="ident" id="7272496">String</span><span class="op" id="7272502">(</span><span class="op" id="7272503">)</span><span class="op" id="7272504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272514">here</span>&nbsp;<span class="op" id="7272519">=</span>&nbsp;<span class="ident" id="7272521">prev</span>&nbsp;<span class="op" id="7272526">+</span>&nbsp;<span class="ident" id="7272528">token</span><span class="op" id="7272533">.</span><span class="ident" id="7272534">Pos</span><span class="op" id="7272537">(</span><span class="ident" id="7272538">l</span><span class="op" id="7272539">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7272546">}</span><br>
<span class="lineno"></span><span class="op" id="7272548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7272551">//&nbsp;compareErrors&nbsp;compares&nbsp;the&nbsp;map&nbsp;of&nbsp;expected&nbsp;error&nbsp;messages&nbsp;with&nbsp;the&nbsp;list</span><br>
<span class="lineno">110</span><span class="comment" id="7272626">//&nbsp;of&nbsp;found&nbsp;errors&nbsp;and&nbsp;reports&nbsp;discrepancies.</span><br>
<span class="lineno"></span><span class="comment" id="7272672">//</span><br>
<span class="lineno"></span><span class="keyword" id="7272675">func</span>&nbsp;<span class="ident" id="7272680">compareErrors</span><span class="op" id="7272693">(</span><span class="ident" id="7272694">t</span>&nbsp;<span class="op" id="7272696">*</span><span class="ident" id="7272697">testing</span><span class="op" id="7272704">.</span><span class="ident" id="7272705">T</span><span class="op" id="7272706">,</span>&nbsp;<span class="ident" id="7272708">expected</span>&nbsp;<span class="keyword" id="7272717">map</span><span class="op" id="7272720">[</span><span class="ident" id="7272721">token</span><span class="op" id="7272726">.</span><span class="ident" id="7272727">Pos</span><span class="op" id="7272730">]</span><span class="builtintype" id="7272731">string</span><span class="op" id="7272737">,</span>&nbsp;<span class="ident" id="7272739">found</span>&nbsp;<span class="ident" id="7272745">scanner</span><span class="op" id="7272752">.</span><span class="ident" id="7272753">ErrorList</span><span class="op" id="7272762">)</span>&nbsp;<span class="op" id="7272764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272767">for</span>&nbsp;<span class="ident" id="7272771">_</span><span class="op" id="7272772">,</span>&nbsp;<span class="builtintype" id="7272774">error</span>&nbsp;<span class="op" id="7272780">:=</span>&nbsp;<span class="keyword" id="7272783">range</span>&nbsp;<span class="ident" id="7272789">found</span>&nbsp;<span class="op" id="7272795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7272799">//&nbsp;error.Pos&nbsp;is&nbsp;a&nbsp;token.Position,&nbsp;but&nbsp;we&nbsp;want</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7272847">//&nbsp;a&nbsp;token.Pos&nbsp;so&nbsp;we&nbsp;can&nbsp;do&nbsp;a&nbsp;map&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7272890">pos</span>&nbsp;<span class="op" id="7272894">:=</span>&nbsp;<span class="ident" id="7272897">getPos</span><span class="op" id="7272903">(</span><span class="builtintype" id="7272904">error</span><span class="op" id="7272909">.</span><span class="ident" id="7272910">Pos</span><span class="op" id="7272913">.</span><span class="ident" id="7272914">Filename</span><span class="op" id="7272922">,</span>&nbsp;<span class="builtintype" id="7272924">error</span><span class="op" id="7272929">.</span><span class="ident" id="7272930">Pos</span><span class="op" id="7272933">.</span><span class="ident" id="7272934">Offset</span><span class="op" id="7272940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7272944">if</span>&nbsp;<span class="ident" id="7272947">msg</span><span class="op" id="7272950">,</span>&nbsp;<span class="ident" id="7272952">found</span>&nbsp;<span class="op" id="7272958">:=</span>&nbsp;<span class="ident" id="7272961">expected</span><span class="op" id="7272969">[</span><span class="ident" id="7272970">pos</span><span class="op" id="7272973">]</span><span class="op" id="7272974">;</span>&nbsp;<span class="ident" id="7272976">found</span>&nbsp;<span class="op" id="7272982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7272987">//&nbsp;we&nbsp;expect&nbsp;a&nbsp;message&nbsp;at&nbsp;pos;&nbsp;check&nbsp;if&nbsp;it&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273041">rx</span><span class="op" id="7273043">,</span>&nbsp;<span class="ident" id="7273045">err</span>&nbsp;<span class="op" id="7273049">:=</span>&nbsp;<span class="ident" id="7273052">regexp</span><span class="op" id="7273058">.</span><span class="ident" id="7273059">Compile</span><span class="op" id="7273066">(</span><span class="ident" id="7273067">msg</span><span class="op" id="7273070">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7273075">if</span>&nbsp;<span class="ident" id="7273078">err</span>&nbsp;<span class="op" id="7273082">!=</span>&nbsp;<span class="ident" id="7273085">nil</span>&nbsp;<span class="op" id="7273089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273095">t</span><span class="op" id="7273096">.</span><span class="ident" id="7273097">Errorf</span><span class="op" id="7273103">(</span><span class="string" id="7273104">&#34;%s:&nbsp;%v&#34;</span><span class="op" id="7273112">,</span>&nbsp;<span class="builtintype" id="7273114">error</span><span class="op" id="7273119">.</span><span class="ident" id="7273120">Pos</span><span class="op" id="7273123">,</span>&nbsp;<span class="ident" id="7273125">err</span><span class="op" id="7273128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7273134">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7273151">if</span>&nbsp;<span class="ident" id="7273154">match</span>&nbsp;<span class="op" id="7273160">:=</span>&nbsp;<span class="ident" id="7273163">rx</span><span class="op" id="7273165">.</span><span class="ident" id="7273166">MatchString</span><span class="op" id="7273177">(</span><span class="builtintype" id="7273178">error</span><span class="op" id="7273183">.</span><span class="ident" id="7273184">Msg</span><span class="op" id="7273187">)</span><span class="op" id="7273188">;</span>&nbsp;<span class="op" id="7273190">!</span><span class="ident" id="7273191">match</span>&nbsp;<span class="op" id="7273197">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273203">t</span><span class="op" id="7273204">.</span><span class="ident" id="7273205">Errorf</span><span class="op" id="7273211">(</span><span class="string" id="7273212">&#34;%s:&nbsp;%q&nbsp;does&nbsp;not&nbsp;match&nbsp;%q&#34;</span><span class="op" id="7273238">,</span>&nbsp;<span class="builtintype" id="7273240">error</span><span class="op" id="7273245">.</span><span class="ident" id="7273246">Pos</span><span class="op" id="7273249">,</span>&nbsp;<span class="builtintype" id="7273251">error</span><span class="op" id="7273256">.</span><span class="ident" id="7273257">Msg</span><span class="op" id="7273260">,</span>&nbsp;<span class="ident" id="7273262">msg</span><span class="op" id="7273265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7273271">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7273288">//&nbsp;we&nbsp;have&nbsp;a&nbsp;match&nbsp;-&nbsp;eliminate&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7273333">delete</span><span class="op" id="7273339">(</span><span class="ident" id="7273340">expected</span><span class="op" id="7273348">,</span>&nbsp;<span class="ident" id="7273350">pos</span><span class="op" id="7273353">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273357">}</span>&nbsp;<span class="keyword" id="7273359">else</span>&nbsp;<span class="op" id="7273364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7273369">//&nbsp;To&nbsp;keep&nbsp;in&nbsp;mind&nbsp;when&nbsp;analyzing&nbsp;failed&nbsp;test&nbsp;output:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7273426">//&nbsp;If&nbsp;the&nbsp;same&nbsp;error&nbsp;position&nbsp;occurs&nbsp;multiple&nbsp;times&nbsp;in&nbsp;errors,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7273492">//&nbsp;this&nbsp;message&nbsp;will&nbsp;be&nbsp;triggered&nbsp;(because&nbsp;the&nbsp;first&nbsp;error&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7273557">//&nbsp;the&nbsp;position&nbsp;removes&nbsp;this&nbsp;position&nbsp;from&nbsp;the&nbsp;expected&nbsp;errors).</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273625">t</span><span class="op" id="7273626">.</span><span class="ident" id="7273627">Errorf</span><span class="op" id="7273633">(</span><span class="string" id="7273634">&#34;%s:&nbsp;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7273660">,</span>&nbsp;<span class="builtintype" id="7273662">error</span><span class="op" id="7273667">.</span><span class="ident" id="7273668">Pos</span><span class="op" id="7273671">,</span>&nbsp;<span class="builtintype" id="7273673">error</span><span class="op" id="7273678">.</span><span class="ident" id="7273679">Msg</span><span class="op" id="7273682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7273693">//&nbsp;there&nbsp;should&nbsp;be&nbsp;no&nbsp;expected&nbsp;errors&nbsp;left</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7273737">if</span>&nbsp;<span class="builtinfunc" id="7273740">len</span><span class="op" id="7273743">(</span><span class="ident" id="7273744">expected</span><span class="op" id="7273752">)</span>&nbsp;<span class="op" id="7273754">&gt;</span>&nbsp;<span class="num" id="7273756">0</span>&nbsp;<span class="op" id="7273758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273762">t</span><span class="op" id="7273763">.</span><span class="ident" id="7273764">Errorf</span><span class="op" id="7273770">(</span><span class="string" id="7273771">&#34;%d&nbsp;errors&nbsp;not&nbsp;reported:&#34;</span><span class="op" id="7273796">,</span>&nbsp;<span class="builtinfunc" id="7273798">len</span><span class="op" id="7273801">(</span><span class="ident" id="7273802">expected</span><span class="op" id="7273810">)</span><span class="op" id="7273811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7273815">for</span>&nbsp;<span class="ident" id="7273819">pos</span><span class="op" id="7273822">,</span>&nbsp;<span class="ident" id="7273824">msg</span>&nbsp;<span class="op" id="7273828">:=</span>&nbsp;<span class="keyword" id="7273831">range</span>&nbsp;<span class="ident" id="7273837">expected</span>&nbsp;<span class="op" id="7273846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273851">t</span><span class="op" id="7273852">.</span><span class="ident" id="7273853">Errorf</span><span class="op" id="7273859">(</span><span class="string" id="7273860">&#34;%s:&nbsp;%s\n&#34;</span><span class="op" id="7273870">,</span>&nbsp;<span class="ident" id="7273872">fsetErrs</span><span class="op" id="7273880">.</span><span class="ident" id="7273881">Position</span><span class="op" id="7273889">(</span><span class="ident" id="7273890">pos</span><span class="op" id="7273893">)</span><span class="op" id="7273894">,</span>&nbsp;<span class="ident" id="7273896">msg</span><span class="op" id="7273899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273903">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7273906">}</span><br>
<span class="lineno"></span><span class="op" id="7273908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7273911">func</span>&nbsp;<span class="ident" id="7273916">checkErrors</span><span class="op" id="7273927">(</span><span class="ident" id="7273928">t</span>&nbsp;<span class="op" id="7273930">*</span><span class="ident" id="7273931">testing</span><span class="op" id="7273938">.</span><span class="ident" id="7273939">T</span><span class="op" id="7273940">,</span>&nbsp;<span class="ident" id="7273942">filename</span>&nbsp;<span class="builtintype" id="7273951">string</span><span class="op" id="7273957">,</span>&nbsp;<span class="ident" id="7273959">input</span>&nbsp;<span class="keyword" id="7273965">interface</span><span class="op" id="7273974">{</span><span class="op" id="7273975">}</span><span class="op" id="7273976">)</span>&nbsp;<span class="op" id="7273978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7273981">src</span><span class="op" id="7273984">,</span>&nbsp;<span class="ident" id="7273986">err</span>&nbsp;<span class="op" id="7273990">:=</span>&nbsp;<span class="ident" id="7273993">readSource</span><span class="op" id="7274003">(</span><span class="ident" id="7274004">filename</span><span class="op" id="7274012">,</span>&nbsp;<span class="ident" id="7274014">input</span><span class="op" id="7274019">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274022">if</span>&nbsp;<span class="ident" id="7274025">err</span>&nbsp;<span class="op" id="7274029">!=</span>&nbsp;<span class="ident" id="7274032">nil</span>&nbsp;<span class="op" id="7274036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274040">t</span><span class="op" id="7274041">.</span><span class="ident" id="7274042">Error</span><span class="op" id="7274047">(</span><span class="ident" id="7274048">err</span><span class="op" id="7274051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274055">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274067">_</span><span class="op" id="7274068">,</span>&nbsp;<span class="ident" id="7274070">err</span>&nbsp;<span class="op" id="7274074">=</span>&nbsp;<span class="ident" id="7274076">ParseFile</span><span class="op" id="7274085">(</span><span class="ident" id="7274086">fsetErrs</span><span class="op" id="7274094">,</span>&nbsp;<span class="ident" id="7274096">filename</span><span class="op" id="7274104">,</span>&nbsp;<span class="ident" id="7274106">src</span><span class="op" id="7274109">,</span>&nbsp;<span class="ident" id="7274111">DeclarationErrors</span><span class="op" id="7274128">|</span><span class="ident" id="7274129">AllErrors</span><span class="op" id="7274138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274141">found</span><span class="op" id="7274146">,</span>&nbsp;<span class="ident" id="7274148">ok</span>&nbsp;<span class="op" id="7274151">:=</span>&nbsp;<span class="ident" id="7274154">err</span><span class="op" id="7274157">.</span><span class="op" id="7274158">(</span><span class="ident" id="7274159">scanner</span><span class="op" id="7274166">.</span><span class="ident" id="7274167">ErrorList</span><span class="op" id="7274176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274179">if</span>&nbsp;<span class="ident" id="7274182">err</span>&nbsp;<span class="op" id="7274186">!=</span>&nbsp;<span class="ident" id="7274189">nil</span>&nbsp;<span class="op" id="7274193">&amp;&amp;</span>&nbsp;<span class="op" id="7274196">!</span><span class="ident" id="7274197">ok</span>&nbsp;<span class="op" id="7274200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274204">t</span><span class="op" id="7274205">.</span><span class="ident" id="7274206">Error</span><span class="op" id="7274211">(</span><span class="ident" id="7274212">err</span><span class="op" id="7274215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274219">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274230">found</span><span class="op" id="7274235">.</span><span class="ident" id="7274236">RemoveMultiples</span><span class="op" id="7274251">(</span><span class="op" id="7274252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7274256">//&nbsp;we&nbsp;are&nbsp;expecting&nbsp;the&nbsp;following&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7274298">//&nbsp;(collect&nbsp;these&nbsp;after&nbsp;parsing&nbsp;a&nbsp;file&nbsp;so&nbsp;that&nbsp;it&nbsp;is&nbsp;found&nbsp;in&nbsp;the&nbsp;file&nbsp;set)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274375">expected</span>&nbsp;<span class="op" id="7274384">:=</span>&nbsp;<span class="ident" id="7274387">expectedErrors</span><span class="op" id="7274401">(</span><span class="ident" id="7274402">t</span><span class="op" id="7274403">,</span>&nbsp;<span class="ident" id="7274405">filename</span><span class="op" id="7274413">,</span>&nbsp;<span class="ident" id="7274415">src</span><span class="op" id="7274418">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7274422">//&nbsp;verify&nbsp;errors&nbsp;returned&nbsp;by&nbsp;the&nbsp;parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274463">compareErrors</span><span class="op" id="7274476">(</span><span class="ident" id="7274477">t</span><span class="op" id="7274478">,</span>&nbsp;<span class="ident" id="7274480">expected</span><span class="op" id="7274488">,</span>&nbsp;<span class="ident" id="7274490">found</span><span class="op" id="7274495">)</span><br>
<span class="lineno"></span><span class="op" id="7274497">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="7274500">func</span>&nbsp;<span class="ident" id="7274505">TestErrors</span><span class="op" id="7274515">(</span><span class="ident" id="7274516">t</span>&nbsp;<span class="op" id="7274518">*</span><span class="ident" id="7274519">testing</span><span class="op" id="7274526">.</span><span class="ident" id="7274527">T</span><span class="op" id="7274528">)</span>&nbsp;<span class="op" id="7274530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274533">list</span><span class="op" id="7274537">,</span>&nbsp;<span class="ident" id="7274539">err</span>&nbsp;<span class="op" id="7274543">:=</span>&nbsp;<span class="ident" id="7274546">ioutil</span><span class="op" id="7274552">.</span><span class="ident" id="7274553">ReadDir</span><span class="op" id="7274560">(</span><span class="ident" id="7274561">testdata</span><span class="op" id="7274569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274572">if</span>&nbsp;<span class="ident" id="7274575">err</span>&nbsp;<span class="op" id="7274579">!=</span>&nbsp;<span class="ident" id="7274582">nil</span>&nbsp;<span class="op" id="7274586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274590">t</span><span class="op" id="7274591">.</span><span class="ident" id="7274592">Fatal</span><span class="op" id="7274597">(</span><span class="ident" id="7274598">err</span><span class="op" id="7274601">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274607">for</span>&nbsp;<span class="ident" id="7274611">_</span><span class="op" id="7274612">,</span>&nbsp;<span class="ident" id="7274614">fi</span>&nbsp;<span class="op" id="7274617">:=</span>&nbsp;<span class="keyword" id="7274620">range</span>&nbsp;<span class="ident" id="7274626">list</span>&nbsp;<span class="op" id="7274631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274635">name</span>&nbsp;<span class="op" id="7274640">:=</span>&nbsp;<span class="ident" id="7274643">fi</span><span class="op" id="7274645">.</span><span class="ident" id="7274646">Name</span><span class="op" id="7274650">(</span><span class="op" id="7274651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7274655">if</span>&nbsp;<span class="op" id="7274658">!</span><span class="ident" id="7274659">fi</span><span class="op" id="7274661">.</span><span class="ident" id="7274662">IsDir</span><span class="op" id="7274667">(</span><span class="op" id="7274668">)</span>&nbsp;<span class="op" id="7274670">&amp;&amp;</span>&nbsp;<span class="op" id="7274673">!</span><span class="ident" id="7274674">strings</span><span class="op" id="7274681">.</span><span class="ident" id="7274682">HasPrefix</span><span class="op" id="7274691">(</span><span class="ident" id="7274692">name</span><span class="op" id="7274696">,</span>&nbsp;<span class="string" id="7274698">&#34;.&#34;</span><span class="op" id="7274701">)</span>&nbsp;<span class="op" id="7274703">&amp;&amp;</span>&nbsp;<span class="ident" id="7274706">strings</span><span class="op" id="7274713">.</span><span class="ident" id="7274714">HasSuffix</span><span class="op" id="7274723">(</span><span class="ident" id="7274724">name</span><span class="op" id="7274728">,</span>&nbsp;<span class="string" id="7274730">&#34;.src&#34;</span><span class="op" id="7274736">)</span>&nbsp;<span class="op" id="7274738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7274743">checkErrors</span><span class="op" id="7274754">(</span><span class="ident" id="7274755">t</span><span class="op" id="7274756">,</span>&nbsp;<span class="ident" id="7274758">filepath</span><span class="op" id="7274766">.</span><span class="ident" id="7274767">Join</span><span class="op" id="7274771">(</span><span class="ident" id="7274772">testdata</span><span class="op" id="7274780">,</span>&nbsp;<span class="ident" id="7274782">name</span><span class="op" id="7274786">)</span><span class="op" id="7274787">,</span>&nbsp;<span class="ident" id="7274789">nil</span><span class="op" id="7274792">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7274799">}</span><br>
<span class="lineno"></span><span class="op" id="7274801">}</span>
</div>
</body>
</html>
