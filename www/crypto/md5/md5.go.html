<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4155878">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4155933">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4155987">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4156038">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156093">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="4156166">package</span>&nbsp;<span class="ident" id="4156174">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4156179">import</span>&nbsp;<span class="op" id="4156186">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156189">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4156199">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4156206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4156209">func</span>&nbsp;<span class="ident" id="4156214">init</span><span class="op" id="4156218">(</span><span class="op" id="4156219">)</span>&nbsp;<span class="op" id="4156221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156224">crypto</span><span class="op" id="4156230">.</span><span class="ident" id="4156231">RegisterHash</span><span class="op" id="4156243">(</span><span class="ident" id="4156244">crypto</span><span class="op" id="4156250">.</span><span class="ident" id="4156251">MD5</span><span class="op" id="4156254">,</span>&nbsp;<span class="ident" id="4156256">New</span><span class="op" id="4156259">)</span><br>
<span class="lineno"></span><span class="op" id="4156261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156264">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="4156305">const</span>&nbsp;<span class="ident" id="4156311">Size</span>&nbsp;<span class="op" id="4156316">=</span>&nbsp;<span class="num" id="4156318">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156322">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4156356">const</span>&nbsp;<span class="ident" id="4156362">BlockSize</span>&nbsp;<span class="op" id="4156372">=</span>&nbsp;<span class="num" id="4156374">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4156378">const</span>&nbsp;<span class="op" id="4156384">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156387">chunk</span>&nbsp;<span class="op" id="4156393">=</span>&nbsp;<span class="num" id="4156395">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156399">init0</span>&nbsp;<span class="op" id="4156405">=</span>&nbsp;<span class="num" id="4156407">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156419">init1</span>&nbsp;<span class="op" id="4156425">=</span>&nbsp;<span class="num" id="4156427">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156439">init2</span>&nbsp;<span class="op" id="4156445">=</span>&nbsp;<span class="num" id="4156447">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156459">init3</span>&nbsp;<span class="op" id="4156465">=</span>&nbsp;<span class="num" id="4156467">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="4156478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4156481">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4156540">type</span>&nbsp;<span class="ident" id="4156545">digest</span>&nbsp;<span class="keyword" id="4156552">struct</span>&nbsp;<span class="op" id="4156559">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156562">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4156566">[</span><span class="num" id="4156567">4</span><span class="op" id="4156568">]</span><span class="builtintype" id="4156569">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156577">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4156581">[</span><span class="ident" id="4156582">chunk</span><span class="op" id="4156587">]</span><span class="builtintype" id="4156588">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156594">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4156598">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4156603">len</span>&nbsp;<span class="ident" id="4156607">uint64</span><br>
<span class="lineno"></span><span class="op" id="4156614">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4156617">func</span>&nbsp;<span class="op" id="4156622">(</span><span class="ident" id="4156623">d</span>&nbsp;<span class="op" id="4156625">*</span><span class="ident" id="4156626">digest</span><span class="op" id="4156632">)</span>&nbsp;<span class="ident" id="4156634">Reset</span><span class="op" id="4156639">(</span><span class="op" id="4156640">)</span>&nbsp;<span class="op" id="4156642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156645">d</span><span class="op" id="4156646">.</span><span class="ident" id="4156647">s</span><span class="op" id="4156648">[</span><span class="num" id="4156649">0</span><span class="op" id="4156650">]</span>&nbsp;<span class="op" id="4156652">=</span>&nbsp;<span class="ident" id="4156654">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156661">d</span><span class="op" id="4156662">.</span><span class="ident" id="4156663">s</span><span class="op" id="4156664">[</span><span class="num" id="4156665">1</span><span class="op" id="4156666">]</span>&nbsp;<span class="op" id="4156668">=</span>&nbsp;<span class="ident" id="4156670">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156677">d</span><span class="op" id="4156678">.</span><span class="ident" id="4156679">s</span><span class="op" id="4156680">[</span><span class="num" id="4156681">2</span><span class="op" id="4156682">]</span>&nbsp;<span class="op" id="4156684">=</span>&nbsp;<span class="ident" id="4156686">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156693">d</span><span class="op" id="4156694">.</span><span class="ident" id="4156695">s</span><span class="op" id="4156696">[</span><span class="num" id="4156697">3</span><span class="op" id="4156698">]</span>&nbsp;<span class="op" id="4156700">=</span>&nbsp;<span class="ident" id="4156702">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156709">d</span><span class="op" id="4156710">.</span><span class="ident" id="4156711">nx</span>&nbsp;<span class="op" id="4156714">=</span>&nbsp;<span class="num" id="4156716">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156719">d</span><span class="op" id="4156720">.</span><span class="builtinfunc" id="4156721">len</span>&nbsp;<span class="op" id="4156725">=</span>&nbsp;<span class="num" id="4156727">0</span><br>
<span class="lineno"></span><span class="op" id="4156729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4156732">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4156791">func</span>&nbsp;<span class="ident" id="4156796">New</span><span class="op" id="4156799">(</span><span class="op" id="4156800">)</span>&nbsp;<span class="ident" id="4156802">hash</span><span class="op" id="4156806">.</span><span class="ident" id="4156807">Hash</span>&nbsp;<span class="op" id="4156812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156815">d</span>&nbsp;<span class="op" id="4156817">:=</span>&nbsp;<span class="builtinfunc" id="4156820">new</span><span class="op" id="4156823">(</span><span class="ident" id="4156824">digest</span><span class="op" id="4156830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4156833">d</span><span class="op" id="4156834">.</span><span class="ident" id="4156835">Reset</span><span class="op" id="4156840">(</span><span class="op" id="4156841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4156844">return</span>&nbsp;<span class="ident" id="4156851">d</span><br>
<span class="lineno">55</span><span class="op" id="4156853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4156856">func</span>&nbsp;<span class="op" id="4156861">(</span><span class="ident" id="4156862">d</span>&nbsp;<span class="op" id="4156864">*</span><span class="ident" id="4156865">digest</span><span class="op" id="4156871">)</span>&nbsp;<span class="ident" id="4156873">Size</span><span class="op" id="4156877">(</span><span class="op" id="4156878">)</span>&nbsp;<span class="builtintype" id="4156880">int</span>&nbsp;<span class="op" id="4156884">{</span>&nbsp;<span class="keyword" id="4156886">return</span>&nbsp;<span class="ident" id="4156893">Size</span>&nbsp;<span class="op" id="4156898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4156901">func</span>&nbsp;<span class="op" id="4156906">(</span><span class="ident" id="4156907">d</span>&nbsp;<span class="op" id="4156909">*</span><span class="ident" id="4156910">digest</span><span class="op" id="4156916">)</span>&nbsp;<span class="ident" id="4156918">BlockSize</span><span class="op" id="4156927">(</span><span class="op" id="4156928">)</span>&nbsp;<span class="builtintype" id="4156930">int</span>&nbsp;<span class="op" id="4156934">{</span>&nbsp;<span class="keyword" id="4156936">return</span>&nbsp;<span class="ident" id="4156943">BlockSize</span>&nbsp;<span class="op" id="4156953">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4156956">func</span>&nbsp;<span class="op" id="4156961">(</span><span class="ident" id="4156962">d</span>&nbsp;<span class="op" id="4156964">*</span><span class="ident" id="4156965">digest</span><span class="op" id="4156971">)</span>&nbsp;<span class="ident" id="4156973">Write</span><span class="op" id="4156978">(</span><span class="ident" id="4156979">p</span>&nbsp;<span class="op" id="4156981">[</span><span class="op" id="4156982">]</span><span class="builtintype" id="4156983">byte</span><span class="op" id="4156987">)</span>&nbsp;<span class="op" id="4156989">(</span><span class="ident" id="4156990">nn</span>&nbsp;<span class="builtintype" id="4156993">int</span><span class="op" id="4156996">,</span>&nbsp;<span class="ident" id="4156998">err</span>&nbsp;<span class="builtintype" id="4157002">error</span><span class="op" id="4157007">)</span>&nbsp;<span class="op" id="4157009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157012">nn</span>&nbsp;<span class="op" id="4157015">=</span>&nbsp;<span class="builtinfunc" id="4157017">len</span><span class="op" id="4157020">(</span><span class="ident" id="4157021">p</span><span class="op" id="4157022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157025">d</span><span class="op" id="4157026">.</span><span class="builtinfunc" id="4157027">len</span>&nbsp;<span class="op" id="4157031">+=</span>&nbsp;<span class="ident" id="4157034">uint64</span><span class="op" id="4157040">(</span><span class="ident" id="4157041">nn</span><span class="op" id="4157043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157046">if</span>&nbsp;<span class="ident" id="4157049">d</span><span class="op" id="4157050">.</span><span class="ident" id="4157051">nx</span>&nbsp;<span class="op" id="4157054">&gt;</span>&nbsp;<span class="num" id="4157056">0</span>&nbsp;<span class="op" id="4157058">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157062">n</span>&nbsp;<span class="op" id="4157064">:=</span>&nbsp;<span class="builtinfunc" id="4157067">len</span><span class="op" id="4157070">(</span><span class="ident" id="4157071">p</span><span class="op" id="4157072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157076">if</span>&nbsp;<span class="ident" id="4157079">n</span>&nbsp;<span class="op" id="4157081">&gt;</span>&nbsp;<span class="ident" id="4157083">chunk</span><span class="op" id="4157088">-</span><span class="ident" id="4157089">d</span><span class="op" id="4157090">.</span><span class="ident" id="4157091">nx</span>&nbsp;<span class="op" id="4157094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157099">n</span>&nbsp;<span class="op" id="4157101">=</span>&nbsp;<span class="ident" id="4157103">chunk</span>&nbsp;<span class="op" id="4157109">-</span>&nbsp;<span class="ident" id="4157111">d</span><span class="op" id="4157112">.</span><span class="ident" id="4157113">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157122">for</span>&nbsp;<span class="ident" id="4157126">i</span>&nbsp;<span class="op" id="4157128">:=</span>&nbsp;<span class="num" id="4157131">0</span><span class="op" id="4157132">;</span>&nbsp;<span class="ident" id="4157134">i</span>&nbsp;<span class="op" id="4157136">&lt;</span>&nbsp;<span class="ident" id="4157138">n</span><span class="op" id="4157139">;</span>&nbsp;<span class="ident" id="4157141">i</span><span class="op" id="4157142">++</span>&nbsp;<span class="op" id="4157145">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157150">d</span><span class="op" id="4157151">.</span><span class="ident" id="4157152">x</span><span class="op" id="4157153">[</span><span class="ident" id="4157154">d</span><span class="op" id="4157155">.</span><span class="ident" id="4157156">nx</span><span class="op" id="4157158">+</span><span class="ident" id="4157159">i</span><span class="op" id="4157160">]</span>&nbsp;<span class="op" id="4157162">=</span>&nbsp;<span class="ident" id="4157164">p</span><span class="op" id="4157165">[</span><span class="ident" id="4157166">i</span><span class="op" id="4157167">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157175">d</span><span class="op" id="4157176">.</span><span class="ident" id="4157177">nx</span>&nbsp;<span class="op" id="4157180">+=</span>&nbsp;<span class="ident" id="4157183">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157187">if</span>&nbsp;<span class="ident" id="4157190">d</span><span class="op" id="4157191">.</span><span class="ident" id="4157192">nx</span>&nbsp;<span class="op" id="4157195">==</span>&nbsp;<span class="ident" id="4157198">chunk</span>&nbsp;<span class="op" id="4157204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157209">block</span><span class="op" id="4157214">(</span><span class="ident" id="4157215">d</span><span class="op" id="4157216">,</span>&nbsp;<span class="ident" id="4157218">d</span><span class="op" id="4157219">.</span><span class="ident" id="4157220">x</span><span class="op" id="4157221">[</span><span class="num" id="4157222">0</span><span class="op" id="4157223">:</span><span class="ident" id="4157224">chunk</span><span class="op" id="4157229">]</span><span class="op" id="4157230">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157235">d</span><span class="op" id="4157236">.</span><span class="ident" id="4157237">nx</span>&nbsp;<span class="op" id="4157240">=</span>&nbsp;<span class="num" id="4157242">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157250">p</span>&nbsp;<span class="op" id="4157252">=</span>&nbsp;<span class="ident" id="4157254">p</span><span class="op" id="4157255">[</span><span class="ident" id="4157256">n</span><span class="op" id="4157257">:</span><span class="op" id="4157258">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157264">if</span>&nbsp;<span class="builtinfunc" id="4157267">len</span><span class="op" id="4157270">(</span><span class="ident" id="4157271">p</span><span class="op" id="4157272">)</span>&nbsp;<span class="op" id="4157274">&gt;=</span>&nbsp;<span class="ident" id="4157277">chunk</span>&nbsp;<span class="op" id="4157283">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157287">n</span>&nbsp;<span class="op" id="4157289">:=</span>&nbsp;<span class="builtinfunc" id="4157292">len</span><span class="op" id="4157295">(</span><span class="ident" id="4157296">p</span><span class="op" id="4157297">)</span>&nbsp;<span class="op" id="4157299">&amp;^</span>&nbsp;<span class="op" id="4157302">(</span><span class="ident" id="4157303">chunk</span>&nbsp;<span class="op" id="4157309">-</span>&nbsp;<span class="num" id="4157311">1</span><span class="op" id="4157312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157316">block</span><span class="op" id="4157321">(</span><span class="ident" id="4157322">d</span><span class="op" id="4157323">,</span>&nbsp;<span class="ident" id="4157325">p</span><span class="op" id="4157326">[</span><span class="op" id="4157327">:</span><span class="ident" id="4157328">n</span><span class="op" id="4157329">]</span><span class="op" id="4157330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157334">p</span>&nbsp;<span class="op" id="4157336">=</span>&nbsp;<span class="ident" id="4157338">p</span><span class="op" id="4157339">[</span><span class="ident" id="4157340">n</span><span class="op" id="4157341">:</span><span class="op" id="4157342">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157348">if</span>&nbsp;<span class="builtinfunc" id="4157351">len</span><span class="op" id="4157354">(</span><span class="ident" id="4157355">p</span><span class="op" id="4157356">)</span>&nbsp;<span class="op" id="4157358">&gt;</span>&nbsp;<span class="num" id="4157360">0</span>&nbsp;<span class="op" id="4157362">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157366">d</span><span class="op" id="4157367">.</span><span class="ident" id="4157368">nx</span>&nbsp;<span class="op" id="4157371">=</span>&nbsp;<span class="builtinfunc" id="4157373">copy</span><span class="op" id="4157377">(</span><span class="ident" id="4157378">d</span><span class="op" id="4157379">.</span><span class="ident" id="4157380">x</span><span class="op" id="4157381">[</span><span class="op" id="4157382">:</span><span class="op" id="4157383">]</span><span class="op" id="4157384">,</span>&nbsp;<span class="ident" id="4157386">p</span><span class="op" id="4157387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157393">return</span><br>
<span class="lineno"></span><span class="op" id="4157400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4157403">func</span>&nbsp;<span class="op" id="4157408">(</span><span class="ident" id="4157409">d0</span>&nbsp;<span class="op" id="4157412">*</span><span class="ident" id="4157413">digest</span><span class="op" id="4157419">)</span>&nbsp;<span class="ident" id="4157421">Sum</span><span class="op" id="4157424">(</span><span class="ident" id="4157425">in</span>&nbsp;<span class="op" id="4157428">[</span><span class="op" id="4157429">]</span><span class="builtintype" id="4157430">byte</span><span class="op" id="4157434">)</span>&nbsp;<span class="op" id="4157436">[</span><span class="op" id="4157437">]</span><span class="builtintype" id="4157438">byte</span>&nbsp;<span class="op" id="4157443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157446">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157513">d</span>&nbsp;<span class="op" id="4157515">:=</span>&nbsp;<span class="op" id="4157518">*</span><span class="ident" id="4157519">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157523">hash</span>&nbsp;<span class="op" id="4157528">:=</span>&nbsp;<span class="ident" id="4157531">d</span><span class="op" id="4157532">.</span><span class="ident" id="4157533">checkSum</span><span class="op" id="4157541">(</span><span class="op" id="4157542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157545">return</span>&nbsp;<span class="builtinfunc" id="4157552">append</span><span class="op" id="4157558">(</span><span class="ident" id="4157559">in</span><span class="op" id="4157561">,</span>&nbsp;<span class="ident" id="4157563">hash</span><span class="op" id="4157567">[</span><span class="op" id="4157568">:</span><span class="op" id="4157569">]</span><span class="op" id="4157570">...</span><span class="op" id="4157573">)</span><br>
<span class="lineno">95</span><span class="op" id="4157575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4157578">func</span>&nbsp;<span class="op" id="4157583">(</span><span class="ident" id="4157584">d</span>&nbsp;<span class="op" id="4157586">*</span><span class="ident" id="4157587">digest</span><span class="op" id="4157593">)</span>&nbsp;<span class="ident" id="4157595">checkSum</span><span class="op" id="4157603">(</span><span class="op" id="4157604">)</span>&nbsp;<span class="op" id="4157606">[</span><span class="ident" id="4157607">Size</span><span class="op" id="4157611">]</span><span class="builtintype" id="4157612">byte</span>&nbsp;<span class="op" id="4157617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157620">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4157680">len</span>&nbsp;<span class="op" id="4157684">:=</span>&nbsp;<span class="ident" id="4157687">d</span><span class="op" id="4157688">.</span><span class="builtinfunc" id="4157689">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157694">var</span>&nbsp;<span class="ident" id="4157698">tmp</span>&nbsp;<span class="op" id="4157702">[</span><span class="num" id="4157703">64</span><span class="op" id="4157705">]</span><span class="builtintype" id="4157706">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157712">tmp</span><span class="op" id="4157715">[</span><span class="num" id="4157716">0</span><span class="op" id="4157717">]</span>&nbsp;<span class="op" id="4157719">=</span>&nbsp;<span class="num" id="4157721">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157727">if</span>&nbsp;<span class="builtinfunc" id="4157730">len</span><span class="op" id="4157733">%</span><span class="num" id="4157734">64</span>&nbsp;<span class="op" id="4157737">&lt;</span>&nbsp;<span class="num" id="4157739">56</span>&nbsp;<span class="op" id="4157742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157746">d</span><span class="op" id="4157747">.</span><span class="ident" id="4157748">Write</span><span class="op" id="4157753">(</span><span class="ident" id="4157754">tmp</span><span class="op" id="4157757">[</span><span class="num" id="4157758">0</span>&nbsp;<span class="op" id="4157760">:</span>&nbsp;<span class="num" id="4157762">56</span><span class="op" id="4157764">-</span><span class="builtinfunc" id="4157765">len</span><span class="op" id="4157768">%</span><span class="num" id="4157769">64</span><span class="op" id="4157771">]</span><span class="op" id="4157772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157775">}</span>&nbsp;<span class="keyword" id="4157777">else</span>&nbsp;<span class="op" id="4157782">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157786">d</span><span class="op" id="4157787">.</span><span class="ident" id="4157788">Write</span><span class="op" id="4157793">(</span><span class="ident" id="4157794">tmp</span><span class="op" id="4157797">[</span><span class="num" id="4157798">0</span>&nbsp;<span class="op" id="4157800">:</span>&nbsp;<span class="num" id="4157802">64</span><span class="op" id="4157804">+</span><span class="num" id="4157805">56</span><span class="op" id="4157807">-</span><span class="builtinfunc" id="4157808">len</span><span class="op" id="4157811">%</span><span class="num" id="4157812">64</span><span class="op" id="4157814">]</span><span class="op" id="4157815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4157822">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4157842">len</span>&nbsp;<span class="op" id="4157846">&lt;&lt;=</span>&nbsp;<span class="num" id="4157850">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157853">for</span>&nbsp;<span class="ident" id="4157857">i</span>&nbsp;<span class="op" id="4157859">:=</span>&nbsp;<span class="builtintype" id="4157862">uint</span><span class="op" id="4157866">(</span><span class="num" id="4157867">0</span><span class="op" id="4157868">)</span><span class="op" id="4157869">;</span>&nbsp;<span class="ident" id="4157871">i</span>&nbsp;<span class="op" id="4157873">&lt;</span>&nbsp;<span class="num" id="4157875">8</span><span class="op" id="4157876">;</span>&nbsp;<span class="ident" id="4157878">i</span><span class="op" id="4157879">++</span>&nbsp;<span class="op" id="4157882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157886">tmp</span><span class="op" id="4157889">[</span><span class="ident" id="4157890">i</span><span class="op" id="4157891">]</span>&nbsp;<span class="op" id="4157893">=</span>&nbsp;<span class="builtintype" id="4157895">byte</span><span class="op" id="4157899">(</span><span class="builtinfunc" id="4157900">len</span>&nbsp;<span class="op" id="4157904">&gt;&gt;</span>&nbsp;<span class="op" id="4157907">(</span><span class="num" id="4157908">8</span>&nbsp;<span class="op" id="4157910">*</span>&nbsp;<span class="ident" id="4157912">i</span><span class="op" id="4157913">)</span><span class="op" id="4157914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4157920">d</span><span class="op" id="4157921">.</span><span class="ident" id="4157922">Write</span><span class="op" id="4157927">(</span><span class="ident" id="4157928">tmp</span><span class="op" id="4157931">[</span><span class="num" id="4157932">0</span><span class="op" id="4157933">:</span><span class="num" id="4157934">8</span><span class="op" id="4157935">]</span><span class="op" id="4157936">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157940">if</span>&nbsp;<span class="ident" id="4157943">d</span><span class="op" id="4157944">.</span><span class="ident" id="4157945">nx</span>&nbsp;<span class="op" id="4157948">!=</span>&nbsp;<span class="num" id="4157951">0</span>&nbsp;<span class="op" id="4157953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4157957">panic</span><span class="op" id="4157962">(</span><span class="string" id="4157963">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4157974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4157977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4157981">var</span>&nbsp;<span class="ident" id="4157985">digest</span>&nbsp;<span class="op" id="4157992">[</span><span class="ident" id="4157993">Size</span><span class="op" id="4157997">]</span><span class="builtintype" id="4157998">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158004">for</span>&nbsp;<span class="ident" id="4158008">i</span><span class="op" id="4158009">,</span>&nbsp;<span class="ident" id="4158011">s</span>&nbsp;<span class="op" id="4158013">:=</span>&nbsp;<span class="keyword" id="4158016">range</span>&nbsp;<span class="ident" id="4158022">d</span><span class="op" id="4158023">.</span><span class="ident" id="4158024">s</span>&nbsp;<span class="op" id="4158026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158030">digest</span><span class="op" id="4158036">[</span><span class="ident" id="4158037">i</span><span class="op" id="4158038">*</span><span class="num" id="4158039">4</span><span class="op" id="4158040">]</span>&nbsp;<span class="op" id="4158042">=</span>&nbsp;<span class="builtintype" id="4158044">byte</span><span class="op" id="4158048">(</span><span class="ident" id="4158049">s</span><span class="op" id="4158050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158054">digest</span><span class="op" id="4158060">[</span><span class="ident" id="4158061">i</span><span class="op" id="4158062">*</span><span class="num" id="4158063">4</span><span class="op" id="4158064">+</span><span class="num" id="4158065">1</span><span class="op" id="4158066">]</span>&nbsp;<span class="op" id="4158068">=</span>&nbsp;<span class="builtintype" id="4158070">byte</span><span class="op" id="4158074">(</span><span class="ident" id="4158075">s</span>&nbsp;<span class="op" id="4158077">&gt;&gt;</span>&nbsp;<span class="num" id="4158080">8</span><span class="op" id="4158081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158085">digest</span><span class="op" id="4158091">[</span><span class="ident" id="4158092">i</span><span class="op" id="4158093">*</span><span class="num" id="4158094">4</span><span class="op" id="4158095">+</span><span class="num" id="4158096">2</span><span class="op" id="4158097">]</span>&nbsp;<span class="op" id="4158099">=</span>&nbsp;<span class="builtintype" id="4158101">byte</span><span class="op" id="4158105">(</span><span class="ident" id="4158106">s</span>&nbsp;<span class="op" id="4158108">&gt;&gt;</span>&nbsp;<span class="num" id="4158111">16</span><span class="op" id="4158113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158117">digest</span><span class="op" id="4158123">[</span><span class="ident" id="4158124">i</span><span class="op" id="4158125">*</span><span class="num" id="4158126">4</span><span class="op" id="4158127">+</span><span class="num" id="4158128">3</span><span class="op" id="4158129">]</span>&nbsp;<span class="op" id="4158131">=</span>&nbsp;<span class="builtintype" id="4158133">byte</span><span class="op" id="4158137">(</span><span class="ident" id="4158138">s</span>&nbsp;<span class="op" id="4158140">&gt;&gt;</span>&nbsp;<span class="num" id="4158143">24</span><span class="op" id="4158145">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4158148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158152">return</span>&nbsp;<span class="ident" id="4158159">digest</span><br>
<span class="lineno"></span><span class="op" id="4158166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4158169">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4158214">func</span>&nbsp;<span class="ident" id="4158219">Sum</span><span class="op" id="4158222">(</span><span class="ident" id="4158223">data</span>&nbsp;<span class="op" id="4158228">[</span><span class="op" id="4158229">]</span><span class="builtintype" id="4158230">byte</span><span class="op" id="4158234">)</span>&nbsp;<span class="op" id="4158236">[</span><span class="ident" id="4158237">Size</span><span class="op" id="4158241">]</span><span class="builtintype" id="4158242">byte</span>&nbsp;<span class="op" id="4158247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158250">var</span>&nbsp;<span class="ident" id="4158254">d</span>&nbsp;<span class="ident" id="4158256">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158264">d</span><span class="op" id="4158265">.</span><span class="ident" id="4158266">Reset</span><span class="op" id="4158271">(</span><span class="op" id="4158272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4158275">d</span><span class="op" id="4158276">.</span><span class="ident" id="4158277">Write</span><span class="op" id="4158282">(</span><span class="ident" id="4158283">data</span><span class="op" id="4158287">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4158290">return</span>&nbsp;<span class="ident" id="4158297">d</span><span class="op" id="4158298">.</span><span class="ident" id="4158299">checkSum</span><span class="op" id="4158307">(</span><span class="op" id="4158308">)</span><br>
<span class="lineno"></span><span class="op" id="4158310">}</span>
</div>
</body>
</html>
