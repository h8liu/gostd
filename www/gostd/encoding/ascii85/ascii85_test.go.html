<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7087244">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7087299">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7087353">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7087404">package</span>&nbsp;<span class="ident" id="7087412">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7087421">import</span>&nbsp;<span class="op" id="7087428">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087431">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087440">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087446">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087459">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087470">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7087480">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7087483">type</span>&nbsp;<span class="ident" id="7087488">testpair</span>&nbsp;<span class="keyword" id="7087497">struct</span>&nbsp;<span class="op" id="7087504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7087507">decoded</span><span class="op" id="7087514">,</span>&nbsp;<span class="ident" id="7087516">encoded</span>&nbsp;<span class="builtintype" id="7087524">string</span><br>
<span class="lineno"></span><span class="op" id="7087531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7087534">var</span>&nbsp;<span class="ident" id="7087538">pairs</span>&nbsp;<span class="op" id="7087544">=</span>&nbsp;<span class="op" id="7087546">[</span><span class="op" id="7087547">]</span><span class="ident" id="7087548">testpair</span><span class="op" id="7087556">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087559">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7087599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087603">&#34;&#34;</span><span class="op" id="7087605">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087609">&#34;&#34;</span><span class="op" id="7087611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7087614">}</span><span class="op" id="7087615">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7087618">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7087640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087644">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7087727">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087732">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7087816">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087821">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7087899">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087904">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7087939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7087943">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7088021">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7088026">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7088108">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7088113">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7088193">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7088198">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7088278">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7088283">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7088326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088329">}</span><span class="op" id="7088330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7088333">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7088382">&#34;\000\000\000\000&#34;</span><span class="op" id="7088400">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7088404">&#34;z&#34;</span><span class="op" id="7088407">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088410">}</span><span class="op" id="7088411">,</span><br>
<span class="lineno"></span><span class="op" id="7088413">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7088416">var</span>&nbsp;<span class="ident" id="7088420">bigtest</span>&nbsp;<span class="op" id="7088428">=</span>&nbsp;<span class="ident" id="7088430">pairs</span><span class="op" id="7088435">[</span><span class="builtinfunc" id="7088436">len</span><span class="op" id="7088439">(</span><span class="ident" id="7088440">pairs</span><span class="op" id="7088445">)</span><span class="op" id="7088446">-</span><span class="num" id="7088447">1</span><span class="op" id="7088448">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7088451">func</span>&nbsp;<span class="ident" id="7088456">testEqual</span><span class="op" id="7088465">(</span><span class="ident" id="7088466">t</span>&nbsp;<span class="op" id="7088468">*</span><span class="ident" id="7088469">testing</span><span class="op" id="7088476">.</span><span class="ident" id="7088477">T</span><span class="op" id="7088478">,</span>&nbsp;<span class="ident" id="7088480">msg</span>&nbsp;<span class="builtintype" id="7088484">string</span><span class="op" id="7088490">,</span>&nbsp;<span class="ident" id="7088492">args</span>&nbsp;<span class="op" id="7088497">...</span><span class="keyword" id="7088500">interface</span><span class="op" id="7088509">{</span><span class="op" id="7088510">}</span><span class="op" id="7088511">)</span>&nbsp;<span class="builtintype" id="7088513">bool</span>&nbsp;<span class="op" id="7088518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088521">if</span>&nbsp;<span class="ident" id="7088524">args</span><span class="op" id="7088528">[</span><span class="builtinfunc" id="7088529">len</span><span class="op" id="7088532">(</span><span class="ident" id="7088533">args</span><span class="op" id="7088537">)</span><span class="op" id="7088538">-</span><span class="num" id="7088539">2</span><span class="op" id="7088540">]</span>&nbsp;<span class="op" id="7088542">!=</span>&nbsp;<span class="ident" id="7088545">args</span><span class="op" id="7088549">[</span><span class="builtinfunc" id="7088550">len</span><span class="op" id="7088553">(</span><span class="ident" id="7088554">args</span><span class="op" id="7088558">)</span><span class="op" id="7088559">-</span><span class="num" id="7088560">1</span><span class="op" id="7088561">]</span>&nbsp;<span class="op" id="7088563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088567">t</span><span class="op" id="7088568">.</span><span class="ident" id="7088569">Errorf</span><span class="op" id="7088575">(</span><span class="ident" id="7088576">msg</span><span class="op" id="7088579">,</span>&nbsp;<span class="ident" id="7088581">args</span><span class="op" id="7088585">...</span><span class="op" id="7088588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088592">return</span>&nbsp;<span class="builtintype" id="7088599">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088609">return</span>&nbsp;<span class="builtintype" id="7088616">true</span><br>
<span class="lineno"></span><span class="op" id="7088621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7088624">func</span>&nbsp;<span class="ident" id="7088629">strip85</span><span class="op" id="7088636">(</span><span class="ident" id="7088637">s</span>&nbsp;<span class="builtintype" id="7088639">string</span><span class="op" id="7088645">)</span>&nbsp;<span class="builtintype" id="7088647">string</span>&nbsp;<span class="op" id="7088654">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088657">t</span>&nbsp;<span class="op" id="7088659">:=</span>&nbsp;<span class="builtinfunc" id="7088662">make</span><span class="op" id="7088666">(</span><span class="op" id="7088667">[</span><span class="op" id="7088668">]</span><span class="builtintype" id="7088669">byte</span><span class="op" id="7088673">,</span>&nbsp;<span class="builtinfunc" id="7088675">len</span><span class="op" id="7088678">(</span><span class="ident" id="7088679">s</span><span class="op" id="7088680">)</span><span class="op" id="7088681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088684">w</span>&nbsp;<span class="op" id="7088686">:=</span>&nbsp;<span class="num" id="7088689">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088692">for</span>&nbsp;<span class="ident" id="7088696">r</span>&nbsp;<span class="op" id="7088698">:=</span>&nbsp;<span class="num" id="7088701">0</span><span class="op" id="7088702">;</span>&nbsp;<span class="ident" id="7088704">r</span>&nbsp;<span class="op" id="7088706">&lt;</span>&nbsp;<span class="builtinfunc" id="7088708">len</span><span class="op" id="7088711">(</span><span class="ident" id="7088712">s</span><span class="op" id="7088713">)</span><span class="op" id="7088714">;</span>&nbsp;<span class="ident" id="7088716">r</span><span class="op" id="7088717">++</span>&nbsp;<span class="op" id="7088720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088724">c</span>&nbsp;<span class="op" id="7088726">:=</span>&nbsp;<span class="ident" id="7088729">s</span><span class="op" id="7088730">[</span><span class="ident" id="7088731">r</span><span class="op" id="7088732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088736">if</span>&nbsp;<span class="ident" id="7088739">c</span>&nbsp;<span class="op" id="7088741">&gt;</span>&nbsp;<span class="string" id="7088743">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7088747">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088752">t</span><span class="op" id="7088753">[</span><span class="ident" id="7088754">w</span><span class="op" id="7088755">]</span>&nbsp;<span class="op" id="7088757">=</span>&nbsp;<span class="ident" id="7088759">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088764">w</span><span class="op" id="7088765">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7088773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088776">return</span>&nbsp;<span class="builtintype" id="7088783">string</span><span class="op" id="7088789">(</span><span class="ident" id="7088790">t</span><span class="op" id="7088791">[</span><span class="num" id="7088792">0</span><span class="op" id="7088793">:</span><span class="ident" id="7088794">w</span><span class="op" id="7088795">]</span><span class="op" id="7088796">)</span><br>
<span class="lineno">65</span><span class="op" id="7088798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7088801">func</span>&nbsp;<span class="ident" id="7088806">TestEncode</span><span class="op" id="7088816">(</span><span class="ident" id="7088817">t</span>&nbsp;<span class="op" id="7088819">*</span><span class="ident" id="7088820">testing</span><span class="op" id="7088827">.</span><span class="ident" id="7088828">T</span><span class="op" id="7088829">)</span>&nbsp;<span class="op" id="7088831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7088834">for</span>&nbsp;<span class="ident" id="7088838">_</span><span class="op" id="7088839">,</span>&nbsp;<span class="ident" id="7088841">p</span>&nbsp;<span class="op" id="7088843">:=</span>&nbsp;<span class="keyword" id="7088846">range</span>&nbsp;<span class="ident" id="7088852">pairs</span>&nbsp;<span class="op" id="7088858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088862">buf</span>&nbsp;<span class="op" id="7088866">:=</span>&nbsp;<span class="builtinfunc" id="7088869">make</span><span class="op" id="7088873">(</span><span class="op" id="7088874">[</span><span class="op" id="7088875">]</span><span class="builtintype" id="7088876">byte</span><span class="op" id="7088880">,</span>&nbsp;<span class="ident" id="7088882">MaxEncodedLen</span><span class="op" id="7088895">(</span><span class="builtinfunc" id="7088896">len</span><span class="op" id="7088899">(</span><span class="ident" id="7088900">p</span><span class="op" id="7088901">.</span><span class="ident" id="7088902">decoded</span><span class="op" id="7088909">)</span><span class="op" id="7088910">)</span><span class="op" id="7088911">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088915">n</span>&nbsp;<span class="op" id="7088917">:=</span>&nbsp;<span class="ident" id="7088920">Encode</span><span class="op" id="7088926">(</span><span class="ident" id="7088927">buf</span><span class="op" id="7088930">,</span>&nbsp;<span class="op" id="7088932">[</span><span class="op" id="7088933">]</span><span class="builtintype" id="7088934">byte</span><span class="op" id="7088938">(</span><span class="ident" id="7088939">p</span><span class="op" id="7088940">.</span><span class="ident" id="7088941">decoded</span><span class="op" id="7088948">)</span><span class="op" id="7088949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088953">buf</span>&nbsp;<span class="op" id="7088957">=</span>&nbsp;<span class="ident" id="7088959">buf</span><span class="op" id="7088962">[</span><span class="num" id="7088963">0</span><span class="op" id="7088964">:</span><span class="ident" id="7088965">n</span><span class="op" id="7088966">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7088970">testEqual</span><span class="op" id="7088979">(</span><span class="ident" id="7088980">t</span><span class="op" id="7088981">,</span>&nbsp;<span class="string" id="7088983">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7089009">,</span>&nbsp;<span class="ident" id="7089011">p</span><span class="op" id="7089012">.</span><span class="ident" id="7089013">decoded</span><span class="op" id="7089020">,</span>&nbsp;<span class="ident" id="7089022">strip85</span><span class="op" id="7089029">(</span><span class="builtintype" id="7089030">string</span><span class="op" id="7089036">(</span><span class="ident" id="7089037">buf</span><span class="op" id="7089040">)</span><span class="op" id="7089041">)</span><span class="op" id="7089042">,</span>&nbsp;<span class="ident" id="7089044">strip85</span><span class="op" id="7089051">(</span><span class="ident" id="7089052">p</span><span class="op" id="7089053">.</span><span class="ident" id="7089054">encoded</span><span class="op" id="7089061">)</span><span class="op" id="7089062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089065">}</span><br>
<span class="lineno"></span><span class="op" id="7089067">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7089070">func</span>&nbsp;<span class="ident" id="7089075">TestEncoder</span><span class="op" id="7089086">(</span><span class="ident" id="7089087">t</span>&nbsp;<span class="op" id="7089089">*</span><span class="ident" id="7089090">testing</span><span class="op" id="7089097">.</span><span class="ident" id="7089098">T</span><span class="op" id="7089099">)</span>&nbsp;<span class="op" id="7089101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089104">for</span>&nbsp;<span class="ident" id="7089108">_</span><span class="op" id="7089109">,</span>&nbsp;<span class="ident" id="7089111">p</span>&nbsp;<span class="op" id="7089113">:=</span>&nbsp;<span class="keyword" id="7089116">range</span>&nbsp;<span class="ident" id="7089122">pairs</span>&nbsp;<span class="op" id="7089128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089132">bb</span>&nbsp;<span class="op" id="7089135">:=</span>&nbsp;<span class="op" id="7089138">&amp;</span><span class="ident" id="7089139">bytes</span><span class="op" id="7089144">.</span><span class="ident" id="7089145">Buffer</span><span class="op" id="7089151">{</span><span class="op" id="7089152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089156">encoder</span>&nbsp;<span class="op" id="7089164">:=</span>&nbsp;<span class="ident" id="7089167">NewEncoder</span><span class="op" id="7089177">(</span><span class="ident" id="7089178">bb</span><span class="op" id="7089180">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089184">encoder</span><span class="op" id="7089191">.</span><span class="ident" id="7089192">Write</span><span class="op" id="7089197">(</span><span class="op" id="7089198">[</span><span class="op" id="7089199">]</span><span class="builtintype" id="7089200">byte</span><span class="op" id="7089204">(</span><span class="ident" id="7089205">p</span><span class="op" id="7089206">.</span><span class="ident" id="7089207">decoded</span><span class="op" id="7089214">)</span><span class="op" id="7089215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089219">encoder</span><span class="op" id="7089226">.</span><span class="ident" id="7089227">Close</span><span class="op" id="7089232">(</span><span class="op" id="7089233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089237">testEqual</span><span class="op" id="7089246">(</span><span class="ident" id="7089247">t</span><span class="op" id="7089248">,</span>&nbsp;<span class="string" id="7089250">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7089276">,</span>&nbsp;<span class="ident" id="7089278">p</span><span class="op" id="7089279">.</span><span class="ident" id="7089280">decoded</span><span class="op" id="7089287">,</span>&nbsp;<span class="ident" id="7089289">strip85</span><span class="op" id="7089296">(</span><span class="ident" id="7089297">bb</span><span class="op" id="7089299">.</span><span class="ident" id="7089300">String</span><span class="op" id="7089306">(</span><span class="op" id="7089307">)</span><span class="op" id="7089308">)</span><span class="op" id="7089309">,</span>&nbsp;<span class="ident" id="7089311">strip85</span><span class="op" id="7089318">(</span><span class="ident" id="7089319">p</span><span class="op" id="7089320">.</span><span class="ident" id="7089321">encoded</span><span class="op" id="7089328">)</span><span class="op" id="7089329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089332">}</span><br>
<span class="lineno"></span><span class="op" id="7089334">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7089337">func</span>&nbsp;<span class="ident" id="7089342">TestEncoderBuffering</span><span class="op" id="7089362">(</span><span class="ident" id="7089363">t</span>&nbsp;<span class="op" id="7089365">*</span><span class="ident" id="7089366">testing</span><span class="op" id="7089373">.</span><span class="ident" id="7089374">T</span><span class="op" id="7089375">)</span>&nbsp;<span class="op" id="7089377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089380">input</span>&nbsp;<span class="op" id="7089386">:=</span>&nbsp;<span class="op" id="7089389">[</span><span class="op" id="7089390">]</span><span class="builtintype" id="7089391">byte</span><span class="op" id="7089395">(</span><span class="ident" id="7089396">bigtest</span><span class="op" id="7089403">.</span><span class="ident" id="7089404">decoded</span><span class="op" id="7089411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089414">for</span>&nbsp;<span class="ident" id="7089418">bs</span>&nbsp;<span class="op" id="7089421">:=</span>&nbsp;<span class="num" id="7089424">1</span><span class="op" id="7089425">;</span>&nbsp;<span class="ident" id="7089427">bs</span>&nbsp;<span class="op" id="7089430">&lt;=</span>&nbsp;<span class="num" id="7089433">12</span><span class="op" id="7089435">;</span>&nbsp;<span class="ident" id="7089437">bs</span><span class="op" id="7089439">++</span>&nbsp;<span class="op" id="7089442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089446">bb</span>&nbsp;<span class="op" id="7089449">:=</span>&nbsp;<span class="op" id="7089452">&amp;</span><span class="ident" id="7089453">bytes</span><span class="op" id="7089458">.</span><span class="ident" id="7089459">Buffer</span><span class="op" id="7089465">{</span><span class="op" id="7089466">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089470">encoder</span>&nbsp;<span class="op" id="7089478">:=</span>&nbsp;<span class="ident" id="7089481">NewEncoder</span><span class="op" id="7089491">(</span><span class="ident" id="7089492">bb</span><span class="op" id="7089494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089498">for</span>&nbsp;<span class="ident" id="7089502">pos</span>&nbsp;<span class="op" id="7089506">:=</span>&nbsp;<span class="num" id="7089509">0</span><span class="op" id="7089510">;</span>&nbsp;<span class="ident" id="7089512">pos</span>&nbsp;<span class="op" id="7089516">&lt;</span>&nbsp;<span class="builtinfunc" id="7089518">len</span><span class="op" id="7089521">(</span><span class="ident" id="7089522">input</span><span class="op" id="7089527">)</span><span class="op" id="7089528">;</span>&nbsp;<span class="ident" id="7089530">pos</span>&nbsp;<span class="op" id="7089534">+=</span>&nbsp;<span class="ident" id="7089537">bs</span>&nbsp;<span class="op" id="7089540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089545">end</span>&nbsp;<span class="op" id="7089549">:=</span>&nbsp;<span class="ident" id="7089552">pos</span>&nbsp;<span class="op" id="7089556">+</span>&nbsp;<span class="ident" id="7089558">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7089564">if</span>&nbsp;<span class="ident" id="7089567">end</span>&nbsp;<span class="op" id="7089571">&gt;</span>&nbsp;<span class="builtinfunc" id="7089573">len</span><span class="op" id="7089576">(</span><span class="ident" id="7089577">input</span><span class="op" id="7089582">)</span>&nbsp;<span class="op" id="7089584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089590">end</span>&nbsp;<span class="op" id="7089594">=</span>&nbsp;<span class="builtinfunc" id="7089596">len</span><span class="op" id="7089599">(</span><span class="ident" id="7089600">input</span><span class="op" id="7089605">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089615">n</span><span class="op" id="7089616">,</span>&nbsp;<span class="ident" id="7089618">err</span>&nbsp;<span class="op" id="7089622">:=</span>&nbsp;<span class="ident" id="7089625">encoder</span><span class="op" id="7089632">.</span><span class="ident" id="7089633">Write</span><span class="op" id="7089638">(</span><span class="ident" id="7089639">input</span><span class="op" id="7089644">[</span><span class="ident" id="7089645">pos</span><span class="op" id="7089648">:</span><span class="ident" id="7089649">end</span><span class="op" id="7089652">]</span><span class="op" id="7089653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089658">testEqual</span><span class="op" id="7089667">(</span><span class="ident" id="7089668">t</span><span class="op" id="7089669">,</span>&nbsp;<span class="string" id="7089671">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7089705">,</span>&nbsp;<span class="ident" id="7089707">input</span><span class="op" id="7089712">[</span><span class="ident" id="7089713">pos</span><span class="op" id="7089716">:</span><span class="ident" id="7089717">end</span><span class="op" id="7089720">]</span><span class="op" id="7089721">,</span>&nbsp;<span class="ident" id="7089723">err</span><span class="op" id="7089726">,</span>&nbsp;<span class="builtintype" id="7089728">error</span><span class="op" id="7089733">(</span><span class="ident" id="7089734">nil</span><span class="op" id="7089737">)</span><span class="op" id="7089738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089743">testEqual</span><span class="op" id="7089752">(</span><span class="ident" id="7089753">t</span><span class="op" id="7089754">,</span>&nbsp;<span class="string" id="7089756">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7089791">,</span>&nbsp;<span class="ident" id="7089793">input</span><span class="op" id="7089798">[</span><span class="ident" id="7089799">pos</span><span class="op" id="7089802">:</span><span class="ident" id="7089803">end</span><span class="op" id="7089806">]</span><span class="op" id="7089807">,</span>&nbsp;<span class="ident" id="7089809">n</span><span class="op" id="7089810">,</span>&nbsp;<span class="ident" id="7089812">end</span><span class="op" id="7089815">-</span><span class="ident" id="7089816">pos</span><span class="op" id="7089819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7089823">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089827">err</span>&nbsp;<span class="op" id="7089831">:=</span>&nbsp;<span class="ident" id="7089834">encoder</span><span class="op" id="7089841">.</span><span class="ident" id="7089842">Close</span><span class="op" id="7089847">(</span><span class="op" id="7089848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089852">testEqual</span><span class="op" id="7089861">(</span><span class="ident" id="7089862">t</span><span class="op" id="7089863">,</span>&nbsp;<span class="string" id="7089865">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7089895">,</span>&nbsp;<span class="ident" id="7089897">err</span><span class="op" id="7089900">,</span>&nbsp;<span class="builtintype" id="7089902">error</span><span class="op" id="7089907">(</span><span class="ident" id="7089908">nil</span><span class="op" id="7089911">)</span><span class="op" id="7089912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7089916">testEqual</span><span class="op" id="7089925">(</span><span class="ident" id="7089926">t</span><span class="op" id="7089927">,</span>&nbsp;<span class="string" id="7089929">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7089962">,</span>&nbsp;<span class="ident" id="7089964">bs</span><span class="op" id="7089966">,</span>&nbsp;<span class="ident" id="7089968">bigtest</span><span class="op" id="7089975">.</span><span class="ident" id="7089976">decoded</span><span class="op" id="7089983">,</span>&nbsp;<span class="ident" id="7089985">strip85</span><span class="op" id="7089992">(</span><span class="ident" id="7089993">bb</span><span class="op" id="7089995">.</span><span class="ident" id="7089996">String</span><span class="op" id="7090002">(</span><span class="op" id="7090003">)</span><span class="op" id="7090004">)</span><span class="op" id="7090005">,</span>&nbsp;<span class="ident" id="7090007">strip85</span><span class="op" id="7090014">(</span><span class="ident" id="7090015">bigtest</span><span class="op" id="7090022">.</span><span class="ident" id="7090023">encoded</span><span class="op" id="7090030">)</span><span class="op" id="7090031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090034">}</span><br>
<span class="lineno"></span><span class="op" id="7090036">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7090039">func</span>&nbsp;<span class="ident" id="7090044">TestDecode</span><span class="op" id="7090054">(</span><span class="ident" id="7090055">t</span>&nbsp;<span class="op" id="7090057">*</span><span class="ident" id="7090058">testing</span><span class="op" id="7090065">.</span><span class="ident" id="7090066">T</span><span class="op" id="7090067">)</span>&nbsp;<span class="op" id="7090069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090072">for</span>&nbsp;<span class="ident" id="7090076">_</span><span class="op" id="7090077">,</span>&nbsp;<span class="ident" id="7090079">p</span>&nbsp;<span class="op" id="7090081">:=</span>&nbsp;<span class="keyword" id="7090084">range</span>&nbsp;<span class="ident" id="7090090">pairs</span>&nbsp;<span class="op" id="7090096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090100">dbuf</span>&nbsp;<span class="op" id="7090105">:=</span>&nbsp;<span class="builtinfunc" id="7090108">make</span><span class="op" id="7090112">(</span><span class="op" id="7090113">[</span><span class="op" id="7090114">]</span><span class="builtintype" id="7090115">byte</span><span class="op" id="7090119">,</span>&nbsp;<span class="num" id="7090121">4</span><span class="op" id="7090122">*</span><span class="builtinfunc" id="7090123">len</span><span class="op" id="7090126">(</span><span class="ident" id="7090127">p</span><span class="op" id="7090128">.</span><span class="ident" id="7090129">encoded</span><span class="op" id="7090136">)</span><span class="op" id="7090137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090141">ndst</span><span class="op" id="7090145">,</span>&nbsp;<span class="ident" id="7090147">nsrc</span><span class="op" id="7090151">,</span>&nbsp;<span class="ident" id="7090153">err</span>&nbsp;<span class="op" id="7090157">:=</span>&nbsp;<span class="ident" id="7090160">Decode</span><span class="op" id="7090166">(</span><span class="ident" id="7090167">dbuf</span><span class="op" id="7090171">,</span>&nbsp;<span class="op" id="7090173">[</span><span class="op" id="7090174">]</span><span class="builtintype" id="7090175">byte</span><span class="op" id="7090179">(</span><span class="ident" id="7090180">p</span><span class="op" id="7090181">.</span><span class="ident" id="7090182">encoded</span><span class="op" id="7090189">)</span><span class="op" id="7090190">,</span>&nbsp;<span class="builtintype" id="7090192">true</span><span class="op" id="7090196">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090200">testEqual</span><span class="op" id="7090209">(</span><span class="ident" id="7090210">t</span><span class="op" id="7090211">,</span>&nbsp;<span class="string" id="7090213">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7090245">,</span>&nbsp;<span class="ident" id="7090247">p</span><span class="op" id="7090248">.</span><span class="ident" id="7090249">encoded</span><span class="op" id="7090256">,</span>&nbsp;<span class="ident" id="7090258">err</span><span class="op" id="7090261">,</span>&nbsp;<span class="builtintype" id="7090263">error</span><span class="op" id="7090268">(</span><span class="ident" id="7090269">nil</span><span class="op" id="7090272">)</span><span class="op" id="7090273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090277">testEqual</span><span class="op" id="7090286">(</span><span class="ident" id="7090287">t</span><span class="op" id="7090288">,</span>&nbsp;<span class="string" id="7090290">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7090321">,</span>&nbsp;<span class="ident" id="7090323">p</span><span class="op" id="7090324">.</span><span class="ident" id="7090325">encoded</span><span class="op" id="7090332">,</span>&nbsp;<span class="ident" id="7090334">nsrc</span><span class="op" id="7090338">,</span>&nbsp;<span class="builtinfunc" id="7090340">len</span><span class="op" id="7090343">(</span><span class="ident" id="7090344">p</span><span class="op" id="7090345">.</span><span class="ident" id="7090346">encoded</span><span class="op" id="7090353">)</span><span class="op" id="7090354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090358">testEqual</span><span class="op" id="7090367">(</span><span class="ident" id="7090368">t</span><span class="op" id="7090369">,</span>&nbsp;<span class="string" id="7090371">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7090402">,</span>&nbsp;<span class="ident" id="7090404">p</span><span class="op" id="7090405">.</span><span class="ident" id="7090406">encoded</span><span class="op" id="7090413">,</span>&nbsp;<span class="ident" id="7090415">ndst</span><span class="op" id="7090419">,</span>&nbsp;<span class="builtinfunc" id="7090421">len</span><span class="op" id="7090424">(</span><span class="ident" id="7090425">p</span><span class="op" id="7090426">.</span><span class="ident" id="7090427">decoded</span><span class="op" id="7090434">)</span><span class="op" id="7090435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090439">testEqual</span><span class="op" id="7090448">(</span><span class="ident" id="7090449">t</span><span class="op" id="7090450">,</span>&nbsp;<span class="string" id="7090452">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7090478">,</span>&nbsp;<span class="ident" id="7090480">p</span><span class="op" id="7090481">.</span><span class="ident" id="7090482">encoded</span><span class="op" id="7090489">,</span>&nbsp;<span class="builtintype" id="7090491">string</span><span class="op" id="7090497">(</span><span class="ident" id="7090498">dbuf</span><span class="op" id="7090502">[</span><span class="num" id="7090503">0</span><span class="op" id="7090504">:</span><span class="ident" id="7090505">ndst</span><span class="op" id="7090509">]</span><span class="op" id="7090510">)</span><span class="op" id="7090511">,</span>&nbsp;<span class="ident" id="7090513">p</span><span class="op" id="7090514">.</span><span class="ident" id="7090515">decoded</span><span class="op" id="7090522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090525">}</span><br>
<span class="lineno">115</span><span class="op" id="7090527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7090530">func</span>&nbsp;<span class="ident" id="7090535">TestDecoder</span><span class="op" id="7090546">(</span><span class="ident" id="7090547">t</span>&nbsp;<span class="op" id="7090549">*</span><span class="ident" id="7090550">testing</span><span class="op" id="7090557">.</span><span class="ident" id="7090558">T</span><span class="op" id="7090559">)</span>&nbsp;<span class="op" id="7090561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090564">for</span>&nbsp;<span class="ident" id="7090568">_</span><span class="op" id="7090569">,</span>&nbsp;<span class="ident" id="7090571">p</span>&nbsp;<span class="op" id="7090573">:=</span>&nbsp;<span class="keyword" id="7090576">range</span>&nbsp;<span class="ident" id="7090582">pairs</span>&nbsp;<span class="op" id="7090588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090592">decoder</span>&nbsp;<span class="op" id="7090600">:=</span>&nbsp;<span class="ident" id="7090603">NewDecoder</span><span class="op" id="7090613">(</span><span class="ident" id="7090614">strings</span><span class="op" id="7090621">.</span><span class="ident" id="7090622">NewReader</span><span class="op" id="7090631">(</span><span class="ident" id="7090632">p</span><span class="op" id="7090633">.</span><span class="ident" id="7090634">encoded</span><span class="op" id="7090641">)</span><span class="op" id="7090642">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090646">dbuf</span><span class="op" id="7090650">,</span>&nbsp;<span class="ident" id="7090652">err</span>&nbsp;<span class="op" id="7090656">:=</span>&nbsp;<span class="ident" id="7090659">ioutil</span><span class="op" id="7090665">.</span><span class="ident" id="7090666">ReadAll</span><span class="op" id="7090673">(</span><span class="ident" id="7090674">decoder</span><span class="op" id="7090681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090685">if</span>&nbsp;<span class="ident" id="7090688">err</span>&nbsp;<span class="op" id="7090692">!=</span>&nbsp;<span class="ident" id="7090695">nil</span>&nbsp;<span class="op" id="7090699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090704">t</span><span class="op" id="7090705">.</span><span class="ident" id="7090706">Fatal</span><span class="op" id="7090711">(</span><span class="string" id="7090712">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7090725">,</span>&nbsp;<span class="ident" id="7090727">err</span><span class="op" id="7090730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090738">testEqual</span><span class="op" id="7090747">(</span><span class="ident" id="7090748">t</span><span class="op" id="7090749">,</span>&nbsp;<span class="string" id="7090751">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7090786">,</span>&nbsp;<span class="ident" id="7090788">p</span><span class="op" id="7090789">.</span><span class="ident" id="7090790">encoded</span><span class="op" id="7090797">,</span>&nbsp;<span class="builtinfunc" id="7090799">len</span><span class="op" id="7090802">(</span><span class="ident" id="7090803">dbuf</span><span class="op" id="7090807">)</span><span class="op" id="7090808">,</span>&nbsp;<span class="builtinfunc" id="7090810">len</span><span class="op" id="7090813">(</span><span class="ident" id="7090814">p</span><span class="op" id="7090815">.</span><span class="ident" id="7090816">decoded</span><span class="op" id="7090823">)</span><span class="op" id="7090824">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090828">testEqual</span><span class="op" id="7090837">(</span><span class="ident" id="7090838">t</span><span class="op" id="7090839">,</span>&nbsp;<span class="string" id="7090841">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7090871">,</span>&nbsp;<span class="ident" id="7090873">p</span><span class="op" id="7090874">.</span><span class="ident" id="7090875">encoded</span><span class="op" id="7090882">,</span>&nbsp;<span class="builtintype" id="7090884">string</span><span class="op" id="7090890">(</span><span class="ident" id="7090891">dbuf</span><span class="op" id="7090895">)</span><span class="op" id="7090896">,</span>&nbsp;<span class="ident" id="7090898">p</span><span class="op" id="7090899">.</span><span class="ident" id="7090900">decoded</span><span class="op" id="7090907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7090911">if</span>&nbsp;<span class="ident" id="7090914">err</span>&nbsp;<span class="op" id="7090918">!=</span>&nbsp;<span class="ident" id="7090921">nil</span>&nbsp;<span class="op" id="7090925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7090930">testEqual</span><span class="op" id="7090939">(</span><span class="ident" id="7090940">t</span><span class="op" id="7090941">,</span>&nbsp;<span class="string" id="7090943">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7090971">,</span>&nbsp;<span class="ident" id="7090973">p</span><span class="op" id="7090974">.</span><span class="ident" id="7090975">encoded</span><span class="op" id="7090982">,</span>&nbsp;<span class="ident" id="7090984">err</span><span class="op" id="7090987">,</span>&nbsp;<span class="ident" id="7090989">io</span><span class="op" id="7090991">.</span><span class="ident" id="7090992">EOF</span><span class="op" id="7090995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7090999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091002">}</span><br>
<span class="lineno">130</span><span class="op" id="7091004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7091007">func</span>&nbsp;<span class="ident" id="7091012">TestDecoderBuffering</span><span class="op" id="7091032">(</span><span class="ident" id="7091033">t</span>&nbsp;<span class="op" id="7091035">*</span><span class="ident" id="7091036">testing</span><span class="op" id="7091043">.</span><span class="ident" id="7091044">T</span><span class="op" id="7091045">)</span>&nbsp;<span class="op" id="7091047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091050">for</span>&nbsp;<span class="ident" id="7091054">bs</span>&nbsp;<span class="op" id="7091057">:=</span>&nbsp;<span class="num" id="7091060">1</span><span class="op" id="7091061">;</span>&nbsp;<span class="ident" id="7091063">bs</span>&nbsp;<span class="op" id="7091066">&lt;=</span>&nbsp;<span class="num" id="7091069">12</span><span class="op" id="7091071">;</span>&nbsp;<span class="ident" id="7091073">bs</span><span class="op" id="7091075">++</span>&nbsp;<span class="op" id="7091078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091082">decoder</span>&nbsp;<span class="op" id="7091090">:=</span>&nbsp;<span class="ident" id="7091093">NewDecoder</span><span class="op" id="7091103">(</span><span class="ident" id="7091104">strings</span><span class="op" id="7091111">.</span><span class="ident" id="7091112">NewReader</span><span class="op" id="7091121">(</span><span class="ident" id="7091122">bigtest</span><span class="op" id="7091129">.</span><span class="ident" id="7091130">encoded</span><span class="op" id="7091137">)</span><span class="op" id="7091138">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091142">buf</span>&nbsp;<span class="op" id="7091146">:=</span>&nbsp;<span class="builtinfunc" id="7091149">make</span><span class="op" id="7091153">(</span><span class="op" id="7091154">[</span><span class="op" id="7091155">]</span><span class="builtintype" id="7091156">byte</span><span class="op" id="7091160">,</span>&nbsp;<span class="builtinfunc" id="7091162">len</span><span class="op" id="7091165">(</span><span class="ident" id="7091166">bigtest</span><span class="op" id="7091173">.</span><span class="ident" id="7091174">decoded</span><span class="op" id="7091181">)</span><span class="op" id="7091182">+</span><span class="num" id="7091183">12</span><span class="op" id="7091185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091189">var</span>&nbsp;<span class="ident" id="7091193">total</span>&nbsp;<span class="builtintype" id="7091199">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091205">for</span>&nbsp;<span class="ident" id="7091209">total</span>&nbsp;<span class="op" id="7091215">=</span>&nbsp;<span class="num" id="7091217">0</span><span class="op" id="7091218">;</span>&nbsp;<span class="ident" id="7091220">total</span>&nbsp;<span class="op" id="7091226">&lt;</span>&nbsp;<span class="builtinfunc" id="7091228">len</span><span class="op" id="7091231">(</span><span class="ident" id="7091232">bigtest</span><span class="op" id="7091239">.</span><span class="ident" id="7091240">decoded</span><span class="op" id="7091247">)</span><span class="op" id="7091248">;</span>&nbsp;<span class="op" id="7091250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091255">n</span><span class="op" id="7091256">,</span>&nbsp;<span class="ident" id="7091258">err</span>&nbsp;<span class="op" id="7091262">:=</span>&nbsp;<span class="ident" id="7091265">decoder</span><span class="op" id="7091272">.</span><span class="ident" id="7091273">Read</span><span class="op" id="7091277">(</span><span class="ident" id="7091278">buf</span><span class="op" id="7091281">[</span><span class="ident" id="7091282">total</span>&nbsp;<span class="op" id="7091288">:</span>&nbsp;<span class="ident" id="7091290">total</span><span class="op" id="7091295">+</span><span class="ident" id="7091296">bs</span><span class="op" id="7091298">]</span><span class="op" id="7091299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091304">testEqual</span><span class="op" id="7091313">(</span><span class="ident" id="7091314">t</span><span class="op" id="7091315">,</span>&nbsp;<span class="string" id="7091317">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7091362">,</span>&nbsp;<span class="ident" id="7091364">bigtest</span><span class="op" id="7091371">.</span><span class="ident" id="7091372">encoded</span><span class="op" id="7091379">,</span>&nbsp;<span class="ident" id="7091381">total</span><span class="op" id="7091386">,</span>&nbsp;<span class="ident" id="7091388">n</span><span class="op" id="7091389">,</span>&nbsp;<span class="ident" id="7091391">err</span><span class="op" id="7091394">,</span>&nbsp;<span class="builtintype" id="7091396">error</span><span class="op" id="7091401">(</span><span class="ident" id="7091402">nil</span><span class="op" id="7091405">)</span><span class="op" id="7091406">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091411">total</span>&nbsp;<span class="op" id="7091417">+=</span>&nbsp;<span class="ident" id="7091420">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091428">testEqual</span><span class="op" id="7091437">(</span><span class="ident" id="7091438">t</span><span class="op" id="7091439">,</span>&nbsp;<span class="string" id="7091441">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7091474">,</span>&nbsp;<span class="ident" id="7091476">bs</span><span class="op" id="7091478">,</span>&nbsp;<span class="ident" id="7091480">bigtest</span><span class="op" id="7091487">.</span><span class="ident" id="7091488">encoded</span><span class="op" id="7091495">,</span>&nbsp;<span class="builtintype" id="7091497">string</span><span class="op" id="7091503">(</span><span class="ident" id="7091504">buf</span><span class="op" id="7091507">[</span><span class="num" id="7091508">0</span><span class="op" id="7091509">:</span><span class="ident" id="7091510">total</span><span class="op" id="7091515">]</span><span class="op" id="7091516">)</span><span class="op" id="7091517">,</span>&nbsp;<span class="ident" id="7091519">bigtest</span><span class="op" id="7091526">.</span><span class="ident" id="7091527">decoded</span><span class="op" id="7091534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091537">}</span><br>
<span class="lineno"></span><span class="op" id="7091539">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7091542">func</span>&nbsp;<span class="ident" id="7091547">TestDecodeCorrupt</span><span class="op" id="7091564">(</span><span class="ident" id="7091565">t</span>&nbsp;<span class="op" id="7091567">*</span><span class="ident" id="7091568">testing</span><span class="op" id="7091575">.</span><span class="ident" id="7091576">T</span><span class="op" id="7091577">)</span>&nbsp;<span class="op" id="7091579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091582">type</span>&nbsp;<span class="ident" id="7091587">corrupt</span>&nbsp;<span class="keyword" id="7091595">struct</span>&nbsp;<span class="op" id="7091602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091606">e</span>&nbsp;<span class="builtintype" id="7091608">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091617">p</span>&nbsp;<span class="builtintype" id="7091619">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091627">examples</span>&nbsp;<span class="op" id="7091636">:=</span>&nbsp;<span class="op" id="7091639">[</span><span class="op" id="7091640">]</span><span class="ident" id="7091641">corrupt</span><span class="op" id="7091648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091652">{</span><span class="string" id="7091653">&#34;v&#34;</span><span class="op" id="7091656">,</span>&nbsp;<span class="num" id="7091658">0</span><span class="op" id="7091659">}</span><span class="op" id="7091660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091664">{</span><span class="string" id="7091665">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7091678">,</span>&nbsp;<span class="num" id="7091680">1</span><span class="op" id="7091681">}</span><span class="op" id="7091682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7091685">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091689">for</span>&nbsp;<span class="ident" id="7091693">_</span><span class="op" id="7091694">,</span>&nbsp;<span class="ident" id="7091696">e</span>&nbsp;<span class="op" id="7091698">:=</span>&nbsp;<span class="keyword" id="7091701">range</span>&nbsp;<span class="ident" id="7091707">examples</span>&nbsp;<span class="op" id="7091716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091720">dbuf</span>&nbsp;<span class="op" id="7091725">:=</span>&nbsp;<span class="builtinfunc" id="7091728">make</span><span class="op" id="7091732">(</span><span class="op" id="7091733">[</span><span class="op" id="7091734">]</span><span class="builtintype" id="7091735">byte</span><span class="op" id="7091739">,</span>&nbsp;<span class="num" id="7091741">4</span><span class="op" id="7091742">*</span><span class="builtinfunc" id="7091743">len</span><span class="op" id="7091746">(</span><span class="ident" id="7091747">e</span><span class="op" id="7091748">.</span><span class="ident" id="7091749">e</span><span class="op" id="7091750">)</span><span class="op" id="7091751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091755">_</span><span class="op" id="7091756">,</span>&nbsp;<span class="ident" id="7091758">_</span><span class="op" id="7091759">,</span>&nbsp;<span class="ident" id="7091761">err</span>&nbsp;<span class="op" id="7091765">:=</span>&nbsp;<span class="ident" id="7091768">Decode</span><span class="op" id="7091774">(</span><span class="ident" id="7091775">dbuf</span><span class="op" id="7091779">,</span>&nbsp;<span class="op" id="7091781">[</span><span class="op" id="7091782">]</span><span class="builtintype" id="7091783">byte</span><span class="op" id="7091787">(</span><span class="ident" id="7091788">e</span><span class="op" id="7091789">.</span><span class="ident" id="7091790">e</span><span class="op" id="7091791">)</span><span class="op" id="7091792">,</span>&nbsp;<span class="builtintype" id="7091794">true</span><span class="op" id="7091798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091802">switch</span>&nbsp;<span class="ident" id="7091809">err</span>&nbsp;<span class="op" id="7091813">:=</span>&nbsp;<span class="ident" id="7091816">err</span><span class="op" id="7091819">.</span><span class="op" id="7091820">(</span><span class="keyword" id="7091821">type</span><span class="op" id="7091825">)</span>&nbsp;<span class="op" id="7091827">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091831">case</span>&nbsp;<span class="ident" id="7091836">CorruptInputError</span><span class="op" id="7091853">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091858">testEqual</span><span class="op" id="7091867">(</span><span class="ident" id="7091868">t</span><span class="op" id="7091869">,</span>&nbsp;<span class="string" id="7091871">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7091911">,</span>&nbsp;<span class="ident" id="7091913">e</span><span class="op" id="7091914">.</span><span class="ident" id="7091915">e</span><span class="op" id="7091916">,</span>&nbsp;<span class="builtintype" id="7091918">int</span><span class="op" id="7091921">(</span><span class="ident" id="7091922">err</span><span class="op" id="7091925">)</span><span class="op" id="7091926">,</span>&nbsp;<span class="ident" id="7091928">e</span><span class="op" id="7091929">.</span><span class="ident" id="7091930">p</span><span class="op" id="7091931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7091935">default</span><span class="op" id="7091942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7091947">t</span><span class="op" id="7091948">.</span><span class="ident" id="7091949">Error</span><span class="op" id="7091954">(</span><span class="string" id="7091955">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7091995">,</span>&nbsp;<span class="ident" id="7091997">e</span><span class="op" id="7091998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092002">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092005">}</span><br>
<span class="lineno"></span><span class="op" id="7092007">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7092010">func</span>&nbsp;<span class="ident" id="7092015">TestBig</span><span class="op" id="7092022">(</span><span class="ident" id="7092023">t</span>&nbsp;<span class="op" id="7092025">*</span><span class="ident" id="7092026">testing</span><span class="op" id="7092033">.</span><span class="ident" id="7092034">T</span><span class="op" id="7092035">)</span>&nbsp;<span class="op" id="7092037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092040">n</span>&nbsp;<span class="op" id="7092042">:=</span>&nbsp;<span class="num" id="7092045">3</span><span class="op" id="7092046">*</span><span class="num" id="7092047">1000</span>&nbsp;<span class="op" id="7092052">+</span>&nbsp;<span class="num" id="7092054">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092057">raw</span>&nbsp;<span class="op" id="7092061">:=</span>&nbsp;<span class="builtinfunc" id="7092064">make</span><span class="op" id="7092068">(</span><span class="op" id="7092069">[</span><span class="op" id="7092070">]</span><span class="builtintype" id="7092071">byte</span><span class="op" id="7092075">,</span>&nbsp;<span class="ident" id="7092077">n</span><span class="op" id="7092078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092081">const</span>&nbsp;<span class="ident" id="7092087">alpha</span>&nbsp;<span class="op" id="7092093">=</span>&nbsp;<span class="string" id="7092095">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092161">for</span>&nbsp;<span class="ident" id="7092165">i</span>&nbsp;<span class="op" id="7092167">:=</span>&nbsp;<span class="num" id="7092170">0</span><span class="op" id="7092171">;</span>&nbsp;<span class="ident" id="7092173">i</span>&nbsp;<span class="op" id="7092175">&lt;</span>&nbsp;<span class="ident" id="7092177">n</span><span class="op" id="7092178">;</span>&nbsp;<span class="ident" id="7092180">i</span><span class="op" id="7092181">++</span>&nbsp;<span class="op" id="7092184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092188">raw</span><span class="op" id="7092191">[</span><span class="ident" id="7092192">i</span><span class="op" id="7092193">]</span>&nbsp;<span class="op" id="7092195">=</span>&nbsp;<span class="ident" id="7092197">alpha</span><span class="op" id="7092202">[</span><span class="ident" id="7092203">i</span><span class="op" id="7092204">%</span><span class="builtinfunc" id="7092205">len</span><span class="op" id="7092208">(</span><span class="ident" id="7092209">alpha</span><span class="op" id="7092214">)</span><span class="op" id="7092215">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092218">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092221">encoded</span>&nbsp;<span class="op" id="7092229">:=</span>&nbsp;<span class="builtinfunc" id="7092232">new</span><span class="op" id="7092235">(</span><span class="ident" id="7092236">bytes</span><span class="op" id="7092241">.</span><span class="ident" id="7092242">Buffer</span><span class="op" id="7092248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092251">w</span>&nbsp;<span class="op" id="7092253">:=</span>&nbsp;<span class="ident" id="7092256">NewEncoder</span><span class="op" id="7092266">(</span><span class="ident" id="7092267">encoded</span><span class="op" id="7092274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092277">nn</span><span class="op" id="7092279">,</span>&nbsp;<span class="ident" id="7092281">err</span>&nbsp;<span class="op" id="7092285">:=</span>&nbsp;<span class="ident" id="7092288">w</span><span class="op" id="7092289">.</span><span class="ident" id="7092290">Write</span><span class="op" id="7092295">(</span><span class="ident" id="7092296">raw</span><span class="op" id="7092299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092302">if</span>&nbsp;<span class="ident" id="7092305">nn</span>&nbsp;<span class="op" id="7092308">!=</span>&nbsp;<span class="ident" id="7092311">n</span>&nbsp;<span class="op" id="7092313">||</span>&nbsp;<span class="ident" id="7092316">err</span>&nbsp;<span class="op" id="7092320">!=</span>&nbsp;<span class="ident" id="7092323">nil</span>&nbsp;<span class="op" id="7092327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092331">t</span><span class="op" id="7092332">.</span><span class="ident" id="7092333">Fatalf</span><span class="op" id="7092339">(</span><span class="string" id="7092340">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7092382">,</span>&nbsp;<span class="ident" id="7092384">nn</span><span class="op" id="7092386">,</span>&nbsp;<span class="ident" id="7092388">err</span><span class="op" id="7092391">,</span>&nbsp;<span class="ident" id="7092393">n</span><span class="op" id="7092394">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092400">err</span>&nbsp;<span class="op" id="7092404">=</span>&nbsp;<span class="ident" id="7092406">w</span><span class="op" id="7092407">.</span><span class="ident" id="7092408">Close</span><span class="op" id="7092413">(</span><span class="op" id="7092414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092417">if</span>&nbsp;<span class="ident" id="7092420">err</span>&nbsp;<span class="op" id="7092424">!=</span>&nbsp;<span class="ident" id="7092427">nil</span>&nbsp;<span class="op" id="7092431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092435">t</span><span class="op" id="7092436">.</span><span class="ident" id="7092437">Fatalf</span><span class="op" id="7092443">(</span><span class="string" id="7092444">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7092475">,</span>&nbsp;<span class="ident" id="7092477">err</span><span class="op" id="7092480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092483">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092486">decoded</span><span class="op" id="7092493">,</span>&nbsp;<span class="ident" id="7092495">err</span>&nbsp;<span class="op" id="7092499">:=</span>&nbsp;<span class="ident" id="7092502">ioutil</span><span class="op" id="7092508">.</span><span class="ident" id="7092509">ReadAll</span><span class="op" id="7092516">(</span><span class="ident" id="7092517">NewDecoder</span><span class="op" id="7092527">(</span><span class="ident" id="7092528">encoded</span><span class="op" id="7092535">)</span><span class="op" id="7092536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092539">if</span>&nbsp;<span class="ident" id="7092542">err</span>&nbsp;<span class="op" id="7092546">!=</span>&nbsp;<span class="ident" id="7092549">nil</span>&nbsp;<span class="op" id="7092553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092557">t</span><span class="op" id="7092558">.</span><span class="ident" id="7092559">Fatalf</span><span class="op" id="7092565">(</span><span class="string" id="7092566">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7092599">,</span>&nbsp;<span class="ident" id="7092601">err</span><span class="op" id="7092604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092611">if</span>&nbsp;<span class="op" id="7092614">!</span><span class="ident" id="7092615">bytes</span><span class="op" id="7092620">.</span><span class="ident" id="7092621">Equal</span><span class="op" id="7092626">(</span><span class="ident" id="7092627">raw</span><span class="op" id="7092630">,</span>&nbsp;<span class="ident" id="7092632">decoded</span><span class="op" id="7092639">)</span>&nbsp;<span class="op" id="7092641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092645">var</span>&nbsp;<span class="ident" id="7092649">i</span>&nbsp;<span class="builtintype" id="7092651">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092657">for</span>&nbsp;<span class="ident" id="7092661">i</span>&nbsp;<span class="op" id="7092663">=</span>&nbsp;<span class="num" id="7092665">0</span><span class="op" id="7092666">;</span>&nbsp;<span class="ident" id="7092668">i</span>&nbsp;<span class="op" id="7092670">&lt;</span>&nbsp;<span class="builtinfunc" id="7092672">len</span><span class="op" id="7092675">(</span><span class="ident" id="7092676">decoded</span><span class="op" id="7092683">)</span>&nbsp;<span class="op" id="7092685">&amp;&amp;</span>&nbsp;<span class="ident" id="7092688">i</span>&nbsp;<span class="op" id="7092690">&lt;</span>&nbsp;<span class="builtinfunc" id="7092692">len</span><span class="op" id="7092695">(</span><span class="ident" id="7092696">raw</span><span class="op" id="7092699">)</span><span class="op" id="7092700">;</span>&nbsp;<span class="ident" id="7092702">i</span><span class="op" id="7092703">++</span>&nbsp;<span class="op" id="7092706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092711">if</span>&nbsp;<span class="ident" id="7092714">decoded</span><span class="op" id="7092721">[</span><span class="ident" id="7092722">i</span><span class="op" id="7092723">]</span>&nbsp;<span class="op" id="7092725">!=</span>&nbsp;<span class="ident" id="7092728">raw</span><span class="op" id="7092731">[</span><span class="ident" id="7092732">i</span><span class="op" id="7092733">]</span>&nbsp;<span class="op" id="7092735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092741">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092758">t</span><span class="op" id="7092759">.</span><span class="ident" id="7092760">Errorf</span><span class="op" id="7092766">(</span><span class="string" id="7092767">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7092819">,</span>&nbsp;<span class="ident" id="7092821">n</span><span class="op" id="7092822">,</span>&nbsp;<span class="ident" id="7092824">i</span><span class="op" id="7092825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7092828">}</span><br>
<span class="lineno"></span><span class="op" id="7092830">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7092833">func</span>&nbsp;<span class="ident" id="7092838">TestDecoderInternalWhitespace</span><span class="op" id="7092867">(</span><span class="ident" id="7092868">t</span>&nbsp;<span class="op" id="7092870">*</span><span class="ident" id="7092871">testing</span><span class="op" id="7092878">.</span><span class="ident" id="7092879">T</span><span class="op" id="7092880">)</span>&nbsp;<span class="op" id="7092882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092885">s</span>&nbsp;<span class="op" id="7092887">:=</span>&nbsp;<span class="ident" id="7092890">strings</span><span class="op" id="7092897">.</span><span class="ident" id="7092898">Repeat</span><span class="op" id="7092904">(</span><span class="string" id="7092905">&#34;&nbsp;&#34;</span><span class="op" id="7092908">,</span>&nbsp;<span class="num" id="7092910">2048</span><span class="op" id="7092914">)</span>&nbsp;<span class="op" id="7092916">+</span>&nbsp;<span class="string" id="7092918">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092923">decoded</span><span class="op" id="7092930">,</span>&nbsp;<span class="ident" id="7092932">err</span>&nbsp;<span class="op" id="7092936">:=</span>&nbsp;<span class="ident" id="7092939">ioutil</span><span class="op" id="7092945">.</span><span class="ident" id="7092946">ReadAll</span><span class="op" id="7092953">(</span><span class="ident" id="7092954">NewDecoder</span><span class="op" id="7092964">(</span><span class="ident" id="7092965">strings</span><span class="op" id="7092972">.</span><span class="ident" id="7092973">NewReader</span><span class="op" id="7092982">(</span><span class="ident" id="7092983">s</span><span class="op" id="7092984">)</span><span class="op" id="7092985">)</span><span class="op" id="7092986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092989">if</span>&nbsp;<span class="ident" id="7092992">err</span>&nbsp;<span class="op" id="7092996">!=</span>&nbsp;<span class="ident" id="7092999">nil</span>&nbsp;<span class="op" id="7093003">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093007">t</span><span class="op" id="7093008">.</span><span class="ident" id="7093009">Errorf</span><span class="op" id="7093015">(</span><span class="string" id="7093016">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7093038">,</span>&nbsp;<span class="ident" id="7093040">err</span><span class="op" id="7093043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093049">if</span>&nbsp;<span class="ident" id="7093052">want</span>&nbsp;<span class="op" id="7093057">:=</span>&nbsp;<span class="op" id="7093060">[</span><span class="op" id="7093061">]</span><span class="builtintype" id="7093062">byte</span><span class="op" id="7093066">(</span><span class="string" id="7093067">&#34;\000\000\000\000&#34;</span><span class="op" id="7093085">)</span><span class="op" id="7093086">;</span>&nbsp;<span class="op" id="7093088">!</span><span class="ident" id="7093089">bytes</span><span class="op" id="7093094">.</span><span class="ident" id="7093095">Equal</span><span class="op" id="7093100">(</span><span class="ident" id="7093101">want</span><span class="op" id="7093105">,</span>&nbsp;<span class="ident" id="7093107">decoded</span><span class="op" id="7093114">)</span>&nbsp;<span class="op" id="7093116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093120">t</span><span class="op" id="7093121">.</span><span class="ident" id="7093122">Errorf</span><span class="op" id="7093128">(</span><span class="string" id="7093129">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7093161">,</span>&nbsp;<span class="ident" id="7093163">decoded</span><span class="op" id="7093170">,</span>&nbsp;<span class="ident" id="7093172">want</span><span class="op" id="7093176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093179">}</span><br>
<span class="lineno">210</span><span class="op" id="7093181">}</span>
</div>
</body>
</html>
