<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6307075">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6307130">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6307184">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6307235">package</span>&nbsp;<span class="ident" id="6307243">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6307249">import</span>&nbsp;<span class="op" id="6307256">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6307259">&#34;image&#34;</span><br>
<span class="lineno"></span><span class="op" id="6307267">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="6307270">//&nbsp;makeImg&nbsp;allocates&nbsp;and&nbsp;initializes&nbsp;the&nbsp;destination&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6307330">func</span>&nbsp;<span class="op" id="6307335">(</span><span class="ident" id="6307336">d</span>&nbsp;<span class="op" id="6307338">*</span><span class="ident" id="6307339">decoder</span><span class="op" id="6307346">)</span>&nbsp;<span class="ident" id="6307348">makeImg</span><span class="op" id="6307355">(</span><span class="ident" id="6307356">h0</span><span class="op" id="6307358">,</span>&nbsp;<span class="ident" id="6307360">v0</span><span class="op" id="6307362">,</span>&nbsp;<span class="ident" id="6307364">mxx</span><span class="op" id="6307367">,</span>&nbsp;<span class="ident" id="6307369">myy</span>&nbsp;<span class="builtintype" id="6307373">int</span><span class="op" id="6307376">)</span>&nbsp;<span class="op" id="6307378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307381">if</span>&nbsp;<span class="ident" id="6307384">d</span><span class="op" id="6307385">.</span><span class="ident" id="6307386">nComp</span>&nbsp;<span class="op" id="6307392">==</span>&nbsp;<span class="ident" id="6307395">nGrayComponent</span>&nbsp;<span class="op" id="6307410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307414">m</span>&nbsp;<span class="op" id="6307416">:=</span>&nbsp;<span class="ident" id="6307419">image</span><span class="op" id="6307424">.</span><span class="ident" id="6307425">NewGray</span><span class="op" id="6307432">(</span><span class="ident" id="6307433">image</span><span class="op" id="6307438">.</span><span class="ident" id="6307439">Rect</span><span class="op" id="6307443">(</span><span class="num" id="6307444">0</span><span class="op" id="6307445">,</span>&nbsp;<span class="num" id="6307447">0</span><span class="op" id="6307448">,</span>&nbsp;<span class="num" id="6307450">8</span><span class="op" id="6307451">*</span><span class="ident" id="6307452">mxx</span><span class="op" id="6307455">,</span>&nbsp;<span class="num" id="6307457">8</span><span class="op" id="6307458">*</span><span class="ident" id="6307459">myy</span><span class="op" id="6307462">)</span><span class="op" id="6307463">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307467">d</span><span class="op" id="6307468">.</span><span class="ident" id="6307469">img1</span>&nbsp;<span class="op" id="6307474">=</span>&nbsp;<span class="ident" id="6307476">m</span><span class="op" id="6307477">.</span><span class="ident" id="6307478">SubImage</span><span class="op" id="6307486">(</span><span class="ident" id="6307487">image</span><span class="op" id="6307492">.</span><span class="ident" id="6307493">Rect</span><span class="op" id="6307497">(</span><span class="num" id="6307498">0</span><span class="op" id="6307499">,</span>&nbsp;<span class="num" id="6307501">0</span><span class="op" id="6307502">,</span>&nbsp;<span class="ident" id="6307504">d</span><span class="op" id="6307505">.</span><span class="ident" id="6307506">width</span><span class="op" id="6307511">,</span>&nbsp;<span class="ident" id="6307513">d</span><span class="op" id="6307514">.</span><span class="ident" id="6307515">height</span><span class="op" id="6307521">)</span><span class="op" id="6307522">)</span><span class="op" id="6307523">.</span><span class="op" id="6307524">(</span><span class="op" id="6307525">*</span><span class="ident" id="6307526">image</span><span class="op" id="6307531">.</span><span class="ident" id="6307532">Gray</span><span class="op" id="6307536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307540">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307551">var</span>&nbsp;<span class="ident" id="6307555">subsampleRatio</span>&nbsp;<span class="ident" id="6307570">image</span><span class="op" id="6307575">.</span><span class="ident" id="6307576">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307597">switch</span>&nbsp;<span class="op" id="6307604">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307607">case</span>&nbsp;<span class="ident" id="6307612">h0</span>&nbsp;<span class="op" id="6307615">==</span>&nbsp;<span class="num" id="6307618">1</span>&nbsp;<span class="op" id="6307620">&amp;&amp;</span>&nbsp;<span class="ident" id="6307623">v0</span>&nbsp;<span class="op" id="6307626">==</span>&nbsp;<span class="num" id="6307629">1</span><span class="op" id="6307630">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307634">subsampleRatio</span>&nbsp;<span class="op" id="6307649">=</span>&nbsp;<span class="ident" id="6307651">image</span><span class="op" id="6307656">.</span><span class="ident" id="6307657">YCbCrSubsampleRatio444</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307681">case</span>&nbsp;<span class="ident" id="6307686">h0</span>&nbsp;<span class="op" id="6307689">==</span>&nbsp;<span class="num" id="6307692">1</span>&nbsp;<span class="op" id="6307694">&amp;&amp;</span>&nbsp;<span class="ident" id="6307697">v0</span>&nbsp;<span class="op" id="6307700">==</span>&nbsp;<span class="num" id="6307703">2</span><span class="op" id="6307704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307708">subsampleRatio</span>&nbsp;<span class="op" id="6307723">=</span>&nbsp;<span class="ident" id="6307725">image</span><span class="op" id="6307730">.</span><span class="ident" id="6307731">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307755">case</span>&nbsp;<span class="ident" id="6307760">h0</span>&nbsp;<span class="op" id="6307763">==</span>&nbsp;<span class="num" id="6307766">2</span>&nbsp;<span class="op" id="6307768">&amp;&amp;</span>&nbsp;<span class="ident" id="6307771">v0</span>&nbsp;<span class="op" id="6307774">==</span>&nbsp;<span class="num" id="6307777">1</span><span class="op" id="6307778">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307782">subsampleRatio</span>&nbsp;<span class="op" id="6307797">=</span>&nbsp;<span class="ident" id="6307799">image</span><span class="op" id="6307804">.</span><span class="ident" id="6307805">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307829">case</span>&nbsp;<span class="ident" id="6307834">h0</span>&nbsp;<span class="op" id="6307837">==</span>&nbsp;<span class="num" id="6307840">2</span>&nbsp;<span class="op" id="6307842">&amp;&amp;</span>&nbsp;<span class="ident" id="6307845">v0</span>&nbsp;<span class="op" id="6307848">==</span>&nbsp;<span class="num" id="6307851">2</span><span class="op" id="6307852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307856">subsampleRatio</span>&nbsp;<span class="op" id="6307871">=</span>&nbsp;<span class="ident" id="6307873">image</span><span class="op" id="6307878">.</span><span class="ident" id="6307879">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307903">default</span><span class="op" id="6307910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6307914">panic</span><span class="op" id="6307919">(</span><span class="string" id="6307920">&#34;unreachable&#34;</span><span class="op" id="6307933">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307939">m</span>&nbsp;<span class="op" id="6307941">:=</span>&nbsp;<span class="ident" id="6307944">image</span><span class="op" id="6307949">.</span><span class="ident" id="6307950">NewYCbCr</span><span class="op" id="6307958">(</span><span class="ident" id="6307959">image</span><span class="op" id="6307964">.</span><span class="ident" id="6307965">Rect</span><span class="op" id="6307969">(</span><span class="num" id="6307970">0</span><span class="op" id="6307971">,</span>&nbsp;<span class="num" id="6307973">0</span><span class="op" id="6307974">,</span>&nbsp;<span class="num" id="6307976">8</span><span class="op" id="6307977">*</span><span class="ident" id="6307978">h0</span><span class="op" id="6307980">*</span><span class="ident" id="6307981">mxx</span><span class="op" id="6307984">,</span>&nbsp;<span class="num" id="6307986">8</span><span class="op" id="6307987">*</span><span class="ident" id="6307988">v0</span><span class="op" id="6307990">*</span><span class="ident" id="6307991">myy</span><span class="op" id="6307994">)</span><span class="op" id="6307995">,</span>&nbsp;<span class="ident" id="6307997">subsampleRatio</span><span class="op" id="6308011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308014">d</span><span class="op" id="6308015">.</span><span class="ident" id="6308016">img3</span>&nbsp;<span class="op" id="6308021">=</span>&nbsp;<span class="ident" id="6308023">m</span><span class="op" id="6308024">.</span><span class="ident" id="6308025">SubImage</span><span class="op" id="6308033">(</span><span class="ident" id="6308034">image</span><span class="op" id="6308039">.</span><span class="ident" id="6308040">Rect</span><span class="op" id="6308044">(</span><span class="num" id="6308045">0</span><span class="op" id="6308046">,</span>&nbsp;<span class="num" id="6308048">0</span><span class="op" id="6308049">,</span>&nbsp;<span class="ident" id="6308051">d</span><span class="op" id="6308052">.</span><span class="ident" id="6308053">width</span><span class="op" id="6308058">,</span>&nbsp;<span class="ident" id="6308060">d</span><span class="op" id="6308061">.</span><span class="ident" id="6308062">height</span><span class="op" id="6308068">)</span><span class="op" id="6308069">)</span><span class="op" id="6308070">.</span><span class="op" id="6308071">(</span><span class="op" id="6308072">*</span><span class="ident" id="6308073">image</span><span class="op" id="6308078">.</span><span class="ident" id="6308079">YCbCr</span><span class="op" id="6308084">)</span><br>
<span class="lineno"></span><span class="op" id="6308086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="6308089">//&nbsp;Specified&nbsp;in&nbsp;section&nbsp;B.2.3.</span><br>
<span class="lineno"></span><span class="keyword" id="6308120">func</span>&nbsp;<span class="op" id="6308125">(</span><span class="ident" id="6308126">d</span>&nbsp;<span class="op" id="6308128">*</span><span class="ident" id="6308129">decoder</span><span class="op" id="6308136">)</span>&nbsp;<span class="ident" id="6308138">processSOS</span><span class="op" id="6308148">(</span><span class="ident" id="6308149">n</span>&nbsp;<span class="builtintype" id="6308151">int</span><span class="op" id="6308154">)</span>&nbsp;<span class="builtintype" id="6308156">error</span>&nbsp;<span class="op" id="6308162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308165">if</span>&nbsp;<span class="ident" id="6308168">d</span><span class="op" id="6308169">.</span><span class="ident" id="6308170">nComp</span>&nbsp;<span class="op" id="6308176">==</span>&nbsp;<span class="num" id="6308179">0</span>&nbsp;<span class="op" id="6308181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308185">return</span>&nbsp;<span class="ident" id="6308192">FormatError</span><span class="op" id="6308203">(</span><span class="string" id="6308204">&#34;missing&nbsp;SOF&nbsp;marker&#34;</span><span class="op" id="6308224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308227">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308230">if</span>&nbsp;<span class="ident" id="6308233">n</span>&nbsp;<span class="op" id="6308235">&lt;</span>&nbsp;<span class="num" id="6308237">6</span>&nbsp;<span class="op" id="6308239">||</span>&nbsp;<span class="num" id="6308242">4</span><span class="op" id="6308243">+</span><span class="num" id="6308244">2</span><span class="op" id="6308245">*</span><span class="ident" id="6308246">d</span><span class="op" id="6308247">.</span><span class="ident" id="6308248">nComp</span>&nbsp;<span class="op" id="6308254">&lt;</span>&nbsp;<span class="ident" id="6308256">n</span>&nbsp;<span class="op" id="6308258">||</span>&nbsp;<span class="ident" id="6308261">n</span><span class="op" id="6308262">%</span><span class="num" id="6308263">2</span>&nbsp;<span class="op" id="6308265">!=</span>&nbsp;<span class="num" id="6308268">0</span>&nbsp;<span class="op" id="6308270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308274">return</span>&nbsp;<span class="ident" id="6308281">FormatError</span><span class="op" id="6308292">(</span><span class="string" id="6308293">&#34;SOS&nbsp;has&nbsp;wrong&nbsp;length&#34;</span><span class="op" id="6308315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308321">if</span>&nbsp;<span class="ident" id="6308324">err</span>&nbsp;<span class="op" id="6308328">:=</span>&nbsp;<span class="ident" id="6308331">d</span><span class="op" id="6308332">.</span><span class="ident" id="6308333">readFull</span><span class="op" id="6308341">(</span><span class="ident" id="6308342">d</span><span class="op" id="6308343">.</span><span class="ident" id="6308344">tmp</span><span class="op" id="6308347">[</span><span class="op" id="6308348">:</span><span class="ident" id="6308349">n</span><span class="op" id="6308350">]</span><span class="op" id="6308351">)</span><span class="op" id="6308352">;</span>&nbsp;<span class="ident" id="6308354">err</span>&nbsp;<span class="op" id="6308358">!=</span>&nbsp;<span class="ident" id="6308361">nil</span>&nbsp;<span class="op" id="6308365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308369">return</span>&nbsp;<span class="ident" id="6308376">err</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308384">nComp</span>&nbsp;<span class="op" id="6308390">:=</span>&nbsp;<span class="builtintype" id="6308393">int</span><span class="op" id="6308396">(</span><span class="ident" id="6308397">d</span><span class="op" id="6308398">.</span><span class="ident" id="6308399">tmp</span><span class="op" id="6308402">[</span><span class="num" id="6308403">0</span><span class="op" id="6308404">]</span><span class="op" id="6308405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308408">if</span>&nbsp;<span class="ident" id="6308411">n</span>&nbsp;<span class="op" id="6308413">!=</span>&nbsp;<span class="num" id="6308416">4</span><span class="op" id="6308417">+</span><span class="num" id="6308418">2</span><span class="op" id="6308419">*</span><span class="ident" id="6308420">nComp</span>&nbsp;<span class="op" id="6308426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308430">return</span>&nbsp;<span class="ident" id="6308437">FormatError</span><span class="op" id="6308448">(</span><span class="string" id="6308449">&#34;SOS&nbsp;length&nbsp;inconsistent&nbsp;with&nbsp;number&nbsp;of&nbsp;components&#34;</span><span class="op" id="6308500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308503">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308506">var</span>&nbsp;<span class="ident" id="6308510">scan</span>&nbsp;<span class="op" id="6308515">[</span><span class="ident" id="6308516">nColorComponent</span><span class="op" id="6308531">]</span><span class="keyword" id="6308532">struct</span>&nbsp;<span class="op" id="6308539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308543">compIndex</span>&nbsp;<span class="builtintype" id="6308553">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308561">td</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6308571">uint8</span>&nbsp;<span class="comment" id="6308577">//&nbsp;DC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308601">ta</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6308611">uint8</span>&nbsp;<span class="comment" id="6308617">//&nbsp;AC&nbsp;table&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308640">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308643">for</span>&nbsp;<span class="ident" id="6308647">i</span>&nbsp;<span class="op" id="6308649">:=</span>&nbsp;<span class="num" id="6308652">0</span><span class="op" id="6308653">;</span>&nbsp;<span class="ident" id="6308655">i</span>&nbsp;<span class="op" id="6308657">&lt;</span>&nbsp;<span class="ident" id="6308659">nComp</span><span class="op" id="6308664">;</span>&nbsp;<span class="ident" id="6308666">i</span><span class="op" id="6308667">++</span>&nbsp;<span class="op" id="6308670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308674">cs</span>&nbsp;<span class="op" id="6308677">:=</span>&nbsp;<span class="ident" id="6308680">d</span><span class="op" id="6308681">.</span><span class="ident" id="6308682">tmp</span><span class="op" id="6308685">[</span><span class="num" id="6308686">1</span><span class="op" id="6308687">+</span><span class="num" id="6308688">2</span><span class="op" id="6308689">*</span><span class="ident" id="6308690">i</span><span class="op" id="6308691">]</span>&nbsp;<span class="comment" id="6308693">//&nbsp;Component&nbsp;selector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308718">compIndex</span>&nbsp;<span class="op" id="6308728">:=</span>&nbsp;<span class="op" id="6308731">-</span><span class="num" id="6308732">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308736">for</span>&nbsp;<span class="ident" id="6308740">j</span><span class="op" id="6308741">,</span>&nbsp;<span class="ident" id="6308743">comp</span>&nbsp;<span class="op" id="6308748">:=</span>&nbsp;<span class="keyword" id="6308751">range</span>&nbsp;<span class="ident" id="6308757">d</span><span class="op" id="6308758">.</span><span class="ident" id="6308759">comp</span>&nbsp;<span class="op" id="6308764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308769">if</span>&nbsp;<span class="ident" id="6308772">cs</span>&nbsp;<span class="op" id="6308775">==</span>&nbsp;<span class="ident" id="6308778">comp</span><span class="op" id="6308782">.</span><span class="ident" id="6308783">c</span>&nbsp;<span class="op" id="6308785">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308791">compIndex</span>&nbsp;<span class="op" id="6308801">=</span>&nbsp;<span class="ident" id="6308803">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308816">if</span>&nbsp;<span class="ident" id="6308819">compIndex</span>&nbsp;<span class="op" id="6308829">&lt;</span>&nbsp;<span class="num" id="6308831">0</span>&nbsp;<span class="op" id="6308833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308838">return</span>&nbsp;<span class="ident" id="6308845">FormatError</span><span class="op" id="6308856">(</span><span class="string" id="6308857">&#34;unknown&nbsp;component&nbsp;selector&#34;</span><span class="op" id="6308885">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308893">scan</span><span class="op" id="6308897">[</span><span class="ident" id="6308898">i</span><span class="op" id="6308899">]</span><span class="op" id="6308900">.</span><span class="ident" id="6308901">compIndex</span>&nbsp;<span class="op" id="6308911">=</span>&nbsp;<span class="builtintype" id="6308913">uint8</span><span class="op" id="6308918">(</span><span class="ident" id="6308919">compIndex</span><span class="op" id="6308928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308932">scan</span><span class="op" id="6308936">[</span><span class="ident" id="6308937">i</span><span class="op" id="6308938">]</span><span class="op" id="6308939">.</span><span class="ident" id="6308940">td</span>&nbsp;<span class="op" id="6308943">=</span>&nbsp;<span class="ident" id="6308945">d</span><span class="op" id="6308946">.</span><span class="ident" id="6308947">tmp</span><span class="op" id="6308950">[</span><span class="num" id="6308951">2</span><span class="op" id="6308952">+</span><span class="num" id="6308953">2</span><span class="op" id="6308954">*</span><span class="ident" id="6308955">i</span><span class="op" id="6308956">]</span>&nbsp;<span class="op" id="6308958">&gt;&gt;</span>&nbsp;<span class="num" id="6308961">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308965">if</span>&nbsp;<span class="ident" id="6308968">scan</span><span class="op" id="6308972">[</span><span class="ident" id="6308973">i</span><span class="op" id="6308974">]</span><span class="op" id="6308975">.</span><span class="ident" id="6308976">td</span>&nbsp;<span class="op" id="6308979">&gt;</span>&nbsp;<span class="ident" id="6308981">maxTh</span>&nbsp;<span class="op" id="6308987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308992">return</span>&nbsp;<span class="ident" id="6308999">FormatError</span><span class="op" id="6309010">(</span><span class="string" id="6309011">&#34;bad&nbsp;Td&nbsp;value&#34;</span><span class="op" id="6309025">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309033">scan</span><span class="op" id="6309037">[</span><span class="ident" id="6309038">i</span><span class="op" id="6309039">]</span><span class="op" id="6309040">.</span><span class="ident" id="6309041">ta</span>&nbsp;<span class="op" id="6309044">=</span>&nbsp;<span class="ident" id="6309046">d</span><span class="op" id="6309047">.</span><span class="ident" id="6309048">tmp</span><span class="op" id="6309051">[</span><span class="num" id="6309052">2</span><span class="op" id="6309053">+</span><span class="num" id="6309054">2</span><span class="op" id="6309055">*</span><span class="ident" id="6309056">i</span><span class="op" id="6309057">]</span>&nbsp;<span class="op" id="6309059">&amp;</span>&nbsp;<span class="num" id="6309061">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309068">if</span>&nbsp;<span class="ident" id="6309071">scan</span><span class="op" id="6309075">[</span><span class="ident" id="6309076">i</span><span class="op" id="6309077">]</span><span class="op" id="6309078">.</span><span class="ident" id="6309079">ta</span>&nbsp;<span class="op" id="6309082">&gt;</span>&nbsp;<span class="ident" id="6309084">maxTh</span>&nbsp;<span class="op" id="6309090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309095">return</span>&nbsp;<span class="ident" id="6309102">FormatError</span><span class="op" id="6309113">(</span><span class="string" id="6309114">&#34;bad&nbsp;Ta&nbsp;value&#34;</span><span class="op" id="6309128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309132">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309139">//&nbsp;zigStart&nbsp;and&nbsp;zigEnd&nbsp;are&nbsp;the&nbsp;spectral&nbsp;selection&nbsp;bounds.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309198">//&nbsp;ah&nbsp;and&nbsp;al&nbsp;are&nbsp;the&nbsp;successive&nbsp;approximation&nbsp;high&nbsp;and&nbsp;low&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309266">//&nbsp;The&nbsp;spec&nbsp;calls&nbsp;these&nbsp;values&nbsp;Ss,&nbsp;Se,&nbsp;Ah&nbsp;and&nbsp;Al.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309317">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309321">//&nbsp;For&nbsp;progressive&nbsp;JPEGs,&nbsp;these&nbsp;are&nbsp;the&nbsp;two&nbsp;more-or-less&nbsp;independent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309391">//&nbsp;aspects&nbsp;of&nbsp;progression.&nbsp;Spectral&nbsp;selection&nbsp;progression&nbsp;is&nbsp;when&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309462">//&nbsp;all&nbsp;of&nbsp;a&nbsp;block&#39;s&nbsp;64&nbsp;DCT&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309532">//&nbsp;For&nbsp;example,&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;coefficient&nbsp;0&nbsp;(the&nbsp;DC</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309599">//&nbsp;component),&nbsp;coefficients&nbsp;1-5,&nbsp;and&nbsp;coefficients&nbsp;6-63,&nbsp;in&nbsp;zig-zag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309667">//&nbsp;order.&nbsp;Successive&nbsp;approximation&nbsp;is&nbsp;when&nbsp;not&nbsp;all&nbsp;of&nbsp;the&nbsp;bits&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309736">//&nbsp;band&nbsp;of&nbsp;coefficients&nbsp;are&nbsp;transmitted&nbsp;in&nbsp;one&nbsp;pass.&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309803">//&nbsp;three&nbsp;passes&nbsp;could&nbsp;transmit&nbsp;the&nbsp;6&nbsp;most&nbsp;significant&nbsp;bits,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309873">//&nbsp;by&nbsp;the&nbsp;second-least&nbsp;significant&nbsp;bit,&nbsp;followed&nbsp;by&nbsp;the&nbsp;least</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309936">//&nbsp;significant&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309957">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6309961">//&nbsp;For&nbsp;baseline&nbsp;JPEGs,&nbsp;these&nbsp;parameters&nbsp;are&nbsp;hard-coded&nbsp;to&nbsp;0/63/0/0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310030">zigStart</span><span class="op" id="6310038">,</span>&nbsp;<span class="ident" id="6310040">zigEnd</span><span class="op" id="6310046">,</span>&nbsp;<span class="ident" id="6310048">ah</span><span class="op" id="6310050">,</span>&nbsp;<span class="ident" id="6310052">al</span>&nbsp;<span class="op" id="6310055">:=</span>&nbsp;<span class="builtintype" id="6310058">int32</span><span class="op" id="6310063">(</span><span class="num" id="6310064">0</span><span class="op" id="6310065">)</span><span class="op" id="6310066">,</span>&nbsp;<span class="builtintype" id="6310068">int32</span><span class="op" id="6310073">(</span><span class="ident" id="6310074">blockSize</span><span class="op" id="6310083">-</span><span class="num" id="6310084">1</span><span class="op" id="6310085">)</span><span class="op" id="6310086">,</span>&nbsp;<span class="builtintype" id="6310088">uint32</span><span class="op" id="6310094">(</span><span class="num" id="6310095">0</span><span class="op" id="6310096">)</span><span class="op" id="6310097">,</span>&nbsp;<span class="builtintype" id="6310099">uint32</span><span class="op" id="6310105">(</span><span class="num" id="6310106">0</span><span class="op" id="6310107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310110">if</span>&nbsp;<span class="ident" id="6310113">d</span><span class="op" id="6310114">.</span><span class="ident" id="6310115">progressive</span>&nbsp;<span class="op" id="6310127">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310131">zigStart</span>&nbsp;<span class="op" id="6310140">=</span>&nbsp;<span class="builtintype" id="6310142">int32</span><span class="op" id="6310147">(</span><span class="ident" id="6310148">d</span><span class="op" id="6310149">.</span><span class="ident" id="6310150">tmp</span><span class="op" id="6310153">[</span><span class="num" id="6310154">1</span><span class="op" id="6310155">+</span><span class="num" id="6310156">2</span><span class="op" id="6310157">*</span><span class="ident" id="6310158">nComp</span><span class="op" id="6310163">]</span><span class="op" id="6310164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310168">zigEnd</span>&nbsp;<span class="op" id="6310175">=</span>&nbsp;<span class="builtintype" id="6310177">int32</span><span class="op" id="6310182">(</span><span class="ident" id="6310183">d</span><span class="op" id="6310184">.</span><span class="ident" id="6310185">tmp</span><span class="op" id="6310188">[</span><span class="num" id="6310189">2</span><span class="op" id="6310190">+</span><span class="num" id="6310191">2</span><span class="op" id="6310192">*</span><span class="ident" id="6310193">nComp</span><span class="op" id="6310198">]</span><span class="op" id="6310199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310203">ah</span>&nbsp;<span class="op" id="6310206">=</span>&nbsp;<span class="builtintype" id="6310208">uint32</span><span class="op" id="6310214">(</span><span class="ident" id="6310215">d</span><span class="op" id="6310216">.</span><span class="ident" id="6310217">tmp</span><span class="op" id="6310220">[</span><span class="num" id="6310221">3</span><span class="op" id="6310222">+</span><span class="num" id="6310223">2</span><span class="op" id="6310224">*</span><span class="ident" id="6310225">nComp</span><span class="op" id="6310230">]</span>&nbsp;<span class="op" id="6310232">&gt;&gt;</span>&nbsp;<span class="num" id="6310235">4</span><span class="op" id="6310236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310240">al</span>&nbsp;<span class="op" id="6310243">=</span>&nbsp;<span class="builtintype" id="6310245">uint32</span><span class="op" id="6310251">(</span><span class="ident" id="6310252">d</span><span class="op" id="6310253">.</span><span class="ident" id="6310254">tmp</span><span class="op" id="6310257">[</span><span class="num" id="6310258">3</span><span class="op" id="6310259">+</span><span class="num" id="6310260">2</span><span class="op" id="6310261">*</span><span class="ident" id="6310262">nComp</span><span class="op" id="6310267">]</span>&nbsp;<span class="op" id="6310269">&amp;</span>&nbsp;<span class="num" id="6310271">0x0f</span><span class="op" id="6310275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310279">if</span>&nbsp;<span class="op" id="6310282">(</span><span class="ident" id="6310283">zigStart</span>&nbsp;<span class="op" id="6310292">==</span>&nbsp;<span class="num" id="6310295">0</span>&nbsp;<span class="op" id="6310297">&amp;&amp;</span>&nbsp;<span class="ident" id="6310300">zigEnd</span>&nbsp;<span class="op" id="6310307">!=</span>&nbsp;<span class="num" id="6310310">0</span><span class="op" id="6310311">)</span>&nbsp;<span class="op" id="6310313">||</span>&nbsp;<span class="ident" id="6310316">zigStart</span>&nbsp;<span class="op" id="6310325">&gt;</span>&nbsp;<span class="ident" id="6310327">zigEnd</span>&nbsp;<span class="op" id="6310334">||</span>&nbsp;<span class="ident" id="6310337">blockSize</span>&nbsp;<span class="op" id="6310347">&lt;=</span>&nbsp;<span class="ident" id="6310350">zigEnd</span>&nbsp;<span class="op" id="6310357">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310362">return</span>&nbsp;<span class="ident" id="6310369">FormatError</span><span class="op" id="6310380">(</span><span class="string" id="6310381">&#34;bad&nbsp;spectral&nbsp;selection&nbsp;bounds&#34;</span><span class="op" id="6310412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310420">if</span>&nbsp;<span class="ident" id="6310423">zigStart</span>&nbsp;<span class="op" id="6310432">!=</span>&nbsp;<span class="num" id="6310435">0</span>&nbsp;<span class="op" id="6310437">&amp;&amp;</span>&nbsp;<span class="ident" id="6310440">nComp</span>&nbsp;<span class="op" id="6310446">!=</span>&nbsp;<span class="num" id="6310449">1</span>&nbsp;<span class="op" id="6310451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310456">return</span>&nbsp;<span class="ident" id="6310463">FormatError</span><span class="op" id="6310474">(</span><span class="string" id="6310475">&#34;progressive&nbsp;AC&nbsp;coefficients&nbsp;for&nbsp;more&nbsp;than&nbsp;one&nbsp;component&#34;</span><span class="op" id="6310532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310536">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310540">if</span>&nbsp;<span class="ident" id="6310543">ah</span>&nbsp;<span class="op" id="6310546">!=</span>&nbsp;<span class="num" id="6310549">0</span>&nbsp;<span class="op" id="6310551">&amp;&amp;</span>&nbsp;<span class="ident" id="6310554">ah</span>&nbsp;<span class="op" id="6310557">!=</span>&nbsp;<span class="ident" id="6310560">al</span><span class="op" id="6310562">+</span><span class="num" id="6310563">1</span>&nbsp;<span class="op" id="6310565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310570">return</span>&nbsp;<span class="ident" id="6310577">FormatError</span><span class="op" id="6310588">(</span><span class="string" id="6310589">&#34;bad&nbsp;successive&nbsp;approximation&nbsp;values&#34;</span><span class="op" id="6310626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310637">//&nbsp;mxx&nbsp;and&nbsp;myy&nbsp;are&nbsp;the&nbsp;number&nbsp;of&nbsp;MCUs&nbsp;(Minimum&nbsp;Coded&nbsp;Units)&nbsp;in&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310712">h0</span><span class="op" id="6310714">,</span>&nbsp;<span class="ident" id="6310716">v0</span>&nbsp;<span class="op" id="6310719">:=</span>&nbsp;<span class="ident" id="6310722">d</span><span class="op" id="6310723">.</span><span class="ident" id="6310724">comp</span><span class="op" id="6310728">[</span><span class="num" id="6310729">0</span><span class="op" id="6310730">]</span><span class="op" id="6310731">.</span><span class="ident" id="6310732">h</span><span class="op" id="6310733">,</span>&nbsp;<span class="ident" id="6310735">d</span><span class="op" id="6310736">.</span><span class="ident" id="6310737">comp</span><span class="op" id="6310741">[</span><span class="num" id="6310742">0</span><span class="op" id="6310743">]</span><span class="op" id="6310744">.</span><span class="ident" id="6310745">v</span>&nbsp;<span class="comment" id="6310747">//&nbsp;The&nbsp;h&nbsp;and&nbsp;v&nbsp;values&nbsp;from&nbsp;the&nbsp;Y&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310793">mxx</span>&nbsp;<span class="op" id="6310797">:=</span>&nbsp;<span class="op" id="6310800">(</span><span class="ident" id="6310801">d</span><span class="op" id="6310802">.</span><span class="ident" id="6310803">width</span>&nbsp;<span class="op" id="6310809">+</span>&nbsp;<span class="num" id="6310811">8</span><span class="op" id="6310812">*</span><span class="ident" id="6310813">h0</span>&nbsp;<span class="op" id="6310816">-</span>&nbsp;<span class="num" id="6310818">1</span><span class="op" id="6310819">)</span>&nbsp;<span class="op" id="6310821">/</span>&nbsp;<span class="op" id="6310823">(</span><span class="num" id="6310824">8</span>&nbsp;<span class="op" id="6310826">*</span>&nbsp;<span class="ident" id="6310828">h0</span><span class="op" id="6310830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310833">myy</span>&nbsp;<span class="op" id="6310837">:=</span>&nbsp;<span class="op" id="6310840">(</span><span class="ident" id="6310841">d</span><span class="op" id="6310842">.</span><span class="ident" id="6310843">height</span>&nbsp;<span class="op" id="6310850">+</span>&nbsp;<span class="num" id="6310852">8</span><span class="op" id="6310853">*</span><span class="ident" id="6310854">v0</span>&nbsp;<span class="op" id="6310857">-</span>&nbsp;<span class="num" id="6310859">1</span><span class="op" id="6310860">)</span>&nbsp;<span class="op" id="6310862">/</span>&nbsp;<span class="op" id="6310864">(</span><span class="num" id="6310865">8</span>&nbsp;<span class="op" id="6310867">*</span>&nbsp;<span class="ident" id="6310869">v0</span><span class="op" id="6310871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310874">if</span>&nbsp;<span class="ident" id="6310877">d</span><span class="op" id="6310878">.</span><span class="ident" id="6310879">img1</span>&nbsp;<span class="op" id="6310884">==</span>&nbsp;<span class="ident" id="6310887">nil</span>&nbsp;<span class="op" id="6310891">&amp;&amp;</span>&nbsp;<span class="ident" id="6310894">d</span><span class="op" id="6310895">.</span><span class="ident" id="6310896">img3</span>&nbsp;<span class="op" id="6310901">==</span>&nbsp;<span class="ident" id="6310904">nil</span>&nbsp;<span class="op" id="6310908">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310912">d</span><span class="op" id="6310913">.</span><span class="ident" id="6310914">makeImg</span><span class="op" id="6310921">(</span><span class="ident" id="6310922">h0</span><span class="op" id="6310924">,</span>&nbsp;<span class="ident" id="6310926">v0</span><span class="op" id="6310928">,</span>&nbsp;<span class="ident" id="6310930">mxx</span><span class="op" id="6310933">,</span>&nbsp;<span class="ident" id="6310935">myy</span><span class="op" id="6310938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310944">if</span>&nbsp;<span class="ident" id="6310947">d</span><span class="op" id="6310948">.</span><span class="ident" id="6310949">progressive</span>&nbsp;<span class="op" id="6310961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310965">for</span>&nbsp;<span class="ident" id="6310969">i</span>&nbsp;<span class="op" id="6310971">:=</span>&nbsp;<span class="num" id="6310974">0</span><span class="op" id="6310975">;</span>&nbsp;<span class="ident" id="6310977">i</span>&nbsp;<span class="op" id="6310979">&lt;</span>&nbsp;<span class="ident" id="6310981">nComp</span><span class="op" id="6310986">;</span>&nbsp;<span class="ident" id="6310988">i</span><span class="op" id="6310989">++</span>&nbsp;<span class="op" id="6310992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310997">compIndex</span>&nbsp;<span class="op" id="6311007">:=</span>&nbsp;<span class="ident" id="6311010">scan</span><span class="op" id="6311014">[</span><span class="ident" id="6311015">i</span><span class="op" id="6311016">]</span><span class="op" id="6311017">.</span><span class="ident" id="6311018">compIndex</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311031">if</span>&nbsp;<span class="ident" id="6311034">d</span><span class="op" id="6311035">.</span><span class="ident" id="6311036">progCoeffs</span><span class="op" id="6311046">[</span><span class="ident" id="6311047">compIndex</span><span class="op" id="6311056">]</span>&nbsp;<span class="op" id="6311058">==</span>&nbsp;<span class="ident" id="6311061">nil</span>&nbsp;<span class="op" id="6311065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311071">d</span><span class="op" id="6311072">.</span><span class="ident" id="6311073">progCoeffs</span><span class="op" id="6311083">[</span><span class="ident" id="6311084">compIndex</span><span class="op" id="6311093">]</span>&nbsp;<span class="op" id="6311095">=</span>&nbsp;<span class="builtinfunc" id="6311097">make</span><span class="op" id="6311101">(</span><span class="op" id="6311102">[</span><span class="op" id="6311103">]</span><span class="ident" id="6311104">block</span><span class="op" id="6311109">,</span>&nbsp;<span class="ident" id="6311111">mxx</span><span class="op" id="6311114">*</span><span class="ident" id="6311115">myy</span><span class="op" id="6311118">*</span><span class="ident" id="6311119">d</span><span class="op" id="6311120">.</span><span class="ident" id="6311121">comp</span><span class="op" id="6311125">[</span><span class="ident" id="6311126">compIndex</span><span class="op" id="6311135">]</span><span class="op" id="6311136">.</span><span class="ident" id="6311137">h</span><span class="op" id="6311138">*</span><span class="ident" id="6311139">d</span><span class="op" id="6311140">.</span><span class="ident" id="6311141">comp</span><span class="op" id="6311145">[</span><span class="ident" id="6311146">compIndex</span><span class="op" id="6311155">]</span><span class="op" id="6311156">.</span><span class="ident" id="6311157">v</span><span class="op" id="6311158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311170">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311174">d</span><span class="op" id="6311175">.</span><span class="ident" id="6311176">bits</span>&nbsp;<span class="op" id="6311181">=</span>&nbsp;<span class="ident" id="6311183">bits</span><span class="op" id="6311187">{</span><span class="op" id="6311188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311191">mcu</span><span class="op" id="6311194">,</span>&nbsp;<span class="ident" id="6311196">expectedRST</span>&nbsp;<span class="op" id="6311208">:=</span>&nbsp;<span class="num" id="6311211">0</span><span class="op" id="6311212">,</span>&nbsp;<span class="builtintype" id="6311214">uint8</span><span class="op" id="6311219">(</span><span class="ident" id="6311220">rst0Marker</span><span class="op" id="6311230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311233">var</span>&nbsp;<span class="op" id="6311237">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311241">//&nbsp;b&nbsp;is&nbsp;the&nbsp;decoded&nbsp;coefficients,&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311309">b</span>&nbsp;&nbsp;<span class="ident" id="6311312">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311320">dc</span>&nbsp;<span class="op" id="6311323">[</span><span class="ident" id="6311324">nColorComponent</span><span class="op" id="6311339">]</span><span class="builtintype" id="6311340">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311348">//&nbsp;bx&nbsp;and&nbsp;by&nbsp;are&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;current&nbsp;(in&nbsp;terms&nbsp;of&nbsp;8x8&nbsp;blocks).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311421">//&nbsp;For&nbsp;example,&nbsp;with&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling,&nbsp;the&nbsp;block&nbsp;whose&nbsp;top&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311495">//&nbsp;pixel&nbsp;co-ordinates&nbsp;are&nbsp;(16,&nbsp;8)&nbsp;is&nbsp;the&nbsp;third&nbsp;block&nbsp;in&nbsp;the&nbsp;first&nbsp;row:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311568">//&nbsp;bx&nbsp;is&nbsp;2&nbsp;and&nbsp;by&nbsp;is&nbsp;0,&nbsp;even&nbsp;though&nbsp;the&nbsp;pixel&nbsp;is&nbsp;in&nbsp;the&nbsp;second&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311638">bx</span><span class="op" id="6311640">,</span>&nbsp;<span class="ident" id="6311642">by</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6311649">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311655">blockCount</span>&nbsp;<span class="builtintype" id="6311666">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6311671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311674">for</span>&nbsp;<span class="ident" id="6311678">my</span>&nbsp;<span class="op" id="6311681">:=</span>&nbsp;<span class="num" id="6311684">0</span><span class="op" id="6311685">;</span>&nbsp;<span class="ident" id="6311687">my</span>&nbsp;<span class="op" id="6311690">&lt;</span>&nbsp;<span class="ident" id="6311692">myy</span><span class="op" id="6311695">;</span>&nbsp;<span class="ident" id="6311697">my</span><span class="op" id="6311699">++</span>&nbsp;<span class="op" id="6311702">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311706">for</span>&nbsp;<span class="ident" id="6311710">mx</span>&nbsp;<span class="op" id="6311713">:=</span>&nbsp;<span class="num" id="6311716">0</span><span class="op" id="6311717">;</span>&nbsp;<span class="ident" id="6311719">mx</span>&nbsp;<span class="op" id="6311722">&lt;</span>&nbsp;<span class="ident" id="6311724">mxx</span><span class="op" id="6311727">;</span>&nbsp;<span class="ident" id="6311729">mx</span><span class="op" id="6311731">++</span>&nbsp;<span class="op" id="6311734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311739">for</span>&nbsp;<span class="ident" id="6311743">i</span>&nbsp;<span class="op" id="6311745">:=</span>&nbsp;<span class="num" id="6311748">0</span><span class="op" id="6311749">;</span>&nbsp;<span class="ident" id="6311751">i</span>&nbsp;<span class="op" id="6311753">&lt;</span>&nbsp;<span class="ident" id="6311755">nComp</span><span class="op" id="6311760">;</span>&nbsp;<span class="ident" id="6311762">i</span><span class="op" id="6311763">++</span>&nbsp;<span class="op" id="6311766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311772">compIndex</span>&nbsp;<span class="op" id="6311782">:=</span>&nbsp;<span class="ident" id="6311785">scan</span><span class="op" id="6311789">[</span><span class="ident" id="6311790">i</span><span class="op" id="6311791">]</span><span class="op" id="6311792">.</span><span class="ident" id="6311793">compIndex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6311807">qt</span>&nbsp;<span class="op" id="6311810">:=</span>&nbsp;<span class="op" id="6311813">&amp;</span><span class="ident" id="6311814">d</span><span class="op" id="6311815">.</span><span class="ident" id="6311816">quant</span><span class="op" id="6311821">[</span><span class="ident" id="6311822">d</span><span class="op" id="6311823">.</span><span class="ident" id="6311824">comp</span><span class="op" id="6311828">[</span><span class="ident" id="6311829">compIndex</span><span class="op" id="6311838">]</span><span class="op" id="6311839">.</span><span class="ident" id="6311840">tq</span><span class="op" id="6311842">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6311848">for</span>&nbsp;<span class="ident" id="6311852">j</span>&nbsp;<span class="op" id="6311854">:=</span>&nbsp;<span class="num" id="6311857">0</span><span class="op" id="6311858">;</span>&nbsp;<span class="ident" id="6311860">j</span>&nbsp;<span class="op" id="6311862">&lt;</span>&nbsp;<span class="ident" id="6311864">d</span><span class="op" id="6311865">.</span><span class="ident" id="6311866">comp</span><span class="op" id="6311870">[</span><span class="ident" id="6311871">compIndex</span><span class="op" id="6311880">]</span><span class="op" id="6311881">.</span><span class="ident" id="6311882">h</span><span class="op" id="6311883">*</span><span class="ident" id="6311884">d</span><span class="op" id="6311885">.</span><span class="ident" id="6311886">comp</span><span class="op" id="6311890">[</span><span class="ident" id="6311891">compIndex</span><span class="op" id="6311900">]</span><span class="op" id="6311901">.</span><span class="ident" id="6311902">v</span><span class="op" id="6311903">;</span>&nbsp;<span class="ident" id="6311905">j</span><span class="op" id="6311906">++</span>&nbsp;<span class="op" id="6311909">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311916">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;traversed&nbsp;one&nbsp;MCU&nbsp;at&nbsp;a&nbsp;time.&nbsp;For&nbsp;4:2:0&nbsp;chroma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6311985">//&nbsp;subsampling,&nbsp;there&nbsp;are&nbsp;four&nbsp;Y&nbsp;8x8&nbsp;blocks&nbsp;in&nbsp;every&nbsp;16x16&nbsp;MCU.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312054">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312062">//&nbsp;For&nbsp;a&nbsp;baseline&nbsp;32x16&nbsp;pixel&nbsp;image,&nbsp;the&nbsp;Y&nbsp;blocks&nbsp;visiting&nbsp;order&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312136">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312152">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312168">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312176">//&nbsp;For&nbsp;progressive&nbsp;images,&nbsp;the&nbsp;interleaved&nbsp;scans&nbsp;(those&nbsp;with&nbsp;nComp&nbsp;&gt;&nbsp;1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312253">//&nbsp;are&nbsp;traversed&nbsp;as&nbsp;above,&nbsp;but&nbsp;non-interleaved&nbsp;scans&nbsp;are&nbsp;traversed&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312330">//&nbsp;to&nbsp;right,&nbsp;top&nbsp;to&nbsp;bottom:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312363">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2&nbsp;3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312379">//&nbsp;&nbsp;&nbsp;&nbsp4&nbsp;5&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312395">//&nbsp;Only&nbsp;DC&nbsp;scans&nbsp;(zigStart&nbsp;==&nbsp;0)&nbsp;can&nbsp;be&nbsp;interleaved.&nbsp;AC&nbsp;scans&nbsp;must&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312472">//&nbsp;only&nbsp;one&nbsp;component.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312500">//</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312508">//&nbsp;To&nbsp;further&nbsp;complicate&nbsp;matters,&nbsp;for&nbsp;non-interleaved&nbsp;scans,&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312586">//&nbsp;data&nbsp;for&nbsp;any&nbsp;blocks&nbsp;that&nbsp;are&nbsp;inside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;MCU&nbsp;level&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312661">//&nbsp;outside&nbsp;the&nbsp;image&nbsp;at&nbsp;the&nbsp;pixel&nbsp;level.&nbsp;For&nbsp;example,&nbsp;a&nbsp;24x16&nbsp;pixel&nbsp;4:2:0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312740">//&nbsp;progressive&nbsp;image&nbsp;consists&nbsp;of&nbsp;two&nbsp;16x16&nbsp;MCUs.&nbsp;The&nbsp;interleaved&nbsp;scans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312816">//&nbsp;will&nbsp;process&nbsp;8&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312849">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;4&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312865">//&nbsp;&nbsp;&nbsp;&nbsp2&nbsp;3&nbsp;6&nbsp;7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312881">//&nbsp;The&nbsp;non-interleaved&nbsp;scans&nbsp;will&nbsp;process&nbsp;only&nbsp;6&nbsp;Y&nbsp;blocks:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312945">//&nbsp;&nbsp;&nbsp;&nbsp0&nbsp;1&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6312959">//&nbsp;&nbsp;&nbsp;&nbsp3&nbsp;4&nbsp;5</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6312973">if</span>&nbsp;<span class="ident" id="6312976">nComp</span>&nbsp;<span class="op" id="6312982">!=</span>&nbsp;<span class="num" id="6312985">1</span>&nbsp;<span class="op" id="6312987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6312995">bx</span><span class="op" id="6312997">,</span>&nbsp;<span class="ident" id="6312999">by</span>&nbsp;<span class="op" id="6313002">=</span>&nbsp;<span class="ident" id="6313004">d</span><span class="op" id="6313005">.</span><span class="ident" id="6313006">comp</span><span class="op" id="6313010">[</span><span class="ident" id="6313011">compIndex</span><span class="op" id="6313020">]</span><span class="op" id="6313021">.</span><span class="ident" id="6313022">h</span><span class="op" id="6313023">*</span><span class="ident" id="6313024">mx</span><span class="op" id="6313026">,</span>&nbsp;<span class="ident" id="6313028">d</span><span class="op" id="6313029">.</span><span class="ident" id="6313030">comp</span><span class="op" id="6313034">[</span><span class="ident" id="6313035">compIndex</span><span class="op" id="6313044">]</span><span class="op" id="6313045">.</span><span class="ident" id="6313046">v</span><span class="op" id="6313047">*</span><span class="ident" id="6313048">my</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313057">if</span>&nbsp;<span class="ident" id="6313060">h0</span>&nbsp;<span class="op" id="6313063">==</span>&nbsp;<span class="num" id="6313066">1</span>&nbsp;<span class="op" id="6313068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313077">by</span>&nbsp;<span class="op" id="6313080">+=</span>&nbsp;<span class="ident" id="6313083">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313091">}</span>&nbsp;<span class="keyword" id="6313093">else</span>&nbsp;<span class="op" id="6313098">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313107">bx</span>&nbsp;<span class="op" id="6313110">+=</span>&nbsp;<span class="ident" id="6313113">j</span>&nbsp;<span class="op" id="6313115">%</span>&nbsp;<span class="num" id="6313117">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313126">by</span>&nbsp;<span class="op" id="6313129">+=</span>&nbsp;<span class="ident" id="6313132">j</span>&nbsp;<span class="op" id="6313134">/</span>&nbsp;<span class="num" id="6313136">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313151">}</span>&nbsp;<span class="keyword" id="6313153">else</span>&nbsp;<span class="op" id="6313158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313166">q</span>&nbsp;<span class="op" id="6313168">:=</span>&nbsp;<span class="ident" id="6313171">mxx</span>&nbsp;<span class="op" id="6313175">*</span>&nbsp;<span class="ident" id="6313177">d</span><span class="op" id="6313178">.</span><span class="ident" id="6313179">comp</span><span class="op" id="6313183">[</span><span class="ident" id="6313184">compIndex</span><span class="op" id="6313193">]</span><span class="op" id="6313194">.</span><span class="ident" id="6313195">h</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313203">bx</span>&nbsp;<span class="op" id="6313206">=</span>&nbsp;<span class="ident" id="6313208">blockCount</span>&nbsp;<span class="op" id="6313219">%</span>&nbsp;<span class="ident" id="6313221">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313229">by</span>&nbsp;<span class="op" id="6313232">=</span>&nbsp;<span class="ident" id="6313234">blockCount</span>&nbsp;<span class="op" id="6313245">/</span>&nbsp;<span class="ident" id="6313247">q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313255">blockCount</span><span class="op" id="6313265">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313274">if</span>&nbsp;<span class="ident" id="6313277">bx</span><span class="op" id="6313279">*</span><span class="num" id="6313280">8</span>&nbsp;<span class="op" id="6313282">&gt;=</span>&nbsp;<span class="ident" id="6313285">d</span><span class="op" id="6313286">.</span><span class="ident" id="6313287">width</span>&nbsp;<span class="op" id="6313293">||</span>&nbsp;<span class="ident" id="6313296">by</span><span class="op" id="6313298">*</span><span class="num" id="6313299">8</span>&nbsp;<span class="op" id="6313301">&gt;=</span>&nbsp;<span class="ident" id="6313304">d</span><span class="op" id="6313305">.</span><span class="ident" id="6313306">height</span>&nbsp;<span class="op" id="6313313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313322">continue</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313352">//&nbsp;Load&nbsp;the&nbsp;previous&nbsp;partially&nbsp;decoded&nbsp;coefficients,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313425">if</span>&nbsp;<span class="ident" id="6313428">d</span><span class="op" id="6313429">.</span><span class="ident" id="6313430">progressive</span>&nbsp;<span class="op" id="6313442">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313450">b</span>&nbsp;<span class="op" id="6313452">=</span>&nbsp;<span class="ident" id="6313454">d</span><span class="op" id="6313455">.</span><span class="ident" id="6313456">progCoeffs</span><span class="op" id="6313466">[</span><span class="ident" id="6313467">compIndex</span><span class="op" id="6313476">]</span><span class="op" id="6313477">[</span><span class="ident" id="6313478">by</span><span class="op" id="6313480">*</span><span class="ident" id="6313481">mxx</span><span class="op" id="6313484">*</span><span class="ident" id="6313485">d</span><span class="op" id="6313486">.</span><span class="ident" id="6313487">comp</span><span class="op" id="6313491">[</span><span class="ident" id="6313492">compIndex</span><span class="op" id="6313501">]</span><span class="op" id="6313502">.</span><span class="ident" id="6313503">h</span><span class="op" id="6313504">+</span><span class="ident" id="6313505">bx</span><span class="op" id="6313507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313514">}</span>&nbsp;<span class="keyword" id="6313516">else</span>&nbsp;<span class="op" id="6313521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313529">b</span>&nbsp;<span class="op" id="6313531">=</span>&nbsp;<span class="ident" id="6313533">block</span><span class="op" id="6313538">{</span><span class="op" id="6313539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313554">if</span>&nbsp;<span class="ident" id="6313557">ah</span>&nbsp;<span class="op" id="6313560">!=</span>&nbsp;<span class="num" id="6313563">0</span>&nbsp;<span class="op" id="6313565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313573">if</span>&nbsp;<span class="ident" id="6313576">err</span>&nbsp;<span class="op" id="6313580">:=</span>&nbsp;<span class="ident" id="6313583">d</span><span class="op" id="6313584">.</span><span class="ident" id="6313585">refine</span><span class="op" id="6313591">(</span><span class="op" id="6313592">&amp;</span><span class="ident" id="6313593">b</span><span class="op" id="6313594">,</span>&nbsp;<span class="op" id="6313596">&amp;</span><span class="ident" id="6313597">d</span><span class="op" id="6313598">.</span><span class="ident" id="6313599">huff</span><span class="op" id="6313603">[</span><span class="ident" id="6313604">acTable</span><span class="op" id="6313611">]</span><span class="op" id="6313612">[</span><span class="ident" id="6313613">scan</span><span class="op" id="6313617">[</span><span class="ident" id="6313618">i</span><span class="op" id="6313619">]</span><span class="op" id="6313620">.</span><span class="ident" id="6313621">ta</span><span class="op" id="6313623">]</span><span class="op" id="6313624">,</span>&nbsp;<span class="ident" id="6313626">zigStart</span><span class="op" id="6313634">,</span>&nbsp;<span class="ident" id="6313636">zigEnd</span><span class="op" id="6313642">,</span>&nbsp;<span class="num" id="6313644">1</span><span class="op" id="6313645">&lt;&lt;</span><span class="ident" id="6313647">al</span><span class="op" id="6313649">)</span><span class="op" id="6313650">;</span>&nbsp;<span class="ident" id="6313652">err</span>&nbsp;<span class="op" id="6313656">!=</span>&nbsp;<span class="ident" id="6313659">nil</span>&nbsp;<span class="op" id="6313663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313672">return</span>&nbsp;<span class="ident" id="6313679">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313696">}</span>&nbsp;<span class="keyword" id="6313698">else</span>&nbsp;<span class="op" id="6313703">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313711">zig</span>&nbsp;<span class="op" id="6313715">:=</span>&nbsp;<span class="ident" id="6313718">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313733">if</span>&nbsp;<span class="ident" id="6313736">zig</span>&nbsp;<span class="op" id="6313740">==</span>&nbsp;<span class="num" id="6313743">0</span>&nbsp;<span class="op" id="6313745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313754">zig</span><span class="op" id="6313757">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6313767">//&nbsp;Decode&nbsp;the&nbsp;DC&nbsp;coefficient,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6313837">value</span><span class="op" id="6313842">,</span>&nbsp;<span class="ident" id="6313844">err</span>&nbsp;<span class="op" id="6313848">:=</span>&nbsp;<span class="ident" id="6313851">d</span><span class="op" id="6313852">.</span><span class="ident" id="6313853">decodeHuffman</span><span class="op" id="6313866">(</span><span class="op" id="6313867">&amp;</span><span class="ident" id="6313868">d</span><span class="op" id="6313869">.</span><span class="ident" id="6313870">huff</span><span class="op" id="6313874">[</span><span class="ident" id="6313875">dcTable</span><span class="op" id="6313882">]</span><span class="op" id="6313883">[</span><span class="ident" id="6313884">scan</span><span class="op" id="6313888">[</span><span class="ident" id="6313889">i</span><span class="op" id="6313890">]</span><span class="op" id="6313891">.</span><span class="ident" id="6313892">td</span><span class="op" id="6313894">]</span><span class="op" id="6313895">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313904">if</span>&nbsp;<span class="ident" id="6313907">err</span>&nbsp;<span class="op" id="6313911">!=</span>&nbsp;<span class="ident" id="6313914">nil</span>&nbsp;<span class="op" id="6313918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313928">return</span>&nbsp;<span class="ident" id="6313935">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6313946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313955">if</span>&nbsp;<span class="ident" id="6313958">value</span>&nbsp;<span class="op" id="6313964">&gt;</span>&nbsp;<span class="num" id="6313966">16</span>&nbsp;<span class="op" id="6313969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6313979">return</span>&nbsp;<span class="ident" id="6313986">UnsupportedError</span><span class="op" id="6314002">(</span><span class="string" id="6314003">&#34;excessive&nbsp;DC&nbsp;component&#34;</span><span class="op" id="6314027">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314045">dcDelta</span><span class="op" id="6314052">,</span>&nbsp;<span class="ident" id="6314054">err</span>&nbsp;<span class="op" id="6314058">:=</span>&nbsp;<span class="ident" id="6314061">d</span><span class="op" id="6314062">.</span><span class="ident" id="6314063">receiveExtend</span><span class="op" id="6314076">(</span><span class="ident" id="6314077">value</span><span class="op" id="6314082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314091">if</span>&nbsp;<span class="ident" id="6314094">err</span>&nbsp;<span class="op" id="6314098">!=</span>&nbsp;<span class="ident" id="6314101">nil</span>&nbsp;<span class="op" id="6314105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314115">return</span>&nbsp;<span class="ident" id="6314122">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314133">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314142">dc</span><span class="op" id="6314144">[</span><span class="ident" id="6314145">compIndex</span><span class="op" id="6314154">]</span>&nbsp;<span class="op" id="6314156">+=</span>&nbsp;<span class="ident" id="6314159">dcDelta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314174">b</span><span class="op" id="6314175">[</span><span class="num" id="6314176">0</span><span class="op" id="6314177">]</span>&nbsp;<span class="op" id="6314179">=</span>&nbsp;<span class="ident" id="6314181">dc</span><span class="op" id="6314183">[</span><span class="ident" id="6314184">compIndex</span><span class="op" id="6314193">]</span>&nbsp;<span class="op" id="6314195">&lt;&lt;</span>&nbsp;<span class="ident" id="6314198">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314216">if</span>&nbsp;<span class="ident" id="6314219">zig</span>&nbsp;<span class="op" id="6314223">&lt;=</span>&nbsp;<span class="ident" id="6314226">zigEnd</span>&nbsp;<span class="op" id="6314233">&amp;&amp;</span>&nbsp;<span class="ident" id="6314236">d</span><span class="op" id="6314237">.</span><span class="ident" id="6314238">eobRun</span>&nbsp;<span class="op" id="6314245">&gt;</span>&nbsp;<span class="num" id="6314247">0</span>&nbsp;<span class="op" id="6314249">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314258">d</span><span class="op" id="6314259">.</span><span class="ident" id="6314260">eobRun</span><span class="op" id="6314266">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314275">}</span>&nbsp;<span class="keyword" id="6314277">else</span>&nbsp;<span class="op" id="6314282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6314291">//&nbsp;Decode&nbsp;the&nbsp;AC&nbsp;coefficients,&nbsp;as&nbsp;specified&nbsp;in&nbsp;section&nbsp;F.2.2.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314362">huff</span>&nbsp;<span class="op" id="6314367">:=</span>&nbsp;<span class="op" id="6314370">&amp;</span><span class="ident" id="6314371">d</span><span class="op" id="6314372">.</span><span class="ident" id="6314373">huff</span><span class="op" id="6314377">[</span><span class="ident" id="6314378">acTable</span><span class="op" id="6314385">]</span><span class="op" id="6314386">[</span><span class="ident" id="6314387">scan</span><span class="op" id="6314391">[</span><span class="ident" id="6314392">i</span><span class="op" id="6314393">]</span><span class="op" id="6314394">.</span><span class="ident" id="6314395">ta</span><span class="op" id="6314397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314406">for</span>&nbsp;<span class="op" id="6314410">;</span>&nbsp;<span class="ident" id="6314412">zig</span>&nbsp;<span class="op" id="6314416">&lt;=</span>&nbsp;<span class="ident" id="6314419">zigEnd</span><span class="op" id="6314425">;</span>&nbsp;<span class="ident" id="6314427">zig</span><span class="op" id="6314430">++</span>&nbsp;<span class="op" id="6314433">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314443">value</span><span class="op" id="6314448">,</span>&nbsp;<span class="ident" id="6314450">err</span>&nbsp;<span class="op" id="6314454">:=</span>&nbsp;<span class="ident" id="6314457">d</span><span class="op" id="6314458">.</span><span class="ident" id="6314459">decodeHuffman</span><span class="op" id="6314472">(</span><span class="ident" id="6314473">huff</span><span class="op" id="6314477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314487">if</span>&nbsp;<span class="ident" id="6314490">err</span>&nbsp;<span class="op" id="6314494">!=</span>&nbsp;<span class="ident" id="6314497">nil</span>&nbsp;<span class="op" id="6314501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314512">return</span>&nbsp;<span class="ident" id="6314519">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314541">val0</span>&nbsp;<span class="op" id="6314546">:=</span>&nbsp;<span class="ident" id="6314549">value</span>&nbsp;<span class="op" id="6314555">&gt;&gt;</span>&nbsp;<span class="num" id="6314558">4</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314568">val1</span>&nbsp;<span class="op" id="6314573">:=</span>&nbsp;<span class="ident" id="6314576">value</span>&nbsp;<span class="op" id="6314582">&amp;</span>&nbsp;<span class="num" id="6314584">0x0f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314597">if</span>&nbsp;<span class="ident" id="6314600">val1</span>&nbsp;<span class="op" id="6314605">!=</span>&nbsp;<span class="num" id="6314608">0</span>&nbsp;<span class="op" id="6314610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314621">zig</span>&nbsp;<span class="op" id="6314625">+=</span>&nbsp;<span class="builtintype" id="6314628">int32</span><span class="op" id="6314633">(</span><span class="ident" id="6314634">val0</span><span class="op" id="6314638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314649">if</span>&nbsp;<span class="ident" id="6314652">zig</span>&nbsp;<span class="op" id="6314656">&gt;</span>&nbsp;<span class="ident" id="6314658">zigEnd</span>&nbsp;<span class="op" id="6314665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314677">break</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314703">ac</span><span class="op" id="6314705">,</span>&nbsp;<span class="ident" id="6314707">err</span>&nbsp;<span class="op" id="6314711">:=</span>&nbsp;<span class="ident" id="6314714">d</span><span class="op" id="6314715">.</span><span class="ident" id="6314716">receiveExtend</span><span class="op" id="6314729">(</span><span class="ident" id="6314730">val1</span><span class="op" id="6314734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314745">if</span>&nbsp;<span class="ident" id="6314748">err</span>&nbsp;<span class="op" id="6314752">!=</span>&nbsp;<span class="ident" id="6314755">nil</span>&nbsp;<span class="op" id="6314759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314771">return</span>&nbsp;<span class="ident" id="6314778">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314791">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314802">b</span><span class="op" id="6314803">[</span><span class="ident" id="6314804">unzig</span><span class="op" id="6314809">[</span><span class="ident" id="6314810">zig</span><span class="op" id="6314813">]</span><span class="op" id="6314814">]</span>&nbsp;<span class="op" id="6314816">=</span>&nbsp;<span class="ident" id="6314818">ac</span>&nbsp;<span class="op" id="6314821">&lt;&lt;</span>&nbsp;<span class="ident" id="6314824">al</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6314835">}</span>&nbsp;<span class="keyword" id="6314837">else</span>&nbsp;<span class="op" id="6314842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314853">if</span>&nbsp;<span class="ident" id="6314856">val0</span>&nbsp;<span class="op" id="6314861">!=</span>&nbsp;<span class="num" id="6314864">0x0f</span>&nbsp;<span class="op" id="6314869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314881">d</span><span class="op" id="6314882">.</span><span class="ident" id="6314883">eobRun</span>&nbsp;<span class="op" id="6314890">=</span>&nbsp;<span class="builtintype" id="6314892">uint16</span><span class="op" id="6314898">(</span><span class="num" id="6314899">1</span>&nbsp;<span class="op" id="6314901">&lt;&lt;</span>&nbsp;<span class="ident" id="6314904">val0</span><span class="op" id="6314908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314920">if</span>&nbsp;<span class="ident" id="6314923">val0</span>&nbsp;<span class="op" id="6314928">!=</span>&nbsp;<span class="num" id="6314931">0</span>&nbsp;<span class="op" id="6314933">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6314946">bits</span><span class="op" id="6314950">,</span>&nbsp;<span class="ident" id="6314952">err</span>&nbsp;<span class="op" id="6314956">:=</span>&nbsp;<span class="ident" id="6314959">d</span><span class="op" id="6314960">.</span><span class="ident" id="6314961">decodeBits</span><span class="op" id="6314971">(</span><span class="builtintype" id="6314972">int32</span><span class="op" id="6314977">(</span><span class="ident" id="6314978">val0</span><span class="op" id="6314982">)</span><span class="op" id="6314983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6314996">if</span>&nbsp;<span class="ident" id="6314999">err</span>&nbsp;<span class="op" id="6315003">!=</span>&nbsp;<span class="ident" id="6315006">nil</span>&nbsp;<span class="op" id="6315010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315024">return</span>&nbsp;<span class="ident" id="6315031">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315059">d</span><span class="op" id="6315060">.</span><span class="ident" id="6315061">eobRun</span>&nbsp;<span class="op" id="6315068">|=</span>&nbsp;<span class="builtintype" id="6315071">uint16</span><span class="op" id="6315077">(</span><span class="ident" id="6315078">bits</span><span class="op" id="6315082">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315106">d</span><span class="op" id="6315107">.</span><span class="ident" id="6315108">eobRun</span><span class="op" id="6315114">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315127">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315153">zig</span>&nbsp;<span class="op" id="6315157">+=</span>&nbsp;<span class="num" id="6315160">0x0f</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315205">if</span>&nbsp;<span class="ident" id="6315208">d</span><span class="op" id="6315209">.</span><span class="ident" id="6315210">progressive</span>&nbsp;<span class="op" id="6315222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315230">if</span>&nbsp;<span class="ident" id="6315233">zigEnd</span>&nbsp;<span class="op" id="6315240">!=</span>&nbsp;<span class="ident" id="6315243">blockSize</span><span class="op" id="6315252">-</span><span class="num" id="6315253">1</span>&nbsp;<span class="op" id="6315255">||</span>&nbsp;<span class="ident" id="6315258">al</span>&nbsp;<span class="op" id="6315261">!=</span>&nbsp;<span class="num" id="6315264">0</span>&nbsp;<span class="op" id="6315266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315275">//&nbsp;We&nbsp;haven&#39;t&nbsp;completely&nbsp;decoded&nbsp;this&nbsp;8x8&nbsp;block.&nbsp;Save&nbsp;the&nbsp;coefficients.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315354">d</span><span class="op" id="6315355">.</span><span class="ident" id="6315356">progCoeffs</span><span class="op" id="6315366">[</span><span class="ident" id="6315367">compIndex</span><span class="op" id="6315376">]</span><span class="op" id="6315377">[</span><span class="ident" id="6315378">by</span><span class="op" id="6315380">*</span><span class="ident" id="6315381">mxx</span><span class="op" id="6315384">*</span><span class="ident" id="6315385">d</span><span class="op" id="6315386">.</span><span class="ident" id="6315387">comp</span><span class="op" id="6315391">[</span><span class="ident" id="6315392">compIndex</span><span class="op" id="6315401">]</span><span class="op" id="6315402">.</span><span class="ident" id="6315403">h</span><span class="op" id="6315404">+</span><span class="ident" id="6315405">bx</span><span class="op" id="6315407">]</span>&nbsp;<span class="op" id="6315409">=</span>&nbsp;<span class="ident" id="6315411">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315420">//&nbsp;At&nbsp;this&nbsp;point,&nbsp;we&nbsp;could&nbsp;execute&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;loop&nbsp;body&nbsp;to&nbsp;dequantize&nbsp;and</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315506">//&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT,&nbsp;to&nbsp;save&nbsp;early&nbsp;stages&nbsp;of&nbsp;a&nbsp;progressive&nbsp;image&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315592">//&nbsp;*image.YCbCr&nbsp;buffers&nbsp;(the&nbsp;whole&nbsp;point&nbsp;of&nbsp;progressive&nbsp;encoding),&nbsp;but&nbsp;in&nbsp;Go,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315677">//&nbsp;the&nbsp;jpeg.Decode&nbsp;function&nbsp;does&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;entire&nbsp;image&nbsp;is&nbsp;decoded,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315763">//&nbsp;so&nbsp;we&nbsp;&#34;continue&#34;&nbsp;here&nbsp;to&nbsp;avoid&nbsp;wasted&nbsp;computation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315824">continue</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6315846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6315854">//&nbsp;Dequantize,&nbsp;perform&nbsp;the&nbsp;inverse&nbsp;DCT&nbsp;and&nbsp;store&nbsp;the&nbsp;block&nbsp;to&nbsp;the&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6315932">for</span>&nbsp;<span class="ident" id="6315936">zig</span>&nbsp;<span class="op" id="6315940">:=</span>&nbsp;<span class="num" id="6315943">0</span><span class="op" id="6315944">;</span>&nbsp;<span class="ident" id="6315946">zig</span>&nbsp;<span class="op" id="6315950">&lt;</span>&nbsp;<span class="ident" id="6315952">blockSize</span><span class="op" id="6315961">;</span>&nbsp;<span class="ident" id="6315963">zig</span><span class="op" id="6315966">++</span>&nbsp;<span class="op" id="6315969">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6315977">b</span><span class="op" id="6315978">[</span><span class="ident" id="6315979">unzig</span><span class="op" id="6315984">[</span><span class="ident" id="6315985">zig</span><span class="op" id="6315988">]</span><span class="op" id="6315989">]</span>&nbsp;<span class="op" id="6315991">*=</span>&nbsp;<span class="ident" id="6315994">qt</span><span class="op" id="6315996">[</span><span class="ident" id="6315997">zig</span><span class="op" id="6316000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316014">idct</span><span class="op" id="6316018">(</span><span class="op" id="6316019">&amp;</span><span class="ident" id="6316020">b</span><span class="op" id="6316021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316028">dst</span><span class="op" id="6316031">,</span>&nbsp;<span class="ident" id="6316033">stride</span>&nbsp;<span class="op" id="6316040">:=</span>&nbsp;<span class="op" id="6316043">[</span><span class="op" id="6316044">]</span><span class="builtintype" id="6316045">byte</span><span class="op" id="6316049">(</span><span class="ident" id="6316050">nil</span><span class="op" id="6316053">)</span><span class="op" id="6316054">,</span>&nbsp;<span class="num" id="6316056">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316063">if</span>&nbsp;<span class="ident" id="6316066">d</span><span class="op" id="6316067">.</span><span class="ident" id="6316068">nComp</span>&nbsp;<span class="op" id="6316074">==</span>&nbsp;<span class="ident" id="6316077">nGrayComponent</span>&nbsp;<span class="op" id="6316092">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316100">dst</span><span class="op" id="6316103">,</span>&nbsp;<span class="ident" id="6316105">stride</span>&nbsp;<span class="op" id="6316112">=</span>&nbsp;<span class="ident" id="6316114">d</span><span class="op" id="6316115">.</span><span class="ident" id="6316116">img1</span><span class="op" id="6316120">.</span><span class="ident" id="6316121">Pix</span><span class="op" id="6316124">[</span><span class="num" id="6316125">8</span><span class="op" id="6316126">*</span><span class="op" id="6316127">(</span><span class="ident" id="6316128">by</span><span class="op" id="6316130">*</span><span class="ident" id="6316131">d</span><span class="op" id="6316132">.</span><span class="ident" id="6316133">img1</span><span class="op" id="6316137">.</span><span class="ident" id="6316138">Stride</span><span class="op" id="6316144">+</span><span class="ident" id="6316145">bx</span><span class="op" id="6316147">)</span><span class="op" id="6316148">:</span><span class="op" id="6316149">]</span><span class="op" id="6316150">,</span>&nbsp;<span class="ident" id="6316152">d</span><span class="op" id="6316153">.</span><span class="ident" id="6316154">img1</span><span class="op" id="6316158">.</span><span class="ident" id="6316159">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316171">}</span>&nbsp;<span class="keyword" id="6316173">else</span>&nbsp;<span class="op" id="6316178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316186">switch</span>&nbsp;<span class="ident" id="6316193">compIndex</span>&nbsp;<span class="op" id="6316203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316211">case</span>&nbsp;<span class="num" id="6316216">0</span><span class="op" id="6316217">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316226">dst</span><span class="op" id="6316229">,</span>&nbsp;<span class="ident" id="6316231">stride</span>&nbsp;<span class="op" id="6316238">=</span>&nbsp;<span class="ident" id="6316240">d</span><span class="op" id="6316241">.</span><span class="ident" id="6316242">img3</span><span class="op" id="6316246">.</span><span class="ident" id="6316247">Y</span><span class="op" id="6316248">[</span><span class="num" id="6316249">8</span><span class="op" id="6316250">*</span><span class="op" id="6316251">(</span><span class="ident" id="6316252">by</span><span class="op" id="6316254">*</span><span class="ident" id="6316255">d</span><span class="op" id="6316256">.</span><span class="ident" id="6316257">img3</span><span class="op" id="6316261">.</span><span class="ident" id="6316262">YStride</span><span class="op" id="6316269">+</span><span class="ident" id="6316270">bx</span><span class="op" id="6316272">)</span><span class="op" id="6316273">:</span><span class="op" id="6316274">]</span><span class="op" id="6316275">,</span>&nbsp;<span class="ident" id="6316277">d</span><span class="op" id="6316278">.</span><span class="ident" id="6316279">img3</span><span class="op" id="6316283">.</span><span class="ident" id="6316284">YStride</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316298">case</span>&nbsp;<span class="num" id="6316303">1</span><span class="op" id="6316304">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316313">dst</span><span class="op" id="6316316">,</span>&nbsp;<span class="ident" id="6316318">stride</span>&nbsp;<span class="op" id="6316325">=</span>&nbsp;<span class="ident" id="6316327">d</span><span class="op" id="6316328">.</span><span class="ident" id="6316329">img3</span><span class="op" id="6316333">.</span><span class="ident" id="6316334">Cb</span><span class="op" id="6316336">[</span><span class="num" id="6316337">8</span><span class="op" id="6316338">*</span><span class="op" id="6316339">(</span><span class="ident" id="6316340">by</span><span class="op" id="6316342">*</span><span class="ident" id="6316343">d</span><span class="op" id="6316344">.</span><span class="ident" id="6316345">img3</span><span class="op" id="6316349">.</span><span class="ident" id="6316350">CStride</span><span class="op" id="6316357">+</span><span class="ident" id="6316358">bx</span><span class="op" id="6316360">)</span><span class="op" id="6316361">:</span><span class="op" id="6316362">]</span><span class="op" id="6316363">,</span>&nbsp;<span class="ident" id="6316365">d</span><span class="op" id="6316366">.</span><span class="ident" id="6316367">img3</span><span class="op" id="6316371">.</span><span class="ident" id="6316372">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316386">case</span>&nbsp;<span class="num" id="6316391">2</span><span class="op" id="6316392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316401">dst</span><span class="op" id="6316404">,</span>&nbsp;<span class="ident" id="6316406">stride</span>&nbsp;<span class="op" id="6316413">=</span>&nbsp;<span class="ident" id="6316415">d</span><span class="op" id="6316416">.</span><span class="ident" id="6316417">img3</span><span class="op" id="6316421">.</span><span class="ident" id="6316422">Cr</span><span class="op" id="6316424">[</span><span class="num" id="6316425">8</span><span class="op" id="6316426">*</span><span class="op" id="6316427">(</span><span class="ident" id="6316428">by</span><span class="op" id="6316430">*</span><span class="ident" id="6316431">d</span><span class="op" id="6316432">.</span><span class="ident" id="6316433">img3</span><span class="op" id="6316437">.</span><span class="ident" id="6316438">CStride</span><span class="op" id="6316445">+</span><span class="ident" id="6316446">bx</span><span class="op" id="6316448">)</span><span class="op" id="6316449">:</span><span class="op" id="6316450">]</span><span class="op" id="6316451">,</span>&nbsp;<span class="ident" id="6316453">d</span><span class="op" id="6316454">.</span><span class="ident" id="6316455">img3</span><span class="op" id="6316459">.</span><span class="ident" id="6316460">CStride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316474">default</span><span class="op" id="6316481">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316490">return</span>&nbsp;<span class="ident" id="6316497">UnsupportedError</span><span class="op" id="6316513">(</span><span class="string" id="6316514">&#34;too&nbsp;many&nbsp;components&#34;</span><span class="op" id="6316535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6316557">//&nbsp;Level&nbsp;shift&nbsp;by&nbsp;+128,&nbsp;clip&nbsp;to&nbsp;[0,&nbsp;255],&nbsp;and&nbsp;write&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316622">for</span>&nbsp;<span class="ident" id="6316626">y</span>&nbsp;<span class="op" id="6316628">:=</span>&nbsp;<span class="num" id="6316631">0</span><span class="op" id="6316632">;</span>&nbsp;<span class="ident" id="6316634">y</span>&nbsp;<span class="op" id="6316636">&lt;</span>&nbsp;<span class="num" id="6316638">8</span><span class="op" id="6316639">;</span>&nbsp;<span class="ident" id="6316641">y</span><span class="op" id="6316642">++</span>&nbsp;<span class="op" id="6316645">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316653">y8</span>&nbsp;<span class="op" id="6316656">:=</span>&nbsp;<span class="ident" id="6316659">y</span>&nbsp;<span class="op" id="6316661">*</span>&nbsp;<span class="num" id="6316663">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316671">yStride</span>&nbsp;<span class="op" id="6316679">:=</span>&nbsp;<span class="ident" id="6316682">y</span>&nbsp;<span class="op" id="6316684">*</span>&nbsp;<span class="ident" id="6316686">stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316699">for</span>&nbsp;<span class="ident" id="6316703">x</span>&nbsp;<span class="op" id="6316705">:=</span>&nbsp;<span class="num" id="6316708">0</span><span class="op" id="6316709">;</span>&nbsp;<span class="ident" id="6316711">x</span>&nbsp;<span class="op" id="6316713">&lt;</span>&nbsp;<span class="num" id="6316715">8</span><span class="op" id="6316716">;</span>&nbsp;<span class="ident" id="6316718">x</span><span class="op" id="6316719">++</span>&nbsp;<span class="op" id="6316722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316731">c</span>&nbsp;<span class="op" id="6316733">:=</span>&nbsp;<span class="ident" id="6316736">b</span><span class="op" id="6316737">[</span><span class="ident" id="6316738">y8</span><span class="op" id="6316740">+</span><span class="ident" id="6316741">x</span><span class="op" id="6316742">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316751">if</span>&nbsp;<span class="ident" id="6316754">c</span>&nbsp;<span class="op" id="6316756">&lt;</span>&nbsp;<span class="op" id="6316758">-</span><span class="num" id="6316759">128</span>&nbsp;<span class="op" id="6316763">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316773">c</span>&nbsp;<span class="op" id="6316775">=</span>&nbsp;<span class="num" id="6316777">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316786">}</span>&nbsp;<span class="keyword" id="6316788">else</span>&nbsp;<span class="keyword" id="6316793">if</span>&nbsp;<span class="ident" id="6316796">c</span>&nbsp;<span class="op" id="6316798">&gt;</span>&nbsp;<span class="num" id="6316800">127</span>&nbsp;<span class="op" id="6316804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316814">c</span>&nbsp;<span class="op" id="6316816">=</span>&nbsp;<span class="num" id="6316818">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316829">}</span>&nbsp;<span class="keyword" id="6316831">else</span>&nbsp;<span class="op" id="6316836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316846">c</span>&nbsp;<span class="op" id="6316848">+=</span>&nbsp;<span class="num" id="6316851">128</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316871">dst</span><span class="op" id="6316874">[</span><span class="ident" id="6316875">yStride</span><span class="op" id="6316882">+</span><span class="ident" id="6316883">x</span><span class="op" id="6316884">]</span>&nbsp;<span class="op" id="6316886">=</span>&nbsp;<span class="builtintype" id="6316888">uint8</span><span class="op" id="6316893">(</span><span class="ident" id="6316894">c</span><span class="op" id="6316895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316916">}</span>&nbsp;<span class="comment" id="6316918">//&nbsp;for&nbsp;j</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6316930">}</span>&nbsp;<span class="comment" id="6316932">//&nbsp;for&nbsp;i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6316944">mcu</span><span class="op" id="6316947">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6316953">if</span>&nbsp;<span class="ident" id="6316956">d</span><span class="op" id="6316957">.</span><span class="ident" id="6316958">ri</span>&nbsp;<span class="op" id="6316961">&gt;</span>&nbsp;<span class="num" id="6316963">0</span>&nbsp;<span class="op" id="6316965">&amp;&amp;</span>&nbsp;<span class="ident" id="6316968">mcu</span><span class="op" id="6316971">%</span><span class="ident" id="6316972">d</span><span class="op" id="6316973">.</span><span class="ident" id="6316974">ri</span>&nbsp;<span class="op" id="6316977">==</span>&nbsp;<span class="num" id="6316980">0</span>&nbsp;<span class="op" id="6316982">&amp;&amp;</span>&nbsp;<span class="ident" id="6316985">mcu</span>&nbsp;<span class="op" id="6316989">&lt;</span>&nbsp;<span class="ident" id="6316991">mxx</span><span class="op" id="6316994">*</span><span class="ident" id="6316995">myy</span>&nbsp;<span class="op" id="6316999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317005">//&nbsp;A&nbsp;more&nbsp;sophisticated&nbsp;decoder&nbsp;could&nbsp;use&nbsp;RST[0-7]&nbsp;markers&nbsp;to&nbsp;resynchronize&nbsp;from&nbsp;corrupt&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317105">//&nbsp;but&nbsp;this&nbsp;one&nbsp;assumes&nbsp;well-formed&nbsp;input,&nbsp;and&nbsp;hence&nbsp;the&nbsp;restart&nbsp;marker&nbsp;follows&nbsp;immediately.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317202">if</span>&nbsp;<span class="ident" id="6317205">err</span>&nbsp;<span class="op" id="6317209">:=</span>&nbsp;<span class="ident" id="6317212">d</span><span class="op" id="6317213">.</span><span class="ident" id="6317214">readFull</span><span class="op" id="6317222">(</span><span class="ident" id="6317223">d</span><span class="op" id="6317224">.</span><span class="ident" id="6317225">tmp</span><span class="op" id="6317228">[</span><span class="op" id="6317229">:</span><span class="num" id="6317230">2</span><span class="op" id="6317231">]</span><span class="op" id="6317232">)</span><span class="op" id="6317233">;</span>&nbsp;<span class="ident" id="6317235">err</span>&nbsp;<span class="op" id="6317239">!=</span>&nbsp;<span class="ident" id="6317242">nil</span>&nbsp;<span class="op" id="6317246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317253">return</span>&nbsp;<span class="ident" id="6317260">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317274">if</span>&nbsp;<span class="ident" id="6317277">d</span><span class="op" id="6317278">.</span><span class="ident" id="6317279">tmp</span><span class="op" id="6317282">[</span><span class="num" id="6317283">0</span><span class="op" id="6317284">]</span>&nbsp;<span class="op" id="6317286">!=</span>&nbsp;<span class="num" id="6317289">0xff</span>&nbsp;<span class="op" id="6317294">||</span>&nbsp;<span class="ident" id="6317297">d</span><span class="op" id="6317298">.</span><span class="ident" id="6317299">tmp</span><span class="op" id="6317302">[</span><span class="num" id="6317303">1</span><span class="op" id="6317304">]</span>&nbsp;<span class="op" id="6317306">!=</span>&nbsp;<span class="ident" id="6317309">expectedRST</span>&nbsp;<span class="op" id="6317321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317328">return</span>&nbsp;<span class="ident" id="6317335">FormatError</span><span class="op" id="6317346">(</span><span class="string" id="6317347">&#34;bad&nbsp;RST&nbsp;marker&#34;</span><span class="op" id="6317363">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317375">expectedRST</span><span class="op" id="6317386">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317393">if</span>&nbsp;<span class="ident" id="6317396">expectedRST</span>&nbsp;<span class="op" id="6317408">==</span>&nbsp;<span class="ident" id="6317411">rst7Marker</span><span class="op" id="6317421">+</span><span class="num" id="6317422">1</span>&nbsp;<span class="op" id="6317424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317431">expectedRST</span>&nbsp;<span class="op" id="6317443">=</span>&nbsp;<span class="ident" id="6317445">rst0Marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317460">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317466">//&nbsp;Reset&nbsp;the&nbsp;Huffman&nbsp;decoder.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317500">d</span><span class="op" id="6317501">.</span><span class="ident" id="6317502">bits</span>&nbsp;<span class="op" id="6317507">=</span>&nbsp;<span class="ident" id="6317509">bits</span><span class="op" id="6317513">{</span><span class="op" id="6317514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317520">//&nbsp;Reset&nbsp;the&nbsp;DC&nbsp;components,&nbsp;as&nbsp;per&nbsp;section&nbsp;F.2.1.3.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317578">dc</span>&nbsp;<span class="op" id="6317581">=</span>&nbsp;<span class="op" id="6317583">[</span><span class="ident" id="6317584">nColorComponent</span><span class="op" id="6317599">]</span><span class="builtintype" id="6317600">int32</span><span class="op" id="6317605">{</span><span class="op" id="6317606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317612">//&nbsp;Reset&nbsp;the&nbsp;progressive&nbsp;decoder&nbsp;state,&nbsp;as&nbsp;per&nbsp;section&nbsp;G.1.2.2.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6317680">d</span><span class="op" id="6317681">.</span><span class="ident" id="6317682">eobRun</span>&nbsp;<span class="op" id="6317689">=</span>&nbsp;<span class="num" id="6317691">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317700">}</span>&nbsp;<span class="comment" id="6317702">//&nbsp;for&nbsp;mx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6317713">}</span>&nbsp;<span class="comment" id="6317715">//&nbsp;for&nbsp;my</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317727">return</span>&nbsp;<span class="ident" id="6317734">nil</span><br>
<span class="lineno"></span><span class="op" id="6317738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6317741">//&nbsp;refine&nbsp;decodes&nbsp;a&nbsp;successive&nbsp;approximation&nbsp;refinement&nbsp;block,&nbsp;as&nbsp;specified&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6317820">//&nbsp;section&nbsp;G.1.2.</span><br>
<span class="lineno">340</span><span class="keyword" id="6317838">func</span>&nbsp;<span class="op" id="6317843">(</span><span class="ident" id="6317844">d</span>&nbsp;<span class="op" id="6317846">*</span><span class="ident" id="6317847">decoder</span><span class="op" id="6317854">)</span>&nbsp;<span class="ident" id="6317856">refine</span><span class="op" id="6317862">(</span><span class="ident" id="6317863">b</span>&nbsp;<span class="op" id="6317865">*</span><span class="ident" id="6317866">block</span><span class="op" id="6317871">,</span>&nbsp;<span class="ident" id="6317873">h</span>&nbsp;<span class="op" id="6317875">*</span><span class="ident" id="6317876">huffman</span><span class="op" id="6317883">,</span>&nbsp;<span class="ident" id="6317885">zigStart</span><span class="op" id="6317893">,</span>&nbsp;<span class="ident" id="6317895">zigEnd</span><span class="op" id="6317901">,</span>&nbsp;<span class="ident" id="6317903">delta</span>&nbsp;<span class="builtintype" id="6317909">int32</span><span class="op" id="6317914">)</span>&nbsp;<span class="builtintype" id="6317916">error</span>&nbsp;<span class="op" id="6317922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6317925">//&nbsp;Refining&nbsp;a&nbsp;DC&nbsp;component&nbsp;is&nbsp;trivial.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317965">if</span>&nbsp;<span class="ident" id="6317968">zigStart</span>&nbsp;<span class="op" id="6317977">==</span>&nbsp;<span class="num" id="6317980">0</span>&nbsp;<span class="op" id="6317982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6317986">if</span>&nbsp;<span class="ident" id="6317989">zigEnd</span>&nbsp;<span class="op" id="6317996">!=</span>&nbsp;<span class="num" id="6317999">0</span>&nbsp;<span class="op" id="6318001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6318006">panic</span><span class="op" id="6318011">(</span><span class="string" id="6318012">&#34;unreachable&#34;</span><span class="op" id="6318025">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318033">bit</span><span class="op" id="6318036">,</span>&nbsp;<span class="ident" id="6318038">err</span>&nbsp;<span class="op" id="6318042">:=</span>&nbsp;<span class="ident" id="6318045">d</span><span class="op" id="6318046">.</span><span class="ident" id="6318047">decodeBit</span><span class="op" id="6318056">(</span><span class="op" id="6318057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318061">if</span>&nbsp;<span class="ident" id="6318064">err</span>&nbsp;<span class="op" id="6318068">!=</span>&nbsp;<span class="ident" id="6318071">nil</span>&nbsp;<span class="op" id="6318075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318080">return</span>&nbsp;<span class="ident" id="6318087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318093">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318097">if</span>&nbsp;<span class="ident" id="6318100">bit</span>&nbsp;<span class="op" id="6318104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318109">b</span><span class="op" id="6318110">[</span><span class="num" id="6318111">0</span><span class="op" id="6318112">]</span>&nbsp;<span class="op" id="6318114">|=</span>&nbsp;<span class="ident" id="6318117">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318129">return</span>&nbsp;<span class="ident" id="6318136">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318141">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6318145">//&nbsp;Refining&nbsp;AC&nbsp;components&nbsp;is&nbsp;more&nbsp;complicated;&nbsp;see&nbsp;sections&nbsp;G.1.2.2&nbsp;and&nbsp;G.1.2.3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318227">zig</span>&nbsp;<span class="op" id="6318231">:=</span>&nbsp;<span class="ident" id="6318234">zigStart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318244">if</span>&nbsp;<span class="ident" id="6318247">d</span><span class="op" id="6318248">.</span><span class="ident" id="6318249">eobRun</span>&nbsp;<span class="op" id="6318256">==</span>&nbsp;<span class="num" id="6318259">0</span>&nbsp;<span class="op" id="6318261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318264">loop</span><span class="op" id="6318268">:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318272">for</span>&nbsp;<span class="op" id="6318276">;</span>&nbsp;<span class="ident" id="6318278">zig</span>&nbsp;<span class="op" id="6318282">&lt;=</span>&nbsp;<span class="ident" id="6318285">zigEnd</span><span class="op" id="6318291">;</span>&nbsp;<span class="ident" id="6318293">zig</span><span class="op" id="6318296">++</span>&nbsp;<span class="op" id="6318299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318304">z</span>&nbsp;<span class="op" id="6318306">:=</span>&nbsp;<span class="builtintype" id="6318309">int32</span><span class="op" id="6318314">(</span><span class="num" id="6318315">0</span><span class="op" id="6318316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318321">value</span><span class="op" id="6318326">,</span>&nbsp;<span class="ident" id="6318328">err</span>&nbsp;<span class="op" id="6318332">:=</span>&nbsp;<span class="ident" id="6318335">d</span><span class="op" id="6318336">.</span><span class="ident" id="6318337">decodeHuffman</span><span class="op" id="6318350">(</span><span class="ident" id="6318351">h</span><span class="op" id="6318352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318357">if</span>&nbsp;<span class="ident" id="6318360">err</span>&nbsp;<span class="op" id="6318364">!=</span>&nbsp;<span class="ident" id="6318367">nil</span>&nbsp;<span class="op" id="6318371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318377">return</span>&nbsp;<span class="ident" id="6318384">err</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318396">val0</span>&nbsp;<span class="op" id="6318401">:=</span>&nbsp;<span class="ident" id="6318404">value</span>&nbsp;<span class="op" id="6318410">&gt;&gt;</span>&nbsp;<span class="num" id="6318413">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318418">val1</span>&nbsp;<span class="op" id="6318423">:=</span>&nbsp;<span class="ident" id="6318426">value</span>&nbsp;<span class="op" id="6318432">&amp;</span>&nbsp;<span class="num" id="6318434">0x0f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318443">switch</span>&nbsp;<span class="ident" id="6318450">val1</span>&nbsp;<span class="op" id="6318455">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318460">case</span>&nbsp;<span class="num" id="6318465">0</span><span class="op" id="6318466">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318472">if</span>&nbsp;<span class="ident" id="6318475">val0</span>&nbsp;<span class="op" id="6318480">!=</span>&nbsp;<span class="num" id="6318483">0x0f</span>&nbsp;<span class="op" id="6318488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318495">d</span><span class="op" id="6318496">.</span><span class="ident" id="6318497">eobRun</span>&nbsp;<span class="op" id="6318504">=</span>&nbsp;<span class="builtintype" id="6318506">uint16</span><span class="op" id="6318512">(</span><span class="num" id="6318513">1</span>&nbsp;<span class="op" id="6318515">&lt;&lt;</span>&nbsp;<span class="ident" id="6318518">val0</span><span class="op" id="6318522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318529">if</span>&nbsp;<span class="ident" id="6318532">val0</span>&nbsp;<span class="op" id="6318537">!=</span>&nbsp;<span class="num" id="6318540">0</span>&nbsp;<span class="op" id="6318542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318550">bits</span><span class="op" id="6318554">,</span>&nbsp;<span class="ident" id="6318556">err</span>&nbsp;<span class="op" id="6318560">:=</span>&nbsp;<span class="ident" id="6318563">d</span><span class="op" id="6318564">.</span><span class="ident" id="6318565">decodeBits</span><span class="op" id="6318575">(</span><span class="builtintype" id="6318576">int32</span><span class="op" id="6318581">(</span><span class="ident" id="6318582">val0</span><span class="op" id="6318586">)</span><span class="op" id="6318587">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318595">if</span>&nbsp;<span class="ident" id="6318598">err</span>&nbsp;<span class="op" id="6318602">!=</span>&nbsp;<span class="ident" id="6318605">nil</span>&nbsp;<span class="op" id="6318609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318618">return</span>&nbsp;<span class="ident" id="6318625">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318643">d</span><span class="op" id="6318644">.</span><span class="ident" id="6318645">eobRun</span>&nbsp;<span class="op" id="6318652">|=</span>&nbsp;<span class="builtintype" id="6318655">uint16</span><span class="op" id="6318661">(</span><span class="ident" id="6318662">bits</span><span class="op" id="6318666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318673">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318680">break</span>&nbsp;<span class="ident" id="6318686">loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318700">case</span>&nbsp;<span class="num" id="6318705">1</span><span class="op" id="6318706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318712">z</span>&nbsp;<span class="op" id="6318714">=</span>&nbsp;<span class="ident" id="6318716">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318726">bit</span><span class="op" id="6318729">,</span>&nbsp;<span class="ident" id="6318731">err</span>&nbsp;<span class="op" id="6318735">:=</span>&nbsp;<span class="ident" id="6318738">d</span><span class="op" id="6318739">.</span><span class="ident" id="6318740">decodeBit</span><span class="op" id="6318749">(</span><span class="op" id="6318750">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318756">if</span>&nbsp;<span class="ident" id="6318759">err</span>&nbsp;<span class="op" id="6318763">!=</span>&nbsp;<span class="ident" id="6318766">nil</span>&nbsp;<span class="op" id="6318770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318777">return</span>&nbsp;<span class="ident" id="6318784">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318798">if</span>&nbsp;<span class="op" id="6318801">!</span><span class="ident" id="6318802">bit</span>&nbsp;<span class="op" id="6318806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318813">z</span>&nbsp;<span class="op" id="6318815">=</span>&nbsp;<span class="op" id="6318817">-</span><span class="ident" id="6318818">z</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318829">default</span><span class="op" id="6318836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318842">return</span>&nbsp;<span class="ident" id="6318849">FormatError</span><span class="op" id="6318860">(</span><span class="string" id="6318861">&#34;unexpected&nbsp;Huffman&nbsp;code&#34;</span><span class="op" id="6318886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6318897">zig</span><span class="op" id="6318900">,</span>&nbsp;<span class="ident" id="6318902">err</span>&nbsp;<span class="op" id="6318906">=</span>&nbsp;<span class="ident" id="6318908">d</span><span class="op" id="6318909">.</span><span class="ident" id="6318910">refineNonZeroes</span><span class="op" id="6318925">(</span><span class="ident" id="6318926">b</span><span class="op" id="6318927">,</span>&nbsp;<span class="ident" id="6318929">zig</span><span class="op" id="6318932">,</span>&nbsp;<span class="ident" id="6318934">zigEnd</span><span class="op" id="6318940">,</span>&nbsp;<span class="builtintype" id="6318942">int32</span><span class="op" id="6318947">(</span><span class="ident" id="6318948">val0</span><span class="op" id="6318952">)</span><span class="op" id="6318953">,</span>&nbsp;<span class="ident" id="6318955">delta</span><span class="op" id="6318960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318965">if</span>&nbsp;<span class="ident" id="6318968">err</span>&nbsp;<span class="op" id="6318972">!=</span>&nbsp;<span class="ident" id="6318975">nil</span>&nbsp;<span class="op" id="6318979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6318985">return</span>&nbsp;<span class="ident" id="6318992">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6318999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319004">if</span>&nbsp;<span class="ident" id="6319007">zig</span>&nbsp;<span class="op" id="6319011">&gt;</span>&nbsp;<span class="ident" id="6319013">zigEnd</span>&nbsp;<span class="op" id="6319020">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319026">return</span>&nbsp;<span class="ident" id="6319033">FormatError</span><span class="op" id="6319044">(</span><span class="string" id="6319045">&#34;too&nbsp;many&nbsp;coefficients&#34;</span><span class="op" id="6319068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319078">if</span>&nbsp;<span class="ident" id="6319081">z</span>&nbsp;<span class="op" id="6319083">!=</span>&nbsp;<span class="num" id="6319086">0</span>&nbsp;<span class="op" id="6319088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319094">b</span><span class="op" id="6319095">[</span><span class="ident" id="6319096">unzig</span><span class="op" id="6319101">[</span><span class="ident" id="6319102">zig</span><span class="op" id="6319105">]</span><span class="op" id="6319106">]</span>&nbsp;<span class="op" id="6319108">=</span>&nbsp;<span class="ident" id="6319110">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319115">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319125">if</span>&nbsp;<span class="ident" id="6319128">d</span><span class="op" id="6319129">.</span><span class="ident" id="6319130">eobRun</span>&nbsp;<span class="op" id="6319137">&gt;</span>&nbsp;<span class="num" id="6319139">0</span>&nbsp;<span class="op" id="6319141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319145">d</span><span class="op" id="6319146">.</span><span class="ident" id="6319147">eobRun</span><span class="op" id="6319153">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319158">if</span>&nbsp;<span class="ident" id="6319161">_</span><span class="op" id="6319162">,</span>&nbsp;<span class="ident" id="6319164">err</span>&nbsp;<span class="op" id="6319168">:=</span>&nbsp;<span class="ident" id="6319171">d</span><span class="op" id="6319172">.</span><span class="ident" id="6319173">refineNonZeroes</span><span class="op" id="6319188">(</span><span class="ident" id="6319189">b</span><span class="op" id="6319190">,</span>&nbsp;<span class="ident" id="6319192">zig</span><span class="op" id="6319195">,</span>&nbsp;<span class="ident" id="6319197">zigEnd</span><span class="op" id="6319203">,</span>&nbsp;<span class="op" id="6319205">-</span><span class="num" id="6319206">1</span><span class="op" id="6319207">,</span>&nbsp;<span class="ident" id="6319209">delta</span><span class="op" id="6319214">)</span><span class="op" id="6319215">;</span>&nbsp;<span class="ident" id="6319217">err</span>&nbsp;<span class="op" id="6319221">!=</span>&nbsp;<span class="ident" id="6319224">nil</span>&nbsp;<span class="op" id="6319228">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319233">return</span>&nbsp;<span class="ident" id="6319240">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319252">return</span>&nbsp;<span class="ident" id="6319259">nil</span><br>
<span class="lineno"></span><span class="op" id="6319263">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="comment" id="6319266">//&nbsp;refineNonZeroes&nbsp;refines&nbsp;non-zero&nbsp;entries&nbsp;of&nbsp;b&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;If&nbsp;nz&nbsp;&gt;=&nbsp;0,</span><br>
<span class="lineno"></span><span class="comment" id="6319345">//&nbsp;the&nbsp;first&nbsp;nz&nbsp;zero&nbsp;entries&nbsp;are&nbsp;skipped&nbsp;over.</span><br>
<span class="lineno"></span><span class="keyword" id="6319392">func</span>&nbsp;<span class="op" id="6319397">(</span><span class="ident" id="6319398">d</span>&nbsp;<span class="op" id="6319400">*</span><span class="ident" id="6319401">decoder</span><span class="op" id="6319408">)</span>&nbsp;<span class="ident" id="6319410">refineNonZeroes</span><span class="op" id="6319425">(</span><span class="ident" id="6319426">b</span>&nbsp;<span class="op" id="6319428">*</span><span class="ident" id="6319429">block</span><span class="op" id="6319434">,</span>&nbsp;<span class="ident" id="6319436">zig</span><span class="op" id="6319439">,</span>&nbsp;<span class="ident" id="6319441">zigEnd</span><span class="op" id="6319447">,</span>&nbsp;<span class="ident" id="6319449">nz</span><span class="op" id="6319451">,</span>&nbsp;<span class="ident" id="6319453">delta</span>&nbsp;<span class="builtintype" id="6319459">int32</span><span class="op" id="6319464">)</span>&nbsp;<span class="op" id="6319466">(</span><span class="builtintype" id="6319467">int32</span><span class="op" id="6319472">,</span>&nbsp;<span class="builtintype" id="6319474">error</span><span class="op" id="6319479">)</span>&nbsp;<span class="op" id="6319481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319484">for</span>&nbsp;<span class="op" id="6319488">;</span>&nbsp;<span class="ident" id="6319490">zig</span>&nbsp;<span class="op" id="6319494">&lt;=</span>&nbsp;<span class="ident" id="6319497">zigEnd</span><span class="op" id="6319503">;</span>&nbsp;<span class="ident" id="6319505">zig</span><span class="op" id="6319508">++</span>&nbsp;<span class="op" id="6319511">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319515">u</span>&nbsp;<span class="op" id="6319517">:=</span>&nbsp;<span class="ident" id="6319520">unzig</span><span class="op" id="6319525">[</span><span class="ident" id="6319526">zig</span><span class="op" id="6319529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319533">if</span>&nbsp;<span class="ident" id="6319536">b</span><span class="op" id="6319537">[</span><span class="ident" id="6319538">u</span><span class="op" id="6319539">]</span>&nbsp;<span class="op" id="6319541">==</span>&nbsp;<span class="num" id="6319544">0</span>&nbsp;<span class="op" id="6319546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319551">if</span>&nbsp;<span class="ident" id="6319554">nz</span>&nbsp;<span class="op" id="6319557">==</span>&nbsp;<span class="num" id="6319560">0</span>&nbsp;<span class="op" id="6319562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319568">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319577">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319582">nz</span><span class="op" id="6319584">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319590">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319605">bit</span><span class="op" id="6319608">,</span>&nbsp;<span class="ident" id="6319610">err</span>&nbsp;<span class="op" id="6319614">:=</span>&nbsp;<span class="ident" id="6319617">d</span><span class="op" id="6319618">.</span><span class="ident" id="6319619">decodeBit</span><span class="op" id="6319628">(</span><span class="op" id="6319629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319633">if</span>&nbsp;<span class="ident" id="6319636">err</span>&nbsp;<span class="op" id="6319640">!=</span>&nbsp;<span class="ident" id="6319643">nil</span>&nbsp;<span class="op" id="6319647">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319652">return</span>&nbsp;<span class="num" id="6319659">0</span><span class="op" id="6319660">,</span>&nbsp;<span class="ident" id="6319662">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319672">if</span>&nbsp;<span class="op" id="6319675">!</span><span class="ident" id="6319676">bit</span>&nbsp;<span class="op" id="6319680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319685">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319696">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319700">if</span>&nbsp;<span class="ident" id="6319703">b</span><span class="op" id="6319704">[</span><span class="ident" id="6319705">u</span><span class="op" id="6319706">]</span>&nbsp;<span class="op" id="6319708">&gt;=</span>&nbsp;<span class="num" id="6319711">0</span>&nbsp;<span class="op" id="6319713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319718">b</span><span class="op" id="6319719">[</span><span class="ident" id="6319720">u</span><span class="op" id="6319721">]</span>&nbsp;<span class="op" id="6319723">+=</span>&nbsp;<span class="ident" id="6319726">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319734">}</span>&nbsp;<span class="keyword" id="6319736">else</span>&nbsp;<span class="op" id="6319741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6319746">b</span><span class="op" id="6319747">[</span><span class="ident" id="6319748">u</span><span class="op" id="6319749">]</span>&nbsp;<span class="op" id="6319751">-=</span>&nbsp;<span class="ident" id="6319754">delta</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319762">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6319765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6319768">return</span>&nbsp;<span class="ident" id="6319775">zig</span><span class="op" id="6319778">,</span>&nbsp;<span class="ident" id="6319780">nil</span><br>
<span class="lineno"></span><span class="op" id="6319784">}</span>
</div>
</body>
</html>
