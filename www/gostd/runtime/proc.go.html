<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1840602">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1840657">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1840711">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1840762">package</span>&nbsp;<span class="ident" id="1840770">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1840779">import</span>&nbsp;<span class="string" id="1840786">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1840796">func</span>&nbsp;<span class="ident" id="1840801">newsysmon</span><span class="op" id="1840810">(</span><span class="op" id="1840811">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1840814">func</span>&nbsp;<span class="ident" id="1840819">runtime_init</span><span class="op" id="1840831">(</span><span class="op" id="1840832">)</span><br>
<span class="lineno"></span><span class="keyword" id="1840834">func</span>&nbsp;<span class="ident" id="1840839">main_init</span><span class="op" id="1840848">(</span><span class="op" id="1840849">)</span><br>
<span class="lineno"></span><span class="keyword" id="1840851">func</span>&nbsp;<span class="ident" id="1840856">main_main</span><span class="op" id="1840865">(</span><span class="op" id="1840866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1840869">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1840892">func</span>&nbsp;<span class="ident" id="1840897">main</span><span class="op" id="1840901">(</span><span class="op" id="1840902">)</span>&nbsp;<span class="op" id="1840904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1840907">g</span>&nbsp;<span class="op" id="1840909">:=</span>&nbsp;<span class="ident" id="1840912">getg</span><span class="op" id="1840916">(</span><span class="op" id="1840917">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840921">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1840993">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841036">g</span><span class="op" id="1841037">.</span><span class="ident" id="1841038">m</span><span class="op" id="1841039">.</span><span class="ident" id="1841040">g0</span><span class="op" id="1841042">.</span><span class="ident" id="1841043">racectx</span>&nbsp;<span class="op" id="1841051">=</span>&nbsp;<span class="num" id="1841053">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841057">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841113">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841167">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841226">if</span>&nbsp;<span class="ident" id="1841229">ptrSize</span>&nbsp;<span class="op" id="1841237">==</span>&nbsp;<span class="num" id="1841240">8</span>&nbsp;<span class="op" id="1841242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841246">maxstacksize</span>&nbsp;<span class="op" id="1841259">=</span>&nbsp;<span class="num" id="1841261">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841273">}</span>&nbsp;<span class="keyword" id="1841275">else</span>&nbsp;<span class="op" id="1841280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841284">maxstacksize</span>&nbsp;<span class="op" id="1841297">=</span>&nbsp;<span class="num" id="1841299">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841310">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841314">onM</span><span class="op" id="1841317">(</span><span class="ident" id="1841318">newsysmon</span><span class="op" id="1841327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841331">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841390">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841454">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841514">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841576">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841634">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841660">lockOSThread</span><span class="op" id="1841672">(</span><span class="op" id="1841673">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841677">if</span>&nbsp;<span class="ident" id="1841680">g</span><span class="op" id="1841681">.</span><span class="ident" id="1841682">m</span>&nbsp;<span class="op" id="1841684">!=</span>&nbsp;<span class="op" id="1841687">&amp;</span><span class="ident" id="1841688">m0</span>&nbsp;<span class="op" id="1841691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841695">gothrow</span><span class="op" id="1841702">(</span><span class="string" id="1841703">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1841727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841730">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841734">runtime_init</span><span class="op" id="1841746">(</span><span class="op" id="1841747">)</span>&nbsp;<span class="comment" id="1841749">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1841775">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841848">needUnlock</span>&nbsp;<span class="op" id="1841859">:=</span>&nbsp;<span class="builtintype" id="1841862">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841868">defer</span>&nbsp;<span class="keyword" id="1841874">func</span><span class="op" id="1841878">(</span><span class="op" id="1841879">)</span>&nbsp;<span class="op" id="1841881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1841885">if</span>&nbsp;<span class="ident" id="1841888">needUnlock</span>&nbsp;<span class="op" id="1841899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841904">unlockOSThread</span><span class="op" id="1841918">(</span><span class="op" id="1841919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1841926">}</span><span class="op" id="1841927">(</span><span class="op" id="1841928">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1841932">memstats</span><span class="op" id="1841940">.</span><span class="ident" id="1841941">enablegc</span>&nbsp;<span class="op" id="1841950">=</span>&nbsp;<span class="builtintype" id="1841952">true</span>&nbsp;<span class="comment" id="1841957">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842006">main_init</span><span class="op" id="1842015">(</span><span class="op" id="1842016">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842020">needUnlock</span>&nbsp;<span class="op" id="1842031">=</span>&nbsp;<span class="builtintype" id="1842033">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842040">unlockOSThread</span><span class="op" id="1842054">(</span><span class="op" id="1842055">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842059">main_main</span><span class="op" id="1842068">(</span><span class="op" id="1842069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842072">if</span>&nbsp;<span class="ident" id="1842075">raceenabled</span>&nbsp;<span class="op" id="1842087">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842091">racefini</span><span class="op" id="1842099">(</span><span class="op" id="1842100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842107">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842158">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842214">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842275">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842323">if</span>&nbsp;<span class="ident" id="1842326">panicking</span>&nbsp;<span class="op" id="1842336">!=</span>&nbsp;<span class="num" id="1842339">0</span>&nbsp;<span class="op" id="1842341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842345">gopark</span><span class="op" id="1842351">(</span><span class="ident" id="1842352">nil</span><span class="op" id="1842355">,</span>&nbsp;<span class="ident" id="1842357">nil</span><span class="op" id="1842360">,</span>&nbsp;<span class="string" id="1842362">&#34;panicwait&#34;</span><span class="op" id="1842373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842376">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842380">exit</span><span class="op" id="1842384">(</span><span class="num" id="1842385">0</span><span class="op" id="1842386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842389">for</span>&nbsp;<span class="op" id="1842393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842397">var</span>&nbsp;<span class="ident" id="1842401">x</span>&nbsp;<span class="op" id="1842403">*</span><span class="builtintype" id="1842404">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842412">*</span><span class="ident" id="1842413">x</span>&nbsp;<span class="op" id="1842415">=</span>&nbsp;<span class="num" id="1842417">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842420">}</span><br>
<span class="lineno"></span><span class="op" id="1842422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1842425">var</span>&nbsp;<span class="ident" id="1842429">parkunlock_c</span>&nbsp;<span class="builtintype" id="1842442">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1842448">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1842482">func</span>&nbsp;<span class="ident" id="1842487">init</span><span class="op" id="1842491">(</span><span class="op" id="1842492">)</span>&nbsp;<span class="op" id="1842494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842497">go</span>&nbsp;<span class="ident" id="1842500">forcegchelper</span><span class="op" id="1842513">(</span><span class="op" id="1842514">)</span><br>
<span class="lineno"></span><span class="op" id="1842516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1842519">func</span>&nbsp;<span class="ident" id="1842524">forcegchelper</span><span class="op" id="1842537">(</span><span class="op" id="1842538">)</span>&nbsp;<span class="op" id="1842540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842543">forcegc</span><span class="op" id="1842550">.</span><span class="ident" id="1842551">g</span>&nbsp;<span class="op" id="1842553">=</span>&nbsp;<span class="ident" id="1842555">getg</span><span class="op" id="1842559">(</span><span class="op" id="1842560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842563">forcegc</span><span class="op" id="1842570">.</span><span class="ident" id="1842571">g</span><span class="op" id="1842572">.</span><span class="ident" id="1842573">issystem</span>&nbsp;<span class="op" id="1842582">=</span>&nbsp;<span class="builtintype" id="1842584">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842590">for</span>&nbsp;<span class="op" id="1842594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842598">lock</span><span class="op" id="1842602">(</span><span class="op" id="1842603">&amp;</span><span class="ident" id="1842604">forcegc</span><span class="op" id="1842611">.</span><span class="ident" id="1842612">lock</span><span class="op" id="1842616">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842620">if</span>&nbsp;<span class="ident" id="1842623">forcegc</span><span class="op" id="1842630">.</span><span class="ident" id="1842631">idle</span>&nbsp;<span class="op" id="1842636">!=</span>&nbsp;<span class="num" id="1842639">0</span>&nbsp;<span class="op" id="1842641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842646">gothrow</span><span class="op" id="1842653">(</span><span class="string" id="1842654">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1842676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842684">atomicstore</span><span class="op" id="1842695">(</span><span class="op" id="1842696">&amp;</span><span class="ident" id="1842697">forcegc</span><span class="op" id="1842704">.</span><span class="ident" id="1842705">idle</span><span class="op" id="1842709">,</span>&nbsp;<span class="num" id="1842711">1</span><span class="op" id="1842712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842716">goparkunlock</span><span class="op" id="1842728">(</span><span class="op" id="1842729">&amp;</span><span class="ident" id="1842730">forcegc</span><span class="op" id="1842737">.</span><span class="ident" id="1842738">lock</span><span class="op" id="1842742">,</span>&nbsp;<span class="string" id="1842744">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1842761">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1842765">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1842817">if</span>&nbsp;<span class="ident" id="1842820">debug</span><span class="op" id="1842825">.</span><span class="ident" id="1842826">gctrace</span>&nbsp;<span class="op" id="1842834">&gt;</span>&nbsp;<span class="num" id="1842836">0</span>&nbsp;<span class="op" id="1842838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1842843">println</span><span class="op" id="1842850">(</span><span class="string" id="1842851">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1842862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1842870">gogc</span><span class="op" id="1842874">(</span><span class="num" id="1842875">1</span><span class="op" id="1842876">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1842879">}</span><br>
<span class="lineno"></span><span class="op" id="1842881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1842884">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1842898">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1842978">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1843048">func</span>&nbsp;<span class="ident" id="1843053">Gosched</span><span class="op" id="1843060">(</span><span class="op" id="1843061">)</span>&nbsp;<span class="op" id="1843063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843066">mcall</span><span class="op" id="1843071">(</span><span class="ident" id="1843072">gosched_m</span><span class="op" id="1843081">)</span><br>
<span class="lineno"></span><span class="op" id="1843083">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1843086">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1843156">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1843211">func</span>&nbsp;<span class="ident" id="1843216">gopark</span><span class="op" id="1843222">(</span><span class="ident" id="1843223">unlockf</span>&nbsp;<span class="ident" id="1843231">unsafe</span><span class="op" id="1843237">.</span><span class="ident" id="1843238">Pointer</span><span class="op" id="1843245">,</span>&nbsp;<span class="ident" id="1843247">lock</span>&nbsp;<span class="ident" id="1843252">unsafe</span><span class="op" id="1843258">.</span><span class="ident" id="1843259">Pointer</span><span class="op" id="1843266">,</span>&nbsp;<span class="ident" id="1843268">reason</span>&nbsp;<span class="builtintype" id="1843275">string</span><span class="op" id="1843281">)</span>&nbsp;<span class="op" id="1843283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843286">mp</span>&nbsp;<span class="op" id="1843289">:=</span>&nbsp;<span class="ident" id="1843292">acquirem</span><span class="op" id="1843300">(</span><span class="op" id="1843301">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843304">gp</span>&nbsp;<span class="op" id="1843307">:=</span>&nbsp;<span class="ident" id="1843310">mp</span><span class="op" id="1843312">.</span><span class="ident" id="1843313">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843319">status</span>&nbsp;<span class="op" id="1843326">:=</span>&nbsp;<span class="ident" id="1843329">readgstatus</span><span class="op" id="1843340">(</span><span class="ident" id="1843341">gp</span><span class="op" id="1843343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1843346">if</span>&nbsp;<span class="ident" id="1843349">status</span>&nbsp;<span class="op" id="1843356">!=</span>&nbsp;<span class="ident" id="1843359">_Grunning</span>&nbsp;<span class="op" id="1843369">&amp;&amp;</span>&nbsp;<span class="ident" id="1843372">status</span>&nbsp;<span class="op" id="1843379">!=</span>&nbsp;<span class="ident" id="1843382">_Gscanrunning</span>&nbsp;<span class="op" id="1843396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843400">gothrow</span><span class="op" id="1843407">(</span><span class="string" id="1843408">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1843430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1843433">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843436">mp</span><span class="op" id="1843438">.</span><span class="ident" id="1843439">waitlock</span>&nbsp;<span class="op" id="1843448">=</span>&nbsp;<span class="ident" id="1843450">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843456">mp</span><span class="op" id="1843458">.</span><span class="ident" id="1843459">waitunlockf</span>&nbsp;<span class="op" id="1843471">=</span>&nbsp;<span class="ident" id="1843473">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843482">gp</span><span class="op" id="1843484">.</span><span class="ident" id="1843485">waitreason</span>&nbsp;<span class="op" id="1843496">=</span>&nbsp;<span class="ident" id="1843498">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843506">releasem</span><span class="op" id="1843514">(</span><span class="ident" id="1843515">mp</span><span class="op" id="1843517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1843520">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843581">mcall</span><span class="op" id="1843586">(</span><span class="ident" id="1843587">park_m</span><span class="op" id="1843593">)</span><br>
<span class="lineno"></span><span class="op" id="1843595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1843598">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1843671">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1843739">func</span>&nbsp;<span class="ident" id="1843744">goparkunlock</span><span class="op" id="1843756">(</span><span class="ident" id="1843757">lock</span>&nbsp;<span class="op" id="1843762">*</span><span class="ident" id="1843763">mutex</span><span class="op" id="1843768">,</span>&nbsp;<span class="ident" id="1843770">reason</span>&nbsp;<span class="builtintype" id="1843777">string</span><span class="op" id="1843783">)</span>&nbsp;<span class="op" id="1843785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843788">gopark</span><span class="op" id="1843794">(</span><span class="ident" id="1843795">unsafe</span><span class="op" id="1843801">.</span><span class="ident" id="1843802">Pointer</span><span class="op" id="1843809">(</span><span class="op" id="1843810">&amp;</span><span class="ident" id="1843811">parkunlock_c</span><span class="op" id="1843823">)</span><span class="op" id="1843824">,</span>&nbsp;<span class="ident" id="1843826">unsafe</span><span class="op" id="1843832">.</span><span class="ident" id="1843833">Pointer</span><span class="op" id="1843840">(</span><span class="ident" id="1843841">lock</span><span class="op" id="1843845">)</span><span class="op" id="1843846">,</span>&nbsp;<span class="ident" id="1843848">reason</span><span class="op" id="1843854">)</span><br>
<span class="lineno"></span><span class="op" id="1843856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1843859">func</span>&nbsp;<span class="ident" id="1843864">goready</span><span class="op" id="1843871">(</span><span class="ident" id="1843872">gp</span>&nbsp;<span class="op" id="1843875">*</span><span class="ident" id="1843876">g</span><span class="op" id="1843877">)</span>&nbsp;<span class="op" id="1843879">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843882">mp</span>&nbsp;<span class="op" id="1843885">:=</span>&nbsp;<span class="ident" id="1843888">acquirem</span><span class="op" id="1843896">(</span><span class="op" id="1843897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843900">mp</span><span class="op" id="1843902">.</span><span class="ident" id="1843903">ptrarg</span><span class="op" id="1843909">[</span><span class="num" id="1843910">0</span><span class="op" id="1843911">]</span>&nbsp;<span class="op" id="1843913">=</span>&nbsp;<span class="ident" id="1843915">unsafe</span><span class="op" id="1843921">.</span><span class="ident" id="1843922">Pointer</span><span class="op" id="1843929">(</span><span class="ident" id="1843930">gp</span><span class="op" id="1843932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843935">onM</span><span class="op" id="1843938">(</span><span class="ident" id="1843939">ready_m</span><span class="op" id="1843946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1843949">releasem</span><span class="op" id="1843957">(</span><span class="ident" id="1843958">mp</span><span class="op" id="1843960">)</span><br>
<span class="lineno"></span><span class="op" id="1843962">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1843965">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1843978">func</span>&nbsp;<span class="ident" id="1843983">acquireSudog</span><span class="op" id="1843995">(</span><span class="op" id="1843996">)</span>&nbsp;<span class="op" id="1843998">*</span><span class="ident" id="1843999">sudog</span>&nbsp;<span class="op" id="1844005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844008">c</span>&nbsp;<span class="op" id="1844010">:=</span>&nbsp;<span class="ident" id="1844013">gomcache</span><span class="op" id="1844021">(</span><span class="op" id="1844022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844025">s</span>&nbsp;<span class="op" id="1844027">:=</span>&nbsp;<span class="ident" id="1844030">c</span><span class="op" id="1844031">.</span><span class="ident" id="1844032">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844044">if</span>&nbsp;<span class="ident" id="1844047">s</span>&nbsp;<span class="op" id="1844049">!=</span>&nbsp;<span class="ident" id="1844052">nil</span>&nbsp;<span class="op" id="1844056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844060">if</span>&nbsp;<span class="ident" id="1844063">s</span><span class="op" id="1844064">.</span><span class="ident" id="1844065">elem</span>&nbsp;<span class="op" id="1844070">!=</span>&nbsp;<span class="ident" id="1844073">nil</span>&nbsp;<span class="op" id="1844077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844082">gothrow</span><span class="op" id="1844089">(</span><span class="string" id="1844090">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1844134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844142">c</span><span class="op" id="1844143">.</span><span class="ident" id="1844144">sudogcache</span>&nbsp;<span class="op" id="1844155">=</span>&nbsp;<span class="ident" id="1844157">s</span><span class="op" id="1844158">.</span><span class="ident" id="1844159">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844166">s</span><span class="op" id="1844167">.</span><span class="ident" id="1844168">next</span>&nbsp;<span class="op" id="1844173">=</span>&nbsp;<span class="ident" id="1844175">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844181">return</span>&nbsp;<span class="ident" id="1844188">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844195">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844250">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844299">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844360">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844425">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844446">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844512">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1844576">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844634">mp</span>&nbsp;<span class="op" id="1844637">:=</span>&nbsp;<span class="ident" id="1844640">acquirem</span><span class="op" id="1844648">(</span><span class="op" id="1844649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844652">p</span>&nbsp;<span class="op" id="1844654">:=</span>&nbsp;<span class="builtinfunc" id="1844657">new</span><span class="op" id="1844660">(</span><span class="ident" id="1844661">sudog</span><span class="op" id="1844666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844669">releasem</span><span class="op" id="1844677">(</span><span class="ident" id="1844678">mp</span><span class="op" id="1844680">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844683">return</span>&nbsp;<span class="ident" id="1844690">p</span><br>
<span class="lineno"></span><span class="op" id="1844692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1844695">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1844708">func</span>&nbsp;<span class="ident" id="1844713">releaseSudog</span><span class="op" id="1844725">(</span><span class="ident" id="1844726">s</span>&nbsp;<span class="op" id="1844728">*</span><span class="ident" id="1844729">sudog</span><span class="op" id="1844734">)</span>&nbsp;<span class="op" id="1844736">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844739">if</span>&nbsp;<span class="ident" id="1844742">s</span><span class="op" id="1844743">.</span><span class="ident" id="1844744">elem</span>&nbsp;<span class="op" id="1844749">!=</span>&nbsp;<span class="ident" id="1844752">nil</span>&nbsp;<span class="op" id="1844756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844760">gothrow</span><span class="op" id="1844767">(</span><span class="string" id="1844768">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1844802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844808">if</span>&nbsp;<span class="ident" id="1844811">s</span><span class="op" id="1844812">.</span><span class="ident" id="1844813">selectdone</span>&nbsp;<span class="op" id="1844824">!=</span>&nbsp;<span class="ident" id="1844827">nil</span>&nbsp;<span class="op" id="1844831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844835">gothrow</span><span class="op" id="1844842">(</span><span class="string" id="1844843">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1844883">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844889">if</span>&nbsp;<span class="ident" id="1844892">s</span><span class="op" id="1844893">.</span><span class="ident" id="1844894">next</span>&nbsp;<span class="op" id="1844899">!=</span>&nbsp;<span class="ident" id="1844902">nil</span>&nbsp;<span class="op" id="1844906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844910">gothrow</span><span class="op" id="1844917">(</span><span class="string" id="1844918">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1844952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1844955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1844958">if</span>&nbsp;<span class="ident" id="1844961">s</span><span class="op" id="1844962">.</span><span class="ident" id="1844963">prev</span>&nbsp;<span class="op" id="1844968">!=</span>&nbsp;<span class="ident" id="1844971">nil</span>&nbsp;<span class="op" id="1844975">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1844979">gothrow</span><span class="op" id="1844986">(</span><span class="string" id="1844987">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1845021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1845024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845027">if</span>&nbsp;<span class="ident" id="1845030">s</span><span class="op" id="1845031">.</span><span class="ident" id="1845032">waitlink</span>&nbsp;<span class="op" id="1845041">!=</span>&nbsp;<span class="ident" id="1845044">nil</span>&nbsp;<span class="op" id="1845048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845052">gothrow</span><span class="op" id="1845059">(</span><span class="string" id="1845060">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1845098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1845101">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845104">gp</span>&nbsp;<span class="op" id="1845107">:=</span>&nbsp;<span class="ident" id="1845110">getg</span><span class="op" id="1845114">(</span><span class="op" id="1845115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845118">if</span>&nbsp;<span class="ident" id="1845121">gp</span><span class="op" id="1845123">.</span><span class="ident" id="1845124">param</span>&nbsp;<span class="op" id="1845130">!=</span>&nbsp;<span class="ident" id="1845133">nil</span>&nbsp;<span class="op" id="1845137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845141">gothrow</span><span class="op" id="1845148">(</span><span class="string" id="1845149">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1845194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1845197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845200">c</span>&nbsp;<span class="op" id="1845202">:=</span>&nbsp;<span class="ident" id="1845205">gomcache</span><span class="op" id="1845213">(</span><span class="op" id="1845214">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845217">s</span><span class="op" id="1845218">.</span><span class="ident" id="1845219">next</span>&nbsp;<span class="op" id="1845224">=</span>&nbsp;<span class="ident" id="1845226">c</span><span class="op" id="1845227">.</span><span class="ident" id="1845228">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845240">c</span><span class="op" id="1845241">.</span><span class="ident" id="1845242">sudogcache</span>&nbsp;<span class="op" id="1845253">=</span>&nbsp;<span class="ident" id="1845255">s</span><br>
<span class="lineno"></span><span class="op" id="1845257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1845260">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1845310">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1845385">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1845398">func</span>&nbsp;<span class="ident" id="1845403">funcPC</span><span class="op" id="1845409">(</span><span class="ident" id="1845410">f</span>&nbsp;<span class="keyword" id="1845412">interface</span><span class="op" id="1845421">{</span><span class="op" id="1845422">}</span><span class="op" id="1845423">)</span>&nbsp;<span class="builtintype" id="1845425">uintptr</span>&nbsp;<span class="op" id="1845433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845436">return</span>&nbsp;<span class="op" id="1845443">*</span><span class="op" id="1845444">*</span><span class="op" id="1845445">(</span><span class="op" id="1845446">*</span><span class="op" id="1845447">*</span><span class="builtintype" id="1845448">uintptr</span><span class="op" id="1845455">)</span><span class="op" id="1845456">(</span><span class="ident" id="1845457">add</span><span class="op" id="1845460">(</span><span class="ident" id="1845461">unsafe</span><span class="op" id="1845467">.</span><span class="ident" id="1845468">Pointer</span><span class="op" id="1845475">(</span><span class="op" id="1845476">&amp;</span><span class="ident" id="1845477">f</span><span class="op" id="1845478">)</span><span class="op" id="1845479">,</span>&nbsp;<span class="ident" id="1845481">ptrSize</span><span class="op" id="1845488">)</span><span class="op" id="1845489">)</span><br>
<span class="lineno"></span><span class="op" id="1845491">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1845494">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1845518">func</span>&nbsp;<span class="ident" id="1845523">badmcall</span><span class="op" id="1845531">(</span><span class="ident" id="1845532">fn</span>&nbsp;<span class="keyword" id="1845535">func</span><span class="op" id="1845539">(</span><span class="op" id="1845540">*</span><span class="ident" id="1845541">g</span><span class="op" id="1845542">)</span><span class="op" id="1845543">)</span>&nbsp;<span class="op" id="1845545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845548">gothrow</span><span class="op" id="1845555">(</span><span class="string" id="1845556">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1845594">)</span><br>
<span class="lineno"></span><span class="op" id="1845596">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1845599">func</span>&nbsp;<span class="ident" id="1845604">badmcall2</span><span class="op" id="1845613">(</span><span class="ident" id="1845614">fn</span>&nbsp;<span class="keyword" id="1845617">func</span><span class="op" id="1845621">(</span><span class="op" id="1845622">*</span><span class="ident" id="1845623">g</span><span class="op" id="1845624">)</span><span class="op" id="1845625">)</span>&nbsp;<span class="op" id="1845627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845630">gothrow</span><span class="op" id="1845637">(</span><span class="string" id="1845638">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1845672">)</span><br>
<span class="lineno"></span><span class="op" id="1845674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1845677">func</span>&nbsp;<span class="ident" id="1845682">badreflectcall</span><span class="op" id="1845696">(</span><span class="op" id="1845697">)</span>&nbsp;<span class="op" id="1845699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1845702">panic</span><span class="op" id="1845707">(</span><span class="string" id="1845708">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1845757">)</span><br>
<span class="lineno"></span><span class="op" id="1845759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1845762">func</span>&nbsp;<span class="ident" id="1845767">lockedOSThread</span><span class="op" id="1845781">(</span><span class="op" id="1845782">)</span>&nbsp;<span class="builtintype" id="1845784">bool</span>&nbsp;<span class="op" id="1845789">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1845792">gp</span>&nbsp;<span class="op" id="1845795">:=</span>&nbsp;<span class="ident" id="1845798">getg</span><span class="op" id="1845802">(</span><span class="op" id="1845803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845806">return</span>&nbsp;<span class="ident" id="1845813">gp</span><span class="op" id="1845815">.</span><span class="ident" id="1845816">lockedm</span>&nbsp;<span class="op" id="1845824">!=</span>&nbsp;<span class="ident" id="1845827">nil</span>&nbsp;<span class="op" id="1845831">&amp;&amp;</span>&nbsp;<span class="ident" id="1845834">gp</span><span class="op" id="1845836">.</span><span class="ident" id="1845837">m</span><span class="op" id="1845838">.</span><span class="ident" id="1845839">lockedg</span>&nbsp;<span class="op" id="1845847">!=</span>&nbsp;<span class="ident" id="1845850">nil</span><br>
<span class="lineno"></span><span class="op" id="1845854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1845857">func</span>&nbsp;<span class="ident" id="1845862">newP</span><span class="op" id="1845866">(</span><span class="op" id="1845867">)</span>&nbsp;<span class="op" id="1845869">*</span><span class="ident" id="1845870">p</span>&nbsp;<span class="op" id="1845872">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845875">return</span>&nbsp;<span class="builtinfunc" id="1845882">new</span><span class="op" id="1845885">(</span><span class="ident" id="1845886">p</span><span class="op" id="1845887">)</span><br>
<span class="lineno"></span><span class="op" id="1845889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1845892">func</span>&nbsp;<span class="ident" id="1845897">newM</span><span class="op" id="1845901">(</span><span class="op" id="1845902">)</span>&nbsp;<span class="op" id="1845904">*</span><span class="ident" id="1845905">m</span>&nbsp;<span class="op" id="1845907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845910">return</span>&nbsp;<span class="builtinfunc" id="1845917">new</span><span class="op" id="1845920">(</span><span class="ident" id="1845921">m</span><span class="op" id="1845922">)</span><br>
<span class="lineno">230</span><span class="op" id="1845924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1845927">func</span>&nbsp;<span class="ident" id="1845932">newG</span><span class="op" id="1845936">(</span><span class="op" id="1845937">)</span>&nbsp;<span class="op" id="1845939">*</span><span class="ident" id="1845940">g</span>&nbsp;<span class="op" id="1845942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845945">return</span>&nbsp;<span class="builtinfunc" id="1845952">new</span><span class="op" id="1845955">(</span><span class="ident" id="1845956">g</span><span class="op" id="1845957">)</span><br>
<span class="lineno"></span><span class="op" id="1845959">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1845962">func</span>&nbsp;<span class="ident" id="1845967">allgadd</span><span class="op" id="1845974">(</span><span class="ident" id="1845975">gp</span>&nbsp;<span class="op" id="1845978">*</span><span class="ident" id="1845979">g</span><span class="op" id="1845980">)</span>&nbsp;<span class="op" id="1845982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1845985">if</span>&nbsp;<span class="ident" id="1845988">readgstatus</span><span class="op" id="1845999">(</span><span class="ident" id="1846000">gp</span><span class="op" id="1846002">)</span>&nbsp;<span class="op" id="1846004">==</span>&nbsp;<span class="ident" id="1846007">_Gidle</span>&nbsp;<span class="op" id="1846014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846018">gothrow</span><span class="op" id="1846025">(</span><span class="string" id="1846026">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1846053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1846056">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846060">lock</span><span class="op" id="1846064">(</span><span class="op" id="1846065">&amp;</span><span class="ident" id="1846066">allglock</span><span class="op" id="1846074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846077">allgs</span>&nbsp;<span class="op" id="1846083">=</span>&nbsp;<span class="builtinfunc" id="1846085">append</span><span class="op" id="1846091">(</span><span class="ident" id="1846092">allgs</span><span class="op" id="1846097">,</span>&nbsp;<span class="ident" id="1846099">gp</span><span class="op" id="1846101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846104">allg</span>&nbsp;<span class="op" id="1846109">=</span>&nbsp;<span class="op" id="1846111">&amp;</span><span class="ident" id="1846112">allgs</span><span class="op" id="1846117">[</span><span class="num" id="1846118">0</span><span class="op" id="1846119">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846122">allglen</span>&nbsp;<span class="op" id="1846130">=</span>&nbsp;<span class="builtintype" id="1846132">uintptr</span><span class="op" id="1846139">(</span><span class="builtinfunc" id="1846140">len</span><span class="op" id="1846143">(</span><span class="ident" id="1846144">allgs</span><span class="op" id="1846149">)</span><span class="op" id="1846150">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1846153">unlock</span><span class="op" id="1846159">(</span><span class="op" id="1846160">&amp;</span><span class="ident" id="1846161">allglock</span><span class="op" id="1846169">)</span><br>
<span class="lineno"></span><span class="op" id="1846171">}</span>
</div>
</body>
</html>
