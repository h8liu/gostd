<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6328128">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6328183">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6328237">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6328288">package</span>&nbsp;<span class="ident" id="6328296">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6328302">import</span>&nbsp;<span class="op" id="6328309">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6328312">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6328327">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6328341">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6328351">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6328357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6328360">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6328420">type</span>&nbsp;<span class="ident" id="6328425">Auth</span>&nbsp;<span class="keyword" id="6328430">interface</span>&nbsp;<span class="op" id="6328440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328443">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328493">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328548">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328611">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328673">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328720">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328778">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328836">Start</span><span class="op" id="6328841">(</span><span class="ident" id="6328842">server</span>&nbsp;<span class="op" id="6328849">*</span><span class="ident" id="6328850"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="6328860">)</span>&nbsp;<span class="op" id="6328862">(</span><span class="ident" id="6328863">proto</span>&nbsp;<span class="builtintype" id="6328869">string</span><span class="op" id="6328875">,</span>&nbsp;<span class="ident" id="6328877">toServer</span>&nbsp;<span class="op" id="6328886">[</span><span class="op" id="6328887">]</span><span class="builtintype" id="6328888">byte</span><span class="op" id="6328892">,</span>&nbsp;<span class="ident" id="6328894">err</span>&nbsp;<span class="builtintype" id="6328898">error</span><span class="op" id="6328903">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328907">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328971">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329034">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329096">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329136">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329196">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329254">Next</span><span class="op" id="6329258">(</span><span class="ident" id="6329259">fromServer</span>&nbsp;<span class="op" id="6329270">[</span><span class="op" id="6329271">]</span><span class="builtintype" id="6329272">byte</span><span class="op" id="6329276">,</span>&nbsp;<span class="ident" id="6329278">more</span>&nbsp;<span class="builtintype" id="6329283">bool</span><span class="op" id="6329287">)</span>&nbsp;<span class="op" id="6329289">(</span><span class="ident" id="6329290">toServer</span>&nbsp;<span class="op" id="6329299">[</span><span class="op" id="6329300">]</span><span class="builtintype" id="6329301">byte</span><span class="op" id="6329305">,</span>&nbsp;<span class="ident" id="6329307">err</span>&nbsp;<span class="builtintype" id="6329311">error</span><span class="op" id="6329316">)</span><br>
<span class="lineno"></span><span class="op" id="6329318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6329321">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6329377">type</span>&nbsp;<span class="ident" id="6329382">ServerInfo</span>&nbsp;<span class="keyword" id="6329393">struct</span>&nbsp;<span class="op" id="6329400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329403">Name</span>&nbsp;<span class="builtintype" id="6329408">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6329417">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329438">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6329443">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6329452">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329499">Auth</span>&nbsp;<span class="op" id="6329504">[</span><span class="op" id="6329505">]</span><span class="builtintype" id="6329506">string</span>&nbsp;<span class="comment" id="6329513">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6329553">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6329556">type</span>&nbsp;<span class="ident" id="6329561">plainAuth</span>&nbsp;<span class="keyword" id="6329571">struct</span>&nbsp;<span class="op" id="6329578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329581">identity</span><span class="op" id="6329589">,</span>&nbsp;<span class="ident" id="6329591">username</span><span class="op" id="6329599">,</span>&nbsp;<span class="ident" id="6329601">password</span>&nbsp;<span class="builtintype" id="6329610">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329618">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6329647">string</span><br>
<span class="lineno"></span><span class="op" id="6329654">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6329657">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6329727">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6329764">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6329838">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6329914">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6329948">func</span>&nbsp;<span class="ident" id="6329953">PlainAuth</span><span class="op" id="6329962">(</span><span class="ident" id="6329963">identity</span><span class="op" id="6329971">,</span>&nbsp;<span class="ident" id="6329973">username</span><span class="op" id="6329981">,</span>&nbsp;<span class="ident" id="6329983">password</span><span class="op" id="6329991">,</span>&nbsp;<span class="ident" id="6329993">host</span>&nbsp;<span class="builtintype" id="6329998">string</span><span class="op" id="6330004">)</span>&nbsp;<span class="ident" id="6330006"><a href="/net/smtp/auth.go.html#6328425">Auth</a></span>&nbsp;<span class="op" id="6330011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330014">return</span>&nbsp;<span class="op" id="6330021">&amp;</span><span class="ident" id="6330022"><a href="/net/smtp/auth.go.html#6329561">plainAuth</a></span><span class="op" id="6330031">{</span><span class="ident" id="6330032"><a href="/net/smtp/auth.go.html#6329963">identity</a></span><span class="op" id="6330040">,</span>&nbsp;<span class="ident" id="6330042"><a href="/net/smtp/auth.go.html#6329973">username</a></span><span class="op" id="6330050">,</span>&nbsp;<span class="ident" id="6330052"><a href="/net/smtp/auth.go.html#6329983">password</a></span><span class="op" id="6330060">,</span>&nbsp;<span class="ident" id="6330062"><a href="/net/smtp/auth.go.html#6329993">host</a></span><span class="op" id="6330066">}</span><br>
<span class="lineno"></span><span class="op" id="6330068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6330071">func</span>&nbsp;<span class="op" id="6330076">(</span><span class="ident" id="6330077">a</span>&nbsp;<span class="op" id="6330079">*</span><span class="ident" id="6330080"><a href="/net/smtp/auth.go.html#6329561">plainAuth</a></span><span class="op" id="6330089">)</span>&nbsp;<span class="ident" id="6330091">Start</span><span class="op" id="6330096">(</span><span class="ident" id="6330097">server</span>&nbsp;<span class="op" id="6330104">*</span><span class="ident" id="6330105"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="6330115">)</span>&nbsp;<span class="op" id="6330117">(</span><span class="builtintype" id="6330118">string</span><span class="op" id="6330124">,</span>&nbsp;<span class="op" id="6330126">[</span><span class="op" id="6330127">]</span><span class="builtintype" id="6330128">byte</span><span class="op" id="6330132">,</span>&nbsp;<span class="builtintype" id="6330134">error</span><span class="op" id="6330139">)</span>&nbsp;<span class="op" id="6330141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330144">if</span>&nbsp;<span class="op" id="6330147">!</span><span class="ident" id="6330148"><a href="/net/smtp/auth.go.html#6330097">server</a></span><span class="op" id="6330154">.</span><span class="ident" id="6330155">TLS</span>&nbsp;<span class="op" id="6330159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330163">advertised</span>&nbsp;<span class="op" id="6330174">:=</span>&nbsp;<span class="builtintype" id="6330177">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330185">for</span>&nbsp;<span class="ident" id="6330189">_</span><span class="op" id="6330190">,</span>&nbsp;<span class="ident" id="6330192">mechanism</span>&nbsp;<span class="op" id="6330202">:=</span>&nbsp;<span class="keyword" id="6330205">range</span>&nbsp;<span class="ident" id="6330211"><a href="/net/smtp/auth.go.html#6330097">server</a></span><span class="op" id="6330217">.</span><span class="ident" id="6330218">Auth</span>&nbsp;<span class="op" id="6330223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330228">if</span>&nbsp;<span class="ident" id="6330231"><a href="/net/smtp/auth.go.html#6330192">mechanism</a></span>&nbsp;<span class="op" id="6330241">==</span>&nbsp;<span class="string" id="6330244">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6330252">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330258"><a href="/net/smtp/auth.go.html#6330163">advertised</a></span>&nbsp;<span class="op" id="6330269">=</span>&nbsp;<span class="builtintype" id="6330271">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330280">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330289">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330297">if</span>&nbsp;<span class="op" id="6330300">!</span><span class="ident" id="6330301"><a href="/net/smtp/auth.go.html#6330163">advertised</a></span>&nbsp;<span class="op" id="6330312">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330317">return</span>&nbsp;<span class="string" id="6330324">&#34;&#34;</span><span class="op" id="6330326">,</span>&nbsp;<span class="ident" id="6330328">nil</span><span class="op" id="6330331">,</span>&nbsp;<span class="ident" id="6330333"><a href="/net/smtp/auth.go.html#6328341">errors</a></span><span class="op" id="6330339">.</span><span class="ident" id="6330340">New</span><span class="op" id="6330343">(</span><span class="string" id="6330344">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6330368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330378">if</span>&nbsp;<span class="ident" id="6330381"><a href="/net/smtp/auth.go.html#6330097">server</a></span><span class="op" id="6330387">.</span><span class="ident" id="6330388">Name</span>&nbsp;<span class="op" id="6330393">!=</span>&nbsp;<span class="ident" id="6330396"><a href="/net/smtp/auth.go.html#6330077">a</a></span><span class="op" id="6330397">.</span><span class="ident" id="6330398">host</span>&nbsp;<span class="op" id="6330403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330407">return</span>&nbsp;<span class="string" id="6330414">&#34;&#34;</span><span class="op" id="6330416">,</span>&nbsp;<span class="ident" id="6330418">nil</span><span class="op" id="6330421">,</span>&nbsp;<span class="ident" id="6330423"><a href="/net/smtp/auth.go.html#6328341">errors</a></span><span class="op" id="6330429">.</span><span class="ident" id="6330430">New</span><span class="op" id="6330433">(</span><span class="string" id="6330434">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6330451">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330457">resp</span>&nbsp;<span class="op" id="6330462">:=</span>&nbsp;<span class="op" id="6330465">[</span><span class="op" id="6330466">]</span><span class="builtintype" id="6330467">byte</span><span class="op" id="6330471">(</span><span class="ident" id="6330472"><a href="/net/smtp/auth.go.html#6330077">a</a></span><span class="op" id="6330473">.</span><span class="ident" id="6330474">identity</span>&nbsp;<span class="op" id="6330483">+</span>&nbsp;<span class="string" id="6330485">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6330492">+</span>&nbsp;<span class="ident" id="6330494"><a href="/net/smtp/auth.go.html#6330077">a</a></span><span class="op" id="6330495">.</span><span class="ident" id="6330496">username</span>&nbsp;<span class="op" id="6330505">+</span>&nbsp;<span class="string" id="6330507">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6330514">+</span>&nbsp;<span class="ident" id="6330516"><a href="/net/smtp/auth.go.html#6330077">a</a></span><span class="op" id="6330517">.</span><span class="ident" id="6330518">password</span><span class="op" id="6330526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330529">return</span>&nbsp;<span class="string" id="6330536">&#34;PLAIN&#34;</span><span class="op" id="6330543">,</span>&nbsp;<span class="ident" id="6330545"><a href="/net/smtp/auth.go.html#6330457">resp</a></span><span class="op" id="6330549">,</span>&nbsp;<span class="ident" id="6330551">nil</span><br>
<span class="lineno"></span><span class="op" id="6330555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6330558">func</span>&nbsp;<span class="op" id="6330563">(</span><span class="ident" id="6330564">a</span>&nbsp;<span class="op" id="6330566">*</span><span class="ident" id="6330567"><a href="/net/smtp/auth.go.html#6329561">plainAuth</a></span><span class="op" id="6330576">)</span>&nbsp;<span class="ident" id="6330578">Next</span><span class="op" id="6330582">(</span><span class="ident" id="6330583">fromServer</span>&nbsp;<span class="op" id="6330594">[</span><span class="op" id="6330595">]</span><span class="builtintype" id="6330596">byte</span><span class="op" id="6330600">,</span>&nbsp;<span class="ident" id="6330602">more</span>&nbsp;<span class="builtintype" id="6330607">bool</span><span class="op" id="6330611">)</span>&nbsp;<span class="op" id="6330613">(</span><span class="op" id="6330614">[</span><span class="op" id="6330615">]</span><span class="builtintype" id="6330616">byte</span><span class="op" id="6330620">,</span>&nbsp;<span class="builtintype" id="6330622">error</span><span class="op" id="6330627">)</span>&nbsp;<span class="op" id="6330629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330632">if</span>&nbsp;<span class="ident" id="6330635"><a href="/net/smtp/auth.go.html#6330602">more</a></span>&nbsp;<span class="op" id="6330640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6330644">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330680">return</span>&nbsp;<span class="ident" id="6330687">nil</span><span class="op" id="6330690">,</span>&nbsp;<span class="ident" id="6330692"><a href="/net/smtp/auth.go.html#6328341">errors</a></span><span class="op" id="6330698">.</span><span class="ident" id="6330699">New</span><span class="op" id="6330702">(</span><span class="string" id="6330703">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6330732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330735">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330738">return</span>&nbsp;<span class="ident" id="6330745">nil</span><span class="op" id="6330748">,</span>&nbsp;<span class="ident" id="6330750">nil</span><br>
<span class="lineno"></span><span class="op" id="6330754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6330757">type</span>&nbsp;<span class="ident" id="6330762">cramMD5Auth</span>&nbsp;<span class="keyword" id="6330774">struct</span>&nbsp;<span class="op" id="6330781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330784">username</span><span class="op" id="6330792">,</span>&nbsp;<span class="ident" id="6330794">secret</span>&nbsp;<span class="builtintype" id="6330801">string</span><br>
<span class="lineno">85</span><span class="op" id="6330808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6330811">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6330886">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6330923">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6330995">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6331052">func</span>&nbsp;<span class="ident" id="6331057">CRAMMD5Auth</span><span class="op" id="6331068">(</span><span class="ident" id="6331069">username</span><span class="op" id="6331077">,</span>&nbsp;<span class="ident" id="6331079">secret</span>&nbsp;<span class="builtintype" id="6331086">string</span><span class="op" id="6331092">)</span>&nbsp;<span class="ident" id="6331094"><a href="/net/smtp/auth.go.html#6328425">Auth</a></span>&nbsp;<span class="op" id="6331099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331102">return</span>&nbsp;<span class="op" id="6331109">&amp;</span><span class="ident" id="6331110"><a href="/net/smtp/auth.go.html#6330762">cramMD5Auth</a></span><span class="op" id="6331121">{</span><span class="ident" id="6331122"><a href="/net/smtp/auth.go.html#6331069">username</a></span><span class="op" id="6331130">,</span>&nbsp;<span class="ident" id="6331132"><a href="/net/smtp/auth.go.html#6331079">secret</a></span><span class="op" id="6331138">}</span><br>
<span class="lineno"></span><span class="op" id="6331140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6331143">func</span>&nbsp;<span class="op" id="6331148">(</span><span class="ident" id="6331149">a</span>&nbsp;<span class="op" id="6331151">*</span><span class="ident" id="6331152"><a href="/net/smtp/auth.go.html#6330762">cramMD5Auth</a></span><span class="op" id="6331163">)</span>&nbsp;<span class="ident" id="6331165">Start</span><span class="op" id="6331170">(</span><span class="ident" id="6331171">server</span>&nbsp;<span class="op" id="6331178">*</span><span class="ident" id="6331179"><a href="/net/smtp/auth.go.html#6329382">ServerInfo</a></span><span class="op" id="6331189">)</span>&nbsp;<span class="op" id="6331191">(</span><span class="builtintype" id="6331192">string</span><span class="op" id="6331198">,</span>&nbsp;<span class="op" id="6331200">[</span><span class="op" id="6331201">]</span><span class="builtintype" id="6331202">byte</span><span class="op" id="6331206">,</span>&nbsp;<span class="builtintype" id="6331208">error</span><span class="op" id="6331213">)</span>&nbsp;<span class="op" id="6331215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331218">return</span>&nbsp;<span class="string" id="6331225">&#34;CRAM-MD5&#34;</span><span class="op" id="6331235">,</span>&nbsp;<span class="ident" id="6331237">nil</span><span class="op" id="6331240">,</span>&nbsp;<span class="ident" id="6331242">nil</span><br>
<span class="lineno"></span><span class="op" id="6331246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331249">func</span>&nbsp;<span class="op" id="6331254">(</span><span class="ident" id="6331255">a</span>&nbsp;<span class="op" id="6331257">*</span><span class="ident" id="6331258"><a href="/net/smtp/auth.go.html#6330762">cramMD5Auth</a></span><span class="op" id="6331269">)</span>&nbsp;<span class="ident" id="6331271">Next</span><span class="op" id="6331275">(</span><span class="ident" id="6331276">fromServer</span>&nbsp;<span class="op" id="6331287">[</span><span class="op" id="6331288">]</span><span class="builtintype" id="6331289">byte</span><span class="op" id="6331293">,</span>&nbsp;<span class="ident" id="6331295">more</span>&nbsp;<span class="builtintype" id="6331300">bool</span><span class="op" id="6331304">)</span>&nbsp;<span class="op" id="6331306">(</span><span class="op" id="6331307">[</span><span class="op" id="6331308">]</span><span class="builtintype" id="6331309">byte</span><span class="op" id="6331313">,</span>&nbsp;<span class="builtintype" id="6331315">error</span><span class="op" id="6331320">)</span>&nbsp;<span class="op" id="6331322">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331325">if</span>&nbsp;<span class="ident" id="6331328"><a href="/net/smtp/auth.go.html#6331295">more</a></span>&nbsp;<span class="op" id="6331333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331337">d</span>&nbsp;<span class="op" id="6331339">:=</span>&nbsp;<span class="ident" id="6331342"><a href="/net/smtp/auth.go.html#6328312">hmac</a></span><span class="op" id="6331346">.</span><span class="ident" id="6331347">New</span><span class="op" id="6331350">(</span><span class="ident" id="6331351"><a href="/net/smtp/auth.go.html#6328327">md5</a></span><span class="op" id="6331354">.</span><span class="ident" id="6331355">New</span><span class="op" id="6331358">,</span>&nbsp;<span class="op" id="6331360">[</span><span class="op" id="6331361">]</span><span class="builtintype" id="6331362">byte</span><span class="op" id="6331366">(</span><span class="ident" id="6331367"><a href="/net/smtp/auth.go.html#6331255">a</a></span><span class="op" id="6331368">.</span><span class="ident" id="6331369">secret</span><span class="op" id="6331375">)</span><span class="op" id="6331376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331380"><a href="/net/smtp/auth.go.html#6331337">d</a></span><span class="op" id="6331381">.</span><span class="ident" id="6331382">Write</span><span class="op" id="6331387">(</span><span class="ident" id="6331388"><a href="/net/smtp/auth.go.html#6331276">fromServer</a></span><span class="op" id="6331398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6331402">s</span>&nbsp;<span class="op" id="6331404">:=</span>&nbsp;<span class="builtinfunc" id="6331407">make</span><span class="op" id="6331411">(</span><span class="op" id="6331412">[</span><span class="op" id="6331413">]</span><span class="builtintype" id="6331414">byte</span><span class="op" id="6331418">,</span>&nbsp;<span class="num" id="6331420">0</span><span class="op" id="6331421">,</span>&nbsp;<span class="ident" id="6331423"><a href="/net/smtp/auth.go.html#6331337">d</a></span><span class="op" id="6331424">.</span><span class="ident" id="6331425">Size</span><span class="op" id="6331429">(</span><span class="op" id="6331430">)</span><span class="op" id="6331431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331435">return</span>&nbsp;<span class="op" id="6331442">[</span><span class="op" id="6331443">]</span><span class="builtintype" id="6331444">byte</span><span class="op" id="6331448">(</span><span class="ident" id="6331449"><a href="/net/smtp/auth.go.html#6328351">fmt</a></span><span class="op" id="6331452">.</span><span class="ident" id="6331453">Sprintf</span><span class="op" id="6331460">(</span><span class="string" id="6331461">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6331468">,</span>&nbsp;<span class="ident" id="6331470"><a href="/net/smtp/auth.go.html#6331255">a</a></span><span class="op" id="6331471">.</span><span class="ident" id="6331472">username</span><span class="op" id="6331480">,</span>&nbsp;<span class="ident" id="6331482"><a href="/net/smtp/auth.go.html#6331337">d</a></span><span class="op" id="6331483">.</span><span class="ident" id="6331484">Sum</span><span class="op" id="6331487">(</span><span class="ident" id="6331488"><a href="/net/smtp/auth.go.html#6331402">s</a></span><span class="op" id="6331489">)</span><span class="op" id="6331490">)</span><span class="op" id="6331491">)</span><span class="op" id="6331492">,</span>&nbsp;<span class="ident" id="6331494">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6331499">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6331502">return</span>&nbsp;<span class="ident" id="6331509">nil</span><span class="op" id="6331512">,</span>&nbsp;<span class="ident" id="6331514">nil</span><br>
<span class="lineno"></span><span class="op" id="6331518">}</span>
</div>
</body>
</html>
