<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strconv</h2>
<ul>
<li><a href="/gostd/strconv/atob.go.html">atob.go</a></li>
<li><a href="/gostd/strconv/atob_test.go.html">atob_test.go</a></li>
<li><a href="/gostd/strconv/atof.go.html">atof.go</a></li>
<li><a href="/gostd/strconv/atof_test.go.html">atof_test.go</a></li>
<li><a href="/gostd/strconv/atoi.go.html">atoi.go</a></li>
<li><a href="/gostd/strconv/atoi_test.go.html">atoi_test.go</a></li>
<li><a href="/gostd/strconv/decimal.go.html">decimal.go</a></li>
<li><a href="/gostd/strconv/decimal_test.go.html">decimal_test.go</a></li>
<li><a href="/gostd/strconv/extfloat.go.html">extfloat.go</a></li>
<li><a href="/gostd/strconv/fp_test.go.html">fp_test.go</a></li>
<li><a href="/gostd/strconv/ftoa.go.html" class="current">ftoa.go</a></li>
<li><a href="/gostd/strconv/ftoa_test.go.html">ftoa_test.go</a></li>
<li><a href="/gostd/strconv/internal_test.go.html">internal_test.go</a></li>
<li><a href="/gostd/strconv/isprint.go.html">isprint.go</a></li>
<li><a href="/gostd/strconv/itoa.go.html">itoa.go</a></li>
<li><a href="/gostd/strconv/itoa_test.go.html">itoa_test.go</a></li>
<li><a href="/gostd/strconv/quote.go.html">quote.go</a></li>
<li><a href="/gostd/strconv/quote_example_test.go.html">quote_example_test.go</a></li>
<li><a href="/gostd/strconv/quote_test.go.html">quote_test.go</a></li>
<li><a href="/gostd/strconv/strconv_test.go.html">strconv_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2275350">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2275405">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2275459">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2275510">//&nbsp;Binary&nbsp;to&nbsp;decimal&nbsp;floating&nbsp;point&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="comment" id="2275558">//&nbsp;Algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2275572">//&nbsp;&nbsp;&nbsp;1)&nbsp;store&nbsp;mantissa&nbsp;in&nbsp;multiprecision&nbsp;decimal</span><br>
<span class="lineno"></span><span class="comment" id="2275621">//&nbsp;&nbsp;&nbsp;2)&nbsp;shift&nbsp;decimal&nbsp;by&nbsp;exponent</span><br>
<span class="lineno"></span><span class="comment" id="2275655">//&nbsp;&nbsp;&nbsp;3)&nbsp;read&nbsp;digits&nbsp;out&nbsp;&amp;&nbsp;format</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2275689">package</span>&nbsp;<span class="ident" id="2275697">strconv</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2275706">import</span>&nbsp;<span class="string" id="2275713">&#34;math&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2275721">//&nbsp;TODO:&nbsp;move&nbsp;elsewhere?</span><br>
<span class="lineno"></span><span class="keyword" id="2275746">type</span>&nbsp;<span class="ident" id="2275751">floatInfo</span>&nbsp;<span class="keyword" id="2275761">struct</span>&nbsp;<span class="op" id="2275768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275771">mantbits</span>&nbsp;<span class="builtintype" id="2275780">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275786">expbits</span>&nbsp;&nbsp;<span class="builtintype" id="2275795">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275801">bias</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2275810">int</span><br>
<span class="lineno">20</span><span class="op" id="2275814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2275817">var</span>&nbsp;<span class="ident" id="2275821">float32info</span>&nbsp;<span class="op" id="2275833">=</span>&nbsp;<span class="ident" id="2275835">floatInfo</span><span class="op" id="2275844">{</span><span class="num" id="2275845">23</span><span class="op" id="2275847">,</span>&nbsp;<span class="num" id="2275849">8</span><span class="op" id="2275850">,</span>&nbsp;<span class="op" id="2275852">-</span><span class="num" id="2275853">127</span><span class="op" id="2275856">}</span><br>
<span class="lineno"></span><span class="keyword" id="2275858">var</span>&nbsp;<span class="ident" id="2275862">float64info</span>&nbsp;<span class="op" id="2275874">=</span>&nbsp;<span class="ident" id="2275876">floatInfo</span><span class="op" id="2275885">{</span><span class="num" id="2275886">52</span><span class="op" id="2275888">,</span>&nbsp;<span class="num" id="2275890">11</span><span class="op" id="2275892">,</span>&nbsp;<span class="op" id="2275894">-</span><span class="num" id="2275895">1023</span><span class="op" id="2275899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2275902">//&nbsp;FormatFloat&nbsp;converts&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f&nbsp;to&nbsp;a&nbsp;string,</span><br>
<span class="lineno"></span><span class="comment" id="2275967">//&nbsp;according&nbsp;to&nbsp;the&nbsp;format&nbsp;fmt&nbsp;and&nbsp;precision&nbsp;prec.&nbsp;&nbsp;It&nbsp;rounds&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2276033">//&nbsp;result&nbsp;assuming&nbsp;that&nbsp;the&nbsp;original&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;floating-point</span><br>
<span class="lineno"></span><span class="comment" id="2276105">//&nbsp;value&nbsp;of&nbsp;bitSize&nbsp;bits&nbsp;(32&nbsp;for&nbsp;float32,&nbsp;64&nbsp;for&nbsp;float64).</span><br>
<span class="lineno"></span><span class="comment" id="2276164">//</span><br>
<span class="lineno">30</span><span class="comment" id="2276167">//&nbsp;The&nbsp;format&nbsp;fmt&nbsp;is&nbsp;one&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2276195">//&nbsp;&#39;b&#39;&nbsp;(-ddddp±ddd,&nbsp;a&nbsp;binary&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2276236">//&nbsp;&#39;e&#39;&nbsp;(-d.dddde±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2276279">//&nbsp;&#39;E&#39;&nbsp;(-d.ddddE±dd,&nbsp;a&nbsp;decimal&nbsp;exponent),</span><br>
<span class="lineno"></span><span class="comment" id="2276322">//&nbsp;&#39;f&#39;&nbsp;(-ddd.dddd,&nbsp;no&nbsp;exponent),</span><br>
<span class="lineno">35</span><span class="comment" id="2276355">//&nbsp;&#39;g&#39;&nbsp;(&#39;e&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2276407">//&nbsp;&#39;G&#39;&nbsp;(&#39;E&#39;&nbsp;for&nbsp;large&nbsp;exponents,&nbsp;&#39;f&#39;&nbsp;otherwise).</span><br>
<span class="lineno"></span><span class="comment" id="2276456">//</span><br>
<span class="lineno"></span><span class="comment" id="2276459">//&nbsp;The&nbsp;precision&nbsp;prec&nbsp;controls&nbsp;the&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2276511">//&nbsp;(excluding&nbsp;the&nbsp;exponent)&nbsp;printed&nbsp;by&nbsp;the&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;&#39;f&#39;,&nbsp;&#39;g&#39;,&nbsp;and&nbsp;&#39;G&#39;&nbsp;formats.</span><br>
<span class="lineno">40</span><span class="comment" id="2276591">//&nbsp;For&nbsp;&#39;e&#39;,&nbsp;&#39;E&#39;,&nbsp;and&nbsp;&#39;f&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;after&nbsp;the&nbsp;decimal&nbsp;point.</span><br>
<span class="lineno"></span><span class="comment" id="2276668">//&nbsp;For&nbsp;&#39;g&#39;&nbsp;and&nbsp;&#39;G&#39;&nbsp;it&nbsp;is&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2276721">//&nbsp;The&nbsp;special&nbsp;precision&nbsp;-1&nbsp;uses&nbsp;the&nbsp;smallest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2276784">//&nbsp;necessary&nbsp;such&nbsp;that&nbsp;ParseFloat&nbsp;will&nbsp;return&nbsp;f&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="keyword" id="2276841">func</span>&nbsp;<span class="ident" id="2276846">FormatFloat</span><span class="op" id="2276857">(</span><span class="ident" id="2276858">f</span>&nbsp;<span class="builtintype" id="2276860">float64</span><span class="op" id="2276867">,</span>&nbsp;<span class="ident" id="2276869">fmt</span>&nbsp;<span class="builtintype" id="2276873">byte</span><span class="op" id="2276877">,</span>&nbsp;<span class="ident" id="2276879">prec</span><span class="op" id="2276883">,</span>&nbsp;<span class="ident" id="2276885">bitSize</span>&nbsp;<span class="builtintype" id="2276893">int</span><span class="op" id="2276896">)</span>&nbsp;<span class="builtintype" id="2276898">string</span>&nbsp;<span class="op" id="2276905">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276908">return</span>&nbsp;<span class="builtintype" id="2276915">string</span><span class="op" id="2276921">(</span><span class="ident" id="2276922">genericFtoa</span><span class="op" id="2276933">(</span><span class="builtinfunc" id="2276934">make</span><span class="op" id="2276938">(</span><span class="op" id="2276939">[</span><span class="op" id="2276940">]</span><span class="builtintype" id="2276941">byte</span><span class="op" id="2276945">,</span>&nbsp;<span class="num" id="2276947">0</span><span class="op" id="2276948">,</span>&nbsp;<span class="ident" id="2276950">max</span><span class="op" id="2276953">(</span><span class="ident" id="2276954">prec</span><span class="op" id="2276958">+</span><span class="num" id="2276959">4</span><span class="op" id="2276960">,</span>&nbsp;<span class="num" id="2276962">24</span><span class="op" id="2276964">)</span><span class="op" id="2276965">)</span><span class="op" id="2276966">,</span>&nbsp;<span class="ident" id="2276968">f</span><span class="op" id="2276969">,</span>&nbsp;<span class="ident" id="2276971">fmt</span><span class="op" id="2276974">,</span>&nbsp;<span class="ident" id="2276976">prec</span><span class="op" id="2276980">,</span>&nbsp;<span class="ident" id="2276982">bitSize</span><span class="op" id="2276989">)</span><span class="op" id="2276990">)</span><br>
<span class="lineno"></span><span class="op" id="2276992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2276995">//&nbsp;AppendFloat&nbsp;appends&nbsp;the&nbsp;string&nbsp;form&nbsp;of&nbsp;the&nbsp;floating-point&nbsp;number&nbsp;f,</span><br>
<span class="lineno"></span><span class="comment" id="2277066">//&nbsp;as&nbsp;generated&nbsp;by&nbsp;FormatFloat,&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;extended&nbsp;buffer.</span><br>
<span class="lineno">50</span><span class="keyword" id="2277138">func</span>&nbsp;<span class="ident" id="2277143">AppendFloat</span><span class="op" id="2277154">(</span><span class="ident" id="2277155">dst</span>&nbsp;<span class="op" id="2277159">[</span><span class="op" id="2277160">]</span><span class="builtintype" id="2277161">byte</span><span class="op" id="2277165">,</span>&nbsp;<span class="ident" id="2277167">f</span>&nbsp;<span class="builtintype" id="2277169">float64</span><span class="op" id="2277176">,</span>&nbsp;<span class="ident" id="2277178">fmt</span>&nbsp;<span class="builtintype" id="2277182">byte</span><span class="op" id="2277186">,</span>&nbsp;<span class="ident" id="2277188">prec</span>&nbsp;<span class="builtintype" id="2277193">int</span><span class="op" id="2277196">,</span>&nbsp;<span class="ident" id="2277198">bitSize</span>&nbsp;<span class="builtintype" id="2277206">int</span><span class="op" id="2277209">)</span>&nbsp;<span class="op" id="2277211">[</span><span class="op" id="2277212">]</span><span class="builtintype" id="2277213">byte</span>&nbsp;<span class="op" id="2277218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277221">return</span>&nbsp;<span class="ident" id="2277228">genericFtoa</span><span class="op" id="2277239">(</span><span class="ident" id="2277240">dst</span><span class="op" id="2277243">,</span>&nbsp;<span class="ident" id="2277245">f</span><span class="op" id="2277246">,</span>&nbsp;<span class="ident" id="2277248">fmt</span><span class="op" id="2277251">,</span>&nbsp;<span class="ident" id="2277253">prec</span><span class="op" id="2277257">,</span>&nbsp;<span class="ident" id="2277259">bitSize</span><span class="op" id="2277266">)</span><br>
<span class="lineno"></span><span class="op" id="2277268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2277271">func</span>&nbsp;<span class="ident" id="2277276">genericFtoa</span><span class="op" id="2277287">(</span><span class="ident" id="2277288">dst</span>&nbsp;<span class="op" id="2277292">[</span><span class="op" id="2277293">]</span><span class="builtintype" id="2277294">byte</span><span class="op" id="2277298">,</span>&nbsp;<span class="ident" id="2277300">val</span>&nbsp;<span class="builtintype" id="2277304">float64</span><span class="op" id="2277311">,</span>&nbsp;<span class="ident" id="2277313">fmt</span>&nbsp;<span class="builtintype" id="2277317">byte</span><span class="op" id="2277321">,</span>&nbsp;<span class="ident" id="2277323">prec</span><span class="op" id="2277327">,</span>&nbsp;<span class="ident" id="2277329">bitSize</span>&nbsp;<span class="builtintype" id="2277337">int</span><span class="op" id="2277340">)</span>&nbsp;<span class="op" id="2277342">[</span><span class="op" id="2277343">]</span><span class="builtintype" id="2277344">byte</span>&nbsp;<span class="op" id="2277349">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277352">var</span>&nbsp;<span class="ident" id="2277356">bits</span>&nbsp;<span class="ident" id="2277361">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277369">var</span>&nbsp;<span class="ident" id="2277373">flt</span>&nbsp;<span class="op" id="2277377">*</span><span class="ident" id="2277378">floatInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277389">switch</span>&nbsp;<span class="ident" id="2277396">bitSize</span>&nbsp;<span class="op" id="2277404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277407">case</span>&nbsp;<span class="num" id="2277412">32</span><span class="op" id="2277414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277418">bits</span>&nbsp;<span class="op" id="2277423">=</span>&nbsp;<span class="ident" id="2277425">uint64</span><span class="op" id="2277431">(</span><span class="ident" id="2277432">math</span><span class="op" id="2277436">.</span><span class="ident" id="2277437">Float32bits</span><span class="op" id="2277448">(</span><span class="builtintype" id="2277449">float32</span><span class="op" id="2277456">(</span><span class="ident" id="2277457">val</span><span class="op" id="2277460">)</span><span class="op" id="2277461">)</span><span class="op" id="2277462">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277466">flt</span>&nbsp;<span class="op" id="2277470">=</span>&nbsp;<span class="op" id="2277472">&amp;</span><span class="ident" id="2277473">float32info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277486">case</span>&nbsp;<span class="num" id="2277491">64</span><span class="op" id="2277493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277497">bits</span>&nbsp;<span class="op" id="2277502">=</span>&nbsp;<span class="ident" id="2277504">math</span><span class="op" id="2277508">.</span><span class="ident" id="2277509">Float64bits</span><span class="op" id="2277520">(</span><span class="ident" id="2277521">val</span><span class="op" id="2277524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277528">flt</span>&nbsp;<span class="op" id="2277532">=</span>&nbsp;<span class="op" id="2277534">&amp;</span><span class="ident" id="2277535">float64info</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277548">default</span><span class="op" id="2277555">:</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2277559">panic</span><span class="op" id="2277564">(</span><span class="string" id="2277565">&#34;strconv:&nbsp;illegal&nbsp;AppendFloat/FormatFloat&nbsp;bitSize&#34;</span><span class="op" id="2277615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277622">neg</span>&nbsp;<span class="op" id="2277626">:=</span>&nbsp;<span class="ident" id="2277629">bits</span><span class="op" id="2277633">&gt;&gt;</span><span class="op" id="2277635">(</span><span class="ident" id="2277636">flt</span><span class="op" id="2277639">.</span><span class="ident" id="2277640">expbits</span><span class="op" id="2277647">+</span><span class="ident" id="2277648">flt</span><span class="op" id="2277651">.</span><span class="ident" id="2277652">mantbits</span><span class="op" id="2277660">)</span>&nbsp;<span class="op" id="2277662">!=</span>&nbsp;<span class="num" id="2277665">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277668">exp</span>&nbsp;<span class="op" id="2277672">:=</span>&nbsp;<span class="builtintype" id="2277675">int</span><span class="op" id="2277678">(</span><span class="ident" id="2277679">bits</span><span class="op" id="2277683">&gt;&gt;</span><span class="ident" id="2277685">flt</span><span class="op" id="2277688">.</span><span class="ident" id="2277689">mantbits</span><span class="op" id="2277697">)</span>&nbsp;<span class="op" id="2277699">&amp;</span>&nbsp;<span class="op" id="2277701">(</span><span class="num" id="2277702">1</span><span class="op" id="2277703">&lt;&lt;</span><span class="ident" id="2277705">flt</span><span class="op" id="2277708">.</span><span class="ident" id="2277709">expbits</span>&nbsp;<span class="op" id="2277717">-</span>&nbsp;<span class="num" id="2277719">1</span><span class="op" id="2277720">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277723">mant</span>&nbsp;<span class="op" id="2277728">:=</span>&nbsp;<span class="ident" id="2277731">bits</span>&nbsp;<span class="op" id="2277736">&amp;</span>&nbsp;<span class="op" id="2277738">(</span><span class="ident" id="2277739">uint64</span><span class="op" id="2277745">(</span><span class="num" id="2277746">1</span><span class="op" id="2277747">)</span><span class="op" id="2277748">&lt;&lt;</span><span class="ident" id="2277750">flt</span><span class="op" id="2277753">.</span><span class="ident" id="2277754">mantbits</span>&nbsp;<span class="op" id="2277763">-</span>&nbsp;<span class="num" id="2277765">1</span><span class="op" id="2277766">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277770">switch</span>&nbsp;<span class="ident" id="2277777">exp</span>&nbsp;<span class="op" id="2277781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277784">case</span>&nbsp;<span class="num" id="2277789">1</span><span class="op" id="2277790">&lt;&lt;</span><span class="ident" id="2277792">flt</span><span class="op" id="2277795">.</span><span class="ident" id="2277796">expbits</span>&nbsp;<span class="op" id="2277804">-</span>&nbsp;<span class="num" id="2277806">1</span><span class="op" id="2277807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277811">//&nbsp;Inf,&nbsp;NaN</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277825">var</span>&nbsp;<span class="ident" id="2277829">s</span>&nbsp;<span class="builtintype" id="2277831">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277840">switch</span>&nbsp;<span class="op" id="2277847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277851">case</span>&nbsp;<span class="ident" id="2277856">mant</span>&nbsp;<span class="op" id="2277861">!=</span>&nbsp;<span class="num" id="2277864">0</span><span class="op" id="2277865">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277870">s</span>&nbsp;<span class="op" id="2277872">=</span>&nbsp;<span class="string" id="2277874">&#34;NaN&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277882">case</span>&nbsp;<span class="ident" id="2277887">neg</span><span class="op" id="2277890">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277895">s</span>&nbsp;<span class="op" id="2277897">=</span>&nbsp;<span class="string" id="2277899">&#34;-Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277908">default</span><span class="op" id="2277915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277920">s</span>&nbsp;<span class="op" id="2277922">=</span>&nbsp;<span class="string" id="2277924">&#34;+Inf&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277937">return</span>&nbsp;<span class="builtinfunc" id="2277944">append</span><span class="op" id="2277950">(</span><span class="ident" id="2277951">dst</span><span class="op" id="2277954">,</span>&nbsp;<span class="ident" id="2277956">s</span><span class="op" id="2277957">...</span><span class="op" id="2277960">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277964">case</span>&nbsp;<span class="num" id="2277969">0</span><span class="op" id="2277970">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277974">//&nbsp;denormalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277992">exp</span><span class="op" id="2277995">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278000">default</span><span class="op" id="2278007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278011">//&nbsp;add&nbsp;implicit&nbsp;top&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278037">mant</span>&nbsp;<span class="op" id="2278042">|=</span>&nbsp;<span class="ident" id="2278045">uint64</span><span class="op" id="2278051">(</span><span class="num" id="2278052">1</span><span class="op" id="2278053">)</span>&nbsp;<span class="op" id="2278055">&lt;&lt;</span>&nbsp;<span class="ident" id="2278058">flt</span><span class="op" id="2278061">.</span><span class="ident" id="2278062">mantbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278075">exp</span>&nbsp;<span class="op" id="2278079">+=</span>&nbsp;<span class="ident" id="2278082">flt</span><span class="op" id="2278085">.</span><span class="ident" id="2278086">bias</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278093">//&nbsp;Pick&nbsp;off&nbsp;easy&nbsp;binary&nbsp;format.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278126">if</span>&nbsp;<span class="ident" id="2278129">fmt</span>&nbsp;<span class="op" id="2278133">==</span>&nbsp;<span class="string" id="2278136">&#39;b&#39;</span>&nbsp;<span class="op" id="2278140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278144">return</span>&nbsp;<span class="ident" id="2278151">fmtB</span><span class="op" id="2278155">(</span><span class="ident" id="2278156">dst</span><span class="op" id="2278159">,</span>&nbsp;<span class="ident" id="2278161">neg</span><span class="op" id="2278164">,</span>&nbsp;<span class="ident" id="2278166">mant</span><span class="op" id="2278170">,</span>&nbsp;<span class="ident" id="2278172">exp</span><span class="op" id="2278175">,</span>&nbsp;<span class="ident" id="2278177">flt</span><span class="op" id="2278180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278183">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278187">if</span>&nbsp;<span class="op" id="2278190">!</span><span class="ident" id="2278191">optimize</span>&nbsp;<span class="op" id="2278200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278204">return</span>&nbsp;<span class="ident" id="2278211">bigFtoa</span><span class="op" id="2278218">(</span><span class="ident" id="2278219">dst</span><span class="op" id="2278222">,</span>&nbsp;<span class="ident" id="2278224">prec</span><span class="op" id="2278228">,</span>&nbsp;<span class="ident" id="2278230">fmt</span><span class="op" id="2278233">,</span>&nbsp;<span class="ident" id="2278235">neg</span><span class="op" id="2278238">,</span>&nbsp;<span class="ident" id="2278240">mant</span><span class="op" id="2278244">,</span>&nbsp;<span class="ident" id="2278246">exp</span><span class="op" id="2278249">,</span>&nbsp;<span class="ident" id="2278251">flt</span><span class="op" id="2278254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278261">var</span>&nbsp;<span class="ident" id="2278265">digs</span>&nbsp;<span class="ident" id="2278270">decimalSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278284">ok</span>&nbsp;<span class="op" id="2278287">:=</span>&nbsp;<span class="builtintype" id="2278290">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278297">//&nbsp;Negative&nbsp;precision&nbsp;means&nbsp;&#34;only&nbsp;as&nbsp;much&nbsp;as&nbsp;needed&nbsp;to&nbsp;be&nbsp;exact.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278364">shortest</span>&nbsp;<span class="op" id="2278373">:=</span>&nbsp;<span class="ident" id="2278376">prec</span>&nbsp;<span class="op" id="2278381">&lt;</span>&nbsp;<span class="num" id="2278383">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278386">if</span>&nbsp;<span class="ident" id="2278389">shortest</span>&nbsp;<span class="op" id="2278398">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278402">//&nbsp;Try&nbsp;Grisu3&nbsp;algorithm.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278429">f</span>&nbsp;<span class="op" id="2278431">:=</span>&nbsp;<span class="builtinfunc" id="2278434">new</span><span class="op" id="2278437">(</span><span class="ident" id="2278438">extFloat</span><span class="op" id="2278446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278450">lower</span><span class="op" id="2278455">,</span>&nbsp;<span class="ident" id="2278457">upper</span>&nbsp;<span class="op" id="2278463">:=</span>&nbsp;<span class="ident" id="2278466">f</span><span class="op" id="2278467">.</span><span class="ident" id="2278468">AssignComputeBounds</span><span class="op" id="2278487">(</span><span class="ident" id="2278488">mant</span><span class="op" id="2278492">,</span>&nbsp;<span class="ident" id="2278494">exp</span><span class="op" id="2278497">,</span>&nbsp;<span class="ident" id="2278499">neg</span><span class="op" id="2278502">,</span>&nbsp;<span class="ident" id="2278504">flt</span><span class="op" id="2278507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278511">var</span>&nbsp;<span class="ident" id="2278515">buf</span>&nbsp;<span class="op" id="2278519">[</span><span class="num" id="2278520">32</span><span class="op" id="2278522">]</span><span class="builtintype" id="2278523">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278530">digs</span><span class="op" id="2278534">.</span><span class="ident" id="2278535">d</span>&nbsp;<span class="op" id="2278537">=</span>&nbsp;<span class="ident" id="2278539">buf</span><span class="op" id="2278542">[</span><span class="op" id="2278543">:</span><span class="op" id="2278544">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278548">ok</span>&nbsp;<span class="op" id="2278551">=</span>&nbsp;<span class="ident" id="2278553">f</span><span class="op" id="2278554">.</span><span class="ident" id="2278555">ShortestDecimal</span><span class="op" id="2278570">(</span><span class="op" id="2278571">&amp;</span><span class="ident" id="2278572">digs</span><span class="op" id="2278576">,</span>&nbsp;<span class="op" id="2278578">&amp;</span><span class="ident" id="2278579">lower</span><span class="op" id="2278584">,</span>&nbsp;<span class="op" id="2278586">&amp;</span><span class="ident" id="2278587">upper</span><span class="op" id="2278592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278596">if</span>&nbsp;<span class="op" id="2278599">!</span><span class="ident" id="2278600">ok</span>&nbsp;<span class="op" id="2278603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278608">return</span>&nbsp;<span class="ident" id="2278615">bigFtoa</span><span class="op" id="2278622">(</span><span class="ident" id="2278623">dst</span><span class="op" id="2278626">,</span>&nbsp;<span class="ident" id="2278628">prec</span><span class="op" id="2278632">,</span>&nbsp;<span class="ident" id="2278634">fmt</span><span class="op" id="2278637">,</span>&nbsp;<span class="ident" id="2278639">neg</span><span class="op" id="2278642">,</span>&nbsp;<span class="ident" id="2278644">mant</span><span class="op" id="2278648">,</span>&nbsp;<span class="ident" id="2278650">exp</span><span class="op" id="2278653">,</span>&nbsp;<span class="ident" id="2278655">flt</span><span class="op" id="2278658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278666">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278715">switch</span>&nbsp;<span class="ident" id="2278722">fmt</span>&nbsp;<span class="op" id="2278726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278730">case</span>&nbsp;<span class="string" id="2278735">&#39;e&#39;</span><span class="op" id="2278738">,</span>&nbsp;<span class="string" id="2278740">&#39;E&#39;</span><span class="op" id="2278743">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278748">prec</span>&nbsp;<span class="op" id="2278753">=</span>&nbsp;<span class="ident" id="2278755">digs</span><span class="op" id="2278759">.</span><span class="ident" id="2278760">nd</span>&nbsp;<span class="op" id="2278763">-</span>&nbsp;<span class="num" id="2278765">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278769">case</span>&nbsp;<span class="string" id="2278774">&#39;f&#39;</span><span class="op" id="2278777">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278782">prec</span>&nbsp;<span class="op" id="2278787">=</span>&nbsp;<span class="ident" id="2278789">max</span><span class="op" id="2278792">(</span><span class="ident" id="2278793">digs</span><span class="op" id="2278797">.</span><span class="ident" id="2278798">nd</span><span class="op" id="2278800">-</span><span class="ident" id="2278801">digs</span><span class="op" id="2278805">.</span><span class="ident" id="2278806">dp</span><span class="op" id="2278808">,</span>&nbsp;<span class="num" id="2278810">0</span><span class="op" id="2278811">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278815">case</span>&nbsp;<span class="string" id="2278820">&#39;g&#39;</span><span class="op" id="2278823">,</span>&nbsp;<span class="string" id="2278825">&#39;G&#39;</span><span class="op" id="2278828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278833">prec</span>&nbsp;<span class="op" id="2278838">=</span>&nbsp;<span class="ident" id="2278840">digs</span><span class="op" id="2278844">.</span><span class="ident" id="2278845">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278853">}</span>&nbsp;<span class="keyword" id="2278855">else</span>&nbsp;<span class="keyword" id="2278860">if</span>&nbsp;<span class="ident" id="2278863">fmt</span>&nbsp;<span class="op" id="2278867">!=</span>&nbsp;<span class="string" id="2278870">&#39;f&#39;</span>&nbsp;<span class="op" id="2278874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278878">//&nbsp;Fixed&nbsp;number&nbsp;of&nbsp;digits.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278907">digits</span>&nbsp;<span class="op" id="2278914">:=</span>&nbsp;<span class="ident" id="2278917">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278924">switch</span>&nbsp;<span class="ident" id="2278931">fmt</span>&nbsp;<span class="op" id="2278935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278939">case</span>&nbsp;<span class="string" id="2278944">&#39;e&#39;</span><span class="op" id="2278947">,</span>&nbsp;<span class="string" id="2278949">&#39;E&#39;</span><span class="op" id="2278952">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278957">digits</span><span class="op" id="2278963">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278968">case</span>&nbsp;<span class="string" id="2278973">&#39;g&#39;</span><span class="op" id="2278976">,</span>&nbsp;<span class="string" id="2278978">&#39;G&#39;</span><span class="op" id="2278981">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278986">if</span>&nbsp;<span class="ident" id="2278989">prec</span>&nbsp;<span class="op" id="2278994">==</span>&nbsp;<span class="num" id="2278997">0</span>&nbsp;<span class="op" id="2278999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279005">prec</span>&nbsp;<span class="op" id="2279010">=</span>&nbsp;<span class="num" id="2279012">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279022">digits</span>&nbsp;<span class="op" id="2279029">=</span>&nbsp;<span class="ident" id="2279031">prec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279038">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279042">if</span>&nbsp;<span class="ident" id="2279045">digits</span>&nbsp;<span class="op" id="2279052">&lt;=</span>&nbsp;<span class="num" id="2279055">15</span>&nbsp;<span class="op" id="2279058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2279063">//&nbsp;try&nbsp;fast&nbsp;algorithm&nbsp;when&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;is&nbsp;reasonable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279129">var</span>&nbsp;<span class="ident" id="2279133">buf</span>&nbsp;<span class="op" id="2279137">[</span><span class="num" id="2279138">24</span><span class="op" id="2279140">]</span><span class="builtintype" id="2279141">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279149">digs</span><span class="op" id="2279153">.</span><span class="ident" id="2279154">d</span>&nbsp;<span class="op" id="2279156">=</span>&nbsp;<span class="ident" id="2279158">buf</span><span class="op" id="2279161">[</span><span class="op" id="2279162">:</span><span class="op" id="2279163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279168">f</span>&nbsp;<span class="op" id="2279170">:=</span>&nbsp;<span class="ident" id="2279173">extFloat</span><span class="op" id="2279181">{</span><span class="ident" id="2279182">mant</span><span class="op" id="2279186">,</span>&nbsp;<span class="ident" id="2279188">exp</span>&nbsp;<span class="op" id="2279192">-</span>&nbsp;<span class="builtintype" id="2279194">int</span><span class="op" id="2279197">(</span><span class="ident" id="2279198">flt</span><span class="op" id="2279201">.</span><span class="ident" id="2279202">mantbits</span><span class="op" id="2279210">)</span><span class="op" id="2279211">,</span>&nbsp;<span class="ident" id="2279213">neg</span><span class="op" id="2279216">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279221">ok</span>&nbsp;<span class="op" id="2279224">=</span>&nbsp;<span class="ident" id="2279226">f</span><span class="op" id="2279227">.</span><span class="ident" id="2279228">FixedDecimal</span><span class="op" id="2279240">(</span><span class="op" id="2279241">&amp;</span><span class="ident" id="2279242">digs</span><span class="op" id="2279246">,</span>&nbsp;<span class="ident" id="2279248">digits</span><span class="op" id="2279254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279264">if</span>&nbsp;<span class="op" id="2279267">!</span><span class="ident" id="2279268">ok</span>&nbsp;<span class="op" id="2279271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279275">return</span>&nbsp;<span class="ident" id="2279282">bigFtoa</span><span class="op" id="2279289">(</span><span class="ident" id="2279290">dst</span><span class="op" id="2279293">,</span>&nbsp;<span class="ident" id="2279295">prec</span><span class="op" id="2279299">,</span>&nbsp;<span class="ident" id="2279301">fmt</span><span class="op" id="2279304">,</span>&nbsp;<span class="ident" id="2279306">neg</span><span class="op" id="2279309">,</span>&nbsp;<span class="ident" id="2279311">mant</span><span class="op" id="2279315">,</span>&nbsp;<span class="ident" id="2279317">exp</span><span class="op" id="2279320">,</span>&nbsp;<span class="ident" id="2279322">flt</span><span class="op" id="2279325">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279331">return</span>&nbsp;<span class="ident" id="2279338">formatDigits</span><span class="op" id="2279350">(</span><span class="ident" id="2279351">dst</span><span class="op" id="2279354">,</span>&nbsp;<span class="ident" id="2279356">shortest</span><span class="op" id="2279364">,</span>&nbsp;<span class="ident" id="2279366">neg</span><span class="op" id="2279369">,</span>&nbsp;<span class="ident" id="2279371">digs</span><span class="op" id="2279375">,</span>&nbsp;<span class="ident" id="2279377">prec</span><span class="op" id="2279381">,</span>&nbsp;<span class="ident" id="2279383">fmt</span><span class="op" id="2279386">)</span><br>
<span class="lineno"></span><span class="op" id="2279388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2279391">//&nbsp;bigFtoa&nbsp;uses&nbsp;multiprecision&nbsp;computations&nbsp;to&nbsp;format&nbsp;a&nbsp;float.</span><br>
<span class="lineno">155</span><span class="keyword" id="2279454">func</span>&nbsp;<span class="ident" id="2279459">bigFtoa</span><span class="op" id="2279466">(</span><span class="ident" id="2279467">dst</span>&nbsp;<span class="op" id="2279471">[</span><span class="op" id="2279472">]</span><span class="builtintype" id="2279473">byte</span><span class="op" id="2279477">,</span>&nbsp;<span class="ident" id="2279479">prec</span>&nbsp;<span class="builtintype" id="2279484">int</span><span class="op" id="2279487">,</span>&nbsp;<span class="ident" id="2279489">fmt</span>&nbsp;<span class="builtintype" id="2279493">byte</span><span class="op" id="2279497">,</span>&nbsp;<span class="ident" id="2279499">neg</span>&nbsp;<span class="builtintype" id="2279503">bool</span><span class="op" id="2279507">,</span>&nbsp;<span class="ident" id="2279509">mant</span>&nbsp;<span class="ident" id="2279514">uint64</span><span class="op" id="2279520">,</span>&nbsp;<span class="ident" id="2279522">exp</span>&nbsp;<span class="builtintype" id="2279526">int</span><span class="op" id="2279529">,</span>&nbsp;<span class="ident" id="2279531">flt</span>&nbsp;<span class="op" id="2279535">*</span><span class="ident" id="2279536">floatInfo</span><span class="op" id="2279545">)</span>&nbsp;<span class="op" id="2279547">[</span><span class="op" id="2279548">]</span><span class="builtintype" id="2279549">byte</span>&nbsp;<span class="op" id="2279554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279557">d</span>&nbsp;<span class="op" id="2279559">:=</span>&nbsp;<span class="builtinfunc" id="2279562">new</span><span class="op" id="2279565">(</span><span class="ident" id="2279566">decimal</span><span class="op" id="2279573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279576">d</span><span class="op" id="2279577">.</span><span class="ident" id="2279578">Assign</span><span class="op" id="2279584">(</span><span class="ident" id="2279585">mant</span><span class="op" id="2279589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279592">d</span><span class="op" id="2279593">.</span><span class="ident" id="2279594">Shift</span><span class="op" id="2279599">(</span><span class="ident" id="2279600">exp</span>&nbsp;<span class="op" id="2279604">-</span>&nbsp;<span class="builtintype" id="2279606">int</span><span class="op" id="2279609">(</span><span class="ident" id="2279610">flt</span><span class="op" id="2279613">.</span><span class="ident" id="2279614">mantbits</span><span class="op" id="2279622">)</span><span class="op" id="2279623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279626">var</span>&nbsp;<span class="ident" id="2279630">digs</span>&nbsp;<span class="ident" id="2279635">decimalSlice</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279649">shortest</span>&nbsp;<span class="op" id="2279658">:=</span>&nbsp;<span class="ident" id="2279661">prec</span>&nbsp;<span class="op" id="2279666">&lt;</span>&nbsp;<span class="num" id="2279668">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279671">if</span>&nbsp;<span class="ident" id="2279674">shortest</span>&nbsp;<span class="op" id="2279683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279687">roundShortest</span><span class="op" id="2279700">(</span><span class="ident" id="2279701">d</span><span class="op" id="2279702">,</span>&nbsp;<span class="ident" id="2279704">mant</span><span class="op" id="2279708">,</span>&nbsp;<span class="ident" id="2279710">exp</span><span class="op" id="2279713">,</span>&nbsp;<span class="ident" id="2279715">flt</span><span class="op" id="2279718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279722">digs</span>&nbsp;<span class="op" id="2279727">=</span>&nbsp;<span class="ident" id="2279729">decimalSlice</span><span class="op" id="2279741">{</span><span class="ident" id="2279742">d</span><span class="op" id="2279743">:</span>&nbsp;<span class="ident" id="2279745">d</span><span class="op" id="2279746">.</span><span class="ident" id="2279747">d</span><span class="op" id="2279748">[</span><span class="op" id="2279749">:</span><span class="op" id="2279750">]</span><span class="op" id="2279751">,</span>&nbsp;<span class="ident" id="2279753">nd</span><span class="op" id="2279755">:</span>&nbsp;<span class="ident" id="2279757">d</span><span class="op" id="2279758">.</span><span class="ident" id="2279759">nd</span><span class="op" id="2279761">,</span>&nbsp;<span class="ident" id="2279763">dp</span><span class="op" id="2279765">:</span>&nbsp;<span class="ident" id="2279767">d</span><span class="op" id="2279768">.</span><span class="ident" id="2279769">dp</span><span class="op" id="2279771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2279775">//&nbsp;Precision&nbsp;for&nbsp;shortest&nbsp;representation&nbsp;mode.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279824">switch</span>&nbsp;<span class="ident" id="2279831">fmt</span>&nbsp;<span class="op" id="2279835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279839">case</span>&nbsp;<span class="string" id="2279844">&#39;e&#39;</span><span class="op" id="2279847">,</span>&nbsp;<span class="string" id="2279849">&#39;E&#39;</span><span class="op" id="2279852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279857">prec</span>&nbsp;<span class="op" id="2279862">=</span>&nbsp;<span class="ident" id="2279864">digs</span><span class="op" id="2279868">.</span><span class="ident" id="2279869">nd</span>&nbsp;<span class="op" id="2279872">-</span>&nbsp;<span class="num" id="2279874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279878">case</span>&nbsp;<span class="string" id="2279883">&#39;f&#39;</span><span class="op" id="2279886">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279891">prec</span>&nbsp;<span class="op" id="2279896">=</span>&nbsp;<span class="ident" id="2279898">max</span><span class="op" id="2279901">(</span><span class="ident" id="2279902">digs</span><span class="op" id="2279906">.</span><span class="ident" id="2279907">nd</span><span class="op" id="2279909">-</span><span class="ident" id="2279910">digs</span><span class="op" id="2279914">.</span><span class="ident" id="2279915">dp</span><span class="op" id="2279917">,</span>&nbsp;<span class="num" id="2279919">0</span><span class="op" id="2279920">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279924">case</span>&nbsp;<span class="string" id="2279929">&#39;g&#39;</span><span class="op" id="2279932">,</span>&nbsp;<span class="string" id="2279934">&#39;G&#39;</span><span class="op" id="2279937">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279942">prec</span>&nbsp;<span class="op" id="2279947">=</span>&nbsp;<span class="ident" id="2279949">digs</span><span class="op" id="2279953">.</span><span class="ident" id="2279954">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279962">}</span>&nbsp;<span class="keyword" id="2279964">else</span>&nbsp;<span class="op" id="2279969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2279973">//&nbsp;Round&nbsp;appropriately.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279999">switch</span>&nbsp;<span class="ident" id="2280006">fmt</span>&nbsp;<span class="op" id="2280010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280014">case</span>&nbsp;<span class="string" id="2280019">&#39;e&#39;</span><span class="op" id="2280022">,</span>&nbsp;<span class="string" id="2280024">&#39;E&#39;</span><span class="op" id="2280027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280032">d</span><span class="op" id="2280033">.</span><span class="ident" id="2280034">Round</span><span class="op" id="2280039">(</span><span class="ident" id="2280040">prec</span>&nbsp;<span class="op" id="2280045">+</span>&nbsp;<span class="num" id="2280047">1</span><span class="op" id="2280048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280052">case</span>&nbsp;<span class="string" id="2280057">&#39;f&#39;</span><span class="op" id="2280060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280065">d</span><span class="op" id="2280066">.</span><span class="ident" id="2280067">Round</span><span class="op" id="2280072">(</span><span class="ident" id="2280073">d</span><span class="op" id="2280074">.</span><span class="ident" id="2280075">dp</span>&nbsp;<span class="op" id="2280078">+</span>&nbsp;<span class="ident" id="2280080">prec</span><span class="op" id="2280084">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280088">case</span>&nbsp;<span class="string" id="2280093">&#39;g&#39;</span><span class="op" id="2280096">,</span>&nbsp;<span class="string" id="2280098">&#39;G&#39;</span><span class="op" id="2280101">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280106">if</span>&nbsp;<span class="ident" id="2280109">prec</span>&nbsp;<span class="op" id="2280114">==</span>&nbsp;<span class="num" id="2280117">0</span>&nbsp;<span class="op" id="2280119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280125">prec</span>&nbsp;<span class="op" id="2280130">=</span>&nbsp;<span class="num" id="2280132">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280142">d</span><span class="op" id="2280143">.</span><span class="ident" id="2280144">Round</span><span class="op" id="2280149">(</span><span class="ident" id="2280150">prec</span><span class="op" id="2280154">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280162">digs</span>&nbsp;<span class="op" id="2280167">=</span>&nbsp;<span class="ident" id="2280169">decimalSlice</span><span class="op" id="2280181">{</span><span class="ident" id="2280182">d</span><span class="op" id="2280183">:</span>&nbsp;<span class="ident" id="2280185">d</span><span class="op" id="2280186">.</span><span class="ident" id="2280187">d</span><span class="op" id="2280188">[</span><span class="op" id="2280189">:</span><span class="op" id="2280190">]</span><span class="op" id="2280191">,</span>&nbsp;<span class="ident" id="2280193">nd</span><span class="op" id="2280195">:</span>&nbsp;<span class="ident" id="2280197">d</span><span class="op" id="2280198">.</span><span class="ident" id="2280199">nd</span><span class="op" id="2280201">,</span>&nbsp;<span class="ident" id="2280203">dp</span><span class="op" id="2280205">:</span>&nbsp;<span class="ident" id="2280207">d</span><span class="op" id="2280208">.</span><span class="ident" id="2280209">dp</span><span class="op" id="2280211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280217">return</span>&nbsp;<span class="ident" id="2280224">formatDigits</span><span class="op" id="2280236">(</span><span class="ident" id="2280237">dst</span><span class="op" id="2280240">,</span>&nbsp;<span class="ident" id="2280242">shortest</span><span class="op" id="2280250">,</span>&nbsp;<span class="ident" id="2280252">neg</span><span class="op" id="2280255">,</span>&nbsp;<span class="ident" id="2280257">digs</span><span class="op" id="2280261">,</span>&nbsp;<span class="ident" id="2280263">prec</span><span class="op" id="2280267">,</span>&nbsp;<span class="ident" id="2280269">fmt</span><span class="op" id="2280272">)</span><br>
<span class="lineno"></span><span class="op" id="2280274">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="2280277">func</span>&nbsp;<span class="ident" id="2280282">formatDigits</span><span class="op" id="2280294">(</span><span class="ident" id="2280295">dst</span>&nbsp;<span class="op" id="2280299">[</span><span class="op" id="2280300">]</span><span class="builtintype" id="2280301">byte</span><span class="op" id="2280305">,</span>&nbsp;<span class="ident" id="2280307">shortest</span>&nbsp;<span class="builtintype" id="2280316">bool</span><span class="op" id="2280320">,</span>&nbsp;<span class="ident" id="2280322">neg</span>&nbsp;<span class="builtintype" id="2280326">bool</span><span class="op" id="2280330">,</span>&nbsp;<span class="ident" id="2280332">digs</span>&nbsp;<span class="ident" id="2280337">decimalSlice</span><span class="op" id="2280349">,</span>&nbsp;<span class="ident" id="2280351">prec</span>&nbsp;<span class="builtintype" id="2280356">int</span><span class="op" id="2280359">,</span>&nbsp;<span class="ident" id="2280361">fmt</span>&nbsp;<span class="builtintype" id="2280365">byte</span><span class="op" id="2280369">)</span>&nbsp;<span class="op" id="2280371">[</span><span class="op" id="2280372">]</span><span class="builtintype" id="2280373">byte</span>&nbsp;<span class="op" id="2280378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280381">switch</span>&nbsp;<span class="ident" id="2280388">fmt</span>&nbsp;<span class="op" id="2280392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280395">case</span>&nbsp;<span class="string" id="2280400">&#39;e&#39;</span><span class="op" id="2280403">,</span>&nbsp;<span class="string" id="2280405">&#39;E&#39;</span><span class="op" id="2280408">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280412">return</span>&nbsp;<span class="ident" id="2280419">fmtE</span><span class="op" id="2280423">(</span><span class="ident" id="2280424">dst</span><span class="op" id="2280427">,</span>&nbsp;<span class="ident" id="2280429">neg</span><span class="op" id="2280432">,</span>&nbsp;<span class="ident" id="2280434">digs</span><span class="op" id="2280438">,</span>&nbsp;<span class="ident" id="2280440">prec</span><span class="op" id="2280444">,</span>&nbsp;<span class="ident" id="2280446">fmt</span><span class="op" id="2280449">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280452">case</span>&nbsp;<span class="string" id="2280457">&#39;f&#39;</span><span class="op" id="2280460">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280464">return</span>&nbsp;<span class="ident" id="2280471">fmtF</span><span class="op" id="2280475">(</span><span class="ident" id="2280476">dst</span><span class="op" id="2280479">,</span>&nbsp;<span class="ident" id="2280481">neg</span><span class="op" id="2280484">,</span>&nbsp;<span class="ident" id="2280486">digs</span><span class="op" id="2280490">,</span>&nbsp;<span class="ident" id="2280492">prec</span><span class="op" id="2280496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280499">case</span>&nbsp;<span class="string" id="2280504">&#39;g&#39;</span><span class="op" id="2280507">,</span>&nbsp;<span class="string" id="2280509">&#39;G&#39;</span><span class="op" id="2280512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2280516">//&nbsp;trailing&nbsp;fractional&nbsp;zeros&nbsp;in&nbsp;&#39;e&#39;&nbsp;form&nbsp;will&nbsp;be&nbsp;trimmed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280576">eprec</span>&nbsp;<span class="op" id="2280582">:=</span>&nbsp;<span class="ident" id="2280585">prec</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280592">if</span>&nbsp;<span class="ident" id="2280595">eprec</span>&nbsp;<span class="op" id="2280601">&gt;</span>&nbsp;<span class="ident" id="2280603">digs</span><span class="op" id="2280607">.</span><span class="ident" id="2280608">nd</span>&nbsp;<span class="op" id="2280611">&amp;&amp;</span>&nbsp;<span class="ident" id="2280614">digs</span><span class="op" id="2280618">.</span><span class="ident" id="2280619">nd</span>&nbsp;<span class="op" id="2280622">&gt;=</span>&nbsp;<span class="ident" id="2280625">digs</span><span class="op" id="2280629">.</span><span class="ident" id="2280630">dp</span>&nbsp;<span class="op" id="2280633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280638">eprec</span>&nbsp;<span class="op" id="2280644">=</span>&nbsp;<span class="ident" id="2280646">digs</span><span class="op" id="2280650">.</span><span class="ident" id="2280651">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2280660">//&nbsp;%e&nbsp;is&nbsp;used&nbsp;if&nbsp;the&nbsp;exponent&nbsp;from&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2280712">//&nbsp;is&nbsp;less&nbsp;than&nbsp;-4&nbsp;or&nbsp;greater&nbsp;than&nbsp;or&nbsp;equal&nbsp;to&nbsp;the&nbsp;precision.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2280776">//&nbsp;if&nbsp;precision&nbsp;was&nbsp;the&nbsp;shortest&nbsp;possible,&nbsp;use&nbsp;precision&nbsp;6&nbsp;for&nbsp;this&nbsp;decision.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280856">if</span>&nbsp;<span class="ident" id="2280859">shortest</span>&nbsp;<span class="op" id="2280868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280873">eprec</span>&nbsp;<span class="op" id="2280879">=</span>&nbsp;<span class="num" id="2280881">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280889">exp</span>&nbsp;<span class="op" id="2280893">:=</span>&nbsp;<span class="ident" id="2280896">digs</span><span class="op" id="2280900">.</span><span class="ident" id="2280901">dp</span>&nbsp;<span class="op" id="2280904">-</span>&nbsp;<span class="num" id="2280906">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280910">if</span>&nbsp;<span class="ident" id="2280913">exp</span>&nbsp;<span class="op" id="2280917">&lt;</span>&nbsp;<span class="op" id="2280919">-</span><span class="num" id="2280920">4</span>&nbsp;<span class="op" id="2280922">||</span>&nbsp;<span class="ident" id="2280925">exp</span>&nbsp;<span class="op" id="2280929">&gt;=</span>&nbsp;<span class="ident" id="2280932">eprec</span>&nbsp;<span class="op" id="2280938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280943">if</span>&nbsp;<span class="ident" id="2280946">prec</span>&nbsp;<span class="op" id="2280951">&gt;</span>&nbsp;<span class="ident" id="2280953">digs</span><span class="op" id="2280957">.</span><span class="ident" id="2280958">nd</span>&nbsp;<span class="op" id="2280961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280967">prec</span>&nbsp;<span class="op" id="2280972">=</span>&nbsp;<span class="ident" id="2280974">digs</span><span class="op" id="2280978">.</span><span class="ident" id="2280979">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280990">return</span>&nbsp;<span class="ident" id="2280997">fmtE</span><span class="op" id="2281001">(</span><span class="ident" id="2281002">dst</span><span class="op" id="2281005">,</span>&nbsp;<span class="ident" id="2281007">neg</span><span class="op" id="2281010">,</span>&nbsp;<span class="ident" id="2281012">digs</span><span class="op" id="2281016">,</span>&nbsp;<span class="ident" id="2281018">prec</span><span class="op" id="2281022">-</span><span class="num" id="2281023">1</span><span class="op" id="2281024">,</span>&nbsp;<span class="ident" id="2281026">fmt</span><span class="op" id="2281029">+</span><span class="string" id="2281030">&#39;e&#39;</span><span class="op" id="2281033">-</span><span class="string" id="2281034">&#39;g&#39;</span><span class="op" id="2281037">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281045">if</span>&nbsp;<span class="ident" id="2281048">prec</span>&nbsp;<span class="op" id="2281053">&gt;</span>&nbsp;<span class="ident" id="2281055">digs</span><span class="op" id="2281059">.</span><span class="ident" id="2281060">dp</span>&nbsp;<span class="op" id="2281063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281068">prec</span>&nbsp;<span class="op" id="2281073">=</span>&nbsp;<span class="ident" id="2281075">digs</span><span class="op" id="2281079">.</span><span class="ident" id="2281080">nd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281089">return</span>&nbsp;<span class="ident" id="2281096">fmtF</span><span class="op" id="2281100">(</span><span class="ident" id="2281101">dst</span><span class="op" id="2281104">,</span>&nbsp;<span class="ident" id="2281106">neg</span><span class="op" id="2281109">,</span>&nbsp;<span class="ident" id="2281111">digs</span><span class="op" id="2281115">,</span>&nbsp;<span class="ident" id="2281117">max</span><span class="op" id="2281120">(</span><span class="ident" id="2281121">prec</span><span class="op" id="2281125">-</span><span class="ident" id="2281126">digs</span><span class="op" id="2281130">.</span><span class="ident" id="2281131">dp</span><span class="op" id="2281133">,</span>&nbsp;<span class="num" id="2281135">0</span><span class="op" id="2281136">)</span><span class="op" id="2281137">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281140">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281144">//&nbsp;unknown&nbsp;format</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281163">return</span>&nbsp;<span class="builtinfunc" id="2281170">append</span><span class="op" id="2281176">(</span><span class="ident" id="2281177">dst</span><span class="op" id="2281180">,</span>&nbsp;<span class="string" id="2281182">&#39;%&#39;</span><span class="op" id="2281185">,</span>&nbsp;<span class="ident" id="2281187">fmt</span><span class="op" id="2281190">)</span><br>
<span class="lineno"></span><span class="op" id="2281192">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2281195">//&nbsp;Round&nbsp;d&nbsp;(=&nbsp;mant&nbsp;*&nbsp;2^exp)&nbsp;to&nbsp;the&nbsp;shortest&nbsp;number&nbsp;of&nbsp;digits</span><br>
<span class="lineno"></span><span class="comment" id="2281256">//&nbsp;that&nbsp;will&nbsp;let&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;value&nbsp;be&nbsp;precisely</span><br>
<span class="lineno"></span><span class="comment" id="2281320">//&nbsp;reconstructed.&nbsp;&nbsp;Size&nbsp;is&nbsp;original&nbsp;floating&nbsp;point&nbsp;size&nbsp;(64&nbsp;or&nbsp;32).</span><br>
<span class="lineno"></span><span class="keyword" id="2281388">func</span>&nbsp;<span class="ident" id="2281393">roundShortest</span><span class="op" id="2281406">(</span><span class="ident" id="2281407">d</span>&nbsp;<span class="op" id="2281409">*</span><span class="ident" id="2281410">decimal</span><span class="op" id="2281417">,</span>&nbsp;<span class="ident" id="2281419">mant</span>&nbsp;<span class="ident" id="2281424">uint64</span><span class="op" id="2281430">,</span>&nbsp;<span class="ident" id="2281432">exp</span>&nbsp;<span class="builtintype" id="2281436">int</span><span class="op" id="2281439">,</span>&nbsp;<span class="ident" id="2281441">flt</span>&nbsp;<span class="op" id="2281445">*</span><span class="ident" id="2281446">floatInfo</span><span class="op" id="2281455">)</span>&nbsp;<span class="op" id="2281457">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281460">//&nbsp;If&nbsp;mantissa&nbsp;is&nbsp;zero,&nbsp;the&nbsp;number&nbsp;is&nbsp;zero;&nbsp;stop&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281515">if</span>&nbsp;<span class="ident" id="2281518">mant</span>&nbsp;<span class="op" id="2281523">==</span>&nbsp;<span class="num" id="2281526">0</span>&nbsp;<span class="op" id="2281528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281532">d</span><span class="op" id="2281533">.</span><span class="ident" id="2281534">nd</span>&nbsp;<span class="op" id="2281537">=</span>&nbsp;<span class="num" id="2281539">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281543">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281551">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281555">//&nbsp;Compute&nbsp;upper&nbsp;and&nbsp;lower&nbsp;such&nbsp;that&nbsp;any&nbsp;decimal&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281612">//&nbsp;between&nbsp;upper&nbsp;and&nbsp;lower&nbsp;(possibly&nbsp;inclusive)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281661">//&nbsp;will&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;floating&nbsp;point&nbsp;number.</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281716">//&nbsp;We&nbsp;may&nbsp;see&nbsp;at&nbsp;once&nbsp;that&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281776">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281780">//&nbsp;Suppose&nbsp;d&nbsp;is&nbsp;not&nbsp;denormal,&nbsp;so&nbsp;that&nbsp;2^exp&nbsp;&lt;=&nbsp;d&nbsp;&lt;&nbsp;10^dp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281839">//&nbsp;The&nbsp;closest&nbsp;shorter&nbsp;number&nbsp;is&nbsp;at&nbsp;least&nbsp;10^(dp-nd)&nbsp;away.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281899">//&nbsp;The&nbsp;lower/upper&nbsp;bounds&nbsp;computed&nbsp;below&nbsp;are&nbsp;at&nbsp;distance</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281957">//&nbsp;at&nbsp;most&nbsp;2^(exp-mantbits).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281987">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2281991">//&nbsp;So&nbsp;the&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest&nbsp;if&nbsp;10^(dp-nd)&nbsp;&gt;&nbsp;2^(exp-mantbits),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282063">//&nbsp;or&nbsp;equivalently&nbsp;log2(10)*(dp-nd)&nbsp;&gt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282116">//&nbsp;It&nbsp;is&nbsp;true&nbsp;if&nbsp;332/100*(dp-nd)&nbsp;&gt;=&nbsp;exp-mantbits&nbsp;(log2(10)&nbsp;&gt;&nbsp;3.32).</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282185">minexp</span>&nbsp;<span class="op" id="2282192">:=</span>&nbsp;<span class="ident" id="2282195">flt</span><span class="op" id="2282198">.</span><span class="ident" id="2282199">bias</span>&nbsp;<span class="op" id="2282204">+</span>&nbsp;<span class="num" id="2282206">1</span>&nbsp;<span class="comment" id="2282208">//&nbsp;minimum&nbsp;possible&nbsp;exponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282238">if</span>&nbsp;<span class="ident" id="2282241">exp</span>&nbsp;<span class="op" id="2282245">&gt;</span>&nbsp;<span class="ident" id="2282247">minexp</span>&nbsp;<span class="op" id="2282254">&amp;&amp;</span>&nbsp;<span class="num" id="2282257">332</span><span class="op" id="2282260">*</span><span class="op" id="2282261">(</span><span class="ident" id="2282262">d</span><span class="op" id="2282263">.</span><span class="ident" id="2282264">dp</span><span class="op" id="2282266">-</span><span class="ident" id="2282267">d</span><span class="op" id="2282268">.</span><span class="ident" id="2282269">nd</span><span class="op" id="2282271">)</span>&nbsp;<span class="op" id="2282273">&gt;=</span>&nbsp;<span class="num" id="2282276">100</span><span class="op" id="2282279">*</span><span class="op" id="2282280">(</span><span class="ident" id="2282281">exp</span><span class="op" id="2282284">-</span><span class="builtintype" id="2282285">int</span><span class="op" id="2282288">(</span><span class="ident" id="2282289">flt</span><span class="op" id="2282292">.</span><span class="ident" id="2282293">mantbits</span><span class="op" id="2282301">)</span><span class="op" id="2282302">)</span>&nbsp;<span class="op" id="2282304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282308">//&nbsp;The&nbsp;number&nbsp;is&nbsp;already&nbsp;shortest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282345">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282353">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282357">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282390">//&nbsp;Next&nbsp;highest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant+1&nbsp;&lt;&lt;&nbsp;exp-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282456">//&nbsp;Our&nbsp;upper&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mant*2+1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282524">upper</span>&nbsp;<span class="op" id="2282530">:=</span>&nbsp;<span class="builtinfunc" id="2282533">new</span><span class="op" id="2282536">(</span><span class="ident" id="2282537">decimal</span><span class="op" id="2282544">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282547">upper</span><span class="op" id="2282552">.</span><span class="ident" id="2282553">Assign</span><span class="op" id="2282559">(</span><span class="ident" id="2282560">mant</span><span class="op" id="2282564">*</span><span class="num" id="2282565">2</span>&nbsp;<span class="op" id="2282567">+</span>&nbsp;<span class="num" id="2282569">1</span><span class="op" id="2282570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282573">upper</span><span class="op" id="2282578">.</span><span class="ident" id="2282579">Shift</span><span class="op" id="2282584">(</span><span class="ident" id="2282585">exp</span>&nbsp;<span class="op" id="2282589">-</span>&nbsp;<span class="builtintype" id="2282591">int</span><span class="op" id="2282594">(</span><span class="ident" id="2282595">flt</span><span class="op" id="2282598">.</span><span class="ident" id="2282599">mantbits</span><span class="op" id="2282607">)</span>&nbsp;<span class="op" id="2282609">-</span>&nbsp;<span class="num" id="2282611">1</span><span class="op" id="2282612">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282616">//&nbsp;d&nbsp;=&nbsp;mant&nbsp;&lt;&lt;&nbsp;(exp&nbsp;-&nbsp;mantbits)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282649">//&nbsp;Next&nbsp;lowest&nbsp;floating&nbsp;point&nbsp;number&nbsp;is&nbsp;mant-1&nbsp;&lt;&lt;&nbsp;exp-mantbits,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282714">//&nbsp;unless&nbsp;mant-1&nbsp;drops&nbsp;the&nbsp;significant&nbsp;bit&nbsp;and&nbsp;exp&nbsp;is&nbsp;not&nbsp;the&nbsp;minimum&nbsp;exp,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282790">//&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;next&nbsp;lowest&nbsp;is&nbsp;mant*2-1&nbsp;&lt;&lt;&nbsp;exp-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282855">//&nbsp;Either&nbsp;way,&nbsp;call&nbsp;it&nbsp;mantlo&nbsp;&lt;&lt;&nbsp;explo-mantbits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282905">//&nbsp;Our&nbsp;lower&nbsp;bound&nbsp;is&nbsp;halfway&nbsp;between,&nbsp;mantlo*2+1&nbsp;&lt;&lt;&nbsp;explo-mantbits-1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282977">var</span>&nbsp;<span class="ident" id="2282981">mantlo</span>&nbsp;<span class="ident" id="2282988">uint64</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282996">var</span>&nbsp;<span class="ident" id="2283000">explo</span>&nbsp;<span class="builtintype" id="2283006">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283011">if</span>&nbsp;<span class="ident" id="2283014">mant</span>&nbsp;<span class="op" id="2283019">&gt;</span>&nbsp;<span class="num" id="2283021">1</span><span class="op" id="2283022">&lt;&lt;</span><span class="ident" id="2283024">flt</span><span class="op" id="2283027">.</span><span class="ident" id="2283028">mantbits</span>&nbsp;<span class="op" id="2283037">||</span>&nbsp;<span class="ident" id="2283040">exp</span>&nbsp;<span class="op" id="2283044">==</span>&nbsp;<span class="ident" id="2283047">minexp</span>&nbsp;<span class="op" id="2283054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283058">mantlo</span>&nbsp;<span class="op" id="2283065">=</span>&nbsp;<span class="ident" id="2283067">mant</span>&nbsp;<span class="op" id="2283072">-</span>&nbsp;<span class="num" id="2283074">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283078">explo</span>&nbsp;<span class="op" id="2283084">=</span>&nbsp;<span class="ident" id="2283086">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283091">}</span>&nbsp;<span class="keyword" id="2283093">else</span>&nbsp;<span class="op" id="2283098">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283102">mantlo</span>&nbsp;<span class="op" id="2283109">=</span>&nbsp;<span class="ident" id="2283111">mant</span><span class="op" id="2283115">*</span><span class="num" id="2283116">2</span>&nbsp;<span class="op" id="2283118">-</span>&nbsp;<span class="num" id="2283120">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283124">explo</span>&nbsp;<span class="op" id="2283130">=</span>&nbsp;<span class="ident" id="2283132">exp</span>&nbsp;<span class="op" id="2283136">-</span>&nbsp;<span class="num" id="2283138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283144">lower</span>&nbsp;<span class="op" id="2283150">:=</span>&nbsp;<span class="builtinfunc" id="2283153">new</span><span class="op" id="2283156">(</span><span class="ident" id="2283157">decimal</span><span class="op" id="2283164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283167">lower</span><span class="op" id="2283172">.</span><span class="ident" id="2283173">Assign</span><span class="op" id="2283179">(</span><span class="ident" id="2283180">mantlo</span><span class="op" id="2283186">*</span><span class="num" id="2283187">2</span>&nbsp;<span class="op" id="2283189">+</span>&nbsp;<span class="num" id="2283191">1</span><span class="op" id="2283192">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283195">lower</span><span class="op" id="2283200">.</span><span class="ident" id="2283201">Shift</span><span class="op" id="2283206">(</span><span class="ident" id="2283207">explo</span>&nbsp;<span class="op" id="2283213">-</span>&nbsp;<span class="builtintype" id="2283215">int</span><span class="op" id="2283218">(</span><span class="ident" id="2283219">flt</span><span class="op" id="2283222">.</span><span class="ident" id="2283223">mantbits</span><span class="op" id="2283231">)</span>&nbsp;<span class="op" id="2283233">-</span>&nbsp;<span class="num" id="2283235">1</span><span class="op" id="2283236">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283240">//&nbsp;The&nbsp;upper&nbsp;and&nbsp;lower&nbsp;bounds&nbsp;are&nbsp;possible&nbsp;outputs&nbsp;only&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283300">//&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;is&nbsp;even,&nbsp;so&nbsp;that&nbsp;IEEE&nbsp;round-to-even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283362">//&nbsp;would&nbsp;round&nbsp;to&nbsp;the&nbsp;original&nbsp;mantissa&nbsp;and&nbsp;not&nbsp;the&nbsp;neighbors.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283426">inclusive</span>&nbsp;<span class="op" id="2283436">:=</span>&nbsp;<span class="ident" id="2283439">mant</span><span class="op" id="2283443">%</span><span class="num" id="2283444">2</span>&nbsp;<span class="op" id="2283446">==</span>&nbsp;<span class="num" id="2283449">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283453">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;figure&nbsp;out&nbsp;the&nbsp;minimum&nbsp;number&nbsp;of&nbsp;digits&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283518">//&nbsp;Walk&nbsp;along&nbsp;until&nbsp;d&nbsp;has&nbsp;distinguished&nbsp;itself&nbsp;from&nbsp;upper&nbsp;and&nbsp;lower.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283588">for</span>&nbsp;<span class="ident" id="2283592">i</span>&nbsp;<span class="op" id="2283594">:=</span>&nbsp;<span class="num" id="2283597">0</span><span class="op" id="2283598">;</span>&nbsp;<span class="ident" id="2283600">i</span>&nbsp;<span class="op" id="2283602">&lt;</span>&nbsp;<span class="ident" id="2283604">d</span><span class="op" id="2283605">.</span><span class="ident" id="2283606">nd</span><span class="op" id="2283608">;</span>&nbsp;<span class="ident" id="2283610">i</span><span class="op" id="2283611">++</span>&nbsp;<span class="op" id="2283614">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283618">var</span>&nbsp;<span class="ident" id="2283622">l</span><span class="op" id="2283623">,</span>&nbsp;<span class="ident" id="2283625">m</span><span class="op" id="2283626">,</span>&nbsp;<span class="ident" id="2283628">u</span>&nbsp;<span class="builtintype" id="2283630">byte</span>&nbsp;<span class="comment" id="2283635">//&nbsp;lower,&nbsp;middle,&nbsp;upper&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283668">if</span>&nbsp;<span class="ident" id="2283671">i</span>&nbsp;<span class="op" id="2283673">&lt;</span>&nbsp;<span class="ident" id="2283675">lower</span><span class="op" id="2283680">.</span><span class="ident" id="2283681">nd</span>&nbsp;<span class="op" id="2283684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283689">l</span>&nbsp;<span class="op" id="2283691">=</span>&nbsp;<span class="ident" id="2283693">lower</span><span class="op" id="2283698">.</span><span class="ident" id="2283699">d</span><span class="op" id="2283700">[</span><span class="ident" id="2283701">i</span><span class="op" id="2283702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283706">}</span>&nbsp;<span class="keyword" id="2283708">else</span>&nbsp;<span class="op" id="2283713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283718">l</span>&nbsp;<span class="op" id="2283720">=</span>&nbsp;<span class="string" id="2283722">&#39;0&#39;</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283732">m</span>&nbsp;<span class="op" id="2283734">=</span>&nbsp;<span class="ident" id="2283736">d</span><span class="op" id="2283737">.</span><span class="ident" id="2283738">d</span><span class="op" id="2283739">[</span><span class="ident" id="2283740">i</span><span class="op" id="2283741">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283745">if</span>&nbsp;<span class="ident" id="2283748">i</span>&nbsp;<span class="op" id="2283750">&lt;</span>&nbsp;<span class="ident" id="2283752">upper</span><span class="op" id="2283757">.</span><span class="ident" id="2283758">nd</span>&nbsp;<span class="op" id="2283761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283766">u</span>&nbsp;<span class="op" id="2283768">=</span>&nbsp;<span class="ident" id="2283770">upper</span><span class="op" id="2283775">.</span><span class="ident" id="2283776">d</span><span class="op" id="2283777">[</span><span class="ident" id="2283778">i</span><span class="op" id="2283779">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283783">}</span>&nbsp;<span class="keyword" id="2283785">else</span>&nbsp;<span class="op" id="2283790">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283795">u</span>&nbsp;<span class="op" id="2283797">=</span>&nbsp;<span class="string" id="2283799">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283810">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;down&nbsp;(truncate)&nbsp;if&nbsp;lower&nbsp;has&nbsp;a&nbsp;different&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2283876">//&nbsp;or&nbsp;if&nbsp;lower&nbsp;is&nbsp;inclusive&nbsp;and&nbsp;is&nbsp;exactly&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;down.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283950">okdown</span>&nbsp;<span class="op" id="2283957">:=</span>&nbsp;<span class="ident" id="2283960">l</span>&nbsp;<span class="op" id="2283962">!=</span>&nbsp;<span class="ident" id="2283965">m</span>&nbsp;<span class="op" id="2283967">||</span>&nbsp;<span class="op" id="2283970">(</span><span class="ident" id="2283971">inclusive</span>&nbsp;<span class="op" id="2283981">&amp;&amp;</span>&nbsp;<span class="ident" id="2283984">l</span>&nbsp;<span class="op" id="2283986">==</span>&nbsp;<span class="ident" id="2283989">m</span>&nbsp;<span class="op" id="2283991">&amp;&amp;</span>&nbsp;<span class="ident" id="2283994">i</span><span class="op" id="2283995">+</span><span class="num" id="2283996">1</span>&nbsp;<span class="op" id="2283998">==</span>&nbsp;<span class="ident" id="2284001">lower</span><span class="op" id="2284006">.</span><span class="ident" id="2284007">nd</span><span class="op" id="2284009">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284014">//&nbsp;Okay&nbsp;to&nbsp;round&nbsp;up&nbsp;if&nbsp;upper&nbsp;has&nbsp;a&nbsp;different&nbsp;digit&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284071">//&nbsp;either&nbsp;upper&nbsp;is&nbsp;inclusive&nbsp;or&nbsp;upper&nbsp;is&nbsp;bigger&nbsp;than&nbsp;the&nbsp;result&nbsp;of&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284153">okup</span>&nbsp;<span class="op" id="2284158">:=</span>&nbsp;<span class="ident" id="2284161">m</span>&nbsp;<span class="op" id="2284163">!=</span>&nbsp;<span class="ident" id="2284166">u</span>&nbsp;<span class="op" id="2284168">&amp;&amp;</span>&nbsp;<span class="op" id="2284171">(</span><span class="ident" id="2284172">inclusive</span>&nbsp;<span class="op" id="2284182">||</span>&nbsp;<span class="ident" id="2284185">m</span><span class="op" id="2284186">+</span><span class="num" id="2284187">1</span>&nbsp;<span class="op" id="2284189">&lt;</span>&nbsp;<span class="ident" id="2284191">u</span>&nbsp;<span class="op" id="2284193">||</span>&nbsp;<span class="ident" id="2284196">i</span><span class="op" id="2284197">+</span><span class="num" id="2284198">1</span>&nbsp;<span class="op" id="2284200">&lt;</span>&nbsp;<span class="ident" id="2284202">upper</span><span class="op" id="2284207">.</span><span class="ident" id="2284208">nd</span><span class="op" id="2284210">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284215">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;either,&nbsp;then&nbsp;round&nbsp;to&nbsp;the&nbsp;nearest&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284278">//&nbsp;If&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;do&nbsp;only&nbsp;one,&nbsp;do&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284319">switch</span>&nbsp;<span class="op" id="2284326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284330">case</span>&nbsp;<span class="ident" id="2284335">okdown</span>&nbsp;<span class="op" id="2284342">&amp;&amp;</span>&nbsp;<span class="ident" id="2284345">okup</span><span class="op" id="2284349">:</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284354">d</span><span class="op" id="2284355">.</span><span class="ident" id="2284356">Round</span><span class="op" id="2284361">(</span><span class="ident" id="2284362">i</span>&nbsp;<span class="op" id="2284364">+</span>&nbsp;<span class="num" id="2284366">1</span><span class="op" id="2284367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284372">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284381">case</span>&nbsp;<span class="ident" id="2284386">okdown</span><span class="op" id="2284392">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284397">d</span><span class="op" id="2284398">.</span><span class="ident" id="2284399">RoundDown</span><span class="op" id="2284408">(</span><span class="ident" id="2284409">i</span>&nbsp;<span class="op" id="2284411">+</span>&nbsp;<span class="num" id="2284413">1</span><span class="op" id="2284414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284419">return</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284428">case</span>&nbsp;<span class="ident" id="2284433">okup</span><span class="op" id="2284437">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284442">d</span><span class="op" id="2284443">.</span><span class="ident" id="2284444">RoundUp</span><span class="op" id="2284451">(</span><span class="ident" id="2284452">i</span>&nbsp;<span class="op" id="2284454">+</span>&nbsp;<span class="num" id="2284456">1</span><span class="op" id="2284457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284462">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2284471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2284474">}</span><br>
<span class="lineno">325</span><span class="op" id="2284476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2284479">type</span>&nbsp;<span class="ident" id="2284484">decimalSlice</span>&nbsp;<span class="keyword" id="2284497">struct</span>&nbsp;<span class="op" id="2284504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284507">d</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2284514">[</span><span class="op" id="2284515">]</span><span class="builtintype" id="2284516">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284522">nd</span><span class="op" id="2284524">,</span>&nbsp;<span class="ident" id="2284526">dp</span>&nbsp;<span class="builtintype" id="2284529">int</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284534">neg</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2284541">bool</span><br>
<span class="lineno"></span><span class="op" id="2284546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2284549">//&nbsp;%e:&nbsp;-d.ddddde±dd</span><br>
<span class="lineno"></span><span class="keyword" id="2284570">func</span>&nbsp;<span class="ident" id="2284575">fmtE</span><span class="op" id="2284579">(</span><span class="ident" id="2284580">dst</span>&nbsp;<span class="op" id="2284584">[</span><span class="op" id="2284585">]</span><span class="builtintype" id="2284586">byte</span><span class="op" id="2284590">,</span>&nbsp;<span class="ident" id="2284592">neg</span>&nbsp;<span class="builtintype" id="2284596">bool</span><span class="op" id="2284600">,</span>&nbsp;<span class="ident" id="2284602">d</span>&nbsp;<span class="ident" id="2284604">decimalSlice</span><span class="op" id="2284616">,</span>&nbsp;<span class="ident" id="2284618">prec</span>&nbsp;<span class="builtintype" id="2284623">int</span><span class="op" id="2284626">,</span>&nbsp;<span class="ident" id="2284628">fmt</span>&nbsp;<span class="builtintype" id="2284632">byte</span><span class="op" id="2284636">)</span>&nbsp;<span class="op" id="2284638">[</span><span class="op" id="2284639">]</span><span class="builtintype" id="2284640">byte</span>&nbsp;<span class="op" id="2284645">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284648">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284657">if</span>&nbsp;<span class="ident" id="2284660">neg</span>&nbsp;<span class="op" id="2284664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284668">dst</span>&nbsp;<span class="op" id="2284672">=</span>&nbsp;<span class="builtinfunc" id="2284674">append</span><span class="op" id="2284680">(</span><span class="ident" id="2284681">dst</span><span class="op" id="2284684">,</span>&nbsp;<span class="string" id="2284686">&#39;-&#39;</span><span class="op" id="2284689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2284692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284696">//&nbsp;first&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284712">ch</span>&nbsp;<span class="op" id="2284715">:=</span>&nbsp;<span class="builtintype" id="2284718">byte</span><span class="op" id="2284722">(</span><span class="string" id="2284723">&#39;0&#39;</span><span class="op" id="2284726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284729">if</span>&nbsp;<span class="ident" id="2284732">d</span><span class="op" id="2284733">.</span><span class="ident" id="2284734">nd</span>&nbsp;<span class="op" id="2284737">!=</span>&nbsp;<span class="num" id="2284740">0</span>&nbsp;<span class="op" id="2284742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284746">ch</span>&nbsp;<span class="op" id="2284749">=</span>&nbsp;<span class="ident" id="2284751">d</span><span class="op" id="2284752">.</span><span class="ident" id="2284753">d</span><span class="op" id="2284754">[</span><span class="num" id="2284755">0</span><span class="op" id="2284756">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2284759">}</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284762">dst</span>&nbsp;<span class="op" id="2284766">=</span>&nbsp;<span class="builtinfunc" id="2284768">append</span><span class="op" id="2284774">(</span><span class="ident" id="2284775">dst</span><span class="op" id="2284778">,</span>&nbsp;<span class="ident" id="2284780">ch</span><span class="op" id="2284782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2284786">//&nbsp;.moredigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284802">if</span>&nbsp;<span class="ident" id="2284805">prec</span>&nbsp;<span class="op" id="2284810">&gt;</span>&nbsp;<span class="num" id="2284812">0</span>&nbsp;<span class="op" id="2284814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284818">dst</span>&nbsp;<span class="op" id="2284822">=</span>&nbsp;<span class="builtinfunc" id="2284824">append</span><span class="op" id="2284830">(</span><span class="ident" id="2284831">dst</span><span class="op" id="2284834">,</span>&nbsp;<span class="string" id="2284836">&#39;.&#39;</span><span class="op" id="2284839">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284843">i</span>&nbsp;<span class="op" id="2284845">:=</span>&nbsp;<span class="num" id="2284848">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284852">m</span>&nbsp;<span class="op" id="2284854">:=</span>&nbsp;<span class="ident" id="2284857">d</span><span class="op" id="2284858">.</span><span class="ident" id="2284859">nd</span>&nbsp;<span class="op" id="2284862">+</span>&nbsp;<span class="ident" id="2284864">prec</span>&nbsp;<span class="op" id="2284869">+</span>&nbsp;<span class="num" id="2284871">1</span>&nbsp;<span class="op" id="2284873">-</span>&nbsp;<span class="ident" id="2284875">max</span><span class="op" id="2284878">(</span><span class="ident" id="2284879">d</span><span class="op" id="2284880">.</span><span class="ident" id="2284881">nd</span><span class="op" id="2284883">,</span>&nbsp;<span class="ident" id="2284885">prec</span><span class="op" id="2284889">+</span><span class="num" id="2284890">1</span><span class="op" id="2284891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284895">for</span>&nbsp;<span class="ident" id="2284899">i</span>&nbsp;<span class="op" id="2284901">&lt;</span>&nbsp;<span class="ident" id="2284903">m</span>&nbsp;<span class="op" id="2284905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284910">dst</span>&nbsp;<span class="op" id="2284914">=</span>&nbsp;<span class="builtinfunc" id="2284916">append</span><span class="op" id="2284922">(</span><span class="ident" id="2284923">dst</span><span class="op" id="2284926">,</span>&nbsp;<span class="ident" id="2284928">d</span><span class="op" id="2284929">.</span><span class="ident" id="2284930">d</span><span class="op" id="2284931">[</span><span class="ident" id="2284932">i</span><span class="op" id="2284933">]</span><span class="op" id="2284934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284939">i</span><span class="op" id="2284940">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2284945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2284949">for</span>&nbsp;<span class="ident" id="2284953">i</span>&nbsp;<span class="op" id="2284955">&lt;=</span>&nbsp;<span class="ident" id="2284958">prec</span>&nbsp;<span class="op" id="2284963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284968">dst</span>&nbsp;<span class="op" id="2284972">=</span>&nbsp;<span class="builtinfunc" id="2284974">append</span><span class="op" id="2284980">(</span><span class="ident" id="2284981">dst</span><span class="op" id="2284984">,</span>&nbsp;<span class="string" id="2284986">&#39;0&#39;</span><span class="op" id="2284989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2284994">i</span><span class="op" id="2284995">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285000">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285007">//&nbsp;e±</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285015">dst</span>&nbsp;<span class="op" id="2285019">=</span>&nbsp;<span class="builtinfunc" id="2285021">append</span><span class="op" id="2285027">(</span><span class="ident" id="2285028">dst</span><span class="op" id="2285031">,</span>&nbsp;<span class="ident" id="2285033">fmt</span><span class="op" id="2285036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285039">exp</span>&nbsp;<span class="op" id="2285043">:=</span>&nbsp;<span class="ident" id="2285046">d</span><span class="op" id="2285047">.</span><span class="ident" id="2285048">dp</span>&nbsp;<span class="op" id="2285051">-</span>&nbsp;<span class="num" id="2285053">1</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285056">if</span>&nbsp;<span class="ident" id="2285059">d</span><span class="op" id="2285060">.</span><span class="ident" id="2285061">nd</span>&nbsp;<span class="op" id="2285064">==</span>&nbsp;<span class="num" id="2285067">0</span>&nbsp;<span class="op" id="2285069">{</span>&nbsp;<span class="comment" id="2285071">//&nbsp;special&nbsp;case:&nbsp;0&nbsp;has&nbsp;exponent&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285107">exp</span>&nbsp;<span class="op" id="2285111">=</span>&nbsp;<span class="num" id="2285113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285119">if</span>&nbsp;<span class="ident" id="2285122">exp</span>&nbsp;<span class="op" id="2285126">&lt;</span>&nbsp;<span class="num" id="2285128">0</span>&nbsp;<span class="op" id="2285130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285134">ch</span>&nbsp;<span class="op" id="2285137">=</span>&nbsp;<span class="string" id="2285139">&#39;-&#39;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285145">exp</span>&nbsp;<span class="op" id="2285149">=</span>&nbsp;<span class="op" id="2285151">-</span><span class="ident" id="2285152">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285157">}</span>&nbsp;<span class="keyword" id="2285159">else</span>&nbsp;<span class="op" id="2285164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285168">ch</span>&nbsp;<span class="op" id="2285171">=</span>&nbsp;<span class="string" id="2285173">&#39;+&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285181">dst</span>&nbsp;<span class="op" id="2285185">=</span>&nbsp;<span class="builtinfunc" id="2285187">append</span><span class="op" id="2285193">(</span><span class="ident" id="2285194">dst</span><span class="op" id="2285197">,</span>&nbsp;<span class="ident" id="2285199">ch</span><span class="op" id="2285201">)</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285205">//&nbsp;dddd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285214">var</span>&nbsp;<span class="ident" id="2285218">buf</span>&nbsp;<span class="op" id="2285222">[</span><span class="num" id="2285223">3</span><span class="op" id="2285224">]</span><span class="builtintype" id="2285225">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285231">i</span>&nbsp;<span class="op" id="2285233">:=</span>&nbsp;<span class="builtinfunc" id="2285236">len</span><span class="op" id="2285239">(</span><span class="ident" id="2285240">buf</span><span class="op" id="2285243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285246">for</span>&nbsp;<span class="ident" id="2285250">exp</span>&nbsp;<span class="op" id="2285254">&gt;=</span>&nbsp;<span class="num" id="2285257">10</span>&nbsp;<span class="op" id="2285260">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285264">i</span><span class="op" id="2285265">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285270">buf</span><span class="op" id="2285273">[</span><span class="ident" id="2285274">i</span><span class="op" id="2285275">]</span>&nbsp;<span class="op" id="2285277">=</span>&nbsp;<span class="builtintype" id="2285279">byte</span><span class="op" id="2285283">(</span><span class="ident" id="2285284">exp</span><span class="op" id="2285287">%</span><span class="num" id="2285288">10</span>&nbsp;<span class="op" id="2285291">+</span>&nbsp;<span class="string" id="2285293">&#39;0&#39;</span><span class="op" id="2285296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285300">exp</span>&nbsp;<span class="op" id="2285304">/=</span>&nbsp;<span class="num" id="2285307">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285314">//&nbsp;exp&nbsp;&lt;&nbsp;10</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285327">i</span><span class="op" id="2285328">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285332">buf</span><span class="op" id="2285335">[</span><span class="ident" id="2285336">i</span><span class="op" id="2285337">]</span>&nbsp;<span class="op" id="2285339">=</span>&nbsp;<span class="builtintype" id="2285341">byte</span><span class="op" id="2285345">(</span><span class="ident" id="2285346">exp</span>&nbsp;<span class="op" id="2285350">+</span>&nbsp;<span class="string" id="2285352">&#39;0&#39;</span><span class="op" id="2285355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285359">switch</span>&nbsp;<span class="ident" id="2285366">i</span>&nbsp;<span class="op" id="2285368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285371">case</span>&nbsp;<span class="num" id="2285376">0</span><span class="op" id="2285377">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285381">dst</span>&nbsp;<span class="op" id="2285385">=</span>&nbsp;<span class="builtinfunc" id="2285387">append</span><span class="op" id="2285393">(</span><span class="ident" id="2285394">dst</span><span class="op" id="2285397">,</span>&nbsp;<span class="ident" id="2285399">buf</span><span class="op" id="2285402">[</span><span class="num" id="2285403">0</span><span class="op" id="2285404">]</span><span class="op" id="2285405">,</span>&nbsp;<span class="ident" id="2285407">buf</span><span class="op" id="2285410">[</span><span class="num" id="2285411">1</span><span class="op" id="2285412">]</span><span class="op" id="2285413">,</span>&nbsp;<span class="ident" id="2285415">buf</span><span class="op" id="2285418">[</span><span class="num" id="2285419">2</span><span class="op" id="2285420">]</span><span class="op" id="2285421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285424">case</span>&nbsp;<span class="num" id="2285429">1</span><span class="op" id="2285430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285434">dst</span>&nbsp;<span class="op" id="2285438">=</span>&nbsp;<span class="builtinfunc" id="2285440">append</span><span class="op" id="2285446">(</span><span class="ident" id="2285447">dst</span><span class="op" id="2285450">,</span>&nbsp;<span class="ident" id="2285452">buf</span><span class="op" id="2285455">[</span><span class="num" id="2285456">1</span><span class="op" id="2285457">]</span><span class="op" id="2285458">,</span>&nbsp;<span class="ident" id="2285460">buf</span><span class="op" id="2285463">[</span><span class="num" id="2285464">2</span><span class="op" id="2285465">]</span><span class="op" id="2285466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285469">case</span>&nbsp;<span class="num" id="2285474">2</span><span class="op" id="2285475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285479">//&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285499">dst</span>&nbsp;<span class="op" id="2285503">=</span>&nbsp;<span class="builtinfunc" id="2285505">append</span><span class="op" id="2285511">(</span><span class="ident" id="2285512">dst</span><span class="op" id="2285515">,</span>&nbsp;<span class="string" id="2285517">&#39;0&#39;</span><span class="op" id="2285520">,</span>&nbsp;<span class="ident" id="2285522">buf</span><span class="op" id="2285525">[</span><span class="num" id="2285526">2</span><span class="op" id="2285527">]</span><span class="op" id="2285528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285534">return</span>&nbsp;<span class="ident" id="2285541">dst</span><br>
<span class="lineno"></span><span class="op" id="2285545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="comment" id="2285548">//&nbsp;%f:&nbsp;-ddddddd.ddddd</span><br>
<span class="lineno"></span><span class="keyword" id="2285570">func</span>&nbsp;<span class="ident" id="2285575">fmtF</span><span class="op" id="2285579">(</span><span class="ident" id="2285580">dst</span>&nbsp;<span class="op" id="2285584">[</span><span class="op" id="2285585">]</span><span class="builtintype" id="2285586">byte</span><span class="op" id="2285590">,</span>&nbsp;<span class="ident" id="2285592">neg</span>&nbsp;<span class="builtintype" id="2285596">bool</span><span class="op" id="2285600">,</span>&nbsp;<span class="ident" id="2285602">d</span>&nbsp;<span class="ident" id="2285604">decimalSlice</span><span class="op" id="2285616">,</span>&nbsp;<span class="ident" id="2285618">prec</span>&nbsp;<span class="builtintype" id="2285623">int</span><span class="op" id="2285626">)</span>&nbsp;<span class="op" id="2285628">[</span><span class="op" id="2285629">]</span><span class="builtintype" id="2285630">byte</span>&nbsp;<span class="op" id="2285635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285638">//&nbsp;sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285647">if</span>&nbsp;<span class="ident" id="2285650">neg</span>&nbsp;<span class="op" id="2285654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285658">dst</span>&nbsp;<span class="op" id="2285662">=</span>&nbsp;<span class="builtinfunc" id="2285664">append</span><span class="op" id="2285670">(</span><span class="ident" id="2285671">dst</span><span class="op" id="2285674">,</span>&nbsp;<span class="string" id="2285676">&#39;-&#39;</span><span class="op" id="2285679">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285686">//&nbsp;integer,&nbsp;padded&nbsp;with&nbsp;zeros&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285728">if</span>&nbsp;<span class="ident" id="2285731">d</span><span class="op" id="2285732">.</span><span class="ident" id="2285733">dp</span>&nbsp;<span class="op" id="2285736">&gt;</span>&nbsp;<span class="num" id="2285738">0</span>&nbsp;<span class="op" id="2285740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285744">var</span>&nbsp;<span class="ident" id="2285748">i</span>&nbsp;<span class="builtintype" id="2285750">int</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285756">for</span>&nbsp;<span class="ident" id="2285760">i</span>&nbsp;<span class="op" id="2285762">=</span>&nbsp;<span class="num" id="2285764">0</span><span class="op" id="2285765">;</span>&nbsp;<span class="ident" id="2285767">i</span>&nbsp;<span class="op" id="2285769">&lt;</span>&nbsp;<span class="ident" id="2285771">d</span><span class="op" id="2285772">.</span><span class="ident" id="2285773">dp</span>&nbsp;<span class="op" id="2285776">&amp;&amp;</span>&nbsp;<span class="ident" id="2285779">i</span>&nbsp;<span class="op" id="2285781">&lt;</span>&nbsp;<span class="ident" id="2285783">d</span><span class="op" id="2285784">.</span><span class="ident" id="2285785">nd</span><span class="op" id="2285787">;</span>&nbsp;<span class="ident" id="2285789">i</span><span class="op" id="2285790">++</span>&nbsp;<span class="op" id="2285793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285798">dst</span>&nbsp;<span class="op" id="2285802">=</span>&nbsp;<span class="builtinfunc" id="2285804">append</span><span class="op" id="2285810">(</span><span class="ident" id="2285811">dst</span><span class="op" id="2285814">,</span>&nbsp;<span class="ident" id="2285816">d</span><span class="op" id="2285817">.</span><span class="ident" id="2285818">d</span><span class="op" id="2285819">[</span><span class="ident" id="2285820">i</span><span class="op" id="2285821">]</span><span class="op" id="2285822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285830">for</span>&nbsp;<span class="op" id="2285834">;</span>&nbsp;<span class="ident" id="2285836">i</span>&nbsp;<span class="op" id="2285838">&lt;</span>&nbsp;<span class="ident" id="2285840">d</span><span class="op" id="2285841">.</span><span class="ident" id="2285842">dp</span><span class="op" id="2285844">;</span>&nbsp;<span class="ident" id="2285846">i</span><span class="op" id="2285847">++</span>&nbsp;<span class="op" id="2285850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285855">dst</span>&nbsp;<span class="op" id="2285859">=</span>&nbsp;<span class="builtinfunc" id="2285861">append</span><span class="op" id="2285867">(</span><span class="ident" id="2285868">dst</span><span class="op" id="2285871">,</span>&nbsp;<span class="string" id="2285873">&#39;0&#39;</span><span class="op" id="2285876">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285883">}</span>&nbsp;<span class="keyword" id="2285885">else</span>&nbsp;<span class="op" id="2285890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285894">dst</span>&nbsp;<span class="op" id="2285898">=</span>&nbsp;<span class="builtinfunc" id="2285900">append</span><span class="op" id="2285906">(</span><span class="ident" id="2285907">dst</span><span class="op" id="2285910">,</span>&nbsp;<span class="string" id="2285912">&#39;0&#39;</span><span class="op" id="2285915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2285918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2285922">//&nbsp;fraction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285935">if</span>&nbsp;<span class="ident" id="2285938">prec</span>&nbsp;<span class="op" id="2285943">&gt;</span>&nbsp;<span class="num" id="2285945">0</span>&nbsp;<span class="op" id="2285947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2285951">dst</span>&nbsp;<span class="op" id="2285955">=</span>&nbsp;<span class="builtinfunc" id="2285957">append</span><span class="op" id="2285963">(</span><span class="ident" id="2285964">dst</span><span class="op" id="2285967">,</span>&nbsp;<span class="string" id="2285969">&#39;.&#39;</span><span class="op" id="2285972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2285976">for</span>&nbsp;<span class="ident" id="2285980">i</span>&nbsp;<span class="op" id="2285982">:=</span>&nbsp;<span class="num" id="2285985">0</span><span class="op" id="2285986">;</span>&nbsp;<span class="ident" id="2285988">i</span>&nbsp;<span class="op" id="2285990">&lt;</span>&nbsp;<span class="ident" id="2285992">prec</span><span class="op" id="2285996">;</span>&nbsp;<span class="ident" id="2285998">i</span><span class="op" id="2285999">++</span>&nbsp;<span class="op" id="2286002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286007">ch</span>&nbsp;<span class="op" id="2286010">:=</span>&nbsp;<span class="builtintype" id="2286013">byte</span><span class="op" id="2286017">(</span><span class="string" id="2286018">&#39;0&#39;</span><span class="op" id="2286021">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286026">if</span>&nbsp;<span class="ident" id="2286029">j</span>&nbsp;<span class="op" id="2286031">:=</span>&nbsp;<span class="ident" id="2286034">d</span><span class="op" id="2286035">.</span><span class="ident" id="2286036">dp</span>&nbsp;<span class="op" id="2286039">+</span>&nbsp;<span class="ident" id="2286041">i</span><span class="op" id="2286042">;</span>&nbsp;<span class="num" id="2286044">0</span>&nbsp;<span class="op" id="2286046">&lt;=</span>&nbsp;<span class="ident" id="2286049">j</span>&nbsp;<span class="op" id="2286051">&amp;&amp;</span>&nbsp;<span class="ident" id="2286054">j</span>&nbsp;<span class="op" id="2286056">&lt;</span>&nbsp;<span class="ident" id="2286058">d</span><span class="op" id="2286059">.</span><span class="ident" id="2286060">nd</span>&nbsp;<span class="op" id="2286063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286069">ch</span>&nbsp;<span class="op" id="2286072">=</span>&nbsp;<span class="ident" id="2286074">d</span><span class="op" id="2286075">.</span><span class="ident" id="2286076">d</span><span class="op" id="2286077">[</span><span class="ident" id="2286078">j</span><span class="op" id="2286079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286089">dst</span>&nbsp;<span class="op" id="2286093">=</span>&nbsp;<span class="builtinfunc" id="2286095">append</span><span class="op" id="2286101">(</span><span class="ident" id="2286102">dst</span><span class="op" id="2286105">,</span>&nbsp;<span class="ident" id="2286107">ch</span><span class="op" id="2286109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286113">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286120">return</span>&nbsp;<span class="ident" id="2286127">dst</span><br>
<span class="lineno"></span><span class="op" id="2286131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="comment" id="2286134">//&nbsp;%b:&nbsp;-ddddddddp+ddd</span><br>
<span class="lineno"></span><span class="keyword" id="2286156">func</span>&nbsp;<span class="ident" id="2286161">fmtB</span><span class="op" id="2286165">(</span><span class="ident" id="2286166">dst</span>&nbsp;<span class="op" id="2286170">[</span><span class="op" id="2286171">]</span><span class="builtintype" id="2286172">byte</span><span class="op" id="2286176">,</span>&nbsp;<span class="ident" id="2286178">neg</span>&nbsp;<span class="builtintype" id="2286182">bool</span><span class="op" id="2286186">,</span>&nbsp;<span class="ident" id="2286188">mant</span>&nbsp;<span class="ident" id="2286193">uint64</span><span class="op" id="2286199">,</span>&nbsp;<span class="ident" id="2286201">exp</span>&nbsp;<span class="builtintype" id="2286205">int</span><span class="op" id="2286208">,</span>&nbsp;<span class="ident" id="2286210">flt</span>&nbsp;<span class="op" id="2286214">*</span><span class="ident" id="2286215">floatInfo</span><span class="op" id="2286224">)</span>&nbsp;<span class="op" id="2286226">[</span><span class="op" id="2286227">]</span><span class="builtintype" id="2286228">byte</span>&nbsp;<span class="op" id="2286233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286236">var</span>&nbsp;<span class="ident" id="2286240">buf</span>&nbsp;<span class="op" id="2286244">[</span><span class="num" id="2286245">50</span><span class="op" id="2286247">]</span><span class="builtintype" id="2286248">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286254">w</span>&nbsp;<span class="op" id="2286256">:=</span>&nbsp;<span class="builtinfunc" id="2286259">len</span><span class="op" id="2286262">(</span><span class="ident" id="2286263">buf</span><span class="op" id="2286266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286269">exp</span>&nbsp;<span class="op" id="2286273">-=</span>&nbsp;<span class="builtintype" id="2286276">int</span><span class="op" id="2286279">(</span><span class="ident" id="2286280">flt</span><span class="op" id="2286283">.</span><span class="ident" id="2286284">mantbits</span><span class="op" id="2286292">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286295">esign</span>&nbsp;<span class="op" id="2286301">:=</span>&nbsp;<span class="builtintype" id="2286304">byte</span><span class="op" id="2286308">(</span><span class="string" id="2286309">&#39;+&#39;</span><span class="op" id="2286312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286315">if</span>&nbsp;<span class="ident" id="2286318">exp</span>&nbsp;<span class="op" id="2286322">&lt;</span>&nbsp;<span class="num" id="2286324">0</span>&nbsp;<span class="op" id="2286326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286330">esign</span>&nbsp;<span class="op" id="2286336">=</span>&nbsp;<span class="string" id="2286338">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286344">exp</span>&nbsp;<span class="op" id="2286348">=</span>&nbsp;<span class="op" id="2286350">-</span><span class="ident" id="2286351">exp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286356">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286359">n</span>&nbsp;<span class="op" id="2286361">:=</span>&nbsp;<span class="num" id="2286364">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286367">for</span>&nbsp;<span class="ident" id="2286371">exp</span>&nbsp;<span class="op" id="2286375">&gt;</span>&nbsp;<span class="num" id="2286377">0</span>&nbsp;<span class="op" id="2286379">||</span>&nbsp;<span class="ident" id="2286382">n</span>&nbsp;<span class="op" id="2286384">&lt;</span>&nbsp;<span class="num" id="2286386">1</span>&nbsp;<span class="op" id="2286388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286392">n</span><span class="op" id="2286393">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286398">w</span><span class="op" id="2286399">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286404">buf</span><span class="op" id="2286407">[</span><span class="ident" id="2286408">w</span><span class="op" id="2286409">]</span>&nbsp;<span class="op" id="2286411">=</span>&nbsp;<span class="builtintype" id="2286413">byte</span><span class="op" id="2286417">(</span><span class="ident" id="2286418">exp</span><span class="op" id="2286421">%</span><span class="num" id="2286422">10</span>&nbsp;<span class="op" id="2286425">+</span>&nbsp;<span class="string" id="2286427">&#39;0&#39;</span><span class="op" id="2286430">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286434">exp</span>&nbsp;<span class="op" id="2286438">/=</span>&nbsp;<span class="num" id="2286441">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286448">w</span><span class="op" id="2286449">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286453">buf</span><span class="op" id="2286456">[</span><span class="ident" id="2286457">w</span><span class="op" id="2286458">]</span>&nbsp;<span class="op" id="2286460">=</span>&nbsp;<span class="ident" id="2286462">esign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286469">w</span><span class="op" id="2286470">--</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286474">buf</span><span class="op" id="2286477">[</span><span class="ident" id="2286478">w</span><span class="op" id="2286479">]</span>&nbsp;<span class="op" id="2286481">=</span>&nbsp;<span class="string" id="2286483">&#39;p&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286488">n</span>&nbsp;<span class="op" id="2286490">=</span>&nbsp;<span class="num" id="2286492">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286495">for</span>&nbsp;<span class="ident" id="2286499">mant</span>&nbsp;<span class="op" id="2286504">&gt;</span>&nbsp;<span class="num" id="2286506">0</span>&nbsp;<span class="op" id="2286508">||</span>&nbsp;<span class="ident" id="2286511">n</span>&nbsp;<span class="op" id="2286513">&lt;</span>&nbsp;<span class="num" id="2286515">1</span>&nbsp;<span class="op" id="2286517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286521">n</span><span class="op" id="2286522">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286527">w</span><span class="op" id="2286528">--</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286533">buf</span><span class="op" id="2286536">[</span><span class="ident" id="2286537">w</span><span class="op" id="2286538">]</span>&nbsp;<span class="op" id="2286540">=</span>&nbsp;<span class="builtintype" id="2286542">byte</span><span class="op" id="2286546">(</span><span class="ident" id="2286547">mant</span><span class="op" id="2286551">%</span><span class="num" id="2286552">10</span>&nbsp;<span class="op" id="2286555">+</span>&nbsp;<span class="string" id="2286557">&#39;0&#39;</span><span class="op" id="2286560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286564">mant</span>&nbsp;<span class="op" id="2286569">/=</span>&nbsp;<span class="num" id="2286572">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286579">if</span>&nbsp;<span class="ident" id="2286582">neg</span>&nbsp;<span class="op" id="2286586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286590">w</span><span class="op" id="2286591">--</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2286596">buf</span><span class="op" id="2286599">[</span><span class="ident" id="2286600">w</span><span class="op" id="2286601">]</span>&nbsp;<span class="op" id="2286603">=</span>&nbsp;<span class="string" id="2286605">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286613">return</span>&nbsp;<span class="builtinfunc" id="2286620">append</span><span class="op" id="2286626">(</span><span class="ident" id="2286627">dst</span><span class="op" id="2286630">,</span>&nbsp;<span class="ident" id="2286632">buf</span><span class="op" id="2286635">[</span><span class="ident" id="2286636">w</span><span class="op" id="2286637">:</span><span class="op" id="2286638">]</span><span class="op" id="2286639">...</span><span class="op" id="2286642">)</span><br>
<span class="lineno"></span><span class="op" id="2286644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="2286647">func</span>&nbsp;<span class="ident" id="2286652">max</span><span class="op" id="2286655">(</span><span class="ident" id="2286656">a</span><span class="op" id="2286657">,</span>&nbsp;<span class="ident" id="2286659">b</span>&nbsp;<span class="builtintype" id="2286661">int</span><span class="op" id="2286664">)</span>&nbsp;<span class="builtintype" id="2286666">int</span>&nbsp;<span class="op" id="2286670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286673">if</span>&nbsp;<span class="ident" id="2286676">a</span>&nbsp;<span class="op" id="2286678">&gt;</span>&nbsp;<span class="ident" id="2286680">b</span>&nbsp;<span class="op" id="2286682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286686">return</span>&nbsp;<span class="ident" id="2286693">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2286696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2286699">return</span>&nbsp;<span class="ident" id="2286706">b</span><br>
<span class="lineno">475</span><span class="op" id="2286708">}</span>
</div>
</body>
</html>
