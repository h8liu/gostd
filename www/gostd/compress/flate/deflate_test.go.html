<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html" class="current">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6586328">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6586383">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6586437">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6586488">package</span>&nbsp;<span class="ident" id="6586496">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586503">import</span>&nbsp;<span class="op" id="6586510">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586513">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586522">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586529">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586535">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586548">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586559">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6586567">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6586577">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586580">type</span>&nbsp;<span class="ident" id="6586585">deflateTest</span>&nbsp;<span class="keyword" id="6586597">struct</span>&nbsp;<span class="op" id="6586604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586607">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6586613">[</span><span class="op" id="6586614">]</span><span class="builtintype" id="6586615">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586621">level</span>&nbsp;<span class="builtintype" id="6586627">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586632">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6586638">[</span><span class="op" id="6586639">]</span><span class="builtintype" id="6586640">byte</span><br>
<span class="lineno"></span><span class="op" id="6586645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586648">type</span>&nbsp;<span class="ident" id="6586653">deflateInflateTest</span>&nbsp;<span class="keyword" id="6586672">struct</span>&nbsp;<span class="op" id="6586679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586682">in</span>&nbsp;<span class="op" id="6586685">[</span><span class="op" id="6586686">]</span><span class="builtintype" id="6586687">byte</span><br>
<span class="lineno">25</span><span class="op" id="6586692">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586695">type</span>&nbsp;<span class="ident" id="6586700">reverseBitsTest</span>&nbsp;<span class="keyword" id="6586716">struct</span>&nbsp;<span class="op" id="6586723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586726">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6586735">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586743">bitCount</span>&nbsp;<span class="builtintype" id="6586752">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6586759">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6586768">uint16</span><br>
<span class="lineno"></span><span class="op" id="6586775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6586778">var</span>&nbsp;<span class="ident" id="6586782">deflateTests</span>&nbsp;<span class="op" id="6586795">=</span>&nbsp;<span class="op" id="6586797">[</span><span class="op" id="6586798">]</span><span class="op" id="6586799">*</span><span class="ident" id="6586800">deflateTest</span><span class="op" id="6586811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586814">{</span><span class="op" id="6586815">[</span><span class="op" id="6586816">]</span><span class="builtintype" id="6586817">byte</span><span class="op" id="6586821">{</span><span class="op" id="6586822">}</span><span class="op" id="6586823">,</span>&nbsp;<span class="num" id="6586825">0</span><span class="op" id="6586826">,</span>&nbsp;<span class="op" id="6586828">[</span><span class="op" id="6586829">]</span><span class="builtintype" id="6586830">byte</span><span class="op" id="6586834">{</span><span class="num" id="6586835">1</span><span class="op" id="6586836">,</span>&nbsp;<span class="num" id="6586838">0</span><span class="op" id="6586839">,</span>&nbsp;<span class="num" id="6586841">0</span><span class="op" id="6586842">,</span>&nbsp;<span class="num" id="6586844">255</span><span class="op" id="6586847">,</span>&nbsp;<span class="num" id="6586849">255</span><span class="op" id="6586852">}</span><span class="op" id="6586853">}</span><span class="op" id="6586854">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586857">{</span><span class="op" id="6586858">[</span><span class="op" id="6586859">]</span><span class="builtintype" id="6586860">byte</span><span class="op" id="6586864">{</span><span class="num" id="6586865">0x11</span><span class="op" id="6586869">}</span><span class="op" id="6586870">,</span>&nbsp;<span class="op" id="6586872">-</span><span class="num" id="6586873">1</span><span class="op" id="6586874">,</span>&nbsp;<span class="op" id="6586876">[</span><span class="op" id="6586877">]</span><span class="builtintype" id="6586878">byte</span><span class="op" id="6586882">{</span><span class="num" id="6586883">18</span><span class="op" id="6586885">,</span>&nbsp;<span class="num" id="6586887">4</span><span class="op" id="6586888">,</span>&nbsp;<span class="num" id="6586890">4</span><span class="op" id="6586891">,</span>&nbsp;<span class="num" id="6586893">0</span><span class="op" id="6586894">,</span>&nbsp;<span class="num" id="6586896">0</span><span class="op" id="6586897">,</span>&nbsp;<span class="num" id="6586899">255</span><span class="op" id="6586902">,</span>&nbsp;<span class="num" id="6586904">255</span><span class="op" id="6586907">}</span><span class="op" id="6586908">}</span><span class="op" id="6586909">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586912">{</span><span class="op" id="6586913">[</span><span class="op" id="6586914">]</span><span class="builtintype" id="6586915">byte</span><span class="op" id="6586919">{</span><span class="num" id="6586920">0x11</span><span class="op" id="6586924">}</span><span class="op" id="6586925">,</span>&nbsp;<span class="ident" id="6586927">DefaultCompression</span><span class="op" id="6586945">,</span>&nbsp;<span class="op" id="6586947">[</span><span class="op" id="6586948">]</span><span class="builtintype" id="6586949">byte</span><span class="op" id="6586953">{</span><span class="num" id="6586954">18</span><span class="op" id="6586956">,</span>&nbsp;<span class="num" id="6586958">4</span><span class="op" id="6586959">,</span>&nbsp;<span class="num" id="6586961">4</span><span class="op" id="6586962">,</span>&nbsp;<span class="num" id="6586964">0</span><span class="op" id="6586965">,</span>&nbsp;<span class="num" id="6586967">0</span><span class="op" id="6586968">,</span>&nbsp;<span class="num" id="6586970">255</span><span class="op" id="6586973">,</span>&nbsp;<span class="num" id="6586975">255</span><span class="op" id="6586978">}</span><span class="op" id="6586979">}</span><span class="op" id="6586980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6586983">{</span><span class="op" id="6586984">[</span><span class="op" id="6586985">]</span><span class="builtintype" id="6586986">byte</span><span class="op" id="6586990">{</span><span class="num" id="6586991">0x11</span><span class="op" id="6586995">}</span><span class="op" id="6586996">,</span>&nbsp;<span class="num" id="6586998">4</span><span class="op" id="6586999">,</span>&nbsp;<span class="op" id="6587001">[</span><span class="op" id="6587002">]</span><span class="builtintype" id="6587003">byte</span><span class="op" id="6587007">{</span><span class="num" id="6587008">18</span><span class="op" id="6587010">,</span>&nbsp;<span class="num" id="6587012">4</span><span class="op" id="6587013">,</span>&nbsp;<span class="num" id="6587015">4</span><span class="op" id="6587016">,</span>&nbsp;<span class="num" id="6587018">0</span><span class="op" id="6587019">,</span>&nbsp;<span class="num" id="6587021">0</span><span class="op" id="6587022">,</span>&nbsp;<span class="num" id="6587024">255</span><span class="op" id="6587027">,</span>&nbsp;<span class="num" id="6587029">255</span><span class="op" id="6587032">}</span><span class="op" id="6587033">}</span><span class="op" id="6587034">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587038">{</span><span class="op" id="6587039">[</span><span class="op" id="6587040">]</span><span class="builtintype" id="6587041">byte</span><span class="op" id="6587045">{</span><span class="num" id="6587046">0x11</span><span class="op" id="6587050">}</span><span class="op" id="6587051">,</span>&nbsp;<span class="num" id="6587053">0</span><span class="op" id="6587054">,</span>&nbsp;<span class="op" id="6587056">[</span><span class="op" id="6587057">]</span><span class="builtintype" id="6587058">byte</span><span class="op" id="6587062">{</span><span class="num" id="6587063">0</span><span class="op" id="6587064">,</span>&nbsp;<span class="num" id="6587066">1</span><span class="op" id="6587067">,</span>&nbsp;<span class="num" id="6587069">0</span><span class="op" id="6587070">,</span>&nbsp;<span class="num" id="6587072">254</span><span class="op" id="6587075">,</span>&nbsp;<span class="num" id="6587077">255</span><span class="op" id="6587080">,</span>&nbsp;<span class="num" id="6587082">17</span><span class="op" id="6587084">,</span>&nbsp;<span class="num" id="6587086">1</span><span class="op" id="6587087">,</span>&nbsp;<span class="num" id="6587089">0</span><span class="op" id="6587090">,</span>&nbsp;<span class="num" id="6587092">0</span><span class="op" id="6587093">,</span>&nbsp;<span class="num" id="6587095">255</span><span class="op" id="6587098">,</span>&nbsp;<span class="num" id="6587100">255</span><span class="op" id="6587103">}</span><span class="op" id="6587104">}</span><span class="op" id="6587105">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587108">{</span><span class="op" id="6587109">[</span><span class="op" id="6587110">]</span><span class="builtintype" id="6587111">byte</span><span class="op" id="6587115">{</span><span class="num" id="6587116">0x11</span><span class="op" id="6587120">,</span>&nbsp;<span class="num" id="6587122">0x12</span><span class="op" id="6587126">}</span><span class="op" id="6587127">,</span>&nbsp;<span class="num" id="6587129">0</span><span class="op" id="6587130">,</span>&nbsp;<span class="op" id="6587132">[</span><span class="op" id="6587133">]</span><span class="builtintype" id="6587134">byte</span><span class="op" id="6587138">{</span><span class="num" id="6587139">0</span><span class="op" id="6587140">,</span>&nbsp;<span class="num" id="6587142">2</span><span class="op" id="6587143">,</span>&nbsp;<span class="num" id="6587145">0</span><span class="op" id="6587146">,</span>&nbsp;<span class="num" id="6587148">253</span><span class="op" id="6587151">,</span>&nbsp;<span class="num" id="6587153">255</span><span class="op" id="6587156">,</span>&nbsp;<span class="num" id="6587158">17</span><span class="op" id="6587160">,</span>&nbsp;<span class="num" id="6587162">18</span><span class="op" id="6587164">,</span>&nbsp;<span class="num" id="6587166">1</span><span class="op" id="6587167">,</span>&nbsp;<span class="num" id="6587169">0</span><span class="op" id="6587170">,</span>&nbsp;<span class="num" id="6587172">0</span><span class="op" id="6587173">,</span>&nbsp;<span class="num" id="6587175">255</span><span class="op" id="6587178">,</span>&nbsp;<span class="num" id="6587180">255</span><span class="op" id="6587183">}</span><span class="op" id="6587184">}</span><span class="op" id="6587185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587188">{</span><span class="op" id="6587189">[</span><span class="op" id="6587190">]</span><span class="builtintype" id="6587191">byte</span><span class="op" id="6587195">{</span><span class="num" id="6587196">0x11</span><span class="op" id="6587200">,</span>&nbsp;<span class="num" id="6587202">0x11</span><span class="op" id="6587206">,</span>&nbsp;<span class="num" id="6587208">0x11</span><span class="op" id="6587212">,</span>&nbsp;<span class="num" id="6587214">0x11</span><span class="op" id="6587218">,</span>&nbsp;<span class="num" id="6587220">0x11</span><span class="op" id="6587224">,</span>&nbsp;<span class="num" id="6587226">0x11</span><span class="op" id="6587230">,</span>&nbsp;<span class="num" id="6587232">0x11</span><span class="op" id="6587236">,</span>&nbsp;<span class="num" id="6587238">0x11</span><span class="op" id="6587242">}</span><span class="op" id="6587243">,</span>&nbsp;<span class="num" id="6587245">0</span><span class="op" id="6587246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587250">[</span><span class="op" id="6587251">]</span><span class="builtintype" id="6587252">byte</span><span class="op" id="6587256">{</span><span class="num" id="6587257">0</span><span class="op" id="6587258">,</span>&nbsp;<span class="num" id="6587260">8</span><span class="op" id="6587261">,</span>&nbsp;<span class="num" id="6587263">0</span><span class="op" id="6587264">,</span>&nbsp;<span class="num" id="6587266">247</span><span class="op" id="6587269">,</span>&nbsp;<span class="num" id="6587271">255</span><span class="op" id="6587274">,</span>&nbsp;<span class="num" id="6587276">17</span><span class="op" id="6587278">,</span>&nbsp;<span class="num" id="6587280">17</span><span class="op" id="6587282">,</span>&nbsp;<span class="num" id="6587284">17</span><span class="op" id="6587286">,</span>&nbsp;<span class="num" id="6587288">17</span><span class="op" id="6587290">,</span>&nbsp;<span class="num" id="6587292">17</span><span class="op" id="6587294">,</span>&nbsp;<span class="num" id="6587296">17</span><span class="op" id="6587298">,</span>&nbsp;<span class="num" id="6587300">17</span><span class="op" id="6587302">,</span>&nbsp;<span class="num" id="6587304">17</span><span class="op" id="6587306">,</span>&nbsp;<span class="num" id="6587308">1</span><span class="op" id="6587309">,</span>&nbsp;<span class="num" id="6587311">0</span><span class="op" id="6587312">,</span>&nbsp;<span class="num" id="6587314">0</span><span class="op" id="6587315">,</span>&nbsp;<span class="num" id="6587317">255</span><span class="op" id="6587320">,</span>&nbsp;<span class="num" id="6587322">255</span><span class="op" id="6587325">}</span><span class="op" id="6587326">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587329">}</span><span class="op" id="6587330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587333">{</span><span class="op" id="6587334">[</span><span class="op" id="6587335">]</span><span class="builtintype" id="6587336">byte</span><span class="op" id="6587340">{</span><span class="op" id="6587341">}</span><span class="op" id="6587342">,</span>&nbsp;<span class="num" id="6587344">1</span><span class="op" id="6587345">,</span>&nbsp;<span class="op" id="6587347">[</span><span class="op" id="6587348">]</span><span class="builtintype" id="6587349">byte</span><span class="op" id="6587353">{</span><span class="num" id="6587354">1</span><span class="op" id="6587355">,</span>&nbsp;<span class="num" id="6587357">0</span><span class="op" id="6587358">,</span>&nbsp;<span class="num" id="6587360">0</span><span class="op" id="6587361">,</span>&nbsp;<span class="num" id="6587363">255</span><span class="op" id="6587366">,</span>&nbsp;<span class="num" id="6587368">255</span><span class="op" id="6587371">}</span><span class="op" id="6587372">}</span><span class="op" id="6587373">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587376">{</span><span class="op" id="6587377">[</span><span class="op" id="6587378">]</span><span class="builtintype" id="6587379">byte</span><span class="op" id="6587383">{</span><span class="num" id="6587384">0x11</span><span class="op" id="6587388">}</span><span class="op" id="6587389">,</span>&nbsp;<span class="num" id="6587391">1</span><span class="op" id="6587392">,</span>&nbsp;<span class="op" id="6587394">[</span><span class="op" id="6587395">]</span><span class="builtintype" id="6587396">byte</span><span class="op" id="6587400">{</span><span class="num" id="6587401">18</span><span class="op" id="6587403">,</span>&nbsp;<span class="num" id="6587405">4</span><span class="op" id="6587406">,</span>&nbsp;<span class="num" id="6587408">4</span><span class="op" id="6587409">,</span>&nbsp;<span class="num" id="6587411">0</span><span class="op" id="6587412">,</span>&nbsp;<span class="num" id="6587414">0</span><span class="op" id="6587415">,</span>&nbsp;<span class="num" id="6587417">255</span><span class="op" id="6587420">,</span>&nbsp;<span class="num" id="6587422">255</span><span class="op" id="6587425">}</span><span class="op" id="6587426">}</span><span class="op" id="6587427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587430">{</span><span class="op" id="6587431">[</span><span class="op" id="6587432">]</span><span class="builtintype" id="6587433">byte</span><span class="op" id="6587437">{</span><span class="num" id="6587438">0x11</span><span class="op" id="6587442">,</span>&nbsp;<span class="num" id="6587444">0x12</span><span class="op" id="6587448">}</span><span class="op" id="6587449">,</span>&nbsp;<span class="num" id="6587451">1</span><span class="op" id="6587452">,</span>&nbsp;<span class="op" id="6587454">[</span><span class="op" id="6587455">]</span><span class="builtintype" id="6587456">byte</span><span class="op" id="6587460">{</span><span class="num" id="6587461">18</span><span class="op" id="6587463">,</span>&nbsp;<span class="num" id="6587465">20</span><span class="op" id="6587467">,</span>&nbsp;<span class="num" id="6587469">2</span><span class="op" id="6587470">,</span>&nbsp;<span class="num" id="6587472">4</span><span class="op" id="6587473">,</span>&nbsp;<span class="num" id="6587475">0</span><span class="op" id="6587476">,</span>&nbsp;<span class="num" id="6587478">0</span><span class="op" id="6587479">,</span>&nbsp;<span class="num" id="6587481">255</span><span class="op" id="6587484">,</span>&nbsp;<span class="num" id="6587486">255</span><span class="op" id="6587489">}</span><span class="op" id="6587490">}</span><span class="op" id="6587491">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587494">{</span><span class="op" id="6587495">[</span><span class="op" id="6587496">]</span><span class="builtintype" id="6587497">byte</span><span class="op" id="6587501">{</span><span class="num" id="6587502">0x11</span><span class="op" id="6587506">,</span>&nbsp;<span class="num" id="6587508">0x11</span><span class="op" id="6587512">,</span>&nbsp;<span class="num" id="6587514">0x11</span><span class="op" id="6587518">,</span>&nbsp;<span class="num" id="6587520">0x11</span><span class="op" id="6587524">,</span>&nbsp;<span class="num" id="6587526">0x11</span><span class="op" id="6587530">,</span>&nbsp;<span class="num" id="6587532">0x11</span><span class="op" id="6587536">,</span>&nbsp;<span class="num" id="6587538">0x11</span><span class="op" id="6587542">,</span>&nbsp;<span class="num" id="6587544">0x11</span><span class="op" id="6587548">}</span><span class="op" id="6587549">,</span>&nbsp;<span class="num" id="6587551">1</span><span class="op" id="6587552">,</span>&nbsp;<span class="op" id="6587554">[</span><span class="op" id="6587555">]</span><span class="builtintype" id="6587556">byte</span><span class="op" id="6587560">{</span><span class="num" id="6587561">18</span><span class="op" id="6587563">,</span>&nbsp;<span class="num" id="6587565">132</span><span class="op" id="6587568">,</span>&nbsp;<span class="num" id="6587570">2</span><span class="op" id="6587571">,</span>&nbsp;<span class="num" id="6587573">64</span><span class="op" id="6587575">,</span>&nbsp;<span class="num" id="6587577">0</span><span class="op" id="6587578">,</span>&nbsp;<span class="num" id="6587580">0</span><span class="op" id="6587581">,</span>&nbsp;<span class="num" id="6587583">0</span><span class="op" id="6587584">,</span>&nbsp;<span class="num" id="6587586">255</span><span class="op" id="6587589">,</span>&nbsp;<span class="num" id="6587591">255</span><span class="op" id="6587594">}</span><span class="op" id="6587595">}</span><span class="op" id="6587596">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587599">{</span><span class="op" id="6587600">[</span><span class="op" id="6587601">]</span><span class="builtintype" id="6587602">byte</span><span class="op" id="6587606">{</span><span class="op" id="6587607">}</span><span class="op" id="6587608">,</span>&nbsp;<span class="num" id="6587610">9</span><span class="op" id="6587611">,</span>&nbsp;<span class="op" id="6587613">[</span><span class="op" id="6587614">]</span><span class="builtintype" id="6587615">byte</span><span class="op" id="6587619">{</span><span class="num" id="6587620">1</span><span class="op" id="6587621">,</span>&nbsp;<span class="num" id="6587623">0</span><span class="op" id="6587624">,</span>&nbsp;<span class="num" id="6587626">0</span><span class="op" id="6587627">,</span>&nbsp;<span class="num" id="6587629">255</span><span class="op" id="6587632">,</span>&nbsp;<span class="num" id="6587634">255</span><span class="op" id="6587637">}</span><span class="op" id="6587638">}</span><span class="op" id="6587639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587642">{</span><span class="op" id="6587643">[</span><span class="op" id="6587644">]</span><span class="builtintype" id="6587645">byte</span><span class="op" id="6587649">{</span><span class="num" id="6587650">0x11</span><span class="op" id="6587654">}</span><span class="op" id="6587655">,</span>&nbsp;<span class="num" id="6587657">9</span><span class="op" id="6587658">,</span>&nbsp;<span class="op" id="6587660">[</span><span class="op" id="6587661">]</span><span class="builtintype" id="6587662">byte</span><span class="op" id="6587666">{</span><span class="num" id="6587667">18</span><span class="op" id="6587669">,</span>&nbsp;<span class="num" id="6587671">4</span><span class="op" id="6587672">,</span>&nbsp;<span class="num" id="6587674">4</span><span class="op" id="6587675">,</span>&nbsp;<span class="num" id="6587677">0</span><span class="op" id="6587678">,</span>&nbsp;<span class="num" id="6587680">0</span><span class="op" id="6587681">,</span>&nbsp;<span class="num" id="6587683">255</span><span class="op" id="6587686">,</span>&nbsp;<span class="num" id="6587688">255</span><span class="op" id="6587691">}</span><span class="op" id="6587692">}</span><span class="op" id="6587693">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587696">{</span><span class="op" id="6587697">[</span><span class="op" id="6587698">]</span><span class="builtintype" id="6587699">byte</span><span class="op" id="6587703">{</span><span class="num" id="6587704">0x11</span><span class="op" id="6587708">,</span>&nbsp;<span class="num" id="6587710">0x12</span><span class="op" id="6587714">}</span><span class="op" id="6587715">,</span>&nbsp;<span class="num" id="6587717">9</span><span class="op" id="6587718">,</span>&nbsp;<span class="op" id="6587720">[</span><span class="op" id="6587721">]</span><span class="builtintype" id="6587722">byte</span><span class="op" id="6587726">{</span><span class="num" id="6587727">18</span><span class="op" id="6587729">,</span>&nbsp;<span class="num" id="6587731">20</span><span class="op" id="6587733">,</span>&nbsp;<span class="num" id="6587735">2</span><span class="op" id="6587736">,</span>&nbsp;<span class="num" id="6587738">4</span><span class="op" id="6587739">,</span>&nbsp;<span class="num" id="6587741">0</span><span class="op" id="6587742">,</span>&nbsp;<span class="num" id="6587744">0</span><span class="op" id="6587745">,</span>&nbsp;<span class="num" id="6587747">255</span><span class="op" id="6587750">,</span>&nbsp;<span class="num" id="6587752">255</span><span class="op" id="6587755">}</span><span class="op" id="6587756">}</span><span class="op" id="6587757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587760">{</span><span class="op" id="6587761">[</span><span class="op" id="6587762">]</span><span class="builtintype" id="6587763">byte</span><span class="op" id="6587767">{</span><span class="num" id="6587768">0x11</span><span class="op" id="6587772">,</span>&nbsp;<span class="num" id="6587774">0x11</span><span class="op" id="6587778">,</span>&nbsp;<span class="num" id="6587780">0x11</span><span class="op" id="6587784">,</span>&nbsp;<span class="num" id="6587786">0x11</span><span class="op" id="6587790">,</span>&nbsp;<span class="num" id="6587792">0x11</span><span class="op" id="6587796">,</span>&nbsp;<span class="num" id="6587798">0x11</span><span class="op" id="6587802">,</span>&nbsp;<span class="num" id="6587804">0x11</span><span class="op" id="6587808">,</span>&nbsp;<span class="num" id="6587810">0x11</span><span class="op" id="6587814">}</span><span class="op" id="6587815">,</span>&nbsp;<span class="num" id="6587817">9</span><span class="op" id="6587818">,</span>&nbsp;<span class="op" id="6587820">[</span><span class="op" id="6587821">]</span><span class="builtintype" id="6587822">byte</span><span class="op" id="6587826">{</span><span class="num" id="6587827">18</span><span class="op" id="6587829">,</span>&nbsp;<span class="num" id="6587831">132</span><span class="op" id="6587834">,</span>&nbsp;<span class="num" id="6587836">2</span><span class="op" id="6587837">,</span>&nbsp;<span class="num" id="6587839">64</span><span class="op" id="6587841">,</span>&nbsp;<span class="num" id="6587843">0</span><span class="op" id="6587844">,</span>&nbsp;<span class="num" id="6587846">0</span><span class="op" id="6587847">,</span>&nbsp;<span class="num" id="6587849">0</span><span class="op" id="6587850">,</span>&nbsp;<span class="num" id="6587852">255</span><span class="op" id="6587855">,</span>&nbsp;<span class="num" id="6587857">255</span><span class="op" id="6587860">}</span><span class="op" id="6587861">}</span><span class="op" id="6587862">,</span><br>
<span class="lineno"></span><span class="op" id="6587864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6587867">var</span>&nbsp;<span class="ident" id="6587871">deflateInflateTests</span>&nbsp;<span class="op" id="6587891">=</span>&nbsp;<span class="op" id="6587893">[</span><span class="op" id="6587894">]</span><span class="op" id="6587895">*</span><span class="ident" id="6587896">deflateInflateTest</span><span class="op" id="6587914">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587917">{</span><span class="op" id="6587918">[</span><span class="op" id="6587919">]</span><span class="builtintype" id="6587920">byte</span><span class="op" id="6587924">{</span><span class="op" id="6587925">}</span><span class="op" id="6587926">}</span><span class="op" id="6587927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587930">{</span><span class="op" id="6587931">[</span><span class="op" id="6587932">]</span><span class="builtintype" id="6587933">byte</span><span class="op" id="6587937">{</span><span class="num" id="6587938">0x11</span><span class="op" id="6587942">}</span><span class="op" id="6587943">}</span><span class="op" id="6587944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587947">{</span><span class="op" id="6587948">[</span><span class="op" id="6587949">]</span><span class="builtintype" id="6587950">byte</span><span class="op" id="6587954">{</span><span class="num" id="6587955">0x11</span><span class="op" id="6587959">,</span>&nbsp;<span class="num" id="6587961">0x12</span><span class="op" id="6587965">}</span><span class="op" id="6587966">}</span><span class="op" id="6587967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6587970">{</span><span class="op" id="6587971">[</span><span class="op" id="6587972">]</span><span class="builtintype" id="6587973">byte</span><span class="op" id="6587977">{</span><span class="num" id="6587978">0x11</span><span class="op" id="6587982">,</span>&nbsp;<span class="num" id="6587984">0x11</span><span class="op" id="6587988">,</span>&nbsp;<span class="num" id="6587990">0x11</span><span class="op" id="6587994">,</span>&nbsp;<span class="num" id="6587996">0x11</span><span class="op" id="6588000">,</span>&nbsp;<span class="num" id="6588002">0x11</span><span class="op" id="6588006">,</span>&nbsp;<span class="num" id="6588008">0x11</span><span class="op" id="6588012">,</span>&nbsp;<span class="num" id="6588014">0x11</span><span class="op" id="6588018">,</span>&nbsp;<span class="num" id="6588020">0x11</span><span class="op" id="6588024">}</span><span class="op" id="6588025">}</span><span class="op" id="6588026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588029">{</span><span class="op" id="6588030">[</span><span class="op" id="6588031">]</span><span class="builtintype" id="6588032">byte</span><span class="op" id="6588036">{</span><span class="num" id="6588037">0x11</span><span class="op" id="6588041">,</span>&nbsp;<span class="num" id="6588043">0x10</span><span class="op" id="6588047">,</span>&nbsp;<span class="num" id="6588049">0x13</span><span class="op" id="6588053">,</span>&nbsp;<span class="num" id="6588055">0x41</span><span class="op" id="6588059">,</span>&nbsp;<span class="num" id="6588061">0x21</span><span class="op" id="6588065">,</span>&nbsp;<span class="num" id="6588067">0x21</span><span class="op" id="6588071">,</span>&nbsp;<span class="num" id="6588073">0x41</span><span class="op" id="6588077">,</span>&nbsp;<span class="num" id="6588079">0x13</span><span class="op" id="6588083">,</span>&nbsp;<span class="num" id="6588085">0x87</span><span class="op" id="6588089">,</span>&nbsp;<span class="num" id="6588091">0x78</span><span class="op" id="6588095">,</span>&nbsp;<span class="num" id="6588097">0x13</span><span class="op" id="6588101">}</span><span class="op" id="6588102">}</span><span class="op" id="6588103">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588106">{</span><span class="ident" id="6588107">largeDataChunk</span><span class="op" id="6588121">(</span><span class="op" id="6588122">)</span><span class="op" id="6588123">}</span><span class="op" id="6588124">,</span><br>
<span class="lineno"></span><span class="op" id="6588126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6588129">var</span>&nbsp;<span class="ident" id="6588133">reverseBitsTests</span>&nbsp;<span class="op" id="6588150">=</span>&nbsp;<span class="op" id="6588152">[</span><span class="op" id="6588153">]</span><span class="op" id="6588154">*</span><span class="ident" id="6588155">reverseBitsTest</span><span class="op" id="6588170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588173">{</span><span class="num" id="6588174">1</span><span class="op" id="6588175">,</span>&nbsp;<span class="num" id="6588177">1</span><span class="op" id="6588178">,</span>&nbsp;<span class="num" id="6588180">1</span><span class="op" id="6588181">}</span><span class="op" id="6588182">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588185">{</span><span class="num" id="6588186">1</span><span class="op" id="6588187">,</span>&nbsp;<span class="num" id="6588189">2</span><span class="op" id="6588190">,</span>&nbsp;<span class="num" id="6588192">2</span><span class="op" id="6588193">}</span><span class="op" id="6588194">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588197">{</span><span class="num" id="6588198">1</span><span class="op" id="6588199">,</span>&nbsp;<span class="num" id="6588201">3</span><span class="op" id="6588202">,</span>&nbsp;<span class="num" id="6588204">4</span><span class="op" id="6588205">}</span><span class="op" id="6588206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588209">{</span><span class="num" id="6588210">1</span><span class="op" id="6588211">,</span>&nbsp;<span class="num" id="6588213">4</span><span class="op" id="6588214">,</span>&nbsp;<span class="num" id="6588216">8</span><span class="op" id="6588217">}</span><span class="op" id="6588218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588221">{</span><span class="num" id="6588222">1</span><span class="op" id="6588223">,</span>&nbsp;<span class="num" id="6588225">5</span><span class="op" id="6588226">,</span>&nbsp;<span class="num" id="6588228">16</span><span class="op" id="6588230">}</span><span class="op" id="6588231">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588234">{</span><span class="num" id="6588235">17</span><span class="op" id="6588237">,</span>&nbsp;<span class="num" id="6588239">5</span><span class="op" id="6588240">,</span>&nbsp;<span class="num" id="6588242">17</span><span class="op" id="6588244">}</span><span class="op" id="6588245">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588248">{</span><span class="num" id="6588249">257</span><span class="op" id="6588252">,</span>&nbsp;<span class="num" id="6588254">9</span><span class="op" id="6588255">,</span>&nbsp;<span class="num" id="6588257">257</span><span class="op" id="6588260">}</span><span class="op" id="6588261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588264">{</span><span class="num" id="6588265">29</span><span class="op" id="6588267">,</span>&nbsp;<span class="num" id="6588269">5</span><span class="op" id="6588270">,</span>&nbsp;<span class="num" id="6588272">23</span><span class="op" id="6588274">}</span><span class="op" id="6588275">,</span><br>
<span class="lineno"></span><span class="op" id="6588277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6588280">func</span>&nbsp;<span class="ident" id="6588285">largeDataChunk</span><span class="op" id="6588299">(</span><span class="op" id="6588300">)</span>&nbsp;<span class="op" id="6588302">[</span><span class="op" id="6588303">]</span><span class="builtintype" id="6588304">byte</span>&nbsp;<span class="op" id="6588309">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588312">result</span>&nbsp;<span class="op" id="6588319">:=</span>&nbsp;<span class="builtinfunc" id="6588322">make</span><span class="op" id="6588326">(</span><span class="op" id="6588327">[</span><span class="op" id="6588328">]</span><span class="builtintype" id="6588329">byte</span><span class="op" id="6588333">,</span>&nbsp;<span class="num" id="6588335">100000</span><span class="op" id="6588341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588344">for</span>&nbsp;<span class="ident" id="6588348">i</span>&nbsp;<span class="op" id="6588350">:=</span>&nbsp;<span class="keyword" id="6588353">range</span>&nbsp;<span class="ident" id="6588359">result</span>&nbsp;<span class="op" id="6588366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588370">result</span><span class="op" id="6588376">[</span><span class="ident" id="6588377">i</span><span class="op" id="6588378">]</span>&nbsp;<span class="op" id="6588380">=</span>&nbsp;<span class="builtintype" id="6588382">byte</span><span class="op" id="6588386">(</span><span class="ident" id="6588387">i</span>&nbsp;<span class="op" id="6588389">*</span>&nbsp;<span class="ident" id="6588391">i</span>&nbsp;<span class="op" id="6588393">&amp;</span>&nbsp;<span class="num" id="6588395">0xFF</span><span class="op" id="6588399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588405">return</span>&nbsp;<span class="ident" id="6588412">result</span><br>
<span class="lineno">80</span><span class="op" id="6588419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6588422">func</span>&nbsp;<span class="ident" id="6588427">TestDeflate</span><span class="op" id="6588438">(</span><span class="ident" id="6588439">t</span>&nbsp;<span class="op" id="6588441">*</span><span class="ident" id="6588442">testing</span><span class="op" id="6588449">.</span><span class="ident" id="6588450">T</span><span class="op" id="6588451">)</span>&nbsp;<span class="op" id="6588453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588456">for</span>&nbsp;<span class="ident" id="6588460">_</span><span class="op" id="6588461">,</span>&nbsp;<span class="ident" id="6588463">h</span>&nbsp;<span class="op" id="6588465">:=</span>&nbsp;<span class="keyword" id="6588468">range</span>&nbsp;<span class="ident" id="6588474">deflateTests</span>&nbsp;<span class="op" id="6588487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588491">var</span>&nbsp;<span class="ident" id="6588495">buf</span>&nbsp;<span class="ident" id="6588499">bytes</span><span class="op" id="6588504">.</span><span class="ident" id="6588505">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588514">w</span><span class="op" id="6588515">,</span>&nbsp;<span class="ident" id="6588517">err</span>&nbsp;<span class="op" id="6588521">:=</span>&nbsp;<span class="ident" id="6588524">NewWriter</span><span class="op" id="6588533">(</span><span class="op" id="6588534">&amp;</span><span class="ident" id="6588535">buf</span><span class="op" id="6588538">,</span>&nbsp;<span class="ident" id="6588540">h</span><span class="op" id="6588541">.</span><span class="ident" id="6588542">level</span><span class="op" id="6588547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588551">if</span>&nbsp;<span class="ident" id="6588554">err</span>&nbsp;<span class="op" id="6588558">!=</span>&nbsp;<span class="ident" id="6588561">nil</span>&nbsp;<span class="op" id="6588565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588570">t</span><span class="op" id="6588571">.</span><span class="ident" id="6588572">Errorf</span><span class="op" id="6588578">(</span><span class="string" id="6588579">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6588594">,</span>&nbsp;<span class="ident" id="6588596">err</span><span class="op" id="6588599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588604">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588615">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588619">w</span><span class="op" id="6588620">.</span><span class="ident" id="6588621">Write</span><span class="op" id="6588626">(</span><span class="ident" id="6588627">h</span><span class="op" id="6588628">.</span><span class="ident" id="6588629">in</span><span class="op" id="6588631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588635">w</span><span class="op" id="6588636">.</span><span class="ident" id="6588637">Close</span><span class="op" id="6588642">(</span><span class="op" id="6588643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6588647">if</span>&nbsp;<span class="op" id="6588650">!</span><span class="ident" id="6588651">bytes</span><span class="op" id="6588656">.</span><span class="ident" id="6588657">Equal</span><span class="op" id="6588662">(</span><span class="ident" id="6588663">buf</span><span class="op" id="6588666">.</span><span class="ident" id="6588667">Bytes</span><span class="op" id="6588672">(</span><span class="op" id="6588673">)</span><span class="op" id="6588674">,</span>&nbsp;<span class="ident" id="6588676">h</span><span class="op" id="6588677">.</span><span class="ident" id="6588678">out</span><span class="op" id="6588681">)</span>&nbsp;<span class="op" id="6588683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588688">t</span><span class="op" id="6588689">.</span><span class="ident" id="6588690">Errorf</span><span class="op" id="6588696">(</span><span class="string" id="6588697">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="6588728">,</span>&nbsp;<span class="ident" id="6588730">h</span><span class="op" id="6588731">.</span><span class="ident" id="6588732">level</span><span class="op" id="6588737">,</span>&nbsp;<span class="ident" id="6588739">h</span><span class="op" id="6588740">.</span><span class="ident" id="6588741">in</span><span class="op" id="6588743">,</span>&nbsp;<span class="ident" id="6588745">buf</span><span class="op" id="6588748">.</span><span class="ident" id="6588749">Bytes</span><span class="op" id="6588754">(</span><span class="op" id="6588755">)</span><span class="op" id="6588756">,</span>&nbsp;<span class="ident" id="6588758">h</span><span class="op" id="6588759">.</span><span class="ident" id="6588760">out</span><span class="op" id="6588763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588767">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6588770">}</span><br>
<span class="lineno"></span><span class="op" id="6588772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6588775">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="6588849">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="6588910">type</span>&nbsp;<span class="ident" id="6588915">sparseReader</span>&nbsp;<span class="keyword" id="6588928">struct</span>&nbsp;<span class="op" id="6588935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588938">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6588942">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6588949">cur</span>&nbsp;<span class="ident" id="6588953">int64</span><br>
<span class="lineno"></span><span class="op" id="6588959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6588962">func</span>&nbsp;<span class="op" id="6588967">(</span><span class="ident" id="6588968">r</span>&nbsp;<span class="op" id="6588970">*</span><span class="ident" id="6588971">sparseReader</span><span class="op" id="6588983">)</span>&nbsp;<span class="ident" id="6588985">Read</span><span class="op" id="6588989">(</span><span class="ident" id="6588990">b</span>&nbsp;<span class="op" id="6588992">[</span><span class="op" id="6588993">]</span><span class="builtintype" id="6588994">byte</span><span class="op" id="6588998">)</span>&nbsp;<span class="op" id="6589000">(</span><span class="ident" id="6589001">n</span>&nbsp;<span class="builtintype" id="6589003">int</span><span class="op" id="6589006">,</span>&nbsp;<span class="ident" id="6589008">err</span>&nbsp;<span class="builtintype" id="6589012">error</span><span class="op" id="6589017">)</span>&nbsp;<span class="op" id="6589019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589022">if</span>&nbsp;<span class="ident" id="6589025">r</span><span class="op" id="6589026">.</span><span class="ident" id="6589027">cur</span>&nbsp;<span class="op" id="6589031">&gt;=</span>&nbsp;<span class="ident" id="6589034">r</span><span class="op" id="6589035">.</span><span class="ident" id="6589036">l</span>&nbsp;<span class="op" id="6589038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589042">return</span>&nbsp;<span class="num" id="6589049">0</span><span class="op" id="6589050">,</span>&nbsp;<span class="ident" id="6589052">io</span><span class="op" id="6589054">.</span><span class="ident" id="6589055">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589063">n</span>&nbsp;<span class="op" id="6589065">=</span>&nbsp;<span class="builtinfunc" id="6589067">len</span><span class="op" id="6589070">(</span><span class="ident" id="6589071">b</span><span class="op" id="6589072">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589075">cur</span>&nbsp;<span class="op" id="6589079">:=</span>&nbsp;<span class="ident" id="6589082">r</span><span class="op" id="6589083">.</span><span class="ident" id="6589084">cur</span>&nbsp;<span class="op" id="6589088">+</span>&nbsp;<span class="ident" id="6589090">int64</span><span class="op" id="6589095">(</span><span class="ident" id="6589096">n</span><span class="op" id="6589097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589100">if</span>&nbsp;<span class="ident" id="6589103">cur</span>&nbsp;<span class="op" id="6589107">&gt;</span>&nbsp;<span class="ident" id="6589109">r</span><span class="op" id="6589110">.</span><span class="ident" id="6589111">l</span>&nbsp;<span class="op" id="6589113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589117">n</span>&nbsp;<span class="op" id="6589119">-=</span>&nbsp;<span class="builtintype" id="6589122">int</span><span class="op" id="6589125">(</span><span class="ident" id="6589126">cur</span>&nbsp;<span class="op" id="6589130">-</span>&nbsp;<span class="ident" id="6589132">r</span><span class="op" id="6589133">.</span><span class="ident" id="6589134">l</span><span class="op" id="6589135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589139">cur</span>&nbsp;<span class="op" id="6589143">=</span>&nbsp;<span class="ident" id="6589145">r</span><span class="op" id="6589146">.</span><span class="ident" id="6589147">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589150">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589153">for</span>&nbsp;<span class="ident" id="6589157">i</span>&nbsp;<span class="op" id="6589159">:=</span>&nbsp;<span class="keyword" id="6589162">range</span>&nbsp;<span class="ident" id="6589168">b</span><span class="op" id="6589169">[</span><span class="num" id="6589170">0</span><span class="op" id="6589171">:</span><span class="ident" id="6589172">n</span><span class="op" id="6589173">]</span>&nbsp;<span class="op" id="6589175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589179">if</span>&nbsp;<span class="ident" id="6589182">r</span><span class="op" id="6589183">.</span><span class="ident" id="6589184">cur</span><span class="op" id="6589187">+</span><span class="ident" id="6589188">int64</span><span class="op" id="6589193">(</span><span class="ident" id="6589194">i</span><span class="op" id="6589195">)</span>&nbsp;<span class="op" id="6589197">&gt;=</span>&nbsp;<span class="ident" id="6589200">r</span><span class="op" id="6589201">.</span><span class="ident" id="6589202">l</span><span class="op" id="6589203">-</span><span class="num" id="6589204">1</span><span class="op" id="6589205">&lt;&lt;</span><span class="num" id="6589207">16</span>&nbsp;<span class="op" id="6589210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589215">b</span><span class="op" id="6589216">[</span><span class="ident" id="6589217">i</span><span class="op" id="6589218">]</span>&nbsp;<span class="op" id="6589220">=</span>&nbsp;<span class="num" id="6589222">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589226">}</span>&nbsp;<span class="keyword" id="6589228">else</span>&nbsp;<span class="op" id="6589233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589238">b</span><span class="op" id="6589239">[</span><span class="ident" id="6589240">i</span><span class="op" id="6589241">]</span>&nbsp;<span class="op" id="6589243">=</span>&nbsp;<span class="num" id="6589245">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589255">r</span><span class="op" id="6589256">.</span><span class="ident" id="6589257">cur</span>&nbsp;<span class="op" id="6589261">=</span>&nbsp;<span class="ident" id="6589263">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589268">return</span><br>
<span class="lineno"></span><span class="op" id="6589275">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6589278">func</span>&nbsp;<span class="ident" id="6589283">TestVeryLongSparseChunk</span><span class="op" id="6589306">(</span><span class="ident" id="6589307">t</span>&nbsp;<span class="op" id="6589309">*</span><span class="ident" id="6589310">testing</span><span class="op" id="6589317">.</span><span class="ident" id="6589318">T</span><span class="op" id="6589319">)</span>&nbsp;<span class="op" id="6589321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589324">if</span>&nbsp;<span class="ident" id="6589327">testing</span><span class="op" id="6589334">.</span><span class="ident" id="6589335">Short</span><span class="op" id="6589340">(</span><span class="op" id="6589341">)</span>&nbsp;<span class="op" id="6589343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589347">t</span><span class="op" id="6589348">.</span><span class="ident" id="6589349">Skip</span><span class="op" id="6589353">(</span><span class="string" id="6589354">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="6589395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589398">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589401">w</span><span class="op" id="6589402">,</span>&nbsp;<span class="ident" id="6589404">err</span>&nbsp;<span class="op" id="6589408">:=</span>&nbsp;<span class="ident" id="6589411">NewWriter</span><span class="op" id="6589420">(</span><span class="ident" id="6589421">ioutil</span><span class="op" id="6589427">.</span><span class="ident" id="6589428">Discard</span><span class="op" id="6589435">,</span>&nbsp;<span class="num" id="6589437">1</span><span class="op" id="6589438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589441">if</span>&nbsp;<span class="ident" id="6589444">err</span>&nbsp;<span class="op" id="6589448">!=</span>&nbsp;<span class="ident" id="6589451">nil</span>&nbsp;<span class="op" id="6589455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589459">t</span><span class="op" id="6589460">.</span><span class="ident" id="6589461">Errorf</span><span class="op" id="6589467">(</span><span class="string" id="6589468">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6589483">,</span>&nbsp;<span class="ident" id="6589485">err</span><span class="op" id="6589488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589492">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589500">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589503">if</span>&nbsp;<span class="ident" id="6589506">_</span><span class="op" id="6589507">,</span>&nbsp;<span class="ident" id="6589509">err</span>&nbsp;<span class="op" id="6589513">=</span>&nbsp;<span class="ident" id="6589515">io</span><span class="op" id="6589517">.</span><span class="ident" id="6589518">Copy</span><span class="op" id="6589522">(</span><span class="ident" id="6589523">w</span><span class="op" id="6589524">,</span>&nbsp;<span class="op" id="6589526">&amp;</span><span class="ident" id="6589527">sparseReader</span><span class="op" id="6589539">{</span><span class="ident" id="6589540">l</span><span class="op" id="6589541">:</span>&nbsp;<span class="num" id="6589543">23E8</span><span class="op" id="6589547">}</span><span class="op" id="6589548">)</span><span class="op" id="6589549">;</span>&nbsp;<span class="ident" id="6589551">err</span>&nbsp;<span class="op" id="6589555">!=</span>&nbsp;<span class="ident" id="6589558">nil</span>&nbsp;<span class="op" id="6589562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589566">t</span><span class="op" id="6589567">.</span><span class="ident" id="6589568">Errorf</span><span class="op" id="6589574">(</span><span class="string" id="6589575">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6589596">,</span>&nbsp;<span class="ident" id="6589598">err</span><span class="op" id="6589601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589605">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589613">}</span><br>
<span class="lineno"></span><span class="op" id="6589615">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6589618">type</span>&nbsp;<span class="ident" id="6589623">syncBuffer</span>&nbsp;<span class="keyword" id="6589634">struct</span>&nbsp;<span class="op" id="6589641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589644">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589651">bytes</span><span class="op" id="6589656">.</span><span class="ident" id="6589657">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589665">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6589672">sync</span><span class="op" id="6589676">.</span><span class="ident" id="6589677">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589686">closed</span>&nbsp;<span class="builtintype" id="6589693">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589699">ready</span>&nbsp;&nbsp;<span class="keyword" id="6589706">chan</span>&nbsp;<span class="builtintype" id="6589711">bool</span><br>
<span class="lineno"></span><span class="op" id="6589716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589719">func</span>&nbsp;<span class="ident" id="6589724">newSyncBuffer</span><span class="op" id="6589737">(</span><span class="op" id="6589738">)</span>&nbsp;<span class="op" id="6589740">*</span><span class="ident" id="6589741">syncBuffer</span>&nbsp;<span class="op" id="6589752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589755">return</span>&nbsp;<span class="op" id="6589762">&amp;</span><span class="ident" id="6589763">syncBuffer</span><span class="op" id="6589773">{</span><span class="ident" id="6589774">ready</span><span class="op" id="6589779">:</span>&nbsp;<span class="builtinfunc" id="6589781">make</span><span class="op" id="6589785">(</span><span class="keyword" id="6589786">chan</span>&nbsp;<span class="builtintype" id="6589791">bool</span><span class="op" id="6589795">,</span>&nbsp;<span class="num" id="6589797">1</span><span class="op" id="6589798">)</span><span class="op" id="6589799">}</span><br>
<span class="lineno">150</span><span class="op" id="6589801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589804">func</span>&nbsp;<span class="op" id="6589809">(</span><span class="ident" id="6589810">b</span>&nbsp;<span class="op" id="6589812">*</span><span class="ident" id="6589813">syncBuffer</span><span class="op" id="6589823">)</span>&nbsp;<span class="ident" id="6589825">Read</span><span class="op" id="6589829">(</span><span class="ident" id="6589830">p</span>&nbsp;<span class="op" id="6589832">[</span><span class="op" id="6589833">]</span><span class="builtintype" id="6589834">byte</span><span class="op" id="6589838">)</span>&nbsp;<span class="op" id="6589840">(</span><span class="ident" id="6589841">n</span>&nbsp;<span class="builtintype" id="6589843">int</span><span class="op" id="6589846">,</span>&nbsp;<span class="ident" id="6589848">err</span>&nbsp;<span class="builtintype" id="6589852">error</span><span class="op" id="6589857">)</span>&nbsp;<span class="op" id="6589859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589862">for</span>&nbsp;<span class="op" id="6589866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589870">b</span><span class="op" id="6589871">.</span><span class="ident" id="6589872">mu</span><span class="op" id="6589874">.</span><span class="ident" id="6589875">RLock</span><span class="op" id="6589880">(</span><span class="op" id="6589881">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589885">n</span><span class="op" id="6589886">,</span>&nbsp;<span class="ident" id="6589888">err</span>&nbsp;<span class="op" id="6589892">=</span>&nbsp;<span class="ident" id="6589894">b</span><span class="op" id="6589895">.</span><span class="ident" id="6589896">buf</span><span class="op" id="6589899">.</span><span class="ident" id="6589900">Read</span><span class="op" id="6589904">(</span><span class="ident" id="6589905">p</span><span class="op" id="6589906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6589910">b</span><span class="op" id="6589911">.</span><span class="ident" id="6589912">mu</span><span class="op" id="6589914">.</span><span class="ident" id="6589915">RUnlock</span><span class="op" id="6589922">(</span><span class="op" id="6589923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589927">if</span>&nbsp;<span class="ident" id="6589930">n</span>&nbsp;<span class="op" id="6589932">&gt;</span>&nbsp;<span class="num" id="6589934">0</span>&nbsp;<span class="op" id="6589936">||</span>&nbsp;<span class="ident" id="6589939">b</span><span class="op" id="6589940">.</span><span class="ident" id="6589941">closed</span>&nbsp;<span class="op" id="6589948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6589953">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589962">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589966">&lt;-</span><span class="ident" id="6589968">b</span><span class="op" id="6589969">.</span><span class="ident" id="6589970">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6589977">}</span><br>
<span class="lineno"></span><span class="op" id="6589979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6589982">func</span>&nbsp;<span class="op" id="6589987">(</span><span class="ident" id="6589988">b</span>&nbsp;<span class="op" id="6589990">*</span><span class="ident" id="6589991">syncBuffer</span><span class="op" id="6590001">)</span>&nbsp;<span class="ident" id="6590003">signal</span><span class="op" id="6590009">(</span><span class="op" id="6590010">)</span>&nbsp;<span class="op" id="6590012">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590015">select</span>&nbsp;<span class="op" id="6590022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590025">case</span>&nbsp;<span class="ident" id="6590030">b</span><span class="op" id="6590031">.</span><span class="ident" id="6590032">ready</span>&nbsp;<span class="op" id="6590038">&lt;-</span>&nbsp;<span class="builtintype" id="6590041">true</span><span class="op" id="6590045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590048">default</span><span class="op" id="6590055">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590058">}</span><br>
<span class="lineno"></span><span class="op" id="6590060">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6590063">func</span>&nbsp;<span class="op" id="6590068">(</span><span class="ident" id="6590069">b</span>&nbsp;<span class="op" id="6590071">*</span><span class="ident" id="6590072">syncBuffer</span><span class="op" id="6590082">)</span>&nbsp;<span class="ident" id="6590084">Write</span><span class="op" id="6590089">(</span><span class="ident" id="6590090">p</span>&nbsp;<span class="op" id="6590092">[</span><span class="op" id="6590093">]</span><span class="builtintype" id="6590094">byte</span><span class="op" id="6590098">)</span>&nbsp;<span class="op" id="6590100">(</span><span class="ident" id="6590101">n</span>&nbsp;<span class="builtintype" id="6590103">int</span><span class="op" id="6590106">,</span>&nbsp;<span class="ident" id="6590108">err</span>&nbsp;<span class="builtintype" id="6590112">error</span><span class="op" id="6590117">)</span>&nbsp;<span class="op" id="6590119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590122">n</span><span class="op" id="6590123">,</span>&nbsp;<span class="ident" id="6590125">err</span>&nbsp;<span class="op" id="6590129">=</span>&nbsp;<span class="ident" id="6590131">b</span><span class="op" id="6590132">.</span><span class="ident" id="6590133">buf</span><span class="op" id="6590136">.</span><span class="ident" id="6590137">Write</span><span class="op" id="6590142">(</span><span class="ident" id="6590143">p</span><span class="op" id="6590144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590147">b</span><span class="op" id="6590148">.</span><span class="ident" id="6590149">signal</span><span class="op" id="6590155">(</span><span class="op" id="6590156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590159">return</span><br>
<span class="lineno">175</span><span class="op" id="6590166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590169">func</span>&nbsp;<span class="op" id="6590174">(</span><span class="ident" id="6590175">b</span>&nbsp;<span class="op" id="6590177">*</span><span class="ident" id="6590178">syncBuffer</span><span class="op" id="6590188">)</span>&nbsp;<span class="ident" id="6590190">WriteMode</span><span class="op" id="6590199">(</span><span class="op" id="6590200">)</span>&nbsp;<span class="op" id="6590202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590205">b</span><span class="op" id="6590206">.</span><span class="ident" id="6590207">mu</span><span class="op" id="6590209">.</span><span class="ident" id="6590210">Lock</span><span class="op" id="6590214">(</span><span class="op" id="6590215">)</span><br>
<span class="lineno"></span><span class="op" id="6590217">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6590220">func</span>&nbsp;<span class="op" id="6590225">(</span><span class="ident" id="6590226">b</span>&nbsp;<span class="op" id="6590228">*</span><span class="ident" id="6590229">syncBuffer</span><span class="op" id="6590239">)</span>&nbsp;<span class="ident" id="6590241">ReadMode</span><span class="op" id="6590249">(</span><span class="op" id="6590250">)</span>&nbsp;<span class="op" id="6590252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590255">b</span><span class="op" id="6590256">.</span><span class="ident" id="6590257">mu</span><span class="op" id="6590259">.</span><span class="ident" id="6590260">Unlock</span><span class="op" id="6590266">(</span><span class="op" id="6590267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590270">b</span><span class="op" id="6590271">.</span><span class="ident" id="6590272">signal</span><span class="op" id="6590278">(</span><span class="op" id="6590279">)</span><br>
<span class="lineno"></span><span class="op" id="6590281">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6590284">func</span>&nbsp;<span class="op" id="6590289">(</span><span class="ident" id="6590290">b</span>&nbsp;<span class="op" id="6590292">*</span><span class="ident" id="6590293">syncBuffer</span><span class="op" id="6590303">)</span>&nbsp;<span class="ident" id="6590305">Close</span><span class="op" id="6590310">(</span><span class="op" id="6590311">)</span>&nbsp;<span class="builtintype" id="6590313">error</span>&nbsp;<span class="op" id="6590319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590322">b</span><span class="op" id="6590323">.</span><span class="ident" id="6590324">closed</span>&nbsp;<span class="op" id="6590331">=</span>&nbsp;<span class="builtintype" id="6590333">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590339">b</span><span class="op" id="6590340">.</span><span class="ident" id="6590341">signal</span><span class="op" id="6590347">(</span><span class="op" id="6590348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590351">return</span>&nbsp;<span class="ident" id="6590358">nil</span><br>
<span class="lineno">190</span><span class="op" id="6590362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6590365">func</span>&nbsp;<span class="ident" id="6590370">testSync</span><span class="op" id="6590378">(</span><span class="ident" id="6590379">t</span>&nbsp;<span class="op" id="6590381">*</span><span class="ident" id="6590382">testing</span><span class="op" id="6590389">.</span><span class="ident" id="6590390">T</span><span class="op" id="6590391">,</span>&nbsp;<span class="ident" id="6590393">level</span>&nbsp;<span class="builtintype" id="6590399">int</span><span class="op" id="6590402">,</span>&nbsp;<span class="ident" id="6590404">input</span>&nbsp;<span class="op" id="6590410">[</span><span class="op" id="6590411">]</span><span class="builtintype" id="6590412">byte</span><span class="op" id="6590416">,</span>&nbsp;<span class="ident" id="6590418">name</span>&nbsp;<span class="builtintype" id="6590423">string</span><span class="op" id="6590429">)</span>&nbsp;<span class="op" id="6590431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590434">if</span>&nbsp;<span class="builtinfunc" id="6590437">len</span><span class="op" id="6590440">(</span><span class="ident" id="6590441">input</span><span class="op" id="6590446">)</span>&nbsp;<span class="op" id="6590448">==</span>&nbsp;<span class="num" id="6590451">0</span>&nbsp;<span class="op" id="6590453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590457">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590469">t</span><span class="op" id="6590470">.</span><span class="ident" id="6590471">Logf</span><span class="op" id="6590475">(</span><span class="string" id="6590476">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="6590499">,</span>&nbsp;<span class="ident" id="6590501">level</span><span class="op" id="6590506">,</span>&nbsp;<span class="builtinfunc" id="6590508">len</span><span class="op" id="6590511">(</span><span class="ident" id="6590512">input</span><span class="op" id="6590517">)</span><span class="op" id="6590518">,</span>&nbsp;<span class="ident" id="6590520">name</span><span class="op" id="6590524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590527">buf</span>&nbsp;<span class="op" id="6590531">:=</span>&nbsp;<span class="ident" id="6590534">newSyncBuffer</span><span class="op" id="6590547">(</span><span class="op" id="6590548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590551">buf1</span>&nbsp;<span class="op" id="6590556">:=</span>&nbsp;<span class="builtinfunc" id="6590559">new</span><span class="op" id="6590562">(</span><span class="ident" id="6590563">bytes</span><span class="op" id="6590568">.</span><span class="ident" id="6590569">Buffer</span><span class="op" id="6590575">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590578">buf</span><span class="op" id="6590581">.</span><span class="ident" id="6590582">WriteMode</span><span class="op" id="6590591">(</span><span class="op" id="6590592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590595">w</span><span class="op" id="6590596">,</span>&nbsp;<span class="ident" id="6590598">err</span>&nbsp;<span class="op" id="6590602">:=</span>&nbsp;<span class="ident" id="6590605">NewWriter</span><span class="op" id="6590614">(</span><span class="ident" id="6590615">io</span><span class="op" id="6590617">.</span><span class="ident" id="6590618">MultiWriter</span><span class="op" id="6590629">(</span><span class="ident" id="6590630">buf</span><span class="op" id="6590633">,</span>&nbsp;<span class="ident" id="6590635">buf1</span><span class="op" id="6590639">)</span><span class="op" id="6590640">,</span>&nbsp;<span class="ident" id="6590642">level</span><span class="op" id="6590647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590650">if</span>&nbsp;<span class="ident" id="6590653">err</span>&nbsp;<span class="op" id="6590657">!=</span>&nbsp;<span class="ident" id="6590660">nil</span>&nbsp;<span class="op" id="6590664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590668">t</span><span class="op" id="6590669">.</span><span class="ident" id="6590670">Errorf</span><span class="op" id="6590676">(</span><span class="string" id="6590677">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6590692">,</span>&nbsp;<span class="ident" id="6590694">err</span><span class="op" id="6590697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590701">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590712">r</span>&nbsp;<span class="op" id="6590714">:=</span>&nbsp;<span class="ident" id="6590717">NewReader</span><span class="op" id="6590726">(</span><span class="ident" id="6590727">buf</span><span class="op" id="6590730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6590734">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590774">for</span>&nbsp;<span class="ident" id="6590778">i</span>&nbsp;<span class="op" id="6590780">:=</span>&nbsp;<span class="num" id="6590783">0</span><span class="op" id="6590784">;</span>&nbsp;<span class="ident" id="6590786">i</span>&nbsp;<span class="op" id="6590788">&lt;</span>&nbsp;<span class="num" id="6590790">2</span><span class="op" id="6590791">;</span>&nbsp;<span class="ident" id="6590793">i</span><span class="op" id="6590794">++</span>&nbsp;<span class="op" id="6590797">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590801">var</span>&nbsp;<span class="ident" id="6590805">lo</span><span class="op" id="6590807">,</span>&nbsp;<span class="ident" id="6590809">hi</span>&nbsp;<span class="builtintype" id="6590812">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590818">if</span>&nbsp;<span class="ident" id="6590821">i</span>&nbsp;<span class="op" id="6590823">==</span>&nbsp;<span class="num" id="6590826">0</span>&nbsp;<span class="op" id="6590828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590833">lo</span><span class="op" id="6590835">,</span>&nbsp;<span class="ident" id="6590837">hi</span>&nbsp;<span class="op" id="6590840">=</span>&nbsp;<span class="num" id="6590842">0</span><span class="op" id="6590843">,</span>&nbsp;<span class="op" id="6590845">(</span><span class="builtinfunc" id="6590846">len</span><span class="op" id="6590849">(</span><span class="ident" id="6590850">input</span><span class="op" id="6590855">)</span><span class="op" id="6590856">+</span><span class="num" id="6590857">1</span><span class="op" id="6590858">)</span><span class="op" id="6590859">/</span><span class="num" id="6590860">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590864">}</span>&nbsp;<span class="keyword" id="6590866">else</span>&nbsp;<span class="op" id="6590871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590876">lo</span><span class="op" id="6590878">,</span>&nbsp;<span class="ident" id="6590880">hi</span>&nbsp;<span class="op" id="6590883">=</span>&nbsp;<span class="op" id="6590885">(</span><span class="builtinfunc" id="6590886">len</span><span class="op" id="6590889">(</span><span class="ident" id="6590890">input</span><span class="op" id="6590895">)</span><span class="op" id="6590896">+</span><span class="num" id="6590897">1</span><span class="op" id="6590898">)</span><span class="op" id="6590899">/</span><span class="num" id="6590900">2</span><span class="op" id="6590901">,</span>&nbsp;<span class="builtinfunc" id="6590903">len</span><span class="op" id="6590906">(</span><span class="ident" id="6590907">input</span><span class="op" id="6590912">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6590916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6590920">t</span><span class="op" id="6590921">.</span><span class="ident" id="6590922">Logf</span><span class="op" id="6590926">(</span><span class="string" id="6590927">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="6590945">,</span>&nbsp;<span class="ident" id="6590947">i</span><span class="op" id="6590948">,</span>&nbsp;<span class="ident" id="6590950">lo</span><span class="op" id="6590952">,</span>&nbsp;<span class="ident" id="6590954">hi</span><span class="op" id="6590956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6590960">if</span>&nbsp;<span class="ident" id="6590963">_</span><span class="op" id="6590964">,</span>&nbsp;<span class="ident" id="6590966">err</span>&nbsp;<span class="op" id="6590970">:=</span>&nbsp;<span class="ident" id="6590973">w</span><span class="op" id="6590974">.</span><span class="ident" id="6590975">Write</span><span class="op" id="6590980">(</span><span class="ident" id="6590981">input</span><span class="op" id="6590986">[</span><span class="ident" id="6590987">lo</span><span class="op" id="6590989">:</span><span class="ident" id="6590990">hi</span><span class="op" id="6590992">]</span><span class="op" id="6590993">)</span><span class="op" id="6590994">;</span>&nbsp;<span class="ident" id="6590996">err</span>&nbsp;<span class="op" id="6591000">!=</span>&nbsp;<span class="ident" id="6591003">nil</span>&nbsp;<span class="op" id="6591007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591012">t</span><span class="op" id="6591013">.</span><span class="ident" id="6591014">Errorf</span><span class="op" id="6591020">(</span><span class="string" id="6591021">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="6591042">,</span>&nbsp;<span class="ident" id="6591044">err</span><span class="op" id="6591047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591052">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591065">if</span>&nbsp;<span class="ident" id="6591068">i</span>&nbsp;<span class="op" id="6591070">==</span>&nbsp;<span class="num" id="6591073">0</span>&nbsp;<span class="op" id="6591075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591080">if</span>&nbsp;<span class="ident" id="6591083">err</span>&nbsp;<span class="op" id="6591087">:=</span>&nbsp;<span class="ident" id="6591090">w</span><span class="op" id="6591091">.</span><span class="ident" id="6591092">Flush</span><span class="op" id="6591097">(</span><span class="op" id="6591098">)</span><span class="op" id="6591099">;</span>&nbsp;<span class="ident" id="6591101">err</span>&nbsp;<span class="op" id="6591105">!=</span>&nbsp;<span class="ident" id="6591108">nil</span>&nbsp;<span class="op" id="6591112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591118">t</span><span class="op" id="6591119">.</span><span class="ident" id="6591120">Errorf</span><span class="op" id="6591126">(</span><span class="string" id="6591127">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="6591148">,</span>&nbsp;<span class="ident" id="6591150">err</span><span class="op" id="6591153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591159">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591173">}</span>&nbsp;<span class="keyword" id="6591175">else</span>&nbsp;<span class="op" id="6591180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591185">if</span>&nbsp;<span class="ident" id="6591188">err</span>&nbsp;<span class="op" id="6591192">:=</span>&nbsp;<span class="ident" id="6591195">w</span><span class="op" id="6591196">.</span><span class="ident" id="6591197">Close</span><span class="op" id="6591202">(</span><span class="op" id="6591203">)</span><span class="op" id="6591204">;</span>&nbsp;<span class="ident" id="6591206">err</span>&nbsp;<span class="op" id="6591210">!=</span>&nbsp;<span class="ident" id="6591213">nil</span>&nbsp;<span class="op" id="6591217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591223">t</span><span class="op" id="6591224">.</span><span class="ident" id="6591225">Errorf</span><span class="op" id="6591231">(</span><span class="string" id="6591232">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="6591253">,</span>&nbsp;<span class="ident" id="6591255">err</span><span class="op" id="6591258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591263">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591271">buf</span><span class="op" id="6591274">.</span><span class="ident" id="6591275">ReadMode</span><span class="op" id="6591283">(</span><span class="op" id="6591284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591288">out</span>&nbsp;<span class="op" id="6591292">:=</span>&nbsp;<span class="builtinfunc" id="6591295">make</span><span class="op" id="6591299">(</span><span class="op" id="6591300">[</span><span class="op" id="6591301">]</span><span class="builtintype" id="6591302">byte</span><span class="op" id="6591306">,</span>&nbsp;<span class="ident" id="6591308">hi</span><span class="op" id="6591310">-</span><span class="ident" id="6591311">lo</span><span class="op" id="6591313">+</span><span class="num" id="6591314">1</span><span class="op" id="6591315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591319">m</span><span class="op" id="6591320">,</span>&nbsp;<span class="ident" id="6591322">err</span>&nbsp;<span class="op" id="6591326">:=</span>&nbsp;<span class="ident" id="6591329">io</span><span class="op" id="6591331">.</span><span class="ident" id="6591332">ReadAtLeast</span><span class="op" id="6591343">(</span><span class="ident" id="6591344">r</span><span class="op" id="6591345">,</span>&nbsp;<span class="ident" id="6591347">out</span><span class="op" id="6591350">,</span>&nbsp;<span class="ident" id="6591352">hi</span><span class="op" id="6591354">-</span><span class="ident" id="6591355">lo</span><span class="op" id="6591357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591361">t</span><span class="op" id="6591362">.</span><span class="ident" id="6591363">Logf</span><span class="op" id="6591367">(</span><span class="string" id="6591368">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6591382">,</span>&nbsp;<span class="ident" id="6591384">i</span><span class="op" id="6591385">,</span>&nbsp;<span class="ident" id="6591387">m</span><span class="op" id="6591388">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591392">if</span>&nbsp;<span class="ident" id="6591395">m</span>&nbsp;<span class="op" id="6591397">!=</span>&nbsp;<span class="ident" id="6591400">hi</span><span class="op" id="6591402">-</span><span class="ident" id="6591403">lo</span>&nbsp;<span class="op" id="6591406">||</span>&nbsp;<span class="ident" id="6591409">err</span>&nbsp;<span class="op" id="6591413">!=</span>&nbsp;<span class="ident" id="6591416">nil</span>&nbsp;<span class="op" id="6591420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591425">t</span><span class="op" id="6591426">.</span><span class="ident" id="6591427">Errorf</span><span class="op" id="6591433">(</span><span class="string" id="6591434">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="6591487">,</span>&nbsp;<span class="ident" id="6591489">i</span><span class="op" id="6591490">,</span>&nbsp;<span class="ident" id="6591492">level</span><span class="op" id="6591497">,</span>&nbsp;<span class="builtinfunc" id="6591499">len</span><span class="op" id="6591502">(</span><span class="ident" id="6591503">input</span><span class="op" id="6591508">)</span><span class="op" id="6591509">,</span>&nbsp;<span class="ident" id="6591511">name</span><span class="op" id="6591515">,</span>&nbsp;<span class="ident" id="6591517">hi</span><span class="op" id="6591519">-</span><span class="ident" id="6591520">lo</span><span class="op" id="6591522">,</span>&nbsp;<span class="ident" id="6591524">m</span><span class="op" id="6591525">,</span>&nbsp;<span class="ident" id="6591527">err</span><span class="op" id="6591530">,</span>&nbsp;<span class="ident" id="6591532">buf</span><span class="op" id="6591535">.</span><span class="ident" id="6591536">buf</span><span class="op" id="6591539">.</span><span class="ident" id="6591540">Len</span><span class="op" id="6591543">(</span><span class="op" id="6591544">)</span><span class="op" id="6591545">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591550">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591563">if</span>&nbsp;<span class="op" id="6591566">!</span><span class="ident" id="6591567">bytes</span><span class="op" id="6591572">.</span><span class="ident" id="6591573">Equal</span><span class="op" id="6591578">(</span><span class="ident" id="6591579">input</span><span class="op" id="6591584">[</span><span class="ident" id="6591585">lo</span><span class="op" id="6591587">:</span><span class="ident" id="6591588">hi</span><span class="op" id="6591590">]</span><span class="op" id="6591591">,</span>&nbsp;<span class="ident" id="6591593">out</span><span class="op" id="6591596">[</span><span class="op" id="6591597">:</span><span class="ident" id="6591598">hi</span><span class="op" id="6591600">-</span><span class="ident" id="6591601">lo</span><span class="op" id="6591603">]</span><span class="op" id="6591604">)</span>&nbsp;<span class="op" id="6591606">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6591611">t</span><span class="op" id="6591612">.</span><span class="ident" id="6591613">Errorf</span><span class="op" id="6591619">(</span><span class="string" id="6591620">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="6591661">,</span>&nbsp;<span class="ident" id="6591663">i</span><span class="op" id="6591664">,</span>&nbsp;<span class="ident" id="6591666">input</span><span class="op" id="6591671">[</span><span class="ident" id="6591672">lo</span><span class="op" id="6591674">:</span><span class="ident" id="6591675">hi</span><span class="op" id="6591677">]</span><span class="op" id="6591678">,</span>&nbsp;<span class="ident" id="6591680">out</span><span class="op" id="6591683">[</span><span class="op" id="6591684">:</span><span class="ident" id="6591685">hi</span><span class="op" id="6591687">-</span><span class="ident" id="6591688">lo</span><span class="op" id="6591690">]</span><span class="op" id="6591691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6591696">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6591705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591709">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591762">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591819">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591876">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591932">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6591984">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592045">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592106">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592158">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592219">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592231">buf</span><span class="op" id="6592234">.</span><span class="ident" id="6592235">WriteMode</span><span class="op" id="6592244">(</span><span class="op" id="6592245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592248">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592251">buf</span><span class="op" id="6592254">.</span><span class="ident" id="6592255">ReadMode</span><span class="op" id="6592263">(</span><span class="op" id="6592264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592267">out</span>&nbsp;<span class="op" id="6592271">:=</span>&nbsp;<span class="builtinfunc" id="6592274">make</span><span class="op" id="6592278">(</span><span class="op" id="6592279">[</span><span class="op" id="6592280">]</span><span class="builtintype" id="6592281">byte</span><span class="op" id="6592285">,</span>&nbsp;<span class="num" id="6592287">10</span><span class="op" id="6592289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592292">if</span>&nbsp;<span class="ident" id="6592295">n</span><span class="op" id="6592296">,</span>&nbsp;<span class="ident" id="6592298">err</span>&nbsp;<span class="op" id="6592302">:=</span>&nbsp;<span class="ident" id="6592305">r</span><span class="op" id="6592306">.</span><span class="ident" id="6592307">Read</span><span class="op" id="6592311">(</span><span class="ident" id="6592312">out</span><span class="op" id="6592315">)</span><span class="op" id="6592316">;</span>&nbsp;<span class="ident" id="6592318">n</span>&nbsp;<span class="op" id="6592320">&gt;</span>&nbsp;<span class="num" id="6592322">0</span>&nbsp;<span class="op" id="6592324">||</span>&nbsp;<span class="ident" id="6592327">err</span>&nbsp;<span class="op" id="6592331">!=</span>&nbsp;<span class="ident" id="6592334">io</span><span class="op" id="6592336">.</span><span class="ident" id="6592337">EOF</span>&nbsp;<span class="op" id="6592341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592345">t</span><span class="op" id="6592346">.</span><span class="ident" id="6592347">Errorf</span><span class="op" id="6592353">(</span><span class="string" id="6592354">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="6592407">,</span>&nbsp;<span class="ident" id="6592409">level</span><span class="op" id="6592414">,</span>&nbsp;<span class="builtinfunc" id="6592416">len</span><span class="op" id="6592419">(</span><span class="ident" id="6592420">input</span><span class="op" id="6592425">)</span><span class="op" id="6592426">,</span>&nbsp;<span class="ident" id="6592428">name</span><span class="op" id="6592432">,</span>&nbsp;<span class="ident" id="6592434">n</span><span class="op" id="6592435">,</span>&nbsp;<span class="ident" id="6592437">err</span><span class="op" id="6592440">,</span>&nbsp;<span class="ident" id="6592442">out</span><span class="op" id="6592445">[</span><span class="num" id="6592446">0</span><span class="op" id="6592447">:</span><span class="ident" id="6592448">n</span><span class="op" id="6592449">]</span><span class="op" id="6592450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592453">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592456">if</span>&nbsp;<span class="ident" id="6592459">buf</span><span class="op" id="6592462">.</span><span class="ident" id="6592463">buf</span><span class="op" id="6592466">.</span><span class="ident" id="6592467">Len</span><span class="op" id="6592470">(</span><span class="op" id="6592471">)</span>&nbsp;<span class="op" id="6592473">!=</span>&nbsp;<span class="num" id="6592476">0</span>&nbsp;<span class="op" id="6592478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592482">t</span><span class="op" id="6592483">.</span><span class="ident" id="6592484">Errorf</span><span class="op" id="6592490">(</span><span class="string" id="6592491">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="6592533">,</span>&nbsp;<span class="ident" id="6592535">level</span><span class="op" id="6592540">,</span>&nbsp;<span class="builtinfunc" id="6592542">len</span><span class="op" id="6592545">(</span><span class="ident" id="6592546">input</span><span class="op" id="6592551">)</span><span class="op" id="6592552">,</span>&nbsp;<span class="ident" id="6592554">name</span><span class="op" id="6592558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592564">r</span><span class="op" id="6592565">.</span><span class="ident" id="6592566">Close</span><span class="op" id="6592571">(</span><span class="op" id="6592572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6592576">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592623">r</span>&nbsp;<span class="op" id="6592625">=</span>&nbsp;<span class="ident" id="6592627">NewReader</span><span class="op" id="6592636">(</span><span class="ident" id="6592637">buf1</span><span class="op" id="6592641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592644">out</span><span class="op" id="6592647">,</span>&nbsp;<span class="ident" id="6592649">err</span>&nbsp;<span class="op" id="6592653">=</span>&nbsp;<span class="ident" id="6592655">ioutil</span><span class="op" id="6592661">.</span><span class="ident" id="6592662">ReadAll</span><span class="op" id="6592669">(</span><span class="ident" id="6592670">r</span><span class="op" id="6592671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592674">if</span>&nbsp;<span class="ident" id="6592677">err</span>&nbsp;<span class="op" id="6592681">!=</span>&nbsp;<span class="ident" id="6592684">nil</span>&nbsp;<span class="op" id="6592688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592692">t</span><span class="op" id="6592693">.</span><span class="ident" id="6592694">Errorf</span><span class="op" id="6592700">(</span><span class="string" id="6592701">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="6592721">,</span>&nbsp;<span class="ident" id="6592723">err</span><span class="op" id="6592726">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592730">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592741">r</span><span class="op" id="6592742">.</span><span class="ident" id="6592743">Close</span><span class="op" id="6592748">(</span><span class="op" id="6592749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592752">if</span>&nbsp;<span class="op" id="6592755">!</span><span class="ident" id="6592756">bytes</span><span class="op" id="6592761">.</span><span class="ident" id="6592762">Equal</span><span class="op" id="6592767">(</span><span class="ident" id="6592768">input</span><span class="op" id="6592773">,</span>&nbsp;<span class="ident" id="6592775">out</span><span class="op" id="6592778">)</span>&nbsp;<span class="op" id="6592780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6592784">t</span><span class="op" id="6592785">.</span><span class="ident" id="6592786">Errorf</span><span class="op" id="6592792">(</span><span class="string" id="6592793">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6592858">,</span>&nbsp;<span class="ident" id="6592860">level</span><span class="op" id="6592865">,</span>&nbsp;<span class="ident" id="6592867">name</span><span class="op" id="6592871">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6592874">}</span><br>
<span class="lineno"></span><span class="op" id="6592876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6592879">func</span>&nbsp;<span class="ident" id="6592884">testToFromWithLevelAndLimit</span><span class="op" id="6592911">(</span><span class="ident" id="6592912">t</span>&nbsp;<span class="op" id="6592914">*</span><span class="ident" id="6592915">testing</span><span class="op" id="6592922">.</span><span class="ident" id="6592923">T</span><span class="op" id="6592924">,</span>&nbsp;<span class="ident" id="6592926">level</span>&nbsp;<span class="builtintype" id="6592932">int</span><span class="op" id="6592935">,</span>&nbsp;<span class="ident" id="6592937">input</span>&nbsp;<span class="op" id="6592943">[</span><span class="op" id="6592944">]</span><span class="builtintype" id="6592945">byte</span><span class="op" id="6592949">,</span>&nbsp;<span class="ident" id="6592951">name</span>&nbsp;<span class="builtintype" id="6592956">string</span><span class="op" id="6592962">,</span>&nbsp;<span class="ident" id="6592964">limit</span>&nbsp;<span class="builtintype" id="6592970">int</span><span class="op" id="6592973">)</span>&nbsp;<span class="op" id="6592975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6592978">var</span>&nbsp;<span class="ident" id="6592982">buffer</span>&nbsp;<span class="ident" id="6592989">bytes</span><span class="op" id="6592994">.</span><span class="ident" id="6592995">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593003">w</span><span class="op" id="6593004">,</span>&nbsp;<span class="ident" id="6593006">err</span>&nbsp;<span class="op" id="6593010">:=</span>&nbsp;<span class="ident" id="6593013">NewWriter</span><span class="op" id="6593022">(</span><span class="op" id="6593023">&amp;</span><span class="ident" id="6593024">buffer</span><span class="op" id="6593030">,</span>&nbsp;<span class="ident" id="6593032">level</span><span class="op" id="6593037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593040">if</span>&nbsp;<span class="ident" id="6593043">err</span>&nbsp;<span class="op" id="6593047">!=</span>&nbsp;<span class="ident" id="6593050">nil</span>&nbsp;<span class="op" id="6593054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593058">t</span><span class="op" id="6593059">.</span><span class="ident" id="6593060">Errorf</span><span class="op" id="6593066">(</span><span class="string" id="6593067">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6593082">,</span>&nbsp;<span class="ident" id="6593084">err</span><span class="op" id="6593087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593091">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593099">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593102">w</span><span class="op" id="6593103">.</span><span class="ident" id="6593104">Write</span><span class="op" id="6593109">(</span><span class="ident" id="6593110">input</span><span class="op" id="6593115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593118">w</span><span class="op" id="6593119">.</span><span class="ident" id="6593120">Close</span><span class="op" id="6593125">(</span><span class="op" id="6593126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593129">if</span>&nbsp;<span class="ident" id="6593132">limit</span>&nbsp;<span class="op" id="6593138">&gt;</span>&nbsp;<span class="num" id="6593140">0</span>&nbsp;<span class="op" id="6593142">&amp;&amp;</span>&nbsp;<span class="ident" id="6593145">buffer</span><span class="op" id="6593151">.</span><span class="ident" id="6593152">Len</span><span class="op" id="6593155">(</span><span class="op" id="6593156">)</span>&nbsp;<span class="op" id="6593158">&gt;</span>&nbsp;<span class="ident" id="6593160">limit</span>&nbsp;<span class="op" id="6593166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593170">t</span><span class="op" id="6593171">.</span><span class="ident" id="6593172">Errorf</span><span class="op" id="6593178">(</span><span class="string" id="6593179">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6593229">,</span>&nbsp;<span class="ident" id="6593231">level</span><span class="op" id="6593236">,</span>&nbsp;<span class="ident" id="6593238">buffer</span><span class="op" id="6593244">.</span><span class="ident" id="6593245">Len</span><span class="op" id="6593248">(</span><span class="op" id="6593249">)</span><span class="op" id="6593250">,</span>&nbsp;<span class="ident" id="6593252">limit</span><span class="op" id="6593257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593261">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593272">r</span>&nbsp;<span class="op" id="6593274">:=</span>&nbsp;<span class="ident" id="6593277">NewReader</span><span class="op" id="6593286">(</span><span class="op" id="6593287">&amp;</span><span class="ident" id="6593288">buffer</span><span class="op" id="6593294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593297">out</span><span class="op" id="6593300">,</span>&nbsp;<span class="ident" id="6593302">err</span>&nbsp;<span class="op" id="6593306">:=</span>&nbsp;<span class="ident" id="6593309">ioutil</span><span class="op" id="6593315">.</span><span class="ident" id="6593316">ReadAll</span><span class="op" id="6593323">(</span><span class="ident" id="6593324">r</span><span class="op" id="6593325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593328">if</span>&nbsp;<span class="ident" id="6593331">err</span>&nbsp;<span class="op" id="6593335">!=</span>&nbsp;<span class="ident" id="6593338">nil</span>&nbsp;<span class="op" id="6593342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593346">t</span><span class="op" id="6593347">.</span><span class="ident" id="6593348">Errorf</span><span class="op" id="6593354">(</span><span class="string" id="6593355">&#34;read:&nbsp;%s&#34;</span><span class="op" id="6593365">,</span>&nbsp;<span class="ident" id="6593367">err</span><span class="op" id="6593370">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593385">r</span><span class="op" id="6593386">.</span><span class="ident" id="6593387">Close</span><span class="op" id="6593392">(</span><span class="op" id="6593393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593396">if</span>&nbsp;<span class="op" id="6593399">!</span><span class="ident" id="6593400">bytes</span><span class="op" id="6593405">.</span><span class="ident" id="6593406">Equal</span><span class="op" id="6593411">(</span><span class="ident" id="6593412">input</span><span class="op" id="6593417">,</span>&nbsp;<span class="ident" id="6593419">out</span><span class="op" id="6593422">)</span>&nbsp;<span class="op" id="6593424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593428">t</span><span class="op" id="6593429">.</span><span class="ident" id="6593430">Errorf</span><span class="op" id="6593436">(</span><span class="string" id="6593437">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6593492">,</span>&nbsp;<span class="ident" id="6593494">level</span><span class="op" id="6593499">,</span>&nbsp;<span class="ident" id="6593501">name</span><span class="op" id="6593505">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593509">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593520">testSync</span><span class="op" id="6593528">(</span><span class="ident" id="6593529">t</span><span class="op" id="6593530">,</span>&nbsp;<span class="ident" id="6593532">level</span><span class="op" id="6593537">,</span>&nbsp;<span class="ident" id="6593539">input</span><span class="op" id="6593544">,</span>&nbsp;<span class="ident" id="6593546">name</span><span class="op" id="6593550">)</span><br>
<span class="lineno"></span><span class="op" id="6593552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6593555">func</span>&nbsp;<span class="ident" id="6593560">testToFromWithLimit</span><span class="op" id="6593579">(</span><span class="ident" id="6593580">t</span>&nbsp;<span class="op" id="6593582">*</span><span class="ident" id="6593583">testing</span><span class="op" id="6593590">.</span><span class="ident" id="6593591">T</span><span class="op" id="6593592">,</span>&nbsp;<span class="ident" id="6593594">input</span>&nbsp;<span class="op" id="6593600">[</span><span class="op" id="6593601">]</span><span class="builtintype" id="6593602">byte</span><span class="op" id="6593606">,</span>&nbsp;<span class="ident" id="6593608">name</span>&nbsp;<span class="builtintype" id="6593613">string</span><span class="op" id="6593619">,</span>&nbsp;<span class="ident" id="6593621">limit</span>&nbsp;<span class="op" id="6593627">[</span><span class="num" id="6593628">10</span><span class="op" id="6593630">]</span><span class="builtintype" id="6593631">int</span><span class="op" id="6593634">)</span>&nbsp;<span class="op" id="6593636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593639">for</span>&nbsp;<span class="ident" id="6593643">i</span>&nbsp;<span class="op" id="6593645">:=</span>&nbsp;<span class="num" id="6593648">0</span><span class="op" id="6593649">;</span>&nbsp;<span class="ident" id="6593651">i</span>&nbsp;<span class="op" id="6593653">&lt;</span>&nbsp;<span class="num" id="6593655">10</span><span class="op" id="6593657">;</span>&nbsp;<span class="ident" id="6593659">i</span><span class="op" id="6593660">++</span>&nbsp;<span class="op" id="6593663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593667">testToFromWithLevelAndLimit</span><span class="op" id="6593694">(</span><span class="ident" id="6593695">t</span><span class="op" id="6593696">,</span>&nbsp;<span class="ident" id="6593698">i</span><span class="op" id="6593699">,</span>&nbsp;<span class="ident" id="6593701">input</span><span class="op" id="6593706">,</span>&nbsp;<span class="ident" id="6593708">name</span><span class="op" id="6593712">,</span>&nbsp;<span class="ident" id="6593714">limit</span><span class="op" id="6593719">[</span><span class="ident" id="6593720">i</span><span class="op" id="6593721">]</span><span class="op" id="6593722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593725">}</span><br>
<span class="lineno"></span><span class="op" id="6593727">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="6593730">func</span>&nbsp;<span class="ident" id="6593735">TestDeflateInflate</span><span class="op" id="6593753">(</span><span class="ident" id="6593754">t</span>&nbsp;<span class="op" id="6593756">*</span><span class="ident" id="6593757">testing</span><span class="op" id="6593764">.</span><span class="ident" id="6593765">T</span><span class="op" id="6593766">)</span>&nbsp;<span class="op" id="6593768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593771">for</span>&nbsp;<span class="ident" id="6593775">i</span><span class="op" id="6593776">,</span>&nbsp;<span class="ident" id="6593778">h</span>&nbsp;<span class="op" id="6593780">:=</span>&nbsp;<span class="keyword" id="6593783">range</span>&nbsp;<span class="ident" id="6593789">deflateInflateTests</span>&nbsp;<span class="op" id="6593809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6593813">testToFromWithLimit</span><span class="op" id="6593832">(</span><span class="ident" id="6593833">t</span><span class="op" id="6593834">,</span>&nbsp;<span class="ident" id="6593836">h</span><span class="op" id="6593837">.</span><span class="ident" id="6593838">in</span><span class="op" id="6593840">,</span>&nbsp;<span class="ident" id="6593842">fmt</span><span class="op" id="6593845">.</span><span class="ident" id="6593846">Sprintf</span><span class="op" id="6593853">(</span><span class="string" id="6593854">&#34;#%d&#34;</span><span class="op" id="6593859">,</span>&nbsp;<span class="ident" id="6593861">i</span><span class="op" id="6593862">)</span><span class="op" id="6593863">,</span>&nbsp;<span class="op" id="6593865">[</span><span class="num" id="6593866">10</span><span class="op" id="6593868">]</span><span class="builtintype" id="6593869">int</span><span class="op" id="6593872">{</span><span class="op" id="6593873">}</span><span class="op" id="6593874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6593877">}</span><br>
<span class="lineno">315</span><span class="op" id="6593879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6593882">func</span>&nbsp;<span class="ident" id="6593887">TestReverseBits</span><span class="op" id="6593902">(</span><span class="ident" id="6593903">t</span>&nbsp;<span class="op" id="6593905">*</span><span class="ident" id="6593906">testing</span><span class="op" id="6593913">.</span><span class="ident" id="6593914">T</span><span class="op" id="6593915">)</span>&nbsp;<span class="op" id="6593917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593920">for</span>&nbsp;<span class="ident" id="6593924">_</span><span class="op" id="6593925">,</span>&nbsp;<span class="ident" id="6593927">h</span>&nbsp;<span class="op" id="6593929">:=</span>&nbsp;<span class="keyword" id="6593932">range</span>&nbsp;<span class="ident" id="6593938">reverseBitsTests</span>&nbsp;<span class="op" id="6593955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6593959">if</span>&nbsp;<span class="ident" id="6593962">v</span>&nbsp;<span class="op" id="6593964">:=</span>&nbsp;<span class="ident" id="6593967">reverseBits</span><span class="op" id="6593978">(</span><span class="ident" id="6593979">h</span><span class="op" id="6593980">.</span><span class="ident" id="6593981">in</span><span class="op" id="6593983">,</span>&nbsp;<span class="ident" id="6593985">h</span><span class="op" id="6593986">.</span><span class="ident" id="6593987">bitCount</span><span class="op" id="6593995">)</span><span class="op" id="6593996">;</span>&nbsp;<span class="ident" id="6593998">v</span>&nbsp;<span class="op" id="6594000">!=</span>&nbsp;<span class="ident" id="6594003">h</span><span class="op" id="6594004">.</span><span class="ident" id="6594005">out</span>&nbsp;<span class="op" id="6594009">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594014">t</span><span class="op" id="6594015">.</span><span class="ident" id="6594016">Errorf</span><span class="op" id="6594022">(</span><span class="string" id="6594023">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6594057">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594063">h</span><span class="op" id="6594064">.</span><span class="ident" id="6594065">in</span><span class="op" id="6594067">,</span>&nbsp;<span class="ident" id="6594069">h</span><span class="op" id="6594070">.</span><span class="ident" id="6594071">bitCount</span><span class="op" id="6594079">,</span>&nbsp;<span class="ident" id="6594081">v</span><span class="op" id="6594082">,</span>&nbsp;<span class="ident" id="6594084">h</span><span class="op" id="6594085">.</span><span class="ident" id="6594086">out</span><span class="op" id="6594089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594096">}</span><br>
<span class="lineno"></span><span class="op" id="6594098">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6594101">type</span>&nbsp;<span class="ident" id="6594106">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="6594131">struct</span>&nbsp;<span class="op" id="6594138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594141">filename</span>&nbsp;<span class="builtintype" id="6594150">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594158">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6594167">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594175">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6594184">[</span><span class="num" id="6594185">10</span><span class="op" id="6594187">]</span><span class="builtintype" id="6594188">int</span><br>
<span class="lineno">330</span><span class="op" id="6594192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594195">var</span>&nbsp;<span class="ident" id="6594199">deflateInflateStringTests</span>&nbsp;<span class="op" id="6594225">=</span>&nbsp;<span class="op" id="6594227">[</span><span class="op" id="6594228">]</span><span class="ident" id="6594229">deflateInflateStringTest</span><span class="op" id="6594253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594260">&#34;../testdata/e.txt&#34;</span><span class="op" id="6594279">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594283">&#34;2.718281828...&#34;</span><span class="op" id="6594299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594303">[</span><span class="op" id="6594304">...</span><span class="op" id="6594307">]</span><span class="builtintype" id="6594308">int</span><span class="op" id="6594311">{</span><span class="num" id="6594312">100018</span><span class="op" id="6594318">,</span>&nbsp;<span class="num" id="6594320">50650</span><span class="op" id="6594325">,</span>&nbsp;<span class="num" id="6594327">50960</span><span class="op" id="6594332">,</span>&nbsp;<span class="num" id="6594334">51150</span><span class="op" id="6594339">,</span>&nbsp;<span class="num" id="6594341">50930</span><span class="op" id="6594346">,</span>&nbsp;<span class="num" id="6594348">50790</span><span class="op" id="6594353">,</span>&nbsp;<span class="num" id="6594355">50790</span><span class="op" id="6594360">,</span>&nbsp;<span class="num" id="6594362">50790</span><span class="op" id="6594367">,</span>&nbsp;<span class="num" id="6594369">50790</span><span class="op" id="6594374">,</span>&nbsp;<span class="num" id="6594376">50790</span><span class="op" id="6594381">}</span><span class="op" id="6594382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594385">}</span><span class="op" id="6594386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594393">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="6594432">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6594436">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="6594459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594463">[</span><span class="op" id="6594464">...</span><span class="op" id="6594467">]</span><span class="builtintype" id="6594468">int</span><span class="op" id="6594471">{</span><span class="num" id="6594472">407330</span><span class="op" id="6594478">,</span>&nbsp;<span class="num" id="6594480">187598</span><span class="op" id="6594486">,</span>&nbsp;<span class="num" id="6594488">180361</span><span class="op" id="6594494">,</span>&nbsp;<span class="num" id="6594496">172974</span><span class="op" id="6594502">,</span>&nbsp;<span class="num" id="6594504">169160</span><span class="op" id="6594510">,</span>&nbsp;<span class="num" id="6594512">163476</span><span class="op" id="6594518">,</span>&nbsp;<span class="num" id="6594520">160936</span><span class="op" id="6594526">,</span>&nbsp;<span class="num" id="6594528">160506</span><span class="op" id="6594534">,</span>&nbsp;<span class="num" id="6594536">160295</span><span class="op" id="6594542">,</span>&nbsp;<span class="num" id="6594544">160295</span><span class="op" id="6594550">}</span><span class="op" id="6594551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594554">}</span><span class="op" id="6594555">,</span><br>
<span class="lineno"></span><span class="op" id="6594557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6594560">func</span>&nbsp;<span class="ident" id="6594565">TestDeflateInflateString</span><span class="op" id="6594589">(</span><span class="ident" id="6594590">t</span>&nbsp;<span class="op" id="6594592">*</span><span class="ident" id="6594593">testing</span><span class="op" id="6594600">.</span><span class="ident" id="6594601">T</span><span class="op" id="6594602">)</span>&nbsp;<span class="op" id="6594604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594607">for</span>&nbsp;<span class="ident" id="6594611">_</span><span class="op" id="6594612">,</span>&nbsp;<span class="ident" id="6594614">test</span>&nbsp;<span class="op" id="6594619">:=</span>&nbsp;<span class="keyword" id="6594622">range</span>&nbsp;<span class="ident" id="6594628">deflateInflateStringTests</span>&nbsp;<span class="op" id="6594654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594658">gold</span><span class="op" id="6594662">,</span>&nbsp;<span class="ident" id="6594664">err</span>&nbsp;<span class="op" id="6594668">:=</span>&nbsp;<span class="ident" id="6594671">ioutil</span><span class="op" id="6594677">.</span><span class="ident" id="6594678">ReadFile</span><span class="op" id="6594686">(</span><span class="ident" id="6594687">test</span><span class="op" id="6594691">.</span><span class="ident" id="6594692">filename</span><span class="op" id="6594700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594704">if</span>&nbsp;<span class="ident" id="6594707">err</span>&nbsp;<span class="op" id="6594711">!=</span>&nbsp;<span class="ident" id="6594714">nil</span>&nbsp;<span class="op" id="6594718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594723">t</span><span class="op" id="6594724">.</span><span class="ident" id="6594725">Error</span><span class="op" id="6594730">(</span><span class="ident" id="6594731">err</span><span class="op" id="6594734">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594742">testToFromWithLimit</span><span class="op" id="6594761">(</span><span class="ident" id="6594762">t</span><span class="op" id="6594763">,</span>&nbsp;<span class="ident" id="6594765">gold</span><span class="op" id="6594769">,</span>&nbsp;<span class="ident" id="6594771">test</span><span class="op" id="6594775">.</span><span class="ident" id="6594776">label</span><span class="op" id="6594781">,</span>&nbsp;<span class="ident" id="6594783">test</span><span class="op" id="6594787">.</span><span class="ident" id="6594788">limit</span><span class="op" id="6594793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594797">if</span>&nbsp;<span class="ident" id="6594800">testing</span><span class="op" id="6594807">.</span><span class="ident" id="6594808">Short</span><span class="op" id="6594813">(</span><span class="op" id="6594814">)</span>&nbsp;<span class="op" id="6594816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594821">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594829">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594832">}</span><br>
<span class="lineno"></span><span class="op" id="6594834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6594837">func</span>&nbsp;<span class="ident" id="6594842">TestReaderDict</span><span class="op" id="6594856">(</span><span class="ident" id="6594857">t</span>&nbsp;<span class="op" id="6594859">*</span><span class="ident" id="6594860">testing</span><span class="op" id="6594867">.</span><span class="ident" id="6594868">T</span><span class="op" id="6594869">)</span>&nbsp;<span class="op" id="6594871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594874">const</span>&nbsp;<span class="op" id="6594880">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594884">dict</span>&nbsp;<span class="op" id="6594889">=</span>&nbsp;<span class="string" id="6594891">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594907">text</span>&nbsp;<span class="op" id="6594912">=</span>&nbsp;<span class="string" id="6594914">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6594935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594938">var</span>&nbsp;<span class="ident" id="6594942">b</span>&nbsp;<span class="ident" id="6594944">bytes</span><span class="op" id="6594949">.</span><span class="ident" id="6594950">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6594958">w</span><span class="op" id="6594959">,</span>&nbsp;<span class="ident" id="6594961">err</span>&nbsp;<span class="op" id="6594965">:=</span>&nbsp;<span class="ident" id="6594968">NewWriter</span><span class="op" id="6594977">(</span><span class="op" id="6594978">&amp;</span><span class="ident" id="6594979">b</span><span class="op" id="6594980">,</span>&nbsp;<span class="num" id="6594982">5</span><span class="op" id="6594983">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6594986">if</span>&nbsp;<span class="ident" id="6594989">err</span>&nbsp;<span class="op" id="6594993">!=</span>&nbsp;<span class="ident" id="6594996">nil</span>&nbsp;<span class="op" id="6595000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595004">t</span><span class="op" id="6595005">.</span><span class="ident" id="6595006">Fatalf</span><span class="op" id="6595012">(</span><span class="string" id="6595013">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6595028">,</span>&nbsp;<span class="ident" id="6595030">err</span><span class="op" id="6595033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595039">w</span><span class="op" id="6595040">.</span><span class="ident" id="6595041">Write</span><span class="op" id="6595046">(</span><span class="op" id="6595047">[</span><span class="op" id="6595048">]</span><span class="builtintype" id="6595049">byte</span><span class="op" id="6595053">(</span><span class="ident" id="6595054">dict</span><span class="op" id="6595058">)</span><span class="op" id="6595059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595062">w</span><span class="op" id="6595063">.</span><span class="ident" id="6595064">Flush</span><span class="op" id="6595069">(</span><span class="op" id="6595070">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595073">b</span><span class="op" id="6595074">.</span><span class="ident" id="6595075">Reset</span><span class="op" id="6595080">(</span><span class="op" id="6595081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595084">w</span><span class="op" id="6595085">.</span><span class="ident" id="6595086">Write</span><span class="op" id="6595091">(</span><span class="op" id="6595092">[</span><span class="op" id="6595093">]</span><span class="builtintype" id="6595094">byte</span><span class="op" id="6595098">(</span><span class="ident" id="6595099">text</span><span class="op" id="6595103">)</span><span class="op" id="6595104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595107">w</span><span class="op" id="6595108">.</span><span class="ident" id="6595109">Close</span><span class="op" id="6595114">(</span><span class="op" id="6595115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595119">r</span>&nbsp;<span class="op" id="6595121">:=</span>&nbsp;<span class="ident" id="6595124">NewReaderDict</span><span class="op" id="6595137">(</span><span class="op" id="6595138">&amp;</span><span class="ident" id="6595139">b</span><span class="op" id="6595140">,</span>&nbsp;<span class="op" id="6595142">[</span><span class="op" id="6595143">]</span><span class="builtintype" id="6595144">byte</span><span class="op" id="6595148">(</span><span class="ident" id="6595149">dict</span><span class="op" id="6595153">)</span><span class="op" id="6595154">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595157">data</span><span class="op" id="6595161">,</span>&nbsp;<span class="ident" id="6595163">err</span>&nbsp;<span class="op" id="6595167">:=</span>&nbsp;<span class="ident" id="6595170">ioutil</span><span class="op" id="6595176">.</span><span class="ident" id="6595177">ReadAll</span><span class="op" id="6595184">(</span><span class="ident" id="6595185">r</span><span class="op" id="6595186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595189">if</span>&nbsp;<span class="ident" id="6595192">err</span>&nbsp;<span class="op" id="6595196">!=</span>&nbsp;<span class="ident" id="6595199">nil</span>&nbsp;<span class="op" id="6595203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595207">t</span><span class="op" id="6595208">.</span><span class="ident" id="6595209">Fatal</span><span class="op" id="6595214">(</span><span class="ident" id="6595215">err</span><span class="op" id="6595218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595224">if</span>&nbsp;<span class="builtintype" id="6595227">string</span><span class="op" id="6595233">(</span><span class="ident" id="6595234">data</span><span class="op" id="6595238">)</span>&nbsp;<span class="op" id="6595240">!=</span>&nbsp;<span class="string" id="6595243">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="6595263">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595267">t</span><span class="op" id="6595268">.</span><span class="ident" id="6595269">Fatalf</span><span class="op" id="6595275">(</span><span class="string" id="6595276">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6595302">,</span>&nbsp;<span class="builtintype" id="6595304">string</span><span class="op" id="6595310">(</span><span class="ident" id="6595311">data</span><span class="op" id="6595315">)</span><span class="op" id="6595316">,</span>&nbsp;<span class="ident" id="6595318">text</span><span class="op" id="6595322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595325">}</span><br>
<span class="lineno"></span><span class="op" id="6595327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6595330">func</span>&nbsp;<span class="ident" id="6595335">TestWriterDict</span><span class="op" id="6595349">(</span><span class="ident" id="6595350">t</span>&nbsp;<span class="op" id="6595352">*</span><span class="ident" id="6595353">testing</span><span class="op" id="6595360">.</span><span class="ident" id="6595361">T</span><span class="op" id="6595362">)</span>&nbsp;<span class="op" id="6595364">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595367">const</span>&nbsp;<span class="op" id="6595373">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595377">dict</span>&nbsp;<span class="op" id="6595382">=</span>&nbsp;<span class="string" id="6595384">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595400">text</span>&nbsp;<span class="op" id="6595405">=</span>&nbsp;<span class="string" id="6595407">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595431">var</span>&nbsp;<span class="ident" id="6595435">b</span>&nbsp;<span class="ident" id="6595437">bytes</span><span class="op" id="6595442">.</span><span class="ident" id="6595443">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595451">w</span><span class="op" id="6595452">,</span>&nbsp;<span class="ident" id="6595454">err</span>&nbsp;<span class="op" id="6595458">:=</span>&nbsp;<span class="ident" id="6595461">NewWriter</span><span class="op" id="6595470">(</span><span class="op" id="6595471">&amp;</span><span class="ident" id="6595472">b</span><span class="op" id="6595473">,</span>&nbsp;<span class="num" id="6595475">5</span><span class="op" id="6595476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595479">if</span>&nbsp;<span class="ident" id="6595482">err</span>&nbsp;<span class="op" id="6595486">!=</span>&nbsp;<span class="ident" id="6595489">nil</span>&nbsp;<span class="op" id="6595493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595497">t</span><span class="op" id="6595498">.</span><span class="ident" id="6595499">Fatalf</span><span class="op" id="6595505">(</span><span class="string" id="6595506">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6595521">,</span>&nbsp;<span class="ident" id="6595523">err</span><span class="op" id="6595526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595532">w</span><span class="op" id="6595533">.</span><span class="ident" id="6595534">Write</span><span class="op" id="6595539">(</span><span class="op" id="6595540">[</span><span class="op" id="6595541">]</span><span class="builtintype" id="6595542">byte</span><span class="op" id="6595546">(</span><span class="ident" id="6595547">dict</span><span class="op" id="6595551">)</span><span class="op" id="6595552">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595555">w</span><span class="op" id="6595556">.</span><span class="ident" id="6595557">Flush</span><span class="op" id="6595562">(</span><span class="op" id="6595563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595566">b</span><span class="op" id="6595567">.</span><span class="ident" id="6595568">Reset</span><span class="op" id="6595573">(</span><span class="op" id="6595574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595577">w</span><span class="op" id="6595578">.</span><span class="ident" id="6595579">Write</span><span class="op" id="6595584">(</span><span class="op" id="6595585">[</span><span class="op" id="6595586">]</span><span class="builtintype" id="6595587">byte</span><span class="op" id="6595591">(</span><span class="ident" id="6595592">text</span><span class="op" id="6595596">)</span><span class="op" id="6595597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595600">w</span><span class="op" id="6595601">.</span><span class="ident" id="6595602">Close</span><span class="op" id="6595607">(</span><span class="op" id="6595608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595612">var</span>&nbsp;<span class="ident" id="6595616">b1</span>&nbsp;<span class="ident" id="6595619">bytes</span><span class="op" id="6595624">.</span><span class="ident" id="6595625">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595633">w</span><span class="op" id="6595634">,</span>&nbsp;<span class="ident" id="6595636">_</span>&nbsp;<span class="op" id="6595638">=</span>&nbsp;<span class="ident" id="6595640">NewWriterDict</span><span class="op" id="6595653">(</span><span class="op" id="6595654">&amp;</span><span class="ident" id="6595655">b1</span><span class="op" id="6595657">,</span>&nbsp;<span class="num" id="6595659">5</span><span class="op" id="6595660">,</span>&nbsp;<span class="op" id="6595662">[</span><span class="op" id="6595663">]</span><span class="builtintype" id="6595664">byte</span><span class="op" id="6595668">(</span><span class="ident" id="6595669">dict</span><span class="op" id="6595673">)</span><span class="op" id="6595674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595677">w</span><span class="op" id="6595678">.</span><span class="ident" id="6595679">Write</span><span class="op" id="6595684">(</span><span class="op" id="6595685">[</span><span class="op" id="6595686">]</span><span class="builtintype" id="6595687">byte</span><span class="op" id="6595691">(</span><span class="ident" id="6595692">text</span><span class="op" id="6595696">)</span><span class="op" id="6595697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595700">w</span><span class="op" id="6595701">.</span><span class="ident" id="6595702">Close</span><span class="op" id="6595707">(</span><span class="op" id="6595708">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595712">if</span>&nbsp;<span class="op" id="6595715">!</span><span class="ident" id="6595716">bytes</span><span class="op" id="6595721">.</span><span class="ident" id="6595722">Equal</span><span class="op" id="6595727">(</span><span class="ident" id="6595728">b1</span><span class="op" id="6595730">.</span><span class="ident" id="6595731">Bytes</span><span class="op" id="6595736">(</span><span class="op" id="6595737">)</span><span class="op" id="6595738">,</span>&nbsp;<span class="ident" id="6595740">b</span><span class="op" id="6595741">.</span><span class="ident" id="6595742">Bytes</span><span class="op" id="6595747">(</span><span class="op" id="6595748">)</span><span class="op" id="6595749">)</span>&nbsp;<span class="op" id="6595751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595755">t</span><span class="op" id="6595756">.</span><span class="ident" id="6595757">Fatalf</span><span class="op" id="6595763">(</span><span class="string" id="6595764">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6595789">,</span>&nbsp;<span class="ident" id="6595791">b1</span><span class="op" id="6595793">.</span><span class="ident" id="6595794">Bytes</span><span class="op" id="6595799">(</span><span class="op" id="6595800">)</span><span class="op" id="6595801">,</span>&nbsp;<span class="ident" id="6595803">b</span><span class="op" id="6595804">.</span><span class="ident" id="6595805">Bytes</span><span class="op" id="6595810">(</span><span class="op" id="6595811">)</span><span class="op" id="6595812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595815">}</span><br>
<span class="lineno"></span><span class="op" id="6595817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="6595820">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="6595877">func</span>&nbsp;<span class="ident" id="6595882">TestRegression2508</span><span class="op" id="6595900">(</span><span class="ident" id="6595901">t</span>&nbsp;<span class="op" id="6595903">*</span><span class="ident" id="6595904">testing</span><span class="op" id="6595911">.</span><span class="ident" id="6595912">T</span><span class="op" id="6595913">)</span>&nbsp;<span class="op" id="6595915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595918">if</span>&nbsp;<span class="ident" id="6595921">testing</span><span class="op" id="6595928">.</span><span class="ident" id="6595929">Short</span><span class="op" id="6595934">(</span><span class="op" id="6595935">)</span>&nbsp;<span class="op" id="6595937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595941">t</span><span class="op" id="6595942">.</span><span class="ident" id="6595943">Logf</span><span class="op" id="6595947">(</span><span class="string" id="6595948">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="6595975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6595979">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6595987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6595990">w</span><span class="op" id="6595991">,</span>&nbsp;<span class="ident" id="6595993">err</span>&nbsp;<span class="op" id="6595997">:=</span>&nbsp;<span class="ident" id="6596000">NewWriter</span><span class="op" id="6596009">(</span><span class="ident" id="6596010">ioutil</span><span class="op" id="6596016">.</span><span class="ident" id="6596017">Discard</span><span class="op" id="6596024">,</span>&nbsp;<span class="num" id="6596026">1</span><span class="op" id="6596027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596030">if</span>&nbsp;<span class="ident" id="6596033">err</span>&nbsp;<span class="op" id="6596037">!=</span>&nbsp;<span class="ident" id="6596040">nil</span>&nbsp;<span class="op" id="6596044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596048">t</span><span class="op" id="6596049">.</span><span class="ident" id="6596050">Fatalf</span><span class="op" id="6596056">(</span><span class="string" id="6596057">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6596072">,</span>&nbsp;<span class="ident" id="6596074">err</span><span class="op" id="6596077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596080">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596083">buf</span>&nbsp;<span class="op" id="6596087">:=</span>&nbsp;<span class="builtinfunc" id="6596090">make</span><span class="op" id="6596094">(</span><span class="op" id="6596095">[</span><span class="op" id="6596096">]</span><span class="builtintype" id="6596097">byte</span><span class="op" id="6596101">,</span>&nbsp;<span class="num" id="6596103">1024</span><span class="op" id="6596107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596110">for</span>&nbsp;<span class="ident" id="6596114">i</span>&nbsp;<span class="op" id="6596116">:=</span>&nbsp;<span class="num" id="6596119">0</span><span class="op" id="6596120">;</span>&nbsp;<span class="ident" id="6596122">i</span>&nbsp;<span class="op" id="6596124">&lt;</span>&nbsp;<span class="num" id="6596126">131072</span><span class="op" id="6596132">;</span>&nbsp;<span class="ident" id="6596134">i</span><span class="op" id="6596135">++</span>&nbsp;<span class="op" id="6596138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596142">if</span>&nbsp;<span class="ident" id="6596145">_</span><span class="op" id="6596146">,</span>&nbsp;<span class="ident" id="6596148">err</span>&nbsp;<span class="op" id="6596152">:=</span>&nbsp;<span class="ident" id="6596155">w</span><span class="op" id="6596156">.</span><span class="ident" id="6596157">Write</span><span class="op" id="6596162">(</span><span class="ident" id="6596163">buf</span><span class="op" id="6596166">)</span><span class="op" id="6596167">;</span>&nbsp;<span class="ident" id="6596169">err</span>&nbsp;<span class="op" id="6596173">!=</span>&nbsp;<span class="ident" id="6596176">nil</span>&nbsp;<span class="op" id="6596180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596185">t</span><span class="op" id="6596186">.</span><span class="ident" id="6596187">Fatalf</span><span class="op" id="6596193">(</span><span class="string" id="6596194">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6596213">,</span>&nbsp;<span class="ident" id="6596215">err</span><span class="op" id="6596218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596222">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596225">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596228">w</span><span class="op" id="6596229">.</span><span class="ident" id="6596230">Close</span><span class="op" id="6596235">(</span><span class="op" id="6596236">)</span><br>
<span class="lineno"></span><span class="op" id="6596238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6596241">func</span>&nbsp;<span class="ident" id="6596246">TestWriterReset</span><span class="op" id="6596261">(</span><span class="ident" id="6596262">t</span>&nbsp;<span class="op" id="6596264">*</span><span class="ident" id="6596265">testing</span><span class="op" id="6596272">.</span><span class="ident" id="6596273">T</span><span class="op" id="6596274">)</span>&nbsp;<span class="op" id="6596276">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596279">for</span>&nbsp;<span class="ident" id="6596283">level</span>&nbsp;<span class="op" id="6596289">:=</span>&nbsp;<span class="num" id="6596292">0</span><span class="op" id="6596293">;</span>&nbsp;<span class="ident" id="6596295">level</span>&nbsp;<span class="op" id="6596301">&lt;=</span>&nbsp;<span class="num" id="6596304">9</span><span class="op" id="6596305">;</span>&nbsp;<span class="ident" id="6596307">level</span><span class="op" id="6596312">++</span>&nbsp;<span class="op" id="6596315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596319">if</span>&nbsp;<span class="ident" id="6596322">testing</span><span class="op" id="6596329">.</span><span class="ident" id="6596330">Short</span><span class="op" id="6596335">(</span><span class="op" id="6596336">)</span>&nbsp;<span class="op" id="6596338">&amp;&amp;</span>&nbsp;<span class="ident" id="6596341">level</span>&nbsp;<span class="op" id="6596347">&gt;</span>&nbsp;<span class="num" id="6596349">1</span>&nbsp;<span class="op" id="6596351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596356">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596368">w</span><span class="op" id="6596369">,</span>&nbsp;<span class="ident" id="6596371">err</span>&nbsp;<span class="op" id="6596375">:=</span>&nbsp;<span class="ident" id="6596378">NewWriter</span><span class="op" id="6596387">(</span><span class="ident" id="6596388">ioutil</span><span class="op" id="6596394">.</span><span class="ident" id="6596395">Discard</span><span class="op" id="6596402">,</span>&nbsp;<span class="ident" id="6596404">level</span><span class="op" id="6596409">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596413">if</span>&nbsp;<span class="ident" id="6596416">err</span>&nbsp;<span class="op" id="6596420">!=</span>&nbsp;<span class="ident" id="6596423">nil</span>&nbsp;<span class="op" id="6596427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596432">t</span><span class="op" id="6596433">.</span><span class="ident" id="6596434">Fatalf</span><span class="op" id="6596440">(</span><span class="string" id="6596441">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6596456">,</span>&nbsp;<span class="ident" id="6596458">err</span><span class="op" id="6596461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596469">buf</span>&nbsp;<span class="op" id="6596473">:=</span>&nbsp;<span class="op" id="6596476">[</span><span class="op" id="6596477">]</span><span class="builtintype" id="6596478">byte</span><span class="op" id="6596482">(</span><span class="string" id="6596483">&#34;hello&nbsp;world&#34;</span><span class="op" id="6596496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596500">for</span>&nbsp;<span class="ident" id="6596504">i</span>&nbsp;<span class="op" id="6596506">:=</span>&nbsp;<span class="num" id="6596509">0</span><span class="op" id="6596510">;</span>&nbsp;<span class="ident" id="6596512">i</span>&nbsp;<span class="op" id="6596514">&lt;</span>&nbsp;<span class="num" id="6596516">1024</span><span class="op" id="6596520">;</span>&nbsp;<span class="ident" id="6596522">i</span><span class="op" id="6596523">++</span>&nbsp;<span class="op" id="6596526">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596531">w</span><span class="op" id="6596532">.</span><span class="ident" id="6596533">Write</span><span class="op" id="6596538">(</span><span class="ident" id="6596539">buf</span><span class="op" id="6596542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596550">w</span><span class="op" id="6596551">.</span><span class="ident" id="6596552">Reset</span><span class="op" id="6596557">(</span><span class="ident" id="6596558">ioutil</span><span class="op" id="6596564">.</span><span class="ident" id="6596565">Discard</span><span class="op" id="6596572">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596577">wref</span><span class="op" id="6596581">,</span>&nbsp;<span class="ident" id="6596583">err</span>&nbsp;<span class="op" id="6596587">:=</span>&nbsp;<span class="ident" id="6596590">NewWriter</span><span class="op" id="6596599">(</span><span class="ident" id="6596600">ioutil</span><span class="op" id="6596606">.</span><span class="ident" id="6596607">Discard</span><span class="op" id="6596614">,</span>&nbsp;<span class="ident" id="6596616">level</span><span class="op" id="6596621">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596625">if</span>&nbsp;<span class="ident" id="6596628">err</span>&nbsp;<span class="op" id="6596632">!=</span>&nbsp;<span class="ident" id="6596635">nil</span>&nbsp;<span class="op" id="6596639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596644">t</span><span class="op" id="6596645">.</span><span class="ident" id="6596646">Fatalf</span><span class="op" id="6596652">(</span><span class="string" id="6596653">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6596668">,</span>&nbsp;<span class="ident" id="6596670">err</span><span class="op" id="6596673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6596682">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596724">w</span><span class="op" id="6596725">.</span><span class="ident" id="6596726">d</span><span class="op" id="6596727">.</span><span class="ident" id="6596728">fill</span><span class="op" id="6596732">,</span>&nbsp;<span class="ident" id="6596734">wref</span><span class="op" id="6596738">.</span><span class="ident" id="6596739">d</span><span class="op" id="6596740">.</span><span class="ident" id="6596741">fill</span>&nbsp;<span class="op" id="6596746">=</span>&nbsp;<span class="ident" id="6596748">nil</span><span class="op" id="6596751">,</span>&nbsp;<span class="ident" id="6596753">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596759">w</span><span class="op" id="6596760">.</span><span class="ident" id="6596761">d</span><span class="op" id="6596762">.</span><span class="ident" id="6596763">step</span><span class="op" id="6596767">,</span>&nbsp;<span class="ident" id="6596769">wref</span><span class="op" id="6596773">.</span><span class="ident" id="6596774">d</span><span class="op" id="6596775">.</span><span class="ident" id="6596776">step</span>&nbsp;<span class="op" id="6596781">=</span>&nbsp;<span class="ident" id="6596783">nil</span><span class="op" id="6596786">,</span>&nbsp;<span class="ident" id="6596788">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6596794">if</span>&nbsp;<span class="op" id="6596797">!</span><span class="ident" id="6596798">reflect</span><span class="op" id="6596805">.</span><span class="ident" id="6596806">DeepEqual</span><span class="op" id="6596815">(</span><span class="ident" id="6596816">w</span><span class="op" id="6596817">,</span>&nbsp;<span class="ident" id="6596819">wref</span><span class="op" id="6596823">)</span>&nbsp;<span class="op" id="6596825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596830">t</span><span class="op" id="6596831">.</span><span class="ident" id="6596832">Errorf</span><span class="op" id="6596838">(</span><span class="string" id="6596839">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="6596878">,</span>&nbsp;<span class="ident" id="6596880">level</span><span class="op" id="6596885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596889">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6596892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596895">testResetOutput</span><span class="op" id="6596910">(</span><span class="ident" id="6596911">t</span><span class="op" id="6596912">,</span>&nbsp;<span class="keyword" id="6596914">func</span><span class="op" id="6596918">(</span><span class="ident" id="6596919">w</span>&nbsp;<span class="ident" id="6596921">io</span><span class="op" id="6596923">.</span><span class="ident" id="6596924">Writer</span><span class="op" id="6596930">)</span>&nbsp;<span class="op" id="6596932">(</span><span class="op" id="6596933">*</span><span class="ident" id="6596934">Writer</span><span class="op" id="6596940">,</span>&nbsp;<span class="builtintype" id="6596942">error</span><span class="op" id="6596947">)</span>&nbsp;<span class="op" id="6596949">{</span>&nbsp;<span class="keyword" id="6596951">return</span>&nbsp;<span class="ident" id="6596958">NewWriter</span><span class="op" id="6596967">(</span><span class="ident" id="6596968">w</span><span class="op" id="6596969">,</span>&nbsp;<span class="ident" id="6596971">NoCompression</span><span class="op" id="6596984">)</span>&nbsp;<span class="op" id="6596986">}</span><span class="op" id="6596987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6596990">testResetOutput</span><span class="op" id="6597005">(</span><span class="ident" id="6597006">t</span><span class="op" id="6597007">,</span>&nbsp;<span class="keyword" id="6597009">func</span><span class="op" id="6597013">(</span><span class="ident" id="6597014">w</span>&nbsp;<span class="ident" id="6597016">io</span><span class="op" id="6597018">.</span><span class="ident" id="6597019">Writer</span><span class="op" id="6597025">)</span>&nbsp;<span class="op" id="6597027">(</span><span class="op" id="6597028">*</span><span class="ident" id="6597029">Writer</span><span class="op" id="6597035">,</span>&nbsp;<span class="builtintype" id="6597037">error</span><span class="op" id="6597042">)</span>&nbsp;<span class="op" id="6597044">{</span>&nbsp;<span class="keyword" id="6597046">return</span>&nbsp;<span class="ident" id="6597053">NewWriter</span><span class="op" id="6597062">(</span><span class="ident" id="6597063">w</span><span class="op" id="6597064">,</span>&nbsp;<span class="ident" id="6597066">DefaultCompression</span><span class="op" id="6597084">)</span>&nbsp;<span class="op" id="6597086">}</span><span class="op" id="6597087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597090">testResetOutput</span><span class="op" id="6597105">(</span><span class="ident" id="6597106">t</span><span class="op" id="6597107">,</span>&nbsp;<span class="keyword" id="6597109">func</span><span class="op" id="6597113">(</span><span class="ident" id="6597114">w</span>&nbsp;<span class="ident" id="6597116">io</span><span class="op" id="6597118">.</span><span class="ident" id="6597119">Writer</span><span class="op" id="6597125">)</span>&nbsp;<span class="op" id="6597127">(</span><span class="op" id="6597128">*</span><span class="ident" id="6597129">Writer</span><span class="op" id="6597135">,</span>&nbsp;<span class="builtintype" id="6597137">error</span><span class="op" id="6597142">)</span>&nbsp;<span class="op" id="6597144">{</span>&nbsp;<span class="keyword" id="6597146">return</span>&nbsp;<span class="ident" id="6597153">NewWriter</span><span class="op" id="6597162">(</span><span class="ident" id="6597163">w</span><span class="op" id="6597164">,</span>&nbsp;<span class="ident" id="6597166">BestCompression</span><span class="op" id="6597181">)</span>&nbsp;<span class="op" id="6597183">}</span><span class="op" id="6597184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597187">dict</span>&nbsp;<span class="op" id="6597192">:=</span>&nbsp;<span class="op" id="6597195">[</span><span class="op" id="6597196">]</span><span class="builtintype" id="6597197">byte</span><span class="op" id="6597201">(</span><span class="string" id="6597202">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="6597220">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597223">testResetOutput</span><span class="op" id="6597238">(</span><span class="ident" id="6597239">t</span><span class="op" id="6597240">,</span>&nbsp;<span class="keyword" id="6597242">func</span><span class="op" id="6597246">(</span><span class="ident" id="6597247">w</span>&nbsp;<span class="ident" id="6597249">io</span><span class="op" id="6597251">.</span><span class="ident" id="6597252">Writer</span><span class="op" id="6597258">)</span>&nbsp;<span class="op" id="6597260">(</span><span class="op" id="6597261">*</span><span class="ident" id="6597262">Writer</span><span class="op" id="6597268">,</span>&nbsp;<span class="builtintype" id="6597270">error</span><span class="op" id="6597275">)</span>&nbsp;<span class="op" id="6597277">{</span>&nbsp;<span class="keyword" id="6597279">return</span>&nbsp;<span class="ident" id="6597286">NewWriterDict</span><span class="op" id="6597299">(</span><span class="ident" id="6597300">w</span><span class="op" id="6597301">,</span>&nbsp;<span class="ident" id="6597303">NoCompression</span><span class="op" id="6597316">,</span>&nbsp;<span class="ident" id="6597318">dict</span><span class="op" id="6597322">)</span>&nbsp;<span class="op" id="6597324">}</span><span class="op" id="6597325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597328">testResetOutput</span><span class="op" id="6597343">(</span><span class="ident" id="6597344">t</span><span class="op" id="6597345">,</span>&nbsp;<span class="keyword" id="6597347">func</span><span class="op" id="6597351">(</span><span class="ident" id="6597352">w</span>&nbsp;<span class="ident" id="6597354">io</span><span class="op" id="6597356">.</span><span class="ident" id="6597357">Writer</span><span class="op" id="6597363">)</span>&nbsp;<span class="op" id="6597365">(</span><span class="op" id="6597366">*</span><span class="ident" id="6597367">Writer</span><span class="op" id="6597373">,</span>&nbsp;<span class="builtintype" id="6597375">error</span><span class="op" id="6597380">)</span>&nbsp;<span class="op" id="6597382">{</span>&nbsp;<span class="keyword" id="6597384">return</span>&nbsp;<span class="ident" id="6597391">NewWriterDict</span><span class="op" id="6597404">(</span><span class="ident" id="6597405">w</span><span class="op" id="6597406">,</span>&nbsp;<span class="ident" id="6597408">DefaultCompression</span><span class="op" id="6597426">,</span>&nbsp;<span class="ident" id="6597428">dict</span><span class="op" id="6597432">)</span>&nbsp;<span class="op" id="6597434">}</span><span class="op" id="6597435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597438">testResetOutput</span><span class="op" id="6597453">(</span><span class="ident" id="6597454">t</span><span class="op" id="6597455">,</span>&nbsp;<span class="keyword" id="6597457">func</span><span class="op" id="6597461">(</span><span class="ident" id="6597462">w</span>&nbsp;<span class="ident" id="6597464">io</span><span class="op" id="6597466">.</span><span class="ident" id="6597467">Writer</span><span class="op" id="6597473">)</span>&nbsp;<span class="op" id="6597475">(</span><span class="op" id="6597476">*</span><span class="ident" id="6597477">Writer</span><span class="op" id="6597483">,</span>&nbsp;<span class="builtintype" id="6597485">error</span><span class="op" id="6597490">)</span>&nbsp;<span class="op" id="6597492">{</span>&nbsp;<span class="keyword" id="6597494">return</span>&nbsp;<span class="ident" id="6597501">NewWriterDict</span><span class="op" id="6597514">(</span><span class="ident" id="6597515">w</span><span class="op" id="6597516">,</span>&nbsp;<span class="ident" id="6597518">BestCompression</span><span class="op" id="6597533">,</span>&nbsp;<span class="ident" id="6597535">dict</span><span class="op" id="6597539">)</span>&nbsp;<span class="op" id="6597541">}</span><span class="op" id="6597542">)</span><br>
<span class="lineno"></span><span class="op" id="6597544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="6597547">func</span>&nbsp;<span class="ident" id="6597552">testResetOutput</span><span class="op" id="6597567">(</span><span class="ident" id="6597568">t</span>&nbsp;<span class="op" id="6597570">*</span><span class="ident" id="6597571">testing</span><span class="op" id="6597578">.</span><span class="ident" id="6597579">T</span><span class="op" id="6597580">,</span>&nbsp;<span class="ident" id="6597582">newWriter</span>&nbsp;<span class="keyword" id="6597592">func</span><span class="op" id="6597596">(</span><span class="ident" id="6597597">w</span>&nbsp;<span class="ident" id="6597599">io</span><span class="op" id="6597601">.</span><span class="ident" id="6597602">Writer</span><span class="op" id="6597608">)</span>&nbsp;<span class="op" id="6597610">(</span><span class="op" id="6597611">*</span><span class="ident" id="6597612">Writer</span><span class="op" id="6597618">,</span>&nbsp;<span class="builtintype" id="6597620">error</span><span class="op" id="6597625">)</span><span class="op" id="6597626">)</span>&nbsp;<span class="op" id="6597628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597631">buf</span>&nbsp;<span class="op" id="6597635">:=</span>&nbsp;<span class="builtinfunc" id="6597638">new</span><span class="op" id="6597641">(</span><span class="ident" id="6597642">bytes</span><span class="op" id="6597647">.</span><span class="ident" id="6597648">Buffer</span><span class="op" id="6597654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597657">w</span><span class="op" id="6597658">,</span>&nbsp;<span class="ident" id="6597660">err</span>&nbsp;<span class="op" id="6597664">:=</span>&nbsp;<span class="ident" id="6597667">newWriter</span><span class="op" id="6597676">(</span><span class="ident" id="6597677">buf</span><span class="op" id="6597680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597683">if</span>&nbsp;<span class="ident" id="6597686">err</span>&nbsp;<span class="op" id="6597690">!=</span>&nbsp;<span class="ident" id="6597693">nil</span>&nbsp;<span class="op" id="6597697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597701">t</span><span class="op" id="6597702">.</span><span class="ident" id="6597703">Fatalf</span><span class="op" id="6597709">(</span><span class="string" id="6597710">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6597725">,</span>&nbsp;<span class="ident" id="6597727">err</span><span class="op" id="6597730">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597736">b</span>&nbsp;<span class="op" id="6597738">:=</span>&nbsp;<span class="op" id="6597741">[</span><span class="op" id="6597742">]</span><span class="builtintype" id="6597743">byte</span><span class="op" id="6597747">(</span><span class="string" id="6597748">&#34;hello&nbsp;world&#34;</span><span class="op" id="6597761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597764">for</span>&nbsp;<span class="ident" id="6597768">i</span>&nbsp;<span class="op" id="6597770">:=</span>&nbsp;<span class="num" id="6597773">0</span><span class="op" id="6597774">;</span>&nbsp;<span class="ident" id="6597776">i</span>&nbsp;<span class="op" id="6597778">&lt;</span>&nbsp;<span class="num" id="6597780">1024</span><span class="op" id="6597784">;</span>&nbsp;<span class="ident" id="6597786">i</span><span class="op" id="6597787">++</span>&nbsp;<span class="op" id="6597790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597794">w</span><span class="op" id="6597795">.</span><span class="ident" id="6597796">Write</span><span class="op" id="6597801">(</span><span class="ident" id="6597802">b</span><span class="op" id="6597803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597806">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597809">w</span><span class="op" id="6597810">.</span><span class="ident" id="6597811">Close</span><span class="op" id="6597816">(</span><span class="op" id="6597817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597820">out1</span>&nbsp;<span class="op" id="6597825">:=</span>&nbsp;<span class="ident" id="6597828">buf</span><span class="op" id="6597831">.</span><span class="ident" id="6597832">String</span><span class="op" id="6597838">(</span><span class="op" id="6597839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597843">buf2</span>&nbsp;<span class="op" id="6597848">:=</span>&nbsp;<span class="builtinfunc" id="6597851">new</span><span class="op" id="6597854">(</span><span class="ident" id="6597855">bytes</span><span class="op" id="6597860">.</span><span class="ident" id="6597861">Buffer</span><span class="op" id="6597867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597870">w</span><span class="op" id="6597871">.</span><span class="ident" id="6597872">Reset</span><span class="op" id="6597877">(</span><span class="ident" id="6597878">buf2</span><span class="op" id="6597882">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597885">for</span>&nbsp;<span class="ident" id="6597889">i</span>&nbsp;<span class="op" id="6597891">:=</span>&nbsp;<span class="num" id="6597894">0</span><span class="op" id="6597895">;</span>&nbsp;<span class="ident" id="6597897">i</span>&nbsp;<span class="op" id="6597899">&lt;</span>&nbsp;<span class="num" id="6597901">1024</span><span class="op" id="6597905">;</span>&nbsp;<span class="ident" id="6597907">i</span><span class="op" id="6597908">++</span>&nbsp;<span class="op" id="6597911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597915">w</span><span class="op" id="6597916">.</span><span class="ident" id="6597917">Write</span><span class="op" id="6597922">(</span><span class="ident" id="6597923">b</span><span class="op" id="6597924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6597927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597930">w</span><span class="op" id="6597931">.</span><span class="ident" id="6597932">Close</span><span class="op" id="6597937">(</span><span class="op" id="6597938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597941">out2</span>&nbsp;<span class="op" id="6597946">:=</span>&nbsp;<span class="ident" id="6597949">buf2</span><span class="op" id="6597953">.</span><span class="ident" id="6597954">String</span><span class="op" id="6597960">(</span><span class="op" id="6597961">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6597965">if</span>&nbsp;<span class="ident" id="6597968">out1</span>&nbsp;<span class="op" id="6597973">!=</span>&nbsp;<span class="ident" id="6597976">out2</span>&nbsp;<span class="op" id="6597981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6597985">t</span><span class="op" id="6597986">.</span><span class="ident" id="6597987">Errorf</span><span class="op" id="6597993">(</span><span class="string" id="6597994">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6598015">,</span>&nbsp;<span class="ident" id="6598017">out2</span><span class="op" id="6598021">,</span>&nbsp;<span class="ident" id="6598023">out1</span><span class="op" id="6598027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6598030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6598033">t</span><span class="op" id="6598034">.</span><span class="ident" id="6598035">Logf</span><span class="op" id="6598039">(</span><span class="string" id="6598040">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6598054">,</span>&nbsp;<span class="builtinfunc" id="6598056">len</span><span class="op" id="6598059">(</span><span class="ident" id="6598060">out1</span><span class="op" id="6598064">)</span><span class="op" id="6598065">)</span><br>
<span class="lineno">490</span><span class="op" id="6598067">}</span>
</div>
</body>
</html>
