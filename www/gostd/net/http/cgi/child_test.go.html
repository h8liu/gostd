<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/cgi</h2>
<ul>
<li><a href="/gostd/net/http/cgi/child.go.html">child.go</a></li>
<li><a href="/gostd/net/http/cgi/child_test.go.html">child_test.go</a></li>
<li><a href="/gostd/net/http/cgi/host.go.html">host.go</a></li>
<li><a href="/gostd/net/http/cgi/host_test.go.html">host_test.go</a></li>
<li><a href="/gostd/net/http/cgi/matryoshka_test.go.html">matryoshka_test.go</a></li>
<li><a href="/gostd/net/http/cgi/posix_test.go.html">posix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8148889">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8148944">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8148998">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8149049">//&nbsp;Tests&nbsp;for&nbsp;CGI&nbsp;(the&nbsp;child&nbsp;process&nbsp;perspective)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149099">package</span>&nbsp;<span class="ident" id="8149107">cgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149112">import</span>&nbsp;<span class="op" id="8149119">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149122">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8149132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8149135">func</span>&nbsp;<span class="ident" id="8149140">TestRequest</span><span class="op" id="8149151">(</span><span class="ident" id="8149152">t</span>&nbsp;<span class="op" id="8149154">*</span><span class="ident" id="8149155">testing</span><span class="op" id="8149162">.</span><span class="ident" id="8149163">T</span><span class="op" id="8149164">)</span>&nbsp;<span class="op" id="8149166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149169">env</span>&nbsp;<span class="op" id="8149173">:=</span>&nbsp;<span class="keyword" id="8149176">map</span><span class="op" id="8149179">[</span><span class="builtintype" id="8149180">string</span><span class="op" id="8149186">]</span><span class="builtintype" id="8149187">string</span><span class="op" id="8149193">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149197">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8149214">:</span>&nbsp;<span class="string" id="8149216">&#34;HTTP/1.1&#34;</span><span class="op" id="8149226">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149230">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8149246">:</span>&nbsp;&nbsp;<span class="string" id="8149249">&#34;GET&#34;</span><span class="op" id="8149254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149258">&#34;HTTP_HOST&#34;</span><span class="op" id="8149269">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149277">&#34;example.com&#34;</span><span class="op" id="8149290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149294">&#34;HTTP_REFERER&#34;</span><span class="op" id="8149308">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149313">&#34;elsewhere&#34;</span><span class="op" id="8149324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149328">&#34;HTTP_USER_AGENT&#34;</span><span class="op" id="8149345">:</span>&nbsp;<span class="string" id="8149347">&#34;goclient&#34;</span><span class="op" id="8149357">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149361">&#34;HTTP_FOO_BAR&#34;</span><span class="op" id="8149375">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149380">&#34;baz&#34;</span><span class="op" id="8149385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149389">&#34;REQUEST_URI&#34;</span><span class="op" id="8149402">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149408">&#34;/path?a=b&#34;</span><span class="op" id="8149419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149423">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8149439">:</span>&nbsp;&nbsp;<span class="string" id="8149442">&#34;123&#34;</span><span class="op" id="8149447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149451">&#34;CONTENT_TYPE&#34;</span><span class="op" id="8149465">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149470">&#34;text/xml&#34;</span><span class="op" id="8149480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8149484">&#34;REMOTE_ADDR&#34;</span><span class="op" id="8149497">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8149503">&#34;5.6.7.8&#34;</span><span class="op" id="8149512">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149518">req</span><span class="op" id="8149521">,</span>&nbsp;<span class="ident" id="8149523">err</span>&nbsp;<span class="op" id="8149527">:=</span>&nbsp;<span class="ident" id="8149530">RequestFromMap</span><span class="op" id="8149544">(</span><span class="ident" id="8149545">env</span><span class="op" id="8149548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149551">if</span>&nbsp;<span class="ident" id="8149554">err</span>&nbsp;<span class="op" id="8149558">!=</span>&nbsp;<span class="ident" id="8149561">nil</span>&nbsp;<span class="op" id="8149565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149569">t</span><span class="op" id="8149570">.</span><span class="ident" id="8149571">Fatalf</span><span class="op" id="8149577">(</span><span class="string" id="8149578">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8149598">,</span>&nbsp;<span class="ident" id="8149600">err</span><span class="op" id="8149603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149606">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149609">if</span>&nbsp;<span class="ident" id="8149612">g</span><span class="op" id="8149613">,</span>&nbsp;<span class="ident" id="8149615">e</span>&nbsp;<span class="op" id="8149617">:=</span>&nbsp;<span class="ident" id="8149620">req</span><span class="op" id="8149623">.</span><span class="ident" id="8149624">UserAgent</span><span class="op" id="8149633">(</span><span class="op" id="8149634">)</span><span class="op" id="8149635">,</span>&nbsp;<span class="string" id="8149637">&#34;goclient&#34;</span><span class="op" id="8149647">;</span>&nbsp;<span class="ident" id="8149649">e</span>&nbsp;<span class="op" id="8149651">!=</span>&nbsp;<span class="ident" id="8149654">g</span>&nbsp;<span class="op" id="8149656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149660">t</span><span class="op" id="8149661">.</span><span class="ident" id="8149662">Errorf</span><span class="op" id="8149668">(</span><span class="string" id="8149669">&#34;expected&nbsp;UserAgent&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8149700">,</span>&nbsp;<span class="ident" id="8149702">e</span><span class="op" id="8149703">,</span>&nbsp;<span class="ident" id="8149705">g</span><span class="op" id="8149706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149712">if</span>&nbsp;<span class="ident" id="8149715">g</span><span class="op" id="8149716">,</span>&nbsp;<span class="ident" id="8149718">e</span>&nbsp;<span class="op" id="8149720">:=</span>&nbsp;<span class="ident" id="8149723">req</span><span class="op" id="8149726">.</span><span class="ident" id="8149727">Method</span><span class="op" id="8149733">,</span>&nbsp;<span class="string" id="8149735">&#34;GET&#34;</span><span class="op" id="8149740">;</span>&nbsp;<span class="ident" id="8149742">e</span>&nbsp;<span class="op" id="8149744">!=</span>&nbsp;<span class="ident" id="8149747">g</span>&nbsp;<span class="op" id="8149749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149753">t</span><span class="op" id="8149754">.</span><span class="ident" id="8149755">Errorf</span><span class="op" id="8149761">(</span><span class="string" id="8149762">&#34;expected&nbsp;Method&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8149790">,</span>&nbsp;<span class="ident" id="8149792">e</span><span class="op" id="8149793">,</span>&nbsp;<span class="ident" id="8149795">g</span><span class="op" id="8149796">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149802">if</span>&nbsp;<span class="ident" id="8149805">g</span><span class="op" id="8149806">,</span>&nbsp;<span class="ident" id="8149808">e</span>&nbsp;<span class="op" id="8149810">:=</span>&nbsp;<span class="ident" id="8149813">req</span><span class="op" id="8149816">.</span><span class="ident" id="8149817">Header</span><span class="op" id="8149823">.</span><span class="ident" id="8149824">Get</span><span class="op" id="8149827">(</span><span class="string" id="8149828">&#34;Content-Type&#34;</span><span class="op" id="8149842">)</span><span class="op" id="8149843">,</span>&nbsp;<span class="string" id="8149845">&#34;text/xml&#34;</span><span class="op" id="8149855">;</span>&nbsp;<span class="ident" id="8149857">e</span>&nbsp;<span class="op" id="8149859">!=</span>&nbsp;<span class="ident" id="8149862">g</span>&nbsp;<span class="op" id="8149864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149868">t</span><span class="op" id="8149869">.</span><span class="ident" id="8149870">Errorf</span><span class="op" id="8149876">(</span><span class="string" id="8149877">&#34;expected&nbsp;Content-Type&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8149911">,</span>&nbsp;<span class="ident" id="8149913">e</span><span class="op" id="8149914">,</span>&nbsp;<span class="ident" id="8149916">g</span><span class="op" id="8149917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8149920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8149923">if</span>&nbsp;<span class="ident" id="8149926">g</span><span class="op" id="8149927">,</span>&nbsp;<span class="ident" id="8149929">e</span>&nbsp;<span class="op" id="8149931">:=</span>&nbsp;<span class="ident" id="8149934">req</span><span class="op" id="8149937">.</span><span class="ident" id="8149938">ContentLength</span><span class="op" id="8149951">,</span>&nbsp;<span class="ident" id="8149953">int64</span><span class="op" id="8149958">(</span><span class="num" id="8149959">123</span><span class="op" id="8149962">)</span><span class="op" id="8149963">;</span>&nbsp;<span class="ident" id="8149965">e</span>&nbsp;<span class="op" id="8149967">!=</span>&nbsp;<span class="ident" id="8149970">g</span>&nbsp;<span class="op" id="8149972">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8149976">t</span><span class="op" id="8149977">.</span><span class="ident" id="8149978">Errorf</span><span class="op" id="8149984">(</span><span class="string" id="8149985">&#34;expected&nbsp;ContentLength&nbsp;%d;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="8150020">,</span>&nbsp;<span class="ident" id="8150022">e</span><span class="op" id="8150023">,</span>&nbsp;<span class="ident" id="8150025">g</span><span class="op" id="8150026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150032">if</span>&nbsp;<span class="ident" id="8150035">g</span><span class="op" id="8150036">,</span>&nbsp;<span class="ident" id="8150038">e</span>&nbsp;<span class="op" id="8150040">:=</span>&nbsp;<span class="ident" id="8150043">req</span><span class="op" id="8150046">.</span><span class="ident" id="8150047">Referer</span><span class="op" id="8150054">(</span><span class="op" id="8150055">)</span><span class="op" id="8150056">,</span>&nbsp;<span class="string" id="8150058">&#34;elsewhere&#34;</span><span class="op" id="8150069">;</span>&nbsp;<span class="ident" id="8150071">e</span>&nbsp;<span class="op" id="8150073">!=</span>&nbsp;<span class="ident" id="8150076">g</span>&nbsp;<span class="op" id="8150078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150082">t</span><span class="op" id="8150083">.</span><span class="ident" id="8150084">Errorf</span><span class="op" id="8150090">(</span><span class="string" id="8150091">&#34;expected&nbsp;Referer&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8150120">,</span>&nbsp;<span class="ident" id="8150122">e</span><span class="op" id="8150123">,</span>&nbsp;<span class="ident" id="8150125">g</span><span class="op" id="8150126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150129">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150132">if</span>&nbsp;<span class="ident" id="8150135">req</span><span class="op" id="8150138">.</span><span class="ident" id="8150139">Header</span>&nbsp;<span class="op" id="8150146">==</span>&nbsp;<span class="ident" id="8150149">nil</span>&nbsp;<span class="op" id="8150153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150157">t</span><span class="op" id="8150158">.</span><span class="ident" id="8150159">Fatalf</span><span class="op" id="8150165">(</span><span class="string" id="8150166">&#34;unexpected&nbsp;nil&nbsp;Header&#34;</span><span class="op" id="8150189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150195">if</span>&nbsp;<span class="ident" id="8150198">g</span><span class="op" id="8150199">,</span>&nbsp;<span class="ident" id="8150201">e</span>&nbsp;<span class="op" id="8150203">:=</span>&nbsp;<span class="ident" id="8150206">req</span><span class="op" id="8150209">.</span><span class="ident" id="8150210">Header</span><span class="op" id="8150216">.</span><span class="ident" id="8150217">Get</span><span class="op" id="8150220">(</span><span class="string" id="8150221">&#34;Foo-Bar&#34;</span><span class="op" id="8150230">)</span><span class="op" id="8150231">,</span>&nbsp;<span class="string" id="8150233">&#34;baz&#34;</span><span class="op" id="8150238">;</span>&nbsp;<span class="ident" id="8150240">e</span>&nbsp;<span class="op" id="8150242">!=</span>&nbsp;<span class="ident" id="8150245">g</span>&nbsp;<span class="op" id="8150247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150251">t</span><span class="op" id="8150252">.</span><span class="ident" id="8150253">Errorf</span><span class="op" id="8150259">(</span><span class="string" id="8150260">&#34;expected&nbsp;Foo-Bar&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8150289">,</span>&nbsp;<span class="ident" id="8150291">e</span><span class="op" id="8150292">,</span>&nbsp;<span class="ident" id="8150294">g</span><span class="op" id="8150295">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150301">if</span>&nbsp;<span class="ident" id="8150304">g</span><span class="op" id="8150305">,</span>&nbsp;<span class="ident" id="8150307">e</span>&nbsp;<span class="op" id="8150309">:=</span>&nbsp;<span class="ident" id="8150312">req</span><span class="op" id="8150315">.</span><span class="ident" id="8150316">URL</span><span class="op" id="8150319">.</span><span class="ident" id="8150320">String</span><span class="op" id="8150326">(</span><span class="op" id="8150327">)</span><span class="op" id="8150328">,</span>&nbsp;<span class="string" id="8150330">&#34;http://example.com/path?a=b&#34;</span><span class="op" id="8150359">;</span>&nbsp;<span class="ident" id="8150361">e</span>&nbsp;<span class="op" id="8150363">!=</span>&nbsp;<span class="ident" id="8150366">g</span>&nbsp;<span class="op" id="8150368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150372">t</span><span class="op" id="8150373">.</span><span class="ident" id="8150374">Errorf</span><span class="op" id="8150380">(</span><span class="string" id="8150381">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8150406">,</span>&nbsp;<span class="ident" id="8150408">e</span><span class="op" id="8150409">,</span>&nbsp;<span class="ident" id="8150411">g</span><span class="op" id="8150412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150418">if</span>&nbsp;<span class="ident" id="8150421">g</span><span class="op" id="8150422">,</span>&nbsp;<span class="ident" id="8150424">e</span>&nbsp;<span class="op" id="8150426">:=</span>&nbsp;<span class="ident" id="8150429">req</span><span class="op" id="8150432">.</span><span class="ident" id="8150433">FormValue</span><span class="op" id="8150442">(</span><span class="string" id="8150443">&#34;a&#34;</span><span class="op" id="8150446">)</span><span class="op" id="8150447">,</span>&nbsp;<span class="string" id="8150449">&#34;b&#34;</span><span class="op" id="8150452">;</span>&nbsp;<span class="ident" id="8150454">e</span>&nbsp;<span class="op" id="8150456">!=</span>&nbsp;<span class="ident" id="8150459">g</span>&nbsp;<span class="op" id="8150461">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150465">t</span><span class="op" id="8150466">.</span><span class="ident" id="8150467">Errorf</span><span class="op" id="8150473">(</span><span class="string" id="8150474">&#34;expected&nbsp;FormValue(a)&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8150508">,</span>&nbsp;<span class="ident" id="8150510">e</span><span class="op" id="8150511">,</span>&nbsp;<span class="ident" id="8150513">g</span><span class="op" id="8150514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150520">if</span>&nbsp;<span class="ident" id="8150523">req</span><span class="op" id="8150526">.</span><span class="ident" id="8150527">Trailer</span>&nbsp;<span class="op" id="8150535">==</span>&nbsp;<span class="ident" id="8150538">nil</span>&nbsp;<span class="op" id="8150542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150546">t</span><span class="op" id="8150547">.</span><span class="ident" id="8150548">Errorf</span><span class="op" id="8150554">(</span><span class="string" id="8150555">&#34;unexpected&nbsp;nil&nbsp;Trailer&#34;</span><span class="op" id="8150579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150582">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150585">if</span>&nbsp;<span class="ident" id="8150588">req</span><span class="op" id="8150591">.</span><span class="ident" id="8150592">TLS</span>&nbsp;<span class="op" id="8150596">!=</span>&nbsp;<span class="ident" id="8150599">nil</span>&nbsp;<span class="op" id="8150603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150607">t</span><span class="op" id="8150608">.</span><span class="ident" id="8150609">Errorf</span><span class="op" id="8150615">(</span><span class="string" id="8150616">&#34;expected&nbsp;nil&nbsp;TLS&#34;</span><span class="op" id="8150634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150637">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8150640">if</span>&nbsp;<span class="ident" id="8150643">e</span><span class="op" id="8150644">,</span>&nbsp;<span class="ident" id="8150646">g</span>&nbsp;<span class="op" id="8150648">:=</span>&nbsp;<span class="string" id="8150651">&#34;5.6.7.8:0&#34;</span><span class="op" id="8150662">,</span>&nbsp;<span class="ident" id="8150664">req</span><span class="op" id="8150667">.</span><span class="ident" id="8150668">RemoteAddr</span><span class="op" id="8150678">;</span>&nbsp;<span class="ident" id="8150680">e</span>&nbsp;<span class="op" id="8150682">!=</span>&nbsp;<span class="ident" id="8150685">g</span>&nbsp;<span class="op" id="8150687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150691">t</span><span class="op" id="8150692">.</span><span class="ident" id="8150693">Errorf</span><span class="op" id="8150699">(</span><span class="string" id="8150700">&#34;RemoteAddr:&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8150729">,</span>&nbsp;<span class="ident" id="8150731">g</span><span class="op" id="8150732">,</span>&nbsp;<span class="ident" id="8150734">e</span><span class="op" id="8150735">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8150738">}</span><br>
<span class="lineno"></span><span class="op" id="8150740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8150743">func</span>&nbsp;<span class="ident" id="8150748">TestRequestWithTLS</span><span class="op" id="8150766">(</span><span class="ident" id="8150767">t</span>&nbsp;<span class="op" id="8150769">*</span><span class="ident" id="8150770">testing</span><span class="op" id="8150777">.</span><span class="ident" id="8150778">T</span><span class="op" id="8150779">)</span>&nbsp;<span class="op" id="8150781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8150784">env</span>&nbsp;<span class="op" id="8150788">:=</span>&nbsp;<span class="keyword" id="8150791">map</span><span class="op" id="8150794">[</span><span class="builtintype" id="8150795">string</span><span class="op" id="8150801">]</span><span class="builtintype" id="8150802">string</span><span class="op" id="8150808">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8150812">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8150829">:</span>&nbsp;<span class="string" id="8150831">&#34;HTTP/1.1&#34;</span><span class="op" id="8150841">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8150845">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8150861">:</span>&nbsp;&nbsp;<span class="string" id="8150864">&#34;GET&#34;</span><span class="op" id="8150869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8150873">&#34;HTTP_HOST&#34;</span><span class="op" id="8150884">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150892">&#34;example.com&#34;</span><span class="op" id="8150905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8150909">&#34;HTTP_REFERER&#34;</span><span class="op" id="8150923">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150928">&#34;elsewhere&#34;</span><span class="op" id="8150939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8150943">&#34;REQUEST_URI&#34;</span><span class="op" id="8150956">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150962">&#34;/path?a=b&#34;</span><span class="op" id="8150973">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8150977">&#34;CONTENT_TYPE&#34;</span><span class="op" id="8150991">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8150996">&#34;text/xml&#34;</span><span class="op" id="8151006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151010">&#34;HTTPS&#34;</span><span class="op" id="8151017">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8151029">&#34;1&#34;</span><span class="op" id="8151032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151036">&#34;REMOTE_ADDR&#34;</span><span class="op" id="8151049">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8151055">&#34;5.6.7.8&#34;</span><span class="op" id="8151064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151070">req</span><span class="op" id="8151073">,</span>&nbsp;<span class="ident" id="8151075">err</span>&nbsp;<span class="op" id="8151079">:=</span>&nbsp;<span class="ident" id="8151082">RequestFromMap</span><span class="op" id="8151096">(</span><span class="ident" id="8151097">env</span><span class="op" id="8151100">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151103">if</span>&nbsp;<span class="ident" id="8151106">err</span>&nbsp;<span class="op" id="8151110">!=</span>&nbsp;<span class="ident" id="8151113">nil</span>&nbsp;<span class="op" id="8151117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151121">t</span><span class="op" id="8151122">.</span><span class="ident" id="8151123">Fatalf</span><span class="op" id="8151129">(</span><span class="string" id="8151130">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8151150">,</span>&nbsp;<span class="ident" id="8151152">err</span><span class="op" id="8151155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151161">if</span>&nbsp;<span class="ident" id="8151164">g</span><span class="op" id="8151165">,</span>&nbsp;<span class="ident" id="8151167">e</span>&nbsp;<span class="op" id="8151169">:=</span>&nbsp;<span class="ident" id="8151172">req</span><span class="op" id="8151175">.</span><span class="ident" id="8151176">URL</span><span class="op" id="8151179">.</span><span class="ident" id="8151180">String</span><span class="op" id="8151186">(</span><span class="op" id="8151187">)</span><span class="op" id="8151188">,</span>&nbsp;<span class="string" id="8151190">&#34;https://example.com/path?a=b&#34;</span><span class="op" id="8151220">;</span>&nbsp;<span class="ident" id="8151222">e</span>&nbsp;<span class="op" id="8151224">!=</span>&nbsp;<span class="ident" id="8151227">g</span>&nbsp;<span class="op" id="8151229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151233">t</span><span class="op" id="8151234">.</span><span class="ident" id="8151235">Errorf</span><span class="op" id="8151241">(</span><span class="string" id="8151242">&#34;expected&nbsp;URL&nbsp;%q;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="8151267">,</span>&nbsp;<span class="ident" id="8151269">e</span><span class="op" id="8151270">,</span>&nbsp;<span class="ident" id="8151272">g</span><span class="op" id="8151273">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151279">if</span>&nbsp;<span class="ident" id="8151282">req</span><span class="op" id="8151285">.</span><span class="ident" id="8151286">TLS</span>&nbsp;<span class="op" id="8151290">==</span>&nbsp;<span class="ident" id="8151293">nil</span>&nbsp;<span class="op" id="8151297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151301">t</span><span class="op" id="8151302">.</span><span class="ident" id="8151303">Errorf</span><span class="op" id="8151309">(</span><span class="string" id="8151310">&#34;expected&nbsp;non-nil&nbsp;TLS&#34;</span><span class="op" id="8151332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151335">}</span><br>
<span class="lineno"></span><span class="op" id="8151337">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="8151340">func</span>&nbsp;<span class="ident" id="8151345">TestRequestWithoutHost</span><span class="op" id="8151367">(</span><span class="ident" id="8151368">t</span>&nbsp;<span class="op" id="8151370">*</span><span class="ident" id="8151371">testing</span><span class="op" id="8151378">.</span><span class="ident" id="8151379">T</span><span class="op" id="8151380">)</span>&nbsp;<span class="op" id="8151382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151385">env</span>&nbsp;<span class="op" id="8151389">:=</span>&nbsp;<span class="keyword" id="8151392">map</span><span class="op" id="8151395">[</span><span class="builtintype" id="8151396">string</span><span class="op" id="8151402">]</span><span class="builtintype" id="8151403">string</span><span class="op" id="8151409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151413">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8151430">:</span>&nbsp;<span class="string" id="8151432">&#34;HTTP/1.1&#34;</span><span class="op" id="8151442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151446">&#34;HTTP_HOST&#34;</span><span class="op" id="8151457">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8151465">&#34;&#34;</span><span class="op" id="8151467">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151471">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8151487">:</span>&nbsp;&nbsp;<span class="string" id="8151490">&#34;GET&#34;</span><span class="op" id="8151495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151499">&#34;REQUEST_URI&#34;</span><span class="op" id="8151512">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8151518">&#34;/path?a=b&#34;</span><span class="op" id="8151529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151533">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8151549">:</span>&nbsp;&nbsp;<span class="string" id="8151552">&#34;123&#34;</span><span class="op" id="8151557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151563">req</span><span class="op" id="8151566">,</span>&nbsp;<span class="ident" id="8151568">err</span>&nbsp;<span class="op" id="8151572">:=</span>&nbsp;<span class="ident" id="8151575">RequestFromMap</span><span class="op" id="8151589">(</span><span class="ident" id="8151590">env</span><span class="op" id="8151593">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151596">if</span>&nbsp;<span class="ident" id="8151599">err</span>&nbsp;<span class="op" id="8151603">!=</span>&nbsp;<span class="ident" id="8151606">nil</span>&nbsp;<span class="op" id="8151610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151614">t</span><span class="op" id="8151615">.</span><span class="ident" id="8151616">Fatalf</span><span class="op" id="8151622">(</span><span class="string" id="8151623">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8151643">,</span>&nbsp;<span class="ident" id="8151645">err</span><span class="op" id="8151648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151654">if</span>&nbsp;<span class="ident" id="8151657">req</span><span class="op" id="8151660">.</span><span class="ident" id="8151661">URL</span>&nbsp;<span class="op" id="8151665">==</span>&nbsp;<span class="ident" id="8151668">nil</span>&nbsp;<span class="op" id="8151672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151676">t</span><span class="op" id="8151677">.</span><span class="ident" id="8151678">Fatalf</span><span class="op" id="8151684">(</span><span class="string" id="8151685">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="8151705">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8151711">if</span>&nbsp;<span class="ident" id="8151714">g</span><span class="op" id="8151715">,</span>&nbsp;<span class="ident" id="8151717">e</span>&nbsp;<span class="op" id="8151719">:=</span>&nbsp;<span class="ident" id="8151722">req</span><span class="op" id="8151725">.</span><span class="ident" id="8151726">URL</span><span class="op" id="8151729">.</span><span class="ident" id="8151730">String</span><span class="op" id="8151736">(</span><span class="op" id="8151737">)</span><span class="op" id="8151738">,</span>&nbsp;<span class="string" id="8151740">&#34;/path?a=b&#34;</span><span class="op" id="8151751">;</span>&nbsp;<span class="ident" id="8151753">e</span>&nbsp;<span class="op" id="8151755">!=</span>&nbsp;<span class="ident" id="8151758">g</span>&nbsp;<span class="op" id="8151760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151764">t</span><span class="op" id="8151765">.</span><span class="ident" id="8151766">Errorf</span><span class="op" id="8151772">(</span><span class="string" id="8151773">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8151792">,</span>&nbsp;<span class="ident" id="8151794">g</span><span class="op" id="8151795">,</span>&nbsp;<span class="ident" id="8151797">e</span><span class="op" id="8151798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8151801">}</span><br>
<span class="lineno"></span><span class="op" id="8151803">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="8151806">func</span>&nbsp;<span class="ident" id="8151811">TestRequestWithoutRequestURI</span><span class="op" id="8151839">(</span><span class="ident" id="8151840">t</span>&nbsp;<span class="op" id="8151842">*</span><span class="ident" id="8151843">testing</span><span class="op" id="8151850">.</span><span class="ident" id="8151851">T</span><span class="op" id="8151852">)</span>&nbsp;<span class="op" id="8151854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8151857">env</span>&nbsp;<span class="op" id="8151861">:=</span>&nbsp;<span class="keyword" id="8151864">map</span><span class="op" id="8151867">[</span><span class="builtintype" id="8151868">string</span><span class="op" id="8151874">]</span><span class="builtintype" id="8151875">string</span><span class="op" id="8151881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151885">&#34;SERVER_PROTOCOL&#34;</span><span class="op" id="8151902">:</span>&nbsp;<span class="string" id="8151904">&#34;HTTP/1.1&#34;</span><span class="op" id="8151914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151918">&#34;HTTP_HOST&#34;</span><span class="op" id="8151929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8151937">&#34;example.com&#34;</span><span class="op" id="8151950">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151954">&#34;REQUEST_METHOD&#34;</span><span class="op" id="8151970">:</span>&nbsp;&nbsp;<span class="string" id="8151973">&#34;GET&#34;</span><span class="op" id="8151978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8151982">&#34;SCRIPT_NAME&#34;</span><span class="op" id="8151995">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152001">&#34;/dir/scriptname&#34;</span><span class="op" id="8152018">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8152022">&#34;PATH_INFO&#34;</span><span class="op" id="8152033">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152041">&#34;/p1/p2&#34;</span><span class="op" id="8152049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8152053">&#34;QUERY_STRING&#34;</span><span class="op" id="8152067">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8152072">&#34;a=1&amp;b=2&#34;</span><span class="op" id="8152081">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8152085">&#34;CONTENT_LENGTH&#34;</span><span class="op" id="8152101">:</span>&nbsp;&nbsp;<span class="string" id="8152104">&#34;123&#34;</span><span class="op" id="8152109">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8152112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152115">req</span><span class="op" id="8152118">,</span>&nbsp;<span class="ident" id="8152120">err</span>&nbsp;<span class="op" id="8152124">:=</span>&nbsp;<span class="ident" id="8152127">RequestFromMap</span><span class="op" id="8152141">(</span><span class="ident" id="8152142">env</span><span class="op" id="8152145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8152148">if</span>&nbsp;<span class="ident" id="8152151">err</span>&nbsp;<span class="op" id="8152155">!=</span>&nbsp;<span class="ident" id="8152158">nil</span>&nbsp;<span class="op" id="8152162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152166">t</span><span class="op" id="8152167">.</span><span class="ident" id="8152168">Fatalf</span><span class="op" id="8152174">(</span><span class="string" id="8152175">&#34;RequestFromMap:&nbsp;%v&#34;</span><span class="op" id="8152195">,</span>&nbsp;<span class="ident" id="8152197">err</span><span class="op" id="8152200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8152203">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8152206">if</span>&nbsp;<span class="ident" id="8152209">req</span><span class="op" id="8152212">.</span><span class="ident" id="8152213">URL</span>&nbsp;<span class="op" id="8152217">==</span>&nbsp;<span class="ident" id="8152220">nil</span>&nbsp;<span class="op" id="8152224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152228">t</span><span class="op" id="8152229">.</span><span class="ident" id="8152230">Fatalf</span><span class="op" id="8152236">(</span><span class="string" id="8152237">&#34;unexpected&nbsp;nil&nbsp;URL&#34;</span><span class="op" id="8152257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8152260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8152263">if</span>&nbsp;<span class="ident" id="8152266">g</span><span class="op" id="8152267">,</span>&nbsp;<span class="ident" id="8152269">e</span>&nbsp;<span class="op" id="8152271">:=</span>&nbsp;<span class="ident" id="8152274">req</span><span class="op" id="8152277">.</span><span class="ident" id="8152278">URL</span><span class="op" id="8152281">.</span><span class="ident" id="8152282">String</span><span class="op" id="8152288">(</span><span class="op" id="8152289">)</span><span class="op" id="8152290">,</span>&nbsp;<span class="string" id="8152292">&#34;http://example.com/dir/scriptname/p1/p2?a=1&amp;b=2&#34;</span><span class="op" id="8152341">;</span>&nbsp;<span class="ident" id="8152343">e</span>&nbsp;<span class="op" id="8152345">!=</span>&nbsp;<span class="ident" id="8152348">g</span>&nbsp;<span class="op" id="8152350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8152354">t</span><span class="op" id="8152355">.</span><span class="ident" id="8152356">Errorf</span><span class="op" id="8152362">(</span><span class="string" id="8152363">&#34;URL&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8152382">,</span>&nbsp;<span class="ident" id="8152384">g</span><span class="op" id="8152385">,</span>&nbsp;<span class="ident" id="8152387">e</span><span class="op" id="8152388">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8152391">}</span><br>
<span class="lineno"></span><span class="op" id="8152393">}</span>
</div>
</body>
</html>
