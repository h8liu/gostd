<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4796728">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4796783">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4796837">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4796888">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4796962">package</span>&nbsp;<span class="ident" id="4796970">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4796976">import</span>&nbsp;<span class="op" id="4796983">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4796986">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4796995">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797006">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4797021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4797024">type</span>&nbsp;<span class="ident" id="4797029">writer</span>&nbsp;<span class="keyword" id="4797036">interface</span>&nbsp;<span class="op" id="4797046">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4797049">WriteString</span><span class="op" id="4797060">(</span><span class="builtintype" id="4797061">string</span><span class="op" id="4797067">)</span>&nbsp;<span class="op" id="4797069">(</span><span class="builtintype" id="4797070">int</span><span class="op" id="4797073">,</span>&nbsp;<span class="builtintype" id="4797075">error</span><span class="op" id="4797080">)</span><br>
<span class="lineno"></span><span class="op" id="4797082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797085">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4797159">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="4797193">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="4797304">var</span>&nbsp;<span class="ident" id="4797308">replacementTable</span>&nbsp;<span class="op" id="4797325">=</span>&nbsp;<span class="op" id="4797327">[</span><span class="op" id="4797328">...</span><span class="op" id="4797331">]</span><span class="builtintype" id="4797332">rune</span><span class="op" id="4797336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797339">&#39;\u20AC&#39;</span><span class="op" id="4797347">,</span>&nbsp;<span class="comment" id="4797349">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797403">&#39;\u0081&#39;</span><span class="op" id="4797411">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797414">&#39;\u201A&#39;</span><span class="op" id="4797422">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797425">&#39;\u0192&#39;</span><span class="op" id="4797433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797436">&#39;\u201E&#39;</span><span class="op" id="4797444">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797447">&#39;\u2026&#39;</span><span class="op" id="4797455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797458">&#39;\u2020&#39;</span><span class="op" id="4797466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797469">&#39;\u2021&#39;</span><span class="op" id="4797477">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797480">&#39;\u02C6&#39;</span><span class="op" id="4797488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797491">&#39;\u2030&#39;</span><span class="op" id="4797499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797502">&#39;\u0160&#39;</span><span class="op" id="4797510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797513">&#39;\u2039&#39;</span><span class="op" id="4797521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797524">&#39;\u0152&#39;</span><span class="op" id="4797532">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797535">&#39;\u008D&#39;</span><span class="op" id="4797543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797546">&#39;\u017D&#39;</span><span class="op" id="4797554">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797557">&#39;\u008F&#39;</span><span class="op" id="4797565">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797568">&#39;\u0090&#39;</span><span class="op" id="4797576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797579">&#39;\u2018&#39;</span><span class="op" id="4797587">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797590">&#39;\u2019&#39;</span><span class="op" id="4797598">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797601">&#39;\u201C&#39;</span><span class="op" id="4797609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797612">&#39;\u201D&#39;</span><span class="op" id="4797620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797623">&#39;\u2022&#39;</span><span class="op" id="4797631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797634">&#39;\u2013&#39;</span><span class="op" id="4797642">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797645">&#39;\u2014&#39;</span><span class="op" id="4797653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797656">&#39;\u02DC&#39;</span><span class="op" id="4797664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797667">&#39;\u2122&#39;</span><span class="op" id="4797675">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797678">&#39;\u0161&#39;</span><span class="op" id="4797686">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797689">&#39;\u203A&#39;</span><span class="op" id="4797697">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797700">&#39;\u0153&#39;</span><span class="op" id="4797708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797711">&#39;\u009D&#39;</span><span class="op" id="4797719">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797722">&#39;\u017E&#39;</span><span class="op" id="4797730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4797733">&#39;\u0178&#39;</span><span class="op" id="4797741">,</span>&nbsp;<span class="comment" id="4797743">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797767">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4797815">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="4797845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4797848">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4797922">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="4798002">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="4798048">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="4798107">func</span>&nbsp;<span class="ident" id="4798112">unescapeEntity</span><span class="op" id="4798126">(</span><span class="ident" id="4798127">b</span>&nbsp;<span class="op" id="4798129">[</span><span class="op" id="4798130">]</span><span class="builtintype" id="4798131">byte</span><span class="op" id="4798135">,</span>&nbsp;<span class="ident" id="4798137">dst</span><span class="op" id="4798140">,</span>&nbsp;<span class="ident" id="4798142">src</span>&nbsp;<span class="builtintype" id="4798146">int</span><span class="op" id="4798149">,</span>&nbsp;<span class="ident" id="4798151">attribute</span>&nbsp;<span class="builtintype" id="4798161">bool</span><span class="op" id="4798165">)</span>&nbsp;<span class="op" id="4798167">(</span><span class="ident" id="4798168">dst1</span><span class="op" id="4798172">,</span>&nbsp;<span class="ident" id="4798174">src1</span>&nbsp;<span class="builtintype" id="4798179">int</span><span class="op" id="4798182">)</span>&nbsp;<span class="op" id="4798184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798187">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4798300">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798360">i</span><span class="op" id="4798361">,</span>&nbsp;<span class="ident" id="4798363">s</span>&nbsp;<span class="op" id="4798365">:=</span>&nbsp;<span class="num" id="4798368">1</span><span class="op" id="4798369">,</span>&nbsp;<span class="ident" id="4798371">b</span><span class="op" id="4798372">[</span><span class="ident" id="4798373">src</span><span class="op" id="4798376">:</span><span class="op" id="4798377">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798381">if</span>&nbsp;<span class="builtinfunc" id="4798384">len</span><span class="op" id="4798387">(</span><span class="ident" id="4798388">s</span><span class="op" id="4798389">)</span>&nbsp;<span class="op" id="4798391">&lt;=</span>&nbsp;<span class="num" id="4798394">1</span>&nbsp;<span class="op" id="4798396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798400">b</span><span class="op" id="4798401">[</span><span class="ident" id="4798402">dst</span><span class="op" id="4798405">]</span>&nbsp;<span class="op" id="4798407">=</span>&nbsp;<span class="ident" id="4798409">b</span><span class="op" id="4798410">[</span><span class="ident" id="4798411">src</span><span class="op" id="4798414">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798418">return</span>&nbsp;<span class="ident" id="4798425">dst</span>&nbsp;<span class="op" id="4798429">+</span>&nbsp;<span class="num" id="4798431">1</span><span class="op" id="4798432">,</span>&nbsp;<span class="ident" id="4798434">src</span>&nbsp;<span class="op" id="4798438">+</span>&nbsp;<span class="num" id="4798440">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798447">if</span>&nbsp;<span class="ident" id="4798450">s</span><span class="op" id="4798451">[</span><span class="ident" id="4798452">i</span><span class="op" id="4798453">]</span>&nbsp;<span class="op" id="4798455">==</span>&nbsp;<span class="string" id="4798458">&#39;#&#39;</span>&nbsp;<span class="op" id="4798462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798466">if</span>&nbsp;<span class="builtinfunc" id="4798469">len</span><span class="op" id="4798472">(</span><span class="ident" id="4798473">s</span><span class="op" id="4798474">)</span>&nbsp;<span class="op" id="4798476">&lt;=</span>&nbsp;<span class="num" id="4798479">3</span>&nbsp;<span class="op" id="4798481">{</span>&nbsp;<span class="comment" id="4798483">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798521">b</span><span class="op" id="4798522">[</span><span class="ident" id="4798523">dst</span><span class="op" id="4798526">]</span>&nbsp;<span class="op" id="4798528">=</span>&nbsp;<span class="ident" id="4798530">b</span><span class="op" id="4798531">[</span><span class="ident" id="4798532">src</span><span class="op" id="4798535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798540">return</span>&nbsp;<span class="ident" id="4798547">dst</span>&nbsp;<span class="op" id="4798551">+</span>&nbsp;<span class="num" id="4798553">1</span><span class="op" id="4798554">,</span>&nbsp;<span class="ident" id="4798556">src</span>&nbsp;<span class="op" id="4798560">+</span>&nbsp;<span class="num" id="4798562">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798570">i</span><span class="op" id="4798571">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798576">c</span>&nbsp;<span class="op" id="4798578">:=</span>&nbsp;<span class="ident" id="4798581">s</span><span class="op" id="4798582">[</span><span class="ident" id="4798583">i</span><span class="op" id="4798584">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798588">hex</span>&nbsp;<span class="op" id="4798592">:=</span>&nbsp;<span class="builtintype" id="4798595">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798603">if</span>&nbsp;<span class="ident" id="4798606">c</span>&nbsp;<span class="op" id="4798608">==</span>&nbsp;<span class="string" id="4798611">&#39;x&#39;</span>&nbsp;<span class="op" id="4798615">||</span>&nbsp;<span class="ident" id="4798618">c</span>&nbsp;<span class="op" id="4798620">==</span>&nbsp;<span class="string" id="4798623">&#39;X&#39;</span>&nbsp;<span class="op" id="4798627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798632">hex</span>&nbsp;<span class="op" id="4798636">=</span>&nbsp;<span class="builtintype" id="4798638">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798646">i</span><span class="op" id="4798647">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798652">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798657">x</span>&nbsp;<span class="op" id="4798659">:=</span>&nbsp;<span class="string" id="4798662">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798671">for</span>&nbsp;<span class="ident" id="4798675">i</span>&nbsp;<span class="op" id="4798677">&lt;</span>&nbsp;<span class="builtinfunc" id="4798679">len</span><span class="op" id="4798682">(</span><span class="ident" id="4798683">s</span><span class="op" id="4798684">)</span>&nbsp;<span class="op" id="4798686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798691">c</span>&nbsp;<span class="op" id="4798693">=</span>&nbsp;<span class="ident" id="4798695">s</span><span class="op" id="4798696">[</span><span class="ident" id="4798697">i</span><span class="op" id="4798698">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798703">i</span><span class="op" id="4798704">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798710">if</span>&nbsp;<span class="ident" id="4798713">hex</span>&nbsp;<span class="op" id="4798717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798723">if</span>&nbsp;<span class="string" id="4798726">&#39;0&#39;</span>&nbsp;<span class="op" id="4798730">&lt;=</span>&nbsp;<span class="ident" id="4798733">c</span>&nbsp;<span class="op" id="4798735">&amp;&amp;</span>&nbsp;<span class="ident" id="4798738">c</span>&nbsp;<span class="op" id="4798740">&lt;=</span>&nbsp;<span class="string" id="4798743">&#39;9&#39;</span>&nbsp;<span class="op" id="4798747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798754">x</span>&nbsp;<span class="op" id="4798756">=</span>&nbsp;<span class="num" id="4798758">16</span><span class="op" id="4798760">*</span><span class="ident" id="4798761">x</span>&nbsp;<span class="op" id="4798763">+</span>&nbsp;<span class="builtintype" id="4798765">rune</span><span class="op" id="4798769">(</span><span class="ident" id="4798770">c</span><span class="op" id="4798771">)</span>&nbsp;<span class="op" id="4798773">-</span>&nbsp;<span class="string" id="4798775">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798784">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798797">}</span>&nbsp;<span class="keyword" id="4798799">else</span>&nbsp;<span class="keyword" id="4798804">if</span>&nbsp;<span class="string" id="4798807">&#39;a&#39;</span>&nbsp;<span class="op" id="4798811">&lt;=</span>&nbsp;<span class="ident" id="4798814">c</span>&nbsp;<span class="op" id="4798816">&amp;&amp;</span>&nbsp;<span class="ident" id="4798819">c</span>&nbsp;<span class="op" id="4798821">&lt;=</span>&nbsp;<span class="string" id="4798824">&#39;f&#39;</span>&nbsp;<span class="op" id="4798828">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798835">x</span>&nbsp;<span class="op" id="4798837">=</span>&nbsp;<span class="num" id="4798839">16</span><span class="op" id="4798841">*</span><span class="ident" id="4798842">x</span>&nbsp;<span class="op" id="4798844">+</span>&nbsp;<span class="builtintype" id="4798846">rune</span><span class="op" id="4798850">(</span><span class="ident" id="4798851">c</span><span class="op" id="4798852">)</span>&nbsp;<span class="op" id="4798854">-</span>&nbsp;<span class="string" id="4798856">&#39;a&#39;</span>&nbsp;<span class="op" id="4798860">+</span>&nbsp;<span class="num" id="4798862">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798870">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798883">}</span>&nbsp;<span class="keyword" id="4798885">else</span>&nbsp;<span class="keyword" id="4798890">if</span>&nbsp;<span class="string" id="4798893">&#39;A&#39;</span>&nbsp;<span class="op" id="4798897">&lt;=</span>&nbsp;<span class="ident" id="4798900">c</span>&nbsp;<span class="op" id="4798902">&amp;&amp;</span>&nbsp;<span class="ident" id="4798905">c</span>&nbsp;<span class="op" id="4798907">&lt;=</span>&nbsp;<span class="string" id="4798910">&#39;F&#39;</span>&nbsp;<span class="op" id="4798914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4798921">x</span>&nbsp;<span class="op" id="4798923">=</span>&nbsp;<span class="num" id="4798925">16</span><span class="op" id="4798927">*</span><span class="ident" id="4798928">x</span>&nbsp;<span class="op" id="4798930">+</span>&nbsp;<span class="builtintype" id="4798932">rune</span><span class="op" id="4798936">(</span><span class="ident" id="4798937">c</span><span class="op" id="4798938">)</span>&nbsp;<span class="op" id="4798940">-</span>&nbsp;<span class="string" id="4798942">&#39;A&#39;</span>&nbsp;<span class="op" id="4798946">+</span>&nbsp;<span class="num" id="4798948">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4798956">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4798974">}</span>&nbsp;<span class="keyword" id="4798976">else</span>&nbsp;<span class="keyword" id="4798981">if</span>&nbsp;<span class="string" id="4798984">&#39;0&#39;</span>&nbsp;<span class="op" id="4798988">&lt;=</span>&nbsp;<span class="ident" id="4798991">c</span>&nbsp;<span class="op" id="4798993">&amp;&amp;</span>&nbsp;<span class="ident" id="4798996">c</span>&nbsp;<span class="op" id="4798998">&lt;=</span>&nbsp;<span class="string" id="4799001">&#39;9&#39;</span>&nbsp;<span class="op" id="4799005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799011">x</span>&nbsp;<span class="op" id="4799013">=</span>&nbsp;<span class="num" id="4799015">10</span><span class="op" id="4799017">*</span><span class="ident" id="4799018">x</span>&nbsp;<span class="op" id="4799020">+</span>&nbsp;<span class="builtintype" id="4799022">rune</span><span class="op" id="4799026">(</span><span class="ident" id="4799027">c</span><span class="op" id="4799028">)</span>&nbsp;<span class="op" id="4799030">-</span>&nbsp;<span class="string" id="4799032">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799040">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799052">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799057">if</span>&nbsp;<span class="ident" id="4799060">c</span>&nbsp;<span class="op" id="4799062">!=</span>&nbsp;<span class="string" id="4799065">&#39;;&#39;</span>&nbsp;<span class="op" id="4799069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799075">i</span><span class="op" id="4799076">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799087">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799095">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799100">if</span>&nbsp;<span class="ident" id="4799103">i</span>&nbsp;<span class="op" id="4799105">&lt;=</span>&nbsp;<span class="num" id="4799108">3</span>&nbsp;<span class="op" id="4799110">{</span>&nbsp;<span class="comment" id="4799112">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799141">b</span><span class="op" id="4799142">[</span><span class="ident" id="4799143">dst</span><span class="op" id="4799146">]</span>&nbsp;<span class="op" id="4799148">=</span>&nbsp;<span class="ident" id="4799150">b</span><span class="op" id="4799151">[</span><span class="ident" id="4799152">src</span><span class="op" id="4799155">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799160">return</span>&nbsp;<span class="ident" id="4799167">dst</span>&nbsp;<span class="op" id="4799171">+</span>&nbsp;<span class="num" id="4799173">1</span><span class="op" id="4799174">,</span>&nbsp;<span class="ident" id="4799176">src</span>&nbsp;<span class="op" id="4799180">+</span>&nbsp;<span class="num" id="4799182">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799186">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799191">if</span>&nbsp;<span class="num" id="4799194">0x80</span>&nbsp;<span class="op" id="4799199">&lt;=</span>&nbsp;<span class="ident" id="4799202">x</span>&nbsp;<span class="op" id="4799204">&amp;&amp;</span>&nbsp;<span class="ident" id="4799207">x</span>&nbsp;<span class="op" id="4799209">&lt;=</span>&nbsp;<span class="num" id="4799212">0x9F</span>&nbsp;<span class="op" id="4799217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799222">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799289">x</span>&nbsp;<span class="op" id="4799291">=</span>&nbsp;<span class="ident" id="4799293">replacementTable</span><span class="op" id="4799309">[</span><span class="ident" id="4799310">x</span><span class="op" id="4799311">-</span><span class="num" id="4799312">0x80</span><span class="op" id="4799316">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799320">}</span>&nbsp;<span class="keyword" id="4799322">else</span>&nbsp;<span class="keyword" id="4799327">if</span>&nbsp;<span class="ident" id="4799330">x</span>&nbsp;<span class="op" id="4799332">==</span>&nbsp;<span class="num" id="4799335">0</span>&nbsp;<span class="op" id="4799337">||</span>&nbsp;<span class="op" id="4799340">(</span><span class="num" id="4799341">0xD800</span>&nbsp;<span class="op" id="4799348">&lt;=</span>&nbsp;<span class="ident" id="4799351">x</span>&nbsp;<span class="op" id="4799353">&amp;&amp;</span>&nbsp;<span class="ident" id="4799356">x</span>&nbsp;<span class="op" id="4799358">&lt;=</span>&nbsp;<span class="num" id="4799361">0xDFFF</span><span class="op" id="4799367">)</span>&nbsp;<span class="op" id="4799369">||</span>&nbsp;<span class="ident" id="4799372">x</span>&nbsp;<span class="op" id="4799374">&gt;</span>&nbsp;<span class="num" id="4799376">0x10FFFF</span>&nbsp;<span class="op" id="4799385">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799390">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799455">x</span>&nbsp;<span class="op" id="4799457">=</span>&nbsp;<span class="string" id="4799459">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799475">return</span>&nbsp;<span class="ident" id="4799482">dst</span>&nbsp;<span class="op" id="4799486">+</span>&nbsp;<span class="ident" id="4799488">utf8</span><span class="op" id="4799492">.</span><span class="ident" id="4799493">EncodeRune</span><span class="op" id="4799503">(</span><span class="ident" id="4799504">b</span><span class="op" id="4799505">[</span><span class="ident" id="4799506">dst</span><span class="op" id="4799509">:</span><span class="op" id="4799510">]</span><span class="op" id="4799511">,</span>&nbsp;<span class="ident" id="4799513">x</span><span class="op" id="4799514">)</span><span class="op" id="4799515">,</span>&nbsp;<span class="ident" id="4799517">src</span>&nbsp;<span class="op" id="4799521">+</span>&nbsp;<span class="ident" id="4799523">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799530">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799594">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799657">for</span>&nbsp;<span class="ident" id="4799661">i</span>&nbsp;<span class="op" id="4799663">&lt;</span>&nbsp;<span class="builtinfunc" id="4799665">len</span><span class="op" id="4799668">(</span><span class="ident" id="4799669">s</span><span class="op" id="4799670">)</span>&nbsp;<span class="op" id="4799672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799676">c</span>&nbsp;<span class="op" id="4799678">:=</span>&nbsp;<span class="ident" id="4799681">s</span><span class="op" id="4799682">[</span><span class="ident" id="4799683">i</span><span class="op" id="4799684">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799688">i</span><span class="op" id="4799689">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799694">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799779">if</span>&nbsp;<span class="string" id="4799782">&#39;a&#39;</span>&nbsp;<span class="op" id="4799786">&lt;=</span>&nbsp;<span class="ident" id="4799789">c</span>&nbsp;<span class="op" id="4799791">&amp;&amp;</span>&nbsp;<span class="ident" id="4799794">c</span>&nbsp;<span class="op" id="4799796">&lt;=</span>&nbsp;<span class="string" id="4799799">&#39;z&#39;</span>&nbsp;<span class="op" id="4799803">||</span>&nbsp;<span class="string" id="4799806">&#39;A&#39;</span>&nbsp;<span class="op" id="4799810">&lt;=</span>&nbsp;<span class="ident" id="4799813">c</span>&nbsp;<span class="op" id="4799815">&amp;&amp;</span>&nbsp;<span class="ident" id="4799818">c</span>&nbsp;<span class="op" id="4799820">&lt;=</span>&nbsp;<span class="string" id="4799823">&#39;Z&#39;</span>&nbsp;<span class="op" id="4799827">||</span>&nbsp;<span class="string" id="4799830">&#39;0&#39;</span>&nbsp;<span class="op" id="4799834">&lt;=</span>&nbsp;<span class="ident" id="4799837">c</span>&nbsp;<span class="op" id="4799839">&amp;&amp;</span>&nbsp;<span class="ident" id="4799842">c</span>&nbsp;<span class="op" id="4799844">&lt;=</span>&nbsp;<span class="string" id="4799847">&#39;9&#39;</span>&nbsp;<span class="op" id="4799851">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799856">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799871">if</span>&nbsp;<span class="ident" id="4799874">c</span>&nbsp;<span class="op" id="4799876">!=</span>&nbsp;<span class="string" id="4799879">&#39;;&#39;</span>&nbsp;<span class="op" id="4799883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799888">i</span><span class="op" id="4799889">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799894">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799898">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799905">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4799909">entityName</span>&nbsp;<span class="op" id="4799920">:=</span>&nbsp;<span class="builtintype" id="4799923">string</span><span class="op" id="4799929">(</span><span class="ident" id="4799930">s</span><span class="op" id="4799931">[</span><span class="num" id="4799932">1</span><span class="op" id="4799933">:</span><span class="ident" id="4799934">i</span><span class="op" id="4799935">]</span><span class="op" id="4799936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4799939">if</span>&nbsp;<span class="ident" id="4799942">entityName</span>&nbsp;<span class="op" id="4799953">==</span>&nbsp;<span class="string" id="4799956">&#34;&#34;</span>&nbsp;<span class="op" id="4799959">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4799963">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4799974">}</span>&nbsp;<span class="keyword" id="4799976">else</span>&nbsp;<span class="keyword" id="4799981">if</span>&nbsp;<span class="ident" id="4799984">attribute</span>&nbsp;<span class="op" id="4799994">&amp;&amp;</span>&nbsp;<span class="ident" id="4799997">entityName</span><span class="op" id="4800007">[</span><span class="builtinfunc" id="4800008">len</span><span class="op" id="4800011">(</span><span class="ident" id="4800012">entityName</span><span class="op" id="4800022">)</span><span class="op" id="4800023">-</span><span class="num" id="4800024">1</span><span class="op" id="4800025">]</span>&nbsp;<span class="op" id="4800027">!=</span>&nbsp;<span class="string" id="4800030">&#39;;&#39;</span>&nbsp;<span class="op" id="4800034">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4800037">len</span><span class="op" id="4800040">(</span><span class="ident" id="4800041">s</span><span class="op" id="4800042">)</span>&nbsp;<span class="op" id="4800044">&gt;</span>&nbsp;<span class="ident" id="4800046">i</span>&nbsp;<span class="op" id="4800048">&amp;&amp;</span>&nbsp;<span class="ident" id="4800051">s</span><span class="op" id="4800052">[</span><span class="ident" id="4800053">i</span><span class="op" id="4800054">]</span>&nbsp;<span class="op" id="4800056">==</span>&nbsp;<span class="string" id="4800059">&#39;=&#39;</span>&nbsp;<span class="op" id="4800063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4800067">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800078">}</span>&nbsp;<span class="keyword" id="4800080">else</span>&nbsp;<span class="keyword" id="4800085">if</span>&nbsp;<span class="ident" id="4800088">x</span>&nbsp;<span class="op" id="4800090">:=</span>&nbsp;<span class="ident" id="4800093">entity</span><span class="op" id="4800099">[</span><span class="ident" id="4800100">entityName</span><span class="op" id="4800110">]</span><span class="op" id="4800111">;</span>&nbsp;<span class="ident" id="4800113">x</span>&nbsp;<span class="op" id="4800115">!=</span>&nbsp;<span class="num" id="4800118">0</span>&nbsp;<span class="op" id="4800120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800124">return</span>&nbsp;<span class="ident" id="4800131">dst</span>&nbsp;<span class="op" id="4800135">+</span>&nbsp;<span class="ident" id="4800137">utf8</span><span class="op" id="4800141">.</span><span class="ident" id="4800142">EncodeRune</span><span class="op" id="4800152">(</span><span class="ident" id="4800153">b</span><span class="op" id="4800154">[</span><span class="ident" id="4800155">dst</span><span class="op" id="4800158">:</span><span class="op" id="4800159">]</span><span class="op" id="4800160">,</span>&nbsp;<span class="ident" id="4800162">x</span><span class="op" id="4800163">)</span><span class="op" id="4800164">,</span>&nbsp;<span class="ident" id="4800166">src</span>&nbsp;<span class="op" id="4800170">+</span>&nbsp;<span class="ident" id="4800172">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800175">}</span>&nbsp;<span class="keyword" id="4800177">else</span>&nbsp;<span class="keyword" id="4800182">if</span>&nbsp;<span class="ident" id="4800185">x</span>&nbsp;<span class="op" id="4800187">:=</span>&nbsp;<span class="ident" id="4800190">entity2</span><span class="op" id="4800197">[</span><span class="ident" id="4800198">entityName</span><span class="op" id="4800208">]</span><span class="op" id="4800209">;</span>&nbsp;<span class="ident" id="4800211">x</span><span class="op" id="4800212">[</span><span class="num" id="4800213">0</span><span class="op" id="4800214">]</span>&nbsp;<span class="op" id="4800216">!=</span>&nbsp;<span class="num" id="4800219">0</span>&nbsp;<span class="op" id="4800221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800225">dst1</span>&nbsp;<span class="op" id="4800230">:=</span>&nbsp;<span class="ident" id="4800233">dst</span>&nbsp;<span class="op" id="4800237">+</span>&nbsp;<span class="ident" id="4800239">utf8</span><span class="op" id="4800243">.</span><span class="ident" id="4800244">EncodeRune</span><span class="op" id="4800254">(</span><span class="ident" id="4800255">b</span><span class="op" id="4800256">[</span><span class="ident" id="4800257">dst</span><span class="op" id="4800260">:</span><span class="op" id="4800261">]</span><span class="op" id="4800262">,</span>&nbsp;<span class="ident" id="4800264">x</span><span class="op" id="4800265">[</span><span class="num" id="4800266">0</span><span class="op" id="4800267">]</span><span class="op" id="4800268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800272">return</span>&nbsp;<span class="ident" id="4800279">dst1</span>&nbsp;<span class="op" id="4800284">+</span>&nbsp;<span class="ident" id="4800286">utf8</span><span class="op" id="4800290">.</span><span class="ident" id="4800291">EncodeRune</span><span class="op" id="4800301">(</span><span class="ident" id="4800302">b</span><span class="op" id="4800303">[</span><span class="ident" id="4800304">dst1</span><span class="op" id="4800308">:</span><span class="op" id="4800309">]</span><span class="op" id="4800310">,</span>&nbsp;<span class="ident" id="4800312">x</span><span class="op" id="4800313">[</span><span class="num" id="4800314">1</span><span class="op" id="4800315">]</span><span class="op" id="4800316">)</span><span class="op" id="4800317">,</span>&nbsp;<span class="ident" id="4800319">src</span>&nbsp;<span class="op" id="4800323">+</span>&nbsp;<span class="ident" id="4800325">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800328">}</span>&nbsp;<span class="keyword" id="4800330">else</span>&nbsp;<span class="keyword" id="4800335">if</span>&nbsp;<span class="op" id="4800338">!</span><span class="ident" id="4800339">attribute</span>&nbsp;<span class="op" id="4800349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800353">maxLen</span>&nbsp;<span class="op" id="4800360">:=</span>&nbsp;<span class="builtinfunc" id="4800363">len</span><span class="op" id="4800366">(</span><span class="ident" id="4800367">entityName</span><span class="op" id="4800377">)</span>&nbsp;<span class="op" id="4800379">-</span>&nbsp;<span class="num" id="4800381">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800385">if</span>&nbsp;<span class="ident" id="4800388">maxLen</span>&nbsp;<span class="op" id="4800395">&gt;</span>&nbsp;<span class="ident" id="4800397">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="4800427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800432">maxLen</span>&nbsp;<span class="op" id="4800439">=</span>&nbsp;<span class="ident" id="4800441">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800477">for</span>&nbsp;<span class="ident" id="4800481">j</span>&nbsp;<span class="op" id="4800483">:=</span>&nbsp;<span class="ident" id="4800486">maxLen</span><span class="op" id="4800492">;</span>&nbsp;<span class="ident" id="4800494">j</span>&nbsp;<span class="op" id="4800496">&gt;</span>&nbsp;<span class="num" id="4800498">1</span><span class="op" id="4800499">;</span>&nbsp;<span class="ident" id="4800501">j</span><span class="op" id="4800502">--</span>&nbsp;<span class="op" id="4800505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800510">if</span>&nbsp;<span class="ident" id="4800513">x</span>&nbsp;<span class="op" id="4800515">:=</span>&nbsp;<span class="ident" id="4800518">entity</span><span class="op" id="4800524">[</span><span class="ident" id="4800525">entityName</span><span class="op" id="4800535">[</span><span class="op" id="4800536">:</span><span class="ident" id="4800537">j</span><span class="op" id="4800538">]</span><span class="op" id="4800539">]</span><span class="op" id="4800540">;</span>&nbsp;<span class="ident" id="4800542">x</span>&nbsp;<span class="op" id="4800544">!=</span>&nbsp;<span class="num" id="4800547">0</span>&nbsp;<span class="op" id="4800549">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800555">return</span>&nbsp;<span class="ident" id="4800562">dst</span>&nbsp;<span class="op" id="4800566">+</span>&nbsp;<span class="ident" id="4800568">utf8</span><span class="op" id="4800572">.</span><span class="ident" id="4800573">EncodeRune</span><span class="op" id="4800583">(</span><span class="ident" id="4800584">b</span><span class="op" id="4800585">[</span><span class="ident" id="4800586">dst</span><span class="op" id="4800589">:</span><span class="op" id="4800590">]</span><span class="op" id="4800591">,</span>&nbsp;<span class="ident" id="4800593">x</span><span class="op" id="4800594">)</span><span class="op" id="4800595">,</span>&nbsp;<span class="ident" id="4800597">src</span>&nbsp;<span class="op" id="4800601">+</span>&nbsp;<span class="ident" id="4800603">j</span>&nbsp;<span class="op" id="4800605">+</span>&nbsp;<span class="num" id="4800607">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4800619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800623">dst1</span><span class="op" id="4800627">,</span>&nbsp;<span class="ident" id="4800629">src1</span>&nbsp;<span class="op" id="4800634">=</span>&nbsp;<span class="ident" id="4800636">dst</span><span class="op" id="4800639">+</span><span class="ident" id="4800640">i</span><span class="op" id="4800641">,</span>&nbsp;<span class="ident" id="4800643">src</span><span class="op" id="4800646">+</span><span class="ident" id="4800647">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4800650">copy</span><span class="op" id="4800654">(</span><span class="ident" id="4800655">b</span><span class="op" id="4800656">[</span><span class="ident" id="4800657">dst</span><span class="op" id="4800660">:</span><span class="ident" id="4800661">dst1</span><span class="op" id="4800665">]</span><span class="op" id="4800666">,</span>&nbsp;<span class="ident" id="4800668">b</span><span class="op" id="4800669">[</span><span class="ident" id="4800670">src</span><span class="op" id="4800673">:</span><span class="ident" id="4800674">src1</span><span class="op" id="4800678">]</span><span class="op" id="4800679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800682">return</span>&nbsp;<span class="ident" id="4800689">dst1</span><span class="op" id="4800693">,</span>&nbsp;<span class="ident" id="4800695">src1</span><br>
<span class="lineno"></span><span class="op" id="4800700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="4800703">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4800780">func</span>&nbsp;<span class="ident" id="4800785">unescape</span><span class="op" id="4800793">(</span><span class="ident" id="4800794">b</span>&nbsp;<span class="op" id="4800796">[</span><span class="op" id="4800797">]</span><span class="builtintype" id="4800798">byte</span><span class="op" id="4800802">)</span>&nbsp;<span class="op" id="4800804">[</span><span class="op" id="4800805">]</span><span class="builtintype" id="4800806">byte</span>&nbsp;<span class="op" id="4800811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800814">for</span>&nbsp;<span class="ident" id="4800818">i</span><span class="op" id="4800819">,</span>&nbsp;<span class="ident" id="4800821">c</span>&nbsp;<span class="op" id="4800823">:=</span>&nbsp;<span class="keyword" id="4800826">range</span>&nbsp;<span class="ident" id="4800832">b</span>&nbsp;<span class="op" id="4800834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800838">if</span>&nbsp;<span class="ident" id="4800841">c</span>&nbsp;<span class="op" id="4800843">==</span>&nbsp;<span class="string" id="4800846">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4800850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800855">dst</span><span class="op" id="4800858">,</span>&nbsp;<span class="ident" id="4800860">src</span>&nbsp;<span class="op" id="4800864">:=</span>&nbsp;<span class="ident" id="4800867">unescapeEntity</span><span class="op" id="4800881">(</span><span class="ident" id="4800882">b</span><span class="op" id="4800883">,</span>&nbsp;<span class="ident" id="4800885">i</span><span class="op" id="4800886">,</span>&nbsp;<span class="ident" id="4800888">i</span><span class="op" id="4800889">,</span>&nbsp;<span class="builtintype" id="4800891">false</span><span class="op" id="4800896">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800901">for</span>&nbsp;<span class="ident" id="4800905">src</span>&nbsp;<span class="op" id="4800909">&lt;</span>&nbsp;<span class="builtinfunc" id="4800911">len</span><span class="op" id="4800914">(</span><span class="ident" id="4800915">b</span><span class="op" id="4800916">)</span>&nbsp;<span class="op" id="4800918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800924">c</span>&nbsp;<span class="op" id="4800926">:=</span>&nbsp;<span class="ident" id="4800929">b</span><span class="op" id="4800930">[</span><span class="ident" id="4800931">src</span><span class="op" id="4800934">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4800940">if</span>&nbsp;<span class="ident" id="4800943">c</span>&nbsp;<span class="op" id="4800945">==</span>&nbsp;<span class="string" id="4800948">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4800952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4800959">dst</span><span class="op" id="4800962">,</span>&nbsp;<span class="ident" id="4800964">src</span>&nbsp;<span class="op" id="4800968">=</span>&nbsp;<span class="ident" id="4800970">unescapeEntity</span><span class="op" id="4800984">(</span><span class="ident" id="4800985">b</span><span class="op" id="4800986">,</span>&nbsp;<span class="ident" id="4800988">dst</span><span class="op" id="4800991">,</span>&nbsp;<span class="ident" id="4800993">src</span><span class="op" id="4800996">,</span>&nbsp;<span class="builtintype" id="4800998">false</span><span class="op" id="4801003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801009">}</span>&nbsp;<span class="keyword" id="4801011">else</span>&nbsp;<span class="op" id="4801016">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801023">b</span><span class="op" id="4801024">[</span><span class="ident" id="4801025">dst</span><span class="op" id="4801028">]</span>&nbsp;<span class="op" id="4801030">=</span>&nbsp;<span class="ident" id="4801032">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801039">dst</span><span class="op" id="4801042">,</span>&nbsp;<span class="ident" id="4801044">src</span>&nbsp;<span class="op" id="4801048">=</span>&nbsp;<span class="ident" id="4801050">dst</span><span class="op" id="4801053">+</span><span class="num" id="4801054">1</span><span class="op" id="4801055">,</span>&nbsp;<span class="ident" id="4801057">src</span><span class="op" id="4801060">+</span><span class="num" id="4801061">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801077">return</span>&nbsp;<span class="ident" id="4801084">b</span><span class="op" id="4801085">[</span><span class="num" id="4801086">0</span><span class="op" id="4801087">:</span><span class="ident" id="4801088">dst</span><span class="op" id="4801091">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801101">return</span>&nbsp;<span class="ident" id="4801108">b</span><br>
<span class="lineno"></span><span class="op" id="4801110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="4801113">const</span>&nbsp;<span class="ident" id="4801119">escapedChars</span>&nbsp;<span class="op" id="4801132">=</span>&nbsp;<span class="string" id="4801134">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4801143">func</span>&nbsp;<span class="ident" id="4801148">escape</span><span class="op" id="4801154">(</span><span class="ident" id="4801155">w</span>&nbsp;<span class="ident" id="4801157">writer</span><span class="op" id="4801163">,</span>&nbsp;<span class="ident" id="4801165">s</span>&nbsp;<span class="builtintype" id="4801167">string</span><span class="op" id="4801173">)</span>&nbsp;<span class="builtintype" id="4801175">error</span>&nbsp;<span class="op" id="4801181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801184">i</span>&nbsp;<span class="op" id="4801186">:=</span>&nbsp;<span class="ident" id="4801189">strings</span><span class="op" id="4801196">.</span><span class="ident" id="4801197">IndexAny</span><span class="op" id="4801205">(</span><span class="ident" id="4801206">s</span><span class="op" id="4801207">,</span>&nbsp;<span class="ident" id="4801209">escapedChars</span><span class="op" id="4801221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801224">for</span>&nbsp;<span class="ident" id="4801228">i</span>&nbsp;<span class="op" id="4801230">!=</span>&nbsp;<span class="op" id="4801233">-</span><span class="num" id="4801234">1</span>&nbsp;<span class="op" id="4801236">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801240">if</span>&nbsp;<span class="ident" id="4801243">_</span><span class="op" id="4801244">,</span>&nbsp;<span class="ident" id="4801246">err</span>&nbsp;<span class="op" id="4801250">:=</span>&nbsp;<span class="ident" id="4801253">w</span><span class="op" id="4801254">.</span><span class="ident" id="4801255">WriteString</span><span class="op" id="4801266">(</span><span class="ident" id="4801267">s</span><span class="op" id="4801268">[</span><span class="op" id="4801269">:</span><span class="ident" id="4801270">i</span><span class="op" id="4801271">]</span><span class="op" id="4801272">)</span><span class="op" id="4801273">;</span>&nbsp;<span class="ident" id="4801275">err</span>&nbsp;<span class="op" id="4801279">!=</span>&nbsp;<span class="ident" id="4801282">nil</span>&nbsp;<span class="op" id="4801286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801291">return</span>&nbsp;<span class="ident" id="4801298">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801308">var</span>&nbsp;<span class="ident" id="4801312">esc</span>&nbsp;<span class="builtintype" id="4801316">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801325">switch</span>&nbsp;<span class="ident" id="4801332">s</span><span class="op" id="4801333">[</span><span class="ident" id="4801334">i</span><span class="op" id="4801335">]</span>&nbsp;<span class="op" id="4801337">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801341">case</span>&nbsp;<span class="string" id="4801346">&#39;&amp;&#39;</span><span class="op" id="4801349">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801354">esc</span>&nbsp;<span class="op" id="4801358">=</span>&nbsp;<span class="string" id="4801360">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801370">case</span>&nbsp;<span class="string" id="4801375">&#39;\&#39;&#39;</span><span class="op" id="4801379">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801384">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801461">esc</span>&nbsp;<span class="op" id="4801465">=</span>&nbsp;<span class="string" id="4801467">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801477">case</span>&nbsp;<span class="string" id="4801482">&#39;&lt;&#39;</span><span class="op" id="4801485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801490">esc</span>&nbsp;<span class="op" id="4801494">=</span>&nbsp;<span class="string" id="4801496">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801505">case</span>&nbsp;<span class="string" id="4801510">&#39;&gt;&#39;</span><span class="op" id="4801513">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801518">esc</span>&nbsp;<span class="op" id="4801522">=</span>&nbsp;<span class="string" id="4801524">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801533">case</span>&nbsp;<span class="string" id="4801538">&#39;&#34;&#39;</span><span class="op" id="4801541">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4801546">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801586">esc</span>&nbsp;<span class="op" id="4801590">=</span>&nbsp;<span class="string" id="4801592">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801602">default</span><span class="op" id="4801609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4801614">panic</span><span class="op" id="4801619">(</span><span class="string" id="4801620">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="4801651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801655">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801659">s</span>&nbsp;<span class="op" id="4801661">=</span>&nbsp;<span class="ident" id="4801663">s</span><span class="op" id="4801664">[</span><span class="ident" id="4801665">i</span><span class="op" id="4801666">+</span><span class="num" id="4801667">1</span><span class="op" id="4801668">:</span><span class="op" id="4801669">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801673">if</span>&nbsp;<span class="ident" id="4801676">_</span><span class="op" id="4801677">,</span>&nbsp;<span class="ident" id="4801679">err</span>&nbsp;<span class="op" id="4801683">:=</span>&nbsp;<span class="ident" id="4801686">w</span><span class="op" id="4801687">.</span><span class="ident" id="4801688">WriteString</span><span class="op" id="4801699">(</span><span class="ident" id="4801700">esc</span><span class="op" id="4801703">)</span><span class="op" id="4801704">;</span>&nbsp;<span class="ident" id="4801706">err</span>&nbsp;<span class="op" id="4801710">!=</span>&nbsp;<span class="ident" id="4801713">nil</span>&nbsp;<span class="op" id="4801717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801722">return</span>&nbsp;<span class="ident" id="4801729">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801739">i</span>&nbsp;<span class="op" id="4801741">=</span>&nbsp;<span class="ident" id="4801743">strings</span><span class="op" id="4801750">.</span><span class="ident" id="4801751">IndexAny</span><span class="op" id="4801759">(</span><span class="ident" id="4801760">s</span><span class="op" id="4801761">,</span>&nbsp;<span class="ident" id="4801763">escapedChars</span><span class="op" id="4801775">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4801778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4801781">_</span><span class="op" id="4801782">,</span>&nbsp;<span class="ident" id="4801784">err</span>&nbsp;<span class="op" id="4801788">:=</span>&nbsp;<span class="ident" id="4801791">w</span><span class="op" id="4801792">.</span><span class="ident" id="4801793">WriteString</span><span class="op" id="4801804">(</span><span class="ident" id="4801805">s</span><span class="op" id="4801806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4801809">return</span>&nbsp;<span class="ident" id="4801816">err</span><br>
<span class="lineno"></span><span class="op" id="4801820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="4801823">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4801896">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4801952">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4802029">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4802045">func</span>&nbsp;<span class="ident" id="4802050">EscapeString</span><span class="op" id="4802062">(</span><span class="ident" id="4802063">s</span>&nbsp;<span class="builtintype" id="4802065">string</span><span class="op" id="4802071">)</span>&nbsp;<span class="builtintype" id="4802073">string</span>&nbsp;<span class="op" id="4802080">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802083">if</span>&nbsp;<span class="ident" id="4802086">strings</span><span class="op" id="4802093">.</span><span class="ident" id="4802094">IndexAny</span><span class="op" id="4802102">(</span><span class="ident" id="4802103">s</span><span class="op" id="4802104">,</span>&nbsp;<span class="ident" id="4802106">escapedChars</span><span class="op" id="4802118">)</span>&nbsp;<span class="op" id="4802120">==</span>&nbsp;<span class="op" id="4802123">-</span><span class="num" id="4802124">1</span>&nbsp;<span class="op" id="4802126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802130">return</span>&nbsp;<span class="ident" id="4802137">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802143">var</span>&nbsp;<span class="ident" id="4802147">buf</span>&nbsp;<span class="ident" id="4802151">bytes</span><span class="op" id="4802156">.</span><span class="ident" id="4802157">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4802165">escape</span><span class="op" id="4802171">(</span><span class="op" id="4802172">&amp;</span><span class="ident" id="4802173">buf</span><span class="op" id="4802176">,</span>&nbsp;<span class="ident" id="4802178">s</span><span class="op" id="4802179">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802182">return</span>&nbsp;<span class="ident" id="4802189">buf</span><span class="op" id="4802192">.</span><span class="ident" id="4802193">String</span><span class="op" id="4802199">(</span><span class="op" id="4802200">)</span><br>
<span class="lineno"></span><span class="op" id="4802202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4802205">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4802284">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="4802363">//&nbsp;unescapes&nbsp;to&nbsp;&#34;&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="4802415">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4802492">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="4802508">func</span>&nbsp;<span class="ident" id="4802513">UnescapeString</span><span class="op" id="4802527">(</span><span class="ident" id="4802528">s</span>&nbsp;<span class="builtintype" id="4802530">string</span><span class="op" id="4802536">)</span>&nbsp;<span class="builtintype" id="4802538">string</span>&nbsp;<span class="op" id="4802545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802548">for</span>&nbsp;<span class="ident" id="4802552">_</span><span class="op" id="4802553">,</span>&nbsp;<span class="ident" id="4802555">c</span>&nbsp;<span class="op" id="4802557">:=</span>&nbsp;<span class="keyword" id="4802560">range</span>&nbsp;<span class="ident" id="4802566">s</span>&nbsp;<span class="op" id="4802568">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802572">if</span>&nbsp;<span class="ident" id="4802575">c</span>&nbsp;<span class="op" id="4802577">==</span>&nbsp;<span class="string" id="4802580">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="4802584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802589">return</span>&nbsp;<span class="builtintype" id="4802596">string</span><span class="op" id="4802602">(</span><span class="ident" id="4802603">unescape</span><span class="op" id="4802611">(</span><span class="op" id="4802612">[</span><span class="op" id="4802613">]</span><span class="builtintype" id="4802614">byte</span><span class="op" id="4802618">(</span><span class="ident" id="4802619">s</span><span class="op" id="4802620">)</span><span class="op" id="4802621">)</span><span class="op" id="4802622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4802629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4802632">return</span>&nbsp;<span class="ident" id="4802639">s</span><br>
<span class="lineno">250</span><span class="op" id="4802641">}</span>
</div>
</body>
</html>
