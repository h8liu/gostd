<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7714625">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7714680">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7714734">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7714785">package</span>&nbsp;<span class="ident" id="7714793">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7714802">import</span>&nbsp;<span class="op" id="7714809">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714812">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714821">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714827">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714840">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714851">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7714861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7714864">type</span>&nbsp;<span class="ident" id="7714869">testpair</span>&nbsp;<span class="keyword" id="7714878">struct</span>&nbsp;<span class="op" id="7714885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7714888">decoded</span><span class="op" id="7714895">,</span>&nbsp;<span class="ident" id="7714897">encoded</span>&nbsp;<span class="builtintype" id="7714905">string</span><br>
<span class="lineno"></span><span class="op" id="7714912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7714915">var</span>&nbsp;<span class="ident" id="7714919">pairs</span>&nbsp;<span class="op" id="7714925">=</span>&nbsp;<span class="op" id="7714927">[</span><span class="op" id="7714928">]</span><span class="ident" id="7714929">testpair</span><span class="op" id="7714937">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7714940">//&nbsp;Encode&nbsp;returns&nbsp;0&nbsp;when&nbsp;len(src)&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714984">&#34;&#34;</span><span class="op" id="7714986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7714990">&#34;&#34;</span><span class="op" id="7714992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7714995">}</span><span class="op" id="7714996">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7714999">//&nbsp;Wikipedia&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715025">&#34;Man&nbsp;is&nbsp;distinguished,&nbsp;not&nbsp;only&nbsp;by&nbsp;his&nbsp;reason,&nbsp;but&nbsp;by&nbsp;this&nbsp;singular&nbsp;passion&nbsp;from&nbsp;&#34;</span>&nbsp;<span class="op" id="7715108">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715113">&#34;other&nbsp;animals,&nbsp;which&nbsp;is&nbsp;a&nbsp;lust&nbsp;of&nbsp;the&nbsp;mind,&nbsp;that&nbsp;by&nbsp;a&nbsp;perseverance&nbsp;of&nbsp;delight&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="7715197">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715202">&#34;the&nbsp;continued&nbsp;and&nbsp;indefatigable&nbsp;generation&nbsp;of&nbsp;knowledge,&nbsp;exceeds&nbsp;the&nbsp;short&nbsp;&#34;</span>&nbsp;<span class="op" id="7715280">+</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715285">&#34;vehemence&nbsp;of&nbsp;any&nbsp;carnal&nbsp;pleasure.&#34;</span><span class="op" id="7715320">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715324">&#34;9jqo^BlbD-BleB1DJ+*+F(f,q/0JhKF&lt;GL&gt;Cj@.4Gp$d7F!,L7@&lt;6@)/0JDEF&lt;G%&lt;+EV:2F!,\n&#34;</span>&nbsp;<span class="op" id="7715402">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715407">&#34;O&lt;DJ+*.@&lt;*K0@&lt;6L(Df-\\0Ec5e;DffZ(EZee.Bl.9pF\&#34;AGXBPCsi+DGm&gt;@3BB/F*&amp;OCAfu2/AKY\n&#34;</span>&nbsp;<span class="op" id="7715489">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715494">&#34;i(DIb:@FD,*)+C]U=@3BN#EcYf8ATD3s@q?d$AftVqCh[NqF&lt;G:8+EV:.+Cf&gt;-FD5W8ARlolDIa\n&#34;</span>&nbsp;<span class="op" id="7715574">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715579">&#34;l(DId&lt;j@&lt;?3r@:F%a+D58&#39;ATD4$Bl@l3De:,-DJs`8ARoFb/0JMK@qB4^F!,R&lt;AKZ&amp;-DfTqBG%G\n&#34;</span>&nbsp;<span class="op" id="7715659">+</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715664">&#34;&gt;uD.RTpAKYo&#39;+CT/5+Cei#DII?(E,9)oF*2M7/c\n&#34;</span><span class="op" id="7715707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715710">}</span><span class="op" id="7715711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7715714">//&nbsp;Special&nbsp;case&nbsp;when&nbsp;shortening&nbsp;!!!!!&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715763">&#34;\000\000\000\000&#34;</span><span class="op" id="7715781">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7715785">&#34;z&#34;</span><span class="op" id="7715788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715791">}</span><span class="op" id="7715792">,</span><br>
<span class="lineno"></span><span class="op" id="7715794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7715797">var</span>&nbsp;<span class="ident" id="7715801">bigtest</span>&nbsp;<span class="op" id="7715809">=</span>&nbsp;<span class="ident" id="7715811">pairs</span><span class="op" id="7715816">[</span><span class="builtinfunc" id="7715817">len</span><span class="op" id="7715820">(</span><span class="ident" id="7715821">pairs</span><span class="op" id="7715826">)</span><span class="op" id="7715827">-</span><span class="num" id="7715828">1</span><span class="op" id="7715829">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7715832">func</span>&nbsp;<span class="ident" id="7715837">testEqual</span><span class="op" id="7715846">(</span><span class="ident" id="7715847">t</span>&nbsp;<span class="op" id="7715849">*</span><span class="ident" id="7715850">testing</span><span class="op" id="7715857">.</span><span class="ident" id="7715858">T</span><span class="op" id="7715859">,</span>&nbsp;<span class="ident" id="7715861">msg</span>&nbsp;<span class="builtintype" id="7715865">string</span><span class="op" id="7715871">,</span>&nbsp;<span class="ident" id="7715873">args</span>&nbsp;<span class="op" id="7715878">...</span><span class="keyword" id="7715881">interface</span><span class="op" id="7715890">{</span><span class="op" id="7715891">}</span><span class="op" id="7715892">)</span>&nbsp;<span class="builtintype" id="7715894">bool</span>&nbsp;<span class="op" id="7715899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715902">if</span>&nbsp;<span class="ident" id="7715905">args</span><span class="op" id="7715909">[</span><span class="builtinfunc" id="7715910">len</span><span class="op" id="7715913">(</span><span class="ident" id="7715914">args</span><span class="op" id="7715918">)</span><span class="op" id="7715919">-</span><span class="num" id="7715920">2</span><span class="op" id="7715921">]</span>&nbsp;<span class="op" id="7715923">!=</span>&nbsp;<span class="ident" id="7715926">args</span><span class="op" id="7715930">[</span><span class="builtinfunc" id="7715931">len</span><span class="op" id="7715934">(</span><span class="ident" id="7715935">args</span><span class="op" id="7715939">)</span><span class="op" id="7715940">-</span><span class="num" id="7715941">1</span><span class="op" id="7715942">]</span>&nbsp;<span class="op" id="7715944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7715948">t</span><span class="op" id="7715949">.</span><span class="ident" id="7715950">Errorf</span><span class="op" id="7715956">(</span><span class="ident" id="7715957">msg</span><span class="op" id="7715960">,</span>&nbsp;<span class="ident" id="7715962">args</span><span class="op" id="7715966">...</span><span class="op" id="7715969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715973">return</span>&nbsp;<span class="builtintype" id="7715980">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7715987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7715990">return</span>&nbsp;<span class="builtintype" id="7715997">true</span><br>
<span class="lineno"></span><span class="op" id="7716002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7716005">func</span>&nbsp;<span class="ident" id="7716010">strip85</span><span class="op" id="7716017">(</span><span class="ident" id="7716018">s</span>&nbsp;<span class="builtintype" id="7716020">string</span><span class="op" id="7716026">)</span>&nbsp;<span class="builtintype" id="7716028">string</span>&nbsp;<span class="op" id="7716035">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716038">t</span>&nbsp;<span class="op" id="7716040">:=</span>&nbsp;<span class="builtinfunc" id="7716043">make</span><span class="op" id="7716047">(</span><span class="op" id="7716048">[</span><span class="op" id="7716049">]</span><span class="builtintype" id="7716050">byte</span><span class="op" id="7716054">,</span>&nbsp;<span class="builtinfunc" id="7716056">len</span><span class="op" id="7716059">(</span><span class="ident" id="7716060">s</span><span class="op" id="7716061">)</span><span class="op" id="7716062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716065">w</span>&nbsp;<span class="op" id="7716067">:=</span>&nbsp;<span class="num" id="7716070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716073">for</span>&nbsp;<span class="ident" id="7716077">r</span>&nbsp;<span class="op" id="7716079">:=</span>&nbsp;<span class="num" id="7716082">0</span><span class="op" id="7716083">;</span>&nbsp;<span class="ident" id="7716085">r</span>&nbsp;<span class="op" id="7716087">&lt;</span>&nbsp;<span class="builtinfunc" id="7716089">len</span><span class="op" id="7716092">(</span><span class="ident" id="7716093">s</span><span class="op" id="7716094">)</span><span class="op" id="7716095">;</span>&nbsp;<span class="ident" id="7716097">r</span><span class="op" id="7716098">++</span>&nbsp;<span class="op" id="7716101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716105">c</span>&nbsp;<span class="op" id="7716107">:=</span>&nbsp;<span class="ident" id="7716110">s</span><span class="op" id="7716111">[</span><span class="ident" id="7716112">r</span><span class="op" id="7716113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716117">if</span>&nbsp;<span class="ident" id="7716120">c</span>&nbsp;<span class="op" id="7716122">&gt;</span>&nbsp;<span class="string" id="7716124">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="7716128">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716133">t</span><span class="op" id="7716134">[</span><span class="ident" id="7716135">w</span><span class="op" id="7716136">]</span>&nbsp;<span class="op" id="7716138">=</span>&nbsp;<span class="ident" id="7716140">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716145">w</span><span class="op" id="7716146">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716157">return</span>&nbsp;<span class="builtintype" id="7716164">string</span><span class="op" id="7716170">(</span><span class="ident" id="7716171">t</span><span class="op" id="7716172">[</span><span class="num" id="7716173">0</span><span class="op" id="7716174">:</span><span class="ident" id="7716175">w</span><span class="op" id="7716176">]</span><span class="op" id="7716177">)</span><br>
<span class="lineno">65</span><span class="op" id="7716179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7716182">func</span>&nbsp;<span class="ident" id="7716187">TestEncode</span><span class="op" id="7716197">(</span><span class="ident" id="7716198">t</span>&nbsp;<span class="op" id="7716200">*</span><span class="ident" id="7716201">testing</span><span class="op" id="7716208">.</span><span class="ident" id="7716209">T</span><span class="op" id="7716210">)</span>&nbsp;<span class="op" id="7716212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716215">for</span>&nbsp;<span class="ident" id="7716219">_</span><span class="op" id="7716220">,</span>&nbsp;<span class="ident" id="7716222">p</span>&nbsp;<span class="op" id="7716224">:=</span>&nbsp;<span class="keyword" id="7716227">range</span>&nbsp;<span class="ident" id="7716233">pairs</span>&nbsp;<span class="op" id="7716239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716243">buf</span>&nbsp;<span class="op" id="7716247">:=</span>&nbsp;<span class="builtinfunc" id="7716250">make</span><span class="op" id="7716254">(</span><span class="op" id="7716255">[</span><span class="op" id="7716256">]</span><span class="builtintype" id="7716257">byte</span><span class="op" id="7716261">,</span>&nbsp;<span class="ident" id="7716263">MaxEncodedLen</span><span class="op" id="7716276">(</span><span class="builtinfunc" id="7716277">len</span><span class="op" id="7716280">(</span><span class="ident" id="7716281">p</span><span class="op" id="7716282">.</span><span class="ident" id="7716283">decoded</span><span class="op" id="7716290">)</span><span class="op" id="7716291">)</span><span class="op" id="7716292">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716296">n</span>&nbsp;<span class="op" id="7716298">:=</span>&nbsp;<span class="ident" id="7716301">Encode</span><span class="op" id="7716307">(</span><span class="ident" id="7716308">buf</span><span class="op" id="7716311">,</span>&nbsp;<span class="op" id="7716313">[</span><span class="op" id="7716314">]</span><span class="builtintype" id="7716315">byte</span><span class="op" id="7716319">(</span><span class="ident" id="7716320">p</span><span class="op" id="7716321">.</span><span class="ident" id="7716322">decoded</span><span class="op" id="7716329">)</span><span class="op" id="7716330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716334">buf</span>&nbsp;<span class="op" id="7716338">=</span>&nbsp;<span class="ident" id="7716340">buf</span><span class="op" id="7716343">[</span><span class="num" id="7716344">0</span><span class="op" id="7716345">:</span><span class="ident" id="7716346">n</span><span class="op" id="7716347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716351">testEqual</span><span class="op" id="7716360">(</span><span class="ident" id="7716361">t</span><span class="op" id="7716362">,</span>&nbsp;<span class="string" id="7716364">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7716390">,</span>&nbsp;<span class="ident" id="7716392">p</span><span class="op" id="7716393">.</span><span class="ident" id="7716394">decoded</span><span class="op" id="7716401">,</span>&nbsp;<span class="ident" id="7716403">strip85</span><span class="op" id="7716410">(</span><span class="builtintype" id="7716411">string</span><span class="op" id="7716417">(</span><span class="ident" id="7716418">buf</span><span class="op" id="7716421">)</span><span class="op" id="7716422">)</span><span class="op" id="7716423">,</span>&nbsp;<span class="ident" id="7716425">strip85</span><span class="op" id="7716432">(</span><span class="ident" id="7716433">p</span><span class="op" id="7716434">.</span><span class="ident" id="7716435">encoded</span><span class="op" id="7716442">)</span><span class="op" id="7716443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716446">}</span><br>
<span class="lineno"></span><span class="op" id="7716448">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="7716451">func</span>&nbsp;<span class="ident" id="7716456">TestEncoder</span><span class="op" id="7716467">(</span><span class="ident" id="7716468">t</span>&nbsp;<span class="op" id="7716470">*</span><span class="ident" id="7716471">testing</span><span class="op" id="7716478">.</span><span class="ident" id="7716479">T</span><span class="op" id="7716480">)</span>&nbsp;<span class="op" id="7716482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716485">for</span>&nbsp;<span class="ident" id="7716489">_</span><span class="op" id="7716490">,</span>&nbsp;<span class="ident" id="7716492">p</span>&nbsp;<span class="op" id="7716494">:=</span>&nbsp;<span class="keyword" id="7716497">range</span>&nbsp;<span class="ident" id="7716503">pairs</span>&nbsp;<span class="op" id="7716509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716513">bb</span>&nbsp;<span class="op" id="7716516">:=</span>&nbsp;<span class="op" id="7716519">&amp;</span><span class="ident" id="7716520">bytes</span><span class="op" id="7716525">.</span><span class="ident" id="7716526">Buffer</span><span class="op" id="7716532">{</span><span class="op" id="7716533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716537">encoder</span>&nbsp;<span class="op" id="7716545">:=</span>&nbsp;<span class="ident" id="7716548">NewEncoder</span><span class="op" id="7716558">(</span><span class="ident" id="7716559">bb</span><span class="op" id="7716561">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716565">encoder</span><span class="op" id="7716572">.</span><span class="ident" id="7716573">Write</span><span class="op" id="7716578">(</span><span class="op" id="7716579">[</span><span class="op" id="7716580">]</span><span class="builtintype" id="7716581">byte</span><span class="op" id="7716585">(</span><span class="ident" id="7716586">p</span><span class="op" id="7716587">.</span><span class="ident" id="7716588">decoded</span><span class="op" id="7716595">)</span><span class="op" id="7716596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716600">encoder</span><span class="op" id="7716607">.</span><span class="ident" id="7716608">Close</span><span class="op" id="7716613">(</span><span class="op" id="7716614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716618">testEqual</span><span class="op" id="7716627">(</span><span class="ident" id="7716628">t</span><span class="op" id="7716629">,</span>&nbsp;<span class="string" id="7716631">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7716657">,</span>&nbsp;<span class="ident" id="7716659">p</span><span class="op" id="7716660">.</span><span class="ident" id="7716661">decoded</span><span class="op" id="7716668">,</span>&nbsp;<span class="ident" id="7716670">strip85</span><span class="op" id="7716677">(</span><span class="ident" id="7716678">bb</span><span class="op" id="7716680">.</span><span class="ident" id="7716681">String</span><span class="op" id="7716687">(</span><span class="op" id="7716688">)</span><span class="op" id="7716689">)</span><span class="op" id="7716690">,</span>&nbsp;<span class="ident" id="7716692">strip85</span><span class="op" id="7716699">(</span><span class="ident" id="7716700">p</span><span class="op" id="7716701">.</span><span class="ident" id="7716702">encoded</span><span class="op" id="7716709">)</span><span class="op" id="7716710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716713">}</span><br>
<span class="lineno"></span><span class="op" id="7716715">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7716718">func</span>&nbsp;<span class="ident" id="7716723">TestEncoderBuffering</span><span class="op" id="7716743">(</span><span class="ident" id="7716744">t</span>&nbsp;<span class="op" id="7716746">*</span><span class="ident" id="7716747">testing</span><span class="op" id="7716754">.</span><span class="ident" id="7716755">T</span><span class="op" id="7716756">)</span>&nbsp;<span class="op" id="7716758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716761">input</span>&nbsp;<span class="op" id="7716767">:=</span>&nbsp;<span class="op" id="7716770">[</span><span class="op" id="7716771">]</span><span class="builtintype" id="7716772">byte</span><span class="op" id="7716776">(</span><span class="ident" id="7716777">bigtest</span><span class="op" id="7716784">.</span><span class="ident" id="7716785">decoded</span><span class="op" id="7716792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716795">for</span>&nbsp;<span class="ident" id="7716799">bs</span>&nbsp;<span class="op" id="7716802">:=</span>&nbsp;<span class="num" id="7716805">1</span><span class="op" id="7716806">;</span>&nbsp;<span class="ident" id="7716808">bs</span>&nbsp;<span class="op" id="7716811">&lt;=</span>&nbsp;<span class="num" id="7716814">12</span><span class="op" id="7716816">;</span>&nbsp;<span class="ident" id="7716818">bs</span><span class="op" id="7716820">++</span>&nbsp;<span class="op" id="7716823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716827">bb</span>&nbsp;<span class="op" id="7716830">:=</span>&nbsp;<span class="op" id="7716833">&amp;</span><span class="ident" id="7716834">bytes</span><span class="op" id="7716839">.</span><span class="ident" id="7716840">Buffer</span><span class="op" id="7716846">{</span><span class="op" id="7716847">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716851">encoder</span>&nbsp;<span class="op" id="7716859">:=</span>&nbsp;<span class="ident" id="7716862">NewEncoder</span><span class="op" id="7716872">(</span><span class="ident" id="7716873">bb</span><span class="op" id="7716875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716879">for</span>&nbsp;<span class="ident" id="7716883">pos</span>&nbsp;<span class="op" id="7716887">:=</span>&nbsp;<span class="num" id="7716890">0</span><span class="op" id="7716891">;</span>&nbsp;<span class="ident" id="7716893">pos</span>&nbsp;<span class="op" id="7716897">&lt;</span>&nbsp;<span class="builtinfunc" id="7716899">len</span><span class="op" id="7716902">(</span><span class="ident" id="7716903">input</span><span class="op" id="7716908">)</span><span class="op" id="7716909">;</span>&nbsp;<span class="ident" id="7716911">pos</span>&nbsp;<span class="op" id="7716915">+=</span>&nbsp;<span class="ident" id="7716918">bs</span>&nbsp;<span class="op" id="7716921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716926">end</span>&nbsp;<span class="op" id="7716930">:=</span>&nbsp;<span class="ident" id="7716933">pos</span>&nbsp;<span class="op" id="7716937">+</span>&nbsp;<span class="ident" id="7716939">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7716945">if</span>&nbsp;<span class="ident" id="7716948">end</span>&nbsp;<span class="op" id="7716952">&gt;</span>&nbsp;<span class="builtinfunc" id="7716954">len</span><span class="op" id="7716957">(</span><span class="ident" id="7716958">input</span><span class="op" id="7716963">)</span>&nbsp;<span class="op" id="7716965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716971">end</span>&nbsp;<span class="op" id="7716975">=</span>&nbsp;<span class="builtinfunc" id="7716977">len</span><span class="op" id="7716980">(</span><span class="ident" id="7716981">input</span><span class="op" id="7716986">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7716991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7716996">n</span><span class="op" id="7716997">,</span>&nbsp;<span class="ident" id="7716999">err</span>&nbsp;<span class="op" id="7717003">:=</span>&nbsp;<span class="ident" id="7717006">encoder</span><span class="op" id="7717013">.</span><span class="ident" id="7717014">Write</span><span class="op" id="7717019">(</span><span class="ident" id="7717020">input</span><span class="op" id="7717025">[</span><span class="ident" id="7717026">pos</span><span class="op" id="7717029">:</span><span class="ident" id="7717030">end</span><span class="op" id="7717033">]</span><span class="op" id="7717034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717039">testEqual</span><span class="op" id="7717048">(</span><span class="ident" id="7717049">t</span><span class="op" id="7717050">,</span>&nbsp;<span class="string" id="7717052">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7717086">,</span>&nbsp;<span class="ident" id="7717088">input</span><span class="op" id="7717093">[</span><span class="ident" id="7717094">pos</span><span class="op" id="7717097">:</span><span class="ident" id="7717098">end</span><span class="op" id="7717101">]</span><span class="op" id="7717102">,</span>&nbsp;<span class="ident" id="7717104">err</span><span class="op" id="7717107">,</span>&nbsp;<span class="builtintype" id="7717109">error</span><span class="op" id="7717114">(</span><span class="ident" id="7717115">nil</span><span class="op" id="7717118">)</span><span class="op" id="7717119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717124">testEqual</span><span class="op" id="7717133">(</span><span class="ident" id="7717134">t</span><span class="op" id="7717135">,</span>&nbsp;<span class="string" id="7717137">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7717172">,</span>&nbsp;<span class="ident" id="7717174">input</span><span class="op" id="7717179">[</span><span class="ident" id="7717180">pos</span><span class="op" id="7717183">:</span><span class="ident" id="7717184">end</span><span class="op" id="7717187">]</span><span class="op" id="7717188">,</span>&nbsp;<span class="ident" id="7717190">n</span><span class="op" id="7717191">,</span>&nbsp;<span class="ident" id="7717193">end</span><span class="op" id="7717196">-</span><span class="ident" id="7717197">pos</span><span class="op" id="7717200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7717204">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717208">err</span>&nbsp;<span class="op" id="7717212">:=</span>&nbsp;<span class="ident" id="7717215">encoder</span><span class="op" id="7717222">.</span><span class="ident" id="7717223">Close</span><span class="op" id="7717228">(</span><span class="op" id="7717229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717233">testEqual</span><span class="op" id="7717242">(</span><span class="ident" id="7717243">t</span><span class="op" id="7717244">,</span>&nbsp;<span class="string" id="7717246">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7717276">,</span>&nbsp;<span class="ident" id="7717278">err</span><span class="op" id="7717281">,</span>&nbsp;<span class="builtintype" id="7717283">error</span><span class="op" id="7717288">(</span><span class="ident" id="7717289">nil</span><span class="op" id="7717292">)</span><span class="op" id="7717293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717297">testEqual</span><span class="op" id="7717306">(</span><span class="ident" id="7717307">t</span><span class="op" id="7717308">,</span>&nbsp;<span class="string" id="7717310">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7717343">,</span>&nbsp;<span class="ident" id="7717345">bs</span><span class="op" id="7717347">,</span>&nbsp;<span class="ident" id="7717349">bigtest</span><span class="op" id="7717356">.</span><span class="ident" id="7717357">decoded</span><span class="op" id="7717364">,</span>&nbsp;<span class="ident" id="7717366">strip85</span><span class="op" id="7717373">(</span><span class="ident" id="7717374">bb</span><span class="op" id="7717376">.</span><span class="ident" id="7717377">String</span><span class="op" id="7717383">(</span><span class="op" id="7717384">)</span><span class="op" id="7717385">)</span><span class="op" id="7717386">,</span>&nbsp;<span class="ident" id="7717388">strip85</span><span class="op" id="7717395">(</span><span class="ident" id="7717396">bigtest</span><span class="op" id="7717403">.</span><span class="ident" id="7717404">encoded</span><span class="op" id="7717411">)</span><span class="op" id="7717412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7717415">}</span><br>
<span class="lineno"></span><span class="op" id="7717417">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7717420">func</span>&nbsp;<span class="ident" id="7717425">TestDecode</span><span class="op" id="7717435">(</span><span class="ident" id="7717436">t</span>&nbsp;<span class="op" id="7717438">*</span><span class="ident" id="7717439">testing</span><span class="op" id="7717446">.</span><span class="ident" id="7717447">T</span><span class="op" id="7717448">)</span>&nbsp;<span class="op" id="7717450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7717453">for</span>&nbsp;<span class="ident" id="7717457">_</span><span class="op" id="7717458">,</span>&nbsp;<span class="ident" id="7717460">p</span>&nbsp;<span class="op" id="7717462">:=</span>&nbsp;<span class="keyword" id="7717465">range</span>&nbsp;<span class="ident" id="7717471">pairs</span>&nbsp;<span class="op" id="7717477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717481">dbuf</span>&nbsp;<span class="op" id="7717486">:=</span>&nbsp;<span class="builtinfunc" id="7717489">make</span><span class="op" id="7717493">(</span><span class="op" id="7717494">[</span><span class="op" id="7717495">]</span><span class="builtintype" id="7717496">byte</span><span class="op" id="7717500">,</span>&nbsp;<span class="num" id="7717502">4</span><span class="op" id="7717503">*</span><span class="builtinfunc" id="7717504">len</span><span class="op" id="7717507">(</span><span class="ident" id="7717508">p</span><span class="op" id="7717509">.</span><span class="ident" id="7717510">encoded</span><span class="op" id="7717517">)</span><span class="op" id="7717518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717522">ndst</span><span class="op" id="7717526">,</span>&nbsp;<span class="ident" id="7717528">nsrc</span><span class="op" id="7717532">,</span>&nbsp;<span class="ident" id="7717534">err</span>&nbsp;<span class="op" id="7717538">:=</span>&nbsp;<span class="ident" id="7717541">Decode</span><span class="op" id="7717547">(</span><span class="ident" id="7717548">dbuf</span><span class="op" id="7717552">,</span>&nbsp;<span class="op" id="7717554">[</span><span class="op" id="7717555">]</span><span class="builtintype" id="7717556">byte</span><span class="op" id="7717560">(</span><span class="ident" id="7717561">p</span><span class="op" id="7717562">.</span><span class="ident" id="7717563">encoded</span><span class="op" id="7717570">)</span><span class="op" id="7717571">,</span>&nbsp;<span class="builtintype" id="7717573">true</span><span class="op" id="7717577">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717581">testEqual</span><span class="op" id="7717590">(</span><span class="ident" id="7717591">t</span><span class="op" id="7717592">,</span>&nbsp;<span class="string" id="7717594">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7717626">,</span>&nbsp;<span class="ident" id="7717628">p</span><span class="op" id="7717629">.</span><span class="ident" id="7717630">encoded</span><span class="op" id="7717637">,</span>&nbsp;<span class="ident" id="7717639">err</span><span class="op" id="7717642">,</span>&nbsp;<span class="builtintype" id="7717644">error</span><span class="op" id="7717649">(</span><span class="ident" id="7717650">nil</span><span class="op" id="7717653">)</span><span class="op" id="7717654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717658">testEqual</span><span class="op" id="7717667">(</span><span class="ident" id="7717668">t</span><span class="op" id="7717669">,</span>&nbsp;<span class="string" id="7717671">&#34;Decode(%q)&nbsp;=&nbsp;nsrc&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7717702">,</span>&nbsp;<span class="ident" id="7717704">p</span><span class="op" id="7717705">.</span><span class="ident" id="7717706">encoded</span><span class="op" id="7717713">,</span>&nbsp;<span class="ident" id="7717715">nsrc</span><span class="op" id="7717719">,</span>&nbsp;<span class="builtinfunc" id="7717721">len</span><span class="op" id="7717724">(</span><span class="ident" id="7717725">p</span><span class="op" id="7717726">.</span><span class="ident" id="7717727">encoded</span><span class="op" id="7717734">)</span><span class="op" id="7717735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717739">testEqual</span><span class="op" id="7717748">(</span><span class="ident" id="7717749">t</span><span class="op" id="7717750">,</span>&nbsp;<span class="string" id="7717752">&#34;Decode(%q)&nbsp;=&nbsp;ndst&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7717783">,</span>&nbsp;<span class="ident" id="7717785">p</span><span class="op" id="7717786">.</span><span class="ident" id="7717787">encoded</span><span class="op" id="7717794">,</span>&nbsp;<span class="ident" id="7717796">ndst</span><span class="op" id="7717800">,</span>&nbsp;<span class="builtinfunc" id="7717802">len</span><span class="op" id="7717805">(</span><span class="ident" id="7717806">p</span><span class="op" id="7717807">.</span><span class="ident" id="7717808">decoded</span><span class="op" id="7717815">)</span><span class="op" id="7717816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717820">testEqual</span><span class="op" id="7717829">(</span><span class="ident" id="7717830">t</span><span class="op" id="7717831">,</span>&nbsp;<span class="string" id="7717833">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7717859">,</span>&nbsp;<span class="ident" id="7717861">p</span><span class="op" id="7717862">.</span><span class="ident" id="7717863">encoded</span><span class="op" id="7717870">,</span>&nbsp;<span class="builtintype" id="7717872">string</span><span class="op" id="7717878">(</span><span class="ident" id="7717879">dbuf</span><span class="op" id="7717883">[</span><span class="num" id="7717884">0</span><span class="op" id="7717885">:</span><span class="ident" id="7717886">ndst</span><span class="op" id="7717890">]</span><span class="op" id="7717891">)</span><span class="op" id="7717892">,</span>&nbsp;<span class="ident" id="7717894">p</span><span class="op" id="7717895">.</span><span class="ident" id="7717896">decoded</span><span class="op" id="7717903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7717906">}</span><br>
<span class="lineno">115</span><span class="op" id="7717908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7717911">func</span>&nbsp;<span class="ident" id="7717916">TestDecoder</span><span class="op" id="7717927">(</span><span class="ident" id="7717928">t</span>&nbsp;<span class="op" id="7717930">*</span><span class="ident" id="7717931">testing</span><span class="op" id="7717938">.</span><span class="ident" id="7717939">T</span><span class="op" id="7717940">)</span>&nbsp;<span class="op" id="7717942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7717945">for</span>&nbsp;<span class="ident" id="7717949">_</span><span class="op" id="7717950">,</span>&nbsp;<span class="ident" id="7717952">p</span>&nbsp;<span class="op" id="7717954">:=</span>&nbsp;<span class="keyword" id="7717957">range</span>&nbsp;<span class="ident" id="7717963">pairs</span>&nbsp;<span class="op" id="7717969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7717973">decoder</span>&nbsp;<span class="op" id="7717981">:=</span>&nbsp;<span class="ident" id="7717984">NewDecoder</span><span class="op" id="7717994">(</span><span class="ident" id="7717995">strings</span><span class="op" id="7718002">.</span><span class="ident" id="7718003">NewReader</span><span class="op" id="7718012">(</span><span class="ident" id="7718013">p</span><span class="op" id="7718014">.</span><span class="ident" id="7718015">encoded</span><span class="op" id="7718022">)</span><span class="op" id="7718023">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718027">dbuf</span><span class="op" id="7718031">,</span>&nbsp;<span class="ident" id="7718033">err</span>&nbsp;<span class="op" id="7718037">:=</span>&nbsp;<span class="ident" id="7718040">ioutil</span><span class="op" id="7718046">.</span><span class="ident" id="7718047">ReadAll</span><span class="op" id="7718054">(</span><span class="ident" id="7718055">decoder</span><span class="op" id="7718062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718066">if</span>&nbsp;<span class="ident" id="7718069">err</span>&nbsp;<span class="op" id="7718073">!=</span>&nbsp;<span class="ident" id="7718076">nil</span>&nbsp;<span class="op" id="7718080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718085">t</span><span class="op" id="7718086">.</span><span class="ident" id="7718087">Fatal</span><span class="op" id="7718092">(</span><span class="string" id="7718093">&#34;Read&nbsp;failed&#34;</span><span class="op" id="7718106">,</span>&nbsp;<span class="ident" id="7718108">err</span><span class="op" id="7718111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718119">testEqual</span><span class="op" id="7718128">(</span><span class="ident" id="7718129">t</span><span class="op" id="7718130">,</span>&nbsp;<span class="string" id="7718132">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7718167">,</span>&nbsp;<span class="ident" id="7718169">p</span><span class="op" id="7718170">.</span><span class="ident" id="7718171">encoded</span><span class="op" id="7718178">,</span>&nbsp;<span class="builtinfunc" id="7718180">len</span><span class="op" id="7718183">(</span><span class="ident" id="7718184">dbuf</span><span class="op" id="7718188">)</span><span class="op" id="7718189">,</span>&nbsp;<span class="builtinfunc" id="7718191">len</span><span class="op" id="7718194">(</span><span class="ident" id="7718195">p</span><span class="op" id="7718196">.</span><span class="ident" id="7718197">decoded</span><span class="op" id="7718204">)</span><span class="op" id="7718205">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718209">testEqual</span><span class="op" id="7718218">(</span><span class="ident" id="7718219">t</span><span class="op" id="7718220">,</span>&nbsp;<span class="string" id="7718222">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7718252">,</span>&nbsp;<span class="ident" id="7718254">p</span><span class="op" id="7718255">.</span><span class="ident" id="7718256">encoded</span><span class="op" id="7718263">,</span>&nbsp;<span class="builtintype" id="7718265">string</span><span class="op" id="7718271">(</span><span class="ident" id="7718272">dbuf</span><span class="op" id="7718276">)</span><span class="op" id="7718277">,</span>&nbsp;<span class="ident" id="7718279">p</span><span class="op" id="7718280">.</span><span class="ident" id="7718281">decoded</span><span class="op" id="7718288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718292">if</span>&nbsp;<span class="ident" id="7718295">err</span>&nbsp;<span class="op" id="7718299">!=</span>&nbsp;<span class="ident" id="7718302">nil</span>&nbsp;<span class="op" id="7718306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718311">testEqual</span><span class="op" id="7718320">(</span><span class="ident" id="7718321">t</span><span class="op" id="7718322">,</span>&nbsp;<span class="string" id="7718324">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7718352">,</span>&nbsp;<span class="ident" id="7718354">p</span><span class="op" id="7718355">.</span><span class="ident" id="7718356">encoded</span><span class="op" id="7718363">,</span>&nbsp;<span class="ident" id="7718365">err</span><span class="op" id="7718368">,</span>&nbsp;<span class="ident" id="7718370">io</span><span class="op" id="7718372">.</span><span class="ident" id="7718373">EOF</span><span class="op" id="7718376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718383">}</span><br>
<span class="lineno">130</span><span class="op" id="7718385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7718388">func</span>&nbsp;<span class="ident" id="7718393">TestDecoderBuffering</span><span class="op" id="7718413">(</span><span class="ident" id="7718414">t</span>&nbsp;<span class="op" id="7718416">*</span><span class="ident" id="7718417">testing</span><span class="op" id="7718424">.</span><span class="ident" id="7718425">T</span><span class="op" id="7718426">)</span>&nbsp;<span class="op" id="7718428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718431">for</span>&nbsp;<span class="ident" id="7718435">bs</span>&nbsp;<span class="op" id="7718438">:=</span>&nbsp;<span class="num" id="7718441">1</span><span class="op" id="7718442">;</span>&nbsp;<span class="ident" id="7718444">bs</span>&nbsp;<span class="op" id="7718447">&lt;=</span>&nbsp;<span class="num" id="7718450">12</span><span class="op" id="7718452">;</span>&nbsp;<span class="ident" id="7718454">bs</span><span class="op" id="7718456">++</span>&nbsp;<span class="op" id="7718459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718463">decoder</span>&nbsp;<span class="op" id="7718471">:=</span>&nbsp;<span class="ident" id="7718474">NewDecoder</span><span class="op" id="7718484">(</span><span class="ident" id="7718485">strings</span><span class="op" id="7718492">.</span><span class="ident" id="7718493">NewReader</span><span class="op" id="7718502">(</span><span class="ident" id="7718503">bigtest</span><span class="op" id="7718510">.</span><span class="ident" id="7718511">encoded</span><span class="op" id="7718518">)</span><span class="op" id="7718519">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718523">buf</span>&nbsp;<span class="op" id="7718527">:=</span>&nbsp;<span class="builtinfunc" id="7718530">make</span><span class="op" id="7718534">(</span><span class="op" id="7718535">[</span><span class="op" id="7718536">]</span><span class="builtintype" id="7718537">byte</span><span class="op" id="7718541">,</span>&nbsp;<span class="builtinfunc" id="7718543">len</span><span class="op" id="7718546">(</span><span class="ident" id="7718547">bigtest</span><span class="op" id="7718554">.</span><span class="ident" id="7718555">decoded</span><span class="op" id="7718562">)</span><span class="op" id="7718563">+</span><span class="num" id="7718564">12</span><span class="op" id="7718566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718570">var</span>&nbsp;<span class="ident" id="7718574">total</span>&nbsp;<span class="builtintype" id="7718580">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718586">for</span>&nbsp;<span class="ident" id="7718590">total</span>&nbsp;<span class="op" id="7718596">=</span>&nbsp;<span class="num" id="7718598">0</span><span class="op" id="7718599">;</span>&nbsp;<span class="ident" id="7718601">total</span>&nbsp;<span class="op" id="7718607">&lt;</span>&nbsp;<span class="builtinfunc" id="7718609">len</span><span class="op" id="7718612">(</span><span class="ident" id="7718613">bigtest</span><span class="op" id="7718620">.</span><span class="ident" id="7718621">decoded</span><span class="op" id="7718628">)</span><span class="op" id="7718629">;</span>&nbsp;<span class="op" id="7718631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718636">n</span><span class="op" id="7718637">,</span>&nbsp;<span class="ident" id="7718639">err</span>&nbsp;<span class="op" id="7718643">:=</span>&nbsp;<span class="ident" id="7718646">decoder</span><span class="op" id="7718653">.</span><span class="ident" id="7718654">Read</span><span class="op" id="7718658">(</span><span class="ident" id="7718659">buf</span><span class="op" id="7718662">[</span><span class="ident" id="7718663">total</span>&nbsp;<span class="op" id="7718669">:</span>&nbsp;<span class="ident" id="7718671">total</span><span class="op" id="7718676">+</span><span class="ident" id="7718677">bs</span><span class="op" id="7718679">]</span><span class="op" id="7718680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718685">testEqual</span><span class="op" id="7718694">(</span><span class="ident" id="7718695">t</span><span class="op" id="7718696">,</span>&nbsp;<span class="string" id="7718698">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7718743">,</span>&nbsp;<span class="ident" id="7718745">bigtest</span><span class="op" id="7718752">.</span><span class="ident" id="7718753">encoded</span><span class="op" id="7718760">,</span>&nbsp;<span class="ident" id="7718762">total</span><span class="op" id="7718767">,</span>&nbsp;<span class="ident" id="7718769">n</span><span class="op" id="7718770">,</span>&nbsp;<span class="ident" id="7718772">err</span><span class="op" id="7718775">,</span>&nbsp;<span class="builtintype" id="7718777">error</span><span class="op" id="7718782">(</span><span class="ident" id="7718783">nil</span><span class="op" id="7718786">)</span><span class="op" id="7718787">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718792">total</span>&nbsp;<span class="op" id="7718798">+=</span>&nbsp;<span class="ident" id="7718801">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718809">testEqual</span><span class="op" id="7718818">(</span><span class="ident" id="7718819">t</span><span class="op" id="7718820">,</span>&nbsp;<span class="string" id="7718822">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7718855">,</span>&nbsp;<span class="ident" id="7718857">bs</span><span class="op" id="7718859">,</span>&nbsp;<span class="ident" id="7718861">bigtest</span><span class="op" id="7718868">.</span><span class="ident" id="7718869">encoded</span><span class="op" id="7718876">,</span>&nbsp;<span class="builtintype" id="7718878">string</span><span class="op" id="7718884">(</span><span class="ident" id="7718885">buf</span><span class="op" id="7718888">[</span><span class="num" id="7718889">0</span><span class="op" id="7718890">:</span><span class="ident" id="7718891">total</span><span class="op" id="7718896">]</span><span class="op" id="7718897">)</span><span class="op" id="7718898">,</span>&nbsp;<span class="ident" id="7718900">bigtest</span><span class="op" id="7718907">.</span><span class="ident" id="7718908">decoded</span><span class="op" id="7718915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7718918">}</span><br>
<span class="lineno"></span><span class="op" id="7718920">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="7718923">func</span>&nbsp;<span class="ident" id="7718928">TestDecodeCorrupt</span><span class="op" id="7718945">(</span><span class="ident" id="7718946">t</span>&nbsp;<span class="op" id="7718948">*</span><span class="ident" id="7718949">testing</span><span class="op" id="7718956">.</span><span class="ident" id="7718957">T</span><span class="op" id="7718958">)</span>&nbsp;<span class="op" id="7718960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7718963">type</span>&nbsp;<span class="ident" id="7718968">corrupt</span>&nbsp;<span class="keyword" id="7718976">struct</span>&nbsp;<span class="op" id="7718983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718987">e</span>&nbsp;<span class="builtintype" id="7718989">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7718998">p</span>&nbsp;<span class="builtintype" id="7719000">int</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719008">examples</span>&nbsp;<span class="op" id="7719017">:=</span>&nbsp;<span class="op" id="7719020">[</span><span class="op" id="7719021">]</span><span class="ident" id="7719022">corrupt</span><span class="op" id="7719029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719033">{</span><span class="string" id="7719034">&#34;v&#34;</span><span class="op" id="7719037">,</span>&nbsp;<span class="num" id="7719039">0</span><span class="op" id="7719040">}</span><span class="op" id="7719041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719045">{</span><span class="string" id="7719046">&#34;!z!!!!!!!!!&#34;</span><span class="op" id="7719059">,</span>&nbsp;<span class="num" id="7719061">1</span><span class="op" id="7719062">}</span><span class="op" id="7719063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719066">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719070">for</span>&nbsp;<span class="ident" id="7719074">_</span><span class="op" id="7719075">,</span>&nbsp;<span class="ident" id="7719077">e</span>&nbsp;<span class="op" id="7719079">:=</span>&nbsp;<span class="keyword" id="7719082">range</span>&nbsp;<span class="ident" id="7719088">examples</span>&nbsp;<span class="op" id="7719097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719101">dbuf</span>&nbsp;<span class="op" id="7719106">:=</span>&nbsp;<span class="builtinfunc" id="7719109">make</span><span class="op" id="7719113">(</span><span class="op" id="7719114">[</span><span class="op" id="7719115">]</span><span class="builtintype" id="7719116">byte</span><span class="op" id="7719120">,</span>&nbsp;<span class="num" id="7719122">4</span><span class="op" id="7719123">*</span><span class="builtinfunc" id="7719124">len</span><span class="op" id="7719127">(</span><span class="ident" id="7719128">e</span><span class="op" id="7719129">.</span><span class="ident" id="7719130">e</span><span class="op" id="7719131">)</span><span class="op" id="7719132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719136">_</span><span class="op" id="7719137">,</span>&nbsp;<span class="ident" id="7719139">_</span><span class="op" id="7719140">,</span>&nbsp;<span class="ident" id="7719142">err</span>&nbsp;<span class="op" id="7719146">:=</span>&nbsp;<span class="ident" id="7719149">Decode</span><span class="op" id="7719155">(</span><span class="ident" id="7719156">dbuf</span><span class="op" id="7719160">,</span>&nbsp;<span class="op" id="7719162">[</span><span class="op" id="7719163">]</span><span class="builtintype" id="7719164">byte</span><span class="op" id="7719168">(</span><span class="ident" id="7719169">e</span><span class="op" id="7719170">.</span><span class="ident" id="7719171">e</span><span class="op" id="7719172">)</span><span class="op" id="7719173">,</span>&nbsp;<span class="builtintype" id="7719175">true</span><span class="op" id="7719179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719183">switch</span>&nbsp;<span class="ident" id="7719190">err</span>&nbsp;<span class="op" id="7719194">:=</span>&nbsp;<span class="ident" id="7719197">err</span><span class="op" id="7719200">.</span><span class="op" id="7719201">(</span><span class="keyword" id="7719202">type</span><span class="op" id="7719206">)</span>&nbsp;<span class="op" id="7719208">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719212">case</span>&nbsp;<span class="ident" id="7719217">CorruptInputError</span><span class="op" id="7719234">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719239">testEqual</span><span class="op" id="7719248">(</span><span class="ident" id="7719249">t</span><span class="op" id="7719250">,</span>&nbsp;<span class="string" id="7719252">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7719292">,</span>&nbsp;<span class="ident" id="7719294">e</span><span class="op" id="7719295">.</span><span class="ident" id="7719296">e</span><span class="op" id="7719297">,</span>&nbsp;<span class="builtintype" id="7719299">int</span><span class="op" id="7719302">(</span><span class="ident" id="7719303">err</span><span class="op" id="7719306">)</span><span class="op" id="7719307">,</span>&nbsp;<span class="ident" id="7719309">e</span><span class="op" id="7719310">.</span><span class="ident" id="7719311">p</span><span class="op" id="7719312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719316">default</span><span class="op" id="7719323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719328">t</span><span class="op" id="7719329">.</span><span class="ident" id="7719330">Error</span><span class="op" id="7719335">(</span><span class="string" id="7719336">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="7719376">,</span>&nbsp;<span class="ident" id="7719378">e</span><span class="op" id="7719379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719383">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719386">}</span><br>
<span class="lineno"></span><span class="op" id="7719388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7719391">func</span>&nbsp;<span class="ident" id="7719396">TestBig</span><span class="op" id="7719403">(</span><span class="ident" id="7719404">t</span>&nbsp;<span class="op" id="7719406">*</span><span class="ident" id="7719407">testing</span><span class="op" id="7719414">.</span><span class="ident" id="7719415">T</span><span class="op" id="7719416">)</span>&nbsp;<span class="op" id="7719418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719421">n</span>&nbsp;<span class="op" id="7719423">:=</span>&nbsp;<span class="num" id="7719426">3</span><span class="op" id="7719427">*</span><span class="num" id="7719428">1000</span>&nbsp;<span class="op" id="7719433">+</span>&nbsp;<span class="num" id="7719435">1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719438">raw</span>&nbsp;<span class="op" id="7719442">:=</span>&nbsp;<span class="builtinfunc" id="7719445">make</span><span class="op" id="7719449">(</span><span class="op" id="7719450">[</span><span class="op" id="7719451">]</span><span class="builtintype" id="7719452">byte</span><span class="op" id="7719456">,</span>&nbsp;<span class="ident" id="7719458">n</span><span class="op" id="7719459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719462">const</span>&nbsp;<span class="ident" id="7719468">alpha</span>&nbsp;<span class="op" id="7719474">=</span>&nbsp;<span class="string" id="7719476">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719542">for</span>&nbsp;<span class="ident" id="7719546">i</span>&nbsp;<span class="op" id="7719548">:=</span>&nbsp;<span class="num" id="7719551">0</span><span class="op" id="7719552">;</span>&nbsp;<span class="ident" id="7719554">i</span>&nbsp;<span class="op" id="7719556">&lt;</span>&nbsp;<span class="ident" id="7719558">n</span><span class="op" id="7719559">;</span>&nbsp;<span class="ident" id="7719561">i</span><span class="op" id="7719562">++</span>&nbsp;<span class="op" id="7719565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719569">raw</span><span class="op" id="7719572">[</span><span class="ident" id="7719573">i</span><span class="op" id="7719574">]</span>&nbsp;<span class="op" id="7719576">=</span>&nbsp;<span class="ident" id="7719578">alpha</span><span class="op" id="7719583">[</span><span class="ident" id="7719584">i</span><span class="op" id="7719585">%</span><span class="builtinfunc" id="7719586">len</span><span class="op" id="7719589">(</span><span class="ident" id="7719590">alpha</span><span class="op" id="7719595">)</span><span class="op" id="7719596">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719599">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719602">encoded</span>&nbsp;<span class="op" id="7719610">:=</span>&nbsp;<span class="builtinfunc" id="7719613">new</span><span class="op" id="7719616">(</span><span class="ident" id="7719617">bytes</span><span class="op" id="7719622">.</span><span class="ident" id="7719623">Buffer</span><span class="op" id="7719629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719632">w</span>&nbsp;<span class="op" id="7719634">:=</span>&nbsp;<span class="ident" id="7719637">NewEncoder</span><span class="op" id="7719647">(</span><span class="ident" id="7719648">encoded</span><span class="op" id="7719655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719658">nn</span><span class="op" id="7719660">,</span>&nbsp;<span class="ident" id="7719662">err</span>&nbsp;<span class="op" id="7719666">:=</span>&nbsp;<span class="ident" id="7719669">w</span><span class="op" id="7719670">.</span><span class="ident" id="7719671">Write</span><span class="op" id="7719676">(</span><span class="ident" id="7719677">raw</span><span class="op" id="7719680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719683">if</span>&nbsp;<span class="ident" id="7719686">nn</span>&nbsp;<span class="op" id="7719689">!=</span>&nbsp;<span class="ident" id="7719692">n</span>&nbsp;<span class="op" id="7719694">||</span>&nbsp;<span class="ident" id="7719697">err</span>&nbsp;<span class="op" id="7719701">!=</span>&nbsp;<span class="ident" id="7719704">nil</span>&nbsp;<span class="op" id="7719708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719712">t</span><span class="op" id="7719713">.</span><span class="ident" id="7719714">Fatalf</span><span class="op" id="7719720">(</span><span class="string" id="7719721">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7719763">,</span>&nbsp;<span class="ident" id="7719765">nn</span><span class="op" id="7719767">,</span>&nbsp;<span class="ident" id="7719769">err</span><span class="op" id="7719772">,</span>&nbsp;<span class="ident" id="7719774">n</span><span class="op" id="7719775">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719781">err</span>&nbsp;<span class="op" id="7719785">=</span>&nbsp;<span class="ident" id="7719787">w</span><span class="op" id="7719788">.</span><span class="ident" id="7719789">Close</span><span class="op" id="7719794">(</span><span class="op" id="7719795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719798">if</span>&nbsp;<span class="ident" id="7719801">err</span>&nbsp;<span class="op" id="7719805">!=</span>&nbsp;<span class="ident" id="7719808">nil</span>&nbsp;<span class="op" id="7719812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719816">t</span><span class="op" id="7719817">.</span><span class="ident" id="7719818">Fatalf</span><span class="op" id="7719824">(</span><span class="string" id="7719825">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="7719856">,</span>&nbsp;<span class="ident" id="7719858">err</span><span class="op" id="7719861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719864">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719867">decoded</span><span class="op" id="7719874">,</span>&nbsp;<span class="ident" id="7719876">err</span>&nbsp;<span class="op" id="7719880">:=</span>&nbsp;<span class="ident" id="7719883">ioutil</span><span class="op" id="7719889">.</span><span class="ident" id="7719890">ReadAll</span><span class="op" id="7719897">(</span><span class="ident" id="7719898">NewDecoder</span><span class="op" id="7719908">(</span><span class="ident" id="7719909">encoded</span><span class="op" id="7719916">)</span><span class="op" id="7719917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719920">if</span>&nbsp;<span class="ident" id="7719923">err</span>&nbsp;<span class="op" id="7719927">!=</span>&nbsp;<span class="ident" id="7719930">nil</span>&nbsp;<span class="op" id="7719934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7719938">t</span><span class="op" id="7719939">.</span><span class="ident" id="7719940">Fatalf</span><span class="op" id="7719946">(</span><span class="string" id="7719947">&#34;io.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="7719980">,</span>&nbsp;<span class="ident" id="7719982">err</span><span class="op" id="7719985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7719988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7719992">if</span>&nbsp;<span class="op" id="7719995">!</span><span class="ident" id="7719996">bytes</span><span class="op" id="7720001">.</span><span class="ident" id="7720002">Equal</span><span class="op" id="7720007">(</span><span class="ident" id="7720008">raw</span><span class="op" id="7720011">,</span>&nbsp;<span class="ident" id="7720013">decoded</span><span class="op" id="7720020">)</span>&nbsp;<span class="op" id="7720022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720026">var</span>&nbsp;<span class="ident" id="7720030">i</span>&nbsp;<span class="builtintype" id="7720032">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720038">for</span>&nbsp;<span class="ident" id="7720042">i</span>&nbsp;<span class="op" id="7720044">=</span>&nbsp;<span class="num" id="7720046">0</span><span class="op" id="7720047">;</span>&nbsp;<span class="ident" id="7720049">i</span>&nbsp;<span class="op" id="7720051">&lt;</span>&nbsp;<span class="builtinfunc" id="7720053">len</span><span class="op" id="7720056">(</span><span class="ident" id="7720057">decoded</span><span class="op" id="7720064">)</span>&nbsp;<span class="op" id="7720066">&amp;&amp;</span>&nbsp;<span class="ident" id="7720069">i</span>&nbsp;<span class="op" id="7720071">&lt;</span>&nbsp;<span class="builtinfunc" id="7720073">len</span><span class="op" id="7720076">(</span><span class="ident" id="7720077">raw</span><span class="op" id="7720080">)</span><span class="op" id="7720081">;</span>&nbsp;<span class="ident" id="7720083">i</span><span class="op" id="7720084">++</span>&nbsp;<span class="op" id="7720087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720092">if</span>&nbsp;<span class="ident" id="7720095">decoded</span><span class="op" id="7720102">[</span><span class="ident" id="7720103">i</span><span class="op" id="7720104">]</span>&nbsp;<span class="op" id="7720106">!=</span>&nbsp;<span class="ident" id="7720109">raw</span><span class="op" id="7720112">[</span><span class="ident" id="7720113">i</span><span class="op" id="7720114">]</span>&nbsp;<span class="op" id="7720116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720122">break</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720139">t</span><span class="op" id="7720140">.</span><span class="ident" id="7720141">Errorf</span><span class="op" id="7720147">(</span><span class="string" id="7720148">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="7720200">,</span>&nbsp;<span class="ident" id="7720202">n</span><span class="op" id="7720203">,</span>&nbsp;<span class="ident" id="7720205">i</span><span class="op" id="7720206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720209">}</span><br>
<span class="lineno"></span><span class="op" id="7720211">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="7720214">func</span>&nbsp;<span class="ident" id="7720219">TestDecoderInternalWhitespace</span><span class="op" id="7720248">(</span><span class="ident" id="7720249">t</span>&nbsp;<span class="op" id="7720251">*</span><span class="ident" id="7720252">testing</span><span class="op" id="7720259">.</span><span class="ident" id="7720260">T</span><span class="op" id="7720261">)</span>&nbsp;<span class="op" id="7720263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720266">s</span>&nbsp;<span class="op" id="7720268">:=</span>&nbsp;<span class="ident" id="7720271">strings</span><span class="op" id="7720278">.</span><span class="ident" id="7720279">Repeat</span><span class="op" id="7720285">(</span><span class="string" id="7720286">&#34;&nbsp;&#34;</span><span class="op" id="7720289">,</span>&nbsp;<span class="num" id="7720291">2048</span><span class="op" id="7720295">)</span>&nbsp;<span class="op" id="7720297">+</span>&nbsp;<span class="string" id="7720299">&#34;z&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720304">decoded</span><span class="op" id="7720311">,</span>&nbsp;<span class="ident" id="7720313">err</span>&nbsp;<span class="op" id="7720317">:=</span>&nbsp;<span class="ident" id="7720320">ioutil</span><span class="op" id="7720326">.</span><span class="ident" id="7720327">ReadAll</span><span class="op" id="7720334">(</span><span class="ident" id="7720335">NewDecoder</span><span class="op" id="7720345">(</span><span class="ident" id="7720346">strings</span><span class="op" id="7720353">.</span><span class="ident" id="7720354">NewReader</span><span class="op" id="7720363">(</span><span class="ident" id="7720364">s</span><span class="op" id="7720365">)</span><span class="op" id="7720366">)</span><span class="op" id="7720367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720370">if</span>&nbsp;<span class="ident" id="7720373">err</span>&nbsp;<span class="op" id="7720377">!=</span>&nbsp;<span class="ident" id="7720380">nil</span>&nbsp;<span class="op" id="7720384">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720388">t</span><span class="op" id="7720389">.</span><span class="ident" id="7720390">Errorf</span><span class="op" id="7720396">(</span><span class="string" id="7720397">&#34;Decode&nbsp;gave&nbsp;error&nbsp;%v&#34;</span><span class="op" id="7720419">,</span>&nbsp;<span class="ident" id="7720421">err</span><span class="op" id="7720424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7720430">if</span>&nbsp;<span class="ident" id="7720433">want</span>&nbsp;<span class="op" id="7720438">:=</span>&nbsp;<span class="op" id="7720441">[</span><span class="op" id="7720442">]</span><span class="builtintype" id="7720443">byte</span><span class="op" id="7720447">(</span><span class="string" id="7720448">&#34;\000\000\000\000&#34;</span><span class="op" id="7720466">)</span><span class="op" id="7720467">;</span>&nbsp;<span class="op" id="7720469">!</span><span class="ident" id="7720470">bytes</span><span class="op" id="7720475">.</span><span class="ident" id="7720476">Equal</span><span class="op" id="7720481">(</span><span class="ident" id="7720482">want</span><span class="op" id="7720486">,</span>&nbsp;<span class="ident" id="7720488">decoded</span><span class="op" id="7720495">)</span>&nbsp;<span class="op" id="7720497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7720501">t</span><span class="op" id="7720502">.</span><span class="ident" id="7720503">Errorf</span><span class="op" id="7720509">(</span><span class="string" id="7720510">&#34;Decode&nbsp;failed:&nbsp;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7720542">,</span>&nbsp;<span class="ident" id="7720544">decoded</span><span class="op" id="7720551">,</span>&nbsp;<span class="ident" id="7720553">want</span><span class="op" id="7720557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7720560">}</span><br>
<span class="lineno">210</span><span class="op" id="7720562">}</span>
</div>
</body>
</html>
