<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6298250">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6298305">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6298359">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6298410">package</span>&nbsp;<span class="ident" id="6298418">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298423">import</span>&nbsp;<span class="op" id="6298430">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298433">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298442">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298461">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298471">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298479">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298493">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6298499">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6298504">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298507">var</span>&nbsp;<span class="op" id="6298511">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298514">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298527">=</span>&nbsp;<span class="ident" id="6298529">errors</span><span class="op" id="6298535">.</span><span class="ident" id="6298536">New</span><span class="op" id="6298539">(</span><span class="string" id="6298540">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="6298567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298570">ErrAlgorithm</span>&nbsp;<span class="op" id="6298583">=</span>&nbsp;<span class="ident" id="6298585">errors</span><span class="op" id="6298591">.</span><span class="ident" id="6298592">New</span><span class="op" id="6298595">(</span><span class="string" id="6298596">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="6298636">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298639">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="6298652">=</span>&nbsp;<span class="ident" id="6298654">errors</span><span class="op" id="6298660">.</span><span class="ident" id="6298661">New</span><span class="op" id="6298664">(</span><span class="string" id="6298665">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="6298686">)</span><br>
<span class="lineno"></span><span class="op" id="6298688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298691">type</span>&nbsp;<span class="ident" id="6298696">Reader</span>&nbsp;<span class="keyword" id="6298703">struct</span>&nbsp;<span class="op" id="6298710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298713">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298721">io</span><span class="op" id="6298723">.</span><span class="ident" id="6298724">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298734">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6298742">[</span><span class="op" id="6298743">]</span><span class="op" id="6298744">*</span><span class="ident" id="6298745">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298751">Comment</span>&nbsp;<span class="builtintype" id="6298759">string</span><br>
<span class="lineno"></span><span class="op" id="6298766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298769">type</span>&nbsp;<span class="ident" id="6298774">ReadCloser</span>&nbsp;<span class="keyword" id="6298785">struct</span>&nbsp;<span class="op" id="6298792">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298795">f</span>&nbsp;<span class="op" id="6298797">*</span><span class="ident" id="6298798">os</span><span class="op" id="6298800">.</span><span class="ident" id="6298801">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298807">Reader</span><br>
<span class="lineno"></span><span class="op" id="6298814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6298817">type</span>&nbsp;<span class="ident" id="6298822">File</span>&nbsp;<span class="keyword" id="6298827">struct</span>&nbsp;<span class="op" id="6298834">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298837">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298849">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298862">io</span><span class="op" id="6298864">.</span><span class="ident" id="6298865">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298875">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6298888">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298895">headerOffset</span>&nbsp;<span class="ident" id="6298908">int64</span><br>
<span class="lineno"></span><span class="op" id="6298914">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6298917">func</span>&nbsp;<span class="op" id="6298922">(</span><span class="ident" id="6298923">f</span>&nbsp;<span class="op" id="6298925">*</span><span class="ident" id="6298926">File</span><span class="op" id="6298930">)</span>&nbsp;<span class="ident" id="6298932">hasDataDescriptor</span><span class="op" id="6298949">(</span><span class="op" id="6298950">)</span>&nbsp;<span class="builtintype" id="6298952">bool</span>&nbsp;<span class="op" id="6298957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298960">return</span>&nbsp;<span class="ident" id="6298967">f</span><span class="op" id="6298968">.</span><span class="ident" id="6298969">Flags</span><span class="op" id="6298974">&amp;</span><span class="num" id="6298975">0x8</span>&nbsp;<span class="op" id="6298979">!=</span>&nbsp;<span class="num" id="6298982">0</span><br>
<span class="lineno"></span><span class="op" id="6298984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6298987">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="6299067">func</span>&nbsp;<span class="ident" id="6299072">OpenReader</span><span class="op" id="6299082">(</span><span class="ident" id="6299083">name</span>&nbsp;<span class="builtintype" id="6299088">string</span><span class="op" id="6299094">)</span>&nbsp;<span class="op" id="6299096">(</span><span class="op" id="6299097">*</span><span class="ident" id="6299098">ReadCloser</span><span class="op" id="6299108">,</span>&nbsp;<span class="builtintype" id="6299110">error</span><span class="op" id="6299115">)</span>&nbsp;<span class="op" id="6299117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299120">f</span><span class="op" id="6299121">,</span>&nbsp;<span class="ident" id="6299123">err</span>&nbsp;<span class="op" id="6299127">:=</span>&nbsp;<span class="ident" id="6299130">os</span><span class="op" id="6299132">.</span><span class="ident" id="6299133">Open</span><span class="op" id="6299137">(</span><span class="ident" id="6299138">name</span><span class="op" id="6299142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299145">if</span>&nbsp;<span class="ident" id="6299148">err</span>&nbsp;<span class="op" id="6299152">!=</span>&nbsp;<span class="ident" id="6299155">nil</span>&nbsp;<span class="op" id="6299159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299163">return</span>&nbsp;<span class="ident" id="6299170">nil</span><span class="op" id="6299173">,</span>&nbsp;<span class="ident" id="6299175">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299183">fi</span><span class="op" id="6299185">,</span>&nbsp;<span class="ident" id="6299187">err</span>&nbsp;<span class="op" id="6299191">:=</span>&nbsp;<span class="ident" id="6299194">f</span><span class="op" id="6299195">.</span><span class="ident" id="6299196">Stat</span><span class="op" id="6299200">(</span><span class="op" id="6299201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299204">if</span>&nbsp;<span class="ident" id="6299207">err</span>&nbsp;<span class="op" id="6299211">!=</span>&nbsp;<span class="ident" id="6299214">nil</span>&nbsp;<span class="op" id="6299218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299222">f</span><span class="op" id="6299223">.</span><span class="ident" id="6299224">Close</span><span class="op" id="6299229">(</span><span class="op" id="6299230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299234">return</span>&nbsp;<span class="ident" id="6299241">nil</span><span class="op" id="6299244">,</span>&nbsp;<span class="ident" id="6299246">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299254">r</span>&nbsp;<span class="op" id="6299256">:=</span>&nbsp;<span class="builtinfunc" id="6299259">new</span><span class="op" id="6299262">(</span><span class="ident" id="6299263">ReadCloser</span><span class="op" id="6299273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299276">if</span>&nbsp;<span class="ident" id="6299279">err</span>&nbsp;<span class="op" id="6299283">:=</span>&nbsp;<span class="ident" id="6299286">r</span><span class="op" id="6299287">.</span><span class="ident" id="6299288">init</span><span class="op" id="6299292">(</span><span class="ident" id="6299293">f</span><span class="op" id="6299294">,</span>&nbsp;<span class="ident" id="6299296">fi</span><span class="op" id="6299298">.</span><span class="ident" id="6299299">Size</span><span class="op" id="6299303">(</span><span class="op" id="6299304">)</span><span class="op" id="6299305">)</span><span class="op" id="6299306">;</span>&nbsp;<span class="ident" id="6299308">err</span>&nbsp;<span class="op" id="6299312">!=</span>&nbsp;<span class="ident" id="6299315">nil</span>&nbsp;<span class="op" id="6299319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299323">f</span><span class="op" id="6299324">.</span><span class="ident" id="6299325">Close</span><span class="op" id="6299330">(</span><span class="op" id="6299331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299335">return</span>&nbsp;<span class="ident" id="6299342">nil</span><span class="op" id="6299345">,</span>&nbsp;<span class="ident" id="6299347">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299355">r</span><span class="op" id="6299356">.</span><span class="ident" id="6299357">f</span>&nbsp;<span class="op" id="6299359">=</span>&nbsp;<span class="ident" id="6299361">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299364">return</span>&nbsp;<span class="ident" id="6299371">r</span><span class="op" id="6299372">,</span>&nbsp;<span class="ident" id="6299374">nil</span><br>
<span class="lineno"></span><span class="op" id="6299378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="6299381">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6299451">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6299484">func</span>&nbsp;<span class="ident" id="6299489">NewReader</span><span class="op" id="6299498">(</span><span class="ident" id="6299499">r</span>&nbsp;<span class="ident" id="6299501">io</span><span class="op" id="6299503">.</span><span class="ident" id="6299504">ReaderAt</span><span class="op" id="6299512">,</span>&nbsp;<span class="ident" id="6299514">size</span>&nbsp;<span class="ident" id="6299519">int64</span><span class="op" id="6299524">)</span>&nbsp;<span class="op" id="6299526">(</span><span class="op" id="6299527">*</span><span class="ident" id="6299528">Reader</span><span class="op" id="6299534">,</span>&nbsp;<span class="builtintype" id="6299536">error</span><span class="op" id="6299541">)</span>&nbsp;<span class="op" id="6299543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299546">zr</span>&nbsp;<span class="op" id="6299549">:=</span>&nbsp;<span class="builtinfunc" id="6299552">new</span><span class="op" id="6299555">(</span><span class="ident" id="6299556">Reader</span><span class="op" id="6299562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299565">if</span>&nbsp;<span class="ident" id="6299568">err</span>&nbsp;<span class="op" id="6299572">:=</span>&nbsp;<span class="ident" id="6299575">zr</span><span class="op" id="6299577">.</span><span class="ident" id="6299578">init</span><span class="op" id="6299582">(</span><span class="ident" id="6299583">r</span><span class="op" id="6299584">,</span>&nbsp;<span class="ident" id="6299586">size</span><span class="op" id="6299590">)</span><span class="op" id="6299591">;</span>&nbsp;<span class="ident" id="6299593">err</span>&nbsp;<span class="op" id="6299597">!=</span>&nbsp;<span class="ident" id="6299600">nil</span>&nbsp;<span class="op" id="6299604">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299608">return</span>&nbsp;<span class="ident" id="6299615">nil</span><span class="op" id="6299618">,</span>&nbsp;<span class="ident" id="6299620">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299628">return</span>&nbsp;<span class="ident" id="6299635">zr</span><span class="op" id="6299637">,</span>&nbsp;<span class="ident" id="6299639">nil</span><br>
<span class="lineno"></span><span class="op" id="6299643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6299646">func</span>&nbsp;<span class="op" id="6299651">(</span><span class="ident" id="6299652">z</span>&nbsp;<span class="op" id="6299654">*</span><span class="ident" id="6299655">Reader</span><span class="op" id="6299661">)</span>&nbsp;<span class="ident" id="6299663">init</span><span class="op" id="6299667">(</span><span class="ident" id="6299668">r</span>&nbsp;<span class="ident" id="6299670">io</span><span class="op" id="6299672">.</span><span class="ident" id="6299673">ReaderAt</span><span class="op" id="6299681">,</span>&nbsp;<span class="ident" id="6299683">size</span>&nbsp;<span class="ident" id="6299688">int64</span><span class="op" id="6299693">)</span>&nbsp;<span class="builtintype" id="6299695">error</span>&nbsp;<span class="op" id="6299701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299704">end</span><span class="op" id="6299707">,</span>&nbsp;<span class="ident" id="6299709">err</span>&nbsp;<span class="op" id="6299713">:=</span>&nbsp;<span class="ident" id="6299716">readDirectoryEnd</span><span class="op" id="6299732">(</span><span class="ident" id="6299733">r</span><span class="op" id="6299734">,</span>&nbsp;<span class="ident" id="6299736">size</span><span class="op" id="6299740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299743">if</span>&nbsp;<span class="ident" id="6299746">err</span>&nbsp;<span class="op" id="6299750">!=</span>&nbsp;<span class="ident" id="6299753">nil</span>&nbsp;<span class="op" id="6299757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299761">return</span>&nbsp;<span class="ident" id="6299768">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299773">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299776">z</span><span class="op" id="6299777">.</span><span class="ident" id="6299778">r</span>&nbsp;<span class="op" id="6299780">=</span>&nbsp;<span class="ident" id="6299782">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299785">z</span><span class="op" id="6299786">.</span><span class="ident" id="6299787">File</span>&nbsp;<span class="op" id="6299792">=</span>&nbsp;<span class="builtinfunc" id="6299794">make</span><span class="op" id="6299798">(</span><span class="op" id="6299799">[</span><span class="op" id="6299800">]</span><span class="op" id="6299801">*</span><span class="ident" id="6299802">File</span><span class="op" id="6299806">,</span>&nbsp;<span class="num" id="6299808">0</span><span class="op" id="6299809">,</span>&nbsp;<span class="ident" id="6299811">end</span><span class="op" id="6299814">.</span><span class="ident" id="6299815">directoryRecords</span><span class="op" id="6299831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299834">z</span><span class="op" id="6299835">.</span><span class="ident" id="6299836">Comment</span>&nbsp;<span class="op" id="6299844">=</span>&nbsp;<span class="ident" id="6299846">end</span><span class="op" id="6299849">.</span><span class="ident" id="6299850">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299859">rs</span>&nbsp;<span class="op" id="6299862">:=</span>&nbsp;<span class="ident" id="6299865">io</span><span class="op" id="6299867">.</span><span class="ident" id="6299868">NewSectionReader</span><span class="op" id="6299884">(</span><span class="ident" id="6299885">r</span><span class="op" id="6299886">,</span>&nbsp;<span class="num" id="6299888">0</span><span class="op" id="6299889">,</span>&nbsp;<span class="ident" id="6299891">size</span><span class="op" id="6299895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299898">if</span>&nbsp;<span class="ident" id="6299901">_</span><span class="op" id="6299902">,</span>&nbsp;<span class="ident" id="6299904">err</span>&nbsp;<span class="op" id="6299908">=</span>&nbsp;<span class="ident" id="6299910">rs</span><span class="op" id="6299912">.</span><span class="ident" id="6299913">Seek</span><span class="op" id="6299917">(</span><span class="ident" id="6299918">int64</span><span class="op" id="6299923">(</span><span class="ident" id="6299924">end</span><span class="op" id="6299927">.</span><span class="ident" id="6299928">directoryOffset</span><span class="op" id="6299943">)</span><span class="op" id="6299944">,</span>&nbsp;<span class="ident" id="6299946">os</span><span class="op" id="6299948">.</span><span class="ident" id="6299949">SEEK_SET</span><span class="op" id="6299957">)</span><span class="op" id="6299958">;</span>&nbsp;<span class="ident" id="6299960">err</span>&nbsp;<span class="op" id="6299964">!=</span>&nbsp;<span class="ident" id="6299967">nil</span>&nbsp;<span class="op" id="6299971">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299975">return</span>&nbsp;<span class="ident" id="6299982">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299990">buf</span>&nbsp;<span class="op" id="6299994">:=</span>&nbsp;<span class="ident" id="6299997">bufio</span><span class="op" id="6300002">.</span><span class="ident" id="6300003">NewReader</span><span class="op" id="6300012">(</span><span class="ident" id="6300013">rs</span><span class="op" id="6300015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300019">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300088">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300146">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300214">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300260">for</span>&nbsp;<span class="op" id="6300264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300268">f</span>&nbsp;<span class="op" id="6300270">:=</span>&nbsp;<span class="op" id="6300273">&amp;</span><span class="ident" id="6300274">File</span><span class="op" id="6300278">{</span><span class="ident" id="6300279">zipr</span><span class="op" id="6300283">:</span>&nbsp;<span class="ident" id="6300285">r</span><span class="op" id="6300286">,</span>&nbsp;<span class="ident" id="6300288">zipsize</span><span class="op" id="6300295">:</span>&nbsp;<span class="ident" id="6300297">size</span><span class="op" id="6300301">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300305">err</span>&nbsp;<span class="op" id="6300309">=</span>&nbsp;<span class="ident" id="6300311">readDirectoryHeader</span><span class="op" id="6300330">(</span><span class="ident" id="6300331">f</span><span class="op" id="6300332">,</span>&nbsp;<span class="ident" id="6300334">buf</span><span class="op" id="6300337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300341">if</span>&nbsp;<span class="ident" id="6300344">err</span>&nbsp;<span class="op" id="6300348">==</span>&nbsp;<span class="ident" id="6300351">ErrFormat</span>&nbsp;<span class="op" id="6300361">||</span>&nbsp;<span class="ident" id="6300364">err</span>&nbsp;<span class="op" id="6300368">==</span>&nbsp;<span class="ident" id="6300371">io</span><span class="op" id="6300373">.</span><span class="ident" id="6300374">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6300391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300396">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300408">if</span>&nbsp;<span class="ident" id="6300411">err</span>&nbsp;<span class="op" id="6300415">!=</span>&nbsp;<span class="ident" id="6300418">nil</span>&nbsp;<span class="op" id="6300422">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300427">return</span>&nbsp;<span class="ident" id="6300434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300444">z</span><span class="op" id="6300445">.</span><span class="ident" id="6300446">File</span>&nbsp;<span class="op" id="6300451">=</span>&nbsp;<span class="builtinfunc" id="6300453">append</span><span class="op" id="6300459">(</span><span class="ident" id="6300460">z</span><span class="op" id="6300461">.</span><span class="ident" id="6300462">File</span><span class="op" id="6300466">,</span>&nbsp;<span class="ident" id="6300468">f</span><span class="op" id="6300469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300475">if</span>&nbsp;<span class="builtintype" id="6300478">uint16</span><span class="op" id="6300484">(</span><span class="builtinfunc" id="6300485">len</span><span class="op" id="6300488">(</span><span class="ident" id="6300489">z</span><span class="op" id="6300490">.</span><span class="ident" id="6300491">File</span><span class="op" id="6300495">)</span><span class="op" id="6300496">)</span>&nbsp;<span class="op" id="6300498">!=</span>&nbsp;<span class="builtintype" id="6300501">uint16</span><span class="op" id="6300507">(</span><span class="ident" id="6300508">end</span><span class="op" id="6300511">.</span><span class="ident" id="6300512">directoryRecords</span><span class="op" id="6300528">)</span>&nbsp;<span class="op" id="6300530">{</span>&nbsp;<span class="comment" id="6300532">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300563">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6300616">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300660">return</span>&nbsp;<span class="ident" id="6300667">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300675">return</span>&nbsp;<span class="ident" id="6300682">nil</span><br>
<span class="lineno">110</span><span class="op" id="6300686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300689">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="6300750">func</span>&nbsp;<span class="op" id="6300755">(</span><span class="ident" id="6300756">rc</span>&nbsp;<span class="op" id="6300759">*</span><span class="ident" id="6300760">ReadCloser</span><span class="op" id="6300770">)</span>&nbsp;<span class="ident" id="6300772">Close</span><span class="op" id="6300777">(</span><span class="op" id="6300778">)</span>&nbsp;<span class="builtintype" id="6300780">error</span>&nbsp;<span class="op" id="6300786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300789">return</span>&nbsp;<span class="ident" id="6300796">rc</span><span class="op" id="6300798">.</span><span class="ident" id="6300799">f</span><span class="op" id="6300800">.</span><span class="ident" id="6300801">Close</span><span class="op" id="6300806">(</span><span class="op" id="6300807">)</span><br>
<span class="lineno">115</span><span class="op" id="6300809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300812">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="6300879">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="6300931">//</span><br>
<span class="lineno">120</span><span class="comment" id="6300934">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="6300995">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="6301040">func</span>&nbsp;<span class="op" id="6301045">(</span><span class="ident" id="6301046">f</span>&nbsp;<span class="op" id="6301048">*</span><span class="ident" id="6301049">File</span><span class="op" id="6301053">)</span>&nbsp;<span class="ident" id="6301055">DataOffset</span><span class="op" id="6301065">(</span><span class="op" id="6301066">)</span>&nbsp;<span class="op" id="6301068">(</span><span class="ident" id="6301069">offset</span>&nbsp;<span class="ident" id="6301076">int64</span><span class="op" id="6301081">,</span>&nbsp;<span class="ident" id="6301083">err</span>&nbsp;<span class="builtintype" id="6301087">error</span><span class="op" id="6301092">)</span>&nbsp;<span class="op" id="6301094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301097">bodyOffset</span><span class="op" id="6301107">,</span>&nbsp;<span class="ident" id="6301109">err</span>&nbsp;<span class="op" id="6301113">:=</span>&nbsp;<span class="ident" id="6301116">f</span><span class="op" id="6301117">.</span><span class="ident" id="6301118">findBodyOffset</span><span class="op" id="6301132">(</span><span class="op" id="6301133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301136">if</span>&nbsp;<span class="ident" id="6301139">err</span>&nbsp;<span class="op" id="6301143">!=</span>&nbsp;<span class="ident" id="6301146">nil</span>&nbsp;<span class="op" id="6301150">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301154">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6301162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301165">return</span>&nbsp;<span class="ident" id="6301172">f</span><span class="op" id="6301173">.</span><span class="ident" id="6301174">headerOffset</span>&nbsp;<span class="op" id="6301187">+</span>&nbsp;<span class="ident" id="6301189">bodyOffset</span><span class="op" id="6301199">,</span>&nbsp;<span class="ident" id="6301201">nil</span><br>
<span class="lineno"></span><span class="op" id="6301205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6301208">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="6301282">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="6301326">func</span>&nbsp;<span class="op" id="6301331">(</span><span class="ident" id="6301332">f</span>&nbsp;<span class="op" id="6301334">*</span><span class="ident" id="6301335">File</span><span class="op" id="6301339">)</span>&nbsp;<span class="ident" id="6301341">Open</span><span class="op" id="6301345">(</span><span class="op" id="6301346">)</span>&nbsp;<span class="op" id="6301348">(</span><span class="ident" id="6301349">rc</span>&nbsp;<span class="ident" id="6301352">io</span><span class="op" id="6301354">.</span><span class="ident" id="6301355">ReadCloser</span><span class="op" id="6301365">,</span>&nbsp;<span class="ident" id="6301367">err</span>&nbsp;<span class="builtintype" id="6301371">error</span><span class="op" id="6301376">)</span>&nbsp;<span class="op" id="6301378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301381">bodyOffset</span><span class="op" id="6301391">,</span>&nbsp;<span class="ident" id="6301393">err</span>&nbsp;<span class="op" id="6301397">:=</span>&nbsp;<span class="ident" id="6301400">f</span><span class="op" id="6301401">.</span><span class="ident" id="6301402">findBodyOffset</span><span class="op" id="6301416">(</span><span class="op" id="6301417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301420">if</span>&nbsp;<span class="ident" id="6301423">err</span>&nbsp;<span class="op" id="6301427">!=</span>&nbsp;<span class="ident" id="6301430">nil</span>&nbsp;<span class="op" id="6301434">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301438">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6301446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301449">size</span>&nbsp;<span class="op" id="6301454">:=</span>&nbsp;<span class="ident" id="6301457">int64</span><span class="op" id="6301462">(</span><span class="ident" id="6301463">f</span><span class="op" id="6301464">.</span><span class="ident" id="6301465">CompressedSize64</span><span class="op" id="6301481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301484">r</span>&nbsp;<span class="op" id="6301486">:=</span>&nbsp;<span class="ident" id="6301489">io</span><span class="op" id="6301491">.</span><span class="ident" id="6301492">NewSectionReader</span><span class="op" id="6301508">(</span><span class="ident" id="6301509">f</span><span class="op" id="6301510">.</span><span class="ident" id="6301511">zipr</span><span class="op" id="6301515">,</span>&nbsp;<span class="ident" id="6301517">f</span><span class="op" id="6301518">.</span><span class="ident" id="6301519">headerOffset</span><span class="op" id="6301531">+</span><span class="ident" id="6301532">bodyOffset</span><span class="op" id="6301542">,</span>&nbsp;<span class="ident" id="6301544">size</span><span class="op" id="6301548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301551">dcomp</span>&nbsp;<span class="op" id="6301557">:=</span>&nbsp;<span class="ident" id="6301560">decompressor</span><span class="op" id="6301572">(</span><span class="ident" id="6301573">f</span><span class="op" id="6301574">.</span><span class="ident" id="6301575">Method</span><span class="op" id="6301581">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301584">if</span>&nbsp;<span class="ident" id="6301587">dcomp</span>&nbsp;<span class="op" id="6301593">==</span>&nbsp;<span class="ident" id="6301596">nil</span>&nbsp;<span class="op" id="6301600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301604">err</span>&nbsp;<span class="op" id="6301608">=</span>&nbsp;<span class="ident" id="6301610">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301625">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6301633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301636">rc</span>&nbsp;<span class="op" id="6301639">=</span>&nbsp;<span class="ident" id="6301641">dcomp</span><span class="op" id="6301646">(</span><span class="ident" id="6301647">r</span><span class="op" id="6301648">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301651">var</span>&nbsp;<span class="ident" id="6301655">desr</span>&nbsp;<span class="ident" id="6301660">io</span><span class="op" id="6301662">.</span><span class="ident" id="6301663">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301671">if</span>&nbsp;<span class="ident" id="6301674">f</span><span class="op" id="6301675">.</span><span class="ident" id="6301676">hasDataDescriptor</span><span class="op" id="6301693">(</span><span class="op" id="6301694">)</span>&nbsp;<span class="op" id="6301696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301700">desr</span>&nbsp;<span class="op" id="6301705">=</span>&nbsp;<span class="ident" id="6301707">io</span><span class="op" id="6301709">.</span><span class="ident" id="6301710">NewSectionReader</span><span class="op" id="6301726">(</span><span class="ident" id="6301727">f</span><span class="op" id="6301728">.</span><span class="ident" id="6301729">zipr</span><span class="op" id="6301733">,</span>&nbsp;<span class="ident" id="6301735">f</span><span class="op" id="6301736">.</span><span class="ident" id="6301737">headerOffset</span><span class="op" id="6301749">+</span><span class="ident" id="6301750">bodyOffset</span><span class="op" id="6301760">+</span><span class="ident" id="6301761">size</span><span class="op" id="6301765">,</span>&nbsp;<span class="ident" id="6301767">dataDescriptorLen</span><span class="op" id="6301784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6301787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301790">rc</span>&nbsp;<span class="op" id="6301793">=</span>&nbsp;<span class="op" id="6301795">&amp;</span><span class="ident" id="6301796">checksumReader</span><span class="op" id="6301810">{</span><span class="ident" id="6301811">rc</span><span class="op" id="6301813">,</span>&nbsp;<span class="ident" id="6301815">crc32</span><span class="op" id="6301820">.</span><span class="ident" id="6301821">NewIEEE</span><span class="op" id="6301828">(</span><span class="op" id="6301829">)</span><span class="op" id="6301830">,</span>&nbsp;<span class="ident" id="6301832">f</span><span class="op" id="6301833">,</span>&nbsp;<span class="ident" id="6301835">desr</span><span class="op" id="6301839">,</span>&nbsp;<span class="ident" id="6301841">nil</span><span class="op" id="6301844">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6301847">return</span><br>
<span class="lineno"></span><span class="op" id="6301854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6301857">type</span>&nbsp;<span class="ident" id="6301862">checksumReader</span>&nbsp;<span class="keyword" id="6301877">struct</span>&nbsp;<span class="op" id="6301884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301887">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6301892">io</span><span class="op" id="6301894">.</span><span class="ident" id="6301895">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301907">hash</span>&nbsp;<span class="ident" id="6301912">hash</span><span class="op" id="6301916">.</span><span class="ident" id="6301917">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301925">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301930">*</span><span class="ident" id="6301931">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6301937">desr</span>&nbsp;<span class="ident" id="6301942">io</span><span class="op" id="6301944">.</span><span class="ident" id="6301945">Reader</span>&nbsp;<span class="comment" id="6301952">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302002">err</span>&nbsp;&nbsp;<span class="builtintype" id="6302007">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6302017">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="6302033">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="6302036">func</span>&nbsp;<span class="op" id="6302041">(</span><span class="ident" id="6302042">r</span>&nbsp;<span class="op" id="6302044">*</span><span class="ident" id="6302045">checksumReader</span><span class="op" id="6302059">)</span>&nbsp;<span class="ident" id="6302061">Read</span><span class="op" id="6302065">(</span><span class="ident" id="6302066">b</span>&nbsp;<span class="op" id="6302068">[</span><span class="op" id="6302069">]</span><span class="builtintype" id="6302070">byte</span><span class="op" id="6302074">)</span>&nbsp;<span class="op" id="6302076">(</span><span class="ident" id="6302077">n</span>&nbsp;<span class="builtintype" id="6302079">int</span><span class="op" id="6302082">,</span>&nbsp;<span class="ident" id="6302084">err</span>&nbsp;<span class="builtintype" id="6302088">error</span><span class="op" id="6302093">)</span>&nbsp;<span class="op" id="6302095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302098">if</span>&nbsp;<span class="ident" id="6302101">r</span><span class="op" id="6302102">.</span><span class="ident" id="6302103">err</span>&nbsp;<span class="op" id="6302107">!=</span>&nbsp;<span class="ident" id="6302110">nil</span>&nbsp;<span class="op" id="6302114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302118">return</span>&nbsp;<span class="num" id="6302125">0</span><span class="op" id="6302126">,</span>&nbsp;<span class="ident" id="6302128">r</span><span class="op" id="6302129">.</span><span class="ident" id="6302130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302135">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302138">n</span><span class="op" id="6302139">,</span>&nbsp;<span class="ident" id="6302141">err</span>&nbsp;<span class="op" id="6302145">=</span>&nbsp;<span class="ident" id="6302147">r</span><span class="op" id="6302148">.</span><span class="ident" id="6302149">rc</span><span class="op" id="6302151">.</span><span class="ident" id="6302152">Read</span><span class="op" id="6302156">(</span><span class="ident" id="6302157">b</span><span class="op" id="6302158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302161">r</span><span class="op" id="6302162">.</span><span class="ident" id="6302163">hash</span><span class="op" id="6302167">.</span><span class="ident" id="6302168">Write</span><span class="op" id="6302173">(</span><span class="ident" id="6302174">b</span><span class="op" id="6302175">[</span><span class="op" id="6302176">:</span><span class="ident" id="6302177">n</span><span class="op" id="6302178">]</span><span class="op" id="6302179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302182">if</span>&nbsp;<span class="ident" id="6302185">err</span>&nbsp;<span class="op" id="6302189">==</span>&nbsp;<span class="ident" id="6302192">nil</span>&nbsp;<span class="op" id="6302196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302200">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302208">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302211">if</span>&nbsp;<span class="ident" id="6302214">err</span>&nbsp;<span class="op" id="6302218">==</span>&nbsp;<span class="ident" id="6302221">io</span><span class="op" id="6302223">.</span><span class="ident" id="6302224">EOF</span>&nbsp;<span class="op" id="6302228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302232">if</span>&nbsp;<span class="ident" id="6302235">r</span><span class="op" id="6302236">.</span><span class="ident" id="6302237">desr</span>&nbsp;<span class="op" id="6302242">!=</span>&nbsp;<span class="ident" id="6302245">nil</span>&nbsp;<span class="op" id="6302249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302254">if</span>&nbsp;<span class="ident" id="6302257">err1</span>&nbsp;<span class="op" id="6302262">:=</span>&nbsp;<span class="ident" id="6302265">readDataDescriptor</span><span class="op" id="6302283">(</span><span class="ident" id="6302284">r</span><span class="op" id="6302285">.</span><span class="ident" id="6302286">desr</span><span class="op" id="6302290">,</span>&nbsp;<span class="ident" id="6302292">r</span><span class="op" id="6302293">.</span><span class="ident" id="6302294">f</span><span class="op" id="6302295">)</span><span class="op" id="6302296">;</span>&nbsp;<span class="ident" id="6302298">err1</span>&nbsp;<span class="op" id="6302303">!=</span>&nbsp;<span class="ident" id="6302306">nil</span>&nbsp;<span class="op" id="6302310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302316">err</span>&nbsp;<span class="op" id="6302320">=</span>&nbsp;<span class="ident" id="6302322">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302330">}</span>&nbsp;<span class="keyword" id="6302332">else</span>&nbsp;<span class="keyword" id="6302337">if</span>&nbsp;<span class="ident" id="6302340">r</span><span class="op" id="6302341">.</span><span class="ident" id="6302342">hash</span><span class="op" id="6302346">.</span><span class="ident" id="6302347">Sum32</span><span class="op" id="6302352">(</span><span class="op" id="6302353">)</span>&nbsp;<span class="op" id="6302355">!=</span>&nbsp;<span class="ident" id="6302358">r</span><span class="op" id="6302359">.</span><span class="ident" id="6302360">f</span><span class="op" id="6302361">.</span><span class="ident" id="6302362">CRC32</span>&nbsp;<span class="op" id="6302368">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302374">err</span>&nbsp;<span class="op" id="6302378">=</span>&nbsp;<span class="ident" id="6302380">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302399">}</span>&nbsp;<span class="keyword" id="6302401">else</span>&nbsp;<span class="op" id="6302406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302411">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302468">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6302527">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302578">if</span>&nbsp;<span class="ident" id="6302581">r</span><span class="op" id="6302582">.</span><span class="ident" id="6302583">f</span><span class="op" id="6302584">.</span><span class="ident" id="6302585">CRC32</span>&nbsp;<span class="op" id="6302591">!=</span>&nbsp;<span class="num" id="6302594">0</span>&nbsp;<span class="op" id="6302596">&amp;&amp;</span>&nbsp;<span class="ident" id="6302599">r</span><span class="op" id="6302600">.</span><span class="ident" id="6302601">hash</span><span class="op" id="6302605">.</span><span class="ident" id="6302606">Sum32</span><span class="op" id="6302611">(</span><span class="op" id="6302612">)</span>&nbsp;<span class="op" id="6302614">!=</span>&nbsp;<span class="ident" id="6302617">r</span><span class="op" id="6302618">.</span><span class="ident" id="6302619">f</span><span class="op" id="6302620">.</span><span class="ident" id="6302621">CRC32</span>&nbsp;<span class="op" id="6302627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302633">err</span>&nbsp;<span class="op" id="6302637">=</span>&nbsp;<span class="ident" id="6302639">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302658">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6302661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6302664">r</span><span class="op" id="6302665">.</span><span class="ident" id="6302666">err</span>&nbsp;<span class="op" id="6302670">=</span>&nbsp;<span class="ident" id="6302672">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302677">return</span><br>
<span class="lineno"></span><span class="op" id="6302684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="6302687">func</span>&nbsp;<span class="op" id="6302692">(</span><span class="ident" id="6302693">r</span>&nbsp;<span class="op" id="6302695">*</span><span class="ident" id="6302696">checksumReader</span><span class="op" id="6302710">)</span>&nbsp;<span class="ident" id="6302712">Close</span><span class="op" id="6302717">(</span><span class="op" id="6302718">)</span>&nbsp;<span class="builtintype" id="6302720">error</span>&nbsp;<span class="op" id="6302726">{</span>&nbsp;<span class="keyword" id="6302728">return</span>&nbsp;<span class="ident" id="6302735">r</span><span class="op" id="6302736">.</span><span class="ident" id="6302737">rc</span><span class="op" id="6302739">.</span><span class="ident" id="6302740">Close</span><span class="op" id="6302745">(</span><span class="op" id="6302746">)</span>&nbsp;<span class="op" id="6302748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6302751">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="6302823">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="6302860">func</span>&nbsp;<span class="op" id="6302865">(</span><span class="ident" id="6302866">f</span>&nbsp;<span class="op" id="6302868">*</span><span class="ident" id="6302869">File</span><span class="op" id="6302873">)</span>&nbsp;<span class="ident" id="6302875">findBodyOffset</span><span class="op" id="6302889">(</span><span class="op" id="6302890">)</span>&nbsp;<span class="op" id="6302892">(</span><span class="ident" id="6302893">int64</span><span class="op" id="6302898">,</span>&nbsp;<span class="builtintype" id="6302900">error</span><span class="op" id="6302905">)</span>&nbsp;<span class="op" id="6302907">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302910">var</span>&nbsp;<span class="ident" id="6302914">buf</span>&nbsp;<span class="op" id="6302918">[</span><span class="ident" id="6302919">fileHeaderLen</span><span class="op" id="6302932">]</span><span class="builtintype" id="6302933">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6302939">if</span>&nbsp;<span class="ident" id="6302942">_</span><span class="op" id="6302943">,</span>&nbsp;<span class="ident" id="6302945">err</span>&nbsp;<span class="op" id="6302949">:=</span>&nbsp;<span class="ident" id="6302952">f</span><span class="op" id="6302953">.</span><span class="ident" id="6302954">zipr</span><span class="op" id="6302958">.</span><span class="ident" id="6302959">ReadAt</span><span class="op" id="6302965">(</span><span class="ident" id="6302966">buf</span><span class="op" id="6302969">[</span><span class="op" id="6302970">:</span><span class="op" id="6302971">]</span><span class="op" id="6302972">,</span>&nbsp;<span class="ident" id="6302974">f</span><span class="op" id="6302975">.</span><span class="ident" id="6302976">headerOffset</span><span class="op" id="6302988">)</span><span class="op" id="6302989">;</span>&nbsp;<span class="ident" id="6302991">err</span>&nbsp;<span class="op" id="6302995">!=</span>&nbsp;<span class="ident" id="6302998">nil</span>&nbsp;<span class="op" id="6303002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303006">return</span>&nbsp;<span class="num" id="6303013">0</span><span class="op" id="6303014">,</span>&nbsp;<span class="ident" id="6303016">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303024">b</span>&nbsp;<span class="op" id="6303026">:=</span>&nbsp;<span class="ident" id="6303029">readBuf</span><span class="op" id="6303036">(</span><span class="ident" id="6303037">buf</span><span class="op" id="6303040">[</span><span class="op" id="6303041">:</span><span class="op" id="6303042">]</span><span class="op" id="6303043">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303046">if</span>&nbsp;<span class="ident" id="6303049">sig</span>&nbsp;<span class="op" id="6303053">:=</span>&nbsp;<span class="ident" id="6303056">b</span><span class="op" id="6303057">.</span><span class="builtintype" id="6303058">uint32</span><span class="op" id="6303064">(</span><span class="op" id="6303065">)</span><span class="op" id="6303066">;</span>&nbsp;<span class="ident" id="6303068">sig</span>&nbsp;<span class="op" id="6303072">!=</span>&nbsp;<span class="ident" id="6303075">fileHeaderSignature</span>&nbsp;<span class="op" id="6303095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303099">return</span>&nbsp;<span class="num" id="6303106">0</span><span class="op" id="6303107">,</span>&nbsp;<span class="ident" id="6303109">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303123">b</span>&nbsp;<span class="op" id="6303125">=</span>&nbsp;<span class="ident" id="6303127">b</span><span class="op" id="6303128">[</span><span class="num" id="6303129">22</span><span class="op" id="6303131">:</span><span class="op" id="6303132">]</span>&nbsp;<span class="comment" id="6303134">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303167">filenameLen</span>&nbsp;<span class="op" id="6303179">:=</span>&nbsp;<span class="builtintype" id="6303182">int</span><span class="op" id="6303185">(</span><span class="ident" id="6303186">b</span><span class="op" id="6303187">.</span><span class="builtintype" id="6303188">uint16</span><span class="op" id="6303194">(</span><span class="op" id="6303195">)</span><span class="op" id="6303196">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303199">extraLen</span>&nbsp;<span class="op" id="6303208">:=</span>&nbsp;<span class="builtintype" id="6303211">int</span><span class="op" id="6303214">(</span><span class="ident" id="6303215">b</span><span class="op" id="6303216">.</span><span class="builtintype" id="6303217">uint16</span><span class="op" id="6303223">(</span><span class="op" id="6303224">)</span><span class="op" id="6303225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303228">return</span>&nbsp;<span class="ident" id="6303235">int64</span><span class="op" id="6303240">(</span><span class="ident" id="6303241">fileHeaderLen</span>&nbsp;<span class="op" id="6303255">+</span>&nbsp;<span class="ident" id="6303257">filenameLen</span>&nbsp;<span class="op" id="6303269">+</span>&nbsp;<span class="ident" id="6303271">extraLen</span><span class="op" id="6303279">)</span><span class="op" id="6303280">,</span>&nbsp;<span class="ident" id="6303282">nil</span><br>
<span class="lineno"></span><span class="op" id="6303286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6303289">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="6303356">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="6303427">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="6303489">func</span>&nbsp;<span class="ident" id="6303494">readDirectoryHeader</span><span class="op" id="6303513">(</span><span class="ident" id="6303514">f</span>&nbsp;<span class="op" id="6303516">*</span><span class="ident" id="6303517">File</span><span class="op" id="6303521">,</span>&nbsp;<span class="ident" id="6303523">r</span>&nbsp;<span class="ident" id="6303525">io</span><span class="op" id="6303527">.</span><span class="ident" id="6303528">Reader</span><span class="op" id="6303534">)</span>&nbsp;<span class="builtintype" id="6303536">error</span>&nbsp;<span class="op" id="6303542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303545">var</span>&nbsp;<span class="ident" id="6303549">buf</span>&nbsp;<span class="op" id="6303553">[</span><span class="ident" id="6303554">directoryHeaderLen</span><span class="op" id="6303572">]</span><span class="builtintype" id="6303573">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303579">if</span>&nbsp;<span class="ident" id="6303582">_</span><span class="op" id="6303583">,</span>&nbsp;<span class="ident" id="6303585">err</span>&nbsp;<span class="op" id="6303589">:=</span>&nbsp;<span class="ident" id="6303592">io</span><span class="op" id="6303594">.</span><span class="ident" id="6303595">ReadFull</span><span class="op" id="6303603">(</span><span class="ident" id="6303604">r</span><span class="op" id="6303605">,</span>&nbsp;<span class="ident" id="6303607">buf</span><span class="op" id="6303610">[</span><span class="op" id="6303611">:</span><span class="op" id="6303612">]</span><span class="op" id="6303613">)</span><span class="op" id="6303614">;</span>&nbsp;<span class="ident" id="6303616">err</span>&nbsp;<span class="op" id="6303620">!=</span>&nbsp;<span class="ident" id="6303623">nil</span>&nbsp;<span class="op" id="6303627">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303631">return</span>&nbsp;<span class="ident" id="6303638">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303646">b</span>&nbsp;<span class="op" id="6303648">:=</span>&nbsp;<span class="ident" id="6303651">readBuf</span><span class="op" id="6303658">(</span><span class="ident" id="6303659">buf</span><span class="op" id="6303662">[</span><span class="op" id="6303663">:</span><span class="op" id="6303664">]</span><span class="op" id="6303665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303668">if</span>&nbsp;<span class="ident" id="6303671">sig</span>&nbsp;<span class="op" id="6303675">:=</span>&nbsp;<span class="ident" id="6303678">b</span><span class="op" id="6303679">.</span><span class="builtintype" id="6303680">uint32</span><span class="op" id="6303686">(</span><span class="op" id="6303687">)</span><span class="op" id="6303688">;</span>&nbsp;<span class="ident" id="6303690">sig</span>&nbsp;<span class="op" id="6303694">!=</span>&nbsp;<span class="ident" id="6303697">directoryHeaderSignature</span>&nbsp;<span class="op" id="6303722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6303726">return</span>&nbsp;<span class="ident" id="6303733">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6303744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303747">f</span><span class="op" id="6303748">.</span><span class="ident" id="6303749">CreatorVersion</span>&nbsp;<span class="op" id="6303764">=</span>&nbsp;<span class="ident" id="6303766">b</span><span class="op" id="6303767">.</span><span class="builtintype" id="6303768">uint16</span><span class="op" id="6303774">(</span><span class="op" id="6303775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303778">f</span><span class="op" id="6303779">.</span><span class="ident" id="6303780">ReaderVersion</span>&nbsp;<span class="op" id="6303794">=</span>&nbsp;<span class="ident" id="6303796">b</span><span class="op" id="6303797">.</span><span class="builtintype" id="6303798">uint16</span><span class="op" id="6303804">(</span><span class="op" id="6303805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303808">f</span><span class="op" id="6303809">.</span><span class="ident" id="6303810">Flags</span>&nbsp;<span class="op" id="6303816">=</span>&nbsp;<span class="ident" id="6303818">b</span><span class="op" id="6303819">.</span><span class="builtintype" id="6303820">uint16</span><span class="op" id="6303826">(</span><span class="op" id="6303827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303830">f</span><span class="op" id="6303831">.</span><span class="ident" id="6303832">Method</span>&nbsp;<span class="op" id="6303839">=</span>&nbsp;<span class="ident" id="6303841">b</span><span class="op" id="6303842">.</span><span class="builtintype" id="6303843">uint16</span><span class="op" id="6303849">(</span><span class="op" id="6303850">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303853">f</span><span class="op" id="6303854">.</span><span class="ident" id="6303855">ModifiedTime</span>&nbsp;<span class="op" id="6303868">=</span>&nbsp;<span class="ident" id="6303870">b</span><span class="op" id="6303871">.</span><span class="builtintype" id="6303872">uint16</span><span class="op" id="6303878">(</span><span class="op" id="6303879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303882">f</span><span class="op" id="6303883">.</span><span class="ident" id="6303884">ModifiedDate</span>&nbsp;<span class="op" id="6303897">=</span>&nbsp;<span class="ident" id="6303899">b</span><span class="op" id="6303900">.</span><span class="builtintype" id="6303901">uint16</span><span class="op" id="6303907">(</span><span class="op" id="6303908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303911">f</span><span class="op" id="6303912">.</span><span class="ident" id="6303913">CRC32</span>&nbsp;<span class="op" id="6303919">=</span>&nbsp;<span class="ident" id="6303921">b</span><span class="op" id="6303922">.</span><span class="builtintype" id="6303923">uint32</span><span class="op" id="6303929">(</span><span class="op" id="6303930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303933">f</span><span class="op" id="6303934">.</span><span class="ident" id="6303935">CompressedSize</span>&nbsp;<span class="op" id="6303950">=</span>&nbsp;<span class="ident" id="6303952">b</span><span class="op" id="6303953">.</span><span class="builtintype" id="6303954">uint32</span><span class="op" id="6303960">(</span><span class="op" id="6303961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303964">f</span><span class="op" id="6303965">.</span><span class="ident" id="6303966">UncompressedSize</span>&nbsp;<span class="op" id="6303983">=</span>&nbsp;<span class="ident" id="6303985">b</span><span class="op" id="6303986">.</span><span class="builtintype" id="6303987">uint32</span><span class="op" id="6303993">(</span><span class="op" id="6303994">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6303997">f</span><span class="op" id="6303998">.</span><span class="ident" id="6303999">CompressedSize64</span>&nbsp;<span class="op" id="6304016">=</span>&nbsp;<span class="ident" id="6304018">uint64</span><span class="op" id="6304024">(</span><span class="ident" id="6304025">f</span><span class="op" id="6304026">.</span><span class="ident" id="6304027">CompressedSize</span><span class="op" id="6304041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304044">f</span><span class="op" id="6304045">.</span><span class="ident" id="6304046">UncompressedSize64</span>&nbsp;<span class="op" id="6304065">=</span>&nbsp;<span class="ident" id="6304067">uint64</span><span class="op" id="6304073">(</span><span class="ident" id="6304074">f</span><span class="op" id="6304075">.</span><span class="ident" id="6304076">UncompressedSize</span><span class="op" id="6304092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304095">filenameLen</span>&nbsp;<span class="op" id="6304107">:=</span>&nbsp;<span class="builtintype" id="6304110">int</span><span class="op" id="6304113">(</span><span class="ident" id="6304114">b</span><span class="op" id="6304115">.</span><span class="builtintype" id="6304116">uint16</span><span class="op" id="6304122">(</span><span class="op" id="6304123">)</span><span class="op" id="6304124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304127">extraLen</span>&nbsp;<span class="op" id="6304136">:=</span>&nbsp;<span class="builtintype" id="6304139">int</span><span class="op" id="6304142">(</span><span class="ident" id="6304143">b</span><span class="op" id="6304144">.</span><span class="builtintype" id="6304145">uint16</span><span class="op" id="6304151">(</span><span class="op" id="6304152">)</span><span class="op" id="6304153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304156">commentLen</span>&nbsp;<span class="op" id="6304167">:=</span>&nbsp;<span class="builtintype" id="6304170">int</span><span class="op" id="6304173">(</span><span class="ident" id="6304174">b</span><span class="op" id="6304175">.</span><span class="builtintype" id="6304176">uint16</span><span class="op" id="6304182">(</span><span class="op" id="6304183">)</span><span class="op" id="6304184">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304187">b</span>&nbsp;<span class="op" id="6304189">=</span>&nbsp;<span class="ident" id="6304191">b</span><span class="op" id="6304192">[</span><span class="num" id="6304193">4</span><span class="op" id="6304194">:</span><span class="op" id="6304195">]</span>&nbsp;<span class="comment" id="6304197">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304263">f</span><span class="op" id="6304264">.</span><span class="ident" id="6304265">ExternalAttrs</span>&nbsp;<span class="op" id="6304279">=</span>&nbsp;<span class="ident" id="6304281">b</span><span class="op" id="6304282">.</span><span class="builtintype" id="6304283">uint32</span><span class="op" id="6304289">(</span><span class="op" id="6304290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304293">f</span><span class="op" id="6304294">.</span><span class="ident" id="6304295">headerOffset</span>&nbsp;<span class="op" id="6304308">=</span>&nbsp;<span class="ident" id="6304310">int64</span><span class="op" id="6304315">(</span><span class="ident" id="6304316">b</span><span class="op" id="6304317">.</span><span class="builtintype" id="6304318">uint32</span><span class="op" id="6304324">(</span><span class="op" id="6304325">)</span><span class="op" id="6304326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304329">d</span>&nbsp;<span class="op" id="6304331">:=</span>&nbsp;<span class="builtinfunc" id="6304334">make</span><span class="op" id="6304338">(</span><span class="op" id="6304339">[</span><span class="op" id="6304340">]</span><span class="builtintype" id="6304341">byte</span><span class="op" id="6304345">,</span>&nbsp;<span class="ident" id="6304347">filenameLen</span><span class="op" id="6304358">+</span><span class="ident" id="6304359">extraLen</span><span class="op" id="6304367">+</span><span class="ident" id="6304368">commentLen</span><span class="op" id="6304378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304381">if</span>&nbsp;<span class="ident" id="6304384">_</span><span class="op" id="6304385">,</span>&nbsp;<span class="ident" id="6304387">err</span>&nbsp;<span class="op" id="6304391">:=</span>&nbsp;<span class="ident" id="6304394">io</span><span class="op" id="6304396">.</span><span class="ident" id="6304397">ReadFull</span><span class="op" id="6304405">(</span><span class="ident" id="6304406">r</span><span class="op" id="6304407">,</span>&nbsp;<span class="ident" id="6304409">d</span><span class="op" id="6304410">)</span><span class="op" id="6304411">;</span>&nbsp;<span class="ident" id="6304413">err</span>&nbsp;<span class="op" id="6304417">!=</span>&nbsp;<span class="ident" id="6304420">nil</span>&nbsp;<span class="op" id="6304424">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304428">return</span>&nbsp;<span class="ident" id="6304435">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304443">f</span><span class="op" id="6304444">.</span><span class="ident" id="6304445">Name</span>&nbsp;<span class="op" id="6304450">=</span>&nbsp;<span class="builtintype" id="6304452">string</span><span class="op" id="6304458">(</span><span class="ident" id="6304459">d</span><span class="op" id="6304460">[</span><span class="op" id="6304461">:</span><span class="ident" id="6304462">filenameLen</span><span class="op" id="6304473">]</span><span class="op" id="6304474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304477">f</span><span class="op" id="6304478">.</span><span class="ident" id="6304479">Extra</span>&nbsp;<span class="op" id="6304485">=</span>&nbsp;<span class="ident" id="6304487">d</span><span class="op" id="6304488">[</span><span class="ident" id="6304489">filenameLen</span>&nbsp;<span class="op" id="6304501">:</span>&nbsp;<span class="ident" id="6304503">filenameLen</span><span class="op" id="6304514">+</span><span class="ident" id="6304515">extraLen</span><span class="op" id="6304523">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304526">f</span><span class="op" id="6304527">.</span><span class="ident" id="6304528">Comment</span>&nbsp;<span class="op" id="6304536">=</span>&nbsp;<span class="builtintype" id="6304538">string</span><span class="op" id="6304544">(</span><span class="ident" id="6304545">d</span><span class="op" id="6304546">[</span><span class="ident" id="6304547">filenameLen</span><span class="op" id="6304558">+</span><span class="ident" id="6304559">extraLen</span><span class="op" id="6304567">:</span><span class="op" id="6304568">]</span><span class="op" id="6304569">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304573">if</span>&nbsp;<span class="builtinfunc" id="6304576">len</span><span class="op" id="6304579">(</span><span class="ident" id="6304580">f</span><span class="op" id="6304581">.</span><span class="ident" id="6304582">Extra</span><span class="op" id="6304587">)</span>&nbsp;<span class="op" id="6304589">&gt;</span>&nbsp;<span class="num" id="6304591">0</span>&nbsp;<span class="op" id="6304593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304597">b</span>&nbsp;<span class="op" id="6304599">:=</span>&nbsp;<span class="ident" id="6304602">readBuf</span><span class="op" id="6304609">(</span><span class="ident" id="6304610">f</span><span class="op" id="6304611">.</span><span class="ident" id="6304612">Extra</span><span class="op" id="6304617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304621">for</span>&nbsp;<span class="builtinfunc" id="6304625">len</span><span class="op" id="6304628">(</span><span class="ident" id="6304629">b</span><span class="op" id="6304630">)</span>&nbsp;<span class="op" id="6304632">&gt;=</span>&nbsp;<span class="num" id="6304635">4</span>&nbsp;<span class="op" id="6304637">{</span>&nbsp;<span class="comment" id="6304639">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304672">tag</span>&nbsp;<span class="op" id="6304676">:=</span>&nbsp;<span class="ident" id="6304679">b</span><span class="op" id="6304680">.</span><span class="builtintype" id="6304681">uint16</span><span class="op" id="6304687">(</span><span class="op" id="6304688">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304693">size</span>&nbsp;<span class="op" id="6304698">:=</span>&nbsp;<span class="ident" id="6304701">b</span><span class="op" id="6304702">.</span><span class="builtintype" id="6304703">uint16</span><span class="op" id="6304709">(</span><span class="op" id="6304710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304715">if</span>&nbsp;<span class="builtintype" id="6304718">int</span><span class="op" id="6304721">(</span><span class="ident" id="6304722">size</span><span class="op" id="6304726">)</span>&nbsp;<span class="op" id="6304728">&gt;</span>&nbsp;<span class="builtinfunc" id="6304730">len</span><span class="op" id="6304733">(</span><span class="ident" id="6304734">b</span><span class="op" id="6304735">)</span>&nbsp;<span class="op" id="6304737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304743">return</span>&nbsp;<span class="ident" id="6304750">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304768">if</span>&nbsp;<span class="ident" id="6304771">tag</span>&nbsp;<span class="op" id="6304775">==</span>&nbsp;<span class="ident" id="6304778">zip64ExtraId</span>&nbsp;<span class="op" id="6304791">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6304797">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304855">eb</span>&nbsp;<span class="op" id="6304858">:=</span>&nbsp;<span class="ident" id="6304861">readBuf</span><span class="op" id="6304868">(</span><span class="ident" id="6304869">b</span><span class="op" id="6304870">[</span><span class="op" id="6304871">:</span><span class="ident" id="6304872">size</span><span class="op" id="6304876">]</span><span class="op" id="6304877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304883">if</span>&nbsp;<span class="builtinfunc" id="6304886">len</span><span class="op" id="6304889">(</span><span class="ident" id="6304890">eb</span><span class="op" id="6304892">)</span>&nbsp;<span class="op" id="6304894">&gt;=</span>&nbsp;<span class="num" id="6304897">8</span>&nbsp;<span class="op" id="6304899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304906">f</span><span class="op" id="6304907">.</span><span class="ident" id="6304908">UncompressedSize64</span>&nbsp;<span class="op" id="6304927">=</span>&nbsp;<span class="ident" id="6304929">eb</span><span class="op" id="6304931">.</span><span class="ident" id="6304932">uint64</span><span class="op" id="6304938">(</span><span class="op" id="6304939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6304945">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6304951">if</span>&nbsp;<span class="builtinfunc" id="6304954">len</span><span class="op" id="6304957">(</span><span class="ident" id="6304958">eb</span><span class="op" id="6304960">)</span>&nbsp;<span class="op" id="6304962">&gt;=</span>&nbsp;<span class="num" id="6304965">8</span>&nbsp;<span class="op" id="6304967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6304974">f</span><span class="op" id="6304975">.</span><span class="ident" id="6304976">CompressedSize64</span>&nbsp;<span class="op" id="6304993">=</span>&nbsp;<span class="ident" id="6304995">eb</span><span class="op" id="6304997">.</span><span class="ident" id="6304998">uint64</span><span class="op" id="6305004">(</span><span class="op" id="6305005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305017">if</span>&nbsp;<span class="builtinfunc" id="6305020">len</span><span class="op" id="6305023">(</span><span class="ident" id="6305024">eb</span><span class="op" id="6305026">)</span>&nbsp;<span class="op" id="6305028">&gt;=</span>&nbsp;<span class="num" id="6305031">8</span>&nbsp;<span class="op" id="6305033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305040">f</span><span class="op" id="6305041">.</span><span class="ident" id="6305042">headerOffset</span>&nbsp;<span class="op" id="6305055">=</span>&nbsp;<span class="ident" id="6305057">int64</span><span class="op" id="6305062">(</span><span class="ident" id="6305063">eb</span><span class="op" id="6305065">.</span><span class="ident" id="6305066">uint64</span><span class="op" id="6305072">(</span><span class="op" id="6305073">)</span><span class="op" id="6305074">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305080">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6305090">b</span>&nbsp;<span class="op" id="6305092">=</span>&nbsp;<span class="ident" id="6305094">b</span><span class="op" id="6305095">[</span><span class="ident" id="6305096">size</span><span class="op" id="6305100">:</span><span class="op" id="6305101">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305109">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305153">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305210">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305263">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305300">for</span>&nbsp;<span class="ident" id="6305304">_</span><span class="op" id="6305305">,</span>&nbsp;<span class="ident" id="6305307">v</span>&nbsp;<span class="op" id="6305309">:=</span>&nbsp;<span class="keyword" id="6305312">range</span>&nbsp;<span class="ident" id="6305318">b</span>&nbsp;<span class="op" id="6305320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305325">if</span>&nbsp;<span class="ident" id="6305328">v</span>&nbsp;<span class="op" id="6305330">!=</span>&nbsp;<span class="num" id="6305333">0</span>&nbsp;<span class="op" id="6305335">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305341">return</span>&nbsp;<span class="ident" id="6305348">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6305368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305371">return</span>&nbsp;<span class="ident" id="6305378">nil</span><br>
<span class="lineno">280</span><span class="op" id="6305382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6305385">func</span>&nbsp;<span class="ident" id="6305390">readDataDescriptor</span><span class="op" id="6305408">(</span><span class="ident" id="6305409">r</span>&nbsp;<span class="ident" id="6305411">io</span><span class="op" id="6305413">.</span><span class="ident" id="6305414">Reader</span><span class="op" id="6305420">,</span>&nbsp;<span class="ident" id="6305422">f</span>&nbsp;<span class="op" id="6305424">*</span><span class="ident" id="6305425">File</span><span class="op" id="6305429">)</span>&nbsp;<span class="builtintype" id="6305431">error</span>&nbsp;<span class="op" id="6305437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305440">var</span>&nbsp;<span class="ident" id="6305444">buf</span>&nbsp;<span class="op" id="6305448">[</span><span class="ident" id="6305449">dataDescriptorLen</span><span class="op" id="6305466">]</span><span class="builtintype" id="6305467">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305474">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305529">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305591">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305648">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305703">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305763">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305827">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305867">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305871">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6305932">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6305987">if</span>&nbsp;<span class="ident" id="6305990">_</span><span class="op" id="6305991">,</span>&nbsp;<span class="ident" id="6305993">err</span>&nbsp;<span class="op" id="6305997">:=</span>&nbsp;<span class="ident" id="6306000">io</span><span class="op" id="6306002">.</span><span class="ident" id="6306003">ReadFull</span><span class="op" id="6306011">(</span><span class="ident" id="6306012">r</span><span class="op" id="6306013">,</span>&nbsp;<span class="ident" id="6306015">buf</span><span class="op" id="6306018">[</span><span class="op" id="6306019">:</span><span class="num" id="6306020">4</span><span class="op" id="6306021">]</span><span class="op" id="6306022">)</span><span class="op" id="6306023">;</span>&nbsp;<span class="ident" id="6306025">err</span>&nbsp;<span class="op" id="6306029">!=</span>&nbsp;<span class="ident" id="6306032">nil</span>&nbsp;<span class="op" id="6306036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306040">return</span>&nbsp;<span class="ident" id="6306047">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306055">off</span>&nbsp;<span class="op" id="6306059">:=</span>&nbsp;<span class="num" id="6306062">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306065">maybeSig</span>&nbsp;<span class="op" id="6306074">:=</span>&nbsp;<span class="ident" id="6306077">readBuf</span><span class="op" id="6306084">(</span><span class="ident" id="6306085">buf</span><span class="op" id="6306088">[</span><span class="op" id="6306089">:</span><span class="num" id="6306090">4</span><span class="op" id="6306091">]</span><span class="op" id="6306092">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306095">if</span>&nbsp;<span class="ident" id="6306098">maybeSig</span><span class="op" id="6306106">.</span><span class="builtintype" id="6306107">uint32</span><span class="op" id="6306113">(</span><span class="op" id="6306114">)</span>&nbsp;<span class="op" id="6306116">!=</span>&nbsp;<span class="ident" id="6306119">dataDescriptorSignature</span>&nbsp;<span class="op" id="6306143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306147">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306198">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306210">off</span>&nbsp;<span class="op" id="6306214">+=</span>&nbsp;<span class="num" id="6306217">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306220">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306223">if</span>&nbsp;<span class="ident" id="6306226">_</span><span class="op" id="6306227">,</span>&nbsp;<span class="ident" id="6306229">err</span>&nbsp;<span class="op" id="6306233">:=</span>&nbsp;<span class="ident" id="6306236">io</span><span class="op" id="6306238">.</span><span class="ident" id="6306239">ReadFull</span><span class="op" id="6306247">(</span><span class="ident" id="6306248">r</span><span class="op" id="6306249">,</span>&nbsp;<span class="ident" id="6306251">buf</span><span class="op" id="6306254">[</span><span class="ident" id="6306255">off</span><span class="op" id="6306258">:</span><span class="num" id="6306259">12</span><span class="op" id="6306261">]</span><span class="op" id="6306262">)</span><span class="op" id="6306263">;</span>&nbsp;<span class="ident" id="6306265">err</span>&nbsp;<span class="op" id="6306269">!=</span>&nbsp;<span class="ident" id="6306272">nil</span>&nbsp;<span class="op" id="6306276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306280">return</span>&nbsp;<span class="ident" id="6306287">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306295">b</span>&nbsp;<span class="op" id="6306297">:=</span>&nbsp;<span class="ident" id="6306300">readBuf</span><span class="op" id="6306307">(</span><span class="ident" id="6306308">buf</span><span class="op" id="6306311">[</span><span class="op" id="6306312">:</span><span class="num" id="6306313">12</span><span class="op" id="6306315">]</span><span class="op" id="6306316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306319">if</span>&nbsp;<span class="ident" id="6306322">b</span><span class="op" id="6306323">.</span><span class="builtintype" id="6306324">uint32</span><span class="op" id="6306330">(</span><span class="op" id="6306331">)</span>&nbsp;<span class="op" id="6306333">!=</span>&nbsp;<span class="ident" id="6306336">f</span><span class="op" id="6306337">.</span><span class="ident" id="6306338">CRC32</span>&nbsp;<span class="op" id="6306344">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306348">return</span>&nbsp;<span class="ident" id="6306355">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306372">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306440">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306497">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306561">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306625">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306649">return</span>&nbsp;<span class="ident" id="6306656">nil</span><br>
<span class="lineno">320</span><span class="op" id="6306660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6306663">func</span>&nbsp;<span class="ident" id="6306668">readDirectoryEnd</span><span class="op" id="6306684">(</span><span class="ident" id="6306685">r</span>&nbsp;<span class="ident" id="6306687">io</span><span class="op" id="6306689">.</span><span class="ident" id="6306690">ReaderAt</span><span class="op" id="6306698">,</span>&nbsp;<span class="ident" id="6306700">size</span>&nbsp;<span class="ident" id="6306705">int64</span><span class="op" id="6306710">)</span>&nbsp;<span class="op" id="6306712">(</span><span class="ident" id="6306713">dir</span>&nbsp;<span class="op" id="6306717">*</span><span class="ident" id="6306718">directoryEnd</span><span class="op" id="6306730">,</span>&nbsp;<span class="ident" id="6306732">err</span>&nbsp;<span class="builtintype" id="6306736">error</span><span class="op" id="6306741">)</span>&nbsp;<span class="op" id="6306743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6306746">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306818">var</span>&nbsp;<span class="ident" id="6306822">buf</span>&nbsp;<span class="op" id="6306826">[</span><span class="op" id="6306827">]</span><span class="builtintype" id="6306828">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306834">var</span>&nbsp;<span class="ident" id="6306838">directoryEndOffset</span>&nbsp;<span class="ident" id="6306857">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306864">for</span>&nbsp;<span class="ident" id="6306868">i</span><span class="op" id="6306869">,</span>&nbsp;<span class="ident" id="6306871">bLen</span>&nbsp;<span class="op" id="6306876">:=</span>&nbsp;<span class="keyword" id="6306879">range</span>&nbsp;<span class="op" id="6306885">[</span><span class="op" id="6306886">]</span><span class="ident" id="6306887">int64</span><span class="op" id="6306892">{</span><span class="num" id="6306893">1024</span><span class="op" id="6306897">,</span>&nbsp;<span class="num" id="6306899">65</span>&nbsp;<span class="op" id="6306902">*</span>&nbsp;<span class="num" id="6306904">1024</span><span class="op" id="6306908">}</span>&nbsp;<span class="op" id="6306910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306914">if</span>&nbsp;<span class="ident" id="6306917">bLen</span>&nbsp;<span class="op" id="6306922">&gt;</span>&nbsp;<span class="ident" id="6306924">size</span>&nbsp;<span class="op" id="6306929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306934">bLen</span>&nbsp;<span class="op" id="6306939">=</span>&nbsp;<span class="ident" id="6306941">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6306948">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6306952">buf</span>&nbsp;<span class="op" id="6306956">=</span>&nbsp;<span class="builtinfunc" id="6306958">make</span><span class="op" id="6306962">(</span><span class="op" id="6306963">[</span><span class="op" id="6306964">]</span><span class="builtintype" id="6306965">byte</span><span class="op" id="6306969">,</span>&nbsp;<span class="builtintype" id="6306971">int</span><span class="op" id="6306974">(</span><span class="ident" id="6306975">bLen</span><span class="op" id="6306979">)</span><span class="op" id="6306980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6306984">if</span>&nbsp;<span class="ident" id="6306987">_</span><span class="op" id="6306988">,</span>&nbsp;<span class="ident" id="6306990">err</span>&nbsp;<span class="op" id="6306994">:=</span>&nbsp;<span class="ident" id="6306997">r</span><span class="op" id="6306998">.</span><span class="ident" id="6306999">ReadAt</span><span class="op" id="6307005">(</span><span class="ident" id="6307006">buf</span><span class="op" id="6307009">,</span>&nbsp;<span class="ident" id="6307011">size</span><span class="op" id="6307015">-</span><span class="ident" id="6307016">bLen</span><span class="op" id="6307020">)</span><span class="op" id="6307021">;</span>&nbsp;<span class="ident" id="6307023">err</span>&nbsp;<span class="op" id="6307027">!=</span>&nbsp;<span class="ident" id="6307030">nil</span>&nbsp;<span class="op" id="6307034">&amp;&amp;</span>&nbsp;<span class="ident" id="6307037">err</span>&nbsp;<span class="op" id="6307041">!=</span>&nbsp;<span class="ident" id="6307044">io</span><span class="op" id="6307046">.</span><span class="ident" id="6307047">EOF</span>&nbsp;<span class="op" id="6307051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307056">return</span>&nbsp;<span class="ident" id="6307063">nil</span><span class="op" id="6307066">,</span>&nbsp;<span class="ident" id="6307068">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307078">if</span>&nbsp;<span class="ident" id="6307081">p</span>&nbsp;<span class="op" id="6307083">:=</span>&nbsp;<span class="ident" id="6307086">findSignatureInBlock</span><span class="op" id="6307106">(</span><span class="ident" id="6307107">buf</span><span class="op" id="6307110">)</span><span class="op" id="6307111">;</span>&nbsp;<span class="ident" id="6307113">p</span>&nbsp;<span class="op" id="6307115">&gt;=</span>&nbsp;<span class="num" id="6307118">0</span>&nbsp;<span class="op" id="6307120">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307125">buf</span>&nbsp;<span class="op" id="6307129">=</span>&nbsp;<span class="ident" id="6307131">buf</span><span class="op" id="6307134">[</span><span class="ident" id="6307135">p</span><span class="op" id="6307136">:</span><span class="op" id="6307137">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307142">directoryEndOffset</span>&nbsp;<span class="op" id="6307161">=</span>&nbsp;<span class="ident" id="6307163">size</span>&nbsp;<span class="op" id="6307168">-</span>&nbsp;<span class="ident" id="6307170">bLen</span>&nbsp;<span class="op" id="6307175">+</span>&nbsp;<span class="ident" id="6307177">int64</span><span class="op" id="6307182">(</span><span class="ident" id="6307183">p</span><span class="op" id="6307184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307189">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307201">if</span>&nbsp;<span class="ident" id="6307204">i</span>&nbsp;<span class="op" id="6307206">==</span>&nbsp;<span class="num" id="6307209">1</span>&nbsp;<span class="op" id="6307211">||</span>&nbsp;<span class="ident" id="6307214">bLen</span>&nbsp;<span class="op" id="6307219">==</span>&nbsp;<span class="ident" id="6307222">size</span>&nbsp;<span class="op" id="6307227">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307232">return</span>&nbsp;<span class="ident" id="6307239">nil</span><span class="op" id="6307242">,</span>&nbsp;<span class="ident" id="6307244">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307263">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307291">b</span>&nbsp;<span class="op" id="6307293">:=</span>&nbsp;<span class="ident" id="6307296">readBuf</span><span class="op" id="6307303">(</span><span class="ident" id="6307304">buf</span><span class="op" id="6307307">[</span><span class="num" id="6307308">4</span><span class="op" id="6307309">:</span><span class="op" id="6307310">]</span><span class="op" id="6307311">)</span>&nbsp;<span class="comment" id="6307313">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307332">d</span>&nbsp;<span class="op" id="6307334">:=</span>&nbsp;<span class="op" id="6307337">&amp;</span><span class="ident" id="6307338">directoryEnd</span><span class="op" id="6307350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307354">diskNbr</span><span class="op" id="6307361">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307374">uint32</span><span class="op" id="6307380">(</span><span class="ident" id="6307381">b</span><span class="op" id="6307382">.</span><span class="builtintype" id="6307383">uint16</span><span class="op" id="6307389">(</span><span class="op" id="6307390">)</span><span class="op" id="6307391">)</span><span class="op" id="6307392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307396">dirDiskNbr</span><span class="op" id="6307406">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6307416">uint32</span><span class="op" id="6307422">(</span><span class="ident" id="6307423">b</span><span class="op" id="6307424">.</span><span class="builtintype" id="6307425">uint16</span><span class="op" id="6307431">(</span><span class="op" id="6307432">)</span><span class="op" id="6307433">)</span><span class="op" id="6307434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307438">dirRecordsThisDisk</span><span class="op" id="6307456">:</span>&nbsp;<span class="ident" id="6307458">uint64</span><span class="op" id="6307464">(</span><span class="ident" id="6307465">b</span><span class="op" id="6307466">.</span><span class="builtintype" id="6307467">uint16</span><span class="op" id="6307473">(</span><span class="op" id="6307474">)</span><span class="op" id="6307475">)</span><span class="op" id="6307476">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307480">directoryRecords</span><span class="op" id="6307496">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6307500">uint64</span><span class="op" id="6307506">(</span><span class="ident" id="6307507">b</span><span class="op" id="6307508">.</span><span class="builtintype" id="6307509">uint16</span><span class="op" id="6307515">(</span><span class="op" id="6307516">)</span><span class="op" id="6307517">)</span><span class="op" id="6307518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307522">directorySize</span><span class="op" id="6307535">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307542">uint64</span><span class="op" id="6307548">(</span><span class="ident" id="6307549">b</span><span class="op" id="6307550">.</span><span class="builtintype" id="6307551">uint32</span><span class="op" id="6307557">(</span><span class="op" id="6307558">)</span><span class="op" id="6307559">)</span><span class="op" id="6307560">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307564">directoryOffset</span><span class="op" id="6307579">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307584">uint64</span><span class="op" id="6307590">(</span><span class="ident" id="6307591">b</span><span class="op" id="6307592">.</span><span class="builtintype" id="6307593">uint32</span><span class="op" id="6307599">(</span><span class="op" id="6307600">)</span><span class="op" id="6307601">)</span><span class="op" id="6307602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307606">commentLen</span><span class="op" id="6307616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307626">b</span><span class="op" id="6307627">.</span><span class="builtintype" id="6307628">uint16</span><span class="op" id="6307634">(</span><span class="op" id="6307635">)</span><span class="op" id="6307636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307639">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307642">l</span>&nbsp;<span class="op" id="6307644">:=</span>&nbsp;<span class="builtintype" id="6307647">int</span><span class="op" id="6307650">(</span><span class="ident" id="6307651">d</span><span class="op" id="6307652">.</span><span class="ident" id="6307653">commentLen</span><span class="op" id="6307663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307666">if</span>&nbsp;<span class="ident" id="6307669">l</span>&nbsp;<span class="op" id="6307671">&gt;</span>&nbsp;<span class="builtinfunc" id="6307673">len</span><span class="op" id="6307676">(</span><span class="ident" id="6307677">b</span><span class="op" id="6307678">)</span>&nbsp;<span class="op" id="6307680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307684">return</span>&nbsp;<span class="ident" id="6307691">nil</span><span class="op" id="6307694">,</span>&nbsp;<span class="ident" id="6307696">errors</span><span class="op" id="6307702">.</span><span class="ident" id="6307703">New</span><span class="op" id="6307706">(</span><span class="string" id="6307707">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="6307736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307742">d</span><span class="op" id="6307743">.</span><span class="ident" id="6307744">comment</span>&nbsp;<span class="op" id="6307752">=</span>&nbsp;<span class="builtintype" id="6307754">string</span><span class="op" id="6307760">(</span><span class="ident" id="6307761">b</span><span class="op" id="6307762">[</span><span class="op" id="6307763">:</span><span class="ident" id="6307764">l</span><span class="op" id="6307765">]</span><span class="op" id="6307766">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307770">p</span><span class="op" id="6307771">,</span>&nbsp;<span class="ident" id="6307773">err</span>&nbsp;<span class="op" id="6307777">:=</span>&nbsp;<span class="ident" id="6307780">findDirectory64End</span><span class="op" id="6307798">(</span><span class="ident" id="6307799">r</span><span class="op" id="6307800">,</span>&nbsp;<span class="ident" id="6307802">directoryEndOffset</span><span class="op" id="6307820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307823">if</span>&nbsp;<span class="ident" id="6307826">err</span>&nbsp;<span class="op" id="6307830">==</span>&nbsp;<span class="ident" id="6307833">nil</span>&nbsp;<span class="op" id="6307837">&amp;&amp;</span>&nbsp;<span class="ident" id="6307840">p</span>&nbsp;<span class="op" id="6307842">&gt;=</span>&nbsp;<span class="num" id="6307845">0</span>&nbsp;<span class="op" id="6307847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6307851">err</span>&nbsp;<span class="op" id="6307855">=</span>&nbsp;<span class="ident" id="6307857">readDirectory64End</span><span class="op" id="6307875">(</span><span class="ident" id="6307876">r</span><span class="op" id="6307877">,</span>&nbsp;<span class="ident" id="6307879">p</span><span class="op" id="6307880">,</span>&nbsp;<span class="ident" id="6307882">d</span><span class="op" id="6307883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307886">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307889">if</span>&nbsp;<span class="ident" id="6307892">err</span>&nbsp;<span class="op" id="6307896">!=</span>&nbsp;<span class="ident" id="6307899">nil</span>&nbsp;<span class="op" id="6307903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307907">return</span>&nbsp;<span class="ident" id="6307914">nil</span><span class="op" id="6307917">,</span>&nbsp;<span class="ident" id="6307919">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6307924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6307928">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6307991">if</span>&nbsp;<span class="ident" id="6307994">o</span>&nbsp;<span class="op" id="6307996">:=</span>&nbsp;<span class="ident" id="6307999">int64</span><span class="op" id="6308004">(</span><span class="ident" id="6308005">d</span><span class="op" id="6308006">.</span><span class="ident" id="6308007">directoryOffset</span><span class="op" id="6308022">)</span><span class="op" id="6308023">;</span>&nbsp;<span class="ident" id="6308025">o</span>&nbsp;<span class="op" id="6308027">&lt;</span>&nbsp;<span class="num" id="6308029">0</span>&nbsp;<span class="op" id="6308031">||</span>&nbsp;<span class="ident" id="6308034">o</span>&nbsp;<span class="op" id="6308036">&gt;=</span>&nbsp;<span class="ident" id="6308039">size</span>&nbsp;<span class="op" id="6308044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308048">return</span>&nbsp;<span class="ident" id="6308055">nil</span><span class="op" id="6308058">,</span>&nbsp;<span class="ident" id="6308060">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308074">return</span>&nbsp;<span class="ident" id="6308081">d</span><span class="op" id="6308082">,</span>&nbsp;<span class="ident" id="6308084">nil</span><br>
<span class="lineno"></span><span class="op" id="6308088">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6308091">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6308161">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="6308231">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="6308241">func</span>&nbsp;<span class="ident" id="6308246">findDirectory64End</span><span class="op" id="6308264">(</span><span class="ident" id="6308265">r</span>&nbsp;<span class="ident" id="6308267">io</span><span class="op" id="6308269">.</span><span class="ident" id="6308270">ReaderAt</span><span class="op" id="6308278">,</span>&nbsp;<span class="ident" id="6308280">directoryEndOffset</span>&nbsp;<span class="ident" id="6308299">int64</span><span class="op" id="6308304">)</span>&nbsp;<span class="op" id="6308306">(</span><span class="ident" id="6308307">int64</span><span class="op" id="6308312">,</span>&nbsp;<span class="builtintype" id="6308314">error</span><span class="op" id="6308319">)</span>&nbsp;<span class="op" id="6308321">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308324">locOffset</span>&nbsp;<span class="op" id="6308334">:=</span>&nbsp;<span class="ident" id="6308337">directoryEndOffset</span>&nbsp;<span class="op" id="6308356">-</span>&nbsp;<span class="ident" id="6308358">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308377">if</span>&nbsp;<span class="ident" id="6308380">locOffset</span>&nbsp;<span class="op" id="6308390">&lt;</span>&nbsp;<span class="num" id="6308392">0</span>&nbsp;<span class="op" id="6308394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308398">return</span>&nbsp;<span class="op" id="6308405">-</span><span class="num" id="6308406">1</span><span class="op" id="6308407">,</span>&nbsp;<span class="ident" id="6308409">nil</span>&nbsp;<span class="comment" id="6308413">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308466">buf</span>&nbsp;<span class="op" id="6308470">:=</span>&nbsp;<span class="builtinfunc" id="6308473">make</span><span class="op" id="6308477">(</span><span class="op" id="6308478">[</span><span class="op" id="6308479">]</span><span class="builtintype" id="6308480">byte</span><span class="op" id="6308484">,</span>&nbsp;<span class="ident" id="6308486">directory64LocLen</span><span class="op" id="6308503">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308506">if</span>&nbsp;<span class="ident" id="6308509">_</span><span class="op" id="6308510">,</span>&nbsp;<span class="ident" id="6308512">err</span>&nbsp;<span class="op" id="6308516">:=</span>&nbsp;<span class="ident" id="6308519">r</span><span class="op" id="6308520">.</span><span class="ident" id="6308521">ReadAt</span><span class="op" id="6308527">(</span><span class="ident" id="6308528">buf</span><span class="op" id="6308531">,</span>&nbsp;<span class="ident" id="6308533">locOffset</span><span class="op" id="6308542">)</span><span class="op" id="6308543">;</span>&nbsp;<span class="ident" id="6308545">err</span>&nbsp;<span class="op" id="6308549">!=</span>&nbsp;<span class="ident" id="6308552">nil</span>&nbsp;<span class="op" id="6308556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308560">return</span>&nbsp;<span class="op" id="6308567">-</span><span class="num" id="6308568">1</span><span class="op" id="6308569">,</span>&nbsp;<span class="ident" id="6308571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308579">b</span>&nbsp;<span class="op" id="6308581">:=</span>&nbsp;<span class="ident" id="6308584">readBuf</span><span class="op" id="6308591">(</span><span class="ident" id="6308592">buf</span><span class="op" id="6308595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308598">if</span>&nbsp;<span class="ident" id="6308601">sig</span>&nbsp;<span class="op" id="6308605">:=</span>&nbsp;<span class="ident" id="6308608">b</span><span class="op" id="6308609">.</span><span class="builtintype" id="6308610">uint32</span><span class="op" id="6308616">(</span><span class="op" id="6308617">)</span><span class="op" id="6308618">;</span>&nbsp;<span class="ident" id="6308620">sig</span>&nbsp;<span class="op" id="6308624">!=</span>&nbsp;<span class="ident" id="6308627">directory64LocSignature</span>&nbsp;<span class="op" id="6308651">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308655">return</span>&nbsp;<span class="op" id="6308662">-</span><span class="num" id="6308663">1</span><span class="op" id="6308664">,</span>&nbsp;<span class="ident" id="6308666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6308671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308674">b</span>&nbsp;<span class="op" id="6308676">=</span>&nbsp;<span class="ident" id="6308678">b</span><span class="op" id="6308679">[</span><span class="num" id="6308680">4</span><span class="op" id="6308681">:</span><span class="op" id="6308682">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6308690">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6308771">p</span>&nbsp;<span class="op" id="6308773">:=</span>&nbsp;<span class="ident" id="6308776">b</span><span class="op" id="6308777">.</span><span class="ident" id="6308778">uint64</span><span class="op" id="6308784">(</span><span class="op" id="6308785">)</span>&nbsp;<span class="comment" id="6308787">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6308852">return</span>&nbsp;<span class="ident" id="6308859">int64</span><span class="op" id="6308864">(</span><span class="ident" id="6308865">p</span><span class="op" id="6308866">)</span><span class="op" id="6308867">,</span>&nbsp;<span class="ident" id="6308869">nil</span><br>
<span class="lineno">395</span><span class="op" id="6308873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308876">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6308944">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="6308998">func</span>&nbsp;<span class="ident" id="6309003">readDirectory64End</span><span class="op" id="6309021">(</span><span class="ident" id="6309022">r</span>&nbsp;<span class="ident" id="6309024">io</span><span class="op" id="6309026">.</span><span class="ident" id="6309027">ReaderAt</span><span class="op" id="6309035">,</span>&nbsp;<span class="ident" id="6309037">offset</span>&nbsp;<span class="ident" id="6309044">int64</span><span class="op" id="6309049">,</span>&nbsp;<span class="ident" id="6309051">d</span>&nbsp;<span class="op" id="6309053">*</span><span class="ident" id="6309054">directoryEnd</span><span class="op" id="6309066">)</span>&nbsp;<span class="op" id="6309068">(</span><span class="ident" id="6309069">err</span>&nbsp;<span class="builtintype" id="6309073">error</span><span class="op" id="6309078">)</span>&nbsp;<span class="op" id="6309080">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309083">buf</span>&nbsp;<span class="op" id="6309087">:=</span>&nbsp;<span class="builtinfunc" id="6309090">make</span><span class="op" id="6309094">(</span><span class="op" id="6309095">[</span><span class="op" id="6309096">]</span><span class="builtintype" id="6309097">byte</span><span class="op" id="6309101">,</span>&nbsp;<span class="ident" id="6309103">directory64EndLen</span><span class="op" id="6309120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309123">if</span>&nbsp;<span class="ident" id="6309126">_</span><span class="op" id="6309127">,</span>&nbsp;<span class="ident" id="6309129">err</span>&nbsp;<span class="op" id="6309133">:=</span>&nbsp;<span class="ident" id="6309136">r</span><span class="op" id="6309137">.</span><span class="ident" id="6309138">ReadAt</span><span class="op" id="6309144">(</span><span class="ident" id="6309145">buf</span><span class="op" id="6309148">,</span>&nbsp;<span class="ident" id="6309150">offset</span><span class="op" id="6309156">)</span><span class="op" id="6309157">;</span>&nbsp;<span class="ident" id="6309159">err</span>&nbsp;<span class="op" id="6309163">!=</span>&nbsp;<span class="ident" id="6309166">nil</span>&nbsp;<span class="op" id="6309170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309174">return</span>&nbsp;<span class="ident" id="6309181">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309190">b</span>&nbsp;<span class="op" id="6309192">:=</span>&nbsp;<span class="ident" id="6309195">readBuf</span><span class="op" id="6309202">(</span><span class="ident" id="6309203">buf</span><span class="op" id="6309206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309209">if</span>&nbsp;<span class="ident" id="6309212">sig</span>&nbsp;<span class="op" id="6309216">:=</span>&nbsp;<span class="ident" id="6309219">b</span><span class="op" id="6309220">.</span><span class="builtintype" id="6309221">uint32</span><span class="op" id="6309227">(</span><span class="op" id="6309228">)</span><span class="op" id="6309229">;</span>&nbsp;<span class="ident" id="6309231">sig</span>&nbsp;<span class="op" id="6309235">!=</span>&nbsp;<span class="ident" id="6309238">directory64EndSignature</span>&nbsp;<span class="op" id="6309262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309266">return</span>&nbsp;<span class="ident" id="6309273">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6309284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309288">b</span>&nbsp;<span class="op" id="6309290">=</span>&nbsp;<span class="ident" id="6309292">b</span><span class="op" id="6309293">[</span><span class="num" id="6309294">12</span><span class="op" id="6309296">:</span><span class="op" id="6309297">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309322">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309389">d</span><span class="op" id="6309390">.</span><span class="ident" id="6309391">diskNbr</span>&nbsp;<span class="op" id="6309399">=</span>&nbsp;<span class="ident" id="6309401">b</span><span class="op" id="6309402">.</span><span class="builtintype" id="6309403">uint32</span><span class="op" id="6309409">(</span><span class="op" id="6309410">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309423">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309447">d</span><span class="op" id="6309448">.</span><span class="ident" id="6309449">dirDiskNbr</span>&nbsp;<span class="op" id="6309460">=</span>&nbsp;<span class="ident" id="6309462">b</span><span class="op" id="6309463">.</span><span class="builtintype" id="6309464">uint32</span><span class="op" id="6309470">(</span><span class="op" id="6309471">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309481">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309544">d</span><span class="op" id="6309545">.</span><span class="ident" id="6309546">dirRecordsThisDisk</span>&nbsp;<span class="op" id="6309565">=</span>&nbsp;<span class="ident" id="6309567">b</span><span class="op" id="6309568">.</span><span class="ident" id="6309569">uint64</span><span class="op" id="6309575">(</span><span class="op" id="6309576">)</span>&nbsp;<span class="comment" id="6309578">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309644">d</span><span class="op" id="6309645">.</span><span class="ident" id="6309646">directoryRecords</span>&nbsp;<span class="op" id="6309663">=</span>&nbsp;<span class="ident" id="6309665">b</span><span class="op" id="6309666">.</span><span class="ident" id="6309667">uint64</span><span class="op" id="6309673">(</span><span class="op" id="6309674">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6309678">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309731">d</span><span class="op" id="6309732">.</span><span class="ident" id="6309733">directorySize</span>&nbsp;<span class="op" id="6309747">=</span>&nbsp;<span class="ident" id="6309749">b</span><span class="op" id="6309750">.</span><span class="ident" id="6309751">uint64</span><span class="op" id="6309757">(</span><span class="op" id="6309758">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309765">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6309799">d</span><span class="op" id="6309800">.</span><span class="ident" id="6309801">directoryOffset</span>&nbsp;<span class="op" id="6309817">=</span>&nbsp;<span class="ident" id="6309819">b</span><span class="op" id="6309820">.</span><span class="ident" id="6309821">uint64</span><span class="op" id="6309827">(</span><span class="op" id="6309828">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6309833">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309916">return</span>&nbsp;<span class="ident" id="6309923">nil</span><br>
<span class="lineno"></span><span class="op" id="6309927">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="6309930">func</span>&nbsp;<span class="ident" id="6309935">findSignatureInBlock</span><span class="op" id="6309955">(</span><span class="ident" id="6309956">b</span>&nbsp;<span class="op" id="6309958">[</span><span class="op" id="6309959">]</span><span class="builtintype" id="6309960">byte</span><span class="op" id="6309964">)</span>&nbsp;<span class="builtintype" id="6309966">int</span>&nbsp;<span class="op" id="6309970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6309973">for</span>&nbsp;<span class="ident" id="6309977">i</span>&nbsp;<span class="op" id="6309979">:=</span>&nbsp;<span class="builtinfunc" id="6309982">len</span><span class="op" id="6309985">(</span><span class="ident" id="6309986">b</span><span class="op" id="6309987">)</span>&nbsp;<span class="op" id="6309989">-</span>&nbsp;<span class="ident" id="6309991">directoryEndLen</span><span class="op" id="6310006">;</span>&nbsp;<span class="ident" id="6310008">i</span>&nbsp;<span class="op" id="6310010">&gt;=</span>&nbsp;<span class="num" id="6310013">0</span><span class="op" id="6310014">;</span>&nbsp;<span class="ident" id="6310016">i</span><span class="op" id="6310017">--</span>&nbsp;<span class="op" id="6310020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310024">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310077">if</span>&nbsp;<span class="ident" id="6310080">b</span><span class="op" id="6310081">[</span><span class="ident" id="6310082">i</span><span class="op" id="6310083">]</span>&nbsp;<span class="op" id="6310085">==</span>&nbsp;<span class="string" id="6310088">&#39;P&#39;</span>&nbsp;<span class="op" id="6310092">&amp;&amp;</span>&nbsp;<span class="ident" id="6310095">b</span><span class="op" id="6310096">[</span><span class="ident" id="6310097">i</span><span class="op" id="6310098">+</span><span class="num" id="6310099">1</span><span class="op" id="6310100">]</span>&nbsp;<span class="op" id="6310102">==</span>&nbsp;<span class="string" id="6310105">&#39;K&#39;</span>&nbsp;<span class="op" id="6310109">&amp;&amp;</span>&nbsp;<span class="ident" id="6310112">b</span><span class="op" id="6310113">[</span><span class="ident" id="6310114">i</span><span class="op" id="6310115">+</span><span class="num" id="6310116">2</span><span class="op" id="6310117">]</span>&nbsp;<span class="op" id="6310119">==</span>&nbsp;<span class="num" id="6310122">0x05</span>&nbsp;<span class="op" id="6310127">&amp;&amp;</span>&nbsp;<span class="ident" id="6310130">b</span><span class="op" id="6310131">[</span><span class="ident" id="6310132">i</span><span class="op" id="6310133">+</span><span class="num" id="6310134">3</span><span class="op" id="6310135">]</span>&nbsp;<span class="op" id="6310137">==</span>&nbsp;<span class="num" id="6310140">0x06</span>&nbsp;<span class="op" id="6310145">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6310150">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310179">n</span>&nbsp;<span class="op" id="6310181">:=</span>&nbsp;<span class="builtintype" id="6310184">int</span><span class="op" id="6310187">(</span><span class="ident" id="6310188">b</span><span class="op" id="6310189">[</span><span class="ident" id="6310190">i</span><span class="op" id="6310191">+</span><span class="ident" id="6310192">directoryEndLen</span><span class="op" id="6310207">-</span><span class="num" id="6310208">2</span><span class="op" id="6310209">]</span><span class="op" id="6310210">)</span>&nbsp;<span class="op" id="6310212">|</span>&nbsp;<span class="builtintype" id="6310214">int</span><span class="op" id="6310217">(</span><span class="ident" id="6310218">b</span><span class="op" id="6310219">[</span><span class="ident" id="6310220">i</span><span class="op" id="6310221">+</span><span class="ident" id="6310222">directoryEndLen</span><span class="op" id="6310237">-</span><span class="num" id="6310238">1</span><span class="op" id="6310239">]</span><span class="op" id="6310240">)</span><span class="op" id="6310241">&lt;&lt;</span><span class="num" id="6310243">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310248">if</span>&nbsp;<span class="ident" id="6310251">n</span><span class="op" id="6310252">+</span><span class="ident" id="6310253">directoryEndLen</span><span class="op" id="6310268">+</span><span class="ident" id="6310269">i</span>&nbsp;<span class="op" id="6310271">&lt;=</span>&nbsp;<span class="builtinfunc" id="6310274">len</span><span class="op" id="6310277">(</span><span class="ident" id="6310278">b</span><span class="op" id="6310279">)</span>&nbsp;<span class="op" id="6310281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310287">return</span>&nbsp;<span class="ident" id="6310294">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310299">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310309">return</span>&nbsp;<span class="op" id="6310316">-</span><span class="num" id="6310317">1</span><br>
<span class="lineno"></span><span class="op" id="6310319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="6310322">type</span>&nbsp;<span class="ident" id="6310327">readBuf</span>&nbsp;<span class="op" id="6310335">[</span><span class="op" id="6310336">]</span><span class="builtintype" id="6310337">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310343">func</span>&nbsp;<span class="op" id="6310348">(</span><span class="ident" id="6310349">b</span>&nbsp;<span class="op" id="6310351">*</span><span class="ident" id="6310352">readBuf</span><span class="op" id="6310359">)</span>&nbsp;<span class="builtintype" id="6310361">uint16</span><span class="op" id="6310367">(</span><span class="op" id="6310368">)</span>&nbsp;<span class="builtintype" id="6310370">uint16</span>&nbsp;<span class="op" id="6310377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310380">v</span>&nbsp;<span class="op" id="6310382">:=</span>&nbsp;<span class="ident" id="6310385">binary</span><span class="op" id="6310391">.</span><span class="ident" id="6310392">LittleEndian</span><span class="op" id="6310404">.</span><span class="ident" id="6310405">Uint16</span><span class="op" id="6310411">(</span><span class="op" id="6310412">*</span><span class="ident" id="6310413">b</span><span class="op" id="6310414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310417">*</span><span class="ident" id="6310418">b</span>&nbsp;<span class="op" id="6310420">=</span>&nbsp;<span class="op" id="6310422">(</span><span class="op" id="6310423">*</span><span class="ident" id="6310424">b</span><span class="op" id="6310425">)</span><span class="op" id="6310426">[</span><span class="num" id="6310427">2</span><span class="op" id="6310428">:</span><span class="op" id="6310429">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310432">return</span>&nbsp;<span class="ident" id="6310439">v</span><br>
<span class="lineno"></span><span class="op" id="6310441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310444">func</span>&nbsp;<span class="op" id="6310449">(</span><span class="ident" id="6310450">b</span>&nbsp;<span class="op" id="6310452">*</span><span class="ident" id="6310453">readBuf</span><span class="op" id="6310460">)</span>&nbsp;<span class="builtintype" id="6310462">uint32</span><span class="op" id="6310468">(</span><span class="op" id="6310469">)</span>&nbsp;<span class="builtintype" id="6310471">uint32</span>&nbsp;<span class="op" id="6310478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310481">v</span>&nbsp;<span class="op" id="6310483">:=</span>&nbsp;<span class="ident" id="6310486">binary</span><span class="op" id="6310492">.</span><span class="ident" id="6310493">LittleEndian</span><span class="op" id="6310505">.</span><span class="ident" id="6310506">Uint32</span><span class="op" id="6310512">(</span><span class="op" id="6310513">*</span><span class="ident" id="6310514">b</span><span class="op" id="6310515">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310518">*</span><span class="ident" id="6310519">b</span>&nbsp;<span class="op" id="6310521">=</span>&nbsp;<span class="op" id="6310523">(</span><span class="op" id="6310524">*</span><span class="ident" id="6310525">b</span><span class="op" id="6310526">)</span><span class="op" id="6310527">[</span><span class="num" id="6310528">4</span><span class="op" id="6310529">:</span><span class="op" id="6310530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310533">return</span>&nbsp;<span class="ident" id="6310540">v</span><br>
<span class="lineno"></span><span class="op" id="6310542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6310545">func</span>&nbsp;<span class="op" id="6310550">(</span><span class="ident" id="6310551">b</span>&nbsp;<span class="op" id="6310553">*</span><span class="ident" id="6310554">readBuf</span><span class="op" id="6310561">)</span>&nbsp;<span class="ident" id="6310563">uint64</span><span class="op" id="6310569">(</span><span class="op" id="6310570">)</span>&nbsp;<span class="ident" id="6310572">uint64</span>&nbsp;<span class="op" id="6310579">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6310582">v</span>&nbsp;<span class="op" id="6310584">:=</span>&nbsp;<span class="ident" id="6310587">binary</span><span class="op" id="6310593">.</span><span class="ident" id="6310594">LittleEndian</span><span class="op" id="6310606">.</span><span class="ident" id="6310607">Uint64</span><span class="op" id="6310613">(</span><span class="op" id="6310614">*</span><span class="ident" id="6310615">b</span><span class="op" id="6310616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6310619">*</span><span class="ident" id="6310620">b</span>&nbsp;<span class="op" id="6310622">=</span>&nbsp;<span class="op" id="6310624">(</span><span class="op" id="6310625">*</span><span class="ident" id="6310626">b</span><span class="op" id="6310627">)</span><span class="op" id="6310628">[</span><span class="num" id="6310629">8</span><span class="op" id="6310630">:</span><span class="op" id="6310631">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6310634">return</span>&nbsp;<span class="ident" id="6310641">v</span><br>
<span class="lineno"></span><span class="op" id="6310643">}</span>
</div>
</body>
</html>
