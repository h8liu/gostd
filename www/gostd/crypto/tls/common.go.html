<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4172247">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4172302">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4172356">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4172407">package</span>&nbsp;<span class="ident" id="4172415">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4172420">import</span>&nbsp;<span class="op" id="4172427">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172430">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172448">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172458">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172473">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172488">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172495">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172501">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172513">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172524">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4172532">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4172539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4172542">const</span>&nbsp;<span class="op" id="4172548">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172551">VersionSSL30</span>&nbsp;<span class="op" id="4172564">=</span>&nbsp;<span class="num" id="4172566">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172574">VersionTLS10</span>&nbsp;<span class="op" id="4172587">=</span>&nbsp;<span class="num" id="4172589">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172597">VersionTLS11</span>&nbsp;<span class="op" id="4172610">=</span>&nbsp;<span class="num" id="4172612">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172620">VersionTLS12</span>&nbsp;<span class="op" id="4172633">=</span>&nbsp;<span class="num" id="4172635">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4172642">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4172645">const</span>&nbsp;<span class="op" id="4172651">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172654">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4172670">=</span>&nbsp;<span class="num" id="4172672">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4172685">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172722">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4172738">=</span>&nbsp;<span class="num" id="4172740">16384</span>&nbsp;<span class="op" id="4172746">+</span>&nbsp;<span class="num" id="4172748">2048</span>&nbsp;<span class="comment" id="4172753">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172791">recordHeaderLen</span>&nbsp;<span class="op" id="4172807">=</span>&nbsp;<span class="num" id="4172809">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4172822">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172847">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4172863">=</span>&nbsp;<span class="num" id="4172865">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4172878">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172936">minVersion</span>&nbsp;<span class="op" id="4172947">=</span>&nbsp;<span class="ident" id="4172949">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4172963">maxVersion</span>&nbsp;<span class="op" id="4172974">=</span>&nbsp;<span class="ident" id="4172976">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="4172989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4172992">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4173013">type</span>&nbsp;<span class="ident" id="4173018">recordType</span>&nbsp;<span class="builtintype" id="4173029">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4173036">const</span>&nbsp;<span class="op" id="4173042">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173045">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4173072">recordType</span>&nbsp;<span class="op" id="4173083">=</span>&nbsp;<span class="num" id="4173085">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173089">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173116">recordType</span>&nbsp;<span class="op" id="4173127">=</span>&nbsp;<span class="num" id="4173129">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173133">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173160">recordType</span>&nbsp;<span class="op" id="4173171">=</span>&nbsp;<span class="num" id="4173173">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173177">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4173204">recordType</span>&nbsp;<span class="op" id="4173215">=</span>&nbsp;<span class="num" id="4173217">23</span><br>
<span class="lineno">45</span><span class="op" id="4173220">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4173223">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4173255">const</span>&nbsp;<span class="op" id="4173261">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173264">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173287">uint8</span>&nbsp;<span class="op" id="4173293">=</span>&nbsp;<span class="num" id="4173295">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173298">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173321">uint8</span>&nbsp;<span class="op" id="4173327">=</span>&nbsp;<span class="num" id="4173329">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173332">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173355">uint8</span>&nbsp;<span class="op" id="4173361">=</span>&nbsp;<span class="num" id="4173363">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173366">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173389">uint8</span>&nbsp;<span class="op" id="4173395">=</span>&nbsp;<span class="num" id="4173397">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173401">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4173424">uint8</span>&nbsp;<span class="op" id="4173430">=</span>&nbsp;<span class="num" id="4173432">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173436">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4173459">uint8</span>&nbsp;<span class="op" id="4173465">=</span>&nbsp;<span class="num" id="4173467">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173471">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173494">uint8</span>&nbsp;<span class="op" id="4173500">=</span>&nbsp;<span class="num" id="4173502">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173506">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4173529">uint8</span>&nbsp;<span class="op" id="4173535">=</span>&nbsp;<span class="num" id="4173537">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173541">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4173564">uint8</span>&nbsp;<span class="op" id="4173570">=</span>&nbsp;<span class="num" id="4173572">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173576">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173599">uint8</span>&nbsp;<span class="op" id="4173605">=</span>&nbsp;<span class="num" id="4173607">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173611">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4173634">uint8</span>&nbsp;<span class="op" id="4173640">=</span>&nbsp;<span class="num" id="4173642">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173646">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173669">uint8</span>&nbsp;<span class="op" id="4173675">=</span>&nbsp;<span class="num" id="4173677">67</span>&nbsp;<span class="comment" id="4173680">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4173701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4173704">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4173730">const</span>&nbsp;<span class="op" id="4173736">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173739">compressionNone</span>&nbsp;<span class="builtintype" id="4173755">uint8</span>&nbsp;<span class="op" id="4173761">=</span>&nbsp;<span class="num" id="4173763">0</span><br>
<span class="lineno"></span><span class="op" id="4173765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4173768">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4173793">const</span>&nbsp;<span class="op" id="4173799">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173802">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173831">uint16</span>&nbsp;<span class="op" id="4173838">=</span>&nbsp;<span class="num" id="4173840">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173843">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173872">uint16</span>&nbsp;<span class="op" id="4173879">=</span>&nbsp;<span class="num" id="4173881">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173884">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173913">uint16</span>&nbsp;<span class="op" id="4173920">=</span>&nbsp;<span class="num" id="4173922">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173926">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4173955">uint16</span>&nbsp;<span class="op" id="4173962">=</span>&nbsp;<span class="num" id="4173964">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4173968">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4173997">uint16</span>&nbsp;<span class="op" id="4174004">=</span>&nbsp;<span class="num" id="4174006">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174010">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4174039">uint16</span>&nbsp;<span class="op" id="4174046">=</span>&nbsp;<span class="num" id="4174048">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174052">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4174081">uint16</span>&nbsp;<span class="op" id="4174088">=</span>&nbsp;<span class="num" id="4174090">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174094">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4174123">uint16</span>&nbsp;<span class="op" id="4174130">=</span>&nbsp;<span class="num" id="4174132">13172</span>&nbsp;<span class="comment" id="4174138">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174160">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4174189">uint16</span>&nbsp;<span class="op" id="4174196">=</span>&nbsp;<span class="num" id="4174198">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4174205">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4174208">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4174245">const</span>&nbsp;<span class="op" id="4174251">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174254">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4174272">uint16</span>&nbsp;<span class="op" id="4174279">=</span>&nbsp;<span class="num" id="4174281">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4174288">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4174291">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4174361">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4174447">type</span>&nbsp;<span class="ident" id="4174452">CurveID</span>&nbsp;<span class="builtintype" id="4174460">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4174468">const</span>&nbsp;<span class="op" id="4174474">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174477">CurveP256</span>&nbsp;<span class="ident" id="4174487">CurveID</span>&nbsp;<span class="op" id="4174495">=</span>&nbsp;<span class="num" id="4174497">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174501">CurveP384</span>&nbsp;<span class="ident" id="4174511">CurveID</span>&nbsp;<span class="op" id="4174519">=</span>&nbsp;<span class="num" id="4174521">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174525">CurveP521</span>&nbsp;<span class="ident" id="4174535">CurveID</span>&nbsp;<span class="op" id="4174543">=</span>&nbsp;<span class="num" id="4174545">25</span><br>
<span class="lineno"></span><span class="op" id="4174548">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4174551">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4174587">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4174673">const</span>&nbsp;<span class="op" id="4174679">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174682">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4174706">uint8</span>&nbsp;<span class="op" id="4174712">=</span>&nbsp;<span class="num" id="4174714">0</span><br>
<span class="lineno">100</span><span class="op" id="4174716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4174719">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4174759">const</span>&nbsp;<span class="op" id="4174765">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174768">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4174783">uint8</span>&nbsp;<span class="op" id="4174789">=</span>&nbsp;<span class="num" id="4174791">1</span><br>
<span class="lineno">105</span><span class="op" id="4174793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4174796">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4174845">const</span>&nbsp;<span class="op" id="4174851">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174854">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174873">=</span>&nbsp;<span class="num" id="4174875">1</span>&nbsp;<span class="comment" id="4174877">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174917">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4174936">=</span>&nbsp;<span class="num" id="4174938">2</span>&nbsp;<span class="comment" id="4174940">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4174979">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4174998">=</span>&nbsp;<span class="num" id="4175000">3</span>&nbsp;<span class="comment" id="4175002">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175047">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4175066">=</span>&nbsp;<span class="num" id="4175068">4</span>&nbsp;<span class="comment" id="4175070">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4175116">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175152">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4175175">=</span>&nbsp;<span class="num" id="4175177">64</span>&nbsp;<span class="comment" id="4175180">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175257">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4175280">=</span>&nbsp;<span class="num" id="4175282">65</span>&nbsp;<span class="comment" id="4175285">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175359">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4175382">=</span>&nbsp;<span class="num" id="4175384">66</span>&nbsp;<span class="comment" id="4175387">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4175464">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4175510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175513">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4175573">const</span>&nbsp;<span class="op" id="4175579">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175582">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4175593">uint8</span>&nbsp;<span class="op" id="4175599">=</span>&nbsp;<span class="num" id="4175601">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175604">hashSHA256</span>&nbsp;<span class="builtintype" id="4175615">uint8</span>&nbsp;<span class="op" id="4175621">=</span>&nbsp;<span class="num" id="4175623">4</span><br>
<span class="lineno"></span><span class="op" id="4175625">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175628">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4175694">const</span>&nbsp;<span class="op" id="4175700">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175703">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4175718">uint8</span>&nbsp;<span class="op" id="4175724">=</span>&nbsp;<span class="num" id="4175726">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175729">signatureECDSA</span>&nbsp;<span class="builtintype" id="4175744">uint8</span>&nbsp;<span class="op" id="4175750">=</span>&nbsp;<span class="num" id="4175752">3</span><br>
<span class="lineno"></span><span class="op" id="4175754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4175757">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4175836">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4175864">type</span>&nbsp;<span class="ident" id="4175869">signatureAndHash</span>&nbsp;<span class="keyword" id="4175886">struct</span>&nbsp;<span class="op" id="4175893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4175896">hash</span><span class="op" id="4175900">,</span>&nbsp;<span class="ident" id="4175902">signature</span>&nbsp;<span class="builtintype" id="4175912">uint8</span><br>
<span class="lineno"></span><span class="op" id="4175918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4175921">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4175999">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4176066">var</span>&nbsp;<span class="ident" id="4176070">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4176102">=</span>&nbsp;<span class="op" id="4176104">[</span><span class="op" id="4176105">]</span><span class="ident" id="4176106">signatureAndHash</span><span class="op" id="4176122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176125">{</span><span class="ident" id="4176126">hashSHA256</span><span class="op" id="4176136">,</span>&nbsp;<span class="ident" id="4176138">signatureRSA</span><span class="op" id="4176150">}</span><span class="op" id="4176151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176154">{</span><span class="ident" id="4176155">hashSHA256</span><span class="op" id="4176165">,</span>&nbsp;<span class="ident" id="4176167">signatureECDSA</span><span class="op" id="4176181">}</span><span class="op" id="4176182">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176185">{</span><span class="ident" id="4176186">hashSHA1</span><span class="op" id="4176194">,</span>&nbsp;<span class="ident" id="4176196">signatureRSA</span><span class="op" id="4176208">}</span><span class="op" id="4176209">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176212">{</span><span class="ident" id="4176213">hashSHA1</span><span class="op" id="4176221">,</span>&nbsp;<span class="ident" id="4176223">signatureECDSA</span><span class="op" id="4176237">}</span><span class="op" id="4176238">,</span><br>
<span class="lineno"></span><span class="op" id="4176240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4176243">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4176317">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4176382">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4176405">var</span>&nbsp;<span class="ident" id="4176409">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4176448">=</span>&nbsp;<span class="op" id="4176450">[</span><span class="op" id="4176451">]</span><span class="ident" id="4176452">signatureAndHash</span><span class="op" id="4176468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176471">{</span><span class="ident" id="4176472">hashSHA256</span><span class="op" id="4176482">,</span>&nbsp;<span class="ident" id="4176484">signatureRSA</span><span class="op" id="4176496">}</span><span class="op" id="4176497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4176500">{</span><span class="ident" id="4176501">hashSHA256</span><span class="op" id="4176511">,</span>&nbsp;<span class="ident" id="4176513">signatureECDSA</span><span class="op" id="4176527">}</span><span class="op" id="4176528">,</span><br>
<span class="lineno">155</span><span class="op" id="4176530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4176533">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4176600">type</span>&nbsp;<span class="ident" id="4176605">ConnectionState</span>&nbsp;<span class="keyword" id="4176621">struct</span>&nbsp;<span class="op" id="4176628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176631">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4176658">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4176680">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176739">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4176766">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4176788">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176818">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4176845">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4176867">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4176916">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4176943">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4176965">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177021">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4177048">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177070">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177124">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4177151">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177173">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177222">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4177249">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177271">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177334">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177361">[</span><span class="op" id="4177362">]</span><span class="op" id="4177363">*</span><span class="ident" id="4177364">x509</span><span class="op" id="4177368">.</span><span class="ident" id="4177369">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4177383">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177430">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4177457">[</span><span class="op" id="4177458">]</span><span class="op" id="4177459">[</span><span class="op" id="4177460">]</span><span class="op" id="4177461">*</span><span class="ident" id="4177462">x509</span><span class="op" id="4177466">.</span><span class="ident" id="4177467">Certificate</span>&nbsp;<span class="comment" id="4177479">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177528">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177599">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177665">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177725">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177798">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4177864">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4177898">TLSUnique</span>&nbsp;<span class="op" id="4177908">[</span><span class="op" id="4177909">]</span><span class="builtintype" id="4177910">byte</span><br>
<span class="lineno"></span><span class="op" id="4177915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4177918">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4177983">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4178013">type</span>&nbsp;<span class="ident" id="4178018">ClientAuthType</span>&nbsp;<span class="builtintype" id="4178033">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4178038">const</span>&nbsp;<span class="op" id="4178044">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178047">NoClientCert</span>&nbsp;<span class="ident" id="4178060">ClientAuthType</span>&nbsp;<span class="op" id="4178075">=</span>&nbsp;<span class="ident" id="4178077">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178083">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178102">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178124">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178149">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4178176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4178179">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4178252">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4178265">type</span>&nbsp;<span class="ident" id="4178270">ClientSessionState</span>&nbsp;<span class="keyword" id="4178289">struct</span>&nbsp;<span class="op" id="4178296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178299">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4178318">[</span><span class="op" id="4178319">]</span><span class="builtintype" id="4178320">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178338">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178399">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4178418">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178438">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178485">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4178504">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178524">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178567">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4178586">[</span><span class="op" id="4178587">]</span><span class="builtintype" id="4178588">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4178606">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4178663">serverCertificates</span>&nbsp;<span class="op" id="4178682">[</span><span class="op" id="4178683">]</span><span class="op" id="4178684">*</span><span class="ident" id="4178685">x509</span><span class="op" id="4178689">.</span><span class="ident" id="4178690">Certificate</span>&nbsp;<span class="comment" id="4178702">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4178747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4178750">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4178830">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4178909">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4178983">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4178998">type</span>&nbsp;<span class="ident" id="4179003">ClientSessionCache</span>&nbsp;<span class="keyword" id="4179022">interface</span>&nbsp;<span class="op" id="4179032">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179035">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179108">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179152">Get</span><span class="op" id="4179155">(</span><span class="ident" id="4179156">sessionKey</span>&nbsp;<span class="builtintype" id="4179167">string</span><span class="op" id="4179173">)</span>&nbsp;<span class="op" id="4179175">(</span><span class="ident" id="4179176">session</span>&nbsp;<span class="op" id="4179184">*</span><span class="ident" id="4179185">ClientSessionState</span><span class="op" id="4179203">,</span>&nbsp;<span class="ident" id="4179205">ok</span>&nbsp;<span class="builtintype" id="4179208">bool</span><span class="op" id="4179212">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179216">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179285">Put</span><span class="op" id="4179288">(</span><span class="ident" id="4179289">sessionKey</span>&nbsp;<span class="builtintype" id="4179300">string</span><span class="op" id="4179306">,</span>&nbsp;<span class="ident" id="4179308">cs</span>&nbsp;<span class="op" id="4179311">*</span><span class="ident" id="4179312">ClientSessionState</span><span class="op" id="4179330">)</span><br>
<span class="lineno"></span><span class="op" id="4179332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4179335">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4179414">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4179477">type</span>&nbsp;<span class="ident" id="4179482">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4179498">struct</span>&nbsp;<span class="op" id="4179505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179508">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179578">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179609">CipherSuites</span>&nbsp;<span class="op" id="4179622">[</span><span class="op" id="4179623">]</span><span class="builtintype" id="4179624">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179633">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179705">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179776">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179805">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4179858">ServerName</span>&nbsp;<span class="builtintype" id="4179869">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179878">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4179949">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180014">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180047">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180102">SupportedCurves</span>&nbsp;<span class="op" id="4180118">[</span><span class="op" id="4180119">]</span><span class="ident" id="4180120">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180130">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180199">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180272">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180295">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180350">SupportedPoints</span>&nbsp;<span class="op" id="4180366">[</span><span class="op" id="4180367">]</span><span class="builtintype" id="4180368">uint8</span><br>
<span class="lineno"></span><span class="op" id="4180374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4180377">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4180444">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4180506">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4180573">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4180587">type</span>&nbsp;<span class="ident" id="4180592">Config</span>&nbsp;<span class="keyword" id="4180599">struct</span>&nbsp;<span class="op" id="4180606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180609">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180678">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180750">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180767">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180827">Rand</span>&nbsp;<span class="ident" id="4180832">io</span><span class="op" id="4180834">.</span><span class="ident" id="4180835">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180844">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180920">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4180959">Time</span>&nbsp;<span class="keyword" id="4180964">func</span><span class="op" id="4180968">(</span><span class="op" id="4180969">)</span>&nbsp;<span class="ident" id="4180971">time</span><span class="op" id="4180975">.</span><span class="ident" id="4180976">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4180983">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181040">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181092">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181157">Certificates</span>&nbsp;<span class="op" id="4181170">[</span><span class="op" id="4181171">]</span><span class="ident" id="4181172">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181186">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181254">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181320">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181389">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181427">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181497">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181522">NameToCertificate</span>&nbsp;<span class="keyword" id="4181540">map</span><span class="op" id="4181543">[</span><span class="builtintype" id="4181544">string</span><span class="op" id="4181550">]</span><span class="op" id="4181551">*</span><span class="ident" id="4181552">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181566">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181626">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181697">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181753">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181825">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4181835">GetCertificate</span>&nbsp;<span class="keyword" id="4181850">func</span><span class="op" id="4181854">(</span><span class="ident" id="4181855">clientHello</span>&nbsp;<span class="op" id="4181867">*</span><span class="ident" id="4181868">ClientHelloInfo</span><span class="op" id="4181883">)</span>&nbsp;<span class="op" id="4181885">(</span><span class="op" id="4181886">*</span><span class="ident" id="4181887">Certificate</span><span class="op" id="4181898">,</span>&nbsp;<span class="builtintype" id="4181900">error</span><span class="op" id="4181905">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181909">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4181969">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182026">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182082">RootCAs</span>&nbsp;<span class="op" id="4182090">*</span><span class="ident" id="4182091">x509</span><span class="op" id="4182095">.</span><span class="ident" id="4182096">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182107">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182175">NextProtos</span>&nbsp;<span class="op" id="4182186">[</span><span class="op" id="4182187">]</span><span class="builtintype" id="4182188">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182197">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182259">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182332">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182390">ServerName</span>&nbsp;<span class="builtintype" id="4182401">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182410">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182460">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182520">ClientAuth</span>&nbsp;<span class="ident" id="4182531">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182548">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182610">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182674">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4182707">ClientCAs</span>&nbsp;<span class="op" id="4182717">*</span><span class="ident" id="4182718">x509</span><span class="op" id="4182722">.</span><span class="ident" id="4182723">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182734">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182796">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182842">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182905">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4182972">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183039">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183081">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4183100">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183107">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183178">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183249">CipherSuites</span>&nbsp;<span class="op" id="4183262">[</span><span class="op" id="4183263">]</span><span class="builtintype" id="4183264">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183273">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183342">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183414">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183485">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183537">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4183562">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183569">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183641">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4183667">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4183690">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183697">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183760">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183822">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183873">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183877">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4183947">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184006">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184069">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4184117">SessionTicketKey</span>&nbsp;<span class="op" id="4184134">[</span><span class="num" id="4184135">32</span><span class="op" id="4184137">]</span><span class="builtintype" id="4184138">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184145">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184219">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4184235">ClientSessionCache</span>&nbsp;<span class="ident" id="4184254">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184275">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184347">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4184396">MinVersion</span>&nbsp;<span class="builtintype" id="4184407">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184416">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184488">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184561">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4184593">MaxVersion</span>&nbsp;<span class="builtintype" id="4184604">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184613">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184684">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184756">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4184769">CurvePreferences</span>&nbsp;<span class="op" id="4184786">[</span><span class="op" id="4184787">]</span><span class="ident" id="4184788">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4184798">serverInitOnce</span>&nbsp;<span class="ident" id="4184813">sync</span><span class="op" id="4184817">.</span><span class="ident" id="4184818">Once</span>&nbsp;<span class="comment" id="4184823">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4184862">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4184865">func</span>&nbsp;<span class="op" id="4184870">(</span><span class="ident" id="4184871">c</span>&nbsp;<span class="op" id="4184873">*</span><span class="ident" id="4184874">Config</span><span class="op" id="4184880">)</span>&nbsp;<span class="ident" id="4184882">serverInit</span><span class="op" id="4184892">(</span><span class="op" id="4184893">)</span>&nbsp;<span class="op" id="4184895">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4184898">if</span>&nbsp;<span class="ident" id="4184901">c</span><span class="op" id="4184902">.</span><span class="ident" id="4184903">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4184926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4184930">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4184938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4184942">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185006">for</span>&nbsp;<span class="ident" id="4185010">_</span><span class="op" id="4185011">,</span>&nbsp;<span class="ident" id="4185013">b</span>&nbsp;<span class="op" id="4185015">:=</span>&nbsp;<span class="keyword" id="4185018">range</span>&nbsp;<span class="ident" id="4185024">c</span><span class="op" id="4185025">.</span><span class="ident" id="4185026">SessionTicketKey</span>&nbsp;<span class="op" id="4185043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185047">if</span>&nbsp;<span class="ident" id="4185050">b</span>&nbsp;<span class="op" id="4185052">!=</span>&nbsp;<span class="num" id="4185055">0</span>&nbsp;<span class="op" id="4185057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185062">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185074">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185078">if</span>&nbsp;<span class="ident" id="4185081">_</span><span class="op" id="4185082">,</span>&nbsp;<span class="ident" id="4185084">err</span>&nbsp;<span class="op" id="4185088">:=</span>&nbsp;<span class="ident" id="4185091">io</span><span class="op" id="4185093">.</span><span class="ident" id="4185094">ReadFull</span><span class="op" id="4185102">(</span><span class="ident" id="4185103">c</span><span class="op" id="4185104">.</span><span class="ident" id="4185105">rand</span><span class="op" id="4185109">(</span><span class="op" id="4185110">)</span><span class="op" id="4185111">,</span>&nbsp;<span class="ident" id="4185113">c</span><span class="op" id="4185114">.</span><span class="ident" id="4185115">SessionTicketKey</span><span class="op" id="4185131">[</span><span class="op" id="4185132">:</span><span class="op" id="4185133">]</span><span class="op" id="4185134">)</span><span class="op" id="4185135">;</span>&nbsp;<span class="ident" id="4185137">err</span>&nbsp;<span class="op" id="4185141">!=</span>&nbsp;<span class="builtintype" id="4185144">nil</span>&nbsp;<span class="op" id="4185148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4185152">c</span><span class="op" id="4185153">.</span><span class="ident" id="4185154">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4185177">=</span>&nbsp;<span class="builtintype" id="4185179">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185185">}</span><br>
<span class="lineno"></span><span class="op" id="4185187">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4185190">func</span>&nbsp;<span class="op" id="4185195">(</span><span class="ident" id="4185196">c</span>&nbsp;<span class="op" id="4185198">*</span><span class="ident" id="4185199">Config</span><span class="op" id="4185205">)</span>&nbsp;<span class="ident" id="4185207">rand</span><span class="op" id="4185211">(</span><span class="op" id="4185212">)</span>&nbsp;<span class="ident" id="4185214">io</span><span class="op" id="4185216">.</span><span class="ident" id="4185217">Reader</span>&nbsp;<span class="op" id="4185224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4185227">r</span>&nbsp;<span class="op" id="4185229">:=</span>&nbsp;<span class="ident" id="4185232">c</span><span class="op" id="4185233">.</span><span class="ident" id="4185234">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185240">if</span>&nbsp;<span class="ident" id="4185243">r</span>&nbsp;<span class="op" id="4185245">==</span>&nbsp;<span class="builtintype" id="4185248">nil</span>&nbsp;<span class="op" id="4185252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185256">return</span>&nbsp;<span class="ident" id="4185263">rand</span><span class="op" id="4185267">.</span><span class="ident" id="4185268">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185279">return</span>&nbsp;<span class="ident" id="4185286">r</span><br>
<span class="lineno"></span><span class="op" id="4185288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4185291">func</span>&nbsp;<span class="op" id="4185296">(</span><span class="ident" id="4185297">c</span>&nbsp;<span class="op" id="4185299">*</span><span class="ident" id="4185300">Config</span><span class="op" id="4185306">)</span>&nbsp;<span class="ident" id="4185308">time</span><span class="op" id="4185312">(</span><span class="op" id="4185313">)</span>&nbsp;<span class="ident" id="4185315">time</span><span class="op" id="4185319">.</span><span class="ident" id="4185320">Time</span>&nbsp;<span class="op" id="4185325">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4185328">t</span>&nbsp;<span class="op" id="4185330">:=</span>&nbsp;<span class="ident" id="4185333">c</span><span class="op" id="4185334">.</span><span class="ident" id="4185335">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185341">if</span>&nbsp;<span class="ident" id="4185344">t</span>&nbsp;<span class="op" id="4185346">==</span>&nbsp;<span class="builtintype" id="4185349">nil</span>&nbsp;<span class="op" id="4185353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4185357">t</span>&nbsp;<span class="op" id="4185359">=</span>&nbsp;<span class="ident" id="4185361">time</span><span class="op" id="4185365">.</span><span class="ident" id="4185366">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185374">return</span>&nbsp;<span class="ident" id="4185381">t</span><span class="op" id="4185382">(</span><span class="op" id="4185383">)</span><br>
<span class="lineno">380</span><span class="op" id="4185385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4185388">func</span>&nbsp;<span class="op" id="4185393">(</span><span class="ident" id="4185394">c</span>&nbsp;<span class="op" id="4185396">*</span><span class="ident" id="4185397">Config</span><span class="op" id="4185403">)</span>&nbsp;<span class="ident" id="4185405">cipherSuites</span><span class="op" id="4185417">(</span><span class="op" id="4185418">)</span>&nbsp;<span class="op" id="4185420">[</span><span class="op" id="4185421">]</span><span class="builtintype" id="4185422">uint16</span>&nbsp;<span class="op" id="4185429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4185432">s</span>&nbsp;<span class="op" id="4185434">:=</span>&nbsp;<span class="ident" id="4185437">c</span><span class="op" id="4185438">.</span><span class="ident" id="4185439">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185453">if</span>&nbsp;<span class="ident" id="4185456">s</span>&nbsp;<span class="op" id="4185458">==</span>&nbsp;<span class="builtintype" id="4185461">nil</span>&nbsp;<span class="op" id="4185465">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4185469">s</span>&nbsp;<span class="op" id="4185471">=</span>&nbsp;<span class="ident" id="4185473">defaultCipherSuites</span><span class="op" id="4185492">(</span><span class="op" id="4185493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185499">return</span>&nbsp;<span class="ident" id="4185506">s</span><br>
<span class="lineno"></span><span class="op" id="4185508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4185511">func</span>&nbsp;<span class="op" id="4185516">(</span><span class="ident" id="4185517">c</span>&nbsp;<span class="op" id="4185519">*</span><span class="ident" id="4185520">Config</span><span class="op" id="4185526">)</span>&nbsp;<span class="ident" id="4185528">minVersion</span><span class="op" id="4185538">(</span><span class="op" id="4185539">)</span>&nbsp;<span class="builtintype" id="4185541">uint16</span>&nbsp;<span class="op" id="4185548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185551">if</span>&nbsp;<span class="ident" id="4185554">c</span>&nbsp;<span class="op" id="4185556">==</span>&nbsp;<span class="builtintype" id="4185559">nil</span>&nbsp;<span class="op" id="4185563">||</span>&nbsp;<span class="ident" id="4185566">c</span><span class="op" id="4185567">.</span><span class="ident" id="4185568">MinVersion</span>&nbsp;<span class="op" id="4185579">==</span>&nbsp;<span class="num" id="4185582">0</span>&nbsp;<span class="op" id="4185584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185588">return</span>&nbsp;<span class="ident" id="4185595">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185610">return</span>&nbsp;<span class="ident" id="4185617">c</span><span class="op" id="4185618">.</span><span class="ident" id="4185619">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="4185630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4185633">func</span>&nbsp;<span class="op" id="4185638">(</span><span class="ident" id="4185639">c</span>&nbsp;<span class="op" id="4185641">*</span><span class="ident" id="4185642">Config</span><span class="op" id="4185648">)</span>&nbsp;<span class="ident" id="4185650">maxVersion</span><span class="op" id="4185660">(</span><span class="op" id="4185661">)</span>&nbsp;<span class="builtintype" id="4185663">uint16</span>&nbsp;<span class="op" id="4185670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185673">if</span>&nbsp;<span class="ident" id="4185676">c</span>&nbsp;<span class="op" id="4185678">==</span>&nbsp;<span class="builtintype" id="4185681">nil</span>&nbsp;<span class="op" id="4185685">||</span>&nbsp;<span class="ident" id="4185688">c</span><span class="op" id="4185689">.</span><span class="ident" id="4185690">MaxVersion</span>&nbsp;<span class="op" id="4185701">==</span>&nbsp;<span class="num" id="4185704">0</span>&nbsp;<span class="op" id="4185706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185710">return</span>&nbsp;<span class="ident" id="4185717">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185732">return</span>&nbsp;<span class="ident" id="4185739">c</span><span class="op" id="4185740">.</span><span class="ident" id="4185741">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="4185752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4185755">var</span>&nbsp;<span class="ident" id="4185759">defaultCurvePreferences</span>&nbsp;<span class="op" id="4185783">=</span>&nbsp;<span class="op" id="4185785">[</span><span class="op" id="4185786">]</span><span class="ident" id="4185787">CurveID</span><span class="op" id="4185794">{</span><span class="ident" id="4185795">CurveP256</span><span class="op" id="4185804">,</span>&nbsp;<span class="ident" id="4185806">CurveP384</span><span class="op" id="4185815">,</span>&nbsp;<span class="ident" id="4185817">CurveP521</span><span class="op" id="4185826">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4185829">func</span>&nbsp;<span class="op" id="4185834">(</span><span class="ident" id="4185835">c</span>&nbsp;<span class="op" id="4185837">*</span><span class="ident" id="4185838">Config</span><span class="op" id="4185844">)</span>&nbsp;<span class="ident" id="4185846">curvePreferences</span><span class="op" id="4185862">(</span><span class="op" id="4185863">)</span>&nbsp;<span class="op" id="4185865">[</span><span class="op" id="4185866">]</span><span class="ident" id="4185867">CurveID</span>&nbsp;<span class="op" id="4185875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185878">if</span>&nbsp;<span class="ident" id="4185881">c</span>&nbsp;<span class="op" id="4185883">==</span>&nbsp;<span class="builtintype" id="4185886">nil</span>&nbsp;<span class="op" id="4185890">||</span>&nbsp;<span class="builtinfunc" id="4185893">len</span><span class="op" id="4185896">(</span><span class="ident" id="4185897">c</span><span class="op" id="4185898">.</span><span class="ident" id="4185899">CurvePreferences</span><span class="op" id="4185915">)</span>&nbsp;<span class="op" id="4185917">==</span>&nbsp;<span class="num" id="4185920">0</span>&nbsp;<span class="op" id="4185922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185926">return</span>&nbsp;<span class="ident" id="4185933">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4185958">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4185961">return</span>&nbsp;<span class="ident" id="4185968">c</span><span class="op" id="4185969">.</span><span class="ident" id="4185970">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="4185987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4185990">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4186064">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4186088">func</span>&nbsp;<span class="op" id="4186093">(</span><span class="ident" id="4186094">c</span>&nbsp;<span class="op" id="4186096">*</span><span class="ident" id="4186097">Config</span><span class="op" id="4186103">)</span>&nbsp;<span class="ident" id="4186105">mutualVersion</span><span class="op" id="4186118">(</span><span class="ident" id="4186119">vers</span>&nbsp;<span class="builtintype" id="4186124">uint16</span><span class="op" id="4186130">)</span>&nbsp;<span class="op" id="4186132">(</span><span class="builtintype" id="4186133">uint16</span><span class="op" id="4186139">,</span>&nbsp;<span class="builtintype" id="4186141">bool</span><span class="op" id="4186145">)</span>&nbsp;<span class="op" id="4186147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4186150">minVersion</span>&nbsp;<span class="op" id="4186161">:=</span>&nbsp;<span class="ident" id="4186164">c</span><span class="op" id="4186165">.</span><span class="ident" id="4186166">minVersion</span><span class="op" id="4186176">(</span><span class="op" id="4186177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4186180">maxVersion</span>&nbsp;<span class="op" id="4186191">:=</span>&nbsp;<span class="ident" id="4186194">c</span><span class="op" id="4186195">.</span><span class="ident" id="4186196">maxVersion</span><span class="op" id="4186206">(</span><span class="op" id="4186207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186211">if</span>&nbsp;<span class="ident" id="4186214">vers</span>&nbsp;<span class="op" id="4186219">&lt;</span>&nbsp;<span class="ident" id="4186221">minVersion</span>&nbsp;<span class="op" id="4186232">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186236">return</span>&nbsp;<span class="num" id="4186243">0</span><span class="op" id="4186244">,</span>&nbsp;<span class="builtintype" id="4186246">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4186253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186256">if</span>&nbsp;<span class="ident" id="4186259">vers</span>&nbsp;<span class="op" id="4186264">&gt;</span>&nbsp;<span class="ident" id="4186266">maxVersion</span>&nbsp;<span class="op" id="4186277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4186281">vers</span>&nbsp;<span class="op" id="4186286">=</span>&nbsp;<span class="ident" id="4186288">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4186300">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186303">return</span>&nbsp;<span class="ident" id="4186310">vers</span><span class="op" id="4186314">,</span>&nbsp;<span class="builtintype" id="4186316">true</span><br>
<span class="lineno"></span><span class="op" id="4186321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4186324">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4186402">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4186456">func</span>&nbsp;<span class="op" id="4186461">(</span><span class="ident" id="4186462">c</span>&nbsp;<span class="op" id="4186464">*</span><span class="ident" id="4186465">Config</span><span class="op" id="4186471">)</span>&nbsp;<span class="ident" id="4186473">getCertificate</span><span class="op" id="4186487">(</span><span class="ident" id="4186488">clientHello</span>&nbsp;<span class="op" id="4186500">*</span><span class="ident" id="4186501">ClientHelloInfo</span><span class="op" id="4186516">)</span>&nbsp;<span class="op" id="4186518">(</span><span class="op" id="4186519">*</span><span class="ident" id="4186520">Certificate</span><span class="op" id="4186531">,</span>&nbsp;<span class="builtintype" id="4186533">error</span><span class="op" id="4186538">)</span>&nbsp;<span class="op" id="4186540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186543">if</span>&nbsp;<span class="ident" id="4186546">c</span><span class="op" id="4186547">.</span><span class="ident" id="4186548">GetCertificate</span>&nbsp;<span class="op" id="4186563">!=</span>&nbsp;<span class="builtintype" id="4186566">nil</span>&nbsp;<span class="op" id="4186570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4186574">cert</span><span class="op" id="4186578">,</span>&nbsp;<span class="ident" id="4186580">err</span>&nbsp;<span class="op" id="4186584">:=</span>&nbsp;<span class="ident" id="4186587">c</span><span class="op" id="4186588">.</span><span class="ident" id="4186589">GetCertificate</span><span class="op" id="4186603">(</span><span class="ident" id="4186604">clientHello</span><span class="op" id="4186615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186619">if</span>&nbsp;<span class="ident" id="4186622">cert</span>&nbsp;<span class="op" id="4186627">!=</span>&nbsp;<span class="builtintype" id="4186630">nil</span>&nbsp;<span class="op" id="4186634">||</span>&nbsp;<span class="ident" id="4186637">err</span>&nbsp;<span class="op" id="4186641">!=</span>&nbsp;<span class="builtintype" id="4186644">nil</span>&nbsp;<span class="op" id="4186648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186653">return</span>&nbsp;<span class="ident" id="4186660">cert</span><span class="op" id="4186664">,</span>&nbsp;<span class="ident" id="4186666">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4186672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4186675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186679">if</span>&nbsp;<span class="builtinfunc" id="4186682">len</span><span class="op" id="4186685">(</span><span class="ident" id="4186686">c</span><span class="op" id="4186687">.</span><span class="ident" id="4186688">Certificates</span><span class="op" id="4186700">)</span>&nbsp;<span class="op" id="4186702">==</span>&nbsp;<span class="num" id="4186705">1</span>&nbsp;<span class="op" id="4186707">||</span>&nbsp;<span class="ident" id="4186710">c</span><span class="op" id="4186711">.</span><span class="ident" id="4186712">NameToCertificate</span>&nbsp;<span class="op" id="4186730">==</span>&nbsp;<span class="builtintype" id="4186733">nil</span>&nbsp;<span class="op" id="4186737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4186741">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186799">return</span>&nbsp;<span class="op" id="4186806">&amp;</span><span class="ident" id="4186807">c</span><span class="op" id="4186808">.</span><span class="ident" id="4186809">Certificates</span><span class="op" id="4186821">[</span><span class="num" id="4186822">0</span><span class="op" id="4186823">]</span><span class="op" id="4186824">,</span>&nbsp;<span class="builtintype" id="4186826">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4186831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4186835">name</span>&nbsp;<span class="op" id="4186840">:=</span>&nbsp;<span class="ident" id="4186843">strings</span><span class="op" id="4186850">.</span><span class="ident" id="4186851">ToLower</span><span class="op" id="4186858">(</span><span class="ident" id="4186859">clientHello</span><span class="op" id="4186870">.</span><span class="ident" id="4186871">ServerName</span><span class="op" id="4186881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186884">for</span>&nbsp;<span class="builtinfunc" id="4186888">len</span><span class="op" id="4186891">(</span><span class="ident" id="4186892">name</span><span class="op" id="4186896">)</span>&nbsp;<span class="op" id="4186898">&gt;</span>&nbsp;<span class="num" id="4186900">0</span>&nbsp;<span class="op" id="4186902">&amp;&amp;</span>&nbsp;<span class="ident" id="4186905">name</span><span class="op" id="4186909">[</span><span class="builtinfunc" id="4186910">len</span><span class="op" id="4186913">(</span><span class="ident" id="4186914">name</span><span class="op" id="4186918">)</span><span class="op" id="4186919">-</span><span class="num" id="4186920">1</span><span class="op" id="4186921">]</span>&nbsp;<span class="op" id="4186923">==</span>&nbsp;<span class="string" id="4186926">&#39;.&#39;</span>&nbsp;<span class="op" id="4186930">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4186934">name</span>&nbsp;<span class="op" id="4186939">=</span>&nbsp;<span class="ident" id="4186941">name</span><span class="op" id="4186945">[</span><span class="op" id="4186946">:</span><span class="builtinfunc" id="4186947">len</span><span class="op" id="4186950">(</span><span class="ident" id="4186951">name</span><span class="op" id="4186955">)</span><span class="op" id="4186956">-</span><span class="num" id="4186957">1</span><span class="op" id="4186958">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4186961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4186965">if</span>&nbsp;<span class="ident" id="4186968">cert</span><span class="op" id="4186972">,</span>&nbsp;<span class="ident" id="4186974">ok</span>&nbsp;<span class="op" id="4186977">:=</span>&nbsp;<span class="ident" id="4186980">c</span><span class="op" id="4186981">.</span><span class="ident" id="4186982">NameToCertificate</span><span class="op" id="4186999">[</span><span class="ident" id="4187000">name</span><span class="op" id="4187004">]</span><span class="op" id="4187005">;</span>&nbsp;<span class="ident" id="4187007">ok</span>&nbsp;<span class="op" id="4187010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187014">return</span>&nbsp;<span class="ident" id="4187021">cert</span><span class="op" id="4187025">,</span>&nbsp;<span class="builtintype" id="4187027">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4187032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4187036">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4187103">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187114">labels</span>&nbsp;<span class="op" id="4187121">:=</span>&nbsp;<span class="ident" id="4187124">strings</span><span class="op" id="4187131">.</span><span class="ident" id="4187132">Split</span><span class="op" id="4187137">(</span><span class="ident" id="4187138">name</span><span class="op" id="4187142">,</span>&nbsp;<span class="string" id="4187144">&#34;.&#34;</span><span class="op" id="4187147">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187150">for</span>&nbsp;<span class="ident" id="4187154">i</span>&nbsp;<span class="op" id="4187156">:=</span>&nbsp;<span class="keyword" id="4187159">range</span>&nbsp;<span class="ident" id="4187165">labels</span>&nbsp;<span class="op" id="4187172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187176">labels</span><span class="op" id="4187182">[</span><span class="ident" id="4187183">i</span><span class="op" id="4187184">]</span>&nbsp;<span class="op" id="4187186">=</span>&nbsp;<span class="string" id="4187188">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187194">candidate</span>&nbsp;<span class="op" id="4187204">:=</span>&nbsp;<span class="ident" id="4187207">strings</span><span class="op" id="4187214">.</span><span class="ident" id="4187215">Join</span><span class="op" id="4187219">(</span><span class="ident" id="4187220">labels</span><span class="op" id="4187226">,</span>&nbsp;<span class="string" id="4187228">&#34;.&#34;</span><span class="op" id="4187231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187235">if</span>&nbsp;<span class="ident" id="4187238">cert</span><span class="op" id="4187242">,</span>&nbsp;<span class="ident" id="4187244">ok</span>&nbsp;<span class="op" id="4187247">:=</span>&nbsp;<span class="ident" id="4187250">c</span><span class="op" id="4187251">.</span><span class="ident" id="4187252">NameToCertificate</span><span class="op" id="4187269">[</span><span class="ident" id="4187270">candidate</span><span class="op" id="4187279">]</span><span class="op" id="4187280">;</span>&nbsp;<span class="ident" id="4187282">ok</span>&nbsp;<span class="op" id="4187285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187290">return</span>&nbsp;<span class="ident" id="4187297">cert</span><span class="op" id="4187301">,</span>&nbsp;<span class="builtintype" id="4187303">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4187309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4187312">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4187316">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187370">return</span>&nbsp;<span class="op" id="4187377">&amp;</span><span class="ident" id="4187378">c</span><span class="op" id="4187379">.</span><span class="ident" id="4187380">Certificates</span><span class="op" id="4187392">[</span><span class="num" id="4187393">0</span><span class="op" id="4187394">]</span><span class="op" id="4187395">,</span>&nbsp;<span class="builtintype" id="4187397">nil</span><br>
<span class="lineno">465</span><span class="op" id="4187401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4187404">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4187483">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4187558">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4187575">func</span>&nbsp;<span class="op" id="4187580">(</span><span class="ident" id="4187581">c</span>&nbsp;<span class="op" id="4187583">*</span><span class="ident" id="4187584">Config</span><span class="op" id="4187590">)</span>&nbsp;<span class="ident" id="4187592">BuildNameToCertificate</span><span class="op" id="4187614">(</span><span class="op" id="4187615">)</span>&nbsp;<span class="op" id="4187617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187620">c</span><span class="op" id="4187621">.</span><span class="ident" id="4187622">NameToCertificate</span>&nbsp;<span class="op" id="4187640">=</span>&nbsp;<span class="builtinfunc" id="4187642">make</span><span class="op" id="4187646">(</span><span class="keyword" id="4187647">map</span><span class="op" id="4187650">[</span><span class="builtintype" id="4187651">string</span><span class="op" id="4187657">]</span><span class="op" id="4187658">*</span><span class="ident" id="4187659">Certificate</span><span class="op" id="4187670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187673">for</span>&nbsp;<span class="ident" id="4187677">i</span>&nbsp;<span class="op" id="4187679">:=</span>&nbsp;<span class="keyword" id="4187682">range</span>&nbsp;<span class="ident" id="4187688">c</span><span class="op" id="4187689">.</span><span class="ident" id="4187690">Certificates</span>&nbsp;<span class="op" id="4187703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187707">cert</span>&nbsp;<span class="op" id="4187712">:=</span>&nbsp;<span class="op" id="4187715">&amp;</span><span class="ident" id="4187716">c</span><span class="op" id="4187717">.</span><span class="ident" id="4187718">Certificates</span><span class="op" id="4187730">[</span><span class="ident" id="4187731">i</span><span class="op" id="4187732">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187736">x509Cert</span><span class="op" id="4187744">,</span>&nbsp;<span class="ident" id="4187746">err</span>&nbsp;<span class="op" id="4187750">:=</span>&nbsp;<span class="ident" id="4187753">x509</span><span class="op" id="4187757">.</span><span class="ident" id="4187758">ParseCertificate</span><span class="op" id="4187774">(</span><span class="ident" id="4187775">cert</span><span class="op" id="4187779">.</span><span class="ident" id="4187780">Certificate</span><span class="op" id="4187791">[</span><span class="num" id="4187792">0</span><span class="op" id="4187793">]</span><span class="op" id="4187794">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187798">if</span>&nbsp;<span class="ident" id="4187801">err</span>&nbsp;<span class="op" id="4187805">!=</span>&nbsp;<span class="builtintype" id="4187808">nil</span>&nbsp;<span class="op" id="4187812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187817">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4187828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187832">if</span>&nbsp;<span class="builtinfunc" id="4187835">len</span><span class="op" id="4187838">(</span><span class="ident" id="4187839">x509Cert</span><span class="op" id="4187847">.</span><span class="ident" id="4187848">Subject</span><span class="op" id="4187855">.</span><span class="ident" id="4187856">CommonName</span><span class="op" id="4187866">)</span>&nbsp;<span class="op" id="4187868">&gt;</span>&nbsp;<span class="num" id="4187870">0</span>&nbsp;<span class="op" id="4187872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187877">c</span><span class="op" id="4187878">.</span><span class="ident" id="4187879">NameToCertificate</span><span class="op" id="4187896">[</span><span class="ident" id="4187897">x509Cert</span><span class="op" id="4187905">.</span><span class="ident" id="4187906">Subject</span><span class="op" id="4187913">.</span><span class="ident" id="4187914">CommonName</span><span class="op" id="4187924">]</span>&nbsp;<span class="op" id="4187926">=</span>&nbsp;<span class="ident" id="4187928">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4187935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4187939">for</span>&nbsp;<span class="ident" id="4187943">_</span><span class="op" id="4187944">,</span>&nbsp;<span class="ident" id="4187946">san</span>&nbsp;<span class="op" id="4187950">:=</span>&nbsp;<span class="keyword" id="4187953">range</span>&nbsp;<span class="ident" id="4187959">x509Cert</span><span class="op" id="4187967">.</span><span class="ident" id="4187968">DNSNames</span>&nbsp;<span class="op" id="4187977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4187982">c</span><span class="op" id="4187983">.</span><span class="ident" id="4187984">NameToCertificate</span><span class="op" id="4188001">[</span><span class="ident" id="4188002">san</span><span class="op" id="4188005">]</span>&nbsp;<span class="op" id="4188007">=</span>&nbsp;<span class="ident" id="4188009">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4188016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4188019">}</span><br>
<span class="lineno">485</span><span class="op" id="4188021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4188024">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4188093">type</span>&nbsp;<span class="ident" id="4188098">Certificate</span>&nbsp;<span class="keyword" id="4188110">struct</span>&nbsp;<span class="op" id="4188117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188120">Certificate</span>&nbsp;<span class="op" id="4188132">[</span><span class="op" id="4188133">]</span><span class="op" id="4188134">[</span><span class="op" id="4188135">]</span><span class="builtintype" id="4188136">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188142">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188214">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188275">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188345">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188415">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188444">PrivateKey</span>&nbsp;<span class="ident" id="4188455">crypto</span><span class="op" id="4188461">.</span><span class="ident" id="4188462">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188474">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188545">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188577">OCSPStaple</span>&nbsp;<span class="op" id="4188588">[</span><span class="op" id="4188589">]</span><span class="builtintype" id="4188590">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188596">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188662">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188730">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4188802">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188849">Leaf</span>&nbsp;<span class="op" id="4188854">*</span><span class="ident" id="4188855">x509</span><span class="op" id="4188859">.</span><span class="ident" id="4188860">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4188872">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4188875">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4188892">type</span>&nbsp;<span class="ident" id="4188897">record</span>&nbsp;<span class="keyword" id="4188904">struct</span>&nbsp;<span class="op" id="4188911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188914">contentType</span>&nbsp;&nbsp;<span class="ident" id="4188927">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188939">major</span><span class="op" id="4188944">,</span>&nbsp;<span class="ident" id="4188946">minor</span>&nbsp;<span class="builtintype" id="4188952">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4188959">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4188972">[</span><span class="op" id="4188973">]</span><span class="builtintype" id="4188974">byte</span><br>
<span class="lineno"></span><span class="op" id="4188979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4188982">type</span>&nbsp;<span class="ident" id="4188987">handshakeMessage</span>&nbsp;<span class="keyword" id="4189004">interface</span>&nbsp;<span class="op" id="4189014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189017">marshal</span><span class="op" id="4189024">(</span><span class="op" id="4189025">)</span>&nbsp;<span class="op" id="4189027">[</span><span class="op" id="4189028">]</span><span class="builtintype" id="4189029">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189035">unmarshal</span><span class="op" id="4189044">(</span><span class="op" id="4189045">[</span><span class="op" id="4189046">]</span><span class="builtintype" id="4189047">byte</span><span class="op" id="4189051">)</span>&nbsp;<span class="builtintype" id="4189053">bool</span><br>
<span class="lineno"></span><span class="op" id="4189058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4189061">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4189136">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4189157">type</span>&nbsp;<span class="ident" id="4189162">lruSessionCache</span>&nbsp;<span class="keyword" id="4189178">struct</span>&nbsp;<span class="op" id="4189185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189188">sync</span><span class="op" id="4189192">.</span><span class="ident" id="4189193">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189201">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4189210">map</span><span class="op" id="4189213">[</span><span class="builtintype" id="4189214">string</span><span class="op" id="4189220">]</span><span class="op" id="4189221">*</span><span class="ident" id="4189222">list</span><span class="op" id="4189226">.</span><span class="ident" id="4189227">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189236">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189245">*</span><span class="ident" id="4189246">list</span><span class="op" id="4189250">.</span><span class="ident" id="4189251">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189257">capacity</span>&nbsp;<span class="builtintype" id="4189266">int</span><br>
<span class="lineno"></span><span class="op" id="4189270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4189273">type</span>&nbsp;<span class="ident" id="4189278">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4189299">struct</span>&nbsp;<span class="op" id="4189306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189309">sessionKey</span>&nbsp;<span class="builtintype" id="4189320">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189328">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189339">*</span><span class="ident" id="4189340">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="4189359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4189362">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4189434">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4189512">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4189532">func</span>&nbsp;<span class="ident" id="4189537">NewLRUClientSessionCache</span><span class="op" id="4189561">(</span><span class="ident" id="4189562">capacity</span>&nbsp;<span class="builtintype" id="4189571">int</span><span class="op" id="4189574">)</span>&nbsp;<span class="ident" id="4189576">ClientSessionCache</span>&nbsp;<span class="op" id="4189595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4189598">const</span>&nbsp;<span class="ident" id="4189604">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4189632">=</span>&nbsp;<span class="num" id="4189634">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4189639">if</span>&nbsp;<span class="ident" id="4189642">capacity</span>&nbsp;<span class="op" id="4189651">&lt;</span>&nbsp;<span class="num" id="4189653">1</span>&nbsp;<span class="op" id="4189655">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189659">capacity</span>&nbsp;<span class="op" id="4189668">=</span>&nbsp;<span class="ident" id="4189670">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4189702">return</span>&nbsp;<span class="op" id="4189709">&amp;</span><span class="ident" id="4189710">lruSessionCache</span><span class="op" id="4189725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189729">m</span><span class="op" id="4189730">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4189739">make</span><span class="op" id="4189743">(</span><span class="keyword" id="4189744">map</span><span class="op" id="4189747">[</span><span class="builtintype" id="4189748">string</span><span class="op" id="4189754">]</span><span class="op" id="4189755">*</span><span class="ident" id="4189756">list</span><span class="op" id="4189760">.</span><span class="ident" id="4189761">Element</span><span class="op" id="4189768">)</span><span class="op" id="4189769">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189773">q</span><span class="op" id="4189774">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189783">list</span><span class="op" id="4189787">.</span><span class="ident" id="4189788">New</span><span class="op" id="4189791">(</span><span class="op" id="4189792">)</span><span class="op" id="4189793">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189797">capacity</span><span class="op" id="4189805">:</span>&nbsp;<span class="ident" id="4189807">capacity</span><span class="op" id="4189815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4189818">}</span><br>
<span class="lineno"></span><span class="op" id="4189820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4189823">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4189884">func</span>&nbsp;<span class="op" id="4189889">(</span><span class="ident" id="4189890">c</span>&nbsp;<span class="op" id="4189892">*</span><span class="ident" id="4189893">lruSessionCache</span><span class="op" id="4189908">)</span>&nbsp;<span class="ident" id="4189910">Put</span><span class="op" id="4189913">(</span><span class="ident" id="4189914">sessionKey</span>&nbsp;<span class="builtintype" id="4189925">string</span><span class="op" id="4189931">,</span>&nbsp;<span class="ident" id="4189933">cs</span>&nbsp;<span class="op" id="4189936">*</span><span class="ident" id="4189937">ClientSessionState</span><span class="op" id="4189955">)</span>&nbsp;<span class="op" id="4189957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4189960">c</span><span class="op" id="4189961">.</span><span class="ident" id="4189962">Lock</span><span class="op" id="4189966">(</span><span class="op" id="4189967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4189970">defer</span>&nbsp;<span class="ident" id="4189976">c</span><span class="op" id="4189977">.</span><span class="ident" id="4189978">Unlock</span><span class="op" id="4189984">(</span><span class="op" id="4189985">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4189989">if</span>&nbsp;<span class="ident" id="4189992">elem</span><span class="op" id="4189996">,</span>&nbsp;<span class="ident" id="4189998">ok</span>&nbsp;<span class="op" id="4190001">:=</span>&nbsp;<span class="ident" id="4190004">c</span><span class="op" id="4190005">.</span><span class="ident" id="4190006">m</span><span class="op" id="4190007">[</span><span class="ident" id="4190008">sessionKey</span><span class="op" id="4190018">]</span><span class="op" id="4190019">;</span>&nbsp;<span class="ident" id="4190021">ok</span>&nbsp;<span class="op" id="4190024">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190028">entry</span>&nbsp;<span class="op" id="4190034">:=</span>&nbsp;<span class="ident" id="4190037">elem</span><span class="op" id="4190041">.</span><span class="ident" id="4190042">Value</span><span class="op" id="4190047">.</span><span class="op" id="4190048">(</span><span class="op" id="4190049">*</span><span class="ident" id="4190050">lruSessionCacheEntry</span><span class="op" id="4190070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190074">entry</span><span class="op" id="4190079">.</span><span class="ident" id="4190080">state</span>&nbsp;<span class="op" id="4190086">=</span>&nbsp;<span class="ident" id="4190088">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190093">c</span><span class="op" id="4190094">.</span><span class="ident" id="4190095">q</span><span class="op" id="4190096">.</span><span class="ident" id="4190097">MoveToFront</span><span class="op" id="4190108">(</span><span class="ident" id="4190109">elem</span><span class="op" id="4190113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4190125">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190129">if</span>&nbsp;<span class="ident" id="4190132">c</span><span class="op" id="4190133">.</span><span class="ident" id="4190134">q</span><span class="op" id="4190135">.</span><span class="ident" id="4190136">Len</span><span class="op" id="4190139">(</span><span class="op" id="4190140">)</span>&nbsp;<span class="op" id="4190142">&lt;</span>&nbsp;<span class="ident" id="4190144">c</span><span class="op" id="4190145">.</span><span class="ident" id="4190146">capacity</span>&nbsp;<span class="op" id="4190155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190159">entry</span>&nbsp;<span class="op" id="4190165">:=</span>&nbsp;<span class="op" id="4190168">&amp;</span><span class="ident" id="4190169">lruSessionCacheEntry</span><span class="op" id="4190189">{</span><span class="ident" id="4190190">sessionKey</span><span class="op" id="4190200">,</span>&nbsp;<span class="ident" id="4190202">cs</span><span class="op" id="4190204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190208">c</span><span class="op" id="4190209">.</span><span class="ident" id="4190210">m</span><span class="op" id="4190211">[</span><span class="ident" id="4190212">sessionKey</span><span class="op" id="4190222">]</span>&nbsp;<span class="op" id="4190224">=</span>&nbsp;<span class="ident" id="4190226">c</span><span class="op" id="4190227">.</span><span class="ident" id="4190228">q</span><span class="op" id="4190229">.</span><span class="ident" id="4190230">PushFront</span><span class="op" id="4190239">(</span><span class="ident" id="4190240">entry</span><span class="op" id="4190245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190249">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4190257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190261">elem</span>&nbsp;<span class="op" id="4190266">:=</span>&nbsp;<span class="ident" id="4190269">c</span><span class="op" id="4190270">.</span><span class="ident" id="4190271">q</span><span class="op" id="4190272">.</span><span class="ident" id="4190273">Back</span><span class="op" id="4190277">(</span><span class="op" id="4190278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190281">entry</span>&nbsp;<span class="op" id="4190287">:=</span>&nbsp;<span class="ident" id="4190290">elem</span><span class="op" id="4190294">.</span><span class="ident" id="4190295">Value</span><span class="op" id="4190300">.</span><span class="op" id="4190301">(</span><span class="op" id="4190302">*</span><span class="ident" id="4190303">lruSessionCacheEntry</span><span class="op" id="4190323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4190326">delete</span><span class="op" id="4190332">(</span><span class="ident" id="4190333">c</span><span class="op" id="4190334">.</span><span class="ident" id="4190335">m</span><span class="op" id="4190336">,</span>&nbsp;<span class="ident" id="4190338">entry</span><span class="op" id="4190343">.</span><span class="ident" id="4190344">sessionKey</span><span class="op" id="4190354">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190357">entry</span><span class="op" id="4190362">.</span><span class="ident" id="4190363">sessionKey</span>&nbsp;<span class="op" id="4190374">=</span>&nbsp;<span class="ident" id="4190376">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190388">entry</span><span class="op" id="4190393">.</span><span class="ident" id="4190394">state</span>&nbsp;<span class="op" id="4190400">=</span>&nbsp;<span class="ident" id="4190402">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190406">c</span><span class="op" id="4190407">.</span><span class="ident" id="4190408">q</span><span class="op" id="4190409">.</span><span class="ident" id="4190410">MoveToFront</span><span class="op" id="4190421">(</span><span class="ident" id="4190422">elem</span><span class="op" id="4190426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190429">c</span><span class="op" id="4190430">.</span><span class="ident" id="4190431">m</span><span class="op" id="4190432">[</span><span class="ident" id="4190433">sessionKey</span><span class="op" id="4190443">]</span>&nbsp;<span class="op" id="4190445">=</span>&nbsp;<span class="ident" id="4190447">elem</span><br>
<span class="lineno"></span><span class="op" id="4190452">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4190455">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4190531">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4190577">func</span>&nbsp;<span class="op" id="4190582">(</span><span class="ident" id="4190583">c</span>&nbsp;<span class="op" id="4190585">*</span><span class="ident" id="4190586">lruSessionCache</span><span class="op" id="4190601">)</span>&nbsp;<span class="ident" id="4190603">Get</span><span class="op" id="4190606">(</span><span class="ident" id="4190607">sessionKey</span>&nbsp;<span class="builtintype" id="4190618">string</span><span class="op" id="4190624">)</span>&nbsp;<span class="op" id="4190626">(</span><span class="op" id="4190627">*</span><span class="ident" id="4190628">ClientSessionState</span><span class="op" id="4190646">,</span>&nbsp;<span class="builtintype" id="4190648">bool</span><span class="op" id="4190652">)</span>&nbsp;<span class="op" id="4190654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190657">c</span><span class="op" id="4190658">.</span><span class="ident" id="4190659">Lock</span><span class="op" id="4190663">(</span><span class="op" id="4190664">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190667">defer</span>&nbsp;<span class="ident" id="4190673">c</span><span class="op" id="4190674">.</span><span class="ident" id="4190675">Unlock</span><span class="op" id="4190681">(</span><span class="op" id="4190682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190686">if</span>&nbsp;<span class="ident" id="4190689">elem</span><span class="op" id="4190693">,</span>&nbsp;<span class="ident" id="4190695">ok</span>&nbsp;<span class="op" id="4190698">:=</span>&nbsp;<span class="ident" id="4190701">c</span><span class="op" id="4190702">.</span><span class="ident" id="4190703">m</span><span class="op" id="4190704">[</span><span class="ident" id="4190705">sessionKey</span><span class="op" id="4190715">]</span><span class="op" id="4190716">;</span>&nbsp;<span class="ident" id="4190718">ok</span>&nbsp;<span class="op" id="4190721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190725">c</span><span class="op" id="4190726">.</span><span class="ident" id="4190727">q</span><span class="op" id="4190728">.</span><span class="ident" id="4190729">MoveToFront</span><span class="op" id="4190740">(</span><span class="ident" id="4190741">elem</span><span class="op" id="4190745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190749">return</span>&nbsp;<span class="ident" id="4190756">elem</span><span class="op" id="4190760">.</span><span class="ident" id="4190761">Value</span><span class="op" id="4190766">.</span><span class="op" id="4190767">(</span><span class="op" id="4190768">*</span><span class="ident" id="4190769">lruSessionCacheEntry</span><span class="op" id="4190789">)</span><span class="op" id="4190790">.</span><span class="ident" id="4190791">state</span><span class="op" id="4190796">,</span>&nbsp;<span class="builtintype" id="4190798">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4190804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4190807">return</span>&nbsp;<span class="builtintype" id="4190814">nil</span><span class="op" id="4190817">,</span>&nbsp;<span class="builtintype" id="4190819">false</span><br>
<span class="lineno"></span><span class="op" id="4190825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4190828">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4190901">type</span>&nbsp;<span class="ident" id="4190906">dsaSignature</span>&nbsp;<span class="keyword" id="4190919">struct</span>&nbsp;<span class="op" id="4190926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4190929">R</span><span class="op" id="4190930">,</span>&nbsp;<span class="ident" id="4190932">S</span>&nbsp;<span class="op" id="4190934">*</span><span class="ident" id="4190935">big</span><span class="op" id="4190938">.</span><span class="ident" id="4190939">Int</span><br>
<span class="lineno"></span><span class="op" id="4190943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4190946">type</span>&nbsp;<span class="ident" id="4190951">ecdsaSignature</span>&nbsp;<span class="ident" id="4190966">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4190980">var</span>&nbsp;<span class="ident" id="4190984">emptyConfig</span>&nbsp;<span class="ident" id="4190996">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4191004">func</span>&nbsp;<span class="ident" id="4191009">defaultConfig</span><span class="op" id="4191022">(</span><span class="op" id="4191023">)</span>&nbsp;<span class="op" id="4191025">*</span><span class="ident" id="4191026">Config</span>&nbsp;<span class="op" id="4191033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4191036">return</span>&nbsp;<span class="op" id="4191043">&amp;</span><span class="ident" id="4191044">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="4191056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4191059">var</span>&nbsp;<span class="op" id="4191063">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4191066">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4191089">sync</span><span class="op" id="4191093">.</span><span class="ident" id="4191094">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4191100">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4191123">[</span><span class="op" id="4191124">]</span><span class="builtintype" id="4191125">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4191132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4191135">func</span>&nbsp;<span class="ident" id="4191140">defaultCipherSuites</span><span class="op" id="4191159">(</span><span class="op" id="4191160">)</span>&nbsp;<span class="op" id="4191162">[</span><span class="op" id="4191163">]</span><span class="builtintype" id="4191164">uint16</span>&nbsp;<span class="op" id="4191171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4191174">once</span><span class="op" id="4191178">.</span><span class="ident" id="4191179">Do</span><span class="op" id="4191181">(</span><span class="ident" id="4191182">initDefaultCipherSuites</span><span class="op" id="4191205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4191208">return</span>&nbsp;<span class="ident" id="4191215">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="4191238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4191241">func</span>&nbsp;<span class="ident" id="4191246">initDefaultCipherSuites</span><span class="op" id="4191269">(</span><span class="op" id="4191270">)</span>&nbsp;<span class="op" id="4191272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4191275">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4191298">=</span>&nbsp;<span class="builtinfunc" id="4191300">make</span><span class="op" id="4191304">(</span><span class="op" id="4191305">[</span><span class="op" id="4191306">]</span><span class="builtintype" id="4191307">uint16</span><span class="op" id="4191313">,</span>&nbsp;<span class="builtinfunc" id="4191315">len</span><span class="op" id="4191318">(</span><span class="ident" id="4191319">cipherSuites</span><span class="op" id="4191331">)</span><span class="op" id="4191332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4191335">for</span>&nbsp;<span class="ident" id="4191339">i</span><span class="op" id="4191340">,</span>&nbsp;<span class="ident" id="4191342">suite</span>&nbsp;<span class="op" id="4191348">:=</span>&nbsp;<span class="keyword" id="4191351">range</span>&nbsp;<span class="ident" id="4191357">cipherSuites</span>&nbsp;<span class="op" id="4191370">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4191374">varDefaultCipherSuites</span><span class="op" id="4191396">[</span><span class="ident" id="4191397">i</span><span class="op" id="4191398">]</span>&nbsp;<span class="op" id="4191400">=</span>&nbsp;<span class="ident" id="4191402">suite</span><span class="op" id="4191407">.</span><span class="ident" id="4191408">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4191412">}</span><br>
<span class="lineno"></span><span class="op" id="4191414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4191417">func</span>&nbsp;<span class="ident" id="4191422">unexpectedMessageError</span><span class="op" id="4191444">(</span><span class="ident" id="4191445">wanted</span><span class="op" id="4191451">,</span>&nbsp;<span class="ident" id="4191453">got</span>&nbsp;<span class="keyword" id="4191457">interface</span><span class="op" id="4191466">{</span><span class="op" id="4191467">}</span><span class="op" id="4191468">)</span>&nbsp;<span class="builtintype" id="4191470">error</span>&nbsp;<span class="op" id="4191476">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4191479">return</span>&nbsp;<span class="ident" id="4191486">fmt</span><span class="op" id="4191489">.</span><span class="ident" id="4191490">Errorf</span><span class="op" id="4191496">(</span><span class="string" id="4191497">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4191572">,</span>&nbsp;<span class="ident" id="4191574">got</span><span class="op" id="4191577">,</span>&nbsp;<span class="ident" id="4191579">wanted</span><span class="op" id="4191585">)</span><br>
<span class="lineno"></span><span class="op" id="4191587">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
