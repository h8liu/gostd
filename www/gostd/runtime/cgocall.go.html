<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1651730">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1651786">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1651840">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1651891">//&nbsp;Cgo&nbsp;call&nbsp;and&nbsp;callback&nbsp;support.</span><br>
<span class="lineno"></span><span class="comment" id="1651925">//</span><br>
<span class="lineno"></span><span class="comment" id="1651928">//&nbsp;To&nbsp;call&nbsp;into&nbsp;the&nbsp;C&nbsp;function&nbsp;f&nbsp;from&nbsp;Go,&nbsp;the&nbsp;cgo-generated&nbsp;code&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1651999">//&nbsp;runtime.cgocall(_cgo_Cfunc_f,&nbsp;frame),&nbsp;where&nbsp;_cgo_Cfunc_f&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1652064">//&nbsp;gcc-compiled&nbsp;function&nbsp;written&nbsp;by&nbsp;cgo.</span><br>
<span class="lineno">10</span><span class="comment" id="1652105">//</span><br>
<span class="lineno"></span><span class="comment" id="1652108">//&nbsp;runtime.cgocall&nbsp;(below)&nbsp;locks&nbsp;g&nbsp;to&nbsp;m,&nbsp;calls&nbsp;entersyscall</span><br>
<span class="lineno"></span><span class="comment" id="1652168">//&nbsp;so&nbsp;as&nbsp;not&nbsp;to&nbsp;block&nbsp;other&nbsp;goroutines&nbsp;or&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span><span class="comment" id="1652233">//&nbsp;and&nbsp;then&nbsp;calls&nbsp;runtime.asmcgocall(_cgo_Cfunc_f,&nbsp;frame).</span><br>
<span class="lineno"></span><span class="comment" id="1652292">//</span><br>
<span class="lineno">15</span><span class="comment" id="1652295">//&nbsp;runtime.asmcgocall&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;to&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1652364">//&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;an&nbsp;operating&nbsp;system-allocated&nbsp;stack,&nbsp;so&nbsp;safe&nbsp;to&nbsp;run</span><br>
<span class="lineno"></span><span class="comment" id="1652434">//&nbsp;gcc-compiled&nbsp;code&nbsp;on)&nbsp;and&nbsp;calls&nbsp;_cgo_Cfunc_f(frame).</span><br>
<span class="lineno"></span><span class="comment" id="1652490">//</span><br>
<span class="lineno"></span><span class="comment" id="1652493">//&nbsp;_cgo_Cfunc_f&nbsp;invokes&nbsp;the&nbsp;actual&nbsp;C&nbsp;function&nbsp;f&nbsp;with&nbsp;arguments</span><br>
<span class="lineno">20</span><span class="comment" id="1652556">//&nbsp;taken&nbsp;from&nbsp;the&nbsp;frame&nbsp;structure,&nbsp;records&nbsp;the&nbsp;results&nbsp;in&nbsp;the&nbsp;frame,</span><br>
<span class="lineno"></span><span class="comment" id="1652625">//&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.asmcgocall.</span><br>
<span class="lineno"></span><span class="comment" id="1652663">//</span><br>
<span class="lineno"></span><span class="comment" id="1652666">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.asmcgocall&nbsp;switches&nbsp;back&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1652735">//&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocall.</span><br>
<span class="lineno">25</span><span class="comment" id="1652799">//</span><br>
<span class="lineno"></span><span class="comment" id="1652802">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocall&nbsp;calls&nbsp;exitsyscall,&nbsp;which&nbsp;blocks</span><br>
<span class="lineno"></span><span class="comment" id="1652879">//&nbsp;until&nbsp;this&nbsp;m&nbsp;can&nbsp;run&nbsp;Go&nbsp;code&nbsp;without&nbsp;violating&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit,</span><br>
<span class="lineno"></span><span class="comment" id="1652952">//&nbsp;and&nbsp;then&nbsp;unlocks&nbsp;g&nbsp;from&nbsp;m.</span><br>
<span class="lineno"></span><span class="comment" id="1652982">//</span><br>
<span class="lineno">30</span><span class="comment" id="1652985">//&nbsp;The&nbsp;above&nbsp;description&nbsp;skipped&nbsp;over&nbsp;the&nbsp;possibility&nbsp;of&nbsp;the&nbsp;gcc-compiled</span><br>
<span class="lineno"></span><span class="comment" id="1653059">//&nbsp;function&nbsp;f&nbsp;calling&nbsp;back&nbsp;into&nbsp;Go.&nbsp;&nbsp;If&nbsp;that&nbsp;happens,&nbsp;we&nbsp;continue&nbsp;down</span><br>
<span class="lineno"></span><span class="comment" id="1653130">//&nbsp;the&nbsp;rabbit&nbsp;hole&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="1653176">//</span><br>
<span class="lineno"></span><span class="comment" id="1653179">//&nbsp;To&nbsp;make&nbsp;it&nbsp;possible&nbsp;for&nbsp;gcc-compiled&nbsp;C&nbsp;code&nbsp;to&nbsp;call&nbsp;a&nbsp;Go&nbsp;function&nbsp;p.GoF,</span><br>
<span class="lineno">35</span><span class="comment" id="1653255">//&nbsp;cgo&nbsp;writes&nbsp;a&nbsp;gcc-compiled&nbsp;function&nbsp;named&nbsp;GoF&nbsp;(not&nbsp;p.GoF,&nbsp;since&nbsp;gcc&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="1653333">//&nbsp;know&nbsp;about&nbsp;packages).&nbsp;&nbsp;The&nbsp;gcc-compiled&nbsp;C&nbsp;function&nbsp;f&nbsp;calls&nbsp;GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1653400">//</span><br>
<span class="lineno"></span><span class="comment" id="1653403">//&nbsp;GoF&nbsp;calls&nbsp;crosscall2(_cgoexp_GoF,&nbsp;frame,&nbsp;framesize).&nbsp;&nbsp;Crosscall2</span><br>
<span class="lineno"></span><span class="comment" id="1653471">//&nbsp;(in&nbsp;cgo/gcc_$GOARCH.S,&nbsp;a&nbsp;gcc-compiled&nbsp;assembly&nbsp;file)&nbsp;is&nbsp;a&nbsp;two-argument</span><br>
<span class="lineno">40</span><span class="comment" id="1653545">//&nbsp;adapter&nbsp;from&nbsp;the&nbsp;gcc&nbsp;function&nbsp;call&nbsp;ABI&nbsp;to&nbsp;the&nbsp;6c&nbsp;function&nbsp;call&nbsp;ABI.</span><br>
<span class="lineno"></span><span class="comment" id="1653616">//&nbsp;It&nbsp;is&nbsp;called&nbsp;from&nbsp;gcc&nbsp;to&nbsp;call&nbsp;6c&nbsp;functions.&nbsp;&nbsp;In&nbsp;this&nbsp;case&nbsp;it&nbsp;calls</span><br>
<span class="lineno"></span><span class="comment" id="1653686">//&nbsp;_cgoexp_GoF(frame,&nbsp;framesize),&nbsp;still&nbsp;running&nbsp;on&nbsp;m-&gt;g0&#39;s&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1653751">//&nbsp;and&nbsp;outside&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit.&nbsp;&nbsp;Thus,&nbsp;this&nbsp;code&nbsp;cannot&nbsp;yet</span><br>
<span class="lineno"></span><span class="comment" id="1653817">//&nbsp;call&nbsp;arbitrary&nbsp;Go&nbsp;code&nbsp;directly&nbsp;and&nbsp;must&nbsp;be&nbsp;careful&nbsp;not&nbsp;to&nbsp;allocate</span><br>
<span class="lineno">45</span><span class="comment" id="1653888">//&nbsp;memory&nbsp;or&nbsp;use&nbsp;up&nbsp;m-&gt;g0&#39;s&nbsp;stack.</span><br>
<span class="lineno"></span><span class="comment" id="1653923">//</span><br>
<span class="lineno"></span><span class="comment" id="1653926">//&nbsp;_cgoexp_GoF&nbsp;calls&nbsp;runtime.cgocallback(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1653993">//&nbsp;(The&nbsp;reason&nbsp;for&nbsp;having&nbsp;_cgoexp_GoF&nbsp;instead&nbsp;of&nbsp;writing&nbsp;a&nbsp;crosscall3</span><br>
<span class="lineno"></span><span class="comment" id="1654063">//&nbsp;to&nbsp;make&nbsp;this&nbsp;call&nbsp;directly&nbsp;is&nbsp;that&nbsp;_cgoexp_GoF,&nbsp;because&nbsp;it&nbsp;is&nbsp;compiled</span><br>
<span class="lineno">50</span><span class="comment" id="1654137">//&nbsp;with&nbsp;6c&nbsp;instead&nbsp;of&nbsp;gcc,&nbsp;can&nbsp;refer&nbsp;to&nbsp;dotted&nbsp;names&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="1654195">//&nbsp;runtime.cgocallback&nbsp;and&nbsp;p.GoF.)</span><br>
<span class="lineno"></span><span class="comment" id="1654230">//</span><br>
<span class="lineno"></span><span class="comment" id="1654233">//&nbsp;runtime.cgocallback&nbsp;(in&nbsp;asm_$GOARCH.s)&nbsp;switches&nbsp;from&nbsp;m-&gt;g0&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="1654297">//&nbsp;stack&nbsp;to&nbsp;the&nbsp;original&nbsp;g&nbsp;(m-&gt;curg)&#39;s&nbsp;stack,&nbsp;on&nbsp;which&nbsp;it&nbsp;calls</span><br>
<span class="lineno">55</span><span class="comment" id="1654361">//&nbsp;runtime.cgocallbackg(p.GoF,&nbsp;frame,&nbsp;framesize).</span><br>
<span class="lineno"></span><span class="comment" id="1654411">//&nbsp;As&nbsp;part&nbsp;of&nbsp;the&nbsp;stack&nbsp;switch,&nbsp;runtime.cgocallback&nbsp;saves&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="1654481">//&nbsp;SP&nbsp;as&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;so&nbsp;that&nbsp;any&nbsp;use&nbsp;of&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;during&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1654551">//&nbsp;execution&nbsp;of&nbsp;the&nbsp;callback&nbsp;will&nbsp;be&nbsp;done&nbsp;below&nbsp;the&nbsp;existing&nbsp;stack&nbsp;frames.</span><br>
<span class="lineno"></span><span class="comment" id="1654626">//&nbsp;Before&nbsp;overwriting&nbsp;m-&gt;g0-&gt;sched.sp,&nbsp;it&nbsp;pushes&nbsp;the&nbsp;old&nbsp;value&nbsp;on&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="1654696">//&nbsp;m-&gt;g0&nbsp;stack,&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;restored&nbsp;later.</span><br>
<span class="lineno"></span><span class="comment" id="1654746">//</span><br>
<span class="lineno"></span><span class="comment" id="1654749">//&nbsp;runtime.cgocallbackg&nbsp;(below)&nbsp;is&nbsp;now&nbsp;running&nbsp;on&nbsp;a&nbsp;real&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="comment" id="1654816">//&nbsp;stack&nbsp;(not&nbsp;an&nbsp;m-&gt;g0&nbsp;stack).&nbsp;&nbsp;First&nbsp;it&nbsp;calls&nbsp;runtime.exitsyscall,&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="1654895">//&nbsp;block&nbsp;until&nbsp;the&nbsp;$GOMAXPROCS&nbsp;limit&nbsp;allows&nbsp;running&nbsp;this&nbsp;goroutine.</span><br>
<span class="lineno">65</span><span class="comment" id="1654963">//&nbsp;Once&nbsp;exitsyscall&nbsp;has&nbsp;returned,&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;do&nbsp;things&nbsp;like&nbsp;call&nbsp;the&nbsp;memory</span><br>
<span class="lineno"></span><span class="comment" id="1655042">//&nbsp;allocator&nbsp;or&nbsp;invoke&nbsp;the&nbsp;Go&nbsp;callback&nbsp;function&nbsp;p.GoF.&nbsp;&nbsp;runtime.cgocallbackg</span><br>
<span class="lineno"></span><span class="comment" id="1655119">//&nbsp;first&nbsp;defers&nbsp;a&nbsp;function&nbsp;to&nbsp;unwind&nbsp;m-&gt;g0.sched.sp,&nbsp;so&nbsp;that&nbsp;if&nbsp;p.GoF</span><br>
<span class="lineno"></span><span class="comment" id="1655189">//&nbsp;panics,&nbsp;m-&gt;g0.sched.sp&nbsp;will&nbsp;be&nbsp;restored&nbsp;to&nbsp;its&nbsp;old&nbsp;value:&nbsp;the&nbsp;m-&gt;g0&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="1655266">//&nbsp;and&nbsp;the&nbsp;m-&gt;curg&nbsp;stack&nbsp;will&nbsp;be&nbsp;unwound&nbsp;in&nbsp;lock&nbsp;step.</span><br>
<span class="lineno">70</span><span class="comment" id="1655321">//&nbsp;Then&nbsp;it&nbsp;calls&nbsp;p.GoF.&nbsp;&nbsp;Finally&nbsp;it&nbsp;pops&nbsp;but&nbsp;does&nbsp;not&nbsp;execute&nbsp;the&nbsp;deferred</span><br>
<span class="lineno"></span><span class="comment" id="1655396">//&nbsp;function,&nbsp;calls&nbsp;runtime.entersyscall,&nbsp;and&nbsp;returns&nbsp;to&nbsp;runtime.cgocallback.</span><br>
<span class="lineno"></span><span class="comment" id="1655473">//</span><br>
<span class="lineno"></span><span class="comment" id="1655476">//&nbsp;After&nbsp;it&nbsp;regains&nbsp;control,&nbsp;runtime.cgocallback&nbsp;switches&nbsp;back&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1655542">//&nbsp;m-&gt;g0&#39;s&nbsp;stack&nbsp;(the&nbsp;pointer&nbsp;is&nbsp;still&nbsp;in&nbsp;m-&gt;g0.sched.sp),&nbsp;restores&nbsp;the&nbsp;old</span><br>
<span class="lineno">75</span><span class="comment" id="1655618">//&nbsp;m-&gt;g0.sched.sp&nbsp;value&nbsp;from&nbsp;the&nbsp;stack,&nbsp;and&nbsp;returns&nbsp;to&nbsp;_cgoexp_GoF.</span><br>
<span class="lineno"></span><span class="comment" id="1655686">//</span><br>
<span class="lineno"></span><span class="comment" id="1655689">//&nbsp;_cgoexp_GoF&nbsp;immediately&nbsp;returns&nbsp;to&nbsp;crosscall2,&nbsp;which&nbsp;restores&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1655758">//&nbsp;callee-save&nbsp;registers&nbsp;for&nbsp;gcc&nbsp;and&nbsp;returns&nbsp;to&nbsp;GoF,&nbsp;which&nbsp;returns&nbsp;to&nbsp;f.</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="1655832">package</span>&nbsp;<span class="ident" id="1655840">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1655849">import</span>&nbsp;<span class="string" id="1655856">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1655866">//&nbsp;Call&nbsp;from&nbsp;Go&nbsp;to&nbsp;C.</span><br>
<span class="lineno">85</span><span class="comment" id="1655888">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1655901">func</span>&nbsp;<span class="ident" id="1655906">cgocall</span><span class="op" id="1655913">(</span><span class="ident" id="1655914">fn</span><span class="op" id="1655916">,</span>&nbsp;<span class="ident" id="1655918">arg</span>&nbsp;<span class="ident" id="1655922">unsafe</span><span class="op" id="1655928">.</span><span class="ident" id="1655929">Pointer</span><span class="op" id="1655936">)</span>&nbsp;<span class="op" id="1655938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1655941">cgocall_errno</span><span class="op" id="1655954">(</span><span class="ident" id="1655955">fn</span><span class="op" id="1655957">,</span>&nbsp;<span class="ident" id="1655959">arg</span><span class="op" id="1655962">)</span><br>
<span class="lineno"></span><span class="op" id="1655964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="1655967">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1655980">func</span>&nbsp;<span class="ident" id="1655985">cgocall_errno</span><span class="op" id="1655998">(</span><span class="ident" id="1655999">fn</span><span class="op" id="1656001">,</span>&nbsp;<span class="ident" id="1656003">arg</span>&nbsp;<span class="ident" id="1656007">unsafe</span><span class="op" id="1656013">.</span><span class="ident" id="1656014">Pointer</span><span class="op" id="1656021">)</span>&nbsp;<span class="builtintype" id="1656023">int32</span>&nbsp;<span class="op" id="1656029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656032">if</span>&nbsp;<span class="op" id="1656035">!</span><span class="ident" id="1656036">iscgo</span>&nbsp;<span class="op" id="1656042">&amp;&amp;</span>&nbsp;<span class="ident" id="1656045">GOOS</span>&nbsp;<span class="op" id="1656050">!=</span>&nbsp;<span class="string" id="1656053">&#34;solaris&#34;</span>&nbsp;<span class="op" id="1656063">&amp;&amp;</span>&nbsp;<span class="ident" id="1656066">GOOS</span>&nbsp;<span class="op" id="1656071">!=</span>&nbsp;<span class="string" id="1656074">&#34;windows&#34;</span>&nbsp;<span class="op" id="1656084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656088">gothrow</span><span class="op" id="1656095">(</span><span class="string" id="1656096">&#34;cgocall&nbsp;unavailable&#34;</span><span class="op" id="1656117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656120">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656124">if</span>&nbsp;<span class="ident" id="1656127">fn</span>&nbsp;<span class="op" id="1656130">==</span>&nbsp;<span class="ident" id="1656133">nil</span>&nbsp;<span class="op" id="1656137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656141">gothrow</span><span class="op" id="1656148">(</span><span class="string" id="1656149">&#34;cgocall&nbsp;nil&#34;</span><span class="op" id="1656162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656169">if</span>&nbsp;<span class="ident" id="1656172">raceenabled</span>&nbsp;<span class="op" id="1656184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656188">racereleasemerge</span><span class="op" id="1656204">(</span><span class="ident" id="1656205">unsafe</span><span class="op" id="1656211">.</span><span class="ident" id="1656212">Pointer</span><span class="op" id="1656219">(</span><span class="op" id="1656220">&amp;</span><span class="ident" id="1656221">racecgosync</span><span class="op" id="1656232">)</span><span class="op" id="1656233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656240">//&nbsp;Create&nbsp;an&nbsp;extra&nbsp;M&nbsp;for&nbsp;callbacks&nbsp;on&nbsp;threads&nbsp;not&nbsp;created&nbsp;by&nbsp;Go&nbsp;on&nbsp;first&nbsp;cgo&nbsp;call.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656324">if</span>&nbsp;<span class="ident" id="1656327">needextram</span>&nbsp;<span class="op" id="1656338">==</span>&nbsp;<span class="num" id="1656341">1</span>&nbsp;<span class="op" id="1656343">&amp;&amp;</span>&nbsp;<span class="ident" id="1656346">cas</span><span class="op" id="1656349">(</span><span class="op" id="1656350">&amp;</span><span class="ident" id="1656351">needextram</span><span class="op" id="1656361">,</span>&nbsp;<span class="num" id="1656363">1</span><span class="op" id="1656364">,</span>&nbsp;<span class="num" id="1656366">0</span><span class="op" id="1656367">)</span>&nbsp;<span class="op" id="1656369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656373">onM</span><span class="op" id="1656376">(</span><span class="ident" id="1656377">newextram</span><span class="op" id="1656386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1656389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656393">/*<br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Lock&nbsp;g&nbsp;to&nbsp;m&nbsp;to&nbsp;ensure&nbsp;we&nbsp;stay&nbsp;on&nbsp;the&nbsp;same&nbsp;stack&nbsp;if&nbsp;we&nbsp;do&nbsp;a<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;cgo&nbsp;callback.&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656526">lockOSThread</span><span class="op" id="1656538">(</span><span class="op" id="1656539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656542">mp</span>&nbsp;<span class="op" id="1656545">:=</span>&nbsp;<span class="ident" id="1656548">getg</span><span class="op" id="1656552">(</span><span class="op" id="1656553">)</span><span class="op" id="1656554">.</span><span class="ident" id="1656555">m</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656558">mp</span><span class="op" id="1656560">.</span><span class="ident" id="1656561">ncgocall</span><span class="op" id="1656569">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656573">mp</span><span class="op" id="1656575">.</span><span class="ident" id="1656576">ncgo</span><span class="op" id="1656580">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1656584">defer</span>&nbsp;<span class="ident" id="1656590">endcgo</span><span class="op" id="1656596">(</span><span class="ident" id="1656597">mp</span><span class="op" id="1656599">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1656603">/*<br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;Announce&nbsp;we&nbsp;are&nbsp;entering&nbsp;a&nbsp;system&nbsp;call<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;that&nbsp;the&nbsp;scheduler&nbsp;knows&nbsp;to&nbsp;create&nbsp;another<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;M&nbsp;to&nbsp;run&nbsp;goroutines&nbsp;while&nbsp;we&nbsp;are&nbsp;in&nbsp;the<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;foreign&nbsp;code.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;The&nbsp;call&nbsp;to&nbsp;asmcgocall&nbsp;is&nbsp;guaranteed&nbsp;not&nbsp;to<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;split&nbsp;the&nbsp;stack&nbsp;and&nbsp;does&nbsp;not&nbsp;allocate&nbsp;memory,<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;so&nbsp;it&nbsp;is&nbsp;safe&nbsp;to&nbsp;call&nbsp;while&nbsp;&#34;in&nbsp;a&nbsp;system&nbsp;call&#34;,&nbsp;outside<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*&nbsp;the&nbsp;$GOMAXPROCS&nbsp;accounting.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;*/</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656961">entersyscall</span><span class="op" id="1656973">(</span><span class="op" id="1656974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1656977">errno</span>&nbsp;<span class="op" id="1656983">:=</span>&nbsp;<span class="ident" id="1656986">asmcgocall_errno</span><span class="op" id="1657002">(</span><span class="ident" id="1657003">fn</span><span class="op" id="1657005">,</span>&nbsp;<span class="ident" id="1657007">arg</span><span class="op" id="1657010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657013">exitsyscall</span><span class="op" id="1657024">(</span><span class="op" id="1657025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657029">return</span>&nbsp;<span class="ident" id="1657036">errno</span><br>
<span class="lineno">135</span><span class="op" id="1657042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1657045">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1657058">func</span>&nbsp;<span class="ident" id="1657063">endcgo</span><span class="op" id="1657069">(</span><span class="ident" id="1657070">mp</span>&nbsp;<span class="op" id="1657073">*</span><span class="ident" id="1657074">m</span><span class="op" id="1657075">)</span>&nbsp;<span class="op" id="1657077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657080">mp</span><span class="op" id="1657082">.</span><span class="ident" id="1657083">ncgo</span><span class="op" id="1657087">--</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657091">if</span>&nbsp;<span class="ident" id="1657094">mp</span><span class="op" id="1657096">.</span><span class="ident" id="1657097">ncgo</span>&nbsp;<span class="op" id="1657102">==</span>&nbsp;<span class="num" id="1657105">0</span>&nbsp;<span class="op" id="1657107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657111">//&nbsp;We&nbsp;are&nbsp;going&nbsp;back&nbsp;to&nbsp;Go&nbsp;and&nbsp;are&nbsp;not&nbsp;in&nbsp;a&nbsp;recursive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657167">//&nbsp;call.&nbsp;&nbsp;Let&nbsp;the&nbsp;GC&nbsp;collect&nbsp;any&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1657223">//&nbsp;_cgo_allocate&nbsp;that&nbsp;is&nbsp;no&nbsp;longer&nbsp;referenced.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657272">mp</span><span class="op" id="1657274">.</span><span class="ident" id="1657275">cgomal</span>&nbsp;<span class="op" id="1657282">=</span>&nbsp;<span class="ident" id="1657284">nil</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657293">if</span>&nbsp;<span class="ident" id="1657296">raceenabled</span>&nbsp;<span class="op" id="1657308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657312">raceacquire</span><span class="op" id="1657323">(</span><span class="ident" id="1657324">unsafe</span><span class="op" id="1657330">.</span><span class="ident" id="1657331">Pointer</span><span class="op" id="1657338">(</span><span class="op" id="1657339">&amp;</span><span class="ident" id="1657340">racecgosync</span><span class="op" id="1657351">)</span><span class="op" id="1657352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657355">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657359">unlockOSThread</span><span class="op" id="1657373">(</span><span class="op" id="1657374">)</span>&nbsp;<span class="comment" id="1657376">//&nbsp;invalidates&nbsp;mp</span><br>
<span class="lineno"></span><span class="op" id="1657394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1657397">//&nbsp;Helper&nbsp;functions&nbsp;for&nbsp;cgo&nbsp;code.</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="1657432">//&nbsp;Filled&nbsp;by&nbsp;schedinit&nbsp;from&nbsp;corresponding&nbsp;C&nbsp;variables,</span><br>
<span class="lineno"></span><span class="comment" id="1657487">//&nbsp;which&nbsp;are&nbsp;in&nbsp;turn&nbsp;filled&nbsp;in&nbsp;by&nbsp;dynamic&nbsp;linker&nbsp;when&nbsp;Cgo&nbsp;is&nbsp;available.</span><br>
<span class="lineno"></span><span class="keyword" id="1657559">var</span>&nbsp;<span class="ident" id="1657563">cgoMalloc</span><span class="op" id="1657572">,</span>&nbsp;<span class="ident" id="1657574">cgoFree</span>&nbsp;<span class="ident" id="1657582">unsafe</span><span class="op" id="1657588">.</span><span class="ident" id="1657589">Pointer</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="keyword" id="1657598">func</span>&nbsp;<span class="ident" id="1657603">cmalloc</span><span class="op" id="1657610">(</span><span class="ident" id="1657611">n</span>&nbsp;<span class="builtintype" id="1657613">uintptr</span><span class="op" id="1657620">)</span>&nbsp;<span class="ident" id="1657622">unsafe</span><span class="op" id="1657628">.</span><span class="ident" id="1657629">Pointer</span>&nbsp;<span class="op" id="1657637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657640">var</span>&nbsp;<span class="ident" id="1657644">args</span>&nbsp;<span class="keyword" id="1657649">struct</span>&nbsp;<span class="op" id="1657656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657660">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1657664">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657673">ret</span>&nbsp;<span class="ident" id="1657677">unsafe</span><span class="op" id="1657683">.</span><span class="ident" id="1657684">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657693">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657696">args</span><span class="op" id="1657700">.</span><span class="ident" id="1657701">n</span>&nbsp;<span class="op" id="1657703">=</span>&nbsp;<span class="ident" id="1657705">uint64</span><span class="op" id="1657711">(</span><span class="ident" id="1657712">n</span><span class="op" id="1657713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657716">cgocall</span><span class="op" id="1657723">(</span><span class="ident" id="1657724">cgoMalloc</span><span class="op" id="1657733">,</span>&nbsp;<span class="ident" id="1657735">unsafe</span><span class="op" id="1657741">.</span><span class="ident" id="1657742">Pointer</span><span class="op" id="1657749">(</span><span class="op" id="1657750">&amp;</span><span class="ident" id="1657751">args</span><span class="op" id="1657755">)</span><span class="op" id="1657756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657759">if</span>&nbsp;<span class="ident" id="1657762">args</span><span class="op" id="1657766">.</span><span class="ident" id="1657767">ret</span>&nbsp;<span class="op" id="1657771">==</span>&nbsp;<span class="ident" id="1657774">nil</span>&nbsp;<span class="op" id="1657778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657782">gothrow</span><span class="op" id="1657789">(</span><span class="string" id="1657790">&#34;C&nbsp;malloc&nbsp;failed&#34;</span><span class="op" id="1657807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1657810">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657813">return</span>&nbsp;<span class="ident" id="1657820">args</span><span class="op" id="1657824">.</span><span class="ident" id="1657825">ret</span><br>
<span class="lineno"></span><span class="op" id="1657829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1657832">func</span>&nbsp;<span class="ident" id="1657837">cfree</span><span class="op" id="1657842">(</span><span class="ident" id="1657843">p</span>&nbsp;<span class="ident" id="1657845">unsafe</span><span class="op" id="1657851">.</span><span class="ident" id="1657852">Pointer</span><span class="op" id="1657859">)</span>&nbsp;<span class="op" id="1657861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657864">cgocall</span><span class="op" id="1657871">(</span><span class="ident" id="1657872">cgoFree</span><span class="op" id="1657879">,</span>&nbsp;<span class="ident" id="1657881">p</span><span class="op" id="1657882">)</span><br>
<span class="lineno">175</span><span class="op" id="1657884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1657887">//&nbsp;Call&nbsp;from&nbsp;C&nbsp;back&nbsp;to&nbsp;Go.</span><br>
<span class="lineno"></span><span class="comment" id="1657914">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1657927">func</span>&nbsp;<span class="ident" id="1657932">cgocallbackg</span><span class="op" id="1657944">(</span><span class="op" id="1657945">)</span>&nbsp;<span class="op" id="1657947">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1657950">gp</span>&nbsp;<span class="op" id="1657953">:=</span>&nbsp;<span class="ident" id="1657956">getg</span><span class="op" id="1657960">(</span><span class="op" id="1657961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1657964">if</span>&nbsp;<span class="ident" id="1657967">gp</span>&nbsp;<span class="op" id="1657970">!=</span>&nbsp;<span class="ident" id="1657973">gp</span><span class="op" id="1657975">.</span><span class="ident" id="1657976">m</span><span class="op" id="1657977">.</span><span class="ident" id="1657978">curg</span>&nbsp;<span class="op" id="1657983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1657987">println</span><span class="op" id="1657994">(</span><span class="string" id="1657995">&#34;runtime:&nbsp;bad&nbsp;g&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1658026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658030">exit</span><span class="op" id="1658034">(</span><span class="num" id="1658035">2</span><span class="op" id="1658036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658039">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658043">//&nbsp;entersyscall&nbsp;saves&nbsp;the&nbsp;caller&#39;s&nbsp;SP&nbsp;to&nbsp;allow&nbsp;the&nbsp;GC&nbsp;to&nbsp;trace&nbsp;the&nbsp;Go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658114">//&nbsp;stack.&nbsp;However,&nbsp;since&nbsp;we&#39;re&nbsp;returning&nbsp;to&nbsp;an&nbsp;earlier&nbsp;stack&nbsp;frame&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658186">//&nbsp;need&nbsp;to&nbsp;pair&nbsp;with&nbsp;the&nbsp;entersyscall()&nbsp;call&nbsp;made&nbsp;by&nbsp;cgocall,&nbsp;we&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658257">//&nbsp;save&nbsp;syscall*&nbsp;and&nbsp;let&nbsp;reentersyscall&nbsp;restore&nbsp;them.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658312">savedsp</span>&nbsp;<span class="op" id="1658320">:=</span>&nbsp;<span class="ident" id="1658323">unsafe</span><span class="op" id="1658329">.</span><span class="ident" id="1658330">Pointer</span><span class="op" id="1658337">(</span><span class="ident" id="1658338">gp</span><span class="op" id="1658340">.</span><span class="ident" id="1658341">syscallsp</span><span class="op" id="1658350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658353">savedpc</span>&nbsp;<span class="op" id="1658361">:=</span>&nbsp;<span class="ident" id="1658364">gp</span><span class="op" id="1658366">.</span><span class="ident" id="1658367">syscallpc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658378">exitsyscall</span><span class="op" id="1658389">(</span><span class="op" id="1658390">)</span>&nbsp;<span class="comment" id="1658392">//&nbsp;coming&nbsp;out&nbsp;of&nbsp;cgo&nbsp;call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658419">cgocallbackg1</span><span class="op" id="1658432">(</span><span class="op" id="1658433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658436">//&nbsp;going&nbsp;back&nbsp;to&nbsp;cgo&nbsp;call</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658463">reentersyscall</span><span class="op" id="1658477">(</span><span class="ident" id="1658478">savedpc</span><span class="op" id="1658485">,</span>&nbsp;<span class="ident" id="1658487">savedsp</span><span class="op" id="1658494">)</span><br>
<span class="lineno"></span><span class="op" id="1658496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1658499">func</span>&nbsp;<span class="ident" id="1658504">cgocallbackg1</span><span class="op" id="1658517">(</span><span class="op" id="1658518">)</span>&nbsp;<span class="op" id="1658520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658523">gp</span>&nbsp;<span class="op" id="1658526">:=</span>&nbsp;<span class="ident" id="1658529">getg</span><span class="op" id="1658533">(</span><span class="op" id="1658534">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658537">if</span>&nbsp;<span class="ident" id="1658540">gp</span><span class="op" id="1658542">.</span><span class="ident" id="1658543">m</span><span class="op" id="1658544">.</span><span class="ident" id="1658545">needextram</span>&nbsp;<span class="op" id="1658556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658560">gp</span><span class="op" id="1658562">.</span><span class="ident" id="1658563">m</span><span class="op" id="1658564">.</span><span class="ident" id="1658565">needextram</span>&nbsp;<span class="op" id="1658576">=</span>&nbsp;<span class="builtintype" id="1658578">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658586">onM</span><span class="op" id="1658589">(</span><span class="ident" id="1658590">newextram</span><span class="op" id="1658599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658606">//&nbsp;Add&nbsp;entry&nbsp;to&nbsp;defer&nbsp;stack&nbsp;in&nbsp;case&nbsp;of&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658653">restore</span>&nbsp;<span class="op" id="1658661">:=</span>&nbsp;<span class="builtintype" id="1658664">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658670">defer</span>&nbsp;<span class="ident" id="1658676">unwindm</span><span class="op" id="1658683">(</span><span class="op" id="1658684">&amp;</span><span class="ident" id="1658685">restore</span><span class="op" id="1658692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658696">if</span>&nbsp;<span class="ident" id="1658699">raceenabled</span>&nbsp;<span class="op" id="1658711">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658715">raceacquire</span><span class="op" id="1658726">(</span><span class="ident" id="1658727">unsafe</span><span class="op" id="1658733">.</span><span class="ident" id="1658734">Pointer</span><span class="op" id="1658741">(</span><span class="op" id="1658742">&amp;</span><span class="ident" id="1658743">racecgosync</span><span class="op" id="1658754">)</span><span class="op" id="1658755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658762">type</span>&nbsp;<span class="ident" id="1658767">args</span>&nbsp;<span class="keyword" id="1658772">struct</span>&nbsp;<span class="op" id="1658779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658783">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1658791">*</span><span class="ident" id="1658792">funcval</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658802">arg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1658810">unsafe</span><span class="op" id="1658816">.</span><span class="ident" id="1658817">Pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658827">argsize</span>&nbsp;<span class="builtintype" id="1658835">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1658844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1658847">var</span>&nbsp;<span class="ident" id="1658851">cb</span>&nbsp;<span class="op" id="1658854">*</span><span class="ident" id="1658855">args</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658862">//&nbsp;Location&nbsp;of&nbsp;callback&nbsp;arguments&nbsp;depends&nbsp;on&nbsp;stack&nbsp;frame&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1658927">//&nbsp;and&nbsp;size&nbsp;of&nbsp;stack&nbsp;frame&nbsp;of&nbsp;cgocallback_gofunc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1658978">sp</span>&nbsp;<span class="op" id="1658981">:=</span>&nbsp;<span class="ident" id="1658984">gp</span><span class="op" id="1658986">.</span><span class="ident" id="1658987">m</span><span class="op" id="1658988">.</span><span class="ident" id="1658989">g0</span><span class="op" id="1658991">.</span><span class="ident" id="1658992">sched</span><span class="op" id="1658997">.</span><span class="ident" id="1658998">sp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659002">switch</span>&nbsp;<span class="ident" id="1659009">GOARCH</span>&nbsp;<span class="op" id="1659016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659019">default</span><span class="op" id="1659026">:</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659030">gothrow</span><span class="op" id="1659037">(</span><span class="string" id="1659038">&#34;cgocallbackg&nbsp;is&nbsp;unimplemented&nbsp;on&nbsp;arch&#34;</span><span class="op" id="1659077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659080">case</span>&nbsp;<span class="string" id="1659085">&#34;arm&#34;</span><span class="op" id="1659090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659094">//&nbsp;On&nbsp;arm,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;two&nbsp;words&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;saved&nbsp;LR&nbsp;between</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659163">//&nbsp;SP&nbsp;and&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;between&nbsp;the&nbsp;stack&nbsp;frame&nbsp;and&nbsp;the&nbsp;arguments.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659238">cb</span>&nbsp;<span class="op" id="1659241">=</span>&nbsp;<span class="op" id="1659243">(</span><span class="op" id="1659244">*</span><span class="ident" id="1659245">args</span><span class="op" id="1659249">)</span><span class="op" id="1659250">(</span><span class="ident" id="1659251">unsafe</span><span class="op" id="1659257">.</span><span class="ident" id="1659258">Pointer</span><span class="op" id="1659265">(</span><span class="ident" id="1659266">sp</span>&nbsp;<span class="op" id="1659269">+</span>&nbsp;<span class="num" id="1659271">4</span><span class="op" id="1659272">*</span><span class="ident" id="1659273">ptrSize</span><span class="op" id="1659280">)</span><span class="op" id="1659281">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659284">case</span>&nbsp;<span class="string" id="1659289">&#34;amd64&#34;</span><span class="op" id="1659296">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659300">//&nbsp;On&nbsp;amd64,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;one&nbsp;word,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659356">cb</span>&nbsp;<span class="op" id="1659359">=</span>&nbsp;<span class="op" id="1659361">(</span><span class="op" id="1659362">*</span><span class="ident" id="1659363">args</span><span class="op" id="1659367">)</span><span class="op" id="1659368">(</span><span class="ident" id="1659369">unsafe</span><span class="op" id="1659375">.</span><span class="ident" id="1659376">Pointer</span><span class="op" id="1659383">(</span><span class="ident" id="1659384">sp</span>&nbsp;<span class="op" id="1659387">+</span>&nbsp;<span class="num" id="1659389">2</span><span class="op" id="1659390">*</span><span class="ident" id="1659391">ptrSize</span><span class="op" id="1659398">)</span><span class="op" id="1659399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659402">case</span>&nbsp;<span class="string" id="1659407">&#34;386&#34;</span><span class="op" id="1659412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659416">//&nbsp;On&nbsp;386,&nbsp;stack&nbsp;frame&nbsp;is&nbsp;three&nbsp;words,&nbsp;plus&nbsp;caller&nbsp;PC.</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659473">cb</span>&nbsp;<span class="op" id="1659476">=</span>&nbsp;<span class="op" id="1659478">(</span><span class="op" id="1659479">*</span><span class="ident" id="1659480">args</span><span class="op" id="1659484">)</span><span class="op" id="1659485">(</span><span class="ident" id="1659486">unsafe</span><span class="op" id="1659492">.</span><span class="ident" id="1659493">Pointer</span><span class="op" id="1659500">(</span><span class="ident" id="1659501">sp</span>&nbsp;<span class="op" id="1659504">+</span>&nbsp;<span class="num" id="1659506">4</span><span class="op" id="1659507">*</span><span class="ident" id="1659508">ptrSize</span><span class="op" id="1659515">)</span><span class="op" id="1659516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1659519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659523">//&nbsp;Invoke&nbsp;callback.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659544">reflectcall</span><span class="op" id="1659555">(</span><span class="ident" id="1659556">unsafe</span><span class="op" id="1659562">.</span><span class="ident" id="1659563">Pointer</span><span class="op" id="1659570">(</span><span class="ident" id="1659571">cb</span><span class="op" id="1659573">.</span><span class="ident" id="1659574">fn</span><span class="op" id="1659576">)</span><span class="op" id="1659577">,</span>&nbsp;<span class="ident" id="1659579">unsafe</span><span class="op" id="1659585">.</span><span class="ident" id="1659586">Pointer</span><span class="op" id="1659593">(</span><span class="ident" id="1659594">cb</span><span class="op" id="1659596">.</span><span class="ident" id="1659597">arg</span><span class="op" id="1659600">)</span><span class="op" id="1659601">,</span>&nbsp;<span class="builtintype" id="1659603">uint32</span><span class="op" id="1659609">(</span><span class="ident" id="1659610">cb</span><span class="op" id="1659612">.</span><span class="ident" id="1659613">argsize</span><span class="op" id="1659620">)</span><span class="op" id="1659621">,</span>&nbsp;<span class="num" id="1659623">0</span><span class="op" id="1659624">)</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659628">if</span>&nbsp;<span class="ident" id="1659631">raceenabled</span>&nbsp;<span class="op" id="1659643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659647">racereleasemerge</span><span class="op" id="1659663">(</span><span class="ident" id="1659664">unsafe</span><span class="op" id="1659670">.</span><span class="ident" id="1659671">Pointer</span><span class="op" id="1659678">(</span><span class="op" id="1659679">&amp;</span><span class="ident" id="1659680">racecgosync</span><span class="op" id="1659691">)</span><span class="op" id="1659692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1659695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659699">//&nbsp;Do&nbsp;not&nbsp;unwind&nbsp;m-&gt;g0-&gt;sched.sp.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659734">//&nbsp;Our&nbsp;caller,&nbsp;cgocallback,&nbsp;will&nbsp;do&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659777">restore</span>&nbsp;<span class="op" id="1659785">=</span>&nbsp;<span class="builtintype" id="1659787">false</span><br>
<span class="lineno"></span><span class="op" id="1659793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="1659796">func</span>&nbsp;<span class="ident" id="1659801">unwindm</span><span class="op" id="1659808">(</span><span class="ident" id="1659809">restore</span>&nbsp;<span class="op" id="1659817">*</span><span class="builtintype" id="1659818">bool</span><span class="op" id="1659822">)</span>&nbsp;<span class="op" id="1659824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659827">if</span>&nbsp;<span class="op" id="1659830">!</span><span class="op" id="1659831">*</span><span class="ident" id="1659832">restore</span>&nbsp;<span class="op" id="1659840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1659852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659855">//&nbsp;Restore&nbsp;sp&nbsp;saved&nbsp;by&nbsp;cgocallback&nbsp;during</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1659898">//&nbsp;unwind&nbsp;of&nbsp;g&#39;s&nbsp;stack&nbsp;(see&nbsp;comment&nbsp;at&nbsp;top&nbsp;of&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659952">mp</span>&nbsp;<span class="op" id="1659955">:=</span>&nbsp;<span class="ident" id="1659958">acquirem</span><span class="op" id="1659966">(</span><span class="op" id="1659967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1659970">sched</span>&nbsp;<span class="op" id="1659976">:=</span>&nbsp;<span class="op" id="1659979">&amp;</span><span class="ident" id="1659980">mp</span><span class="op" id="1659982">.</span><span class="ident" id="1659983">g0</span><span class="op" id="1659985">.</span><span class="ident" id="1659986">sched</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1659993">switch</span>&nbsp;<span class="ident" id="1660000">GOARCH</span>&nbsp;<span class="op" id="1660007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660010">default</span><span class="op" id="1660017">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660021">gothrow</span><span class="op" id="1660028">(</span><span class="string" id="1660029">&#34;unwindm&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1660054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660057">case</span>&nbsp;<span class="string" id="1660062">&#34;386&#34;</span><span class="op" id="1660067">,</span>&nbsp;<span class="string" id="1660069">&#34;amd64&#34;</span><span class="op" id="1660076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660080">sched</span><span class="op" id="1660085">.</span><span class="ident" id="1660086">sp</span>&nbsp;<span class="op" id="1660089">=</span>&nbsp;<span class="op" id="1660091">*</span><span class="op" id="1660092">(</span><span class="op" id="1660093">*</span><span class="builtintype" id="1660094">uintptr</span><span class="op" id="1660101">)</span><span class="op" id="1660102">(</span><span class="ident" id="1660103">unsafe</span><span class="op" id="1660109">.</span><span class="ident" id="1660110">Pointer</span><span class="op" id="1660117">(</span><span class="ident" id="1660118">sched</span><span class="op" id="1660123">.</span><span class="ident" id="1660124">sp</span><span class="op" id="1660126">)</span><span class="op" id="1660127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1660130">case</span>&nbsp;<span class="string" id="1660135">&#34;arm&#34;</span><span class="op" id="1660140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660144">sched</span><span class="op" id="1660149">.</span><span class="ident" id="1660150">sp</span>&nbsp;<span class="op" id="1660153">=</span>&nbsp;<span class="op" id="1660155">*</span><span class="op" id="1660156">(</span><span class="op" id="1660157">*</span><span class="builtintype" id="1660158">uintptr</span><span class="op" id="1660165">)</span><span class="op" id="1660166">(</span><span class="ident" id="1660167">unsafe</span><span class="op" id="1660173">.</span><span class="ident" id="1660174">Pointer</span><span class="op" id="1660181">(</span><span class="ident" id="1660182">sched</span><span class="op" id="1660187">.</span><span class="ident" id="1660188">sp</span>&nbsp;<span class="op" id="1660191">+</span>&nbsp;<span class="num" id="1660193">4</span><span class="op" id="1660194">)</span><span class="op" id="1660195">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1660198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660201">releasem</span><span class="op" id="1660209">(</span><span class="ident" id="1660210">mp</span><span class="op" id="1660212">)</span><br>
<span class="lineno"></span><span class="op" id="1660214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660217">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno">270</span><span class="keyword" id="1660241">func</span>&nbsp;<span class="ident" id="1660246">badcgocallback</span><span class="op" id="1660260">(</span><span class="op" id="1660261">)</span>&nbsp;<span class="op" id="1660263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660266">gothrow</span><span class="op" id="1660273">(</span><span class="string" id="1660274">&#34;misaligned&nbsp;stack&nbsp;in&nbsp;cgocallback&#34;</span><span class="op" id="1660307">)</span><br>
<span class="lineno"></span><span class="op" id="1660309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1660312">//&nbsp;called&nbsp;from&nbsp;(incomplete)&nbsp;assembly</span><br>
<span class="lineno">275</span><span class="keyword" id="1660349">func</span>&nbsp;<span class="ident" id="1660354">cgounimpl</span><span class="op" id="1660363">(</span><span class="op" id="1660364">)</span>&nbsp;<span class="op" id="1660366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1660369">gothrow</span><span class="op" id="1660376">(</span><span class="string" id="1660377">&#34;cgo&nbsp;not&nbsp;implemented&#34;</span><span class="op" id="1660398">)</span><br>
<span class="lineno"></span><span class="op" id="1660400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1660403">var</span>&nbsp;<span class="ident" id="1660407">racecgosync</span>&nbsp;<span class="ident" id="1660419">uint64</span>&nbsp;<span class="comment" id="1660426">//&nbsp;represents&nbsp;possible&nbsp;synchronization&nbsp;in&nbsp;C&nbsp;code</span>
</div>
</body>
</html>
