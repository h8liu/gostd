<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8408323">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8408378">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8408432">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="8408483">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;a&nbsp;simple&nbsp;printer&nbsp;performance&nbsp;benchmark:</span><br>
<span class="lineno"></span><span class="comment" id="8408547">//&nbsp;go&nbsp;test&nbsp;-bench=BenchmarkPrint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8408581">package</span>&nbsp;<span class="ident" id="8408589">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="8408598">import</span>&nbsp;<span class="op" id="8408605">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408608">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408617">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408627">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408640">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408646">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408659">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8408666">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8408676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="8408679">var</span>&nbsp;<span class="ident" id="8408683">testfile</span>&nbsp;<span class="op" id="8408692">*</span><span class="ident" id="8408693"><a href="/go/printer/performance_test.go.html#8408617">ast</a></span><span class="op" id="8408696">.</span><span class="ident" id="8408697">File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8408703">func</span>&nbsp;<span class="ident" id="8408708">testprint</span><span class="op" id="8408717">(</span><span class="ident" id="8408718">out</span>&nbsp;<span class="ident" id="8408722"><a href="/go/printer/performance_test.go.html#8408640">io</a></span><span class="op" id="8408724">.</span><span class="ident" id="8408725">Writer</span><span class="op" id="8408731">,</span>&nbsp;<span class="ident" id="8408733">file</span>&nbsp;<span class="op" id="8408738">*</span><span class="ident" id="8408739"><a href="/go/printer/performance_test.go.html#8408617">ast</a></span><span class="op" id="8408742">.</span><span class="ident" id="8408743">File</span><span class="op" id="8408747">)</span>&nbsp;<span class="op" id="8408749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408752">if</span>&nbsp;<span class="ident" id="8408755">err</span>&nbsp;<span class="op" id="8408759">:=</span>&nbsp;<span class="op" id="8408762">(</span><span class="op" id="8408763">&amp;</span><span class="ident" id="8408764"><a href="/go/printer/printer.go.html#6213576">Config</a></span><span class="op" id="8408770">{</span><span class="ident" id="8408771"><a href="/go/printer/printer.go.html#6213278">TabIndent</a></span>&nbsp;<span class="op" id="8408781">|</span>&nbsp;<span class="ident" id="8408783"><a href="/go/printer/printer.go.html#6213359">UseSpaces</a></span><span class="op" id="8408792">,</span>&nbsp;<span class="num" id="8408794">8</span><span class="op" id="8408795">,</span>&nbsp;<span class="num" id="8408797">0</span><span class="op" id="8408798">}</span><span class="op" id="8408799">)</span><span class="op" id="8408800">.</span><span class="ident" id="8408801">Fprint</span><span class="op" id="8408807">(</span><span class="ident" id="8408808"><a href="/go/printer/performance_test.go.html#8408718">out</a></span><span class="op" id="8408811">,</span>&nbsp;<span class="ident" id="8408813"><a href="/go/printer/printer_test.go.html#8409954">fset</a></span><span class="op" id="8408817">,</span>&nbsp;<span class="ident" id="8408819"><a href="/go/printer/performance_test.go.html#8408733">file</a></span><span class="op" id="8408823">)</span><span class="op" id="8408824">;</span>&nbsp;<span class="ident" id="8408826"><a href="/go/printer/performance_test.go.html#8408755">err</a></span>&nbsp;<span class="op" id="8408830">!=</span>&nbsp;<span class="ident" id="8408833">nil</span>&nbsp;<span class="op" id="8408837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8408841"><a href="/go/printer/performance_test.go.html#8408659">log</a></span><span class="op" id="8408844">.</span><span class="ident" id="8408845">Fatalf</span><span class="op" id="8408851">(</span><span class="string" id="8408852">&#34;print&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8408869">,</span>&nbsp;<span class="ident" id="8408871"><a href="/go/printer/performance_test.go.html#8408755">err</a></span><span class="op" id="8408874">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8408877">}</span><br>
<span class="lineno"></span><span class="op" id="8408879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8408882">//&nbsp;cannot&nbsp;initialize&nbsp;in&nbsp;init&nbsp;because&nbsp;(printer)&nbsp;Fprint&nbsp;launches&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="8408957">func</span>&nbsp;<span class="ident" id="8408962">initialize</span><span class="op" id="8408972">(</span><span class="op" id="8408973">)</span>&nbsp;<span class="op" id="8408975">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8408978">const</span>&nbsp;<span class="ident" id="8408984">filename</span>&nbsp;<span class="op" id="8408993">=</span>&nbsp;<span class="string" id="8408995">&#34;testdata/parser.go&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409018">src</span><span class="op" id="8409021">,</span>&nbsp;<span class="ident" id="8409023">err</span>&nbsp;<span class="op" id="8409027">:=</span>&nbsp;<span class="ident" id="8409030"><a href="/go/printer/performance_test.go.html#8408646">ioutil</a></span><span class="op" id="8409036">.</span><span class="ident" id="8409037">ReadFile</span><span class="op" id="8409045">(</span><span class="ident" id="8409046"><a href="/go/printer/performance_test.go.html#8408984">filename</a></span><span class="op" id="8409054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409057">if</span>&nbsp;<span class="ident" id="8409060"><a href="/go/printer/performance_test.go.html#8409023">err</a></span>&nbsp;<span class="op" id="8409064">!=</span>&nbsp;<span class="ident" id="8409067">nil</span>&nbsp;<span class="op" id="8409071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409075"><a href="/go/printer/performance_test.go.html#8408659">log</a></span><span class="op" id="8409078">.</span><span class="ident" id="8409079">Fatalf</span><span class="op" id="8409085">(</span><span class="string" id="8409086">&#34;%s&#34;</span><span class="op" id="8409090">,</span>&nbsp;<span class="ident" id="8409092"><a href="/go/printer/performance_test.go.html#8409023">err</a></span><span class="op" id="8409095">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409102">file</span><span class="op" id="8409106">,</span>&nbsp;<span class="ident" id="8409108"><a href="/go/printer/performance_test.go.html#8409023">err</a></span>&nbsp;<span class="op" id="8409112">:=</span>&nbsp;<span class="ident" id="8409115"><a href="/go/printer/performance_test.go.html#8408627">parser</a></span><span class="op" id="8409121">.</span><span class="ident" id="8409122">ParseFile</span><span class="op" id="8409131">(</span><span class="ident" id="8409132"><a href="/go/printer/printer_test.go.html#8409954">fset</a></span><span class="op" id="8409136">,</span>&nbsp;<span class="ident" id="8409138"><a href="/go/printer/performance_test.go.html#8408984">filename</a></span><span class="op" id="8409146">,</span>&nbsp;<span class="ident" id="8409148"><a href="/go/printer/performance_test.go.html#8409018">src</a></span><span class="op" id="8409151">,</span>&nbsp;<span class="ident" id="8409153"><a href="/go/printer/performance_test.go.html#8408627">parser</a></span><span class="op" id="8409159">.</span><span class="ident" id="8409160">ParseComments</span><span class="op" id="8409173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409176">if</span>&nbsp;<span class="ident" id="8409179"><a href="/go/printer/performance_test.go.html#8409023">err</a></span>&nbsp;<span class="op" id="8409183">!=</span>&nbsp;<span class="ident" id="8409186">nil</span>&nbsp;<span class="op" id="8409190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409194"><a href="/go/printer/performance_test.go.html#8408659">log</a></span><span class="op" id="8409197">.</span><span class="ident" id="8409198">Fatalf</span><span class="op" id="8409204">(</span><span class="string" id="8409205">&#34;%s&#34;</span><span class="op" id="8409209">,</span>&nbsp;<span class="ident" id="8409211"><a href="/go/printer/performance_test.go.html#8409023">err</a></span><span class="op" id="8409214">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409221">var</span>&nbsp;<span class="ident" id="8409225">buf</span>&nbsp;<span class="ident" id="8409229"><a href="/go/printer/performance_test.go.html#8408608">bytes</a></span><span class="op" id="8409234">.</span><span class="ident" id="8409235">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409243"><a href="/go/printer/performance_test.go.html#8408708">testprint</a></span><span class="op" id="8409252">(</span><span class="op" id="8409253">&amp;</span><span class="ident" id="8409254"><a href="/go/printer/performance_test.go.html#8409225">buf</a></span><span class="op" id="8409257">,</span>&nbsp;<span class="ident" id="8409259"><a href="/go/printer/performance_test.go.html#8409102">file</a></span><span class="op" id="8409263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409266">if</span>&nbsp;<span class="op" id="8409269">!</span><span class="ident" id="8409270"><a href="/go/printer/performance_test.go.html#8408608">bytes</a></span><span class="op" id="8409275">.</span><span class="ident" id="8409276">Equal</span><span class="op" id="8409281">(</span><span class="ident" id="8409282"><a href="/go/printer/performance_test.go.html#8409225">buf</a></span><span class="op" id="8409285">.</span><span class="ident" id="8409286">Bytes</span><span class="op" id="8409291">(</span><span class="op" id="8409292">)</span><span class="op" id="8409293">,</span>&nbsp;<span class="ident" id="8409295"><a href="/go/printer/performance_test.go.html#8409018">src</a></span><span class="op" id="8409298">)</span>&nbsp;<span class="op" id="8409300">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409304"><a href="/go/printer/performance_test.go.html#8408659">log</a></span><span class="op" id="8409307">.</span><span class="ident" id="8409308">Fatalf</span><span class="op" id="8409314">(</span><span class="string" id="8409315">&#34;print&nbsp;error:&nbsp;%s&nbsp;not&nbsp;idempotent&#34;</span><span class="op" id="8409347">,</span>&nbsp;<span class="ident" id="8409349"><a href="/go/printer/performance_test.go.html#8408984">filename</a></span><span class="op" id="8409357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409364"><a href="/go/printer/performance_test.go.html#8408683">testfile</a></span>&nbsp;<span class="op" id="8409373">=</span>&nbsp;<span class="ident" id="8409375"><a href="/go/printer/performance_test.go.html#8409102">file</a></span><br>
<span class="lineno"></span><span class="op" id="8409380">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="8409383">func</span>&nbsp;<span class="ident" id="8409388">BenchmarkPrint</span><span class="op" id="8409402">(</span><span class="ident" id="8409403">b</span>&nbsp;<span class="op" id="8409405">*</span><span class="ident" id="8409406"><a href="/go/printer/performance_test.go.html#8408666">testing</a></span><span class="op" id="8409413">.</span><span class="ident" id="8409414">B</span><span class="op" id="8409415">)</span>&nbsp;<span class="op" id="8409417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409420">if</span>&nbsp;<span class="ident" id="8409423"><a href="/go/printer/performance_test.go.html#8408683">testfile</a></span>&nbsp;<span class="op" id="8409432">==</span>&nbsp;<span class="ident" id="8409435">nil</span>&nbsp;<span class="op" id="8409439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409443"><a href="/go/printer/performance_test.go.html#8408962">initialize</a></span><span class="op" id="8409453">(</span><span class="op" id="8409454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409457">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8409460">for</span>&nbsp;<span class="ident" id="8409464">i</span>&nbsp;<span class="op" id="8409466">:=</span>&nbsp;<span class="num" id="8409469">0</span><span class="op" id="8409470">;</span>&nbsp;<span class="ident" id="8409472"><a href="/go/printer/performance_test.go.html#8409464">i</a></span>&nbsp;<span class="op" id="8409474">&lt;</span>&nbsp;<span class="ident" id="8409476"><a href="/go/printer/performance_test.go.html#8409403">b</a></span><span class="op" id="8409477">.</span><span class="ident" id="8409478">N</span><span class="op" id="8409479">;</span>&nbsp;<span class="ident" id="8409481"><a href="/go/printer/performance_test.go.html#8409464">i</a></span><span class="op" id="8409482">++</span>&nbsp;<span class="op" id="8409485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8409489"><a href="/go/printer/performance_test.go.html#8408708">testprint</a></span><span class="op" id="8409498">(</span><span class="ident" id="8409499"><a href="/go/printer/performance_test.go.html#8408646">ioutil</a></span><span class="op" id="8409505">.</span><span class="ident" id="8409506">Discard</span><span class="op" id="8409513">,</span>&nbsp;<span class="ident" id="8409515"><a href="/go/printer/performance_test.go.html#8408683">testfile</a></span><span class="op" id="8409523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8409526">}</span><br>
<span class="lineno"></span><span class="op" id="8409528">}</span>
</div>
</body>
</html>
