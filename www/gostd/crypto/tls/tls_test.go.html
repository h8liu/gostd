<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7299671">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7299726">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7299780">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7299831">package</span>&nbsp;<span class="ident" id="7299839">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7299844">import</span>&nbsp;<span class="op" id="7299851">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299854">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299863">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299870">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299876">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299883">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299894">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7299905">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7299912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7299915">var</span>&nbsp;<span class="ident" id="7299919">rsaCertPEM</span>&nbsp;<span class="op" id="7299930">=</span>&nbsp;<span class="string" id="7299932">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="7300628">var</span>&nbsp;<span class="ident" id="7300632">rsaKeyPEM</span>&nbsp;<span class="op" id="7300642">=</span>&nbsp;<span class="string" id="7300644">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7301145">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="7301209">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="7301280">var</span>&nbsp;<span class="ident" id="7301284">keyPEM</span>&nbsp;<span class="op" id="7301291">=</span>&nbsp;<span class="string" id="7301293">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7301786">var</span>&nbsp;<span class="ident" id="7301790">ecdsaCertPEM</span>&nbsp;<span class="op" id="7301803">=</span>&nbsp;<span class="string" id="7301805">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7302562">var</span>&nbsp;<span class="ident" id="7302566">ecdsaKeyPEM</span>&nbsp;<span class="op" id="7302578">=</span>&nbsp;<span class="string" id="7302580">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7303020">var</span>&nbsp;<span class="ident" id="7303024">keyPairTests</span>&nbsp;<span class="op" id="7303037">=</span>&nbsp;<span class="op" id="7303039">[</span><span class="op" id="7303040">]</span><span class="keyword" id="7303041">struct</span>&nbsp;<span class="op" id="7303048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303051">algo</span>&nbsp;<span class="builtintype" id="7303056">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303064">cert</span>&nbsp;<span class="builtintype" id="7303069">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303077">key</span>&nbsp;&nbsp;<span class="builtintype" id="7303082">string</span><br>
<span class="lineno"></span><span class="op" id="7303089">}</span><span class="op" id="7303090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303093">{</span><span class="string" id="7303094">&#34;ECDSA&#34;</span><span class="op" id="7303101">,</span>&nbsp;<span class="ident" id="7303103">ecdsaCertPEM</span><span class="op" id="7303115">,</span>&nbsp;<span class="ident" id="7303117">ecdsaKeyPEM</span><span class="op" id="7303128">}</span><span class="op" id="7303129">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303132">{</span><span class="string" id="7303133">&#34;RSA&#34;</span><span class="op" id="7303138">,</span>&nbsp;<span class="ident" id="7303140">rsaCertPEM</span><span class="op" id="7303150">,</span>&nbsp;<span class="ident" id="7303152">rsaKeyPEM</span><span class="op" id="7303161">}</span><span class="op" id="7303162">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303165">{</span><span class="string" id="7303166">&#34;RSA-untyped&#34;</span><span class="op" id="7303179">,</span>&nbsp;<span class="ident" id="7303181">rsaCertPEM</span><span class="op" id="7303191">,</span>&nbsp;<span class="ident" id="7303193">keyPEM</span><span class="op" id="7303199">}</span><span class="op" id="7303200">,</span>&nbsp;<span class="comment" id="7303202">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="7303227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7303230">func</span>&nbsp;<span class="ident" id="7303235">TestX509KeyPair</span><span class="op" id="7303250">(</span><span class="ident" id="7303251">t</span>&nbsp;<span class="op" id="7303253">*</span><span class="ident" id="7303254">testing</span><span class="op" id="7303261">.</span><span class="ident" id="7303262">T</span><span class="op" id="7303263">)</span>&nbsp;<span class="op" id="7303265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303268">var</span>&nbsp;<span class="ident" id="7303272">pem</span>&nbsp;<span class="op" id="7303276">[</span><span class="op" id="7303277">]</span><span class="builtintype" id="7303278">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303284">for</span>&nbsp;<span class="ident" id="7303288">_</span><span class="op" id="7303289">,</span>&nbsp;<span class="ident" id="7303291">test</span>&nbsp;<span class="op" id="7303296">:=</span>&nbsp;<span class="keyword" id="7303299">range</span>&nbsp;<span class="ident" id="7303305">keyPairTests</span>&nbsp;<span class="op" id="7303318">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303322">pem</span>&nbsp;<span class="op" id="7303326">=</span>&nbsp;<span class="op" id="7303328">[</span><span class="op" id="7303329">]</span><span class="builtintype" id="7303330">byte</span><span class="op" id="7303334">(</span><span class="ident" id="7303335">test</span><span class="op" id="7303339">.</span><span class="ident" id="7303340">cert</span>&nbsp;<span class="op" id="7303345">+</span>&nbsp;<span class="ident" id="7303347">test</span><span class="op" id="7303351">.</span><span class="ident" id="7303352">key</span><span class="op" id="7303355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303359">if</span>&nbsp;<span class="ident" id="7303362">_</span><span class="op" id="7303363">,</span>&nbsp;<span class="ident" id="7303365">err</span>&nbsp;<span class="op" id="7303369">:=</span>&nbsp;<span class="ident" id="7303372">X509KeyPair</span><span class="op" id="7303383">(</span><span class="ident" id="7303384">pem</span><span class="op" id="7303387">,</span>&nbsp;<span class="ident" id="7303389">pem</span><span class="op" id="7303392">)</span><span class="op" id="7303393">;</span>&nbsp;<span class="ident" id="7303395">err</span>&nbsp;<span class="op" id="7303399">!=</span>&nbsp;<span class="ident" id="7303402">nil</span>&nbsp;<span class="op" id="7303406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303411">t</span><span class="op" id="7303412">.</span><span class="ident" id="7303413">Errorf</span><span class="op" id="7303419">(</span><span class="string" id="7303420">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7303467">,</span>&nbsp;<span class="ident" id="7303469">test</span><span class="op" id="7303473">.</span><span class="ident" id="7303474">algo</span><span class="op" id="7303478">,</span>&nbsp;<span class="ident" id="7303480">test</span><span class="op" id="7303484">.</span><span class="ident" id="7303485">algo</span><span class="op" id="7303489">,</span>&nbsp;<span class="ident" id="7303491">err</span><span class="op" id="7303494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303502">pem</span>&nbsp;<span class="op" id="7303506">=</span>&nbsp;<span class="op" id="7303508">[</span><span class="op" id="7303509">]</span><span class="builtintype" id="7303510">byte</span><span class="op" id="7303514">(</span><span class="ident" id="7303515">test</span><span class="op" id="7303519">.</span><span class="ident" id="7303520">key</span>&nbsp;<span class="op" id="7303524">+</span>&nbsp;<span class="ident" id="7303526">test</span><span class="op" id="7303530">.</span><span class="ident" id="7303531">cert</span><span class="op" id="7303535">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303539">if</span>&nbsp;<span class="ident" id="7303542">_</span><span class="op" id="7303543">,</span>&nbsp;<span class="ident" id="7303545">err</span>&nbsp;<span class="op" id="7303549">:=</span>&nbsp;<span class="ident" id="7303552">X509KeyPair</span><span class="op" id="7303563">(</span><span class="ident" id="7303564">pem</span><span class="op" id="7303567">,</span>&nbsp;<span class="ident" id="7303569">pem</span><span class="op" id="7303572">)</span><span class="op" id="7303573">;</span>&nbsp;<span class="ident" id="7303575">err</span>&nbsp;<span class="op" id="7303579">!=</span>&nbsp;<span class="ident" id="7303582">nil</span>&nbsp;<span class="op" id="7303586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303591">t</span><span class="op" id="7303592">.</span><span class="ident" id="7303593">Errorf</span><span class="op" id="7303599">(</span><span class="string" id="7303600">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="7303647">,</span>&nbsp;<span class="ident" id="7303649">test</span><span class="op" id="7303653">.</span><span class="ident" id="7303654">algo</span><span class="op" id="7303658">,</span>&nbsp;<span class="ident" id="7303660">test</span><span class="op" id="7303664">.</span><span class="ident" id="7303665">algo</span><span class="op" id="7303669">,</span>&nbsp;<span class="ident" id="7303671">err</span><span class="op" id="7303674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303681">}</span><br>
<span class="lineno"></span><span class="op" id="7303683">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7303686">func</span>&nbsp;<span class="ident" id="7303691">TestX509MixedKeyPair</span><span class="op" id="7303711">(</span><span class="ident" id="7303712">t</span>&nbsp;<span class="op" id="7303714">*</span><span class="ident" id="7303715">testing</span><span class="op" id="7303722">.</span><span class="ident" id="7303723">T</span><span class="op" id="7303724">)</span>&nbsp;<span class="op" id="7303726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303729">if</span>&nbsp;<span class="ident" id="7303732">_</span><span class="op" id="7303733">,</span>&nbsp;<span class="ident" id="7303735">err</span>&nbsp;<span class="op" id="7303739">:=</span>&nbsp;<span class="ident" id="7303742">X509KeyPair</span><span class="op" id="7303753">(</span><span class="op" id="7303754">[</span><span class="op" id="7303755">]</span><span class="builtintype" id="7303756">byte</span><span class="op" id="7303760">(</span><span class="ident" id="7303761">rsaCertPEM</span><span class="op" id="7303771">)</span><span class="op" id="7303772">,</span>&nbsp;<span class="op" id="7303774">[</span><span class="op" id="7303775">]</span><span class="builtintype" id="7303776">byte</span><span class="op" id="7303780">(</span><span class="ident" id="7303781">ecdsaKeyPEM</span><span class="op" id="7303792">)</span><span class="op" id="7303793">)</span><span class="op" id="7303794">;</span>&nbsp;<span class="ident" id="7303796">err</span>&nbsp;<span class="op" id="7303800">==</span>&nbsp;<span class="ident" id="7303803">nil</span>&nbsp;<span class="op" id="7303807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303811">t</span><span class="op" id="7303812">.</span><span class="ident" id="7303813">Error</span><span class="op" id="7303818">(</span><span class="string" id="7303819">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7303877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7303880">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7303883">if</span>&nbsp;<span class="ident" id="7303886">_</span><span class="op" id="7303887">,</span>&nbsp;<span class="ident" id="7303889">err</span>&nbsp;<span class="op" id="7303893">:=</span>&nbsp;<span class="ident" id="7303896">X509KeyPair</span><span class="op" id="7303907">(</span><span class="op" id="7303908">[</span><span class="op" id="7303909">]</span><span class="builtintype" id="7303910">byte</span><span class="op" id="7303914">(</span><span class="ident" id="7303915">ecdsaCertPEM</span><span class="op" id="7303927">)</span><span class="op" id="7303928">,</span>&nbsp;<span class="op" id="7303930">[</span><span class="op" id="7303931">]</span><span class="builtintype" id="7303932">byte</span><span class="op" id="7303936">(</span><span class="ident" id="7303937">rsaKeyPEM</span><span class="op" id="7303946">)</span><span class="op" id="7303947">)</span><span class="op" id="7303948">;</span>&nbsp;<span class="ident" id="7303950">err</span>&nbsp;<span class="op" id="7303954">==</span>&nbsp;<span class="ident" id="7303957">nil</span>&nbsp;<span class="op" id="7303961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7303965">t</span><span class="op" id="7303966">.</span><span class="ident" id="7303967">Error</span><span class="op" id="7303972">(</span><span class="string" id="7303973">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7304031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304034">}</span><br>
<span class="lineno"></span><span class="op" id="7304036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7304039">func</span>&nbsp;<span class="ident" id="7304044">newLocalListener</span><span class="op" id="7304060">(</span><span class="ident" id="7304061">t</span>&nbsp;<span class="op" id="7304063">*</span><span class="ident" id="7304064">testing</span><span class="op" id="7304071">.</span><span class="ident" id="7304072">T</span><span class="op" id="7304073">)</span>&nbsp;<span class="ident" id="7304075">net</span><span class="op" id="7304078">.</span><span class="ident" id="7304079">Listener</span>&nbsp;<span class="op" id="7304088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304091">ln</span><span class="op" id="7304093">,</span>&nbsp;<span class="ident" id="7304095">err</span>&nbsp;<span class="op" id="7304099">:=</span>&nbsp;<span class="ident" id="7304102">net</span><span class="op" id="7304105">.</span><span class="ident" id="7304106">Listen</span><span class="op" id="7304112">(</span><span class="string" id="7304113">&#34;tcp&#34;</span><span class="op" id="7304118">,</span>&nbsp;<span class="string" id="7304120">&#34;127.0.0.1:0&#34;</span><span class="op" id="7304133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304136">if</span>&nbsp;<span class="ident" id="7304139">err</span>&nbsp;<span class="op" id="7304143">!=</span>&nbsp;<span class="ident" id="7304146">nil</span>&nbsp;<span class="op" id="7304150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304154">ln</span><span class="op" id="7304156">,</span>&nbsp;<span class="ident" id="7304158">err</span>&nbsp;<span class="op" id="7304162">=</span>&nbsp;<span class="ident" id="7304164">net</span><span class="op" id="7304167">.</span><span class="ident" id="7304168">Listen</span><span class="op" id="7304174">(</span><span class="string" id="7304175">&#34;tcp6&#34;</span><span class="op" id="7304181">,</span>&nbsp;<span class="string" id="7304183">&#34;[::1]:0&#34;</span><span class="op" id="7304192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304195">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304198">if</span>&nbsp;<span class="ident" id="7304201">err</span>&nbsp;<span class="op" id="7304205">!=</span>&nbsp;<span class="ident" id="7304208">nil</span>&nbsp;<span class="op" id="7304212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304216">t</span><span class="op" id="7304217">.</span><span class="ident" id="7304218">Fatal</span><span class="op" id="7304223">(</span><span class="ident" id="7304224">err</span><span class="op" id="7304227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304233">return</span>&nbsp;<span class="ident" id="7304240">ln</span><br>
<span class="lineno"></span><span class="op" id="7304243">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7304246">func</span>&nbsp;<span class="ident" id="7304251">TestDialTimeout</span><span class="op" id="7304266">(</span><span class="ident" id="7304267">t</span>&nbsp;<span class="op" id="7304269">*</span><span class="ident" id="7304270">testing</span><span class="op" id="7304277">.</span><span class="ident" id="7304278">T</span><span class="op" id="7304279">)</span>&nbsp;<span class="op" id="7304281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304284">if</span>&nbsp;<span class="ident" id="7304287">testing</span><span class="op" id="7304294">.</span><span class="ident" id="7304295">Short</span><span class="op" id="7304300">(</span><span class="op" id="7304301">)</span>&nbsp;<span class="op" id="7304303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304307">t</span><span class="op" id="7304308">.</span><span class="ident" id="7304309">Skip</span><span class="op" id="7304313">(</span><span class="string" id="7304314">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7304338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304341">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304344">listener</span>&nbsp;<span class="op" id="7304353">:=</span>&nbsp;<span class="ident" id="7304356">newLocalListener</span><span class="op" id="7304372">(</span><span class="ident" id="7304373">t</span><span class="op" id="7304374">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304378">addr</span>&nbsp;<span class="op" id="7304383">:=</span>&nbsp;<span class="ident" id="7304386">listener</span><span class="op" id="7304394">.</span><span class="ident" id="7304395">Addr</span><span class="op" id="7304399">(</span><span class="op" id="7304400">)</span><span class="op" id="7304401">.</span><span class="ident" id="7304402">String</span><span class="op" id="7304408">(</span><span class="op" id="7304409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304412">defer</span>&nbsp;<span class="ident" id="7304418">listener</span><span class="op" id="7304426">.</span><span class="ident" id="7304427">Close</span><span class="op" id="7304432">(</span><span class="op" id="7304433">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304437">complete</span>&nbsp;<span class="op" id="7304446">:=</span>&nbsp;<span class="builtinfunc" id="7304449">make</span><span class="op" id="7304453">(</span><span class="keyword" id="7304454">chan</span>&nbsp;<span class="builtintype" id="7304459">bool</span><span class="op" id="7304463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304466">defer</span>&nbsp;<span class="builtinfunc" id="7304472">close</span><span class="op" id="7304477">(</span><span class="ident" id="7304478">complete</span><span class="op" id="7304486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304490">go</span>&nbsp;<span class="keyword" id="7304493">func</span><span class="op" id="7304497">(</span><span class="op" id="7304498">)</span>&nbsp;<span class="op" id="7304500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304504">conn</span><span class="op" id="7304508">,</span>&nbsp;<span class="ident" id="7304510">err</span>&nbsp;<span class="op" id="7304514">:=</span>&nbsp;<span class="ident" id="7304517">listener</span><span class="op" id="7304525">.</span><span class="ident" id="7304526">Accept</span><span class="op" id="7304532">(</span><span class="op" id="7304533">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304537">if</span>&nbsp;<span class="ident" id="7304540">err</span>&nbsp;<span class="op" id="7304544">!=</span>&nbsp;<span class="ident" id="7304547">nil</span>&nbsp;<span class="op" id="7304551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304556">t</span><span class="op" id="7304557">.</span><span class="ident" id="7304558">Error</span><span class="op" id="7304563">(</span><span class="ident" id="7304564">err</span><span class="op" id="7304567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304572">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304585">&lt;-</span><span class="ident" id="7304587">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304598">conn</span><span class="op" id="7304602">.</span><span class="ident" id="7304603">Close</span><span class="op" id="7304608">(</span><span class="op" id="7304609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304612">}</span><span class="op" id="7304613">(</span><span class="op" id="7304614">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304618">dialer</span>&nbsp;<span class="op" id="7304625">:=</span>&nbsp;<span class="op" id="7304628">&amp;</span><span class="ident" id="7304629">net</span><span class="op" id="7304632">.</span><span class="ident" id="7304633">Dialer</span><span class="op" id="7304639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304643">Timeout</span><span class="op" id="7304650">:</span>&nbsp;<span class="num" id="7304652">10</span>&nbsp;<span class="op" id="7304655">*</span>&nbsp;<span class="ident" id="7304657">time</span><span class="op" id="7304661">.</span><span class="ident" id="7304662">Millisecond</span><span class="op" id="7304673">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304680">var</span>&nbsp;<span class="ident" id="7304684">err</span>&nbsp;<span class="builtintype" id="7304688">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304695">if</span>&nbsp;<span class="ident" id="7304698">_</span><span class="op" id="7304699">,</span>&nbsp;<span class="ident" id="7304701">err</span>&nbsp;<span class="op" id="7304705">=</span>&nbsp;<span class="ident" id="7304707">DialWithDialer</span><span class="op" id="7304721">(</span><span class="ident" id="7304722">dialer</span><span class="op" id="7304728">,</span>&nbsp;<span class="string" id="7304730">&#34;tcp&#34;</span><span class="op" id="7304735">,</span>&nbsp;<span class="ident" id="7304737">addr</span><span class="op" id="7304741">,</span>&nbsp;<span class="ident" id="7304743">nil</span><span class="op" id="7304746">)</span><span class="op" id="7304747">;</span>&nbsp;<span class="ident" id="7304749">err</span>&nbsp;<span class="op" id="7304753">==</span>&nbsp;<span class="ident" id="7304756">nil</span>&nbsp;<span class="op" id="7304760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304764">t</span><span class="op" id="7304765">.</span><span class="ident" id="7304766">Fatal</span><span class="op" id="7304771">(</span><span class="string" id="7304772">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="7304812">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7304819">if</span>&nbsp;<span class="op" id="7304822">!</span><span class="ident" id="7304823">strings</span><span class="op" id="7304830">.</span><span class="ident" id="7304831">Contains</span><span class="op" id="7304839">(</span><span class="ident" id="7304840">err</span><span class="op" id="7304843">.</span><span class="ident" id="7304844">Error</span><span class="op" id="7304849">(</span><span class="op" id="7304850">)</span><span class="op" id="7304851">,</span>&nbsp;<span class="string" id="7304853">&#34;timed&nbsp;out&#34;</span><span class="op" id="7304864">)</span>&nbsp;<span class="op" id="7304866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7304870">t</span><span class="op" id="7304871">.</span><span class="ident" id="7304872">Errorf</span><span class="op" id="7304878">(</span><span class="string" id="7304879">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="7304914">,</span>&nbsp;<span class="ident" id="7304916">err</span><span class="op" id="7304919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7304922">}</span><br>
<span class="lineno">160</span><span class="op" id="7304924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7304927">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7304989">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="7305057">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="7305103">func</span>&nbsp;<span class="ident" id="7305108">TestConnReadNonzeroAndEOF</span><span class="op" id="7305133">(</span><span class="ident" id="7305134">t</span>&nbsp;<span class="op" id="7305136">*</span><span class="ident" id="7305137">testing</span><span class="op" id="7305144">.</span><span class="ident" id="7305145">T</span><span class="op" id="7305146">)</span>&nbsp;<span class="op" id="7305148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305151">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305209">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305267">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305330">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305389">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7305452">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305487">if</span>&nbsp;<span class="ident" id="7305490">testing</span><span class="op" id="7305497">.</span><span class="ident" id="7305498">Short</span><span class="op" id="7305503">(</span><span class="op" id="7305504">)</span>&nbsp;<span class="op" id="7305506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305510">t</span><span class="op" id="7305511">.</span><span class="ident" id="7305512">Skip</span><span class="op" id="7305516">(</span><span class="string" id="7305517">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7305541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305544">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305547">var</span>&nbsp;<span class="ident" id="7305551">err</span>&nbsp;<span class="builtintype" id="7305555">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305562">for</span>&nbsp;<span class="ident" id="7305566">delay</span>&nbsp;<span class="op" id="7305572">:=</span>&nbsp;<span class="ident" id="7305575">time</span><span class="op" id="7305579">.</span><span class="ident" id="7305580">Millisecond</span><span class="op" id="7305591">;</span>&nbsp;<span class="ident" id="7305593">delay</span>&nbsp;<span class="op" id="7305599">&lt;=</span>&nbsp;<span class="num" id="7305602">64</span><span class="op" id="7305604">*</span><span class="ident" id="7305605">time</span><span class="op" id="7305609">.</span><span class="ident" id="7305610">Millisecond</span><span class="op" id="7305621">;</span>&nbsp;<span class="ident" id="7305623">delay</span>&nbsp;<span class="op" id="7305629">*=</span>&nbsp;<span class="num" id="7305632">2</span>&nbsp;<span class="op" id="7305634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305638">if</span>&nbsp;<span class="ident" id="7305641">err</span>&nbsp;<span class="op" id="7305645">=</span>&nbsp;<span class="ident" id="7305647">testConnReadNonzeroAndEOF</span><span class="op" id="7305672">(</span><span class="ident" id="7305673">t</span><span class="op" id="7305674">,</span>&nbsp;<span class="ident" id="7305676">delay</span><span class="op" id="7305681">)</span><span class="op" id="7305682">;</span>&nbsp;<span class="ident" id="7305684">err</span>&nbsp;<span class="op" id="7305688">==</span>&nbsp;<span class="ident" id="7305691">nil</span>&nbsp;<span class="op" id="7305695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305709">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305715">t</span><span class="op" id="7305716">.</span><span class="ident" id="7305717">Error</span><span class="op" id="7305722">(</span><span class="ident" id="7305723">err</span><span class="op" id="7305726">)</span><br>
<span class="lineno"></span><span class="op" id="7305728">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7305731">func</span>&nbsp;<span class="ident" id="7305736">testConnReadNonzeroAndEOF</span><span class="op" id="7305761">(</span><span class="ident" id="7305762">t</span>&nbsp;<span class="op" id="7305764">*</span><span class="ident" id="7305765">testing</span><span class="op" id="7305772">.</span><span class="ident" id="7305773">T</span><span class="op" id="7305774">,</span>&nbsp;<span class="ident" id="7305776">delay</span>&nbsp;<span class="ident" id="7305782">time</span><span class="op" id="7305786">.</span><span class="ident" id="7305787">Duration</span><span class="op" id="7305795">)</span>&nbsp;<span class="builtintype" id="7305797">error</span>&nbsp;<span class="op" id="7305803">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305806">ln</span>&nbsp;<span class="op" id="7305809">:=</span>&nbsp;<span class="ident" id="7305812">newLocalListener</span><span class="op" id="7305828">(</span><span class="ident" id="7305829">t</span><span class="op" id="7305830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305833">defer</span>&nbsp;<span class="ident" id="7305839">ln</span><span class="op" id="7305841">.</span><span class="ident" id="7305842">Close</span><span class="op" id="7305847">(</span><span class="op" id="7305848">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305852">srvCh</span>&nbsp;<span class="op" id="7305858">:=</span>&nbsp;<span class="builtinfunc" id="7305861">make</span><span class="op" id="7305865">(</span><span class="keyword" id="7305866">chan</span>&nbsp;<span class="op" id="7305871">*</span><span class="ident" id="7305872">Conn</span><span class="op" id="7305876">,</span>&nbsp;<span class="num" id="7305878">1</span><span class="op" id="7305879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305882">var</span>&nbsp;<span class="ident" id="7305886">serr</span>&nbsp;<span class="builtintype" id="7305891">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305898">go</span>&nbsp;<span class="keyword" id="7305901">func</span><span class="op" id="7305905">(</span><span class="op" id="7305906">)</span>&nbsp;<span class="op" id="7305908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305912">sconn</span><span class="op" id="7305917">,</span>&nbsp;<span class="ident" id="7305919">err</span>&nbsp;<span class="op" id="7305923">:=</span>&nbsp;<span class="ident" id="7305926">ln</span><span class="op" id="7305928">.</span><span class="ident" id="7305929">Accept</span><span class="op" id="7305935">(</span><span class="op" id="7305936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305940">if</span>&nbsp;<span class="ident" id="7305943">err</span>&nbsp;<span class="op" id="7305947">!=</span>&nbsp;<span class="ident" id="7305950">nil</span>&nbsp;<span class="op" id="7305954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305959">serr</span>&nbsp;<span class="op" id="7305964">=</span>&nbsp;<span class="ident" id="7305966">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7305973">srvCh</span>&nbsp;<span class="op" id="7305979">&lt;-</span>&nbsp;<span class="ident" id="7305982">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7305989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7305998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306002">serverConfig</span>&nbsp;<span class="op" id="7306015">:=</span>&nbsp;<span class="op" id="7306018">*</span><span class="ident" id="7306019">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306032">srv</span>&nbsp;<span class="op" id="7306036">:=</span>&nbsp;<span class="ident" id="7306039">Server</span><span class="op" id="7306045">(</span><span class="ident" id="7306046">sconn</span><span class="op" id="7306051">,</span>&nbsp;<span class="op" id="7306053">&amp;</span><span class="ident" id="7306054">serverConfig</span><span class="op" id="7306066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306070">if</span>&nbsp;<span class="ident" id="7306073">err</span>&nbsp;<span class="op" id="7306077">:=</span>&nbsp;<span class="ident" id="7306080">srv</span><span class="op" id="7306083">.</span><span class="ident" id="7306084">Handshake</span><span class="op" id="7306093">(</span><span class="op" id="7306094">)</span><span class="op" id="7306095">;</span>&nbsp;<span class="ident" id="7306097">err</span>&nbsp;<span class="op" id="7306101">!=</span>&nbsp;<span class="ident" id="7306104">nil</span>&nbsp;<span class="op" id="7306108">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306113">serr</span>&nbsp;<span class="op" id="7306118">=</span>&nbsp;<span class="ident" id="7306120">fmt</span><span class="op" id="7306123">.</span><span class="ident" id="7306124">Errorf</span><span class="op" id="7306130">(</span><span class="string" id="7306131">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="7306146">,</span>&nbsp;<span class="ident" id="7306148">err</span><span class="op" id="7306151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306156">srvCh</span>&nbsp;<span class="op" id="7306162">&lt;-</span>&nbsp;<span class="ident" id="7306165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306172">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306185">srvCh</span>&nbsp;<span class="op" id="7306191">&lt;-</span>&nbsp;<span class="ident" id="7306194">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306199">}</span><span class="op" id="7306200">(</span><span class="op" id="7306201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306205">clientConfig</span>&nbsp;<span class="op" id="7306218">:=</span>&nbsp;<span class="op" id="7306221">*</span><span class="ident" id="7306222">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306234">conn</span><span class="op" id="7306238">,</span>&nbsp;<span class="ident" id="7306240">err</span>&nbsp;<span class="op" id="7306244">:=</span>&nbsp;<span class="ident" id="7306247">Dial</span><span class="op" id="7306251">(</span><span class="string" id="7306252">&#34;tcp&#34;</span><span class="op" id="7306257">,</span>&nbsp;<span class="ident" id="7306259">ln</span><span class="op" id="7306261">.</span><span class="ident" id="7306262">Addr</span><span class="op" id="7306266">(</span><span class="op" id="7306267">)</span><span class="op" id="7306268">.</span><span class="ident" id="7306269">String</span><span class="op" id="7306275">(</span><span class="op" id="7306276">)</span><span class="op" id="7306277">,</span>&nbsp;<span class="op" id="7306279">&amp;</span><span class="ident" id="7306280">clientConfig</span><span class="op" id="7306292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306295">if</span>&nbsp;<span class="ident" id="7306298">err</span>&nbsp;<span class="op" id="7306302">!=</span>&nbsp;<span class="ident" id="7306305">nil</span>&nbsp;<span class="op" id="7306309">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306313">t</span><span class="op" id="7306314">.</span><span class="ident" id="7306315">Fatal</span><span class="op" id="7306320">(</span><span class="ident" id="7306321">err</span><span class="op" id="7306324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306330">defer</span>&nbsp;<span class="ident" id="7306336">conn</span><span class="op" id="7306340">.</span><span class="ident" id="7306341">Close</span><span class="op" id="7306346">(</span><span class="op" id="7306347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306351">srv</span>&nbsp;<span class="op" id="7306355">:=</span>&nbsp;<span class="op" id="7306358">&lt;-</span><span class="ident" id="7306360">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306367">if</span>&nbsp;<span class="ident" id="7306370">srv</span>&nbsp;<span class="op" id="7306374">==</span>&nbsp;<span class="ident" id="7306377">nil</span>&nbsp;<span class="op" id="7306381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306385">return</span>&nbsp;<span class="ident" id="7306392">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306402">buf</span>&nbsp;<span class="op" id="7306406">:=</span>&nbsp;<span class="builtinfunc" id="7306409">make</span><span class="op" id="7306413">(</span><span class="op" id="7306414">[</span><span class="op" id="7306415">]</span><span class="builtintype" id="7306416">byte</span><span class="op" id="7306420">,</span>&nbsp;<span class="num" id="7306422">6</span><span class="op" id="7306423">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306427">srv</span><span class="op" id="7306430">.</span><span class="ident" id="7306431">Write</span><span class="op" id="7306436">(</span><span class="op" id="7306437">[</span><span class="op" id="7306438">]</span><span class="builtintype" id="7306439">byte</span><span class="op" id="7306443">(</span><span class="string" id="7306444">&#34;foobar&#34;</span><span class="op" id="7306452">)</span><span class="op" id="7306453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306456">n</span><span class="op" id="7306457">,</span>&nbsp;<span class="ident" id="7306459">err</span>&nbsp;<span class="op" id="7306463">:=</span>&nbsp;<span class="ident" id="7306466">conn</span><span class="op" id="7306470">.</span><span class="ident" id="7306471">Read</span><span class="op" id="7306475">(</span><span class="ident" id="7306476">buf</span><span class="op" id="7306479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306482">if</span>&nbsp;<span class="ident" id="7306485">n</span>&nbsp;<span class="op" id="7306487">!=</span>&nbsp;<span class="num" id="7306490">6</span>&nbsp;<span class="op" id="7306492">||</span>&nbsp;<span class="ident" id="7306495">err</span>&nbsp;<span class="op" id="7306499">!=</span>&nbsp;<span class="ident" id="7306502">nil</span>&nbsp;<span class="op" id="7306506">||</span>&nbsp;<span class="builtintype" id="7306509">string</span><span class="op" id="7306515">(</span><span class="ident" id="7306516">buf</span><span class="op" id="7306519">)</span>&nbsp;<span class="op" id="7306521">!=</span>&nbsp;<span class="string" id="7306524">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7306533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306537">return</span>&nbsp;<span class="ident" id="7306544">fmt</span><span class="op" id="7306547">.</span><span class="ident" id="7306548">Errorf</span><span class="op" id="7306554">(</span><span class="string" id="7306555">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="7306600">,</span>&nbsp;<span class="ident" id="7306602">n</span><span class="op" id="7306603">,</span>&nbsp;<span class="ident" id="7306605">err</span><span class="op" id="7306608">,</span>&nbsp;<span class="ident" id="7306610">buf</span><span class="op" id="7306613">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306620">srv</span><span class="op" id="7306623">.</span><span class="ident" id="7306624">Write</span><span class="op" id="7306629">(</span><span class="op" id="7306630">[</span><span class="op" id="7306631">]</span><span class="builtintype" id="7306632">byte</span><span class="op" id="7306636">(</span><span class="string" id="7306637">&#34;abcdef&#34;</span><span class="op" id="7306645">)</span><span class="op" id="7306646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306649">srv</span><span class="op" id="7306652">.</span><span class="ident" id="7306653">Close</span><span class="op" id="7306658">(</span><span class="op" id="7306659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306662">time</span><span class="op" id="7306666">.</span><span class="ident" id="7306667">Sleep</span><span class="op" id="7306672">(</span><span class="ident" id="7306673">delay</span><span class="op" id="7306678">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306681">n</span><span class="op" id="7306682">,</span>&nbsp;<span class="ident" id="7306684">err</span>&nbsp;<span class="op" id="7306688">=</span>&nbsp;<span class="ident" id="7306690">conn</span><span class="op" id="7306694">.</span><span class="ident" id="7306695">Read</span><span class="op" id="7306699">(</span><span class="ident" id="7306700">buf</span><span class="op" id="7306703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306706">if</span>&nbsp;<span class="ident" id="7306709">n</span>&nbsp;<span class="op" id="7306711">!=</span>&nbsp;<span class="num" id="7306714">6</span>&nbsp;<span class="op" id="7306716">||</span>&nbsp;<span class="builtintype" id="7306719">string</span><span class="op" id="7306725">(</span><span class="ident" id="7306726">buf</span><span class="op" id="7306729">)</span>&nbsp;<span class="op" id="7306731">!=</span>&nbsp;<span class="string" id="7306734">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="7306743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306747">return</span>&nbsp;<span class="ident" id="7306754">fmt</span><span class="op" id="7306757">.</span><span class="ident" id="7306758">Errorf</span><span class="op" id="7306764">(</span><span class="string" id="7306765">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="7306801">,</span>&nbsp;<span class="ident" id="7306803">n</span><span class="op" id="7306804">,</span>&nbsp;<span class="ident" id="7306806">buf</span><span class="op" id="7306809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306815">if</span>&nbsp;<span class="ident" id="7306818">err</span>&nbsp;<span class="op" id="7306822">!=</span>&nbsp;<span class="ident" id="7306825">io</span><span class="op" id="7306827">.</span><span class="ident" id="7306828">EOF</span>&nbsp;<span class="op" id="7306832">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306836">return</span>&nbsp;<span class="ident" id="7306843">fmt</span><span class="op" id="7306846">.</span><span class="ident" id="7306847">Errorf</span><span class="op" id="7306853">(</span><span class="string" id="7306854">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7306891">,</span>&nbsp;<span class="ident" id="7306893">err</span><span class="op" id="7306896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7306899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306902">return</span>&nbsp;<span class="ident" id="7306909">nil</span><br>
<span class="lineno"></span><span class="op" id="7306913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7306916">func</span>&nbsp;<span class="ident" id="7306921">TestTLSUniqueMatches</span><span class="op" id="7306941">(</span><span class="ident" id="7306942">t</span>&nbsp;<span class="op" id="7306944">*</span><span class="ident" id="7306945">testing</span><span class="op" id="7306952">.</span><span class="ident" id="7306953">T</span><span class="op" id="7306954">)</span>&nbsp;<span class="op" id="7306956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7306959">ln</span>&nbsp;<span class="op" id="7306962">:=</span>&nbsp;<span class="ident" id="7306965">newLocalListener</span><span class="op" id="7306981">(</span><span class="ident" id="7306982">t</span><span class="op" id="7306983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7306986">defer</span>&nbsp;<span class="ident" id="7306992">ln</span><span class="op" id="7306994">.</span><span class="ident" id="7306995">Close</span><span class="op" id="7307000">(</span><span class="op" id="7307001">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307005">serverTLSUniques</span>&nbsp;<span class="op" id="7307022">:=</span>&nbsp;<span class="builtinfunc" id="7307025">make</span><span class="op" id="7307029">(</span><span class="keyword" id="7307030">chan</span>&nbsp;<span class="op" id="7307035">[</span><span class="op" id="7307036">]</span><span class="builtintype" id="7307037">byte</span><span class="op" id="7307041">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307044">go</span>&nbsp;<span class="keyword" id="7307047">func</span><span class="op" id="7307051">(</span><span class="op" id="7307052">)</span>&nbsp;<span class="op" id="7307054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307058">for</span>&nbsp;<span class="ident" id="7307062">i</span>&nbsp;<span class="op" id="7307064">:=</span>&nbsp;<span class="num" id="7307067">0</span><span class="op" id="7307068">;</span>&nbsp;<span class="ident" id="7307070">i</span>&nbsp;<span class="op" id="7307072">&lt;</span>&nbsp;<span class="num" id="7307074">2</span><span class="op" id="7307075">;</span>&nbsp;<span class="ident" id="7307077">i</span><span class="op" id="7307078">++</span>&nbsp;<span class="op" id="7307081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307086">sconn</span><span class="op" id="7307091">,</span>&nbsp;<span class="ident" id="7307093">err</span>&nbsp;<span class="op" id="7307097">:=</span>&nbsp;<span class="ident" id="7307100">ln</span><span class="op" id="7307102">.</span><span class="ident" id="7307103">Accept</span><span class="op" id="7307109">(</span><span class="op" id="7307110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307115">if</span>&nbsp;<span class="ident" id="7307118">err</span>&nbsp;<span class="op" id="7307122">!=</span>&nbsp;<span class="ident" id="7307125">nil</span>&nbsp;<span class="op" id="7307129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307135">t</span><span class="op" id="7307136">.</span><span class="ident" id="7307137">Fatal</span><span class="op" id="7307142">(</span><span class="ident" id="7307143">err</span><span class="op" id="7307146">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307156">serverConfig</span>&nbsp;<span class="op" id="7307169">:=</span>&nbsp;<span class="op" id="7307172">*</span><span class="ident" id="7307173">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307187">srv</span>&nbsp;<span class="op" id="7307191">:=</span>&nbsp;<span class="ident" id="7307194">Server</span><span class="op" id="7307200">(</span><span class="ident" id="7307201">sconn</span><span class="op" id="7307206">,</span>&nbsp;<span class="op" id="7307208">&amp;</span><span class="ident" id="7307209">serverConfig</span><span class="op" id="7307221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307226">if</span>&nbsp;<span class="ident" id="7307229">err</span>&nbsp;<span class="op" id="7307233">:=</span>&nbsp;<span class="ident" id="7307236">srv</span><span class="op" id="7307239">.</span><span class="ident" id="7307240">Handshake</span><span class="op" id="7307249">(</span><span class="op" id="7307250">)</span><span class="op" id="7307251">;</span>&nbsp;<span class="ident" id="7307253">err</span>&nbsp;<span class="op" id="7307257">!=</span>&nbsp;<span class="ident" id="7307260">nil</span>&nbsp;<span class="op" id="7307264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307270">t</span><span class="op" id="7307271">.</span><span class="ident" id="7307272">Fatal</span><span class="op" id="7307277">(</span><span class="ident" id="7307278">err</span><span class="op" id="7307281">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307291">serverTLSUniques</span>&nbsp;<span class="op" id="7307308">&lt;-</span>&nbsp;<span class="ident" id="7307311">srv</span><span class="op" id="7307314">.</span><span class="ident" id="7307315">ConnectionState</span><span class="op" id="7307330">(</span><span class="op" id="7307331">)</span><span class="op" id="7307332">.</span><span class="ident" id="7307333">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307348">}</span><span class="op" id="7307349">(</span><span class="op" id="7307350">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307354">clientConfig</span>&nbsp;<span class="op" id="7307367">:=</span>&nbsp;<span class="op" id="7307370">*</span><span class="ident" id="7307371">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307383">clientConfig</span><span class="op" id="7307395">.</span><span class="ident" id="7307396">ClientSessionCache</span>&nbsp;<span class="op" id="7307415">=</span>&nbsp;<span class="ident" id="7307417">NewLRUClientSessionCache</span><span class="op" id="7307441">(</span><span class="num" id="7307442">1</span><span class="op" id="7307443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307446">conn</span><span class="op" id="7307450">,</span>&nbsp;<span class="ident" id="7307452">err</span>&nbsp;<span class="op" id="7307456">:=</span>&nbsp;<span class="ident" id="7307459">Dial</span><span class="op" id="7307463">(</span><span class="string" id="7307464">&#34;tcp&#34;</span><span class="op" id="7307469">,</span>&nbsp;<span class="ident" id="7307471">ln</span><span class="op" id="7307473">.</span><span class="ident" id="7307474">Addr</span><span class="op" id="7307478">(</span><span class="op" id="7307479">)</span><span class="op" id="7307480">.</span><span class="ident" id="7307481">String</span><span class="op" id="7307487">(</span><span class="op" id="7307488">)</span><span class="op" id="7307489">,</span>&nbsp;<span class="op" id="7307491">&amp;</span><span class="ident" id="7307492">clientConfig</span><span class="op" id="7307504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307507">if</span>&nbsp;<span class="ident" id="7307510">err</span>&nbsp;<span class="op" id="7307514">!=</span>&nbsp;<span class="ident" id="7307517">nil</span>&nbsp;<span class="op" id="7307521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307525">t</span><span class="op" id="7307526">.</span><span class="ident" id="7307527">Fatal</span><span class="op" id="7307532">(</span><span class="ident" id="7307533">err</span><span class="op" id="7307536">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307542">if</span>&nbsp;<span class="op" id="7307545">!</span><span class="ident" id="7307546">bytes</span><span class="op" id="7307551">.</span><span class="ident" id="7307552">Equal</span><span class="op" id="7307557">(</span><span class="ident" id="7307558">conn</span><span class="op" id="7307562">.</span><span class="ident" id="7307563">ConnectionState</span><span class="op" id="7307578">(</span><span class="op" id="7307579">)</span><span class="op" id="7307580">.</span><span class="ident" id="7307581">TLSUnique</span><span class="op" id="7307590">,</span>&nbsp;<span class="op" id="7307592">&lt;-</span><span class="ident" id="7307594">serverTLSUniques</span><span class="op" id="7307610">)</span>&nbsp;<span class="op" id="7307612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307616">t</span><span class="op" id="7307617">.</span><span class="ident" id="7307618">Error</span><span class="op" id="7307623">(</span><span class="string" id="7307624">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="7307667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307673">conn</span><span class="op" id="7307677">.</span><span class="ident" id="7307678">Close</span><span class="op" id="7307683">(</span><span class="op" id="7307684">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307688">conn</span><span class="op" id="7307692">,</span>&nbsp;<span class="ident" id="7307694">err</span>&nbsp;<span class="op" id="7307698">=</span>&nbsp;<span class="ident" id="7307700">Dial</span><span class="op" id="7307704">(</span><span class="string" id="7307705">&#34;tcp&#34;</span><span class="op" id="7307710">,</span>&nbsp;<span class="ident" id="7307712">ln</span><span class="op" id="7307714">.</span><span class="ident" id="7307715">Addr</span><span class="op" id="7307719">(</span><span class="op" id="7307720">)</span><span class="op" id="7307721">.</span><span class="ident" id="7307722">String</span><span class="op" id="7307728">(</span><span class="op" id="7307729">)</span><span class="op" id="7307730">,</span>&nbsp;<span class="op" id="7307732">&amp;</span><span class="ident" id="7307733">clientConfig</span><span class="op" id="7307745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307748">if</span>&nbsp;<span class="ident" id="7307751">err</span>&nbsp;<span class="op" id="7307755">!=</span>&nbsp;<span class="ident" id="7307758">nil</span>&nbsp;<span class="op" id="7307762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307766">t</span><span class="op" id="7307767">.</span><span class="ident" id="7307768">Fatal</span><span class="op" id="7307773">(</span><span class="ident" id="7307774">err</span><span class="op" id="7307777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307780">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307783">defer</span>&nbsp;<span class="ident" id="7307789">conn</span><span class="op" id="7307793">.</span><span class="ident" id="7307794">Close</span><span class="op" id="7307799">(</span><span class="op" id="7307800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307803">if</span>&nbsp;<span class="op" id="7307806">!</span><span class="ident" id="7307807">conn</span><span class="op" id="7307811">.</span><span class="ident" id="7307812">ConnectionState</span><span class="op" id="7307827">(</span><span class="op" id="7307828">)</span><span class="op" id="7307829">.</span><span class="ident" id="7307830">DidResume</span>&nbsp;<span class="op" id="7307840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307844">t</span><span class="op" id="7307845">.</span><span class="ident" id="7307846">Error</span><span class="op" id="7307851">(</span><span class="string" id="7307852">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="7307891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7307894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7307897">if</span>&nbsp;<span class="op" id="7307900">!</span><span class="ident" id="7307901">bytes</span><span class="op" id="7307906">.</span><span class="ident" id="7307907">Equal</span><span class="op" id="7307912">(</span><span class="ident" id="7307913">conn</span><span class="op" id="7307917">.</span><span class="ident" id="7307918">ConnectionState</span><span class="op" id="7307933">(</span><span class="op" id="7307934">)</span><span class="op" id="7307935">.</span><span class="ident" id="7307936">TLSUnique</span><span class="op" id="7307945">,</span>&nbsp;<span class="op" id="7307947">&lt;-</span><span class="ident" id="7307949">serverTLSUniques</span><span class="op" id="7307965">)</span>&nbsp;<span class="op" id="7307967">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7307971">t</span><span class="op" id="7307972">.</span><span class="ident" id="7307973">Error</span><span class="op" id="7307978">(</span><span class="string" id="7307979">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="7308054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7308057">}</span><br>
<span class="lineno"></span><span class="op" id="7308059">}</span>
</div>
</body>
</html>
