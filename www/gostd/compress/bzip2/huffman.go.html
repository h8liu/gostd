<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5391816">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5391871">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5391925">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5391976">package</span>&nbsp;<span class="ident" id="5391984">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5391991">import</span>&nbsp;<span class="string" id="5391998">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5392006">//&nbsp;A&nbsp;huffmanTree&nbsp;is&nbsp;a&nbsp;binary&nbsp;tree&nbsp;which&nbsp;is&nbsp;navigated,&nbsp;bit-by-bit&nbsp;to&nbsp;reach&nbsp;a</span><br>
<span class="lineno">10</span><span class="comment" id="5392082">//&nbsp;symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5392093">type</span>&nbsp;<span class="ident" id="5392098">huffmanTree</span>&nbsp;<span class="keyword" id="5392110">struct</span>&nbsp;<span class="op" id="5392117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392120">//&nbsp;nodes&nbsp;contains&nbsp;all&nbsp;the&nbsp;non-leaf&nbsp;nodes&nbsp;in&nbsp;the&nbsp;tree.&nbsp;nodes[0]&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392191">//&nbsp;root&nbsp;of&nbsp;the&nbsp;tree&nbsp;and&nbsp;nextNode&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;next&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5392264">//&nbsp;of&nbsp;nodes&nbsp;to&nbsp;use&nbsp;when&nbsp;the&nbsp;tree&nbsp;is&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392320">nodes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5392329">[</span><span class="op" id="5392330">]</span><span class="ident" id="5392331">huffmanNode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392344">nextNode</span>&nbsp;<span class="builtintype" id="5392353">int</span><br>
<span class="lineno"></span><span class="op" id="5392357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5392360">//&nbsp;A&nbsp;huffmanNode&nbsp;is&nbsp;a&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.&nbsp;left&nbsp;and&nbsp;right&nbsp;contain&nbsp;indexes&nbsp;into&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="5392440">//&nbsp;nodes&nbsp;slice&nbsp;of&nbsp;the&nbsp;tree.&nbsp;If&nbsp;left&nbsp;or&nbsp;right&nbsp;is&nbsp;invalidNodeValue&nbsp;then&nbsp;the&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="5392520">//&nbsp;is&nbsp;a&nbsp;left&nbsp;node&nbsp;and&nbsp;its&nbsp;value&nbsp;is&nbsp;in&nbsp;leftValue/rightValue.</span><br>
<span class="lineno"></span><span class="comment" id="5392580">//</span><br>
<span class="lineno"></span><span class="comment" id="5392583">//&nbsp;The&nbsp;symbols&nbsp;are&nbsp;uint16s&nbsp;because&nbsp;bzip2&nbsp;encodes&nbsp;not&nbsp;only&nbsp;MTF&nbsp;indexes&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5392660">//&nbsp;tree,&nbsp;but&nbsp;also&nbsp;two&nbsp;magic&nbsp;values&nbsp;for&nbsp;run-length&nbsp;encoding&nbsp;and&nbsp;an&nbsp;EOF&nbsp;symbol.</span><br>
<span class="lineno">25</span><span class="comment" id="5392738">//&nbsp;Thus&nbsp;there&nbsp;are&nbsp;more&nbsp;than&nbsp;256&nbsp;possible&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5392788">type</span>&nbsp;<span class="ident" id="5392793">huffmanNode</span>&nbsp;<span class="keyword" id="5392805">struct</span>&nbsp;<span class="op" id="5392812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392815">left</span><span class="op" id="5392819">,</span>&nbsp;<span class="ident" id="5392821">right</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5392837">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5392845">leftValue</span><span class="op" id="5392854">,</span>&nbsp;<span class="ident" id="5392856">rightValue</span>&nbsp;<span class="builtintype" id="5392867">uint16</span><br>
<span class="lineno"></span><span class="op" id="5392874">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="5392877">//&nbsp;invalidNodeValue&nbsp;is&nbsp;an&nbsp;invalid&nbsp;index&nbsp;which&nbsp;marks&nbsp;a&nbsp;leaf&nbsp;node&nbsp;in&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><span class="keyword" id="5392954">const</span>&nbsp;<span class="ident" id="5392960">invalidNodeValue</span>&nbsp;<span class="op" id="5392977">=</span>&nbsp;<span class="num" id="5392979">0xffff</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5392987">//&nbsp;Decode&nbsp;reads&nbsp;bits&nbsp;from&nbsp;the&nbsp;given&nbsp;bitReader&nbsp;and&nbsp;navigates&nbsp;the&nbsp;tree&nbsp;until&nbsp;a</span><br>
<span class="lineno">35</span><span class="comment" id="5393064">//&nbsp;symbol&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5393084">func</span>&nbsp;<span class="op" id="5393089">(</span><span class="ident" id="5393090">t</span>&nbsp;<span class="op" id="5393092">*</span><span class="ident" id="5393093">huffmanTree</span><span class="op" id="5393104">)</span>&nbsp;<span class="ident" id="5393106">Decode</span><span class="op" id="5393112">(</span><span class="ident" id="5393113">br</span>&nbsp;<span class="op" id="5393116">*</span><span class="ident" id="5393117">bitReader</span><span class="op" id="5393126">)</span>&nbsp;<span class="op" id="5393128">(</span><span class="ident" id="5393129">v</span>&nbsp;<span class="builtintype" id="5393131">uint16</span><span class="op" id="5393137">)</span>&nbsp;<span class="op" id="5393139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393142">nodeIndex</span>&nbsp;<span class="op" id="5393152">:=</span>&nbsp;<span class="builtintype" id="5393155">uint16</span><span class="op" id="5393161">(</span><span class="num" id="5393162">0</span><span class="op" id="5393163">)</span>&nbsp;<span class="comment" id="5393165">//&nbsp;node&nbsp;0&nbsp;is&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;tree.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393202">for</span>&nbsp;<span class="op" id="5393206">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393210">node</span>&nbsp;<span class="op" id="5393215">:=</span>&nbsp;<span class="op" id="5393218">&amp;</span><span class="ident" id="5393219">t</span><span class="op" id="5393220">.</span><span class="ident" id="5393221">nodes</span><span class="op" id="5393226">[</span><span class="ident" id="5393227">nodeIndex</span><span class="op" id="5393236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393240">bit</span><span class="op" id="5393243">,</span>&nbsp;<span class="ident" id="5393245">ok</span>&nbsp;<span class="op" id="5393248">:=</span>&nbsp;<span class="ident" id="5393251">br</span><span class="op" id="5393253">.</span><span class="ident" id="5393254">TryReadBit</span><span class="op" id="5393264">(</span><span class="op" id="5393265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393269">if</span>&nbsp;<span class="op" id="5393272">!</span><span class="ident" id="5393273">ok</span>&nbsp;<span class="op" id="5393276">&amp;&amp;</span>&nbsp;<span class="ident" id="5393279">br</span><span class="op" id="5393281">.</span><span class="ident" id="5393282">ReadBit</span><span class="op" id="5393289">(</span><span class="op" id="5393290">)</span>&nbsp;<span class="op" id="5393292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393297">bit</span>&nbsp;<span class="op" id="5393301">=</span>&nbsp;<span class="num" id="5393303">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393307">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393311">//&nbsp;bzip2&nbsp;encodes&nbsp;left&nbsp;as&nbsp;a&nbsp;true&nbsp;bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393350">if</span>&nbsp;<span class="ident" id="5393353">bit</span>&nbsp;<span class="op" id="5393357">!=</span>&nbsp;<span class="num" id="5393360">0</span>&nbsp;<span class="op" id="5393362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393367">//&nbsp;left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393378">if</span>&nbsp;<span class="ident" id="5393381">node</span><span class="op" id="5393385">.</span><span class="ident" id="5393386">left</span>&nbsp;<span class="op" id="5393391">==</span>&nbsp;<span class="ident" id="5393394">invalidNodeValue</span>&nbsp;<span class="op" id="5393411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393417">return</span>&nbsp;<span class="ident" id="5393424">node</span><span class="op" id="5393428">.</span><span class="ident" id="5393429">leftValue</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393447">nodeIndex</span>&nbsp;<span class="op" id="5393457">=</span>&nbsp;<span class="ident" id="5393459">node</span><span class="op" id="5393463">.</span><span class="ident" id="5393464">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393471">}</span>&nbsp;<span class="keyword" id="5393473">else</span>&nbsp;<span class="op" id="5393478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393483">//&nbsp;right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393495">if</span>&nbsp;<span class="ident" id="5393498">node</span><span class="op" id="5393502">.</span><span class="ident" id="5393503">right</span>&nbsp;<span class="op" id="5393509">==</span>&nbsp;<span class="ident" id="5393512">invalidNodeValue</span>&nbsp;<span class="op" id="5393529">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5393535">return</span>&nbsp;<span class="ident" id="5393542">node</span><span class="op" id="5393546">.</span><span class="ident" id="5393547">rightValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5393566">nodeIndex</span>&nbsp;<span class="op" id="5393576">=</span>&nbsp;<span class="ident" id="5393578">node</span><span class="op" id="5393582">.</span><span class="ident" id="5393583">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5393594">}</span><br>
<span class="lineno">60</span><span class="op" id="5393596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5393599">//&nbsp;newHuffmanTree&nbsp;builds&nbsp;a&nbsp;Huffman&nbsp;tree&nbsp;from&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="5393672">//&nbsp;lengths&nbsp;of&nbsp;each&nbsp;symbol.&nbsp;The&nbsp;maximum&nbsp;code&nbsp;length&nbsp;is&nbsp;32&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="5393735">func</span>&nbsp;<span class="ident" id="5393740">newHuffmanTree</span><span class="op" id="5393754">(</span><span class="ident" id="5393755">lengths</span>&nbsp;<span class="op" id="5393763">[</span><span class="op" id="5393764">]</span><span class="builtintype" id="5393765">uint8</span><span class="op" id="5393770">)</span>&nbsp;<span class="op" id="5393772">(</span><span class="ident" id="5393773">huffmanTree</span><span class="op" id="5393784">,</span>&nbsp;<span class="builtintype" id="5393786">error</span><span class="op" id="5393791">)</span>&nbsp;<span class="op" id="5393793">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393796">//&nbsp;There&nbsp;are&nbsp;many&nbsp;possible&nbsp;trees&nbsp;that&nbsp;assign&nbsp;the&nbsp;same&nbsp;code&nbsp;length&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393866">//&nbsp;each&nbsp;symbol&nbsp;(consider&nbsp;reflecting&nbsp;a&nbsp;tree&nbsp;down&nbsp;the&nbsp;middle,&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393931">//&nbsp;example).&nbsp;Since&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;determine&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5393993">//&nbsp;efficiency&nbsp;of&nbsp;the&nbsp;tree,&nbsp;each&nbsp;of&nbsp;these&nbsp;trees&nbsp;is&nbsp;equally&nbsp;good.&nbsp;In</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394061">//&nbsp;order&nbsp;to&nbsp;minimize&nbsp;the&nbsp;amount&nbsp;of&nbsp;information&nbsp;needed&nbsp;to&nbsp;build&nbsp;a&nbsp;tree</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394132">//&nbsp;bzip2&nbsp;uses&nbsp;a&nbsp;canonical&nbsp;tree&nbsp;so&nbsp;that&nbsp;it&nbsp;can&nbsp;be&nbsp;reconstructed&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394202">//&nbsp;only&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394241">if</span>&nbsp;<span class="builtinfunc" id="5394244">len</span><span class="op" id="5394247">(</span><span class="ident" id="5394248">lengths</span><span class="op" id="5394255">)</span>&nbsp;<span class="op" id="5394257">&lt;</span>&nbsp;<span class="num" id="5394259">2</span>&nbsp;<span class="op" id="5394261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5394265">panic</span><span class="op" id="5394270">(</span><span class="string" id="5394271">&#34;newHuffmanTree:&nbsp;too&nbsp;few&nbsp;symbols&#34;</span><span class="op" id="5394304">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394311">var</span>&nbsp;<span class="ident" id="5394315">t</span>&nbsp;<span class="ident" id="5394317">huffmanTree</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394331">//&nbsp;First&nbsp;we&nbsp;sort&nbsp;the&nbsp;code&nbsp;length&nbsp;assignments&nbsp;by&nbsp;ascending&nbsp;code&nbsp;length,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394403">//&nbsp;using&nbsp;the&nbsp;symbol&nbsp;value&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394445">pairs</span>&nbsp;<span class="op" id="5394451">:=</span>&nbsp;<span class="ident" id="5394454">huffmanSymbolLengthPairs</span><span class="op" id="5394478">(</span><span class="builtinfunc" id="5394479">make</span><span class="op" id="5394483">(</span><span class="op" id="5394484">[</span><span class="op" id="5394485">]</span><span class="ident" id="5394486">huffmanSymbolLengthPair</span><span class="op" id="5394509">,</span>&nbsp;<span class="builtinfunc" id="5394511">len</span><span class="op" id="5394514">(</span><span class="ident" id="5394515">lengths</span><span class="op" id="5394522">)</span><span class="op" id="5394523">)</span><span class="op" id="5394524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394527">for</span>&nbsp;<span class="ident" id="5394531">i</span><span class="op" id="5394532">,</span>&nbsp;<span class="ident" id="5394534">length</span>&nbsp;<span class="op" id="5394541">:=</span>&nbsp;<span class="keyword" id="5394544">range</span>&nbsp;<span class="ident" id="5394550">lengths</span>&nbsp;<span class="op" id="5394558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394562">pairs</span><span class="op" id="5394567">[</span><span class="ident" id="5394568">i</span><span class="op" id="5394569">]</span><span class="op" id="5394570">.</span><span class="ident" id="5394571">value</span>&nbsp;<span class="op" id="5394577">=</span>&nbsp;<span class="builtintype" id="5394579">uint16</span><span class="op" id="5394585">(</span><span class="ident" id="5394586">i</span><span class="op" id="5394587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394591">pairs</span><span class="op" id="5394596">[</span><span class="ident" id="5394597">i</span><span class="op" id="5394598">]</span><span class="op" id="5394599">.</span><span class="ident" id="5394600">length</span>&nbsp;<span class="op" id="5394607">=</span>&nbsp;<span class="ident" id="5394609">length</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5394617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394621">sort</span><span class="op" id="5394625">.</span><span class="ident" id="5394626">Sort</span><span class="op" id="5394630">(</span><span class="ident" id="5394631">pairs</span><span class="op" id="5394636">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394640">//&nbsp;Now&nbsp;we&nbsp;assign&nbsp;codes&nbsp;to&nbsp;the&nbsp;symbols,&nbsp;starting&nbsp;with&nbsp;the&nbsp;longest&nbsp;code.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394712">//&nbsp;We&nbsp;keep&nbsp;the&nbsp;codes&nbsp;packed&nbsp;into&nbsp;a&nbsp;uint32,&nbsp;at&nbsp;the&nbsp;most-significant&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394785">//&nbsp;So&nbsp;branches&nbsp;are&nbsp;taken&nbsp;from&nbsp;the&nbsp;MSB&nbsp;downwards.&nbsp;This&nbsp;makes&nbsp;it&nbsp;easy&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5394857">//&nbsp;sort&nbsp;them&nbsp;later.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394878">code</span>&nbsp;<span class="op" id="5394883">:=</span>&nbsp;<span class="builtintype" id="5394886">uint32</span><span class="op" id="5394892">(</span><span class="num" id="5394893">0</span><span class="op" id="5394894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394897">length</span>&nbsp;<span class="op" id="5394904">:=</span>&nbsp;<span class="builtintype" id="5394907">uint8</span><span class="op" id="5394912">(</span><span class="num" id="5394913">32</span><span class="op" id="5394915">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5394919">codes</span>&nbsp;<span class="op" id="5394925">:=</span>&nbsp;<span class="ident" id="5394928">huffmanCodes</span><span class="op" id="5394940">(</span><span class="builtinfunc" id="5394941">make</span><span class="op" id="5394945">(</span><span class="op" id="5394946">[</span><span class="op" id="5394947">]</span><span class="ident" id="5394948">huffmanCode</span><span class="op" id="5394959">,</span>&nbsp;<span class="builtinfunc" id="5394961">len</span><span class="op" id="5394964">(</span><span class="ident" id="5394965">lengths</span><span class="op" id="5394972">)</span><span class="op" id="5394973">)</span><span class="op" id="5394974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5394977">for</span>&nbsp;<span class="ident" id="5394981">i</span>&nbsp;<span class="op" id="5394983">:=</span>&nbsp;<span class="builtinfunc" id="5394986">len</span><span class="op" id="5394989">(</span><span class="ident" id="5394990">pairs</span><span class="op" id="5394995">)</span>&nbsp;<span class="op" id="5394997">-</span>&nbsp;<span class="num" id="5394999">1</span><span class="op" id="5395000">;</span>&nbsp;<span class="ident" id="5395002">i</span>&nbsp;<span class="op" id="5395004">&gt;=</span>&nbsp;<span class="num" id="5395007">0</span><span class="op" id="5395008">;</span>&nbsp;<span class="ident" id="5395010">i</span><span class="op" id="5395011">--</span>&nbsp;<span class="op" id="5395014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395018">if</span>&nbsp;<span class="ident" id="5395021">length</span>&nbsp;<span class="op" id="5395028">&gt;</span>&nbsp;<span class="ident" id="5395030">pairs</span><span class="op" id="5395035">[</span><span class="ident" id="5395036">i</span><span class="op" id="5395037">]</span><span class="op" id="5395038">.</span><span class="ident" id="5395039">length</span>&nbsp;<span class="op" id="5395046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395051">//&nbsp;If&nbsp;the&nbsp;code&nbsp;length&nbsp;decreases&nbsp;we&nbsp;shift&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395107">//&nbsp;zero&nbsp;any&nbsp;bits&nbsp;beyond&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395155">length</span>&nbsp;<span class="op" id="5395162">&gt;&gt;=</span>&nbsp;<span class="num" id="5395166">32</span>&nbsp;<span class="op" id="5395169">-</span>&nbsp;<span class="ident" id="5395171">pairs</span><span class="op" id="5395176">[</span><span class="ident" id="5395177">i</span><span class="op" id="5395178">]</span><span class="op" id="5395179">.</span><span class="ident" id="5395180">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395190">length</span>&nbsp;<span class="op" id="5395197">&lt;&lt;=</span>&nbsp;<span class="num" id="5395201">32</span>&nbsp;<span class="op" id="5395204">-</span>&nbsp;<span class="ident" id="5395206">pairs</span><span class="op" id="5395211">[</span><span class="ident" id="5395212">i</span><span class="op" id="5395213">]</span><span class="op" id="5395214">.</span><span class="ident" id="5395215">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395225">length</span>&nbsp;<span class="op" id="5395232">=</span>&nbsp;<span class="ident" id="5395234">pairs</span><span class="op" id="5395239">[</span><span class="ident" id="5395240">i</span><span class="op" id="5395241">]</span><span class="op" id="5395242">.</span><span class="ident" id="5395243">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395252">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395256">codes</span><span class="op" id="5395261">[</span><span class="ident" id="5395262">i</span><span class="op" id="5395263">]</span><span class="op" id="5395264">.</span><span class="ident" id="5395265">code</span>&nbsp;<span class="op" id="5395270">=</span>&nbsp;<span class="ident" id="5395272">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395279">codes</span><span class="op" id="5395284">[</span><span class="ident" id="5395285">i</span><span class="op" id="5395286">]</span><span class="op" id="5395287">.</span><span class="ident" id="5395288">codeLen</span>&nbsp;<span class="op" id="5395296">=</span>&nbsp;<span class="ident" id="5395298">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395307">codes</span><span class="op" id="5395312">[</span><span class="ident" id="5395313">i</span><span class="op" id="5395314">]</span><span class="op" id="5395315">.</span><span class="ident" id="5395316">value</span>&nbsp;<span class="op" id="5395322">=</span>&nbsp;<span class="ident" id="5395324">pairs</span><span class="op" id="5395329">[</span><span class="ident" id="5395330">i</span><span class="op" id="5395331">]</span><span class="op" id="5395332">.</span><span class="ident" id="5395333">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395341">//&nbsp;We&nbsp;need&nbsp;to&nbsp;&#39;increment&#39;&nbsp;the&nbsp;code,&nbsp;which&nbsp;means&nbsp;treating&nbsp;|code|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395407">//&nbsp;like&nbsp;a&nbsp;|length|&nbsp;bit&nbsp;number.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395440">code</span>&nbsp;<span class="op" id="5395445">+=</span>&nbsp;<span class="num" id="5395448">1</span>&nbsp;<span class="op" id="5395450">&lt;&lt;</span>&nbsp;<span class="op" id="5395453">(</span><span class="num" id="5395454">32</span>&nbsp;<span class="op" id="5395457">-</span>&nbsp;<span class="ident" id="5395459">length</span><span class="op" id="5395465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5395468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395472">//&nbsp;Now&nbsp;we&nbsp;can&nbsp;sort&nbsp;by&nbsp;the&nbsp;code&nbsp;so&nbsp;that&nbsp;the&nbsp;left&nbsp;half&nbsp;of&nbsp;each&nbsp;branch&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5395545">//&nbsp;grouped&nbsp;together,&nbsp;recursively.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395580">sort</span><span class="op" id="5395584">.</span><span class="ident" id="5395585">Sort</span><span class="op" id="5395589">(</span><span class="ident" id="5395590">codes</span><span class="op" id="5395595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395599">t</span><span class="op" id="5395600">.</span><span class="ident" id="5395601">nodes</span>&nbsp;<span class="op" id="5395607">=</span>&nbsp;<span class="builtinfunc" id="5395609">make</span><span class="op" id="5395613">(</span><span class="op" id="5395614">[</span><span class="op" id="5395615">]</span><span class="ident" id="5395616">huffmanNode</span><span class="op" id="5395627">,</span>&nbsp;<span class="builtinfunc" id="5395629">len</span><span class="op" id="5395632">(</span><span class="ident" id="5395633">codes</span><span class="op" id="5395638">)</span><span class="op" id="5395639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395642">_</span><span class="op" id="5395643">,</span>&nbsp;<span class="ident" id="5395645">err</span>&nbsp;<span class="op" id="5395649">:=</span>&nbsp;<span class="ident" id="5395652">buildHuffmanNode</span><span class="op" id="5395668">(</span><span class="op" id="5395669">&amp;</span><span class="ident" id="5395670">t</span><span class="op" id="5395671">,</span>&nbsp;<span class="ident" id="5395673">codes</span><span class="op" id="5395678">,</span>&nbsp;<span class="num" id="5395680">0</span><span class="op" id="5395681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5395684">return</span>&nbsp;<span class="ident" id="5395691">t</span><span class="op" id="5395692">,</span>&nbsp;<span class="ident" id="5395694">err</span><br>
<span class="lineno">120</span><span class="op" id="5395698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5395701">//&nbsp;huffmanSymbolLengthPair&nbsp;contains&nbsp;a&nbsp;symbol&nbsp;and&nbsp;its&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5395767">type</span>&nbsp;<span class="ident" id="5395772">huffmanSymbolLengthPair</span>&nbsp;<span class="keyword" id="5395796">struct</span>&nbsp;<span class="op" id="5395803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395806">value</span>&nbsp;&nbsp;<span class="builtintype" id="5395813">uint16</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5395821">length</span>&nbsp;<span class="builtintype" id="5395828">uint8</span><br>
<span class="lineno"></span><span class="op" id="5395834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5395837">//&nbsp;huffmanSymbolLengthPair&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno"></span><span class="keyword" id="5395909">type</span>&nbsp;<span class="ident" id="5395914">huffmanSymbolLengthPairs</span>&nbsp;<span class="op" id="5395939">[</span><span class="op" id="5395940">]</span><span class="ident" id="5395941">huffmanSymbolLengthPair</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="5395966">func</span>&nbsp;<span class="op" id="5395971">(</span><span class="ident" id="5395972">h</span>&nbsp;<span class="ident" id="5395974">huffmanSymbolLengthPairs</span><span class="op" id="5395998">)</span>&nbsp;<span class="ident" id="5396000">Len</span><span class="op" id="5396003">(</span><span class="op" id="5396004">)</span>&nbsp;<span class="builtintype" id="5396006">int</span>&nbsp;<span class="op" id="5396010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396013">return</span>&nbsp;<span class="builtinfunc" id="5396020">len</span><span class="op" id="5396023">(</span><span class="ident" id="5396024">h</span><span class="op" id="5396025">)</span><br>
<span class="lineno"></span><span class="op" id="5396027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="5396030">func</span>&nbsp;<span class="op" id="5396035">(</span><span class="ident" id="5396036">h</span>&nbsp;<span class="ident" id="5396038">huffmanSymbolLengthPairs</span><span class="op" id="5396062">)</span>&nbsp;<span class="ident" id="5396064">Less</span><span class="op" id="5396068">(</span><span class="ident" id="5396069">i</span><span class="op" id="5396070">,</span>&nbsp;<span class="ident" id="5396072">j</span>&nbsp;<span class="builtintype" id="5396074">int</span><span class="op" id="5396077">)</span>&nbsp;<span class="builtintype" id="5396079">bool</span>&nbsp;<span class="op" id="5396084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396087">if</span>&nbsp;<span class="ident" id="5396090">h</span><span class="op" id="5396091">[</span><span class="ident" id="5396092">i</span><span class="op" id="5396093">]</span><span class="op" id="5396094">.</span><span class="ident" id="5396095">length</span>&nbsp;<span class="op" id="5396102">&lt;</span>&nbsp;<span class="ident" id="5396104">h</span><span class="op" id="5396105">[</span><span class="ident" id="5396106">j</span><span class="op" id="5396107">]</span><span class="op" id="5396108">.</span><span class="ident" id="5396109">length</span>&nbsp;<span class="op" id="5396116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396120">return</span>&nbsp;<span class="builtintype" id="5396127">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396136">if</span>&nbsp;<span class="ident" id="5396139">h</span><span class="op" id="5396140">[</span><span class="ident" id="5396141">i</span><span class="op" id="5396142">]</span><span class="op" id="5396143">.</span><span class="ident" id="5396144">length</span>&nbsp;<span class="op" id="5396151">&gt;</span>&nbsp;<span class="ident" id="5396153">h</span><span class="op" id="5396154">[</span><span class="ident" id="5396155">j</span><span class="op" id="5396156">]</span><span class="op" id="5396157">.</span><span class="ident" id="5396158">length</span>&nbsp;<span class="op" id="5396165">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396169">return</span>&nbsp;<span class="builtintype" id="5396176">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396186">if</span>&nbsp;<span class="ident" id="5396189">h</span><span class="op" id="5396190">[</span><span class="ident" id="5396191">i</span><span class="op" id="5396192">]</span><span class="op" id="5396193">.</span><span class="ident" id="5396194">value</span>&nbsp;<span class="op" id="5396200">&lt;</span>&nbsp;<span class="ident" id="5396202">h</span><span class="op" id="5396203">[</span><span class="ident" id="5396204">j</span><span class="op" id="5396205">]</span><span class="op" id="5396206">.</span><span class="ident" id="5396207">value</span>&nbsp;<span class="op" id="5396213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396217">return</span>&nbsp;<span class="builtintype" id="5396224">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5396230">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396233">return</span>&nbsp;<span class="builtintype" id="5396240">false</span><br>
<span class="lineno"></span><span class="op" id="5396246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396249">func</span>&nbsp;<span class="op" id="5396254">(</span><span class="ident" id="5396255">h</span>&nbsp;<span class="ident" id="5396257">huffmanSymbolLengthPairs</span><span class="op" id="5396281">)</span>&nbsp;<span class="ident" id="5396283">Swap</span><span class="op" id="5396287">(</span><span class="ident" id="5396288">i</span><span class="op" id="5396289">,</span>&nbsp;<span class="ident" id="5396291">j</span>&nbsp;<span class="builtintype" id="5396293">int</span><span class="op" id="5396296">)</span>&nbsp;<span class="op" id="5396298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396301">h</span><span class="op" id="5396302">[</span><span class="ident" id="5396303">i</span><span class="op" id="5396304">]</span><span class="op" id="5396305">,</span>&nbsp;<span class="ident" id="5396307">h</span><span class="op" id="5396308">[</span><span class="ident" id="5396309">j</span><span class="op" id="5396310">]</span>&nbsp;<span class="op" id="5396312">=</span>&nbsp;<span class="ident" id="5396314">h</span><span class="op" id="5396315">[</span><span class="ident" id="5396316">j</span><span class="op" id="5396317">]</span><span class="op" id="5396318">,</span>&nbsp;<span class="ident" id="5396320">h</span><span class="op" id="5396321">[</span><span class="ident" id="5396322">i</span><span class="op" id="5396323">]</span><br>
<span class="lineno">150</span><span class="op" id="5396325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5396328">//&nbsp;huffmanCode&nbsp;contains&nbsp;a&nbsp;symbol,&nbsp;its&nbsp;code&nbsp;and&nbsp;code&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="5396388">type</span>&nbsp;<span class="ident" id="5396393">huffmanCode</span>&nbsp;<span class="keyword" id="5396405">struct</span>&nbsp;<span class="op" id="5396412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396415">code</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5396423">uint32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396431">codeLen</span>&nbsp;<span class="builtintype" id="5396439">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396446">value</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5396454">uint16</span><br>
<span class="lineno"></span><span class="op" id="5396461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5396464">//&nbsp;huffmanCodes&nbsp;is&nbsp;used&nbsp;to&nbsp;provide&nbsp;an&nbsp;interface&nbsp;for&nbsp;sorting.</span><br>
<span class="lineno">160</span><span class="keyword" id="5396525">type</span>&nbsp;<span class="ident" id="5396530">huffmanCodes</span>&nbsp;<span class="op" id="5396543">[</span><span class="op" id="5396544">]</span><span class="ident" id="5396545">huffmanCode</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5396558">func</span>&nbsp;<span class="op" id="5396563">(</span><span class="ident" id="5396564">n</span>&nbsp;<span class="ident" id="5396566">huffmanCodes</span><span class="op" id="5396578">)</span>&nbsp;<span class="ident" id="5396580">Len</span><span class="op" id="5396583">(</span><span class="op" id="5396584">)</span>&nbsp;<span class="builtintype" id="5396586">int</span>&nbsp;<span class="op" id="5396590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396593">return</span>&nbsp;<span class="builtinfunc" id="5396600">len</span><span class="op" id="5396603">(</span><span class="ident" id="5396604">n</span><span class="op" id="5396605">)</span><br>
<span class="lineno"></span><span class="op" id="5396607">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="5396610">func</span>&nbsp;<span class="op" id="5396615">(</span><span class="ident" id="5396616">n</span>&nbsp;<span class="ident" id="5396618">huffmanCodes</span><span class="op" id="5396630">)</span>&nbsp;<span class="ident" id="5396632">Less</span><span class="op" id="5396636">(</span><span class="ident" id="5396637">i</span><span class="op" id="5396638">,</span>&nbsp;<span class="ident" id="5396640">j</span>&nbsp;<span class="builtintype" id="5396642">int</span><span class="op" id="5396645">)</span>&nbsp;<span class="builtintype" id="5396647">bool</span>&nbsp;<span class="op" id="5396652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5396655">return</span>&nbsp;<span class="ident" id="5396662">n</span><span class="op" id="5396663">[</span><span class="ident" id="5396664">i</span><span class="op" id="5396665">]</span><span class="op" id="5396666">.</span><span class="ident" id="5396667">code</span>&nbsp;<span class="op" id="5396672">&lt;</span>&nbsp;<span class="ident" id="5396674">n</span><span class="op" id="5396675">[</span><span class="ident" id="5396676">j</span><span class="op" id="5396677">]</span><span class="op" id="5396678">.</span><span class="ident" id="5396679">code</span><br>
<span class="lineno"></span><span class="op" id="5396684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="5396687">func</span>&nbsp;<span class="op" id="5396692">(</span><span class="ident" id="5396693">n</span>&nbsp;<span class="ident" id="5396695">huffmanCodes</span><span class="op" id="5396707">)</span>&nbsp;<span class="ident" id="5396709">Swap</span><span class="op" id="5396713">(</span><span class="ident" id="5396714">i</span><span class="op" id="5396715">,</span>&nbsp;<span class="ident" id="5396717">j</span>&nbsp;<span class="builtintype" id="5396719">int</span><span class="op" id="5396722">)</span>&nbsp;<span class="op" id="5396724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5396727">n</span><span class="op" id="5396728">[</span><span class="ident" id="5396729">i</span><span class="op" id="5396730">]</span><span class="op" id="5396731">,</span>&nbsp;<span class="ident" id="5396733">n</span><span class="op" id="5396734">[</span><span class="ident" id="5396735">j</span><span class="op" id="5396736">]</span>&nbsp;<span class="op" id="5396738">=</span>&nbsp;<span class="ident" id="5396740">n</span><span class="op" id="5396741">[</span><span class="ident" id="5396742">j</span><span class="op" id="5396743">]</span><span class="op" id="5396744">,</span>&nbsp;<span class="ident" id="5396746">n</span><span class="op" id="5396747">[</span><span class="ident" id="5396748">i</span><span class="op" id="5396749">]</span><br>
<span class="lineno"></span><span class="op" id="5396751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5396754">//&nbsp;buildHuffmanNode&nbsp;takes&nbsp;a&nbsp;slice&nbsp;of&nbsp;sorted&nbsp;huffmanCodes&nbsp;and&nbsp;builds&nbsp;a&nbsp;node&nbsp;in</span><br>
<span class="lineno">175</span><span class="comment" id="5396832">//&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;at&nbsp;the&nbsp;given&nbsp;level.&nbsp;It&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;newly</span><br>
<span class="lineno"></span><span class="comment" id="5396906">//&nbsp;constructed&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="5396927">func</span>&nbsp;<span class="ident" id="5396932">buildHuffmanNode</span><span class="op" id="5396948">(</span><span class="ident" id="5396949">t</span>&nbsp;<span class="op" id="5396951">*</span><span class="ident" id="5396952">huffmanTree</span><span class="op" id="5396963">,</span>&nbsp;<span class="ident" id="5396965">codes</span>&nbsp;<span class="op" id="5396971">[</span><span class="op" id="5396972">]</span><span class="ident" id="5396973">huffmanCode</span><span class="op" id="5396984">,</span>&nbsp;<span class="ident" id="5396986">level</span>&nbsp;<span class="builtintype" id="5396992">uint32</span><span class="op" id="5396998">)</span>&nbsp;<span class="op" id="5397000">(</span><span class="ident" id="5397001">nodeIndex</span>&nbsp;<span class="builtintype" id="5397011">uint16</span><span class="op" id="5397017">,</span>&nbsp;<span class="ident" id="5397019">err</span>&nbsp;<span class="builtintype" id="5397023">error</span><span class="op" id="5397028">)</span>&nbsp;<span class="op" id="5397030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397033">test</span>&nbsp;<span class="op" id="5397038">:=</span>&nbsp;<span class="builtintype" id="5397041">uint32</span><span class="op" id="5397047">(</span><span class="num" id="5397048">1</span><span class="op" id="5397049">)</span>&nbsp;<span class="op" id="5397051">&lt;&lt;</span>&nbsp;<span class="op" id="5397054">(</span><span class="num" id="5397055">31</span>&nbsp;<span class="op" id="5397058">-</span>&nbsp;<span class="ident" id="5397060">level</span><span class="op" id="5397065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397069">//&nbsp;We&nbsp;have&nbsp;to&nbsp;search&nbsp;the&nbsp;list&nbsp;of&nbsp;codes&nbsp;to&nbsp;find&nbsp;the&nbsp;divide&nbsp;between&nbsp;the&nbsp;left&nbsp;and&nbsp;right&nbsp;sides.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397162">firstRightIndex</span>&nbsp;<span class="op" id="5397178">:=</span>&nbsp;<span class="builtinfunc" id="5397181">len</span><span class="op" id="5397184">(</span><span class="ident" id="5397185">codes</span><span class="op" id="5397190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397193">for</span>&nbsp;<span class="ident" id="5397197">i</span><span class="op" id="5397198">,</span>&nbsp;<span class="ident" id="5397200">code</span>&nbsp;<span class="op" id="5397205">:=</span>&nbsp;<span class="keyword" id="5397208">range</span>&nbsp;<span class="ident" id="5397214">codes</span>&nbsp;<span class="op" id="5397220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397224">if</span>&nbsp;<span class="ident" id="5397227">code</span><span class="op" id="5397231">.</span><span class="ident" id="5397232">code</span><span class="op" id="5397236">&amp;</span><span class="ident" id="5397237">test</span>&nbsp;<span class="op" id="5397242">!=</span>&nbsp;<span class="num" id="5397245">0</span>&nbsp;<span class="op" id="5397247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397252">firstRightIndex</span>&nbsp;<span class="op" id="5397268">=</span>&nbsp;<span class="ident" id="5397270">i</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397275">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5397286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397290">left</span>&nbsp;<span class="op" id="5397295">:=</span>&nbsp;<span class="ident" id="5397298">codes</span><span class="op" id="5397303">[</span><span class="op" id="5397304">:</span><span class="ident" id="5397305">firstRightIndex</span><span class="op" id="5397320">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5397323">right</span>&nbsp;<span class="op" id="5397329">:=</span>&nbsp;<span class="ident" id="5397332">codes</span><span class="op" id="5397337">[</span><span class="ident" id="5397338">firstRightIndex</span><span class="op" id="5397353">:</span><span class="op" id="5397354">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397358">if</span>&nbsp;<span class="builtinfunc" id="5397361">len</span><span class="op" id="5397364">(</span><span class="ident" id="5397365">left</span><span class="op" id="5397369">)</span>&nbsp;<span class="op" id="5397371">==</span>&nbsp;<span class="num" id="5397374">0</span>&nbsp;<span class="op" id="5397376">||</span>&nbsp;<span class="builtinfunc" id="5397379">len</span><span class="op" id="5397382">(</span><span class="ident" id="5397383">right</span><span class="op" id="5397388">)</span>&nbsp;<span class="op" id="5397390">==</span>&nbsp;<span class="num" id="5397393">0</span>&nbsp;<span class="op" id="5397395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397399">//&nbsp;There&nbsp;is&nbsp;a&nbsp;superfluous&nbsp;level&nbsp;in&nbsp;the&nbsp;Huffman&nbsp;tree&nbsp;indicating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397464">//&nbsp;a&nbsp;bug&nbsp;in&nbsp;the&nbsp;encoder.&nbsp;However,&nbsp;this&nbsp;bug&nbsp;has&nbsp;been&nbsp;observed&nbsp;in</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397530">//&nbsp;the&nbsp;wild&nbsp;so&nbsp;we&nbsp;handle&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397562">//&nbsp;If&nbsp;this&nbsp;function&nbsp;was&nbsp;called&nbsp;recursively&nbsp;then&nbsp;we&nbsp;know&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397625">//&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;because,&nbsp;otherwise,&nbsp;we&nbsp;would&nbsp;have&nbsp;hit&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397688">//&nbsp;&#34;leaf&nbsp;node&#34;&nbsp;case,&nbsp;below,&nbsp;and&nbsp;not&nbsp;recursed.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397736">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397741">//&nbsp;However,&nbsp;for&nbsp;the&nbsp;initial&nbsp;call&nbsp;it&#39;s&nbsp;possible&nbsp;that&nbsp;len(codes)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397806">//&nbsp;is&nbsp;zero&nbsp;or&nbsp;one.&nbsp;Both&nbsp;cases&nbsp;are&nbsp;invalid&nbsp;because&nbsp;a&nbsp;zero&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397872">//&nbsp;tree&nbsp;cannot&nbsp;encode&nbsp;anything&nbsp;and&nbsp;a&nbsp;length-1&nbsp;tree&nbsp;can&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5397934">//&nbsp;encode&nbsp;EOF&nbsp;and&nbsp;so&nbsp;is&nbsp;superfluous.&nbsp;We&nbsp;reject&nbsp;both.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5397989">if</span>&nbsp;<span class="builtinfunc" id="5397992">len</span><span class="op" id="5397995">(</span><span class="ident" id="5397996">codes</span><span class="op" id="5398001">)</span>&nbsp;<span class="op" id="5398003">&lt;</span>&nbsp;<span class="num" id="5398005">2</span>&nbsp;<span class="op" id="5398007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398012">return</span>&nbsp;<span class="num" id="5398019">0</span><span class="op" id="5398020">,</span>&nbsp;<span class="ident" id="5398022">StructuralError</span><span class="op" id="5398037">(</span><span class="string" id="5398038">&#34;empty&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5398058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398067">//&nbsp;In&nbsp;this&nbsp;case&nbsp;the&nbsp;recursion&nbsp;doesn&#39;t&nbsp;always&nbsp;reduce&nbsp;the&nbsp;length</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398132">//&nbsp;of&nbsp;codes&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;ensure&nbsp;termination&nbsp;via&nbsp;another</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398191">//&nbsp;mechanism.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398207">if</span>&nbsp;<span class="ident" id="5398210">level</span>&nbsp;<span class="op" id="5398216">==</span>&nbsp;<span class="num" id="5398219">31</span>&nbsp;<span class="op" id="5398222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398227">//&nbsp;Since&nbsp;len(codes)&nbsp;&gt;=&nbsp;2&nbsp;the&nbsp;only&nbsp;way&nbsp;that&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398284">//&nbsp;can&nbsp;match&nbsp;at&nbsp;all&nbsp;32&nbsp;bits&nbsp;is&nbsp;if&nbsp;they&nbsp;are&nbsp;equal,&nbsp;which</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398343">//&nbsp;is&nbsp;invalid.&nbsp;This&nbsp;ensures&nbsp;that&nbsp;we&nbsp;never&nbsp;enter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398394">//&nbsp;infinite&nbsp;recursion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398420">return</span>&nbsp;<span class="num" id="5398427">0</span><span class="op" id="5398428">,</span>&nbsp;<span class="ident" id="5398430">StructuralError</span><span class="op" id="5398445">(</span><span class="string" id="5398446">&#34;equal&nbsp;symbols&nbsp;in&nbsp;Huffman&nbsp;tree&#34;</span><span class="op" id="5398477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398486">if</span>&nbsp;<span class="builtinfunc" id="5398489">len</span><span class="op" id="5398492">(</span><span class="ident" id="5398493">left</span><span class="op" id="5398497">)</span>&nbsp;<span class="op" id="5398499">==</span>&nbsp;<span class="num" id="5398502">0</span>&nbsp;<span class="op" id="5398504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398509">return</span>&nbsp;<span class="ident" id="5398516">buildHuffmanNode</span><span class="op" id="5398532">(</span><span class="ident" id="5398533">t</span><span class="op" id="5398534">,</span>&nbsp;<span class="ident" id="5398536">right</span><span class="op" id="5398541">,</span>&nbsp;<span class="ident" id="5398543">level</span><span class="op" id="5398548">+</span><span class="num" id="5398549">1</span><span class="op" id="5398550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398558">return</span>&nbsp;<span class="ident" id="5398565">buildHuffmanNode</span><span class="op" id="5398581">(</span><span class="ident" id="5398582">t</span><span class="op" id="5398583">,</span>&nbsp;<span class="ident" id="5398585">left</span><span class="op" id="5398589">,</span>&nbsp;<span class="ident" id="5398591">level</span><span class="op" id="5398596">+</span><span class="num" id="5398597">1</span><span class="op" id="5398598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398601">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398605">nodeIndex</span>&nbsp;<span class="op" id="5398615">=</span>&nbsp;<span class="builtintype" id="5398617">uint16</span><span class="op" id="5398623">(</span><span class="ident" id="5398624">t</span><span class="op" id="5398625">.</span><span class="ident" id="5398626">nextNode</span><span class="op" id="5398634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398637">node</span>&nbsp;<span class="op" id="5398642">:=</span>&nbsp;<span class="op" id="5398645">&amp;</span><span class="ident" id="5398646">t</span><span class="op" id="5398647">.</span><span class="ident" id="5398648">nodes</span><span class="op" id="5398653">[</span><span class="ident" id="5398654">t</span><span class="op" id="5398655">.</span><span class="ident" id="5398656">nextNode</span><span class="op" id="5398664">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398667">t</span><span class="op" id="5398668">.</span><span class="ident" id="5398669">nextNode</span><span class="op" id="5398677">++</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398682">if</span>&nbsp;<span class="builtinfunc" id="5398685">len</span><span class="op" id="5398688">(</span><span class="ident" id="5398689">left</span><span class="op" id="5398693">)</span>&nbsp;<span class="op" id="5398695">==</span>&nbsp;<span class="num" id="5398698">1</span>&nbsp;<span class="op" id="5398700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398704">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398719">node</span><span class="op" id="5398723">.</span><span class="ident" id="5398724">left</span>&nbsp;<span class="op" id="5398729">=</span>&nbsp;<span class="ident" id="5398731">invalidNodeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398750">node</span><span class="op" id="5398754">.</span><span class="ident" id="5398755">leftValue</span>&nbsp;<span class="op" id="5398765">=</span>&nbsp;<span class="ident" id="5398767">left</span><span class="op" id="5398771">[</span><span class="num" id="5398772">0</span><span class="op" id="5398773">]</span><span class="op" id="5398774">.</span><span class="ident" id="5398775">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398782">}</span>&nbsp;<span class="keyword" id="5398784">else</span>&nbsp;<span class="op" id="5398789">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398793">node</span><span class="op" id="5398797">.</span><span class="ident" id="5398798">left</span><span class="op" id="5398802">,</span>&nbsp;<span class="ident" id="5398804">err</span>&nbsp;<span class="op" id="5398808">=</span>&nbsp;<span class="ident" id="5398810">buildHuffmanNode</span><span class="op" id="5398826">(</span><span class="ident" id="5398827">t</span><span class="op" id="5398828">,</span>&nbsp;<span class="ident" id="5398830">left</span><span class="op" id="5398834">,</span>&nbsp;<span class="ident" id="5398836">level</span><span class="op" id="5398841">+</span><span class="num" id="5398842">1</span><span class="op" id="5398843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398850">if</span>&nbsp;<span class="ident" id="5398853">err</span>&nbsp;<span class="op" id="5398857">!=</span>&nbsp;<span class="ident" id="5398860">nil</span>&nbsp;<span class="op" id="5398864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398868">return</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5398880">if</span>&nbsp;<span class="builtinfunc" id="5398883">len</span><span class="op" id="5398886">(</span><span class="ident" id="5398887">right</span><span class="op" id="5398892">)</span>&nbsp;<span class="op" id="5398894">==</span>&nbsp;<span class="num" id="5398897">1</span>&nbsp;<span class="op" id="5398899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5398903">//&nbsp;leaf&nbsp;node</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398918">node</span><span class="op" id="5398922">.</span><span class="ident" id="5398923">right</span>&nbsp;<span class="op" id="5398929">=</span>&nbsp;<span class="ident" id="5398931">invalidNodeValue</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398950">node</span><span class="op" id="5398954">.</span><span class="ident" id="5398955">rightValue</span>&nbsp;<span class="op" id="5398966">=</span>&nbsp;<span class="ident" id="5398968">right</span><span class="op" id="5398973">[</span><span class="num" id="5398974">0</span><span class="op" id="5398975">]</span><span class="op" id="5398976">.</span><span class="ident" id="5398977">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5398984">}</span>&nbsp;<span class="keyword" id="5398986">else</span>&nbsp;<span class="op" id="5398991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5398995">node</span><span class="op" id="5398999">.</span><span class="ident" id="5399000">right</span><span class="op" id="5399005">,</span>&nbsp;<span class="ident" id="5399007">err</span>&nbsp;<span class="op" id="5399011">=</span>&nbsp;<span class="ident" id="5399013">buildHuffmanNode</span><span class="op" id="5399029">(</span><span class="ident" id="5399030">t</span><span class="op" id="5399031">,</span>&nbsp;<span class="ident" id="5399033">right</span><span class="op" id="5399038">,</span>&nbsp;<span class="ident" id="5399040">level</span><span class="op" id="5399045">+</span><span class="num" id="5399046">1</span><span class="op" id="5399047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5399050">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5399054">return</span><br>
<span class="lineno"></span><span class="op" id="5399061">}</span>
</div>
</body>
</html>
