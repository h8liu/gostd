<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6934767">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6934822">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6934876">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6934927">package</span>&nbsp;<span class="ident" id="6934935">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6934946">import</span>&nbsp;<span class="op" id="6934953">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934956">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934965">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934982">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934989">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6934995">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935008">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935025">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935031">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935042">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6935053">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6935063">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6935066">func</span>&nbsp;<span class="ident" id="6935071">TestBoundaryLine</span><span class="op" id="6935087">(</span><span class="ident" id="6935088">t</span>&nbsp;<span class="op" id="6935090">*</span><span class="ident" id="6935091">testing</span><span class="op" id="6935098">.</span><span class="ident" id="6935099">T</span><span class="op" id="6935100">)</span>&nbsp;<span class="op" id="6935102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935105">mr</span>&nbsp;<span class="op" id="6935108">:=</span>&nbsp;<span class="ident" id="6935111">NewReader</span><span class="op" id="6935120">(</span><span class="ident" id="6935121">strings</span><span class="op" id="6935128">.</span><span class="ident" id="6935129">NewReader</span><span class="op" id="6935138">(</span><span class="string" id="6935139">&#34;&#34;</span><span class="op" id="6935141">)</span><span class="op" id="6935142">,</span>&nbsp;<span class="string" id="6935144">&#34;myBoundary&#34;</span><span class="op" id="6935156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935159">if</span>&nbsp;<span class="op" id="6935162">!</span><span class="ident" id="6935163">mr</span><span class="op" id="6935165">.</span><span class="ident" id="6935166">isBoundaryDelimiterLine</span><span class="op" id="6935189">(</span><span class="op" id="6935190">[</span><span class="op" id="6935191">]</span><span class="builtintype" id="6935192">byte</span><span class="op" id="6935196">(</span><span class="string" id="6935197">&#34;--myBoundary\r\n&#34;</span><span class="op" id="6935215">)</span><span class="op" id="6935216">)</span>&nbsp;<span class="op" id="6935218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935222">t</span><span class="op" id="6935223">.</span><span class="ident" id="6935224">Error</span><span class="op" id="6935229">(</span><span class="string" id="6935230">&#34;expected&#34;</span><span class="op" id="6935240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935243">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935246">if</span>&nbsp;<span class="op" id="6935249">!</span><span class="ident" id="6935250">mr</span><span class="op" id="6935252">.</span><span class="ident" id="6935253">isBoundaryDelimiterLine</span><span class="op" id="6935276">(</span><span class="op" id="6935277">[</span><span class="op" id="6935278">]</span><span class="builtintype" id="6935279">byte</span><span class="op" id="6935283">(</span><span class="string" id="6935284">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="6935303">)</span><span class="op" id="6935304">)</span>&nbsp;<span class="op" id="6935306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935310">t</span><span class="op" id="6935311">.</span><span class="ident" id="6935312">Error</span><span class="op" id="6935317">(</span><span class="string" id="6935318">&#34;expected&#34;</span><span class="op" id="6935328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935334">if</span>&nbsp;<span class="op" id="6935337">!</span><span class="ident" id="6935338">mr</span><span class="op" id="6935340">.</span><span class="ident" id="6935341">isBoundaryDelimiterLine</span><span class="op" id="6935364">(</span><span class="op" id="6935365">[</span><span class="op" id="6935366">]</span><span class="builtintype" id="6935367">byte</span><span class="op" id="6935371">(</span><span class="string" id="6935372">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="6935389">)</span><span class="op" id="6935390">)</span>&nbsp;<span class="op" id="6935392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935396">t</span><span class="op" id="6935397">.</span><span class="ident" id="6935398">Error</span><span class="op" id="6935403">(</span><span class="string" id="6935404">&#34;expected&#34;</span><span class="op" id="6935414">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935420">if</span>&nbsp;<span class="ident" id="6935423">mr</span><span class="op" id="6935425">.</span><span class="ident" id="6935426">isBoundaryDelimiterLine</span><span class="op" id="6935449">(</span><span class="op" id="6935450">[</span><span class="op" id="6935451">]</span><span class="builtintype" id="6935452">byte</span><span class="op" id="6935456">(</span><span class="string" id="6935457">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="6935480">)</span><span class="op" id="6935481">)</span>&nbsp;<span class="op" id="6935483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935487">t</span><span class="op" id="6935488">.</span><span class="ident" id="6935489">Error</span><span class="op" id="6935494">(</span><span class="string" id="6935495">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6935510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935516">if</span>&nbsp;<span class="ident" id="6935519">mr</span><span class="op" id="6935521">.</span><span class="ident" id="6935522">isBoundaryDelimiterLine</span><span class="op" id="6935545">(</span><span class="op" id="6935546">[</span><span class="op" id="6935547">]</span><span class="builtintype" id="6935548">byte</span><span class="op" id="6935552">(</span><span class="string" id="6935553">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="6935575">)</span><span class="op" id="6935576">)</span>&nbsp;<span class="op" id="6935578">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935582">t</span><span class="op" id="6935583">.</span><span class="ident" id="6935584">Error</span><span class="op" id="6935589">(</span><span class="string" id="6935590">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6935605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935608">}</span><br>
<span class="lineno"></span><span class="op" id="6935610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6935613">func</span>&nbsp;<span class="ident" id="6935618">escapeString</span><span class="op" id="6935630">(</span><span class="ident" id="6935631">v</span>&nbsp;<span class="builtintype" id="6935633">string</span><span class="op" id="6935639">)</span>&nbsp;<span class="builtintype" id="6935641">string</span>&nbsp;<span class="op" id="6935648">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935651">bytes</span><span class="op" id="6935656">,</span>&nbsp;<span class="ident" id="6935658">_</span>&nbsp;<span class="op" id="6935660">:=</span>&nbsp;<span class="ident" id="6935663">json</span><span class="op" id="6935667">.</span><span class="ident" id="6935668">Marshal</span><span class="op" id="6935675">(</span><span class="ident" id="6935676">v</span><span class="op" id="6935677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935680">return</span>&nbsp;<span class="builtintype" id="6935687">string</span><span class="op" id="6935693">(</span><span class="ident" id="6935694">bytes</span><span class="op" id="6935699">)</span><br>
<span class="lineno"></span><span class="op" id="6935701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6935704">func</span>&nbsp;<span class="ident" id="6935709">expectEq</span><span class="op" id="6935717">(</span><span class="ident" id="6935718">t</span>&nbsp;<span class="op" id="6935720">*</span><span class="ident" id="6935721">testing</span><span class="op" id="6935728">.</span><span class="ident" id="6935729">T</span><span class="op" id="6935730">,</span>&nbsp;<span class="ident" id="6935732">expected</span><span class="op" id="6935740">,</span>&nbsp;<span class="ident" id="6935742">actual</span><span class="op" id="6935748">,</span>&nbsp;<span class="ident" id="6935750">what</span>&nbsp;<span class="builtintype" id="6935755">string</span><span class="op" id="6935761">)</span>&nbsp;<span class="op" id="6935763">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935766">if</span>&nbsp;<span class="ident" id="6935769">expected</span>&nbsp;<span class="op" id="6935778">==</span>&nbsp;<span class="ident" id="6935781">actual</span>&nbsp;<span class="op" id="6935788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935792">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935803">t</span><span class="op" id="6935804">.</span><span class="ident" id="6935805">Errorf</span><span class="op" id="6935811">(</span><span class="string" id="6935812">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="6935880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935884">what</span><span class="op" id="6935888">,</span>&nbsp;<span class="ident" id="6935890">escapeString</span><span class="op" id="6935902">(</span><span class="ident" id="6935903">actual</span><span class="op" id="6935909">)</span><span class="op" id="6935910">,</span>&nbsp;<span class="builtinfunc" id="6935912">len</span><span class="op" id="6935915">(</span><span class="ident" id="6935916">actual</span><span class="op" id="6935922">)</span><span class="op" id="6935923">,</span>&nbsp;<span class="ident" id="6935925">escapeString</span><span class="op" id="6935937">(</span><span class="ident" id="6935938">expected</span><span class="op" id="6935946">)</span><span class="op" id="6935947">,</span>&nbsp;<span class="builtinfunc" id="6935949">len</span><span class="op" id="6935952">(</span><span class="ident" id="6935953">expected</span><span class="op" id="6935961">)</span><span class="op" id="6935962">)</span><br>
<span class="lineno">50</span><span class="op" id="6935964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6935967">func</span>&nbsp;<span class="ident" id="6935972">TestNameAccessors</span><span class="op" id="6935989">(</span><span class="ident" id="6935990">t</span>&nbsp;<span class="op" id="6935992">*</span><span class="ident" id="6935993">testing</span><span class="op" id="6936000">.</span><span class="ident" id="6936001">T</span><span class="op" id="6936002">)</span>&nbsp;<span class="op" id="6936004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936007">tests</span>&nbsp;<span class="op" id="6936013">:=</span>&nbsp;<span class="op" id="6936016">[</span><span class="op" id="6936017">...</span><span class="op" id="6936020">]</span><span class="op" id="6936021">[</span><span class="num" id="6936022">3</span><span class="op" id="6936023">]</span><span class="builtintype" id="6936024">string</span><span class="op" id="6936030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936034">{</span><span class="string" id="6936035">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6936058">,</span>&nbsp;<span class="string" id="6936060">&#34;foo&#34;</span><span class="op" id="6936065">,</span>&nbsp;<span class="string" id="6936067">&#34;&#34;</span><span class="op" id="6936069">}</span><span class="op" id="6936070">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936074">{</span><span class="string" id="6936075">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="6936098">,</span>&nbsp;<span class="string" id="6936100">&#34;foo&#34;</span><span class="op" id="6936105">,</span>&nbsp;<span class="string" id="6936107">&#34;&#34;</span><span class="op" id="6936109">}</span><span class="op" id="6936110">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936114">{</span><span class="string" id="6936115">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="6936137">,</span>&nbsp;<span class="string" id="6936139">&#34;foo&#34;</span><span class="op" id="6936144">,</span>&nbsp;<span class="string" id="6936146">&#34;&#34;</span><span class="op" id="6936148">}</span><span class="op" id="6936149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936153">{</span><span class="string" id="6936154">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6936179">,</span>&nbsp;<span class="string" id="6936181">&#34;foo&#34;</span><span class="op" id="6936186">,</span>&nbsp;<span class="string" id="6936188">&#34;&#34;</span><span class="op" id="6936190">}</span><span class="op" id="6936191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936195">{</span><span class="string" id="6936196">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6936221">,</span>&nbsp;<span class="string" id="6936223">&#34;foo&#34;</span><span class="op" id="6936228">,</span>&nbsp;<span class="string" id="6936230">&#34;&#34;</span><span class="op" id="6936232">}</span><span class="op" id="6936233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936237">{</span><span class="string" id="6936238">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="6936261">,</span>&nbsp;<span class="string" id="6936263">&#34;foo&#34;</span><span class="op" id="6936268">,</span>&nbsp;<span class="string" id="6936270">&#34;&#34;</span><span class="op" id="6936272">}</span><span class="op" id="6936273">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936277">{</span><span class="string" id="6936278">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6936331">,</span>&nbsp;<span class="string" id="6936333">&#34;foo&#34;</span><span class="op" id="6936338">,</span>&nbsp;<span class="string" id="6936340">&#34;foo.txt&#34;</span><span class="op" id="6936349">}</span><span class="op" id="6936350">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936354">{</span><span class="string" id="6936355">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6936412">,</span>&nbsp;<span class="string" id="6936414">&#34;&#34;</span><span class="op" id="6936416">,</span>&nbsp;<span class="string" id="6936418">&#34;bar.txt&#34;</span><span class="op" id="6936427">}</span><span class="op" id="6936428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936434">for</span>&nbsp;<span class="ident" id="6936438">i</span><span class="op" id="6936439">,</span>&nbsp;<span class="ident" id="6936441">test</span>&nbsp;<span class="op" id="6936446">:=</span>&nbsp;<span class="keyword" id="6936449">range</span>&nbsp;<span class="ident" id="6936455">tests</span>&nbsp;<span class="op" id="6936461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936465">p</span>&nbsp;<span class="op" id="6936467">:=</span>&nbsp;<span class="op" id="6936470">&amp;</span><span class="ident" id="6936471">Part</span><span class="op" id="6936475">{</span><span class="ident" id="6936476">Header</span><span class="op" id="6936482">:</span>&nbsp;<span class="builtinfunc" id="6936484">make</span><span class="op" id="6936488">(</span><span class="keyword" id="6936489">map</span><span class="op" id="6936492">[</span><span class="builtintype" id="6936493">string</span><span class="op" id="6936499">]</span><span class="op" id="6936500">[</span><span class="op" id="6936501">]</span><span class="builtintype" id="6936502">string</span><span class="op" id="6936508">)</span><span class="op" id="6936509">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936513">p</span><span class="op" id="6936514">.</span><span class="ident" id="6936515">Header</span><span class="op" id="6936521">.</span><span class="ident" id="6936522">Set</span><span class="op" id="6936525">(</span><span class="string" id="6936526">&#34;Content-Disposition&#34;</span><span class="op" id="6936547">,</span>&nbsp;<span class="ident" id="6936549">test</span><span class="op" id="6936553">[</span><span class="num" id="6936554">0</span><span class="op" id="6936555">]</span><span class="op" id="6936556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936560">if</span>&nbsp;<span class="ident" id="6936563">g</span><span class="op" id="6936564">,</span>&nbsp;<span class="ident" id="6936566">e</span>&nbsp;<span class="op" id="6936568">:=</span>&nbsp;<span class="ident" id="6936571">p</span><span class="op" id="6936572">.</span><span class="ident" id="6936573">FormName</span><span class="op" id="6936581">(</span><span class="op" id="6936582">)</span><span class="op" id="6936583">,</span>&nbsp;<span class="ident" id="6936585">test</span><span class="op" id="6936589">[</span><span class="num" id="6936590">1</span><span class="op" id="6936591">]</span><span class="op" id="6936592">;</span>&nbsp;<span class="ident" id="6936594">g</span>&nbsp;<span class="op" id="6936596">!=</span>&nbsp;<span class="ident" id="6936599">e</span>&nbsp;<span class="op" id="6936601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936606">t</span><span class="op" id="6936607">.</span><span class="ident" id="6936608">Errorf</span><span class="op" id="6936614">(</span><span class="string" id="6936615">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6936650">,</span>&nbsp;<span class="ident" id="6936652">i</span><span class="op" id="6936653">,</span>&nbsp;<span class="ident" id="6936655">g</span><span class="op" id="6936656">,</span>&nbsp;<span class="ident" id="6936658">e</span><span class="op" id="6936659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936667">if</span>&nbsp;<span class="ident" id="6936670">g</span><span class="op" id="6936671">,</span>&nbsp;<span class="ident" id="6936673">e</span>&nbsp;<span class="op" id="6936675">:=</span>&nbsp;<span class="ident" id="6936678">p</span><span class="op" id="6936679">.</span><span class="ident" id="6936680">FileName</span><span class="op" id="6936688">(</span><span class="op" id="6936689">)</span><span class="op" id="6936690">,</span>&nbsp;<span class="ident" id="6936692">test</span><span class="op" id="6936696">[</span><span class="num" id="6936697">2</span><span class="op" id="6936698">]</span><span class="op" id="6936699">;</span>&nbsp;<span class="ident" id="6936701">g</span>&nbsp;<span class="op" id="6936703">!=</span>&nbsp;<span class="ident" id="6936706">e</span>&nbsp;<span class="op" id="6936708">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936713">t</span><span class="op" id="6936714">.</span><span class="ident" id="6936715">Errorf</span><span class="op" id="6936721">(</span><span class="string" id="6936722">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6936757">,</span>&nbsp;<span class="ident" id="6936759">i</span><span class="op" id="6936760">,</span>&nbsp;<span class="ident" id="6936762">g</span><span class="op" id="6936763">,</span>&nbsp;<span class="ident" id="6936765">e</span><span class="op" id="6936766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936773">}</span><br>
<span class="lineno"></span><span class="op" id="6936775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6936778">var</span>&nbsp;<span class="ident" id="6936782">longLine</span>&nbsp;<span class="op" id="6936791">=</span>&nbsp;<span class="ident" id="6936793">strings</span><span class="op" id="6936800">.</span><span class="ident" id="6936801">Repeat</span><span class="op" id="6936807">(</span><span class="string" id="6936808">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="6936828">,</span>&nbsp;<span class="op" id="6936830">(</span><span class="num" id="6936831">1</span><span class="op" id="6936832">&lt;&lt;</span><span class="num" id="6936834">20</span><span class="op" id="6936836">)</span><span class="op" id="6936837">/</span><span class="num" id="6936838">8</span><span class="op" id="6936839">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6936842">func</span>&nbsp;<span class="ident" id="6936847">testMultipartBody</span><span class="op" id="6936864">(</span><span class="ident" id="6936865">sep</span>&nbsp;<span class="builtintype" id="6936869">string</span><span class="op" id="6936875">)</span>&nbsp;<span class="builtintype" id="6936877">string</span>&nbsp;<span class="op" id="6936884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936887">testBody</span>&nbsp;<span class="op" id="6936896">:=</span>&nbsp;<span class="string" id="6936899">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937256">testBody</span>&nbsp;<span class="op" id="6937265">=</span>&nbsp;<span class="ident" id="6937267">strings</span><span class="op" id="6937274">.</span><span class="ident" id="6937275">Replace</span><span class="op" id="6937282">(</span><span class="ident" id="6937283">testBody</span><span class="op" id="6937291">,</span>&nbsp;<span class="string" id="6937293">&#34;\n&#34;</span><span class="op" id="6937297">,</span>&nbsp;<span class="ident" id="6937299">sep</span><span class="op" id="6937302">,</span>&nbsp;<span class="op" id="6937304">-</span><span class="num" id="6937305">1</span><span class="op" id="6937306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937309">return</span>&nbsp;<span class="ident" id="6937316">strings</span><span class="op" id="6937323">.</span><span class="ident" id="6937324">Replace</span><span class="op" id="6937331">(</span><span class="ident" id="6937332">testBody</span><span class="op" id="6937340">,</span>&nbsp;<span class="string" id="6937342">&#34;[longline]&#34;</span><span class="op" id="6937354">,</span>&nbsp;<span class="ident" id="6937356">longLine</span><span class="op" id="6937364">,</span>&nbsp;<span class="num" id="6937366">1</span><span class="op" id="6937367">)</span><br>
<span class="lineno">110</span><span class="op" id="6937369">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937372">func</span>&nbsp;<span class="ident" id="6937377">TestMultipart</span><span class="op" id="6937390">(</span><span class="ident" id="6937391">t</span>&nbsp;<span class="op" id="6937393">*</span><span class="ident" id="6937394">testing</span><span class="op" id="6937401">.</span><span class="ident" id="6937402">T</span><span class="op" id="6937403">)</span>&nbsp;<span class="op" id="6937405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937408">bodyReader</span>&nbsp;<span class="op" id="6937419">:=</span>&nbsp;<span class="ident" id="6937422">strings</span><span class="op" id="6937429">.</span><span class="ident" id="6937430">NewReader</span><span class="op" id="6937439">(</span><span class="ident" id="6937440">testMultipartBody</span><span class="op" id="6937457">(</span><span class="string" id="6937458">&#34;\r\n&#34;</span><span class="op" id="6937464">)</span><span class="op" id="6937465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937468">testMultipart</span><span class="op" id="6937481">(</span><span class="ident" id="6937482">t</span><span class="op" id="6937483">,</span>&nbsp;<span class="ident" id="6937485">bodyReader</span><span class="op" id="6937495">,</span>&nbsp;<span class="ident" id="6937497">false</span><span class="op" id="6937502">)</span><br>
<span class="lineno">115</span><span class="op" id="6937504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937507">func</span>&nbsp;<span class="ident" id="6937512">TestMultipartOnlyNewlines</span><span class="op" id="6937537">(</span><span class="ident" id="6937538">t</span>&nbsp;<span class="op" id="6937540">*</span><span class="ident" id="6937541">testing</span><span class="op" id="6937548">.</span><span class="ident" id="6937549">T</span><span class="op" id="6937550">)</span>&nbsp;<span class="op" id="6937552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937555">bodyReader</span>&nbsp;<span class="op" id="6937566">:=</span>&nbsp;<span class="ident" id="6937569">strings</span><span class="op" id="6937576">.</span><span class="ident" id="6937577">NewReader</span><span class="op" id="6937586">(</span><span class="ident" id="6937587">testMultipartBody</span><span class="op" id="6937604">(</span><span class="string" id="6937605">&#34;\n&#34;</span><span class="op" id="6937609">)</span><span class="op" id="6937610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937613">testMultipart</span><span class="op" id="6937626">(</span><span class="ident" id="6937627">t</span><span class="op" id="6937628">,</span>&nbsp;<span class="ident" id="6937630">bodyReader</span><span class="op" id="6937640">,</span>&nbsp;<span class="ident" id="6937642">true</span><span class="op" id="6937646">)</span><br>
<span class="lineno">120</span><span class="op" id="6937648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937651">func</span>&nbsp;<span class="ident" id="6937656">TestMultipartSlowInput</span><span class="op" id="6937678">(</span><span class="ident" id="6937679">t</span>&nbsp;<span class="op" id="6937681">*</span><span class="ident" id="6937682">testing</span><span class="op" id="6937689">.</span><span class="ident" id="6937690">T</span><span class="op" id="6937691">)</span>&nbsp;<span class="op" id="6937693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937696">bodyReader</span>&nbsp;<span class="op" id="6937707">:=</span>&nbsp;<span class="ident" id="6937710">strings</span><span class="op" id="6937717">.</span><span class="ident" id="6937718">NewReader</span><span class="op" id="6937727">(</span><span class="ident" id="6937728">testMultipartBody</span><span class="op" id="6937745">(</span><span class="string" id="6937746">&#34;\r\n&#34;</span><span class="op" id="6937752">)</span><span class="op" id="6937753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937756">testMultipart</span><span class="op" id="6937769">(</span><span class="ident" id="6937770">t</span><span class="op" id="6937771">,</span>&nbsp;<span class="op" id="6937773">&amp;</span><span class="ident" id="6937774">slowReader</span><span class="op" id="6937784">{</span><span class="ident" id="6937785">bodyReader</span><span class="op" id="6937795">}</span><span class="op" id="6937796">,</span>&nbsp;<span class="ident" id="6937798">false</span><span class="op" id="6937803">)</span><br>
<span class="lineno">125</span><span class="op" id="6937805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937808">func</span>&nbsp;<span class="ident" id="6937813">testMultipart</span><span class="op" id="6937826">(</span><span class="ident" id="6937827">t</span>&nbsp;<span class="op" id="6937829">*</span><span class="ident" id="6937830">testing</span><span class="op" id="6937837">.</span><span class="ident" id="6937838">T</span><span class="op" id="6937839">,</span>&nbsp;<span class="ident" id="6937841">r</span>&nbsp;<span class="ident" id="6937843">io</span><span class="op" id="6937845">.</span><span class="ident" id="6937846">Reader</span><span class="op" id="6937852">,</span>&nbsp;<span class="ident" id="6937854">onlyNewlines</span>&nbsp;<span class="builtintype" id="6937867">bool</span><span class="op" id="6937871">)</span>&nbsp;<span class="op" id="6937873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937876">reader</span>&nbsp;<span class="op" id="6937883">:=</span>&nbsp;<span class="ident" id="6937886">NewReader</span><span class="op" id="6937895">(</span><span class="ident" id="6937896">r</span><span class="op" id="6937897">,</span>&nbsp;<span class="string" id="6937899">&#34;MyBoundary&#34;</span><span class="op" id="6937911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937914">buf</span>&nbsp;<span class="op" id="6937918">:=</span>&nbsp;<span class="builtinfunc" id="6937921">new</span><span class="op" id="6937924">(</span><span class="ident" id="6937925">bytes</span><span class="op" id="6937930">.</span><span class="ident" id="6937931">Buffer</span><span class="op" id="6937937">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6937941">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937951">part</span><span class="op" id="6937955">,</span>&nbsp;<span class="ident" id="6937957">err</span>&nbsp;<span class="op" id="6937961">:=</span>&nbsp;<span class="ident" id="6937964">reader</span><span class="op" id="6937970">.</span><span class="ident" id="6937971">NextPart</span><span class="op" id="6937979">(</span><span class="op" id="6937980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937983">if</span>&nbsp;<span class="ident" id="6937986">part</span>&nbsp;<span class="op" id="6937991">==</span>&nbsp;<span class="ident" id="6937994">nil</span>&nbsp;<span class="op" id="6937998">||</span>&nbsp;<span class="ident" id="6938001">err</span>&nbsp;<span class="op" id="6938005">!=</span>&nbsp;<span class="ident" id="6938008">nil</span>&nbsp;<span class="op" id="6938012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938016">t</span><span class="op" id="6938017">.</span><span class="ident" id="6938018">Error</span><span class="op" id="6938023">(</span><span class="string" id="6938024">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="6938040">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938044">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938055">if</span>&nbsp;<span class="ident" id="6938058">x</span>&nbsp;<span class="op" id="6938060">:=</span>&nbsp;<span class="ident" id="6938063">part</span><span class="op" id="6938067">.</span><span class="ident" id="6938068">Header</span><span class="op" id="6938074">.</span><span class="ident" id="6938075">Get</span><span class="op" id="6938078">(</span><span class="string" id="6938079">&#34;Header1&#34;</span><span class="op" id="6938088">)</span><span class="op" id="6938089">;</span>&nbsp;<span class="ident" id="6938091">x</span>&nbsp;<span class="op" id="6938093">!=</span>&nbsp;<span class="string" id="6938096">&#34;value1&#34;</span>&nbsp;<span class="op" id="6938105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938109">t</span><span class="op" id="6938110">.</span><span class="ident" id="6938111">Errorf</span><span class="op" id="6938117">(</span><span class="string" id="6938118">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6938153">,</span>&nbsp;<span class="string" id="6938155">&#34;Header1&#34;</span><span class="op" id="6938164">,</span>&nbsp;<span class="ident" id="6938166">x</span><span class="op" id="6938167">,</span>&nbsp;<span class="string" id="6938169">&#34;value1&#34;</span><span class="op" id="6938177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938180">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938183">if</span>&nbsp;<span class="ident" id="6938186">x</span>&nbsp;<span class="op" id="6938188">:=</span>&nbsp;<span class="ident" id="6938191">part</span><span class="op" id="6938195">.</span><span class="ident" id="6938196">Header</span><span class="op" id="6938202">.</span><span class="ident" id="6938203">Get</span><span class="op" id="6938206">(</span><span class="string" id="6938207">&#34;foo-bar&#34;</span><span class="op" id="6938216">)</span><span class="op" id="6938217">;</span>&nbsp;<span class="ident" id="6938219">x</span>&nbsp;<span class="op" id="6938221">!=</span>&nbsp;<span class="string" id="6938224">&#34;baz&#34;</span>&nbsp;<span class="op" id="6938230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938234">t</span><span class="op" id="6938235">.</span><span class="ident" id="6938236">Errorf</span><span class="op" id="6938242">(</span><span class="string" id="6938243">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6938278">,</span>&nbsp;<span class="string" id="6938280">&#34;foo-bar&#34;</span><span class="op" id="6938289">,</span>&nbsp;<span class="ident" id="6938291">x</span><span class="op" id="6938292">,</span>&nbsp;<span class="string" id="6938294">&#34;baz&#34;</span><span class="op" id="6938299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938305">if</span>&nbsp;<span class="ident" id="6938308">x</span>&nbsp;<span class="op" id="6938310">:=</span>&nbsp;<span class="ident" id="6938313">part</span><span class="op" id="6938317">.</span><span class="ident" id="6938318">Header</span><span class="op" id="6938324">.</span><span class="ident" id="6938325">Get</span><span class="op" id="6938328">(</span><span class="string" id="6938329">&#34;Foo-Bar&#34;</span><span class="op" id="6938338">)</span><span class="op" id="6938339">;</span>&nbsp;<span class="ident" id="6938341">x</span>&nbsp;<span class="op" id="6938343">!=</span>&nbsp;<span class="string" id="6938346">&#34;baz&#34;</span>&nbsp;<span class="op" id="6938352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938356">t</span><span class="op" id="6938357">.</span><span class="ident" id="6938358">Errorf</span><span class="op" id="6938364">(</span><span class="string" id="6938365">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6938400">,</span>&nbsp;<span class="string" id="6938402">&#34;Foo-Bar&#34;</span><span class="op" id="6938411">,</span>&nbsp;<span class="ident" id="6938413">x</span><span class="op" id="6938414">,</span>&nbsp;<span class="string" id="6938416">&#34;baz&#34;</span><span class="op" id="6938421">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938427">buf</span><span class="op" id="6938430">.</span><span class="ident" id="6938431">Reset</span><span class="op" id="6938436">(</span><span class="op" id="6938437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938440">if</span>&nbsp;<span class="ident" id="6938443">_</span><span class="op" id="6938444">,</span>&nbsp;<span class="ident" id="6938446">err</span>&nbsp;<span class="op" id="6938450">:=</span>&nbsp;<span class="ident" id="6938453">io</span><span class="op" id="6938455">.</span><span class="ident" id="6938456">Copy</span><span class="op" id="6938460">(</span><span class="ident" id="6938461">buf</span><span class="op" id="6938464">,</span>&nbsp;<span class="ident" id="6938466">part</span><span class="op" id="6938470">)</span><span class="op" id="6938471">;</span>&nbsp;<span class="ident" id="6938473">err</span>&nbsp;<span class="op" id="6938477">!=</span>&nbsp;<span class="ident" id="6938480">nil</span>&nbsp;<span class="op" id="6938484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938488">t</span><span class="op" id="6938489">.</span><span class="ident" id="6938490">Errorf</span><span class="op" id="6938496">(</span><span class="string" id="6938497">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6938514">,</span>&nbsp;<span class="ident" id="6938516">err</span><span class="op" id="6938519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938522">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938526">adjustNewlines</span>&nbsp;<span class="op" id="6938541">:=</span>&nbsp;<span class="keyword" id="6938544">func</span><span class="op" id="6938548">(</span><span class="ident" id="6938549">s</span>&nbsp;<span class="builtintype" id="6938551">string</span><span class="op" id="6938557">)</span>&nbsp;<span class="builtintype" id="6938559">string</span>&nbsp;<span class="op" id="6938566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938570">if</span>&nbsp;<span class="ident" id="6938573">onlyNewlines</span>&nbsp;<span class="op" id="6938586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938591">return</span>&nbsp;<span class="ident" id="6938598">strings</span><span class="op" id="6938605">.</span><span class="ident" id="6938606">Replace</span><span class="op" id="6938613">(</span><span class="ident" id="6938614">s</span><span class="op" id="6938615">,</span>&nbsp;<span class="string" id="6938617">&#34;\r\n&#34;</span><span class="op" id="6938623">,</span>&nbsp;<span class="string" id="6938625">&#34;\n&#34;</span><span class="op" id="6938629">,</span>&nbsp;<span class="op" id="6938631">-</span><span class="num" id="6938632">1</span><span class="op" id="6938633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938637">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938641">return</span>&nbsp;<span class="ident" id="6938648">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938655">expectEq</span><span class="op" id="6938663">(</span><span class="ident" id="6938664">t</span><span class="op" id="6938665">,</span>&nbsp;<span class="ident" id="6938667">adjustNewlines</span><span class="op" id="6938681">(</span><span class="string" id="6938682">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="6938704">)</span><span class="op" id="6938705">,</span>&nbsp;<span class="ident" id="6938707">buf</span><span class="op" id="6938710">.</span><span class="ident" id="6938711">String</span><span class="op" id="6938717">(</span><span class="op" id="6938718">)</span><span class="op" id="6938719">,</span>&nbsp;<span class="string" id="6938721">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="6938742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6938746">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938756">part</span><span class="op" id="6938760">,</span>&nbsp;<span class="ident" id="6938762">err</span>&nbsp;<span class="op" id="6938766">=</span>&nbsp;<span class="ident" id="6938768">reader</span><span class="op" id="6938774">.</span><span class="ident" id="6938775">NextPart</span><span class="op" id="6938783">(</span><span class="op" id="6938784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938787">if</span>&nbsp;<span class="ident" id="6938790">err</span>&nbsp;<span class="op" id="6938794">!=</span>&nbsp;<span class="ident" id="6938797">nil</span>&nbsp;<span class="op" id="6938801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938805">t</span><span class="op" id="6938806">.</span><span class="ident" id="6938807">Fatalf</span><span class="op" id="6938813">(</span><span class="string" id="6938814">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="6938839">,</span>&nbsp;<span class="ident" id="6938841">err</span><span class="op" id="6938844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938848">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938859">if</span>&nbsp;<span class="ident" id="6938862">e</span><span class="op" id="6938863">,</span>&nbsp;<span class="ident" id="6938865">g</span>&nbsp;<span class="op" id="6938867">:=</span>&nbsp;<span class="string" id="6938870">&#34;bigsection&#34;</span><span class="op" id="6938882">,</span>&nbsp;<span class="ident" id="6938884">part</span><span class="op" id="6938888">.</span><span class="ident" id="6938889">Header</span><span class="op" id="6938895">.</span><span class="ident" id="6938896">Get</span><span class="op" id="6938899">(</span><span class="string" id="6938900">&#34;name&#34;</span><span class="op" id="6938906">)</span><span class="op" id="6938907">;</span>&nbsp;<span class="ident" id="6938909">e</span>&nbsp;<span class="op" id="6938911">!=</span>&nbsp;<span class="ident" id="6938914">g</span>&nbsp;<span class="op" id="6938916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938920">t</span><span class="op" id="6938921">.</span><span class="ident" id="6938922">Errorf</span><span class="op" id="6938928">(</span><span class="string" id="6938929">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6938971">,</span>&nbsp;<span class="ident" id="6938973">e</span><span class="op" id="6938974">,</span>&nbsp;<span class="ident" id="6938976">g</span><span class="op" id="6938977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938983">buf</span><span class="op" id="6938986">.</span><span class="ident" id="6938987">Reset</span><span class="op" id="6938992">(</span><span class="op" id="6938993">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938996">if</span>&nbsp;<span class="ident" id="6938999">_</span><span class="op" id="6939000">,</span>&nbsp;<span class="ident" id="6939002">err</span>&nbsp;<span class="op" id="6939006">:=</span>&nbsp;<span class="ident" id="6939009">io</span><span class="op" id="6939011">.</span><span class="ident" id="6939012">Copy</span><span class="op" id="6939016">(</span><span class="ident" id="6939017">buf</span><span class="op" id="6939020">,</span>&nbsp;<span class="ident" id="6939022">part</span><span class="op" id="6939026">)</span><span class="op" id="6939027">;</span>&nbsp;<span class="ident" id="6939029">err</span>&nbsp;<span class="op" id="6939033">!=</span>&nbsp;<span class="ident" id="6939036">nil</span>&nbsp;<span class="op" id="6939040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939044">t</span><span class="op" id="6939045">.</span><span class="ident" id="6939046">Errorf</span><span class="op" id="6939052">(</span><span class="string" id="6939053">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6939070">,</span>&nbsp;<span class="ident" id="6939072">err</span><span class="op" id="6939075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939081">s</span>&nbsp;<span class="op" id="6939083">:=</span>&nbsp;<span class="ident" id="6939086">buf</span><span class="op" id="6939089">.</span><span class="ident" id="6939090">String</span><span class="op" id="6939096">(</span><span class="op" id="6939097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939100">if</span>&nbsp;<span class="builtinfunc" id="6939103">len</span><span class="op" id="6939106">(</span><span class="ident" id="6939107">s</span><span class="op" id="6939108">)</span>&nbsp;<span class="op" id="6939110">!=</span>&nbsp;<span class="builtinfunc" id="6939113">len</span><span class="op" id="6939116">(</span><span class="ident" id="6939117">longLine</span><span class="op" id="6939125">)</span>&nbsp;<span class="op" id="6939127">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939131">t</span><span class="op" id="6939132">.</span><span class="ident" id="6939133">Errorf</span><span class="op" id="6939139">(</span><span class="string" id="6939140">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="6939199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6939204">len</span><span class="op" id="6939207">(</span><span class="ident" id="6939208">longLine</span><span class="op" id="6939216">)</span><span class="op" id="6939217">,</span>&nbsp;<span class="builtinfunc" id="6939219">len</span><span class="op" id="6939222">(</span><span class="ident" id="6939223">s</span><span class="op" id="6939224">)</span><span class="op" id="6939225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939231">if</span>&nbsp;<span class="ident" id="6939234">s</span>&nbsp;<span class="op" id="6939236">!=</span>&nbsp;<span class="ident" id="6939239">longLine</span>&nbsp;<span class="op" id="6939248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939252">t</span><span class="op" id="6939253">.</span><span class="ident" id="6939254">Errorf</span><span class="op" id="6939260">(</span><span class="string" id="6939261">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="6939291">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6939298">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939308">part</span><span class="op" id="6939312">,</span>&nbsp;<span class="ident" id="6939314">err</span>&nbsp;<span class="op" id="6939318">=</span>&nbsp;<span class="ident" id="6939320">reader</span><span class="op" id="6939326">.</span><span class="ident" id="6939327">NextPart</span><span class="op" id="6939335">(</span><span class="op" id="6939336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939339">if</span>&nbsp;<span class="ident" id="6939342">part</span>&nbsp;<span class="op" id="6939347">==</span>&nbsp;<span class="ident" id="6939350">nil</span>&nbsp;<span class="op" id="6939354">||</span>&nbsp;<span class="ident" id="6939357">err</span>&nbsp;<span class="op" id="6939361">!=</span>&nbsp;<span class="ident" id="6939364">nil</span>&nbsp;<span class="op" id="6939368">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939372">t</span><span class="op" id="6939373">.</span><span class="ident" id="6939374">Error</span><span class="op" id="6939379">(</span><span class="string" id="6939380">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="6939396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939400">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939411">if</span>&nbsp;<span class="ident" id="6939414">part</span><span class="op" id="6939418">.</span><span class="ident" id="6939419">Header</span><span class="op" id="6939425">.</span><span class="ident" id="6939426">Get</span><span class="op" id="6939429">(</span><span class="string" id="6939430">&#34;foo-bar&#34;</span><span class="op" id="6939439">)</span>&nbsp;<span class="op" id="6939441">!=</span>&nbsp;<span class="string" id="6939444">&#34;bazb&#34;</span>&nbsp;<span class="op" id="6939451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939455">t</span><span class="op" id="6939456">.</span><span class="ident" id="6939457">Error</span><span class="op" id="6939462">(</span><span class="string" id="6939463">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="6939487">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939493">buf</span><span class="op" id="6939496">.</span><span class="ident" id="6939497">Reset</span><span class="op" id="6939502">(</span><span class="op" id="6939503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939506">if</span>&nbsp;<span class="ident" id="6939509">_</span><span class="op" id="6939510">,</span>&nbsp;<span class="ident" id="6939512">err</span>&nbsp;<span class="op" id="6939516">:=</span>&nbsp;<span class="ident" id="6939519">io</span><span class="op" id="6939521">.</span><span class="ident" id="6939522">Copy</span><span class="op" id="6939526">(</span><span class="ident" id="6939527">buf</span><span class="op" id="6939530">,</span>&nbsp;<span class="ident" id="6939532">part</span><span class="op" id="6939536">)</span><span class="op" id="6939537">;</span>&nbsp;<span class="ident" id="6939539">err</span>&nbsp;<span class="op" id="6939543">!=</span>&nbsp;<span class="ident" id="6939546">nil</span>&nbsp;<span class="op" id="6939550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939554">t</span><span class="op" id="6939555">.</span><span class="ident" id="6939556">Errorf</span><span class="op" id="6939562">(</span><span class="string" id="6939563">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6939580">,</span>&nbsp;<span class="ident" id="6939582">err</span><span class="op" id="6939585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939588">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939591">expectEq</span><span class="op" id="6939599">(</span><span class="ident" id="6939600">t</span><span class="op" id="6939601">,</span>&nbsp;<span class="ident" id="6939603">adjustNewlines</span><span class="op" id="6939617">(</span><span class="string" id="6939618">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="6939683">)</span><span class="op" id="6939684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939688">buf</span><span class="op" id="6939691">.</span><span class="ident" id="6939692">String</span><span class="op" id="6939698">(</span><span class="op" id="6939699">)</span><span class="op" id="6939700">,</span>&nbsp;<span class="string" id="6939702">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="6939718">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6939722">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939732">part</span><span class="op" id="6939736">,</span>&nbsp;<span class="ident" id="6939738">err</span>&nbsp;<span class="op" id="6939742">=</span>&nbsp;<span class="ident" id="6939744">reader</span><span class="op" id="6939750">.</span><span class="ident" id="6939751">NextPart</span><span class="op" id="6939759">(</span><span class="op" id="6939760">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939763">if</span>&nbsp;<span class="ident" id="6939766">part</span>&nbsp;<span class="op" id="6939771">==</span>&nbsp;<span class="ident" id="6939774">nil</span>&nbsp;<span class="op" id="6939778">||</span>&nbsp;<span class="ident" id="6939781">err</span>&nbsp;<span class="op" id="6939785">!=</span>&nbsp;<span class="ident" id="6939788">nil</span>&nbsp;<span class="op" id="6939792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939796">t</span><span class="op" id="6939797">.</span><span class="ident" id="6939798">Error</span><span class="op" id="6939803">(</span><span class="string" id="6939804">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="6939836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939840">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6939852">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939875">part</span><span class="op" id="6939879">,</span>&nbsp;<span class="ident" id="6939881">err</span>&nbsp;<span class="op" id="6939885">=</span>&nbsp;<span class="ident" id="6939887">reader</span><span class="op" id="6939893">.</span><span class="ident" id="6939894">NextPart</span><span class="op" id="6939902">(</span><span class="op" id="6939903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939906">if</span>&nbsp;<span class="ident" id="6939909">part</span>&nbsp;<span class="op" id="6939914">!=</span>&nbsp;<span class="ident" id="6939917">nil</span>&nbsp;<span class="op" id="6939921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939925">t</span><span class="op" id="6939926">.</span><span class="ident" id="6939927">Error</span><span class="op" id="6939932">(</span><span class="string" id="6939933">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="6939962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939965">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939968">if</span>&nbsp;<span class="ident" id="6939971">err</span>&nbsp;<span class="op" id="6939975">!=</span>&nbsp;<span class="ident" id="6939978">io</span><span class="op" id="6939980">.</span><span class="ident" id="6939981">EOF</span>&nbsp;<span class="op" id="6939985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939989">t</span><span class="op" id="6939990">.</span><span class="ident" id="6939991">Errorf</span><span class="op" id="6939997">(</span><span class="string" id="6939998">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6940037">,</span>&nbsp;<span class="ident" id="6940039">err</span><span class="op" id="6940042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940045">}</span><br>
<span class="lineno"></span><span class="op" id="6940047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6940050">func</span>&nbsp;<span class="ident" id="6940055">TestVariousTextLineEndings</span><span class="op" id="6940081">(</span><span class="ident" id="6940082">t</span>&nbsp;<span class="op" id="6940084">*</span><span class="ident" id="6940085">testing</span><span class="op" id="6940092">.</span><span class="ident" id="6940093">T</span><span class="op" id="6940094">)</span>&nbsp;<span class="op" id="6940096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940099">tests</span>&nbsp;<span class="op" id="6940105">:=</span>&nbsp;<span class="op" id="6940108">[</span><span class="op" id="6940109">...</span><span class="op" id="6940112">]</span><span class="builtintype" id="6940113">string</span><span class="op" id="6940119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940123">&#34;Foo\nBar&#34;</span><span class="op" id="6940133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940137">&#34;Foo\nBar\n&#34;</span><span class="op" id="6940149">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940153">&#34;Foo\r\nBar&#34;</span><span class="op" id="6940165">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940169">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="6940185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940189">&#34;Foo\rBar&#34;</span><span class="op" id="6940199">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940203">&#34;Foo\rBar\r&#34;</span><span class="op" id="6940215">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940219">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="6940265">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940268">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940272">for</span>&nbsp;<span class="ident" id="6940276">testNum</span><span class="op" id="6940283">,</span>&nbsp;<span class="ident" id="6940285">expectedBody</span>&nbsp;<span class="op" id="6940298">:=</span>&nbsp;<span class="keyword" id="6940301">range</span>&nbsp;<span class="ident" id="6940307">tests</span>&nbsp;<span class="op" id="6940313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940317">body</span>&nbsp;<span class="op" id="6940322">:=</span>&nbsp;<span class="string" id="6940325">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="6940342">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940347">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6940400">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940405">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6940412">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940417">expectedBody</span>&nbsp;<span class="op" id="6940430">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6940435">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940460">bodyReader</span>&nbsp;<span class="op" id="6940471">:=</span>&nbsp;<span class="ident" id="6940474">strings</span><span class="op" id="6940481">.</span><span class="ident" id="6940482">NewReader</span><span class="op" id="6940491">(</span><span class="ident" id="6940492">body</span><span class="op" id="6940496">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940501">reader</span>&nbsp;<span class="op" id="6940508">:=</span>&nbsp;<span class="ident" id="6940511">NewReader</span><span class="op" id="6940520">(</span><span class="ident" id="6940521">bodyReader</span><span class="op" id="6940531">,</span>&nbsp;<span class="string" id="6940533">&#34;BOUNDARY&#34;</span><span class="op" id="6940543">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940547">buf</span>&nbsp;<span class="op" id="6940551">:=</span>&nbsp;<span class="builtinfunc" id="6940554">new</span><span class="op" id="6940557">(</span><span class="ident" id="6940558">bytes</span><span class="op" id="6940563">.</span><span class="ident" id="6940564">Buffer</span><span class="op" id="6940570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940574">part</span><span class="op" id="6940578">,</span>&nbsp;<span class="ident" id="6940580">err</span>&nbsp;<span class="op" id="6940584">:=</span>&nbsp;<span class="ident" id="6940587">reader</span><span class="op" id="6940593">.</span><span class="ident" id="6940594">NextPart</span><span class="op" id="6940602">(</span><span class="op" id="6940603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940607">if</span>&nbsp;<span class="ident" id="6940610">part</span>&nbsp;<span class="op" id="6940615">==</span>&nbsp;<span class="ident" id="6940618">nil</span>&nbsp;<span class="op" id="6940622">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940627">t</span><span class="op" id="6940628">.</span><span class="ident" id="6940629">Errorf</span><span class="op" id="6940635">(</span><span class="string" id="6940636">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="6940669">,</span>&nbsp;<span class="ident" id="6940671">testNum</span><span class="op" id="6940678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940683">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940698">if</span>&nbsp;<span class="ident" id="6940701">err</span>&nbsp;<span class="op" id="6940705">!=</span>&nbsp;<span class="ident" id="6940708">nil</span>&nbsp;<span class="op" id="6940712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940717">t</span><span class="op" id="6940718">.</span><span class="ident" id="6940719">Errorf</span><span class="op" id="6940725">(</span><span class="string" id="6940726">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6940759">,</span>&nbsp;<span class="ident" id="6940761">testNum</span><span class="op" id="6940768">,</span>&nbsp;<span class="ident" id="6940770">err</span><span class="op" id="6940773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940778">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940789">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940793">written</span><span class="op" id="6940800">,</span>&nbsp;<span class="ident" id="6940802">err</span>&nbsp;<span class="op" id="6940806">:=</span>&nbsp;<span class="ident" id="6940809">io</span><span class="op" id="6940811">.</span><span class="ident" id="6940812">Copy</span><span class="op" id="6940816">(</span><span class="ident" id="6940817">buf</span><span class="op" id="6940820">,</span>&nbsp;<span class="ident" id="6940822">part</span><span class="op" id="6940826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940830">expectEq</span><span class="op" id="6940838">(</span><span class="ident" id="6940839">t</span><span class="op" id="6940840">,</span>&nbsp;<span class="ident" id="6940842">expectedBody</span><span class="op" id="6940854">,</span>&nbsp;<span class="ident" id="6940856">buf</span><span class="op" id="6940859">.</span><span class="ident" id="6940860">String</span><span class="op" id="6940866">(</span><span class="op" id="6940867">)</span><span class="op" id="6940868">,</span>&nbsp;<span class="ident" id="6940870">fmt</span><span class="op" id="6940873">.</span><span class="ident" id="6940874">Sprintf</span><span class="op" id="6940881">(</span><span class="string" id="6940882">&#34;test&nbsp;%d&#34;</span><span class="op" id="6940891">,</span>&nbsp;<span class="ident" id="6940893">testNum</span><span class="op" id="6940900">)</span><span class="op" id="6940901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940905">if</span>&nbsp;<span class="ident" id="6940908">err</span>&nbsp;<span class="op" id="6940912">!=</span>&nbsp;<span class="ident" id="6940915">nil</span>&nbsp;<span class="op" id="6940919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940924">t</span><span class="op" id="6940925">.</span><span class="ident" id="6940926">Errorf</span><span class="op" id="6940932">(</span><span class="string" id="6940933">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="6940978">,</span>&nbsp;<span class="ident" id="6940980">written</span><span class="op" id="6940987">,</span>&nbsp;<span class="ident" id="6940989">err</span><span class="op" id="6940992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940996">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941001">part</span><span class="op" id="6941005">,</span>&nbsp;<span class="ident" id="6941007">err</span>&nbsp;<span class="op" id="6941011">=</span>&nbsp;<span class="ident" id="6941013">reader</span><span class="op" id="6941019">.</span><span class="ident" id="6941020">NextPart</span><span class="op" id="6941028">(</span><span class="op" id="6941029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941033">if</span>&nbsp;<span class="ident" id="6941036">part</span>&nbsp;<span class="op" id="6941041">!=</span>&nbsp;<span class="ident" id="6941044">nil</span>&nbsp;<span class="op" id="6941048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941053">t</span><span class="op" id="6941054">.</span><span class="ident" id="6941055">Errorf</span><span class="op" id="6941061">(</span><span class="string" id="6941062">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="6941090">,</span>&nbsp;<span class="ident" id="6941092">testNum</span><span class="op" id="6941099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941103">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941107">if</span>&nbsp;<span class="ident" id="6941110">err</span>&nbsp;<span class="op" id="6941114">!=</span>&nbsp;<span class="ident" id="6941117">io</span><span class="op" id="6941119">.</span><span class="ident" id="6941120">EOF</span>&nbsp;<span class="op" id="6941124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941129">t</span><span class="op" id="6941130">.</span><span class="ident" id="6941131">Errorf</span><span class="op" id="6941137">(</span><span class="string" id="6941138">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6941174">,</span>&nbsp;<span class="ident" id="6941176">testNum</span><span class="op" id="6941183">,</span>&nbsp;<span class="ident" id="6941185">err</span><span class="op" id="6941188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941196">}</span><br>
<span class="lineno">260</span><span class="op" id="6941198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941201">type</span>&nbsp;<span class="ident" id="6941206">maliciousReader</span>&nbsp;<span class="keyword" id="6941222">struct</span>&nbsp;<span class="op" id="6941229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941232">t</span>&nbsp;<span class="op" id="6941234">*</span><span class="ident" id="6941235">testing</span><span class="op" id="6941242">.</span><span class="ident" id="6941243">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941246">n</span>&nbsp;<span class="builtintype" id="6941248">int</span><br>
<span class="lineno">265</span><span class="op" id="6941252">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941255">const</span>&nbsp;<span class="ident" id="6941261">maxReadThreshold</span>&nbsp;<span class="op" id="6941278">=</span>&nbsp;<span class="num" id="6941280">1</span>&nbsp;<span class="op" id="6941282">&lt;&lt;</span>&nbsp;<span class="num" id="6941285">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941289">func</span>&nbsp;<span class="op" id="6941294">(</span><span class="ident" id="6941295">mr</span>&nbsp;<span class="op" id="6941298">*</span><span class="ident" id="6941299">maliciousReader</span><span class="op" id="6941314">)</span>&nbsp;<span class="ident" id="6941316">Read</span><span class="op" id="6941320">(</span><span class="ident" id="6941321">b</span>&nbsp;<span class="op" id="6941323">[</span><span class="op" id="6941324">]</span><span class="builtintype" id="6941325">byte</span><span class="op" id="6941329">)</span>&nbsp;<span class="op" id="6941331">(</span><span class="ident" id="6941332">n</span>&nbsp;<span class="builtintype" id="6941334">int</span><span class="op" id="6941337">,</span>&nbsp;<span class="ident" id="6941339">err</span>&nbsp;<span class="builtintype" id="6941343">error</span><span class="op" id="6941348">)</span>&nbsp;<span class="op" id="6941350">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941353">mr</span><span class="op" id="6941355">.</span><span class="ident" id="6941356">n</span>&nbsp;<span class="op" id="6941358">+=</span>&nbsp;<span class="builtinfunc" id="6941361">len</span><span class="op" id="6941364">(</span><span class="ident" id="6941365">b</span><span class="op" id="6941366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941369">if</span>&nbsp;<span class="ident" id="6941372">mr</span><span class="op" id="6941374">.</span><span class="ident" id="6941375">n</span>&nbsp;<span class="op" id="6941377">&gt;=</span>&nbsp;<span class="ident" id="6941380">maxReadThreshold</span>&nbsp;<span class="op" id="6941397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941401">mr</span><span class="op" id="6941403">.</span><span class="ident" id="6941404">t</span><span class="op" id="6941405">.</span><span class="ident" id="6941406">Fatal</span><span class="op" id="6941411">(</span><span class="string" id="6941412">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="6941431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941435">return</span>&nbsp;<span class="num" id="6941442">0</span><span class="op" id="6941443">,</span>&nbsp;<span class="ident" id="6941445">io</span><span class="op" id="6941447">.</span><span class="ident" id="6941448">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941453">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941456">return</span>&nbsp;<span class="builtinfunc" id="6941463">len</span><span class="op" id="6941466">(</span><span class="ident" id="6941467">b</span><span class="op" id="6941468">)</span><span class="op" id="6941469">,</span>&nbsp;<span class="ident" id="6941471">nil</span><br>
<span class="lineno"></span><span class="op" id="6941475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941478">func</span>&nbsp;<span class="ident" id="6941483">TestLineLimit</span><span class="op" id="6941496">(</span><span class="ident" id="6941497">t</span>&nbsp;<span class="op" id="6941499">*</span><span class="ident" id="6941500">testing</span><span class="op" id="6941507">.</span><span class="ident" id="6941508">T</span><span class="op" id="6941509">)</span>&nbsp;<span class="op" id="6941511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941514">mr</span>&nbsp;<span class="op" id="6941517">:=</span>&nbsp;<span class="op" id="6941520">&amp;</span><span class="ident" id="6941521">maliciousReader</span><span class="op" id="6941536">{</span><span class="ident" id="6941537">t</span><span class="op" id="6941538">:</span>&nbsp;<span class="ident" id="6941540">t</span><span class="op" id="6941541">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941544">r</span>&nbsp;<span class="op" id="6941546">:=</span>&nbsp;<span class="ident" id="6941549">NewReader</span><span class="op" id="6941558">(</span><span class="ident" id="6941559">mr</span><span class="op" id="6941561">,</span>&nbsp;<span class="string" id="6941563">&#34;fooBoundary&#34;</span><span class="op" id="6941576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941579">part</span><span class="op" id="6941583">,</span>&nbsp;<span class="ident" id="6941585">err</span>&nbsp;<span class="op" id="6941589">:=</span>&nbsp;<span class="ident" id="6941592">r</span><span class="op" id="6941593">.</span><span class="ident" id="6941594">NextPart</span><span class="op" id="6941602">(</span><span class="op" id="6941603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941606">if</span>&nbsp;<span class="ident" id="6941609">part</span>&nbsp;<span class="op" id="6941614">!=</span>&nbsp;<span class="ident" id="6941617">nil</span>&nbsp;<span class="op" id="6941621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941625">t</span><span class="op" id="6941626">.</span><span class="ident" id="6941627">Errorf</span><span class="op" id="6941633">(</span><span class="string" id="6941634">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="6941656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941659">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941662">if</span>&nbsp;<span class="ident" id="6941665">err</span>&nbsp;<span class="op" id="6941669">==</span>&nbsp;<span class="ident" id="6941672">nil</span>&nbsp;<span class="op" id="6941676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941680">t</span><span class="op" id="6941681">.</span><span class="ident" id="6941682">Errorf</span><span class="op" id="6941688">(</span><span class="string" id="6941689">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="6941708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6941714">if</span>&nbsp;<span class="ident" id="6941717">mr</span><span class="op" id="6941719">.</span><span class="ident" id="6941720">n</span>&nbsp;<span class="op" id="6941722">&gt;=</span>&nbsp;<span class="ident" id="6941725">maxReadThreshold</span>&nbsp;<span class="op" id="6941742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941746">t</span><span class="op" id="6941747">.</span><span class="ident" id="6941748">Errorf</span><span class="op" id="6941754">(</span><span class="string" id="6941755">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6941793">,</span>&nbsp;<span class="ident" id="6941795">maxReadThreshold</span><span class="op" id="6941811">,</span>&nbsp;<span class="ident" id="6941813">mr</span><span class="op" id="6941815">.</span><span class="ident" id="6941816">n</span><span class="op" id="6941817">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6941820">}</span><br>
<span class="lineno"></span><span class="op" id="6941822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941825">func</span>&nbsp;<span class="ident" id="6941830">TestMultipartTruncated</span><span class="op" id="6941852">(</span><span class="ident" id="6941853">t</span>&nbsp;<span class="op" id="6941855">*</span><span class="ident" id="6941856">testing</span><span class="op" id="6941863">.</span><span class="ident" id="6941864">T</span><span class="op" id="6941865">)</span>&nbsp;<span class="op" id="6941867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941870">testBody</span>&nbsp;<span class="op" id="6941879">:=</span>&nbsp;<span class="string" id="6941882">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6941989">body</span>&nbsp;<span class="op" id="6941994">:=</span>&nbsp;<span class="ident" id="6941997">strings</span><span class="op" id="6942004">.</span><span class="ident" id="6942005">Replace</span><span class="op" id="6942012">(</span><span class="ident" id="6942013">testBody</span><span class="op" id="6942021">,</span>&nbsp;<span class="string" id="6942023">&#34;\n&#34;</span><span class="op" id="6942027">,</span>&nbsp;<span class="string" id="6942029">&#34;\r\n&#34;</span><span class="op" id="6942035">,</span>&nbsp;<span class="op" id="6942037">-</span><span class="num" id="6942038">1</span><span class="op" id="6942039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942042">bodyReader</span>&nbsp;<span class="op" id="6942053">:=</span>&nbsp;<span class="ident" id="6942056">strings</span><span class="op" id="6942063">.</span><span class="ident" id="6942064">NewReader</span><span class="op" id="6942073">(</span><span class="ident" id="6942074">body</span><span class="op" id="6942078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942081">r</span>&nbsp;<span class="op" id="6942083">:=</span>&nbsp;<span class="ident" id="6942086">NewReader</span><span class="op" id="6942095">(</span><span class="ident" id="6942096">bodyReader</span><span class="op" id="6942106">,</span>&nbsp;<span class="string" id="6942108">&#34;MyBoundary&#34;</span><span class="op" id="6942120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942124">part</span><span class="op" id="6942128">,</span>&nbsp;<span class="ident" id="6942130">err</span>&nbsp;<span class="op" id="6942134">:=</span>&nbsp;<span class="ident" id="6942137">r</span><span class="op" id="6942138">.</span><span class="ident" id="6942139">NextPart</span><span class="op" id="6942147">(</span><span class="op" id="6942148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6942151">if</span>&nbsp;<span class="ident" id="6942154">err</span>&nbsp;<span class="op" id="6942158">!=</span>&nbsp;<span class="ident" id="6942161">nil</span>&nbsp;<span class="op" id="6942165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942169">t</span><span class="op" id="6942170">.</span><span class="ident" id="6942171">Fatalf</span><span class="op" id="6942177">(</span><span class="string" id="6942178">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6942197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6942200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942203">_</span><span class="op" id="6942204">,</span>&nbsp;<span class="ident" id="6942206">err</span>&nbsp;<span class="op" id="6942210">=</span>&nbsp;<span class="ident" id="6942212">io</span><span class="op" id="6942214">.</span><span class="ident" id="6942215">Copy</span><span class="op" id="6942219">(</span><span class="ident" id="6942220">ioutil</span><span class="op" id="6942226">.</span><span class="ident" id="6942227">Discard</span><span class="op" id="6942234">,</span>&nbsp;<span class="ident" id="6942236">part</span><span class="op" id="6942240">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6942243">if</span>&nbsp;<span class="ident" id="6942246">err</span>&nbsp;<span class="op" id="6942250">!=</span>&nbsp;<span class="ident" id="6942253">io</span><span class="op" id="6942255">.</span><span class="ident" id="6942256">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6942273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942277">t</span><span class="op" id="6942278">.</span><span class="ident" id="6942279">Fatalf</span><span class="op" id="6942285">(</span><span class="string" id="6942286">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6942330">,</span>&nbsp;<span class="ident" id="6942332">err</span><span class="op" id="6942335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6942338">}</span><br>
<span class="lineno"></span><span class="op" id="6942340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6942343">type</span>&nbsp;<span class="ident" id="6942348">slowReader</span>&nbsp;<span class="keyword" id="6942359">struct</span>&nbsp;<span class="op" id="6942366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942369">r</span>&nbsp;<span class="ident" id="6942371">io</span><span class="op" id="6942373">.</span><span class="ident" id="6942374">Reader</span><br>
<span class="lineno"></span><span class="op" id="6942381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6942384">func</span>&nbsp;<span class="op" id="6942389">(</span><span class="ident" id="6942390">s</span>&nbsp;<span class="op" id="6942392">*</span><span class="ident" id="6942393">slowReader</span><span class="op" id="6942403">)</span>&nbsp;<span class="ident" id="6942405">Read</span><span class="op" id="6942409">(</span><span class="ident" id="6942410">p</span>&nbsp;<span class="op" id="6942412">[</span><span class="op" id="6942413">]</span><span class="builtintype" id="6942414">byte</span><span class="op" id="6942418">)</span>&nbsp;<span class="op" id="6942420">(</span><span class="builtintype" id="6942421">int</span><span class="op" id="6942424">,</span>&nbsp;<span class="builtintype" id="6942426">error</span><span class="op" id="6942431">)</span>&nbsp;<span class="op" id="6942433">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6942436">if</span>&nbsp;<span class="builtinfunc" id="6942439">len</span><span class="op" id="6942442">(</span><span class="ident" id="6942443">p</span><span class="op" id="6942444">)</span>&nbsp;<span class="op" id="6942446">==</span>&nbsp;<span class="num" id="6942449">0</span>&nbsp;<span class="op" id="6942451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6942455">return</span>&nbsp;<span class="ident" id="6942462">s</span><span class="op" id="6942463">.</span><span class="ident" id="6942464">r</span><span class="op" id="6942465">.</span><span class="ident" id="6942466">Read</span><span class="op" id="6942470">(</span><span class="ident" id="6942471">p</span><span class="op" id="6942472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6942475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6942478">return</span>&nbsp;<span class="ident" id="6942485">s</span><span class="op" id="6942486">.</span><span class="ident" id="6942487">r</span><span class="op" id="6942488">.</span><span class="ident" id="6942489">Read</span><span class="op" id="6942493">(</span><span class="ident" id="6942494">p</span><span class="op" id="6942495">[</span><span class="op" id="6942496">:</span><span class="num" id="6942497">1</span><span class="op" id="6942498">]</span><span class="op" id="6942499">)</span><br>
<span class="lineno"></span><span class="op" id="6942501">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6942504">func</span>&nbsp;<span class="ident" id="6942509">TestLineContinuation</span><span class="op" id="6942529">(</span><span class="ident" id="6942530">t</span>&nbsp;<span class="op" id="6942532">*</span><span class="ident" id="6942533">testing</span><span class="op" id="6942540">.</span><span class="ident" id="6942541">T</span><span class="op" id="6942542">)</span>&nbsp;<span class="op" id="6942544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6942547">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6942623">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6942635">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6942702">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6942763">testBody</span>&nbsp;<span class="op" id="6942772">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6942777">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943273">r</span>&nbsp;<span class="op" id="6943275">:=</span>&nbsp;<span class="ident" id="6943278">NewReader</span><span class="op" id="6943287">(</span><span class="ident" id="6943288">strings</span><span class="op" id="6943295">.</span><span class="ident" id="6943296">NewReader</span><span class="op" id="6943305">(</span><span class="ident" id="6943306">testBody</span><span class="op" id="6943314">)</span><span class="op" id="6943315">,</span>&nbsp;<span class="string" id="6943317">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="6943341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943345">for</span>&nbsp;<span class="ident" id="6943349">i</span>&nbsp;<span class="op" id="6943351">:=</span>&nbsp;<span class="num" id="6943354">0</span><span class="op" id="6943355">;</span>&nbsp;<span class="ident" id="6943357">i</span>&nbsp;<span class="op" id="6943359">&lt;</span>&nbsp;<span class="num" id="6943361">2</span><span class="op" id="6943362">;</span>&nbsp;<span class="ident" id="6943364">i</span><span class="op" id="6943365">++</span>&nbsp;<span class="op" id="6943368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943372">part</span><span class="op" id="6943376">,</span>&nbsp;<span class="ident" id="6943378">err</span>&nbsp;<span class="op" id="6943382">:=</span>&nbsp;<span class="ident" id="6943385">r</span><span class="op" id="6943386">.</span><span class="ident" id="6943387">NextPart</span><span class="op" id="6943395">(</span><span class="op" id="6943396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943400">if</span>&nbsp;<span class="ident" id="6943403">err</span>&nbsp;<span class="op" id="6943407">!=</span>&nbsp;<span class="ident" id="6943410">nil</span>&nbsp;<span class="op" id="6943414">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943419">t</span><span class="op" id="6943420">.</span><span class="ident" id="6943421">Fatalf</span><span class="op" id="6943427">(</span><span class="string" id="6943428">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6943447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6943451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943455">var</span>&nbsp;<span class="ident" id="6943459">buf</span>&nbsp;<span class="ident" id="6943463">bytes</span><span class="op" id="6943468">.</span><span class="ident" id="6943469">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943478">n</span><span class="op" id="6943479">,</span>&nbsp;<span class="ident" id="6943481">err</span>&nbsp;<span class="op" id="6943485">:=</span>&nbsp;<span class="ident" id="6943488">io</span><span class="op" id="6943490">.</span><span class="ident" id="6943491">Copy</span><span class="op" id="6943495">(</span><span class="op" id="6943496">&amp;</span><span class="ident" id="6943497">buf</span><span class="op" id="6943500">,</span>&nbsp;<span class="ident" id="6943502">part</span><span class="op" id="6943506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943510">if</span>&nbsp;<span class="ident" id="6943513">err</span>&nbsp;<span class="op" id="6943517">!=</span>&nbsp;<span class="ident" id="6943520">nil</span>&nbsp;<span class="op" id="6943524">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943529">t</span><span class="op" id="6943530">.</span><span class="ident" id="6943531">Errorf</span><span class="op" id="6943537">(</span><span class="string" id="6943538">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="6943579">,</span>&nbsp;<span class="ident" id="6943581">err</span><span class="op" id="6943584">,</span>&nbsp;<span class="ident" id="6943586">buf</span><span class="op" id="6943589">.</span><span class="ident" id="6943590">String</span><span class="op" id="6943596">(</span><span class="op" id="6943597">)</span><span class="op" id="6943598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6943602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6943606">if</span>&nbsp;<span class="ident" id="6943609">n</span>&nbsp;<span class="op" id="6943611">&lt;=</span>&nbsp;<span class="num" id="6943614">0</span>&nbsp;<span class="op" id="6943616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943621">t</span><span class="op" id="6943622">.</span><span class="ident" id="6943623">Errorf</span><span class="op" id="6943629">(</span><span class="string" id="6943630">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="6943658">,</span>&nbsp;<span class="ident" id="6943660">n</span><span class="op" id="6943661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6943665">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6943668">}</span><br>
<span class="lineno"></span><span class="op" id="6943670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6943673">func</span>&nbsp;<span class="ident" id="6943678">TestQuotedPrintableEncoding</span><span class="op" id="6943705">(</span><span class="ident" id="6943706">t</span>&nbsp;<span class="op" id="6943708">*</span><span class="ident" id="6943709">testing</span><span class="op" id="6943716">.</span><span class="ident" id="6943717">T</span><span class="op" id="6943718">)</span>&nbsp;<span class="op" id="6943720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6943723">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6943761">body</span>&nbsp;<span class="op" id="6943766">:=</span>&nbsp;<span class="string" id="6943769">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944503">r</span>&nbsp;<span class="op" id="6944505">:=</span>&nbsp;<span class="ident" id="6944508">NewReader</span><span class="op" id="6944517">(</span><span class="ident" id="6944518">strings</span><span class="op" id="6944525">.</span><span class="ident" id="6944526">NewReader</span><span class="op" id="6944535">(</span><span class="ident" id="6944536">body</span><span class="op" id="6944540">)</span><span class="op" id="6944541">,</span>&nbsp;<span class="string" id="6944543">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="6944573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944576">part</span><span class="op" id="6944580">,</span>&nbsp;<span class="ident" id="6944582">err</span>&nbsp;<span class="op" id="6944586">:=</span>&nbsp;<span class="ident" id="6944589">r</span><span class="op" id="6944590">.</span><span class="ident" id="6944591">NextPart</span><span class="op" id="6944599">(</span><span class="op" id="6944600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944603">if</span>&nbsp;<span class="ident" id="6944606">err</span>&nbsp;<span class="op" id="6944610">!=</span>&nbsp;<span class="ident" id="6944613">nil</span>&nbsp;<span class="op" id="6944617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944621">t</span><span class="op" id="6944622">.</span><span class="ident" id="6944623">Fatal</span><span class="op" id="6944628">(</span><span class="ident" id="6944629">err</span><span class="op" id="6944632">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6944635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944638">if</span>&nbsp;<span class="ident" id="6944641">te</span><span class="op" id="6944643">,</span>&nbsp;<span class="ident" id="6944645">ok</span>&nbsp;<span class="op" id="6944648">:=</span>&nbsp;<span class="ident" id="6944651">part</span><span class="op" id="6944655">.</span><span class="ident" id="6944656">Header</span><span class="op" id="6944662">[</span><span class="string" id="6944663">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="6944690">]</span><span class="op" id="6944691">;</span>&nbsp;<span class="ident" id="6944693">ok</span>&nbsp;<span class="op" id="6944696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944700">t</span><span class="op" id="6944701">.</span><span class="ident" id="6944702">Errorf</span><span class="op" id="6944708">(</span><span class="string" id="6944709">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6944753">,</span>&nbsp;<span class="ident" id="6944755">te</span><span class="op" id="6944757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6944760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944763">var</span>&nbsp;<span class="ident" id="6944767">buf</span>&nbsp;<span class="ident" id="6944771">bytes</span><span class="op" id="6944776">.</span><span class="ident" id="6944777">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944785">_</span><span class="op" id="6944786">,</span>&nbsp;<span class="ident" id="6944788">err</span>&nbsp;<span class="op" id="6944792">=</span>&nbsp;<span class="ident" id="6944794">io</span><span class="op" id="6944796">.</span><span class="ident" id="6944797">Copy</span><span class="op" id="6944801">(</span><span class="op" id="6944802">&amp;</span><span class="ident" id="6944803">buf</span><span class="op" id="6944806">,</span>&nbsp;<span class="ident" id="6944808">part</span><span class="op" id="6944812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6944815">if</span>&nbsp;<span class="ident" id="6944818">err</span>&nbsp;<span class="op" id="6944822">!=</span>&nbsp;<span class="ident" id="6944825">nil</span>&nbsp;<span class="op" id="6944829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944833">t</span><span class="op" id="6944834">.</span><span class="ident" id="6944835">Error</span><span class="op" id="6944840">(</span><span class="ident" id="6944841">err</span><span class="op" id="6944844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6944847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944850">got</span>&nbsp;<span class="op" id="6944854">:=</span>&nbsp;<span class="ident" id="6944857">buf</span><span class="op" id="6944860">.</span><span class="ident" id="6944861">String</span><span class="op" id="6944867">(</span><span class="op" id="6944868">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6944871">want</span>&nbsp;<span class="op" id="6944876">:=</span>&nbsp;<span class="string" id="6944879">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945236">if</span>&nbsp;<span class="ident" id="6945239">got</span>&nbsp;<span class="op" id="6945243">!=</span>&nbsp;<span class="ident" id="6945246">want</span>&nbsp;<span class="op" id="6945251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945255">t</span><span class="op" id="6945256">.</span><span class="ident" id="6945257">Errorf</span><span class="op" id="6945263">(</span><span class="string" id="6945264">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="6945303">,</span>&nbsp;<span class="ident" id="6945305">got</span><span class="op" id="6945308">,</span>&nbsp;<span class="ident" id="6945310">want</span><span class="op" id="6945314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945317">}</span><br>
<span class="lineno"></span><span class="op" id="6945319">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6945322">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6945395">func</span>&nbsp;<span class="ident" id="6945400">TestNested</span><span class="op" id="6945410">(</span><span class="ident" id="6945411">t</span>&nbsp;<span class="op" id="6945413">*</span><span class="ident" id="6945414">testing</span><span class="op" id="6945421">.</span><span class="ident" id="6945422">T</span><span class="op" id="6945423">)</span>&nbsp;<span class="op" id="6945425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6945428">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6945488">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945535">f</span><span class="op" id="6945536">,</span>&nbsp;<span class="ident" id="6945538">err</span>&nbsp;<span class="op" id="6945542">:=</span>&nbsp;<span class="ident" id="6945545">os</span><span class="op" id="6945547">.</span><span class="ident" id="6945548">Open</span><span class="op" id="6945552">(</span><span class="string" id="6945553">&#34;testdata/nested-mime&#34;</span><span class="op" id="6945575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945578">if</span>&nbsp;<span class="ident" id="6945581">err</span>&nbsp;<span class="op" id="6945585">!=</span>&nbsp;<span class="ident" id="6945588">nil</span>&nbsp;<span class="op" id="6945592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945596">t</span><span class="op" id="6945597">.</span><span class="ident" id="6945598">Fatal</span><span class="op" id="6945603">(</span><span class="ident" id="6945604">err</span><span class="op" id="6945607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945613">defer</span>&nbsp;<span class="ident" id="6945619">f</span><span class="op" id="6945620">.</span><span class="ident" id="6945621">Close</span><span class="op" id="6945626">(</span><span class="op" id="6945627">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945630">mr</span>&nbsp;<span class="op" id="6945633">:=</span>&nbsp;<span class="ident" id="6945636">NewReader</span><span class="op" id="6945645">(</span><span class="ident" id="6945646">f</span><span class="op" id="6945647">,</span>&nbsp;<span class="string" id="6945649">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="6945679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945682">p</span><span class="op" id="6945683">,</span>&nbsp;<span class="ident" id="6945685">err</span>&nbsp;<span class="op" id="6945689">:=</span>&nbsp;<span class="ident" id="6945692">mr</span><span class="op" id="6945694">.</span><span class="ident" id="6945695">NextPart</span><span class="op" id="6945703">(</span><span class="op" id="6945704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945707">if</span>&nbsp;<span class="ident" id="6945710">err</span>&nbsp;<span class="op" id="6945714">!=</span>&nbsp;<span class="ident" id="6945717">nil</span>&nbsp;<span class="op" id="6945721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945725">t</span><span class="op" id="6945726">.</span><span class="ident" id="6945727">Fatalf</span><span class="op" id="6945733">(</span><span class="string" id="6945734">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="6945781">,</span>&nbsp;<span class="ident" id="6945783">err</span><span class="op" id="6945786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6945789">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6945793">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945876">mr2</span>&nbsp;<span class="op" id="6945880">:=</span>&nbsp;<span class="ident" id="6945883">NewReader</span><span class="op" id="6945892">(</span><span class="ident" id="6945893">p</span><span class="op" id="6945894">,</span>&nbsp;<span class="string" id="6945896">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="6945926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945929">p</span><span class="op" id="6945930">,</span>&nbsp;<span class="ident" id="6945932">err</span>&nbsp;<span class="op" id="6945936">=</span>&nbsp;<span class="ident" id="6945938">mr2</span><span class="op" id="6945941">.</span><span class="ident" id="6945942">NextPart</span><span class="op" id="6945950">(</span><span class="op" id="6945951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6945954">if</span>&nbsp;<span class="ident" id="6945957">err</span>&nbsp;<span class="op" id="6945961">!=</span>&nbsp;<span class="ident" id="6945964">nil</span>&nbsp;<span class="op" id="6945968">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6945972">t</span><span class="op" id="6945973">.</span><span class="ident" id="6945974">Fatalf</span><span class="op" id="6945980">(</span><span class="string" id="6945981">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6946010">,</span>&nbsp;<span class="ident" id="6946012">err</span><span class="op" id="6946015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946021">if</span>&nbsp;<span class="ident" id="6946024">b</span><span class="op" id="6946025">,</span>&nbsp;<span class="ident" id="6946027">err</span>&nbsp;<span class="op" id="6946031">:=</span>&nbsp;<span class="ident" id="6946034">ioutil</span><span class="op" id="6946040">.</span><span class="ident" id="6946041">ReadAll</span><span class="op" id="6946048">(</span><span class="ident" id="6946049">p</span><span class="op" id="6946050">)</span><span class="op" id="6946051">;</span>&nbsp;<span class="builtintype" id="6946053">string</span><span class="op" id="6946059">(</span><span class="ident" id="6946060">b</span><span class="op" id="6946061">)</span>&nbsp;<span class="op" id="6946063">!=</span>&nbsp;<span class="string" id="6946066">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="6946079">||</span>&nbsp;<span class="ident" id="6946082">err</span>&nbsp;<span class="op" id="6946086">!=</span>&nbsp;<span class="ident" id="6946089">nil</span>&nbsp;<span class="op" id="6946093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946097">t</span><span class="op" id="6946098">.</span><span class="ident" id="6946099">Fatalf</span><span class="op" id="6946105">(</span><span class="string" id="6946106">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6946143">,</span>&nbsp;<span class="ident" id="6946145">b</span><span class="op" id="6946146">,</span>&nbsp;<span class="ident" id="6946148">err</span><span class="op" id="6946151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946154">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946157">p</span><span class="op" id="6946158">,</span>&nbsp;<span class="ident" id="6946160">err</span>&nbsp;<span class="op" id="6946164">=</span>&nbsp;<span class="ident" id="6946166">mr2</span><span class="op" id="6946169">.</span><span class="ident" id="6946170">NextPart</span><span class="op" id="6946178">(</span><span class="op" id="6946179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946182">if</span>&nbsp;<span class="ident" id="6946185">err</span>&nbsp;<span class="op" id="6946189">!=</span>&nbsp;<span class="ident" id="6946192">nil</span>&nbsp;<span class="op" id="6946196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946200">t</span><span class="op" id="6946201">.</span><span class="ident" id="6946202">Fatalf</span><span class="op" id="6946208">(</span><span class="string" id="6946209">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6946237">,</span>&nbsp;<span class="ident" id="6946239">err</span><span class="op" id="6946242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946248">if</span>&nbsp;<span class="ident" id="6946251">b</span><span class="op" id="6946252">,</span>&nbsp;<span class="ident" id="6946254">err</span>&nbsp;<span class="op" id="6946258">:=</span>&nbsp;<span class="ident" id="6946261">ioutil</span><span class="op" id="6946267">.</span><span class="ident" id="6946268">ReadAll</span><span class="op" id="6946275">(</span><span class="ident" id="6946276">p</span><span class="op" id="6946277">)</span><span class="op" id="6946278">;</span>&nbsp;<span class="builtintype" id="6946280">string</span><span class="op" id="6946286">(</span><span class="ident" id="6946287">b</span><span class="op" id="6946288">)</span>&nbsp;<span class="op" id="6946290">!=</span>&nbsp;<span class="string" id="6946293">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="6946311">||</span>&nbsp;<span class="ident" id="6946314">err</span>&nbsp;<span class="op" id="6946318">!=</span>&nbsp;<span class="ident" id="6946321">nil</span>&nbsp;<span class="op" id="6946325">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946329">t</span><span class="op" id="6946330">.</span><span class="ident" id="6946331">Fatalf</span><span class="op" id="6946337">(</span><span class="string" id="6946338">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6946374">,</span>&nbsp;<span class="ident" id="6946376">b</span><span class="op" id="6946377">,</span>&nbsp;<span class="ident" id="6946379">err</span><span class="op" id="6946382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946389">p</span><span class="op" id="6946390">,</span>&nbsp;<span class="ident" id="6946392">err</span>&nbsp;<span class="op" id="6946396">=</span>&nbsp;<span class="ident" id="6946398">mr2</span><span class="op" id="6946401">.</span><span class="ident" id="6946402">NextPart</span><span class="op" id="6946410">(</span><span class="op" id="6946411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946414">if</span>&nbsp;<span class="ident" id="6946417">err</span>&nbsp;<span class="op" id="6946421">!=</span>&nbsp;<span class="ident" id="6946424">io</span><span class="op" id="6946426">.</span><span class="ident" id="6946427">EOF</span>&nbsp;<span class="op" id="6946431">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946435">t</span><span class="op" id="6946436">.</span><span class="ident" id="6946437">Fatalf</span><span class="op" id="6946443">(</span><span class="string" id="6946444">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6946484">,</span>&nbsp;<span class="ident" id="6946486">err</span><span class="op" id="6946489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6946496">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946565">_</span><span class="op" id="6946566">,</span>&nbsp;<span class="ident" id="6946568">err</span>&nbsp;<span class="op" id="6946572">=</span>&nbsp;<span class="ident" id="6946574">mr</span><span class="op" id="6946576">.</span><span class="ident" id="6946577">NextPart</span><span class="op" id="6946585">(</span><span class="op" id="6946586">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946589">if</span>&nbsp;<span class="ident" id="6946592">err</span>&nbsp;<span class="op" id="6946596">!=</span>&nbsp;<span class="ident" id="6946599">nil</span>&nbsp;<span class="op" id="6946603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946607">t</span><span class="op" id="6946608">.</span><span class="ident" id="6946609">Fatalf</span><span class="op" id="6946615">(</span><span class="string" id="6946616">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="6946667">,</span>&nbsp;<span class="ident" id="6946669">err</span><span class="op" id="6946672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946679">_</span><span class="op" id="6946680">,</span>&nbsp;<span class="ident" id="6946682">err</span>&nbsp;<span class="op" id="6946686">=</span>&nbsp;<span class="ident" id="6946688">mr</span><span class="op" id="6946690">.</span><span class="ident" id="6946691">NextPart</span><span class="op" id="6946699">(</span><span class="op" id="6946700">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946703">if</span>&nbsp;<span class="ident" id="6946706">err</span>&nbsp;<span class="op" id="6946710">!=</span>&nbsp;<span class="ident" id="6946713">io</span><span class="op" id="6946715">.</span><span class="ident" id="6946716">EOF</span>&nbsp;<span class="op" id="6946720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946724">t</span><span class="op" id="6946725">.</span><span class="ident" id="6946726">Fatalf</span><span class="op" id="6946732">(</span><span class="string" id="6946733">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6946773">,</span>&nbsp;<span class="ident" id="6946775">err</span><span class="op" id="6946778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6946781">}</span><br>
<span class="lineno"></span><span class="op" id="6946783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="6946786">type</span>&nbsp;<span class="ident" id="6946791">headerBody</span>&nbsp;<span class="keyword" id="6946802">struct</span>&nbsp;<span class="op" id="6946809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946812">header</span>&nbsp;<span class="ident" id="6946819">textproto</span><span class="op" id="6946828">.</span><span class="ident" id="6946829">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946841">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6946848">string</span><br>
<span class="lineno"></span><span class="op" id="6946855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6946858">func</span>&nbsp;<span class="ident" id="6946863">formData</span><span class="op" id="6946871">(</span><span class="ident" id="6946872">key</span><span class="op" id="6946875">,</span>&nbsp;<span class="ident" id="6946877">value</span>&nbsp;<span class="builtintype" id="6946883">string</span><span class="op" id="6946889">)</span>&nbsp;<span class="ident" id="6946891">headerBody</span>&nbsp;<span class="op" id="6946902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6946905">return</span>&nbsp;<span class="ident" id="6946912">headerBody</span><span class="op" id="6946922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6946926">textproto</span><span class="op" id="6946935">.</span><span class="ident" id="6946936">MIMEHeader</span><span class="op" id="6946946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6946951">&#34;Content-Type&#34;</span><span class="op" id="6946965">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6946974">{</span><span class="string" id="6946975">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="6947007">}</span><span class="op" id="6947008">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6947013">&#34;Content-Disposition&#34;</span><span class="op" id="6947034">:</span>&nbsp;<span class="op" id="6947036">{</span><span class="string" id="6947037">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="6947056">+</span>&nbsp;<span class="ident" id="6947058">key</span><span class="op" id="6947061">}</span><span class="op" id="6947062">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947066">}</span><span class="op" id="6947067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947071">value</span><span class="op" id="6947076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947079">}</span><br>
<span class="lineno"></span><span class="op" id="6947081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="6947084">type</span>&nbsp;<span class="ident" id="6947089">parseTest</span>&nbsp;<span class="keyword" id="6947099">struct</span>&nbsp;<span class="op" id="6947106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947109">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6947117">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947125">in</span><span class="op" id="6947127">,</span>&nbsp;<span class="ident" id="6947129">sep</span>&nbsp;<span class="builtintype" id="6947133">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947141">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6947149">[</span><span class="op" id="6947150">]</span><span class="ident" id="6947151">headerBody</span><br>
<span class="lineno"></span><span class="op" id="6947162">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6947165">var</span>&nbsp;<span class="ident" id="6947169">parseTests</span>&nbsp;<span class="op" id="6947180">=</span>&nbsp;<span class="op" id="6947182">[</span><span class="op" id="6947183">]</span><span class="ident" id="6947184">parseTest</span><span class="op" id="6947193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947196">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947266">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947335">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947401">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947464">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6947530">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6947593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947597">name</span><span class="op" id="6947601">:</span>&nbsp;<span class="string" id="6947603">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="6947620">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947624">sep</span><span class="op" id="6947627">:</span>&nbsp;&nbsp;<span class="string" id="6947630">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="6947660">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6947664">in</span><span class="op" id="6947666">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6947670">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="6949578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949582">want</span><span class="op" id="6949586">:</span>&nbsp;<span class="op" id="6949588">[</span><span class="op" id="6949589">]</span><span class="ident" id="6949590">headerBody</span><span class="op" id="6949600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949605">formData</span><span class="op" id="6949613">(</span><span class="string" id="6949614">&#34;otherEmpty1&#34;</span><span class="op" id="6949627">,</span>&nbsp;<span class="string" id="6949629">&#34;&#34;</span><span class="op" id="6949631">)</span><span class="op" id="6949632">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949637">formData</span><span class="op" id="6949645">(</span><span class="string" id="6949646">&#34;otherFoo1&#34;</span><span class="op" id="6949657">,</span>&nbsp;<span class="string" id="6949659">&#34;foo&#34;</span><span class="op" id="6949664">)</span><span class="op" id="6949665">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949670">formData</span><span class="op" id="6949678">(</span><span class="string" id="6949679">&#34;otherFoo2&#34;</span><span class="op" id="6949690">,</span>&nbsp;<span class="string" id="6949692">&#34;foo&#34;</span><span class="op" id="6949697">)</span><span class="op" id="6949698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949703">formData</span><span class="op" id="6949711">(</span><span class="string" id="6949712">&#34;otherEmpty2&#34;</span><span class="op" id="6949725">,</span>&nbsp;<span class="string" id="6949727">&#34;&#34;</span><span class="op" id="6949729">)</span><span class="op" id="6949730">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949735">formData</span><span class="op" id="6949743">(</span><span class="string" id="6949744">&#34;otherRepeatFoo&#34;</span><span class="op" id="6949760">,</span>&nbsp;<span class="string" id="6949762">&#34;foo&#34;</span><span class="op" id="6949767">)</span><span class="op" id="6949768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949773">formData</span><span class="op" id="6949781">(</span><span class="string" id="6949782">&#34;otherRepeatFoo&#34;</span><span class="op" id="6949798">,</span>&nbsp;<span class="string" id="6949800">&#34;foo&#34;</span><span class="op" id="6949805">)</span><span class="op" id="6949806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949811">formData</span><span class="op" id="6949819">(</span><span class="string" id="6949820">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6949838">,</span>&nbsp;<span class="string" id="6949840">&#34;&#34;</span><span class="op" id="6949842">)</span><span class="op" id="6949843">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949848">formData</span><span class="op" id="6949856">(</span><span class="string" id="6949857">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6949875">,</span>&nbsp;<span class="string" id="6949877">&#34;&#34;</span><span class="op" id="6949879">)</span><span class="op" id="6949880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6949885">formData</span><span class="op" id="6949893">(</span><span class="string" id="6949894">&#34;submit&#34;</span><span class="op" id="6949902">,</span>&nbsp;<span class="string" id="6949904">&#34;Submit&#34;</span><span class="op" id="6949912">)</span><span class="op" id="6949913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6949918">{</span><span class="ident" id="6949919">textproto</span><span class="op" id="6949928">.</span><span class="ident" id="6949929">MIMEHeader</span><span class="op" id="6949939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6949945">&#34;Content-Type&#34;</span><span class="op" id="6949959">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6949968">{</span><span class="string" id="6949969">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="6950185">}</span><span class="op" id="6950186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6950192">&#34;Content-Disposition&#34;</span><span class="op" id="6950213">:</span>&nbsp;<span class="op" id="6950215">{</span><span class="string" id="6950216">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="6950261">}</span><span class="op" id="6950262">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950267">}</span><span class="op" id="6950268">,</span>&nbsp;<span class="string" id="6950270">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="6950517">}</span><span class="op" id="6950518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950522">}</span><span class="op" id="6950523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950526">}</span><span class="op" id="6950527">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6950531">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950607">name</span><span class="op" id="6950611">:</span>&nbsp;<span class="string" id="6950613">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="6950644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950648">sep</span><span class="op" id="6950651">:</span>&nbsp;&nbsp;<span class="string" id="6950654">&#34;abc&#34;</span><span class="op" id="6950659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950663">in</span><span class="op" id="6950665">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6950669">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="6950703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950707">want</span><span class="op" id="6950711">:</span>&nbsp;<span class="op" id="6950713">[</span><span class="op" id="6950714">]</span><span class="ident" id="6950715">headerBody</span><span class="op" id="6950725">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950730">{</span><span class="ident" id="6950731">textproto</span><span class="op" id="6950740">.</span><span class="ident" id="6950741">MIMEHeader</span><span class="op" id="6950751">{</span><span class="string" id="6950752">&#34;Foo&#34;</span><span class="op" id="6950757">:</span>&nbsp;<span class="op" id="6950759">{</span><span class="string" id="6950760">&#34;bar&#34;</span><span class="op" id="6950765">}</span><span class="op" id="6950766">}</span><span class="op" id="6950767">,</span>&nbsp;<span class="string" id="6950769">&#34;&#34;</span><span class="op" id="6950771">}</span><span class="op" id="6950772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950776">}</span><span class="op" id="6950777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950780">}</span><span class="op" id="6950781">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6950785">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950865">name</span><span class="op" id="6950869">:</span>&nbsp;<span class="string" id="6950871">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="6950906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950910">sep</span><span class="op" id="6950913">:</span>&nbsp;&nbsp;<span class="string" id="6950916">&#34;abc&#34;</span><span class="op" id="6950921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950925">in</span><span class="op" id="6950927">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6950931">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="6950969">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6950973">want</span><span class="op" id="6950977">:</span>&nbsp;<span class="op" id="6950979">[</span><span class="op" id="6950980">]</span><span class="ident" id="6950981">headerBody</span><span class="op" id="6950991">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6950996">{</span><span class="ident" id="6950997">textproto</span><span class="op" id="6951006">.</span><span class="ident" id="6951007">MIMEHeader</span><span class="op" id="6951017">{</span><span class="string" id="6951018">&#34;Foo&#34;</span><span class="op" id="6951023">:</span>&nbsp;<span class="op" id="6951025">{</span><span class="string" id="6951026">&#34;bar&#34;</span><span class="op" id="6951031">}</span><span class="op" id="6951032">}</span><span class="op" id="6951033">,</span>&nbsp;<span class="string" id="6951035">&#34;&#34;</span><span class="op" id="6951037">}</span><span class="op" id="6951038">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951042">}</span><span class="op" id="6951043">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951046">}</span><span class="op" id="6951047">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6951051">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951077">name</span><span class="op" id="6951081">:</span>&nbsp;<span class="string" id="6951083">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="6951101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951105">sep</span><span class="op" id="6951108">:</span>&nbsp;&nbsp;<span class="string" id="6951111">&#34;abc&#34;</span><span class="op" id="6951116">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951120">in</span><span class="op" id="6951122">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6951126">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="6951187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951191">want</span><span class="op" id="6951195">:</span>&nbsp;<span class="op" id="6951197">[</span><span class="op" id="6951198">]</span><span class="ident" id="6951199">headerBody</span><span class="op" id="6951209">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951214">{</span><span class="ident" id="6951215">textproto</span><span class="op" id="6951224">.</span><span class="ident" id="6951225">MIMEHeader</span><span class="op" id="6951235">{</span><span class="string" id="6951236">&#34;Foo&#34;</span><span class="op" id="6951241">:</span>&nbsp;<span class="op" id="6951243">{</span><span class="string" id="6951244">&#34;bar&#34;</span><span class="op" id="6951249">}</span><span class="op" id="6951250">}</span><span class="op" id="6951251">,</span>&nbsp;<span class="string" id="6951253">&#34;&#34;</span><span class="op" id="6951255">}</span><span class="op" id="6951256">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951261">{</span><span class="ident" id="6951262">textproto</span><span class="op" id="6951271">.</span><span class="ident" id="6951272">MIMEHeader</span><span class="op" id="6951282">{</span><span class="string" id="6951283">&#34;Foo2&#34;</span><span class="op" id="6951289">:</span>&nbsp;<span class="op" id="6951291">{</span><span class="string" id="6951292">&#34;bar2&#34;</span><span class="op" id="6951298">}</span><span class="op" id="6951299">}</span><span class="op" id="6951300">,</span>&nbsp;<span class="string" id="6951302">&#34;&#34;</span><span class="op" id="6951304">}</span><span class="op" id="6951305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951309">}</span><span class="op" id="6951310">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951313">}</span><span class="op" id="6951314">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6951318">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951380">name</span><span class="op" id="6951384">:</span>&nbsp;<span class="string" id="6951386">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="6951414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951418">sep</span><span class="op" id="6951421">:</span>&nbsp;&nbsp;<span class="string" id="6951424">&#34;abc&#34;</span><span class="op" id="6951429">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951433">in</span><span class="op" id="6951435">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6951439">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="6951477">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951481">want</span><span class="op" id="6951485">:</span>&nbsp;<span class="op" id="6951487">[</span><span class="op" id="6951488">]</span><span class="ident" id="6951489">headerBody</span><span class="op" id="6951499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951504">{</span><span class="ident" id="6951505">textproto</span><span class="op" id="6951514">.</span><span class="ident" id="6951515">MIMEHeader</span><span class="op" id="6951525">{</span><span class="string" id="6951526">&#34;Foo&#34;</span><span class="op" id="6951531">:</span>&nbsp;<span class="op" id="6951533">{</span><span class="string" id="6951534">&#34;bar&#34;</span><span class="op" id="6951539">}</span><span class="op" id="6951540">}</span><span class="op" id="6951541">,</span>&nbsp;<span class="string" id="6951543">&#34;&#34;</span><span class="op" id="6951545">}</span><span class="op" id="6951546">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951550">}</span><span class="op" id="6951551">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951554">}</span><span class="op" id="6951555">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6951559">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951623">name</span><span class="op" id="6951627">:</span>&nbsp;<span class="string" id="6951629">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="6951657">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951661">sep</span><span class="op" id="6951664">:</span>&nbsp;&nbsp;<span class="string" id="6951667">&#34;abc&#34;</span><span class="op" id="6951672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951676">in</span><span class="op" id="6951678">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6951682">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="6951719">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951723">want</span><span class="op" id="6951727">:</span>&nbsp;<span class="op" id="6951729">[</span><span class="op" id="6951730">]</span><span class="ident" id="6951731">headerBody</span><span class="op" id="6951741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951746">{</span><span class="ident" id="6951747">textproto</span><span class="op" id="6951756">.</span><span class="ident" id="6951757">MIMEHeader</span><span class="op" id="6951767">{</span><span class="string" id="6951768">&#34;Foo&#34;</span><span class="op" id="6951773">:</span>&nbsp;<span class="op" id="6951775">{</span><span class="string" id="6951776">&#34;bar&#34;</span><span class="op" id="6951781">}</span><span class="op" id="6951782">}</span><span class="op" id="6951783">,</span>&nbsp;<span class="string" id="6951785">&#34;&#34;</span><span class="op" id="6951787">}</span><span class="op" id="6951788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951792">}</span><span class="op" id="6951793">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951796">}</span><span class="op" id="6951797">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6951801">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6951850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951854">name</span><span class="op" id="6951858">:</span>&nbsp;<span class="string" id="6951860">&#34;no&nbsp;parts&#34;</span><span class="op" id="6951870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951874">sep</span><span class="op" id="6951877">:</span>&nbsp;&nbsp;<span class="string" id="6951880">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="6951920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951924">in</span><span class="op" id="6951926">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6951930">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="6951978">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6951982">want</span><span class="op" id="6951986">:</span>&nbsp;<span class="op" id="6951988">[</span><span class="op" id="6951989">]</span><span class="ident" id="6951990">headerBody</span><span class="op" id="6952000">{</span><span class="op" id="6952001">}</span><span class="op" id="6952002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952005">}</span><span class="op" id="6952006">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6952010">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952091">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952095">name</span><span class="op" id="6952099">:</span>&nbsp;<span class="string" id="6952101">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="6952125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952129">sep</span><span class="op" id="6952132">:</span>&nbsp;&nbsp;<span class="string" id="6952135">&#34;sep&#34;</span><span class="op" id="6952140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952144">in</span><span class="op" id="6952146">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6952150">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="6952197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952201">want</span><span class="op" id="6952205">:</span>&nbsp;<span class="op" id="6952207">[</span><span class="op" id="6952208">]</span><span class="ident" id="6952209">headerBody</span><span class="op" id="6952219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952224">{</span><span class="ident" id="6952225">textproto</span><span class="op" id="6952234">.</span><span class="ident" id="6952235">MIMEHeader</span><span class="op" id="6952245">{</span><span class="string" id="6952246">&#34;Foo&#34;</span><span class="op" id="6952251">:</span>&nbsp;<span class="op" id="6952253">{</span><span class="string" id="6952254">&#34;bar&#34;</span><span class="op" id="6952259">}</span><span class="op" id="6952260">}</span><span class="op" id="6952261">,</span>&nbsp;<span class="string" id="6952263">&#34;--sepFAKE&#34;</span><span class="op" id="6952274">}</span><span class="op" id="6952275">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952279">}</span><span class="op" id="6952280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952283">}</span><span class="op" id="6952284">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6952288">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952349">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952353">name</span><span class="op" id="6952357">:</span>&nbsp;<span class="string" id="6952359">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="6952385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952389">sep</span><span class="op" id="6952392">:</span>&nbsp;&nbsp;<span class="string" id="6952395">&#34;sep&#34;</span><span class="op" id="6952400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952404">in</span><span class="op" id="6952406">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6952410">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="6952453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952457">want</span><span class="op" id="6952461">:</span>&nbsp;<span class="op" id="6952463">[</span><span class="op" id="6952464">]</span><span class="ident" id="6952465">headerBody</span><span class="op" id="6952475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952480">{</span><span class="ident" id="6952481">textproto</span><span class="op" id="6952490">.</span><span class="ident" id="6952491">MIMEHeader</span><span class="op" id="6952501">{</span><span class="string" id="6952502">&#34;Foo&#34;</span><span class="op" id="6952507">:</span>&nbsp;<span class="op" id="6952509">{</span><span class="string" id="6952510">&#34;bar&#34;</span><span class="op" id="6952515">}</span><span class="op" id="6952516">}</span><span class="op" id="6952517">,</span>&nbsp;<span class="string" id="6952519">&#34;text&#34;</span><span class="op" id="6952525">}</span><span class="op" id="6952526">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952530">}</span><span class="op" id="6952531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952534">}</span><span class="op" id="6952535">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6952539">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952570">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952574">name</span><span class="op" id="6952578">:</span>&nbsp;<span class="string" id="6952580">&#34;leading&nbsp;line&#34;</span><span class="op" id="6952594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952598">sep</span><span class="op" id="6952601">:</span>&nbsp;&nbsp;<span class="string" id="6952604">&#34;MyBoundary&#34;</span><span class="op" id="6952616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952620">in</span><span class="op" id="6952622">:</span>&nbsp;<span class="ident" id="6952624">strings</span><span class="op" id="6952631">.</span><span class="ident" id="6952632">Replace</span><span class="op" id="6952639">(</span><span class="string" id="6952640">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="6952733">,</span>&nbsp;<span class="string" id="6952735">&#34;\n&#34;</span><span class="op" id="6952739">,</span>&nbsp;<span class="string" id="6952741">&#34;\r\n&#34;</span><span class="op" id="6952747">,</span>&nbsp;<span class="op" id="6952749">-</span><span class="num" id="6952750">1</span><span class="op" id="6952751">)</span><span class="op" id="6952752">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952756">want</span><span class="op" id="6952760">:</span>&nbsp;<span class="op" id="6952762">[</span><span class="op" id="6952763">]</span><span class="ident" id="6952764">headerBody</span><span class="op" id="6952774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952779">{</span><span class="ident" id="6952780">textproto</span><span class="op" id="6952789">.</span><span class="ident" id="6952790">MIMEHeader</span><span class="op" id="6952800">{</span><span class="string" id="6952801">&#34;Foo&#34;</span><span class="op" id="6952806">:</span>&nbsp;<span class="op" id="6952808">{</span><span class="string" id="6952809">&#34;bar&#34;</span><span class="op" id="6952814">}</span><span class="op" id="6952815">}</span><span class="op" id="6952816">,</span>&nbsp;<span class="string" id="6952818">&#34;&#34;</span><span class="op" id="6952820">}</span><span class="op" id="6952821">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952825">}</span><span class="op" id="6952826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6952829">}</span><span class="op" id="6952830">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952834">roundTripParseTest</span><span class="op" id="6952852">(</span><span class="op" id="6952853">)</span><span class="op" id="6952854">,</span><br>
<span class="lineno"></span><span class="op" id="6952856">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="6952859">func</span>&nbsp;<span class="ident" id="6952864">TestParse</span><span class="op" id="6952873">(</span><span class="ident" id="6952874">t</span>&nbsp;<span class="op" id="6952876">*</span><span class="ident" id="6952877">testing</span><span class="op" id="6952884">.</span><span class="ident" id="6952885">T</span><span class="op" id="6952886">)</span>&nbsp;<span class="op" id="6952888">{</span><br>
<span class="lineno"></span><span class="ident" id="6952890">Cases</span><span class="op" id="6952895">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6952898">for</span>&nbsp;<span class="ident" id="6952902">_</span><span class="op" id="6952903">,</span>&nbsp;<span class="ident" id="6952905">tt</span>&nbsp;<span class="op" id="6952908">:=</span>&nbsp;<span class="keyword" id="6952911">range</span>&nbsp;<span class="ident" id="6952917">parseTests</span>&nbsp;<span class="op" id="6952928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952932">r</span>&nbsp;<span class="op" id="6952934">:=</span>&nbsp;<span class="ident" id="6952937">NewReader</span><span class="op" id="6952946">(</span><span class="ident" id="6952947">strings</span><span class="op" id="6952954">.</span><span class="ident" id="6952955">NewReader</span><span class="op" id="6952964">(</span><span class="ident" id="6952965">tt</span><span class="op" id="6952967">.</span><span class="ident" id="6952968">in</span><span class="op" id="6952970">)</span><span class="op" id="6952971">,</span>&nbsp;<span class="ident" id="6952973">tt</span><span class="op" id="6952975">.</span><span class="ident" id="6952976">sep</span><span class="op" id="6952979">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6952983">got</span>&nbsp;<span class="op" id="6952987">:=</span>&nbsp;<span class="op" id="6952990">[</span><span class="op" id="6952991">]</span><span class="ident" id="6952992">headerBody</span><span class="op" id="6953002">{</span><span class="op" id="6953003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953007">for</span>&nbsp;<span class="op" id="6953011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953016">p</span><span class="op" id="6953017">,</span>&nbsp;<span class="ident" id="6953019">err</span>&nbsp;<span class="op" id="6953023">:=</span>&nbsp;<span class="ident" id="6953026">r</span><span class="op" id="6953027">.</span><span class="ident" id="6953028">NextPart</span><span class="op" id="6953036">(</span><span class="op" id="6953037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953042">if</span>&nbsp;<span class="ident" id="6953045">err</span>&nbsp;<span class="op" id="6953049">==</span>&nbsp;<span class="ident" id="6953052">io</span><span class="op" id="6953054">.</span><span class="ident" id="6953055">EOF</span>&nbsp;<span class="op" id="6953059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953065">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953079">if</span>&nbsp;<span class="ident" id="6953082">err</span>&nbsp;<span class="op" id="6953086">!=</span>&nbsp;<span class="ident" id="6953089">nil</span>&nbsp;<span class="op" id="6953093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953099">t</span><span class="op" id="6953100">.</span><span class="ident" id="6953101">Errorf</span><span class="op" id="6953107">(</span><span class="string" id="6953108">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="6953134">,</span>&nbsp;<span class="ident" id="6953136">tt</span><span class="op" id="6953138">.</span><span class="ident" id="6953139">name</span><span class="op" id="6953143">,</span>&nbsp;<span class="ident" id="6953145">err</span><span class="op" id="6953148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953154">continue</span>&nbsp;<span class="ident" id="6953163">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953172">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953177">pbody</span><span class="op" id="6953182">,</span>&nbsp;<span class="ident" id="6953184">err</span>&nbsp;<span class="op" id="6953188">:=</span>&nbsp;<span class="ident" id="6953191">ioutil</span><span class="op" id="6953197">.</span><span class="ident" id="6953198">ReadAll</span><span class="op" id="6953205">(</span><span class="ident" id="6953206">p</span><span class="op" id="6953207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953212">if</span>&nbsp;<span class="ident" id="6953215">err</span>&nbsp;<span class="op" id="6953219">!=</span>&nbsp;<span class="ident" id="6953222">nil</span>&nbsp;<span class="op" id="6953226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953232">t</span><span class="op" id="6953233">.</span><span class="ident" id="6953234">Errorf</span><span class="op" id="6953240">(</span><span class="string" id="6953241">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6953277">,</span>&nbsp;<span class="ident" id="6953279">tt</span><span class="op" id="6953281">.</span><span class="ident" id="6953282">name</span><span class="op" id="6953286">,</span>&nbsp;<span class="ident" id="6953288">err</span><span class="op" id="6953291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953297">continue</span>&nbsp;<span class="ident" id="6953306">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953315">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953320">got</span>&nbsp;<span class="op" id="6953324">=</span>&nbsp;<span class="builtinfunc" id="6953326">append</span><span class="op" id="6953332">(</span><span class="ident" id="6953333">got</span><span class="op" id="6953336">,</span>&nbsp;<span class="ident" id="6953338">headerBody</span><span class="op" id="6953348">{</span><span class="ident" id="6953349">p</span><span class="op" id="6953350">.</span><span class="ident" id="6953351">Header</span><span class="op" id="6953357">,</span>&nbsp;<span class="builtintype" id="6953359">string</span><span class="op" id="6953365">(</span><span class="ident" id="6953366">pbody</span><span class="op" id="6953371">)</span><span class="op" id="6953372">}</span><span class="op" id="6953373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953381">if</span>&nbsp;<span class="op" id="6953384">!</span><span class="ident" id="6953385">reflect</span><span class="op" id="6953392">.</span><span class="ident" id="6953393">DeepEqual</span><span class="op" id="6953402">(</span><span class="ident" id="6953403">tt</span><span class="op" id="6953405">.</span><span class="ident" id="6953406">want</span><span class="op" id="6953410">,</span>&nbsp;<span class="ident" id="6953412">got</span><span class="op" id="6953415">)</span>&nbsp;<span class="op" id="6953417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953422">t</span><span class="op" id="6953423">.</span><span class="ident" id="6953424">Errorf</span><span class="op" id="6953430">(</span><span class="string" id="6953431">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6953461">,</span>&nbsp;<span class="ident" id="6953463">tt</span><span class="op" id="6953465">.</span><span class="ident" id="6953466">name</span><span class="op" id="6953470">,</span>&nbsp;<span class="ident" id="6953472">got</span><span class="op" id="6953475">,</span>&nbsp;<span class="ident" id="6953477">tt</span><span class="op" id="6953479">.</span><span class="ident" id="6953480">want</span><span class="op" id="6953484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953489">if</span>&nbsp;<span class="builtinfunc" id="6953492">len</span><span class="op" id="6953495">(</span><span class="ident" id="6953496">tt</span><span class="op" id="6953498">.</span><span class="ident" id="6953499">want</span><span class="op" id="6953503">)</span>&nbsp;<span class="op" id="6953505">!=</span>&nbsp;<span class="builtinfunc" id="6953508">len</span><span class="op" id="6953511">(</span><span class="ident" id="6953512">got</span><span class="op" id="6953515">)</span>&nbsp;<span class="op" id="6953517">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953523">t</span><span class="op" id="6953524">.</span><span class="ident" id="6953525">Errorf</span><span class="op" id="6953531">(</span><span class="string" id="6953532">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6953564">,</span>&nbsp;<span class="ident" id="6953566">tt</span><span class="op" id="6953568">.</span><span class="ident" id="6953569">name</span><span class="op" id="6953573">,</span>&nbsp;<span class="builtinfunc" id="6953575">len</span><span class="op" id="6953578">(</span><span class="ident" id="6953579">got</span><span class="op" id="6953582">)</span><span class="op" id="6953583">,</span>&nbsp;<span class="builtinfunc" id="6953585">len</span><span class="op" id="6953588">(</span><span class="ident" id="6953589">tt</span><span class="op" id="6953591">.</span><span class="ident" id="6953592">want</span><span class="op" id="6953596">)</span><span class="op" id="6953597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953602">}</span>&nbsp;<span class="keyword" id="6953604">else</span>&nbsp;<span class="keyword" id="6953609">if</span>&nbsp;<span class="builtinfunc" id="6953612">len</span><span class="op" id="6953615">(</span><span class="ident" id="6953616">got</span><span class="op" id="6953619">)</span>&nbsp;<span class="op" id="6953621">&gt;</span>&nbsp;<span class="num" id="6953623">1</span>&nbsp;<span class="op" id="6953625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953631">for</span>&nbsp;<span class="ident" id="6953635">pi</span><span class="op" id="6953637">,</span>&nbsp;<span class="ident" id="6953639">wantPart</span>&nbsp;<span class="op" id="6953648">:=</span>&nbsp;<span class="keyword" id="6953651">range</span>&nbsp;<span class="ident" id="6953657">tt</span><span class="op" id="6953659">.</span><span class="ident" id="6953660">want</span>&nbsp;<span class="op" id="6953665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6953672">if</span>&nbsp;<span class="op" id="6953675">!</span><span class="ident" id="6953676">reflect</span><span class="op" id="6953683">.</span><span class="ident" id="6953684">DeepEqual</span><span class="op" id="6953693">(</span><span class="ident" id="6953694">wantPart</span><span class="op" id="6953702">,</span>&nbsp;<span class="ident" id="6953704">got</span><span class="op" id="6953707">[</span><span class="ident" id="6953708">pi</span><span class="op" id="6953710">]</span><span class="op" id="6953711">)</span>&nbsp;<span class="op" id="6953713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953721">t</span><span class="op" id="6953722">.</span><span class="ident" id="6953723">Errorf</span><span class="op" id="6953729">(</span><span class="string" id="6953730">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6953769">,</span>&nbsp;<span class="ident" id="6953771">tt</span><span class="op" id="6953773">.</span><span class="ident" id="6953774">name</span><span class="op" id="6953778">,</span>&nbsp;<span class="ident" id="6953780">pi</span><span class="op" id="6953782">,</span>&nbsp;<span class="ident" id="6953784">got</span><span class="op" id="6953787">[</span><span class="ident" id="6953788">pi</span><span class="op" id="6953790">]</span><span class="op" id="6953791">,</span>&nbsp;<span class="ident" id="6953793">wantPart</span><span class="op" id="6953801">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6953826">}</span><br>
<span class="lineno">605</span><span class="op" id="6953828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6953831">func</span>&nbsp;<span class="ident" id="6953836">roundTripParseTest</span><span class="op" id="6953854">(</span><span class="op" id="6953855">)</span>&nbsp;<span class="ident" id="6953857">parseTest</span>&nbsp;<span class="op" id="6953867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953870">t</span>&nbsp;<span class="op" id="6953872">:=</span>&nbsp;<span class="ident" id="6953875">parseTest</span><span class="op" id="6953884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953888">name</span><span class="op" id="6953892">:</span>&nbsp;<span class="string" id="6953894">&#34;round&nbsp;trip&#34;</span><span class="op" id="6953906">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953910">want</span><span class="op" id="6953914">:</span>&nbsp;<span class="op" id="6953916">[</span><span class="op" id="6953917">]</span><span class="ident" id="6953918">headerBody</span><span class="op" id="6953928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953933">formData</span><span class="op" id="6953941">(</span><span class="string" id="6953942">&#34;empty&#34;</span><span class="op" id="6953949">,</span>&nbsp;<span class="string" id="6953951">&#34;&#34;</span><span class="op" id="6953953">)</span><span class="op" id="6953954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953959">formData</span><span class="op" id="6953967">(</span><span class="string" id="6953968">&#34;lf&#34;</span><span class="op" id="6953972">,</span>&nbsp;<span class="string" id="6953974">&#34;\n&#34;</span><span class="op" id="6953978">)</span><span class="op" id="6953979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6953984">formData</span><span class="op" id="6953992">(</span><span class="string" id="6953993">&#34;cr&#34;</span><span class="op" id="6953997">,</span>&nbsp;<span class="string" id="6953999">&#34;\r&#34;</span><span class="op" id="6954003">)</span><span class="op" id="6954004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954009">formData</span><span class="op" id="6954017">(</span><span class="string" id="6954018">&#34;crlf&#34;</span><span class="op" id="6954024">,</span>&nbsp;<span class="string" id="6954026">&#34;\r\n&#34;</span><span class="op" id="6954032">)</span><span class="op" id="6954033">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954038">formData</span><span class="op" id="6954046">(</span><span class="string" id="6954047">&#34;foo&#34;</span><span class="op" id="6954052">,</span>&nbsp;<span class="string" id="6954054">&#34;bar&#34;</span><span class="op" id="6954059">)</span><span class="op" id="6954060">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6954064">}</span><span class="op" id="6954065">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6954068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6954071">var</span>&nbsp;<span class="ident" id="6954075">buf</span>&nbsp;<span class="ident" id="6954079">bytes</span><span class="op" id="6954084">.</span><span class="ident" id="6954085">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954093">w</span>&nbsp;<span class="op" id="6954095">:=</span>&nbsp;<span class="ident" id="6954098">NewWriter</span><span class="op" id="6954107">(</span><span class="op" id="6954108">&amp;</span><span class="ident" id="6954109">buf</span><span class="op" id="6954112">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6954115">for</span>&nbsp;<span class="ident" id="6954119">_</span><span class="op" id="6954120">,</span>&nbsp;<span class="ident" id="6954122">p</span>&nbsp;<span class="op" id="6954124">:=</span>&nbsp;<span class="keyword" id="6954127">range</span>&nbsp;<span class="ident" id="6954133">t</span><span class="op" id="6954134">.</span><span class="ident" id="6954135">want</span>&nbsp;<span class="op" id="6954140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954144">pw</span><span class="op" id="6954146">,</span>&nbsp;<span class="ident" id="6954148">err</span>&nbsp;<span class="op" id="6954152">:=</span>&nbsp;<span class="ident" id="6954155">w</span><span class="op" id="6954156">.</span><span class="ident" id="6954157">CreatePart</span><span class="op" id="6954167">(</span><span class="ident" id="6954168">p</span><span class="op" id="6954169">.</span><span class="ident" id="6954170">header</span><span class="op" id="6954176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6954180">if</span>&nbsp;<span class="ident" id="6954183">err</span>&nbsp;<span class="op" id="6954187">!=</span>&nbsp;<span class="ident" id="6954190">nil</span>&nbsp;<span class="op" id="6954194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6954199">panic</span><span class="op" id="6954204">(</span><span class="ident" id="6954205">err</span><span class="op" id="6954208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6954212">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954216">_</span><span class="op" id="6954217">,</span>&nbsp;<span class="ident" id="6954219">err</span>&nbsp;<span class="op" id="6954223">=</span>&nbsp;<span class="ident" id="6954225">pw</span><span class="op" id="6954227">.</span><span class="ident" id="6954228">Write</span><span class="op" id="6954233">(</span><span class="op" id="6954234">[</span><span class="op" id="6954235">]</span><span class="builtintype" id="6954236">byte</span><span class="op" id="6954240">(</span><span class="ident" id="6954241">p</span><span class="op" id="6954242">.</span><span class="ident" id="6954243">body</span><span class="op" id="6954247">)</span><span class="op" id="6954248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6954252">if</span>&nbsp;<span class="ident" id="6954255">err</span>&nbsp;<span class="op" id="6954259">!=</span>&nbsp;<span class="ident" id="6954262">nil</span>&nbsp;<span class="op" id="6954266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6954271">panic</span><span class="op" id="6954276">(</span><span class="ident" id="6954277">err</span><span class="op" id="6954280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6954284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6954287">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954290">w</span><span class="op" id="6954291">.</span><span class="ident" id="6954292">Close</span><span class="op" id="6954297">(</span><span class="op" id="6954298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954301">t</span><span class="op" id="6954302">.</span><span class="ident" id="6954303">in</span>&nbsp;<span class="op" id="6954306">=</span>&nbsp;<span class="ident" id="6954308">buf</span><span class="op" id="6954311">.</span><span class="ident" id="6954312">String</span><span class="op" id="6954318">(</span><span class="op" id="6954319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6954322">t</span><span class="op" id="6954323">.</span><span class="ident" id="6954324">sep</span>&nbsp;<span class="op" id="6954328">=</span>&nbsp;<span class="ident" id="6954330">w</span><span class="op" id="6954331">.</span><span class="ident" id="6954332">Boundary</span><span class="op" id="6954340">(</span><span class="op" id="6954341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6954344">return</span>&nbsp;<span class="ident" id="6954351">t</span><br>
<span class="lineno"></span><span class="op" id="6954353">}</span>
</div>
</body>
</html>
