<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html" class="current">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6930357">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6930412">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6930466">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6930517">package</span>&nbsp;<span class="ident" id="6930525">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930533">import</span>&nbsp;<span class="op" id="6930540">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930543">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930552">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930562">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930568">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930581">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930592">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930603">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6930614">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6930621">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930624">type</span>&nbsp;<span class="ident" id="6930629">testpair</span>&nbsp;<span class="keyword" id="6930638">struct</span>&nbsp;<span class="op" id="6930645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6930648">decoded</span><span class="op" id="6930655">,</span>&nbsp;<span class="ident" id="6930657">encoded</span>&nbsp;<span class="builtintype" id="6930665">string</span><br>
<span class="lineno">20</span><span class="op" id="6930672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6930675">var</span>&nbsp;<span class="ident" id="6930679">pairs</span>&nbsp;<span class="op" id="6930685">=</span>&nbsp;<span class="op" id="6930687">[</span><span class="op" id="6930688">]</span><span class="ident" id="6930689">testpair</span><span class="op" id="6930697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6930700">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930722">{</span><span class="string" id="6930723">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="6930749">,</span>&nbsp;<span class="string" id="6930751">&#34;FPucA9l+&#34;</span><span class="op" id="6930761">}</span><span class="op" id="6930762">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930765">{</span><span class="string" id="6930766">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="6930788">,</span>&nbsp;<span class="string" id="6930790">&#34;FPucA9k=&#34;</span><span class="op" id="6930800">}</span><span class="op" id="6930801">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930804">{</span><span class="string" id="6930805">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="6930823">,</span>&nbsp;<span class="string" id="6930825">&#34;FPucAw==&#34;</span><span class="op" id="6930835">}</span><span class="op" id="6930836">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6930840">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930862">{</span><span class="string" id="6930863">&#34;&#34;</span><span class="op" id="6930865">,</span>&nbsp;<span class="string" id="6930867">&#34;&#34;</span><span class="op" id="6930869">}</span><span class="op" id="6930870">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930873">{</span><span class="string" id="6930874">&#34;f&#34;</span><span class="op" id="6930877">,</span>&nbsp;<span class="string" id="6930879">&#34;Zg==&#34;</span><span class="op" id="6930885">}</span><span class="op" id="6930886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930889">{</span><span class="string" id="6930890">&#34;fo&#34;</span><span class="op" id="6930894">,</span>&nbsp;<span class="string" id="6930896">&#34;Zm8=&#34;</span><span class="op" id="6930902">}</span><span class="op" id="6930903">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930906">{</span><span class="string" id="6930907">&#34;foo&#34;</span><span class="op" id="6930912">,</span>&nbsp;<span class="string" id="6930914">&#34;Zm9v&#34;</span><span class="op" id="6930920">}</span><span class="op" id="6930921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930924">{</span><span class="string" id="6930925">&#34;foob&#34;</span><span class="op" id="6930931">,</span>&nbsp;<span class="string" id="6930933">&#34;Zm9vYg==&#34;</span><span class="op" id="6930943">}</span><span class="op" id="6930944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930947">{</span><span class="string" id="6930948">&#34;fooba&#34;</span><span class="op" id="6930955">,</span>&nbsp;<span class="string" id="6930957">&#34;Zm9vYmE=&#34;</span><span class="op" id="6930967">}</span><span class="op" id="6930968">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6930971">{</span><span class="string" id="6930972">&#34;foobar&#34;</span><span class="op" id="6930980">,</span>&nbsp;<span class="string" id="6930982">&#34;Zm9vYmFy&#34;</span><span class="op" id="6930992">}</span><span class="op" id="6930993">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6930997">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931020">{</span><span class="string" id="6931021">&#34;sure.&#34;</span><span class="op" id="6931028">,</span>&nbsp;<span class="string" id="6931030">&#34;c3VyZS4=&#34;</span><span class="op" id="6931040">}</span><span class="op" id="6931041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931044">{</span><span class="string" id="6931045">&#34;sure&#34;</span><span class="op" id="6931051">,</span>&nbsp;<span class="string" id="6931053">&#34;c3VyZQ==&#34;</span><span class="op" id="6931063">}</span><span class="op" id="6931064">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931067">{</span><span class="string" id="6931068">&#34;sur&#34;</span><span class="op" id="6931073">,</span>&nbsp;<span class="string" id="6931075">&#34;c3Vy&#34;</span><span class="op" id="6931081">}</span><span class="op" id="6931082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931085">{</span><span class="string" id="6931086">&#34;su&#34;</span><span class="op" id="6931090">,</span>&nbsp;<span class="string" id="6931092">&#34;c3U=&#34;</span><span class="op" id="6931098">}</span><span class="op" id="6931099">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931102">{</span><span class="string" id="6931103">&#34;leasure.&#34;</span><span class="op" id="6931113">,</span>&nbsp;<span class="string" id="6931115">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="6931129">}</span><span class="op" id="6931130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931133">{</span><span class="string" id="6931134">&#34;easure.&#34;</span><span class="op" id="6931143">,</span>&nbsp;<span class="string" id="6931145">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="6931159">}</span><span class="op" id="6931160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931163">{</span><span class="string" id="6931164">&#34;asure.&#34;</span><span class="op" id="6931172">,</span>&nbsp;<span class="string" id="6931174">&#34;YXN1cmUu&#34;</span><span class="op" id="6931184">}</span><span class="op" id="6931185">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931188">{</span><span class="string" id="6931189">&#34;sure.&#34;</span><span class="op" id="6931196">,</span>&nbsp;<span class="string" id="6931198">&#34;c3VyZS4=&#34;</span><span class="op" id="6931208">}</span><span class="op" id="6931209">,</span><br>
<span class="lineno"></span><span class="op" id="6931211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931214">var</span>&nbsp;<span class="ident" id="6931218">bigtest</span>&nbsp;<span class="op" id="6931226">=</span>&nbsp;<span class="ident" id="6931228">testpair</span><span class="op" id="6931236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6931239">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="6931275">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6931278">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6931328">,</span><br>
<span class="lineno"></span><span class="op" id="6931330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931333">func</span>&nbsp;<span class="ident" id="6931338">testEqual</span><span class="op" id="6931347">(</span><span class="ident" id="6931348">t</span>&nbsp;<span class="op" id="6931350">*</span><span class="ident" id="6931351">testing</span><span class="op" id="6931358">.</span><span class="ident" id="6931359">T</span><span class="op" id="6931360">,</span>&nbsp;<span class="ident" id="6931362">msg</span>&nbsp;<span class="builtintype" id="6931366">string</span><span class="op" id="6931372">,</span>&nbsp;<span class="ident" id="6931374">args</span>&nbsp;<span class="op" id="6931379">...</span><span class="keyword" id="6931382">interface</span><span class="op" id="6931391">{</span><span class="op" id="6931392">}</span><span class="op" id="6931393">)</span>&nbsp;<span class="builtintype" id="6931395">bool</span>&nbsp;<span class="op" id="6931400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931403">if</span>&nbsp;<span class="ident" id="6931406">args</span><span class="op" id="6931410">[</span><span class="builtinfunc" id="6931411">len</span><span class="op" id="6931414">(</span><span class="ident" id="6931415">args</span><span class="op" id="6931419">)</span><span class="op" id="6931420">-</span><span class="num" id="6931421">2</span><span class="op" id="6931422">]</span>&nbsp;<span class="op" id="6931424">!=</span>&nbsp;<span class="ident" id="6931427">args</span><span class="op" id="6931431">[</span><span class="builtinfunc" id="6931432">len</span><span class="op" id="6931435">(</span><span class="ident" id="6931436">args</span><span class="op" id="6931440">)</span><span class="op" id="6931441">-</span><span class="num" id="6931442">1</span><span class="op" id="6931443">]</span>&nbsp;<span class="op" id="6931445">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931449">t</span><span class="op" id="6931450">.</span><span class="ident" id="6931451">Errorf</span><span class="op" id="6931457">(</span><span class="ident" id="6931458">msg</span><span class="op" id="6931461">,</span>&nbsp;<span class="ident" id="6931463">args</span><span class="op" id="6931467">...</span><span class="op" id="6931470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931474">return</span>&nbsp;<span class="builtintype" id="6931481">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931491">return</span>&nbsp;<span class="builtintype" id="6931498">true</span><br>
<span class="lineno"></span><span class="op" id="6931503">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6931506">func</span>&nbsp;<span class="ident" id="6931511">TestEncode</span><span class="op" id="6931521">(</span><span class="ident" id="6931522">t</span>&nbsp;<span class="op" id="6931524">*</span><span class="ident" id="6931525">testing</span><span class="op" id="6931532">.</span><span class="ident" id="6931533">T</span><span class="op" id="6931534">)</span>&nbsp;<span class="op" id="6931536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931539">for</span>&nbsp;<span class="ident" id="6931543">_</span><span class="op" id="6931544">,</span>&nbsp;<span class="ident" id="6931546">p</span>&nbsp;<span class="op" id="6931548">:=</span>&nbsp;<span class="keyword" id="6931551">range</span>&nbsp;<span class="ident" id="6931557">pairs</span>&nbsp;<span class="op" id="6931563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931567">got</span>&nbsp;<span class="op" id="6931571">:=</span>&nbsp;<span class="ident" id="6931574">StdEncoding</span><span class="op" id="6931585">.</span><span class="ident" id="6931586">EncodeToString</span><span class="op" id="6931600">(</span><span class="op" id="6931601">[</span><span class="op" id="6931602">]</span><span class="builtintype" id="6931603">byte</span><span class="op" id="6931607">(</span><span class="ident" id="6931608">p</span><span class="op" id="6931609">.</span><span class="ident" id="6931610">decoded</span><span class="op" id="6931617">)</span><span class="op" id="6931618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931622">testEqual</span><span class="op" id="6931631">(</span><span class="ident" id="6931632">t</span><span class="op" id="6931633">,</span>&nbsp;<span class="string" id="6931635">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6931661">,</span>&nbsp;<span class="ident" id="6931663">p</span><span class="op" id="6931664">.</span><span class="ident" id="6931665">decoded</span><span class="op" id="6931672">,</span>&nbsp;<span class="ident" id="6931674">got</span><span class="op" id="6931677">,</span>&nbsp;<span class="ident" id="6931679">p</span><span class="op" id="6931680">.</span><span class="ident" id="6931681">encoded</span><span class="op" id="6931688">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931691">}</span><br>
<span class="lineno"></span><span class="op" id="6931693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931696">func</span>&nbsp;<span class="ident" id="6931701">TestEncoder</span><span class="op" id="6931712">(</span><span class="ident" id="6931713">t</span>&nbsp;<span class="op" id="6931715">*</span><span class="ident" id="6931716">testing</span><span class="op" id="6931723">.</span><span class="ident" id="6931724">T</span><span class="op" id="6931725">)</span>&nbsp;<span class="op" id="6931727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6931730">for</span>&nbsp;<span class="ident" id="6931734">_</span><span class="op" id="6931735">,</span>&nbsp;<span class="ident" id="6931737">p</span>&nbsp;<span class="op" id="6931739">:=</span>&nbsp;<span class="keyword" id="6931742">range</span>&nbsp;<span class="ident" id="6931748">pairs</span>&nbsp;<span class="op" id="6931754">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931758">bb</span>&nbsp;<span class="op" id="6931761">:=</span>&nbsp;<span class="op" id="6931764">&amp;</span><span class="ident" id="6931765">bytes</span><span class="op" id="6931770">.</span><span class="ident" id="6931771">Buffer</span><span class="op" id="6931777">{</span><span class="op" id="6931778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931782">encoder</span>&nbsp;<span class="op" id="6931790">:=</span>&nbsp;<span class="ident" id="6931793">NewEncoder</span><span class="op" id="6931803">(</span><span class="ident" id="6931804">StdEncoding</span><span class="op" id="6931815">,</span>&nbsp;<span class="ident" id="6931817">bb</span><span class="op" id="6931819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931823">encoder</span><span class="op" id="6931830">.</span><span class="ident" id="6931831">Write</span><span class="op" id="6931836">(</span><span class="op" id="6931837">[</span><span class="op" id="6931838">]</span><span class="builtintype" id="6931839">byte</span><span class="op" id="6931843">(</span><span class="ident" id="6931844">p</span><span class="op" id="6931845">.</span><span class="ident" id="6931846">decoded</span><span class="op" id="6931853">)</span><span class="op" id="6931854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931858">encoder</span><span class="op" id="6931865">.</span><span class="ident" id="6931866">Close</span><span class="op" id="6931871">(</span><span class="op" id="6931872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6931876">testEqual</span><span class="op" id="6931885">(</span><span class="ident" id="6931886">t</span><span class="op" id="6931887">,</span>&nbsp;<span class="string" id="6931889">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6931915">,</span>&nbsp;<span class="ident" id="6931917">p</span><span class="op" id="6931918">.</span><span class="ident" id="6931919">decoded</span><span class="op" id="6931926">,</span>&nbsp;<span class="ident" id="6931928">bb</span><span class="op" id="6931930">.</span><span class="ident" id="6931931">String</span><span class="op" id="6931937">(</span><span class="op" id="6931938">)</span><span class="op" id="6931939">,</span>&nbsp;<span class="ident" id="6931941">p</span><span class="op" id="6931942">.</span><span class="ident" id="6931943">encoded</span><span class="op" id="6931950">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6931953">}</span><br>
<span class="lineno"></span><span class="op" id="6931955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6931958">func</span>&nbsp;<span class="ident" id="6931963">TestEncoderBuffering</span><span class="op" id="6931983">(</span><span class="ident" id="6931984">t</span>&nbsp;<span class="op" id="6931986">*</span><span class="ident" id="6931987">testing</span><span class="op" id="6931994">.</span><span class="ident" id="6931995">T</span><span class="op" id="6931996">)</span>&nbsp;<span class="op" id="6931998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932001">input</span>&nbsp;<span class="op" id="6932007">:=</span>&nbsp;<span class="op" id="6932010">[</span><span class="op" id="6932011">]</span><span class="builtintype" id="6932012">byte</span><span class="op" id="6932016">(</span><span class="ident" id="6932017">bigtest</span><span class="op" id="6932024">.</span><span class="ident" id="6932025">decoded</span><span class="op" id="6932032">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932035">for</span>&nbsp;<span class="ident" id="6932039">bs</span>&nbsp;<span class="op" id="6932042">:=</span>&nbsp;<span class="num" id="6932045">1</span><span class="op" id="6932046">;</span>&nbsp;<span class="ident" id="6932048">bs</span>&nbsp;<span class="op" id="6932051">&lt;=</span>&nbsp;<span class="num" id="6932054">12</span><span class="op" id="6932056">;</span>&nbsp;<span class="ident" id="6932058">bs</span><span class="op" id="6932060">++</span>&nbsp;<span class="op" id="6932063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932067">bb</span>&nbsp;<span class="op" id="6932070">:=</span>&nbsp;<span class="op" id="6932073">&amp;</span><span class="ident" id="6932074">bytes</span><span class="op" id="6932079">.</span><span class="ident" id="6932080">Buffer</span><span class="op" id="6932086">{</span><span class="op" id="6932087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932091">encoder</span>&nbsp;<span class="op" id="6932099">:=</span>&nbsp;<span class="ident" id="6932102">NewEncoder</span><span class="op" id="6932112">(</span><span class="ident" id="6932113">StdEncoding</span><span class="op" id="6932124">,</span>&nbsp;<span class="ident" id="6932126">bb</span><span class="op" id="6932128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932132">for</span>&nbsp;<span class="ident" id="6932136">pos</span>&nbsp;<span class="op" id="6932140">:=</span>&nbsp;<span class="num" id="6932143">0</span><span class="op" id="6932144">;</span>&nbsp;<span class="ident" id="6932146">pos</span>&nbsp;<span class="op" id="6932150">&lt;</span>&nbsp;<span class="builtinfunc" id="6932152">len</span><span class="op" id="6932155">(</span><span class="ident" id="6932156">input</span><span class="op" id="6932161">)</span><span class="op" id="6932162">;</span>&nbsp;<span class="ident" id="6932164">pos</span>&nbsp;<span class="op" id="6932168">+=</span>&nbsp;<span class="ident" id="6932171">bs</span>&nbsp;<span class="op" id="6932174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932179">end</span>&nbsp;<span class="op" id="6932183">:=</span>&nbsp;<span class="ident" id="6932186">pos</span>&nbsp;<span class="op" id="6932190">+</span>&nbsp;<span class="ident" id="6932192">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932198">if</span>&nbsp;<span class="ident" id="6932201">end</span>&nbsp;<span class="op" id="6932205">&gt;</span>&nbsp;<span class="builtinfunc" id="6932207">len</span><span class="op" id="6932210">(</span><span class="ident" id="6932211">input</span><span class="op" id="6932216">)</span>&nbsp;<span class="op" id="6932218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932224">end</span>&nbsp;<span class="op" id="6932228">=</span>&nbsp;<span class="builtinfunc" id="6932230">len</span><span class="op" id="6932233">(</span><span class="ident" id="6932234">input</span><span class="op" id="6932239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6932244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932249">n</span><span class="op" id="6932250">,</span>&nbsp;<span class="ident" id="6932252">err</span>&nbsp;<span class="op" id="6932256">:=</span>&nbsp;<span class="ident" id="6932259">encoder</span><span class="op" id="6932266">.</span><span class="ident" id="6932267">Write</span><span class="op" id="6932272">(</span><span class="ident" id="6932273">input</span><span class="op" id="6932278">[</span><span class="ident" id="6932279">pos</span><span class="op" id="6932282">:</span><span class="ident" id="6932283">end</span><span class="op" id="6932286">]</span><span class="op" id="6932287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932292">testEqual</span><span class="op" id="6932301">(</span><span class="ident" id="6932302">t</span><span class="op" id="6932303">,</span>&nbsp;<span class="string" id="6932305">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6932339">,</span>&nbsp;<span class="ident" id="6932341">input</span><span class="op" id="6932346">[</span><span class="ident" id="6932347">pos</span><span class="op" id="6932350">:</span><span class="ident" id="6932351">end</span><span class="op" id="6932354">]</span><span class="op" id="6932355">,</span>&nbsp;<span class="ident" id="6932357">err</span><span class="op" id="6932360">,</span>&nbsp;<span class="builtintype" id="6932362">error</span><span class="op" id="6932367">(</span><span class="ident" id="6932368">nil</span><span class="op" id="6932371">)</span><span class="op" id="6932372">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932377">testEqual</span><span class="op" id="6932386">(</span><span class="ident" id="6932387">t</span><span class="op" id="6932388">,</span>&nbsp;<span class="string" id="6932390">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6932425">,</span>&nbsp;<span class="ident" id="6932427">input</span><span class="op" id="6932432">[</span><span class="ident" id="6932433">pos</span><span class="op" id="6932436">:</span><span class="ident" id="6932437">end</span><span class="op" id="6932440">]</span><span class="op" id="6932441">,</span>&nbsp;<span class="ident" id="6932443">n</span><span class="op" id="6932444">,</span>&nbsp;<span class="ident" id="6932446">end</span><span class="op" id="6932449">-</span><span class="ident" id="6932450">pos</span><span class="op" id="6932453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6932457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932461">err</span>&nbsp;<span class="op" id="6932465">:=</span>&nbsp;<span class="ident" id="6932468">encoder</span><span class="op" id="6932475">.</span><span class="ident" id="6932476">Close</span><span class="op" id="6932481">(</span><span class="op" id="6932482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932486">testEqual</span><span class="op" id="6932495">(</span><span class="ident" id="6932496">t</span><span class="op" id="6932497">,</span>&nbsp;<span class="string" id="6932499">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6932529">,</span>&nbsp;<span class="ident" id="6932531">err</span><span class="op" id="6932534">,</span>&nbsp;<span class="builtintype" id="6932536">error</span><span class="op" id="6932541">(</span><span class="ident" id="6932542">nil</span><span class="op" id="6932545">)</span><span class="op" id="6932546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932550">testEqual</span><span class="op" id="6932559">(</span><span class="ident" id="6932560">t</span><span class="op" id="6932561">,</span>&nbsp;<span class="string" id="6932563">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6932596">,</span>&nbsp;<span class="ident" id="6932598">bs</span><span class="op" id="6932600">,</span>&nbsp;<span class="ident" id="6932602">bigtest</span><span class="op" id="6932609">.</span><span class="ident" id="6932610">decoded</span><span class="op" id="6932617">,</span>&nbsp;<span class="ident" id="6932619">bb</span><span class="op" id="6932621">.</span><span class="ident" id="6932622">String</span><span class="op" id="6932628">(</span><span class="op" id="6932629">)</span><span class="op" id="6932630">,</span>&nbsp;<span class="ident" id="6932632">bigtest</span><span class="op" id="6932639">.</span><span class="ident" id="6932640">encoded</span><span class="op" id="6932647">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6932650">}</span><br>
<span class="lineno"></span><span class="op" id="6932652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6932655">func</span>&nbsp;<span class="ident" id="6932660">TestDecode</span><span class="op" id="6932670">(</span><span class="ident" id="6932671">t</span>&nbsp;<span class="op" id="6932673">*</span><span class="ident" id="6932674">testing</span><span class="op" id="6932681">.</span><span class="ident" id="6932682">T</span><span class="op" id="6932683">)</span>&nbsp;<span class="op" id="6932685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6932688">for</span>&nbsp;<span class="ident" id="6932692">_</span><span class="op" id="6932693">,</span>&nbsp;<span class="ident" id="6932695">p</span>&nbsp;<span class="op" id="6932697">:=</span>&nbsp;<span class="keyword" id="6932700">range</span>&nbsp;<span class="ident" id="6932706">pairs</span>&nbsp;<span class="op" id="6932712">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932716">dbuf</span>&nbsp;<span class="op" id="6932721">:=</span>&nbsp;<span class="builtinfunc" id="6932724">make</span><span class="op" id="6932728">(</span><span class="op" id="6932729">[</span><span class="op" id="6932730">]</span><span class="builtintype" id="6932731">byte</span><span class="op" id="6932735">,</span>&nbsp;<span class="ident" id="6932737">StdEncoding</span><span class="op" id="6932748">.</span><span class="ident" id="6932749">DecodedLen</span><span class="op" id="6932759">(</span><span class="builtinfunc" id="6932760">len</span><span class="op" id="6932763">(</span><span class="ident" id="6932764">p</span><span class="op" id="6932765">.</span><span class="ident" id="6932766">encoded</span><span class="op" id="6932773">)</span><span class="op" id="6932774">)</span><span class="op" id="6932775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932779">count</span><span class="op" id="6932784">,</span>&nbsp;<span class="ident" id="6932786">end</span><span class="op" id="6932789">,</span>&nbsp;<span class="ident" id="6932791">err</span>&nbsp;<span class="op" id="6932795">:=</span>&nbsp;<span class="ident" id="6932798">StdEncoding</span><span class="op" id="6932809">.</span><span class="ident" id="6932810">decode</span><span class="op" id="6932816">(</span><span class="ident" id="6932817">dbuf</span><span class="op" id="6932821">,</span>&nbsp;<span class="op" id="6932823">[</span><span class="op" id="6932824">]</span><span class="builtintype" id="6932825">byte</span><span class="op" id="6932829">(</span><span class="ident" id="6932830">p</span><span class="op" id="6932831">.</span><span class="ident" id="6932832">encoded</span><span class="op" id="6932839">)</span><span class="op" id="6932840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932844">testEqual</span><span class="op" id="6932853">(</span><span class="ident" id="6932854">t</span><span class="op" id="6932855">,</span>&nbsp;<span class="string" id="6932857">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6932889">,</span>&nbsp;<span class="ident" id="6932891">p</span><span class="op" id="6932892">.</span><span class="ident" id="6932893">encoded</span><span class="op" id="6932900">,</span>&nbsp;<span class="ident" id="6932902">err</span><span class="op" id="6932905">,</span>&nbsp;<span class="builtintype" id="6932907">error</span><span class="op" id="6932912">(</span><span class="ident" id="6932913">nil</span><span class="op" id="6932916">)</span><span class="op" id="6932917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6932921">testEqual</span><span class="op" id="6932930">(</span><span class="ident" id="6932931">t</span><span class="op" id="6932932">,</span>&nbsp;<span class="string" id="6932934">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6932967">,</span>&nbsp;<span class="ident" id="6932969">p</span><span class="op" id="6932970">.</span><span class="ident" id="6932971">encoded</span><span class="op" id="6932978">,</span>&nbsp;<span class="ident" id="6932980">count</span><span class="op" id="6932985">,</span>&nbsp;<span class="builtinfunc" id="6932987">len</span><span class="op" id="6932990">(</span><span class="ident" id="6932991">p</span><span class="op" id="6932992">.</span><span class="ident" id="6932993">decoded</span><span class="op" id="6933000">)</span><span class="op" id="6933001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933005">if</span>&nbsp;<span class="builtinfunc" id="6933008">len</span><span class="op" id="6933011">(</span><span class="ident" id="6933012">p</span><span class="op" id="6933013">.</span><span class="ident" id="6933014">encoded</span><span class="op" id="6933021">)</span>&nbsp;<span class="op" id="6933023">&gt;</span>&nbsp;<span class="num" id="6933025">0</span>&nbsp;<span class="op" id="6933027">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933032">testEqual</span><span class="op" id="6933041">(</span><span class="ident" id="6933042">t</span><span class="op" id="6933043">,</span>&nbsp;<span class="string" id="6933045">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6933075">,</span>&nbsp;<span class="ident" id="6933077">p</span><span class="op" id="6933078">.</span><span class="ident" id="6933079">encoded</span><span class="op" id="6933086">,</span>&nbsp;<span class="ident" id="6933088">end</span><span class="op" id="6933091">,</span>&nbsp;<span class="op" id="6933093">(</span><span class="ident" id="6933094">p</span><span class="op" id="6933095">.</span><span class="ident" id="6933096">encoded</span><span class="op" id="6933103">[</span><span class="builtinfunc" id="6933104">len</span><span class="op" id="6933107">(</span><span class="ident" id="6933108">p</span><span class="op" id="6933109">.</span><span class="ident" id="6933110">encoded</span><span class="op" id="6933117">)</span><span class="op" id="6933118">-</span><span class="num" id="6933119">1</span><span class="op" id="6933120">]</span>&nbsp;<span class="op" id="6933122">==</span>&nbsp;<span class="string" id="6933125">&#39;=&#39;</span><span class="op" id="6933128">)</span><span class="op" id="6933129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933137">testEqual</span><span class="op" id="6933146">(</span><span class="ident" id="6933147">t</span><span class="op" id="6933148">,</span>&nbsp;<span class="string" id="6933150">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6933176">,</span>&nbsp;<span class="ident" id="6933178">p</span><span class="op" id="6933179">.</span><span class="ident" id="6933180">encoded</span><span class="op" id="6933187">,</span>&nbsp;<span class="builtintype" id="6933189">string</span><span class="op" id="6933195">(</span><span class="ident" id="6933196">dbuf</span><span class="op" id="6933200">[</span><span class="num" id="6933201">0</span><span class="op" id="6933202">:</span><span class="ident" id="6933203">count</span><span class="op" id="6933208">]</span><span class="op" id="6933209">)</span><span class="op" id="6933210">,</span>&nbsp;<span class="ident" id="6933212">p</span><span class="op" id="6933213">.</span><span class="ident" id="6933214">decoded</span><span class="op" id="6933221">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933226">dbuf</span><span class="op" id="6933230">,</span>&nbsp;<span class="ident" id="6933232">err</span>&nbsp;<span class="op" id="6933236">=</span>&nbsp;<span class="ident" id="6933238">StdEncoding</span><span class="op" id="6933249">.</span><span class="ident" id="6933250">DecodeString</span><span class="op" id="6933262">(</span><span class="ident" id="6933263">p</span><span class="op" id="6933264">.</span><span class="ident" id="6933265">encoded</span><span class="op" id="6933272">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933276">testEqual</span><span class="op" id="6933285">(</span><span class="ident" id="6933286">t</span><span class="op" id="6933287">,</span>&nbsp;<span class="string" id="6933289">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6933327">,</span>&nbsp;<span class="ident" id="6933329">p</span><span class="op" id="6933330">.</span><span class="ident" id="6933331">encoded</span><span class="op" id="6933338">,</span>&nbsp;<span class="ident" id="6933340">err</span><span class="op" id="6933343">,</span>&nbsp;<span class="builtintype" id="6933345">error</span><span class="op" id="6933350">(</span><span class="ident" id="6933351">nil</span><span class="op" id="6933354">)</span><span class="op" id="6933355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933359">testEqual</span><span class="op" id="6933368">(</span><span class="ident" id="6933369">t</span><span class="op" id="6933370">,</span>&nbsp;<span class="string" id="6933372">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6933404">,</span>&nbsp;<span class="builtintype" id="6933406">string</span><span class="op" id="6933412">(</span><span class="ident" id="6933413">dbuf</span><span class="op" id="6933417">)</span><span class="op" id="6933418">,</span>&nbsp;<span class="ident" id="6933420">p</span><span class="op" id="6933421">.</span><span class="ident" id="6933422">decoded</span><span class="op" id="6933429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933432">}</span><br>
<span class="lineno"></span><span class="op" id="6933434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6933437">func</span>&nbsp;<span class="ident" id="6933442">TestDecoder</span><span class="op" id="6933453">(</span><span class="ident" id="6933454">t</span>&nbsp;<span class="op" id="6933456">*</span><span class="ident" id="6933457">testing</span><span class="op" id="6933464">.</span><span class="ident" id="6933465">T</span><span class="op" id="6933466">)</span>&nbsp;<span class="op" id="6933468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933471">for</span>&nbsp;<span class="ident" id="6933475">_</span><span class="op" id="6933476">,</span>&nbsp;<span class="ident" id="6933478">p</span>&nbsp;<span class="op" id="6933480">:=</span>&nbsp;<span class="keyword" id="6933483">range</span>&nbsp;<span class="ident" id="6933489">pairs</span>&nbsp;<span class="op" id="6933495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933499">decoder</span>&nbsp;<span class="op" id="6933507">:=</span>&nbsp;<span class="ident" id="6933510">NewDecoder</span><span class="op" id="6933520">(</span><span class="ident" id="6933521">StdEncoding</span><span class="op" id="6933532">,</span>&nbsp;<span class="ident" id="6933534">strings</span><span class="op" id="6933541">.</span><span class="ident" id="6933542">NewReader</span><span class="op" id="6933551">(</span><span class="ident" id="6933552">p</span><span class="op" id="6933553">.</span><span class="ident" id="6933554">encoded</span><span class="op" id="6933561">)</span><span class="op" id="6933562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933566">dbuf</span>&nbsp;<span class="op" id="6933571">:=</span>&nbsp;<span class="builtinfunc" id="6933574">make</span><span class="op" id="6933578">(</span><span class="op" id="6933579">[</span><span class="op" id="6933580">]</span><span class="builtintype" id="6933581">byte</span><span class="op" id="6933585">,</span>&nbsp;<span class="ident" id="6933587">StdEncoding</span><span class="op" id="6933598">.</span><span class="ident" id="6933599">DecodedLen</span><span class="op" id="6933609">(</span><span class="builtinfunc" id="6933610">len</span><span class="op" id="6933613">(</span><span class="ident" id="6933614">p</span><span class="op" id="6933615">.</span><span class="ident" id="6933616">encoded</span><span class="op" id="6933623">)</span><span class="op" id="6933624">)</span><span class="op" id="6933625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933629">count</span><span class="op" id="6933634">,</span>&nbsp;<span class="ident" id="6933636">err</span>&nbsp;<span class="op" id="6933640">:=</span>&nbsp;<span class="ident" id="6933643">decoder</span><span class="op" id="6933650">.</span><span class="ident" id="6933651">Read</span><span class="op" id="6933655">(</span><span class="ident" id="6933656">dbuf</span><span class="op" id="6933660">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933664">if</span>&nbsp;<span class="ident" id="6933667">err</span>&nbsp;<span class="op" id="6933671">!=</span>&nbsp;<span class="ident" id="6933674">nil</span>&nbsp;<span class="op" id="6933678">&amp;&amp;</span>&nbsp;<span class="ident" id="6933681">err</span>&nbsp;<span class="op" id="6933685">!=</span>&nbsp;<span class="ident" id="6933688">io</span><span class="op" id="6933690">.</span><span class="ident" id="6933691">EOF</span>&nbsp;<span class="op" id="6933695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933700">t</span><span class="op" id="6933701">.</span><span class="ident" id="6933702">Fatal</span><span class="op" id="6933707">(</span><span class="string" id="6933708">&#34;Read&nbsp;failed&#34;</span><span class="op" id="6933721">,</span>&nbsp;<span class="ident" id="6933723">err</span><span class="op" id="6933726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933734">testEqual</span><span class="op" id="6933743">(</span><span class="ident" id="6933744">t</span><span class="op" id="6933745">,</span>&nbsp;<span class="string" id="6933747">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6933782">,</span>&nbsp;<span class="ident" id="6933784">p</span><span class="op" id="6933785">.</span><span class="ident" id="6933786">encoded</span><span class="op" id="6933793">,</span>&nbsp;<span class="ident" id="6933795">count</span><span class="op" id="6933800">,</span>&nbsp;<span class="builtinfunc" id="6933802">len</span><span class="op" id="6933805">(</span><span class="ident" id="6933806">p</span><span class="op" id="6933807">.</span><span class="ident" id="6933808">decoded</span><span class="op" id="6933815">)</span><span class="op" id="6933816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933820">testEqual</span><span class="op" id="6933829">(</span><span class="ident" id="6933830">t</span><span class="op" id="6933831">,</span>&nbsp;<span class="string" id="6933833">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6933863">,</span>&nbsp;<span class="ident" id="6933865">p</span><span class="op" id="6933866">.</span><span class="ident" id="6933867">encoded</span><span class="op" id="6933874">,</span>&nbsp;<span class="builtintype" id="6933876">string</span><span class="op" id="6933882">(</span><span class="ident" id="6933883">dbuf</span><span class="op" id="6933887">[</span><span class="num" id="6933888">0</span><span class="op" id="6933889">:</span><span class="ident" id="6933890">count</span><span class="op" id="6933895">]</span><span class="op" id="6933896">)</span><span class="op" id="6933897">,</span>&nbsp;<span class="ident" id="6933899">p</span><span class="op" id="6933900">.</span><span class="ident" id="6933901">decoded</span><span class="op" id="6933908">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6933912">if</span>&nbsp;<span class="ident" id="6933915">err</span>&nbsp;<span class="op" id="6933919">!=</span>&nbsp;<span class="ident" id="6933922">io</span><span class="op" id="6933924">.</span><span class="ident" id="6933925">EOF</span>&nbsp;<span class="op" id="6933929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933934">count</span><span class="op" id="6933939">,</span>&nbsp;<span class="ident" id="6933941">err</span>&nbsp;<span class="op" id="6933945">=</span>&nbsp;<span class="ident" id="6933947">decoder</span><span class="op" id="6933954">.</span><span class="ident" id="6933955">Read</span><span class="op" id="6933959">(</span><span class="ident" id="6933960">dbuf</span><span class="op" id="6933964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6933968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6933972">testEqual</span><span class="op" id="6933981">(</span><span class="ident" id="6933982">t</span><span class="op" id="6933983">,</span>&nbsp;<span class="string" id="6933985">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6934013">,</span>&nbsp;<span class="ident" id="6934015">p</span><span class="op" id="6934016">.</span><span class="ident" id="6934017">encoded</span><span class="op" id="6934024">,</span>&nbsp;<span class="ident" id="6934026">err</span><span class="op" id="6934029">,</span>&nbsp;<span class="ident" id="6934031">io</span><span class="op" id="6934033">.</span><span class="ident" id="6934034">EOF</span><span class="op" id="6934037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934040">}</span><br>
<span class="lineno">130</span><span class="op" id="6934042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6934045">func</span>&nbsp;<span class="ident" id="6934050">TestDecoderBuffering</span><span class="op" id="6934070">(</span><span class="ident" id="6934071">t</span>&nbsp;<span class="op" id="6934073">*</span><span class="ident" id="6934074">testing</span><span class="op" id="6934081">.</span><span class="ident" id="6934082">T</span><span class="op" id="6934083">)</span>&nbsp;<span class="op" id="6934085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934088">for</span>&nbsp;<span class="ident" id="6934092">bs</span>&nbsp;<span class="op" id="6934095">:=</span>&nbsp;<span class="num" id="6934098">1</span><span class="op" id="6934099">;</span>&nbsp;<span class="ident" id="6934101">bs</span>&nbsp;<span class="op" id="6934104">&lt;=</span>&nbsp;<span class="num" id="6934107">12</span><span class="op" id="6934109">;</span>&nbsp;<span class="ident" id="6934111">bs</span><span class="op" id="6934113">++</span>&nbsp;<span class="op" id="6934116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934120">decoder</span>&nbsp;<span class="op" id="6934128">:=</span>&nbsp;<span class="ident" id="6934131">NewDecoder</span><span class="op" id="6934141">(</span><span class="ident" id="6934142">StdEncoding</span><span class="op" id="6934153">,</span>&nbsp;<span class="ident" id="6934155">strings</span><span class="op" id="6934162">.</span><span class="ident" id="6934163">NewReader</span><span class="op" id="6934172">(</span><span class="ident" id="6934173">bigtest</span><span class="op" id="6934180">.</span><span class="ident" id="6934181">encoded</span><span class="op" id="6934188">)</span><span class="op" id="6934189">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934193">buf</span>&nbsp;<span class="op" id="6934197">:=</span>&nbsp;<span class="builtinfunc" id="6934200">make</span><span class="op" id="6934204">(</span><span class="op" id="6934205">[</span><span class="op" id="6934206">]</span><span class="builtintype" id="6934207">byte</span><span class="op" id="6934211">,</span>&nbsp;<span class="builtinfunc" id="6934213">len</span><span class="op" id="6934216">(</span><span class="ident" id="6934217">bigtest</span><span class="op" id="6934224">.</span><span class="ident" id="6934225">decoded</span><span class="op" id="6934232">)</span><span class="op" id="6934233">+</span><span class="num" id="6934234">12</span><span class="op" id="6934236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934240">var</span>&nbsp;<span class="ident" id="6934244">total</span>&nbsp;<span class="builtintype" id="6934250">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6934256">for</span>&nbsp;<span class="ident" id="6934260">total</span>&nbsp;<span class="op" id="6934266">=</span>&nbsp;<span class="num" id="6934268">0</span><span class="op" id="6934269">;</span>&nbsp;<span class="ident" id="6934271">total</span>&nbsp;<span class="op" id="6934277">&lt;</span>&nbsp;<span class="builtinfunc" id="6934279">len</span><span class="op" id="6934282">(</span><span class="ident" id="6934283">bigtest</span><span class="op" id="6934290">.</span><span class="ident" id="6934291">decoded</span><span class="op" id="6934298">)</span><span class="op" id="6934299">;</span>&nbsp;<span class="op" id="6934301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934306">n</span><span class="op" id="6934307">,</span>&nbsp;<span class="ident" id="6934309">err</span>&nbsp;<span class="op" id="6934313">:=</span>&nbsp;<span class="ident" id="6934316">decoder</span><span class="op" id="6934323">.</span><span class="ident" id="6934324">Read</span><span class="op" id="6934328">(</span><span class="ident" id="6934329">buf</span><span class="op" id="6934332">[</span><span class="ident" id="6934333">total</span>&nbsp;<span class="op" id="6934339">:</span>&nbsp;<span class="ident" id="6934341">total</span><span class="op" id="6934346">+</span><span class="ident" id="6934347">bs</span><span class="op" id="6934349">]</span><span class="op" id="6934350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934355">testEqual</span><span class="op" id="6934364">(</span><span class="ident" id="6934365">t</span><span class="op" id="6934366">,</span>&nbsp;<span class="string" id="6934368">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6934413">,</span>&nbsp;<span class="ident" id="6934415">bigtest</span><span class="op" id="6934422">.</span><span class="ident" id="6934423">encoded</span><span class="op" id="6934430">,</span>&nbsp;<span class="ident" id="6934432">total</span><span class="op" id="6934437">,</span>&nbsp;<span class="ident" id="6934439">n</span><span class="op" id="6934440">,</span>&nbsp;<span class="ident" id="6934442">err</span><span class="op" id="6934445">,</span>&nbsp;<span class="builtintype" id="6934447">error</span><span class="op" id="6934452">(</span><span class="ident" id="6934453">nil</span><span class="op" id="6934456">)</span><span class="op" id="6934457">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934462">total</span>&nbsp;<span class="op" id="6934468">+=</span>&nbsp;<span class="ident" id="6934471">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934479">testEqual</span><span class="op" id="6934488">(</span><span class="ident" id="6934489">t</span><span class="op" id="6934490">,</span>&nbsp;<span class="string" id="6934492">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6934525">,</span>&nbsp;<span class="ident" id="6934527">bs</span><span class="op" id="6934529">,</span>&nbsp;<span class="ident" id="6934531">bigtest</span><span class="op" id="6934538">.</span><span class="ident" id="6934539">encoded</span><span class="op" id="6934546">,</span>&nbsp;<span class="builtintype" id="6934548">string</span><span class="op" id="6934554">(</span><span class="ident" id="6934555">buf</span><span class="op" id="6934558">[</span><span class="num" id="6934559">0</span><span class="op" id="6934560">:</span><span class="ident" id="6934561">total</span><span class="op" id="6934566">]</span><span class="op" id="6934567">)</span><span class="op" id="6934568">,</span>&nbsp;<span class="ident" id="6934570">bigtest</span><span class="op" id="6934577">.</span><span class="ident" id="6934578">decoded</span><span class="op" id="6934585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934588">}</span><br>
<span class="lineno"></span><span class="op" id="6934590">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6934593">func</span>&nbsp;<span class="ident" id="6934598">TestDecodeCorrupt</span><span class="op" id="6934615">(</span><span class="ident" id="6934616">t</span>&nbsp;<span class="op" id="6934618">*</span><span class="ident" id="6934619">testing</span><span class="op" id="6934626">.</span><span class="ident" id="6934627">T</span><span class="op" id="6934628">)</span>&nbsp;<span class="op" id="6934630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934633">testCases</span>&nbsp;<span class="op" id="6934643">:=</span>&nbsp;<span class="op" id="6934646">[</span><span class="op" id="6934647">]</span><span class="keyword" id="6934648">struct</span>&nbsp;<span class="op" id="6934655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934659">input</span>&nbsp;&nbsp;<span class="builtintype" id="6934666">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6934675">offset</span>&nbsp;<span class="builtintype" id="6934682">int</span>&nbsp;<span class="comment" id="6934686">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934714">}</span><span class="op" id="6934715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934719">{</span><span class="string" id="6934720">&#34;&#34;</span><span class="op" id="6934722">,</span>&nbsp;<span class="op" id="6934724">-</span><span class="num" id="6934725">1</span><span class="op" id="6934726">}</span><span class="op" id="6934727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934731">{</span><span class="string" id="6934732">&#34;!!!!&#34;</span><span class="op" id="6934738">,</span>&nbsp;<span class="num" id="6934740">0</span><span class="op" id="6934741">}</span><span class="op" id="6934742">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934746">{</span><span class="string" id="6934747">&#34;====&#34;</span><span class="op" id="6934753">,</span>&nbsp;<span class="num" id="6934755">0</span><span class="op" id="6934756">}</span><span class="op" id="6934757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934761">{</span><span class="string" id="6934762">&#34;x===&#34;</span><span class="op" id="6934768">,</span>&nbsp;<span class="num" id="6934770">1</span><span class="op" id="6934771">}</span><span class="op" id="6934772">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934776">{</span><span class="string" id="6934777">&#34;=AAA&#34;</span><span class="op" id="6934783">,</span>&nbsp;<span class="num" id="6934785">0</span><span class="op" id="6934786">}</span><span class="op" id="6934787">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934791">{</span><span class="string" id="6934792">&#34;A=AA&#34;</span><span class="op" id="6934798">,</span>&nbsp;<span class="num" id="6934800">1</span><span class="op" id="6934801">}</span><span class="op" id="6934802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934806">{</span><span class="string" id="6934807">&#34;AA=A&#34;</span><span class="op" id="6934813">,</span>&nbsp;<span class="num" id="6934815">2</span><span class="op" id="6934816">}</span><span class="op" id="6934817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934821">{</span><span class="string" id="6934822">&#34;AA==A&#34;</span><span class="op" id="6934829">,</span>&nbsp;<span class="num" id="6934831">4</span><span class="op" id="6934832">}</span><span class="op" id="6934833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934837">{</span><span class="string" id="6934838">&#34;AAA=AAAA&#34;</span><span class="op" id="6934848">,</span>&nbsp;<span class="num" id="6934850">4</span><span class="op" id="6934851">}</span><span class="op" id="6934852">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934856">{</span><span class="string" id="6934857">&#34;AAAAA&#34;</span><span class="op" id="6934864">,</span>&nbsp;<span class="num" id="6934866">4</span><span class="op" id="6934867">}</span><span class="op" id="6934868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934872">{</span><span class="string" id="6934873">&#34;AAAAAA&#34;</span><span class="op" id="6934881">,</span>&nbsp;<span class="num" id="6934883">4</span><span class="op" id="6934884">}</span><span class="op" id="6934885">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934889">{</span><span class="string" id="6934890">&#34;A=&#34;</span><span class="op" id="6934894">,</span>&nbsp;<span class="num" id="6934896">1</span><span class="op" id="6934897">}</span><span class="op" id="6934898">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934902">{</span><span class="string" id="6934903">&#34;A==&#34;</span><span class="op" id="6934908">,</span>&nbsp;<span class="num" id="6934910">1</span><span class="op" id="6934911">}</span><span class="op" id="6934912">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934916">{</span><span class="string" id="6934917">&#34;AA=&#34;</span><span class="op" id="6934922">,</span>&nbsp;<span class="num" id="6934924">3</span><span class="op" id="6934925">}</span><span class="op" id="6934926">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934930">{</span><span class="string" id="6934931">&#34;AA==&#34;</span><span class="op" id="6934937">,</span>&nbsp;<span class="op" id="6934939">-</span><span class="num" id="6934940">1</span><span class="op" id="6934941">}</span><span class="op" id="6934942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934946">{</span><span class="string" id="6934947">&#34;AAA=&#34;</span><span class="op" id="6934953">,</span>&nbsp;<span class="op" id="6934955">-</span><span class="num" id="6934956">1</span><span class="op" id="6934957">}</span><span class="op" id="6934958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934962">{</span><span class="string" id="6934963">&#34;AAAA&#34;</span><span class="op" id="6934969">,</span>&nbsp;<span class="op" id="6934971">-</span><span class="num" id="6934972">1</span><span class="op" id="6934973">}</span><span class="op" id="6934974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934978">{</span><span class="string" id="6934979">&#34;AAAAAA=&#34;</span><span class="op" id="6934988">,</span>&nbsp;<span class="num" id="6934990">7</span><span class="op" id="6934991">}</span><span class="op" id="6934992">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6934996">{</span><span class="string" id="6934997">&#34;YWJjZA=====&#34;</span><span class="op" id="6935010">,</span>&nbsp;<span class="num" id="6935012">8</span><span class="op" id="6935013">}</span><span class="op" id="6935014">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935020">for</span>&nbsp;<span class="ident" id="6935024">_</span><span class="op" id="6935025">,</span>&nbsp;<span class="ident" id="6935027">tc</span>&nbsp;<span class="op" id="6935030">:=</span>&nbsp;<span class="keyword" id="6935033">range</span>&nbsp;<span class="ident" id="6935039">testCases</span>&nbsp;<span class="op" id="6935049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935053">dbuf</span>&nbsp;<span class="op" id="6935058">:=</span>&nbsp;<span class="builtinfunc" id="6935061">make</span><span class="op" id="6935065">(</span><span class="op" id="6935066">[</span><span class="op" id="6935067">]</span><span class="builtintype" id="6935068">byte</span><span class="op" id="6935072">,</span>&nbsp;<span class="ident" id="6935074">StdEncoding</span><span class="op" id="6935085">.</span><span class="ident" id="6935086">DecodedLen</span><span class="op" id="6935096">(</span><span class="builtinfunc" id="6935097">len</span><span class="op" id="6935100">(</span><span class="ident" id="6935101">tc</span><span class="op" id="6935103">.</span><span class="ident" id="6935104">input</span><span class="op" id="6935109">)</span><span class="op" id="6935110">)</span><span class="op" id="6935111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935115">_</span><span class="op" id="6935116">,</span>&nbsp;<span class="ident" id="6935118">err</span>&nbsp;<span class="op" id="6935122">:=</span>&nbsp;<span class="ident" id="6935125">StdEncoding</span><span class="op" id="6935136">.</span><span class="ident" id="6935137">Decode</span><span class="op" id="6935143">(</span><span class="ident" id="6935144">dbuf</span><span class="op" id="6935148">,</span>&nbsp;<span class="op" id="6935150">[</span><span class="op" id="6935151">]</span><span class="builtintype" id="6935152">byte</span><span class="op" id="6935156">(</span><span class="ident" id="6935157">tc</span><span class="op" id="6935159">.</span><span class="ident" id="6935160">input</span><span class="op" id="6935165">)</span><span class="op" id="6935166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935170">if</span>&nbsp;<span class="ident" id="6935173">tc</span><span class="op" id="6935175">.</span><span class="ident" id="6935176">offset</span>&nbsp;<span class="op" id="6935183">==</span>&nbsp;<span class="op" id="6935186">-</span><span class="num" id="6935187">1</span>&nbsp;<span class="op" id="6935189">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935194">if</span>&nbsp;<span class="ident" id="6935197">err</span>&nbsp;<span class="op" id="6935201">!=</span>&nbsp;<span class="ident" id="6935204">nil</span>&nbsp;<span class="op" id="6935208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935214">t</span><span class="op" id="6935215">.</span><span class="ident" id="6935216">Error</span><span class="op" id="6935221">(</span><span class="string" id="6935222">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="6935261">,</span>&nbsp;<span class="ident" id="6935263">tc</span><span class="op" id="6935265">.</span><span class="ident" id="6935266">input</span><span class="op" id="6935271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935281">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935292">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935296">switch</span>&nbsp;<span class="ident" id="6935303">err</span>&nbsp;<span class="op" id="6935307">:=</span>&nbsp;<span class="ident" id="6935310">err</span><span class="op" id="6935313">.</span><span class="op" id="6935314">(</span><span class="keyword" id="6935315">type</span><span class="op" id="6935319">)</span>&nbsp;<span class="op" id="6935321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935325">case</span>&nbsp;<span class="ident" id="6935330">CorruptInputError</span><span class="op" id="6935347">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935352">testEqual</span><span class="op" id="6935361">(</span><span class="ident" id="6935362">t</span><span class="op" id="6935363">,</span>&nbsp;<span class="string" id="6935365">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6935405">,</span>&nbsp;<span class="ident" id="6935407">tc</span><span class="op" id="6935409">.</span><span class="ident" id="6935410">input</span><span class="op" id="6935415">,</span>&nbsp;<span class="builtintype" id="6935417">int</span><span class="op" id="6935420">(</span><span class="ident" id="6935421">err</span><span class="op" id="6935424">)</span><span class="op" id="6935425">,</span>&nbsp;<span class="ident" id="6935427">tc</span><span class="op" id="6935429">.</span><span class="ident" id="6935430">offset</span><span class="op" id="6935436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935440">default</span><span class="op" id="6935447">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935452">t</span><span class="op" id="6935453">.</span><span class="ident" id="6935454">Error</span><span class="op" id="6935459">(</span><span class="string" id="6935460">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="6935500">,</span>&nbsp;<span class="ident" id="6935502">tc</span><span class="op" id="6935504">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935511">}</span><br>
<span class="lineno"></span><span class="op" id="6935513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6935516">func</span>&nbsp;<span class="ident" id="6935521">TestBig</span><span class="op" id="6935528">(</span><span class="ident" id="6935529">t</span>&nbsp;<span class="op" id="6935531">*</span><span class="ident" id="6935532">testing</span><span class="op" id="6935539">.</span><span class="ident" id="6935540">T</span><span class="op" id="6935541">)</span>&nbsp;<span class="op" id="6935543">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935546">n</span>&nbsp;<span class="op" id="6935548">:=</span>&nbsp;<span class="num" id="6935551">3</span><span class="op" id="6935552">*</span><span class="num" id="6935553">1000</span>&nbsp;<span class="op" id="6935558">+</span>&nbsp;<span class="num" id="6935560">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935563">raw</span>&nbsp;<span class="op" id="6935567">:=</span>&nbsp;<span class="builtinfunc" id="6935570">make</span><span class="op" id="6935574">(</span><span class="op" id="6935575">[</span><span class="op" id="6935576">]</span><span class="builtintype" id="6935577">byte</span><span class="op" id="6935581">,</span>&nbsp;<span class="ident" id="6935583">n</span><span class="op" id="6935584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935587">const</span>&nbsp;<span class="ident" id="6935593">alpha</span>&nbsp;<span class="op" id="6935599">=</span>&nbsp;<span class="string" id="6935601">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935667">for</span>&nbsp;<span class="ident" id="6935671">i</span>&nbsp;<span class="op" id="6935673">:=</span>&nbsp;<span class="num" id="6935676">0</span><span class="op" id="6935677">;</span>&nbsp;<span class="ident" id="6935679">i</span>&nbsp;<span class="op" id="6935681">&lt;</span>&nbsp;<span class="ident" id="6935683">n</span><span class="op" id="6935684">;</span>&nbsp;<span class="ident" id="6935686">i</span><span class="op" id="6935687">++</span>&nbsp;<span class="op" id="6935690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935694">raw</span><span class="op" id="6935697">[</span><span class="ident" id="6935698">i</span><span class="op" id="6935699">]</span>&nbsp;<span class="op" id="6935701">=</span>&nbsp;<span class="ident" id="6935703">alpha</span><span class="op" id="6935708">[</span><span class="ident" id="6935709">i</span><span class="op" id="6935710">%</span><span class="builtinfunc" id="6935711">len</span><span class="op" id="6935714">(</span><span class="ident" id="6935715">alpha</span><span class="op" id="6935720">)</span><span class="op" id="6935721">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935727">encoded</span>&nbsp;<span class="op" id="6935735">:=</span>&nbsp;<span class="builtinfunc" id="6935738">new</span><span class="op" id="6935741">(</span><span class="ident" id="6935742">bytes</span><span class="op" id="6935747">.</span><span class="ident" id="6935748">Buffer</span><span class="op" id="6935754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935757">w</span>&nbsp;<span class="op" id="6935759">:=</span>&nbsp;<span class="ident" id="6935762">NewEncoder</span><span class="op" id="6935772">(</span><span class="ident" id="6935773">StdEncoding</span><span class="op" id="6935784">,</span>&nbsp;<span class="ident" id="6935786">encoded</span><span class="op" id="6935793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935796">nn</span><span class="op" id="6935798">,</span>&nbsp;<span class="ident" id="6935800">err</span>&nbsp;<span class="op" id="6935804">:=</span>&nbsp;<span class="ident" id="6935807">w</span><span class="op" id="6935808">.</span><span class="ident" id="6935809">Write</span><span class="op" id="6935814">(</span><span class="ident" id="6935815">raw</span><span class="op" id="6935818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935821">if</span>&nbsp;<span class="ident" id="6935824">nn</span>&nbsp;<span class="op" id="6935827">!=</span>&nbsp;<span class="ident" id="6935830">n</span>&nbsp;<span class="op" id="6935832">||</span>&nbsp;<span class="ident" id="6935835">err</span>&nbsp;<span class="op" id="6935839">!=</span>&nbsp;<span class="ident" id="6935842">nil</span>&nbsp;<span class="op" id="6935846">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935850">t</span><span class="op" id="6935851">.</span><span class="ident" id="6935852">Fatalf</span><span class="op" id="6935858">(</span><span class="string" id="6935859">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6935901">,</span>&nbsp;<span class="ident" id="6935903">nn</span><span class="op" id="6935905">,</span>&nbsp;<span class="ident" id="6935907">err</span><span class="op" id="6935910">,</span>&nbsp;<span class="ident" id="6935912">n</span><span class="op" id="6935913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6935916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935919">err</span>&nbsp;<span class="op" id="6935923">=</span>&nbsp;<span class="ident" id="6935925">w</span><span class="op" id="6935926">.</span><span class="ident" id="6935927">Close</span><span class="op" id="6935932">(</span><span class="op" id="6935933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6935936">if</span>&nbsp;<span class="ident" id="6935939">err</span>&nbsp;<span class="op" id="6935943">!=</span>&nbsp;<span class="ident" id="6935946">nil</span>&nbsp;<span class="op" id="6935950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6935954">t</span><span class="op" id="6935955">.</span><span class="ident" id="6935956">Fatalf</span><span class="op" id="6935962">(</span><span class="string" id="6935963">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="6935994">,</span>&nbsp;<span class="ident" id="6935996">err</span><span class="op" id="6935999">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936005">decoded</span><span class="op" id="6936012">,</span>&nbsp;<span class="ident" id="6936014">err</span>&nbsp;<span class="op" id="6936018">:=</span>&nbsp;<span class="ident" id="6936021">ioutil</span><span class="op" id="6936027">.</span><span class="ident" id="6936028">ReadAll</span><span class="op" id="6936035">(</span><span class="ident" id="6936036">NewDecoder</span><span class="op" id="6936046">(</span><span class="ident" id="6936047">StdEncoding</span><span class="op" id="6936058">,</span>&nbsp;<span class="ident" id="6936060">encoded</span><span class="op" id="6936067">)</span><span class="op" id="6936068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936071">if</span>&nbsp;<span class="ident" id="6936074">err</span>&nbsp;<span class="op" id="6936078">!=</span>&nbsp;<span class="ident" id="6936081">nil</span>&nbsp;<span class="op" id="6936085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936089">t</span><span class="op" id="6936090">.</span><span class="ident" id="6936091">Fatalf</span><span class="op" id="6936097">(</span><span class="string" id="6936098">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="6936135">,</span>&nbsp;<span class="ident" id="6936137">err</span><span class="op" id="6936140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936143">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936147">if</span>&nbsp;<span class="op" id="6936150">!</span><span class="ident" id="6936151">bytes</span><span class="op" id="6936156">.</span><span class="ident" id="6936157">Equal</span><span class="op" id="6936162">(</span><span class="ident" id="6936163">raw</span><span class="op" id="6936166">,</span>&nbsp;<span class="ident" id="6936168">decoded</span><span class="op" id="6936175">)</span>&nbsp;<span class="op" id="6936177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936181">var</span>&nbsp;<span class="ident" id="6936185">i</span>&nbsp;<span class="builtintype" id="6936187">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936193">for</span>&nbsp;<span class="ident" id="6936197">i</span>&nbsp;<span class="op" id="6936199">=</span>&nbsp;<span class="num" id="6936201">0</span><span class="op" id="6936202">;</span>&nbsp;<span class="ident" id="6936204">i</span>&nbsp;<span class="op" id="6936206">&lt;</span>&nbsp;<span class="builtinfunc" id="6936208">len</span><span class="op" id="6936211">(</span><span class="ident" id="6936212">decoded</span><span class="op" id="6936219">)</span>&nbsp;<span class="op" id="6936221">&amp;&amp;</span>&nbsp;<span class="ident" id="6936224">i</span>&nbsp;<span class="op" id="6936226">&lt;</span>&nbsp;<span class="builtinfunc" id="6936228">len</span><span class="op" id="6936231">(</span><span class="ident" id="6936232">raw</span><span class="op" id="6936235">)</span><span class="op" id="6936236">;</span>&nbsp;<span class="ident" id="6936238">i</span><span class="op" id="6936239">++</span>&nbsp;<span class="op" id="6936242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936247">if</span>&nbsp;<span class="ident" id="6936250">decoded</span><span class="op" id="6936257">[</span><span class="ident" id="6936258">i</span><span class="op" id="6936259">]</span>&nbsp;<span class="op" id="6936261">!=</span>&nbsp;<span class="ident" id="6936264">raw</span><span class="op" id="6936267">[</span><span class="ident" id="6936268">i</span><span class="op" id="6936269">]</span>&nbsp;<span class="op" id="6936271">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936277">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936294">t</span><span class="op" id="6936295">.</span><span class="ident" id="6936296">Errorf</span><span class="op" id="6936302">(</span><span class="string" id="6936303">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="6936355">,</span>&nbsp;<span class="ident" id="6936357">n</span><span class="op" id="6936358">,</span>&nbsp;<span class="ident" id="6936360">i</span><span class="op" id="6936361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936364">}</span><br>
<span class="lineno">220</span><span class="op" id="6936366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6936369">func</span>&nbsp;<span class="ident" id="6936374">TestNewLineCharacters</span><span class="op" id="6936395">(</span><span class="ident" id="6936396">t</span>&nbsp;<span class="op" id="6936398">*</span><span class="ident" id="6936399">testing</span><span class="op" id="6936406">.</span><span class="ident" id="6936407">T</span><span class="op" id="6936408">)</span>&nbsp;<span class="op" id="6936410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6936413">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936483">const</span>&nbsp;<span class="ident" id="6936489">expected</span>&nbsp;<span class="op" id="6936498">=</span>&nbsp;<span class="string" id="6936500">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936508">examples</span>&nbsp;<span class="op" id="6936517">:=</span>&nbsp;<span class="op" id="6936520">[</span><span class="op" id="6936521">]</span><span class="builtintype" id="6936522">string</span><span class="op" id="6936528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936532">&#34;c3VyZQ==&#34;</span><span class="op" id="6936542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936546">&#34;c3VyZQ==\r&#34;</span><span class="op" id="6936558">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936562">&#34;c3VyZQ==\n&#34;</span><span class="op" id="6936574">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936578">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="6936592">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936596">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="6936610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936614">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="6936628">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936632">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="6936646">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936650">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="6936662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936666">&#34;c3VyZQ\n==&#34;</span><span class="op" id="6936678">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936682">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="6936694">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6936698">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="6936716">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936722">for</span>&nbsp;<span class="ident" id="6936726">_</span><span class="op" id="6936727">,</span>&nbsp;<span class="ident" id="6936729">e</span>&nbsp;<span class="op" id="6936731">:=</span>&nbsp;<span class="keyword" id="6936734">range</span>&nbsp;<span class="ident" id="6936740">examples</span>&nbsp;<span class="op" id="6936749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936753">buf</span><span class="op" id="6936756">,</span>&nbsp;<span class="ident" id="6936758">err</span>&nbsp;<span class="op" id="6936762">:=</span>&nbsp;<span class="ident" id="6936765">StdEncoding</span><span class="op" id="6936776">.</span><span class="ident" id="6936777">DecodeString</span><span class="op" id="6936789">(</span><span class="ident" id="6936790">e</span><span class="op" id="6936791">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936795">if</span>&nbsp;<span class="ident" id="6936798">err</span>&nbsp;<span class="op" id="6936802">!=</span>&nbsp;<span class="ident" id="6936805">nil</span>&nbsp;<span class="op" id="6936809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936814">t</span><span class="op" id="6936815">.</span><span class="ident" id="6936816">Errorf</span><span class="op" id="6936822">(</span><span class="string" id="6936823">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6936846">,</span>&nbsp;<span class="ident" id="6936848">e</span><span class="op" id="6936849">,</span>&nbsp;<span class="ident" id="6936851">err</span><span class="op" id="6936854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936859">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6936874">if</span>&nbsp;<span class="ident" id="6936877">s</span>&nbsp;<span class="op" id="6936879">:=</span>&nbsp;<span class="builtintype" id="6936882">string</span><span class="op" id="6936888">(</span><span class="ident" id="6936889">buf</span><span class="op" id="6936892">)</span><span class="op" id="6936893">;</span>&nbsp;<span class="ident" id="6936895">s</span>&nbsp;<span class="op" id="6936897">!=</span>&nbsp;<span class="ident" id="6936900">expected</span>&nbsp;<span class="op" id="6936909">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6936914">t</span><span class="op" id="6936915">.</span><span class="ident" id="6936916">Errorf</span><span class="op" id="6936922">(</span><span class="string" id="6936923">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6936949">,</span>&nbsp;<span class="ident" id="6936951">e</span><span class="op" id="6936952">,</span>&nbsp;<span class="ident" id="6936954">s</span><span class="op" id="6936955">,</span>&nbsp;<span class="ident" id="6936957">expected</span><span class="op" id="6936965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6936972">}</span><br>
<span class="lineno"></span><span class="op" id="6936974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6936977">type</span>&nbsp;<span class="ident" id="6936982">nextRead</span>&nbsp;<span class="keyword" id="6936991">struct</span>&nbsp;<span class="op" id="6936998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937001">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6937005">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6937011">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937031">err</span>&nbsp;<span class="builtintype" id="6937035">error</span>&nbsp;<span class="comment" id="6937041">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="6937060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6937063">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="6937123">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="6937167">type</span>&nbsp;<span class="ident" id="6937172">faultInjectReader</span>&nbsp;<span class="keyword" id="6937190">struct</span>&nbsp;<span class="op" id="6937197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937200">source</span>&nbsp;<span class="builtintype" id="6937207">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937215">nextc</span>&nbsp;&nbsp;<span class="op" id="6937222">&lt;-</span><span class="keyword" id="6937224">chan</span>&nbsp;<span class="ident" id="6937229">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="6937238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6937241">func</span>&nbsp;<span class="op" id="6937246">(</span><span class="ident" id="6937247">r</span>&nbsp;<span class="op" id="6937249">*</span><span class="ident" id="6937250">faultInjectReader</span><span class="op" id="6937267">)</span>&nbsp;<span class="ident" id="6937269">Read</span><span class="op" id="6937273">(</span><span class="ident" id="6937274">p</span>&nbsp;<span class="op" id="6937276">[</span><span class="op" id="6937277">]</span><span class="builtintype" id="6937278">byte</span><span class="op" id="6937282">)</span>&nbsp;<span class="op" id="6937284">(</span><span class="builtintype" id="6937285">int</span><span class="op" id="6937288">,</span>&nbsp;<span class="builtintype" id="6937290">error</span><span class="op" id="6937295">)</span>&nbsp;<span class="op" id="6937297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937300">nr</span>&nbsp;<span class="op" id="6937303">:=</span>&nbsp;<span class="op" id="6937306">&lt;-</span><span class="ident" id="6937308">r</span><span class="op" id="6937309">.</span><span class="ident" id="6937310">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937317">if</span>&nbsp;<span class="builtinfunc" id="6937320">len</span><span class="op" id="6937323">(</span><span class="ident" id="6937324">p</span><span class="op" id="6937325">)</span>&nbsp;<span class="op" id="6937327">&gt;</span>&nbsp;<span class="ident" id="6937329">nr</span><span class="op" id="6937331">.</span><span class="ident" id="6937332">n</span>&nbsp;<span class="op" id="6937334">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937338">p</span>&nbsp;<span class="op" id="6937340">=</span>&nbsp;<span class="ident" id="6937342">p</span><span class="op" id="6937343">[</span><span class="op" id="6937344">:</span><span class="ident" id="6937345">nr</span><span class="op" id="6937347">.</span><span class="ident" id="6937348">n</span><span class="op" id="6937349">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6937352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937355">n</span>&nbsp;<span class="op" id="6937357">:=</span>&nbsp;<span class="builtinfunc" id="6937360">copy</span><span class="op" id="6937364">(</span><span class="ident" id="6937365">p</span><span class="op" id="6937366">,</span>&nbsp;<span class="ident" id="6937368">r</span><span class="op" id="6937369">.</span><span class="ident" id="6937370">source</span><span class="op" id="6937376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937379">r</span><span class="op" id="6937380">.</span><span class="ident" id="6937381">source</span>&nbsp;<span class="op" id="6937388">=</span>&nbsp;<span class="ident" id="6937390">r</span><span class="op" id="6937391">.</span><span class="ident" id="6937392">source</span><span class="op" id="6937398">[</span><span class="ident" id="6937399">n</span><span class="op" id="6937400">:</span><span class="op" id="6937401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937404">return</span>&nbsp;<span class="ident" id="6937411">n</span><span class="op" id="6937412">,</span>&nbsp;<span class="ident" id="6937414">nr</span><span class="op" id="6937416">.</span><span class="ident" id="6937417">err</span><br>
<span class="lineno">270</span><span class="op" id="6937421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6937424">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="6937488">func</span>&nbsp;<span class="ident" id="6937493">TestDecoderIssue3577</span><span class="op" id="6937513">(</span><span class="ident" id="6937514">t</span>&nbsp;<span class="op" id="6937516">*</span><span class="ident" id="6937517">testing</span><span class="op" id="6937524">.</span><span class="ident" id="6937525">T</span><span class="op" id="6937526">)</span>&nbsp;<span class="op" id="6937528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937531">next</span>&nbsp;<span class="op" id="6937536">:=</span>&nbsp;<span class="builtinfunc" id="6937539">make</span><span class="op" id="6937543">(</span><span class="keyword" id="6937544">chan</span>&nbsp;<span class="ident" id="6937549">nextRead</span><span class="op" id="6937557">,</span>&nbsp;<span class="num" id="6937559">10</span><span class="op" id="6937561">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937564">wantErr</span>&nbsp;<span class="op" id="6937572">:=</span>&nbsp;<span class="ident" id="6937575">errors</span><span class="op" id="6937581">.</span><span class="ident" id="6937582">New</span><span class="op" id="6937585">(</span><span class="string" id="6937586">&#34;my&nbsp;error&#34;</span><span class="op" id="6937596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937599">next</span>&nbsp;<span class="op" id="6937604">&lt;-</span>&nbsp;<span class="ident" id="6937607">nextRead</span><span class="op" id="6937615">{</span><span class="num" id="6937616">5</span><span class="op" id="6937617">,</span>&nbsp;<span class="ident" id="6937619">nil</span><span class="op" id="6937622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937625">next</span>&nbsp;<span class="op" id="6937630">&lt;-</span>&nbsp;<span class="ident" id="6937633">nextRead</span><span class="op" id="6937641">{</span><span class="num" id="6937642">10</span><span class="op" id="6937644">,</span>&nbsp;<span class="ident" id="6937646">wantErr</span><span class="op" id="6937653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937656">next</span>&nbsp;<span class="op" id="6937661">&lt;-</span>&nbsp;<span class="ident" id="6937664">nextRead</span><span class="op" id="6937672">{</span><span class="num" id="6937673">0</span><span class="op" id="6937674">,</span>&nbsp;<span class="ident" id="6937676">wantErr</span><span class="op" id="6937683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937686">d</span>&nbsp;<span class="op" id="6937688">:=</span>&nbsp;<span class="ident" id="6937691">NewDecoder</span><span class="op" id="6937701">(</span><span class="ident" id="6937702">StdEncoding</span><span class="op" id="6937713">,</span>&nbsp;<span class="op" id="6937715">&amp;</span><span class="ident" id="6937716">faultInjectReader</span><span class="op" id="6937733">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937737">source</span><span class="op" id="6937743">:</span>&nbsp;<span class="string" id="6937745">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6937795">,</span>&nbsp;<span class="comment" id="6937797">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937818">nextc</span><span class="op" id="6937823">:</span>&nbsp;&nbsp;<span class="ident" id="6937826">next</span><span class="op" id="6937830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6937833">}</span><span class="op" id="6937834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937837">errc</span>&nbsp;<span class="op" id="6937842">:=</span>&nbsp;<span class="builtinfunc" id="6937845">make</span><span class="op" id="6937849">(</span><span class="keyword" id="6937850">chan</span>&nbsp;<span class="builtintype" id="6937855">error</span><span class="op" id="6937860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937863">go</span>&nbsp;<span class="keyword" id="6937866">func</span><span class="op" id="6937870">(</span><span class="op" id="6937871">)</span>&nbsp;<span class="op" id="6937873">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937877">_</span><span class="op" id="6937878">,</span>&nbsp;<span class="ident" id="6937880">err</span>&nbsp;<span class="op" id="6937884">:=</span>&nbsp;<span class="ident" id="6937887">ioutil</span><span class="op" id="6937893">.</span><span class="ident" id="6937894">ReadAll</span><span class="op" id="6937901">(</span><span class="ident" id="6937902">d</span><span class="op" id="6937903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937907">errc</span>&nbsp;<span class="op" id="6937912">&lt;-</span>&nbsp;<span class="ident" id="6937915">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6937920">}</span><span class="op" id="6937921">(</span><span class="op" id="6937922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937925">select</span>&nbsp;<span class="op" id="6937932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937935">case</span>&nbsp;<span class="ident" id="6937940">err</span>&nbsp;<span class="op" id="6937944">:=</span>&nbsp;<span class="op" id="6937947">&lt;-</span><span class="ident" id="6937949">errc</span><span class="op" id="6937953">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6937957">if</span>&nbsp;<span class="ident" id="6937960">err</span>&nbsp;<span class="op" id="6937964">!=</span>&nbsp;<span class="ident" id="6937967">wantErr</span>&nbsp;<span class="op" id="6937975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6937980">t</span><span class="op" id="6937981">.</span><span class="ident" id="6937982">Errorf</span><span class="op" id="6937988">(</span><span class="string" id="6937989">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6938012">,</span>&nbsp;<span class="ident" id="6938014">err</span><span class="op" id="6938017">,</span>&nbsp;<span class="ident" id="6938019">wantErr</span><span class="op" id="6938026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6938033">case</span>&nbsp;<span class="op" id="6938038">&lt;-</span><span class="ident" id="6938040">time</span><span class="op" id="6938044">.</span><span class="ident" id="6938045">After</span><span class="op" id="6938050">(</span><span class="num" id="6938051">5</span>&nbsp;<span class="op" id="6938053">*</span>&nbsp;<span class="ident" id="6938055">time</span><span class="op" id="6938059">.</span><span class="ident" id="6938060">Second</span><span class="op" id="6938066">)</span><span class="op" id="6938067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938071">t</span><span class="op" id="6938072">.</span><span class="ident" id="6938073">Errorf</span><span class="op" id="6938079">(</span><span class="string" id="6938080">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="6938133">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6938136">}</span><br>
<span class="lineno"></span><span class="op" id="6938138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6938141">func</span>&nbsp;<span class="ident" id="6938146">TestDecoderIssue4779</span><span class="op" id="6938166">(</span><span class="ident" id="6938167">t</span>&nbsp;<span class="op" id="6938169">*</span><span class="ident" id="6938170">testing</span><span class="op" id="6938177">.</span><span class="ident" id="6938178">T</span><span class="op" id="6938179">)</span>&nbsp;<span class="op" id="6938181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6938184">encoded</span>&nbsp;<span class="op" id="6938192">:=</span>&nbsp;<span class="string" id="6938195">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939226">encodedShort</span>&nbsp;<span class="op" id="6939239">:=</span>&nbsp;<span class="ident" id="6939242">strings</span><span class="op" id="6939249">.</span><span class="ident" id="6939250">Replace</span><span class="op" id="6939257">(</span><span class="ident" id="6939258">encoded</span><span class="op" id="6939265">,</span>&nbsp;<span class="string" id="6939267">&#34;\n&#34;</span><span class="op" id="6939271">,</span>&nbsp;<span class="string" id="6939273">&#34;&#34;</span><span class="op" id="6939275">,</span>&nbsp;<span class="op" id="6939277">-</span><span class="num" id="6939278">1</span><span class="op" id="6939279">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939283">dec</span>&nbsp;<span class="op" id="6939287">:=</span>&nbsp;<span class="ident" id="6939290">NewDecoder</span><span class="op" id="6939300">(</span><span class="ident" id="6939301">StdEncoding</span><span class="op" id="6939312">,</span>&nbsp;<span class="ident" id="6939314">strings</span><span class="op" id="6939321">.</span><span class="ident" id="6939322">NewReader</span><span class="op" id="6939331">(</span><span class="ident" id="6939332">encoded</span><span class="op" id="6939339">)</span><span class="op" id="6939340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939343">res1</span><span class="op" id="6939347">,</span>&nbsp;<span class="ident" id="6939349">err</span>&nbsp;<span class="op" id="6939353">:=</span>&nbsp;<span class="ident" id="6939356">ioutil</span><span class="op" id="6939362">.</span><span class="ident" id="6939363">ReadAll</span><span class="op" id="6939370">(</span><span class="ident" id="6939371">dec</span><span class="op" id="6939374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939377">if</span>&nbsp;<span class="ident" id="6939380">err</span>&nbsp;<span class="op" id="6939384">!=</span>&nbsp;<span class="ident" id="6939387">nil</span>&nbsp;<span class="op" id="6939391">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939395">t</span><span class="op" id="6939396">.</span><span class="ident" id="6939397">Errorf</span><span class="op" id="6939403">(</span><span class="string" id="6939404">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6939424">,</span>&nbsp;<span class="ident" id="6939426">err</span><span class="op" id="6939429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939436">dec</span>&nbsp;<span class="op" id="6939440">=</span>&nbsp;<span class="ident" id="6939442">NewDecoder</span><span class="op" id="6939452">(</span><span class="ident" id="6939453">StdEncoding</span><span class="op" id="6939464">,</span>&nbsp;<span class="ident" id="6939466">strings</span><span class="op" id="6939473">.</span><span class="ident" id="6939474">NewReader</span><span class="op" id="6939483">(</span><span class="ident" id="6939484">encodedShort</span><span class="op" id="6939496">)</span><span class="op" id="6939497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939500">var</span>&nbsp;<span class="ident" id="6939504">res2</span>&nbsp;<span class="op" id="6939509">[</span><span class="op" id="6939510">]</span><span class="builtintype" id="6939511">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939517">res2</span><span class="op" id="6939521">,</span>&nbsp;<span class="ident" id="6939523">err</span>&nbsp;<span class="op" id="6939527">=</span>&nbsp;<span class="ident" id="6939529">ioutil</span><span class="op" id="6939535">.</span><span class="ident" id="6939536">ReadAll</span><span class="op" id="6939543">(</span><span class="ident" id="6939544">dec</span><span class="op" id="6939547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939550">if</span>&nbsp;<span class="ident" id="6939553">err</span>&nbsp;<span class="op" id="6939557">!=</span>&nbsp;<span class="ident" id="6939560">nil</span>&nbsp;<span class="op" id="6939564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939568">t</span><span class="op" id="6939569">.</span><span class="ident" id="6939570">Errorf</span><span class="op" id="6939576">(</span><span class="string" id="6939577">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6939597">,</span>&nbsp;<span class="ident" id="6939599">err</span><span class="op" id="6939602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939609">if</span>&nbsp;<span class="op" id="6939612">!</span><span class="ident" id="6939613">bytes</span><span class="op" id="6939618">.</span><span class="ident" id="6939619">Equal</span><span class="op" id="6939624">(</span><span class="ident" id="6939625">res1</span><span class="op" id="6939629">,</span>&nbsp;<span class="ident" id="6939631">res2</span><span class="op" id="6939635">)</span>&nbsp;<span class="op" id="6939637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939641">t</span><span class="op" id="6939642">.</span><span class="ident" id="6939643">Error</span><span class="op" id="6939648">(</span><span class="string" id="6939649">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="6939676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939679">}</span><br>
<span class="lineno"></span><span class="op" id="6939681">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6939684">func</span>&nbsp;<span class="ident" id="6939689">TestDecoderIssue7733</span><span class="op" id="6939709">(</span><span class="ident" id="6939710">t</span>&nbsp;<span class="op" id="6939712">*</span><span class="ident" id="6939713">testing</span><span class="op" id="6939720">.</span><span class="ident" id="6939721">T</span><span class="op" id="6939722">)</span>&nbsp;<span class="op" id="6939724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939727">s</span><span class="op" id="6939728">,</span>&nbsp;<span class="ident" id="6939730">err</span>&nbsp;<span class="op" id="6939734">:=</span>&nbsp;<span class="ident" id="6939737">StdEncoding</span><span class="op" id="6939748">.</span><span class="ident" id="6939749">DecodeString</span><span class="op" id="6939761">(</span><span class="string" id="6939762">&#34;YWJjZA=====&#34;</span><span class="op" id="6939775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939778">want</span>&nbsp;<span class="op" id="6939783">:=</span>&nbsp;<span class="ident" id="6939786">CorruptInputError</span><span class="op" id="6939803">(</span><span class="num" id="6939804">8</span><span class="op" id="6939805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939808">if</span>&nbsp;<span class="op" id="6939811">!</span><span class="ident" id="6939812">reflect</span><span class="op" id="6939819">.</span><span class="ident" id="6939820">DeepEqual</span><span class="op" id="6939829">(</span><span class="ident" id="6939830">want</span><span class="op" id="6939834">,</span>&nbsp;<span class="ident" id="6939836">err</span><span class="op" id="6939839">)</span>&nbsp;<span class="op" id="6939841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939845">t</span><span class="op" id="6939846">.</span><span class="ident" id="6939847">Errorf</span><span class="op" id="6939853">(</span><span class="string" id="6939854">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="6939893">,</span>&nbsp;<span class="ident" id="6939895">err</span><span class="op" id="6939898">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6939904">if</span>&nbsp;<span class="builtintype" id="6939907">string</span><span class="op" id="6939913">(</span><span class="ident" id="6939914">s</span><span class="op" id="6939915">)</span>&nbsp;<span class="op" id="6939917">!=</span>&nbsp;<span class="string" id="6939920">&#34;abcd&#34;</span>&nbsp;<span class="op" id="6939927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6939931">t</span><span class="op" id="6939932">.</span><span class="ident" id="6939933">Errorf</span><span class="op" id="6939939">(</span><span class="string" id="6939940">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="6939970">,</span>&nbsp;<span class="ident" id="6939972">s</span><span class="op" id="6939973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6939976">}</span><br>
<span class="lineno"></span><span class="op" id="6939978">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6939981">func</span>&nbsp;<span class="ident" id="6939986">BenchmarkEncodeToString</span><span class="op" id="6940009">(</span><span class="ident" id="6940010">b</span>&nbsp;<span class="op" id="6940012">*</span><span class="ident" id="6940013">testing</span><span class="op" id="6940020">.</span><span class="ident" id="6940021">B</span><span class="op" id="6940022">)</span>&nbsp;<span class="op" id="6940024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940027">data</span>&nbsp;<span class="op" id="6940032">:=</span>&nbsp;<span class="builtinfunc" id="6940035">make</span><span class="op" id="6940039">(</span><span class="op" id="6940040">[</span><span class="op" id="6940041">]</span><span class="builtintype" id="6940042">byte</span><span class="op" id="6940046">,</span>&nbsp;<span class="num" id="6940048">8192</span><span class="op" id="6940052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940055">b</span><span class="op" id="6940056">.</span><span class="ident" id="6940057">SetBytes</span><span class="op" id="6940065">(</span><span class="ident" id="6940066">int64</span><span class="op" id="6940071">(</span><span class="builtinfunc" id="6940072">len</span><span class="op" id="6940075">(</span><span class="ident" id="6940076">data</span><span class="op" id="6940080">)</span><span class="op" id="6940081">)</span><span class="op" id="6940082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940085">for</span>&nbsp;<span class="ident" id="6940089">i</span>&nbsp;<span class="op" id="6940091">:=</span>&nbsp;<span class="num" id="6940094">0</span><span class="op" id="6940095">;</span>&nbsp;<span class="ident" id="6940097">i</span>&nbsp;<span class="op" id="6940099">&lt;</span>&nbsp;<span class="ident" id="6940101">b</span><span class="op" id="6940102">.</span><span class="ident" id="6940103">N</span><span class="op" id="6940104">;</span>&nbsp;<span class="ident" id="6940106">i</span><span class="op" id="6940107">++</span>&nbsp;<span class="op" id="6940110">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940114">StdEncoding</span><span class="op" id="6940125">.</span><span class="ident" id="6940126">EncodeToString</span><span class="op" id="6940140">(</span><span class="ident" id="6940141">data</span><span class="op" id="6940145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940148">}</span><br>
<span class="lineno"></span><span class="op" id="6940150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6940153">func</span>&nbsp;<span class="ident" id="6940158">BenchmarkDecodeString</span><span class="op" id="6940179">(</span><span class="ident" id="6940180">b</span>&nbsp;<span class="op" id="6940182">*</span><span class="ident" id="6940183">testing</span><span class="op" id="6940190">.</span><span class="ident" id="6940191">B</span><span class="op" id="6940192">)</span>&nbsp;<span class="op" id="6940194">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940197">data</span>&nbsp;<span class="op" id="6940202">:=</span>&nbsp;<span class="ident" id="6940205">StdEncoding</span><span class="op" id="6940216">.</span><span class="ident" id="6940217">EncodeToString</span><span class="op" id="6940231">(</span><span class="builtinfunc" id="6940232">make</span><span class="op" id="6940236">(</span><span class="op" id="6940237">[</span><span class="op" id="6940238">]</span><span class="builtintype" id="6940239">byte</span><span class="op" id="6940243">,</span>&nbsp;<span class="num" id="6940245">8192</span><span class="op" id="6940249">)</span><span class="op" id="6940250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940253">b</span><span class="op" id="6940254">.</span><span class="ident" id="6940255">SetBytes</span><span class="op" id="6940263">(</span><span class="ident" id="6940264">int64</span><span class="op" id="6940269">(</span><span class="builtinfunc" id="6940270">len</span><span class="op" id="6940273">(</span><span class="ident" id="6940274">data</span><span class="op" id="6940278">)</span><span class="op" id="6940279">)</span><span class="op" id="6940280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6940283">for</span>&nbsp;<span class="ident" id="6940287">i</span>&nbsp;<span class="op" id="6940289">:=</span>&nbsp;<span class="num" id="6940292">0</span><span class="op" id="6940293">;</span>&nbsp;<span class="ident" id="6940295">i</span>&nbsp;<span class="op" id="6940297">&lt;</span>&nbsp;<span class="ident" id="6940299">b</span><span class="op" id="6940300">.</span><span class="ident" id="6940301">N</span><span class="op" id="6940302">;</span>&nbsp;<span class="ident" id="6940304">i</span><span class="op" id="6940305">++</span>&nbsp;<span class="op" id="6940308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6940312">StdEncoding</span><span class="op" id="6940323">.</span><span class="ident" id="6940324">DecodeString</span><span class="op" id="6940336">(</span><span class="ident" id="6940337">data</span><span class="op" id="6940341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6940344">}</span><br>
<span class="lineno">360</span><span class="op" id="6940346">}</span>
</div>
</body>
</html>
