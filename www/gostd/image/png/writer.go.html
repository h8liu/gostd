<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6168932">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6168987">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6169041">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6169092">package</span>&nbsp;<span class="ident" id="6169100">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169105">import</span>&nbsp;<span class="op" id="6169112">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169115">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169124">&#34;compress/zlib&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169141">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169155">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169164">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169179">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6169185">&#34;strconv&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6169195">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6169198">//&nbsp;Encoder&nbsp;configures&nbsp;encoding&nbsp;PNG&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="6169241">type</span>&nbsp;<span class="ident" id="6169246">Encoder</span>&nbsp;<span class="keyword" id="6169254">struct</span>&nbsp;<span class="op" id="6169261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169264">CompressionLevel</span>&nbsp;<span class="ident" id="6169281"><a href="/gostd/image/png/writer.go.html#6169466">CompressionLevel</a></span><br>
<span class="lineno">20</span><span class="op" id="6169298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169301">type</span>&nbsp;<span class="ident" id="6169306">encoder</span>&nbsp;<span class="keyword" id="6169314">struct</span>&nbsp;<span class="op" id="6169321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169324">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169331">*</span><span class="ident" id="6169332"><a href="/gostd/image/png/writer.go.html#6169246">Encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169341">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169348"><a href="/gostd/image/png/writer.go.html#6169179">io</a></span><span class="op" id="6169350">.</span><span class="ident" id="6169351"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169359">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169366"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6169371">.</span><span class="ident" id="6169372"><a href="/gostd/image/image.go.html#5154907">Image</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169379">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6169386">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169391">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6169398">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169405">header</span>&nbsp;<span class="op" id="6169412">[</span><span class="num" id="6169413">8</span><span class="op" id="6169414">]</span><span class="builtintype" id="6169415">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169421">footer</span>&nbsp;<span class="op" id="6169428">[</span><span class="num" id="6169429">4</span><span class="op" id="6169430">]</span><span class="builtintype" id="6169431">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169437">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6169444">[</span><span class="num" id="6169445">4</span>&nbsp;<span class="op" id="6169447">*</span>&nbsp;<span class="num" id="6169449">256</span><span class="op" id="6169452">]</span><span class="builtintype" id="6169453">byte</span><br>
<span class="lineno"></span><span class="op" id="6169458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169461">type</span>&nbsp;<span class="ident" id="6169466">CompressionLevel</span>&nbsp;<span class="builtintype" id="6169483">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="6169488">const</span>&nbsp;<span class="op" id="6169494">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169497">DefaultCompression</span>&nbsp;<span class="ident" id="6169516"><a href="/gostd/image/png/writer.go.html#6169466">CompressionLevel</a></span>&nbsp;<span class="op" id="6169533">=</span>&nbsp;<span class="num" id="6169535">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169538">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169557"><a href="/gostd/image/png/writer.go.html#6169466">CompressionLevel</a></span>&nbsp;<span class="op" id="6169574">=</span>&nbsp;<span class="op" id="6169576">-</span><span class="num" id="6169577">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169580">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169599"><a href="/gostd/image/png/writer.go.html#6169466">CompressionLevel</a></span>&nbsp;<span class="op" id="6169616">=</span>&nbsp;<span class="op" id="6169618">-</span><span class="num" id="6169619">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169622">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169641"><a href="/gostd/image/png/writer.go.html#6169466">CompressionLevel</a></span>&nbsp;<span class="op" id="6169658">=</span>&nbsp;<span class="op" id="6169660">-</span><span class="num" id="6169661">3</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6169665">//&nbsp;Positive&nbsp;CompressionLevel&nbsp;values&nbsp;are&nbsp;reserved&nbsp;to&nbsp;mean&nbsp;a&nbsp;numeric&nbsp;zlib</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6169738">//&nbsp;compression&nbsp;level,&nbsp;although&nbsp;that&nbsp;is&nbsp;not&nbsp;implemented&nbsp;yet.</span><br>
<span class="lineno"></span><span class="op" id="6169798">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6169801">//&nbsp;Big-endian.</span><br>
<span class="lineno"></span><span class="keyword" id="6169816">func</span>&nbsp;<span class="ident" id="6169821">writeUint32</span><span class="op" id="6169832">(</span><span class="ident" id="6169833">b</span>&nbsp;<span class="op" id="6169835">[</span><span class="op" id="6169836">]</span><span class="builtintype" id="6169837">uint8</span><span class="op" id="6169842">,</span>&nbsp;<span class="ident" id="6169844">u</span>&nbsp;<span class="builtintype" id="6169846">uint32</span><span class="op" id="6169852">)</span>&nbsp;<span class="op" id="6169854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169857"><a href="/gostd/image/png/writer.go.html#6169833">b</a></span><span class="op" id="6169858">[</span><span class="num" id="6169859">0</span><span class="op" id="6169860">]</span>&nbsp;<span class="op" id="6169862">=</span>&nbsp;<span class="builtintype" id="6169864">uint8</span><span class="op" id="6169869">(</span><span class="ident" id="6169870"><a href="/gostd/image/png/writer.go.html#6169844">u</a></span>&nbsp;<span class="op" id="6169872">&gt;&gt;</span>&nbsp;<span class="num" id="6169875">24</span><span class="op" id="6169877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169880"><a href="/gostd/image/png/writer.go.html#6169833">b</a></span><span class="op" id="6169881">[</span><span class="num" id="6169882">1</span><span class="op" id="6169883">]</span>&nbsp;<span class="op" id="6169885">=</span>&nbsp;<span class="builtintype" id="6169887">uint8</span><span class="op" id="6169892">(</span><span class="ident" id="6169893"><a href="/gostd/image/png/writer.go.html#6169844">u</a></span>&nbsp;<span class="op" id="6169895">&gt;&gt;</span>&nbsp;<span class="num" id="6169898">16</span><span class="op" id="6169900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169903"><a href="/gostd/image/png/writer.go.html#6169833">b</a></span><span class="op" id="6169904">[</span><span class="num" id="6169905">2</span><span class="op" id="6169906">]</span>&nbsp;<span class="op" id="6169908">=</span>&nbsp;<span class="builtintype" id="6169910">uint8</span><span class="op" id="6169915">(</span><span class="ident" id="6169916"><a href="/gostd/image/png/writer.go.html#6169844">u</a></span>&nbsp;<span class="op" id="6169918">&gt;&gt;</span>&nbsp;<span class="num" id="6169921">8</span><span class="op" id="6169922">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169925"><a href="/gostd/image/png/writer.go.html#6169833">b</a></span><span class="op" id="6169926">[</span><span class="num" id="6169927">3</span><span class="op" id="6169928">]</span>&nbsp;<span class="op" id="6169930">=</span>&nbsp;<span class="builtintype" id="6169932">uint8</span><span class="op" id="6169937">(</span><span class="ident" id="6169938"><a href="/gostd/image/png/writer.go.html#6169844">u</a></span>&nbsp;<span class="op" id="6169940">&gt;&gt;</span>&nbsp;<span class="num" id="6169943">0</span><span class="op" id="6169944">)</span><br>
<span class="lineno"></span><span class="op" id="6169946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6169949">type</span>&nbsp;<span class="ident" id="6169954">opaquer</span>&nbsp;<span class="keyword" id="6169962">interface</span>&nbsp;<span class="op" id="6169972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6169975">Opaque</span><span class="op" id="6169981">(</span><span class="op" id="6169982">)</span>&nbsp;<span class="builtintype" id="6169984">bool</span><br>
<span class="lineno">55</span><span class="op" id="6169989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6169992">//&nbsp;Returns&nbsp;whether&nbsp;or&nbsp;not&nbsp;the&nbsp;image&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span><span class="keyword" id="6170045">func</span>&nbsp;<span class="ident" id="6170050">opaque</span><span class="op" id="6170056">(</span><span class="ident" id="6170057">m</span>&nbsp;<span class="ident" id="6170059"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6170064">.</span><span class="ident" id="6170065"><a href="/gostd/image/image.go.html#5154907">Image</a></span><span class="op" id="6170070">)</span>&nbsp;<span class="builtintype" id="6170072">bool</span>&nbsp;<span class="op" id="6170077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170080">if</span>&nbsp;<span class="ident" id="6170083">o</span><span class="op" id="6170084">,</span>&nbsp;<span class="ident" id="6170086">ok</span>&nbsp;<span class="op" id="6170089">:=</span>&nbsp;<span class="ident" id="6170092"><a href="/gostd/image/png/writer.go.html#6170057">m</a></span><span class="op" id="6170093">.</span><span class="op" id="6170094">(</span><span class="ident" id="6170095"><a href="/gostd/image/png/writer.go.html#6169954">opaquer</a></span><span class="op" id="6170102">)</span><span class="op" id="6170103">;</span>&nbsp;<span class="ident" id="6170105"><a href="/gostd/image/png/writer.go.html#6170086">ok</a></span>&nbsp;<span class="op" id="6170108">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170112">return</span>&nbsp;<span class="ident" id="6170119"><a href="/gostd/image/png/writer.go.html#6170083">o</a></span><span class="op" id="6170120">.</span><span class="ident" id="6170121"><a href="/gostd/image/png/writer.go.html#6169975">Opaque</a></span><span class="op" id="6170127">(</span><span class="op" id="6170128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170134">b</span>&nbsp;<span class="op" id="6170136">:=</span>&nbsp;<span class="ident" id="6170139"><a href="/gostd/image/png/writer.go.html#6170057">m</a></span><span class="op" id="6170140">.</span><span class="ident" id="6170141"><a href="/gostd/image/image.go.html#5155130">Bounds</a></span><span class="op" id="6170147">(</span><span class="op" id="6170148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170151">for</span>&nbsp;<span class="ident" id="6170155">y</span>&nbsp;<span class="op" id="6170157">:=</span>&nbsp;<span class="ident" id="6170160"><a href="/gostd/image/png/writer.go.html#6170134">b</a></span><span class="op" id="6170161">.</span><span class="ident" id="6170162"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6170165">.</span><span class="ident" id="6170166"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6170167">;</span>&nbsp;<span class="ident" id="6170169"><a href="/gostd/image/png/writer.go.html#6170155">y</a></span>&nbsp;<span class="op" id="6170171">&lt;</span>&nbsp;<span class="ident" id="6170173"><a href="/gostd/image/png/writer.go.html#6170134">b</a></span><span class="op" id="6170174">.</span><span class="ident" id="6170175"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6170178">.</span><span class="ident" id="6170179"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6170180">;</span>&nbsp;<span class="ident" id="6170182"><a href="/gostd/image/png/writer.go.html#6170155">y</a></span><span class="op" id="6170183">++</span>&nbsp;<span class="op" id="6170186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170190">for</span>&nbsp;<span class="ident" id="6170194">x</span>&nbsp;<span class="op" id="6170196">:=</span>&nbsp;<span class="ident" id="6170199"><a href="/gostd/image/png/writer.go.html#6170134">b</a></span><span class="op" id="6170200">.</span><span class="ident" id="6170201"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6170204">.</span><span class="ident" id="6170205"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6170206">;</span>&nbsp;<span class="ident" id="6170208"><a href="/gostd/image/png/writer.go.html#6170194">x</a></span>&nbsp;<span class="op" id="6170210">&lt;</span>&nbsp;<span class="ident" id="6170212"><a href="/gostd/image/png/writer.go.html#6170134">b</a></span><span class="op" id="6170213">.</span><span class="ident" id="6170214"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6170217">.</span><span class="ident" id="6170218"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6170219">;</span>&nbsp;<span class="ident" id="6170221"><a href="/gostd/image/png/writer.go.html#6170194">x</a></span><span class="op" id="6170222">++</span>&nbsp;<span class="op" id="6170225">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170230">_</span><span class="op" id="6170231">,</span>&nbsp;<span class="ident" id="6170233">_</span><span class="op" id="6170234">,</span>&nbsp;<span class="ident" id="6170236">_</span><span class="op" id="6170237">,</span>&nbsp;<span class="ident" id="6170239">a</span>&nbsp;<span class="op" id="6170241">:=</span>&nbsp;<span class="ident" id="6170244"><a href="/gostd/image/png/writer.go.html#6170057">m</a></span><span class="op" id="6170245">.</span><span class="ident" id="6170246"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6170248">(</span><span class="ident" id="6170249"><a href="/gostd/image/png/writer.go.html#6170194">x</a></span><span class="op" id="6170250">,</span>&nbsp;<span class="ident" id="6170252"><a href="/gostd/image/png/writer.go.html#6170155">y</a></span><span class="op" id="6170253">)</span><span class="op" id="6170254">.</span><span class="ident" id="6170255"><a href="/gostd/image/color/color.go.html#5185453">RGBA</a></span><span class="op" id="6170259">(</span><span class="op" id="6170260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170265">if</span>&nbsp;<span class="ident" id="6170268"><a href="/gostd/image/png/writer.go.html#6170239">a</a></span>&nbsp;<span class="op" id="6170270">!=</span>&nbsp;<span class="num" id="6170273">0xffff</span>&nbsp;<span class="op" id="6170280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170286">return</span>&nbsp;<span class="builtintype" id="6170293">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170306">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170312">return</span>&nbsp;<span class="builtintype" id="6170319">true</span><br>
<span class="lineno"></span><span class="op" id="6170324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6170327">//&nbsp;The&nbsp;absolute&nbsp;value&nbsp;of&nbsp;a&nbsp;byte&nbsp;interpreted&nbsp;as&nbsp;a&nbsp;signed&nbsp;int8.</span><br>
<span class="lineno">75</span><span class="keyword" id="6170389">func</span>&nbsp;<span class="ident" id="6170394">abs8</span><span class="op" id="6170398">(</span><span class="ident" id="6170399">d</span>&nbsp;<span class="builtintype" id="6170401">uint8</span><span class="op" id="6170406">)</span>&nbsp;<span class="builtintype" id="6170408">int</span>&nbsp;<span class="op" id="6170412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170415">if</span>&nbsp;<span class="ident" id="6170418"><a href="/gostd/image/png/writer.go.html#6170399">d</a></span>&nbsp;<span class="op" id="6170420">&lt;</span>&nbsp;<span class="num" id="6170422">128</span>&nbsp;<span class="op" id="6170426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170430">return</span>&nbsp;<span class="builtintype" id="6170437">int</span><span class="op" id="6170440">(</span><span class="ident" id="6170441"><a href="/gostd/image/png/writer.go.html#6170399">d</a></span><span class="op" id="6170442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170445">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170448">return</span>&nbsp;<span class="num" id="6170455">256</span>&nbsp;<span class="op" id="6170459">-</span>&nbsp;<span class="builtintype" id="6170461">int</span><span class="op" id="6170464">(</span><span class="ident" id="6170465"><a href="/gostd/image/png/writer.go.html#6170399">d</a></span><span class="op" id="6170466">)</span><br>
<span class="lineno">80</span><span class="op" id="6170468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6170471">func</span>&nbsp;<span class="op" id="6170476">(</span><span class="ident" id="6170477">e</span>&nbsp;<span class="op" id="6170479">*</span><span class="ident" id="6170480"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><span class="op" id="6170487">)</span>&nbsp;<span class="ident" id="6170489">writeChunk</span><span class="op" id="6170499">(</span><span class="ident" id="6170500">b</span>&nbsp;<span class="op" id="6170502">[</span><span class="op" id="6170503">]</span><span class="builtintype" id="6170504">byte</span><span class="op" id="6170508">,</span>&nbsp;<span class="ident" id="6170510">name</span>&nbsp;<span class="builtintype" id="6170515">string</span><span class="op" id="6170521">)</span>&nbsp;<span class="op" id="6170523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170526">if</span>&nbsp;<span class="ident" id="6170529"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170530">.</span><span class="ident" id="6170531"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6170535">!=</span>&nbsp;<span class="builtintype" id="6170538">nil</span>&nbsp;<span class="op" id="6170542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170546">return</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170557">n</span>&nbsp;<span class="op" id="6170559">:=</span>&nbsp;<span class="builtintype" id="6170562">uint32</span><span class="op" id="6170568">(</span><span class="builtinfunc" id="6170569">len</span><span class="op" id="6170572">(</span><span class="ident" id="6170573"><a href="/gostd/image/png/writer.go.html#6170500">b</a></span><span class="op" id="6170574">)</span><span class="op" id="6170575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170578">if</span>&nbsp;<span class="builtintype" id="6170581">int</span><span class="op" id="6170584">(</span><span class="ident" id="6170585"><a href="/gostd/image/png/writer.go.html#6170557">n</a></span><span class="op" id="6170586">)</span>&nbsp;<span class="op" id="6170588">!=</span>&nbsp;<span class="builtinfunc" id="6170591">len</span><span class="op" id="6170594">(</span><span class="ident" id="6170595"><a href="/gostd/image/png/writer.go.html#6170500">b</a></span><span class="op" id="6170596">)</span>&nbsp;<span class="op" id="6170598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170602"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170603">.</span><span class="ident" id="6170604"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6170608">=</span>&nbsp;<span class="ident" id="6170610"><a href="/gostd/image/png/reader.go.html#6150743">UnsupportedError</a></span><span class="op" id="6170626">(</span><span class="ident" id="6170627"><a href="/gostd/image/png/writer.go.html#6170510">name</a></span>&nbsp;<span class="op" id="6170632">+</span>&nbsp;<span class="string" id="6170634">&#34;&nbsp;chunk&nbsp;is&nbsp;too&nbsp;large:&nbsp;&#34;</span>&nbsp;<span class="op" id="6170658">+</span>&nbsp;<span class="ident" id="6170660"><a href="/gostd/image/png/writer.go.html#6169185">strconv</a></span><span class="op" id="6170667">.</span><span class="ident" id="6170668"><a href="/gostd/strconv/itoa.go.html#2407288">Itoa</a></span><span class="op" id="6170672">(</span><span class="builtinfunc" id="6170673">len</span><span class="op" id="6170676">(</span><span class="ident" id="6170677"><a href="/gostd/image/png/writer.go.html#6170500">b</a></span><span class="op" id="6170678">)</span><span class="op" id="6170679">)</span><span class="op" id="6170680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170684">return</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170695"><a href="/gostd/image/png/writer.go.html#6169821">writeUint32</a></span><span class="op" id="6170706">(</span><span class="ident" id="6170707"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170708">.</span><span class="ident" id="6170709"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170715">[</span><span class="op" id="6170716">:</span><span class="num" id="6170717">4</span><span class="op" id="6170718">]</span><span class="op" id="6170719">,</span>&nbsp;<span class="ident" id="6170721"><a href="/gostd/image/png/writer.go.html#6170557">n</a></span><span class="op" id="6170722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170725"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170726">.</span><span class="ident" id="6170727"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170733">[</span><span class="num" id="6170734">4</span><span class="op" id="6170735">]</span>&nbsp;<span class="op" id="6170737">=</span>&nbsp;<span class="ident" id="6170739"><a href="/gostd/image/png/writer.go.html#6170510">name</a></span><span class="op" id="6170743">[</span><span class="num" id="6170744">0</span><span class="op" id="6170745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170748"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170749">.</span><span class="ident" id="6170750"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170756">[</span><span class="num" id="6170757">5</span><span class="op" id="6170758">]</span>&nbsp;<span class="op" id="6170760">=</span>&nbsp;<span class="ident" id="6170762"><a href="/gostd/image/png/writer.go.html#6170510">name</a></span><span class="op" id="6170766">[</span><span class="num" id="6170767">1</span><span class="op" id="6170768">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170771"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170772">.</span><span class="ident" id="6170773"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170779">[</span><span class="num" id="6170780">6</span><span class="op" id="6170781">]</span>&nbsp;<span class="op" id="6170783">=</span>&nbsp;<span class="ident" id="6170785"><a href="/gostd/image/png/writer.go.html#6170510">name</a></span><span class="op" id="6170789">[</span><span class="num" id="6170790">2</span><span class="op" id="6170791">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170794"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170795">.</span><span class="ident" id="6170796"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170802">[</span><span class="num" id="6170803">7</span><span class="op" id="6170804">]</span>&nbsp;<span class="op" id="6170806">=</span>&nbsp;<span class="ident" id="6170808"><a href="/gostd/image/png/writer.go.html#6170510">name</a></span><span class="op" id="6170812">[</span><span class="num" id="6170813">3</span><span class="op" id="6170814">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170817">crc</span>&nbsp;<span class="op" id="6170821">:=</span>&nbsp;<span class="ident" id="6170824"><a href="/gostd/image/png/writer.go.html#6169141">crc32</a></span><span class="op" id="6170829">.</span><span class="ident" id="6170830"><a href="/gostd/hash/crc32/crc32.go.html#4859679">NewIEEE</a></span><span class="op" id="6170837">(</span><span class="op" id="6170838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170841"><a href="/gostd/image/png/writer.go.html#6170817">crc</a></span><span class="op" id="6170844">.</span><span class="ident" id="6170845"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="6170850">(</span><span class="ident" id="6170851"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170852">.</span><span class="ident" id="6170853"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170859">[</span><span class="num" id="6170860">4</span><span class="op" id="6170861">:</span><span class="num" id="6170862">8</span><span class="op" id="6170863">]</span><span class="op" id="6170864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170867"><a href="/gostd/image/png/writer.go.html#6170817">crc</a></span><span class="op" id="6170870">.</span><span class="ident" id="6170871"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="6170876">(</span><span class="ident" id="6170877"><a href="/gostd/image/png/writer.go.html#6170500">b</a></span><span class="op" id="6170878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170881"><a href="/gostd/image/png/writer.go.html#6169821">writeUint32</a></span><span class="op" id="6170892">(</span><span class="ident" id="6170893"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170894">.</span><span class="ident" id="6170895"><a href="/gostd/image/png/writer.go.html#6169421">footer</a></span><span class="op" id="6170901">[</span><span class="op" id="6170902">:</span><span class="num" id="6170903">4</span><span class="op" id="6170904">]</span><span class="op" id="6170905">,</span>&nbsp;<span class="ident" id="6170907"><a href="/gostd/image/png/writer.go.html#6170817">crc</a></span><span class="op" id="6170910">.</span><span class="ident" id="6170911"><a href="/gostd/hash/hash.go.html#3014858">Sum32</a></span><span class="op" id="6170916">(</span><span class="op" id="6170917">)</span><span class="op" id="6170918">)</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170922">_</span><span class="op" id="6170923">,</span>&nbsp;<span class="ident" id="6170925"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170926">.</span><span class="ident" id="6170927"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6170931">=</span>&nbsp;<span class="ident" id="6170933"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170934">.</span><span class="ident" id="6170935"><a href="/gostd/image/png/writer.go.html#6169341">w</a></span><span class="op" id="6170936">.</span><span class="ident" id="6170937"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="6170942">(</span><span class="ident" id="6170943"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170944">.</span><span class="ident" id="6170945"><a href="/gostd/image/png/writer.go.html#6169405">header</a></span><span class="op" id="6170951">[</span><span class="op" id="6170952">:</span><span class="num" id="6170953">8</span><span class="op" id="6170954">]</span><span class="op" id="6170955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170958">if</span>&nbsp;<span class="ident" id="6170961"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170962">.</span><span class="ident" id="6170963"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6170967">!=</span>&nbsp;<span class="builtintype" id="6170970">nil</span>&nbsp;<span class="op" id="6170974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6170978">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6170986">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6170989">_</span><span class="op" id="6170990">,</span>&nbsp;<span class="ident" id="6170992"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6170993">.</span><span class="ident" id="6170994"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6170998">=</span>&nbsp;<span class="ident" id="6171000"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6171001">.</span><span class="ident" id="6171002"><a href="/gostd/image/png/writer.go.html#6169341">w</a></span><span class="op" id="6171003">.</span><span class="ident" id="6171004"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="6171009">(</span><span class="ident" id="6171010"><a href="/gostd/image/png/writer.go.html#6170500">b</a></span><span class="op" id="6171011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171014">if</span>&nbsp;<span class="ident" id="6171017"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6171018">.</span><span class="ident" id="6171019"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6171023">!=</span>&nbsp;<span class="builtintype" id="6171026">nil</span>&nbsp;<span class="op" id="6171030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171034">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171045">_</span><span class="op" id="6171046">,</span>&nbsp;<span class="ident" id="6171048"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6171049">.</span><span class="ident" id="6171050"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6171054">=</span>&nbsp;<span class="ident" id="6171056"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6171057">.</span><span class="ident" id="6171058"><a href="/gostd/image/png/writer.go.html#6169341">w</a></span><span class="op" id="6171059">.</span><span class="ident" id="6171060"><a href="/gostd/io/io.go.html#1422334">Write</a></span><span class="op" id="6171065">(</span><span class="ident" id="6171066"><a href="/gostd/image/png/writer.go.html#6170477">e</a></span><span class="op" id="6171067">.</span><span class="ident" id="6171068"><a href="/gostd/image/png/writer.go.html#6169421">footer</a></span><span class="op" id="6171074">[</span><span class="op" id="6171075">:</span><span class="num" id="6171076">4</span><span class="op" id="6171077">]</span><span class="op" id="6171078">)</span><br>
<span class="lineno">110</span><span class="op" id="6171080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6171083">func</span>&nbsp;<span class="op" id="6171088">(</span><span class="ident" id="6171089">e</span>&nbsp;<span class="op" id="6171091">*</span><span class="ident" id="6171092"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><span class="op" id="6171099">)</span>&nbsp;<span class="ident" id="6171101">writeIHDR</span><span class="op" id="6171110">(</span><span class="op" id="6171111">)</span>&nbsp;<span class="op" id="6171113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171116">b</span>&nbsp;<span class="op" id="6171118">:=</span>&nbsp;<span class="ident" id="6171121"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171122">.</span><span class="ident" id="6171123"><a href="/gostd/image/png/writer.go.html#6169359">m</a></span><span class="op" id="6171124">.</span><span class="ident" id="6171125"><a href="/gostd/image/image.go.html#5155130">Bounds</a></span><span class="op" id="6171131">(</span><span class="op" id="6171132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171135"><a href="/gostd/image/png/writer.go.html#6169821">writeUint32</a></span><span class="op" id="6171146">(</span><span class="ident" id="6171147"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171148">.</span><span class="ident" id="6171149"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171152">[</span><span class="num" id="6171153">0</span><span class="op" id="6171154">:</span><span class="num" id="6171155">4</span><span class="op" id="6171156">]</span><span class="op" id="6171157">,</span>&nbsp;<span class="builtintype" id="6171159">uint32</span><span class="op" id="6171165">(</span><span class="ident" id="6171166"><a href="/gostd/image/png/writer.go.html#6171116">b</a></span><span class="op" id="6171167">.</span><span class="ident" id="6171168"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6171170">(</span><span class="op" id="6171171">)</span><span class="op" id="6171172">)</span><span class="op" id="6171173">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171176"><a href="/gostd/image/png/writer.go.html#6169821">writeUint32</a></span><span class="op" id="6171187">(</span><span class="ident" id="6171188"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171189">.</span><span class="ident" id="6171190"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171193">[</span><span class="num" id="6171194">4</span><span class="op" id="6171195">:</span><span class="num" id="6171196">8</span><span class="op" id="6171197">]</span><span class="op" id="6171198">,</span>&nbsp;<span class="builtintype" id="6171200">uint32</span><span class="op" id="6171206">(</span><span class="ident" id="6171207"><a href="/gostd/image/png/writer.go.html#6171116">b</a></span><span class="op" id="6171208">.</span><span class="ident" id="6171209"><a href="/gostd/image/geom.go.html#5150316">Dy</a></span><span class="op" id="6171211">(</span><span class="op" id="6171212">)</span><span class="op" id="6171213">)</span><span class="op" id="6171214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6171217">//&nbsp;Set&nbsp;bit&nbsp;depth&nbsp;and&nbsp;color&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171251">switch</span>&nbsp;<span class="ident" id="6171258"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171259">.</span><span class="ident" id="6171260"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6171263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171266">case</span>&nbsp;<span class="ident" id="6171271"><a href="/gostd/image/png/reader.go.html#6149025">cbG8</a></span><span class="op" id="6171275">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171279"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171280">.</span><span class="ident" id="6171281"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171284">[</span><span class="num" id="6171285">8</span><span class="op" id="6171286">]</span>&nbsp;<span class="op" id="6171288">=</span>&nbsp;<span class="num" id="6171290">8</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171294"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171295">.</span><span class="ident" id="6171296"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171299">[</span><span class="num" id="6171300">9</span><span class="op" id="6171301">]</span>&nbsp;<span class="op" id="6171303">=</span>&nbsp;<span class="ident" id="6171305"><a href="/gostd/image/png/reader.go.html#6148814">ctGrayscale</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171318">case</span>&nbsp;<span class="ident" id="6171323"><a href="/gostd/image/png/reader.go.html#6149038">cbTC8</a></span><span class="op" id="6171328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171332"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171333">.</span><span class="ident" id="6171334"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171337">[</span><span class="num" id="6171338">8</span><span class="op" id="6171339">]</span>&nbsp;<span class="op" id="6171341">=</span>&nbsp;<span class="num" id="6171343">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171347"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171348">.</span><span class="ident" id="6171349"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171352">[</span><span class="num" id="6171353">9</span><span class="op" id="6171354">]</span>&nbsp;<span class="op" id="6171356">=</span>&nbsp;<span class="ident" id="6171358"><a href="/gostd/image/png/reader.go.html#6148836">ctTrueColor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171371">case</span>&nbsp;<span class="ident" id="6171376"><a href="/gostd/image/png/reader.go.html#6149063">cbP8</a></span><span class="op" id="6171380">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171384"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171385">.</span><span class="ident" id="6171386"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171389">[</span><span class="num" id="6171390">8</span><span class="op" id="6171391">]</span>&nbsp;<span class="op" id="6171393">=</span>&nbsp;<span class="num" id="6171395">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171399"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171400">.</span><span class="ident" id="6171401"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171404">[</span><span class="num" id="6171405">9</span><span class="op" id="6171406">]</span>&nbsp;<span class="op" id="6171408">=</span>&nbsp;<span class="ident" id="6171410"><a href="/gostd/image/png/reader.go.html#6148858">ctPaletted</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171422">case</span>&nbsp;<span class="ident" id="6171427"><a href="/gostd/image/png/reader.go.html#6149069">cbTCA8</a></span><span class="op" id="6171433">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171437"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171438">.</span><span class="ident" id="6171439"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171442">[</span><span class="num" id="6171443">8</span><span class="op" id="6171444">]</span>&nbsp;<span class="op" id="6171446">=</span>&nbsp;<span class="num" id="6171448">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171452"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171453">.</span><span class="ident" id="6171454"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171457">[</span><span class="num" id="6171458">9</span><span class="op" id="6171459">]</span>&nbsp;<span class="op" id="6171461">=</span>&nbsp;<span class="ident" id="6171463"><a href="/gostd/image/png/reader.go.html#6148902">ctTrueColorAlpha</a></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171481">case</span>&nbsp;<span class="ident" id="6171486"><a href="/gostd/image/png/reader.go.html#6149077">cbG16</a></span><span class="op" id="6171491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171495"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171496">.</span><span class="ident" id="6171497"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171500">[</span><span class="num" id="6171501">8</span><span class="op" id="6171502">]</span>&nbsp;<span class="op" id="6171504">=</span>&nbsp;<span class="num" id="6171506">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171511"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171512">.</span><span class="ident" id="6171513"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171516">[</span><span class="num" id="6171517">9</span><span class="op" id="6171518">]</span>&nbsp;<span class="op" id="6171520">=</span>&nbsp;<span class="ident" id="6171522"><a href="/gostd/image/png/reader.go.html#6148814">ctGrayscale</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171535">case</span>&nbsp;<span class="ident" id="6171540"><a href="/gostd/image/png/reader.go.html#6149092">cbTC16</a></span><span class="op" id="6171546">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171550"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171551">.</span><span class="ident" id="6171552"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171555">[</span><span class="num" id="6171556">8</span><span class="op" id="6171557">]</span>&nbsp;<span class="op" id="6171559">=</span>&nbsp;<span class="num" id="6171561">16</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171566"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171567">.</span><span class="ident" id="6171568"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171571">[</span><span class="num" id="6171572">9</span><span class="op" id="6171573">]</span>&nbsp;<span class="op" id="6171575">=</span>&nbsp;<span class="ident" id="6171577"><a href="/gostd/image/png/reader.go.html#6148836">ctTrueColor</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171590">case</span>&nbsp;<span class="ident" id="6171595"><a href="/gostd/image/png/reader.go.html#6149100">cbTCA16</a></span><span class="op" id="6171602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171606"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171607">.</span><span class="ident" id="6171608"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171611">[</span><span class="num" id="6171612">8</span><span class="op" id="6171613">]</span>&nbsp;<span class="op" id="6171615">=</span>&nbsp;<span class="num" id="6171617">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171622"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171623">.</span><span class="ident" id="6171624"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171627">[</span><span class="num" id="6171628">9</span><span class="op" id="6171629">]</span>&nbsp;<span class="op" id="6171631">=</span>&nbsp;<span class="ident" id="6171633"><a href="/gostd/image/png/reader.go.html#6148902">ctTrueColorAlpha</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171651">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171654"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171655">.</span><span class="ident" id="6171656"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171659">[</span><span class="num" id="6171660">10</span><span class="op" id="6171662">]</span>&nbsp;<span class="op" id="6171664">=</span>&nbsp;<span class="num" id="6171666">0</span>&nbsp;<span class="comment" id="6171668">//&nbsp;default&nbsp;compression&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171699"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171700">.</span><span class="ident" id="6171701"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171704">[</span><span class="num" id="6171705">11</span><span class="op" id="6171707">]</span>&nbsp;<span class="op" id="6171709">=</span>&nbsp;<span class="num" id="6171711">0</span>&nbsp;<span class="comment" id="6171713">//&nbsp;default&nbsp;filter&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171739"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171740">.</span><span class="ident" id="6171741"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171744">[</span><span class="num" id="6171745">12</span><span class="op" id="6171747">]</span>&nbsp;<span class="op" id="6171749">=</span>&nbsp;<span class="num" id="6171751">0</span>&nbsp;<span class="comment" id="6171753">//&nbsp;non-interlaced</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171772"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171773">.</span><span class="ident" id="6171774"><a href="/gostd/image/png/writer.go.html#6170489">writeChunk</a></span><span class="op" id="6171784">(</span><span class="ident" id="6171785"><a href="/gostd/image/png/writer.go.html#6171089">e</a></span><span class="op" id="6171786">.</span><span class="ident" id="6171787"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6171790">[</span><span class="op" id="6171791">:</span><span class="num" id="6171792">13</span><span class="op" id="6171794">]</span><span class="op" id="6171795">,</span>&nbsp;<span class="string" id="6171797">&#34;IHDR&#34;</span><span class="op" id="6171803">)</span><br>
<span class="lineno"></span><span class="op" id="6171805">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6171808">func</span>&nbsp;<span class="op" id="6171813">(</span><span class="ident" id="6171814">e</span>&nbsp;<span class="op" id="6171816">*</span><span class="ident" id="6171817"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><span class="op" id="6171824">)</span>&nbsp;<span class="ident" id="6171826">writePLTEAndTRNS</span><span class="op" id="6171842">(</span><span class="ident" id="6171843">p</span>&nbsp;<span class="ident" id="6171845"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6171850">.</span><span class="ident" id="6171851"><a href="/gostd/image/color/color.go.html#5190467">Palette</a></span><span class="op" id="6171858">)</span>&nbsp;<span class="op" id="6171860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171863">if</span>&nbsp;<span class="builtinfunc" id="6171866">len</span><span class="op" id="6171869">(</span><span class="ident" id="6171870"><a href="/gostd/image/png/writer.go.html#6171843">p</a></span><span class="op" id="6171871">)</span>&nbsp;<span class="op" id="6171873">&lt;</span>&nbsp;<span class="num" id="6171875">1</span>&nbsp;<span class="op" id="6171877">||</span>&nbsp;<span class="builtinfunc" id="6171880">len</span><span class="op" id="6171883">(</span><span class="ident" id="6171884"><a href="/gostd/image/png/writer.go.html#6171843">p</a></span><span class="op" id="6171885">)</span>&nbsp;<span class="op" id="6171887">&gt;</span>&nbsp;<span class="num" id="6171889">256</span>&nbsp;<span class="op" id="6171893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171897"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6171898">.</span><span class="ident" id="6171899"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6171903">=</span>&nbsp;<span class="ident" id="6171905"><a href="/gostd/image/png/reader.go.html#6150487">FormatError</a></span><span class="op" id="6171916">(</span><span class="string" id="6171917">&#34;bad&nbsp;palette&nbsp;length:&nbsp;&#34;</span>&nbsp;<span class="op" id="6171940">+</span>&nbsp;<span class="ident" id="6171942"><a href="/gostd/image/png/writer.go.html#6169185">strconv</a></span><span class="op" id="6171949">.</span><span class="ident" id="6171950"><a href="/gostd/strconv/itoa.go.html#2407288">Itoa</a></span><span class="op" id="6171954">(</span><span class="builtinfunc" id="6171955">len</span><span class="op" id="6171958">(</span><span class="ident" id="6171959"><a href="/gostd/image/png/writer.go.html#6171843">p</a></span><span class="op" id="6171960">)</span><span class="op" id="6171961">)</span><span class="op" id="6171962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171966">return</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6171974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6171977">last</span>&nbsp;<span class="op" id="6171982">:=</span>&nbsp;<span class="op" id="6171985">-</span><span class="num" id="6171986">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6171989">for</span>&nbsp;<span class="ident" id="6171993">i</span><span class="op" id="6171994">,</span>&nbsp;<span class="ident" id="6171996">c</span>&nbsp;<span class="op" id="6171998">:=</span>&nbsp;<span class="keyword" id="6172001">range</span>&nbsp;<span class="ident" id="6172007"><a href="/gostd/image/png/writer.go.html#6171843">p</a></span>&nbsp;<span class="op" id="6172009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172013">c1</span>&nbsp;<span class="op" id="6172016">:=</span>&nbsp;<span class="ident" id="6172019"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6172024">.</span><span class="ident" id="6172025"><a href="/gostd/image/color/color.go.html#5188275">NRGBAModel</a></span><span class="op" id="6172035">.</span><span class="ident" id="6172036"><a href="/gostd/image/color/color.go.html#5187633">Convert</a></span><span class="op" id="6172043">(</span><span class="ident" id="6172044"><a href="/gostd/image/png/writer.go.html#6171996">c</a></span><span class="op" id="6172045">)</span><span class="op" id="6172046">.</span><span class="op" id="6172047">(</span><span class="ident" id="6172048"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6172053">.</span><span class="ident" id="6172054"><a href="/gostd/image/color/color.go.html#5186151">NRGBA</a></span><span class="op" id="6172059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172063"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172064">.</span><span class="ident" id="6172065"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6172068">[</span><span class="num" id="6172069">3</span><span class="op" id="6172070">*</span><span class="ident" id="6172071"><a href="/gostd/image/png/writer.go.html#6171993">i</a></span><span class="op" id="6172072">+</span><span class="num" id="6172073">0</span><span class="op" id="6172074">]</span>&nbsp;<span class="op" id="6172076">=</span>&nbsp;<span class="ident" id="6172078"><a href="/gostd/image/png/writer.go.html#6172013">c1</a></span><span class="op" id="6172080">.</span><span class="ident" id="6172081"><a href="/gostd/image/color/color.go.html#5186167">R</a></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172085"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172086">.</span><span class="ident" id="6172087"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6172090">[</span><span class="num" id="6172091">3</span><span class="op" id="6172092">*</span><span class="ident" id="6172093"><a href="/gostd/image/png/writer.go.html#6171993">i</a></span><span class="op" id="6172094">+</span><span class="num" id="6172095">1</span><span class="op" id="6172096">]</span>&nbsp;<span class="op" id="6172098">=</span>&nbsp;<span class="ident" id="6172100"><a href="/gostd/image/png/writer.go.html#6172013">c1</a></span><span class="op" id="6172102">.</span><span class="ident" id="6172103"><a href="/gostd/image/color/color.go.html#5186170">G</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172107"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172108">.</span><span class="ident" id="6172109"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6172112">[</span><span class="num" id="6172113">3</span><span class="op" id="6172114">*</span><span class="ident" id="6172115"><a href="/gostd/image/png/writer.go.html#6171993">i</a></span><span class="op" id="6172116">+</span><span class="num" id="6172117">2</span><span class="op" id="6172118">]</span>&nbsp;<span class="op" id="6172120">=</span>&nbsp;<span class="ident" id="6172122"><a href="/gostd/image/png/writer.go.html#6172013">c1</a></span><span class="op" id="6172124">.</span><span class="ident" id="6172125"><a href="/gostd/image/color/color.go.html#5186173">B</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172129">if</span>&nbsp;<span class="ident" id="6172132"><a href="/gostd/image/png/writer.go.html#6172013">c1</a></span><span class="op" id="6172134">.</span><span class="ident" id="6172135"><a href="/gostd/image/color/color.go.html#5186176">A</a></span>&nbsp;<span class="op" id="6172137">!=</span>&nbsp;<span class="num" id="6172140">0xff</span>&nbsp;<span class="op" id="6172145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172150"><a href="/gostd/image/png/writer.go.html#6171977">last</a></span>&nbsp;<span class="op" id="6172155">=</span>&nbsp;<span class="ident" id="6172157"><a href="/gostd/image/png/writer.go.html#6171993">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172161">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172165"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172166">.</span><span class="ident" id="6172167"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6172170">[</span><span class="num" id="6172171">3</span><span class="op" id="6172172">*</span><span class="num" id="6172173">256</span><span class="op" id="6172176">+</span><span class="ident" id="6172177"><a href="/gostd/image/png/writer.go.html#6171993">i</a></span><span class="op" id="6172178">]</span>&nbsp;<span class="op" id="6172180">=</span>&nbsp;<span class="ident" id="6172182"><a href="/gostd/image/png/writer.go.html#6172013">c1</a></span><span class="op" id="6172184">.</span><span class="ident" id="6172185"><a href="/gostd/image/color/color.go.html#5186176">A</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172191"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172192">.</span><span class="ident" id="6172193"><a href="/gostd/image/png/writer.go.html#6170489">writeChunk</a></span><span class="op" id="6172203">(</span><span class="ident" id="6172204"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172205">.</span><span class="ident" id="6172206"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6172209">[</span><span class="op" id="6172210">:</span><span class="num" id="6172211">3</span><span class="op" id="6172212">*</span><span class="builtinfunc" id="6172213">len</span><span class="op" id="6172216">(</span><span class="ident" id="6172217"><a href="/gostd/image/png/writer.go.html#6171843">p</a></span><span class="op" id="6172218">)</span><span class="op" id="6172219">]</span><span class="op" id="6172220">,</span>&nbsp;<span class="string" id="6172222">&#34;PLTE&#34;</span><span class="op" id="6172228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172231">if</span>&nbsp;<span class="ident" id="6172234"><a href="/gostd/image/png/writer.go.html#6171977">last</a></span>&nbsp;<span class="op" id="6172239">!=</span>&nbsp;<span class="op" id="6172242">-</span><span class="num" id="6172243">1</span>&nbsp;<span class="op" id="6172245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172249"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172250">.</span><span class="ident" id="6172251"><a href="/gostd/image/png/writer.go.html#6170489">writeChunk</a></span><span class="op" id="6172261">(</span><span class="ident" id="6172262"><a href="/gostd/image/png/writer.go.html#6171814">e</a></span><span class="op" id="6172263">.</span><span class="ident" id="6172264"><a href="/gostd/image/png/writer.go.html#6169437">tmp</a></span><span class="op" id="6172267">[</span><span class="num" id="6172268">3</span><span class="op" id="6172269">*</span><span class="num" id="6172270">256</span><span class="op" id="6172273">:</span><span class="num" id="6172274">3</span><span class="op" id="6172275">*</span><span class="num" id="6172276">256</span><span class="op" id="6172279">+</span><span class="num" id="6172280">1</span><span class="op" id="6172281">+</span><span class="ident" id="6172282"><a href="/gostd/image/png/writer.go.html#6171977">last</a></span><span class="op" id="6172286">]</span><span class="op" id="6172287">,</span>&nbsp;<span class="string" id="6172289">&#34;tRNS&#34;</span><span class="op" id="6172295">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172298">}</span><br>
<span class="lineno"></span><span class="op" id="6172300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6172303">//&nbsp;An&nbsp;encoder&nbsp;is&nbsp;an&nbsp;io.Writer&nbsp;that&nbsp;satisfies&nbsp;writes&nbsp;by&nbsp;writing&nbsp;PNG&nbsp;IDAT&nbsp;chunks,</span><br>
<span class="lineno"></span><span class="comment" id="6172383">//&nbsp;including&nbsp;an&nbsp;8-byte&nbsp;header&nbsp;and&nbsp;4-byte&nbsp;CRC&nbsp;checksum&nbsp;per&nbsp;Write&nbsp;call.&nbsp;Such&nbsp;calls</span><br>
<span class="lineno">170</span><span class="comment" id="6172464">//&nbsp;should&nbsp;be&nbsp;relatively&nbsp;infrequent,&nbsp;since&nbsp;writeIDATs&nbsp;uses&nbsp;a&nbsp;bufio.Writer.</span><br>
<span class="lineno"></span><span class="comment" id="6172538">//</span><br>
<span class="lineno"></span><span class="comment" id="6172541">//&nbsp;This&nbsp;method&nbsp;should&nbsp;only&nbsp;be&nbsp;called&nbsp;from&nbsp;writeIDATs&nbsp;(via&nbsp;writeImage).</span><br>
<span class="lineno"></span><span class="comment" id="6172612">//&nbsp;No&nbsp;other&nbsp;code&nbsp;should&nbsp;treat&nbsp;an&nbsp;encoder&nbsp;as&nbsp;an&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6172670">func</span>&nbsp;<span class="op" id="6172675">(</span><span class="ident" id="6172676">e</span>&nbsp;<span class="op" id="6172678">*</span><span class="ident" id="6172679"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><span class="op" id="6172686">)</span>&nbsp;<span class="ident" id="6172688">Write</span><span class="op" id="6172693">(</span><span class="ident" id="6172694">b</span>&nbsp;<span class="op" id="6172696">[</span><span class="op" id="6172697">]</span><span class="builtintype" id="6172698">byte</span><span class="op" id="6172702">)</span>&nbsp;<span class="op" id="6172704">(</span><span class="builtintype" id="6172705">int</span><span class="op" id="6172708">,</span>&nbsp;<span class="builtintype" id="6172710">error</span><span class="op" id="6172715">)</span>&nbsp;<span class="op" id="6172717">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6172720"><a href="/gostd/image/png/writer.go.html#6172676">e</a></span><span class="op" id="6172721">.</span><span class="ident" id="6172722"><a href="/gostd/image/png/writer.go.html#6170489">writeChunk</a></span><span class="op" id="6172732">(</span><span class="ident" id="6172733"><a href="/gostd/image/png/writer.go.html#6172694">b</a></span><span class="op" id="6172734">,</span>&nbsp;<span class="string" id="6172736">&#34;IDAT&#34;</span><span class="op" id="6172742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172745">if</span>&nbsp;<span class="ident" id="6172748"><a href="/gostd/image/png/writer.go.html#6172676">e</a></span><span class="op" id="6172749">.</span><span class="ident" id="6172750"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6172754">!=</span>&nbsp;<span class="builtintype" id="6172757">nil</span>&nbsp;<span class="op" id="6172761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172765">return</span>&nbsp;<span class="num" id="6172772">0</span><span class="op" id="6172773">,</span>&nbsp;<span class="ident" id="6172775"><a href="/gostd/image/png/writer.go.html#6172676">e</a></span><span class="op" id="6172776">.</span><span class="ident" id="6172777"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6172782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6172785">return</span>&nbsp;<span class="builtinfunc" id="6172792">len</span><span class="op" id="6172795">(</span><span class="ident" id="6172796"><a href="/gostd/image/png/writer.go.html#6172694">b</a></span><span class="op" id="6172797">)</span><span class="op" id="6172798">,</span>&nbsp;<span class="builtintype" id="6172800">nil</span><br>
<span class="lineno">180</span><span class="op" id="6172804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6172807">//&nbsp;Chooses&nbsp;the&nbsp;filter&nbsp;to&nbsp;use&nbsp;for&nbsp;encoding&nbsp;the&nbsp;current&nbsp;row,&nbsp;and&nbsp;applies&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6172882">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;filter&nbsp;and&nbsp;also&nbsp;of&nbsp;the&nbsp;row&nbsp;in&nbsp;cr&nbsp;that&nbsp;has&nbsp;had&nbsp;it&nbsp;applied.</span><br>
<span class="lineno"></span><span class="keyword" id="6172980">func</span>&nbsp;<span class="ident" id="6172985">filter</span><span class="op" id="6172991">(</span><span class="ident" id="6172992">cr</span>&nbsp;<span class="op" id="6172995">*</span><span class="op" id="6172996">[</span><span class="ident" id="6172997"><a href="/gostd/image/png/reader.go.html#6149232">nFilter</a></span><span class="op" id="6173004">]</span><span class="op" id="6173005">[</span><span class="op" id="6173006">]</span><span class="builtintype" id="6173007">byte</span><span class="op" id="6173011">,</span>&nbsp;<span class="ident" id="6173013">pr</span>&nbsp;<span class="op" id="6173016">[</span><span class="op" id="6173017">]</span><span class="builtintype" id="6173018">byte</span><span class="op" id="6173022">,</span>&nbsp;<span class="ident" id="6173024">bpp</span>&nbsp;<span class="builtintype" id="6173028">int</span><span class="op" id="6173031">)</span>&nbsp;<span class="builtintype" id="6173033">int</span>&nbsp;<span class="op" id="6173037">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173040">//&nbsp;We&nbsp;try&nbsp;all&nbsp;five&nbsp;filter&nbsp;types,&nbsp;and&nbsp;pick&nbsp;the&nbsp;one&nbsp;that&nbsp;minimizes&nbsp;the&nbsp;sum&nbsp;of&nbsp;absolute&nbsp;differences.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173139">//&nbsp;This&nbsp;is&nbsp;the&nbsp;same&nbsp;heuristic&nbsp;that&nbsp;libpng&nbsp;uses,&nbsp;although&nbsp;the&nbsp;filters&nbsp;are&nbsp;attempted&nbsp;in&nbsp;order&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173235">//&nbsp;estimated&nbsp;most&nbsp;likely&nbsp;to&nbsp;be&nbsp;minimal&nbsp;(ftUp,&nbsp;ftPaeth,&nbsp;ftNone,&nbsp;ftSub,&nbsp;ftAverage),&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173330">//&nbsp;in&nbsp;their&nbsp;enumeration&nbsp;order&nbsp;(ftNone,&nbsp;ftSub,&nbsp;ftUp,&nbsp;ftAverage,&nbsp;ftPaeth).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173404">cdat0</span>&nbsp;<span class="op" id="6173410">:=</span>&nbsp;<span class="ident" id="6173413"><a href="/gostd/image/png/writer.go.html#6172992">cr</a></span><span class="op" id="6173415">[</span><span class="num" id="6173416">0</span><span class="op" id="6173417">]</span><span class="op" id="6173418">[</span><span class="num" id="6173419">1</span><span class="op" id="6173420">:</span><span class="op" id="6173421">]</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173424">cdat1</span>&nbsp;<span class="op" id="6173430">:=</span>&nbsp;<span class="ident" id="6173433"><a href="/gostd/image/png/writer.go.html#6172992">cr</a></span><span class="op" id="6173435">[</span><span class="num" id="6173436">1</span><span class="op" id="6173437">]</span><span class="op" id="6173438">[</span><span class="num" id="6173439">1</span><span class="op" id="6173440">:</span><span class="op" id="6173441">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173444">cdat2</span>&nbsp;<span class="op" id="6173450">:=</span>&nbsp;<span class="ident" id="6173453"><a href="/gostd/image/png/writer.go.html#6172992">cr</a></span><span class="op" id="6173455">[</span><span class="num" id="6173456">2</span><span class="op" id="6173457">]</span><span class="op" id="6173458">[</span><span class="num" id="6173459">1</span><span class="op" id="6173460">:</span><span class="op" id="6173461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173464">cdat3</span>&nbsp;<span class="op" id="6173470">:=</span>&nbsp;<span class="ident" id="6173473"><a href="/gostd/image/png/writer.go.html#6172992">cr</a></span><span class="op" id="6173475">[</span><span class="num" id="6173476">3</span><span class="op" id="6173477">]</span><span class="op" id="6173478">[</span><span class="num" id="6173479">1</span><span class="op" id="6173480">:</span><span class="op" id="6173481">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173484">cdat4</span>&nbsp;<span class="op" id="6173490">:=</span>&nbsp;<span class="ident" id="6173493"><a href="/gostd/image/png/writer.go.html#6172992">cr</a></span><span class="op" id="6173495">[</span><span class="num" id="6173496">4</span><span class="op" id="6173497">]</span><span class="op" id="6173498">[</span><span class="num" id="6173499">1</span><span class="op" id="6173500">:</span><span class="op" id="6173501">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173504">pdat</span>&nbsp;<span class="op" id="6173509">:=</span>&nbsp;<span class="ident" id="6173512"><a href="/gostd/image/png/writer.go.html#6173013">pr</a></span><span class="op" id="6173514">[</span><span class="num" id="6173515">1</span><span class="op" id="6173516">:</span><span class="op" id="6173517">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173520">n</span>&nbsp;<span class="op" id="6173522">:=</span>&nbsp;<span class="builtinfunc" id="6173525">len</span><span class="op" id="6173528">(</span><span class="ident" id="6173529"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6173534">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173538">//&nbsp;The&nbsp;up&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173557">sum</span>&nbsp;<span class="op" id="6173561">:=</span>&nbsp;<span class="num" id="6173564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173567">for</span>&nbsp;<span class="ident" id="6173571">i</span>&nbsp;<span class="op" id="6173573">:=</span>&nbsp;<span class="num" id="6173576">0</span><span class="op" id="6173577">;</span>&nbsp;<span class="ident" id="6173579"><a href="/gostd/image/png/writer.go.html#6173571">i</a></span>&nbsp;<span class="op" id="6173581">&lt;</span>&nbsp;<span class="ident" id="6173583"><a href="/gostd/image/png/writer.go.html#6173520">n</a></span><span class="op" id="6173584">;</span>&nbsp;<span class="ident" id="6173586"><a href="/gostd/image/png/writer.go.html#6173571">i</a></span><span class="op" id="6173587">++</span>&nbsp;<span class="op" id="6173590">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173594"><a href="/gostd/image/png/writer.go.html#6173444">cdat2</a></span><span class="op" id="6173599">[</span><span class="ident" id="6173600"><a href="/gostd/image/png/writer.go.html#6173571">i</a></span><span class="op" id="6173601">]</span>&nbsp;<span class="op" id="6173603">=</span>&nbsp;<span class="ident" id="6173605"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6173610">[</span><span class="ident" id="6173611"><a href="/gostd/image/png/writer.go.html#6173571">i</a></span><span class="op" id="6173612">]</span>&nbsp;<span class="op" id="6173614">-</span>&nbsp;<span class="ident" id="6173616"><a href="/gostd/image/png/writer.go.html#6173504">pdat</a></span><span class="op" id="6173620">[</span><span class="ident" id="6173621"><a href="/gostd/image/png/writer.go.html#6173571">i</a></span><span class="op" id="6173622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173626"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6173630">+=</span>&nbsp;<span class="ident" id="6173633"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6173637">(</span><span class="ident" id="6173638"><a href="/gostd/image/png/writer.go.html#6173444">cdat2</a></span><span class="op" id="6173643">[</span><span class="ident" id="6173644"><a href="/gostd/image/png/writer.go.html#6173571">i</a></span><span class="op" id="6173645">]</span><span class="op" id="6173646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173652">best</span>&nbsp;<span class="op" id="6173657">:=</span>&nbsp;<span class="ident" id="6173660"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173665">filter</span>&nbsp;<span class="op" id="6173672">:=</span>&nbsp;<span class="ident" id="6173675"><a href="/gostd/image/png/reader.go.html#6149187">ftUp</a></span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6173682">//&nbsp;The&nbsp;Paeth&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173704"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6173708">=</span>&nbsp;<span class="num" id="6173710">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173713">for</span>&nbsp;<span class="ident" id="6173717">i</span>&nbsp;<span class="op" id="6173719">:=</span>&nbsp;<span class="num" id="6173722">0</span><span class="op" id="6173723">;</span>&nbsp;<span class="ident" id="6173725"><a href="/gostd/image/png/writer.go.html#6173717">i</a></span>&nbsp;<span class="op" id="6173727">&lt;</span>&nbsp;<span class="ident" id="6173729"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6173732">;</span>&nbsp;<span class="ident" id="6173734"><a href="/gostd/image/png/writer.go.html#6173717">i</a></span><span class="op" id="6173735">++</span>&nbsp;<span class="op" id="6173738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173742"><a href="/gostd/image/png/writer.go.html#6173484">cdat4</a></span><span class="op" id="6173747">[</span><span class="ident" id="6173748"><a href="/gostd/image/png/writer.go.html#6173717">i</a></span><span class="op" id="6173749">]</span>&nbsp;<span class="op" id="6173751">=</span>&nbsp;<span class="ident" id="6173753"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6173758">[</span><span class="ident" id="6173759"><a href="/gostd/image/png/writer.go.html#6173717">i</a></span><span class="op" id="6173760">]</span>&nbsp;<span class="op" id="6173762">-</span>&nbsp;<span class="ident" id="6173764"><a href="/gostd/image/png/writer.go.html#6173504">pdat</a></span><span class="op" id="6173768">[</span><span class="ident" id="6173769"><a href="/gostd/image/png/writer.go.html#6173717">i</a></span><span class="op" id="6173770">]</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173774"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6173778">+=</span>&nbsp;<span class="ident" id="6173781"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6173785">(</span><span class="ident" id="6173786"><a href="/gostd/image/png/writer.go.html#6173484">cdat4</a></span><span class="op" id="6173791">[</span><span class="ident" id="6173792"><a href="/gostd/image/png/writer.go.html#6173717">i</a></span><span class="op" id="6173793">]</span><span class="op" id="6173794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173800">for</span>&nbsp;<span class="ident" id="6173804">i</span>&nbsp;<span class="op" id="6173806">:=</span>&nbsp;<span class="ident" id="6173809"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6173812">;</span>&nbsp;<span class="ident" id="6173814"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span>&nbsp;<span class="op" id="6173816">&lt;</span>&nbsp;<span class="ident" id="6173818"><a href="/gostd/image/png/writer.go.html#6173520">n</a></span><span class="op" id="6173819">;</span>&nbsp;<span class="ident" id="6173821"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173822">++</span>&nbsp;<span class="op" id="6173825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173829"><a href="/gostd/image/png/writer.go.html#6173484">cdat4</a></span><span class="op" id="6173834">[</span><span class="ident" id="6173835"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173836">]</span>&nbsp;<span class="op" id="6173838">=</span>&nbsp;<span class="ident" id="6173840"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6173845">[</span><span class="ident" id="6173846"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173847">]</span>&nbsp;<span class="op" id="6173849">-</span>&nbsp;<span class="ident" id="6173851"><a href="/gostd/image/png/paeth.go.html#6147280">paeth</a></span><span class="op" id="6173856">(</span><span class="ident" id="6173857"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6173862">[</span><span class="ident" id="6173863"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173864">-</span><span class="ident" id="6173865"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6173868">]</span><span class="op" id="6173869">,</span>&nbsp;<span class="ident" id="6173871"><a href="/gostd/image/png/writer.go.html#6173504">pdat</a></span><span class="op" id="6173875">[</span><span class="ident" id="6173876"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173877">]</span><span class="op" id="6173878">,</span>&nbsp;<span class="ident" id="6173880"><a href="/gostd/image/png/writer.go.html#6173504">pdat</a></span><span class="op" id="6173884">[</span><span class="ident" id="6173885"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173886">-</span><span class="ident" id="6173887"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6173890">]</span><span class="op" id="6173891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173895"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6173899">+=</span>&nbsp;<span class="ident" id="6173902"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6173906">(</span><span class="ident" id="6173907"><a href="/gostd/image/png/writer.go.html#6173484">cdat4</a></span><span class="op" id="6173912">[</span><span class="ident" id="6173913"><a href="/gostd/image/png/writer.go.html#6173804">i</a></span><span class="op" id="6173914">]</span><span class="op" id="6173915">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173919">if</span>&nbsp;<span class="ident" id="6173922"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6173926">&gt;=</span>&nbsp;<span class="ident" id="6173929"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6173934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173939">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6173950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6173953">if</span>&nbsp;<span class="ident" id="6173956"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6173960">&lt;</span>&nbsp;<span class="ident" id="6173962"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6173967">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173971"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6173976">=</span>&nbsp;<span class="ident" id="6173978"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6173984"><a href="/gostd/image/png/writer.go.html#6173665">filter</a></span>&nbsp;<span class="op" id="6173991">=</span>&nbsp;<span class="ident" id="6173993"><a href="/gostd/image/png/reader.go.html#6149217">ftPaeth</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174006">//&nbsp;The&nbsp;none&nbsp;filter.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174027"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174031">=</span>&nbsp;<span class="num" id="6174033">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174036">for</span>&nbsp;<span class="ident" id="6174040">i</span>&nbsp;<span class="op" id="6174042">:=</span>&nbsp;<span class="num" id="6174045">0</span><span class="op" id="6174046">;</span>&nbsp;<span class="ident" id="6174048"><a href="/gostd/image/png/writer.go.html#6174040">i</a></span>&nbsp;<span class="op" id="6174050">&lt;</span>&nbsp;<span class="ident" id="6174052"><a href="/gostd/image/png/writer.go.html#6173520">n</a></span><span class="op" id="6174053">;</span>&nbsp;<span class="ident" id="6174055"><a href="/gostd/image/png/writer.go.html#6174040">i</a></span><span class="op" id="6174056">++</span>&nbsp;<span class="op" id="6174059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174063"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174067">+=</span>&nbsp;<span class="ident" id="6174070"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6174074">(</span><span class="ident" id="6174075"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174080">[</span><span class="ident" id="6174081"><a href="/gostd/image/png/writer.go.html#6174040">i</a></span><span class="op" id="6174082">]</span><span class="op" id="6174083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174087">if</span>&nbsp;<span class="ident" id="6174090"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174094">&gt;=</span>&nbsp;<span class="ident" id="6174097"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174107">break</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174121">if</span>&nbsp;<span class="ident" id="6174124"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174128">&lt;</span>&nbsp;<span class="ident" id="6174130"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174139"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174144">=</span>&nbsp;<span class="ident" id="6174146"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174152"><a href="/gostd/image/png/writer.go.html#6173665">filter</a></span>&nbsp;<span class="op" id="6174159">=</span>&nbsp;<span class="ident" id="6174161"><a href="/gostd/image/png/reader.go.html#6149157">ftNone</a></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174173">//&nbsp;The&nbsp;sub&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174193"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174197">=</span>&nbsp;<span class="num" id="6174199">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174202">for</span>&nbsp;<span class="ident" id="6174206">i</span>&nbsp;<span class="op" id="6174208">:=</span>&nbsp;<span class="num" id="6174211">0</span><span class="op" id="6174212">;</span>&nbsp;<span class="ident" id="6174214"><a href="/gostd/image/png/writer.go.html#6174206">i</a></span>&nbsp;<span class="op" id="6174216">&lt;</span>&nbsp;<span class="ident" id="6174218"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6174221">;</span>&nbsp;<span class="ident" id="6174223"><a href="/gostd/image/png/writer.go.html#6174206">i</a></span><span class="op" id="6174224">++</span>&nbsp;<span class="op" id="6174227">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174231"><a href="/gostd/image/png/writer.go.html#6173424">cdat1</a></span><span class="op" id="6174236">[</span><span class="ident" id="6174237"><a href="/gostd/image/png/writer.go.html#6174206">i</a></span><span class="op" id="6174238">]</span>&nbsp;<span class="op" id="6174240">=</span>&nbsp;<span class="ident" id="6174242"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174247">[</span><span class="ident" id="6174248"><a href="/gostd/image/png/writer.go.html#6174206">i</a></span><span class="op" id="6174249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174253"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174257">+=</span>&nbsp;<span class="ident" id="6174260"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6174264">(</span><span class="ident" id="6174265"><a href="/gostd/image/png/writer.go.html#6173424">cdat1</a></span><span class="op" id="6174270">[</span><span class="ident" id="6174271"><a href="/gostd/image/png/writer.go.html#6174206">i</a></span><span class="op" id="6174272">]</span><span class="op" id="6174273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174279">for</span>&nbsp;<span class="ident" id="6174283">i</span>&nbsp;<span class="op" id="6174285">:=</span>&nbsp;<span class="ident" id="6174288"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6174291">;</span>&nbsp;<span class="ident" id="6174293"><a href="/gostd/image/png/writer.go.html#6174283">i</a></span>&nbsp;<span class="op" id="6174295">&lt;</span>&nbsp;<span class="ident" id="6174297"><a href="/gostd/image/png/writer.go.html#6173520">n</a></span><span class="op" id="6174298">;</span>&nbsp;<span class="ident" id="6174300"><a href="/gostd/image/png/writer.go.html#6174283">i</a></span><span class="op" id="6174301">++</span>&nbsp;<span class="op" id="6174304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174308"><a href="/gostd/image/png/writer.go.html#6173424">cdat1</a></span><span class="op" id="6174313">[</span><span class="ident" id="6174314"><a href="/gostd/image/png/writer.go.html#6174283">i</a></span><span class="op" id="6174315">]</span>&nbsp;<span class="op" id="6174317">=</span>&nbsp;<span class="ident" id="6174319"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174324">[</span><span class="ident" id="6174325"><a href="/gostd/image/png/writer.go.html#6174283">i</a></span><span class="op" id="6174326">]</span>&nbsp;<span class="op" id="6174328">-</span>&nbsp;<span class="ident" id="6174330"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174335">[</span><span class="ident" id="6174336"><a href="/gostd/image/png/writer.go.html#6174283">i</a></span><span class="op" id="6174337">-</span><span class="ident" id="6174338"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6174341">]</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174345"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174349">+=</span>&nbsp;<span class="ident" id="6174352"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6174356">(</span><span class="ident" id="6174357"><a href="/gostd/image/png/writer.go.html#6173424">cdat1</a></span><span class="op" id="6174362">[</span><span class="ident" id="6174363"><a href="/gostd/image/png/writer.go.html#6174283">i</a></span><span class="op" id="6174364">]</span><span class="op" id="6174365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174369">if</span>&nbsp;<span class="ident" id="6174372"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174376">&gt;=</span>&nbsp;<span class="ident" id="6174379"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174389">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174400">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174403">if</span>&nbsp;<span class="ident" id="6174406"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174410">&lt;</span>&nbsp;<span class="ident" id="6174412"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174421"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174426">=</span>&nbsp;<span class="ident" id="6174428"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174434"><a href="/gostd/image/png/writer.go.html#6173665">filter</a></span>&nbsp;<span class="op" id="6174441">=</span>&nbsp;<span class="ident" id="6174443"><a href="/gostd/image/png/reader.go.html#6149172">ftSub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6174454">//&nbsp;The&nbsp;average&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174478"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174482">=</span>&nbsp;<span class="num" id="6174484">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174487">for</span>&nbsp;<span class="ident" id="6174491">i</span>&nbsp;<span class="op" id="6174493">:=</span>&nbsp;<span class="num" id="6174496">0</span><span class="op" id="6174497">;</span>&nbsp;<span class="ident" id="6174499"><a href="/gostd/image/png/writer.go.html#6174491">i</a></span>&nbsp;<span class="op" id="6174501">&lt;</span>&nbsp;<span class="ident" id="6174503"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6174506">;</span>&nbsp;<span class="ident" id="6174508"><a href="/gostd/image/png/writer.go.html#6174491">i</a></span><span class="op" id="6174509">++</span>&nbsp;<span class="op" id="6174512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174516"><a href="/gostd/image/png/writer.go.html#6173464">cdat3</a></span><span class="op" id="6174521">[</span><span class="ident" id="6174522"><a href="/gostd/image/png/writer.go.html#6174491">i</a></span><span class="op" id="6174523">]</span>&nbsp;<span class="op" id="6174525">=</span>&nbsp;<span class="ident" id="6174527"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174532">[</span><span class="ident" id="6174533"><a href="/gostd/image/png/writer.go.html#6174491">i</a></span><span class="op" id="6174534">]</span>&nbsp;<span class="op" id="6174536">-</span>&nbsp;<span class="ident" id="6174538"><a href="/gostd/image/png/writer.go.html#6173504">pdat</a></span><span class="op" id="6174542">[</span><span class="ident" id="6174543"><a href="/gostd/image/png/writer.go.html#6174491">i</a></span><span class="op" id="6174544">]</span><span class="op" id="6174545">/</span><span class="num" id="6174546">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174550"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174554">+=</span>&nbsp;<span class="ident" id="6174557"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6174561">(</span><span class="ident" id="6174562"><a href="/gostd/image/png/writer.go.html#6173464">cdat3</a></span><span class="op" id="6174567">[</span><span class="ident" id="6174568"><a href="/gostd/image/png/writer.go.html#6174491">i</a></span><span class="op" id="6174569">]</span><span class="op" id="6174570">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174576">for</span>&nbsp;<span class="ident" id="6174580">i</span>&nbsp;<span class="op" id="6174582">:=</span>&nbsp;<span class="ident" id="6174585"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6174588">;</span>&nbsp;<span class="ident" id="6174590"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span>&nbsp;<span class="op" id="6174592">&lt;</span>&nbsp;<span class="ident" id="6174594"><a href="/gostd/image/png/writer.go.html#6173520">n</a></span><span class="op" id="6174595">;</span>&nbsp;<span class="ident" id="6174597"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span><span class="op" id="6174598">++</span>&nbsp;<span class="op" id="6174601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174605"><a href="/gostd/image/png/writer.go.html#6173464">cdat3</a></span><span class="op" id="6174610">[</span><span class="ident" id="6174611"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span><span class="op" id="6174612">]</span>&nbsp;<span class="op" id="6174614">=</span>&nbsp;<span class="ident" id="6174616"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174621">[</span><span class="ident" id="6174622"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span><span class="op" id="6174623">]</span>&nbsp;<span class="op" id="6174625">-</span>&nbsp;<span class="builtintype" id="6174627">uint8</span><span class="op" id="6174632">(</span><span class="op" id="6174633">(</span><span class="builtintype" id="6174634">int</span><span class="op" id="6174637">(</span><span class="ident" id="6174638"><a href="/gostd/image/png/writer.go.html#6173404">cdat0</a></span><span class="op" id="6174643">[</span><span class="ident" id="6174644"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span><span class="op" id="6174645">-</span><span class="ident" id="6174646"><a href="/gostd/image/png/writer.go.html#6173024">bpp</a></span><span class="op" id="6174649">]</span><span class="op" id="6174650">)</span><span class="op" id="6174651">+</span><span class="builtintype" id="6174652">int</span><span class="op" id="6174655">(</span><span class="ident" id="6174656"><a href="/gostd/image/png/writer.go.html#6173504">pdat</a></span><span class="op" id="6174660">[</span><span class="ident" id="6174661"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span><span class="op" id="6174662">]</span><span class="op" id="6174663">)</span><span class="op" id="6174664">)</span><span class="op" id="6174665">/</span><span class="num" id="6174666">2</span><span class="op" id="6174667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174671"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174675">+=</span>&nbsp;<span class="ident" id="6174678"><a href="/gostd/image/png/writer.go.html#6170394">abs8</a></span><span class="op" id="6174682">(</span><span class="ident" id="6174683"><a href="/gostd/image/png/writer.go.html#6173464">cdat3</a></span><span class="op" id="6174688">[</span><span class="ident" id="6174689"><a href="/gostd/image/png/writer.go.html#6174580">i</a></span><span class="op" id="6174690">]</span><span class="op" id="6174691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174695">if</span>&nbsp;<span class="ident" id="6174698"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174702">&gt;=</span>&nbsp;<span class="ident" id="6174705"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174710">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174715">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174729">if</span>&nbsp;<span class="ident" id="6174732"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span>&nbsp;<span class="op" id="6174736">&lt;</span>&nbsp;<span class="ident" id="6174738"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174747"><a href="/gostd/image/png/writer.go.html#6173652">best</a></span>&nbsp;<span class="op" id="6174752">=</span>&nbsp;<span class="ident" id="6174754"><a href="/gostd/image/png/writer.go.html#6173557">sum</a></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174760"><a href="/gostd/image/png/writer.go.html#6173665">filter</a></span>&nbsp;<span class="op" id="6174767">=</span>&nbsp;<span class="ident" id="6174769"><a href="/gostd/image/png/reader.go.html#6149202">ftAverage</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174784">return</span>&nbsp;<span class="ident" id="6174791"><a href="/gostd/image/png/writer.go.html#6173665">filter</a></span><br>
<span class="lineno"></span><span class="op" id="6174798">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="keyword" id="6174801">func</span>&nbsp;<span class="ident" id="6174806">writeImage</span><span class="op" id="6174816">(</span><span class="ident" id="6174817">w</span>&nbsp;<span class="ident" id="6174819"><a href="/gostd/image/png/writer.go.html#6169179">io</a></span><span class="op" id="6174821">.</span><span class="ident" id="6174822"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="6174828">,</span>&nbsp;<span class="ident" id="6174830">m</span>&nbsp;<span class="ident" id="6174832"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6174837">.</span><span class="ident" id="6174838"><a href="/gostd/image/image.go.html#5154907">Image</a></span><span class="op" id="6174843">,</span>&nbsp;<span class="ident" id="6174845">cb</span>&nbsp;<span class="builtintype" id="6174848">int</span><span class="op" id="6174851">,</span>&nbsp;<span class="ident" id="6174853">level</span>&nbsp;<span class="builtintype" id="6174859">int</span><span class="op" id="6174862">)</span>&nbsp;<span class="builtintype" id="6174864">error</span>&nbsp;<span class="op" id="6174870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174873">zw</span><span class="op" id="6174875">,</span>&nbsp;<span class="ident" id="6174877">err</span>&nbsp;<span class="op" id="6174881">:=</span>&nbsp;<span class="ident" id="6174884"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6174888">.</span><span class="ident" id="6174889"><a href="/gostd/compress/zlib/writer.go.html#5710271">NewWriterLevel</a></span><span class="op" id="6174903">(</span><span class="ident" id="6174904"><a href="/gostd/image/png/writer.go.html#6174817">w</a></span><span class="op" id="6174905">,</span>&nbsp;<span class="ident" id="6174907"><a href="/gostd/image/png/writer.go.html#6174853">level</a></span><span class="op" id="6174912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174915">if</span>&nbsp;<span class="ident" id="6174918"><a href="/gostd/image/png/writer.go.html#6174877">err</a></span>&nbsp;<span class="op" id="6174922">!=</span>&nbsp;<span class="builtintype" id="6174925">nil</span>&nbsp;<span class="op" id="6174929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174933">return</span>&nbsp;<span class="ident" id="6174940"><a href="/gostd/image/png/writer.go.html#6174877">err</a></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6174945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174948">defer</span>&nbsp;<span class="ident" id="6174954"><a href="/gostd/image/png/writer.go.html#6174873">zw</a></span><span class="op" id="6174956">.</span><span class="ident" id="6174957"><a href="/gostd/compress/zlib/writer.go.html#5713724">Close</a></span><span class="op" id="6174962">(</span><span class="op" id="6174963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6174967">bpp</span>&nbsp;<span class="op" id="6174971">:=</span>&nbsp;<span class="num" id="6174974">0</span>&nbsp;<span class="comment" id="6174976">//&nbsp;Bytes&nbsp;per&nbsp;pixel.</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6174998">switch</span>&nbsp;<span class="ident" id="6175005"><a href="/gostd/image/png/writer.go.html#6174845">cb</a></span>&nbsp;<span class="op" id="6175008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175011">case</span>&nbsp;<span class="ident" id="6175016"><a href="/gostd/image/png/reader.go.html#6149025">cbG8</a></span><span class="op" id="6175020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175024"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175028">=</span>&nbsp;<span class="num" id="6175030">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175033">case</span>&nbsp;<span class="ident" id="6175038"><a href="/gostd/image/png/reader.go.html#6149038">cbTC8</a></span><span class="op" id="6175043">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175047"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175051">=</span>&nbsp;<span class="num" id="6175053">3</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175056">case</span>&nbsp;<span class="ident" id="6175061"><a href="/gostd/image/png/reader.go.html#6149063">cbP8</a></span><span class="op" id="6175065">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175069"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175073">=</span>&nbsp;<span class="num" id="6175075">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175078">case</span>&nbsp;<span class="ident" id="6175083"><a href="/gostd/image/png/reader.go.html#6149069">cbTCA8</a></span><span class="op" id="6175089">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175093"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175097">=</span>&nbsp;<span class="num" id="6175099">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175102">case</span>&nbsp;<span class="ident" id="6175107"><a href="/gostd/image/png/reader.go.html#6149092">cbTC16</a></span><span class="op" id="6175113">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175117"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175121">=</span>&nbsp;<span class="num" id="6175123">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175126">case</span>&nbsp;<span class="ident" id="6175131"><a href="/gostd/image/png/reader.go.html#6149100">cbTCA16</a></span><span class="op" id="6175138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175142"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175146">=</span>&nbsp;<span class="num" id="6175148">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175151">case</span>&nbsp;<span class="ident" id="6175156"><a href="/gostd/image/png/reader.go.html#6149077">cbG16</a></span><span class="op" id="6175161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175165"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span>&nbsp;<span class="op" id="6175169">=</span>&nbsp;<span class="num" id="6175171">2</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175177">//&nbsp;cr[*]&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175242">//&nbsp;cr[0]&nbsp;is&nbsp;unfiltered&nbsp;(or&nbsp;equivalently,&nbsp;filtered&nbsp;with&nbsp;the&nbsp;ftNone&nbsp;filter).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175318">//&nbsp;cr[ft],&nbsp;for&nbsp;non-zero&nbsp;filter&nbsp;types&nbsp;ft,&nbsp;are&nbsp;buffers&nbsp;for&nbsp;transforming&nbsp;cr[0]&nbsp;under&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175405">//&nbsp;other&nbsp;PNG&nbsp;filter&nbsp;types.&nbsp;These&nbsp;buffers&nbsp;are&nbsp;allocated&nbsp;once&nbsp;and&nbsp;re-used&nbsp;for&nbsp;each&nbsp;row.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175492">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[*][0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175557">b</span>&nbsp;<span class="op" id="6175559">:=</span>&nbsp;<span class="ident" id="6175562"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6175563">.</span><span class="ident" id="6175564"><a href="/gostd/image/image.go.html#5155130">Bounds</a></span><span class="op" id="6175570">(</span><span class="op" id="6175571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175574">var</span>&nbsp;<span class="ident" id="6175578">cr</span>&nbsp;<span class="op" id="6175581">[</span><span class="ident" id="6175582"><a href="/gostd/image/png/reader.go.html#6149232">nFilter</a></span><span class="op" id="6175589">]</span><span class="op" id="6175590">[</span><span class="op" id="6175591">]</span><span class="builtintype" id="6175592">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175599">for</span>&nbsp;<span class="ident" id="6175603">i</span>&nbsp;<span class="op" id="6175605">:=</span>&nbsp;<span class="keyword" id="6175608">range</span>&nbsp;<span class="ident" id="6175614"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span>&nbsp;<span class="op" id="6175617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175621"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6175623">[</span><span class="ident" id="6175624"><a href="/gostd/image/png/writer.go.html#6175603">i</a></span><span class="op" id="6175625">]</span>&nbsp;<span class="op" id="6175627">=</span>&nbsp;<span class="builtinfunc" id="6175629">make</span><span class="op" id="6175633">(</span><span class="op" id="6175634">[</span><span class="op" id="6175635">]</span><span class="builtintype" id="6175636">uint8</span><span class="op" id="6175641">,</span>&nbsp;<span class="num" id="6175643">1</span><span class="op" id="6175644">+</span><span class="ident" id="6175645"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span><span class="op" id="6175648">*</span><span class="ident" id="6175649"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6175650">.</span><span class="ident" id="6175651"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6175653">(</span><span class="op" id="6175654">)</span><span class="op" id="6175655">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175659"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6175661">[</span><span class="ident" id="6175662"><a href="/gostd/image/png/writer.go.html#6175603">i</a></span><span class="op" id="6175663">]</span><span class="op" id="6175664">[</span><span class="num" id="6175665">0</span><span class="op" id="6175666">]</span>&nbsp;<span class="op" id="6175668">=</span>&nbsp;<span class="builtintype" id="6175670">uint8</span><span class="op" id="6175675">(</span><span class="ident" id="6175676"><a href="/gostd/image/png/writer.go.html#6175603">i</a></span><span class="op" id="6175677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6175680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175683">pr</span>&nbsp;<span class="op" id="6175686">:=</span>&nbsp;<span class="builtinfunc" id="6175689">make</span><span class="op" id="6175693">(</span><span class="op" id="6175694">[</span><span class="op" id="6175695">]</span><span class="builtintype" id="6175696">uint8</span><span class="op" id="6175701">,</span>&nbsp;<span class="num" id="6175703">1</span><span class="op" id="6175704">+</span><span class="ident" id="6175705"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span><span class="op" id="6175708">*</span><span class="ident" id="6175709"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6175710">.</span><span class="ident" id="6175711"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6175713">(</span><span class="op" id="6175714">)</span><span class="op" id="6175715">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175719">gray</span><span class="op" id="6175723">,</span>&nbsp;<span class="ident" id="6175725">_</span>&nbsp;<span class="op" id="6175727">:=</span>&nbsp;<span class="ident" id="6175730"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6175731">.</span><span class="op" id="6175732">(</span><span class="op" id="6175733">*</span><span class="ident" id="6175734"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6175739">.</span><span class="ident" id="6175740"><a href="/gostd/image/image.go.html#5172029">Gray</a></span><span class="op" id="6175744">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175747">rgba</span><span class="op" id="6175751">,</span>&nbsp;<span class="ident" id="6175753">_</span>&nbsp;<span class="op" id="6175755">:=</span>&nbsp;<span class="ident" id="6175758"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6175759">.</span><span class="op" id="6175760">(</span><span class="op" id="6175761">*</span><span class="ident" id="6175762"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6175767">.</span><span class="ident" id="6175768"><a href="/gostd/image/image.go.html#5155914">RGBA</a></span><span class="op" id="6175772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175775">paletted</span><span class="op" id="6175783">,</span>&nbsp;<span class="ident" id="6175785">_</span>&nbsp;<span class="op" id="6175787">:=</span>&nbsp;<span class="ident" id="6175790"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6175791">.</span><span class="op" id="6175792">(</span><span class="op" id="6175793">*</span><span class="ident" id="6175794"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6175799">.</span><span class="ident" id="6175800"><a href="/gostd/image/image.go.html#5176435">Paletted</a></span><span class="op" id="6175808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175811">nrgba</span><span class="op" id="6175816">,</span>&nbsp;<span class="ident" id="6175818">_</span>&nbsp;<span class="op" id="6175820">:=</span>&nbsp;<span class="ident" id="6175823"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6175824">.</span><span class="op" id="6175825">(</span><span class="op" id="6175826">*</span><span class="ident" id="6175827"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6175832">.</span><span class="ident" id="6175833"><a href="/gostd/image/image.go.html#5161468">NRGBA</a></span><span class="op" id="6175838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175842">for</span>&nbsp;<span class="ident" id="6175846">y</span>&nbsp;<span class="op" id="6175848">:=</span>&nbsp;<span class="ident" id="6175851"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6175852">.</span><span class="ident" id="6175853"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6175856">.</span><span class="ident" id="6175857"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6175858">;</span>&nbsp;<span class="ident" id="6175860"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span>&nbsp;<span class="op" id="6175862">&lt;</span>&nbsp;<span class="ident" id="6175864"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6175865">.</span><span class="ident" id="6175866"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6175869">.</span><span class="ident" id="6175870"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6175871">;</span>&nbsp;<span class="ident" id="6175873"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6175874">++</span>&nbsp;<span class="op" id="6175877">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6175881">//&nbsp;Convert&nbsp;from&nbsp;colors&nbsp;to&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175916">i</span>&nbsp;<span class="op" id="6175918">:=</span>&nbsp;<span class="num" id="6175921">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175925">switch</span>&nbsp;<span class="ident" id="6175932"><a href="/gostd/image/png/writer.go.html#6174845">cb</a></span>&nbsp;<span class="op" id="6175935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175939">case</span>&nbsp;<span class="ident" id="6175944"><a href="/gostd/image/png/reader.go.html#6149025">cbG8</a></span><span class="op" id="6175948">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6175953">if</span>&nbsp;<span class="ident" id="6175956"><a href="/gostd/image/png/writer.go.html#6175719">gray</a></span>&nbsp;<span class="op" id="6175961">!=</span>&nbsp;<span class="builtintype" id="6175964">nil</span>&nbsp;<span class="op" id="6175968">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6175974">offset</span>&nbsp;<span class="op" id="6175981">:=</span>&nbsp;<span class="op" id="6175984">(</span><span class="ident" id="6175985"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span>&nbsp;<span class="op" id="6175987">-</span>&nbsp;<span class="ident" id="6175989"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6175990">.</span><span class="ident" id="6175991"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6175994">.</span><span class="ident" id="6175995"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6175996">)</span>&nbsp;<span class="op" id="6175998">*</span>&nbsp;<span class="ident" id="6176000"><a href="/gostd/image/png/writer.go.html#6175719">gray</a></span><span class="op" id="6176004">.</span><span class="ident" id="6176005"><a href="/gostd/image/image.go.html#5172264">Stride</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6176016">copy</span><span class="op" id="6176020">(</span><span class="ident" id="6176021"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6176023">[</span><span class="num" id="6176024">0</span><span class="op" id="6176025">]</span><span class="op" id="6176026">[</span><span class="num" id="6176027">1</span><span class="op" id="6176028">:</span><span class="op" id="6176029">]</span><span class="op" id="6176030">,</span>&nbsp;<span class="ident" id="6176032"><a href="/gostd/image/png/writer.go.html#6175719">gray</a></span><span class="op" id="6176036">.</span><span class="ident" id="6176037"><a href="/gostd/image/image.go.html#5172175">Pix</a></span><span class="op" id="6176040">[</span><span class="ident" id="6176041"><a href="/gostd/image/png/writer.go.html#6175974">offset</a></span><span class="op" id="6176047">:</span><span class="ident" id="6176048"><a href="/gostd/image/png/writer.go.html#6175974">offset</a></span><span class="op" id="6176054">+</span><span class="ident" id="6176055"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176056">.</span><span class="ident" id="6176057"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6176059">(</span><span class="op" id="6176060">)</span><span class="op" id="6176061">]</span><span class="op" id="6176062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176067">}</span>&nbsp;<span class="keyword" id="6176069">else</span>&nbsp;<span class="op" id="6176074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176080">for</span>&nbsp;<span class="ident" id="6176084">x</span>&nbsp;<span class="op" id="6176086">:=</span>&nbsp;<span class="ident" id="6176089"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176090">.</span><span class="ident" id="6176091"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6176094">.</span><span class="ident" id="6176095"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6176096">;</span>&nbsp;<span class="ident" id="6176098"><a href="/gostd/image/png/writer.go.html#6176084">x</a></span>&nbsp;<span class="op" id="6176100">&lt;</span>&nbsp;<span class="ident" id="6176102"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176103">.</span><span class="ident" id="6176104"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6176107">.</span><span class="ident" id="6176108"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6176109">;</span>&nbsp;<span class="ident" id="6176111"><a href="/gostd/image/png/writer.go.html#6176084">x</a></span><span class="op" id="6176112">++</span>&nbsp;<span class="op" id="6176115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176122">c</span>&nbsp;<span class="op" id="6176124">:=</span>&nbsp;<span class="ident" id="6176127"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6176132">.</span><span class="ident" id="6176133"><a href="/gostd/image/color/color.go.html#5188455">GrayModel</a></span><span class="op" id="6176142">.</span><span class="ident" id="6176143"><a href="/gostd/image/color/color.go.html#5187633">Convert</a></span><span class="op" id="6176150">(</span><span class="ident" id="6176151"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6176152">.</span><span class="ident" id="6176153"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6176155">(</span><span class="ident" id="6176156"><a href="/gostd/image/png/writer.go.html#6176084">x</a></span><span class="op" id="6176157">,</span>&nbsp;<span class="ident" id="6176159"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6176160">)</span><span class="op" id="6176161">)</span><span class="op" id="6176162">.</span><span class="op" id="6176163">(</span><span class="ident" id="6176164"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6176169">.</span><span class="ident" id="6176170"><a href="/gostd/image/color/color.go.html#5187215">Gray</a></span><span class="op" id="6176174">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176181"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6176183">[</span><span class="num" id="6176184">0</span><span class="op" id="6176185">]</span><span class="op" id="6176186">[</span><span class="ident" id="6176187"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176188">]</span>&nbsp;<span class="op" id="6176190">=</span>&nbsp;<span class="ident" id="6176192"><a href="/gostd/image/png/writer.go.html#6176122">c</a></span><span class="op" id="6176193">.</span><span class="ident" id="6176194"><a href="/gostd/image/color/color.go.html#5187230">Y</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176201"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176202">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176218">case</span>&nbsp;<span class="ident" id="6176223"><a href="/gostd/image/png/reader.go.html#6149038">cbTC8</a></span><span class="op" id="6176228">:</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6176233">//&nbsp;We&nbsp;have&nbsp;previously&nbsp;verified&nbsp;that&nbsp;the&nbsp;alpha&nbsp;value&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176305">cr0</span>&nbsp;<span class="op" id="6176309">:=</span>&nbsp;<span class="ident" id="6176312"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6176314">[</span><span class="num" id="6176315">0</span><span class="op" id="6176316">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176321">stride</span><span class="op" id="6176327">,</span>&nbsp;<span class="ident" id="6176329">pix</span>&nbsp;<span class="op" id="6176333">:=</span>&nbsp;<span class="num" id="6176336">0</span><span class="op" id="6176337">,</span>&nbsp;<span class="op" id="6176339">[</span><span class="op" id="6176340">]</span><span class="builtintype" id="6176341">byte</span><span class="op" id="6176345">(</span><span class="builtintype" id="6176346">nil</span><span class="op" id="6176349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176354">if</span>&nbsp;<span class="ident" id="6176357"><a href="/gostd/image/png/writer.go.html#6175747">rgba</a></span>&nbsp;<span class="op" id="6176362">!=</span>&nbsp;<span class="builtintype" id="6176365">nil</span>&nbsp;<span class="op" id="6176369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176375"><a href="/gostd/image/png/writer.go.html#6176321">stride</a></span><span class="op" id="6176381">,</span>&nbsp;<span class="ident" id="6176383"><a href="/gostd/image/png/writer.go.html#6176329">pix</a></span>&nbsp;<span class="op" id="6176387">=</span>&nbsp;<span class="ident" id="6176389"><a href="/gostd/image/png/writer.go.html#6175747">rgba</a></span><span class="op" id="6176393">.</span><span class="ident" id="6176394"><a href="/gostd/image/image.go.html#5156154">Stride</a></span><span class="op" id="6176400">,</span>&nbsp;<span class="ident" id="6176402"><a href="/gostd/image/png/writer.go.html#6175747">rgba</a></span><span class="op" id="6176406">.</span><span class="ident" id="6176407"><a href="/gostd/image/image.go.html#5156065">Pix</a></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176414">}</span>&nbsp;<span class="keyword" id="6176416">else</span>&nbsp;<span class="keyword" id="6176421">if</span>&nbsp;<span class="ident" id="6176424"><a href="/gostd/image/png/writer.go.html#6175811">nrgba</a></span>&nbsp;<span class="op" id="6176430">!=</span>&nbsp;<span class="builtintype" id="6176433">nil</span>&nbsp;<span class="op" id="6176437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176443"><a href="/gostd/image/png/writer.go.html#6176321">stride</a></span><span class="op" id="6176449">,</span>&nbsp;<span class="ident" id="6176451"><a href="/gostd/image/png/writer.go.html#6176329">pix</a></span>&nbsp;<span class="op" id="6176455">=</span>&nbsp;<span class="ident" id="6176457"><a href="/gostd/image/png/writer.go.html#6175811">nrgba</a></span><span class="op" id="6176462">.</span><span class="ident" id="6176463"><a href="/gostd/image/image.go.html#5161709">Stride</a></span><span class="op" id="6176469">,</span>&nbsp;<span class="ident" id="6176471"><a href="/gostd/image/png/writer.go.html#6175811">nrgba</a></span><span class="op" id="6176476">.</span><span class="ident" id="6176477"><a href="/gostd/image/image.go.html#5161620">Pix</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176489">if</span>&nbsp;<span class="ident" id="6176492"><a href="/gostd/image/png/writer.go.html#6176321">stride</a></span>&nbsp;<span class="op" id="6176499">!=</span>&nbsp;<span class="num" id="6176502">0</span>&nbsp;<span class="op" id="6176504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176510">j0</span>&nbsp;<span class="op" id="6176513">:=</span>&nbsp;<span class="op" id="6176516">(</span><span class="ident" id="6176517"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span>&nbsp;<span class="op" id="6176519">-</span>&nbsp;<span class="ident" id="6176521"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176522">.</span><span class="ident" id="6176523"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6176526">.</span><span class="ident" id="6176527"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6176528">)</span>&nbsp;<span class="op" id="6176530">*</span>&nbsp;<span class="ident" id="6176532"><a href="/gostd/image/png/writer.go.html#6176321">stride</a></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176543">j1</span>&nbsp;<span class="op" id="6176546">:=</span>&nbsp;<span class="ident" id="6176549"><a href="/gostd/image/png/writer.go.html#6176510">j0</a></span>&nbsp;<span class="op" id="6176552">+</span>&nbsp;<span class="ident" id="6176554"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176555">.</span><span class="ident" id="6176556"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6176558">(</span><span class="op" id="6176559">)</span><span class="op" id="6176560">*</span><span class="num" id="6176561">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176567">for</span>&nbsp;<span class="ident" id="6176571">j</span>&nbsp;<span class="op" id="6176573">:=</span>&nbsp;<span class="ident" id="6176576"><a href="/gostd/image/png/writer.go.html#6176510">j0</a></span><span class="op" id="6176578">;</span>&nbsp;<span class="ident" id="6176580"><a href="/gostd/image/png/writer.go.html#6176571">j</a></span>&nbsp;<span class="op" id="6176582">&lt;</span>&nbsp;<span class="ident" id="6176584"><a href="/gostd/image/png/writer.go.html#6176543">j1</a></span><span class="op" id="6176586">;</span>&nbsp;<span class="ident" id="6176588"><a href="/gostd/image/png/writer.go.html#6176571">j</a></span>&nbsp;<span class="op" id="6176590">+=</span>&nbsp;<span class="num" id="6176593">4</span>&nbsp;<span class="op" id="6176595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176602"><a href="/gostd/image/png/writer.go.html#6176305">cr0</a></span><span class="op" id="6176605">[</span><span class="ident" id="6176606"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176607">+</span><span class="num" id="6176608">0</span><span class="op" id="6176609">]</span>&nbsp;<span class="op" id="6176611">=</span>&nbsp;<span class="ident" id="6176613"><a href="/gostd/image/png/writer.go.html#6176329">pix</a></span><span class="op" id="6176616">[</span><span class="ident" id="6176617"><a href="/gostd/image/png/writer.go.html#6176571">j</a></span><span class="op" id="6176618">+</span><span class="num" id="6176619">0</span><span class="op" id="6176620">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176627"><a href="/gostd/image/png/writer.go.html#6176305">cr0</a></span><span class="op" id="6176630">[</span><span class="ident" id="6176631"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176632">+</span><span class="num" id="6176633">1</span><span class="op" id="6176634">]</span>&nbsp;<span class="op" id="6176636">=</span>&nbsp;<span class="ident" id="6176638"><a href="/gostd/image/png/writer.go.html#6176329">pix</a></span><span class="op" id="6176641">[</span><span class="ident" id="6176642"><a href="/gostd/image/png/writer.go.html#6176571">j</a></span><span class="op" id="6176643">+</span><span class="num" id="6176644">1</span><span class="op" id="6176645">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176652"><a href="/gostd/image/png/writer.go.html#6176305">cr0</a></span><span class="op" id="6176655">[</span><span class="ident" id="6176656"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176657">+</span><span class="num" id="6176658">2</span><span class="op" id="6176659">]</span>&nbsp;<span class="op" id="6176661">=</span>&nbsp;<span class="ident" id="6176663"><a href="/gostd/image/png/writer.go.html#6176329">pix</a></span><span class="op" id="6176666">[</span><span class="ident" id="6176667"><a href="/gostd/image/png/writer.go.html#6176571">j</a></span><span class="op" id="6176668">+</span><span class="num" id="6176669">2</span><span class="op" id="6176670">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176677"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6176679">+=</span>&nbsp;<span class="num" id="6176682">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176693">}</span>&nbsp;<span class="keyword" id="6176695">else</span>&nbsp;<span class="op" id="6176700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176706">for</span>&nbsp;<span class="ident" id="6176710">x</span>&nbsp;<span class="op" id="6176712">:=</span>&nbsp;<span class="ident" id="6176715"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176716">.</span><span class="ident" id="6176717"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6176720">.</span><span class="ident" id="6176721"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6176722">;</span>&nbsp;<span class="ident" id="6176724"><a href="/gostd/image/png/writer.go.html#6176710">x</a></span>&nbsp;<span class="op" id="6176726">&lt;</span>&nbsp;<span class="ident" id="6176728"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176729">.</span><span class="ident" id="6176730"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6176733">.</span><span class="ident" id="6176734"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6176735">;</span>&nbsp;<span class="ident" id="6176737"><a href="/gostd/image/png/writer.go.html#6176710">x</a></span><span class="op" id="6176738">++</span>&nbsp;<span class="op" id="6176741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176748">r</span><span class="op" id="6176749">,</span>&nbsp;<span class="ident" id="6176751">g</span><span class="op" id="6176752">,</span>&nbsp;<span class="ident" id="6176754">b</span><span class="op" id="6176755">,</span>&nbsp;<span class="ident" id="6176757">_</span>&nbsp;<span class="op" id="6176759">:=</span>&nbsp;<span class="ident" id="6176762"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6176763">.</span><span class="ident" id="6176764"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6176766">(</span><span class="ident" id="6176767"><a href="/gostd/image/png/writer.go.html#6176710">x</a></span><span class="op" id="6176768">,</span>&nbsp;<span class="ident" id="6176770"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6176771">)</span><span class="op" id="6176772">.</span><span class="ident" id="6176773"><a href="/gostd/image/color/color.go.html#5185453">RGBA</a></span><span class="op" id="6176777">(</span><span class="op" id="6176778">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176785"><a href="/gostd/image/png/writer.go.html#6176305">cr0</a></span><span class="op" id="6176788">[</span><span class="ident" id="6176789"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176790">+</span><span class="num" id="6176791">0</span><span class="op" id="6176792">]</span>&nbsp;<span class="op" id="6176794">=</span>&nbsp;<span class="builtintype" id="6176796">uint8</span><span class="op" id="6176801">(</span><span class="ident" id="6176802"><a href="/gostd/image/png/writer.go.html#6176748">r</a></span>&nbsp;<span class="op" id="6176804">&gt;&gt;</span>&nbsp;<span class="num" id="6176807">8</span><span class="op" id="6176808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176815"><a href="/gostd/image/png/writer.go.html#6176305">cr0</a></span><span class="op" id="6176818">[</span><span class="ident" id="6176819"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176820">+</span><span class="num" id="6176821">1</span><span class="op" id="6176822">]</span>&nbsp;<span class="op" id="6176824">=</span>&nbsp;<span class="builtintype" id="6176826">uint8</span><span class="op" id="6176831">(</span><span class="ident" id="6176832"><a href="/gostd/image/png/writer.go.html#6176751">g</a></span>&nbsp;<span class="op" id="6176834">&gt;&gt;</span>&nbsp;<span class="num" id="6176837">8</span><span class="op" id="6176838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176845"><a href="/gostd/image/png/writer.go.html#6176305">cr0</a></span><span class="op" id="6176848">[</span><span class="ident" id="6176849"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6176850">+</span><span class="num" id="6176851">2</span><span class="op" id="6176852">]</span>&nbsp;<span class="op" id="6176854">=</span>&nbsp;<span class="builtintype" id="6176856">uint8</span><span class="op" id="6176861">(</span><span class="ident" id="6176862"><a href="/gostd/image/png/writer.go.html#6176754">b</a></span>&nbsp;<span class="op" id="6176864">&gt;&gt;</span>&nbsp;<span class="num" id="6176867">8</span><span class="op" id="6176868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176875"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6176877">+=</span>&nbsp;<span class="num" id="6176880">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176886">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6176891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176895">case</span>&nbsp;<span class="ident" id="6176900"><a href="/gostd/image/png/reader.go.html#6149063">cbP8</a></span><span class="op" id="6176904">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6176909">if</span>&nbsp;<span class="ident" id="6176912"><a href="/gostd/image/png/writer.go.html#6175775">paletted</a></span>&nbsp;<span class="op" id="6176921">!=</span>&nbsp;<span class="builtintype" id="6176924">nil</span>&nbsp;<span class="op" id="6176928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6176934">offset</span>&nbsp;<span class="op" id="6176941">:=</span>&nbsp;<span class="op" id="6176944">(</span><span class="ident" id="6176945"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span>&nbsp;<span class="op" id="6176947">-</span>&nbsp;<span class="ident" id="6176949"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6176950">.</span><span class="ident" id="6176951"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6176954">.</span><span class="ident" id="6176955"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6176956">)</span>&nbsp;<span class="op" id="6176958">*</span>&nbsp;<span class="ident" id="6176960"><a href="/gostd/image/png/writer.go.html#6175775">paletted</a></span><span class="op" id="6176968">.</span><span class="ident" id="6176969"><a href="/gostd/image/image.go.html#5176678">Stride</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6176980">copy</span><span class="op" id="6176984">(</span><span class="ident" id="6176985"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6176987">[</span><span class="num" id="6176988">0</span><span class="op" id="6176989">]</span><span class="op" id="6176990">[</span><span class="num" id="6176991">1</span><span class="op" id="6176992">:</span><span class="op" id="6176993">]</span><span class="op" id="6176994">,</span>&nbsp;<span class="ident" id="6176996"><a href="/gostd/image/png/writer.go.html#6175775">paletted</a></span><span class="op" id="6177004">.</span><span class="ident" id="6177005"><a href="/gostd/image/image.go.html#5176589">Pix</a></span><span class="op" id="6177008">[</span><span class="ident" id="6177009"><a href="/gostd/image/png/writer.go.html#6176934">offset</a></span><span class="op" id="6177015">:</span><span class="ident" id="6177016"><a href="/gostd/image/png/writer.go.html#6176934">offset</a></span><span class="op" id="6177022">+</span><span class="ident" id="6177023"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177024">.</span><span class="ident" id="6177025"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6177027">(</span><span class="op" id="6177028">)</span><span class="op" id="6177029">]</span><span class="op" id="6177030">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177035">}</span>&nbsp;<span class="keyword" id="6177037">else</span>&nbsp;<span class="op" id="6177042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177048">pi</span>&nbsp;<span class="op" id="6177051">:=</span>&nbsp;<span class="ident" id="6177054"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6177055">.</span><span class="op" id="6177056">(</span><span class="ident" id="6177057"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6177062">.</span><span class="ident" id="6177063"><a href="/gostd/image/image.go.html#5155703">PalettedImage</a></span><span class="op" id="6177076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177082">for</span>&nbsp;<span class="ident" id="6177086">x</span>&nbsp;<span class="op" id="6177088">:=</span>&nbsp;<span class="ident" id="6177091"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177092">.</span><span class="ident" id="6177093"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6177096">.</span><span class="ident" id="6177097"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177098">;</span>&nbsp;<span class="ident" id="6177100"><a href="/gostd/image/png/writer.go.html#6177086">x</a></span>&nbsp;<span class="op" id="6177102">&lt;</span>&nbsp;<span class="ident" id="6177104"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177105">.</span><span class="ident" id="6177106"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6177109">.</span><span class="ident" id="6177110"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177111">;</span>&nbsp;<span class="ident" id="6177113"><a href="/gostd/image/png/writer.go.html#6177086">x</a></span><span class="op" id="6177114">++</span>&nbsp;<span class="op" id="6177117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177124"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177126">[</span><span class="num" id="6177127">0</span><span class="op" id="6177128">]</span><span class="op" id="6177129">[</span><span class="ident" id="6177130"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177131">]</span>&nbsp;<span class="op" id="6177133">=</span>&nbsp;<span class="ident" id="6177135"><a href="/gostd/image/png/writer.go.html#6177048">pi</a></span><span class="op" id="6177137">.</span><span class="ident" id="6177138"><a href="/gostd/image/image.go.html#5155797">ColorIndexAt</a></span><span class="op" id="6177150">(</span><span class="ident" id="6177151"><a href="/gostd/image/png/writer.go.html#6177086">x</a></span><span class="op" id="6177152">,</span>&nbsp;<span class="ident" id="6177154"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6177155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177162"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6177164">+=</span>&nbsp;<span class="num" id="6177167">1</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177182">case</span>&nbsp;<span class="ident" id="6177187"><a href="/gostd/image/png/reader.go.html#6149069">cbTCA8</a></span><span class="op" id="6177193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177198">if</span>&nbsp;<span class="ident" id="6177201"><a href="/gostd/image/png/writer.go.html#6175811">nrgba</a></span>&nbsp;<span class="op" id="6177207">!=</span>&nbsp;<span class="builtintype" id="6177210">nil</span>&nbsp;<span class="op" id="6177214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177220">offset</span>&nbsp;<span class="op" id="6177227">:=</span>&nbsp;<span class="op" id="6177230">(</span><span class="ident" id="6177231"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span>&nbsp;<span class="op" id="6177233">-</span>&nbsp;<span class="ident" id="6177235"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177236">.</span><span class="ident" id="6177237"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6177240">.</span><span class="ident" id="6177241"><a href="/gostd/image/geom.go.html#5148454">Y</a></span><span class="op" id="6177242">)</span>&nbsp;<span class="op" id="6177244">*</span>&nbsp;<span class="ident" id="6177246"><a href="/gostd/image/png/writer.go.html#6175811">nrgba</a></span><span class="op" id="6177251">.</span><span class="ident" id="6177252"><a href="/gostd/image/image.go.html#5161709">Stride</a></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6177263">copy</span><span class="op" id="6177267">(</span><span class="ident" id="6177268"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177270">[</span><span class="num" id="6177271">0</span><span class="op" id="6177272">]</span><span class="op" id="6177273">[</span><span class="num" id="6177274">1</span><span class="op" id="6177275">:</span><span class="op" id="6177276">]</span><span class="op" id="6177277">,</span>&nbsp;<span class="ident" id="6177279"><a href="/gostd/image/png/writer.go.html#6175811">nrgba</a></span><span class="op" id="6177284">.</span><span class="ident" id="6177285"><a href="/gostd/image/image.go.html#5161620">Pix</a></span><span class="op" id="6177288">[</span><span class="ident" id="6177289"><a href="/gostd/image/png/writer.go.html#6177220">offset</a></span><span class="op" id="6177295">:</span><span class="ident" id="6177296"><a href="/gostd/image/png/writer.go.html#6177220">offset</a></span><span class="op" id="6177302">+</span><span class="ident" id="6177303"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177304">.</span><span class="ident" id="6177305"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6177307">(</span><span class="op" id="6177308">)</span><span class="op" id="6177309">*</span><span class="num" id="6177310">4</span><span class="op" id="6177311">]</span><span class="op" id="6177312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177317">}</span>&nbsp;<span class="keyword" id="6177319">else</span>&nbsp;<span class="op" id="6177324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6177330">//&nbsp;Convert&nbsp;from&nbsp;image.Image&nbsp;(which&nbsp;is&nbsp;alpha-premultiplied)&nbsp;to&nbsp;PNG&#39;s&nbsp;non-alpha-premultiplied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177427">for</span>&nbsp;<span class="ident" id="6177431">x</span>&nbsp;<span class="op" id="6177433">:=</span>&nbsp;<span class="ident" id="6177436"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177437">.</span><span class="ident" id="6177438"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6177441">.</span><span class="ident" id="6177442"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177443">;</span>&nbsp;<span class="ident" id="6177445"><a href="/gostd/image/png/writer.go.html#6177431">x</a></span>&nbsp;<span class="op" id="6177447">&lt;</span>&nbsp;<span class="ident" id="6177449"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177450">.</span><span class="ident" id="6177451"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6177454">.</span><span class="ident" id="6177455"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177456">;</span>&nbsp;<span class="ident" id="6177458"><a href="/gostd/image/png/writer.go.html#6177431">x</a></span><span class="op" id="6177459">++</span>&nbsp;<span class="op" id="6177462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177469">c</span>&nbsp;<span class="op" id="6177471">:=</span>&nbsp;<span class="ident" id="6177474"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6177479">.</span><span class="ident" id="6177480"><a href="/gostd/image/color/color.go.html#5188275">NRGBAModel</a></span><span class="op" id="6177490">.</span><span class="ident" id="6177491"><a href="/gostd/image/color/color.go.html#5187633">Convert</a></span><span class="op" id="6177498">(</span><span class="ident" id="6177499"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6177500">.</span><span class="ident" id="6177501"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6177503">(</span><span class="ident" id="6177504"><a href="/gostd/image/png/writer.go.html#6177431">x</a></span><span class="op" id="6177505">,</span>&nbsp;<span class="ident" id="6177507"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6177508">)</span><span class="op" id="6177509">)</span><span class="op" id="6177510">.</span><span class="op" id="6177511">(</span><span class="ident" id="6177512"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6177517">.</span><span class="ident" id="6177518"><a href="/gostd/image/color/color.go.html#5186151">NRGBA</a></span><span class="op" id="6177523">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177530"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177532">[</span><span class="num" id="6177533">0</span><span class="op" id="6177534">]</span><span class="op" id="6177535">[</span><span class="ident" id="6177536"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177537">+</span><span class="num" id="6177538">0</span><span class="op" id="6177539">]</span>&nbsp;<span class="op" id="6177541">=</span>&nbsp;<span class="ident" id="6177543"><a href="/gostd/image/png/writer.go.html#6177469">c</a></span><span class="op" id="6177544">.</span><span class="ident" id="6177545"><a href="/gostd/image/color/color.go.html#5186167">R</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177552"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177554">[</span><span class="num" id="6177555">0</span><span class="op" id="6177556">]</span><span class="op" id="6177557">[</span><span class="ident" id="6177558"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177559">+</span><span class="num" id="6177560">1</span><span class="op" id="6177561">]</span>&nbsp;<span class="op" id="6177563">=</span>&nbsp;<span class="ident" id="6177565"><a href="/gostd/image/png/writer.go.html#6177469">c</a></span><span class="op" id="6177566">.</span><span class="ident" id="6177567"><a href="/gostd/image/color/color.go.html#5186170">G</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177574"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177576">[</span><span class="num" id="6177577">0</span><span class="op" id="6177578">]</span><span class="op" id="6177579">[</span><span class="ident" id="6177580"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177581">+</span><span class="num" id="6177582">2</span><span class="op" id="6177583">]</span>&nbsp;<span class="op" id="6177585">=</span>&nbsp;<span class="ident" id="6177587"><a href="/gostd/image/png/writer.go.html#6177469">c</a></span><span class="op" id="6177588">.</span><span class="ident" id="6177589"><a href="/gostd/image/color/color.go.html#5186173">B</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177596"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177598">[</span><span class="num" id="6177599">0</span><span class="op" id="6177600">]</span><span class="op" id="6177601">[</span><span class="ident" id="6177602"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177603">+</span><span class="num" id="6177604">3</span><span class="op" id="6177605">]</span>&nbsp;<span class="op" id="6177607">=</span>&nbsp;<span class="ident" id="6177609"><a href="/gostd/image/png/writer.go.html#6177469">c</a></span><span class="op" id="6177610">.</span><span class="ident" id="6177611"><a href="/gostd/image/color/color.go.html#5186176">A</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177618"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6177620">+=</span>&nbsp;<span class="num" id="6177623">4</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177638">case</span>&nbsp;<span class="ident" id="6177643"><a href="/gostd/image/png/reader.go.html#6149077">cbG16</a></span><span class="op" id="6177648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177653">for</span>&nbsp;<span class="ident" id="6177657">x</span>&nbsp;<span class="op" id="6177659">:=</span>&nbsp;<span class="ident" id="6177662"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177663">.</span><span class="ident" id="6177664"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6177667">.</span><span class="ident" id="6177668"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177669">;</span>&nbsp;<span class="ident" id="6177671"><a href="/gostd/image/png/writer.go.html#6177657">x</a></span>&nbsp;<span class="op" id="6177673">&lt;</span>&nbsp;<span class="ident" id="6177675"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177676">.</span><span class="ident" id="6177677"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6177680">.</span><span class="ident" id="6177681"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177682">;</span>&nbsp;<span class="ident" id="6177684"><a href="/gostd/image/png/writer.go.html#6177657">x</a></span><span class="op" id="6177685">++</span>&nbsp;<span class="op" id="6177688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177694">c</span>&nbsp;<span class="op" id="6177696">:=</span>&nbsp;<span class="ident" id="6177699"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6177704">.</span><span class="ident" id="6177705"><a href="/gostd/image/color/color.go.html#5188498">Gray16Model</a></span><span class="op" id="6177716">.</span><span class="ident" id="6177717"><a href="/gostd/image/color/color.go.html#5187633">Convert</a></span><span class="op" id="6177724">(</span><span class="ident" id="6177725"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6177726">.</span><span class="ident" id="6177727"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6177729">(</span><span class="ident" id="6177730"><a href="/gostd/image/png/writer.go.html#6177657">x</a></span><span class="op" id="6177731">,</span>&nbsp;<span class="ident" id="6177733"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6177734">)</span><span class="op" id="6177735">)</span><span class="op" id="6177736">.</span><span class="op" id="6177737">(</span><span class="ident" id="6177738"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6177743">.</span><span class="ident" id="6177744"><a href="/gostd/image/color/color.go.html#5187394">Gray16</a></span><span class="op" id="6177750">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177756"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177758">[</span><span class="num" id="6177759">0</span><span class="op" id="6177760">]</span><span class="op" id="6177761">[</span><span class="ident" id="6177762"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177763">+</span><span class="num" id="6177764">0</span><span class="op" id="6177765">]</span>&nbsp;<span class="op" id="6177767">=</span>&nbsp;<span class="builtintype" id="6177769">uint8</span><span class="op" id="6177774">(</span><span class="ident" id="6177775"><a href="/gostd/image/png/writer.go.html#6177694">c</a></span><span class="op" id="6177776">.</span><span class="ident" id="6177777"><a href="/gostd/image/color/color.go.html#5187411">Y</a></span>&nbsp;<span class="op" id="6177779">&gt;&gt;</span>&nbsp;<span class="num" id="6177782">8</span><span class="op" id="6177783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177789"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177791">[</span><span class="num" id="6177792">0</span><span class="op" id="6177793">]</span><span class="op" id="6177794">[</span><span class="ident" id="6177795"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6177796">+</span><span class="num" id="6177797">1</span><span class="op" id="6177798">]</span>&nbsp;<span class="op" id="6177800">=</span>&nbsp;<span class="builtintype" id="6177802">uint8</span><span class="op" id="6177807">(</span><span class="ident" id="6177808"><a href="/gostd/image/png/writer.go.html#6177694">c</a></span><span class="op" id="6177809">.</span><span class="ident" id="6177810"><a href="/gostd/image/color/color.go.html#5187411">Y</a></span><span class="op" id="6177811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177817"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6177819">+=</span>&nbsp;<span class="num" id="6177822">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6177827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177831">case</span>&nbsp;<span class="ident" id="6177836"><a href="/gostd/image/png/reader.go.html#6149092">cbTC16</a></span><span class="op" id="6177842">:</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6177847">//&nbsp;We&nbsp;have&nbsp;previously&nbsp;verified&nbsp;that&nbsp;the&nbsp;alpha&nbsp;value&nbsp;is&nbsp;fully&nbsp;opaque.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6177919">for</span>&nbsp;<span class="ident" id="6177923">x</span>&nbsp;<span class="op" id="6177925">:=</span>&nbsp;<span class="ident" id="6177928"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177929">.</span><span class="ident" id="6177930"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6177933">.</span><span class="ident" id="6177934"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177935">;</span>&nbsp;<span class="ident" id="6177937"><a href="/gostd/image/png/writer.go.html#6177923">x</a></span>&nbsp;<span class="op" id="6177939">&lt;</span>&nbsp;<span class="ident" id="6177941"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6177942">.</span><span class="ident" id="6177943"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6177946">.</span><span class="ident" id="6177947"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6177948">;</span>&nbsp;<span class="ident" id="6177950"><a href="/gostd/image/png/writer.go.html#6177923">x</a></span><span class="op" id="6177951">++</span>&nbsp;<span class="op" id="6177954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177960">r</span><span class="op" id="6177961">,</span>&nbsp;<span class="ident" id="6177963">g</span><span class="op" id="6177964">,</span>&nbsp;<span class="ident" id="6177966">b</span><span class="op" id="6177967">,</span>&nbsp;<span class="ident" id="6177969">_</span>&nbsp;<span class="op" id="6177971">:=</span>&nbsp;<span class="ident" id="6177974"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6177975">.</span><span class="ident" id="6177976"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6177978">(</span><span class="ident" id="6177979"><a href="/gostd/image/png/writer.go.html#6177923">x</a></span><span class="op" id="6177980">,</span>&nbsp;<span class="ident" id="6177982"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6177983">)</span><span class="op" id="6177984">.</span><span class="ident" id="6177985"><a href="/gostd/image/color/color.go.html#5185453">RGBA</a></span><span class="op" id="6177989">(</span><span class="op" id="6177990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6177996"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6177998">[</span><span class="num" id="6177999">0</span><span class="op" id="6178000">]</span><span class="op" id="6178001">[</span><span class="ident" id="6178002"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178003">+</span><span class="num" id="6178004">0</span><span class="op" id="6178005">]</span>&nbsp;<span class="op" id="6178007">=</span>&nbsp;<span class="builtintype" id="6178009">uint8</span><span class="op" id="6178014">(</span><span class="ident" id="6178015"><a href="/gostd/image/png/writer.go.html#6177960">r</a></span>&nbsp;<span class="op" id="6178017">&gt;&gt;</span>&nbsp;<span class="num" id="6178020">8</span><span class="op" id="6178021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178027"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178029">[</span><span class="num" id="6178030">0</span><span class="op" id="6178031">]</span><span class="op" id="6178032">[</span><span class="ident" id="6178033"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178034">+</span><span class="num" id="6178035">1</span><span class="op" id="6178036">]</span>&nbsp;<span class="op" id="6178038">=</span>&nbsp;<span class="builtintype" id="6178040">uint8</span><span class="op" id="6178045">(</span><span class="ident" id="6178046"><a href="/gostd/image/png/writer.go.html#6177960">r</a></span><span class="op" id="6178047">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178053"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178055">[</span><span class="num" id="6178056">0</span><span class="op" id="6178057">]</span><span class="op" id="6178058">[</span><span class="ident" id="6178059"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178060">+</span><span class="num" id="6178061">2</span><span class="op" id="6178062">]</span>&nbsp;<span class="op" id="6178064">=</span>&nbsp;<span class="builtintype" id="6178066">uint8</span><span class="op" id="6178071">(</span><span class="ident" id="6178072"><a href="/gostd/image/png/writer.go.html#6177963">g</a></span>&nbsp;<span class="op" id="6178074">&gt;&gt;</span>&nbsp;<span class="num" id="6178077">8</span><span class="op" id="6178078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178084"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178086">[</span><span class="num" id="6178087">0</span><span class="op" id="6178088">]</span><span class="op" id="6178089">[</span><span class="ident" id="6178090"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178091">+</span><span class="num" id="6178092">3</span><span class="op" id="6178093">]</span>&nbsp;<span class="op" id="6178095">=</span>&nbsp;<span class="builtintype" id="6178097">uint8</span><span class="op" id="6178102">(</span><span class="ident" id="6178103"><a href="/gostd/image/png/writer.go.html#6177963">g</a></span><span class="op" id="6178104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178110"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178112">[</span><span class="num" id="6178113">0</span><span class="op" id="6178114">]</span><span class="op" id="6178115">[</span><span class="ident" id="6178116"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178117">+</span><span class="num" id="6178118">4</span><span class="op" id="6178119">]</span>&nbsp;<span class="op" id="6178121">=</span>&nbsp;<span class="builtintype" id="6178123">uint8</span><span class="op" id="6178128">(</span><span class="ident" id="6178129"><a href="/gostd/image/png/writer.go.html#6177966">b</a></span>&nbsp;<span class="op" id="6178131">&gt;&gt;</span>&nbsp;<span class="num" id="6178134">8</span><span class="op" id="6178135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178141"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178143">[</span><span class="num" id="6178144">0</span><span class="op" id="6178145">]</span><span class="op" id="6178146">[</span><span class="ident" id="6178147"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178148">+</span><span class="num" id="6178149">5</span><span class="op" id="6178150">]</span>&nbsp;<span class="op" id="6178152">=</span>&nbsp;<span class="builtintype" id="6178154">uint8</span><span class="op" id="6178159">(</span><span class="ident" id="6178160"><a href="/gostd/image/png/writer.go.html#6177966">b</a></span><span class="op" id="6178161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178167"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6178169">+=</span>&nbsp;<span class="num" id="6178172">6</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178181">case</span>&nbsp;<span class="ident" id="6178186"><a href="/gostd/image/png/reader.go.html#6149100">cbTCA16</a></span><span class="op" id="6178193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178198">//&nbsp;Convert&nbsp;from&nbsp;image.Image&nbsp;(which&nbsp;is&nbsp;alpha-premultiplied)&nbsp;to&nbsp;PNG&#39;s&nbsp;non-alpha-premultiplied.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178294">for</span>&nbsp;<span class="ident" id="6178298">x</span>&nbsp;<span class="op" id="6178300">:=</span>&nbsp;<span class="ident" id="6178303"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6178304">.</span><span class="ident" id="6178305"><a href="/gostd/image/geom.go.html#5150016">Min</a></span><span class="op" id="6178308">.</span><span class="ident" id="6178309"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6178310">;</span>&nbsp;<span class="ident" id="6178312"><a href="/gostd/image/png/writer.go.html#6178298">x</a></span>&nbsp;<span class="op" id="6178314">&lt;</span>&nbsp;<span class="ident" id="6178316"><a href="/gostd/image/png/writer.go.html#6175557">b</a></span><span class="op" id="6178317">.</span><span class="ident" id="6178318"><a href="/gostd/image/geom.go.html#5150021">Max</a></span><span class="op" id="6178321">.</span><span class="ident" id="6178322"><a href="/gostd/image/geom.go.html#5148451">X</a></span><span class="op" id="6178323">;</span>&nbsp;<span class="ident" id="6178325"><a href="/gostd/image/png/writer.go.html#6178298">x</a></span><span class="op" id="6178326">++</span>&nbsp;<span class="op" id="6178329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178335">c</span>&nbsp;<span class="op" id="6178337">:=</span>&nbsp;<span class="ident" id="6178340"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6178345">.</span><span class="ident" id="6178346"><a href="/gostd/image/color/color.go.html#5188319">NRGBA64Model</a></span><span class="op" id="6178358">.</span><span class="ident" id="6178359"><a href="/gostd/image/color/color.go.html#5187633">Convert</a></span><span class="op" id="6178366">(</span><span class="ident" id="6178367"><a href="/gostd/image/png/writer.go.html#6174830">m</a></span><span class="op" id="6178368">.</span><span class="ident" id="6178369"><a href="/gostd/image/image.go.html#5155352">At</a></span><span class="op" id="6178371">(</span><span class="ident" id="6178372"><a href="/gostd/image/png/writer.go.html#6178298">x</a></span><span class="op" id="6178373">,</span>&nbsp;<span class="ident" id="6178375"><a href="/gostd/image/png/writer.go.html#6175846">y</a></span><span class="op" id="6178376">)</span><span class="op" id="6178377">)</span><span class="op" id="6178378">.</span><span class="op" id="6178379">(</span><span class="ident" id="6178380"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6178385">.</span><span class="ident" id="6178386"><a href="/gostd/image/color/color.go.html#5186574">NRGBA64</a></span><span class="op" id="6178393">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178399"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178401">[</span><span class="num" id="6178402">0</span><span class="op" id="6178403">]</span><span class="op" id="6178404">[</span><span class="ident" id="6178405"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178406">+</span><span class="num" id="6178407">0</span><span class="op" id="6178408">]</span>&nbsp;<span class="op" id="6178410">=</span>&nbsp;<span class="builtintype" id="6178412">uint8</span><span class="op" id="6178417">(</span><span class="ident" id="6178418"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178419">.</span><span class="ident" id="6178420"><a href="/gostd/image/color/color.go.html#5186592">R</a></span>&nbsp;<span class="op" id="6178422">&gt;&gt;</span>&nbsp;<span class="num" id="6178425">8</span><span class="op" id="6178426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178432"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178434">[</span><span class="num" id="6178435">0</span><span class="op" id="6178436">]</span><span class="op" id="6178437">[</span><span class="ident" id="6178438"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178439">+</span><span class="num" id="6178440">1</span><span class="op" id="6178441">]</span>&nbsp;<span class="op" id="6178443">=</span>&nbsp;<span class="builtintype" id="6178445">uint8</span><span class="op" id="6178450">(</span><span class="ident" id="6178451"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178452">.</span><span class="ident" id="6178453"><a href="/gostd/image/color/color.go.html#5186592">R</a></span><span class="op" id="6178454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178460"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178462">[</span><span class="num" id="6178463">0</span><span class="op" id="6178464">]</span><span class="op" id="6178465">[</span><span class="ident" id="6178466"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178467">+</span><span class="num" id="6178468">2</span><span class="op" id="6178469">]</span>&nbsp;<span class="op" id="6178471">=</span>&nbsp;<span class="builtintype" id="6178473">uint8</span><span class="op" id="6178478">(</span><span class="ident" id="6178479"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178480">.</span><span class="ident" id="6178481"><a href="/gostd/image/color/color.go.html#5186595">G</a></span>&nbsp;<span class="op" id="6178483">&gt;&gt;</span>&nbsp;<span class="num" id="6178486">8</span><span class="op" id="6178487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178493"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178495">[</span><span class="num" id="6178496">0</span><span class="op" id="6178497">]</span><span class="op" id="6178498">[</span><span class="ident" id="6178499"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178500">+</span><span class="num" id="6178501">3</span><span class="op" id="6178502">]</span>&nbsp;<span class="op" id="6178504">=</span>&nbsp;<span class="builtintype" id="6178506">uint8</span><span class="op" id="6178511">(</span><span class="ident" id="6178512"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178513">.</span><span class="ident" id="6178514"><a href="/gostd/image/color/color.go.html#5186595">G</a></span><span class="op" id="6178515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178521"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178523">[</span><span class="num" id="6178524">0</span><span class="op" id="6178525">]</span><span class="op" id="6178526">[</span><span class="ident" id="6178527"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178528">+</span><span class="num" id="6178529">4</span><span class="op" id="6178530">]</span>&nbsp;<span class="op" id="6178532">=</span>&nbsp;<span class="builtintype" id="6178534">uint8</span><span class="op" id="6178539">(</span><span class="ident" id="6178540"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178541">.</span><span class="ident" id="6178542"><a href="/gostd/image/color/color.go.html#5186598">B</a></span>&nbsp;<span class="op" id="6178544">&gt;&gt;</span>&nbsp;<span class="num" id="6178547">8</span><span class="op" id="6178548">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178554"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178556">[</span><span class="num" id="6178557">0</span><span class="op" id="6178558">]</span><span class="op" id="6178559">[</span><span class="ident" id="6178560"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178561">+</span><span class="num" id="6178562">5</span><span class="op" id="6178563">]</span>&nbsp;<span class="op" id="6178565">=</span>&nbsp;<span class="builtintype" id="6178567">uint8</span><span class="op" id="6178572">(</span><span class="ident" id="6178573"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178574">.</span><span class="ident" id="6178575"><a href="/gostd/image/color/color.go.html#5186598">B</a></span><span class="op" id="6178576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178582"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178584">[</span><span class="num" id="6178585">0</span><span class="op" id="6178586">]</span><span class="op" id="6178587">[</span><span class="ident" id="6178588"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178589">+</span><span class="num" id="6178590">6</span><span class="op" id="6178591">]</span>&nbsp;<span class="op" id="6178593">=</span>&nbsp;<span class="builtintype" id="6178595">uint8</span><span class="op" id="6178600">(</span><span class="ident" id="6178601"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178602">.</span><span class="ident" id="6178603"><a href="/gostd/image/color/color.go.html#5186601">A</a></span>&nbsp;<span class="op" id="6178605">&gt;&gt;</span>&nbsp;<span class="num" id="6178608">8</span><span class="op" id="6178609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178615"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178617">[</span><span class="num" id="6178618">0</span><span class="op" id="6178619">]</span><span class="op" id="6178620">[</span><span class="ident" id="6178621"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span><span class="op" id="6178622">+</span><span class="num" id="6178623">7</span><span class="op" id="6178624">]</span>&nbsp;<span class="op" id="6178626">=</span>&nbsp;<span class="builtintype" id="6178628">uint8</span><span class="op" id="6178633">(</span><span class="ident" id="6178634"><a href="/gostd/image/png/writer.go.html#6178335">c</a></span><span class="op" id="6178635">.</span><span class="ident" id="6178636"><a href="/gostd/image/color/color.go.html#5186601">A</a></span><span class="op" id="6178637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178643"><a href="/gostd/image/png/writer.go.html#6175916">i</a></span>&nbsp;<span class="op" id="6178645">+=</span>&nbsp;<span class="num" id="6178648">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178653">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178662">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178685">f</span>&nbsp;<span class="op" id="6178687">:=</span>&nbsp;<span class="ident" id="6178690"><a href="/gostd/image/png/reader.go.html#6149157">ftNone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178699">if</span>&nbsp;<span class="ident" id="6178702"><a href="/gostd/image/png/writer.go.html#6174853">level</a></span>&nbsp;<span class="op" id="6178708">!=</span>&nbsp;<span class="ident" id="6178711"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6178715">.</span><span class="ident" id="6178716"><a href="/gostd/compress/zlib/writer.go.html#5709112">NoCompression</a></span>&nbsp;<span class="op" id="6178730">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178735"><a href="/gostd/image/png/writer.go.html#6178685">f</a></span>&nbsp;<span class="op" id="6178737">=</span>&nbsp;<span class="ident" id="6178739"><a href="/gostd/image/png/writer.go.html#6172985">filter</a></span><span class="op" id="6178745">(</span><span class="op" id="6178746">&amp;</span><span class="ident" id="6178747"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178749">,</span>&nbsp;<span class="ident" id="6178751"><a href="/gostd/image/png/writer.go.html#6175683">pr</a></span><span class="op" id="6178753">,</span>&nbsp;<span class="ident" id="6178755"><a href="/gostd/image/png/writer.go.html#6174967">bpp</a></span><span class="op" id="6178758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178767">//&nbsp;Write&nbsp;the&nbsp;compressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178800">if</span>&nbsp;<span class="ident" id="6178803">_</span><span class="op" id="6178804">,</span>&nbsp;<span class="ident" id="6178806">err</span>&nbsp;<span class="op" id="6178810">:=</span>&nbsp;<span class="ident" id="6178813"><a href="/gostd/image/png/writer.go.html#6174873">zw</a></span><span class="op" id="6178815">.</span><span class="ident" id="6178816"><a href="/gostd/compress/zlib/writer.go.html#5713081">Write</a></span><span class="op" id="6178821">(</span><span class="ident" id="6178822"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178824">[</span><span class="ident" id="6178825"><a href="/gostd/image/png/writer.go.html#6178685">f</a></span><span class="op" id="6178826">]</span><span class="op" id="6178827">)</span><span class="op" id="6178828">;</span>&nbsp;<span class="ident" id="6178830"><a href="/gostd/image/png/writer.go.html#6178806">err</a></span>&nbsp;<span class="op" id="6178834">!=</span>&nbsp;<span class="builtintype" id="6178837">nil</span>&nbsp;<span class="op" id="6178841">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178846">return</span>&nbsp;<span class="ident" id="6178853"><a href="/gostd/image/png/writer.go.html#6178806">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6178864">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6178920"><a href="/gostd/image/png/writer.go.html#6175683">pr</a></span><span class="op" id="6178922">,</span>&nbsp;<span class="ident" id="6178924"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178926">[</span><span class="num" id="6178927">0</span><span class="op" id="6178928">]</span>&nbsp;<span class="op" id="6178930">=</span>&nbsp;<span class="ident" id="6178932"><a href="/gostd/image/png/writer.go.html#6175578">cr</a></span><span class="op" id="6178934">[</span><span class="num" id="6178935">0</span><span class="op" id="6178936">]</span><span class="op" id="6178937">,</span>&nbsp;<span class="ident" id="6178939"><a href="/gostd/image/png/writer.go.html#6175683">pr</a></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6178943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6178946">return</span>&nbsp;<span class="builtintype" id="6178953">nil</span><br>
<span class="lineno"></span><span class="op" id="6178957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6178960">//&nbsp;Write&nbsp;the&nbsp;actual&nbsp;image&nbsp;data&nbsp;to&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks.</span><br>
<span class="lineno">440</span><span class="keyword" id="6179019">func</span>&nbsp;<span class="op" id="6179024">(</span><span class="ident" id="6179025">e</span>&nbsp;<span class="op" id="6179027">*</span><span class="ident" id="6179028"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><span class="op" id="6179035">)</span>&nbsp;<span class="ident" id="6179037">writeIDATs</span><span class="op" id="6179047">(</span><span class="op" id="6179048">)</span>&nbsp;<span class="op" id="6179050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179053">if</span>&nbsp;<span class="ident" id="6179056"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179057">.</span><span class="ident" id="6179058"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6179062">!=</span>&nbsp;<span class="builtintype" id="6179065">nil</span>&nbsp;<span class="op" id="6179069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179073">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179084">var</span>&nbsp;<span class="ident" id="6179088">bw</span>&nbsp;<span class="op" id="6179091">*</span><span class="ident" id="6179092"><a href="/gostd/image/png/writer.go.html#6169115">bufio</a></span><span class="op" id="6179097">.</span><span class="ident" id="6179098"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179106"><a href="/gostd/image/png/writer.go.html#6179088">bw</a></span>&nbsp;<span class="op" id="6179109">=</span>&nbsp;<span class="ident" id="6179111"><a href="/gostd/image/png/writer.go.html#6169115">bufio</a></span><span class="op" id="6179116">.</span><span class="ident" id="6179117"><a href="/gostd/bufio/bufio.go.html#1366830">NewWriterSize</a></span><span class="op" id="6179130">(</span><span class="ident" id="6179131"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179132">,</span>&nbsp;<span class="num" id="6179134">1</span><span class="op" id="6179135">&lt;&lt;</span><span class="num" id="6179137">15</span><span class="op" id="6179139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179142"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179143">.</span><span class="ident" id="6179144"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6179148">=</span>&nbsp;<span class="ident" id="6179150"><a href="/gostd/image/png/writer.go.html#6174806">writeImage</a></span><span class="op" id="6179160">(</span><span class="ident" id="6179161"><a href="/gostd/image/png/writer.go.html#6179088">bw</a></span><span class="op" id="6179163">,</span>&nbsp;<span class="ident" id="6179165"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179166">.</span><span class="ident" id="6179167"><a href="/gostd/image/png/writer.go.html#6169359">m</a></span><span class="op" id="6179168">,</span>&nbsp;<span class="ident" id="6179170"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179171">.</span><span class="ident" id="6179172"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span><span class="op" id="6179174">,</span>&nbsp;<span class="ident" id="6179176"><a href="/gostd/image/png/writer.go.html#6179398">levelToZlib</a></span><span class="op" id="6179187">(</span><span class="ident" id="6179188"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179189">.</span><span class="ident" id="6179190"><a href="/gostd/image/png/writer.go.html#6169324">enc</a></span><span class="op" id="6179193">.</span><span class="ident" id="6179194"><a href="/gostd/image/png/writer.go.html#6169264">CompressionLevel</a></span><span class="op" id="6179210">)</span><span class="op" id="6179211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179214">if</span>&nbsp;<span class="ident" id="6179217"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179218">.</span><span class="ident" id="6179219"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6179223">!=</span>&nbsp;<span class="builtintype" id="6179226">nil</span>&nbsp;<span class="op" id="6179230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179234">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179242">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6179245"><a href="/gostd/image/png/writer.go.html#6179025">e</a></span><span class="op" id="6179246">.</span><span class="ident" id="6179247"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6179251">=</span>&nbsp;<span class="ident" id="6179253"><a href="/gostd/image/png/writer.go.html#6179088">bw</a></span><span class="op" id="6179255">.</span><span class="ident" id="6179256"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="6179261">(</span><span class="op" id="6179262">)</span><br>
<span class="lineno"></span><span class="op" id="6179264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6179267">//&nbsp;This&nbsp;function&nbsp;is&nbsp;required&nbsp;because&nbsp;we&nbsp;want&nbsp;the&nbsp;zero&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="6179330">//&nbsp;Encoder.CompressionLevel&nbsp;to&nbsp;map&nbsp;to&nbsp;zlib.DefaultCompression.</span><br>
<span class="lineno">455</span><span class="keyword" id="6179393">func</span>&nbsp;<span class="ident" id="6179398">levelToZlib</span><span class="op" id="6179409">(</span><span class="ident" id="6179410">l</span>&nbsp;<span class="ident" id="6179412"><a href="/gostd/image/png/writer.go.html#6169466">CompressionLevel</a></span><span class="op" id="6179428">)</span>&nbsp;<span class="builtintype" id="6179430">int</span>&nbsp;<span class="op" id="6179434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179437">switch</span>&nbsp;<span class="ident" id="6179444"><a href="/gostd/image/png/writer.go.html#6179410">l</a></span>&nbsp;<span class="op" id="6179446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179449">case</span>&nbsp;<span class="ident" id="6179454"><a href="/gostd/image/png/writer.go.html#6169497">DefaultCompression</a></span><span class="op" id="6179472">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179476">return</span>&nbsp;<span class="ident" id="6179483"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6179487">.</span><span class="ident" id="6179488"><a href="/gostd/compress/zlib/writer.go.html#5709236">DefaultCompression</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179508">case</span>&nbsp;<span class="ident" id="6179513"><a href="/gostd/image/png/writer.go.html#6169538">NoCompression</a></span><span class="op" id="6179526">:</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179530">return</span>&nbsp;<span class="ident" id="6179537"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6179541">.</span><span class="ident" id="6179542"><a href="/gostd/compress/zlib/writer.go.html#5709112">NoCompression</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179557">case</span>&nbsp;<span class="ident" id="6179562"><a href="/gostd/image/png/writer.go.html#6169580">BestSpeed</a></span><span class="op" id="6179571">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179575">return</span>&nbsp;<span class="ident" id="6179582"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6179586">.</span><span class="ident" id="6179587"><a href="/gostd/compress/zlib/writer.go.html#5709154">BestSpeed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179598">case</span>&nbsp;<span class="ident" id="6179603"><a href="/gostd/image/png/writer.go.html#6169622">BestCompression</a></span><span class="op" id="6179618">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179622">return</span>&nbsp;<span class="ident" id="6179629"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6179633">.</span><span class="ident" id="6179634"><a href="/gostd/compress/zlib/writer.go.html#5709192">BestCompression</a></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179651">default</span><span class="op" id="6179658">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179662">return</span>&nbsp;<span class="ident" id="6179669"><a href="/gostd/image/png/writer.go.html#6169124">zlib</a></span><span class="op" id="6179673">.</span><span class="ident" id="6179674"><a href="/gostd/compress/zlib/writer.go.html#5709236">DefaultCompression</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6179694">}</span><br>
<span class="lineno"></span><span class="op" id="6179696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="keyword" id="6179699">func</span>&nbsp;<span class="op" id="6179704">(</span><span class="ident" id="6179705">e</span>&nbsp;<span class="op" id="6179707">*</span><span class="ident" id="6179708"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><span class="op" id="6179715">)</span>&nbsp;<span class="ident" id="6179717">writeIEND</span><span class="op" id="6179726">(</span><span class="op" id="6179727">)</span>&nbsp;<span class="op" id="6179729">{</span>&nbsp;<span class="ident" id="6179731"><a href="/gostd/image/png/writer.go.html#6179705">e</a></span><span class="op" id="6179732">.</span><span class="ident" id="6179733"><a href="/gostd/image/png/writer.go.html#6170489">writeChunk</a></span><span class="op" id="6179743">(</span><span class="builtintype" id="6179744">nil</span><span class="op" id="6179747">,</span>&nbsp;<span class="string" id="6179749">&#34;IEND&#34;</span><span class="op" id="6179755">)</span>&nbsp;<span class="op" id="6179757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6179760">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;PNG&nbsp;format.&nbsp;Any&nbsp;Image&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6179826">//&nbsp;encoded,&nbsp;but&nbsp;images&nbsp;that&nbsp;are&nbsp;not&nbsp;image.NRGBA&nbsp;might&nbsp;be&nbsp;encoded&nbsp;lossily.</span><br>
<span class="lineno"></span><span class="keyword" id="6179900">func</span>&nbsp;<span class="ident" id="6179905">Encode</span><span class="op" id="6179911">(</span><span class="ident" id="6179912">w</span>&nbsp;<span class="ident" id="6179914"><a href="/gostd/image/png/writer.go.html#6169179">io</a></span><span class="op" id="6179916">.</span><span class="ident" id="6179917"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="6179923">,</span>&nbsp;<span class="ident" id="6179925">m</span>&nbsp;<span class="ident" id="6179927"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6179932">.</span><span class="ident" id="6179933"><a href="/gostd/image/image.go.html#5154907">Image</a></span><span class="op" id="6179938">)</span>&nbsp;<span class="builtintype" id="6179940">error</span>&nbsp;<span class="op" id="6179946">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179949">var</span>&nbsp;<span class="ident" id="6179953">e</span>&nbsp;<span class="ident" id="6179955"><a href="/gostd/image/png/writer.go.html#6169246">Encoder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6179964">return</span>&nbsp;<span class="ident" id="6179971"><a href="/gostd/image/png/writer.go.html#6179953">e</a></span><span class="op" id="6179972">.</span><span class="ident" id="6179973"><a href="/gostd/image/png/writer.go.html#6180058">Encode</a></span><span class="op" id="6179979">(</span><span class="ident" id="6179980"><a href="/gostd/image/png/writer.go.html#6179912">w</a></span><span class="op" id="6179981">,</span>&nbsp;<span class="ident" id="6179983"><a href="/gostd/image/png/writer.go.html#6179925">m</a></span><span class="op" id="6179984">)</span><br>
<span class="lineno"></span><span class="op" id="6179986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6179989">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;PNG&nbsp;format.</span><br>
<span class="lineno">480</span><span class="keyword" id="6180038">func</span>&nbsp;<span class="op" id="6180043">(</span><span class="ident" id="6180044">enc</span>&nbsp;<span class="op" id="6180048">*</span><span class="ident" id="6180049"><a href="/gostd/image/png/writer.go.html#6169246">Encoder</a></span><span class="op" id="6180056">)</span>&nbsp;<span class="ident" id="6180058">Encode</span><span class="op" id="6180064">(</span><span class="ident" id="6180065">w</span>&nbsp;<span class="ident" id="6180067"><a href="/gostd/image/png/writer.go.html#6169179">io</a></span><span class="op" id="6180069">.</span><span class="ident" id="6180070"><a href="/gostd/io/io.go.html#1422314">Writer</a></span><span class="op" id="6180076">,</span>&nbsp;<span class="ident" id="6180078">m</span>&nbsp;<span class="ident" id="6180080"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6180085">.</span><span class="ident" id="6180086"><a href="/gostd/image/image.go.html#5154907">Image</a></span><span class="op" id="6180091">)</span>&nbsp;<span class="builtintype" id="6180093">error</span>&nbsp;<span class="op" id="6180099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180102">//&nbsp;Obviously,&nbsp;negative&nbsp;widths&nbsp;and&nbsp;heights&nbsp;are&nbsp;invalid.&nbsp;Furthermore,&nbsp;the&nbsp;PNG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180179">//&nbsp;spec&nbsp;section&nbsp;11.2.2&nbsp;says&nbsp;that&nbsp;zero&nbsp;is&nbsp;invalid.&nbsp;Excessively&nbsp;large&nbsp;images&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180259">//&nbsp;also&nbsp;rejected.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180278">mw</span><span class="op" id="6180280">,</span>&nbsp;<span class="ident" id="6180282">mh</span>&nbsp;<span class="op" id="6180285">:=</span>&nbsp;<span class="builtintype" id="6180288">int64</span><span class="op" id="6180293">(</span><span class="ident" id="6180294"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6180295">.</span><span class="ident" id="6180296"><a href="/gostd/image/image.go.html#5155130">Bounds</a></span><span class="op" id="6180302">(</span><span class="op" id="6180303">)</span><span class="op" id="6180304">.</span><span class="ident" id="6180305"><a href="/gostd/image/geom.go.html#5150231">Dx</a></span><span class="op" id="6180307">(</span><span class="op" id="6180308">)</span><span class="op" id="6180309">)</span><span class="op" id="6180310">,</span>&nbsp;<span class="builtintype" id="6180312">int64</span><span class="op" id="6180317">(</span><span class="ident" id="6180318"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6180319">.</span><span class="ident" id="6180320"><a href="/gostd/image/image.go.html#5155130">Bounds</a></span><span class="op" id="6180326">(</span><span class="op" id="6180327">)</span><span class="op" id="6180328">.</span><span class="ident" id="6180329"><a href="/gostd/image/geom.go.html#5150316">Dy</a></span><span class="op" id="6180331">(</span><span class="op" id="6180332">)</span><span class="op" id="6180333">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180336">if</span>&nbsp;<span class="ident" id="6180339"><a href="/gostd/image/png/writer.go.html#6180278">mw</a></span>&nbsp;<span class="op" id="6180342">&lt;=</span>&nbsp;<span class="num" id="6180345">0</span>&nbsp;<span class="op" id="6180347">||</span>&nbsp;<span class="ident" id="6180350"><a href="/gostd/image/png/writer.go.html#6180282">mh</a></span>&nbsp;<span class="op" id="6180353">&lt;=</span>&nbsp;<span class="num" id="6180356">0</span>&nbsp;<span class="op" id="6180358">||</span>&nbsp;<span class="ident" id="6180361"><a href="/gostd/image/png/writer.go.html#6180278">mw</a></span>&nbsp;<span class="op" id="6180364">&gt;=</span>&nbsp;<span class="num" id="6180367">1</span><span class="op" id="6180368">&lt;&lt;</span><span class="num" id="6180370">32</span>&nbsp;<span class="op" id="6180373">||</span>&nbsp;<span class="ident" id="6180376"><a href="/gostd/image/png/writer.go.html#6180282">mh</a></span>&nbsp;<span class="op" id="6180379">&gt;=</span>&nbsp;<span class="num" id="6180382">1</span><span class="op" id="6180383">&lt;&lt;</span><span class="num" id="6180385">32</span>&nbsp;<span class="op" id="6180388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180392">return</span>&nbsp;<span class="ident" id="6180399"><a href="/gostd/image/png/reader.go.html#6150487">FormatError</a></span><span class="op" id="6180410">(</span><span class="string" id="6180411">&#34;invalid&nbsp;image&nbsp;size:&nbsp;&#34;</span>&nbsp;<span class="op" id="6180434">+</span>&nbsp;<span class="ident" id="6180436"><a href="/gostd/image/png/writer.go.html#6169185">strconv</a></span><span class="op" id="6180443">.</span><span class="ident" id="6180444"><a href="/gostd/strconv/itoa.go.html#2407133">FormatInt</a></span><span class="op" id="6180453">(</span><span class="ident" id="6180454"><a href="/gostd/image/png/writer.go.html#6180278">mw</a></span><span class="op" id="6180456">,</span>&nbsp;<span class="num" id="6180458">10</span><span class="op" id="6180460">)</span>&nbsp;<span class="op" id="6180462">+</span>&nbsp;<span class="string" id="6180464">&#34;x&#34;</span>&nbsp;<span class="op" id="6180468">+</span>&nbsp;<span class="ident" id="6180470"><a href="/gostd/image/png/writer.go.html#6169185">strconv</a></span><span class="op" id="6180477">.</span><span class="ident" id="6180478"><a href="/gostd/strconv/itoa.go.html#2407133">FormatInt</a></span><span class="op" id="6180487">(</span><span class="ident" id="6180488"><a href="/gostd/image/png/writer.go.html#6180282">mh</a></span><span class="op" id="6180490">,</span>&nbsp;<span class="num" id="6180492">10</span><span class="op" id="6180494">)</span><span class="op" id="6180495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180502">var</span>&nbsp;<span class="ident" id="6180506">e</span>&nbsp;<span class="ident" id="6180508"><a href="/gostd/image/png/writer.go.html#6169306">encoder</a></span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180517"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180518">.</span><span class="ident" id="6180519"><a href="/gostd/image/png/writer.go.html#6169324">enc</a></span>&nbsp;<span class="op" id="6180523">=</span>&nbsp;<span class="ident" id="6180525"><a href="/gostd/image/png/writer.go.html#6180044">enc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180530"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180531">.</span><span class="ident" id="6180532"><a href="/gostd/image/png/writer.go.html#6169341">w</a></span>&nbsp;<span class="op" id="6180534">=</span>&nbsp;<span class="ident" id="6180536"><a href="/gostd/image/png/writer.go.html#6180065">w</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180539"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180540">.</span><span class="ident" id="6180541"><a href="/gostd/image/png/writer.go.html#6169359">m</a></span>&nbsp;<span class="op" id="6180543">=</span>&nbsp;<span class="ident" id="6180545"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180549">var</span>&nbsp;<span class="ident" id="6180553">pal</span>&nbsp;<span class="ident" id="6180557"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180562">.</span><span class="ident" id="6180563"><a href="/gostd/image/color/color.go.html#5190467">Palette</a></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6180572">//&nbsp;cbP8&nbsp;encoding&nbsp;needs&nbsp;PalettedImage&#39;s&nbsp;ColorIndexAt&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180633">if</span>&nbsp;<span class="ident" id="6180636">_</span><span class="op" id="6180637">,</span>&nbsp;<span class="ident" id="6180639">ok</span>&nbsp;<span class="op" id="6180642">:=</span>&nbsp;<span class="ident" id="6180645"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6180646">.</span><span class="op" id="6180647">(</span><span class="ident" id="6180648"><a href="/gostd/image/png/writer.go.html#6169155">image</a></span><span class="op" id="6180653">.</span><span class="ident" id="6180654"><a href="/gostd/image/image.go.html#5155703">PalettedImage</a></span><span class="op" id="6180667">)</span><span class="op" id="6180668">;</span>&nbsp;<span class="ident" id="6180670"><a href="/gostd/image/png/writer.go.html#6180639">ok</a></span>&nbsp;<span class="op" id="6180673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180677"><a href="/gostd/image/png/writer.go.html#6180553">pal</a></span><span class="op" id="6180680">,</span>&nbsp;<span class="ident" id="6180682">_</span>&nbsp;<span class="op" id="6180684">=</span>&nbsp;<span class="ident" id="6180686"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6180687">.</span><span class="ident" id="6180688"><a href="/gostd/image/image.go.html#5154974">ColorModel</a></span><span class="op" id="6180698">(</span><span class="op" id="6180699">)</span><span class="op" id="6180700">.</span><span class="op" id="6180701">(</span><span class="ident" id="6180702"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180707">.</span><span class="ident" id="6180708"><a href="/gostd/image/color/color.go.html#5190467">Palette</a></span><span class="op" id="6180715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180721">if</span>&nbsp;<span class="ident" id="6180724"><a href="/gostd/image/png/writer.go.html#6180553">pal</a></span>&nbsp;<span class="op" id="6180728">!=</span>&nbsp;<span class="builtintype" id="6180731">nil</span>&nbsp;<span class="op" id="6180735">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180739"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180740">.</span><span class="ident" id="6180741"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6180744">=</span>&nbsp;<span class="ident" id="6180746"><a href="/gostd/image/png/reader.go.html#6149063">cbP8</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180752">}</span>&nbsp;<span class="keyword" id="6180754">else</span>&nbsp;<span class="op" id="6180759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180763">switch</span>&nbsp;<span class="ident" id="6180770"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6180771">.</span><span class="ident" id="6180772"><a href="/gostd/image/image.go.html#5154974">ColorModel</a></span><span class="op" id="6180782">(</span><span class="op" id="6180783">)</span>&nbsp;<span class="op" id="6180785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180789">case</span>&nbsp;<span class="ident" id="6180794"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180799">.</span><span class="ident" id="6180800"><a href="/gostd/image/color/color.go.html#5188455">GrayModel</a></span><span class="op" id="6180809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180814"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180815">.</span><span class="ident" id="6180816"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6180819">=</span>&nbsp;<span class="ident" id="6180821"><a href="/gostd/image/png/reader.go.html#6149025">cbG8</a></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180828">case</span>&nbsp;<span class="ident" id="6180833"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180838">.</span><span class="ident" id="6180839"><a href="/gostd/image/color/color.go.html#5188498">Gray16Model</a></span><span class="op" id="6180850">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180855"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180856">.</span><span class="ident" id="6180857"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6180860">=</span>&nbsp;<span class="ident" id="6180862"><a href="/gostd/image/png/reader.go.html#6149077">cbG16</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180870">case</span>&nbsp;<span class="ident" id="6180875"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180880">.</span><span class="ident" id="6180881"><a href="/gostd/image/color/color.go.html#5188187">RGBAModel</a></span><span class="op" id="6180890">,</span>&nbsp;<span class="ident" id="6180892"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180897">.</span><span class="ident" id="6180898"><a href="/gostd/image/color/color.go.html#5188275">NRGBAModel</a></span><span class="op" id="6180908">,</span>&nbsp;<span class="ident" id="6180910"><a href="/gostd/image/png/writer.go.html#6169164">color</a></span><span class="op" id="6180915">.</span><span class="ident" id="6180916"><a href="/gostd/image/color/color.go.html#5188365">AlphaModel</a></span><span class="op" id="6180926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6180931">if</span>&nbsp;<span class="ident" id="6180934"><a href="/gostd/image/png/writer.go.html#6170050">opaque</a></span><span class="op" id="6180940">(</span><span class="ident" id="6180941"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6180942">)</span>&nbsp;<span class="op" id="6180944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180950"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180951">.</span><span class="ident" id="6180952"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6180955">=</span>&nbsp;<span class="ident" id="6180957"><a href="/gostd/image/png/reader.go.html#6149038">cbTC8</a></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180966">}</span>&nbsp;<span class="keyword" id="6180968">else</span>&nbsp;<span class="op" id="6180973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6180979"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6180980">.</span><span class="ident" id="6180981"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6180984">=</span>&nbsp;<span class="ident" id="6180986"><a href="/gostd/image/png/reader.go.html#6149069">cbTCA8</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6180996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181000">default</span><span class="op" id="6181007">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181012">if</span>&nbsp;<span class="ident" id="6181015"><a href="/gostd/image/png/writer.go.html#6170050">opaque</a></span><span class="op" id="6181021">(</span><span class="ident" id="6181022"><a href="/gostd/image/png/writer.go.html#6180078">m</a></span><span class="op" id="6181023">)</span>&nbsp;<span class="op" id="6181025">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181031"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181032">.</span><span class="ident" id="6181033"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6181036">=</span>&nbsp;<span class="ident" id="6181038"><a href="/gostd/image/png/reader.go.html#6149092">cbTC16</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181048">}</span>&nbsp;<span class="keyword" id="6181050">else</span>&nbsp;<span class="op" id="6181055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181061"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181062">.</span><span class="ident" id="6181063"><a href="/gostd/image/png/writer.go.html#6169379">cb</a></span>&nbsp;<span class="op" id="6181066">=</span>&nbsp;<span class="ident" id="6181068"><a href="/gostd/image/png/reader.go.html#6149100">cbTCA16</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181083">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181090">_</span><span class="op" id="6181091">,</span>&nbsp;<span class="ident" id="6181093"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181094">.</span><span class="ident" id="6181095"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span>&nbsp;<span class="op" id="6181099">=</span>&nbsp;<span class="ident" id="6181101"><a href="/gostd/image/png/writer.go.html#6169179">io</a></span><span class="op" id="6181103">.</span><span class="ident" id="6181104"><a href="/gostd/io/io.go.html#1428475">WriteString</a></span><span class="op" id="6181115">(</span><span class="ident" id="6181116"><a href="/gostd/image/png/writer.go.html#6180065">w</a></span><span class="op" id="6181117">,</span>&nbsp;<span class="ident" id="6181119"><a href="/gostd/image/png/reader.go.html#6150110">pngHeader</a></span><span class="op" id="6181128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181131"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181132">.</span><span class="ident" id="6181133"><a href="/gostd/image/png/writer.go.html#6171101">writeIHDR</a></span><span class="op" id="6181142">(</span><span class="op" id="6181143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181146">if</span>&nbsp;<span class="ident" id="6181149"><a href="/gostd/image/png/writer.go.html#6180553">pal</a></span>&nbsp;<span class="op" id="6181153">!=</span>&nbsp;<span class="builtintype" id="6181156">nil</span>&nbsp;<span class="op" id="6181160">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181164"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181165">.</span><span class="ident" id="6181166"><a href="/gostd/image/png/writer.go.html#6171826">writePLTEAndTRNS</a></span><span class="op" id="6181182">(</span><span class="ident" id="6181183"><a href="/gostd/image/png/writer.go.html#6180553">pal</a></span><span class="op" id="6181186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6181189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181192"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181193">.</span><span class="ident" id="6181194"><a href="/gostd/image/png/writer.go.html#6179037">writeIDATs</a></span><span class="op" id="6181204">(</span><span class="op" id="6181205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6181208"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181209">.</span><span class="ident" id="6181210"><a href="/gostd/image/png/writer.go.html#6179717">writeIEND</a></span><span class="op" id="6181219">(</span><span class="op" id="6181220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6181223">return</span>&nbsp;<span class="ident" id="6181230"><a href="/gostd/image/png/writer.go.html#6180506">e</a></span><span class="op" id="6181231">.</span><span class="ident" id="6181232"><a href="/gostd/image/png/writer.go.html#6169391">err</a></span><br>
<span class="lineno">530</span><span class="op" id="6181236">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
