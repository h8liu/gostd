<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6291840">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6291895">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6291949">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6292000">package</span>&nbsp;<span class="ident" id="6292008">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6292014">import</span>&nbsp;<span class="op" id="6292021">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6292024">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6292042">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6292049">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6292057">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6292073">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6292078">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6292081">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="6292161">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="6292227">const</span>&nbsp;<span class="op" id="6292233">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292236">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6292255">=</span>&nbsp;<span class="ident" id="6292257">flate</span><span class="op" id="6292262">.</span><span class="ident" id="6292263">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292278">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6292297">=</span>&nbsp;<span class="ident" id="6292299">flate</span><span class="op" id="6292304">.</span><span class="ident" id="6292305">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292316">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6292335">=</span>&nbsp;<span class="ident" id="6292337">flate</span><span class="op" id="6292342">.</span><span class="ident" id="6292343">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292360">DefaultCompression</span>&nbsp;<span class="op" id="6292379">=</span>&nbsp;<span class="ident" id="6292381">flate</span><span class="op" id="6292386">.</span><span class="ident" id="6292387">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="6292406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6292409">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="6292472">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="6292534">type</span>&nbsp;<span class="ident" id="6292539">Writer</span>&nbsp;<span class="keyword" id="6292546">struct</span>&nbsp;<span class="op" id="6292553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292556">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292568">io</span><span class="op" id="6292570">.</span><span class="ident" id="6292571">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292579">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6292591">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292596">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6292608">[</span><span class="op" id="6292609">]</span><span class="builtintype" id="6292610">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292616">compressor</span>&nbsp;&nbsp;<span class="op" id="6292628">*</span><span class="ident" id="6292629">flate</span><span class="op" id="6292634">.</span><span class="ident" id="6292635">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292643">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292655">hash</span><span class="op" id="6292659">.</span><span class="ident" id="6292660">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292668">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6292680">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292687">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6292699">[</span><span class="num" id="6292700">4</span><span class="op" id="6292701">]</span><span class="builtintype" id="6292702">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6292708">wroteHeader</span>&nbsp;<span class="builtintype" id="6292720">bool</span><br>
<span class="lineno">35</span><span class="op" id="6292725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6292728">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="6292763">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="6292829">//</span><br>
<span class="lineno">40</span><span class="comment" id="6292832">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="6292913">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6292968">func</span>&nbsp;<span class="ident" id="6292973">NewWriter</span><span class="op" id="6292982">(</span><span class="ident" id="6292983">w</span>&nbsp;<span class="ident" id="6292985">io</span><span class="op" id="6292987">.</span><span class="ident" id="6292988">Writer</span><span class="op" id="6292994">)</span>&nbsp;<span class="op" id="6292996">*</span><span class="ident" id="6292997">Writer</span>&nbsp;<span class="op" id="6293004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293007">z</span><span class="op" id="6293008">,</span>&nbsp;<span class="ident" id="6293010">_</span>&nbsp;<span class="op" id="6293012">:=</span>&nbsp;<span class="ident" id="6293015">NewWriterLevelDict</span><span class="op" id="6293033">(</span><span class="ident" id="6293034">w</span><span class="op" id="6293035">,</span>&nbsp;<span class="ident" id="6293037">DefaultCompression</span><span class="op" id="6293055">,</span>&nbsp;<span class="ident" id="6293057">nil</span><span class="op" id="6293060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6293063">return</span>&nbsp;<span class="ident" id="6293070">z</span><br>
<span class="lineno">45</span><span class="op" id="6293072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6293075">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="6293155">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="6293190">//</span><br>
<span class="lineno">50</span><span class="comment" id="6293193">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6293267">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6293343">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="6293390">func</span>&nbsp;<span class="ident" id="6293395">NewWriterLevel</span><span class="op" id="6293409">(</span><span class="ident" id="6293410">w</span>&nbsp;<span class="ident" id="6293412">io</span><span class="op" id="6293414">.</span><span class="ident" id="6293415">Writer</span><span class="op" id="6293421">,</span>&nbsp;<span class="ident" id="6293423">level</span>&nbsp;<span class="builtintype" id="6293429">int</span><span class="op" id="6293432">)</span>&nbsp;<span class="op" id="6293434">(</span><span class="op" id="6293435">*</span><span class="ident" id="6293436">Writer</span><span class="op" id="6293442">,</span>&nbsp;<span class="builtintype" id="6293444">error</span><span class="op" id="6293449">)</span>&nbsp;<span class="op" id="6293451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6293454">return</span>&nbsp;<span class="ident" id="6293461">NewWriterLevelDict</span><span class="op" id="6293479">(</span><span class="ident" id="6293480">w</span><span class="op" id="6293481">,</span>&nbsp;<span class="ident" id="6293483">level</span><span class="op" id="6293488">,</span>&nbsp;<span class="ident" id="6293490">nil</span><span class="op" id="6293493">)</span><br>
<span class="lineno">55</span><span class="op" id="6293495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6293498">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6293573">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="6293591">//</span><br>
<span class="lineno">60</span><span class="comment" id="6293594">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="6293674">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6293699">func</span>&nbsp;<span class="ident" id="6293704">NewWriterLevelDict</span><span class="op" id="6293722">(</span><span class="ident" id="6293723">w</span>&nbsp;<span class="ident" id="6293725">io</span><span class="op" id="6293727">.</span><span class="ident" id="6293728">Writer</span><span class="op" id="6293734">,</span>&nbsp;<span class="ident" id="6293736">level</span>&nbsp;<span class="builtintype" id="6293742">int</span><span class="op" id="6293745">,</span>&nbsp;<span class="ident" id="6293747">dict</span>&nbsp;<span class="op" id="6293752">[</span><span class="op" id="6293753">]</span><span class="builtintype" id="6293754">byte</span><span class="op" id="6293758">)</span>&nbsp;<span class="op" id="6293760">(</span><span class="op" id="6293761">*</span><span class="ident" id="6293762">Writer</span><span class="op" id="6293768">,</span>&nbsp;<span class="builtintype" id="6293770">error</span><span class="op" id="6293775">)</span>&nbsp;<span class="op" id="6293777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6293780">if</span>&nbsp;<span class="ident" id="6293783">level</span>&nbsp;<span class="op" id="6293789">&lt;</span>&nbsp;<span class="ident" id="6293791">DefaultCompression</span>&nbsp;<span class="op" id="6293810">||</span>&nbsp;<span class="ident" id="6293813">level</span>&nbsp;<span class="op" id="6293819">&gt;</span>&nbsp;<span class="ident" id="6293821">BestCompression</span>&nbsp;<span class="op" id="6293837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6293841">return</span>&nbsp;<span class="ident" id="6293848">nil</span><span class="op" id="6293851">,</span>&nbsp;<span class="ident" id="6293853">fmt</span><span class="op" id="6293856">.</span><span class="ident" id="6293857">Errorf</span><span class="op" id="6293863">(</span><span class="string" id="6293864">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="6293901">,</span>&nbsp;<span class="ident" id="6293903">level</span><span class="op" id="6293908">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6293911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6293914">return</span>&nbsp;<span class="op" id="6293921">&amp;</span><span class="ident" id="6293922">Writer</span><span class="op" id="6293928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293932">w</span><span class="op" id="6293933">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293939">w</span><span class="op" id="6293940">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293944">level</span><span class="op" id="6293949">:</span>&nbsp;<span class="ident" id="6293951">level</span><span class="op" id="6293956">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6293960">dict</span><span class="op" id="6293964">:</span>&nbsp;&nbsp;<span class="ident" id="6293967">dict</span><span class="op" id="6293971">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6293974">}</span><span class="op" id="6293975">,</span>&nbsp;<span class="ident" id="6293977">nil</span><br>
<span class="lineno"></span><span class="op" id="6293981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6293984">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6294060">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="6294140">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6294149">func</span>&nbsp;<span class="op" id="6294154">(</span><span class="ident" id="6294155">z</span>&nbsp;<span class="op" id="6294157">*</span><span class="ident" id="6294158">Writer</span><span class="op" id="6294164">)</span>&nbsp;<span class="ident" id="6294166">Reset</span><span class="op" id="6294171">(</span><span class="ident" id="6294172">w</span>&nbsp;<span class="ident" id="6294174">io</span><span class="op" id="6294176">.</span><span class="ident" id="6294177">Writer</span><span class="op" id="6294183">)</span>&nbsp;<span class="op" id="6294185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294188">z</span><span class="op" id="6294189">.</span><span class="ident" id="6294190">w</span>&nbsp;<span class="op" id="6294192">=</span>&nbsp;<span class="ident" id="6294194">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294197">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6294236">if</span>&nbsp;<span class="ident" id="6294239">z</span><span class="op" id="6294240">.</span><span class="ident" id="6294241">compressor</span>&nbsp;<span class="op" id="6294252">!=</span>&nbsp;<span class="ident" id="6294255">nil</span>&nbsp;<span class="op" id="6294259">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294263">z</span><span class="op" id="6294264">.</span><span class="ident" id="6294265">compressor</span><span class="op" id="6294275">.</span><span class="ident" id="6294276">Reset</span><span class="op" id="6294281">(</span><span class="ident" id="6294282">w</span><span class="op" id="6294283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6294286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6294289">if</span>&nbsp;<span class="ident" id="6294292">z</span><span class="op" id="6294293">.</span><span class="ident" id="6294294">digest</span>&nbsp;<span class="op" id="6294301">!=</span>&nbsp;<span class="ident" id="6294304">nil</span>&nbsp;<span class="op" id="6294308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294312">z</span><span class="op" id="6294313">.</span><span class="ident" id="6294314">digest</span><span class="op" id="6294320">.</span><span class="ident" id="6294321">Reset</span><span class="op" id="6294326">(</span><span class="op" id="6294327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6294330">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294333">z</span><span class="op" id="6294334">.</span><span class="ident" id="6294335">err</span>&nbsp;<span class="op" id="6294339">=</span>&nbsp;<span class="ident" id="6294341">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294346">z</span><span class="op" id="6294347">.</span><span class="ident" id="6294348">scratch</span>&nbsp;<span class="op" id="6294356">=</span>&nbsp;<span class="op" id="6294358">[</span><span class="num" id="6294359">4</span><span class="op" id="6294360">]</span><span class="builtintype" id="6294361">byte</span><span class="op" id="6294365">{</span><span class="op" id="6294366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294369">z</span><span class="op" id="6294370">.</span><span class="ident" id="6294371">wroteHeader</span>&nbsp;<span class="op" id="6294383">=</span>&nbsp;<span class="builtintype" id="6294385">false</span><br>
<span class="lineno"></span><span class="op" id="6294391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="6294394">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="6294433">func</span>&nbsp;<span class="op" id="6294438">(</span><span class="ident" id="6294439">z</span>&nbsp;<span class="op" id="6294441">*</span><span class="ident" id="6294442">Writer</span><span class="op" id="6294448">)</span>&nbsp;<span class="ident" id="6294450">writeHeader</span><span class="op" id="6294461">(</span><span class="op" id="6294462">)</span>&nbsp;<span class="op" id="6294464">(</span><span class="ident" id="6294465">err</span>&nbsp;<span class="builtintype" id="6294469">error</span><span class="op" id="6294474">)</span>&nbsp;<span class="op" id="6294476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294479">z</span><span class="op" id="6294480">.</span><span class="ident" id="6294481">wroteHeader</span>&nbsp;<span class="op" id="6294493">=</span>&nbsp;<span class="builtintype" id="6294495">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294501">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294561">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294666">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6294745">z</span><span class="op" id="6294746">.</span><span class="ident" id="6294747">scratch</span><span class="op" id="6294754">[</span><span class="num" id="6294755">0</span><span class="op" id="6294756">]</span>&nbsp;<span class="op" id="6294758">=</span>&nbsp;<span class="num" id="6294760">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294766">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294844">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294886">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6294944">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6294999">switch</span>&nbsp;<span class="ident" id="6295006">z</span><span class="op" id="6295007">.</span><span class="ident" id="6295008">level</span>&nbsp;<span class="op" id="6295014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295017">case</span>&nbsp;<span class="num" id="6295022">0</span><span class="op" id="6295023">,</span>&nbsp;<span class="num" id="6295025">1</span><span class="op" id="6295026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295030">z</span><span class="op" id="6295031">.</span><span class="ident" id="6295032">scratch</span><span class="op" id="6295039">[</span><span class="num" id="6295040">1</span><span class="op" id="6295041">]</span>&nbsp;<span class="op" id="6295043">=</span>&nbsp;<span class="num" id="6295045">0</span>&nbsp;<span class="op" id="6295047">&lt;&lt;</span>&nbsp;<span class="num" id="6295050">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295053">case</span>&nbsp;<span class="num" id="6295058">2</span><span class="op" id="6295059">,</span>&nbsp;<span class="num" id="6295061">3</span><span class="op" id="6295062">,</span>&nbsp;<span class="num" id="6295064">4</span><span class="op" id="6295065">,</span>&nbsp;<span class="num" id="6295067">5</span><span class="op" id="6295068">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295072">z</span><span class="op" id="6295073">.</span><span class="ident" id="6295074">scratch</span><span class="op" id="6295081">[</span><span class="num" id="6295082">1</span><span class="op" id="6295083">]</span>&nbsp;<span class="op" id="6295085">=</span>&nbsp;<span class="num" id="6295087">1</span>&nbsp;<span class="op" id="6295089">&lt;&lt;</span>&nbsp;<span class="num" id="6295092">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295095">case</span>&nbsp;<span class="num" id="6295100">6</span><span class="op" id="6295101">,</span>&nbsp;<span class="op" id="6295103">-</span><span class="num" id="6295104">1</span><span class="op" id="6295105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295109">z</span><span class="op" id="6295110">.</span><span class="ident" id="6295111">scratch</span><span class="op" id="6295118">[</span><span class="num" id="6295119">1</span><span class="op" id="6295120">]</span>&nbsp;<span class="op" id="6295122">=</span>&nbsp;<span class="num" id="6295124">2</span>&nbsp;<span class="op" id="6295126">&lt;&lt;</span>&nbsp;<span class="num" id="6295129">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295132">case</span>&nbsp;<span class="num" id="6295137">7</span><span class="op" id="6295138">,</span>&nbsp;<span class="num" id="6295140">8</span><span class="op" id="6295141">,</span>&nbsp;<span class="num" id="6295143">9</span><span class="op" id="6295144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295148">z</span><span class="op" id="6295149">.</span><span class="ident" id="6295150">scratch</span><span class="op" id="6295157">[</span><span class="num" id="6295158">1</span><span class="op" id="6295159">]</span>&nbsp;<span class="op" id="6295161">=</span>&nbsp;<span class="num" id="6295163">3</span>&nbsp;<span class="op" id="6295165">&lt;&lt;</span>&nbsp;<span class="num" id="6295168">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295171">default</span><span class="op" id="6295178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6295182">panic</span><span class="op" id="6295187">(</span><span class="string" id="6295188">&#34;unreachable&#34;</span><span class="op" id="6295201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295207">if</span>&nbsp;<span class="ident" id="6295210">z</span><span class="op" id="6295211">.</span><span class="ident" id="6295212">dict</span>&nbsp;<span class="op" id="6295217">!=</span>&nbsp;<span class="ident" id="6295220">nil</span>&nbsp;<span class="op" id="6295224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295228">z</span><span class="op" id="6295229">.</span><span class="ident" id="6295230">scratch</span><span class="op" id="6295237">[</span><span class="num" id="6295238">1</span><span class="op" id="6295239">]</span>&nbsp;<span class="op" id="6295241">|=</span>&nbsp;<span class="num" id="6295244">1</span>&nbsp;<span class="op" id="6295246">&lt;&lt;</span>&nbsp;<span class="num" id="6295249">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295255">z</span><span class="op" id="6295256">.</span><span class="ident" id="6295257">scratch</span><span class="op" id="6295264">[</span><span class="num" id="6295265">1</span><span class="op" id="6295266">]</span>&nbsp;<span class="op" id="6295268">+=</span>&nbsp;<span class="builtintype" id="6295271">uint8</span><span class="op" id="6295276">(</span><span class="num" id="6295277">31</span>&nbsp;<span class="op" id="6295280">-</span>&nbsp;<span class="op" id="6295282">(</span><span class="builtintype" id="6295283">uint16</span><span class="op" id="6295289">(</span><span class="ident" id="6295290">z</span><span class="op" id="6295291">.</span><span class="ident" id="6295292">scratch</span><span class="op" id="6295299">[</span><span class="num" id="6295300">0</span><span class="op" id="6295301">]</span><span class="op" id="6295302">)</span><span class="op" id="6295303">&lt;&lt;</span><span class="num" id="6295305">8</span><span class="op" id="6295306">+</span><span class="builtintype" id="6295307">uint16</span><span class="op" id="6295313">(</span><span class="ident" id="6295314">z</span><span class="op" id="6295315">.</span><span class="ident" id="6295316">scratch</span><span class="op" id="6295323">[</span><span class="num" id="6295324">1</span><span class="op" id="6295325">]</span><span class="op" id="6295326">)</span><span class="op" id="6295327">)</span><span class="op" id="6295328">%</span><span class="num" id="6295329">31</span><span class="op" id="6295331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295334">if</span>&nbsp;<span class="ident" id="6295337">_</span><span class="op" id="6295338">,</span>&nbsp;<span class="ident" id="6295340">err</span>&nbsp;<span class="op" id="6295344">=</span>&nbsp;<span class="ident" id="6295346">z</span><span class="op" id="6295347">.</span><span class="ident" id="6295348">w</span><span class="op" id="6295349">.</span><span class="ident" id="6295350">Write</span><span class="op" id="6295355">(</span><span class="ident" id="6295356">z</span><span class="op" id="6295357">.</span><span class="ident" id="6295358">scratch</span><span class="op" id="6295365">[</span><span class="num" id="6295366">0</span><span class="op" id="6295367">:</span><span class="num" id="6295368">2</span><span class="op" id="6295369">]</span><span class="op" id="6295370">)</span><span class="op" id="6295371">;</span>&nbsp;<span class="ident" id="6295373">err</span>&nbsp;<span class="op" id="6295377">!=</span>&nbsp;<span class="ident" id="6295380">nil</span>&nbsp;<span class="op" id="6295384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295388">return</span>&nbsp;<span class="ident" id="6295395">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295400">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295403">if</span>&nbsp;<span class="ident" id="6295406">z</span><span class="op" id="6295407">.</span><span class="ident" id="6295408">dict</span>&nbsp;<span class="op" id="6295413">!=</span>&nbsp;<span class="ident" id="6295416">nil</span>&nbsp;<span class="op" id="6295420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295424">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295494">checksum</span>&nbsp;<span class="op" id="6295503">:=</span>&nbsp;<span class="ident" id="6295506">adler32</span><span class="op" id="6295513">.</span><span class="ident" id="6295514">Checksum</span><span class="op" id="6295522">(</span><span class="ident" id="6295523">z</span><span class="op" id="6295524">.</span><span class="ident" id="6295525">dict</span><span class="op" id="6295529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295533">z</span><span class="op" id="6295534">.</span><span class="ident" id="6295535">scratch</span><span class="op" id="6295542">[</span><span class="num" id="6295543">0</span><span class="op" id="6295544">]</span>&nbsp;<span class="op" id="6295546">=</span>&nbsp;<span class="builtintype" id="6295548">uint8</span><span class="op" id="6295553">(</span><span class="ident" id="6295554">checksum</span>&nbsp;<span class="op" id="6295563">&gt;&gt;</span>&nbsp;<span class="num" id="6295566">24</span><span class="op" id="6295568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295572">z</span><span class="op" id="6295573">.</span><span class="ident" id="6295574">scratch</span><span class="op" id="6295581">[</span><span class="num" id="6295582">1</span><span class="op" id="6295583">]</span>&nbsp;<span class="op" id="6295585">=</span>&nbsp;<span class="builtintype" id="6295587">uint8</span><span class="op" id="6295592">(</span><span class="ident" id="6295593">checksum</span>&nbsp;<span class="op" id="6295602">&gt;&gt;</span>&nbsp;<span class="num" id="6295605">16</span><span class="op" id="6295607">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295611">z</span><span class="op" id="6295612">.</span><span class="ident" id="6295613">scratch</span><span class="op" id="6295620">[</span><span class="num" id="6295621">2</span><span class="op" id="6295622">]</span>&nbsp;<span class="op" id="6295624">=</span>&nbsp;<span class="builtintype" id="6295626">uint8</span><span class="op" id="6295631">(</span><span class="ident" id="6295632">checksum</span>&nbsp;<span class="op" id="6295641">&gt;&gt;</span>&nbsp;<span class="num" id="6295644">8</span><span class="op" id="6295645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295649">z</span><span class="op" id="6295650">.</span><span class="ident" id="6295651">scratch</span><span class="op" id="6295658">[</span><span class="num" id="6295659">3</span><span class="op" id="6295660">]</span>&nbsp;<span class="op" id="6295662">=</span>&nbsp;<span class="builtintype" id="6295664">uint8</span><span class="op" id="6295669">(</span><span class="ident" id="6295670">checksum</span>&nbsp;<span class="op" id="6295679">&gt;&gt;</span>&nbsp;<span class="num" id="6295682">0</span><span class="op" id="6295683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295687">if</span>&nbsp;<span class="ident" id="6295690">_</span><span class="op" id="6295691">,</span>&nbsp;<span class="ident" id="6295693">err</span>&nbsp;<span class="op" id="6295697">=</span>&nbsp;<span class="ident" id="6295699">z</span><span class="op" id="6295700">.</span><span class="ident" id="6295701">w</span><span class="op" id="6295702">.</span><span class="ident" id="6295703">Write</span><span class="op" id="6295708">(</span><span class="ident" id="6295709">z</span><span class="op" id="6295710">.</span><span class="ident" id="6295711">scratch</span><span class="op" id="6295718">[</span><span class="num" id="6295719">0</span><span class="op" id="6295720">:</span><span class="num" id="6295721">4</span><span class="op" id="6295722">]</span><span class="op" id="6295723">)</span><span class="op" id="6295724">;</span>&nbsp;<span class="ident" id="6295726">err</span>&nbsp;<span class="op" id="6295730">!=</span>&nbsp;<span class="ident" id="6295733">nil</span>&nbsp;<span class="op" id="6295737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295742">return</span>&nbsp;<span class="ident" id="6295749">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295755">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295761">if</span>&nbsp;<span class="ident" id="6295764">z</span><span class="op" id="6295765">.</span><span class="ident" id="6295766">compressor</span>&nbsp;<span class="op" id="6295777">==</span>&nbsp;<span class="ident" id="6295780">nil</span>&nbsp;<span class="op" id="6295784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295788">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6295847">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295872">z</span><span class="op" id="6295873">.</span><span class="ident" id="6295874">compressor</span><span class="op" id="6295884">,</span>&nbsp;<span class="ident" id="6295886">err</span>&nbsp;<span class="op" id="6295890">=</span>&nbsp;<span class="ident" id="6295892">flate</span><span class="op" id="6295897">.</span><span class="ident" id="6295898">NewWriterDict</span><span class="op" id="6295911">(</span><span class="ident" id="6295912">z</span><span class="op" id="6295913">.</span><span class="ident" id="6295914">w</span><span class="op" id="6295915">,</span>&nbsp;<span class="ident" id="6295917">z</span><span class="op" id="6295918">.</span><span class="ident" id="6295919">level</span><span class="op" id="6295924">,</span>&nbsp;<span class="ident" id="6295926">z</span><span class="op" id="6295927">.</span><span class="ident" id="6295928">dict</span><span class="op" id="6295932">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295936">if</span>&nbsp;<span class="ident" id="6295939">err</span>&nbsp;<span class="op" id="6295943">!=</span>&nbsp;<span class="ident" id="6295946">nil</span>&nbsp;<span class="op" id="6295950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6295955">return</span>&nbsp;<span class="ident" id="6295962">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6295972">z</span><span class="op" id="6295973">.</span><span class="ident" id="6295974">digest</span>&nbsp;<span class="op" id="6295981">=</span>&nbsp;<span class="ident" id="6295983">adler32</span><span class="op" id="6295990">.</span><span class="ident" id="6295991">New</span><span class="op" id="6295994">(</span><span class="op" id="6295995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6295998">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296001">return</span>&nbsp;<span class="ident" id="6296008">nil</span><br>
<span class="lineno"></span><span class="op" id="6296012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296015">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="6296087">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="6296165">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6296188">func</span>&nbsp;<span class="op" id="6296193">(</span><span class="ident" id="6296194">z</span>&nbsp;<span class="op" id="6296196">*</span><span class="ident" id="6296197">Writer</span><span class="op" id="6296203">)</span>&nbsp;<span class="ident" id="6296205">Write</span><span class="op" id="6296210">(</span><span class="ident" id="6296211">p</span>&nbsp;<span class="op" id="6296213">[</span><span class="op" id="6296214">]</span><span class="builtintype" id="6296215">byte</span><span class="op" id="6296219">)</span>&nbsp;<span class="op" id="6296221">(</span><span class="ident" id="6296222">n</span>&nbsp;<span class="builtintype" id="6296224">int</span><span class="op" id="6296227">,</span>&nbsp;<span class="ident" id="6296229">err</span>&nbsp;<span class="builtintype" id="6296233">error</span><span class="op" id="6296238">)</span>&nbsp;<span class="op" id="6296240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296243">if</span>&nbsp;<span class="op" id="6296246">!</span><span class="ident" id="6296247">z</span><span class="op" id="6296248">.</span><span class="ident" id="6296249">wroteHeader</span>&nbsp;<span class="op" id="6296261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296265">z</span><span class="op" id="6296266">.</span><span class="ident" id="6296267">err</span>&nbsp;<span class="op" id="6296271">=</span>&nbsp;<span class="ident" id="6296273">z</span><span class="op" id="6296274">.</span><span class="ident" id="6296275">writeHeader</span><span class="op" id="6296286">(</span><span class="op" id="6296287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296290">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296293">if</span>&nbsp;<span class="ident" id="6296296">z</span><span class="op" id="6296297">.</span><span class="ident" id="6296298">err</span>&nbsp;<span class="op" id="6296302">!=</span>&nbsp;<span class="ident" id="6296305">nil</span>&nbsp;<span class="op" id="6296309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296313">return</span>&nbsp;<span class="num" id="6296320">0</span><span class="op" id="6296321">,</span>&nbsp;<span class="ident" id="6296323">z</span><span class="op" id="6296324">.</span><span class="ident" id="6296325">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296333">if</span>&nbsp;<span class="builtinfunc" id="6296336">len</span><span class="op" id="6296339">(</span><span class="ident" id="6296340">p</span><span class="op" id="6296341">)</span>&nbsp;<span class="op" id="6296343">==</span>&nbsp;<span class="num" id="6296346">0</span>&nbsp;<span class="op" id="6296348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296352">return</span>&nbsp;<span class="num" id="6296359">0</span><span class="op" id="6296360">,</span>&nbsp;<span class="ident" id="6296362">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296370">n</span><span class="op" id="6296371">,</span>&nbsp;<span class="ident" id="6296373">err</span>&nbsp;<span class="op" id="6296377">=</span>&nbsp;<span class="ident" id="6296379">z</span><span class="op" id="6296380">.</span><span class="ident" id="6296381">compressor</span><span class="op" id="6296391">.</span><span class="ident" id="6296392">Write</span><span class="op" id="6296397">(</span><span class="ident" id="6296398">p</span><span class="op" id="6296399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296402">if</span>&nbsp;<span class="ident" id="6296405">err</span>&nbsp;<span class="op" id="6296409">!=</span>&nbsp;<span class="ident" id="6296412">nil</span>&nbsp;<span class="op" id="6296416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296420">z</span><span class="op" id="6296421">.</span><span class="ident" id="6296422">err</span>&nbsp;<span class="op" id="6296426">=</span>&nbsp;<span class="ident" id="6296428">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296434">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296445">z</span><span class="op" id="6296446">.</span><span class="ident" id="6296447">digest</span><span class="op" id="6296453">.</span><span class="ident" id="6296454">Write</span><span class="op" id="6296459">(</span><span class="ident" id="6296460">p</span><span class="op" id="6296461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296464">return</span><br>
<span class="lineno"></span><span class="op" id="6296471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6296474">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6296531">func</span>&nbsp;<span class="op" id="6296536">(</span><span class="ident" id="6296537">z</span>&nbsp;<span class="op" id="6296539">*</span><span class="ident" id="6296540">Writer</span><span class="op" id="6296546">)</span>&nbsp;<span class="ident" id="6296548">Flush</span><span class="op" id="6296553">(</span><span class="op" id="6296554">)</span>&nbsp;<span class="builtintype" id="6296556">error</span>&nbsp;<span class="op" id="6296562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296565">if</span>&nbsp;<span class="op" id="6296568">!</span><span class="ident" id="6296569">z</span><span class="op" id="6296570">.</span><span class="ident" id="6296571">wroteHeader</span>&nbsp;<span class="op" id="6296583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296587">z</span><span class="op" id="6296588">.</span><span class="ident" id="6296589">err</span>&nbsp;<span class="op" id="6296593">=</span>&nbsp;<span class="ident" id="6296595">z</span><span class="op" id="6296596">.</span><span class="ident" id="6296597">writeHeader</span><span class="op" id="6296608">(</span><span class="op" id="6296609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296612">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296615">if</span>&nbsp;<span class="ident" id="6296618">z</span><span class="op" id="6296619">.</span><span class="ident" id="6296620">err</span>&nbsp;<span class="op" id="6296624">!=</span>&nbsp;<span class="ident" id="6296627">nil</span>&nbsp;<span class="op" id="6296631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296635">return</span>&nbsp;<span class="ident" id="6296642">z</span><span class="op" id="6296643">.</span><span class="ident" id="6296644">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296652">z</span><span class="op" id="6296653">.</span><span class="ident" id="6296654">err</span>&nbsp;<span class="op" id="6296658">=</span>&nbsp;<span class="ident" id="6296660">z</span><span class="op" id="6296661">.</span><span class="ident" id="6296662">compressor</span><span class="op" id="6296672">.</span><span class="ident" id="6296673">Flush</span><span class="op" id="6296678">(</span><span class="op" id="6296679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296682">return</span>&nbsp;<span class="ident" id="6296689">z</span><span class="op" id="6296690">.</span><span class="ident" id="6296691">err</span><br>
<span class="lineno">175</span><span class="op" id="6296695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6296698">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="6296772">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6296831">func</span>&nbsp;<span class="op" id="6296836">(</span><span class="ident" id="6296837">z</span>&nbsp;<span class="op" id="6296839">*</span><span class="ident" id="6296840">Writer</span><span class="op" id="6296846">)</span>&nbsp;<span class="ident" id="6296848">Close</span><span class="op" id="6296853">(</span><span class="op" id="6296854">)</span>&nbsp;<span class="builtintype" id="6296856">error</span>&nbsp;<span class="op" id="6296862">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296865">if</span>&nbsp;<span class="op" id="6296868">!</span><span class="ident" id="6296869">z</span><span class="op" id="6296870">.</span><span class="ident" id="6296871">wroteHeader</span>&nbsp;<span class="op" id="6296883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296887">z</span><span class="op" id="6296888">.</span><span class="ident" id="6296889">err</span>&nbsp;<span class="op" id="6296893">=</span>&nbsp;<span class="ident" id="6296895">z</span><span class="op" id="6296896">.</span><span class="ident" id="6296897">writeHeader</span><span class="op" id="6296908">(</span><span class="op" id="6296909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296915">if</span>&nbsp;<span class="ident" id="6296918">z</span><span class="op" id="6296919">.</span><span class="ident" id="6296920">err</span>&nbsp;<span class="op" id="6296924">!=</span>&nbsp;<span class="ident" id="6296927">nil</span>&nbsp;<span class="op" id="6296931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296935">return</span>&nbsp;<span class="ident" id="6296942">z</span><span class="op" id="6296943">.</span><span class="ident" id="6296944">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6296949">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6296952">z</span><span class="op" id="6296953">.</span><span class="ident" id="6296954">err</span>&nbsp;<span class="op" id="6296958">=</span>&nbsp;<span class="ident" id="6296960">z</span><span class="op" id="6296961">.</span><span class="ident" id="6296962">compressor</span><span class="op" id="6296972">.</span><span class="ident" id="6296973">Close</span><span class="op" id="6296978">(</span><span class="op" id="6296979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6296982">if</span>&nbsp;<span class="ident" id="6296985">z</span><span class="op" id="6296986">.</span><span class="ident" id="6296987">err</span>&nbsp;<span class="op" id="6296991">!=</span>&nbsp;<span class="ident" id="6296994">nil</span>&nbsp;<span class="op" id="6296998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297002">return</span>&nbsp;<span class="ident" id="6297009">z</span><span class="op" id="6297010">.</span><span class="ident" id="6297011">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6297016">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297019">checksum</span>&nbsp;<span class="op" id="6297028">:=</span>&nbsp;<span class="ident" id="6297031">z</span><span class="op" id="6297032">.</span><span class="ident" id="6297033">digest</span><span class="op" id="6297039">.</span><span class="ident" id="6297040">Sum32</span><span class="op" id="6297045">(</span><span class="op" id="6297046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6297049">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297108">z</span><span class="op" id="6297109">.</span><span class="ident" id="6297110">scratch</span><span class="op" id="6297117">[</span><span class="num" id="6297118">0</span><span class="op" id="6297119">]</span>&nbsp;<span class="op" id="6297121">=</span>&nbsp;<span class="builtintype" id="6297123">uint8</span><span class="op" id="6297128">(</span><span class="ident" id="6297129">checksum</span>&nbsp;<span class="op" id="6297138">&gt;&gt;</span>&nbsp;<span class="num" id="6297141">24</span><span class="op" id="6297143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297146">z</span><span class="op" id="6297147">.</span><span class="ident" id="6297148">scratch</span><span class="op" id="6297155">[</span><span class="num" id="6297156">1</span><span class="op" id="6297157">]</span>&nbsp;<span class="op" id="6297159">=</span>&nbsp;<span class="builtintype" id="6297161">uint8</span><span class="op" id="6297166">(</span><span class="ident" id="6297167">checksum</span>&nbsp;<span class="op" id="6297176">&gt;&gt;</span>&nbsp;<span class="num" id="6297179">16</span><span class="op" id="6297181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297184">z</span><span class="op" id="6297185">.</span><span class="ident" id="6297186">scratch</span><span class="op" id="6297193">[</span><span class="num" id="6297194">2</span><span class="op" id="6297195">]</span>&nbsp;<span class="op" id="6297197">=</span>&nbsp;<span class="builtintype" id="6297199">uint8</span><span class="op" id="6297204">(</span><span class="ident" id="6297205">checksum</span>&nbsp;<span class="op" id="6297214">&gt;&gt;</span>&nbsp;<span class="num" id="6297217">8</span><span class="op" id="6297218">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297221">z</span><span class="op" id="6297222">.</span><span class="ident" id="6297223">scratch</span><span class="op" id="6297230">[</span><span class="num" id="6297231">3</span><span class="op" id="6297232">]</span>&nbsp;<span class="op" id="6297234">=</span>&nbsp;<span class="builtintype" id="6297236">uint8</span><span class="op" id="6297241">(</span><span class="ident" id="6297242">checksum</span>&nbsp;<span class="op" id="6297251">&gt;&gt;</span>&nbsp;<span class="num" id="6297254">0</span><span class="op" id="6297255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6297258">_</span><span class="op" id="6297259">,</span>&nbsp;<span class="ident" id="6297261">z</span><span class="op" id="6297262">.</span><span class="ident" id="6297263">err</span>&nbsp;<span class="op" id="6297267">=</span>&nbsp;<span class="ident" id="6297269">z</span><span class="op" id="6297270">.</span><span class="ident" id="6297271">w</span><span class="op" id="6297272">.</span><span class="ident" id="6297273">Write</span><span class="op" id="6297278">(</span><span class="ident" id="6297279">z</span><span class="op" id="6297280">.</span><span class="ident" id="6297281">scratch</span><span class="op" id="6297288">[</span><span class="num" id="6297289">0</span><span class="op" id="6297290">:</span><span class="num" id="6297291">4</span><span class="op" id="6297292">]</span><span class="op" id="6297293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6297296">return</span>&nbsp;<span class="ident" id="6297303">z</span><span class="op" id="6297304">.</span><span class="ident" id="6297305">err</span><br>
<span class="lineno"></span><span class="op" id="6297309">}</span>
</div>
</body>
</html>
