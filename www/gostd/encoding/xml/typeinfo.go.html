<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6054528">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6054584">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6054638">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6054689">package</span>&nbsp;<span class="ident" id="6054697">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6054702">import</span>&nbsp;<span class="op" id="6054709">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6054712">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6054719">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6054730">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6054741">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6054748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6054751">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6054815">type</span>&nbsp;<span class="ident" id="6054820">typeInfo</span>&nbsp;<span class="keyword" id="6054829">struct</span>&nbsp;<span class="op" id="6054836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054839">xmlname</span>&nbsp;<span class="op" id="6054847">*</span><span class="ident" id="6054848">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054859">fields</span>&nbsp;&nbsp;<span class="op" id="6054867">[</span><span class="op" id="6054868">]</span><span class="ident" id="6054869">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6054879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6054882">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6054955">type</span>&nbsp;<span class="ident" id="6054960">fieldInfo</span>&nbsp;<span class="keyword" id="6054970">struct</span>&nbsp;<span class="op" id="6054977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054980">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6054988">[</span><span class="op" id="6054989">]</span><span class="builtintype" id="6054990">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6054995">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6055003">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055011">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6055019">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055027">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6055035">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055047">parents</span>&nbsp;<span class="op" id="6055055">[</span><span class="op" id="6055056">]</span><span class="builtintype" id="6055057">string</span><br>
<span class="lineno"></span><span class="op" id="6055064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6055067">type</span>&nbsp;<span class="ident" id="6055072">fieldFlags</span>&nbsp;<span class="builtintype" id="6055083">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6055088">const</span>&nbsp;<span class="op" id="6055094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055097">fElement</span>&nbsp;<span class="ident" id="6055106">fieldFlags</span>&nbsp;<span class="op" id="6055117">=</span>&nbsp;<span class="num" id="6055119">1</span>&nbsp;<span class="op" id="6055121">&lt;&lt;</span>&nbsp;<span class="ident" id="6055124">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055130">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055137">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055148">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055159">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055169">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055176">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055189">fMode</span>&nbsp;<span class="op" id="6055195">=</span>&nbsp;<span class="ident" id="6055197">fElement</span>&nbsp;<span class="op" id="6055206">|</span>&nbsp;<span class="ident" id="6055208">fAttr</span>&nbsp;<span class="op" id="6055214">|</span>&nbsp;<span class="ident" id="6055216">fCharData</span>&nbsp;<span class="op" id="6055226">|</span>&nbsp;<span class="ident" id="6055228">fInnerXml</span>&nbsp;<span class="op" id="6055238">|</span>&nbsp;<span class="ident" id="6055240">fComment</span>&nbsp;<span class="op" id="6055249">|</span>&nbsp;<span class="ident" id="6055251">fAny</span><br>
<span class="lineno"></span><span class="op" id="6055256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6055259">var</span>&nbsp;<span class="ident" id="6055263">tinfoMap</span>&nbsp;<span class="op" id="6055272">=</span>&nbsp;<span class="builtinfunc" id="6055274">make</span><span class="op" id="6055278">(</span><span class="keyword" id="6055279">map</span><span class="op" id="6055282">[</span><span class="ident" id="6055283">reflect</span><span class="op" id="6055290">.</span><span class="ident" id="6055291">Type</span><span class="op" id="6055295">]</span><span class="op" id="6055296">*</span><span class="ident" id="6055297">typeInfo</span><span class="op" id="6055305">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6055307">var</span>&nbsp;<span class="ident" id="6055311">tinfoLock</span>&nbsp;<span class="ident" id="6055321">sync</span><span class="op" id="6055325">.</span><span class="ident" id="6055326">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6055335">var</span>&nbsp;<span class="ident" id="6055339">nameType</span>&nbsp;<span class="op" id="6055348">=</span>&nbsp;<span class="ident" id="6055350">reflect</span><span class="op" id="6055357">.</span><span class="ident" id="6055358">TypeOf</span><span class="op" id="6055364">(</span><span class="ident" id="6055365">Name</span><span class="op" id="6055369">{</span><span class="op" id="6055370">}</span><span class="op" id="6055371">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6055374">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6055443">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6055485">func</span>&nbsp;<span class="ident" id="6055490">getTypeInfo</span><span class="op" id="6055501">(</span><span class="ident" id="6055502">typ</span>&nbsp;<span class="ident" id="6055506">reflect</span><span class="op" id="6055513">.</span><span class="ident" id="6055514">Type</span><span class="op" id="6055518">)</span>&nbsp;<span class="op" id="6055520">(</span><span class="op" id="6055521">*</span><span class="ident" id="6055522">typeInfo</span><span class="op" id="6055530">,</span>&nbsp;<span class="builtintype" id="6055532">error</span><span class="op" id="6055537">)</span>&nbsp;<span class="op" id="6055539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055542">tinfoLock</span><span class="op" id="6055551">.</span><span class="ident" id="6055552">RLock</span><span class="op" id="6055557">(</span><span class="op" id="6055558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055561">tinfo</span><span class="op" id="6055566">,</span>&nbsp;<span class="ident" id="6055568">ok</span>&nbsp;<span class="op" id="6055571">:=</span>&nbsp;<span class="ident" id="6055574">tinfoMap</span><span class="op" id="6055582">[</span><span class="ident" id="6055583">typ</span><span class="op" id="6055586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055589">tinfoLock</span><span class="op" id="6055598">.</span><span class="ident" id="6055599">RUnlock</span><span class="op" id="6055606">(</span><span class="op" id="6055607">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055610">if</span>&nbsp;<span class="ident" id="6055613">ok</span>&nbsp;<span class="op" id="6055616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055620">return</span>&nbsp;<span class="ident" id="6055627">tinfo</span><span class="op" id="6055632">,</span>&nbsp;<span class="ident" id="6055634">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055642">tinfo</span>&nbsp;<span class="op" id="6055648">=</span>&nbsp;<span class="op" id="6055650">&amp;</span><span class="ident" id="6055651">typeInfo</span><span class="op" id="6055659">{</span><span class="op" id="6055660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055663">if</span>&nbsp;<span class="ident" id="6055666">typ</span><span class="op" id="6055669">.</span><span class="ident" id="6055670">Kind</span><span class="op" id="6055674">(</span><span class="op" id="6055675">)</span>&nbsp;<span class="op" id="6055677">==</span>&nbsp;<span class="ident" id="6055680">reflect</span><span class="op" id="6055687">.</span><span class="ident" id="6055688">Struct</span>&nbsp;<span class="op" id="6055695">&amp;&amp;</span>&nbsp;<span class="ident" id="6055698">typ</span>&nbsp;<span class="op" id="6055702">!=</span>&nbsp;<span class="ident" id="6055705">nameType</span>&nbsp;<span class="op" id="6055714">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055718">n</span>&nbsp;<span class="op" id="6055720">:=</span>&nbsp;<span class="ident" id="6055723">typ</span><span class="op" id="6055726">.</span><span class="ident" id="6055727">NumField</span><span class="op" id="6055735">(</span><span class="op" id="6055736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055740">for</span>&nbsp;<span class="ident" id="6055744">i</span>&nbsp;<span class="op" id="6055746">:=</span>&nbsp;<span class="num" id="6055749">0</span><span class="op" id="6055750">;</span>&nbsp;<span class="ident" id="6055752">i</span>&nbsp;<span class="op" id="6055754">&lt;</span>&nbsp;<span class="ident" id="6055756">n</span><span class="op" id="6055757">;</span>&nbsp;<span class="ident" id="6055759">i</span><span class="op" id="6055760">++</span>&nbsp;<span class="op" id="6055763">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055768">f</span>&nbsp;<span class="op" id="6055770">:=</span>&nbsp;<span class="ident" id="6055773">typ</span><span class="op" id="6055776">.</span><span class="ident" id="6055777">Field</span><span class="op" id="6055782">(</span><span class="ident" id="6055783">i</span><span class="op" id="6055784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055789">if</span>&nbsp;<span class="ident" id="6055792">f</span><span class="op" id="6055793">.</span><span class="ident" id="6055794">PkgPath</span>&nbsp;<span class="op" id="6055802">!=</span>&nbsp;<span class="string" id="6055805">&#34;&#34;</span>&nbsp;<span class="op" id="6055808">||</span>&nbsp;<span class="ident" id="6055811">f</span><span class="op" id="6055812">.</span><span class="ident" id="6055813">Tag</span><span class="op" id="6055816">.</span><span class="ident" id="6055817">Get</span><span class="op" id="6055820">(</span><span class="string" id="6055821">&#34;xml&#34;</span><span class="op" id="6055826">)</span>&nbsp;<span class="op" id="6055828">==</span>&nbsp;<span class="string" id="6055831">&#34;-&#34;</span>&nbsp;<span class="op" id="6055835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055841">continue</span>&nbsp;<span class="comment" id="6055850">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6055870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6055876">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055922">if</span>&nbsp;<span class="ident" id="6055925">f</span><span class="op" id="6055926">.</span><span class="ident" id="6055927">Anonymous</span>&nbsp;<span class="op" id="6055937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055943">t</span>&nbsp;<span class="op" id="6055945">:=</span>&nbsp;<span class="ident" id="6055948">f</span><span class="op" id="6055949">.</span><span class="ident" id="6055950">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6055959">if</span>&nbsp;<span class="ident" id="6055962">t</span><span class="op" id="6055963">.</span><span class="ident" id="6055964">Kind</span><span class="op" id="6055968">(</span><span class="op" id="6055969">)</span>&nbsp;<span class="op" id="6055971">==</span>&nbsp;<span class="ident" id="6055974">reflect</span><span class="op" id="6055981">.</span><span class="ident" id="6055982">Ptr</span>&nbsp;<span class="op" id="6055986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6055993">t</span>&nbsp;<span class="op" id="6055995">=</span>&nbsp;<span class="ident" id="6055997">t</span><span class="op" id="6055998">.</span><span class="ident" id="6055999">Elem</span><span class="op" id="6056003">(</span><span class="op" id="6056004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056016">if</span>&nbsp;<span class="ident" id="6056019">t</span><span class="op" id="6056020">.</span><span class="ident" id="6056021">Kind</span><span class="op" id="6056025">(</span><span class="op" id="6056026">)</span>&nbsp;<span class="op" id="6056028">==</span>&nbsp;<span class="ident" id="6056031">reflect</span><span class="op" id="6056038">.</span><span class="ident" id="6056039">Struct</span>&nbsp;<span class="op" id="6056046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056053">inner</span><span class="op" id="6056058">,</span>&nbsp;<span class="ident" id="6056060">err</span>&nbsp;<span class="op" id="6056064">:=</span>&nbsp;<span class="ident" id="6056067">getTypeInfo</span><span class="op" id="6056078">(</span><span class="ident" id="6056079">t</span><span class="op" id="6056080">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056087">if</span>&nbsp;<span class="ident" id="6056090">err</span>&nbsp;<span class="op" id="6056094">!=</span>&nbsp;<span class="ident" id="6056097">nil</span>&nbsp;<span class="op" id="6056101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056109">return</span>&nbsp;<span class="ident" id="6056116">nil</span><span class="op" id="6056119">,</span>&nbsp;<span class="ident" id="6056121">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056137">if</span>&nbsp;<span class="ident" id="6056140">tinfo</span><span class="op" id="6056145">.</span><span class="ident" id="6056146">xmlname</span>&nbsp;<span class="op" id="6056154">==</span>&nbsp;<span class="ident" id="6056157">nil</span>&nbsp;<span class="op" id="6056161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056169">tinfo</span><span class="op" id="6056174">.</span><span class="ident" id="6056175">xmlname</span>&nbsp;<span class="op" id="6056183">=</span>&nbsp;<span class="ident" id="6056185">inner</span><span class="op" id="6056190">.</span><span class="ident" id="6056191">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056211">for</span>&nbsp;<span class="ident" id="6056215">_</span><span class="op" id="6056216">,</span>&nbsp;<span class="ident" id="6056218">finfo</span>&nbsp;<span class="op" id="6056224">:=</span>&nbsp;<span class="keyword" id="6056227">range</span>&nbsp;<span class="ident" id="6056233">inner</span><span class="op" id="6056238">.</span><span class="ident" id="6056239">fields</span>&nbsp;<span class="op" id="6056246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056254">finfo</span><span class="op" id="6056259">.</span><span class="ident" id="6056260">idx</span>&nbsp;<span class="op" id="6056264">=</span>&nbsp;<span class="builtinfunc" id="6056266">append</span><span class="op" id="6056272">(</span><span class="op" id="6056273">[</span><span class="op" id="6056274">]</span><span class="builtintype" id="6056275">int</span><span class="op" id="6056278">{</span><span class="ident" id="6056279">i</span><span class="op" id="6056280">}</span><span class="op" id="6056281">,</span>&nbsp;<span class="ident" id="6056283">finfo</span><span class="op" id="6056288">.</span><span class="ident" id="6056289">idx</span><span class="op" id="6056292">...</span><span class="op" id="6056295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056303">if</span>&nbsp;<span class="ident" id="6056306">err</span>&nbsp;<span class="op" id="6056310">:=</span>&nbsp;<span class="ident" id="6056313">addFieldInfo</span><span class="op" id="6056325">(</span><span class="ident" id="6056326">typ</span><span class="op" id="6056329">,</span>&nbsp;<span class="ident" id="6056331">tinfo</span><span class="op" id="6056336">,</span>&nbsp;<span class="op" id="6056338">&amp;</span><span class="ident" id="6056339">finfo</span><span class="op" id="6056344">)</span><span class="op" id="6056345">;</span>&nbsp;<span class="ident" id="6056347">err</span>&nbsp;<span class="op" id="6056351">!=</span>&nbsp;<span class="ident" id="6056354">nil</span>&nbsp;<span class="op" id="6056358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056367">return</span>&nbsp;<span class="ident" id="6056374">nil</span><span class="op" id="6056377">,</span>&nbsp;<span class="ident" id="6056379">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056403">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056421">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056427">finfo</span><span class="op" id="6056432">,</span>&nbsp;<span class="ident" id="6056434">err</span>&nbsp;<span class="op" id="6056438">:=</span>&nbsp;<span class="ident" id="6056441">structFieldInfo</span><span class="op" id="6056456">(</span><span class="ident" id="6056457">typ</span><span class="op" id="6056460">,</span>&nbsp;<span class="op" id="6056462">&amp;</span><span class="ident" id="6056463">f</span><span class="op" id="6056464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056469">if</span>&nbsp;<span class="ident" id="6056472">err</span>&nbsp;<span class="op" id="6056476">!=</span>&nbsp;<span class="ident" id="6056479">nil</span>&nbsp;<span class="op" id="6056483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056489">return</span>&nbsp;<span class="ident" id="6056496">nil</span><span class="op" id="6056499">,</span>&nbsp;<span class="ident" id="6056501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056508">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056514">if</span>&nbsp;<span class="ident" id="6056517">f</span><span class="op" id="6056518">.</span><span class="ident" id="6056519">Name</span>&nbsp;<span class="op" id="6056524">==</span>&nbsp;<span class="string" id="6056527">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6056537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056543">tinfo</span><span class="op" id="6056548">.</span><span class="ident" id="6056549">xmlname</span>&nbsp;<span class="op" id="6056557">=</span>&nbsp;<span class="ident" id="6056559">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056569">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056581">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6056587">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056649">if</span>&nbsp;<span class="ident" id="6056652">err</span>&nbsp;<span class="op" id="6056656">:=</span>&nbsp;<span class="ident" id="6056659">addFieldInfo</span><span class="op" id="6056671">(</span><span class="ident" id="6056672">typ</span><span class="op" id="6056675">,</span>&nbsp;<span class="ident" id="6056677">tinfo</span><span class="op" id="6056682">,</span>&nbsp;<span class="ident" id="6056684">finfo</span><span class="op" id="6056689">)</span><span class="op" id="6056690">;</span>&nbsp;<span class="ident" id="6056692">err</span>&nbsp;<span class="op" id="6056696">!=</span>&nbsp;<span class="ident" id="6056699">nil</span>&nbsp;<span class="op" id="6056703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056709">return</span>&nbsp;<span class="ident" id="6056716">nil</span><span class="op" id="6056719">,</span>&nbsp;<span class="ident" id="6056721">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056728">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6056735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056738">tinfoLock</span><span class="op" id="6056747">.</span><span class="ident" id="6056748">Lock</span><span class="op" id="6056752">(</span><span class="op" id="6056753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056756">tinfoMap</span><span class="op" id="6056764">[</span><span class="ident" id="6056765">typ</span><span class="op" id="6056768">]</span>&nbsp;<span class="op" id="6056770">=</span>&nbsp;<span class="ident" id="6056772">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056779">tinfoLock</span><span class="op" id="6056788">.</span><span class="ident" id="6056789">Unlock</span><span class="op" id="6056795">(</span><span class="op" id="6056796">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6056799">return</span>&nbsp;<span class="ident" id="6056806">tinfo</span><span class="op" id="6056811">,</span>&nbsp;<span class="ident" id="6056813">nil</span><br>
<span class="lineno"></span><span class="op" id="6056817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6056820">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6056877">func</span>&nbsp;<span class="ident" id="6056882">structFieldInfo</span><span class="op" id="6056897">(</span><span class="ident" id="6056898">typ</span>&nbsp;<span class="ident" id="6056902">reflect</span><span class="op" id="6056909">.</span><span class="ident" id="6056910">Type</span><span class="op" id="6056914">,</span>&nbsp;<span class="ident" id="6056916">f</span>&nbsp;<span class="op" id="6056918">*</span><span class="ident" id="6056919">reflect</span><span class="op" id="6056926">.</span><span class="ident" id="6056927">StructField</span><span class="op" id="6056938">)</span>&nbsp;<span class="op" id="6056940">(</span><span class="op" id="6056941">*</span><span class="ident" id="6056942">fieldInfo</span><span class="op" id="6056951">,</span>&nbsp;<span class="builtintype" id="6056953">error</span><span class="op" id="6056958">)</span>&nbsp;<span class="op" id="6056960">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6056963">finfo</span>&nbsp;<span class="op" id="6056969">:=</span>&nbsp;<span class="op" id="6056972">&amp;</span><span class="ident" id="6056973">fieldInfo</span><span class="op" id="6056982">{</span><span class="ident" id="6056983">idx</span><span class="op" id="6056986">:</span>&nbsp;<span class="ident" id="6056988">f</span><span class="op" id="6056989">.</span><span class="ident" id="6056990">Index</span><span class="op" id="6056995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6056999">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057054">tag</span>&nbsp;<span class="op" id="6057058">:=</span>&nbsp;<span class="ident" id="6057061">f</span><span class="op" id="6057062">.</span><span class="ident" id="6057063">Tag</span><span class="op" id="6057066">.</span><span class="ident" id="6057067">Get</span><span class="op" id="6057070">(</span><span class="string" id="6057071">&#34;xml&#34;</span><span class="op" id="6057076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057079">if</span>&nbsp;<span class="ident" id="6057082">i</span>&nbsp;<span class="op" id="6057084">:=</span>&nbsp;<span class="ident" id="6057087">strings</span><span class="op" id="6057094">.</span><span class="ident" id="6057095">Index</span><span class="op" id="6057100">(</span><span class="ident" id="6057101">tag</span><span class="op" id="6057104">,</span>&nbsp;<span class="string" id="6057106">&#34;&nbsp;&#34;</span><span class="op" id="6057109">)</span><span class="op" id="6057110">;</span>&nbsp;<span class="ident" id="6057112">i</span>&nbsp;<span class="op" id="6057114">&gt;=</span>&nbsp;<span class="num" id="6057117">0</span>&nbsp;<span class="op" id="6057119">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057123">finfo</span><span class="op" id="6057128">.</span><span class="ident" id="6057129">xmlns</span><span class="op" id="6057134">,</span>&nbsp;<span class="ident" id="6057136">tag</span>&nbsp;<span class="op" id="6057140">=</span>&nbsp;<span class="ident" id="6057142">tag</span><span class="op" id="6057145">[</span><span class="op" id="6057146">:</span><span class="ident" id="6057147">i</span><span class="op" id="6057148">]</span><span class="op" id="6057149">,</span>&nbsp;<span class="ident" id="6057151">tag</span><span class="op" id="6057154">[</span><span class="ident" id="6057155">i</span><span class="op" id="6057156">+</span><span class="num" id="6057157">1</span><span class="op" id="6057158">:</span><span class="op" id="6057159">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6057166">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057183">tokens</span>&nbsp;<span class="op" id="6057190">:=</span>&nbsp;<span class="ident" id="6057193">strings</span><span class="op" id="6057200">.</span><span class="ident" id="6057201">Split</span><span class="op" id="6057206">(</span><span class="ident" id="6057207">tag</span><span class="op" id="6057210">,</span>&nbsp;<span class="string" id="6057212">&#34;,&#34;</span><span class="op" id="6057215">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057218">if</span>&nbsp;<span class="builtinfunc" id="6057221">len</span><span class="op" id="6057224">(</span><span class="ident" id="6057225">tokens</span><span class="op" id="6057231">)</span>&nbsp;<span class="op" id="6057233">==</span>&nbsp;<span class="num" id="6057236">1</span>&nbsp;<span class="op" id="6057238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057242">finfo</span><span class="op" id="6057247">.</span><span class="ident" id="6057248">flags</span>&nbsp;<span class="op" id="6057254">=</span>&nbsp;<span class="ident" id="6057256">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057266">}</span>&nbsp;<span class="keyword" id="6057268">else</span>&nbsp;<span class="op" id="6057273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057277">tag</span>&nbsp;<span class="op" id="6057281">=</span>&nbsp;<span class="ident" id="6057283">tokens</span><span class="op" id="6057289">[</span><span class="num" id="6057290">0</span><span class="op" id="6057291">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057295">for</span>&nbsp;<span class="ident" id="6057299">_</span><span class="op" id="6057300">,</span>&nbsp;<span class="ident" id="6057302">flag</span>&nbsp;<span class="op" id="6057307">:=</span>&nbsp;<span class="keyword" id="6057310">range</span>&nbsp;<span class="ident" id="6057316">tokens</span><span class="op" id="6057322">[</span><span class="num" id="6057323">1</span><span class="op" id="6057324">:</span><span class="op" id="6057325">]</span>&nbsp;<span class="op" id="6057327">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057332">switch</span>&nbsp;<span class="ident" id="6057339">flag</span>&nbsp;<span class="op" id="6057344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057349">case</span>&nbsp;<span class="string" id="6057354">&#34;attr&#34;</span><span class="op" id="6057360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057366">finfo</span><span class="op" id="6057371">.</span><span class="ident" id="6057372">flags</span>&nbsp;<span class="op" id="6057378">|=</span>&nbsp;<span class="ident" id="6057381">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057390">case</span>&nbsp;<span class="string" id="6057395">&#34;chardata&#34;</span><span class="op" id="6057405">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057411">finfo</span><span class="op" id="6057416">.</span><span class="ident" id="6057417">flags</span>&nbsp;<span class="op" id="6057423">|=</span>&nbsp;<span class="ident" id="6057426">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057439">case</span>&nbsp;<span class="string" id="6057444">&#34;innerxml&#34;</span><span class="op" id="6057454">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057460">finfo</span><span class="op" id="6057465">.</span><span class="ident" id="6057466">flags</span>&nbsp;<span class="op" id="6057472">|=</span>&nbsp;<span class="ident" id="6057475">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057488">case</span>&nbsp;<span class="string" id="6057493">&#34;comment&#34;</span><span class="op" id="6057502">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057508">finfo</span><span class="op" id="6057513">.</span><span class="ident" id="6057514">flags</span>&nbsp;<span class="op" id="6057520">|=</span>&nbsp;<span class="ident" id="6057523">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057535">case</span>&nbsp;<span class="string" id="6057540">&#34;any&#34;</span><span class="op" id="6057545">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057551">finfo</span><span class="op" id="6057556">.</span><span class="ident" id="6057557">flags</span>&nbsp;<span class="op" id="6057563">|=</span>&nbsp;<span class="ident" id="6057566">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057574">case</span>&nbsp;<span class="string" id="6057579">&#34;omitempty&#34;</span><span class="op" id="6057590">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057596">finfo</span><span class="op" id="6057601">.</span><span class="ident" id="6057602">flags</span>&nbsp;<span class="op" id="6057608">|=</span>&nbsp;<span class="ident" id="6057611">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057629">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6057634">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057664">valid</span>&nbsp;<span class="op" id="6057670">:=</span>&nbsp;<span class="builtintype" id="6057673">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057680">switch</span>&nbsp;<span class="ident" id="6057687">mode</span>&nbsp;<span class="op" id="6057692">:=</span>&nbsp;<span class="ident" id="6057695">finfo</span><span class="op" id="6057700">.</span><span class="ident" id="6057701">flags</span>&nbsp;<span class="op" id="6057707">&amp;</span>&nbsp;<span class="ident" id="6057709">fMode</span><span class="op" id="6057714">;</span>&nbsp;<span class="ident" id="6057716">mode</span>&nbsp;<span class="op" id="6057721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057725">case</span>&nbsp;<span class="num" id="6057730">0</span><span class="op" id="6057731">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057736">finfo</span><span class="op" id="6057741">.</span><span class="ident" id="6057742">flags</span>&nbsp;<span class="op" id="6057748">|=</span>&nbsp;<span class="ident" id="6057751">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057762">case</span>&nbsp;<span class="ident" id="6057767">fAttr</span><span class="op" id="6057772">,</span>&nbsp;<span class="ident" id="6057774">fCharData</span><span class="op" id="6057783">,</span>&nbsp;<span class="ident" id="6057785">fInnerXml</span><span class="op" id="6057794">,</span>&nbsp;<span class="ident" id="6057796">fComment</span><span class="op" id="6057804">,</span>&nbsp;<span class="ident" id="6057806">fAny</span><span class="op" id="6057810">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057815">if</span>&nbsp;<span class="ident" id="6057818">f</span><span class="op" id="6057819">.</span><span class="ident" id="6057820">Name</span>&nbsp;<span class="op" id="6057825">==</span>&nbsp;<span class="string" id="6057828">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6057838">||</span>&nbsp;<span class="ident" id="6057841">tag</span>&nbsp;<span class="op" id="6057845">!=</span>&nbsp;<span class="string" id="6057848">&#34;&#34;</span>&nbsp;<span class="op" id="6057851">&amp;&amp;</span>&nbsp;<span class="ident" id="6057854">mode</span>&nbsp;<span class="op" id="6057859">!=</span>&nbsp;<span class="ident" id="6057862">fAttr</span>&nbsp;<span class="op" id="6057868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057874">valid</span>&nbsp;<span class="op" id="6057880">=</span>&nbsp;<span class="builtintype" id="6057882">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057891">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057895">default</span><span class="op" id="6057902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6057907">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6057968">valid</span>&nbsp;<span class="op" id="6057974">=</span>&nbsp;<span class="builtintype" id="6057976">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6057984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6057988">if</span>&nbsp;<span class="ident" id="6057991">finfo</span><span class="op" id="6057996">.</span><span class="ident" id="6057997">flags</span><span class="op" id="6058002">&amp;</span><span class="ident" id="6058003">fMode</span>&nbsp;<span class="op" id="6058009">==</span>&nbsp;<span class="ident" id="6058012">fAny</span>&nbsp;<span class="op" id="6058017">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058022">finfo</span><span class="op" id="6058027">.</span><span class="ident" id="6058028">flags</span>&nbsp;<span class="op" id="6058034">|=</span>&nbsp;<span class="ident" id="6058037">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058052">if</span>&nbsp;<span class="ident" id="6058055">finfo</span><span class="op" id="6058060">.</span><span class="ident" id="6058061">flags</span><span class="op" id="6058066">&amp;</span><span class="ident" id="6058067">fOmitEmpty</span>&nbsp;<span class="op" id="6058078">!=</span>&nbsp;<span class="num" id="6058081">0</span>&nbsp;<span class="op" id="6058083">&amp;&amp;</span>&nbsp;<span class="ident" id="6058086">finfo</span><span class="op" id="6058091">.</span><span class="ident" id="6058092">flags</span><span class="op" id="6058097">&amp;</span><span class="op" id="6058098">(</span><span class="ident" id="6058099">fElement</span><span class="op" id="6058107">|</span><span class="ident" id="6058108">fAttr</span><span class="op" id="6058113">)</span>&nbsp;<span class="op" id="6058115">==</span>&nbsp;<span class="num" id="6058118">0</span>&nbsp;<span class="op" id="6058120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058125">valid</span>&nbsp;<span class="op" id="6058131">=</span>&nbsp;<span class="builtintype" id="6058133">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058141">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058145">if</span>&nbsp;<span class="op" id="6058148">!</span><span class="ident" id="6058149">valid</span>&nbsp;<span class="op" id="6058155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058160">return</span>&nbsp;<span class="ident" id="6058167">nil</span><span class="op" id="6058170">,</span>&nbsp;<span class="ident" id="6058172">fmt</span><span class="op" id="6058175">.</span><span class="ident" id="6058176">Errorf</span><span class="op" id="6058182">(</span><span class="string" id="6058183">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6058228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058234">f</span><span class="op" id="6058235">.</span><span class="ident" id="6058236">Name</span><span class="op" id="6058240">,</span>&nbsp;<span class="ident" id="6058242">typ</span><span class="op" id="6058245">,</span>&nbsp;<span class="ident" id="6058247">f</span><span class="op" id="6058248">.</span><span class="ident" id="6058249">Tag</span><span class="op" id="6058252">.</span><span class="ident" id="6058253">Get</span><span class="op" id="6058256">(</span><span class="string" id="6058257">&#34;xml&#34;</span><span class="op" id="6058262">)</span><span class="op" id="6058263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058270">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058274">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058322">if</span>&nbsp;<span class="ident" id="6058325">finfo</span><span class="op" id="6058330">.</span><span class="ident" id="6058331">xmlns</span>&nbsp;<span class="op" id="6058337">!=</span>&nbsp;<span class="string" id="6058340">&#34;&#34;</span>&nbsp;<span class="op" id="6058343">&amp;&amp;</span>&nbsp;<span class="ident" id="6058346">tag</span>&nbsp;<span class="op" id="6058350">==</span>&nbsp;<span class="string" id="6058353">&#34;&#34;</span>&nbsp;<span class="op" id="6058356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058360">return</span>&nbsp;<span class="ident" id="6058367">nil</span><span class="op" id="6058370">,</span>&nbsp;<span class="ident" id="6058372">fmt</span><span class="op" id="6058375">.</span><span class="ident" id="6058376">Errorf</span><span class="op" id="6058382">(</span><span class="string" id="6058383">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6058439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058444">f</span><span class="op" id="6058445">.</span><span class="ident" id="6058446">Name</span><span class="op" id="6058450">,</span>&nbsp;<span class="ident" id="6058452">typ</span><span class="op" id="6058455">,</span>&nbsp;<span class="ident" id="6058457">f</span><span class="op" id="6058458">.</span><span class="ident" id="6058459">Tag</span><span class="op" id="6058462">.</span><span class="ident" id="6058463">Get</span><span class="op" id="6058466">(</span><span class="string" id="6058467">&#34;xml&#34;</span><span class="op" id="6058472">)</span><span class="op" id="6058473">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058480">if</span>&nbsp;<span class="ident" id="6058483">f</span><span class="op" id="6058484">.</span><span class="ident" id="6058485">Name</span>&nbsp;<span class="op" id="6058490">==</span>&nbsp;<span class="string" id="6058493">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6058503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058507">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058566">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058626">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058668">finfo</span><span class="op" id="6058673">.</span><span class="ident" id="6058674">name</span>&nbsp;<span class="op" id="6058679">=</span>&nbsp;<span class="ident" id="6058681">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058687">return</span>&nbsp;<span class="ident" id="6058694">finfo</span><span class="op" id="6058699">,</span>&nbsp;<span class="ident" id="6058701">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058710">if</span>&nbsp;<span class="ident" id="6058713">tag</span>&nbsp;<span class="op" id="6058717">==</span>&nbsp;<span class="string" id="6058720">&#34;&#34;</span>&nbsp;<span class="op" id="6058723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058727">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058785">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6058845">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058875">if</span>&nbsp;<span class="ident" id="6058878">xmlname</span>&nbsp;<span class="op" id="6058886">:=</span>&nbsp;<span class="ident" id="6058889">lookupXMLName</span><span class="op" id="6058902">(</span><span class="ident" id="6058903">f</span><span class="op" id="6058904">.</span><span class="ident" id="6058905">Type</span><span class="op" id="6058909">)</span><span class="op" id="6058910">;</span>&nbsp;<span class="ident" id="6058912">xmlname</span>&nbsp;<span class="op" id="6058920">!=</span>&nbsp;<span class="ident" id="6058923">nil</span>&nbsp;<span class="op" id="6058927">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058932">finfo</span><span class="op" id="6058937">.</span><span class="ident" id="6058938">xmlns</span><span class="op" id="6058943">,</span>&nbsp;<span class="ident" id="6058945">finfo</span><span class="op" id="6058950">.</span><span class="ident" id="6058951">name</span>&nbsp;<span class="op" id="6058956">=</span>&nbsp;<span class="ident" id="6058958">xmlname</span><span class="op" id="6058965">.</span><span class="ident" id="6058966">xmlns</span><span class="op" id="6058971">,</span>&nbsp;<span class="ident" id="6058973">xmlname</span><span class="op" id="6058980">.</span><span class="ident" id="6058981">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058988">}</span>&nbsp;<span class="keyword" id="6058990">else</span>&nbsp;<span class="op" id="6058995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059000">finfo</span><span class="op" id="6059005">.</span><span class="ident" id="6059006">name</span>&nbsp;<span class="op" id="6059011">=</span>&nbsp;<span class="ident" id="6059013">f</span><span class="op" id="6059014">.</span><span class="ident" id="6059015">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059026">return</span>&nbsp;<span class="ident" id="6059033">finfo</span><span class="op" id="6059038">,</span>&nbsp;<span class="ident" id="6059040">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059049">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059085">parents</span>&nbsp;<span class="op" id="6059093">:=</span>&nbsp;<span class="ident" id="6059096">strings</span><span class="op" id="6059103">.</span><span class="ident" id="6059104">Split</span><span class="op" id="6059109">(</span><span class="ident" id="6059110">tag</span><span class="op" id="6059113">,</span>&nbsp;<span class="string" id="6059115">&#34;&gt;&#34;</span><span class="op" id="6059118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059121">if</span>&nbsp;<span class="ident" id="6059124">parents</span><span class="op" id="6059131">[</span><span class="num" id="6059132">0</span><span class="op" id="6059133">]</span>&nbsp;<span class="op" id="6059135">==</span>&nbsp;<span class="string" id="6059138">&#34;&#34;</span>&nbsp;<span class="op" id="6059141">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059145">parents</span><span class="op" id="6059152">[</span><span class="num" id="6059153">0</span><span class="op" id="6059154">]</span>&nbsp;<span class="op" id="6059156">=</span>&nbsp;<span class="ident" id="6059158">f</span><span class="op" id="6059159">.</span><span class="ident" id="6059160">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059169">if</span>&nbsp;<span class="ident" id="6059172">parents</span><span class="op" id="6059179">[</span><span class="builtinfunc" id="6059180">len</span><span class="op" id="6059183">(</span><span class="ident" id="6059184">parents</span><span class="op" id="6059191">)</span><span class="op" id="6059192">-</span><span class="num" id="6059193">1</span><span class="op" id="6059194">]</span>&nbsp;<span class="op" id="6059196">==</span>&nbsp;<span class="string" id="6059199">&#34;&#34;</span>&nbsp;<span class="op" id="6059202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059206">return</span>&nbsp;<span class="ident" id="6059213">nil</span><span class="op" id="6059216">,</span>&nbsp;<span class="ident" id="6059218">fmt</span><span class="op" id="6059221">.</span><span class="ident" id="6059222">Errorf</span><span class="op" id="6059228">(</span><span class="string" id="6059229">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6059271">,</span>&nbsp;<span class="ident" id="6059273">f</span><span class="op" id="6059274">.</span><span class="ident" id="6059275">Name</span><span class="op" id="6059279">,</span>&nbsp;<span class="ident" id="6059281">typ</span><span class="op" id="6059284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059287">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059290">finfo</span><span class="op" id="6059295">.</span><span class="ident" id="6059296">name</span>&nbsp;<span class="op" id="6059301">=</span>&nbsp;<span class="ident" id="6059303">parents</span><span class="op" id="6059310">[</span><span class="builtinfunc" id="6059311">len</span><span class="op" id="6059314">(</span><span class="ident" id="6059315">parents</span><span class="op" id="6059322">)</span><span class="op" id="6059323">-</span><span class="num" id="6059324">1</span><span class="op" id="6059325">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059328">if</span>&nbsp;<span class="builtinfunc" id="6059331">len</span><span class="op" id="6059334">(</span><span class="ident" id="6059335">parents</span><span class="op" id="6059342">)</span>&nbsp;<span class="op" id="6059344">&gt;</span>&nbsp;<span class="num" id="6059346">1</span>&nbsp;<span class="op" id="6059348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059352">if</span>&nbsp;<span class="op" id="6059355">(</span><span class="ident" id="6059356">finfo</span><span class="op" id="6059361">.</span><span class="ident" id="6059362">flags</span>&nbsp;<span class="op" id="6059368">&amp;</span>&nbsp;<span class="ident" id="6059370">fElement</span><span class="op" id="6059378">)</span>&nbsp;<span class="op" id="6059380">==</span>&nbsp;<span class="num" id="6059383">0</span>&nbsp;<span class="op" id="6059385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059390">return</span>&nbsp;<span class="ident" id="6059397">nil</span><span class="op" id="6059400">,</span>&nbsp;<span class="ident" id="6059402">fmt</span><span class="op" id="6059405">.</span><span class="ident" id="6059406">Errorf</span><span class="op" id="6059412">(</span><span class="string" id="6059413">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6059451">,</span>&nbsp;<span class="ident" id="6059453">tag</span><span class="op" id="6059456">,</span>&nbsp;<span class="ident" id="6059458">strings</span><span class="op" id="6059465">.</span><span class="ident" id="6059466">Join</span><span class="op" id="6059470">(</span><span class="ident" id="6059471">tokens</span><span class="op" id="6059477">[</span><span class="num" id="6059478">1</span><span class="op" id="6059479">:</span><span class="op" id="6059480">]</span><span class="op" id="6059481">,</span>&nbsp;<span class="string" id="6059483">&#34;,&#34;</span><span class="op" id="6059486">)</span><span class="op" id="6059487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059491">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059495">finfo</span><span class="op" id="6059500">.</span><span class="ident" id="6059501">parents</span>&nbsp;<span class="op" id="6059509">=</span>&nbsp;<span class="ident" id="6059511">parents</span><span class="op" id="6059518">[</span><span class="op" id="6059519">:</span><span class="builtinfunc" id="6059520">len</span><span class="op" id="6059523">(</span><span class="ident" id="6059524">parents</span><span class="op" id="6059531">)</span><span class="op" id="6059532">-</span><span class="num" id="6059533">1</span><span class="op" id="6059534">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059541">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059606">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6059669">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059709">if</span>&nbsp;<span class="ident" id="6059712">finfo</span><span class="op" id="6059717">.</span><span class="ident" id="6059718">flags</span><span class="op" id="6059723">&amp;</span><span class="ident" id="6059724">fElement</span>&nbsp;<span class="op" id="6059733">!=</span>&nbsp;<span class="num" id="6059736">0</span>&nbsp;<span class="op" id="6059738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059742">ftyp</span>&nbsp;<span class="op" id="6059747">:=</span>&nbsp;<span class="ident" id="6059750">f</span><span class="op" id="6059751">.</span><span class="ident" id="6059752">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059759">xmlname</span>&nbsp;<span class="op" id="6059767">:=</span>&nbsp;<span class="ident" id="6059770">lookupXMLName</span><span class="op" id="6059783">(</span><span class="ident" id="6059784">ftyp</span><span class="op" id="6059788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059792">if</span>&nbsp;<span class="ident" id="6059795">xmlname</span>&nbsp;<span class="op" id="6059803">!=</span>&nbsp;<span class="ident" id="6059806">nil</span>&nbsp;<span class="op" id="6059810">&amp;&amp;</span>&nbsp;<span class="ident" id="6059813">xmlname</span><span class="op" id="6059820">.</span><span class="ident" id="6059821">name</span>&nbsp;<span class="op" id="6059826">!=</span>&nbsp;<span class="ident" id="6059829">finfo</span><span class="op" id="6059834">.</span><span class="ident" id="6059835">name</span>&nbsp;<span class="op" id="6059840">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059845">return</span>&nbsp;<span class="ident" id="6059852">nil</span><span class="op" id="6059855">,</span>&nbsp;<span class="ident" id="6059857">fmt</span><span class="op" id="6059860">.</span><span class="ident" id="6059861">Errorf</span><span class="op" id="6059867">(</span><span class="string" id="6059868">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6059935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059941">finfo</span><span class="op" id="6059946">.</span><span class="ident" id="6059947">name</span><span class="op" id="6059951">,</span>&nbsp;<span class="ident" id="6059953">typ</span><span class="op" id="6059956">,</span>&nbsp;<span class="ident" id="6059958">f</span><span class="op" id="6059959">.</span><span class="ident" id="6059960">Name</span><span class="op" id="6059964">,</span>&nbsp;<span class="ident" id="6059966">xmlname</span><span class="op" id="6059973">.</span><span class="ident" id="6059974">name</span><span class="op" id="6059978">,</span>&nbsp;<span class="ident" id="6059980">ftyp</span><span class="op" id="6059984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059994">return</span>&nbsp;<span class="ident" id="6060001">finfo</span><span class="op" id="6060006">,</span>&nbsp;<span class="ident" id="6060008">nil</span><br>
<span class="lineno">225</span><span class="op" id="6060012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6060015">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6060078">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6060140">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6060159">func</span>&nbsp;<span class="ident" id="6060164">lookupXMLName</span><span class="op" id="6060177">(</span><span class="ident" id="6060178">typ</span>&nbsp;<span class="ident" id="6060182">reflect</span><span class="op" id="6060189">.</span><span class="ident" id="6060190">Type</span><span class="op" id="6060194">)</span>&nbsp;<span class="op" id="6060196">(</span><span class="ident" id="6060197">xmlname</span>&nbsp;<span class="op" id="6060205">*</span><span class="ident" id="6060206">fieldInfo</span><span class="op" id="6060215">)</span>&nbsp;<span class="op" id="6060217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060220">for</span>&nbsp;<span class="ident" id="6060224">typ</span><span class="op" id="6060227">.</span><span class="ident" id="6060228">Kind</span><span class="op" id="6060232">(</span><span class="op" id="6060233">)</span>&nbsp;<span class="op" id="6060235">==</span>&nbsp;<span class="ident" id="6060238">reflect</span><span class="op" id="6060245">.</span><span class="ident" id="6060246">Ptr</span>&nbsp;<span class="op" id="6060250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060254">typ</span>&nbsp;<span class="op" id="6060258">=</span>&nbsp;<span class="ident" id="6060260">typ</span><span class="op" id="6060263">.</span><span class="ident" id="6060264">Elem</span><span class="op" id="6060268">(</span><span class="op" id="6060269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060275">if</span>&nbsp;<span class="ident" id="6060278">typ</span><span class="op" id="6060281">.</span><span class="ident" id="6060282">Kind</span><span class="op" id="6060286">(</span><span class="op" id="6060287">)</span>&nbsp;<span class="op" id="6060289">!=</span>&nbsp;<span class="ident" id="6060292">reflect</span><span class="op" id="6060299">.</span><span class="ident" id="6060300">Struct</span>&nbsp;<span class="op" id="6060307">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060311">return</span>&nbsp;<span class="ident" id="6060318">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060326">for</span>&nbsp;<span class="ident" id="6060330">i</span><span class="op" id="6060331">,</span>&nbsp;<span class="ident" id="6060333">n</span>&nbsp;<span class="op" id="6060335">:=</span>&nbsp;<span class="num" id="6060338">0</span><span class="op" id="6060339">,</span>&nbsp;<span class="ident" id="6060341">typ</span><span class="op" id="6060344">.</span><span class="ident" id="6060345">NumField</span><span class="op" id="6060353">(</span><span class="op" id="6060354">)</span><span class="op" id="6060355">;</span>&nbsp;<span class="ident" id="6060357">i</span>&nbsp;<span class="op" id="6060359">&lt;</span>&nbsp;<span class="ident" id="6060361">n</span><span class="op" id="6060362">;</span>&nbsp;<span class="ident" id="6060364">i</span><span class="op" id="6060365">++</span>&nbsp;<span class="op" id="6060368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060372">f</span>&nbsp;<span class="op" id="6060374">:=</span>&nbsp;<span class="ident" id="6060377">typ</span><span class="op" id="6060380">.</span><span class="ident" id="6060381">Field</span><span class="op" id="6060386">(</span><span class="ident" id="6060387">i</span><span class="op" id="6060388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060392">if</span>&nbsp;<span class="ident" id="6060395">f</span><span class="op" id="6060396">.</span><span class="ident" id="6060397">Name</span>&nbsp;<span class="op" id="6060402">!=</span>&nbsp;<span class="string" id="6060405">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6060415">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060420">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060435">finfo</span><span class="op" id="6060440">,</span>&nbsp;<span class="ident" id="6060442">err</span>&nbsp;<span class="op" id="6060446">:=</span>&nbsp;<span class="ident" id="6060449">structFieldInfo</span><span class="op" id="6060464">(</span><span class="ident" id="6060465">typ</span><span class="op" id="6060468">,</span>&nbsp;<span class="op" id="6060470">&amp;</span><span class="ident" id="6060471">f</span><span class="op" id="6060472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060476">if</span>&nbsp;<span class="ident" id="6060479">finfo</span><span class="op" id="6060484">.</span><span class="ident" id="6060485">name</span>&nbsp;<span class="op" id="6060490">!=</span>&nbsp;<span class="string" id="6060493">&#34;&#34;</span>&nbsp;<span class="op" id="6060496">&amp;&amp;</span>&nbsp;<span class="ident" id="6060499">err</span>&nbsp;<span class="op" id="6060503">==</span>&nbsp;<span class="ident" id="6060506">nil</span>&nbsp;<span class="op" id="6060510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060515">return</span>&nbsp;<span class="ident" id="6060522">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060534">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6060588">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060638">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060645">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060648">return</span>&nbsp;<span class="ident" id="6060655">nil</span><br>
<span class="lineno"></span><span class="op" id="6060659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6060662">func</span>&nbsp;<span class="ident" id="6060667">min</span><span class="op" id="6060670">(</span><span class="ident" id="6060671">a</span><span class="op" id="6060672">,</span>&nbsp;<span class="ident" id="6060674">b</span>&nbsp;<span class="builtintype" id="6060676">int</span><span class="op" id="6060679">)</span>&nbsp;<span class="builtintype" id="6060681">int</span>&nbsp;<span class="op" id="6060685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060688">if</span>&nbsp;<span class="ident" id="6060691">a</span>&nbsp;<span class="op" id="6060693">&lt;=</span>&nbsp;<span class="ident" id="6060696">b</span>&nbsp;<span class="op" id="6060698">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060702">return</span>&nbsp;<span class="ident" id="6060709">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060715">return</span>&nbsp;<span class="ident" id="6060722">b</span><br>
<span class="lineno"></span><span class="op" id="6060724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6060727">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6060786">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6060853">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6060923">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6060969">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6061034">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6061103">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6061168">func</span>&nbsp;<span class="ident" id="6061173">addFieldInfo</span><span class="op" id="6061185">(</span><span class="ident" id="6061186">typ</span>&nbsp;<span class="ident" id="6061190">reflect</span><span class="op" id="6061197">.</span><span class="ident" id="6061198">Type</span><span class="op" id="6061202">,</span>&nbsp;<span class="ident" id="6061204">tinfo</span>&nbsp;<span class="op" id="6061210">*</span><span class="ident" id="6061211">typeInfo</span><span class="op" id="6061219">,</span>&nbsp;<span class="ident" id="6061221">newf</span>&nbsp;<span class="op" id="6061226">*</span><span class="ident" id="6061227">fieldInfo</span><span class="op" id="6061236">)</span>&nbsp;<span class="builtintype" id="6061238">error</span>&nbsp;<span class="op" id="6061244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061247">var</span>&nbsp;<span class="ident" id="6061251">conflicts</span>&nbsp;<span class="op" id="6061261">[</span><span class="op" id="6061262">]</span><span class="builtintype" id="6061263">int</span><br>
<span class="lineno"></span><span class="ident" id="6061267">Loop</span><span class="op" id="6061271">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6061274">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061341">for</span>&nbsp;<span class="ident" id="6061345">i</span>&nbsp;<span class="op" id="6061347">:=</span>&nbsp;<span class="keyword" id="6061350">range</span>&nbsp;<span class="ident" id="6061356">tinfo</span><span class="op" id="6061361">.</span><span class="ident" id="6061362">fields</span>&nbsp;<span class="op" id="6061369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061373">oldf</span>&nbsp;<span class="op" id="6061378">:=</span>&nbsp;<span class="op" id="6061381">&amp;</span><span class="ident" id="6061382">tinfo</span><span class="op" id="6061387">.</span><span class="ident" id="6061388">fields</span><span class="op" id="6061394">[</span><span class="ident" id="6061395">i</span><span class="op" id="6061396">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061400">if</span>&nbsp;<span class="ident" id="6061403">oldf</span><span class="op" id="6061407">.</span><span class="ident" id="6061408">flags</span><span class="op" id="6061413">&amp;</span><span class="ident" id="6061414">fMode</span>&nbsp;<span class="op" id="6061420">!=</span>&nbsp;<span class="ident" id="6061423">newf</span><span class="op" id="6061427">.</span><span class="ident" id="6061428">flags</span><span class="op" id="6061433">&amp;</span><span class="ident" id="6061434">fMode</span>&nbsp;<span class="op" id="6061440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061445">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061460">if</span>&nbsp;<span class="ident" id="6061463">oldf</span><span class="op" id="6061467">.</span><span class="ident" id="6061468">xmlns</span>&nbsp;<span class="op" id="6061474">!=</span>&nbsp;<span class="string" id="6061477">&#34;&#34;</span>&nbsp;<span class="op" id="6061480">&amp;&amp;</span>&nbsp;<span class="ident" id="6061483">newf</span><span class="op" id="6061487">.</span><span class="ident" id="6061488">xmlns</span>&nbsp;<span class="op" id="6061494">!=</span>&nbsp;<span class="string" id="6061497">&#34;&#34;</span>&nbsp;<span class="op" id="6061500">&amp;&amp;</span>&nbsp;<span class="ident" id="6061503">oldf</span><span class="op" id="6061507">.</span><span class="ident" id="6061508">xmlns</span>&nbsp;<span class="op" id="6061514">!=</span>&nbsp;<span class="ident" id="6061517">newf</span><span class="op" id="6061521">.</span><span class="ident" id="6061522">xmlns</span>&nbsp;<span class="op" id="6061528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061533">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061548">minl</span>&nbsp;<span class="op" id="6061553">:=</span>&nbsp;<span class="ident" id="6061556">min</span><span class="op" id="6061559">(</span><span class="builtinfunc" id="6061560">len</span><span class="op" id="6061563">(</span><span class="ident" id="6061564">newf</span><span class="op" id="6061568">.</span><span class="ident" id="6061569">parents</span><span class="op" id="6061576">)</span><span class="op" id="6061577">,</span>&nbsp;<span class="builtinfunc" id="6061579">len</span><span class="op" id="6061582">(</span><span class="ident" id="6061583">oldf</span><span class="op" id="6061587">.</span><span class="ident" id="6061588">parents</span><span class="op" id="6061595">)</span><span class="op" id="6061596">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061600">for</span>&nbsp;<span class="ident" id="6061604">p</span>&nbsp;<span class="op" id="6061606">:=</span>&nbsp;<span class="num" id="6061609">0</span><span class="op" id="6061610">;</span>&nbsp;<span class="ident" id="6061612">p</span>&nbsp;<span class="op" id="6061614">&lt;</span>&nbsp;<span class="ident" id="6061616">minl</span><span class="op" id="6061620">;</span>&nbsp;<span class="ident" id="6061622">p</span><span class="op" id="6061623">++</span>&nbsp;<span class="op" id="6061626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061631">if</span>&nbsp;<span class="ident" id="6061634">oldf</span><span class="op" id="6061638">.</span><span class="ident" id="6061639">parents</span><span class="op" id="6061646">[</span><span class="ident" id="6061647">p</span><span class="op" id="6061648">]</span>&nbsp;<span class="op" id="6061650">!=</span>&nbsp;<span class="ident" id="6061653">newf</span><span class="op" id="6061657">.</span><span class="ident" id="6061658">parents</span><span class="op" id="6061665">[</span><span class="ident" id="6061666">p</span><span class="op" id="6061667">]</span>&nbsp;<span class="op" id="6061669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061675">continue</span>&nbsp;<span class="ident" id="6061684">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061696">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061700">if</span>&nbsp;<span class="builtinfunc" id="6061703">len</span><span class="op" id="6061706">(</span><span class="ident" id="6061707">oldf</span><span class="op" id="6061711">.</span><span class="ident" id="6061712">parents</span><span class="op" id="6061719">)</span>&nbsp;<span class="op" id="6061721">&gt;</span>&nbsp;<span class="builtinfunc" id="6061723">len</span><span class="op" id="6061726">(</span><span class="ident" id="6061727">newf</span><span class="op" id="6061731">.</span><span class="ident" id="6061732">parents</span><span class="op" id="6061739">)</span>&nbsp;<span class="op" id="6061741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061746">if</span>&nbsp;<span class="ident" id="6061749">oldf</span><span class="op" id="6061753">.</span><span class="ident" id="6061754">parents</span><span class="op" id="6061761">[</span><span class="builtinfunc" id="6061762">len</span><span class="op" id="6061765">(</span><span class="ident" id="6061766">newf</span><span class="op" id="6061770">.</span><span class="ident" id="6061771">parents</span><span class="op" id="6061778">)</span><span class="op" id="6061779">]</span>&nbsp;<span class="op" id="6061781">==</span>&nbsp;<span class="ident" id="6061784">newf</span><span class="op" id="6061788">.</span><span class="ident" id="6061789">name</span>&nbsp;<span class="op" id="6061794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061800">conflicts</span>&nbsp;<span class="op" id="6061810">=</span>&nbsp;<span class="builtinfunc" id="6061812">append</span><span class="op" id="6061818">(</span><span class="ident" id="6061819">conflicts</span><span class="op" id="6061828">,</span>&nbsp;<span class="ident" id="6061830">i</span><span class="op" id="6061831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061840">}</span>&nbsp;<span class="keyword" id="6061842">else</span>&nbsp;<span class="keyword" id="6061847">if</span>&nbsp;<span class="builtinfunc" id="6061850">len</span><span class="op" id="6061853">(</span><span class="ident" id="6061854">oldf</span><span class="op" id="6061858">.</span><span class="ident" id="6061859">parents</span><span class="op" id="6061866">)</span>&nbsp;<span class="op" id="6061868">&lt;</span>&nbsp;<span class="builtinfunc" id="6061870">len</span><span class="op" id="6061873">(</span><span class="ident" id="6061874">newf</span><span class="op" id="6061878">.</span><span class="ident" id="6061879">parents</span><span class="op" id="6061886">)</span>&nbsp;<span class="op" id="6061888">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061893">if</span>&nbsp;<span class="ident" id="6061896">newf</span><span class="op" id="6061900">.</span><span class="ident" id="6061901">parents</span><span class="op" id="6061908">[</span><span class="builtinfunc" id="6061909">len</span><span class="op" id="6061912">(</span><span class="ident" id="6061913">oldf</span><span class="op" id="6061917">.</span><span class="ident" id="6061918">parents</span><span class="op" id="6061925">)</span><span class="op" id="6061926">]</span>&nbsp;<span class="op" id="6061928">==</span>&nbsp;<span class="ident" id="6061931">oldf</span><span class="op" id="6061935">.</span><span class="ident" id="6061936">name</span>&nbsp;<span class="op" id="6061941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6061947">conflicts</span>&nbsp;<span class="op" id="6061957">=</span>&nbsp;<span class="builtinfunc" id="6061959">append</span><span class="op" id="6061965">(</span><span class="ident" id="6061966">conflicts</span><span class="op" id="6061975">,</span>&nbsp;<span class="ident" id="6061977">i</span><span class="op" id="6061978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6061987">}</span>&nbsp;<span class="keyword" id="6061989">else</span>&nbsp;<span class="op" id="6061994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6061999">if</span>&nbsp;<span class="ident" id="6062002">newf</span><span class="op" id="6062006">.</span><span class="ident" id="6062007">name</span>&nbsp;<span class="op" id="6062012">==</span>&nbsp;<span class="ident" id="6062015">oldf</span><span class="op" id="6062019">.</span><span class="ident" id="6062020">name</span>&nbsp;<span class="op" id="6062025">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062031">conflicts</span>&nbsp;<span class="op" id="6062041">=</span>&nbsp;<span class="builtinfunc" id="6062043">append</span><span class="op" id="6062049">(</span><span class="ident" id="6062050">conflicts</span><span class="op" id="6062059">,</span>&nbsp;<span class="ident" id="6062061">i</span><span class="op" id="6062062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062077">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062130">if</span>&nbsp;<span class="ident" id="6062133">conflicts</span>&nbsp;<span class="op" id="6062143">==</span>&nbsp;<span class="ident" id="6062146">nil</span>&nbsp;<span class="op" id="6062150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062154">tinfo</span><span class="op" id="6062159">.</span><span class="ident" id="6062160">fields</span>&nbsp;<span class="op" id="6062167">=</span>&nbsp;<span class="builtinfunc" id="6062169">append</span><span class="op" id="6062175">(</span><span class="ident" id="6062176">tinfo</span><span class="op" id="6062181">.</span><span class="ident" id="6062182">fields</span><span class="op" id="6062188">,</span>&nbsp;<span class="op" id="6062190">*</span><span class="ident" id="6062191">newf</span><span class="op" id="6062195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062199">return</span>&nbsp;<span class="ident" id="6062206">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062215">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062271">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062326">for</span>&nbsp;<span class="ident" id="6062330">_</span><span class="op" id="6062331">,</span>&nbsp;<span class="ident" id="6062333">i</span>&nbsp;<span class="op" id="6062335">:=</span>&nbsp;<span class="keyword" id="6062338">range</span>&nbsp;<span class="ident" id="6062344">conflicts</span>&nbsp;<span class="op" id="6062354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062358">if</span>&nbsp;<span class="builtinfunc" id="6062361">len</span><span class="op" id="6062364">(</span><span class="ident" id="6062365">tinfo</span><span class="op" id="6062370">.</span><span class="ident" id="6062371">fields</span><span class="op" id="6062377">[</span><span class="ident" id="6062378">i</span><span class="op" id="6062379">]</span><span class="op" id="6062380">.</span><span class="ident" id="6062381">idx</span><span class="op" id="6062384">)</span>&nbsp;<span class="op" id="6062386">&lt;</span>&nbsp;<span class="builtinfunc" id="6062388">len</span><span class="op" id="6062391">(</span><span class="ident" id="6062392">newf</span><span class="op" id="6062396">.</span><span class="ident" id="6062397">idx</span><span class="op" id="6062400">)</span>&nbsp;<span class="op" id="6062402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062407">return</span>&nbsp;<span class="ident" id="6062414">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062427">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062500">for</span>&nbsp;<span class="ident" id="6062504">_</span><span class="op" id="6062505">,</span>&nbsp;<span class="ident" id="6062507">i</span>&nbsp;<span class="op" id="6062509">:=</span>&nbsp;<span class="keyword" id="6062512">range</span>&nbsp;<span class="ident" id="6062518">conflicts</span>&nbsp;<span class="op" id="6062528">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062532">oldf</span>&nbsp;<span class="op" id="6062537">:=</span>&nbsp;<span class="op" id="6062540">&amp;</span><span class="ident" id="6062541">tinfo</span><span class="op" id="6062546">.</span><span class="ident" id="6062547">fields</span><span class="op" id="6062553">[</span><span class="ident" id="6062554">i</span><span class="op" id="6062555">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062559">if</span>&nbsp;<span class="builtinfunc" id="6062562">len</span><span class="op" id="6062565">(</span><span class="ident" id="6062566">oldf</span><span class="op" id="6062570">.</span><span class="ident" id="6062571">idx</span><span class="op" id="6062574">)</span>&nbsp;<span class="op" id="6062576">==</span>&nbsp;<span class="builtinfunc" id="6062579">len</span><span class="op" id="6062582">(</span><span class="ident" id="6062583">newf</span><span class="op" id="6062587">.</span><span class="ident" id="6062588">idx</span><span class="op" id="6062591">)</span>&nbsp;<span class="op" id="6062593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062598">f1</span>&nbsp;<span class="op" id="6062601">:=</span>&nbsp;<span class="ident" id="6062604">typ</span><span class="op" id="6062607">.</span><span class="ident" id="6062608">FieldByIndex</span><span class="op" id="6062620">(</span><span class="ident" id="6062621">oldf</span><span class="op" id="6062625">.</span><span class="ident" id="6062626">idx</span><span class="op" id="6062629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062634">f2</span>&nbsp;<span class="op" id="6062637">:=</span>&nbsp;<span class="ident" id="6062640">typ</span><span class="op" id="6062643">.</span><span class="ident" id="6062644">FieldByIndex</span><span class="op" id="6062656">(</span><span class="ident" id="6062657">newf</span><span class="op" id="6062661">.</span><span class="ident" id="6062662">idx</span><span class="op" id="6062665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062670">return</span>&nbsp;<span class="op" id="6062677">&amp;</span><span class="ident" id="6062678">TagPathError</span><span class="op" id="6062690">{</span><span class="ident" id="6062691">typ</span><span class="op" id="6062694">,</span>&nbsp;<span class="ident" id="6062696">f1</span><span class="op" id="6062698">.</span><span class="ident" id="6062699">Name</span><span class="op" id="6062703">,</span>&nbsp;<span class="ident" id="6062705">f1</span><span class="op" id="6062707">.</span><span class="ident" id="6062708">Tag</span><span class="op" id="6062711">.</span><span class="ident" id="6062712">Get</span><span class="op" id="6062715">(</span><span class="string" id="6062716">&#34;xml&#34;</span><span class="op" id="6062721">)</span><span class="op" id="6062722">,</span>&nbsp;<span class="ident" id="6062724">f2</span><span class="op" id="6062726">.</span><span class="ident" id="6062727">Name</span><span class="op" id="6062731">,</span>&nbsp;<span class="ident" id="6062733">f2</span><span class="op" id="6062735">.</span><span class="ident" id="6062736">Tag</span><span class="op" id="6062739">.</span><span class="ident" id="6062740">Get</span><span class="op" id="6062743">(</span><span class="string" id="6062744">&#34;xml&#34;</span><span class="op" id="6062749">)</span><span class="op" id="6062750">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062754">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6062757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062761">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6062831">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6062901">for</span>&nbsp;<span class="ident" id="6062905">c</span>&nbsp;<span class="op" id="6062907">:=</span>&nbsp;<span class="builtinfunc" id="6062910">len</span><span class="op" id="6062913">(</span><span class="ident" id="6062914">conflicts</span><span class="op" id="6062923">)</span>&nbsp;<span class="op" id="6062925">-</span>&nbsp;<span class="num" id="6062927">1</span><span class="op" id="6062928">;</span>&nbsp;<span class="ident" id="6062930">c</span>&nbsp;<span class="op" id="6062932">&gt;=</span>&nbsp;<span class="num" id="6062935">0</span><span class="op" id="6062936">;</span>&nbsp;<span class="ident" id="6062938">c</span><span class="op" id="6062939">--</span>&nbsp;<span class="op" id="6062942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6062946">i</span>&nbsp;<span class="op" id="6062948">:=</span>&nbsp;<span class="ident" id="6062951">conflicts</span><span class="op" id="6062960">[</span><span class="ident" id="6062961">c</span><span class="op" id="6062962">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6062966">copy</span><span class="op" id="6062970">(</span><span class="ident" id="6062971">tinfo</span><span class="op" id="6062976">.</span><span class="ident" id="6062977">fields</span><span class="op" id="6062983">[</span><span class="ident" id="6062984">i</span><span class="op" id="6062985">:</span><span class="op" id="6062986">]</span><span class="op" id="6062987">,</span>&nbsp;<span class="ident" id="6062989">tinfo</span><span class="op" id="6062994">.</span><span class="ident" id="6062995">fields</span><span class="op" id="6063001">[</span><span class="ident" id="6063002">i</span><span class="op" id="6063003">+</span><span class="num" id="6063004">1</span><span class="op" id="6063005">:</span><span class="op" id="6063006">]</span><span class="op" id="6063007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063011">tinfo</span><span class="op" id="6063016">.</span><span class="ident" id="6063017">fields</span>&nbsp;<span class="op" id="6063024">=</span>&nbsp;<span class="ident" id="6063026">tinfo</span><span class="op" id="6063031">.</span><span class="ident" id="6063032">fields</span><span class="op" id="6063038">[</span><span class="op" id="6063039">:</span><span class="builtinfunc" id="6063040">len</span><span class="op" id="6063043">(</span><span class="ident" id="6063044">tinfo</span><span class="op" id="6063049">.</span><span class="ident" id="6063050">fields</span><span class="op" id="6063056">)</span><span class="op" id="6063057">-</span><span class="num" id="6063058">1</span><span class="op" id="6063059">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063062">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063065">tinfo</span><span class="op" id="6063070">.</span><span class="ident" id="6063071">fields</span>&nbsp;<span class="op" id="6063078">=</span>&nbsp;<span class="builtinfunc" id="6063080">append</span><span class="op" id="6063086">(</span><span class="ident" id="6063087">tinfo</span><span class="op" id="6063092">.</span><span class="ident" id="6063093">fields</span><span class="op" id="6063099">,</span>&nbsp;<span class="op" id="6063101">*</span><span class="ident" id="6063102">newf</span><span class="op" id="6063106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063109">return</span>&nbsp;<span class="ident" id="6063116">nil</span><br>
<span class="lineno"></span><span class="op" id="6063120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6063123">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6063190">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6063249">type</span>&nbsp;<span class="ident" id="6063254">TagPathError</span>&nbsp;<span class="keyword" id="6063267">struct</span>&nbsp;<span class="op" id="6063274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063277">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6063290">reflect</span><span class="op" id="6063297">.</span><span class="ident" id="6063298">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063304">Field1</span><span class="op" id="6063310">,</span>&nbsp;<span class="ident" id="6063312">Tag1</span>&nbsp;<span class="builtintype" id="6063317">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063325">Field2</span><span class="op" id="6063331">,</span>&nbsp;<span class="ident" id="6063333">Tag2</span>&nbsp;<span class="builtintype" id="6063338">string</span><br>
<span class="lineno">340</span><span class="op" id="6063345">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6063348">func</span>&nbsp;<span class="op" id="6063353">(</span><span class="ident" id="6063354">e</span>&nbsp;<span class="op" id="6063356">*</span><span class="ident" id="6063357">TagPathError</span><span class="op" id="6063369">)</span>&nbsp;<span class="ident" id="6063371">Error</span><span class="op" id="6063376">(</span><span class="op" id="6063377">)</span>&nbsp;<span class="builtintype" id="6063379">string</span>&nbsp;<span class="op" id="6063386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063389">return</span>&nbsp;<span class="ident" id="6063396">fmt</span><span class="op" id="6063399">.</span><span class="ident" id="6063400">Sprintf</span><span class="op" id="6063407">(</span><span class="string" id="6063408">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6063469">,</span>&nbsp;<span class="ident" id="6063471">e</span><span class="op" id="6063472">.</span><span class="ident" id="6063473">Struct</span><span class="op" id="6063479">,</span>&nbsp;<span class="ident" id="6063481">e</span><span class="op" id="6063482">.</span><span class="ident" id="6063483">Field1</span><span class="op" id="6063489">,</span>&nbsp;<span class="ident" id="6063491">e</span><span class="op" id="6063492">.</span><span class="ident" id="6063493">Tag1</span><span class="op" id="6063497">,</span>&nbsp;<span class="ident" id="6063499">e</span><span class="op" id="6063500">.</span><span class="ident" id="6063501">Field2</span><span class="op" id="6063507">,</span>&nbsp;<span class="ident" id="6063509">e</span><span class="op" id="6063510">.</span><span class="ident" id="6063511">Tag2</span><span class="op" id="6063515">)</span><br>
<span class="lineno"></span><span class="op" id="6063517">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6063520">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6063577">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6063642">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6063685">func</span>&nbsp;<span class="op" id="6063690">(</span><span class="ident" id="6063691">finfo</span>&nbsp;<span class="op" id="6063697">*</span><span class="ident" id="6063698">fieldInfo</span><span class="op" id="6063707">)</span>&nbsp;<span class="ident" id="6063709">value</span><span class="op" id="6063714">(</span><span class="ident" id="6063715">v</span>&nbsp;<span class="ident" id="6063717">reflect</span><span class="op" id="6063724">.</span><span class="ident" id="6063725">Value</span><span class="op" id="6063730">)</span>&nbsp;<span class="ident" id="6063732">reflect</span><span class="op" id="6063739">.</span><span class="ident" id="6063740">Value</span>&nbsp;<span class="op" id="6063746">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063749">for</span>&nbsp;<span class="ident" id="6063753">i</span><span class="op" id="6063754">,</span>&nbsp;<span class="ident" id="6063756">x</span>&nbsp;<span class="op" id="6063758">:=</span>&nbsp;<span class="keyword" id="6063761">range</span>&nbsp;<span class="ident" id="6063767">finfo</span><span class="op" id="6063772">.</span><span class="ident" id="6063773">idx</span>&nbsp;<span class="op" id="6063777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063781">if</span>&nbsp;<span class="ident" id="6063784">i</span>&nbsp;<span class="op" id="6063786">&gt;</span>&nbsp;<span class="num" id="6063788">0</span>&nbsp;<span class="op" id="6063790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063795">t</span>&nbsp;<span class="op" id="6063797">:=</span>&nbsp;<span class="ident" id="6063800">v</span><span class="op" id="6063801">.</span><span class="ident" id="6063802">Type</span><span class="op" id="6063806">(</span><span class="op" id="6063807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063812">if</span>&nbsp;<span class="ident" id="6063815">t</span><span class="op" id="6063816">.</span><span class="ident" id="6063817">Kind</span><span class="op" id="6063821">(</span><span class="op" id="6063822">)</span>&nbsp;<span class="op" id="6063824">==</span>&nbsp;<span class="ident" id="6063827">reflect</span><span class="op" id="6063834">.</span><span class="ident" id="6063835">Ptr</span>&nbsp;<span class="op" id="6063839">&amp;&amp;</span>&nbsp;<span class="ident" id="6063842">t</span><span class="op" id="6063843">.</span><span class="ident" id="6063844">Elem</span><span class="op" id="6063848">(</span><span class="op" id="6063849">)</span><span class="op" id="6063850">.</span><span class="ident" id="6063851">Kind</span><span class="op" id="6063855">(</span><span class="op" id="6063856">)</span>&nbsp;<span class="op" id="6063858">==</span>&nbsp;<span class="ident" id="6063861">reflect</span><span class="op" id="6063868">.</span><span class="ident" id="6063869">Struct</span>&nbsp;<span class="op" id="6063876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063882">if</span>&nbsp;<span class="ident" id="6063885">v</span><span class="op" id="6063886">.</span><span class="ident" id="6063887">IsNil</span><span class="op" id="6063892">(</span><span class="op" id="6063893">)</span>&nbsp;<span class="op" id="6063895">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063902">v</span><span class="op" id="6063903">.</span><span class="ident" id="6063904">Set</span><span class="op" id="6063907">(</span><span class="ident" id="6063908">reflect</span><span class="op" id="6063915">.</span><span class="ident" id="6063916">New</span><span class="op" id="6063919">(</span><span class="ident" id="6063920">v</span><span class="op" id="6063921">.</span><span class="ident" id="6063922">Type</span><span class="op" id="6063926">(</span><span class="op" id="6063927">)</span><span class="op" id="6063928">.</span><span class="ident" id="6063929">Elem</span><span class="op" id="6063933">(</span><span class="op" id="6063934">)</span><span class="op" id="6063935">)</span><span class="op" id="6063936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063948">v</span>&nbsp;<span class="op" id="6063950">=</span>&nbsp;<span class="ident" id="6063952">v</span><span class="op" id="6063953">.</span><span class="ident" id="6063954">Elem</span><span class="op" id="6063958">(</span><span class="op" id="6063959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063968">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6063972">v</span>&nbsp;<span class="op" id="6063974">=</span>&nbsp;<span class="ident" id="6063976">v</span><span class="op" id="6063977">.</span><span class="ident" id="6063978">Field</span><span class="op" id="6063983">(</span><span class="ident" id="6063984">x</span><span class="op" id="6063985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6063988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6063991">return</span>&nbsp;<span class="ident" id="6063998">v</span><br>
<span class="lineno"></span><span class="op" id="6064000">}</span>
</div>
</body>
</html>
