<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4413506">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4413561">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4413615">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4413666">//&nbsp;Package&nbsp;rsa&nbsp;implements&nbsp;RSA&nbsp;encryption&nbsp;as&nbsp;specified&nbsp;in&nbsp;PKCS#1.</span><br>
<span class="lineno"></span><span class="keyword" id="4413731">package</span>&nbsp;<span class="ident" id="4413739">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4413744">import</span>&nbsp;<span class="op" id="4413751">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413754">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413764">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413779">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413796">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413806">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413814">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4413820">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4413831">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4413834">var</span>&nbsp;<span class="ident" id="4413838">bigZero</span>&nbsp;<span class="op" id="4413846">=</span>&nbsp;<span class="ident" id="4413848"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4413851">.</span><span class="ident" id="4413852">NewInt</span><span class="op" id="4413858">(</span><span class="num" id="4413859">0</span><span class="op" id="4413860">)</span><br>
<span class="lineno"></span><span class="keyword" id="4413862">var</span>&nbsp;<span class="ident" id="4413866">bigOne</span>&nbsp;<span class="op" id="4413873">=</span>&nbsp;<span class="ident" id="4413875"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4413878">.</span><span class="ident" id="4413879">NewInt</span><span class="op" id="4413885">(</span><span class="num" id="4413886">1</span><span class="op" id="4413887">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4413890">//&nbsp;A&nbsp;PublicKey&nbsp;represents&nbsp;the&nbsp;public&nbsp;part&nbsp;of&nbsp;an&nbsp;RSA&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4413947">type</span>&nbsp;<span class="ident" id="4413952">PublicKey</span>&nbsp;<span class="keyword" id="4413962">struct</span>&nbsp;<span class="op" id="4413969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413972">N</span>&nbsp;<span class="op" id="4413974">*</span><span class="ident" id="4413975"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4413978">.</span><span class="ident" id="4413979">Int</span>&nbsp;<span class="comment" id="4413983">//&nbsp;modulus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4413995">E</span>&nbsp;<span class="builtintype" id="4413997">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414006">//&nbsp;public&nbsp;exponent</span><br>
<span class="lineno">25</span><span class="op" id="4414025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4414028">var</span>&nbsp;<span class="op" id="4414032">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414035">errPublicModulus</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4414058">=</span>&nbsp;<span class="ident" id="4414060"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4414066">.</span><span class="ident" id="4414067">New</span><span class="op" id="4414070">(</span><span class="string" id="4414071">&#34;crypto/rsa:&nbsp;missing&nbsp;public&nbsp;modulus&#34;</span><span class="op" id="4414107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414110">errPublicExponentSmall</span>&nbsp;<span class="op" id="4414133">=</span>&nbsp;<span class="ident" id="4414135"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4414141">.</span><span class="ident" id="4414142">New</span><span class="op" id="4414145">(</span><span class="string" id="4414146">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;small&#34;</span><span class="op" id="4414185">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414188">errPublicExponentLarge</span>&nbsp;<span class="op" id="4414211">=</span>&nbsp;<span class="ident" id="4414213"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4414219">.</span><span class="ident" id="4414220">New</span><span class="op" id="4414223">(</span><span class="string" id="4414224">&#34;crypto/rsa:&nbsp;public&nbsp;exponent&nbsp;too&nbsp;large&#34;</span><span class="op" id="4414263">)</span><br>
<span class="lineno"></span><span class="op" id="4414265">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4414268">//&nbsp;checkPub&nbsp;sanity&nbsp;checks&nbsp;the&nbsp;public&nbsp;key&nbsp;before&nbsp;we&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="4414327">//&nbsp;We&nbsp;require&nbsp;pub.E&nbsp;to&nbsp;fit&nbsp;into&nbsp;a&nbsp;32-bit&nbsp;integer&nbsp;so&nbsp;that&nbsp;we</span><br>
<span class="lineno">35</span><span class="comment" id="4414387">//&nbsp;do&nbsp;not&nbsp;have&nbsp;different&nbsp;behavior&nbsp;depending&nbsp;on&nbsp;whether</span><br>
<span class="lineno"></span><span class="comment" id="4414442">//&nbsp;int&nbsp;is&nbsp;32&nbsp;or&nbsp;64&nbsp;bits.&nbsp;See&nbsp;also</span><br>
<span class="lineno"></span><span class="comment" id="4414476">//&nbsp;http://www.imperialviolet.org/2012/03/16/rsae.html.</span><br>
<span class="lineno"></span><span class="keyword" id="4414531">func</span>&nbsp;<span class="ident" id="4414536">checkPub</span><span class="op" id="4414544">(</span><span class="ident" id="4414545">pub</span>&nbsp;<span class="op" id="4414549">*</span><span class="ident" id="4414550"><a href="/crypto/rsa/rsa.go.html#4413952">PublicKey</a></span><span class="op" id="4414559">)</span>&nbsp;<span class="builtintype" id="4414561">error</span>&nbsp;<span class="op" id="4414567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414570">if</span>&nbsp;<span class="ident" id="4414573"><a href="/crypto/rsa/rsa.go.html#4414545">pub</a></span><span class="op" id="4414576">.</span><span class="ident" id="4414577">N</span>&nbsp;<span class="op" id="4414579">==</span>&nbsp;<span class="ident" id="4414582">nil</span>&nbsp;<span class="op" id="4414586">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414590">return</span>&nbsp;<span class="ident" id="4414597"><a href="/crypto/rsa/rsa.go.html#4414035">errPublicModulus</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414618">if</span>&nbsp;<span class="ident" id="4414621"><a href="/crypto/rsa/rsa.go.html#4414545">pub</a></span><span class="op" id="4414624">.</span><span class="ident" id="4414625">E</span>&nbsp;<span class="op" id="4414627">&lt;</span>&nbsp;<span class="num" id="4414629">2</span>&nbsp;<span class="op" id="4414631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414635">return</span>&nbsp;<span class="ident" id="4414642"><a href="/crypto/rsa/rsa.go.html#4414110">errPublicExponentSmall</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414666">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414669">if</span>&nbsp;<span class="ident" id="4414672"><a href="/crypto/rsa/rsa.go.html#4414545">pub</a></span><span class="op" id="4414675">.</span><span class="ident" id="4414676">E</span>&nbsp;<span class="op" id="4414678">&gt;</span>&nbsp;<span class="num" id="4414680">1</span><span class="op" id="4414681">&lt;&lt;</span><span class="num" id="4414683">31</span><span class="op" id="4414685">-</span><span class="num" id="4414686">1</span>&nbsp;<span class="op" id="4414688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414692">return</span>&nbsp;<span class="ident" id="4414699"><a href="/crypto/rsa/rsa.go.html#4414188">errPublicExponentLarge</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4414723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4414726">return</span>&nbsp;<span class="ident" id="4414733">nil</span><br>
<span class="lineno"></span><span class="op" id="4414737">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4414740">//&nbsp;A&nbsp;PrivateKey&nbsp;represents&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno"></span><span class="keyword" id="4414778">type</span>&nbsp;<span class="ident" id="4414783">PrivateKey</span>&nbsp;<span class="keyword" id="4414794">struct</span>&nbsp;<span class="op" id="4414801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414804"><a href="/crypto/rsa/rsa.go.html#4413952">PublicKey</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4414825">//&nbsp;public&nbsp;part.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414842">D</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4414852">*</span><span class="ident" id="4414853"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4414856">.</span><span class="ident" id="4414857">Int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4414863">//&nbsp;private&nbsp;exponent</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4414884">Primes</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4414894">[</span><span class="op" id="4414895">]</span><span class="op" id="4414896">*</span><span class="ident" id="4414897"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4414900">.</span><span class="ident" id="4414901">Int</span>&nbsp;<span class="comment" id="4414905">//&nbsp;prime&nbsp;factors&nbsp;of&nbsp;N,&nbsp;has&nbsp;&gt;=&nbsp;2&nbsp;elements.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4414949">//&nbsp;Precomputed&nbsp;contains&nbsp;precomputed&nbsp;values&nbsp;that&nbsp;speed&nbsp;up&nbsp;private</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415015">//&nbsp;operations,&nbsp;if&nbsp;available.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415045">Precomputed</span>&nbsp;<span class="ident" id="4415057"><a href="/crypto/rsa/rsa.go.html#4415816">PrecomputedValues</a></span><br>
<span class="lineno">60</span><span class="op" id="4415075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4415078">//&nbsp;Public&nbsp;returns&nbsp;the&nbsp;public&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;priv.</span><br>
<span class="lineno"></span><span class="keyword" id="4415134">func</span>&nbsp;<span class="op" id="4415139">(</span><span class="ident" id="4415140">priv</span>&nbsp;<span class="op" id="4415145">*</span><span class="ident" id="4415146"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4415156">)</span>&nbsp;<span class="ident" id="4415158">Public</span><span class="op" id="4415164">(</span><span class="op" id="4415165">)</span>&nbsp;<span class="ident" id="4415167"><a href="/crypto/rsa/rsa.go.html#4413754">crypto</a></span><span class="op" id="4415173">.</span><span class="ident" id="4415174">PublicKey</span>&nbsp;<span class="op" id="4415184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415187">return</span>&nbsp;<span class="op" id="4415194">&amp;</span><span class="ident" id="4415195"><a href="/crypto/rsa/rsa.go.html#4415140">priv</a></span><span class="op" id="4415199">.</span><span class="ident" id="4415200">PublicKey</span><br>
<span class="lineno">65</span><span class="op" id="4415210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4415213">//&nbsp;Sign&nbsp;signs&nbsp;msg&nbsp;with&nbsp;priv,&nbsp;reading&nbsp;randomness&nbsp;from&nbsp;rand.&nbsp;If&nbsp;opts&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4415285">//&nbsp;*PSSOptions&nbsp;then&nbsp;the&nbsp;PSS&nbsp;algorithm&nbsp;will&nbsp;be&nbsp;used,&nbsp;otherwise&nbsp;PKCS#1&nbsp;v1.5&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="4415364">//&nbsp;be&nbsp;used.&nbsp;This&nbsp;method&nbsp;is&nbsp;intended&nbsp;to&nbsp;support&nbsp;keys&nbsp;where&nbsp;the&nbsp;private&nbsp;part&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="4415442">//&nbsp;kept&nbsp;in,&nbsp;for&nbsp;example,&nbsp;a&nbsp;hardware&nbsp;module.&nbsp;Common&nbsp;uses&nbsp;should&nbsp;use&nbsp;the&nbsp;Sign*</span><br>
<span class="lineno"></span><span class="comment" id="4415519">//&nbsp;functions&nbsp;in&nbsp;this&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="4415549">func</span>&nbsp;<span class="op" id="4415554">(</span><span class="ident" id="4415555">priv</span>&nbsp;<span class="op" id="4415560">*</span><span class="ident" id="4415561"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4415571">)</span>&nbsp;<span class="ident" id="4415573">Sign</span><span class="op" id="4415577">(</span><span class="ident" id="4415578">rand</span>&nbsp;<span class="ident" id="4415583"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4415585">.</span><span class="ident" id="4415586">Reader</span><span class="op" id="4415592">,</span>&nbsp;<span class="ident" id="4415594">msg</span>&nbsp;<span class="op" id="4415598">[</span><span class="op" id="4415599">]</span><span class="builtintype" id="4415600">byte</span><span class="op" id="4415604">,</span>&nbsp;<span class="ident" id="4415606">opts</span>&nbsp;<span class="ident" id="4415611"><a href="/crypto/rsa/rsa.go.html#4413754">crypto</a></span><span class="op" id="4415617">.</span><span class="ident" id="4415618">SignerOpts</span><span class="op" id="4415628">)</span>&nbsp;<span class="op" id="4415630">(</span><span class="op" id="4415631">[</span><span class="op" id="4415632">]</span><span class="builtintype" id="4415633">byte</span><span class="op" id="4415637">,</span>&nbsp;<span class="builtintype" id="4415639">error</span><span class="op" id="4415644">)</span>&nbsp;<span class="op" id="4415646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415649">if</span>&nbsp;<span class="ident" id="4415652">pssOpts</span><span class="op" id="4415659">,</span>&nbsp;<span class="ident" id="4415661">ok</span>&nbsp;<span class="op" id="4415664">:=</span>&nbsp;<span class="ident" id="4415667"><a href="/crypto/rsa/rsa.go.html#4415606">opts</a></span><span class="op" id="4415671">.</span><span class="op" id="4415672">(</span><span class="op" id="4415673">*</span><span class="ident" id="4415674"><a href="/crypto/rsa/pss.go.html#4411008">PSSOptions</a></span><span class="op" id="4415684">)</span><span class="op" id="4415685">;</span>&nbsp;<span class="ident" id="4415687"><a href="/crypto/rsa/rsa.go.html#4415661">ok</a></span>&nbsp;<span class="op" id="4415690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415694">return</span>&nbsp;<span class="ident" id="4415701"><a href="/crypto/rsa/pss.go.html#4411928">SignPSS</a></span><span class="op" id="4415708">(</span><span class="ident" id="4415709"><a href="/crypto/rsa/rsa.go.html#4415578">rand</a></span><span class="op" id="4415713">,</span>&nbsp;<span class="ident" id="4415715"><a href="/crypto/rsa/rsa.go.html#4415555">priv</a></span><span class="op" id="4415719">,</span>&nbsp;<span class="ident" id="4415721"><a href="/crypto/rsa/rsa.go.html#4415652">pssOpts</a></span><span class="op" id="4415728">.</span><span class="ident" id="4415729">Hash</span><span class="op" id="4415733">,</span>&nbsp;<span class="ident" id="4415735"><a href="/crypto/rsa/rsa.go.html#4415594">msg</a></span><span class="op" id="4415738">,</span>&nbsp;<span class="ident" id="4415740"><a href="/crypto/rsa/rsa.go.html#4415652">pssOpts</a></span><span class="op" id="4415747">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4415750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4415754">return</span>&nbsp;<span class="ident" id="4415761"><a href="/crypto/rsa/pkcs1v15.go.html#4402408">SignPKCS1v15</a></span><span class="op" id="4415773">(</span><span class="ident" id="4415774"><a href="/crypto/rsa/rsa.go.html#4415578">rand</a></span><span class="op" id="4415778">,</span>&nbsp;<span class="ident" id="4415780"><a href="/crypto/rsa/rsa.go.html#4415555">priv</a></span><span class="op" id="4415784">,</span>&nbsp;<span class="ident" id="4415786"><a href="/crypto/rsa/rsa.go.html#4415606">opts</a></span><span class="op" id="4415790">.</span><span class="ident" id="4415791">HashFunc</span><span class="op" id="4415799">(</span><span class="op" id="4415800">)</span><span class="op" id="4415801">,</span>&nbsp;<span class="ident" id="4415803"><a href="/crypto/rsa/rsa.go.html#4415594">msg</a></span><span class="op" id="4415806">)</span><br>
<span class="lineno"></span><span class="op" id="4415808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="4415811">type</span>&nbsp;<span class="ident" id="4415816">PrecomputedValues</span>&nbsp;<span class="keyword" id="4415834">struct</span>&nbsp;<span class="op" id="4415841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415844">Dp</span><span class="op" id="4415846">,</span>&nbsp;<span class="ident" id="4415848">Dq</span>&nbsp;<span class="op" id="4415851">*</span><span class="ident" id="4415852"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4415855">.</span><span class="ident" id="4415856">Int</span>&nbsp;<span class="comment" id="4415860">//&nbsp;D&nbsp;mod&nbsp;(P-1)&nbsp;(or&nbsp;mod&nbsp;Q-1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4415889">Qinv</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4415896">*</span><span class="ident" id="4415897"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4415900">.</span><span class="ident" id="4415901">Int</span>&nbsp;<span class="comment" id="4415905">//&nbsp;Q^-1&nbsp;mod&nbsp;P</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415921">//&nbsp;CRTValues&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;3rd&nbsp;and&nbsp;subsequent&nbsp;primes.&nbsp;Due&nbsp;to&nbsp;a</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4415987">//&nbsp;historical&nbsp;accident,&nbsp;the&nbsp;CRT&nbsp;for&nbsp;the&nbsp;first&nbsp;two&nbsp;primes&nbsp;is&nbsp;handled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4416056">//&nbsp;differently&nbsp;in&nbsp;PKCS#1&nbsp;and&nbsp;interoperability&nbsp;is&nbsp;sufficiently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4416119">//&nbsp;important&nbsp;that&nbsp;we&nbsp;mirror&nbsp;this.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416154">CRTValues</span>&nbsp;<span class="op" id="4416164">[</span><span class="op" id="4416165">]</span><span class="ident" id="4416166"><a href="/crypto/rsa/rsa.go.html#4416254">CRTValue</a></span><br>
<span class="lineno"></span><span class="op" id="4416175">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="4416178">//&nbsp;CRTValue&nbsp;contains&nbsp;the&nbsp;precomputed&nbsp;chinese&nbsp;remainder&nbsp;theorem&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4416249">type</span>&nbsp;<span class="ident" id="4416254">CRTValue</span>&nbsp;<span class="keyword" id="4416263">struct</span>&nbsp;<span class="op" id="4416270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416273">Exp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4416279">*</span><span class="ident" id="4416280"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4416283">.</span><span class="ident" id="4416284">Int</span>&nbsp;<span class="comment" id="4416288">//&nbsp;D&nbsp;mod&nbsp;(prime-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416309">Coeff</span>&nbsp;<span class="op" id="4416315">*</span><span class="ident" id="4416316"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4416319">.</span><span class="ident" id="4416320">Int</span>&nbsp;<span class="comment" id="4416324">//&nbsp;R·Coeff&nbsp;≡&nbsp;1&nbsp;mod&nbsp;Prime.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4416354">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4416360">*</span><span class="ident" id="4416361"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4416364">.</span><span class="ident" id="4416365">Int</span>&nbsp;<span class="comment" id="4416369">//&nbsp;product&nbsp;of&nbsp;primes&nbsp;prior&nbsp;to&nbsp;this&nbsp;(inc&nbsp;p&nbsp;and&nbsp;q).</span><br>
<span class="lineno"></span><span class="op" id="4416419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4416422">//&nbsp;Validate&nbsp;performs&nbsp;basic&nbsp;sanity&nbsp;checks&nbsp;on&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4416475">//&nbsp;It&nbsp;returns&nbsp;nil&nbsp;if&nbsp;the&nbsp;key&nbsp;is&nbsp;valid,&nbsp;or&nbsp;else&nbsp;an&nbsp;error&nbsp;describing&nbsp;a&nbsp;problem.</span><br>
<span class="lineno">100</span><span class="keyword" id="4416553">func</span>&nbsp;<span class="op" id="4416558">(</span><span class="ident" id="4416559">priv</span>&nbsp;<span class="op" id="4416564">*</span><span class="ident" id="4416565"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4416575">)</span>&nbsp;<span class="ident" id="4416577">Validate</span><span class="op" id="4416585">(</span><span class="op" id="4416586">)</span>&nbsp;<span class="builtintype" id="4416588">error</span>&nbsp;<span class="op" id="4416594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416597">if</span>&nbsp;<span class="ident" id="4416600">err</span>&nbsp;<span class="op" id="4416604">:=</span>&nbsp;<span class="ident" id="4416607"><a href="/crypto/rsa/rsa.go.html#4414536">checkPub</a></span><span class="op" id="4416615">(</span><span class="op" id="4416616">&amp;</span><span class="ident" id="4416617"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4416621">.</span><span class="ident" id="4416622">PublicKey</span><span class="op" id="4416631">)</span><span class="op" id="4416632">;</span>&nbsp;<span class="ident" id="4416634"><a href="/crypto/rsa/rsa.go.html#4416600">err</a></span>&nbsp;<span class="op" id="4416638">!=</span>&nbsp;<span class="ident" id="4416641">nil</span>&nbsp;<span class="op" id="4416645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416649">return</span>&nbsp;<span class="ident" id="4416656"><a href="/crypto/rsa/rsa.go.html#4416600">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4416661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4416665">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;prime&nbsp;factors&nbsp;are&nbsp;actually&nbsp;prime.&nbsp;Note&nbsp;that&nbsp;this&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4416736">//&nbsp;just&nbsp;a&nbsp;sanity&nbsp;check.&nbsp;Since&nbsp;the&nbsp;random&nbsp;witnesses&nbsp;chosen&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4416798">//&nbsp;ProbablyPrime&nbsp;are&nbsp;deterministic,&nbsp;given&nbsp;the&nbsp;candidate&nbsp;number,&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4416868">//&nbsp;easy&nbsp;for&nbsp;an&nbsp;attack&nbsp;to&nbsp;generate&nbsp;composites&nbsp;that&nbsp;pass&nbsp;this&nbsp;test.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416935">for</span>&nbsp;<span class="ident" id="4416939">_</span><span class="op" id="4416940">,</span>&nbsp;<span class="ident" id="4416942">prime</span>&nbsp;<span class="op" id="4416948">:=</span>&nbsp;<span class="keyword" id="4416951">range</span>&nbsp;<span class="ident" id="4416957"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4416961">.</span><span class="ident" id="4416962">Primes</span>&nbsp;<span class="op" id="4416969">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4416973">if</span>&nbsp;<span class="op" id="4416976">!</span><span class="ident" id="4416977"><a href="/crypto/rsa/rsa.go.html#4416942">prime</a></span><span class="op" id="4416982">.</span><span class="ident" id="4416983">ProbablyPrime</span><span class="op" id="4416996">(</span><span class="num" id="4416997">20</span><span class="op" id="4416999">)</span>&nbsp;<span class="op" id="4417001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417006">return</span>&nbsp;<span class="ident" id="4417013"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4417019">.</span><span class="ident" id="4417020">New</span><span class="op" id="4417023">(</span><span class="string" id="4417024">&#34;crypto/rsa:&nbsp;prime&nbsp;factor&nbsp;is&nbsp;composite&#34;</span><span class="op" id="4417063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417070">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417074">//&nbsp;Check&nbsp;that&nbsp;Πprimes&nbsp;==&nbsp;n.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417104">modulus</span>&nbsp;<span class="op" id="4417112">:=</span>&nbsp;<span class="builtinfunc" id="4417115">new</span><span class="op" id="4417118">(</span><span class="ident" id="4417119"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4417122">.</span><span class="ident" id="4417123">Int</span><span class="op" id="4417126">)</span><span class="op" id="4417127">.</span><span class="ident" id="4417128">Set</span><span class="op" id="4417131">(</span><span class="ident" id="4417132"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4417138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417141">for</span>&nbsp;<span class="ident" id="4417145">_</span><span class="op" id="4417146">,</span>&nbsp;<span class="ident" id="4417148">prime</span>&nbsp;<span class="op" id="4417154">:=</span>&nbsp;<span class="keyword" id="4417157">range</span>&nbsp;<span class="ident" id="4417163"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4417167">.</span><span class="ident" id="4417168">Primes</span>&nbsp;<span class="op" id="4417175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417179"><a href="/crypto/rsa/rsa.go.html#4417104">modulus</a></span><span class="op" id="4417186">.</span><span class="ident" id="4417187">Mul</span><span class="op" id="4417190">(</span><span class="ident" id="4417191"><a href="/crypto/rsa/rsa.go.html#4417104">modulus</a></span><span class="op" id="4417198">,</span>&nbsp;<span class="ident" id="4417200"><a href="/crypto/rsa/rsa.go.html#4417148">prime</a></span><span class="op" id="4417205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417208">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417211">if</span>&nbsp;<span class="ident" id="4417214"><a href="/crypto/rsa/rsa.go.html#4417104">modulus</a></span><span class="op" id="4417221">.</span><span class="ident" id="4417222">Cmp</span><span class="op" id="4417225">(</span><span class="ident" id="4417226"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4417230">.</span><span class="ident" id="4417231">N</span><span class="op" id="4417232">)</span>&nbsp;<span class="op" id="4417234">!=</span>&nbsp;<span class="num" id="4417237">0</span>&nbsp;<span class="op" id="4417239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417243">return</span>&nbsp;<span class="ident" id="4417250"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4417256">.</span><span class="ident" id="4417257">New</span><span class="op" id="4417260">(</span><span class="string" id="4417261">&#34;crypto/rsa:&nbsp;invalid&nbsp;modulus&#34;</span><span class="op" id="4417290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417297">//&nbsp;Check&nbsp;that&nbsp;de&nbsp;≡&nbsp;1&nbsp;mod&nbsp;p-1,&nbsp;for&nbsp;each&nbsp;prime.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417346">//&nbsp;This&nbsp;implies&nbsp;that&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;each&nbsp;p-1&nbsp;as&nbsp;e&nbsp;has&nbsp;a&nbsp;multiplicative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417419">//&nbsp;inverse.&nbsp;Therefore&nbsp;e&nbsp;is&nbsp;coprime&nbsp;to&nbsp;lcm(p-1,q-1,r-1,...)&nbsp;=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417481">//&nbsp;exponent(ℤ/nℤ).&nbsp;It&nbsp;also&nbsp;implies&nbsp;that&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;p&nbsp;as&nbsp;a^(p-1)&nbsp;≡&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4417560">//&nbsp;mod&nbsp;p.&nbsp;Thus&nbsp;a^de&nbsp;≡&nbsp;a&nbsp;mod&nbsp;n&nbsp;for&nbsp;all&nbsp;a&nbsp;coprime&nbsp;to&nbsp;n,&nbsp;as&nbsp;required.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417630">congruence</span>&nbsp;<span class="op" id="4417641">:=</span>&nbsp;<span class="builtinfunc" id="4417644">new</span><span class="op" id="4417647">(</span><span class="ident" id="4417648"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4417651">.</span><span class="ident" id="4417652">Int</span><span class="op" id="4417655">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417658">de</span>&nbsp;<span class="op" id="4417661">:=</span>&nbsp;<span class="builtinfunc" id="4417664">new</span><span class="op" id="4417667">(</span><span class="ident" id="4417668"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4417671">.</span><span class="ident" id="4417672">Int</span><span class="op" id="4417675">)</span><span class="op" id="4417676">.</span><span class="ident" id="4417677">SetInt64</span><span class="op" id="4417685">(</span><span class="ident" id="4417686">int64</span><span class="op" id="4417691">(</span><span class="ident" id="4417692"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4417696">.</span><span class="ident" id="4417697">E</span><span class="op" id="4417698">)</span><span class="op" id="4417699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417702"><a href="/crypto/rsa/rsa.go.html#4417658">de</a></span><span class="op" id="4417704">.</span><span class="ident" id="4417705">Mul</span><span class="op" id="4417708">(</span><span class="ident" id="4417709"><a href="/crypto/rsa/rsa.go.html#4417658">de</a></span><span class="op" id="4417711">,</span>&nbsp;<span class="ident" id="4417713"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4417717">.</span><span class="ident" id="4417718">D</span><span class="op" id="4417719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417722">for</span>&nbsp;<span class="ident" id="4417726">_</span><span class="op" id="4417727">,</span>&nbsp;<span class="ident" id="4417729">prime</span>&nbsp;<span class="op" id="4417735">:=</span>&nbsp;<span class="keyword" id="4417738">range</span>&nbsp;<span class="ident" id="4417744"><a href="/crypto/rsa/rsa.go.html#4416559">priv</a></span><span class="op" id="4417748">.</span><span class="ident" id="4417749">Primes</span>&nbsp;<span class="op" id="4417756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417760">pminus1</span>&nbsp;<span class="op" id="4417768">:=</span>&nbsp;<span class="builtinfunc" id="4417771">new</span><span class="op" id="4417774">(</span><span class="ident" id="4417775"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4417778">.</span><span class="ident" id="4417779">Int</span><span class="op" id="4417782">)</span><span class="op" id="4417783">.</span><span class="ident" id="4417784">Sub</span><span class="op" id="4417787">(</span><span class="ident" id="4417788"><a href="/crypto/rsa/rsa.go.html#4417729">prime</a></span><span class="op" id="4417793">,</span>&nbsp;<span class="ident" id="4417795"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4417801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4417805"><a href="/crypto/rsa/rsa.go.html#4417630">congruence</a></span><span class="op" id="4417815">.</span><span class="ident" id="4417816">Mod</span><span class="op" id="4417819">(</span><span class="ident" id="4417820"><a href="/crypto/rsa/rsa.go.html#4417658">de</a></span><span class="op" id="4417822">,</span>&nbsp;<span class="ident" id="4417824"><a href="/crypto/rsa/rsa.go.html#4417760">pminus1</a></span><span class="op" id="4417831">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417835">if</span>&nbsp;<span class="ident" id="4417838"><a href="/crypto/rsa/rsa.go.html#4417630">congruence</a></span><span class="op" id="4417848">.</span><span class="ident" id="4417849">Cmp</span><span class="op" id="4417852">(</span><span class="ident" id="4417853"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4417859">)</span>&nbsp;<span class="op" id="4417861">!=</span>&nbsp;<span class="num" id="4417864">0</span>&nbsp;<span class="op" id="4417866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417871">return</span>&nbsp;<span class="ident" id="4417878"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4417884">.</span><span class="ident" id="4417885">New</span><span class="op" id="4417888">(</span><span class="string" id="4417889">&#34;crypto/rsa:&nbsp;invalid&nbsp;exponents&#34;</span><span class="op" id="4417920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4417927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4417930">return</span>&nbsp;<span class="ident" id="4417937">nil</span><br>
<span class="lineno">140</span><span class="op" id="4417941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4417944">//&nbsp;GenerateKey&nbsp;generates&nbsp;an&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit&nbsp;size&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4418016">//&nbsp;random&nbsp;source&nbsp;random&nbsp;(for&nbsp;example,&nbsp;crypto/rand.Reader).</span><br>
<span class="lineno"></span><span class="keyword" id="4418075">func</span>&nbsp;<span class="ident" id="4418080">GenerateKey</span><span class="op" id="4418091">(</span><span class="ident" id="4418092">random</span>&nbsp;<span class="ident" id="4418099"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4418101">.</span><span class="ident" id="4418102">Reader</span><span class="op" id="4418108">,</span>&nbsp;<span class="ident" id="4418110">bits</span>&nbsp;<span class="builtintype" id="4418115">int</span><span class="op" id="4418118">)</span>&nbsp;<span class="op" id="4418120">(</span><span class="ident" id="4418121">priv</span>&nbsp;<span class="op" id="4418126">*</span><span class="ident" id="4418127"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4418137">,</span>&nbsp;<span class="ident" id="4418139">err</span>&nbsp;<span class="builtintype" id="4418143">error</span><span class="op" id="4418148">)</span>&nbsp;<span class="op" id="4418150">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4418153">return</span>&nbsp;<span class="ident" id="4418160"><a href="/crypto/rsa/rsa.go.html#4418796">GenerateMultiPrimeKey</a></span><span class="op" id="4418181">(</span><span class="ident" id="4418182"><a href="/crypto/rsa/rsa.go.html#4418092">random</a></span><span class="op" id="4418188">,</span>&nbsp;<span class="num" id="4418190">2</span><span class="op" id="4418191">,</span>&nbsp;<span class="ident" id="4418193"><a href="/crypto/rsa/rsa.go.html#4418110">bits</a></span><span class="op" id="4418197">)</span><br>
<span class="lineno"></span><span class="op" id="4418199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4418202">//&nbsp;GenerateMultiPrimeKey&nbsp;generates&nbsp;a&nbsp;multi-prime&nbsp;RSA&nbsp;keypair&nbsp;of&nbsp;the&nbsp;given&nbsp;bit</span><br>
<span class="lineno"></span><span class="comment" id="4418280">//&nbsp;size&nbsp;and&nbsp;the&nbsp;given&nbsp;random&nbsp;source,&nbsp;as&nbsp;suggested&nbsp;in&nbsp;[1].&nbsp;Although&nbsp;the&nbsp;public</span><br>
<span class="lineno">150</span><span class="comment" id="4418358">//&nbsp;keys&nbsp;are&nbsp;compatible&nbsp;(actually,&nbsp;indistinguishable)&nbsp;from&nbsp;the&nbsp;2-prime&nbsp;case,</span><br>
<span class="lineno"></span><span class="comment" id="4418434">//&nbsp;the&nbsp;private&nbsp;keys&nbsp;are&nbsp;not.&nbsp;Thus&nbsp;it&nbsp;may&nbsp;not&nbsp;be&nbsp;possible&nbsp;to&nbsp;export&nbsp;multi-prime</span><br>
<span class="lineno"></span><span class="comment" id="4418513">//&nbsp;private&nbsp;keys&nbsp;in&nbsp;certain&nbsp;formats&nbsp;or&nbsp;to&nbsp;subsequently&nbsp;import&nbsp;them&nbsp;into&nbsp;other</span><br>
<span class="lineno"></span><span class="comment" id="4418590">//&nbsp;code.</span><br>
<span class="lineno"></span><span class="comment" id="4418599">//</span><br>
<span class="lineno">155</span><span class="comment" id="4418602">//&nbsp;Table&nbsp;1&nbsp;in&nbsp;[2]&nbsp;suggests&nbsp;maximum&nbsp;numbers&nbsp;of&nbsp;primes&nbsp;for&nbsp;a&nbsp;given&nbsp;size.</span><br>
<span class="lineno"></span><span class="comment" id="4418673">//</span><br>
<span class="lineno"></span><span class="comment" id="4418676">//&nbsp;[1]&nbsp;US&nbsp;patent&nbsp;4405829&nbsp;(1972,&nbsp;expired)</span><br>
<span class="lineno"></span><span class="comment" id="4418717">//&nbsp;[2]&nbsp;http://www.cacr.math.uwaterloo.ca/techreports/2006/cacr2006-16.pdf</span><br>
<span class="lineno"></span><span class="keyword" id="4418791">func</span>&nbsp;<span class="ident" id="4418796">GenerateMultiPrimeKey</span><span class="op" id="4418817">(</span><span class="ident" id="4418818">random</span>&nbsp;<span class="ident" id="4418825"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4418827">.</span><span class="ident" id="4418828">Reader</span><span class="op" id="4418834">,</span>&nbsp;<span class="ident" id="4418836">nprimes</span>&nbsp;<span class="builtintype" id="4418844">int</span><span class="op" id="4418847">,</span>&nbsp;<span class="ident" id="4418849">bits</span>&nbsp;<span class="builtintype" id="4418854">int</span><span class="op" id="4418857">)</span>&nbsp;<span class="op" id="4418859">(</span><span class="ident" id="4418860">priv</span>&nbsp;<span class="op" id="4418865">*</span><span class="ident" id="4418866"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4418876">,</span>&nbsp;<span class="ident" id="4418878">err</span>&nbsp;<span class="builtintype" id="4418882">error</span><span class="op" id="4418887">)</span>&nbsp;<span class="op" id="4418889">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418892"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span>&nbsp;<span class="op" id="4418897">=</span>&nbsp;<span class="builtinfunc" id="4418899">new</span><span class="op" id="4418902">(</span><span class="ident" id="4418903"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4418913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4418916"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4418920">.</span><span class="ident" id="4418921">E</span>&nbsp;<span class="op" id="4418923">=</span>&nbsp;<span class="num" id="4418925">65537</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4418933">if</span>&nbsp;<span class="ident" id="4418936"><a href="/crypto/rsa/rsa.go.html#4418836">nprimes</a></span>&nbsp;<span class="op" id="4418944">&lt;</span>&nbsp;<span class="num" id="4418946">2</span>&nbsp;<span class="op" id="4418948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4418952">return</span>&nbsp;<span class="ident" id="4418959">nil</span><span class="op" id="4418962">,</span>&nbsp;<span class="ident" id="4418964"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4418970">.</span><span class="ident" id="4418971">New</span><span class="op" id="4418974">(</span><span class="string" id="4418975">&#34;crypto/rsa:&nbsp;GenerateMultiPrimeKey:&nbsp;nprimes&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&#34;</span><span class="op" id="4419032">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419039">primes</span>&nbsp;<span class="op" id="4419046">:=</span>&nbsp;<span class="builtinfunc" id="4419049">make</span><span class="op" id="4419053">(</span><span class="op" id="4419054">[</span><span class="op" id="4419055">]</span><span class="op" id="4419056">*</span><span class="ident" id="4419057"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4419060">.</span><span class="ident" id="4419061">Int</span><span class="op" id="4419064">,</span>&nbsp;<span class="ident" id="4419066"><a href="/crypto/rsa/rsa.go.html#4418836">nprimes</a></span><span class="op" id="4419073">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="4419076">NextSetOfPrimes</span><span class="op" id="4419091">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419094">for</span>&nbsp;<span class="op" id="4419098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419102">todo</span>&nbsp;<span class="op" id="4419107">:=</span>&nbsp;<span class="ident" id="4419110"><a href="/crypto/rsa/rsa.go.html#4418849">bits</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419117">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419177">//&nbsp;Thus&nbsp;each&nbsp;prime&nbsp;has&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419211">//&nbsp;&nbsp;&nbsp;p_i&nbsp;=&nbsp;2^bitlen(p_i)&nbsp;×&nbsp;0.11...&nbsp;(in&nbsp;base&nbsp;2).</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419262">//&nbsp;And&nbsp;the&nbsp;product&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419287">//&nbsp;&nbsp;&nbsp;P&nbsp;=&nbsp;2^todo&nbsp;×&nbsp;α</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419311">//&nbsp;where&nbsp;α&nbsp;is&nbsp;the&nbsp;product&nbsp;of&nbsp;nprimes&nbsp;numbers&nbsp;of&nbsp;the&nbsp;form&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419379">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419384">//&nbsp;If&nbsp;α&nbsp;&lt;&nbsp;1/2&nbsp;(which&nbsp;can&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;&gt;&nbsp;2),&nbsp;we&nbsp;need&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419448">//&nbsp;shift&nbsp;todo&nbsp;to&nbsp;compensate&nbsp;for&nbsp;lost&nbsp;bits:&nbsp;the&nbsp;mean&nbsp;value&nbsp;of&nbsp;0.11...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419519">//&nbsp;is&nbsp;7/8,&nbsp;so&nbsp;todo&nbsp;+&nbsp;shift&nbsp;-&nbsp;nprimes&nbsp;*&nbsp;log2(7/8)&nbsp;~=&nbsp;bits&nbsp;-&nbsp;1/2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419584">//&nbsp;will&nbsp;give&nbsp;good&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419613">if</span>&nbsp;<span class="ident" id="4419616"><a href="/crypto/rsa/rsa.go.html#4418836">nprimes</a></span>&nbsp;<span class="op" id="4419624">&gt;=</span>&nbsp;<span class="num" id="4419627">7</span>&nbsp;<span class="op" id="4419629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419634"><a href="/crypto/rsa/rsa.go.html#4419102">todo</a></span>&nbsp;<span class="op" id="4419639">+=</span>&nbsp;<span class="op" id="4419642">(</span><span class="ident" id="4419643"><a href="/crypto/rsa/rsa.go.html#4418836">nprimes</a></span>&nbsp;<span class="op" id="4419651">-</span>&nbsp;<span class="num" id="4419653">2</span><span class="op" id="4419654">)</span>&nbsp;<span class="op" id="4419656">/</span>&nbsp;<span class="num" id="4419658">5</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419666">for</span>&nbsp;<span class="ident" id="4419670">i</span>&nbsp;<span class="op" id="4419672">:=</span>&nbsp;<span class="num" id="4419675">0</span><span class="op" id="4419676">;</span>&nbsp;<span class="ident" id="4419678"><a href="/crypto/rsa/rsa.go.html#4419670">i</a></span>&nbsp;<span class="op" id="4419680">&lt;</span>&nbsp;<span class="ident" id="4419682"><a href="/crypto/rsa/rsa.go.html#4418836">nprimes</a></span><span class="op" id="4419689">;</span>&nbsp;<span class="ident" id="4419691"><a href="/crypto/rsa/rsa.go.html#4419670">i</a></span><span class="op" id="4419692">++</span>&nbsp;<span class="op" id="4419695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419700"><a href="/crypto/rsa/rsa.go.html#4419039">primes</a></span><span class="op" id="4419706">[</span><span class="ident" id="4419707"><a href="/crypto/rsa/rsa.go.html#4419670">i</a></span><span class="op" id="4419708">]</span><span class="op" id="4419709">,</span>&nbsp;<span class="ident" id="4419711"><a href="/crypto/rsa/rsa.go.html#4418878">err</a></span>&nbsp;<span class="op" id="4419715">=</span>&nbsp;<span class="ident" id="4419717"><a href="/crypto/rsa/rsa.go.html#4413764">rand</a></span><span class="op" id="4419721">.</span><span class="ident" id="4419722">Prime</span><span class="op" id="4419727">(</span><span class="ident" id="4419728"><a href="/crypto/rsa/rsa.go.html#4418818">random</a></span><span class="op" id="4419734">,</span>&nbsp;<span class="ident" id="4419736"><a href="/crypto/rsa/rsa.go.html#4419102">todo</a></span><span class="op" id="4419740">/</span><span class="op" id="4419741">(</span><span class="ident" id="4419742"><a href="/crypto/rsa/rsa.go.html#4418836">nprimes</a></span><span class="op" id="4419749">-</span><span class="ident" id="4419750"><a href="/crypto/rsa/rsa.go.html#4419670">i</a></span><span class="op" id="4419751">)</span><span class="op" id="4419752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419757">if</span>&nbsp;<span class="ident" id="4419760"><a href="/crypto/rsa/rsa.go.html#4418878">err</a></span>&nbsp;<span class="op" id="4419764">!=</span>&nbsp;<span class="ident" id="4419767">nil</span>&nbsp;<span class="op" id="4419771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419777">return</span>&nbsp;<span class="ident" id="4419784">nil</span><span class="op" id="4419787">,</span>&nbsp;<span class="ident" id="4419789"><a href="/crypto/rsa/rsa.go.html#4418878">err</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4419801"><a href="/crypto/rsa/rsa.go.html#4419102">todo</a></span>&nbsp;<span class="op" id="4419806">-=</span>&nbsp;<span class="ident" id="4419809"><a href="/crypto/rsa/rsa.go.html#4419039">primes</a></span><span class="op" id="4419815">[</span><span class="ident" id="4419816"><a href="/crypto/rsa/rsa.go.html#4419670">i</a></span><span class="op" id="4419817">]</span><span class="op" id="4419818">.</span><span class="ident" id="4419819">BitLen</span><span class="op" id="4419825">(</span><span class="op" id="4419826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4419830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4419835">//&nbsp;Make&nbsp;sure&nbsp;that&nbsp;primes&nbsp;is&nbsp;pairwise&nbsp;unequal.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419883">for</span>&nbsp;<span class="ident" id="4419887">i</span><span class="op" id="4419888">,</span>&nbsp;<span class="ident" id="4419890">prime</span>&nbsp;<span class="op" id="4419896">:=</span>&nbsp;<span class="keyword" id="4419899">range</span>&nbsp;<span class="ident" id="4419905"><a href="/crypto/rsa/rsa.go.html#4419039">primes</a></span>&nbsp;<span class="op" id="4419912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419917">for</span>&nbsp;<span class="ident" id="4419921">j</span>&nbsp;<span class="op" id="4419923">:=</span>&nbsp;<span class="num" id="4419926">0</span><span class="op" id="4419927">;</span>&nbsp;<span class="ident" id="4419929"><a href="/crypto/rsa/rsa.go.html#4419921">j</a></span>&nbsp;<span class="op" id="4419931">&lt;</span>&nbsp;<span class="ident" id="4419933"><a href="/crypto/rsa/rsa.go.html#4419887">i</a></span><span class="op" id="4419934">;</span>&nbsp;<span class="ident" id="4419936"><a href="/crypto/rsa/rsa.go.html#4419921">j</a></span><span class="op" id="4419937">++</span>&nbsp;<span class="op" id="4419940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419946">if</span>&nbsp;<span class="ident" id="4419949"><a href="/crypto/rsa/rsa.go.html#4419890">prime</a></span><span class="op" id="4419954">.</span><span class="ident" id="4419955">Cmp</span><span class="op" id="4419958">(</span><span class="ident" id="4419959"><a href="/crypto/rsa/rsa.go.html#4419039">primes</a></span><span class="op" id="4419965">[</span><span class="ident" id="4419966"><a href="/crypto/rsa/rsa.go.html#4419921">j</a></span><span class="op" id="4419967">]</span><span class="op" id="4419968">)</span>&nbsp;<span class="op" id="4419970">==</span>&nbsp;<span class="num" id="4419973">0</span>&nbsp;<span class="op" id="4419975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4419982">continue</span>&nbsp;<span class="ident" id="4419991">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420011">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420025">n</span>&nbsp;<span class="op" id="4420027">:=</span>&nbsp;<span class="builtinfunc" id="4420030">new</span><span class="op" id="4420033">(</span><span class="ident" id="4420034"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420037">.</span><span class="ident" id="4420038">Int</span><span class="op" id="4420041">)</span><span class="op" id="4420042">.</span><span class="ident" id="4420043">Set</span><span class="op" id="4420046">(</span><span class="ident" id="4420047"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4420053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420057">totient</span>&nbsp;<span class="op" id="4420065">:=</span>&nbsp;<span class="builtinfunc" id="4420068">new</span><span class="op" id="4420071">(</span><span class="ident" id="4420072"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420075">.</span><span class="ident" id="4420076">Int</span><span class="op" id="4420079">)</span><span class="op" id="4420080">.</span><span class="ident" id="4420081">Set</span><span class="op" id="4420084">(</span><span class="ident" id="4420085"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4420091">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420095">pminus1</span>&nbsp;<span class="op" id="4420103">:=</span>&nbsp;<span class="builtinfunc" id="4420106">new</span><span class="op" id="4420109">(</span><span class="ident" id="4420110"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420113">.</span><span class="ident" id="4420114">Int</span><span class="op" id="4420117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420121">for</span>&nbsp;<span class="ident" id="4420125">_</span><span class="op" id="4420126">,</span>&nbsp;<span class="ident" id="4420128">prime</span>&nbsp;<span class="op" id="4420134">:=</span>&nbsp;<span class="keyword" id="4420137">range</span>&nbsp;<span class="ident" id="4420143"><a href="/crypto/rsa/rsa.go.html#4419039">primes</a></span>&nbsp;<span class="op" id="4420150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420155"><a href="/crypto/rsa/rsa.go.html#4420025">n</a></span><span class="op" id="4420156">.</span><span class="ident" id="4420157">Mul</span><span class="op" id="4420160">(</span><span class="ident" id="4420161"><a href="/crypto/rsa/rsa.go.html#4420025">n</a></span><span class="op" id="4420162">,</span>&nbsp;<span class="ident" id="4420164"><a href="/crypto/rsa/rsa.go.html#4420128">prime</a></span><span class="op" id="4420169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420174"><a href="/crypto/rsa/rsa.go.html#4420095">pminus1</a></span><span class="op" id="4420181">.</span><span class="ident" id="4420182">Sub</span><span class="op" id="4420185">(</span><span class="ident" id="4420186"><a href="/crypto/rsa/rsa.go.html#4420128">prime</a></span><span class="op" id="4420191">,</span>&nbsp;<span class="ident" id="4420193"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4420199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420204"><a href="/crypto/rsa/rsa.go.html#4420057">totient</a></span><span class="op" id="4420211">.</span><span class="ident" id="4420212">Mul</span><span class="op" id="4420215">(</span><span class="ident" id="4420216"><a href="/crypto/rsa/rsa.go.html#4420057">totient</a></span><span class="op" id="4420223">,</span>&nbsp;<span class="ident" id="4420225"><a href="/crypto/rsa/rsa.go.html#4420095">pminus1</a></span><span class="op" id="4420232">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420240">if</span>&nbsp;<span class="ident" id="4420243"><a href="/crypto/rsa/rsa.go.html#4420025">n</a></span><span class="op" id="4420244">.</span><span class="ident" id="4420245">BitLen</span><span class="op" id="4420251">(</span><span class="op" id="4420252">)</span>&nbsp;<span class="op" id="4420254">!=</span>&nbsp;<span class="ident" id="4420257"><a href="/crypto/rsa/rsa.go.html#4418849">bits</a></span>&nbsp;<span class="op" id="4420262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420267">//&nbsp;This&nbsp;should&nbsp;never&nbsp;happen&nbsp;for&nbsp;nprimes&nbsp;==&nbsp;2&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420323">//&nbsp;crypto/rand&nbsp;should&nbsp;set&nbsp;the&nbsp;top&nbsp;two&nbsp;bits&nbsp;in&nbsp;each&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4420384">//&nbsp;For&nbsp;nprimes&nbsp;&gt;&nbsp;2&nbsp;we&nbsp;hope&nbsp;it&nbsp;does&nbsp;not&nbsp;happen&nbsp;often.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420440">continue</span>&nbsp;<span class="ident" id="4420449">NextSetOfPrimes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420472">g</span>&nbsp;<span class="op" id="4420474">:=</span>&nbsp;<span class="builtinfunc" id="4420477">new</span><span class="op" id="4420480">(</span><span class="ident" id="4420481"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420484">.</span><span class="ident" id="4420485">Int</span><span class="op" id="4420488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420492"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420496">.</span><span class="ident" id="4420497">D</span>&nbsp;<span class="op" id="4420499">=</span>&nbsp;<span class="builtinfunc" id="4420501">new</span><span class="op" id="4420504">(</span><span class="ident" id="4420505"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420508">.</span><span class="ident" id="4420509">Int</span><span class="op" id="4420512">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420516">y</span>&nbsp;<span class="op" id="4420518">:=</span>&nbsp;<span class="builtinfunc" id="4420521">new</span><span class="op" id="4420524">(</span><span class="ident" id="4420525"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420528">.</span><span class="ident" id="4420529">Int</span><span class="op" id="4420532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420536">e</span>&nbsp;<span class="op" id="4420538">:=</span>&nbsp;<span class="ident" id="4420541"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4420544">.</span><span class="ident" id="4420545">NewInt</span><span class="op" id="4420551">(</span><span class="ident" id="4420552">int64</span><span class="op" id="4420557">(</span><span class="ident" id="4420558"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420562">.</span><span class="ident" id="4420563">E</span><span class="op" id="4420564">)</span><span class="op" id="4420565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420569"><a href="/crypto/rsa/rsa.go.html#4420472">g</a></span><span class="op" id="4420570">.</span><span class="ident" id="4420571">GCD</span><span class="op" id="4420574">(</span><span class="ident" id="4420575"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420579">.</span><span class="ident" id="4420580">D</span><span class="op" id="4420581">,</span>&nbsp;<span class="ident" id="4420583"><a href="/crypto/rsa/rsa.go.html#4420516">y</a></span><span class="op" id="4420584">,</span>&nbsp;<span class="ident" id="4420586"><a href="/crypto/rsa/rsa.go.html#4420536">e</a></span><span class="op" id="4420587">,</span>&nbsp;<span class="ident" id="4420589"><a href="/crypto/rsa/rsa.go.html#4420057">totient</a></span><span class="op" id="4420596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420601">if</span>&nbsp;<span class="ident" id="4420604"><a href="/crypto/rsa/rsa.go.html#4420472">g</a></span><span class="op" id="4420605">.</span><span class="ident" id="4420606">Cmp</span><span class="op" id="4420609">(</span><span class="ident" id="4420610"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4420616">)</span>&nbsp;<span class="op" id="4420618">==</span>&nbsp;<span class="num" id="4420621">0</span>&nbsp;<span class="op" id="4420623">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420628">if</span>&nbsp;<span class="ident" id="4420631"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420635">.</span><span class="ident" id="4420636">D</span><span class="op" id="4420637">.</span><span class="ident" id="4420638">Sign</span><span class="op" id="4420642">(</span><span class="op" id="4420643">)</span>&nbsp;<span class="op" id="4420645">&lt;</span>&nbsp;<span class="num" id="4420647">0</span>&nbsp;<span class="op" id="4420649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420655"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420659">.</span><span class="ident" id="4420660">D</span><span class="op" id="4420661">.</span><span class="ident" id="4420662">Add</span><span class="op" id="4420665">(</span><span class="ident" id="4420666"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420670">.</span><span class="ident" id="4420671">D</span><span class="op" id="4420672">,</span>&nbsp;<span class="ident" id="4420674"><a href="/crypto/rsa/rsa.go.html#4420057">totient</a></span><span class="op" id="4420681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420691"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420695">.</span><span class="ident" id="4420696">Primes</span>&nbsp;<span class="op" id="4420703">=</span>&nbsp;<span class="ident" id="4420705"><a href="/crypto/rsa/rsa.go.html#4419039">primes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420715"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420719">.</span><span class="ident" id="4420720">N</span>&nbsp;<span class="op" id="4420722">=</span>&nbsp;<span class="ident" id="4420724"><a href="/crypto/rsa/rsa.go.html#4420025">n</a></span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420730">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420745"><a href="/crypto/rsa/rsa.go.html#4418860">priv</a></span><span class="op" id="4420749">.</span><span class="ident" id="4420750">Precompute</span><span class="op" id="4420760">(</span><span class="op" id="4420761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420764">return</span><br>
<span class="lineno"></span><span class="op" id="4420771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4420774">//&nbsp;incCounter&nbsp;increments&nbsp;a&nbsp;four&nbsp;byte,&nbsp;big-endian&nbsp;counter.</span><br>
<span class="lineno">240</span><span class="keyword" id="4420832">func</span>&nbsp;<span class="ident" id="4420837">incCounter</span><span class="op" id="4420847">(</span><span class="ident" id="4420848">c</span>&nbsp;<span class="op" id="4420850">*</span><span class="op" id="4420851">[</span><span class="num" id="4420852">4</span><span class="op" id="4420853">]</span><span class="builtintype" id="4420854">byte</span><span class="op" id="4420858">)</span>&nbsp;<span class="op" id="4420860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420863">if</span>&nbsp;<span class="ident" id="4420866"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420867">[</span><span class="num" id="4420868">3</span><span class="op" id="4420869">]</span><span class="op" id="4420870">++</span><span class="op" id="4420872">;</span>&nbsp;<span class="ident" id="4420874"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420875">[</span><span class="num" id="4420876">3</span><span class="op" id="4420877">]</span>&nbsp;<span class="op" id="4420879">!=</span>&nbsp;<span class="num" id="4420882">0</span>&nbsp;<span class="op" id="4420884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420888">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420899">if</span>&nbsp;<span class="ident" id="4420902"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420903">[</span><span class="num" id="4420904">2</span><span class="op" id="4420905">]</span><span class="op" id="4420906">++</span><span class="op" id="4420908">;</span>&nbsp;<span class="ident" id="4420910"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420911">[</span><span class="num" id="4420912">2</span><span class="op" id="4420913">]</span>&nbsp;<span class="op" id="4420915">!=</span>&nbsp;<span class="num" id="4420918">0</span>&nbsp;<span class="op" id="4420920">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420924">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420935">if</span>&nbsp;<span class="ident" id="4420938"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420939">[</span><span class="num" id="4420940">1</span><span class="op" id="4420941">]</span><span class="op" id="4420942">++</span><span class="op" id="4420944">;</span>&nbsp;<span class="ident" id="4420946"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420947">[</span><span class="num" id="4420948">1</span><span class="op" id="4420949">]</span>&nbsp;<span class="op" id="4420951">!=</span>&nbsp;<span class="num" id="4420954">0</span>&nbsp;<span class="op" id="4420956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4420960">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4420968">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4420971"><a href="/crypto/rsa/rsa.go.html#4420848">c</a></span><span class="op" id="4420972">[</span><span class="num" id="4420973">0</span><span class="op" id="4420974">]</span><span class="op" id="4420975">++</span><br>
<span class="lineno"></span><span class="op" id="4420978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4420981">//&nbsp;mgf1XOR&nbsp;XORs&nbsp;the&nbsp;bytes&nbsp;in&nbsp;out&nbsp;with&nbsp;a&nbsp;mask&nbsp;generated&nbsp;using&nbsp;the&nbsp;MGF1&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4421060">//&nbsp;specified&nbsp;in&nbsp;PKCS#1&nbsp;v2.1.</span><br>
<span class="lineno">255</span><span class="keyword" id="4421089">func</span>&nbsp;<span class="ident" id="4421094">mgf1XOR</span><span class="op" id="4421101">(</span><span class="ident" id="4421102">out</span>&nbsp;<span class="op" id="4421106">[</span><span class="op" id="4421107">]</span><span class="builtintype" id="4421108">byte</span><span class="op" id="4421112">,</span>&nbsp;<span class="ident" id="4421114">hash</span>&nbsp;<span class="ident" id="4421119"><a href="/crypto/rsa/rsa.go.html#4413806">hash</a></span><span class="op" id="4421123">.</span><span class="ident" id="4421124">Hash</span><span class="op" id="4421128">,</span>&nbsp;<span class="ident" id="4421130">seed</span>&nbsp;<span class="op" id="4421135">[</span><span class="op" id="4421136">]</span><span class="builtintype" id="4421137">byte</span><span class="op" id="4421141">)</span>&nbsp;<span class="op" id="4421143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421146">var</span>&nbsp;<span class="ident" id="4421150">counter</span>&nbsp;<span class="op" id="4421158">[</span><span class="num" id="4421159">4</span><span class="op" id="4421160">]</span><span class="builtintype" id="4421161">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421167">var</span>&nbsp;<span class="ident" id="4421171">digest</span>&nbsp;<span class="op" id="4421178">[</span><span class="op" id="4421179">]</span><span class="builtintype" id="4421180">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421187">done</span>&nbsp;<span class="op" id="4421192">:=</span>&nbsp;<span class="num" id="4421195">0</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421198">for</span>&nbsp;<span class="ident" id="4421202"><a href="/crypto/rsa/rsa.go.html#4421187">done</a></span>&nbsp;<span class="op" id="4421207">&lt;</span>&nbsp;<span class="builtinfunc" id="4421209">len</span><span class="op" id="4421212">(</span><span class="ident" id="4421213"><a href="/crypto/rsa/rsa.go.html#4421102">out</a></span><span class="op" id="4421216">)</span>&nbsp;<span class="op" id="4421218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421222"><a href="/crypto/rsa/rsa.go.html#4421114">hash</a></span><span class="op" id="4421226">.</span><span class="ident" id="4421227">Write</span><span class="op" id="4421232">(</span><span class="ident" id="4421233"><a href="/crypto/rsa/rsa.go.html#4421130">seed</a></span><span class="op" id="4421237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421241"><a href="/crypto/rsa/rsa.go.html#4421114">hash</a></span><span class="op" id="4421245">.</span><span class="ident" id="4421246">Write</span><span class="op" id="4421251">(</span><span class="ident" id="4421252"><a href="/crypto/rsa/rsa.go.html#4421150">counter</a></span><span class="op" id="4421259">[</span><span class="num" id="4421260">0</span><span class="op" id="4421261">:</span><span class="num" id="4421262">4</span><span class="op" id="4421263">]</span><span class="op" id="4421264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421268"><a href="/crypto/rsa/rsa.go.html#4421171">digest</a></span>&nbsp;<span class="op" id="4421275">=</span>&nbsp;<span class="ident" id="4421277"><a href="/crypto/rsa/rsa.go.html#4421114">hash</a></span><span class="op" id="4421281">.</span><span class="ident" id="4421282">Sum</span><span class="op" id="4421285">(</span><span class="ident" id="4421286"><a href="/crypto/rsa/rsa.go.html#4421171">digest</a></span><span class="op" id="4421292">[</span><span class="op" id="4421293">:</span><span class="num" id="4421294">0</span><span class="op" id="4421295">]</span><span class="op" id="4421296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421300"><a href="/crypto/rsa/rsa.go.html#4421114">hash</a></span><span class="op" id="4421304">.</span><span class="ident" id="4421305">Reset</span><span class="op" id="4421310">(</span><span class="op" id="4421311">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421316">for</span>&nbsp;<span class="ident" id="4421320">i</span>&nbsp;<span class="op" id="4421322">:=</span>&nbsp;<span class="num" id="4421325">0</span><span class="op" id="4421326">;</span>&nbsp;<span class="ident" id="4421328"><a href="/crypto/rsa/rsa.go.html#4421320">i</a></span>&nbsp;<span class="op" id="4421330">&lt;</span>&nbsp;<span class="builtinfunc" id="4421332">len</span><span class="op" id="4421335">(</span><span class="ident" id="4421336"><a href="/crypto/rsa/rsa.go.html#4421171">digest</a></span><span class="op" id="4421342">)</span>&nbsp;<span class="op" id="4421344">&amp;&amp;</span>&nbsp;<span class="ident" id="4421347"><a href="/crypto/rsa/rsa.go.html#4421187">done</a></span>&nbsp;<span class="op" id="4421352">&lt;</span>&nbsp;<span class="builtinfunc" id="4421354">len</span><span class="op" id="4421357">(</span><span class="ident" id="4421358"><a href="/crypto/rsa/rsa.go.html#4421102">out</a></span><span class="op" id="4421361">)</span><span class="op" id="4421362">;</span>&nbsp;<span class="ident" id="4421364"><a href="/crypto/rsa/rsa.go.html#4421320">i</a></span><span class="op" id="4421365">++</span>&nbsp;<span class="op" id="4421368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421373"><a href="/crypto/rsa/rsa.go.html#4421102">out</a></span><span class="op" id="4421376">[</span><span class="ident" id="4421377"><a href="/crypto/rsa/rsa.go.html#4421187">done</a></span><span class="op" id="4421381">]</span>&nbsp;<span class="op" id="4421383">^=</span>&nbsp;<span class="ident" id="4421386"><a href="/crypto/rsa/rsa.go.html#4421171">digest</a></span><span class="op" id="4421392">[</span><span class="ident" id="4421393"><a href="/crypto/rsa/rsa.go.html#4421320">i</a></span><span class="op" id="4421394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421399"><a href="/crypto/rsa/rsa.go.html#4421187">done</a></span><span class="op" id="4421403">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421408">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421412"><a href="/crypto/rsa/rsa.go.html#4420837">incCounter</a></span><span class="op" id="4421422">(</span><span class="op" id="4421423">&amp;</span><span class="ident" id="4421424"><a href="/crypto/rsa/rsa.go.html#4421150">counter</a></span><span class="op" id="4421431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4421434">}</span><br>
<span class="lineno"></span><span class="op" id="4421436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4421439">//&nbsp;ErrMessageTooLong&nbsp;is&nbsp;returned&nbsp;when&nbsp;attempting&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;message&nbsp;which&nbsp;is</span><br>
<span class="lineno">275</span><span class="comment" id="4421518">//&nbsp;too&nbsp;large&nbsp;for&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;public&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4421563">var</span>&nbsp;<span class="ident" id="4421567">ErrMessageTooLong</span>&nbsp;<span class="op" id="4421585">=</span>&nbsp;<span class="ident" id="4421587"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4421593">.</span><span class="ident" id="4421594">New</span><span class="op" id="4421597">(</span><span class="string" id="4421598">&#34;crypto/rsa:&nbsp;message&nbsp;too&nbsp;long&nbsp;for&nbsp;RSA&nbsp;public&nbsp;key&nbsp;size&#34;</span><span class="op" id="4421652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4421655">func</span>&nbsp;<span class="ident" id="4421660">encrypt</span><span class="op" id="4421667">(</span><span class="ident" id="4421668">c</span>&nbsp;<span class="op" id="4421670">*</span><span class="ident" id="4421671"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4421674">.</span><span class="ident" id="4421675">Int</span><span class="op" id="4421678">,</span>&nbsp;<span class="ident" id="4421680">pub</span>&nbsp;<span class="op" id="4421684">*</span><span class="ident" id="4421685"><a href="/crypto/rsa/rsa.go.html#4413952">PublicKey</a></span><span class="op" id="4421694">,</span>&nbsp;<span class="ident" id="4421696">m</span>&nbsp;<span class="op" id="4421698">*</span><span class="ident" id="4421699"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4421702">.</span><span class="ident" id="4421703">Int</span><span class="op" id="4421706">)</span>&nbsp;<span class="op" id="4421708">*</span><span class="ident" id="4421709"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4421712">.</span><span class="ident" id="4421713">Int</span>&nbsp;<span class="op" id="4421717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421720">e</span>&nbsp;<span class="op" id="4421722">:=</span>&nbsp;<span class="ident" id="4421725"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4421728">.</span><span class="ident" id="4421729">NewInt</span><span class="op" id="4421735">(</span><span class="ident" id="4421736">int64</span><span class="op" id="4421741">(</span><span class="ident" id="4421742"><a href="/crypto/rsa/rsa.go.html#4421680">pub</a></span><span class="op" id="4421745">.</span><span class="ident" id="4421746">E</span><span class="op" id="4421747">)</span><span class="op" id="4421748">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4421751"><a href="/crypto/rsa/rsa.go.html#4421668">c</a></span><span class="op" id="4421752">.</span><span class="ident" id="4421753">Exp</span><span class="op" id="4421756">(</span><span class="ident" id="4421757"><a href="/crypto/rsa/rsa.go.html#4421696">m</a></span><span class="op" id="4421758">,</span>&nbsp;<span class="ident" id="4421760"><a href="/crypto/rsa/rsa.go.html#4421720">e</a></span><span class="op" id="4421761">,</span>&nbsp;<span class="ident" id="4421763"><a href="/crypto/rsa/rsa.go.html#4421680">pub</a></span><span class="op" id="4421766">.</span><span class="ident" id="4421767">N</span><span class="op" id="4421768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4421771">return</span>&nbsp;<span class="ident" id="4421778"><a href="/crypto/rsa/rsa.go.html#4421668">c</a></span><br>
<span class="lineno"></span><span class="op" id="4421780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4421783">//&nbsp;EncryptOAEP&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA-OAEP.</span><br>
<span class="lineno">285</span><span class="comment" id="4421840">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;less</span><br>
<span class="lineno"></span><span class="comment" id="4421916">//&nbsp;twice&nbsp;the&nbsp;hash&nbsp;length&nbsp;plus&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4421949">func</span>&nbsp;<span class="ident" id="4421954">EncryptOAEP</span><span class="op" id="4421965">(</span><span class="ident" id="4421966">hash</span>&nbsp;<span class="ident" id="4421971"><a href="/crypto/rsa/rsa.go.html#4413806">hash</a></span><span class="op" id="4421975">.</span><span class="ident" id="4421976">Hash</span><span class="op" id="4421980">,</span>&nbsp;<span class="ident" id="4421982">random</span>&nbsp;<span class="ident" id="4421989"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4421991">.</span><span class="ident" id="4421992">Reader</span><span class="op" id="4421998">,</span>&nbsp;<span class="ident" id="4422000">pub</span>&nbsp;<span class="op" id="4422004">*</span><span class="ident" id="4422005"><a href="/crypto/rsa/rsa.go.html#4413952">PublicKey</a></span><span class="op" id="4422014">,</span>&nbsp;<span class="ident" id="4422016">msg</span>&nbsp;<span class="op" id="4422020">[</span><span class="op" id="4422021">]</span><span class="builtintype" id="4422022">byte</span><span class="op" id="4422026">,</span>&nbsp;<span class="ident" id="4422028">label</span>&nbsp;<span class="op" id="4422034">[</span><span class="op" id="4422035">]</span><span class="builtintype" id="4422036">byte</span><span class="op" id="4422040">)</span>&nbsp;<span class="op" id="4422042">(</span><span class="ident" id="4422043">out</span>&nbsp;<span class="op" id="4422047">[</span><span class="op" id="4422048">]</span><span class="builtintype" id="4422049">byte</span><span class="op" id="4422053">,</span>&nbsp;<span class="ident" id="4422055">err</span>&nbsp;<span class="builtintype" id="4422059">error</span><span class="op" id="4422064">)</span>&nbsp;<span class="op" id="4422066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422069">if</span>&nbsp;<span class="ident" id="4422072">err</span>&nbsp;<span class="op" id="4422076">:=</span>&nbsp;<span class="ident" id="4422079"><a href="/crypto/rsa/rsa.go.html#4414536">checkPub</a></span><span class="op" id="4422087">(</span><span class="ident" id="4422088"><a href="/crypto/rsa/rsa.go.html#4422000">pub</a></span><span class="op" id="4422091">)</span><span class="op" id="4422092">;</span>&nbsp;<span class="ident" id="4422094"><a href="/crypto/rsa/rsa.go.html#4422072">err</a></span>&nbsp;<span class="op" id="4422098">!=</span>&nbsp;<span class="ident" id="4422101">nil</span>&nbsp;<span class="op" id="4422105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422109">return</span>&nbsp;<span class="ident" id="4422116">nil</span><span class="op" id="4422119">,</span>&nbsp;<span class="ident" id="4422121"><a href="/crypto/rsa/rsa.go.html#4422072">err</a></span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422129"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422133">.</span><span class="ident" id="4422134">Reset</span><span class="op" id="4422139">(</span><span class="op" id="4422140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422143">k</span>&nbsp;<span class="op" id="4422145">:=</span>&nbsp;<span class="op" id="4422148">(</span><span class="ident" id="4422149"><a href="/crypto/rsa/rsa.go.html#4422000">pub</a></span><span class="op" id="4422152">.</span><span class="ident" id="4422153">N</span><span class="op" id="4422154">.</span><span class="ident" id="4422155">BitLen</span><span class="op" id="4422161">(</span><span class="op" id="4422162">)</span>&nbsp;<span class="op" id="4422164">+</span>&nbsp;<span class="num" id="4422166">7</span><span class="op" id="4422167">)</span>&nbsp;<span class="op" id="4422169">/</span>&nbsp;<span class="num" id="4422171">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422174">if</span>&nbsp;<span class="builtinfunc" id="4422177">len</span><span class="op" id="4422180">(</span><span class="ident" id="4422181"><a href="/crypto/rsa/rsa.go.html#4422016">msg</a></span><span class="op" id="4422184">)</span>&nbsp;<span class="op" id="4422186">&gt;</span>&nbsp;<span class="ident" id="4422188"><a href="/crypto/rsa/rsa.go.html#4422143">k</a></span><span class="op" id="4422189">-</span><span class="num" id="4422190">2</span><span class="op" id="4422191">*</span><span class="ident" id="4422192"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422196">.</span><span class="ident" id="4422197">Size</span><span class="op" id="4422201">(</span><span class="op" id="4422202">)</span><span class="op" id="4422203">-</span><span class="num" id="4422204">2</span>&nbsp;<span class="op" id="4422206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422210"><a href="/crypto/rsa/rsa.go.html#4422055">err</a></span>&nbsp;<span class="op" id="4422214">=</span>&nbsp;<span class="ident" id="4422216"><a href="/crypto/rsa/rsa.go.html#4421567">ErrMessageTooLong</a></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422236">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422248"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422252">.</span><span class="ident" id="4422253">Write</span><span class="op" id="4422258">(</span><span class="ident" id="4422259"><a href="/crypto/rsa/rsa.go.html#4422028">label</a></span><span class="op" id="4422264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422267">lHash</span>&nbsp;<span class="op" id="4422273">:=</span>&nbsp;<span class="ident" id="4422276"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422280">.</span><span class="ident" id="4422281">Sum</span><span class="op" id="4422284">(</span><span class="ident" id="4422285">nil</span><span class="op" id="4422288">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422291"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422295">.</span><span class="ident" id="4422296">Reset</span><span class="op" id="4422301">(</span><span class="op" id="4422302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422306">em</span>&nbsp;<span class="op" id="4422309">:=</span>&nbsp;<span class="builtinfunc" id="4422312">make</span><span class="op" id="4422316">(</span><span class="op" id="4422317">[</span><span class="op" id="4422318">]</span><span class="builtintype" id="4422319">byte</span><span class="op" id="4422323">,</span>&nbsp;<span class="ident" id="4422325"><a href="/crypto/rsa/rsa.go.html#4422143">k</a></span><span class="op" id="4422326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422329">seed</span>&nbsp;<span class="op" id="4422334">:=</span>&nbsp;<span class="ident" id="4422337"><a href="/crypto/rsa/rsa.go.html#4422306">em</a></span><span class="op" id="4422339">[</span><span class="num" id="4422340">1</span>&nbsp;<span class="op" id="4422342">:</span>&nbsp;<span class="num" id="4422344">1</span><span class="op" id="4422345">+</span><span class="ident" id="4422346"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422350">.</span><span class="ident" id="4422351">Size</span><span class="op" id="4422355">(</span><span class="op" id="4422356">)</span><span class="op" id="4422357">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422360">db</span>&nbsp;<span class="op" id="4422363">:=</span>&nbsp;<span class="ident" id="4422366"><a href="/crypto/rsa/rsa.go.html#4422306">em</a></span><span class="op" id="4422368">[</span><span class="num" id="4422369">1</span><span class="op" id="4422370">+</span><span class="ident" id="4422371"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422375">.</span><span class="ident" id="4422376">Size</span><span class="op" id="4422380">(</span><span class="op" id="4422381">)</span><span class="op" id="4422382">:</span><span class="op" id="4422383">]</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4422387">copy</span><span class="op" id="4422391">(</span><span class="ident" id="4422392"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422394">[</span><span class="num" id="4422395">0</span><span class="op" id="4422396">:</span><span class="ident" id="4422397"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422401">.</span><span class="ident" id="4422402">Size</span><span class="op" id="4422406">(</span><span class="op" id="4422407">)</span><span class="op" id="4422408">]</span><span class="op" id="4422409">,</span>&nbsp;<span class="ident" id="4422411"><a href="/crypto/rsa/rsa.go.html#4422267">lHash</a></span><span class="op" id="4422416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422419"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422421">[</span><span class="builtinfunc" id="4422422">len</span><span class="op" id="4422425">(</span><span class="ident" id="4422426"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422428">)</span><span class="op" id="4422429">-</span><span class="builtinfunc" id="4422430">len</span><span class="op" id="4422433">(</span><span class="ident" id="4422434"><a href="/crypto/rsa/rsa.go.html#4422016">msg</a></span><span class="op" id="4422437">)</span><span class="op" id="4422438">-</span><span class="num" id="4422439">1</span><span class="op" id="4422440">]</span>&nbsp;<span class="op" id="4422442">=</span>&nbsp;<span class="num" id="4422444">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4422447">copy</span><span class="op" id="4422451">(</span><span class="ident" id="4422452"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422454">[</span><span class="builtinfunc" id="4422455">len</span><span class="op" id="4422458">(</span><span class="ident" id="4422459"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422461">)</span><span class="op" id="4422462">-</span><span class="builtinfunc" id="4422463">len</span><span class="op" id="4422466">(</span><span class="ident" id="4422467"><a href="/crypto/rsa/rsa.go.html#4422016">msg</a></span><span class="op" id="4422470">)</span><span class="op" id="4422471">:</span><span class="op" id="4422472">]</span><span class="op" id="4422473">,</span>&nbsp;<span class="ident" id="4422475"><a href="/crypto/rsa/rsa.go.html#4422016">msg</a></span><span class="op" id="4422478">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422482">_</span><span class="op" id="4422483">,</span>&nbsp;<span class="ident" id="4422485"><a href="/crypto/rsa/rsa.go.html#4422055">err</a></span>&nbsp;<span class="op" id="4422489">=</span>&nbsp;<span class="ident" id="4422491"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4422493">.</span><span class="ident" id="4422494">ReadFull</span><span class="op" id="4422502">(</span><span class="ident" id="4422503"><a href="/crypto/rsa/rsa.go.html#4421982">random</a></span><span class="op" id="4422509">,</span>&nbsp;<span class="ident" id="4422511"><a href="/crypto/rsa/rsa.go.html#4422329">seed</a></span><span class="op" id="4422515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422518">if</span>&nbsp;<span class="ident" id="4422521"><a href="/crypto/rsa/rsa.go.html#4422055">err</a></span>&nbsp;<span class="op" id="4422525">!=</span>&nbsp;<span class="ident" id="4422528">nil</span>&nbsp;<span class="op" id="4422532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422536">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422548"><a href="/crypto/rsa/rsa.go.html#4421094">mgf1XOR</a></span><span class="op" id="4422555">(</span><span class="ident" id="4422556"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422558">,</span>&nbsp;<span class="ident" id="4422560"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422564">,</span>&nbsp;<span class="ident" id="4422566"><a href="/crypto/rsa/rsa.go.html#4422329">seed</a></span><span class="op" id="4422570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422573"><a href="/crypto/rsa/rsa.go.html#4421094">mgf1XOR</a></span><span class="op" id="4422580">(</span><span class="ident" id="4422581"><a href="/crypto/rsa/rsa.go.html#4422329">seed</a></span><span class="op" id="4422585">,</span>&nbsp;<span class="ident" id="4422587"><a href="/crypto/rsa/rsa.go.html#4421966">hash</a></span><span class="op" id="4422591">,</span>&nbsp;<span class="ident" id="4422593"><a href="/crypto/rsa/rsa.go.html#4422360">db</a></span><span class="op" id="4422595">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422599">m</span>&nbsp;<span class="op" id="4422601">:=</span>&nbsp;<span class="builtinfunc" id="4422604">new</span><span class="op" id="4422607">(</span><span class="ident" id="4422608"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4422611">.</span><span class="ident" id="4422612">Int</span><span class="op" id="4422615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422618"><a href="/crypto/rsa/rsa.go.html#4422599">m</a></span><span class="op" id="4422619">.</span><span class="ident" id="4422620">SetBytes</span><span class="op" id="4422628">(</span><span class="ident" id="4422629"><a href="/crypto/rsa/rsa.go.html#4422306">em</a></span><span class="op" id="4422631">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422634">c</span>&nbsp;<span class="op" id="4422636">:=</span>&nbsp;<span class="ident" id="4422639"><a href="/crypto/rsa/rsa.go.html#4421660">encrypt</a></span><span class="op" id="4422646">(</span><span class="builtinfunc" id="4422647">new</span><span class="op" id="4422650">(</span><span class="ident" id="4422651"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4422654">.</span><span class="ident" id="4422655">Int</span><span class="op" id="4422658">)</span><span class="op" id="4422659">,</span>&nbsp;<span class="ident" id="4422661"><a href="/crypto/rsa/rsa.go.html#4422000">pub</a></span><span class="op" id="4422664">,</span>&nbsp;<span class="ident" id="4422666"><a href="/crypto/rsa/rsa.go.html#4422599">m</a></span><span class="op" id="4422667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422670"><a href="/crypto/rsa/rsa.go.html#4422043">out</a></span>&nbsp;<span class="op" id="4422674">=</span>&nbsp;<span class="ident" id="4422676"><a href="/crypto/rsa/rsa.go.html#4422634">c</a></span><span class="op" id="4422677">.</span><span class="ident" id="4422678">Bytes</span><span class="op" id="4422683">(</span><span class="op" id="4422684">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422688">if</span>&nbsp;<span class="builtinfunc" id="4422691">len</span><span class="op" id="4422694">(</span><span class="ident" id="4422695"><a href="/crypto/rsa/rsa.go.html#4422043">out</a></span><span class="op" id="4422698">)</span>&nbsp;<span class="op" id="4422700">&lt;</span>&nbsp;<span class="ident" id="4422702"><a href="/crypto/rsa/rsa.go.html#4422143">k</a></span>&nbsp;<span class="op" id="4422704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4422708">//&nbsp;If&nbsp;the&nbsp;output&nbsp;is&nbsp;too&nbsp;small,&nbsp;we&nbsp;need&nbsp;to&nbsp;left-pad&nbsp;with&nbsp;zeros.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422773">t</span>&nbsp;<span class="op" id="4422775">:=</span>&nbsp;<span class="builtinfunc" id="4422778">make</span><span class="op" id="4422782">(</span><span class="op" id="4422783">[</span><span class="op" id="4422784">]</span><span class="builtintype" id="4422785">byte</span><span class="op" id="4422789">,</span>&nbsp;<span class="ident" id="4422791"><a href="/crypto/rsa/rsa.go.html#4422143">k</a></span><span class="op" id="4422792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4422796">copy</span><span class="op" id="4422800">(</span><span class="ident" id="4422801"><a href="/crypto/rsa/rsa.go.html#4422773">t</a></span><span class="op" id="4422802">[</span><span class="ident" id="4422803"><a href="/crypto/rsa/rsa.go.html#4422143">k</a></span><span class="op" id="4422804">-</span><span class="builtinfunc" id="4422805">len</span><span class="op" id="4422808">(</span><span class="ident" id="4422809"><a href="/crypto/rsa/rsa.go.html#4422043">out</a></span><span class="op" id="4422812">)</span><span class="op" id="4422813">:</span><span class="op" id="4422814">]</span><span class="op" id="4422815">,</span>&nbsp;<span class="ident" id="4422817"><a href="/crypto/rsa/rsa.go.html#4422043">out</a></span><span class="op" id="4422820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4422824"><a href="/crypto/rsa/rsa.go.html#4422043">out</a></span>&nbsp;<span class="op" id="4422828">=</span>&nbsp;<span class="ident" id="4422830"><a href="/crypto/rsa/rsa.go.html#4422773">t</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4422833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4422837">return</span><br>
<span class="lineno"></span><span class="op" id="4422844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4422847">//&nbsp;ErrDecryption&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;decrypt&nbsp;a&nbsp;message.</span><br>
<span class="lineno"></span><span class="comment" id="4422907">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno">335</span><span class="keyword" id="4422962">var</span>&nbsp;<span class="ident" id="4422966">ErrDecryption</span>&nbsp;<span class="op" id="4422980">=</span>&nbsp;<span class="ident" id="4422982"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4422988">.</span><span class="ident" id="4422989">New</span><span class="op" id="4422992">(</span><span class="string" id="4422993">&#34;crypto/rsa:&nbsp;decryption&nbsp;error&#34;</span><span class="op" id="4423023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4423026">//&nbsp;ErrVerification&nbsp;represents&nbsp;a&nbsp;failure&nbsp;to&nbsp;verify&nbsp;a&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4423089">//&nbsp;It&nbsp;is&nbsp;deliberately&nbsp;vague&nbsp;to&nbsp;avoid&nbsp;adaptive&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4423144">var</span>&nbsp;<span class="ident" id="4423148">ErrVerification</span>&nbsp;<span class="op" id="4423164">=</span>&nbsp;<span class="ident" id="4423166"><a href="/crypto/rsa/rsa.go.html#4413796">errors</a></span><span class="op" id="4423172">.</span><span class="ident" id="4423173">New</span><span class="op" id="4423176">(</span><span class="string" id="4423177">&#34;crypto/rsa:&nbsp;verification&nbsp;error&#34;</span><span class="op" id="4423209">)</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="comment" id="4423212">//&nbsp;modInverse&nbsp;returns&nbsp;ia,&nbsp;the&nbsp;inverse&nbsp;of&nbsp;a&nbsp;in&nbsp;the&nbsp;multiplicative&nbsp;group&nbsp;of&nbsp;prime</span><br>
<span class="lineno"></span><span class="comment" id="4423292">//&nbsp;order&nbsp;n.&nbsp;It&nbsp;requires&nbsp;that&nbsp;a&nbsp;be&nbsp;a&nbsp;member&nbsp;of&nbsp;the&nbsp;group&nbsp;(i.e.&nbsp;less&nbsp;than&nbsp;n).</span><br>
<span class="lineno"></span><span class="keyword" id="4423368">func</span>&nbsp;<span class="ident" id="4423373">modInverse</span><span class="op" id="4423383">(</span><span class="ident" id="4423384">a</span><span class="op" id="4423385">,</span>&nbsp;<span class="ident" id="4423387">n</span>&nbsp;<span class="op" id="4423389">*</span><span class="ident" id="4423390"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4423393">.</span><span class="ident" id="4423394">Int</span><span class="op" id="4423397">)</span>&nbsp;<span class="op" id="4423399">(</span><span class="ident" id="4423400">ia</span>&nbsp;<span class="op" id="4423403">*</span><span class="ident" id="4423404"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4423407">.</span><span class="ident" id="4423408">Int</span><span class="op" id="4423411">,</span>&nbsp;<span class="ident" id="4423413">ok</span>&nbsp;<span class="builtintype" id="4423416">bool</span><span class="op" id="4423420">)</span>&nbsp;<span class="op" id="4423422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423425">g</span>&nbsp;<span class="op" id="4423427">:=</span>&nbsp;<span class="builtinfunc" id="4423430">new</span><span class="op" id="4423433">(</span><span class="ident" id="4423434"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4423437">.</span><span class="ident" id="4423438">Int</span><span class="op" id="4423441">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423444">x</span>&nbsp;<span class="op" id="4423446">:=</span>&nbsp;<span class="builtinfunc" id="4423449">new</span><span class="op" id="4423452">(</span><span class="ident" id="4423453"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4423456">.</span><span class="ident" id="4423457">Int</span><span class="op" id="4423460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423463">y</span>&nbsp;<span class="op" id="4423465">:=</span>&nbsp;<span class="builtinfunc" id="4423468">new</span><span class="op" id="4423471">(</span><span class="ident" id="4423472"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4423475">.</span><span class="ident" id="4423476">Int</span><span class="op" id="4423479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423482"><a href="/crypto/rsa/rsa.go.html#4423425">g</a></span><span class="op" id="4423483">.</span><span class="ident" id="4423484">GCD</span><span class="op" id="4423487">(</span><span class="ident" id="4423488"><a href="/crypto/rsa/rsa.go.html#4423444">x</a></span><span class="op" id="4423489">,</span>&nbsp;<span class="ident" id="4423491"><a href="/crypto/rsa/rsa.go.html#4423463">y</a></span><span class="op" id="4423492">,</span>&nbsp;<span class="ident" id="4423494"><a href="/crypto/rsa/rsa.go.html#4423384">a</a></span><span class="op" id="4423495">,</span>&nbsp;<span class="ident" id="4423497"><a href="/crypto/rsa/rsa.go.html#4423387">n</a></span><span class="op" id="4423498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423501">if</span>&nbsp;<span class="ident" id="4423504"><a href="/crypto/rsa/rsa.go.html#4423425">g</a></span><span class="op" id="4423505">.</span><span class="ident" id="4423506">Cmp</span><span class="op" id="4423509">(</span><span class="ident" id="4423510"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4423516">)</span>&nbsp;<span class="op" id="4423518">!=</span>&nbsp;<span class="num" id="4423521">0</span>&nbsp;<span class="op" id="4423523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423527">//&nbsp;In&nbsp;this&nbsp;case,&nbsp;a&nbsp;and&nbsp;n&nbsp;aren&#39;t&nbsp;coprime&nbsp;and&nbsp;we&nbsp;cannot&nbsp;calculate</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423593">//&nbsp;the&nbsp;inverse.&nbsp;This&nbsp;happens&nbsp;because&nbsp;the&nbsp;values&nbsp;of&nbsp;n&nbsp;are&nbsp;nearly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423659">//&nbsp;prime&nbsp;(being&nbsp;the&nbsp;product&nbsp;of&nbsp;two&nbsp;primes)&nbsp;rather&nbsp;than&nbsp;truly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423722">//&nbsp;prime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423734">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423742">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423746">if</span>&nbsp;<span class="ident" id="4423749"><a href="/crypto/rsa/rsa.go.html#4423444">x</a></span><span class="op" id="4423750">.</span><span class="ident" id="4423751">Cmp</span><span class="op" id="4423754">(</span><span class="ident" id="4423755"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4423761">)</span>&nbsp;<span class="op" id="4423763">&lt;</span>&nbsp;<span class="num" id="4423765">0</span>&nbsp;<span class="op" id="4423767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423771">//&nbsp;0&nbsp;is&nbsp;not&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;any&nbsp;element&nbsp;so,&nbsp;if&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4423836">//&nbsp;&lt;&nbsp;1,&nbsp;then&nbsp;x&nbsp;is&nbsp;negative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4423866"><a href="/crypto/rsa/rsa.go.html#4423444">x</a></span><span class="op" id="4423867">.</span><span class="ident" id="4423868">Add</span><span class="op" id="4423871">(</span><span class="ident" id="4423872"><a href="/crypto/rsa/rsa.go.html#4423444">x</a></span><span class="op" id="4423873">,</span>&nbsp;<span class="ident" id="4423875"><a href="/crypto/rsa/rsa.go.html#4423387">n</a></span><span class="op" id="4423876">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4423879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4423883">return</span>&nbsp;<span class="ident" id="4423890"><a href="/crypto/rsa/rsa.go.html#4423444">x</a></span><span class="op" id="4423891">,</span>&nbsp;<span class="ident" id="4423893">true</span><br>
<span class="lineno"></span><span class="op" id="4423898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4423901">//&nbsp;Precompute&nbsp;performs&nbsp;some&nbsp;calculations&nbsp;that&nbsp;speed&nbsp;up&nbsp;private&nbsp;key&nbsp;operations</span><br>
<span class="lineno"></span><span class="comment" id="4423979">//&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno"></span><span class="keyword" id="4423997">func</span>&nbsp;<span class="op" id="4424002">(</span><span class="ident" id="4424003">priv</span>&nbsp;<span class="op" id="4424008">*</span><span class="ident" id="4424009"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4424019">)</span>&nbsp;<span class="ident" id="4424021">Precompute</span><span class="op" id="4424031">(</span><span class="op" id="4424032">)</span>&nbsp;<span class="op" id="4424034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424037">if</span>&nbsp;<span class="ident" id="4424040"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424044">.</span><span class="ident" id="4424045">Precomputed</span><span class="op" id="4424056">.</span><span class="ident" id="4424057">Dp</span>&nbsp;<span class="op" id="4424060">!=</span>&nbsp;<span class="ident" id="4424063">nil</span>&nbsp;<span class="op" id="4424067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424071">return</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424083"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424087">.</span><span class="ident" id="4424088">Precomputed</span><span class="op" id="4424099">.</span><span class="ident" id="4424100">Dp</span>&nbsp;<span class="op" id="4424103">=</span>&nbsp;<span class="builtinfunc" id="4424105">new</span><span class="op" id="4424108">(</span><span class="ident" id="4424109"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424112">.</span><span class="ident" id="4424113">Int</span><span class="op" id="4424116">)</span><span class="op" id="4424117">.</span><span class="ident" id="4424118">Sub</span><span class="op" id="4424121">(</span><span class="ident" id="4424122"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424126">.</span><span class="ident" id="4424127">Primes</span><span class="op" id="4424133">[</span><span class="num" id="4424134">0</span><span class="op" id="4424135">]</span><span class="op" id="4424136">,</span>&nbsp;<span class="ident" id="4424138"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4424144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424147"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424151">.</span><span class="ident" id="4424152">Precomputed</span><span class="op" id="4424163">.</span><span class="ident" id="4424164">Dp</span><span class="op" id="4424166">.</span><span class="ident" id="4424167">Mod</span><span class="op" id="4424170">(</span><span class="ident" id="4424171"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424175">.</span><span class="ident" id="4424176">D</span><span class="op" id="4424177">,</span>&nbsp;<span class="ident" id="4424179"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424183">.</span><span class="ident" id="4424184">Precomputed</span><span class="op" id="4424195">.</span><span class="ident" id="4424196">Dp</span><span class="op" id="4424198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424202"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424206">.</span><span class="ident" id="4424207">Precomputed</span><span class="op" id="4424218">.</span><span class="ident" id="4424219">Dq</span>&nbsp;<span class="op" id="4424222">=</span>&nbsp;<span class="builtinfunc" id="4424224">new</span><span class="op" id="4424227">(</span><span class="ident" id="4424228"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424231">.</span><span class="ident" id="4424232">Int</span><span class="op" id="4424235">)</span><span class="op" id="4424236">.</span><span class="ident" id="4424237">Sub</span><span class="op" id="4424240">(</span><span class="ident" id="4424241"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424245">.</span><span class="ident" id="4424246">Primes</span><span class="op" id="4424252">[</span><span class="num" id="4424253">1</span><span class="op" id="4424254">]</span><span class="op" id="4424255">,</span>&nbsp;<span class="ident" id="4424257"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4424263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424266"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424270">.</span><span class="ident" id="4424271">Precomputed</span><span class="op" id="4424282">.</span><span class="ident" id="4424283">Dq</span><span class="op" id="4424285">.</span><span class="ident" id="4424286">Mod</span><span class="op" id="4424289">(</span><span class="ident" id="4424290"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424294">.</span><span class="ident" id="4424295">D</span><span class="op" id="4424296">,</span>&nbsp;<span class="ident" id="4424298"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424302">.</span><span class="ident" id="4424303">Precomputed</span><span class="op" id="4424314">.</span><span class="ident" id="4424315">Dq</span><span class="op" id="4424317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424321"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424325">.</span><span class="ident" id="4424326">Precomputed</span><span class="op" id="4424337">.</span><span class="ident" id="4424338">Qinv</span>&nbsp;<span class="op" id="4424343">=</span>&nbsp;<span class="builtinfunc" id="4424345">new</span><span class="op" id="4424348">(</span><span class="ident" id="4424349"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424352">.</span><span class="ident" id="4424353">Int</span><span class="op" id="4424356">)</span><span class="op" id="4424357">.</span><span class="ident" id="4424358">ModInverse</span><span class="op" id="4424368">(</span><span class="ident" id="4424369"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424373">.</span><span class="ident" id="4424374">Primes</span><span class="op" id="4424380">[</span><span class="num" id="4424381">1</span><span class="op" id="4424382">]</span><span class="op" id="4424383">,</span>&nbsp;<span class="ident" id="4424385"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424389">.</span><span class="ident" id="4424390">Primes</span><span class="op" id="4424396">[</span><span class="num" id="4424397">0</span><span class="op" id="4424398">]</span><span class="op" id="4424399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424403">r</span>&nbsp;<span class="op" id="4424405">:=</span>&nbsp;<span class="builtinfunc" id="4424408">new</span><span class="op" id="4424411">(</span><span class="ident" id="4424412"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424415">.</span><span class="ident" id="4424416">Int</span><span class="op" id="4424419">)</span><span class="op" id="4424420">.</span><span class="ident" id="4424421">Mul</span><span class="op" id="4424424">(</span><span class="ident" id="4424425"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424429">.</span><span class="ident" id="4424430">Primes</span><span class="op" id="4424436">[</span><span class="num" id="4424437">0</span><span class="op" id="4424438">]</span><span class="op" id="4424439">,</span>&nbsp;<span class="ident" id="4424441"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424445">.</span><span class="ident" id="4424446">Primes</span><span class="op" id="4424452">[</span><span class="num" id="4424453">1</span><span class="op" id="4424454">]</span><span class="op" id="4424455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424458"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424462">.</span><span class="ident" id="4424463">Precomputed</span><span class="op" id="4424474">.</span><span class="ident" id="4424475">CRTValues</span>&nbsp;<span class="op" id="4424485">=</span>&nbsp;<span class="builtinfunc" id="4424487">make</span><span class="op" id="4424491">(</span><span class="op" id="4424492">[</span><span class="op" id="4424493">]</span><span class="ident" id="4424494"><a href="/crypto/rsa/rsa.go.html#4416254">CRTValue</a></span><span class="op" id="4424502">,</span>&nbsp;<span class="builtinfunc" id="4424504">len</span><span class="op" id="4424507">(</span><span class="ident" id="4424508"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424512">.</span><span class="ident" id="4424513">Primes</span><span class="op" id="4424519">)</span><span class="op" id="4424520">-</span><span class="num" id="4424521">2</span><span class="op" id="4424522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4424525">for</span>&nbsp;<span class="ident" id="4424529">i</span>&nbsp;<span class="op" id="4424531">:=</span>&nbsp;<span class="num" id="4424534">2</span><span class="op" id="4424535">;</span>&nbsp;<span class="ident" id="4424537"><a href="/crypto/rsa/rsa.go.html#4424529">i</a></span>&nbsp;<span class="op" id="4424539">&lt;</span>&nbsp;<span class="builtinfunc" id="4424541">len</span><span class="op" id="4424544">(</span><span class="ident" id="4424545"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424549">.</span><span class="ident" id="4424550">Primes</span><span class="op" id="4424556">)</span><span class="op" id="4424557">;</span>&nbsp;<span class="ident" id="4424559"><a href="/crypto/rsa/rsa.go.html#4424529">i</a></span><span class="op" id="4424560">++</span>&nbsp;<span class="op" id="4424563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424567">prime</span>&nbsp;<span class="op" id="4424573">:=</span>&nbsp;<span class="ident" id="4424576"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424580">.</span><span class="ident" id="4424581">Primes</span><span class="op" id="4424587">[</span><span class="ident" id="4424588"><a href="/crypto/rsa/rsa.go.html#4424529">i</a></span><span class="op" id="4424589">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424593">values</span>&nbsp;<span class="op" id="4424600">:=</span>&nbsp;<span class="op" id="4424603">&amp;</span><span class="ident" id="4424604"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424608">.</span><span class="ident" id="4424609">Precomputed</span><span class="op" id="4424620">.</span><span class="ident" id="4424621">CRTValues</span><span class="op" id="4424630">[</span><span class="ident" id="4424631"><a href="/crypto/rsa/rsa.go.html#4424529">i</a></span><span class="op" id="4424632">-</span><span class="num" id="4424633">2</span><span class="op" id="4424634">]</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424639"><a href="/crypto/rsa/rsa.go.html#4424593">values</a></span><span class="op" id="4424645">.</span><span class="ident" id="4424646">Exp</span>&nbsp;<span class="op" id="4424650">=</span>&nbsp;<span class="builtinfunc" id="4424652">new</span><span class="op" id="4424655">(</span><span class="ident" id="4424656"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424659">.</span><span class="ident" id="4424660">Int</span><span class="op" id="4424663">)</span><span class="op" id="4424664">.</span><span class="ident" id="4424665">Sub</span><span class="op" id="4424668">(</span><span class="ident" id="4424669"><a href="/crypto/rsa/rsa.go.html#4424567">prime</a></span><span class="op" id="4424674">,</span>&nbsp;<span class="ident" id="4424676"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><span class="op" id="4424682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424686"><a href="/crypto/rsa/rsa.go.html#4424593">values</a></span><span class="op" id="4424692">.</span><span class="ident" id="4424693">Exp</span><span class="op" id="4424696">.</span><span class="ident" id="4424697">Mod</span><span class="op" id="4424700">(</span><span class="ident" id="4424701"><a href="/crypto/rsa/rsa.go.html#4424003">priv</a></span><span class="op" id="4424705">.</span><span class="ident" id="4424706">D</span><span class="op" id="4424707">,</span>&nbsp;<span class="ident" id="4424709"><a href="/crypto/rsa/rsa.go.html#4424593">values</a></span><span class="op" id="4424715">.</span><span class="ident" id="4424716">Exp</span><span class="op" id="4424719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424724"><a href="/crypto/rsa/rsa.go.html#4424593">values</a></span><span class="op" id="4424730">.</span><span class="ident" id="4424731">R</span>&nbsp;<span class="op" id="4424733">=</span>&nbsp;<span class="builtinfunc" id="4424735">new</span><span class="op" id="4424738">(</span><span class="ident" id="4424739"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424742">.</span><span class="ident" id="4424743">Int</span><span class="op" id="4424746">)</span><span class="op" id="4424747">.</span><span class="ident" id="4424748">Set</span><span class="op" id="4424751">(</span><span class="ident" id="4424752"><a href="/crypto/rsa/rsa.go.html#4424403">r</a></span><span class="op" id="4424753">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424757"><a href="/crypto/rsa/rsa.go.html#4424593">values</a></span><span class="op" id="4424763">.</span><span class="ident" id="4424764">Coeff</span>&nbsp;<span class="op" id="4424770">=</span>&nbsp;<span class="builtinfunc" id="4424772">new</span><span class="op" id="4424775">(</span><span class="ident" id="4424776"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4424779">.</span><span class="ident" id="4424780">Int</span><span class="op" id="4424783">)</span><span class="op" id="4424784">.</span><span class="ident" id="4424785">ModInverse</span><span class="op" id="4424795">(</span><span class="ident" id="4424796"><a href="/crypto/rsa/rsa.go.html#4424403">r</a></span><span class="op" id="4424797">,</span>&nbsp;<span class="ident" id="4424799"><a href="/crypto/rsa/rsa.go.html#4424567">prime</a></span><span class="op" id="4424804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4424809"><a href="/crypto/rsa/rsa.go.html#4424403">r</a></span><span class="op" id="4424810">.</span><span class="ident" id="4424811">Mul</span><span class="op" id="4424814">(</span><span class="ident" id="4424815"><a href="/crypto/rsa/rsa.go.html#4424403">r</a></span><span class="op" id="4424816">,</span>&nbsp;<span class="ident" id="4424818"><a href="/crypto/rsa/rsa.go.html#4424567">prime</a></span><span class="op" id="4424823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4424826">}</span><br>
<span class="lineno"></span><span class="op" id="4424828">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="4424831">//&nbsp;decrypt&nbsp;performs&nbsp;an&nbsp;RSA&nbsp;decryption,&nbsp;resulting&nbsp;in&nbsp;a&nbsp;plaintext&nbsp;integer.&nbsp;If&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4424909">//&nbsp;random&nbsp;source&nbsp;is&nbsp;given,&nbsp;RSA&nbsp;blinding&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4424958">func</span>&nbsp;<span class="ident" id="4424963">decrypt</span><span class="op" id="4424970">(</span><span class="ident" id="4424971">random</span>&nbsp;<span class="ident" id="4424978"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4424980">.</span><span class="ident" id="4424981">Reader</span><span class="op" id="4424987">,</span>&nbsp;<span class="ident" id="4424989">priv</span>&nbsp;<span class="op" id="4424994">*</span><span class="ident" id="4424995"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4425005">,</span>&nbsp;<span class="ident" id="4425007">c</span>&nbsp;<span class="op" id="4425009">*</span><span class="ident" id="4425010"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425013">.</span><span class="ident" id="4425014">Int</span><span class="op" id="4425017">)</span>&nbsp;<span class="op" id="4425019">(</span><span class="ident" id="4425020">m</span>&nbsp;<span class="op" id="4425022">*</span><span class="ident" id="4425023"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425026">.</span><span class="ident" id="4425027">Int</span><span class="op" id="4425030">,</span>&nbsp;<span class="ident" id="4425032">err</span>&nbsp;<span class="builtintype" id="4425036">error</span><span class="op" id="4425041">)</span>&nbsp;<span class="op" id="4425043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425046">//&nbsp;TODO(agl):&nbsp;can&nbsp;we&nbsp;get&nbsp;away&nbsp;with&nbsp;reusing&nbsp;blinds?</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425098">if</span>&nbsp;<span class="ident" id="4425101"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span><span class="op" id="4425102">.</span><span class="ident" id="4425103">Cmp</span><span class="op" id="4425106">(</span><span class="ident" id="4425107"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425111">.</span><span class="ident" id="4425112">N</span><span class="op" id="4425113">)</span>&nbsp;<span class="op" id="4425115">&gt;</span>&nbsp;<span class="num" id="4425117">0</span>&nbsp;<span class="op" id="4425119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425123"><a href="/crypto/rsa/rsa.go.html#4425032">err</a></span>&nbsp;<span class="op" id="4425127">=</span>&nbsp;<span class="ident" id="4425129"><a href="/crypto/rsa/rsa.go.html#4422966">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425157">var</span>&nbsp;<span class="ident" id="4425161">ir</span>&nbsp;<span class="op" id="4425164">*</span><span class="ident" id="4425165"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425168">.</span><span class="ident" id="4425169">Int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425174">if</span>&nbsp;<span class="ident" id="4425177"><a href="/crypto/rsa/rsa.go.html#4424971">random</a></span>&nbsp;<span class="op" id="4425184">!=</span>&nbsp;<span class="ident" id="4425187">nil</span>&nbsp;<span class="op" id="4425191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425195">//&nbsp;Blinding&nbsp;enabled.&nbsp;Blinding&nbsp;involves&nbsp;multiplying&nbsp;c&nbsp;by&nbsp;r^e.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425258">//&nbsp;Then&nbsp;the&nbsp;decryption&nbsp;operation&nbsp;performs&nbsp;(m^e&nbsp;*&nbsp;r^e)^d&nbsp;mod&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425322">//&nbsp;which&nbsp;equals&nbsp;mr&nbsp;mod&nbsp;n.&nbsp;The&nbsp;factor&nbsp;of&nbsp;r&nbsp;can&nbsp;then&nbsp;be&nbsp;removed</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425386">//&nbsp;by&nbsp;multiplying&nbsp;by&nbsp;the&nbsp;multiplicative&nbsp;inverse&nbsp;of&nbsp;r.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425443">var</span>&nbsp;<span class="ident" id="4425447">r</span>&nbsp;<span class="op" id="4425449">*</span><span class="ident" id="4425450"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425453">.</span><span class="ident" id="4425454">Int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425461">for</span>&nbsp;<span class="op" id="4425465">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425470"><a href="/crypto/rsa/rsa.go.html#4425447">r</a></span><span class="op" id="4425471">,</span>&nbsp;<span class="ident" id="4425473"><a href="/crypto/rsa/rsa.go.html#4425032">err</a></span>&nbsp;<span class="op" id="4425477">=</span>&nbsp;<span class="ident" id="4425479"><a href="/crypto/rsa/rsa.go.html#4413764">rand</a></span><span class="op" id="4425483">.</span><span class="ident" id="4425484">Int</span><span class="op" id="4425487">(</span><span class="ident" id="4425488"><a href="/crypto/rsa/rsa.go.html#4424971">random</a></span><span class="op" id="4425494">,</span>&nbsp;<span class="ident" id="4425496"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425500">.</span><span class="ident" id="4425501">N</span><span class="op" id="4425502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425507">if</span>&nbsp;<span class="ident" id="4425510"><a href="/crypto/rsa/rsa.go.html#4425032">err</a></span>&nbsp;<span class="op" id="4425514">!=</span>&nbsp;<span class="ident" id="4425517">nil</span>&nbsp;<span class="op" id="4425521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425527">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425542">if</span>&nbsp;<span class="ident" id="4425545"><a href="/crypto/rsa/rsa.go.html#4425447">r</a></span><span class="op" id="4425546">.</span><span class="ident" id="4425547">Cmp</span><span class="op" id="4425550">(</span><span class="ident" id="4425551"><a href="/crypto/rsa/rsa.go.html#4413838">bigZero</a></span><span class="op" id="4425558">)</span>&nbsp;<span class="op" id="4425560">==</span>&nbsp;<span class="num" id="4425563">0</span>&nbsp;<span class="op" id="4425565">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425571"><a href="/crypto/rsa/rsa.go.html#4425447">r</a></span>&nbsp;<span class="op" id="4425573">=</span>&nbsp;<span class="ident" id="4425575"><a href="/crypto/rsa/rsa.go.html#4413866">bigOne</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425590">var</span>&nbsp;<span class="ident" id="4425594">ok</span>&nbsp;<span class="builtintype" id="4425597">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425605"><a href="/crypto/rsa/rsa.go.html#4425161">ir</a></span><span class="op" id="4425607">,</span>&nbsp;<span class="ident" id="4425609"><a href="/crypto/rsa/rsa.go.html#4425594">ok</a></span>&nbsp;<span class="op" id="4425612">=</span>&nbsp;<span class="ident" id="4425614"><a href="/crypto/rsa/rsa.go.html#4423373">modInverse</a></span><span class="op" id="4425624">(</span><span class="ident" id="4425625"><a href="/crypto/rsa/rsa.go.html#4425447">r</a></span><span class="op" id="4425626">,</span>&nbsp;<span class="ident" id="4425628"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425632">.</span><span class="ident" id="4425633">N</span><span class="op" id="4425634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425639">if</span>&nbsp;<span class="ident" id="4425642"><a href="/crypto/rsa/rsa.go.html#4425594">ok</a></span>&nbsp;<span class="op" id="4425645">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425651">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425668">bigE</span>&nbsp;<span class="op" id="4425673">:=</span>&nbsp;<span class="ident" id="4425676"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425679">.</span><span class="ident" id="4425680">NewInt</span><span class="op" id="4425686">(</span><span class="ident" id="4425687">int64</span><span class="op" id="4425692">(</span><span class="ident" id="4425693"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425697">.</span><span class="ident" id="4425698">E</span><span class="op" id="4425699">)</span><span class="op" id="4425700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425704">rpowe</span>&nbsp;<span class="op" id="4425710">:=</span>&nbsp;<span class="builtinfunc" id="4425713">new</span><span class="op" id="4425716">(</span><span class="ident" id="4425717"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425720">.</span><span class="ident" id="4425721">Int</span><span class="op" id="4425724">)</span><span class="op" id="4425725">.</span><span class="ident" id="4425726">Exp</span><span class="op" id="4425729">(</span><span class="ident" id="4425730"><a href="/crypto/rsa/rsa.go.html#4425447">r</a></span><span class="op" id="4425731">,</span>&nbsp;<span class="ident" id="4425733"><a href="/crypto/rsa/rsa.go.html#4425668">bigE</a></span><span class="op" id="4425737">,</span>&nbsp;<span class="ident" id="4425739"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425743">.</span><span class="ident" id="4425744">N</span><span class="op" id="4425745">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425749">cCopy</span>&nbsp;<span class="op" id="4425755">:=</span>&nbsp;<span class="builtinfunc" id="4425758">new</span><span class="op" id="4425761">(</span><span class="ident" id="4425762"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425765">.</span><span class="ident" id="4425766">Int</span><span class="op" id="4425769">)</span><span class="op" id="4425770">.</span><span class="ident" id="4425771">Set</span><span class="op" id="4425774">(</span><span class="ident" id="4425775"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span><span class="op" id="4425776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425780"><a href="/crypto/rsa/rsa.go.html#4425749">cCopy</a></span><span class="op" id="4425785">.</span><span class="ident" id="4425786">Mul</span><span class="op" id="4425789">(</span><span class="ident" id="4425790"><a href="/crypto/rsa/rsa.go.html#4425749">cCopy</a></span><span class="op" id="4425795">,</span>&nbsp;<span class="ident" id="4425797"><a href="/crypto/rsa/rsa.go.html#4425704">rpowe</a></span><span class="op" id="4425802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425806"><a href="/crypto/rsa/rsa.go.html#4425749">cCopy</a></span><span class="op" id="4425811">.</span><span class="ident" id="4425812">Mod</span><span class="op" id="4425815">(</span><span class="ident" id="4425816"><a href="/crypto/rsa/rsa.go.html#4425749">cCopy</a></span><span class="op" id="4425821">,</span>&nbsp;<span class="ident" id="4425823"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425827">.</span><span class="ident" id="4425828">N</span><span class="op" id="4425829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425833"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span>&nbsp;<span class="op" id="4425835">=</span>&nbsp;<span class="ident" id="4425837"><a href="/crypto/rsa/rsa.go.html#4425749">cCopy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425844">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4425848">if</span>&nbsp;<span class="ident" id="4425851"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425855">.</span><span class="ident" id="4425856">Precomputed</span><span class="op" id="4425867">.</span><span class="ident" id="4425868">Dp</span>&nbsp;<span class="op" id="4425871">==</span>&nbsp;<span class="ident" id="4425874">nil</span>&nbsp;<span class="op" id="4425878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425882"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span>&nbsp;<span class="op" id="4425884">=</span>&nbsp;<span class="builtinfunc" id="4425886">new</span><span class="op" id="4425889">(</span><span class="ident" id="4425890"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4425893">.</span><span class="ident" id="4425894">Int</span><span class="op" id="4425897">)</span><span class="op" id="4425898">.</span><span class="ident" id="4425899">Exp</span><span class="op" id="4425902">(</span><span class="ident" id="4425903"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span><span class="op" id="4425904">,</span>&nbsp;<span class="ident" id="4425906"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425910">.</span><span class="ident" id="4425911">D</span><span class="op" id="4425912">,</span>&nbsp;<span class="ident" id="4425914"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4425918">.</span><span class="ident" id="4425919">N</span><span class="op" id="4425920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4425923">}</span>&nbsp;<span class="keyword" id="4425925">else</span>&nbsp;<span class="op" id="4425930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4425934">//&nbsp;We&nbsp;have&nbsp;the&nbsp;precalculated&nbsp;values&nbsp;needed&nbsp;for&nbsp;the&nbsp;CRT.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4425992"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span>&nbsp;<span class="op" id="4425994">=</span>&nbsp;<span class="builtinfunc" id="4425996">new</span><span class="op" id="4425999">(</span><span class="ident" id="4426000"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4426003">.</span><span class="ident" id="4426004">Int</span><span class="op" id="4426007">)</span><span class="op" id="4426008">.</span><span class="ident" id="4426009">Exp</span><span class="op" id="4426012">(</span><span class="ident" id="4426013"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span><span class="op" id="4426014">,</span>&nbsp;<span class="ident" id="4426016"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426020">.</span><span class="ident" id="4426021">Precomputed</span><span class="op" id="4426032">.</span><span class="ident" id="4426033">Dp</span><span class="op" id="4426035">,</span>&nbsp;<span class="ident" id="4426037"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426041">.</span><span class="ident" id="4426042">Primes</span><span class="op" id="4426048">[</span><span class="num" id="4426049">0</span><span class="op" id="4426050">]</span><span class="op" id="4426051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426055">m2</span>&nbsp;<span class="op" id="4426058">:=</span>&nbsp;<span class="builtinfunc" id="4426061">new</span><span class="op" id="4426064">(</span><span class="ident" id="4426065"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4426068">.</span><span class="ident" id="4426069">Int</span><span class="op" id="4426072">)</span><span class="op" id="4426073">.</span><span class="ident" id="4426074">Exp</span><span class="op" id="4426077">(</span><span class="ident" id="4426078"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span><span class="op" id="4426079">,</span>&nbsp;<span class="ident" id="4426081"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426085">.</span><span class="ident" id="4426086">Precomputed</span><span class="op" id="4426097">.</span><span class="ident" id="4426098">Dq</span><span class="op" id="4426100">,</span>&nbsp;<span class="ident" id="4426102"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426106">.</span><span class="ident" id="4426107">Primes</span><span class="op" id="4426113">[</span><span class="num" id="4426114">1</span><span class="op" id="4426115">]</span><span class="op" id="4426116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426120"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426121">.</span><span class="ident" id="4426122">Sub</span><span class="op" id="4426125">(</span><span class="ident" id="4426126"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426127">,</span>&nbsp;<span class="ident" id="4426129"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426135">if</span>&nbsp;<span class="ident" id="4426138"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426139">.</span><span class="ident" id="4426140">Sign</span><span class="op" id="4426144">(</span><span class="op" id="4426145">)</span>&nbsp;<span class="op" id="4426147">&lt;</span>&nbsp;<span class="num" id="4426149">0</span>&nbsp;<span class="op" id="4426151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426156"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426157">.</span><span class="ident" id="4426158">Add</span><span class="op" id="4426161">(</span><span class="ident" id="4426162"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426163">,</span>&nbsp;<span class="ident" id="4426165"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426169">.</span><span class="ident" id="4426170">Primes</span><span class="op" id="4426176">[</span><span class="num" id="4426177">0</span><span class="op" id="4426178">]</span><span class="op" id="4426179">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426187"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426188">.</span><span class="ident" id="4426189">Mul</span><span class="op" id="4426192">(</span><span class="ident" id="4426193"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426194">,</span>&nbsp;<span class="ident" id="4426196"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426200">.</span><span class="ident" id="4426201">Precomputed</span><span class="op" id="4426212">.</span><span class="ident" id="4426213">Qinv</span><span class="op" id="4426217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426221"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426222">.</span><span class="ident" id="4426223">Mod</span><span class="op" id="4426226">(</span><span class="ident" id="4426227"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426228">,</span>&nbsp;<span class="ident" id="4426230"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426234">.</span><span class="ident" id="4426235">Primes</span><span class="op" id="4426241">[</span><span class="num" id="4426242">0</span><span class="op" id="4426243">]</span><span class="op" id="4426244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426248"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426249">.</span><span class="ident" id="4426250">Mul</span><span class="op" id="4426253">(</span><span class="ident" id="4426254"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426255">,</span>&nbsp;<span class="ident" id="4426257"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426261">.</span><span class="ident" id="4426262">Primes</span><span class="op" id="4426268">[</span><span class="num" id="4426269">1</span><span class="op" id="4426270">]</span><span class="op" id="4426271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426275"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426276">.</span><span class="ident" id="4426277">Add</span><span class="op" id="4426280">(</span><span class="ident" id="4426281"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426282">,</span>&nbsp;<span class="ident" id="4426284"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426286">)</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426291">for</span>&nbsp;<span class="ident" id="4426295">i</span><span class="op" id="4426296">,</span>&nbsp;<span class="ident" id="4426298">values</span>&nbsp;<span class="op" id="4426305">:=</span>&nbsp;<span class="keyword" id="4426308">range</span>&nbsp;<span class="ident" id="4426314"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426318">.</span><span class="ident" id="4426319">Precomputed</span><span class="op" id="4426330">.</span><span class="ident" id="4426331">CRTValues</span>&nbsp;<span class="op" id="4426341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426346">prime</span>&nbsp;<span class="op" id="4426352">:=</span>&nbsp;<span class="ident" id="4426355"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426359">.</span><span class="ident" id="4426360">Primes</span><span class="op" id="4426366">[</span><span class="num" id="4426367">2</span><span class="op" id="4426368">+</span><span class="ident" id="4426369"><a href="/crypto/rsa/rsa.go.html#4426295">i</a></span><span class="op" id="4426370">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426375"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426377">.</span><span class="ident" id="4426378">Exp</span><span class="op" id="4426381">(</span><span class="ident" id="4426382"><a href="/crypto/rsa/rsa.go.html#4425007">c</a></span><span class="op" id="4426383">,</span>&nbsp;<span class="ident" id="4426385"><a href="/crypto/rsa/rsa.go.html#4426298">values</a></span><span class="op" id="4426391">.</span><span class="ident" id="4426392">Exp</span><span class="op" id="4426395">,</span>&nbsp;<span class="ident" id="4426397"><a href="/crypto/rsa/rsa.go.html#4426346">prime</a></span><span class="op" id="4426402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426407"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426409">.</span><span class="ident" id="4426410">Sub</span><span class="op" id="4426413">(</span><span class="ident" id="4426414"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426416">,</span>&nbsp;<span class="ident" id="4426418"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426419">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426424"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426426">.</span><span class="ident" id="4426427">Mul</span><span class="op" id="4426430">(</span><span class="ident" id="4426431"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426433">,</span>&nbsp;<span class="ident" id="4426435"><a href="/crypto/rsa/rsa.go.html#4426298">values</a></span><span class="op" id="4426441">.</span><span class="ident" id="4426442">Coeff</span><span class="op" id="4426447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426452"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426454">.</span><span class="ident" id="4426455">Mod</span><span class="op" id="4426458">(</span><span class="ident" id="4426459"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426461">,</span>&nbsp;<span class="ident" id="4426463"><a href="/crypto/rsa/rsa.go.html#4426346">prime</a></span><span class="op" id="4426468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426473">if</span>&nbsp;<span class="ident" id="4426476"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426478">.</span><span class="ident" id="4426479">Sign</span><span class="op" id="4426483">(</span><span class="op" id="4426484">)</span>&nbsp;<span class="op" id="4426486">&lt;</span>&nbsp;<span class="num" id="4426488">0</span>&nbsp;<span class="op" id="4426490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426496"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426498">.</span><span class="ident" id="4426499">Add</span><span class="op" id="4426502">(</span><span class="ident" id="4426503"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426505">,</span>&nbsp;<span class="ident" id="4426507"><a href="/crypto/rsa/rsa.go.html#4426346">prime</a></span><span class="op" id="4426512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426517">}</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426522"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426524">.</span><span class="ident" id="4426525">Mul</span><span class="op" id="4426528">(</span><span class="ident" id="4426529"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426531">,</span>&nbsp;<span class="ident" id="4426533"><a href="/crypto/rsa/rsa.go.html#4426298">values</a></span><span class="op" id="4426539">.</span><span class="ident" id="4426540">R</span><span class="op" id="4426541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426546"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426547">.</span><span class="ident" id="4426548">Add</span><span class="op" id="4426551">(</span><span class="ident" id="4426552"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426553">,</span>&nbsp;<span class="ident" id="4426555"><a href="/crypto/rsa/rsa.go.html#4426055">m2</a></span><span class="op" id="4426557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426568">if</span>&nbsp;<span class="ident" id="4426571"><a href="/crypto/rsa/rsa.go.html#4425161">ir</a></span>&nbsp;<span class="op" id="4426574">!=</span>&nbsp;<span class="ident" id="4426577">nil</span>&nbsp;<span class="op" id="4426581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4426585">//&nbsp;Unblind.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426599"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426600">.</span><span class="ident" id="4426601">Mul</span><span class="op" id="4426604">(</span><span class="ident" id="4426605"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426606">,</span>&nbsp;<span class="ident" id="4426608"><a href="/crypto/rsa/rsa.go.html#4425161">ir</a></span><span class="op" id="4426610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426614"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426615">.</span><span class="ident" id="4426616">Mod</span><span class="op" id="4426619">(</span><span class="ident" id="4426620"><a href="/crypto/rsa/rsa.go.html#4425020">m</a></span><span class="op" id="4426621">,</span>&nbsp;<span class="ident" id="4426623"><a href="/crypto/rsa/rsa.go.html#4424989">priv</a></span><span class="op" id="4426627">.</span><span class="ident" id="4426628">N</span><span class="op" id="4426629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426632">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426636">return</span><br>
<span class="lineno"></span><span class="op" id="4426643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4426646">//&nbsp;DecryptOAEP&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;RSA-OAEP.</span><br>
<span class="lineno">475</span><span class="comment" id="4426697">//&nbsp;If&nbsp;random&nbsp;!=&nbsp;nil,&nbsp;DecryptOAEP&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4426786">func</span>&nbsp;<span class="ident" id="4426791">DecryptOAEP</span><span class="op" id="4426802">(</span><span class="ident" id="4426803">hash</span>&nbsp;<span class="ident" id="4426808"><a href="/crypto/rsa/rsa.go.html#4413806">hash</a></span><span class="op" id="4426812">.</span><span class="ident" id="4426813">Hash</span><span class="op" id="4426817">,</span>&nbsp;<span class="ident" id="4426819">random</span>&nbsp;<span class="ident" id="4426826"><a href="/crypto/rsa/rsa.go.html#4413814">io</a></span><span class="op" id="4426828">.</span><span class="ident" id="4426829">Reader</span><span class="op" id="4426835">,</span>&nbsp;<span class="ident" id="4426837">priv</span>&nbsp;<span class="op" id="4426842">*</span><span class="ident" id="4426843"><a href="/crypto/rsa/rsa.go.html#4414783">PrivateKey</a></span><span class="op" id="4426853">,</span>&nbsp;<span class="ident" id="4426855">ciphertext</span>&nbsp;<span class="op" id="4426866">[</span><span class="op" id="4426867">]</span><span class="builtintype" id="4426868">byte</span><span class="op" id="4426872">,</span>&nbsp;<span class="ident" id="4426874">label</span>&nbsp;<span class="op" id="4426880">[</span><span class="op" id="4426881">]</span><span class="builtintype" id="4426882">byte</span><span class="op" id="4426886">)</span>&nbsp;<span class="op" id="4426888">(</span><span class="ident" id="4426889">msg</span>&nbsp;<span class="op" id="4426893">[</span><span class="op" id="4426894">]</span><span class="builtintype" id="4426895">byte</span><span class="op" id="4426899">,</span>&nbsp;<span class="ident" id="4426901">err</span>&nbsp;<span class="builtintype" id="4426905">error</span><span class="op" id="4426910">)</span>&nbsp;<span class="op" id="4426912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426915">if</span>&nbsp;<span class="ident" id="4426918">err</span>&nbsp;<span class="op" id="4426922">:=</span>&nbsp;<span class="ident" id="4426925"><a href="/crypto/rsa/rsa.go.html#4414536">checkPub</a></span><span class="op" id="4426933">(</span><span class="op" id="4426934">&amp;</span><span class="ident" id="4426935"><a href="/crypto/rsa/rsa.go.html#4426837">priv</a></span><span class="op" id="4426939">.</span><span class="ident" id="4426940">PublicKey</span><span class="op" id="4426949">)</span><span class="op" id="4426950">;</span>&nbsp;<span class="ident" id="4426952"><a href="/crypto/rsa/rsa.go.html#4426918">err</a></span>&nbsp;<span class="op" id="4426956">!=</span>&nbsp;<span class="ident" id="4426959">nil</span>&nbsp;<span class="op" id="4426963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4426967">return</span>&nbsp;<span class="ident" id="4426974">nil</span><span class="op" id="4426977">,</span>&nbsp;<span class="ident" id="4426979"><a href="/crypto/rsa/rsa.go.html#4426918">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4426984">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4426987">k</span>&nbsp;<span class="op" id="4426989">:=</span>&nbsp;<span class="op" id="4426992">(</span><span class="ident" id="4426993"><a href="/crypto/rsa/rsa.go.html#4426837">priv</a></span><span class="op" id="4426997">.</span><span class="ident" id="4426998">N</span><span class="op" id="4426999">.</span><span class="ident" id="4427000">BitLen</span><span class="op" id="4427006">(</span><span class="op" id="4427007">)</span>&nbsp;<span class="op" id="4427009">+</span>&nbsp;<span class="num" id="4427011">7</span><span class="op" id="4427012">)</span>&nbsp;<span class="op" id="4427014">/</span>&nbsp;<span class="num" id="4427016">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427019">if</span>&nbsp;<span class="builtinfunc" id="4427022">len</span><span class="op" id="4427025">(</span><span class="ident" id="4427026"><a href="/crypto/rsa/rsa.go.html#4426855">ciphertext</a></span><span class="op" id="4427036">)</span>&nbsp;<span class="op" id="4427038">&gt;</span>&nbsp;<span class="ident" id="4427040"><a href="/crypto/rsa/rsa.go.html#4426987">k</a></span>&nbsp;<span class="op" id="4427042">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427047"><a href="/crypto/rsa/rsa.go.html#4426987">k</a></span>&nbsp;<span class="op" id="4427049">&lt;</span>&nbsp;<span class="ident" id="4427051"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427055">.</span><span class="ident" id="4427056">Size</span><span class="op" id="4427060">(</span><span class="op" id="4427061">)</span><span class="op" id="4427062">*</span><span class="num" id="4427063">2</span><span class="op" id="4427064">+</span><span class="num" id="4427065">2</span>&nbsp;<span class="op" id="4427067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427071"><a href="/crypto/rsa/rsa.go.html#4426901">err</a></span>&nbsp;<span class="op" id="4427075">=</span>&nbsp;<span class="ident" id="4427077"><a href="/crypto/rsa/rsa.go.html#4422966">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427093">return</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427105">c</span>&nbsp;<span class="op" id="4427107">:=</span>&nbsp;<span class="builtinfunc" id="4427110">new</span><span class="op" id="4427113">(</span><span class="ident" id="4427114"><a href="/crypto/rsa/rsa.go.html#4413820">big</a></span><span class="op" id="4427117">.</span><span class="ident" id="4427118">Int</span><span class="op" id="4427121">)</span><span class="op" id="4427122">.</span><span class="ident" id="4427123">SetBytes</span><span class="op" id="4427131">(</span><span class="ident" id="4427132"><a href="/crypto/rsa/rsa.go.html#4426855">ciphertext</a></span><span class="op" id="4427142">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427146">m</span><span class="op" id="4427147">,</span>&nbsp;<span class="ident" id="4427149"><a href="/crypto/rsa/rsa.go.html#4426901">err</a></span>&nbsp;<span class="op" id="4427153">:=</span>&nbsp;<span class="ident" id="4427156"><a href="/crypto/rsa/rsa.go.html#4424963">decrypt</a></span><span class="op" id="4427163">(</span><span class="ident" id="4427164"><a href="/crypto/rsa/rsa.go.html#4426819">random</a></span><span class="op" id="4427170">,</span>&nbsp;<span class="ident" id="4427172"><a href="/crypto/rsa/rsa.go.html#4426837">priv</a></span><span class="op" id="4427176">,</span>&nbsp;<span class="ident" id="4427178"><a href="/crypto/rsa/rsa.go.html#4427105">c</a></span><span class="op" id="4427179">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427182">if</span>&nbsp;<span class="ident" id="4427185"><a href="/crypto/rsa/rsa.go.html#4426901">err</a></span>&nbsp;<span class="op" id="4427189">!=</span>&nbsp;<span class="ident" id="4427192">nil</span>&nbsp;<span class="op" id="4427196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4427200">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4427208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427212"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427216">.</span><span class="ident" id="4427217">Write</span><span class="op" id="4427222">(</span><span class="ident" id="4427223"><a href="/crypto/rsa/rsa.go.html#4426874">label</a></span><span class="op" id="4427228">)</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427231">lHash</span>&nbsp;<span class="op" id="4427237">:=</span>&nbsp;<span class="ident" id="4427240"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427244">.</span><span class="ident" id="4427245">Sum</span><span class="op" id="4427248">(</span><span class="ident" id="4427249">nil</span><span class="op" id="4427252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427255"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427259">.</span><span class="ident" id="4427260">Reset</span><span class="op" id="4427265">(</span><span class="op" id="4427266">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427270">//&nbsp;Converting&nbsp;the&nbsp;plaintext&nbsp;number&nbsp;to&nbsp;bytes&nbsp;will&nbsp;strip&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427330">//&nbsp;leading&nbsp;zeros&nbsp;so&nbsp;we&nbsp;may&nbsp;have&nbsp;to&nbsp;left&nbsp;pad.&nbsp;We&nbsp;do&nbsp;this&nbsp;unconditionally</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427403">//&nbsp;to&nbsp;avoid&nbsp;leaking&nbsp;timing&nbsp;information.&nbsp;(Although&nbsp;we&nbsp;still&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427472">//&nbsp;leak&nbsp;the&nbsp;number&nbsp;of&nbsp;leading&nbsp;zeros.&nbsp;It&#39;s&nbsp;not&nbsp;clear&nbsp;that&nbsp;we&nbsp;can&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427540">//&nbsp;anything&nbsp;about&nbsp;this.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427566">em</span>&nbsp;<span class="op" id="4427569">:=</span>&nbsp;<span class="ident" id="4427572"><a href="/crypto/rsa/rsa.go.html#4429093">leftPad</a></span><span class="op" id="4427579">(</span><span class="ident" id="4427580"><a href="/crypto/rsa/rsa.go.html#4427146">m</a></span><span class="op" id="4427581">.</span><span class="ident" id="4427582">Bytes</span><span class="op" id="4427587">(</span><span class="op" id="4427588">)</span><span class="op" id="4427589">,</span>&nbsp;<span class="ident" id="4427591"><a href="/crypto/rsa/rsa.go.html#4426987">k</a></span><span class="op" id="4427592">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427596">firstByteIsZero</span>&nbsp;<span class="op" id="4427612">:=</span>&nbsp;<span class="ident" id="4427615"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4427621">.</span><span class="ident" id="4427622">ConstantTimeByteEq</span><span class="op" id="4427640">(</span><span class="ident" id="4427641"><a href="/crypto/rsa/rsa.go.html#4427566">em</a></span><span class="op" id="4427643">[</span><span class="num" id="4427644">0</span><span class="op" id="4427645">]</span><span class="op" id="4427646">,</span>&nbsp;<span class="num" id="4427648">0</span><span class="op" id="4427649">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427653">seed</span>&nbsp;<span class="op" id="4427658">:=</span>&nbsp;<span class="ident" id="4427661"><a href="/crypto/rsa/rsa.go.html#4427566">em</a></span><span class="op" id="4427663">[</span><span class="num" id="4427664">1</span>&nbsp;<span class="op" id="4427666">:</span>&nbsp;<span class="ident" id="4427668"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427672">.</span><span class="ident" id="4427673">Size</span><span class="op" id="4427677">(</span><span class="op" id="4427678">)</span><span class="op" id="4427679">+</span><span class="num" id="4427680">1</span><span class="op" id="4427681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427684">db</span>&nbsp;<span class="op" id="4427687">:=</span>&nbsp;<span class="ident" id="4427690"><a href="/crypto/rsa/rsa.go.html#4427566">em</a></span><span class="op" id="4427692">[</span><span class="ident" id="4427693"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427697">.</span><span class="ident" id="4427698">Size</span><span class="op" id="4427702">(</span><span class="op" id="4427703">)</span><span class="op" id="4427704">+</span><span class="num" id="4427705">1</span><span class="op" id="4427706">:</span><span class="op" id="4427707">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427711"><a href="/crypto/rsa/rsa.go.html#4421094">mgf1XOR</a></span><span class="op" id="4427718">(</span><span class="ident" id="4427719"><a href="/crypto/rsa/rsa.go.html#4427653">seed</a></span><span class="op" id="4427723">,</span>&nbsp;<span class="ident" id="4427725"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427729">,</span>&nbsp;<span class="ident" id="4427731"><a href="/crypto/rsa/rsa.go.html#4427684">db</a></span><span class="op" id="4427733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427736"><a href="/crypto/rsa/rsa.go.html#4421094">mgf1XOR</a></span><span class="op" id="4427743">(</span><span class="ident" id="4427744"><a href="/crypto/rsa/rsa.go.html#4427684">db</a></span><span class="op" id="4427746">,</span>&nbsp;<span class="ident" id="4427748"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427752">,</span>&nbsp;<span class="ident" id="4427754"><a href="/crypto/rsa/rsa.go.html#4427653">seed</a></span><span class="op" id="4427758">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4427762">lHash2</span>&nbsp;<span class="op" id="4427769">:=</span>&nbsp;<span class="ident" id="4427772"><a href="/crypto/rsa/rsa.go.html#4427684">db</a></span><span class="op" id="4427774">[</span><span class="num" id="4427775">0</span><span class="op" id="4427776">:</span><span class="ident" id="4427777"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4427781">.</span><span class="ident" id="4427782">Size</span><span class="op" id="4427786">(</span><span class="op" id="4427787">)</span><span class="op" id="4427788">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427792">//&nbsp;We&nbsp;have&nbsp;to&nbsp;validate&nbsp;the&nbsp;plaintext&nbsp;in&nbsp;constant&nbsp;time&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427865">//&nbsp;attacks&nbsp;like:&nbsp;J.&nbsp;Manger.&nbsp;A&nbsp;Chosen&nbsp;Ciphertext&nbsp;Attack&nbsp;on&nbsp;RSA&nbsp;Optimal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4427936">//&nbsp;Asymmetric&nbsp;Encryption&nbsp;Padding&nbsp;(OAEP)&nbsp;as&nbsp;Standardized&nbsp;in&nbsp;PKCS&nbsp;#1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428004">//&nbsp;v2.0.&nbsp;In&nbsp;J.&nbsp;Kilian,&nbsp;editor,&nbsp;Advances&nbsp;in&nbsp;Cryptology.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428060">lHash2Good</span>&nbsp;<span class="op" id="4428071">:=</span>&nbsp;<span class="ident" id="4428074"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4428080">.</span><span class="ident" id="4428081">ConstantTimeCompare</span><span class="op" id="4428100">(</span><span class="ident" id="4428101"><a href="/crypto/rsa/rsa.go.html#4427231">lHash</a></span><span class="op" id="4428106">,</span>&nbsp;<span class="ident" id="4428108"><a href="/crypto/rsa/rsa.go.html#4427762">lHash2</a></span><span class="op" id="4428114">)</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428118">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;zero&nbsp;or&nbsp;more&nbsp;0x00,&nbsp;followed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428189">//&nbsp;by&nbsp;0x01,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428227">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428290">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;0x01&nbsp;byte</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4428337">//&nbsp;&nbsp;&nbsp;invalid:&nbsp;1&nbsp;iff&nbsp;we&nbsp;saw&nbsp;a&nbsp;non-zero&nbsp;byte&nbsp;before&nbsp;the&nbsp;0x01.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428398">var</span>&nbsp;<span class="ident" id="4428402">lookingForIndex</span><span class="op" id="4428417">,</span>&nbsp;<span class="ident" id="4428419">index</span><span class="op" id="4428424">,</span>&nbsp;<span class="ident" id="4428426">invalid</span>&nbsp;<span class="builtintype" id="4428434">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428439"><a href="/crypto/rsa/rsa.go.html#4428402">lookingForIndex</a></span>&nbsp;<span class="op" id="4428455">=</span>&nbsp;<span class="num" id="4428457">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428460">rest</span>&nbsp;<span class="op" id="4428465">:=</span>&nbsp;<span class="ident" id="4428468"><a href="/crypto/rsa/rsa.go.html#4427684">db</a></span><span class="op" id="4428470">[</span><span class="ident" id="4428471"><a href="/crypto/rsa/rsa.go.html#4426803">hash</a></span><span class="op" id="4428475">.</span><span class="ident" id="4428476">Size</span><span class="op" id="4428480">(</span><span class="op" id="4428481">)</span><span class="op" id="4428482">:</span><span class="op" id="4428483">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428487">for</span>&nbsp;<span class="ident" id="4428491">i</span>&nbsp;<span class="op" id="4428493">:=</span>&nbsp;<span class="num" id="4428496">0</span><span class="op" id="4428497">;</span>&nbsp;<span class="ident" id="4428499"><a href="/crypto/rsa/rsa.go.html#4428491">i</a></span>&nbsp;<span class="op" id="4428501">&lt;</span>&nbsp;<span class="builtinfunc" id="4428503">len</span><span class="op" id="4428506">(</span><span class="ident" id="4428507"><a href="/crypto/rsa/rsa.go.html#4428460">rest</a></span><span class="op" id="4428511">)</span><span class="op" id="4428512">;</span>&nbsp;<span class="ident" id="4428514"><a href="/crypto/rsa/rsa.go.html#4428491">i</a></span><span class="op" id="4428515">++</span>&nbsp;<span class="op" id="4428518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428522">equals0</span>&nbsp;<span class="op" id="4428530">:=</span>&nbsp;<span class="ident" id="4428533"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4428539">.</span><span class="ident" id="4428540">ConstantTimeByteEq</span><span class="op" id="4428558">(</span><span class="ident" id="4428559"><a href="/crypto/rsa/rsa.go.html#4428460">rest</a></span><span class="op" id="4428563">[</span><span class="ident" id="4428564"><a href="/crypto/rsa/rsa.go.html#4428491">i</a></span><span class="op" id="4428565">]</span><span class="op" id="4428566">,</span>&nbsp;<span class="num" id="4428568">0</span><span class="op" id="4428569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428573">equals1</span>&nbsp;<span class="op" id="4428581">:=</span>&nbsp;<span class="ident" id="4428584"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4428590">.</span><span class="ident" id="4428591">ConstantTimeByteEq</span><span class="op" id="4428609">(</span><span class="ident" id="4428610"><a href="/crypto/rsa/rsa.go.html#4428460">rest</a></span><span class="op" id="4428614">[</span><span class="ident" id="4428615"><a href="/crypto/rsa/rsa.go.html#4428491">i</a></span><span class="op" id="4428616">]</span><span class="op" id="4428617">,</span>&nbsp;<span class="num" id="4428619">1</span><span class="op" id="4428620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428624"><a href="/crypto/rsa/rsa.go.html#4428419">index</a></span>&nbsp;<span class="op" id="4428630">=</span>&nbsp;<span class="ident" id="4428632"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4428638">.</span><span class="ident" id="4428639">ConstantTimeSelect</span><span class="op" id="4428657">(</span><span class="ident" id="4428658"><a href="/crypto/rsa/rsa.go.html#4428402">lookingForIndex</a></span><span class="op" id="4428673">&amp;</span><span class="ident" id="4428674"><a href="/crypto/rsa/rsa.go.html#4428573">equals1</a></span><span class="op" id="4428681">,</span>&nbsp;<span class="ident" id="4428683"><a href="/crypto/rsa/rsa.go.html#4428491">i</a></span><span class="op" id="4428684">,</span>&nbsp;<span class="ident" id="4428686"><a href="/crypto/rsa/rsa.go.html#4428419">index</a></span><span class="op" id="4428691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428695"><a href="/crypto/rsa/rsa.go.html#4428402">lookingForIndex</a></span>&nbsp;<span class="op" id="4428711">=</span>&nbsp;<span class="ident" id="4428713"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4428719">.</span><span class="ident" id="4428720">ConstantTimeSelect</span><span class="op" id="4428738">(</span><span class="ident" id="4428739"><a href="/crypto/rsa/rsa.go.html#4428573">equals1</a></span><span class="op" id="4428746">,</span>&nbsp;<span class="num" id="4428748">0</span><span class="op" id="4428749">,</span>&nbsp;<span class="ident" id="4428751"><a href="/crypto/rsa/rsa.go.html#4428402">lookingForIndex</a></span><span class="op" id="4428766">)</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428770"><a href="/crypto/rsa/rsa.go.html#4428426">invalid</a></span>&nbsp;<span class="op" id="4428778">=</span>&nbsp;<span class="ident" id="4428780"><a href="/crypto/rsa/rsa.go.html#4413779">subtle</a></span><span class="op" id="4428786">.</span><span class="ident" id="4428787">ConstantTimeSelect</span><span class="op" id="4428805">(</span><span class="ident" id="4428806"><a href="/crypto/rsa/rsa.go.html#4428402">lookingForIndex</a></span><span class="op" id="4428821">&amp;^</span><span class="ident" id="4428823"><a href="/crypto/rsa/rsa.go.html#4428522">equals0</a></span><span class="op" id="4428830">,</span>&nbsp;<span class="num" id="4428832">1</span><span class="op" id="4428833">,</span>&nbsp;<span class="ident" id="4428835"><a href="/crypto/rsa/rsa.go.html#4428426">invalid</a></span><span class="op" id="4428842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428849">if</span>&nbsp;<span class="ident" id="4428852"><a href="/crypto/rsa/rsa.go.html#4427596">firstByteIsZero</a></span><span class="op" id="4428867">&amp;</span><span class="ident" id="4428868"><a href="/crypto/rsa/rsa.go.html#4428060">lHash2Good</a></span><span class="op" id="4428878">&amp;^</span><span class="ident" id="4428880"><a href="/crypto/rsa/rsa.go.html#4428426">invalid</a></span><span class="op" id="4428887">&amp;^</span><span class="ident" id="4428889"><a href="/crypto/rsa/rsa.go.html#4428402">lookingForIndex</a></span>&nbsp;<span class="op" id="4428905">!=</span>&nbsp;<span class="num" id="4428908">1</span>&nbsp;<span class="op" id="4428910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428914"><a href="/crypto/rsa/rsa.go.html#4426901">err</a></span>&nbsp;<span class="op" id="4428918">=</span>&nbsp;<span class="ident" id="4428920"><a href="/crypto/rsa/rsa.go.html#4422966">ErrDecryption</a></span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428936">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4428944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4428948"><a href="/crypto/rsa/rsa.go.html#4426889">msg</a></span>&nbsp;<span class="op" id="4428952">=</span>&nbsp;<span class="ident" id="4428954"><a href="/crypto/rsa/rsa.go.html#4428460">rest</a></span><span class="op" id="4428958">[</span><span class="ident" id="4428959"><a href="/crypto/rsa/rsa.go.html#4428419">index</a></span><span class="op" id="4428964">+</span><span class="num" id="4428965">1</span><span class="op" id="4428966">:</span><span class="op" id="4428967">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4428970">return</span><br>
<span class="lineno">545</span><span class="op" id="4428977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4428980">//&nbsp;leftPad&nbsp;returns&nbsp;a&nbsp;new&nbsp;slice&nbsp;of&nbsp;length&nbsp;size.&nbsp;The&nbsp;contents&nbsp;of&nbsp;input&nbsp;are&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="4429059">//&nbsp;aligned&nbsp;in&nbsp;the&nbsp;new&nbsp;slice.</span><br>
<span class="lineno"></span><span class="keyword" id="4429088">func</span>&nbsp;<span class="ident" id="4429093">leftPad</span><span class="op" id="4429100">(</span><span class="ident" id="4429101">input</span>&nbsp;<span class="op" id="4429107">[</span><span class="op" id="4429108">]</span><span class="builtintype" id="4429109">byte</span><span class="op" id="4429113">,</span>&nbsp;<span class="ident" id="4429115">size</span>&nbsp;<span class="builtintype" id="4429120">int</span><span class="op" id="4429123">)</span>&nbsp;<span class="op" id="4429125">(</span><span class="ident" id="4429126">out</span>&nbsp;<span class="op" id="4429130">[</span><span class="op" id="4429131">]</span><span class="builtintype" id="4429132">byte</span><span class="op" id="4429136">)</span>&nbsp;<span class="op" id="4429138">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429141">n</span>&nbsp;<span class="op" id="4429143">:=</span>&nbsp;<span class="builtinfunc" id="4429146">len</span><span class="op" id="4429149">(</span><span class="ident" id="4429150"><a href="/crypto/rsa/rsa.go.html#4429101">input</a></span><span class="op" id="4429155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429158">if</span>&nbsp;<span class="ident" id="4429161"><a href="/crypto/rsa/rsa.go.html#4429141">n</a></span>&nbsp;<span class="op" id="4429163">&gt;</span>&nbsp;<span class="ident" id="4429165"><a href="/crypto/rsa/rsa.go.html#4429115">size</a></span>&nbsp;<span class="op" id="4429170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429174"><a href="/crypto/rsa/rsa.go.html#4429141">n</a></span>&nbsp;<span class="op" id="4429176">=</span>&nbsp;<span class="ident" id="4429178"><a href="/crypto/rsa/rsa.go.html#4429115">size</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4429184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4429187"><a href="/crypto/rsa/rsa.go.html#4429126">out</a></span>&nbsp;<span class="op" id="4429191">=</span>&nbsp;<span class="builtinfunc" id="4429193">make</span><span class="op" id="4429197">(</span><span class="op" id="4429198">[</span><span class="op" id="4429199">]</span><span class="builtintype" id="4429200">byte</span><span class="op" id="4429204">,</span>&nbsp;<span class="ident" id="4429206"><a href="/crypto/rsa/rsa.go.html#4429115">size</a></span><span class="op" id="4429210">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4429213">copy</span><span class="op" id="4429217">(</span><span class="ident" id="4429218"><a href="/crypto/rsa/rsa.go.html#4429126">out</a></span><span class="op" id="4429221">[</span><span class="builtinfunc" id="4429222">len</span><span class="op" id="4429225">(</span><span class="ident" id="4429226"><a href="/crypto/rsa/rsa.go.html#4429126">out</a></span><span class="op" id="4429229">)</span><span class="op" id="4429230">-</span><span class="ident" id="4429231"><a href="/crypto/rsa/rsa.go.html#4429141">n</a></span><span class="op" id="4429232">:</span><span class="op" id="4429233">]</span><span class="op" id="4429234">,</span>&nbsp;<span class="ident" id="4429236"><a href="/crypto/rsa/rsa.go.html#4429101">input</a></span><span class="op" id="4429241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4429244">return</span><br>
<span class="lineno"></span><span class="op" id="4429251">}</span>
</div>
</body>
</html>
